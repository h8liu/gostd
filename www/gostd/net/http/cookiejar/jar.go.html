<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cookiejar</h2>
<ul>
<li><a href="/gostd/net/http/cookiejar/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/cookiejar/jar_test.go.html">jar_test.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode.go.html">punycode.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode_test.go.html">punycode_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5660749">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5660804">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5660858">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5660909">//&nbsp;Package&nbsp;cookiejar&nbsp;implements&nbsp;an&nbsp;in-memory&nbsp;RFC&nbsp;6265-compliant&nbsp;http.CookieJar.</span><br>
<span class="lineno"></span><span class="keyword" id="5660989">package</span>&nbsp;<span class="ident" id="5660997">cookiejar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5661008">import</span>&nbsp;<span class="op" id="5661015">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5661018">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5661028">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5661035">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5661042">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5661054">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5661065">&#34;sort&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5661073">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5661084">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5661092">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5661099">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5661102">//&nbsp;PublicSuffixList&nbsp;provides&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;a&nbsp;domain.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="5661175">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;example.com&#34;&nbsp;is&nbsp;&#34;com&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5661230">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;foo1.foo2.foo3.co.uk&#34;&nbsp;is&nbsp;&#34;co.uk&#34;,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5661300">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;bar.pvt.k12.ma.us&#34;&nbsp;is&nbsp;&#34;pvt.k12.ma.us&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5661371">//</span><br>
<span class="lineno">25</span><span class="comment" id="5661374">//&nbsp;Implementations&nbsp;of&nbsp;PublicSuffixList&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5661448">//&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="5661472">//</span><br>
<span class="lineno"></span><span class="comment" id="5661475">//&nbsp;An&nbsp;implementation&nbsp;that&nbsp;always&nbsp;returns&nbsp;&#34;&#34;&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5661550">//&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.com&nbsp;can</span><br>
<span class="lineno">30</span><span class="comment" id="5661629">//&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;bar.com.</span><br>
<span class="lineno"></span><span class="comment" id="5661658">//</span><br>
<span class="lineno"></span><span class="comment" id="5661661">//&nbsp;A&nbsp;public&nbsp;suffix&nbsp;list&nbsp;implementation&nbsp;is&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5661718">//&nbsp;golang.org/x/net/publicsuffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5661752">type</span>&nbsp;<span class="ident" id="5661757">PublicSuffixList</span>&nbsp;<span class="keyword" id="5661774">interface</span>&nbsp;<span class="op" id="5661784">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661787">//&nbsp;PublicSuffix&nbsp;returns&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661841">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661845">//&nbsp;TODO:&nbsp;specify&nbsp;which&nbsp;of&nbsp;the&nbsp;caller&nbsp;and&nbsp;callee&nbsp;is&nbsp;responsible&nbsp;for&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661916">//&nbsp;addresses,&nbsp;for&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;dots,&nbsp;for&nbsp;case&nbsp;sensitivity,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661988">//&nbsp;for&nbsp;IDN/Punycode.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662010">PublicSuffix</span><span class="op" id="5662022">(</span><span class="ident" id="5662023">domain</span>&nbsp;<span class="builtintype" id="5662030">string</span><span class="op" id="5662036">)</span>&nbsp;<span class="builtintype" id="5662038">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662047">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;source&nbsp;of&nbsp;this&nbsp;public&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662116">//&nbsp;list.&nbsp;The&nbsp;description&nbsp;will&nbsp;typically&nbsp;contain&nbsp;something&nbsp;like&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662187">//&nbsp;stamp&nbsp;or&nbsp;version&nbsp;number.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662216">String</span><span class="op" id="5662222">(</span><span class="op" id="5662223">)</span>&nbsp;<span class="builtintype" id="5662225">string</span><br>
<span class="lineno"></span><span class="op" id="5662232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5662235">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;options&nbsp;for&nbsp;creating&nbsp;a&nbsp;new&nbsp;Jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5662286">type</span>&nbsp;<span class="ident" id="5662291">Options</span>&nbsp;<span class="keyword" id="5662299">struct</span>&nbsp;<span class="op" id="5662306">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662309">//&nbsp;PublicSuffixList&nbsp;is&nbsp;the&nbsp;public&nbsp;suffix&nbsp;list&nbsp;that&nbsp;determines&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662380">//&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;a&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662430">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662434">//&nbsp;A&nbsp;nil&nbsp;value&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662503">//&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.co.uk&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662576">//&nbsp;for&nbsp;bar.co.uk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662595">PublicSuffixList</span>&nbsp;<span class="ident" id="5662612">PublicSuffixList</span><br>
<span class="lineno"></span><span class="op" id="5662629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5662632">//&nbsp;Jar&nbsp;implements&nbsp;the&nbsp;http.CookieJar&nbsp;interface&nbsp;from&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno">60</span><span class="keyword" id="5662706">type</span>&nbsp;<span class="ident" id="5662711">Jar</span>&nbsp;<span class="keyword" id="5662715">struct</span>&nbsp;<span class="op" id="5662722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662725">psList</span>&nbsp;<span class="ident" id="5662732">PublicSuffixList</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662751">//&nbsp;mu&nbsp;locks&nbsp;the&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662786">mu</span>&nbsp;<span class="ident" id="5662789">sync</span><span class="op" id="5662793">.</span><span class="ident" id="5662794">Mutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662802">//&nbsp;entries&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;entries,&nbsp;keyed&nbsp;by&nbsp;their&nbsp;eTLD+1&nbsp;and&nbsp;subkeyed&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662873">//&nbsp;their&nbsp;name/domain/path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662901">entries</span>&nbsp;<span class="keyword" id="5662909">map</span><span class="op" id="5662912">[</span><span class="builtintype" id="5662913">string</span><span class="op" id="5662919">]</span><span class="keyword" id="5662920">map</span><span class="op" id="5662923">[</span><span class="builtintype" id="5662924">string</span><span class="op" id="5662930">]</span><span class="ident" id="5662931">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662939">//&nbsp;nextSeqNum&nbsp;is&nbsp;the&nbsp;next&nbsp;sequence&nbsp;number&nbsp;assigned&nbsp;to&nbsp;a&nbsp;new&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5663007">//&nbsp;created&nbsp;SetCookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663031">nextSeqNum</span>&nbsp;<span class="ident" id="5663042">uint64</span><br>
<span class="lineno"></span><span class="op" id="5663049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="5663052">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;cookie&nbsp;jar.&nbsp;A&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="5663124">//&nbsp;Options.</span><br>
<span class="lineno"></span><span class="keyword" id="5663136">func</span>&nbsp;<span class="ident" id="5663141">New</span><span class="op" id="5663144">(</span><span class="ident" id="5663145">o</span>&nbsp;<span class="op" id="5663147">*</span><span class="ident" id="5663148">Options</span><span class="op" id="5663155">)</span>&nbsp;<span class="op" id="5663157">(</span><span class="op" id="5663158">*</span><span class="ident" id="5663159">Jar</span><span class="op" id="5663162">,</span>&nbsp;<span class="builtintype" id="5663164">error</span><span class="op" id="5663169">)</span>&nbsp;<span class="op" id="5663171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663174">jar</span>&nbsp;<span class="op" id="5663178">:=</span>&nbsp;<span class="op" id="5663181">&amp;</span><span class="ident" id="5663182">Jar</span><span class="op" id="5663185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663189">entries</span><span class="op" id="5663196">:</span>&nbsp;<span class="builtinfunc" id="5663198">make</span><span class="op" id="5663202">(</span><span class="keyword" id="5663203">map</span><span class="op" id="5663206">[</span><span class="builtintype" id="5663207">string</span><span class="op" id="5663213">]</span><span class="keyword" id="5663214">map</span><span class="op" id="5663217">[</span><span class="builtintype" id="5663218">string</span><span class="op" id="5663224">]</span><span class="ident" id="5663225">entry</span><span class="op" id="5663230">)</span><span class="op" id="5663231">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663237">if</span>&nbsp;<span class="ident" id="5663240">o</span>&nbsp;<span class="op" id="5663242">!=</span>&nbsp;<span class="ident" id="5663245">nil</span>&nbsp;<span class="op" id="5663249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663253">jar</span><span class="op" id="5663256">.</span><span class="ident" id="5663257">psList</span>&nbsp;<span class="op" id="5663264">=</span>&nbsp;<span class="ident" id="5663266">o</span><span class="op" id="5663267">.</span><span class="ident" id="5663268">PublicSuffixList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663289">return</span>&nbsp;<span class="ident" id="5663296">jar</span><span class="op" id="5663299">,</span>&nbsp;<span class="ident" id="5663301">nil</span><br>
<span class="lineno">85</span><span class="op" id="5663305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5663308">//&nbsp;entry&nbsp;is&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;a&nbsp;cookie.</span><br>
<span class="lineno"></span><span class="comment" id="5663361">//</span><br>
<span class="lineno"></span><span class="comment" id="5663364">//&nbsp;This&nbsp;struct&nbsp;type&nbsp;is&nbsp;not&nbsp;used&nbsp;outside&nbsp;of&nbsp;this&nbsp;package&nbsp;per&nbsp;se,&nbsp;but&nbsp;the&nbsp;exported</span><br>
<span class="lineno">90</span><span class="comment" id="5663445">//&nbsp;fields&nbsp;are&nbsp;those&nbsp;of&nbsp;RFC&nbsp;6265.</span><br>
<span class="lineno"></span><span class="keyword" id="5663478">type</span>&nbsp;<span class="ident" id="5663483">entry</span>&nbsp;<span class="keyword" id="5663489">struct</span>&nbsp;<span class="op" id="5663496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663499">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5663510">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663518">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5663529">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663537">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5663548">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663556">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5663567">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663575">Secure</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5663586">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663592">HttpOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5663603">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663609">Persistent</span>&nbsp;<span class="builtintype" id="5663620">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663626">HostOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5663637">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663643">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663654">time</span><span class="op" id="5663658">.</span><span class="ident" id="5663659">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663665">Creation</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5663676">time</span><span class="op" id="5663680">.</span><span class="ident" id="5663681">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663687">LastAccess</span>&nbsp;<span class="ident" id="5663698">time</span><span class="op" id="5663702">.</span><span class="ident" id="5663703">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5663710">//&nbsp;seqNum&nbsp;is&nbsp;a&nbsp;sequence&nbsp;number&nbsp;so&nbsp;that&nbsp;Cookies&nbsp;returns&nbsp;cookies&nbsp;in&nbsp;a</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5663779">//&nbsp;deterministic&nbsp;order,&nbsp;even&nbsp;for&nbsp;cookies&nbsp;that&nbsp;have&nbsp;equal&nbsp;Path&nbsp;length&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5663853">//&nbsp;equal&nbsp;Creation&nbsp;time.&nbsp;This&nbsp;simplifies&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663903">seqNum</span>&nbsp;<span class="ident" id="5663910">uint64</span><br>
<span class="lineno"></span><span class="op" id="5663917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5663920">//&nbsp;Id&nbsp;returns&nbsp;the&nbsp;domain;path;name&nbsp;triple&nbsp;of&nbsp;e&nbsp;as&nbsp;an&nbsp;id.</span><br>
<span class="lineno"></span><span class="keyword" id="5663977">func</span>&nbsp;<span class="op" id="5663982">(</span><span class="ident" id="5663983">e</span>&nbsp;<span class="op" id="5663985">*</span><span class="ident" id="5663986">entry</span><span class="op" id="5663991">)</span>&nbsp;<span class="ident" id="5663993">id</span><span class="op" id="5663995">(</span><span class="op" id="5663996">)</span>&nbsp;<span class="builtintype" id="5663998">string</span>&nbsp;<span class="op" id="5664005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664008">return</span>&nbsp;<span class="ident" id="5664015">fmt</span><span class="op" id="5664018">.</span><span class="ident" id="5664019">Sprintf</span><span class="op" id="5664026">(</span><span class="string" id="5664027">&#34;%s;%s;%s&#34;</span><span class="op" id="5664037">,</span>&nbsp;<span class="ident" id="5664039">e</span><span class="op" id="5664040">.</span><span class="ident" id="5664041">Domain</span><span class="op" id="5664047">,</span>&nbsp;<span class="ident" id="5664049">e</span><span class="op" id="5664050">.</span><span class="ident" id="5664051">Path</span><span class="op" id="5664055">,</span>&nbsp;<span class="ident" id="5664057">e</span><span class="op" id="5664058">.</span><span class="ident" id="5664059">Name</span><span class="op" id="5664063">)</span><br>
<span class="lineno"></span><span class="op" id="5664065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5664068">//&nbsp;shouldSend&nbsp;determines&nbsp;whether&nbsp;e&#39;s&nbsp;cookie&nbsp;qualifies&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5664142">//&nbsp;request&nbsp;to&nbsp;host/path.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;check&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5664217">//&nbsp;cookie&nbsp;is&nbsp;expired.</span><br>
<span class="lineno"></span><span class="keyword" id="5664239">func</span>&nbsp;<span class="op" id="5664244">(</span><span class="ident" id="5664245">e</span>&nbsp;<span class="op" id="5664247">*</span><span class="ident" id="5664248">entry</span><span class="op" id="5664253">)</span>&nbsp;<span class="ident" id="5664255">shouldSend</span><span class="op" id="5664265">(</span><span class="ident" id="5664266">https</span>&nbsp;<span class="builtintype" id="5664272">bool</span><span class="op" id="5664276">,</span>&nbsp;<span class="ident" id="5664278">host</span><span class="op" id="5664282">,</span>&nbsp;<span class="ident" id="5664284">path</span>&nbsp;<span class="builtintype" id="5664289">string</span><span class="op" id="5664295">)</span>&nbsp;<span class="builtintype" id="5664297">bool</span>&nbsp;<span class="op" id="5664302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664305">return</span>&nbsp;<span class="ident" id="5664312">e</span><span class="op" id="5664313">.</span><span class="ident" id="5664314">domainMatch</span><span class="op" id="5664325">(</span><span class="ident" id="5664326">host</span><span class="op" id="5664330">)</span>&nbsp;<span class="op" id="5664332">&amp;&amp;</span>&nbsp;<span class="ident" id="5664335">e</span><span class="op" id="5664336">.</span><span class="ident" id="5664337">pathMatch</span><span class="op" id="5664346">(</span><span class="ident" id="5664347">path</span><span class="op" id="5664351">)</span>&nbsp;<span class="op" id="5664353">&amp;&amp;</span>&nbsp;<span class="op" id="5664356">(</span><span class="ident" id="5664357">https</span>&nbsp;<span class="op" id="5664363">||</span>&nbsp;<span class="op" id="5664366">!</span><span class="ident" id="5664367">e</span><span class="op" id="5664368">.</span><span class="ident" id="5664369">Secure</span><span class="op" id="5664375">)</span><br>
<span class="lineno">120</span><span class="op" id="5664377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5664380">//&nbsp;domainMatch&nbsp;implements&nbsp;&#34;domain-match&#34;&nbsp;of&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.3.</span><br>
<span class="lineno"></span><span class="keyword" id="5664448">func</span>&nbsp;<span class="op" id="5664453">(</span><span class="ident" id="5664454">e</span>&nbsp;<span class="op" id="5664456">*</span><span class="ident" id="5664457">entry</span><span class="op" id="5664462">)</span>&nbsp;<span class="ident" id="5664464">domainMatch</span><span class="op" id="5664475">(</span><span class="ident" id="5664476">host</span>&nbsp;<span class="builtintype" id="5664481">string</span><span class="op" id="5664487">)</span>&nbsp;<span class="builtintype" id="5664489">bool</span>&nbsp;<span class="op" id="5664494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664497">if</span>&nbsp;<span class="ident" id="5664500">e</span><span class="op" id="5664501">.</span><span class="ident" id="5664502">Domain</span>&nbsp;<span class="op" id="5664509">==</span>&nbsp;<span class="ident" id="5664512">host</span>&nbsp;<span class="op" id="5664517">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664521">return</span>&nbsp;<span class="builtintype" id="5664528">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664537">return</span>&nbsp;<span class="op" id="5664544">!</span><span class="ident" id="5664545">e</span><span class="op" id="5664546">.</span><span class="ident" id="5664547">HostOnly</span>&nbsp;<span class="op" id="5664556">&amp;&amp;</span>&nbsp;<span class="ident" id="5664559">hasDotSuffix</span><span class="op" id="5664571">(</span><span class="ident" id="5664572">host</span><span class="op" id="5664576">,</span>&nbsp;<span class="ident" id="5664578">e</span><span class="op" id="5664579">.</span><span class="ident" id="5664580">Domain</span><span class="op" id="5664586">)</span><br>
<span class="lineno"></span><span class="op" id="5664588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5664591">//&nbsp;pathMatch&nbsp;implements&nbsp;&#34;path-match&#34;&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5664665">func</span>&nbsp;<span class="op" id="5664670">(</span><span class="ident" id="5664671">e</span>&nbsp;<span class="op" id="5664673">*</span><span class="ident" id="5664674">entry</span><span class="op" id="5664679">)</span>&nbsp;<span class="ident" id="5664681">pathMatch</span><span class="op" id="5664690">(</span><span class="ident" id="5664691">requestPath</span>&nbsp;<span class="builtintype" id="5664703">string</span><span class="op" id="5664709">)</span>&nbsp;<span class="builtintype" id="5664711">bool</span>&nbsp;<span class="op" id="5664716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664719">if</span>&nbsp;<span class="ident" id="5664722">requestPath</span>&nbsp;<span class="op" id="5664734">==</span>&nbsp;<span class="ident" id="5664737">e</span><span class="op" id="5664738">.</span><span class="ident" id="5664739">Path</span>&nbsp;<span class="op" id="5664744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664748">return</span>&nbsp;<span class="builtintype" id="5664755">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664761">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664764">if</span>&nbsp;<span class="ident" id="5664767">strings</span><span class="op" id="5664774">.</span><span class="ident" id="5664775">HasPrefix</span><span class="op" id="5664784">(</span><span class="ident" id="5664785">requestPath</span><span class="op" id="5664796">,</span>&nbsp;<span class="ident" id="5664798">e</span><span class="op" id="5664799">.</span><span class="ident" id="5664800">Path</span><span class="op" id="5664804">)</span>&nbsp;<span class="op" id="5664806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664810">if</span>&nbsp;<span class="ident" id="5664813">e</span><span class="op" id="5664814">.</span><span class="ident" id="5664815">Path</span><span class="op" id="5664819">[</span><span class="builtinfunc" id="5664820">len</span><span class="op" id="5664823">(</span><span class="ident" id="5664824">e</span><span class="op" id="5664825">.</span><span class="ident" id="5664826">Path</span><span class="op" id="5664830">)</span><span class="op" id="5664831">-</span><span class="num" id="5664832">1</span><span class="op" id="5664833">]</span>&nbsp;<span class="op" id="5664835">==</span>&nbsp;<span class="string" id="5664838">&#39;/&#39;</span>&nbsp;<span class="op" id="5664842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664847">return</span>&nbsp;<span class="builtintype" id="5664854">true</span>&nbsp;<span class="comment" id="5664859">//&nbsp;The&nbsp;&#34;/any/&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664902">}</span>&nbsp;<span class="keyword" id="5664904">else</span>&nbsp;<span class="keyword" id="5664909">if</span>&nbsp;<span class="ident" id="5664912">requestPath</span><span class="op" id="5664923">[</span><span class="builtinfunc" id="5664924">len</span><span class="op" id="5664927">(</span><span class="ident" id="5664928">e</span><span class="op" id="5664929">.</span><span class="ident" id="5664930">Path</span><span class="op" id="5664934">)</span><span class="op" id="5664935">]</span>&nbsp;<span class="op" id="5664937">==</span>&nbsp;<span class="string" id="5664940">&#39;/&#39;</span>&nbsp;<span class="op" id="5664944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664949">return</span>&nbsp;<span class="builtintype" id="5664956">true</span>&nbsp;<span class="comment" id="5664961">//&nbsp;The&nbsp;&#34;/any&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665009">return</span>&nbsp;<span class="builtintype" id="5665016">false</span><br>
<span class="lineno"></span><span class="op" id="5665022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5665025">//&nbsp;hasDotSuffix&nbsp;reports&nbsp;whether&nbsp;s&nbsp;ends&nbsp;in&nbsp;&#34;.&#34;+suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5665079">func</span>&nbsp;<span class="ident" id="5665084">hasDotSuffix</span><span class="op" id="5665096">(</span><span class="ident" id="5665097">s</span><span class="op" id="5665098">,</span>&nbsp;<span class="ident" id="5665100">suffix</span>&nbsp;<span class="builtintype" id="5665107">string</span><span class="op" id="5665113">)</span>&nbsp;<span class="builtintype" id="5665115">bool</span>&nbsp;<span class="op" id="5665120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665123">return</span>&nbsp;<span class="builtinfunc" id="5665130">len</span><span class="op" id="5665133">(</span><span class="ident" id="5665134">s</span><span class="op" id="5665135">)</span>&nbsp;<span class="op" id="5665137">&gt;</span>&nbsp;<span class="builtinfunc" id="5665139">len</span><span class="op" id="5665142">(</span><span class="ident" id="5665143">suffix</span><span class="op" id="5665149">)</span>&nbsp;<span class="op" id="5665151">&amp;&amp;</span>&nbsp;<span class="ident" id="5665154">s</span><span class="op" id="5665155">[</span><span class="builtinfunc" id="5665156">len</span><span class="op" id="5665159">(</span><span class="ident" id="5665160">s</span><span class="op" id="5665161">)</span><span class="op" id="5665162">-</span><span class="builtinfunc" id="5665163">len</span><span class="op" id="5665166">(</span><span class="ident" id="5665167">suffix</span><span class="op" id="5665173">)</span><span class="op" id="5665174">-</span><span class="num" id="5665175">1</span><span class="op" id="5665176">]</span>&nbsp;<span class="op" id="5665178">==</span>&nbsp;<span class="string" id="5665181">&#39;.&#39;</span>&nbsp;<span class="op" id="5665185">&amp;&amp;</span>&nbsp;<span class="ident" id="5665188">s</span><span class="op" id="5665189">[</span><span class="builtinfunc" id="5665190">len</span><span class="op" id="5665193">(</span><span class="ident" id="5665194">s</span><span class="op" id="5665195">)</span><span class="op" id="5665196">-</span><span class="builtinfunc" id="5665197">len</span><span class="op" id="5665200">(</span><span class="ident" id="5665201">suffix</span><span class="op" id="5665207">)</span><span class="op" id="5665208">:</span><span class="op" id="5665209">]</span>&nbsp;<span class="op" id="5665211">==</span>&nbsp;<span class="ident" id="5665214">suffix</span><br>
<span class="lineno"></span><span class="op" id="5665221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="5665224">//&nbsp;byPathLength&nbsp;is&nbsp;a&nbsp;[]entry&nbsp;sort.Interface&nbsp;that&nbsp;sorts&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265</span><br>
<span class="lineno"></span><span class="comment" id="5665301">//&nbsp;section&nbsp;5.4&nbsp;point&nbsp;2:&nbsp;by&nbsp;longest&nbsp;path&nbsp;and&nbsp;then&nbsp;by&nbsp;earliest&nbsp;creation&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="5665377">type</span>&nbsp;<span class="ident" id="5665382">byPathLength</span>&nbsp;<span class="op" id="5665395">[</span><span class="op" id="5665396">]</span><span class="ident" id="5665397">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5665404">func</span>&nbsp;<span class="op" id="5665409">(</span><span class="ident" id="5665410">s</span>&nbsp;<span class="ident" id="5665412">byPathLength</span><span class="op" id="5665424">)</span>&nbsp;<span class="ident" id="5665426">Len</span><span class="op" id="5665429">(</span><span class="op" id="5665430">)</span>&nbsp;<span class="builtintype" id="5665432">int</span>&nbsp;<span class="op" id="5665436">{</span>&nbsp;<span class="keyword" id="5665438">return</span>&nbsp;<span class="builtinfunc" id="5665445">len</span><span class="op" id="5665448">(</span><span class="ident" id="5665449">s</span><span class="op" id="5665450">)</span>&nbsp;<span class="op" id="5665452">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="5665455">func</span>&nbsp;<span class="op" id="5665460">(</span><span class="ident" id="5665461">s</span>&nbsp;<span class="ident" id="5665463">byPathLength</span><span class="op" id="5665475">)</span>&nbsp;<span class="ident" id="5665477">Less</span><span class="op" id="5665481">(</span><span class="ident" id="5665482">i</span><span class="op" id="5665483">,</span>&nbsp;<span class="ident" id="5665485">j</span>&nbsp;<span class="builtintype" id="5665487">int</span><span class="op" id="5665490">)</span>&nbsp;<span class="builtintype" id="5665492">bool</span>&nbsp;<span class="op" id="5665497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665500">if</span>&nbsp;<span class="builtinfunc" id="5665503">len</span><span class="op" id="5665506">(</span><span class="ident" id="5665507">s</span><span class="op" id="5665508">[</span><span class="ident" id="5665509">i</span><span class="op" id="5665510">]</span><span class="op" id="5665511">.</span><span class="ident" id="5665512">Path</span><span class="op" id="5665516">)</span>&nbsp;<span class="op" id="5665518">!=</span>&nbsp;<span class="builtinfunc" id="5665521">len</span><span class="op" id="5665524">(</span><span class="ident" id="5665525">s</span><span class="op" id="5665526">[</span><span class="ident" id="5665527">j</span><span class="op" id="5665528">]</span><span class="op" id="5665529">.</span><span class="ident" id="5665530">Path</span><span class="op" id="5665534">)</span>&nbsp;<span class="op" id="5665536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665540">return</span>&nbsp;<span class="builtinfunc" id="5665547">len</span><span class="op" id="5665550">(</span><span class="ident" id="5665551">s</span><span class="op" id="5665552">[</span><span class="ident" id="5665553">i</span><span class="op" id="5665554">]</span><span class="op" id="5665555">.</span><span class="ident" id="5665556">Path</span><span class="op" id="5665560">)</span>&nbsp;<span class="op" id="5665562">&gt;</span>&nbsp;<span class="builtinfunc" id="5665564">len</span><span class="op" id="5665567">(</span><span class="ident" id="5665568">s</span><span class="op" id="5665569">[</span><span class="ident" id="5665570">j</span><span class="op" id="5665571">]</span><span class="op" id="5665572">.</span><span class="ident" id="5665573">Path</span><span class="op" id="5665577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665580">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665583">if</span>&nbsp;<span class="op" id="5665586">!</span><span class="ident" id="5665587">s</span><span class="op" id="5665588">[</span><span class="ident" id="5665589">i</span><span class="op" id="5665590">]</span><span class="op" id="5665591">.</span><span class="ident" id="5665592">Creation</span><span class="op" id="5665600">.</span><span class="ident" id="5665601">Equal</span><span class="op" id="5665606">(</span><span class="ident" id="5665607">s</span><span class="op" id="5665608">[</span><span class="ident" id="5665609">j</span><span class="op" id="5665610">]</span><span class="op" id="5665611">.</span><span class="ident" id="5665612">Creation</span><span class="op" id="5665620">)</span>&nbsp;<span class="op" id="5665622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665626">return</span>&nbsp;<span class="ident" id="5665633">s</span><span class="op" id="5665634">[</span><span class="ident" id="5665635">i</span><span class="op" id="5665636">]</span><span class="op" id="5665637">.</span><span class="ident" id="5665638">Creation</span><span class="op" id="5665646">.</span><span class="ident" id="5665647">Before</span><span class="op" id="5665653">(</span><span class="ident" id="5665654">s</span><span class="op" id="5665655">[</span><span class="ident" id="5665656">j</span><span class="op" id="5665657">]</span><span class="op" id="5665658">.</span><span class="ident" id="5665659">Creation</span><span class="op" id="5665667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665673">return</span>&nbsp;<span class="ident" id="5665680">s</span><span class="op" id="5665681">[</span><span class="ident" id="5665682">i</span><span class="op" id="5665683">]</span><span class="op" id="5665684">.</span><span class="ident" id="5665685">seqNum</span>&nbsp;<span class="op" id="5665692">&lt;</span>&nbsp;<span class="ident" id="5665694">s</span><span class="op" id="5665695">[</span><span class="ident" id="5665696">j</span><span class="op" id="5665697">]</span><span class="op" id="5665698">.</span><span class="ident" id="5665699">seqNum</span><br>
<span class="lineno"></span><span class="op" id="5665706">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5665709">func</span>&nbsp;<span class="op" id="5665714">(</span><span class="ident" id="5665715">s</span>&nbsp;<span class="ident" id="5665717">byPathLength</span><span class="op" id="5665729">)</span>&nbsp;<span class="ident" id="5665731">Swap</span><span class="op" id="5665735">(</span><span class="ident" id="5665736">i</span><span class="op" id="5665737">,</span>&nbsp;<span class="ident" id="5665739">j</span>&nbsp;<span class="builtintype" id="5665741">int</span><span class="op" id="5665744">)</span>&nbsp;<span class="op" id="5665746">{</span>&nbsp;<span class="ident" id="5665748">s</span><span class="op" id="5665749">[</span><span class="ident" id="5665750">i</span><span class="op" id="5665751">]</span><span class="op" id="5665752">,</span>&nbsp;<span class="ident" id="5665754">s</span><span class="op" id="5665755">[</span><span class="ident" id="5665756">j</span><span class="op" id="5665757">]</span>&nbsp;<span class="op" id="5665759">=</span>&nbsp;<span class="ident" id="5665761">s</span><span class="op" id="5665762">[</span><span class="ident" id="5665763">j</span><span class="op" id="5665764">]</span><span class="op" id="5665765">,</span>&nbsp;<span class="ident" id="5665767">s</span><span class="op" id="5665768">[</span><span class="ident" id="5665769">i</span><span class="op" id="5665770">]</span>&nbsp;<span class="op" id="5665772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5665775">//&nbsp;Cookies&nbsp;implements&nbsp;the&nbsp;Cookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5665849">//</span><br>
<span class="lineno">170</span><span class="comment" id="5665852">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno"></span><span class="keyword" id="5665923">func</span>&nbsp;<span class="op" id="5665928">(</span><span class="ident" id="5665929">j</span>&nbsp;<span class="op" id="5665931">*</span><span class="ident" id="5665932">Jar</span><span class="op" id="5665935">)</span>&nbsp;<span class="ident" id="5665937">Cookies</span><span class="op" id="5665944">(</span><span class="ident" id="5665945">u</span>&nbsp;<span class="op" id="5665947">*</span><span class="ident" id="5665948">url</span><span class="op" id="5665951">.</span><span class="ident" id="5665952">URL</span><span class="op" id="5665955">)</span>&nbsp;<span class="op" id="5665957">(</span><span class="ident" id="5665958">cookies</span>&nbsp;<span class="op" id="5665966">[</span><span class="op" id="5665967">]</span><span class="op" id="5665968">*</span><span class="ident" id="5665969">http</span><span class="op" id="5665973">.</span><span class="ident" id="5665974">Cookie</span><span class="op" id="5665980">)</span>&nbsp;<span class="op" id="5665982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665985">return</span>&nbsp;<span class="ident" id="5665992">j</span><span class="op" id="5665993">.</span><span class="ident" id="5665994">cookies</span><span class="op" id="5666001">(</span><span class="ident" id="5666002">u</span><span class="op" id="5666003">,</span>&nbsp;<span class="ident" id="5666005">time</span><span class="op" id="5666009">.</span><span class="ident" id="5666010">Now</span><span class="op" id="5666013">(</span><span class="op" id="5666014">)</span><span class="op" id="5666015">)</span><br>
<span class="lineno"></span><span class="op" id="5666017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5666020">//&nbsp;cookies&nbsp;is&nbsp;like&nbsp;Cookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;a&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5666090">func</span>&nbsp;<span class="op" id="5666095">(</span><span class="ident" id="5666096">j</span>&nbsp;<span class="op" id="5666098">*</span><span class="ident" id="5666099">Jar</span><span class="op" id="5666102">)</span>&nbsp;<span class="ident" id="5666104">cookies</span><span class="op" id="5666111">(</span><span class="ident" id="5666112">u</span>&nbsp;<span class="op" id="5666114">*</span><span class="ident" id="5666115">url</span><span class="op" id="5666118">.</span><span class="ident" id="5666119">URL</span><span class="op" id="5666122">,</span>&nbsp;<span class="ident" id="5666124">now</span>&nbsp;<span class="ident" id="5666128">time</span><span class="op" id="5666132">.</span><span class="ident" id="5666133">Time</span><span class="op" id="5666137">)</span>&nbsp;<span class="op" id="5666139">(</span><span class="ident" id="5666140">cookies</span>&nbsp;<span class="op" id="5666148">[</span><span class="op" id="5666149">]</span><span class="op" id="5666150">*</span><span class="ident" id="5666151">http</span><span class="op" id="5666155">.</span><span class="ident" id="5666156">Cookie</span><span class="op" id="5666162">)</span>&nbsp;<span class="op" id="5666164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666167">if</span>&nbsp;<span class="ident" id="5666170">u</span><span class="op" id="5666171">.</span><span class="ident" id="5666172">Scheme</span>&nbsp;<span class="op" id="5666179">!=</span>&nbsp;<span class="string" id="5666182">&#34;http&#34;</span>&nbsp;<span class="op" id="5666189">&amp;&amp;</span>&nbsp;<span class="ident" id="5666192">u</span><span class="op" id="5666193">.</span><span class="ident" id="5666194">Scheme</span>&nbsp;<span class="op" id="5666201">!=</span>&nbsp;<span class="string" id="5666204">&#34;https&#34;</span>&nbsp;<span class="op" id="5666212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666216">return</span>&nbsp;<span class="ident" id="5666223">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666232">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666235">host</span><span class="op" id="5666239">,</span>&nbsp;<span class="ident" id="5666241">err</span>&nbsp;<span class="op" id="5666245">:=</span>&nbsp;<span class="ident" id="5666248">canonicalHost</span><span class="op" id="5666261">(</span><span class="ident" id="5666262">u</span><span class="op" id="5666263">.</span><span class="ident" id="5666264">Host</span><span class="op" id="5666268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666271">if</span>&nbsp;<span class="ident" id="5666274">err</span>&nbsp;<span class="op" id="5666278">!=</span>&nbsp;<span class="ident" id="5666281">nil</span>&nbsp;<span class="op" id="5666285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666289">return</span>&nbsp;<span class="ident" id="5666296">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666308">key</span>&nbsp;<span class="op" id="5666312">:=</span>&nbsp;<span class="ident" id="5666315">jarKey</span><span class="op" id="5666321">(</span><span class="ident" id="5666322">host</span><span class="op" id="5666326">,</span>&nbsp;<span class="ident" id="5666328">j</span><span class="op" id="5666329">.</span><span class="ident" id="5666330">psList</span><span class="op" id="5666336">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666340">j</span><span class="op" id="5666341">.</span><span class="ident" id="5666342">mu</span><span class="op" id="5666344">.</span><span class="ident" id="5666345">Lock</span><span class="op" id="5666349">(</span><span class="op" id="5666350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666353">defer</span>&nbsp;<span class="ident" id="5666359">j</span><span class="op" id="5666360">.</span><span class="ident" id="5666361">mu</span><span class="op" id="5666363">.</span><span class="ident" id="5666364">Unlock</span><span class="op" id="5666370">(</span><span class="op" id="5666371">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666375">submap</span>&nbsp;<span class="op" id="5666382">:=</span>&nbsp;<span class="ident" id="5666385">j</span><span class="op" id="5666386">.</span><span class="ident" id="5666387">entries</span><span class="op" id="5666394">[</span><span class="ident" id="5666395">key</span><span class="op" id="5666398">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666401">if</span>&nbsp;<span class="ident" id="5666404">submap</span>&nbsp;<span class="op" id="5666411">==</span>&nbsp;<span class="ident" id="5666414">nil</span>&nbsp;<span class="op" id="5666418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666422">return</span>&nbsp;<span class="ident" id="5666429">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666442">https</span>&nbsp;<span class="op" id="5666448">:=</span>&nbsp;<span class="ident" id="5666451">u</span><span class="op" id="5666452">.</span><span class="ident" id="5666453">Scheme</span>&nbsp;<span class="op" id="5666460">==</span>&nbsp;<span class="string" id="5666463">&#34;https&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666472">path</span>&nbsp;<span class="op" id="5666477">:=</span>&nbsp;<span class="ident" id="5666480">u</span><span class="op" id="5666481">.</span><span class="ident" id="5666482">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666488">if</span>&nbsp;<span class="ident" id="5666491">path</span>&nbsp;<span class="op" id="5666496">==</span>&nbsp;<span class="string" id="5666499">&#34;&#34;</span>&nbsp;<span class="op" id="5666502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666506">path</span>&nbsp;<span class="op" id="5666511">=</span>&nbsp;<span class="string" id="5666513">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666522">modified</span>&nbsp;<span class="op" id="5666531">:=</span>&nbsp;<span class="builtintype" id="5666534">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666541">var</span>&nbsp;<span class="ident" id="5666545">selected</span>&nbsp;<span class="op" id="5666554">[</span><span class="op" id="5666555">]</span><span class="ident" id="5666556">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666563">for</span>&nbsp;<span class="ident" id="5666567">id</span><span class="op" id="5666569">,</span>&nbsp;<span class="ident" id="5666571">e</span>&nbsp;<span class="op" id="5666573">:=</span>&nbsp;<span class="keyword" id="5666576">range</span>&nbsp;<span class="ident" id="5666582">submap</span>&nbsp;<span class="op" id="5666589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666593">if</span>&nbsp;<span class="ident" id="5666596">e</span><span class="op" id="5666597">.</span><span class="ident" id="5666598">Persistent</span>&nbsp;<span class="op" id="5666609">&amp;&amp;</span>&nbsp;<span class="op" id="5666612">!</span><span class="ident" id="5666613">e</span><span class="op" id="5666614">.</span><span class="ident" id="5666615">Expires</span><span class="op" id="5666622">.</span><span class="ident" id="5666623">After</span><span class="op" id="5666628">(</span><span class="ident" id="5666629">now</span><span class="op" id="5666632">)</span>&nbsp;<span class="op" id="5666634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5666639">delete</span><span class="op" id="5666645">(</span><span class="ident" id="5666646">submap</span><span class="op" id="5666652">,</span>&nbsp;<span class="ident" id="5666654">id</span><span class="op" id="5666656">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666661">modified</span>&nbsp;<span class="op" id="5666670">=</span>&nbsp;<span class="builtintype" id="5666672">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666680">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666695">if</span>&nbsp;<span class="op" id="5666698">!</span><span class="ident" id="5666699">e</span><span class="op" id="5666700">.</span><span class="ident" id="5666701">shouldSend</span><span class="op" id="5666711">(</span><span class="ident" id="5666712">https</span><span class="op" id="5666717">,</span>&nbsp;<span class="ident" id="5666719">host</span><span class="op" id="5666723">,</span>&nbsp;<span class="ident" id="5666725">path</span><span class="op" id="5666729">)</span>&nbsp;<span class="op" id="5666731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666736">continue</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666751">e</span><span class="op" id="5666752">.</span><span class="ident" id="5666753">LastAccess</span>&nbsp;<span class="op" id="5666764">=</span>&nbsp;<span class="ident" id="5666766">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666772">submap</span><span class="op" id="5666778">[</span><span class="ident" id="5666779">id</span><span class="op" id="5666781">]</span>&nbsp;<span class="op" id="5666783">=</span>&nbsp;<span class="ident" id="5666785">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666789">selected</span>&nbsp;<span class="op" id="5666798">=</span>&nbsp;<span class="builtinfunc" id="5666800">append</span><span class="op" id="5666806">(</span><span class="ident" id="5666807">selected</span><span class="op" id="5666815">,</span>&nbsp;<span class="ident" id="5666817">e</span><span class="op" id="5666818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666822">modified</span>&nbsp;<span class="op" id="5666831">=</span>&nbsp;<span class="builtintype" id="5666833">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666842">if</span>&nbsp;<span class="ident" id="5666845">modified</span>&nbsp;<span class="op" id="5666854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666858">if</span>&nbsp;<span class="builtinfunc" id="5666861">len</span><span class="op" id="5666864">(</span><span class="ident" id="5666865">submap</span><span class="op" id="5666871">)</span>&nbsp;<span class="op" id="5666873">==</span>&nbsp;<span class="num" id="5666876">0</span>&nbsp;<span class="op" id="5666878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5666883">delete</span><span class="op" id="5666889">(</span><span class="ident" id="5666890">j</span><span class="op" id="5666891">.</span><span class="ident" id="5666892">entries</span><span class="op" id="5666899">,</span>&nbsp;<span class="ident" id="5666901">key</span><span class="op" id="5666904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666908">}</span>&nbsp;<span class="keyword" id="5666910">else</span>&nbsp;<span class="op" id="5666915">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666920">j</span><span class="op" id="5666921">.</span><span class="ident" id="5666922">entries</span><span class="op" id="5666929">[</span><span class="ident" id="5666930">key</span><span class="op" id="5666933">]</span>&nbsp;<span class="op" id="5666935">=</span>&nbsp;<span class="ident" id="5666937">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666953">sort</span><span class="op" id="5666957">.</span><span class="ident" id="5666958">Sort</span><span class="op" id="5666962">(</span><span class="ident" id="5666963">byPathLength</span><span class="op" id="5666975">(</span><span class="ident" id="5666976">selected</span><span class="op" id="5666984">)</span><span class="op" id="5666985">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666988">for</span>&nbsp;<span class="ident" id="5666992">_</span><span class="op" id="5666993">,</span>&nbsp;<span class="ident" id="5666995">e</span>&nbsp;<span class="op" id="5666997">:=</span>&nbsp;<span class="keyword" id="5667000">range</span>&nbsp;<span class="ident" id="5667006">selected</span>&nbsp;<span class="op" id="5667015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667019">cookies</span>&nbsp;<span class="op" id="5667027">=</span>&nbsp;<span class="builtinfunc" id="5667029">append</span><span class="op" id="5667035">(</span><span class="ident" id="5667036">cookies</span><span class="op" id="5667043">,</span>&nbsp;<span class="op" id="5667045">&amp;</span><span class="ident" id="5667046">http</span><span class="op" id="5667050">.</span><span class="ident" id="5667051">Cookie</span><span class="op" id="5667057">{</span><span class="ident" id="5667058">Name</span><span class="op" id="5667062">:</span>&nbsp;<span class="ident" id="5667064">e</span><span class="op" id="5667065">.</span><span class="ident" id="5667066">Name</span><span class="op" id="5667070">,</span>&nbsp;<span class="ident" id="5667072">Value</span><span class="op" id="5667077">:</span>&nbsp;<span class="ident" id="5667079">e</span><span class="op" id="5667080">.</span><span class="ident" id="5667081">Value</span><span class="op" id="5667086">}</span><span class="op" id="5667087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667094">return</span>&nbsp;<span class="ident" id="5667101">cookies</span><br>
<span class="lineno">230</span><span class="op" id="5667109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5667112">//&nbsp;SetCookies&nbsp;implements&nbsp;the&nbsp;SetCookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5667192">//</span><br>
<span class="lineno"></span><span class="comment" id="5667195">//&nbsp;It&nbsp;does&nbsp;nothing&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno">235</span><span class="keyword" id="5667256">func</span>&nbsp;<span class="op" id="5667261">(</span><span class="ident" id="5667262">j</span>&nbsp;<span class="op" id="5667264">*</span><span class="ident" id="5667265">Jar</span><span class="op" id="5667268">)</span>&nbsp;<span class="ident" id="5667270">SetCookies</span><span class="op" id="5667280">(</span><span class="ident" id="5667281">u</span>&nbsp;<span class="op" id="5667283">*</span><span class="ident" id="5667284">url</span><span class="op" id="5667287">.</span><span class="ident" id="5667288">URL</span><span class="op" id="5667291">,</span>&nbsp;<span class="ident" id="5667293">cookies</span>&nbsp;<span class="op" id="5667301">[</span><span class="op" id="5667302">]</span><span class="op" id="5667303">*</span><span class="ident" id="5667304">http</span><span class="op" id="5667308">.</span><span class="ident" id="5667309">Cookie</span><span class="op" id="5667315">)</span>&nbsp;<span class="op" id="5667317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667320">j</span><span class="op" id="5667321">.</span><span class="ident" id="5667322">setCookies</span><span class="op" id="5667332">(</span><span class="ident" id="5667333">u</span><span class="op" id="5667334">,</span>&nbsp;<span class="ident" id="5667336">cookies</span><span class="op" id="5667343">,</span>&nbsp;<span class="ident" id="5667345">time</span><span class="op" id="5667349">.</span><span class="ident" id="5667350">Now</span><span class="op" id="5667353">(</span><span class="op" id="5667354">)</span><span class="op" id="5667355">)</span><br>
<span class="lineno"></span><span class="op" id="5667357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5667360">//&nbsp;setCookies&nbsp;is&nbsp;like&nbsp;SetCookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;parameter.</span><br>
<span class="lineno">240</span><span class="keyword" id="5667434">func</span>&nbsp;<span class="op" id="5667439">(</span><span class="ident" id="5667440">j</span>&nbsp;<span class="op" id="5667442">*</span><span class="ident" id="5667443">Jar</span><span class="op" id="5667446">)</span>&nbsp;<span class="ident" id="5667448">setCookies</span><span class="op" id="5667458">(</span><span class="ident" id="5667459">u</span>&nbsp;<span class="op" id="5667461">*</span><span class="ident" id="5667462">url</span><span class="op" id="5667465">.</span><span class="ident" id="5667466">URL</span><span class="op" id="5667469">,</span>&nbsp;<span class="ident" id="5667471">cookies</span>&nbsp;<span class="op" id="5667479">[</span><span class="op" id="5667480">]</span><span class="op" id="5667481">*</span><span class="ident" id="5667482">http</span><span class="op" id="5667486">.</span><span class="ident" id="5667487">Cookie</span><span class="op" id="5667493">,</span>&nbsp;<span class="ident" id="5667495">now</span>&nbsp;<span class="ident" id="5667499">time</span><span class="op" id="5667503">.</span><span class="ident" id="5667504">Time</span><span class="op" id="5667508">)</span>&nbsp;<span class="op" id="5667510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667513">if</span>&nbsp;<span class="builtinfunc" id="5667516">len</span><span class="op" id="5667519">(</span><span class="ident" id="5667520">cookies</span><span class="op" id="5667527">)</span>&nbsp;<span class="op" id="5667529">==</span>&nbsp;<span class="num" id="5667532">0</span>&nbsp;<span class="op" id="5667534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667538">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667549">if</span>&nbsp;<span class="ident" id="5667552">u</span><span class="op" id="5667553">.</span><span class="ident" id="5667554">Scheme</span>&nbsp;<span class="op" id="5667561">!=</span>&nbsp;<span class="string" id="5667564">&#34;http&#34;</span>&nbsp;<span class="op" id="5667571">&amp;&amp;</span>&nbsp;<span class="ident" id="5667574">u</span><span class="op" id="5667575">.</span><span class="ident" id="5667576">Scheme</span>&nbsp;<span class="op" id="5667583">!=</span>&nbsp;<span class="string" id="5667586">&#34;https&#34;</span>&nbsp;<span class="op" id="5667594">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667598">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667609">host</span><span class="op" id="5667613">,</span>&nbsp;<span class="ident" id="5667615">err</span>&nbsp;<span class="op" id="5667619">:=</span>&nbsp;<span class="ident" id="5667622">canonicalHost</span><span class="op" id="5667635">(</span><span class="ident" id="5667636">u</span><span class="op" id="5667637">.</span><span class="ident" id="5667638">Host</span><span class="op" id="5667642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667645">if</span>&nbsp;<span class="ident" id="5667648">err</span>&nbsp;<span class="op" id="5667652">!=</span>&nbsp;<span class="ident" id="5667655">nil</span>&nbsp;<span class="op" id="5667659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667663">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667674">key</span>&nbsp;<span class="op" id="5667678">:=</span>&nbsp;<span class="ident" id="5667681">jarKey</span><span class="op" id="5667687">(</span><span class="ident" id="5667688">host</span><span class="op" id="5667692">,</span>&nbsp;<span class="ident" id="5667694">j</span><span class="op" id="5667695">.</span><span class="ident" id="5667696">psList</span><span class="op" id="5667702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667705">defPath</span>&nbsp;<span class="op" id="5667713">:=</span>&nbsp;<span class="ident" id="5667716">defaultPath</span><span class="op" id="5667727">(</span><span class="ident" id="5667728">u</span><span class="op" id="5667729">.</span><span class="ident" id="5667730">Path</span><span class="op" id="5667734">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667738">j</span><span class="op" id="5667739">.</span><span class="ident" id="5667740">mu</span><span class="op" id="5667742">.</span><span class="ident" id="5667743">Lock</span><span class="op" id="5667747">(</span><span class="op" id="5667748">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667751">defer</span>&nbsp;<span class="ident" id="5667757">j</span><span class="op" id="5667758">.</span><span class="ident" id="5667759">mu</span><span class="op" id="5667761">.</span><span class="ident" id="5667762">Unlock</span><span class="op" id="5667768">(</span><span class="op" id="5667769">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667773">submap</span>&nbsp;<span class="op" id="5667780">:=</span>&nbsp;<span class="ident" id="5667783">j</span><span class="op" id="5667784">.</span><span class="ident" id="5667785">entries</span><span class="op" id="5667792">[</span><span class="ident" id="5667793">key</span><span class="op" id="5667796">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667800">modified</span>&nbsp;<span class="op" id="5667809">:=</span>&nbsp;<span class="builtintype" id="5667812">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667819">for</span>&nbsp;<span class="ident" id="5667823">_</span><span class="op" id="5667824">,</span>&nbsp;<span class="ident" id="5667826">cookie</span>&nbsp;<span class="op" id="5667833">:=</span>&nbsp;<span class="keyword" id="5667836">range</span>&nbsp;<span class="ident" id="5667842">cookies</span>&nbsp;<span class="op" id="5667850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667854">e</span><span class="op" id="5667855">,</span>&nbsp;<span class="ident" id="5667857">remove</span><span class="op" id="5667863">,</span>&nbsp;<span class="ident" id="5667865">err</span>&nbsp;<span class="op" id="5667869">:=</span>&nbsp;<span class="ident" id="5667872">j</span><span class="op" id="5667873">.</span><span class="ident" id="5667874">newEntry</span><span class="op" id="5667882">(</span><span class="ident" id="5667883">cookie</span><span class="op" id="5667889">,</span>&nbsp;<span class="ident" id="5667891">now</span><span class="op" id="5667894">,</span>&nbsp;<span class="ident" id="5667896">defPath</span><span class="op" id="5667903">,</span>&nbsp;<span class="ident" id="5667905">host</span><span class="op" id="5667909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667913">if</span>&nbsp;<span class="ident" id="5667916">err</span>&nbsp;<span class="op" id="5667920">!=</span>&nbsp;<span class="ident" id="5667923">nil</span>&nbsp;<span class="op" id="5667927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667932">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667943">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667947">id</span>&nbsp;<span class="op" id="5667950">:=</span>&nbsp;<span class="ident" id="5667953">e</span><span class="op" id="5667954">.</span><span class="ident" id="5667955">id</span><span class="op" id="5667957">(</span><span class="op" id="5667958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667962">if</span>&nbsp;<span class="ident" id="5667965">remove</span>&nbsp;<span class="op" id="5667972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667977">if</span>&nbsp;<span class="ident" id="5667980">submap</span>&nbsp;<span class="op" id="5667987">!=</span>&nbsp;<span class="ident" id="5667990">nil</span>&nbsp;<span class="op" id="5667994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668000">if</span>&nbsp;<span class="ident" id="5668003">_</span><span class="op" id="5668004">,</span>&nbsp;<span class="ident" id="5668006">ok</span>&nbsp;<span class="op" id="5668009">:=</span>&nbsp;<span class="ident" id="5668012">submap</span><span class="op" id="5668018">[</span><span class="ident" id="5668019">id</span><span class="op" id="5668021">]</span><span class="op" id="5668022">;</span>&nbsp;<span class="ident" id="5668024">ok</span>&nbsp;<span class="op" id="5668027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5668034">delete</span><span class="op" id="5668040">(</span><span class="ident" id="5668041">submap</span><span class="op" id="5668047">,</span>&nbsp;<span class="ident" id="5668049">id</span><span class="op" id="5668051">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668058">modified</span>&nbsp;<span class="op" id="5668067">=</span>&nbsp;<span class="builtintype" id="5668069">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668088">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668099">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668103">if</span>&nbsp;<span class="ident" id="5668106">submap</span>&nbsp;<span class="op" id="5668113">==</span>&nbsp;<span class="ident" id="5668116">nil</span>&nbsp;<span class="op" id="5668120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668125">submap</span>&nbsp;<span class="op" id="5668132">=</span>&nbsp;<span class="builtinfunc" id="5668134">make</span><span class="op" id="5668138">(</span><span class="keyword" id="5668139">map</span><span class="op" id="5668142">[</span><span class="builtintype" id="5668143">string</span><span class="op" id="5668149">]</span><span class="ident" id="5668150">entry</span><span class="op" id="5668155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668164">if</span>&nbsp;<span class="ident" id="5668167">old</span><span class="op" id="5668170">,</span>&nbsp;<span class="ident" id="5668172">ok</span>&nbsp;<span class="op" id="5668175">:=</span>&nbsp;<span class="ident" id="5668178">submap</span><span class="op" id="5668184">[</span><span class="ident" id="5668185">id</span><span class="op" id="5668187">]</span><span class="op" id="5668188">;</span>&nbsp;<span class="ident" id="5668190">ok</span>&nbsp;<span class="op" id="5668193">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668198">e</span><span class="op" id="5668199">.</span><span class="ident" id="5668200">Creation</span>&nbsp;<span class="op" id="5668209">=</span>&nbsp;<span class="ident" id="5668211">old</span><span class="op" id="5668214">.</span><span class="ident" id="5668215">Creation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668227">e</span><span class="op" id="5668228">.</span><span class="ident" id="5668229">seqNum</span>&nbsp;<span class="op" id="5668236">=</span>&nbsp;<span class="ident" id="5668238">old</span><span class="op" id="5668241">.</span><span class="ident" id="5668242">seqNum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668251">}</span>&nbsp;<span class="keyword" id="5668253">else</span>&nbsp;<span class="op" id="5668258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668263">e</span><span class="op" id="5668264">.</span><span class="ident" id="5668265">Creation</span>&nbsp;<span class="op" id="5668274">=</span>&nbsp;<span class="ident" id="5668276">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668283">e</span><span class="op" id="5668284">.</span><span class="ident" id="5668285">seqNum</span>&nbsp;<span class="op" id="5668292">=</span>&nbsp;<span class="ident" id="5668294">j</span><span class="op" id="5668295">.</span><span class="ident" id="5668296">nextSeqNum</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668310">j</span><span class="op" id="5668311">.</span><span class="ident" id="5668312">nextSeqNum</span><span class="op" id="5668322">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668331">e</span><span class="op" id="5668332">.</span><span class="ident" id="5668333">LastAccess</span>&nbsp;<span class="op" id="5668344">=</span>&nbsp;<span class="ident" id="5668346">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668352">submap</span><span class="op" id="5668358">[</span><span class="ident" id="5668359">id</span><span class="op" id="5668361">]</span>&nbsp;<span class="op" id="5668363">=</span>&nbsp;<span class="ident" id="5668365">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668369">modified</span>&nbsp;<span class="op" id="5668378">=</span>&nbsp;<span class="builtintype" id="5668380">true</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668390">if</span>&nbsp;<span class="ident" id="5668393">modified</span>&nbsp;<span class="op" id="5668402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668406">if</span>&nbsp;<span class="builtinfunc" id="5668409">len</span><span class="op" id="5668412">(</span><span class="ident" id="5668413">submap</span><span class="op" id="5668419">)</span>&nbsp;<span class="op" id="5668421">==</span>&nbsp;<span class="num" id="5668424">0</span>&nbsp;<span class="op" id="5668426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5668431">delete</span><span class="op" id="5668437">(</span><span class="ident" id="5668438">j</span><span class="op" id="5668439">.</span><span class="ident" id="5668440">entries</span><span class="op" id="5668447">,</span>&nbsp;<span class="ident" id="5668449">key</span><span class="op" id="5668452">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668456">}</span>&nbsp;<span class="keyword" id="5668458">else</span>&nbsp;<span class="op" id="5668463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668468">j</span><span class="op" id="5668469">.</span><span class="ident" id="5668470">entries</span><span class="op" id="5668477">[</span><span class="ident" id="5668478">key</span><span class="op" id="5668481">]</span>&nbsp;<span class="op" id="5668483">=</span>&nbsp;<span class="ident" id="5668485">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668497">}</span><br>
<span class="lineno"></span><span class="op" id="5668499">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="5668502">//&nbsp;canonicalHost&nbsp;strips&nbsp;port&nbsp;from&nbsp;host&nbsp;if&nbsp;present&nbsp;and&nbsp;returns&nbsp;the&nbsp;canonicalized</span><br>
<span class="lineno"></span><span class="comment" id="5668582">//&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5668596">func</span>&nbsp;<span class="ident" id="5668601">canonicalHost</span><span class="op" id="5668614">(</span><span class="ident" id="5668615">host</span>&nbsp;<span class="builtintype" id="5668620">string</span><span class="op" id="5668626">)</span>&nbsp;<span class="op" id="5668628">(</span><span class="builtintype" id="5668629">string</span><span class="op" id="5668635">,</span>&nbsp;<span class="builtintype" id="5668637">error</span><span class="op" id="5668642">)</span>&nbsp;<span class="op" id="5668644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668647">var</span>&nbsp;<span class="ident" id="5668651">err</span>&nbsp;<span class="builtintype" id="5668655">error</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668662">host</span>&nbsp;<span class="op" id="5668667">=</span>&nbsp;<span class="ident" id="5668669">strings</span><span class="op" id="5668676">.</span><span class="ident" id="5668677">ToLower</span><span class="op" id="5668684">(</span><span class="ident" id="5668685">host</span><span class="op" id="5668689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668692">if</span>&nbsp;<span class="ident" id="5668695">hasPort</span><span class="op" id="5668702">(</span><span class="ident" id="5668703">host</span><span class="op" id="5668707">)</span>&nbsp;<span class="op" id="5668709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668713">host</span><span class="op" id="5668717">,</span>&nbsp;<span class="ident" id="5668719">_</span><span class="op" id="5668720">,</span>&nbsp;<span class="ident" id="5668722">err</span>&nbsp;<span class="op" id="5668726">=</span>&nbsp;<span class="ident" id="5668728">net</span><span class="op" id="5668731">.</span><span class="ident" id="5668732">SplitHostPort</span><span class="op" id="5668745">(</span><span class="ident" id="5668746">host</span><span class="op" id="5668750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668754">if</span>&nbsp;<span class="ident" id="5668757">err</span>&nbsp;<span class="op" id="5668761">!=</span>&nbsp;<span class="ident" id="5668764">nil</span>&nbsp;<span class="op" id="5668768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668773">return</span>&nbsp;<span class="string" id="5668780">&#34;&#34;</span><span class="op" id="5668782">,</span>&nbsp;<span class="ident" id="5668784">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668796">if</span>&nbsp;<span class="ident" id="5668799">strings</span><span class="op" id="5668806">.</span><span class="ident" id="5668807">HasSuffix</span><span class="op" id="5668816">(</span><span class="ident" id="5668817">host</span><span class="op" id="5668821">,</span>&nbsp;<span class="string" id="5668823">&#34;.&#34;</span><span class="op" id="5668826">)</span>&nbsp;<span class="op" id="5668828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5668832">//&nbsp;Strip&nbsp;trailing&nbsp;dot&nbsp;from&nbsp;fully&nbsp;qualified&nbsp;domain&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668891">host</span>&nbsp;<span class="op" id="5668896">=</span>&nbsp;<span class="ident" id="5668898">host</span><span class="op" id="5668902">[</span><span class="op" id="5668903">:</span><span class="builtinfunc" id="5668904">len</span><span class="op" id="5668907">(</span><span class="ident" id="5668908">host</span><span class="op" id="5668912">)</span><span class="op" id="5668913">-</span><span class="num" id="5668914">1</span><span class="op" id="5668915">]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668921">return</span>&nbsp;<span class="ident" id="5668928">toASCII</span><span class="op" id="5668935">(</span><span class="ident" id="5668936">host</span><span class="op" id="5668940">)</span><br>
<span class="lineno"></span><span class="op" id="5668942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5668945">//&nbsp;hasPort&nbsp;reports&nbsp;whether&nbsp;host&nbsp;contains&nbsp;a&nbsp;port&nbsp;number.&nbsp;host&nbsp;may&nbsp;be&nbsp;a&nbsp;host</span><br>
<span class="lineno">320</span><span class="comment" id="5669020">//&nbsp;name,&nbsp;an&nbsp;IPv4&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5669057">func</span>&nbsp;<span class="ident" id="5669062">hasPort</span><span class="op" id="5669069">(</span><span class="ident" id="5669070">host</span>&nbsp;<span class="builtintype" id="5669075">string</span><span class="op" id="5669081">)</span>&nbsp;<span class="builtintype" id="5669083">bool</span>&nbsp;<span class="op" id="5669088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669091">colons</span>&nbsp;<span class="op" id="5669098">:=</span>&nbsp;<span class="ident" id="5669101">strings</span><span class="op" id="5669108">.</span><span class="ident" id="5669109">Count</span><span class="op" id="5669114">(</span><span class="ident" id="5669115">host</span><span class="op" id="5669119">,</span>&nbsp;<span class="string" id="5669121">&#34;:&#34;</span><span class="op" id="5669124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669127">if</span>&nbsp;<span class="ident" id="5669130">colons</span>&nbsp;<span class="op" id="5669137">==</span>&nbsp;<span class="num" id="5669140">0</span>&nbsp;<span class="op" id="5669142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669146">return</span>&nbsp;<span class="builtintype" id="5669153">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669163">if</span>&nbsp;<span class="ident" id="5669166">colons</span>&nbsp;<span class="op" id="5669173">==</span>&nbsp;<span class="num" id="5669176">1</span>&nbsp;<span class="op" id="5669178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669182">return</span>&nbsp;<span class="builtintype" id="5669189">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669198">return</span>&nbsp;<span class="ident" id="5669205">host</span><span class="op" id="5669209">[</span><span class="num" id="5669210">0</span><span class="op" id="5669211">]</span>&nbsp;<span class="op" id="5669213">==</span>&nbsp;<span class="string" id="5669216">&#39;[&#39;</span>&nbsp;<span class="op" id="5669220">&amp;&amp;</span>&nbsp;<span class="ident" id="5669223">strings</span><span class="op" id="5669230">.</span><span class="ident" id="5669231">Contains</span><span class="op" id="5669239">(</span><span class="ident" id="5669240">host</span><span class="op" id="5669244">,</span>&nbsp;<span class="string" id="5669246">&#34;]:&#34;</span><span class="op" id="5669250">)</span><br>
<span class="lineno">330</span><span class="op" id="5669252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5669255">//&nbsp;jarKey&nbsp;returns&nbsp;the&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;a&nbsp;jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5669299">func</span>&nbsp;<span class="ident" id="5669304">jarKey</span><span class="op" id="5669310">(</span><span class="ident" id="5669311">host</span>&nbsp;<span class="builtintype" id="5669316">string</span><span class="op" id="5669322">,</span>&nbsp;<span class="ident" id="5669324">psl</span>&nbsp;<span class="ident" id="5669328">PublicSuffixList</span><span class="op" id="5669344">)</span>&nbsp;<span class="builtintype" id="5669346">string</span>&nbsp;<span class="op" id="5669353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669356">if</span>&nbsp;<span class="ident" id="5669359">isIP</span><span class="op" id="5669363">(</span><span class="ident" id="5669364">host</span><span class="op" id="5669368">)</span>&nbsp;<span class="op" id="5669370">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669374">return</span>&nbsp;<span class="ident" id="5669381">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669391">var</span>&nbsp;<span class="ident" id="5669395">i</span>&nbsp;<span class="builtintype" id="5669397">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669402">if</span>&nbsp;<span class="ident" id="5669405">psl</span>&nbsp;<span class="op" id="5669409">==</span>&nbsp;<span class="ident" id="5669412">nil</span>&nbsp;<span class="op" id="5669416">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669420">i</span>&nbsp;<span class="op" id="5669422">=</span>&nbsp;<span class="ident" id="5669424">strings</span><span class="op" id="5669431">.</span><span class="ident" id="5669432">LastIndex</span><span class="op" id="5669441">(</span><span class="ident" id="5669442">host</span><span class="op" id="5669446">,</span>&nbsp;<span class="string" id="5669448">&#34;.&#34;</span><span class="op" id="5669451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669455">if</span>&nbsp;<span class="ident" id="5669458">i</span>&nbsp;<span class="op" id="5669460">==</span>&nbsp;<span class="op" id="5669463">-</span><span class="num" id="5669464">1</span>&nbsp;<span class="op" id="5669466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669471">return</span>&nbsp;<span class="ident" id="5669478">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669488">}</span>&nbsp;<span class="keyword" id="5669490">else</span>&nbsp;<span class="op" id="5669495">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669499">suffix</span>&nbsp;<span class="op" id="5669506">:=</span>&nbsp;<span class="ident" id="5669509">psl</span><span class="op" id="5669512">.</span><span class="ident" id="5669513">PublicSuffix</span><span class="op" id="5669525">(</span><span class="ident" id="5669526">host</span><span class="op" id="5669530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669534">if</span>&nbsp;<span class="ident" id="5669537">suffix</span>&nbsp;<span class="op" id="5669544">==</span>&nbsp;<span class="ident" id="5669547">host</span>&nbsp;<span class="op" id="5669552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669557">return</span>&nbsp;<span class="ident" id="5669564">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669575">i</span>&nbsp;<span class="op" id="5669577">=</span>&nbsp;<span class="builtinfunc" id="5669579">len</span><span class="op" id="5669582">(</span><span class="ident" id="5669583">host</span><span class="op" id="5669587">)</span>&nbsp;<span class="op" id="5669589">-</span>&nbsp;<span class="builtinfunc" id="5669591">len</span><span class="op" id="5669594">(</span><span class="ident" id="5669595">suffix</span><span class="op" id="5669601">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669605">if</span>&nbsp;<span class="ident" id="5669608">i</span>&nbsp;<span class="op" id="5669610">&lt;=</span>&nbsp;<span class="num" id="5669613">0</span>&nbsp;<span class="op" id="5669615">||</span>&nbsp;<span class="ident" id="5669618">host</span><span class="op" id="5669622">[</span><span class="ident" id="5669623">i</span><span class="op" id="5669624">-</span><span class="num" id="5669625">1</span><span class="op" id="5669626">]</span>&nbsp;<span class="op" id="5669628">!=</span>&nbsp;<span class="string" id="5669631">&#39;.&#39;</span>&nbsp;<span class="op" id="5669635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5669640">//&nbsp;The&nbsp;provided&nbsp;public&nbsp;suffix&nbsp;list&nbsp;psl&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5669693">//&nbsp;Storing&nbsp;cookies&nbsp;under&nbsp;host&nbsp;is&nbsp;a&nbsp;safe&nbsp;stopgap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669745">return</span>&nbsp;<span class="ident" id="5669752">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669759">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669765">prevDot</span>&nbsp;<span class="op" id="5669773">:=</span>&nbsp;<span class="ident" id="5669776">strings</span><span class="op" id="5669783">.</span><span class="ident" id="5669784">LastIndex</span><span class="op" id="5669793">(</span><span class="ident" id="5669794">host</span><span class="op" id="5669798">[</span><span class="op" id="5669799">:</span><span class="ident" id="5669800">i</span><span class="op" id="5669801">-</span><span class="num" id="5669802">1</span><span class="op" id="5669803">]</span><span class="op" id="5669804">,</span>&nbsp;<span class="string" id="5669806">&#34;.&#34;</span><span class="op" id="5669809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669812">return</span>&nbsp;<span class="ident" id="5669819">host</span><span class="op" id="5669823">[</span><span class="ident" id="5669824">prevDot</span><span class="op" id="5669831">+</span><span class="num" id="5669832">1</span><span class="op" id="5669833">:</span><span class="op" id="5669834">]</span><br>
<span class="lineno"></span><span class="op" id="5669836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="5669839">//&nbsp;isIP&nbsp;reports&nbsp;whether&nbsp;host&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5669886">func</span>&nbsp;<span class="ident" id="5669891">isIP</span><span class="op" id="5669895">(</span><span class="ident" id="5669896">host</span>&nbsp;<span class="builtintype" id="5669901">string</span><span class="op" id="5669907">)</span>&nbsp;<span class="builtintype" id="5669909">bool</span>&nbsp;<span class="op" id="5669914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669917">return</span>&nbsp;<span class="ident" id="5669924">net</span><span class="op" id="5669927">.</span><span class="ident" id="5669928">ParseIP</span><span class="op" id="5669935">(</span><span class="ident" id="5669936">host</span><span class="op" id="5669940">)</span>&nbsp;<span class="op" id="5669942">!=</span>&nbsp;<span class="ident" id="5669945">nil</span><br>
<span class="lineno"></span><span class="op" id="5669949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5669952">//&nbsp;defaultPath&nbsp;returns&nbsp;the&nbsp;directory&nbsp;part&nbsp;of&nbsp;an&nbsp;URL&#39;s&nbsp;path&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5670024">//&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5670051">func</span>&nbsp;<span class="ident" id="5670056">defaultPath</span><span class="op" id="5670067">(</span><span class="ident" id="5670068">path</span>&nbsp;<span class="builtintype" id="5670073">string</span><span class="op" id="5670079">)</span>&nbsp;<span class="builtintype" id="5670081">string</span>&nbsp;<span class="op" id="5670088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670091">if</span>&nbsp;<span class="builtinfunc" id="5670094">len</span><span class="op" id="5670097">(</span><span class="ident" id="5670098">path</span><span class="op" id="5670102">)</span>&nbsp;<span class="op" id="5670104">==</span>&nbsp;<span class="num" id="5670107">0</span>&nbsp;<span class="op" id="5670109">||</span>&nbsp;<span class="ident" id="5670112">path</span><span class="op" id="5670116">[</span><span class="num" id="5670117">0</span><span class="op" id="5670118">]</span>&nbsp;<span class="op" id="5670120">!=</span>&nbsp;<span class="string" id="5670123">&#39;/&#39;</span>&nbsp;<span class="op" id="5670127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670131">return</span>&nbsp;<span class="string" id="5670138">&#34;/&#34;</span>&nbsp;<span class="comment" id="5670142">//&nbsp;Path&nbsp;is&nbsp;empty&nbsp;or&nbsp;malformed.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670178">i</span>&nbsp;<span class="op" id="5670180">:=</span>&nbsp;<span class="ident" id="5670183">strings</span><span class="op" id="5670190">.</span><span class="ident" id="5670191">LastIndex</span><span class="op" id="5670200">(</span><span class="ident" id="5670201">path</span><span class="op" id="5670205">,</span>&nbsp;<span class="string" id="5670207">&#34;/&#34;</span><span class="op" id="5670210">)</span>&nbsp;<span class="comment" id="5670212">//&nbsp;Path&nbsp;starts&nbsp;with&nbsp;&#34;/&#34;,&nbsp;so&nbsp;i&nbsp;!=&nbsp;-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670250">if</span>&nbsp;<span class="ident" id="5670253">i</span>&nbsp;<span class="op" id="5670255">==</span>&nbsp;<span class="num" id="5670258">0</span>&nbsp;<span class="op" id="5670260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670264">return</span>&nbsp;<span class="string" id="5670271">&#34;/&#34;</span>&nbsp;<span class="comment" id="5670275">//&nbsp;Path&nbsp;has&nbsp;the&nbsp;form&nbsp;&#34;/abc&#34;.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670308">return</span>&nbsp;<span class="ident" id="5670315">path</span><span class="op" id="5670319">[</span><span class="op" id="5670320">:</span><span class="ident" id="5670321">i</span><span class="op" id="5670322">]</span>&nbsp;<span class="comment" id="5670324">//&nbsp;Path&nbsp;is&nbsp;either&nbsp;of&nbsp;form&nbsp;&#34;/abc/xyz&#34;&nbsp;or&nbsp;&#34;/abc/xyz/&#34;.</span><br>
<span class="lineno"></span><span class="op" id="5670377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5670380">//&nbsp;newEntry&nbsp;creates&nbsp;an&nbsp;entry&nbsp;from&nbsp;a&nbsp;http.Cookie&nbsp;c.&nbsp;now&nbsp;is&nbsp;the&nbsp;current&nbsp;time&nbsp;and</span><br>
<span class="lineno">380</span><span class="comment" id="5670459">//&nbsp;is&nbsp;compared&nbsp;to&nbsp;c.Expires&nbsp;to&nbsp;determine&nbsp;deletion&nbsp;of&nbsp;c.&nbsp;defPath&nbsp;and&nbsp;host&nbsp;are&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5670540">//&nbsp;default-path&nbsp;and&nbsp;the&nbsp;canonical&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;URL&nbsp;c&nbsp;was&nbsp;received&nbsp;from.</span><br>
<span class="lineno"></span><span class="comment" id="5670616">//</span><br>
<span class="lineno"></span><span class="comment" id="5670619">//&nbsp;remove&nbsp;records&nbsp;whether&nbsp;the&nbsp;jar&nbsp;should&nbsp;delete&nbsp;this&nbsp;cookie,&nbsp;as&nbsp;it&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="5670698">//&nbsp;expired&nbsp;with&nbsp;respect&nbsp;to&nbsp;now.&nbsp;In&nbsp;this&nbsp;case,&nbsp;e&nbsp;may&nbsp;be&nbsp;incomplete,&nbsp;but&nbsp;it&nbsp;will</span><br>
<span class="lineno">385</span><span class="comment" id="5670777">//&nbsp;be&nbsp;valid&nbsp;to&nbsp;call&nbsp;e.id&nbsp;(which&nbsp;depends&nbsp;on&nbsp;e&#39;s&nbsp;Name,&nbsp;Domain&nbsp;and&nbsp;Path).</span><br>
<span class="lineno"></span><span class="comment" id="5670848">//</span><br>
<span class="lineno"></span><span class="comment" id="5670851">//&nbsp;A&nbsp;malformed&nbsp;c.Domain&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5670900">func</span>&nbsp;<span class="op" id="5670905">(</span><span class="ident" id="5670906">j</span>&nbsp;<span class="op" id="5670908">*</span><span class="ident" id="5670909">Jar</span><span class="op" id="5670912">)</span>&nbsp;<span class="ident" id="5670914">newEntry</span><span class="op" id="5670922">(</span><span class="ident" id="5670923">c</span>&nbsp;<span class="op" id="5670925">*</span><span class="ident" id="5670926">http</span><span class="op" id="5670930">.</span><span class="ident" id="5670931">Cookie</span><span class="op" id="5670937">,</span>&nbsp;<span class="ident" id="5670939">now</span>&nbsp;<span class="ident" id="5670943">time</span><span class="op" id="5670947">.</span><span class="ident" id="5670948">Time</span><span class="op" id="5670952">,</span>&nbsp;<span class="ident" id="5670954">defPath</span><span class="op" id="5670961">,</span>&nbsp;<span class="ident" id="5670963">host</span>&nbsp;<span class="builtintype" id="5670968">string</span><span class="op" id="5670974">)</span>&nbsp;<span class="op" id="5670976">(</span><span class="ident" id="5670977">e</span>&nbsp;<span class="ident" id="5670979">entry</span><span class="op" id="5670984">,</span>&nbsp;<span class="ident" id="5670986">remove</span>&nbsp;<span class="builtintype" id="5670993">bool</span><span class="op" id="5670997">,</span>&nbsp;<span class="ident" id="5670999">err</span>&nbsp;<span class="builtintype" id="5671003">error</span><span class="op" id="5671008">)</span>&nbsp;<span class="op" id="5671010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671013">e</span><span class="op" id="5671014">.</span><span class="ident" id="5671015">Name</span>&nbsp;<span class="op" id="5671020">=</span>&nbsp;<span class="ident" id="5671022">c</span><span class="op" id="5671023">.</span><span class="ident" id="5671024">Name</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671031">if</span>&nbsp;<span class="ident" id="5671034">c</span><span class="op" id="5671035">.</span><span class="ident" id="5671036">Path</span>&nbsp;<span class="op" id="5671041">==</span>&nbsp;<span class="string" id="5671044">&#34;&#34;</span>&nbsp;<span class="op" id="5671047">||</span>&nbsp;<span class="ident" id="5671050">c</span><span class="op" id="5671051">.</span><span class="ident" id="5671052">Path</span><span class="op" id="5671056">[</span><span class="num" id="5671057">0</span><span class="op" id="5671058">]</span>&nbsp;<span class="op" id="5671060">!=</span>&nbsp;<span class="string" id="5671063">&#39;/&#39;</span>&nbsp;<span class="op" id="5671067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671071">e</span><span class="op" id="5671072">.</span><span class="ident" id="5671073">Path</span>&nbsp;<span class="op" id="5671078">=</span>&nbsp;<span class="ident" id="5671080">defPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671089">}</span>&nbsp;<span class="keyword" id="5671091">else</span>&nbsp;<span class="op" id="5671096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671100">e</span><span class="op" id="5671101">.</span><span class="ident" id="5671102">Path</span>&nbsp;<span class="op" id="5671107">=</span>&nbsp;<span class="ident" id="5671109">c</span><span class="op" id="5671110">.</span><span class="ident" id="5671111">Path</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671121">e</span><span class="op" id="5671122">.</span><span class="ident" id="5671123">Domain</span><span class="op" id="5671129">,</span>&nbsp;<span class="ident" id="5671131">e</span><span class="op" id="5671132">.</span><span class="ident" id="5671133">HostOnly</span><span class="op" id="5671141">,</span>&nbsp;<span class="ident" id="5671143">err</span>&nbsp;<span class="op" id="5671147">=</span>&nbsp;<span class="ident" id="5671149">j</span><span class="op" id="5671150">.</span><span class="ident" id="5671151">domainAndType</span><span class="op" id="5671164">(</span><span class="ident" id="5671165">host</span><span class="op" id="5671169">,</span>&nbsp;<span class="ident" id="5671171">c</span><span class="op" id="5671172">.</span><span class="ident" id="5671173">Domain</span><span class="op" id="5671179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671182">if</span>&nbsp;<span class="ident" id="5671185">err</span>&nbsp;<span class="op" id="5671189">!=</span>&nbsp;<span class="ident" id="5671192">nil</span>&nbsp;<span class="op" id="5671196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671200">return</span>&nbsp;<span class="ident" id="5671207">e</span><span class="op" id="5671208">,</span>&nbsp;<span class="builtintype" id="5671210">false</span><span class="op" id="5671215">,</span>&nbsp;<span class="ident" id="5671217">err</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671226">//&nbsp;MaxAge&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;Expires.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671268">if</span>&nbsp;<span class="ident" id="5671271">c</span><span class="op" id="5671272">.</span><span class="ident" id="5671273">MaxAge</span>&nbsp;<span class="op" id="5671280">&lt;</span>&nbsp;<span class="num" id="5671282">0</span>&nbsp;<span class="op" id="5671284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671288">return</span>&nbsp;<span class="ident" id="5671295">e</span><span class="op" id="5671296">,</span>&nbsp;<span class="builtintype" id="5671298">true</span><span class="op" id="5671302">,</span>&nbsp;<span class="ident" id="5671304">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671309">}</span>&nbsp;<span class="keyword" id="5671311">else</span>&nbsp;<span class="keyword" id="5671316">if</span>&nbsp;<span class="ident" id="5671319">c</span><span class="op" id="5671320">.</span><span class="ident" id="5671321">MaxAge</span>&nbsp;<span class="op" id="5671328">&gt;</span>&nbsp;<span class="num" id="5671330">0</span>&nbsp;<span class="op" id="5671332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671336">e</span><span class="op" id="5671337">.</span><span class="ident" id="5671338">Expires</span>&nbsp;<span class="op" id="5671346">=</span>&nbsp;<span class="ident" id="5671348">now</span><span class="op" id="5671351">.</span><span class="ident" id="5671352">Add</span><span class="op" id="5671355">(</span><span class="ident" id="5671356">time</span><span class="op" id="5671360">.</span><span class="ident" id="5671361">Duration</span><span class="op" id="5671369">(</span><span class="ident" id="5671370">c</span><span class="op" id="5671371">.</span><span class="ident" id="5671372">MaxAge</span><span class="op" id="5671378">)</span>&nbsp;<span class="op" id="5671380">*</span>&nbsp;<span class="ident" id="5671382">time</span><span class="op" id="5671386">.</span><span class="ident" id="5671387">Second</span><span class="op" id="5671393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671397">e</span><span class="op" id="5671398">.</span><span class="ident" id="5671399">Persistent</span>&nbsp;<span class="op" id="5671410">=</span>&nbsp;<span class="builtintype" id="5671412">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671418">}</span>&nbsp;<span class="keyword" id="5671420">else</span>&nbsp;<span class="op" id="5671425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671429">if</span>&nbsp;<span class="ident" id="5671432">c</span><span class="op" id="5671433">.</span><span class="ident" id="5671434">Expires</span><span class="op" id="5671441">.</span><span class="ident" id="5671442">IsZero</span><span class="op" id="5671448">(</span><span class="op" id="5671449">)</span>&nbsp;<span class="op" id="5671451">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671456">e</span><span class="op" id="5671457">.</span><span class="ident" id="5671458">Expires</span>&nbsp;<span class="op" id="5671466">=</span>&nbsp;<span class="ident" id="5671468">endOfTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671481">e</span><span class="op" id="5671482">.</span><span class="ident" id="5671483">Persistent</span>&nbsp;<span class="op" id="5671494">=</span>&nbsp;<span class="builtintype" id="5671496">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671504">}</span>&nbsp;<span class="keyword" id="5671506">else</span>&nbsp;<span class="op" id="5671511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671516">if</span>&nbsp;<span class="op" id="5671519">!</span><span class="ident" id="5671520">c</span><span class="op" id="5671521">.</span><span class="ident" id="5671522">Expires</span><span class="op" id="5671529">.</span><span class="ident" id="5671530">After</span><span class="op" id="5671535">(</span><span class="ident" id="5671536">now</span><span class="op" id="5671539">)</span>&nbsp;<span class="op" id="5671541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671547">return</span>&nbsp;<span class="ident" id="5671554">e</span><span class="op" id="5671555">,</span>&nbsp;<span class="builtintype" id="5671557">true</span><span class="op" id="5671561">,</span>&nbsp;<span class="ident" id="5671563">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671575">e</span><span class="op" id="5671576">.</span><span class="ident" id="5671577">Expires</span>&nbsp;<span class="op" id="5671585">=</span>&nbsp;<span class="ident" id="5671587">c</span><span class="op" id="5671588">.</span><span class="ident" id="5671589">Expires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671600">e</span><span class="op" id="5671601">.</span><span class="ident" id="5671602">Persistent</span>&nbsp;<span class="op" id="5671613">=</span>&nbsp;<span class="builtintype" id="5671615">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671625">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671629">e</span><span class="op" id="5671630">.</span><span class="ident" id="5671631">Value</span>&nbsp;<span class="op" id="5671637">=</span>&nbsp;<span class="ident" id="5671639">c</span><span class="op" id="5671640">.</span><span class="ident" id="5671641">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671648">e</span><span class="op" id="5671649">.</span><span class="ident" id="5671650">Secure</span>&nbsp;<span class="op" id="5671657">=</span>&nbsp;<span class="ident" id="5671659">c</span><span class="op" id="5671660">.</span><span class="ident" id="5671661">Secure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671669">e</span><span class="op" id="5671670">.</span><span class="ident" id="5671671">HttpOnly</span>&nbsp;<span class="op" id="5671680">=</span>&nbsp;<span class="ident" id="5671682">c</span><span class="op" id="5671683">.</span><span class="ident" id="5671684">HttpOnly</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671695">return</span>&nbsp;<span class="ident" id="5671702">e</span><span class="op" id="5671703">,</span>&nbsp;<span class="builtintype" id="5671705">false</span><span class="op" id="5671710">,</span>&nbsp;<span class="ident" id="5671712">nil</span><br>
<span class="lineno"></span><span class="op" id="5671716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5671719">var</span>&nbsp;<span class="op" id="5671723">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671726">errIllegalDomain</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5671745">=</span>&nbsp;<span class="ident" id="5671747">errors</span><span class="op" id="5671753">.</span><span class="ident" id="5671754">New</span><span class="op" id="5671757">(</span><span class="string" id="5671758">&#34;cookiejar:&nbsp;illegal&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5671802">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671805">errMalformedDomain</span>&nbsp;<span class="op" id="5671824">=</span>&nbsp;<span class="ident" id="5671826">errors</span><span class="op" id="5671832">.</span><span class="ident" id="5671833">New</span><span class="op" id="5671836">(</span><span class="string" id="5671837">&#34;cookiejar:&nbsp;malformed&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5671883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671886">errNoHostname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5671905">=</span>&nbsp;<span class="ident" id="5671907">errors</span><span class="op" id="5671913">.</span><span class="ident" id="5671914">New</span><span class="op" id="5671917">(</span><span class="string" id="5671918">&#34;cookiejar:&nbsp;no&nbsp;host&nbsp;name&nbsp;available&nbsp;(IP&nbsp;only)&#34;</span><span class="op" id="5671963">)</span><br>
<span class="lineno"></span><span class="op" id="5671965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5671968">//&nbsp;endOfTime&nbsp;is&nbsp;the&nbsp;time&nbsp;when&nbsp;session&nbsp;(non-persistent)&nbsp;cookies&nbsp;expire.</span><br>
<span class="lineno">435</span><span class="comment" id="5672039">//&nbsp;This&nbsp;instant&nbsp;is&nbsp;representable&nbsp;in&nbsp;most&nbsp;date/time&nbsp;formats&nbsp;(not&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="5672108">//&nbsp;Go&#39;s&nbsp;time.Time)&nbsp;and&nbsp;should&nbsp;be&nbsp;far&nbsp;enough&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="5672167">var</span>&nbsp;<span class="ident" id="5672171">endOfTime</span>&nbsp;<span class="op" id="5672181">=</span>&nbsp;<span class="ident" id="5672183">time</span><span class="op" id="5672187">.</span><span class="ident" id="5672188">Date</span><span class="op" id="5672192">(</span><span class="num" id="5672193">9999</span><span class="op" id="5672197">,</span>&nbsp;<span class="num" id="5672199">12</span><span class="op" id="5672201">,</span>&nbsp;<span class="num" id="5672203">31</span><span class="op" id="5672205">,</span>&nbsp;<span class="num" id="5672207">23</span><span class="op" id="5672209">,</span>&nbsp;<span class="num" id="5672211">59</span><span class="op" id="5672213">,</span>&nbsp;<span class="num" id="5672215">59</span><span class="op" id="5672217">,</span>&nbsp;<span class="num" id="5672219">0</span><span class="op" id="5672220">,</span>&nbsp;<span class="ident" id="5672222">time</span><span class="op" id="5672226">.</span><span class="ident" id="5672227">UTC</span><span class="op" id="5672230">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5672233">//&nbsp;domainAndType&nbsp;determines&nbsp;the&nbsp;cookie&#39;s&nbsp;domain&nbsp;and&nbsp;hostOnly&nbsp;attribute.</span><br>
<span class="lineno">440</span><span class="keyword" id="5672305">func</span>&nbsp;<span class="op" id="5672310">(</span><span class="ident" id="5672311">j</span>&nbsp;<span class="op" id="5672313">*</span><span class="ident" id="5672314">Jar</span><span class="op" id="5672317">)</span>&nbsp;<span class="ident" id="5672319">domainAndType</span><span class="op" id="5672332">(</span><span class="ident" id="5672333">host</span><span class="op" id="5672337">,</span>&nbsp;<span class="ident" id="5672339">domain</span>&nbsp;<span class="builtintype" id="5672346">string</span><span class="op" id="5672352">)</span>&nbsp;<span class="op" id="5672354">(</span><span class="builtintype" id="5672355">string</span><span class="op" id="5672361">,</span>&nbsp;<span class="builtintype" id="5672363">bool</span><span class="op" id="5672367">,</span>&nbsp;<span class="builtintype" id="5672369">error</span><span class="op" id="5672374">)</span>&nbsp;<span class="op" id="5672376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672379">if</span>&nbsp;<span class="ident" id="5672382">domain</span>&nbsp;<span class="op" id="5672389">==</span>&nbsp;<span class="string" id="5672392">&#34;&#34;</span>&nbsp;<span class="op" id="5672395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5672399">//&nbsp;No&nbsp;domain&nbsp;attribute&nbsp;in&nbsp;the&nbsp;SetCookie&nbsp;header&nbsp;indicates&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5672460">//&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672478">return</span>&nbsp;<span class="ident" id="5672485">host</span><span class="op" id="5672489">,</span>&nbsp;<span class="builtintype" id="5672491">true</span><span class="op" id="5672495">,</span>&nbsp;<span class="ident" id="5672497">nil</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672506">if</span>&nbsp;<span class="ident" id="5672509">isIP</span><span class="op" id="5672513">(</span><span class="ident" id="5672514">host</span><span class="op" id="5672518">)</span>&nbsp;<span class="op" id="5672520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5672524">//&nbsp;According&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;domain-matching&nbsp;includes&nbsp;not&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5672586">//&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5672606">//&nbsp;TODO:&nbsp;This&nbsp;might&nbsp;be&nbsp;relaxed&nbsp;as&nbsp;in&nbsp;common&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672662">return</span>&nbsp;<span class="string" id="5672669">&#34;&#34;</span><span class="op" id="5672671">,</span>&nbsp;<span class="builtintype" id="5672673">false</span><span class="op" id="5672678">,</span>&nbsp;<span class="ident" id="5672680">errNoHostname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5672699">//&nbsp;From&nbsp;here&nbsp;on:&nbsp;If&nbsp;the&nbsp;cookie&nbsp;is&nbsp;valid,&nbsp;it&nbsp;is&nbsp;a&nbsp;domain&nbsp;cookie&nbsp;(with</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5672769">//&nbsp;the&nbsp;one&nbsp;exception&nbsp;of&nbsp;a&nbsp;public&nbsp;suffix&nbsp;below).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5672818">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672850">if</span>&nbsp;<span class="ident" id="5672853">domain</span><span class="op" id="5672859">[</span><span class="num" id="5672860">0</span><span class="op" id="5672861">]</span>&nbsp;<span class="op" id="5672863">==</span>&nbsp;<span class="string" id="5672866">&#39;.&#39;</span>&nbsp;<span class="op" id="5672870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672874">domain</span>&nbsp;<span class="op" id="5672881">=</span>&nbsp;<span class="ident" id="5672883">domain</span><span class="op" id="5672889">[</span><span class="num" id="5672890">1</span><span class="op" id="5672891">:</span><span class="op" id="5672892">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672895">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672899">if</span>&nbsp;<span class="builtinfunc" id="5672902">len</span><span class="op" id="5672905">(</span><span class="ident" id="5672906">domain</span><span class="op" id="5672912">)</span>&nbsp;<span class="op" id="5672914">==</span>&nbsp;<span class="num" id="5672917">0</span>&nbsp;<span class="op" id="5672919">||</span>&nbsp;<span class="ident" id="5672922">domain</span><span class="op" id="5672928">[</span><span class="num" id="5672929">0</span><span class="op" id="5672930">]</span>&nbsp;<span class="op" id="5672932">==</span>&nbsp;<span class="string" id="5672935">&#39;.&#39;</span>&nbsp;<span class="op" id="5672939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5672943">//&nbsp;Received&nbsp;either&nbsp;&#34;Domain=.&#34;&nbsp;or&nbsp;&#34;Domain=..some.thing&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673001">//&nbsp;both&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673024">return</span>&nbsp;<span class="string" id="5673031">&#34;&#34;</span><span class="op" id="5673033">,</span>&nbsp;<span class="builtintype" id="5673035">false</span><span class="op" id="5673040">,</span>&nbsp;<span class="ident" id="5673042">errMalformedDomain</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673065">domain</span>&nbsp;<span class="op" id="5673072">=</span>&nbsp;<span class="ident" id="5673074">strings</span><span class="op" id="5673081">.</span><span class="ident" id="5673082">ToLower</span><span class="op" id="5673089">(</span><span class="ident" id="5673090">domain</span><span class="op" id="5673096">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673100">if</span>&nbsp;<span class="ident" id="5673103">domain</span><span class="op" id="5673109">[</span><span class="builtinfunc" id="5673110">len</span><span class="op" id="5673113">(</span><span class="ident" id="5673114">domain</span><span class="op" id="5673120">)</span><span class="op" id="5673121">-</span><span class="num" id="5673122">1</span><span class="op" id="5673123">]</span>&nbsp;<span class="op" id="5673125">==</span>&nbsp;<span class="string" id="5673128">&#39;.&#39;</span>&nbsp;<span class="op" id="5673132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673136">//&nbsp;We&nbsp;received&nbsp;stuff&nbsp;like&nbsp;&#34;Domain=www.example.com.&#34;.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673191">//&nbsp;Browsers&nbsp;do&nbsp;handle&nbsp;such&nbsp;stuff&nbsp;(actually&nbsp;differently)&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673253">//&nbsp;RFC&nbsp;6265&nbsp;seems&nbsp;to&nbsp;be&nbsp;clear&nbsp;here&nbsp;(e.g.&nbsp;section&nbsp;4.1.2.3)&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673316">//&nbsp;requiring&nbsp;a&nbsp;reject.&nbsp;&nbsp;4.1.2.3&nbsp;is&nbsp;not&nbsp;normative,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673372">//&nbsp;&#34;Domain&nbsp;Matching&#34;&nbsp;(5.1.3)&nbsp;and&nbsp;&#34;Canonicalized&nbsp;Host&nbsp;Names&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673434">//&nbsp;(5.1.2)&nbsp;are.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673452">return</span>&nbsp;<span class="string" id="5673459">&#34;&#34;</span><span class="op" id="5673461">,</span>&nbsp;<span class="builtintype" id="5673463">false</span><span class="op" id="5673468">,</span>&nbsp;<span class="ident" id="5673470">errMalformedDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673494">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.3&nbsp;#5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673527">if</span>&nbsp;<span class="ident" id="5673530">j</span><span class="op" id="5673531">.</span><span class="ident" id="5673532">psList</span>&nbsp;<span class="op" id="5673539">!=</span>&nbsp;<span class="ident" id="5673542">nil</span>&nbsp;<span class="op" id="5673546">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673550">if</span>&nbsp;<span class="ident" id="5673553">ps</span>&nbsp;<span class="op" id="5673556">:=</span>&nbsp;<span class="ident" id="5673559">j</span><span class="op" id="5673560">.</span><span class="ident" id="5673561">psList</span><span class="op" id="5673567">.</span><span class="ident" id="5673568">PublicSuffix</span><span class="op" id="5673580">(</span><span class="ident" id="5673581">domain</span><span class="op" id="5673587">)</span><span class="op" id="5673588">;</span>&nbsp;<span class="ident" id="5673590">ps</span>&nbsp;<span class="op" id="5673593">!=</span>&nbsp;<span class="string" id="5673596">&#34;&#34;</span>&nbsp;<span class="op" id="5673599">&amp;&amp;</span>&nbsp;<span class="op" id="5673602">!</span><span class="ident" id="5673603">hasDotSuffix</span><span class="op" id="5673615">(</span><span class="ident" id="5673616">domain</span><span class="op" id="5673622">,</span>&nbsp;<span class="ident" id="5673624">ps</span><span class="op" id="5673626">)</span>&nbsp;<span class="op" id="5673628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673633">if</span>&nbsp;<span class="ident" id="5673636">host</span>&nbsp;<span class="op" id="5673641">==</span>&nbsp;<span class="ident" id="5673644">domain</span>&nbsp;<span class="op" id="5673651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673657">//&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;exception&nbsp;in&nbsp;which&nbsp;a&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673708">//&nbsp;with&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;is&nbsp;a&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673757">return</span>&nbsp;<span class="ident" id="5673764">host</span><span class="op" id="5673768">,</span>&nbsp;<span class="builtintype" id="5673770">true</span><span class="op" id="5673774">,</span>&nbsp;<span class="ident" id="5673776">nil</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673788">return</span>&nbsp;<span class="string" id="5673795">&#34;&#34;</span><span class="op" id="5673797">,</span>&nbsp;<span class="builtintype" id="5673799">false</span><span class="op" id="5673804">,</span>&nbsp;<span class="ident" id="5673806">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673832">//&nbsp;The&nbsp;domain&nbsp;must&nbsp;domain-match&nbsp;host:&nbsp;www.mycompany.com&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673896">//&nbsp;set&nbsp;cookies&nbsp;for&nbsp;.ourcompetitors.com.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673937">if</span>&nbsp;<span class="ident" id="5673940">host</span>&nbsp;<span class="op" id="5673945">!=</span>&nbsp;<span class="ident" id="5673948">domain</span>&nbsp;<span class="op" id="5673955">&amp;&amp;</span>&nbsp;<span class="op" id="5673958">!</span><span class="ident" id="5673959">hasDotSuffix</span><span class="op" id="5673971">(</span><span class="ident" id="5673972">host</span><span class="op" id="5673976">,</span>&nbsp;<span class="ident" id="5673978">domain</span><span class="op" id="5673984">)</span>&nbsp;<span class="op" id="5673986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673990">return</span>&nbsp;<span class="string" id="5673997">&#34;&#34;</span><span class="op" id="5673999">,</span>&nbsp;<span class="builtintype" id="5674001">false</span><span class="op" id="5674006">,</span>&nbsp;<span class="ident" id="5674008">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674026">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674030">return</span>&nbsp;<span class="ident" id="5674037">domain</span><span class="op" id="5674043">,</span>&nbsp;<span class="builtintype" id="5674045">false</span><span class="op" id="5674050">,</span>&nbsp;<span class="ident" id="5674052">nil</span><br>
<span class="lineno"></span><span class="op" id="5674056">}</span>
</div>
</body>
</html>
