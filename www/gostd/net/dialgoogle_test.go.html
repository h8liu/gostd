<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8354923">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8354978">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8355032">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8355083">package</span>&nbsp;<span class="ident" id="8355091">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8355096">import</span>&nbsp;<span class="op" id="8355103">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8355106">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8355114">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8355121">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8355127">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8355138">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8355149">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8355159">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="8355162">//&nbsp;If&nbsp;an&nbsp;IPv6&nbsp;tunnel&nbsp;is&nbsp;running,&nbsp;we&nbsp;can&nbsp;try&nbsp;dialing&nbsp;a&nbsp;real&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="8355235">var</span>&nbsp;<span class="ident" id="8355239">testIPv6</span>&nbsp;<span class="op" id="8355248">=</span>&nbsp;<span class="ident" id="8355250">flag</span><span class="op" id="8355254">.</span><span class="ident" id="8355255">Bool</span><span class="op" id="8355259">(</span><span class="string" id="8355260">&#34;ipv6&#34;</span><span class="op" id="8355266">,</span>&nbsp;<span class="builtintype" id="8355268">false</span><span class="op" id="8355273">,</span>&nbsp;<span class="string" id="8355275">&#34;assume&nbsp;ipv6&nbsp;tunnel&nbsp;is&nbsp;present&#34;</span><span class="op" id="8355306">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8355309">func</span>&nbsp;<span class="ident" id="8355314">TestResolveGoogle</span><span class="op" id="8355331">(</span><span class="ident" id="8355332">t</span>&nbsp;<span class="op" id="8355334">*</span><span class="ident" id="8355335">testing</span><span class="op" id="8355342">.</span><span class="ident" id="8355343">T</span><span class="op" id="8355344">)</span>&nbsp;<span class="op" id="8355346">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355349">if</span>&nbsp;<span class="ident" id="8355352">testing</span><span class="op" id="8355359">.</span><span class="ident" id="8355360">Short</span><span class="op" id="8355365">(</span><span class="op" id="8355366">)</span>&nbsp;<span class="op" id="8355368">||</span>&nbsp;<span class="op" id="8355371">!</span><span class="op" id="8355372">*</span><span class="ident" id="8355373">testExternal</span>&nbsp;<span class="op" id="8355386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355390">t</span><span class="op" id="8355391">.</span><span class="ident" id="8355392">Skip</span><span class="op" id="8355396">(</span><span class="string" id="8355397">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8355438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355445">for</span>&nbsp;<span class="ident" id="8355449">_</span><span class="op" id="8355450">,</span>&nbsp;<span class="ident" id="8355452">network</span>&nbsp;<span class="op" id="8355460">:=</span>&nbsp;<span class="keyword" id="8355463">range</span>&nbsp;<span class="op" id="8355469">[</span><span class="op" id="8355470">]</span><span class="builtintype" id="8355471">string</span><span class="op" id="8355477">{</span><span class="string" id="8355478">&#34;tcp&#34;</span><span class="op" id="8355483">,</span>&nbsp;<span class="string" id="8355485">&#34;tcp4&#34;</span><span class="op" id="8355491">,</span>&nbsp;<span class="string" id="8355493">&#34;tcp6&#34;</span><span class="op" id="8355499">}</span>&nbsp;<span class="op" id="8355501">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355505">addr</span><span class="op" id="8355509">,</span>&nbsp;<span class="ident" id="8355511">err</span>&nbsp;<span class="op" id="8355515">:=</span>&nbsp;<span class="ident" id="8355518">ResolveTCPAddr</span><span class="op" id="8355532">(</span><span class="ident" id="8355533">network</span><span class="op" id="8355540">,</span>&nbsp;<span class="string" id="8355542">&#34;www.google.com:http&#34;</span><span class="op" id="8355563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355567">if</span>&nbsp;<span class="ident" id="8355570">err</span>&nbsp;<span class="op" id="8355574">!=</span>&nbsp;<span class="ident" id="8355577">nil</span>&nbsp;<span class="op" id="8355581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355586">if</span>&nbsp;<span class="op" id="8355589">(</span><span class="ident" id="8355590">network</span>&nbsp;<span class="op" id="8355598">==</span>&nbsp;<span class="string" id="8355601">&#34;tcp&#34;</span>&nbsp;<span class="op" id="8355607">||</span>&nbsp;<span class="ident" id="8355610">network</span>&nbsp;<span class="op" id="8355618">==</span>&nbsp;<span class="string" id="8355621">&#34;tcp4&#34;</span><span class="op" id="8355627">)</span>&nbsp;<span class="op" id="8355629">&amp;&amp;</span>&nbsp;<span class="op" id="8355632">!</span><span class="ident" id="8355633">supportsIPv4</span>&nbsp;<span class="op" id="8355646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355652">t</span><span class="op" id="8355653">.</span><span class="ident" id="8355654">Logf</span><span class="op" id="8355658">(</span><span class="string" id="8355659">&#34;ipv4&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="8355686">,</span>&nbsp;<span class="ident" id="8355688">err</span><span class="op" id="8355691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355696">}</span>&nbsp;<span class="keyword" id="8355698">else</span>&nbsp;<span class="keyword" id="8355703">if</span>&nbsp;<span class="ident" id="8355706">network</span>&nbsp;<span class="op" id="8355714">==</span>&nbsp;<span class="string" id="8355717">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="8355724">&amp;&amp;</span>&nbsp;<span class="op" id="8355727">!</span><span class="ident" id="8355728">supportsIPv6</span>&nbsp;<span class="op" id="8355741">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355747">t</span><span class="op" id="8355748">.</span><span class="ident" id="8355749">Logf</span><span class="op" id="8355753">(</span><span class="string" id="8355754">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="8355781">,</span>&nbsp;<span class="ident" id="8355783">err</span><span class="op" id="8355786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355791">}</span>&nbsp;<span class="keyword" id="8355793">else</span>&nbsp;<span class="op" id="8355798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355804">t</span><span class="op" id="8355805">.</span><span class="ident" id="8355806">Errorf</span><span class="op" id="8355812">(</span><span class="string" id="8355813">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8355840">,</span>&nbsp;<span class="ident" id="8355842">err</span><span class="op" id="8355845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355855">continue</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355870">if</span>&nbsp;<span class="op" id="8355873">(</span><span class="ident" id="8355874">network</span>&nbsp;<span class="op" id="8355882">==</span>&nbsp;<span class="string" id="8355885">&#34;tcp&#34;</span>&nbsp;<span class="op" id="8355891">||</span>&nbsp;<span class="ident" id="8355894">network</span>&nbsp;<span class="op" id="8355902">==</span>&nbsp;<span class="string" id="8355905">&#34;tcp4&#34;</span><span class="op" id="8355911">)</span>&nbsp;<span class="op" id="8355913">&amp;&amp;</span>&nbsp;<span class="ident" id="8355916">addr</span><span class="op" id="8355920">.</span><span class="ident" id="8355921">IP</span><span class="op" id="8355923">.</span><span class="ident" id="8355924">To4</span><span class="op" id="8355927">(</span><span class="op" id="8355928">)</span>&nbsp;<span class="op" id="8355930">==</span>&nbsp;<span class="ident" id="8355933">nil</span>&nbsp;<span class="op" id="8355937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355942">t</span><span class="op" id="8355943">.</span><span class="ident" id="8355944">Errorf</span><span class="op" id="8355950">(</span><span class="string" id="8355951">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="8355991">,</span>&nbsp;<span class="ident" id="8355993">addr</span><span class="op" id="8355997">,</span>&nbsp;<span class="ident" id="8355999">network</span><span class="op" id="8356006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356010">}</span>&nbsp;<span class="keyword" id="8356012">else</span>&nbsp;<span class="keyword" id="8356017">if</span>&nbsp;<span class="ident" id="8356020">network</span>&nbsp;<span class="op" id="8356028">==</span>&nbsp;<span class="string" id="8356031">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="8356038">&amp;&amp;</span>&nbsp;<span class="op" id="8356041">(</span><span class="ident" id="8356042">addr</span><span class="op" id="8356046">.</span><span class="ident" id="8356047">IP</span><span class="op" id="8356049">.</span><span class="ident" id="8356050">To16</span><span class="op" id="8356054">(</span><span class="op" id="8356055">)</span>&nbsp;<span class="op" id="8356057">==</span>&nbsp;<span class="ident" id="8356060">nil</span>&nbsp;<span class="op" id="8356064">||</span>&nbsp;<span class="ident" id="8356067">addr</span><span class="op" id="8356071">.</span><span class="ident" id="8356072">IP</span><span class="op" id="8356074">.</span><span class="ident" id="8356075">To4</span><span class="op" id="8356078">(</span><span class="op" id="8356079">)</span>&nbsp;<span class="op" id="8356081">!=</span>&nbsp;<span class="ident" id="8356084">nil</span><span class="op" id="8356087">)</span>&nbsp;<span class="op" id="8356089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356094">t</span><span class="op" id="8356095">.</span><span class="ident" id="8356096">Errorf</span><span class="op" id="8356102">(</span><span class="string" id="8356103">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="8356143">,</span>&nbsp;<span class="ident" id="8356145">addr</span><span class="op" id="8356149">,</span>&nbsp;<span class="ident" id="8356151">network</span><span class="op" id="8356158">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356165">}</span><br>
<span class="lineno"></span><span class="op" id="8356167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8356170">func</span>&nbsp;<span class="ident" id="8356175">TestDialGoogle</span><span class="op" id="8356189">(</span><span class="ident" id="8356190">t</span>&nbsp;<span class="op" id="8356192">*</span><span class="ident" id="8356193">testing</span><span class="op" id="8356200">.</span><span class="ident" id="8356201">T</span><span class="op" id="8356202">)</span>&nbsp;<span class="op" id="8356204">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356207">if</span>&nbsp;<span class="ident" id="8356210">testing</span><span class="op" id="8356217">.</span><span class="ident" id="8356218">Short</span><span class="op" id="8356223">(</span><span class="op" id="8356224">)</span>&nbsp;<span class="op" id="8356226">||</span>&nbsp;<span class="op" id="8356229">!</span><span class="op" id="8356230">*</span><span class="ident" id="8356231">testExternal</span>&nbsp;<span class="op" id="8356244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356248">t</span><span class="op" id="8356249">.</span><span class="ident" id="8356250">Skip</span><span class="op" id="8356254">(</span><span class="string" id="8356255">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8356296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356303">d</span>&nbsp;<span class="op" id="8356305">:=</span>&nbsp;<span class="op" id="8356308">&amp;</span><span class="ident" id="8356309">Dialer</span><span class="op" id="8356315">{</span><span class="ident" id="8356316">DualStack</span><span class="op" id="8356325">:</span>&nbsp;<span class="builtintype" id="8356327">true</span><span class="op" id="8356331">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356334">for</span>&nbsp;<span class="ident" id="8356338">_</span><span class="op" id="8356339">,</span>&nbsp;<span class="ident" id="8356341">network</span>&nbsp;<span class="op" id="8356349">:=</span>&nbsp;<span class="keyword" id="8356352">range</span>&nbsp;<span class="op" id="8356358">[</span><span class="op" id="8356359">]</span><span class="builtintype" id="8356360">string</span><span class="op" id="8356366">{</span><span class="string" id="8356367">&#34;tcp&#34;</span><span class="op" id="8356372">,</span>&nbsp;<span class="string" id="8356374">&#34;tcp4&#34;</span><span class="op" id="8356380">,</span>&nbsp;<span class="string" id="8356382">&#34;tcp6&#34;</span><span class="op" id="8356388">}</span>&nbsp;<span class="op" id="8356390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356394">if</span>&nbsp;<span class="ident" id="8356397">network</span>&nbsp;<span class="op" id="8356405">==</span>&nbsp;<span class="string" id="8356408">&#34;tcp&#34;</span>&nbsp;<span class="op" id="8356414">&amp;&amp;</span>&nbsp;<span class="op" id="8356417">!</span><span class="ident" id="8356418">supportsIPv4</span>&nbsp;<span class="op" id="8356431">&amp;&amp;</span>&nbsp;<span class="op" id="8356434">!</span><span class="ident" id="8356435">supportsIPv6</span>&nbsp;<span class="op" id="8356448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356453">t</span><span class="op" id="8356454">.</span><span class="ident" id="8356455">Logf</span><span class="op" id="8356459">(</span><span class="string" id="8356460">&#34;skipping&nbsp;test;&nbsp;both&nbsp;ipv4&nbsp;and&nbsp;ipv6&nbsp;are&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8356513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356518">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356529">}</span>&nbsp;<span class="keyword" id="8356531">else</span>&nbsp;<span class="keyword" id="8356536">if</span>&nbsp;<span class="ident" id="8356539">network</span>&nbsp;<span class="op" id="8356547">==</span>&nbsp;<span class="string" id="8356550">&#34;tcp4&#34;</span>&nbsp;<span class="op" id="8356557">&amp;&amp;</span>&nbsp;<span class="op" id="8356560">!</span><span class="ident" id="8356561">supportsIPv4</span>&nbsp;<span class="op" id="8356574">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356579">t</span><span class="op" id="8356580">.</span><span class="ident" id="8356581">Logf</span><span class="op" id="8356585">(</span><span class="string" id="8356586">&#34;skipping&nbsp;test;&nbsp;ipv4&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8356624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356629">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356640">}</span>&nbsp;<span class="keyword" id="8356642">else</span>&nbsp;<span class="keyword" id="8356647">if</span>&nbsp;<span class="ident" id="8356650">network</span>&nbsp;<span class="op" id="8356658">==</span>&nbsp;<span class="string" id="8356661">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="8356668">&amp;&amp;</span>&nbsp;<span class="op" id="8356671">!</span><span class="ident" id="8356672">supportsIPv6</span>&nbsp;<span class="op" id="8356685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356690">t</span><span class="op" id="8356691">.</span><span class="ident" id="8356692">Logf</span><span class="op" id="8356696">(</span><span class="string" id="8356697">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8356735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356740">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356751">}</span>&nbsp;<span class="keyword" id="8356753">else</span>&nbsp;<span class="keyword" id="8356758">if</span>&nbsp;<span class="ident" id="8356761">network</span>&nbsp;<span class="op" id="8356769">==</span>&nbsp;<span class="string" id="8356772">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="8356779">&amp;&amp;</span>&nbsp;<span class="op" id="8356782">!</span><span class="op" id="8356783">*</span><span class="ident" id="8356784">testIPv6</span>&nbsp;<span class="op" id="8356793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356798">t</span><span class="op" id="8356799">.</span><span class="ident" id="8356800">Logf</span><span class="op" id="8356804">(</span><span class="string" id="8356805">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="8356841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356846">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356861">if</span>&nbsp;<span class="ident" id="8356864">c</span><span class="op" id="8356865">,</span>&nbsp;<span class="ident" id="8356867">err</span>&nbsp;<span class="op" id="8356871">:=</span>&nbsp;<span class="ident" id="8356874">d</span><span class="op" id="8356875">.</span><span class="ident" id="8356876">Dial</span><span class="op" id="8356880">(</span><span class="ident" id="8356881">network</span><span class="op" id="8356888">,</span>&nbsp;<span class="string" id="8356890">&#34;www.google.com:http&#34;</span><span class="op" id="8356911">)</span><span class="op" id="8356912">;</span>&nbsp;<span class="ident" id="8356914">err</span>&nbsp;<span class="op" id="8356918">!=</span>&nbsp;<span class="ident" id="8356921">nil</span>&nbsp;<span class="op" id="8356925">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356930">t</span><span class="op" id="8356931">.</span><span class="ident" id="8356932">Errorf</span><span class="op" id="8356938">(</span><span class="string" id="8356939">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8356956">,</span>&nbsp;<span class="ident" id="8356958">err</span><span class="op" id="8356961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356965">}</span>&nbsp;<span class="keyword" id="8356967">else</span>&nbsp;<span class="op" id="8356972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356977">c</span><span class="op" id="8356978">.</span><span class="ident" id="8356979">Close</span><span class="op" id="8356984">(</span><span class="op" id="8356985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356992">}</span><br>
<span class="lineno">70</span><span class="op" id="8356994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8356997">//&nbsp;fd&nbsp;is&nbsp;already&nbsp;connected&nbsp;to&nbsp;the&nbsp;destination,&nbsp;port&nbsp;80.</span><br>
<span class="lineno"></span><span class="comment" id="8357053">//&nbsp;Run&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;to&nbsp;fetch&nbsp;the&nbsp;appropriate&nbsp;page.</span><br>
<span class="lineno"></span><span class="keyword" id="8357107">func</span>&nbsp;<span class="ident" id="8357112">fetchGoogle</span><span class="op" id="8357123">(</span><span class="ident" id="8357124">t</span>&nbsp;<span class="op" id="8357126">*</span><span class="ident" id="8357127">testing</span><span class="op" id="8357134">.</span><span class="ident" id="8357135">T</span><span class="op" id="8357136">,</span>&nbsp;<span class="ident" id="8357138">fd</span>&nbsp;<span class="ident" id="8357141">Conn</span><span class="op" id="8357145">,</span>&nbsp;<span class="ident" id="8357147">network</span><span class="op" id="8357154">,</span>&nbsp;<span class="ident" id="8357156">addr</span>&nbsp;<span class="builtintype" id="8357161">string</span><span class="op" id="8357167">)</span>&nbsp;<span class="op" id="8357169">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357172">req</span>&nbsp;<span class="op" id="8357176">:=</span>&nbsp;<span class="op" id="8357179">[</span><span class="op" id="8357180">]</span><span class="builtintype" id="8357181">byte</span><span class="op" id="8357185">(</span><span class="string" id="8357186">&#34;GET&nbsp;/robots.txt&nbsp;HTTP/1.0\r\nHost:&nbsp;www.google.com\r\n\r\n&#34;</span><span class="op" id="8357244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357247">n</span><span class="op" id="8357248">,</span>&nbsp;<span class="ident" id="8357250">err</span>&nbsp;<span class="op" id="8357254">:=</span>&nbsp;<span class="ident" id="8357257">fd</span><span class="op" id="8357259">.</span><span class="ident" id="8357260">Write</span><span class="op" id="8357265">(</span><span class="ident" id="8357266">req</span><span class="op" id="8357269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357273">buf</span>&nbsp;<span class="op" id="8357277">:=</span>&nbsp;<span class="builtinfunc" id="8357280">make</span><span class="op" id="8357284">(</span><span class="op" id="8357285">[</span><span class="op" id="8357286">]</span><span class="builtintype" id="8357287">byte</span><span class="op" id="8357291">,</span>&nbsp;<span class="num" id="8357293">1000</span><span class="op" id="8357297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357300">n</span><span class="op" id="8357301">,</span>&nbsp;<span class="ident" id="8357303">err</span>&nbsp;<span class="op" id="8357307">=</span>&nbsp;<span class="ident" id="8357309">io</span><span class="op" id="8357311">.</span><span class="ident" id="8357312">ReadFull</span><span class="op" id="8357320">(</span><span class="ident" id="8357321">fd</span><span class="op" id="8357323">,</span>&nbsp;<span class="ident" id="8357325">buf</span><span class="op" id="8357328">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357332">if</span>&nbsp;<span class="ident" id="8357335">n</span>&nbsp;<span class="op" id="8357337">&lt;</span>&nbsp;<span class="num" id="8357339">1000</span>&nbsp;<span class="op" id="8357344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357348">t</span><span class="op" id="8357349">.</span><span class="ident" id="8357350">Errorf</span><span class="op" id="8357356">(</span><span class="string" id="8357357">&#34;fetchGoogle:&nbsp;short&nbsp;HTTP&nbsp;read&nbsp;from&nbsp;%s&nbsp;%s&nbsp;-&nbsp;%v&#34;</span><span class="op" id="8357403">,</span>&nbsp;<span class="ident" id="8357405">network</span><span class="op" id="8357412">,</span>&nbsp;<span class="ident" id="8357414">addr</span><span class="op" id="8357418">,</span>&nbsp;<span class="ident" id="8357420">err</span><span class="op" id="8357423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357427">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357435">}</span><br>
<span class="lineno">85</span><span class="op" id="8357437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8357440">func</span>&nbsp;<span class="ident" id="8357445">doDial</span><span class="op" id="8357451">(</span><span class="ident" id="8357452">t</span>&nbsp;<span class="op" id="8357454">*</span><span class="ident" id="8357455">testing</span><span class="op" id="8357462">.</span><span class="ident" id="8357463">T</span><span class="op" id="8357464">,</span>&nbsp;<span class="ident" id="8357466">network</span><span class="op" id="8357473">,</span>&nbsp;<span class="ident" id="8357475">addr</span>&nbsp;<span class="builtintype" id="8357480">string</span><span class="op" id="8357486">)</span>&nbsp;<span class="op" id="8357488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357491">fd</span><span class="op" id="8357493">,</span>&nbsp;<span class="ident" id="8357495">err</span>&nbsp;<span class="op" id="8357499">:=</span>&nbsp;<span class="ident" id="8357502">Dial</span><span class="op" id="8357506">(</span><span class="ident" id="8357507">network</span><span class="op" id="8357514">,</span>&nbsp;<span class="ident" id="8357516">addr</span><span class="op" id="8357520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357523">if</span>&nbsp;<span class="ident" id="8357526">err</span>&nbsp;<span class="op" id="8357530">!=</span>&nbsp;<span class="ident" id="8357533">nil</span>&nbsp;<span class="op" id="8357537">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357541">t</span><span class="op" id="8357542">.</span><span class="ident" id="8357543">Errorf</span><span class="op" id="8357549">(</span><span class="string" id="8357550">&#34;Dial(%q,&nbsp;%q,&nbsp;%q)&nbsp;=&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="8357576">,</span>&nbsp;<span class="ident" id="8357578">network</span><span class="op" id="8357585">,</span>&nbsp;<span class="string" id="8357587">&#34;&#34;</span><span class="op" id="8357589">,</span>&nbsp;<span class="ident" id="8357591">addr</span><span class="op" id="8357595">,</span>&nbsp;<span class="ident" id="8357597">err</span><span class="op" id="8357600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357604">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357615">fetchGoogle</span><span class="op" id="8357626">(</span><span class="ident" id="8357627">t</span><span class="op" id="8357628">,</span>&nbsp;<span class="ident" id="8357630">fd</span><span class="op" id="8357632">,</span>&nbsp;<span class="ident" id="8357634">network</span><span class="op" id="8357641">,</span>&nbsp;<span class="ident" id="8357643">addr</span><span class="op" id="8357647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357650">fd</span><span class="op" id="8357652">.</span><span class="ident" id="8357653">Close</span><span class="op" id="8357658">(</span><span class="op" id="8357659">)</span><br>
<span class="lineno">95</span><span class="op" id="8357661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8357664">var</span>&nbsp;<span class="ident" id="8357668">googleaddrsipv4</span>&nbsp;<span class="op" id="8357684">=</span>&nbsp;<span class="op" id="8357686">[</span><span class="op" id="8357687">]</span><span class="builtintype" id="8357688">string</span><span class="op" id="8357694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8357697">&#34;%d.%d.%d.%d:80&#34;</span><span class="op" id="8357713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8357716">&#34;www.google.com:80&#34;</span><span class="op" id="8357735">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8357738">&#34;%d.%d.%d.%d:http&#34;</span><span class="op" id="8357756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8357759">&#34;www.google.com:http&#34;</span><span class="op" id="8357780">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8357783">&#34;%03d.%03d.%03d.%03d:0080&#34;</span><span class="op" id="8357809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8357812">&#34;[::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="8357837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8357840">&#34;[::ffff:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="8357871">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8357874">&#34;[0:0:0:0:0000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="8357910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8357913">&#34;[0:0:0:0:000000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="8357951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8357954">&#34;[0:0:0:0::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="8357986">,</span><br>
<span class="lineno"></span><span class="op" id="8357988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8357991">func</span>&nbsp;<span class="ident" id="8357996">TestDialGoogleIPv4</span><span class="op" id="8358014">(</span><span class="ident" id="8358015">t</span>&nbsp;<span class="op" id="8358017">*</span><span class="ident" id="8358018">testing</span><span class="op" id="8358025">.</span><span class="ident" id="8358026">T</span><span class="op" id="8358027">)</span>&nbsp;<span class="op" id="8358029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358032">if</span>&nbsp;<span class="ident" id="8358035">testing</span><span class="op" id="8358042">.</span><span class="ident" id="8358043">Short</span><span class="op" id="8358048">(</span><span class="op" id="8358049">)</span>&nbsp;<span class="op" id="8358051">||</span>&nbsp;<span class="op" id="8358054">!</span><span class="op" id="8358055">*</span><span class="ident" id="8358056">testExternal</span>&nbsp;<span class="op" id="8358069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358073">t</span><span class="op" id="8358074">.</span><span class="ident" id="8358075">Skip</span><span class="op" id="8358079">(</span><span class="string" id="8358080">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8358121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8358128">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv4&nbsp;address&nbsp;for&nbsp;google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8358177">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358197">addrs</span><span class="op" id="8358202">,</span>&nbsp;<span class="ident" id="8358204">err</span>&nbsp;<span class="op" id="8358208">:=</span>&nbsp;<span class="ident" id="8358211">LookupIP</span><span class="op" id="8358219">(</span><span class="string" id="8358220">&#34;www.google.com&#34;</span><span class="op" id="8358236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358239">if</span>&nbsp;<span class="ident" id="8358242">err</span>&nbsp;<span class="op" id="8358246">!=</span>&nbsp;<span class="ident" id="8358249">nil</span>&nbsp;<span class="op" id="8358253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358257">t</span><span class="op" id="8358258">.</span><span class="ident" id="8358259">Fatalf</span><span class="op" id="8358265">(</span><span class="string" id="8358266">&#34;lookup&nbsp;www.google.com:&nbsp;%v&#34;</span><span class="op" id="8358293">,</span>&nbsp;<span class="ident" id="8358295">err</span><span class="op" id="8358298">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358304">var</span>&nbsp;<span class="ident" id="8358308">ip</span>&nbsp;<span class="ident" id="8358311">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358315">for</span>&nbsp;<span class="ident" id="8358319">_</span><span class="op" id="8358320">,</span>&nbsp;<span class="ident" id="8358322">addr</span>&nbsp;<span class="op" id="8358327">:=</span>&nbsp;<span class="keyword" id="8358330">range</span>&nbsp;<span class="ident" id="8358336">addrs</span>&nbsp;<span class="op" id="8358342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358346">if</span>&nbsp;<span class="ident" id="8358349">x</span>&nbsp;<span class="op" id="8358351">:=</span>&nbsp;<span class="ident" id="8358354">addr</span><span class="op" id="8358358">.</span><span class="ident" id="8358359">To4</span><span class="op" id="8358362">(</span><span class="op" id="8358363">)</span><span class="op" id="8358364">;</span>&nbsp;<span class="ident" id="8358366">x</span>&nbsp;<span class="op" id="8358368">!=</span>&nbsp;<span class="ident" id="8358371">nil</span>&nbsp;<span class="op" id="8358375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358380">ip</span>&nbsp;<span class="op" id="8358383">=</span>&nbsp;<span class="ident" id="8358385">x</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358390">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358404">if</span>&nbsp;<span class="ident" id="8358407">ip</span>&nbsp;<span class="op" id="8358410">==</span>&nbsp;<span class="ident" id="8358413">nil</span>&nbsp;<span class="op" id="8358417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358421">t</span><span class="op" id="8358422">.</span><span class="ident" id="8358423">Fatalf</span><span class="op" id="8358429">(</span><span class="string" id="8358430">&#34;no&nbsp;IPv4&nbsp;addresses&nbsp;for&nbsp;www.google.com&#34;</span><span class="op" id="8358468">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358475">for</span>&nbsp;<span class="ident" id="8358479">i</span><span class="op" id="8358480">,</span>&nbsp;<span class="ident" id="8358482">s</span>&nbsp;<span class="op" id="8358484">:=</span>&nbsp;<span class="keyword" id="8358487">range</span>&nbsp;<span class="ident" id="8358493">googleaddrsipv4</span>&nbsp;<span class="op" id="8358509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358513">if</span>&nbsp;<span class="ident" id="8358516">strings</span><span class="op" id="8358523">.</span><span class="ident" id="8358524">Contains</span><span class="op" id="8358532">(</span><span class="ident" id="8358533">s</span><span class="op" id="8358534">,</span>&nbsp;<span class="string" id="8358536">&#34;%&#34;</span><span class="op" id="8358539">)</span>&nbsp;<span class="op" id="8358541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358546">googleaddrsipv4</span><span class="op" id="8358561">[</span><span class="ident" id="8358562">i</span><span class="op" id="8358563">]</span>&nbsp;<span class="op" id="8358565">=</span>&nbsp;<span class="ident" id="8358567">fmt</span><span class="op" id="8358570">.</span><span class="ident" id="8358571">Sprintf</span><span class="op" id="8358578">(</span><span class="ident" id="8358579">s</span><span class="op" id="8358580">,</span>&nbsp;<span class="ident" id="8358582">ip</span><span class="op" id="8358584">[</span><span class="num" id="8358585">0</span><span class="op" id="8358586">]</span><span class="op" id="8358587">,</span>&nbsp;<span class="ident" id="8358589">ip</span><span class="op" id="8358591">[</span><span class="num" id="8358592">1</span><span class="op" id="8358593">]</span><span class="op" id="8358594">,</span>&nbsp;<span class="ident" id="8358596">ip</span><span class="op" id="8358598">[</span><span class="num" id="8358599">2</span><span class="op" id="8358600">]</span><span class="op" id="8358601">,</span>&nbsp;<span class="ident" id="8358603">ip</span><span class="op" id="8358605">[</span><span class="num" id="8358606">3</span><span class="op" id="8358607">]</span><span class="op" id="8358608">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358619">for</span>&nbsp;<span class="ident" id="8358623">i</span>&nbsp;<span class="op" id="8358625">:=</span>&nbsp;<span class="num" id="8358628">0</span><span class="op" id="8358629">;</span>&nbsp;<span class="ident" id="8358631">i</span>&nbsp;<span class="op" id="8358633">&lt;</span>&nbsp;<span class="builtinfunc" id="8358635">len</span><span class="op" id="8358638">(</span><span class="ident" id="8358639">googleaddrsipv4</span><span class="op" id="8358654">)</span><span class="op" id="8358655">;</span>&nbsp;<span class="ident" id="8358657">i</span><span class="op" id="8358658">++</span>&nbsp;<span class="op" id="8358661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358665">addr</span>&nbsp;<span class="op" id="8358670">:=</span>&nbsp;<span class="ident" id="8358673">googleaddrsipv4</span><span class="op" id="8358688">[</span><span class="ident" id="8358689">i</span><span class="op" id="8358690">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358694">if</span>&nbsp;<span class="ident" id="8358697">addr</span>&nbsp;<span class="op" id="8358702">==</span>&nbsp;<span class="string" id="8358705">&#34;&#34;</span>&nbsp;<span class="op" id="8358708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358713">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358728">t</span><span class="op" id="8358729">.</span><span class="ident" id="8358730">Logf</span><span class="op" id="8358734">(</span><span class="string" id="8358735">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="8358745">,</span>&nbsp;<span class="ident" id="8358747">addr</span><span class="op" id="8358751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358755">doDial</span><span class="op" id="8358761">(</span><span class="ident" id="8358762">t</span><span class="op" id="8358763">,</span>&nbsp;<span class="string" id="8358765">&#34;tcp&#34;</span><span class="op" id="8358770">,</span>&nbsp;<span class="ident" id="8358772">addr</span><span class="op" id="8358776">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358780">if</span>&nbsp;<span class="ident" id="8358783">addr</span><span class="op" id="8358787">[</span><span class="num" id="8358788">0</span><span class="op" id="8358789">]</span>&nbsp;<span class="op" id="8358791">!=</span>&nbsp;<span class="string" id="8358794">&#39;[&#39;</span>&nbsp;<span class="op" id="8358798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358803">doDial</span><span class="op" id="8358809">(</span><span class="ident" id="8358810">t</span><span class="op" id="8358811">,</span>&nbsp;<span class="string" id="8358813">&#34;tcp4&#34;</span><span class="op" id="8358819">,</span>&nbsp;<span class="ident" id="8358821">addr</span><span class="op" id="8358825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358830">if</span>&nbsp;<span class="ident" id="8358833">supportsIPv6</span>&nbsp;<span class="op" id="8358846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8358852">//&nbsp;make&nbsp;sure&nbsp;syscall.SocketDisableIPv6&nbsp;flag&nbsp;works.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358907">syscall</span><span class="op" id="8358914">.</span><span class="ident" id="8358915">SocketDisableIPv6</span>&nbsp;<span class="op" id="8358933">=</span>&nbsp;<span class="builtintype" id="8358935">true</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358944">doDial</span><span class="op" id="8358950">(</span><span class="ident" id="8358951">t</span><span class="op" id="8358952">,</span>&nbsp;<span class="string" id="8358954">&#34;tcp&#34;</span><span class="op" id="8358959">,</span>&nbsp;<span class="ident" id="8358961">addr</span><span class="op" id="8358965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358971">doDial</span><span class="op" id="8358977">(</span><span class="ident" id="8358978">t</span><span class="op" id="8358979">,</span>&nbsp;<span class="string" id="8358981">&#34;tcp4&#34;</span><span class="op" id="8358987">,</span>&nbsp;<span class="ident" id="8358989">addr</span><span class="op" id="8358993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358999">syscall</span><span class="op" id="8359006">.</span><span class="ident" id="8359007">SocketDisableIPv6</span>&nbsp;<span class="op" id="8359025">=</span>&nbsp;<span class="builtintype" id="8359027">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359040">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359043">}</span><br>
<span class="lineno"></span><span class="op" id="8359045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8359048">var</span>&nbsp;<span class="ident" id="8359052">googleaddrsipv6</span>&nbsp;<span class="op" id="8359068">=</span>&nbsp;<span class="op" id="8359070">[</span><span class="op" id="8359071">]</span><span class="builtintype" id="8359072">string</span><span class="op" id="8359078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8359081">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="8359159">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8359162">&#34;ipv6.google.com:80&#34;</span><span class="op" id="8359182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8359185">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:http&#34;</span><span class="op" id="8359265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8359268">&#34;ipv6.google.com:http&#34;</span><span class="op" id="8359290">,</span><br>
<span class="lineno"></span><span class="op" id="8359292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="8359295">func</span>&nbsp;<span class="ident" id="8359300">TestDialGoogleIPv6</span><span class="op" id="8359318">(</span><span class="ident" id="8359319">t</span>&nbsp;<span class="op" id="8359321">*</span><span class="ident" id="8359322">testing</span><span class="op" id="8359329">.</span><span class="ident" id="8359330">T</span><span class="op" id="8359331">)</span>&nbsp;<span class="op" id="8359333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359336">if</span>&nbsp;<span class="ident" id="8359339">testing</span><span class="op" id="8359346">.</span><span class="ident" id="8359347">Short</span><span class="op" id="8359352">(</span><span class="op" id="8359353">)</span>&nbsp;<span class="op" id="8359355">||</span>&nbsp;<span class="op" id="8359358">!</span><span class="op" id="8359359">*</span><span class="ident" id="8359360">testExternal</span>&nbsp;<span class="op" id="8359373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359377">t</span><span class="op" id="8359378">.</span><span class="ident" id="8359379">Skip</span><span class="op" id="8359383">(</span><span class="string" id="8359384">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8359425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8359431">//&nbsp;Only&nbsp;run&nbsp;tcp6&nbsp;if&nbsp;the&nbsp;kernel&nbsp;will&nbsp;take&nbsp;it.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359477">if</span>&nbsp;<span class="op" id="8359480">!</span><span class="ident" id="8359481">supportsIPv6</span>&nbsp;<span class="op" id="8359494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359498">t</span><span class="op" id="8359499">.</span><span class="ident" id="8359500">Skip</span><span class="op" id="8359504">(</span><span class="string" id="8359505">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8359543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359549">if</span>&nbsp;<span class="op" id="8359552">!</span><span class="op" id="8359553">*</span><span class="ident" id="8359554">testIPv6</span>&nbsp;<span class="op" id="8359563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359567">t</span><span class="op" id="8359568">.</span><span class="ident" id="8359569">Skip</span><span class="op" id="8359573">(</span><span class="string" id="8359574">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="8359610">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8359617">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv6&nbsp;address&nbsp;for&nbsp;ipv6.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8359671">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359691">addrs</span><span class="op" id="8359696">,</span>&nbsp;<span class="ident" id="8359698">err</span>&nbsp;<span class="op" id="8359702">:=</span>&nbsp;<span class="ident" id="8359705">LookupIP</span><span class="op" id="8359713">(</span><span class="string" id="8359714">&#34;ipv6.google.com&#34;</span><span class="op" id="8359731">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359734">if</span>&nbsp;<span class="ident" id="8359737">err</span>&nbsp;<span class="op" id="8359741">!=</span>&nbsp;<span class="ident" id="8359744">nil</span>&nbsp;<span class="op" id="8359748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359752">t</span><span class="op" id="8359753">.</span><span class="ident" id="8359754">Fatalf</span><span class="op" id="8359760">(</span><span class="string" id="8359761">&#34;lookup&nbsp;ipv6.google.com:&nbsp;%v&#34;</span><span class="op" id="8359789">,</span>&nbsp;<span class="ident" id="8359791">err</span><span class="op" id="8359794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359800">var</span>&nbsp;<span class="ident" id="8359804">ip</span>&nbsp;<span class="ident" id="8359807">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359811">for</span>&nbsp;<span class="ident" id="8359815">_</span><span class="op" id="8359816">,</span>&nbsp;<span class="ident" id="8359818">addr</span>&nbsp;<span class="op" id="8359823">:=</span>&nbsp;<span class="keyword" id="8359826">range</span>&nbsp;<span class="ident" id="8359832">addrs</span>&nbsp;<span class="op" id="8359838">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359842">if</span>&nbsp;<span class="ident" id="8359845">x</span>&nbsp;<span class="op" id="8359847">:=</span>&nbsp;<span class="ident" id="8359850">addr</span><span class="op" id="8359854">.</span><span class="ident" id="8359855">To16</span><span class="op" id="8359859">(</span><span class="op" id="8359860">)</span><span class="op" id="8359861">;</span>&nbsp;<span class="ident" id="8359863">x</span>&nbsp;<span class="op" id="8359865">!=</span>&nbsp;<span class="ident" id="8359868">nil</span>&nbsp;<span class="op" id="8359872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359877">ip</span>&nbsp;<span class="op" id="8359880">=</span>&nbsp;<span class="ident" id="8359882">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359887">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359898">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359901">if</span>&nbsp;<span class="ident" id="8359904">ip</span>&nbsp;<span class="op" id="8359907">==</span>&nbsp;<span class="ident" id="8359910">nil</span>&nbsp;<span class="op" id="8359914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359918">t</span><span class="op" id="8359919">.</span><span class="ident" id="8359920">Fatalf</span><span class="op" id="8359926">(</span><span class="string" id="8359927">&#34;no&nbsp;IPv6&nbsp;addresses&nbsp;for&nbsp;ipv6.google.com&#34;</span><span class="op" id="8359966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359973">for</span>&nbsp;<span class="ident" id="8359977">i</span><span class="op" id="8359978">,</span>&nbsp;<span class="ident" id="8359980">s</span>&nbsp;<span class="op" id="8359982">:=</span>&nbsp;<span class="keyword" id="8359985">range</span>&nbsp;<span class="ident" id="8359991">googleaddrsipv6</span>&nbsp;<span class="op" id="8360007">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360011">if</span>&nbsp;<span class="ident" id="8360014">strings</span><span class="op" id="8360021">.</span><span class="ident" id="8360022">Contains</span><span class="op" id="8360030">(</span><span class="ident" id="8360031">s</span><span class="op" id="8360032">,</span>&nbsp;<span class="string" id="8360034">&#34;%&#34;</span><span class="op" id="8360037">)</span>&nbsp;<span class="op" id="8360039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360044">googleaddrsipv6</span><span class="op" id="8360059">[</span><span class="ident" id="8360060">i</span><span class="op" id="8360061">]</span>&nbsp;<span class="op" id="8360063">=</span>&nbsp;<span class="ident" id="8360065">fmt</span><span class="op" id="8360068">.</span><span class="ident" id="8360069">Sprintf</span><span class="op" id="8360076">(</span><span class="ident" id="8360077">s</span><span class="op" id="8360078">,</span>&nbsp;<span class="ident" id="8360080">ip</span><span class="op" id="8360082">[</span><span class="num" id="8360083">0</span><span class="op" id="8360084">]</span><span class="op" id="8360085">,</span>&nbsp;<span class="ident" id="8360087">ip</span><span class="op" id="8360089">[</span><span class="num" id="8360090">1</span><span class="op" id="8360091">]</span><span class="op" id="8360092">,</span>&nbsp;<span class="ident" id="8360094">ip</span><span class="op" id="8360096">[</span><span class="num" id="8360097">2</span><span class="op" id="8360098">]</span><span class="op" id="8360099">,</span>&nbsp;<span class="ident" id="8360101">ip</span><span class="op" id="8360103">[</span><span class="num" id="8360104">3</span><span class="op" id="8360105">]</span><span class="op" id="8360106">,</span>&nbsp;<span class="ident" id="8360108">ip</span><span class="op" id="8360110">[</span><span class="num" id="8360111">4</span><span class="op" id="8360112">]</span><span class="op" id="8360113">,</span>&nbsp;<span class="ident" id="8360115">ip</span><span class="op" id="8360117">[</span><span class="num" id="8360118">5</span><span class="op" id="8360119">]</span><span class="op" id="8360120">,</span>&nbsp;<span class="ident" id="8360122">ip</span><span class="op" id="8360124">[</span><span class="num" id="8360125">6</span><span class="op" id="8360126">]</span><span class="op" id="8360127">,</span>&nbsp;<span class="ident" id="8360129">ip</span><span class="op" id="8360131">[</span><span class="num" id="8360132">7</span><span class="op" id="8360133">]</span><span class="op" id="8360134">,</span>&nbsp;<span class="ident" id="8360136">ip</span><span class="op" id="8360138">[</span><span class="num" id="8360139">8</span><span class="op" id="8360140">]</span><span class="op" id="8360141">,</span>&nbsp;<span class="ident" id="8360143">ip</span><span class="op" id="8360145">[</span><span class="num" id="8360146">9</span><span class="op" id="8360147">]</span><span class="op" id="8360148">,</span>&nbsp;<span class="ident" id="8360150">ip</span><span class="op" id="8360152">[</span><span class="num" id="8360153">10</span><span class="op" id="8360155">]</span><span class="op" id="8360156">,</span>&nbsp;<span class="ident" id="8360158">ip</span><span class="op" id="8360160">[</span><span class="num" id="8360161">11</span><span class="op" id="8360163">]</span><span class="op" id="8360164">,</span>&nbsp;<span class="ident" id="8360166">ip</span><span class="op" id="8360168">[</span><span class="num" id="8360169">12</span><span class="op" id="8360171">]</span><span class="op" id="8360172">,</span>&nbsp;<span class="ident" id="8360174">ip</span><span class="op" id="8360176">[</span><span class="num" id="8360177">13</span><span class="op" id="8360179">]</span><span class="op" id="8360180">,</span>&nbsp;<span class="ident" id="8360182">ip</span><span class="op" id="8360184">[</span><span class="num" id="8360185">14</span><span class="op" id="8360187">]</span><span class="op" id="8360188">,</span>&nbsp;<span class="ident" id="8360190">ip</span><span class="op" id="8360192">[</span><span class="num" id="8360193">15</span><span class="op" id="8360195">]</span><span class="op" id="8360196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360207">for</span>&nbsp;<span class="ident" id="8360211">i</span>&nbsp;<span class="op" id="8360213">:=</span>&nbsp;<span class="num" id="8360216">0</span><span class="op" id="8360217">;</span>&nbsp;<span class="ident" id="8360219">i</span>&nbsp;<span class="op" id="8360221">&lt;</span>&nbsp;<span class="builtinfunc" id="8360223">len</span><span class="op" id="8360226">(</span><span class="ident" id="8360227">googleaddrsipv6</span><span class="op" id="8360242">)</span><span class="op" id="8360243">;</span>&nbsp;<span class="ident" id="8360245">i</span><span class="op" id="8360246">++</span>&nbsp;<span class="op" id="8360249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360253">addr</span>&nbsp;<span class="op" id="8360258">:=</span>&nbsp;<span class="ident" id="8360261">googleaddrsipv6</span><span class="op" id="8360276">[</span><span class="ident" id="8360277">i</span><span class="op" id="8360278">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360282">if</span>&nbsp;<span class="ident" id="8360285">addr</span>&nbsp;<span class="op" id="8360290">==</span>&nbsp;<span class="string" id="8360293">&#34;&#34;</span>&nbsp;<span class="op" id="8360296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360301">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360312">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360316">t</span><span class="op" id="8360317">.</span><span class="ident" id="8360318">Logf</span><span class="op" id="8360322">(</span><span class="string" id="8360323">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="8360333">,</span>&nbsp;<span class="ident" id="8360335">addr</span><span class="op" id="8360339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360343">doDial</span><span class="op" id="8360349">(</span><span class="ident" id="8360350">t</span><span class="op" id="8360351">,</span>&nbsp;<span class="string" id="8360353">&#34;tcp&#34;</span><span class="op" id="8360358">,</span>&nbsp;<span class="ident" id="8360360">addr</span><span class="op" id="8360364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360368">doDial</span><span class="op" id="8360374">(</span><span class="ident" id="8360375">t</span><span class="op" id="8360376">,</span>&nbsp;<span class="string" id="8360378">&#34;tcp6&#34;</span><span class="op" id="8360384">,</span>&nbsp;<span class="ident" id="8360386">addr</span><span class="op" id="8360390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360393">}</span><br>
<span class="lineno"></span><span class="op" id="8360395">}</span>
</div>
</body>
</html>
