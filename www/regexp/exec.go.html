<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5160110">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5160165">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5160219">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5160270">package</span>&nbsp;<span class="ident" id="5160278">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5160286">import</span>&nbsp;<span class="op" id="5160293">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5160296">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5160302">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5160318">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5160321">//&nbsp;A&nbsp;queue&nbsp;is&nbsp;a&nbsp;&#39;sparse&nbsp;array&#39;&nbsp;holding&nbsp;pending&nbsp;threads&nbsp;of&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="5160390">//&nbsp;See&nbsp;http://research.swtch.com/2008/03/using-uninitialized-memory-for-fun-and.html</span><br>
<span class="lineno"></span><span class="keyword" id="5160475">type</span>&nbsp;<span class="ident" id="5160480">queue</span>&nbsp;<span class="keyword" id="5160486">struct</span>&nbsp;<span class="op" id="5160493">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160496">sparse</span>&nbsp;<span class="op" id="5160503">[</span><span class="op" id="5160504">]</span><span class="builtintype" id="5160505">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160513">dense</span>&nbsp;&nbsp;<span class="op" id="5160520">[</span><span class="op" id="5160521">]</span><span class="ident" id="5160522">entry</span><br>
<span class="lineno"></span><span class="op" id="5160528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5160531">//&nbsp;A&nbsp;entry&nbsp;is&nbsp;an&nbsp;entry&nbsp;on&nbsp;a&nbsp;queue.</span><br>
<span class="lineno">20</span><span class="comment" id="5160566">//&nbsp;It&nbsp;holds&nbsp;both&nbsp;the&nbsp;instruction&nbsp;pc&nbsp;and&nbsp;the&nbsp;actual&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="5160625">//&nbsp;Some&nbsp;queue&nbsp;entries&nbsp;are&nbsp;just&nbsp;place&nbsp;holders&nbsp;so&nbsp;that&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="5160690">//&nbsp;knows&nbsp;it&nbsp;has&nbsp;considered&nbsp;that&nbsp;pc.&nbsp;&nbsp;Such&nbsp;entries&nbsp;have&nbsp;t&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5160755">type</span>&nbsp;<span class="ident" id="5160760">entry</span>&nbsp;<span class="keyword" id="5160766">struct</span>&nbsp;<span class="op" id="5160773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160776">pc</span>&nbsp;<span class="builtintype" id="5160779">uint32</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160787">t</span>&nbsp;&nbsp;<span class="op" id="5160790">*</span><span class="ident" id="5160791">thread</span><br>
<span class="lineno"></span><span class="op" id="5160798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5160801">//&nbsp;A&nbsp;thread&nbsp;is&nbsp;the&nbsp;state&nbsp;of&nbsp;a&nbsp;single&nbsp;path&nbsp;through&nbsp;the&nbsp;machine:</span><br>
<span class="lineno"></span><span class="comment" id="5160864">//&nbsp;an&nbsp;instruction&nbsp;and&nbsp;a&nbsp;corresponding&nbsp;capture&nbsp;array.</span><br>
<span class="lineno">30</span><span class="comment" id="5160917">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html</span><br>
<span class="lineno"></span><span class="keyword" id="5160966">type</span>&nbsp;<span class="ident" id="5160971">thread</span>&nbsp;<span class="keyword" id="5160978">struct</span>&nbsp;<span class="op" id="5160985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160988">inst</span>&nbsp;<span class="op" id="5160993">*</span><span class="ident" id="5160994">syntax</span><span class="op" id="5161000">.</span><span class="ident" id="5161001">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5161007">cap</span>&nbsp;&nbsp;<span class="op" id="5161012">[</span><span class="op" id="5161013">]</span><span class="builtintype" id="5161014">int</span><br>
<span class="lineno"></span><span class="op" id="5161018">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="5161021">//&nbsp;A&nbsp;machine&nbsp;holds&nbsp;all&nbsp;the&nbsp;state&nbsp;during&nbsp;an&nbsp;NFA&nbsp;simulation&nbsp;for&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5161086">type</span>&nbsp;<span class="ident" id="5161091">machine</span>&nbsp;<span class="keyword" id="5161099">struct</span>&nbsp;<span class="op" id="5161106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161109">re</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5161118">*</span><span class="ident" id="5161119">Regexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5161131">//&nbsp;corresponding&nbsp;Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161156">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5161165">*</span><span class="ident" id="5161166">syntax</span><span class="op" id="5161172">.</span><span class="ident" id="5161173">Prog</span>&nbsp;<span class="comment" id="5161178">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161199">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5161208">*</span><span class="ident" id="5161209">onePassProg</span>&nbsp;<span class="comment" id="5161221">//&nbsp;compiled&nbsp;onepass&nbsp;program,&nbsp;or&nbsp;notOnePass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161265">q0</span><span class="op" id="5161267">,</span>&nbsp;<span class="ident" id="5161269">q1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5161274">queue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5161287">//&nbsp;two&nbsp;queues&nbsp;for&nbsp;runq,&nbsp;nextq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161318">pool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5161327">[</span><span class="op" id="5161328">]</span><span class="op" id="5161329">*</span><span class="ident" id="5161330">thread</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5161340">//&nbsp;pool&nbsp;of&nbsp;available&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161370">matched</span>&nbsp;&nbsp;<span class="builtintype" id="5161379">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5161392">//&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161422">matchcap</span>&nbsp;<span class="op" id="5161431">[</span><span class="op" id="5161432">]</span><span class="builtintype" id="5161433">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5161444">//&nbsp;capture&nbsp;information&nbsp;for&nbsp;the&nbsp;match</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5161483">//&nbsp;cached&nbsp;inputs,&nbsp;to&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161522">inputBytes</span>&nbsp;&nbsp;<span class="ident" id="5161534">inputBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161546">inputString</span>&nbsp;<span class="ident" id="5161558">inputString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161571">inputReader</span>&nbsp;<span class="ident" id="5161583">inputReader</span><br>
<span class="lineno">50</span><span class="op" id="5161595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5161598">func</span>&nbsp;<span class="op" id="5161603">(</span><span class="ident" id="5161604">m</span>&nbsp;<span class="op" id="5161606">*</span><span class="ident" id="5161607">machine</span><span class="op" id="5161614">)</span>&nbsp;<span class="ident" id="5161616">newInputBytes</span><span class="op" id="5161629">(</span><span class="ident" id="5161630">b</span>&nbsp;<span class="op" id="5161632">[</span><span class="op" id="5161633">]</span><span class="builtintype" id="5161634">byte</span><span class="op" id="5161638">)</span>&nbsp;<span class="ident" id="5161640">input</span>&nbsp;<span class="op" id="5161646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161649">m</span><span class="op" id="5161650">.</span><span class="ident" id="5161651">inputBytes</span><span class="op" id="5161661">.</span><span class="ident" id="5161662">str</span>&nbsp;<span class="op" id="5161666">=</span>&nbsp;<span class="ident" id="5161668">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5161671">return</span>&nbsp;<span class="op" id="5161678">&amp;</span><span class="ident" id="5161679">m</span><span class="op" id="5161680">.</span><span class="ident" id="5161681">inputBytes</span><br>
<span class="lineno">55</span><span class="op" id="5161692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5161695">func</span>&nbsp;<span class="op" id="5161700">(</span><span class="ident" id="5161701">m</span>&nbsp;<span class="op" id="5161703">*</span><span class="ident" id="5161704">machine</span><span class="op" id="5161711">)</span>&nbsp;<span class="ident" id="5161713">newInputString</span><span class="op" id="5161727">(</span><span class="ident" id="5161728">s</span>&nbsp;<span class="builtintype" id="5161730">string</span><span class="op" id="5161736">)</span>&nbsp;<span class="ident" id="5161738">input</span>&nbsp;<span class="op" id="5161744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161747">m</span><span class="op" id="5161748">.</span><span class="ident" id="5161749">inputString</span><span class="op" id="5161760">.</span><span class="ident" id="5161761">str</span>&nbsp;<span class="op" id="5161765">=</span>&nbsp;<span class="ident" id="5161767">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5161770">return</span>&nbsp;<span class="op" id="5161777">&amp;</span><span class="ident" id="5161778">m</span><span class="op" id="5161779">.</span><span class="ident" id="5161780">inputString</span><br>
<span class="lineno">60</span><span class="op" id="5161792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5161795">func</span>&nbsp;<span class="op" id="5161800">(</span><span class="ident" id="5161801">m</span>&nbsp;<span class="op" id="5161803">*</span><span class="ident" id="5161804">machine</span><span class="op" id="5161811">)</span>&nbsp;<span class="ident" id="5161813">newInputReader</span><span class="op" id="5161827">(</span><span class="ident" id="5161828">r</span>&nbsp;<span class="ident" id="5161830">io</span><span class="op" id="5161832">.</span><span class="ident" id="5161833">RuneReader</span><span class="op" id="5161843">)</span>&nbsp;<span class="ident" id="5161845">input</span>&nbsp;<span class="op" id="5161851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161854">m</span><span class="op" id="5161855">.</span><span class="ident" id="5161856">inputReader</span><span class="op" id="5161867">.</span><span class="ident" id="5161868">r</span>&nbsp;<span class="op" id="5161870">=</span>&nbsp;<span class="ident" id="5161872">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161875">m</span><span class="op" id="5161876">.</span><span class="ident" id="5161877">inputReader</span><span class="op" id="5161888">.</span><span class="ident" id="5161889">atEOT</span>&nbsp;<span class="op" id="5161895">=</span>&nbsp;<span class="ident" id="5161897">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161904">m</span><span class="op" id="5161905">.</span><span class="ident" id="5161906">inputReader</span><span class="op" id="5161917">.</span><span class="ident" id="5161918">pos</span>&nbsp;<span class="op" id="5161922">=</span>&nbsp;<span class="num" id="5161924">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5161927">return</span>&nbsp;<span class="op" id="5161934">&amp;</span><span class="ident" id="5161935">m</span><span class="op" id="5161936">.</span><span class="ident" id="5161937">inputReader</span><br>
<span class="lineno"></span><span class="op" id="5161949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5161952">//&nbsp;progMachine&nbsp;returns&nbsp;a&nbsp;new&nbsp;machine&nbsp;running&nbsp;the&nbsp;prog&nbsp;p.</span><br>
<span class="lineno">70</span><span class="keyword" id="5162009">func</span>&nbsp;<span class="ident" id="5162014">progMachine</span><span class="op" id="5162025">(</span><span class="ident" id="5162026">p</span>&nbsp;<span class="op" id="5162028">*</span><span class="ident" id="5162029">syntax</span><span class="op" id="5162035">.</span><span class="ident" id="5162036">Prog</span><span class="op" id="5162040">,</span>&nbsp;<span class="ident" id="5162042">op</span>&nbsp;<span class="op" id="5162045">*</span><span class="ident" id="5162046">onePassProg</span><span class="op" id="5162057">)</span>&nbsp;<span class="op" id="5162059">*</span><span class="ident" id="5162060">machine</span>&nbsp;<span class="op" id="5162068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162071">m</span>&nbsp;<span class="op" id="5162073">:=</span>&nbsp;<span class="op" id="5162076">&amp;</span><span class="ident" id="5162077">machine</span><span class="op" id="5162084">{</span><span class="ident" id="5162085">p</span><span class="op" id="5162086">:</span>&nbsp;<span class="ident" id="5162088">p</span><span class="op" id="5162089">,</span>&nbsp;<span class="ident" id="5162091">op</span><span class="op" id="5162093">:</span>&nbsp;<span class="ident" id="5162095">op</span><span class="op" id="5162097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162100">n</span>&nbsp;<span class="op" id="5162102">:=</span>&nbsp;<span class="builtinfunc" id="5162105">len</span><span class="op" id="5162108">(</span><span class="ident" id="5162109">m</span><span class="op" id="5162110">.</span><span class="ident" id="5162111">p</span><span class="op" id="5162112">.</span><span class="ident" id="5162113">Inst</span><span class="op" id="5162117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162120">m</span><span class="op" id="5162121">.</span><span class="ident" id="5162122">q0</span>&nbsp;<span class="op" id="5162125">=</span>&nbsp;<span class="ident" id="5162127">queue</span><span class="op" id="5162132">{</span><span class="builtinfunc" id="5162133">make</span><span class="op" id="5162137">(</span><span class="op" id="5162138">[</span><span class="op" id="5162139">]</span><span class="builtintype" id="5162140">uint32</span><span class="op" id="5162146">,</span>&nbsp;<span class="ident" id="5162148">n</span><span class="op" id="5162149">)</span><span class="op" id="5162150">,</span>&nbsp;<span class="builtinfunc" id="5162152">make</span><span class="op" id="5162156">(</span><span class="op" id="5162157">[</span><span class="op" id="5162158">]</span><span class="ident" id="5162159">entry</span><span class="op" id="5162164">,</span>&nbsp;<span class="num" id="5162166">0</span><span class="op" id="5162167">,</span>&nbsp;<span class="ident" id="5162169">n</span><span class="op" id="5162170">)</span><span class="op" id="5162171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162174">m</span><span class="op" id="5162175">.</span><span class="ident" id="5162176">q1</span>&nbsp;<span class="op" id="5162179">=</span>&nbsp;<span class="ident" id="5162181">queue</span><span class="op" id="5162186">{</span><span class="builtinfunc" id="5162187">make</span><span class="op" id="5162191">(</span><span class="op" id="5162192">[</span><span class="op" id="5162193">]</span><span class="builtintype" id="5162194">uint32</span><span class="op" id="5162200">,</span>&nbsp;<span class="ident" id="5162202">n</span><span class="op" id="5162203">)</span><span class="op" id="5162204">,</span>&nbsp;<span class="builtinfunc" id="5162206">make</span><span class="op" id="5162210">(</span><span class="op" id="5162211">[</span><span class="op" id="5162212">]</span><span class="ident" id="5162213">entry</span><span class="op" id="5162218">,</span>&nbsp;<span class="num" id="5162220">0</span><span class="op" id="5162221">,</span>&nbsp;<span class="ident" id="5162223">n</span><span class="op" id="5162224">)</span><span class="op" id="5162225">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162228">ncap</span>&nbsp;<span class="op" id="5162233">:=</span>&nbsp;<span class="ident" id="5162236">p</span><span class="op" id="5162237">.</span><span class="ident" id="5162238">NumCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5162246">if</span>&nbsp;<span class="ident" id="5162249">ncap</span>&nbsp;<span class="op" id="5162254">&lt;</span>&nbsp;<span class="num" id="5162256">2</span>&nbsp;<span class="op" id="5162258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162262">ncap</span>&nbsp;<span class="op" id="5162267">=</span>&nbsp;<span class="num" id="5162269">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5162272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162275">m</span><span class="op" id="5162276">.</span><span class="ident" id="5162277">matchcap</span>&nbsp;<span class="op" id="5162286">=</span>&nbsp;<span class="builtinfunc" id="5162288">make</span><span class="op" id="5162292">(</span><span class="op" id="5162293">[</span><span class="op" id="5162294">]</span><span class="builtintype" id="5162295">int</span><span class="op" id="5162298">,</span>&nbsp;<span class="ident" id="5162300">ncap</span><span class="op" id="5162304">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5162307">return</span>&nbsp;<span class="ident" id="5162314">m</span><br>
<span class="lineno"></span><span class="op" id="5162316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5162319">func</span>&nbsp;<span class="op" id="5162324">(</span><span class="ident" id="5162325">m</span>&nbsp;<span class="op" id="5162327">*</span><span class="ident" id="5162328">machine</span><span class="op" id="5162335">)</span>&nbsp;<span class="ident" id="5162337">init</span><span class="op" id="5162341">(</span><span class="ident" id="5162342">ncap</span>&nbsp;<span class="builtintype" id="5162347">int</span><span class="op" id="5162350">)</span>&nbsp;<span class="op" id="5162352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5162355">for</span>&nbsp;<span class="ident" id="5162359">_</span><span class="op" id="5162360">,</span>&nbsp;<span class="ident" id="5162362">t</span>&nbsp;<span class="op" id="5162364">:=</span>&nbsp;<span class="keyword" id="5162367">range</span>&nbsp;<span class="ident" id="5162373">m</span><span class="op" id="5162374">.</span><span class="ident" id="5162375">pool</span>&nbsp;<span class="op" id="5162380">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162384">t</span><span class="op" id="5162385">.</span><span class="builtinfunc" id="5162386">cap</span>&nbsp;<span class="op" id="5162390">=</span>&nbsp;<span class="ident" id="5162392">t</span><span class="op" id="5162393">.</span><span class="builtinfunc" id="5162394">cap</span><span class="op" id="5162397">[</span><span class="op" id="5162398">:</span><span class="ident" id="5162399">ncap</span><span class="op" id="5162403">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5162406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162409">m</span><span class="op" id="5162410">.</span><span class="ident" id="5162411">matchcap</span>&nbsp;<span class="op" id="5162420">=</span>&nbsp;<span class="ident" id="5162422">m</span><span class="op" id="5162423">.</span><span class="ident" id="5162424">matchcap</span><span class="op" id="5162432">[</span><span class="op" id="5162433">:</span><span class="ident" id="5162434">ncap</span><span class="op" id="5162438">]</span><br>
<span class="lineno"></span><span class="op" id="5162440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5162443">//&nbsp;alloc&nbsp;allocates&nbsp;a&nbsp;new&nbsp;thread&nbsp;with&nbsp;the&nbsp;given&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="5162503">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;free&nbsp;pool&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="5162541">func</span>&nbsp;<span class="op" id="5162546">(</span><span class="ident" id="5162547">m</span>&nbsp;<span class="op" id="5162549">*</span><span class="ident" id="5162550">machine</span><span class="op" id="5162557">)</span>&nbsp;<span class="ident" id="5162559">alloc</span><span class="op" id="5162564">(</span><span class="ident" id="5162565">i</span>&nbsp;<span class="op" id="5162567">*</span><span class="ident" id="5162568">syntax</span><span class="op" id="5162574">.</span><span class="ident" id="5162575">Inst</span><span class="op" id="5162579">)</span>&nbsp;<span class="op" id="5162581">*</span><span class="ident" id="5162582">thread</span>&nbsp;<span class="op" id="5162589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5162592">var</span>&nbsp;<span class="ident" id="5162596">t</span>&nbsp;<span class="op" id="5162598">*</span><span class="ident" id="5162599">thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5162607">if</span>&nbsp;<span class="ident" id="5162610">n</span>&nbsp;<span class="op" id="5162612">:=</span>&nbsp;<span class="builtinfunc" id="5162615">len</span><span class="op" id="5162618">(</span><span class="ident" id="5162619">m</span><span class="op" id="5162620">.</span><span class="ident" id="5162621">pool</span><span class="op" id="5162625">)</span><span class="op" id="5162626">;</span>&nbsp;<span class="ident" id="5162628">n</span>&nbsp;<span class="op" id="5162630">&gt;</span>&nbsp;<span class="num" id="5162632">0</span>&nbsp;<span class="op" id="5162634">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162638">t</span>&nbsp;<span class="op" id="5162640">=</span>&nbsp;<span class="ident" id="5162642">m</span><span class="op" id="5162643">.</span><span class="ident" id="5162644">pool</span><span class="op" id="5162648">[</span><span class="ident" id="5162649">n</span><span class="op" id="5162650">-</span><span class="num" id="5162651">1</span><span class="op" id="5162652">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162656">m</span><span class="op" id="5162657">.</span><span class="ident" id="5162658">pool</span>&nbsp;<span class="op" id="5162663">=</span>&nbsp;<span class="ident" id="5162665">m</span><span class="op" id="5162666">.</span><span class="ident" id="5162667">pool</span><span class="op" id="5162671">[</span><span class="op" id="5162672">:</span><span class="ident" id="5162673">n</span><span class="op" id="5162674">-</span><span class="num" id="5162675">1</span><span class="op" id="5162676">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5162679">}</span>&nbsp;<span class="keyword" id="5162681">else</span>&nbsp;<span class="op" id="5162686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162690">t</span>&nbsp;<span class="op" id="5162692">=</span>&nbsp;<span class="builtinfunc" id="5162694">new</span><span class="op" id="5162697">(</span><span class="ident" id="5162698">thread</span><span class="op" id="5162704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162708">t</span><span class="op" id="5162709">.</span><span class="builtinfunc" id="5162710">cap</span>&nbsp;<span class="op" id="5162714">=</span>&nbsp;<span class="builtinfunc" id="5162716">make</span><span class="op" id="5162720">(</span><span class="op" id="5162721">[</span><span class="op" id="5162722">]</span><span class="builtintype" id="5162723">int</span><span class="op" id="5162726">,</span>&nbsp;<span class="builtinfunc" id="5162728">len</span><span class="op" id="5162731">(</span><span class="ident" id="5162732">m</span><span class="op" id="5162733">.</span><span class="ident" id="5162734">matchcap</span><span class="op" id="5162742">)</span><span class="op" id="5162743">,</span>&nbsp;<span class="builtinfunc" id="5162745">cap</span><span class="op" id="5162748">(</span><span class="ident" id="5162749">m</span><span class="op" id="5162750">.</span><span class="ident" id="5162751">matchcap</span><span class="op" id="5162759">)</span><span class="op" id="5162760">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5162763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162766">t</span><span class="op" id="5162767">.</span><span class="ident" id="5162768">inst</span>&nbsp;<span class="op" id="5162773">=</span>&nbsp;<span class="ident" id="5162775">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5162778">return</span>&nbsp;<span class="ident" id="5162785">t</span><br>
<span class="lineno"></span><span class="op" id="5162787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5162790">//&nbsp;free&nbsp;returns&nbsp;t&nbsp;to&nbsp;the&nbsp;free&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="5162826">func</span>&nbsp;<span class="op" id="5162831">(</span><span class="ident" id="5162832">m</span>&nbsp;<span class="op" id="5162834">*</span><span class="ident" id="5162835">machine</span><span class="op" id="5162842">)</span>&nbsp;<span class="ident" id="5162844">free</span><span class="op" id="5162848">(</span><span class="ident" id="5162849">t</span>&nbsp;<span class="op" id="5162851">*</span><span class="ident" id="5162852">thread</span><span class="op" id="5162858">)</span>&nbsp;<span class="op" id="5162860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162863">m</span><span class="op" id="5162864">.</span><span class="ident" id="5162865">inputBytes</span><span class="op" id="5162875">.</span><span class="ident" id="5162876">str</span>&nbsp;<span class="op" id="5162880">=</span>&nbsp;<span class="ident" id="5162882">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162887">m</span><span class="op" id="5162888">.</span><span class="ident" id="5162889">inputString</span><span class="op" id="5162900">.</span><span class="ident" id="5162901">str</span>&nbsp;<span class="op" id="5162905">=</span>&nbsp;<span class="string" id="5162907">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162911">m</span><span class="op" id="5162912">.</span><span class="ident" id="5162913">inputReader</span><span class="op" id="5162924">.</span><span class="ident" id="5162925">r</span>&nbsp;<span class="op" id="5162927">=</span>&nbsp;<span class="ident" id="5162929">nil</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5162934">m</span><span class="op" id="5162935">.</span><span class="ident" id="5162936">pool</span>&nbsp;<span class="op" id="5162941">=</span>&nbsp;<span class="builtinfunc" id="5162943">append</span><span class="op" id="5162949">(</span><span class="ident" id="5162950">m</span><span class="op" id="5162951">.</span><span class="ident" id="5162952">pool</span><span class="op" id="5162956">,</span>&nbsp;<span class="ident" id="5162958">t</span><span class="op" id="5162959">)</span><br>
<span class="lineno"></span><span class="op" id="5162961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5162964">//&nbsp;match&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5163022">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno">115</span><span class="comment" id="5163063">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5163116">func</span>&nbsp;<span class="op" id="5163121">(</span><span class="ident" id="5163122">m</span>&nbsp;<span class="op" id="5163124">*</span><span class="ident" id="5163125">machine</span><span class="op" id="5163132">)</span>&nbsp;<span class="ident" id="5163134">match</span><span class="op" id="5163139">(</span><span class="ident" id="5163140">i</span>&nbsp;<span class="ident" id="5163142">input</span><span class="op" id="5163147">,</span>&nbsp;<span class="ident" id="5163149">pos</span>&nbsp;<span class="builtintype" id="5163153">int</span><span class="op" id="5163156">)</span>&nbsp;<span class="builtintype" id="5163158">bool</span>&nbsp;<span class="op" id="5163163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5163166">startCond</span>&nbsp;<span class="op" id="5163176">:=</span>&nbsp;<span class="ident" id="5163179">m</span><span class="op" id="5163180">.</span><span class="ident" id="5163181">re</span><span class="op" id="5163183">.</span><span class="ident" id="5163184">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5163190">if</span>&nbsp;<span class="ident" id="5163193">startCond</span>&nbsp;<span class="op" id="5163203">==</span>&nbsp;<span class="op" id="5163206">^</span><span class="ident" id="5163207">syntax</span><span class="op" id="5163213">.</span><span class="ident" id="5163214">EmptyOp</span><span class="op" id="5163221">(</span><span class="num" id="5163222">0</span><span class="op" id="5163223">)</span>&nbsp;<span class="op" id="5163225">{</span>&nbsp;<span class="comment" id="5163227">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5163243">return</span>&nbsp;<span class="ident" id="5163250">false</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5163257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5163260">m</span><span class="op" id="5163261">.</span><span class="ident" id="5163262">matched</span>&nbsp;<span class="op" id="5163270">=</span>&nbsp;<span class="ident" id="5163272">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5163279">for</span>&nbsp;<span class="ident" id="5163283">i</span>&nbsp;<span class="op" id="5163285">:=</span>&nbsp;<span class="keyword" id="5163288">range</span>&nbsp;<span class="ident" id="5163294">m</span><span class="op" id="5163295">.</span><span class="ident" id="5163296">matchcap</span>&nbsp;<span class="op" id="5163305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5163309">m</span><span class="op" id="5163310">.</span><span class="ident" id="5163311">matchcap</span><span class="op" id="5163319">[</span><span class="ident" id="5163320">i</span><span class="op" id="5163321">]</span>&nbsp;<span class="op" id="5163323">=</span>&nbsp;<span class="op" id="5163325">-</span><span class="num" id="5163326">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5163329">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5163332">runq</span><span class="op" id="5163336">,</span>&nbsp;<span class="ident" id="5163338">nextq</span>&nbsp;<span class="op" id="5163344">:=</span>&nbsp;<span class="op" id="5163347">&amp;</span><span class="ident" id="5163348">m</span><span class="op" id="5163349">.</span><span class="ident" id="5163350">q0</span><span class="op" id="5163352">,</span>&nbsp;<span class="op" id="5163354">&amp;</span><span class="ident" id="5163355">m</span><span class="op" id="5163356">.</span><span class="ident" id="5163357">q1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5163361">r</span><span class="op" id="5163362">,</span>&nbsp;<span class="ident" id="5163364">r1</span>&nbsp;<span class="op" id="5163367">:=</span>&nbsp;<span class="ident" id="5163370">endOfText</span><span class="op" id="5163379">,</span>&nbsp;<span class="ident" id="5163381">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5163392">width</span><span class="op" id="5163397">,</span>&nbsp;<span class="ident" id="5163399">width1</span>&nbsp;<span class="op" id="5163406">:=</span>&nbsp;<span class="num" id="5163409">0</span><span class="op" id="5163410">,</span>&nbsp;<span class="num" id="5163412">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5163415">r</span><span class="op" id="5163416">,</span>&nbsp;<span class="ident" id="5163418">width</span>&nbsp;<span class="op" id="5163424">=</span>&nbsp;<span class="ident" id="5163426">i</span><span class="op" id="5163427">.</span><span class="ident" id="5163428">step</span><span class="op" id="5163432">(</span><span class="ident" id="5163433">pos</span><span class="op" id="5163436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5163439">if</span>&nbsp;<span class="ident" id="5163442">r</span>&nbsp;<span class="op" id="5163444">!=</span>&nbsp;<span class="ident" id="5163447">endOfText</span>&nbsp;<span class="op" id="5163457">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5163461">r1</span><span class="op" id="5163463">,</span>&nbsp;<span class="ident" id="5163465">width1</span>&nbsp;<span class="op" id="5163472">=</span>&nbsp;<span class="ident" id="5163474">i</span><span class="op" id="5163475">.</span><span class="ident" id="5163476">step</span><span class="op" id="5163480">(</span><span class="ident" id="5163481">pos</span>&nbsp;<span class="op" id="5163485">+</span>&nbsp;<span class="ident" id="5163487">width</span><span class="op" id="5163492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5163495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5163498">var</span>&nbsp;<span class="ident" id="5163502">flag</span>&nbsp;<span class="ident" id="5163507">syntax</span><span class="op" id="5163513">.</span><span class="ident" id="5163514">EmptyOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5163523">if</span>&nbsp;<span class="ident" id="5163526">pos</span>&nbsp;<span class="op" id="5163530">==</span>&nbsp;<span class="num" id="5163533">0</span>&nbsp;<span class="op" id="5163535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5163539">flag</span>&nbsp;<span class="op" id="5163544">=</span>&nbsp;<span class="ident" id="5163546">syntax</span><span class="op" id="5163552">.</span><span class="ident" id="5163553">EmptyOpContext</span><span class="op" id="5163567">(</span><span class="op" id="5163568">-</span><span class="num" id="5163569">1</span><span class="op" id="5163570">,</span>&nbsp;<span class="ident" id="5163572">r</span><span class="op" id="5163573">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5163576">}</span>&nbsp;<span class="keyword" id="5163578">else</span>&nbsp;<span class="op" id="5163583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5163587">flag</span>&nbsp;<span class="op" id="5163592">=</span>&nbsp;<span class="ident" id="5163594">i</span><span class="op" id="5163595">.</span><span class="ident" id="5163596">context</span><span class="op" id="5163603">(</span><span class="ident" id="5163604">pos</span><span class="op" id="5163607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5163610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5163613">for</span>&nbsp;<span class="op" id="5163617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5163621">if</span>&nbsp;<span class="builtinfunc" id="5163624">len</span><span class="op" id="5163627">(</span><span class="ident" id="5163628">runq</span><span class="op" id="5163632">.</span><span class="ident" id="5163633">dense</span><span class="op" id="5163638">)</span>&nbsp;<span class="op" id="5163640">==</span>&nbsp;<span class="num" id="5163643">0</span>&nbsp;<span class="op" id="5163645">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5163650">if</span>&nbsp;<span class="ident" id="5163653">startCond</span><span class="op" id="5163662">&amp;</span><span class="ident" id="5163663">syntax</span><span class="op" id="5163669">.</span><span class="ident" id="5163670">EmptyBeginText</span>&nbsp;<span class="op" id="5163685">!=</span>&nbsp;<span class="num" id="5163688">0</span>&nbsp;<span class="op" id="5163690">&amp;&amp;</span>&nbsp;<span class="ident" id="5163693">pos</span>&nbsp;<span class="op" id="5163697">!=</span>&nbsp;<span class="num" id="5163700">0</span>&nbsp;<span class="op" id="5163702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5163708">//&nbsp;Anchored&nbsp;match,&nbsp;past&nbsp;beginning&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5163755">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5163764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5163769">if</span>&nbsp;<span class="ident" id="5163772">m</span><span class="op" id="5163773">.</span><span class="ident" id="5163774">matched</span>&nbsp;<span class="op" id="5163782">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5163788">//&nbsp;Have&nbsp;match;&nbsp;finished&nbsp;exploring&nbsp;alternatives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5163840">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5163849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5163854">if</span>&nbsp;<span class="builtinfunc" id="5163857">len</span><span class="op" id="5163860">(</span><span class="ident" id="5163861">m</span><span class="op" id="5163862">.</span><span class="ident" id="5163863">re</span><span class="op" id="5163865">.</span><span class="ident" id="5163866">prefix</span><span class="op" id="5163872">)</span>&nbsp;<span class="op" id="5163874">&gt;</span>&nbsp;<span class="num" id="5163876">0</span>&nbsp;<span class="op" id="5163878">&amp;&amp;</span>&nbsp;<span class="ident" id="5163881">r1</span>&nbsp;<span class="op" id="5163884">!=</span>&nbsp;<span class="ident" id="5163887">m</span><span class="op" id="5163888">.</span><span class="ident" id="5163889">re</span><span class="op" id="5163891">.</span><span class="ident" id="5163892">prefixRune</span>&nbsp;<span class="op" id="5163903">&amp;&amp;</span>&nbsp;<span class="ident" id="5163906">i</span><span class="op" id="5163907">.</span><span class="ident" id="5163908">canCheckPrefix</span><span class="op" id="5163922">(</span><span class="op" id="5163923">)</span>&nbsp;<span class="op" id="5163925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5163931">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5163989">advance</span>&nbsp;<span class="op" id="5163997">:=</span>&nbsp;<span class="ident" id="5164000">i</span><span class="op" id="5164001">.</span><span class="ident" id="5164002">index</span><span class="op" id="5164007">(</span><span class="ident" id="5164008">m</span><span class="op" id="5164009">.</span><span class="ident" id="5164010">re</span><span class="op" id="5164012">,</span>&nbsp;<span class="ident" id="5164014">pos</span><span class="op" id="5164017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164023">if</span>&nbsp;<span class="ident" id="5164026">advance</span>&nbsp;<span class="op" id="5164034">&lt;</span>&nbsp;<span class="num" id="5164036">0</span>&nbsp;<span class="op" id="5164038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164045">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5164055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164061">pos</span>&nbsp;<span class="op" id="5164065">+=</span>&nbsp;<span class="ident" id="5164068">advance</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164080">r</span><span class="op" id="5164081">,</span>&nbsp;<span class="ident" id="5164083">width</span>&nbsp;<span class="op" id="5164089">=</span>&nbsp;<span class="ident" id="5164091">i</span><span class="op" id="5164092">.</span><span class="ident" id="5164093">step</span><span class="op" id="5164097">(</span><span class="ident" id="5164098">pos</span><span class="op" id="5164101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164107">r1</span><span class="op" id="5164109">,</span>&nbsp;<span class="ident" id="5164111">width1</span>&nbsp;<span class="op" id="5164118">=</span>&nbsp;<span class="ident" id="5164120">i</span><span class="op" id="5164121">.</span><span class="ident" id="5164122">step</span><span class="op" id="5164126">(</span><span class="ident" id="5164127">pos</span>&nbsp;<span class="op" id="5164131">+</span>&nbsp;<span class="ident" id="5164133">width</span><span class="op" id="5164138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5164143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5164147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164151">if</span>&nbsp;<span class="op" id="5164154">!</span><span class="ident" id="5164155">m</span><span class="op" id="5164156">.</span><span class="ident" id="5164157">matched</span>&nbsp;<span class="op" id="5164165">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164170">if</span>&nbsp;<span class="builtinfunc" id="5164173">len</span><span class="op" id="5164176">(</span><span class="ident" id="5164177">m</span><span class="op" id="5164178">.</span><span class="ident" id="5164179">matchcap</span><span class="op" id="5164187">)</span>&nbsp;<span class="op" id="5164189">&gt;</span>&nbsp;<span class="num" id="5164191">0</span>&nbsp;<span class="op" id="5164193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164199">m</span><span class="op" id="5164200">.</span><span class="ident" id="5164201">matchcap</span><span class="op" id="5164209">[</span><span class="num" id="5164210">0</span><span class="op" id="5164211">]</span>&nbsp;<span class="op" id="5164213">=</span>&nbsp;<span class="ident" id="5164215">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5164222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164227">m</span><span class="op" id="5164228">.</span><span class="ident" id="5164229">add</span><span class="op" id="5164232">(</span><span class="ident" id="5164233">runq</span><span class="op" id="5164237">,</span>&nbsp;<span class="builtintype" id="5164239">uint32</span><span class="op" id="5164245">(</span><span class="ident" id="5164246">m</span><span class="op" id="5164247">.</span><span class="ident" id="5164248">p</span><span class="op" id="5164249">.</span><span class="ident" id="5164250">Start</span><span class="op" id="5164255">)</span><span class="op" id="5164256">,</span>&nbsp;<span class="ident" id="5164258">pos</span><span class="op" id="5164261">,</span>&nbsp;<span class="ident" id="5164263">m</span><span class="op" id="5164264">.</span><span class="ident" id="5164265">matchcap</span><span class="op" id="5164273">,</span>&nbsp;<span class="ident" id="5164275">flag</span><span class="op" id="5164279">,</span>&nbsp;<span class="ident" id="5164281">nil</span><span class="op" id="5164284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5164288">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164292">flag</span>&nbsp;<span class="op" id="5164297">=</span>&nbsp;<span class="ident" id="5164299">syntax</span><span class="op" id="5164305">.</span><span class="ident" id="5164306">EmptyOpContext</span><span class="op" id="5164320">(</span><span class="ident" id="5164321">r</span><span class="op" id="5164322">,</span>&nbsp;<span class="ident" id="5164324">r1</span><span class="op" id="5164326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164330">m</span><span class="op" id="5164331">.</span><span class="ident" id="5164332">step</span><span class="op" id="5164336">(</span><span class="ident" id="5164337">runq</span><span class="op" id="5164341">,</span>&nbsp;<span class="ident" id="5164343">nextq</span><span class="op" id="5164348">,</span>&nbsp;<span class="ident" id="5164350">pos</span><span class="op" id="5164353">,</span>&nbsp;<span class="ident" id="5164355">pos</span><span class="op" id="5164358">+</span><span class="ident" id="5164359">width</span><span class="op" id="5164364">,</span>&nbsp;<span class="ident" id="5164366">r</span><span class="op" id="5164367">,</span>&nbsp;<span class="ident" id="5164369">flag</span><span class="op" id="5164373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164377">if</span>&nbsp;<span class="ident" id="5164380">width</span>&nbsp;<span class="op" id="5164386">==</span>&nbsp;<span class="num" id="5164389">0</span>&nbsp;<span class="op" id="5164391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164396">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5164404">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164408">if</span>&nbsp;<span class="builtinfunc" id="5164411">len</span><span class="op" id="5164414">(</span><span class="ident" id="5164415">m</span><span class="op" id="5164416">.</span><span class="ident" id="5164417">matchcap</span><span class="op" id="5164425">)</span>&nbsp;<span class="op" id="5164427">==</span>&nbsp;<span class="num" id="5164430">0</span>&nbsp;<span class="op" id="5164432">&amp;&amp;</span>&nbsp;<span class="ident" id="5164435">m</span><span class="op" id="5164436">.</span><span class="ident" id="5164437">matched</span>&nbsp;<span class="op" id="5164445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5164450">//&nbsp;Found&nbsp;a&nbsp;match&nbsp;and&nbsp;not&nbsp;paying&nbsp;attention</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5164495">//&nbsp;to&nbsp;where&nbsp;it&nbsp;is,&nbsp;so&nbsp;any&nbsp;match&nbsp;will&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164539">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5164547">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164551">pos</span>&nbsp;<span class="op" id="5164555">+=</span>&nbsp;<span class="ident" id="5164558">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164566">r</span><span class="op" id="5164567">,</span>&nbsp;<span class="ident" id="5164569">width</span>&nbsp;<span class="op" id="5164575">=</span>&nbsp;<span class="ident" id="5164577">r1</span><span class="op" id="5164579">,</span>&nbsp;<span class="ident" id="5164581">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164590">if</span>&nbsp;<span class="ident" id="5164593">r</span>&nbsp;<span class="op" id="5164595">!=</span>&nbsp;<span class="ident" id="5164598">endOfText</span>&nbsp;<span class="op" id="5164608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164613">r1</span><span class="op" id="5164615">,</span>&nbsp;<span class="ident" id="5164617">width1</span>&nbsp;<span class="op" id="5164624">=</span>&nbsp;<span class="ident" id="5164626">i</span><span class="op" id="5164627">.</span><span class="ident" id="5164628">step</span><span class="op" id="5164632">(</span><span class="ident" id="5164633">pos</span>&nbsp;<span class="op" id="5164637">+</span>&nbsp;<span class="ident" id="5164639">width</span><span class="op" id="5164644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5164648">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164652">runq</span><span class="op" id="5164656">,</span>&nbsp;<span class="ident" id="5164658">nextq</span>&nbsp;<span class="op" id="5164664">=</span>&nbsp;<span class="ident" id="5164666">nextq</span><span class="op" id="5164671">,</span>&nbsp;<span class="ident" id="5164673">runq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5164679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164682">m</span><span class="op" id="5164683">.</span><span class="ident" id="5164684">clear</span><span class="op" id="5164689">(</span><span class="ident" id="5164690">nextq</span><span class="op" id="5164695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164698">return</span>&nbsp;<span class="ident" id="5164705">m</span><span class="op" id="5164706">.</span><span class="ident" id="5164707">matched</span><br>
<span class="lineno"></span><span class="op" id="5164715">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="5164718">//&nbsp;clear&nbsp;frees&nbsp;all&nbsp;threads&nbsp;on&nbsp;the&nbsp;thread&nbsp;queue.</span><br>
<span class="lineno"></span><span class="keyword" id="5164766">func</span>&nbsp;<span class="op" id="5164771">(</span><span class="ident" id="5164772">m</span>&nbsp;<span class="op" id="5164774">*</span><span class="ident" id="5164775">machine</span><span class="op" id="5164782">)</span>&nbsp;<span class="ident" id="5164784">clear</span><span class="op" id="5164789">(</span><span class="ident" id="5164790">q</span>&nbsp;<span class="op" id="5164792">*</span><span class="ident" id="5164793">queue</span><span class="op" id="5164798">)</span>&nbsp;<span class="op" id="5164800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164803">for</span>&nbsp;<span class="ident" id="5164807">_</span><span class="op" id="5164808">,</span>&nbsp;<span class="ident" id="5164810">d</span>&nbsp;<span class="op" id="5164812">:=</span>&nbsp;<span class="keyword" id="5164815">range</span>&nbsp;<span class="ident" id="5164821">q</span><span class="op" id="5164822">.</span><span class="ident" id="5164823">dense</span>&nbsp;<span class="op" id="5164829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164833">if</span>&nbsp;<span class="ident" id="5164836">d</span><span class="op" id="5164837">.</span><span class="ident" id="5164838">t</span>&nbsp;<span class="op" id="5164840">!=</span>&nbsp;<span class="ident" id="5164843">nil</span>&nbsp;<span class="op" id="5164847">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5164852">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164870">m</span><span class="op" id="5164871">.</span><span class="ident" id="5164872">pool</span>&nbsp;<span class="op" id="5164877">=</span>&nbsp;<span class="builtinfunc" id="5164879">append</span><span class="op" id="5164885">(</span><span class="ident" id="5164886">m</span><span class="op" id="5164887">.</span><span class="ident" id="5164888">pool</span><span class="op" id="5164892">,</span>&nbsp;<span class="ident" id="5164894">d</span><span class="op" id="5164895">.</span><span class="ident" id="5164896">t</span><span class="op" id="5164897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5164901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5164904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164907">q</span><span class="op" id="5164908">.</span><span class="ident" id="5164909">dense</span>&nbsp;<span class="op" id="5164915">=</span>&nbsp;<span class="ident" id="5164917">q</span><span class="op" id="5164918">.</span><span class="ident" id="5164919">dense</span><span class="op" id="5164924">[</span><span class="op" id="5164925">:</span><span class="num" id="5164926">0</span><span class="op" id="5164927">]</span><br>
<span class="lineno">195</span><span class="op" id="5164929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5164932">//&nbsp;step&nbsp;executes&nbsp;one&nbsp;step&nbsp;of&nbsp;the&nbsp;machine,&nbsp;running&nbsp;each&nbsp;of&nbsp;the&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="5165002">//&nbsp;on&nbsp;runq&nbsp;and&nbsp;appending&nbsp;new&nbsp;threads&nbsp;to&nbsp;nextq.</span><br>
<span class="lineno"></span><span class="comment" id="5165049">//&nbsp;The&nbsp;step&nbsp;processes&nbsp;the&nbsp;rune&nbsp;c&nbsp;(which&nbsp;may&nbsp;be&nbsp;endOfText),</span><br>
<span class="lineno">200</span><span class="comment" id="5165108">//&nbsp;which&nbsp;starts&nbsp;at&nbsp;position&nbsp;pos&nbsp;and&nbsp;ends&nbsp;at&nbsp;nextPos.</span><br>
<span class="lineno"></span><span class="comment" id="5165161">//&nbsp;nextCond&nbsp;gives&nbsp;the&nbsp;setting&nbsp;for&nbsp;the&nbsp;empty-width&nbsp;flags&nbsp;after&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="5165226">func</span>&nbsp;<span class="op" id="5165231">(</span><span class="ident" id="5165232">m</span>&nbsp;<span class="op" id="5165234">*</span><span class="ident" id="5165235">machine</span><span class="op" id="5165242">)</span>&nbsp;<span class="ident" id="5165244">step</span><span class="op" id="5165248">(</span><span class="ident" id="5165249">runq</span><span class="op" id="5165253">,</span>&nbsp;<span class="ident" id="5165255">nextq</span>&nbsp;<span class="op" id="5165261">*</span><span class="ident" id="5165262">queue</span><span class="op" id="5165267">,</span>&nbsp;<span class="ident" id="5165269">pos</span><span class="op" id="5165272">,</span>&nbsp;<span class="ident" id="5165274">nextPos</span>&nbsp;<span class="builtintype" id="5165282">int</span><span class="op" id="5165285">,</span>&nbsp;<span class="ident" id="5165287">c</span>&nbsp;<span class="builtintype" id="5165289">rune</span><span class="op" id="5165293">,</span>&nbsp;<span class="ident" id="5165295">nextCond</span>&nbsp;<span class="ident" id="5165304">syntax</span><span class="op" id="5165310">.</span><span class="ident" id="5165311">EmptyOp</span><span class="op" id="5165318">)</span>&nbsp;<span class="op" id="5165320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165323">longest</span>&nbsp;<span class="op" id="5165331">:=</span>&nbsp;<span class="ident" id="5165334">m</span><span class="op" id="5165335">.</span><span class="ident" id="5165336">re</span><span class="op" id="5165338">.</span><span class="ident" id="5165339">longest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165348">for</span>&nbsp;<span class="ident" id="5165352">j</span>&nbsp;<span class="op" id="5165354">:=</span>&nbsp;<span class="num" id="5165357">0</span><span class="op" id="5165358">;</span>&nbsp;<span class="ident" id="5165360">j</span>&nbsp;<span class="op" id="5165362">&lt;</span>&nbsp;<span class="builtinfunc" id="5165364">len</span><span class="op" id="5165367">(</span><span class="ident" id="5165368">runq</span><span class="op" id="5165372">.</span><span class="ident" id="5165373">dense</span><span class="op" id="5165378">)</span><span class="op" id="5165379">;</span>&nbsp;<span class="ident" id="5165381">j</span><span class="op" id="5165382">++</span>&nbsp;<span class="op" id="5165385">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165389">d</span>&nbsp;<span class="op" id="5165391">:=</span>&nbsp;<span class="op" id="5165394">&amp;</span><span class="ident" id="5165395">runq</span><span class="op" id="5165399">.</span><span class="ident" id="5165400">dense</span><span class="op" id="5165405">[</span><span class="ident" id="5165406">j</span><span class="op" id="5165407">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165411">t</span>&nbsp;<span class="op" id="5165413">:=</span>&nbsp;<span class="ident" id="5165416">d</span><span class="op" id="5165417">.</span><span class="ident" id="5165418">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165422">if</span>&nbsp;<span class="ident" id="5165425">t</span>&nbsp;<span class="op" id="5165427">==</span>&nbsp;<span class="ident" id="5165430">nil</span>&nbsp;<span class="op" id="5165434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165439">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5165450">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165454">if</span>&nbsp;<span class="ident" id="5165457">longest</span>&nbsp;<span class="op" id="5165465">&amp;&amp;</span>&nbsp;<span class="ident" id="5165468">m</span><span class="op" id="5165469">.</span><span class="ident" id="5165470">matched</span>&nbsp;<span class="op" id="5165478">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5165481">len</span><span class="op" id="5165484">(</span><span class="ident" id="5165485">t</span><span class="op" id="5165486">.</span><span class="builtinfunc" id="5165487">cap</span><span class="op" id="5165490">)</span>&nbsp;<span class="op" id="5165492">&gt;</span>&nbsp;<span class="num" id="5165494">0</span>&nbsp;<span class="op" id="5165496">&amp;&amp;</span>&nbsp;<span class="ident" id="5165499">m</span><span class="op" id="5165500">.</span><span class="ident" id="5165501">matchcap</span><span class="op" id="5165509">[</span><span class="num" id="5165510">0</span><span class="op" id="5165511">]</span>&nbsp;<span class="op" id="5165513">&lt;</span>&nbsp;<span class="ident" id="5165515">t</span><span class="op" id="5165516">.</span><span class="builtinfunc" id="5165517">cap</span><span class="op" id="5165520">[</span><span class="num" id="5165521">0</span><span class="op" id="5165522">]</span>&nbsp;<span class="op" id="5165524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5165529">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165545">m</span><span class="op" id="5165546">.</span><span class="ident" id="5165547">pool</span>&nbsp;<span class="op" id="5165552">=</span>&nbsp;<span class="builtinfunc" id="5165554">append</span><span class="op" id="5165560">(</span><span class="ident" id="5165561">m</span><span class="op" id="5165562">.</span><span class="ident" id="5165563">pool</span><span class="op" id="5165567">,</span>&nbsp;<span class="ident" id="5165569">t</span><span class="op" id="5165570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165575">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5165586">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165590">i</span>&nbsp;<span class="op" id="5165592">:=</span>&nbsp;<span class="ident" id="5165595">t</span><span class="op" id="5165596">.</span><span class="ident" id="5165597">inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165604">add</span>&nbsp;<span class="op" id="5165608">:=</span>&nbsp;<span class="ident" id="5165611">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165619">switch</span>&nbsp;<span class="ident" id="5165626">i</span><span class="op" id="5165627">.</span><span class="ident" id="5165628">Op</span>&nbsp;<span class="op" id="5165631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165635">default</span><span class="op" id="5165642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5165647">panic</span><span class="op" id="5165652">(</span><span class="string" id="5165653">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5165663">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165668">case</span>&nbsp;<span class="ident" id="5165673">syntax</span><span class="op" id="5165679">.</span><span class="ident" id="5165680">InstMatch</span><span class="op" id="5165689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165694">if</span>&nbsp;<span class="builtinfunc" id="5165697">len</span><span class="op" id="5165700">(</span><span class="ident" id="5165701">t</span><span class="op" id="5165702">.</span><span class="builtinfunc" id="5165703">cap</span><span class="op" id="5165706">)</span>&nbsp;<span class="op" id="5165708">&gt;</span>&nbsp;<span class="num" id="5165710">0</span>&nbsp;<span class="op" id="5165712">&amp;&amp;</span>&nbsp;<span class="op" id="5165715">(</span><span class="op" id="5165716">!</span><span class="ident" id="5165717">longest</span>&nbsp;<span class="op" id="5165725">||</span>&nbsp;<span class="op" id="5165728">!</span><span class="ident" id="5165729">m</span><span class="op" id="5165730">.</span><span class="ident" id="5165731">matched</span>&nbsp;<span class="op" id="5165739">||</span>&nbsp;<span class="ident" id="5165742">m</span><span class="op" id="5165743">.</span><span class="ident" id="5165744">matchcap</span><span class="op" id="5165752">[</span><span class="num" id="5165753">1</span><span class="op" id="5165754">]</span>&nbsp;<span class="op" id="5165756">&lt;</span>&nbsp;<span class="ident" id="5165758">pos</span><span class="op" id="5165761">)</span>&nbsp;<span class="op" id="5165763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165769">t</span><span class="op" id="5165770">.</span><span class="builtinfunc" id="5165771">cap</span><span class="op" id="5165774">[</span><span class="num" id="5165775">1</span><span class="op" id="5165776">]</span>&nbsp;<span class="op" id="5165778">=</span>&nbsp;<span class="ident" id="5165780">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5165788">copy</span><span class="op" id="5165792">(</span><span class="ident" id="5165793">m</span><span class="op" id="5165794">.</span><span class="ident" id="5165795">matchcap</span><span class="op" id="5165803">,</span>&nbsp;<span class="ident" id="5165805">t</span><span class="op" id="5165806">.</span><span class="builtinfunc" id="5165807">cap</span><span class="op" id="5165810">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5165815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165820">if</span>&nbsp;<span class="op" id="5165823">!</span><span class="ident" id="5165824">longest</span>&nbsp;<span class="op" id="5165832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5165838">//&nbsp;First-match&nbsp;mode:&nbsp;cut&nbsp;off&nbsp;all&nbsp;lower-priority&nbsp;threads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165899">for</span>&nbsp;<span class="ident" id="5165903">_</span><span class="op" id="5165904">,</span>&nbsp;<span class="ident" id="5165906">d</span>&nbsp;<span class="op" id="5165908">:=</span>&nbsp;<span class="keyword" id="5165911">range</span>&nbsp;<span class="ident" id="5165917">runq</span><span class="op" id="5165921">.</span><span class="ident" id="5165922">dense</span><span class="op" id="5165927">[</span><span class="ident" id="5165928">j</span><span class="op" id="5165929">+</span><span class="num" id="5165930">1</span><span class="op" id="5165931">:</span><span class="op" id="5165932">]</span>&nbsp;<span class="op" id="5165934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165941">if</span>&nbsp;<span class="ident" id="5165944">d</span><span class="op" id="5165945">.</span><span class="ident" id="5165946">t</span>&nbsp;<span class="op" id="5165948">!=</span>&nbsp;<span class="ident" id="5165951">nil</span>&nbsp;<span class="op" id="5165955">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5165963">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165984">m</span><span class="op" id="5165985">.</span><span class="ident" id="5165986">pool</span>&nbsp;<span class="op" id="5165991">=</span>&nbsp;<span class="builtinfunc" id="5165993">append</span><span class="op" id="5165999">(</span><span class="ident" id="5166000">m</span><span class="op" id="5166001">.</span><span class="ident" id="5166002">pool</span><span class="op" id="5166006">,</span>&nbsp;<span class="ident" id="5166008">d</span><span class="op" id="5166009">.</span><span class="ident" id="5166010">t</span><span class="op" id="5166011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166030">runq</span><span class="op" id="5166034">.</span><span class="ident" id="5166035">dense</span>&nbsp;<span class="op" id="5166041">=</span>&nbsp;<span class="ident" id="5166043">runq</span><span class="op" id="5166047">.</span><span class="ident" id="5166048">dense</span><span class="op" id="5166053">[</span><span class="op" id="5166054">:</span><span class="num" id="5166055">0</span><span class="op" id="5166056">]</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166066">m</span><span class="op" id="5166067">.</span><span class="ident" id="5166068">matched</span>&nbsp;<span class="op" id="5166076">=</span>&nbsp;<span class="ident" id="5166078">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166086">case</span>&nbsp;<span class="ident" id="5166091">syntax</span><span class="op" id="5166097">.</span><span class="ident" id="5166098">InstRune</span><span class="op" id="5166106">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166111">add</span>&nbsp;<span class="op" id="5166115">=</span>&nbsp;<span class="ident" id="5166117">i</span><span class="op" id="5166118">.</span><span class="ident" id="5166119">MatchRune</span><span class="op" id="5166128">(</span><span class="ident" id="5166129">c</span><span class="op" id="5166130">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166134">case</span>&nbsp;<span class="ident" id="5166139">syntax</span><span class="op" id="5166145">.</span><span class="ident" id="5166146">InstRune1</span><span class="op" id="5166155">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166160">add</span>&nbsp;<span class="op" id="5166164">=</span>&nbsp;<span class="ident" id="5166166">c</span>&nbsp;<span class="op" id="5166168">==</span>&nbsp;<span class="ident" id="5166171">i</span><span class="op" id="5166172">.</span><span class="ident" id="5166173">Rune</span><span class="op" id="5166177">[</span><span class="num" id="5166178">0</span><span class="op" id="5166179">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166183">case</span>&nbsp;<span class="ident" id="5166188">syntax</span><span class="op" id="5166194">.</span><span class="ident" id="5166195">InstRuneAny</span><span class="op" id="5166206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166211">add</span>&nbsp;<span class="op" id="5166215">=</span>&nbsp;<span class="ident" id="5166217">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166224">case</span>&nbsp;<span class="ident" id="5166229">syntax</span><span class="op" id="5166235">.</span><span class="ident" id="5166236">InstRuneAnyNotNL</span><span class="op" id="5166252">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166257">add</span>&nbsp;<span class="op" id="5166261">=</span>&nbsp;<span class="ident" id="5166263">c</span>&nbsp;<span class="op" id="5166265">!=</span>&nbsp;<span class="string" id="5166268">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166279">if</span>&nbsp;<span class="ident" id="5166282">add</span>&nbsp;<span class="op" id="5166286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166291">t</span>&nbsp;<span class="op" id="5166293">=</span>&nbsp;<span class="ident" id="5166295">m</span><span class="op" id="5166296">.</span><span class="ident" id="5166297">add</span><span class="op" id="5166300">(</span><span class="ident" id="5166301">nextq</span><span class="op" id="5166306">,</span>&nbsp;<span class="ident" id="5166308">i</span><span class="op" id="5166309">.</span><span class="ident" id="5166310">Out</span><span class="op" id="5166313">,</span>&nbsp;<span class="ident" id="5166315">nextPos</span><span class="op" id="5166322">,</span>&nbsp;<span class="ident" id="5166324">t</span><span class="op" id="5166325">.</span><span class="builtinfunc" id="5166326">cap</span><span class="op" id="5166329">,</span>&nbsp;<span class="ident" id="5166331">nextCond</span><span class="op" id="5166339">,</span>&nbsp;<span class="ident" id="5166341">t</span><span class="op" id="5166342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166346">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166350">if</span>&nbsp;<span class="ident" id="5166353">t</span>&nbsp;<span class="op" id="5166355">!=</span>&nbsp;<span class="ident" id="5166358">nil</span>&nbsp;<span class="op" id="5166362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5166367">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166383">m</span><span class="op" id="5166384">.</span><span class="ident" id="5166385">pool</span>&nbsp;<span class="op" id="5166390">=</span>&nbsp;<span class="builtinfunc" id="5166392">append</span><span class="op" id="5166398">(</span><span class="ident" id="5166399">m</span><span class="op" id="5166400">.</span><span class="ident" id="5166401">pool</span><span class="op" id="5166405">,</span>&nbsp;<span class="ident" id="5166407">t</span><span class="op" id="5166408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166415">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166418">runq</span><span class="op" id="5166422">.</span><span class="ident" id="5166423">dense</span>&nbsp;<span class="op" id="5166429">=</span>&nbsp;<span class="ident" id="5166431">runq</span><span class="op" id="5166435">.</span><span class="ident" id="5166436">dense</span><span class="op" id="5166441">[</span><span class="op" id="5166442">:</span><span class="num" id="5166443">0</span><span class="op" id="5166444">]</span><br>
<span class="lineno"></span><span class="op" id="5166446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5166449">//&nbsp;add&nbsp;adds&nbsp;an&nbsp;entry&nbsp;to&nbsp;q&nbsp;for&nbsp;pc,&nbsp;unless&nbsp;the&nbsp;q&nbsp;already&nbsp;has&nbsp;such&nbsp;an&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="5166523">//&nbsp;It&nbsp;also&nbsp;recursively&nbsp;adds&nbsp;an&nbsp;entry&nbsp;for&nbsp;all&nbsp;instructions&nbsp;reachable&nbsp;from&nbsp;pc&nbsp;by&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="5166612">//&nbsp;empty-width&nbsp;conditions&nbsp;satisfied&nbsp;by&nbsp;cond.&nbsp;&nbsp;pos&nbsp;gives&nbsp;the&nbsp;current&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5166689">//&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5166706">func</span>&nbsp;<span class="op" id="5166711">(</span><span class="ident" id="5166712">m</span>&nbsp;<span class="op" id="5166714">*</span><span class="ident" id="5166715">machine</span><span class="op" id="5166722">)</span>&nbsp;<span class="ident" id="5166724">add</span><span class="op" id="5166727">(</span><span class="ident" id="5166728">q</span>&nbsp;<span class="op" id="5166730">*</span><span class="ident" id="5166731">queue</span><span class="op" id="5166736">,</span>&nbsp;<span class="ident" id="5166738">pc</span>&nbsp;<span class="builtintype" id="5166741">uint32</span><span class="op" id="5166747">,</span>&nbsp;<span class="ident" id="5166749">pos</span>&nbsp;<span class="builtintype" id="5166753">int</span><span class="op" id="5166756">,</span>&nbsp;<span class="builtinfunc" id="5166758">cap</span>&nbsp;<span class="op" id="5166762">[</span><span class="op" id="5166763">]</span><span class="builtintype" id="5166764">int</span><span class="op" id="5166767">,</span>&nbsp;<span class="ident" id="5166769">cond</span>&nbsp;<span class="ident" id="5166774">syntax</span><span class="op" id="5166780">.</span><span class="ident" id="5166781">EmptyOp</span><span class="op" id="5166788">,</span>&nbsp;<span class="ident" id="5166790">t</span>&nbsp;<span class="op" id="5166792">*</span><span class="ident" id="5166793">thread</span><span class="op" id="5166799">)</span>&nbsp;<span class="op" id="5166801">*</span><span class="ident" id="5166802">thread</span>&nbsp;<span class="op" id="5166809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166812">if</span>&nbsp;<span class="ident" id="5166815">pc</span>&nbsp;<span class="op" id="5166818">==</span>&nbsp;<span class="num" id="5166821">0</span>&nbsp;<span class="op" id="5166823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166827">return</span>&nbsp;<span class="ident" id="5166834">t</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166840">if</span>&nbsp;<span class="ident" id="5166843">j</span>&nbsp;<span class="op" id="5166845">:=</span>&nbsp;<span class="ident" id="5166848">q</span><span class="op" id="5166849">.</span><span class="ident" id="5166850">sparse</span><span class="op" id="5166856">[</span><span class="ident" id="5166857">pc</span><span class="op" id="5166859">]</span><span class="op" id="5166860">;</span>&nbsp;<span class="ident" id="5166862">j</span>&nbsp;<span class="op" id="5166864">&lt;</span>&nbsp;<span class="builtintype" id="5166866">uint32</span><span class="op" id="5166872">(</span><span class="builtinfunc" id="5166873">len</span><span class="op" id="5166876">(</span><span class="ident" id="5166877">q</span><span class="op" id="5166878">.</span><span class="ident" id="5166879">dense</span><span class="op" id="5166884">)</span><span class="op" id="5166885">)</span>&nbsp;<span class="op" id="5166887">&amp;&amp;</span>&nbsp;<span class="ident" id="5166890">q</span><span class="op" id="5166891">.</span><span class="ident" id="5166892">dense</span><span class="op" id="5166897">[</span><span class="ident" id="5166898">j</span><span class="op" id="5166899">]</span><span class="op" id="5166900">.</span><span class="ident" id="5166901">pc</span>&nbsp;<span class="op" id="5166904">==</span>&nbsp;<span class="ident" id="5166907">pc</span>&nbsp;<span class="op" id="5166910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166914">return</span>&nbsp;<span class="ident" id="5166921">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166928">j</span>&nbsp;<span class="op" id="5166930">:=</span>&nbsp;<span class="builtinfunc" id="5166933">len</span><span class="op" id="5166936">(</span><span class="ident" id="5166937">q</span><span class="op" id="5166938">.</span><span class="ident" id="5166939">dense</span><span class="op" id="5166944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166947">q</span><span class="op" id="5166948">.</span><span class="ident" id="5166949">dense</span>&nbsp;<span class="op" id="5166955">=</span>&nbsp;<span class="ident" id="5166957">q</span><span class="op" id="5166958">.</span><span class="ident" id="5166959">dense</span><span class="op" id="5166964">[</span><span class="op" id="5166965">:</span><span class="ident" id="5166966">j</span><span class="op" id="5166967">+</span><span class="num" id="5166968">1</span><span class="op" id="5166969">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166972">d</span>&nbsp;<span class="op" id="5166974">:=</span>&nbsp;<span class="op" id="5166977">&amp;</span><span class="ident" id="5166978">q</span><span class="op" id="5166979">.</span><span class="ident" id="5166980">dense</span><span class="op" id="5166985">[</span><span class="ident" id="5166986">j</span><span class="op" id="5166987">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166990">d</span><span class="op" id="5166991">.</span><span class="ident" id="5166992">t</span>&nbsp;<span class="op" id="5166994">=</span>&nbsp;<span class="ident" id="5166996">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167001">d</span><span class="op" id="5167002">.</span><span class="ident" id="5167003">pc</span>&nbsp;<span class="op" id="5167006">=</span>&nbsp;<span class="ident" id="5167008">pc</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167012">q</span><span class="op" id="5167013">.</span><span class="ident" id="5167014">sparse</span><span class="op" id="5167020">[</span><span class="ident" id="5167021">pc</span><span class="op" id="5167023">]</span>&nbsp;<span class="op" id="5167025">=</span>&nbsp;<span class="builtintype" id="5167027">uint32</span><span class="op" id="5167033">(</span><span class="ident" id="5167034">j</span><span class="op" id="5167035">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167039">i</span>&nbsp;<span class="op" id="5167041">:=</span>&nbsp;<span class="op" id="5167044">&amp;</span><span class="ident" id="5167045">m</span><span class="op" id="5167046">.</span><span class="ident" id="5167047">p</span><span class="op" id="5167048">.</span><span class="ident" id="5167049">Inst</span><span class="op" id="5167053">[</span><span class="ident" id="5167054">pc</span><span class="op" id="5167056">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167059">switch</span>&nbsp;<span class="ident" id="5167066">i</span><span class="op" id="5167067">.</span><span class="ident" id="5167068">Op</span>&nbsp;<span class="op" id="5167071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167074">default</span><span class="op" id="5167081">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5167085">panic</span><span class="op" id="5167090">(</span><span class="string" id="5167091">&#34;unhandled&#34;</span><span class="op" id="5167102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167105">case</span>&nbsp;<span class="ident" id="5167110">syntax</span><span class="op" id="5167116">.</span><span class="ident" id="5167117">InstFail</span><span class="op" id="5167125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5167129">//&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167141">case</span>&nbsp;<span class="ident" id="5167146">syntax</span><span class="op" id="5167152">.</span><span class="ident" id="5167153">InstAlt</span><span class="op" id="5167160">,</span>&nbsp;<span class="ident" id="5167162">syntax</span><span class="op" id="5167168">.</span><span class="ident" id="5167169">InstAltMatch</span><span class="op" id="5167181">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167185">t</span>&nbsp;<span class="op" id="5167187">=</span>&nbsp;<span class="ident" id="5167189">m</span><span class="op" id="5167190">.</span><span class="ident" id="5167191">add</span><span class="op" id="5167194">(</span><span class="ident" id="5167195">q</span><span class="op" id="5167196">,</span>&nbsp;<span class="ident" id="5167198">i</span><span class="op" id="5167199">.</span><span class="ident" id="5167200">Out</span><span class="op" id="5167203">,</span>&nbsp;<span class="ident" id="5167205">pos</span><span class="op" id="5167208">,</span>&nbsp;<span class="builtinfunc" id="5167210">cap</span><span class="op" id="5167213">,</span>&nbsp;<span class="ident" id="5167215">cond</span><span class="op" id="5167219">,</span>&nbsp;<span class="ident" id="5167221">t</span><span class="op" id="5167222">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167226">t</span>&nbsp;<span class="op" id="5167228">=</span>&nbsp;<span class="ident" id="5167230">m</span><span class="op" id="5167231">.</span><span class="ident" id="5167232">add</span><span class="op" id="5167235">(</span><span class="ident" id="5167236">q</span><span class="op" id="5167237">,</span>&nbsp;<span class="ident" id="5167239">i</span><span class="op" id="5167240">.</span><span class="ident" id="5167241">Arg</span><span class="op" id="5167244">,</span>&nbsp;<span class="ident" id="5167246">pos</span><span class="op" id="5167249">,</span>&nbsp;<span class="builtinfunc" id="5167251">cap</span><span class="op" id="5167254">,</span>&nbsp;<span class="ident" id="5167256">cond</span><span class="op" id="5167260">,</span>&nbsp;<span class="ident" id="5167262">t</span><span class="op" id="5167263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167266">case</span>&nbsp;<span class="ident" id="5167271">syntax</span><span class="op" id="5167277">.</span><span class="ident" id="5167278">InstEmptyWidth</span><span class="op" id="5167292">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167296">if</span>&nbsp;<span class="ident" id="5167299">syntax</span><span class="op" id="5167305">.</span><span class="ident" id="5167306">EmptyOp</span><span class="op" id="5167313">(</span><span class="ident" id="5167314">i</span><span class="op" id="5167315">.</span><span class="ident" id="5167316">Arg</span><span class="op" id="5167319">)</span><span class="op" id="5167320">&amp;^</span><span class="ident" id="5167322">cond</span>&nbsp;<span class="op" id="5167327">==</span>&nbsp;<span class="num" id="5167330">0</span>&nbsp;<span class="op" id="5167332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167337">t</span>&nbsp;<span class="op" id="5167339">=</span>&nbsp;<span class="ident" id="5167341">m</span><span class="op" id="5167342">.</span><span class="ident" id="5167343">add</span><span class="op" id="5167346">(</span><span class="ident" id="5167347">q</span><span class="op" id="5167348">,</span>&nbsp;<span class="ident" id="5167350">i</span><span class="op" id="5167351">.</span><span class="ident" id="5167352">Out</span><span class="op" id="5167355">,</span>&nbsp;<span class="ident" id="5167357">pos</span><span class="op" id="5167360">,</span>&nbsp;<span class="builtinfunc" id="5167362">cap</span><span class="op" id="5167365">,</span>&nbsp;<span class="ident" id="5167367">cond</span><span class="op" id="5167371">,</span>&nbsp;<span class="ident" id="5167373">t</span><span class="op" id="5167374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5167378">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167381">case</span>&nbsp;<span class="ident" id="5167386">syntax</span><span class="op" id="5167392">.</span><span class="ident" id="5167393">InstNop</span><span class="op" id="5167400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167404">t</span>&nbsp;<span class="op" id="5167406">=</span>&nbsp;<span class="ident" id="5167408">m</span><span class="op" id="5167409">.</span><span class="ident" id="5167410">add</span><span class="op" id="5167413">(</span><span class="ident" id="5167414">q</span><span class="op" id="5167415">,</span>&nbsp;<span class="ident" id="5167417">i</span><span class="op" id="5167418">.</span><span class="ident" id="5167419">Out</span><span class="op" id="5167422">,</span>&nbsp;<span class="ident" id="5167424">pos</span><span class="op" id="5167427">,</span>&nbsp;<span class="builtinfunc" id="5167429">cap</span><span class="op" id="5167432">,</span>&nbsp;<span class="ident" id="5167434">cond</span><span class="op" id="5167438">,</span>&nbsp;<span class="ident" id="5167440">t</span><span class="op" id="5167441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167444">case</span>&nbsp;<span class="ident" id="5167449">syntax</span><span class="op" id="5167455">.</span><span class="ident" id="5167456">InstCapture</span><span class="op" id="5167467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167471">if</span>&nbsp;<span class="builtintype" id="5167474">int</span><span class="op" id="5167477">(</span><span class="ident" id="5167478">i</span><span class="op" id="5167479">.</span><span class="ident" id="5167480">Arg</span><span class="op" id="5167483">)</span>&nbsp;<span class="op" id="5167485">&lt;</span>&nbsp;<span class="builtinfunc" id="5167487">len</span><span class="op" id="5167490">(</span><span class="builtinfunc" id="5167491">cap</span><span class="op" id="5167494">)</span>&nbsp;<span class="op" id="5167496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167501">opos</span>&nbsp;<span class="op" id="5167506">:=</span>&nbsp;<span class="builtinfunc" id="5167509">cap</span><span class="op" id="5167512">[</span><span class="ident" id="5167513">i</span><span class="op" id="5167514">.</span><span class="ident" id="5167515">Arg</span><span class="op" id="5167518">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5167523">cap</span><span class="op" id="5167526">[</span><span class="ident" id="5167527">i</span><span class="op" id="5167528">.</span><span class="ident" id="5167529">Arg</span><span class="op" id="5167532">]</span>&nbsp;<span class="op" id="5167534">=</span>&nbsp;<span class="ident" id="5167536">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167543">m</span><span class="op" id="5167544">.</span><span class="ident" id="5167545">add</span><span class="op" id="5167548">(</span><span class="ident" id="5167549">q</span><span class="op" id="5167550">,</span>&nbsp;<span class="ident" id="5167552">i</span><span class="op" id="5167553">.</span><span class="ident" id="5167554">Out</span><span class="op" id="5167557">,</span>&nbsp;<span class="ident" id="5167559">pos</span><span class="op" id="5167562">,</span>&nbsp;<span class="builtinfunc" id="5167564">cap</span><span class="op" id="5167567">,</span>&nbsp;<span class="ident" id="5167569">cond</span><span class="op" id="5167573">,</span>&nbsp;<span class="ident" id="5167575">nil</span><span class="op" id="5167578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5167583">cap</span><span class="op" id="5167586">[</span><span class="ident" id="5167587">i</span><span class="op" id="5167588">.</span><span class="ident" id="5167589">Arg</span><span class="op" id="5167592">]</span>&nbsp;<span class="op" id="5167594">=</span>&nbsp;<span class="ident" id="5167596">opos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5167603">}</span>&nbsp;<span class="keyword" id="5167605">else</span>&nbsp;<span class="op" id="5167610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167615">t</span>&nbsp;<span class="op" id="5167617">=</span>&nbsp;<span class="ident" id="5167619">m</span><span class="op" id="5167620">.</span><span class="ident" id="5167621">add</span><span class="op" id="5167624">(</span><span class="ident" id="5167625">q</span><span class="op" id="5167626">,</span>&nbsp;<span class="ident" id="5167628">i</span><span class="op" id="5167629">.</span><span class="ident" id="5167630">Out</span><span class="op" id="5167633">,</span>&nbsp;<span class="ident" id="5167635">pos</span><span class="op" id="5167638">,</span>&nbsp;<span class="builtinfunc" id="5167640">cap</span><span class="op" id="5167643">,</span>&nbsp;<span class="ident" id="5167645">cond</span><span class="op" id="5167649">,</span>&nbsp;<span class="ident" id="5167651">t</span><span class="op" id="5167652">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5167656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167659">case</span>&nbsp;<span class="ident" id="5167664">syntax</span><span class="op" id="5167670">.</span><span class="ident" id="5167671">InstMatch</span><span class="op" id="5167680">,</span>&nbsp;<span class="ident" id="5167682">syntax</span><span class="op" id="5167688">.</span><span class="ident" id="5167689">InstRune</span><span class="op" id="5167697">,</span>&nbsp;<span class="ident" id="5167699">syntax</span><span class="op" id="5167705">.</span><span class="ident" id="5167706">InstRune1</span><span class="op" id="5167715">,</span>&nbsp;<span class="ident" id="5167717">syntax</span><span class="op" id="5167723">.</span><span class="ident" id="5167724">InstRuneAny</span><span class="op" id="5167735">,</span>&nbsp;<span class="ident" id="5167737">syntax</span><span class="op" id="5167743">.</span><span class="ident" id="5167744">InstRuneAnyNotNL</span><span class="op" id="5167760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167764">if</span>&nbsp;<span class="ident" id="5167767">t</span>&nbsp;<span class="op" id="5167769">==</span>&nbsp;<span class="ident" id="5167772">nil</span>&nbsp;<span class="op" id="5167776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167781">t</span>&nbsp;<span class="op" id="5167783">=</span>&nbsp;<span class="ident" id="5167785">m</span><span class="op" id="5167786">.</span><span class="ident" id="5167787">alloc</span><span class="op" id="5167792">(</span><span class="ident" id="5167793">i</span><span class="op" id="5167794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5167798">}</span>&nbsp;<span class="keyword" id="5167800">else</span>&nbsp;<span class="op" id="5167805">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167810">t</span><span class="op" id="5167811">.</span><span class="ident" id="5167812">inst</span>&nbsp;<span class="op" id="5167817">=</span>&nbsp;<span class="ident" id="5167819">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5167823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167827">if</span>&nbsp;<span class="builtinfunc" id="5167830">len</span><span class="op" id="5167833">(</span><span class="builtinfunc" id="5167834">cap</span><span class="op" id="5167837">)</span>&nbsp;<span class="op" id="5167839">&gt;</span>&nbsp;<span class="num" id="5167841">0</span>&nbsp;<span class="op" id="5167843">&amp;&amp;</span>&nbsp;<span class="op" id="5167846">&amp;</span><span class="ident" id="5167847">t</span><span class="op" id="5167848">.</span><span class="builtinfunc" id="5167849">cap</span><span class="op" id="5167852">[</span><span class="num" id="5167853">0</span><span class="op" id="5167854">]</span>&nbsp;<span class="op" id="5167856">!=</span>&nbsp;<span class="op" id="5167859">&amp;</span><span class="builtinfunc" id="5167860">cap</span><span class="op" id="5167863">[</span><span class="num" id="5167864">0</span><span class="op" id="5167865">]</span>&nbsp;<span class="op" id="5167867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5167872">copy</span><span class="op" id="5167876">(</span><span class="ident" id="5167877">t</span><span class="op" id="5167878">.</span><span class="builtinfunc" id="5167879">cap</span><span class="op" id="5167882">,</span>&nbsp;<span class="builtinfunc" id="5167884">cap</span><span class="op" id="5167887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5167891">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167895">d</span><span class="op" id="5167896">.</span><span class="ident" id="5167897">t</span>&nbsp;<span class="op" id="5167899">=</span>&nbsp;<span class="ident" id="5167901">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167905">t</span>&nbsp;<span class="op" id="5167907">=</span>&nbsp;<span class="ident" id="5167909">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5167914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167917">return</span>&nbsp;<span class="ident" id="5167924">t</span><br>
<span class="lineno"></span><span class="op" id="5167926">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="5167929">//&nbsp;onepass&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5167989">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="5168030">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5168083">func</span>&nbsp;<span class="op" id="5168088">(</span><span class="ident" id="5168089">m</span>&nbsp;<span class="op" id="5168091">*</span><span class="ident" id="5168092">machine</span><span class="op" id="5168099">)</span>&nbsp;<span class="ident" id="5168101">onepass</span><span class="op" id="5168108">(</span><span class="ident" id="5168109">i</span>&nbsp;<span class="ident" id="5168111">input</span><span class="op" id="5168116">,</span>&nbsp;<span class="ident" id="5168118">pos</span>&nbsp;<span class="builtintype" id="5168122">int</span><span class="op" id="5168125">)</span>&nbsp;<span class="builtintype" id="5168127">bool</span>&nbsp;<span class="op" id="5168132">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168135">startCond</span>&nbsp;<span class="op" id="5168145">:=</span>&nbsp;<span class="ident" id="5168148">m</span><span class="op" id="5168149">.</span><span class="ident" id="5168150">re</span><span class="op" id="5168152">.</span><span class="ident" id="5168153">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168159">if</span>&nbsp;<span class="ident" id="5168162">startCond</span>&nbsp;<span class="op" id="5168172">==</span>&nbsp;<span class="op" id="5168175">^</span><span class="ident" id="5168176">syntax</span><span class="op" id="5168182">.</span><span class="ident" id="5168183">EmptyOp</span><span class="op" id="5168190">(</span><span class="num" id="5168191">0</span><span class="op" id="5168192">)</span>&nbsp;<span class="op" id="5168194">{</span>&nbsp;<span class="comment" id="5168196">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168212">return</span>&nbsp;<span class="ident" id="5168219">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5168226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168229">m</span><span class="op" id="5168230">.</span><span class="ident" id="5168231">matched</span>&nbsp;<span class="op" id="5168239">=</span>&nbsp;<span class="ident" id="5168241">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168248">for</span>&nbsp;<span class="ident" id="5168252">i</span>&nbsp;<span class="op" id="5168254">:=</span>&nbsp;<span class="keyword" id="5168257">range</span>&nbsp;<span class="ident" id="5168263">m</span><span class="op" id="5168264">.</span><span class="ident" id="5168265">matchcap</span>&nbsp;<span class="op" id="5168274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168278">m</span><span class="op" id="5168279">.</span><span class="ident" id="5168280">matchcap</span><span class="op" id="5168288">[</span><span class="ident" id="5168289">i</span><span class="op" id="5168290">]</span>&nbsp;<span class="op" id="5168292">=</span>&nbsp;<span class="op" id="5168294">-</span><span class="num" id="5168295">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5168298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168301">r</span><span class="op" id="5168302">,</span>&nbsp;<span class="ident" id="5168304">r1</span>&nbsp;<span class="op" id="5168307">:=</span>&nbsp;<span class="ident" id="5168310">endOfText</span><span class="op" id="5168319">,</span>&nbsp;<span class="ident" id="5168321">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168332">width</span><span class="op" id="5168337">,</span>&nbsp;<span class="ident" id="5168339">width1</span>&nbsp;<span class="op" id="5168346">:=</span>&nbsp;<span class="num" id="5168349">0</span><span class="op" id="5168350">,</span>&nbsp;<span class="num" id="5168352">0</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168355">r</span><span class="op" id="5168356">,</span>&nbsp;<span class="ident" id="5168358">width</span>&nbsp;<span class="op" id="5168364">=</span>&nbsp;<span class="ident" id="5168366">i</span><span class="op" id="5168367">.</span><span class="ident" id="5168368">step</span><span class="op" id="5168372">(</span><span class="ident" id="5168373">pos</span><span class="op" id="5168376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168379">if</span>&nbsp;<span class="ident" id="5168382">r</span>&nbsp;<span class="op" id="5168384">!=</span>&nbsp;<span class="ident" id="5168387">endOfText</span>&nbsp;<span class="op" id="5168397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168401">r1</span><span class="op" id="5168403">,</span>&nbsp;<span class="ident" id="5168405">width1</span>&nbsp;<span class="op" id="5168412">=</span>&nbsp;<span class="ident" id="5168414">i</span><span class="op" id="5168415">.</span><span class="ident" id="5168416">step</span><span class="op" id="5168420">(</span><span class="ident" id="5168421">pos</span>&nbsp;<span class="op" id="5168425">+</span>&nbsp;<span class="ident" id="5168427">width</span><span class="op" id="5168432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5168435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168438">var</span>&nbsp;<span class="ident" id="5168442">flag</span>&nbsp;<span class="ident" id="5168447">syntax</span><span class="op" id="5168453">.</span><span class="ident" id="5168454">EmptyOp</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168463">if</span>&nbsp;<span class="ident" id="5168466">pos</span>&nbsp;<span class="op" id="5168470">==</span>&nbsp;<span class="num" id="5168473">0</span>&nbsp;<span class="op" id="5168475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168479">flag</span>&nbsp;<span class="op" id="5168484">=</span>&nbsp;<span class="ident" id="5168486">syntax</span><span class="op" id="5168492">.</span><span class="ident" id="5168493">EmptyOpContext</span><span class="op" id="5168507">(</span><span class="op" id="5168508">-</span><span class="num" id="5168509">1</span><span class="op" id="5168510">,</span>&nbsp;<span class="ident" id="5168512">r</span><span class="op" id="5168513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5168516">}</span>&nbsp;<span class="keyword" id="5168518">else</span>&nbsp;<span class="op" id="5168523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168527">flag</span>&nbsp;<span class="op" id="5168532">=</span>&nbsp;<span class="ident" id="5168534">i</span><span class="op" id="5168535">.</span><span class="ident" id="5168536">context</span><span class="op" id="5168543">(</span><span class="ident" id="5168544">pos</span><span class="op" id="5168547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5168550">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168553">pc</span>&nbsp;<span class="op" id="5168556">:=</span>&nbsp;<span class="ident" id="5168559">m</span><span class="op" id="5168560">.</span><span class="ident" id="5168561">op</span><span class="op" id="5168563">.</span><span class="ident" id="5168564">Start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168571">inst</span>&nbsp;<span class="op" id="5168576">:=</span>&nbsp;<span class="ident" id="5168579">m</span><span class="op" id="5168580">.</span><span class="ident" id="5168581">op</span><span class="op" id="5168583">.</span><span class="ident" id="5168584">Inst</span><span class="op" id="5168588">[</span><span class="ident" id="5168589">pc</span><span class="op" id="5168591">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5168594">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;simple&nbsp;literal&nbsp;prefix,&nbsp;skip&nbsp;over&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168649">if</span>&nbsp;<span class="ident" id="5168652">pos</span>&nbsp;<span class="op" id="5168656">==</span>&nbsp;<span class="num" id="5168659">0</span>&nbsp;<span class="op" id="5168661">&amp;&amp;</span>&nbsp;<span class="ident" id="5168664">syntax</span><span class="op" id="5168670">.</span><span class="ident" id="5168671">EmptyOp</span><span class="op" id="5168678">(</span><span class="ident" id="5168679">inst</span><span class="op" id="5168683">.</span><span class="ident" id="5168684">Arg</span><span class="op" id="5168687">)</span><span class="op" id="5168688">&amp;^</span><span class="ident" id="5168690">flag</span>&nbsp;<span class="op" id="5168695">==</span>&nbsp;<span class="num" id="5168698">0</span>&nbsp;<span class="op" id="5168700">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5168705">len</span><span class="op" id="5168708">(</span><span class="ident" id="5168709">m</span><span class="op" id="5168710">.</span><span class="ident" id="5168711">re</span><span class="op" id="5168713">.</span><span class="ident" id="5168714">prefix</span><span class="op" id="5168720">)</span>&nbsp;<span class="op" id="5168722">&gt;</span>&nbsp;<span class="num" id="5168724">0</span>&nbsp;<span class="op" id="5168726">&amp;&amp;</span>&nbsp;<span class="ident" id="5168729">i</span><span class="op" id="5168730">.</span><span class="ident" id="5168731">canCheckPrefix</span><span class="op" id="5168745">(</span><span class="op" id="5168746">)</span>&nbsp;<span class="op" id="5168748">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5168752">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168808">if</span>&nbsp;<span class="ident" id="5168811">i</span><span class="op" id="5168812">.</span><span class="ident" id="5168813">hasPrefix</span><span class="op" id="5168822">(</span><span class="ident" id="5168823">m</span><span class="op" id="5168824">.</span><span class="ident" id="5168825">re</span><span class="op" id="5168827">)</span>&nbsp;<span class="op" id="5168829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168834">pos</span>&nbsp;<span class="op" id="5168838">+=</span>&nbsp;<span class="builtinfunc" id="5168841">len</span><span class="op" id="5168844">(</span><span class="ident" id="5168845">m</span><span class="op" id="5168846">.</span><span class="ident" id="5168847">re</span><span class="op" id="5168849">.</span><span class="ident" id="5168850">prefix</span><span class="op" id="5168856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168861">r</span><span class="op" id="5168862">,</span>&nbsp;<span class="ident" id="5168864">width</span>&nbsp;<span class="op" id="5168870">=</span>&nbsp;<span class="ident" id="5168872">i</span><span class="op" id="5168873">.</span><span class="ident" id="5168874">step</span><span class="op" id="5168878">(</span><span class="ident" id="5168879">pos</span><span class="op" id="5168882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168887">r1</span><span class="op" id="5168889">,</span>&nbsp;<span class="ident" id="5168891">width1</span>&nbsp;<span class="op" id="5168898">=</span>&nbsp;<span class="ident" id="5168900">i</span><span class="op" id="5168901">.</span><span class="ident" id="5168902">step</span><span class="op" id="5168906">(</span><span class="ident" id="5168907">pos</span>&nbsp;<span class="op" id="5168911">+</span>&nbsp;<span class="ident" id="5168913">width</span><span class="op" id="5168918">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168923">flag</span>&nbsp;<span class="op" id="5168928">=</span>&nbsp;<span class="ident" id="5168930">i</span><span class="op" id="5168931">.</span><span class="ident" id="5168932">context</span><span class="op" id="5168939">(</span><span class="ident" id="5168940">pos</span><span class="op" id="5168943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168948">pc</span>&nbsp;<span class="op" id="5168951">=</span>&nbsp;<span class="builtintype" id="5168953">int</span><span class="op" id="5168956">(</span><span class="ident" id="5168957">m</span><span class="op" id="5168958">.</span><span class="ident" id="5168959">re</span><span class="op" id="5168961">.</span><span class="ident" id="5168962">prefixEnd</span><span class="op" id="5168971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5168975">}</span>&nbsp;<span class="keyword" id="5168977">else</span>&nbsp;<span class="op" id="5168982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168987">return</span>&nbsp;<span class="ident" id="5168994">m</span><span class="op" id="5168995">.</span><span class="ident" id="5168996">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169006">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169012">for</span>&nbsp;<span class="op" id="5169016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169020">inst</span>&nbsp;<span class="op" id="5169025">=</span>&nbsp;<span class="ident" id="5169027">m</span><span class="op" id="5169028">.</span><span class="ident" id="5169029">op</span><span class="op" id="5169031">.</span><span class="ident" id="5169032">Inst</span><span class="op" id="5169036">[</span><span class="ident" id="5169037">pc</span><span class="op" id="5169039">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169043">pc</span>&nbsp;<span class="op" id="5169046">=</span>&nbsp;<span class="builtintype" id="5169048">int</span><span class="op" id="5169051">(</span><span class="ident" id="5169052">inst</span><span class="op" id="5169056">.</span><span class="ident" id="5169057">Out</span><span class="op" id="5169060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169064">switch</span>&nbsp;<span class="ident" id="5169071">inst</span><span class="op" id="5169075">.</span><span class="ident" id="5169076">Op</span>&nbsp;<span class="op" id="5169079">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169083">default</span><span class="op" id="5169090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5169095">panic</span><span class="op" id="5169100">(</span><span class="string" id="5169101">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5169111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169115">case</span>&nbsp;<span class="ident" id="5169120">syntax</span><span class="op" id="5169126">.</span><span class="ident" id="5169127">InstMatch</span><span class="op" id="5169136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169141">m</span><span class="op" id="5169142">.</span><span class="ident" id="5169143">matched</span>&nbsp;<span class="op" id="5169151">=</span>&nbsp;<span class="ident" id="5169153">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169161">if</span>&nbsp;<span class="builtinfunc" id="5169164">len</span><span class="op" id="5169167">(</span><span class="ident" id="5169168">m</span><span class="op" id="5169169">.</span><span class="ident" id="5169170">matchcap</span><span class="op" id="5169178">)</span>&nbsp;<span class="op" id="5169180">&gt;</span>&nbsp;<span class="num" id="5169182">0</span>&nbsp;<span class="op" id="5169184">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169190">m</span><span class="op" id="5169191">.</span><span class="ident" id="5169192">matchcap</span><span class="op" id="5169200">[</span><span class="num" id="5169201">0</span><span class="op" id="5169202">]</span>&nbsp;<span class="op" id="5169204">=</span>&nbsp;<span class="num" id="5169206">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169212">m</span><span class="op" id="5169213">.</span><span class="ident" id="5169214">matchcap</span><span class="op" id="5169222">[</span><span class="num" id="5169223">1</span><span class="op" id="5169224">]</span>&nbsp;<span class="op" id="5169226">=</span>&nbsp;<span class="ident" id="5169228">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169240">return</span>&nbsp;<span class="ident" id="5169247">m</span><span class="op" id="5169248">.</span><span class="ident" id="5169249">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169259">case</span>&nbsp;<span class="ident" id="5169264">syntax</span><span class="op" id="5169270">.</span><span class="ident" id="5169271">InstRune</span><span class="op" id="5169279">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169284">if</span>&nbsp;<span class="op" id="5169287">!</span><span class="ident" id="5169288">inst</span><span class="op" id="5169292">.</span><span class="ident" id="5169293">MatchRune</span><span class="op" id="5169302">(</span><span class="ident" id="5169303">r</span><span class="op" id="5169304">)</span>&nbsp;<span class="op" id="5169306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169312">return</span>&nbsp;<span class="ident" id="5169319">m</span><span class="op" id="5169320">.</span><span class="ident" id="5169321">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169336">case</span>&nbsp;<span class="ident" id="5169341">syntax</span><span class="op" id="5169347">.</span><span class="ident" id="5169348">InstRune1</span><span class="op" id="5169357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169362">if</span>&nbsp;<span class="ident" id="5169365">r</span>&nbsp;<span class="op" id="5169367">!=</span>&nbsp;<span class="ident" id="5169370">inst</span><span class="op" id="5169374">.</span><span class="ident" id="5169375">Rune</span><span class="op" id="5169379">[</span><span class="num" id="5169380">0</span><span class="op" id="5169381">]</span>&nbsp;<span class="op" id="5169383">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169389">return</span>&nbsp;<span class="ident" id="5169396">m</span><span class="op" id="5169397">.</span><span class="ident" id="5169398">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169413">case</span>&nbsp;<span class="ident" id="5169418">syntax</span><span class="op" id="5169424">.</span><span class="ident" id="5169425">InstRuneAny</span><span class="op" id="5169436">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5169441">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169454">case</span>&nbsp;<span class="ident" id="5169459">syntax</span><span class="op" id="5169465">.</span><span class="ident" id="5169466">InstRuneAnyNotNL</span><span class="op" id="5169482">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169487">if</span>&nbsp;<span class="ident" id="5169490">r</span>&nbsp;<span class="op" id="5169492">==</span>&nbsp;<span class="string" id="5169495">&#39;\n&#39;</span>&nbsp;<span class="op" id="5169500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169506">return</span>&nbsp;<span class="ident" id="5169513">m</span><span class="op" id="5169514">.</span><span class="ident" id="5169515">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5169530">//&nbsp;peek&nbsp;at&nbsp;the&nbsp;input&nbsp;rune&nbsp;to&nbsp;see&nbsp;which&nbsp;branch&nbsp;of&nbsp;the&nbsp;Alt&nbsp;to&nbsp;take</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169597">case</span>&nbsp;<span class="ident" id="5169602">syntax</span><span class="op" id="5169608">.</span><span class="ident" id="5169609">InstAlt</span><span class="op" id="5169616">,</span>&nbsp;<span class="ident" id="5169618">syntax</span><span class="op" id="5169624">.</span><span class="ident" id="5169625">InstAltMatch</span><span class="op" id="5169637">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169642">pc</span>&nbsp;<span class="op" id="5169645">=</span>&nbsp;<span class="builtintype" id="5169647">int</span><span class="op" id="5169650">(</span><span class="ident" id="5169651">onePassNext</span><span class="op" id="5169662">(</span><span class="op" id="5169663">&amp;</span><span class="ident" id="5169664">inst</span><span class="op" id="5169668">,</span>&nbsp;<span class="ident" id="5169670">r</span><span class="op" id="5169671">)</span><span class="op" id="5169672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169677">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169688">case</span>&nbsp;<span class="ident" id="5169693">syntax</span><span class="op" id="5169699">.</span><span class="ident" id="5169700">InstFail</span><span class="op" id="5169708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169713">return</span>&nbsp;<span class="ident" id="5169720">m</span><span class="op" id="5169721">.</span><span class="ident" id="5169722">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169732">case</span>&nbsp;<span class="ident" id="5169737">syntax</span><span class="op" id="5169743">.</span><span class="ident" id="5169744">InstNop</span><span class="op" id="5169751">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169756">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169767">case</span>&nbsp;<span class="ident" id="5169772">syntax</span><span class="op" id="5169778">.</span><span class="ident" id="5169779">InstEmptyWidth</span><span class="op" id="5169793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169798">if</span>&nbsp;<span class="ident" id="5169801">syntax</span><span class="op" id="5169807">.</span><span class="ident" id="5169808">EmptyOp</span><span class="op" id="5169815">(</span><span class="ident" id="5169816">inst</span><span class="op" id="5169820">.</span><span class="ident" id="5169821">Arg</span><span class="op" id="5169824">)</span><span class="op" id="5169825">&amp;^</span><span class="ident" id="5169827">flag</span>&nbsp;<span class="op" id="5169832">!=</span>&nbsp;<span class="num" id="5169835">0</span>&nbsp;<span class="op" id="5169837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169843">return</span>&nbsp;<span class="ident" id="5169850">m</span><span class="op" id="5169851">.</span><span class="ident" id="5169852">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169863">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169868">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169879">case</span>&nbsp;<span class="ident" id="5169884">syntax</span><span class="op" id="5169890">.</span><span class="ident" id="5169891">InstCapture</span><span class="op" id="5169902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169907">if</span>&nbsp;<span class="builtintype" id="5169910">int</span><span class="op" id="5169913">(</span><span class="ident" id="5169914">inst</span><span class="op" id="5169918">.</span><span class="ident" id="5169919">Arg</span><span class="op" id="5169922">)</span>&nbsp;<span class="op" id="5169924">&lt;</span>&nbsp;<span class="builtinfunc" id="5169926">len</span><span class="op" id="5169929">(</span><span class="ident" id="5169930">m</span><span class="op" id="5169931">.</span><span class="ident" id="5169932">matchcap</span><span class="op" id="5169940">)</span>&nbsp;<span class="op" id="5169942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169948">m</span><span class="op" id="5169949">.</span><span class="ident" id="5169950">matchcap</span><span class="op" id="5169958">[</span><span class="ident" id="5169959">inst</span><span class="op" id="5169963">.</span><span class="ident" id="5169964">Arg</span><span class="op" id="5169967">]</span>&nbsp;<span class="op" id="5169969">=</span>&nbsp;<span class="ident" id="5169971">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169978">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169983">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169998">if</span>&nbsp;<span class="ident" id="5170001">width</span>&nbsp;<span class="op" id="5170007">==</span>&nbsp;<span class="num" id="5170010">0</span>&nbsp;<span class="op" id="5170012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5170017">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5170025">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5170029">flag</span>&nbsp;<span class="op" id="5170034">=</span>&nbsp;<span class="ident" id="5170036">syntax</span><span class="op" id="5170042">.</span><span class="ident" id="5170043">EmptyOpContext</span><span class="op" id="5170057">(</span><span class="ident" id="5170058">r</span><span class="op" id="5170059">,</span>&nbsp;<span class="ident" id="5170061">r1</span><span class="op" id="5170063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5170067">pos</span>&nbsp;<span class="op" id="5170071">+=</span>&nbsp;<span class="ident" id="5170074">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5170082">r</span><span class="op" id="5170083">,</span>&nbsp;<span class="ident" id="5170085">width</span>&nbsp;<span class="op" id="5170091">=</span>&nbsp;<span class="ident" id="5170093">r1</span><span class="op" id="5170095">,</span>&nbsp;<span class="ident" id="5170097">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5170106">if</span>&nbsp;<span class="ident" id="5170109">r</span>&nbsp;<span class="op" id="5170111">!=</span>&nbsp;<span class="ident" id="5170114">endOfText</span>&nbsp;<span class="op" id="5170124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5170129">r1</span><span class="op" id="5170131">,</span>&nbsp;<span class="ident" id="5170133">width1</span>&nbsp;<span class="op" id="5170140">=</span>&nbsp;<span class="ident" id="5170142">i</span><span class="op" id="5170143">.</span><span class="ident" id="5170144">step</span><span class="op" id="5170148">(</span><span class="ident" id="5170149">pos</span>&nbsp;<span class="op" id="5170153">+</span>&nbsp;<span class="ident" id="5170155">width</span><span class="op" id="5170160">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5170164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5170167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5170170">return</span>&nbsp;<span class="ident" id="5170177">m</span><span class="op" id="5170178">.</span><span class="ident" id="5170179">matched</span><br>
<span class="lineno"></span><span class="op" id="5170187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="5170190">//&nbsp;empty&nbsp;is&nbsp;a&nbsp;non-nil&nbsp;0-element&nbsp;slice,</span><br>
<span class="lineno"></span><span class="comment" id="5170229">//&nbsp;so&nbsp;doExecute&nbsp;can&nbsp;avoid&nbsp;an&nbsp;allocation</span><br>
<span class="lineno"></span><span class="comment" id="5170269">//&nbsp;when&nbsp;0&nbsp;captures&nbsp;are&nbsp;requested&nbsp;from&nbsp;a&nbsp;successful&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5170327">var</span>&nbsp;<span class="ident" id="5170331">empty</span>&nbsp;<span class="op" id="5170337">=</span>&nbsp;<span class="builtinfunc" id="5170339">make</span><span class="op" id="5170343">(</span><span class="op" id="5170344">[</span><span class="op" id="5170345">]</span><span class="builtintype" id="5170346">int</span><span class="op" id="5170349">,</span>&nbsp;<span class="num" id="5170351">0</span><span class="op" id="5170352">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="5170355">//&nbsp;doExecute&nbsp;finds&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;the&nbsp;input&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5170418">//&nbsp;the&nbsp;position&nbsp;of&nbsp;its&nbsp;subexpressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5170457">func</span>&nbsp;<span class="op" id="5170462">(</span><span class="ident" id="5170463">re</span>&nbsp;<span class="op" id="5170466">*</span><span class="ident" id="5170467">Regexp</span><span class="op" id="5170473">)</span>&nbsp;<span class="ident" id="5170475">doExecute</span><span class="op" id="5170484">(</span><span class="ident" id="5170485">r</span>&nbsp;<span class="ident" id="5170487">io</span><span class="op" id="5170489">.</span><span class="ident" id="5170490">RuneReader</span><span class="op" id="5170500">,</span>&nbsp;<span class="ident" id="5170502">b</span>&nbsp;<span class="op" id="5170504">[</span><span class="op" id="5170505">]</span><span class="builtintype" id="5170506">byte</span><span class="op" id="5170510">,</span>&nbsp;<span class="ident" id="5170512">s</span>&nbsp;<span class="builtintype" id="5170514">string</span><span class="op" id="5170520">,</span>&nbsp;<span class="ident" id="5170522">pos</span>&nbsp;<span class="builtintype" id="5170526">int</span><span class="op" id="5170529">,</span>&nbsp;<span class="ident" id="5170531">ncap</span>&nbsp;<span class="builtintype" id="5170536">int</span><span class="op" id="5170539">)</span>&nbsp;<span class="op" id="5170541">[</span><span class="op" id="5170542">]</span><span class="builtintype" id="5170543">int</span>&nbsp;<span class="op" id="5170547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5170550">m</span>&nbsp;<span class="op" id="5170552">:=</span>&nbsp;<span class="ident" id="5170555">re</span><span class="op" id="5170557">.</span><span class="ident" id="5170558">get</span><span class="op" id="5170561">(</span><span class="op" id="5170562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5170565">var</span>&nbsp;<span class="ident" id="5170569">i</span>&nbsp;<span class="ident" id="5170571">input</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5170578">if</span>&nbsp;<span class="ident" id="5170581">r</span>&nbsp;<span class="op" id="5170583">!=</span>&nbsp;<span class="ident" id="5170586">nil</span>&nbsp;<span class="op" id="5170590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5170594">i</span>&nbsp;<span class="op" id="5170596">=</span>&nbsp;<span class="ident" id="5170598">m</span><span class="op" id="5170599">.</span><span class="ident" id="5170600">newInputReader</span><span class="op" id="5170614">(</span><span class="ident" id="5170615">r</span><span class="op" id="5170616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5170619">}</span>&nbsp;<span class="keyword" id="5170621">else</span>&nbsp;<span class="keyword" id="5170626">if</span>&nbsp;<span class="ident" id="5170629">b</span>&nbsp;<span class="op" id="5170631">!=</span>&nbsp;<span class="ident" id="5170634">nil</span>&nbsp;<span class="op" id="5170638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5170642">i</span>&nbsp;<span class="op" id="5170644">=</span>&nbsp;<span class="ident" id="5170646">m</span><span class="op" id="5170647">.</span><span class="ident" id="5170648">newInputBytes</span><span class="op" id="5170661">(</span><span class="ident" id="5170662">b</span><span class="op" id="5170663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5170666">}</span>&nbsp;<span class="keyword" id="5170668">else</span>&nbsp;<span class="op" id="5170673">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5170677">i</span>&nbsp;<span class="op" id="5170679">=</span>&nbsp;<span class="ident" id="5170681">m</span><span class="op" id="5170682">.</span><span class="ident" id="5170683">newInputString</span><span class="op" id="5170697">(</span><span class="ident" id="5170698">s</span><span class="op" id="5170699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5170702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5170705">if</span>&nbsp;<span class="ident" id="5170708">m</span><span class="op" id="5170709">.</span><span class="ident" id="5170710">op</span>&nbsp;<span class="op" id="5170713">!=</span>&nbsp;<span class="ident" id="5170716">notOnePass</span>&nbsp;<span class="op" id="5170727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5170731">if</span>&nbsp;<span class="op" id="5170734">!</span><span class="ident" id="5170735">m</span><span class="op" id="5170736">.</span><span class="ident" id="5170737">onepass</span><span class="op" id="5170744">(</span><span class="ident" id="5170745">i</span><span class="op" id="5170746">,</span>&nbsp;<span class="ident" id="5170748">pos</span><span class="op" id="5170751">)</span>&nbsp;<span class="op" id="5170753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5170758">re</span><span class="op" id="5170760">.</span><span class="ident" id="5170761">put</span><span class="op" id="5170764">(</span><span class="ident" id="5170765">m</span><span class="op" id="5170766">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5170771">return</span>&nbsp;<span class="ident" id="5170778">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5170784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5170787">}</span>&nbsp;<span class="keyword" id="5170789">else</span>&nbsp;<span class="op" id="5170794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5170798">m</span><span class="op" id="5170799">.</span><span class="ident" id="5170800">init</span><span class="op" id="5170804">(</span><span class="ident" id="5170805">ncap</span><span class="op" id="5170809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5170813">if</span>&nbsp;<span class="op" id="5170816">!</span><span class="ident" id="5170817">m</span><span class="op" id="5170818">.</span><span class="ident" id="5170819">match</span><span class="op" id="5170824">(</span><span class="ident" id="5170825">i</span><span class="op" id="5170826">,</span>&nbsp;<span class="ident" id="5170828">pos</span><span class="op" id="5170831">)</span>&nbsp;<span class="op" id="5170833">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5170838">re</span><span class="op" id="5170840">.</span><span class="ident" id="5170841">put</span><span class="op" id="5170844">(</span><span class="ident" id="5170845">m</span><span class="op" id="5170846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5170851">return</span>&nbsp;<span class="ident" id="5170858">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5170864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5170867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5170870">if</span>&nbsp;<span class="ident" id="5170873">ncap</span>&nbsp;<span class="op" id="5170878">==</span>&nbsp;<span class="num" id="5170881">0</span>&nbsp;<span class="op" id="5170883">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5170887">re</span><span class="op" id="5170889">.</span><span class="ident" id="5170890">put</span><span class="op" id="5170893">(</span><span class="ident" id="5170894">m</span><span class="op" id="5170895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5170899">return</span>&nbsp;<span class="ident" id="5170906">empty</span>&nbsp;<span class="comment" id="5170912">//&nbsp;empty&nbsp;but&nbsp;not&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5170934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5170937">cap</span>&nbsp;<span class="op" id="5170941">:=</span>&nbsp;<span class="builtinfunc" id="5170944">make</span><span class="op" id="5170948">(</span><span class="op" id="5170949">[</span><span class="op" id="5170950">]</span><span class="builtintype" id="5170951">int</span><span class="op" id="5170954">,</span>&nbsp;<span class="builtinfunc" id="5170956">len</span><span class="op" id="5170959">(</span><span class="ident" id="5170960">m</span><span class="op" id="5170961">.</span><span class="ident" id="5170962">matchcap</span><span class="op" id="5170970">)</span><span class="op" id="5170971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5170974">copy</span><span class="op" id="5170978">(</span><span class="builtinfunc" id="5170979">cap</span><span class="op" id="5170982">,</span>&nbsp;<span class="ident" id="5170984">m</span><span class="op" id="5170985">.</span><span class="ident" id="5170986">matchcap</span><span class="op" id="5170994">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5170997">re</span><span class="op" id="5170999">.</span><span class="ident" id="5171000">put</span><span class="op" id="5171003">(</span><span class="ident" id="5171004">m</span><span class="op" id="5171005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5171008">return</span>&nbsp;<span class="builtinfunc" id="5171015">cap</span><br>
<span class="lineno"></span><span class="op" id="5171019">}</span>
</div>
</body>
</html>
