<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5492239">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5492294">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5492348">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5492399">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;host&nbsp;side&nbsp;of&nbsp;CGI&nbsp;(being&nbsp;the&nbsp;webserver</span><br>
<span class="lineno"></span><span class="comment" id="5492465">//&nbsp;parent&nbsp;process).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5492486">//&nbsp;Package&nbsp;cgi&nbsp;implements&nbsp;CGI&nbsp;(Common&nbsp;Gateway&nbsp;Interface)&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5492556">//&nbsp;in&nbsp;RFC&nbsp;3875.</span><br>
<span class="lineno">10</span><span class="comment" id="5492572">//</span><br>
<span class="lineno"></span><span class="comment" id="5492575">//&nbsp;Note&nbsp;that&nbsp;using&nbsp;CGI&nbsp;means&nbsp;starting&nbsp;a&nbsp;new&nbsp;process&nbsp;to&nbsp;handle&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="5492642">//&nbsp;request,&nbsp;which&nbsp;is&nbsp;typically&nbsp;less&nbsp;efficient&nbsp;than&nbsp;using&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5492701">//&nbsp;long-running&nbsp;server.&nbsp;&nbsp;This&nbsp;package&nbsp;is&nbsp;intended&nbsp;primarily&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5492765">//&nbsp;compatibility&nbsp;with&nbsp;existing&nbsp;systems.</span><br>
<span class="lineno">15</span><span class="keyword" id="5492805">package</span>&nbsp;<span class="ident" id="5492813">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5492818">import</span>&nbsp;<span class="op" id="5492825">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5492828">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5492837">&#34;fmt&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5492844">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5492850">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5492857">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5492869">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5492875">&#34;os/exec&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5492886">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5492903">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5492913">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5492924">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5492935">&#34;strings&#34;</span><br>
<span class="lineno">30</span><span class="op" id="5492945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5492948">var</span>&nbsp;<span class="ident" id="5492952">trailingPort</span>&nbsp;<span class="op" id="5492965">=</span>&nbsp;<span class="ident" id="5492967"><a href="/net/http/cgi/host.go.html#5492903">regexp</a></span><span class="op" id="5492973">.</span><span class="ident" id="5492974">MustCompile</span><span class="op" id="5492985">(</span><span class="string" id="5492986">`:([0-9]+)$`</span><span class="op" id="5492998">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5493001">var</span>&nbsp;<span class="ident" id="5493005">osDefaultInheritEnv</span>&nbsp;<span class="op" id="5493025">=</span>&nbsp;<span class="keyword" id="5493027">map</span><span class="op" id="5493030">[</span><span class="builtintype" id="5493031">string</span><span class="op" id="5493037">]</span><span class="op" id="5493038">[</span><span class="op" id="5493039">]</span><span class="builtintype" id="5493040">string</span><span class="op" id="5493046">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5493049">&#34;darwin&#34;</span><span class="op" id="5493057">:</span>&nbsp;&nbsp;<span class="op" id="5493060">{</span><span class="string" id="5493061">&#34;DYLD_LIBRARY_PATH&#34;</span><span class="op" id="5493080">}</span><span class="op" id="5493081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5493084">&#34;freebsd&#34;</span><span class="op" id="5493093">:</span>&nbsp;<span class="op" id="5493095">{</span><span class="string" id="5493096">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5493113">}</span><span class="op" id="5493114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5493117">&#34;hpux&#34;</span><span class="op" id="5493123">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493128">{</span><span class="string" id="5493129">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5493146">,</span>&nbsp;<span class="string" id="5493148">&#34;SHLIB_PATH&#34;</span><span class="op" id="5493160">}</span><span class="op" id="5493161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5493164">&#34;irix&#34;</span><span class="op" id="5493170">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493175">{</span><span class="string" id="5493176">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5493193">,</span>&nbsp;<span class="string" id="5493195">&#34;LD_LIBRARYN32_PATH&#34;</span><span class="op" id="5493215">,</span>&nbsp;<span class="string" id="5493217">&#34;LD_LIBRARY64_PATH&#34;</span><span class="op" id="5493236">}</span><span class="op" id="5493237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5493240">&#34;linux&#34;</span><span class="op" id="5493247">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5493251">{</span><span class="string" id="5493252">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5493269">}</span><span class="op" id="5493270">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5493273">&#34;openbsd&#34;</span><span class="op" id="5493282">:</span>&nbsp;<span class="op" id="5493284">{</span><span class="string" id="5493285">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5493302">}</span><span class="op" id="5493303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5493306">&#34;solaris&#34;</span><span class="op" id="5493315">:</span>&nbsp;<span class="op" id="5493317">{</span><span class="string" id="5493318">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5493335">,</span>&nbsp;<span class="string" id="5493337">&#34;LD_LIBRARY_PATH_32&#34;</span><span class="op" id="5493357">,</span>&nbsp;<span class="string" id="5493359">&#34;LD_LIBRARY_PATH_64&#34;</span><span class="op" id="5493379">}</span><span class="op" id="5493380">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5493383">&#34;windows&#34;</span><span class="op" id="5493392">:</span>&nbsp;<span class="op" id="5493394">{</span><span class="string" id="5493395">&#34;SystemRoot&#34;</span><span class="op" id="5493407">,</span>&nbsp;<span class="string" id="5493409">&#34;COMSPEC&#34;</span><span class="op" id="5493418">,</span>&nbsp;<span class="string" id="5493420">&#34;PATHEXT&#34;</span><span class="op" id="5493429">,</span>&nbsp;<span class="string" id="5493431">&#34;WINDIR&#34;</span><span class="op" id="5493439">}</span><span class="op" id="5493440">,</span><br>
<span class="lineno"></span><span class="op" id="5493442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5493445">//&nbsp;Handler&nbsp;runs&nbsp;an&nbsp;executable&nbsp;in&nbsp;a&nbsp;subprocess&nbsp;with&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="keyword" id="5493515">type</span>&nbsp;<span class="ident" id="5493520">Handler</span>&nbsp;<span class="keyword" id="5493528">struct</span>&nbsp;<span class="op" id="5493535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493538">Path</span>&nbsp;<span class="builtintype" id="5493543">string</span>&nbsp;<span class="comment" id="5493550">//&nbsp;path&nbsp;to&nbsp;the&nbsp;CGI&nbsp;executable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493581">Root</span>&nbsp;<span class="builtintype" id="5493586">string</span>&nbsp;<span class="comment" id="5493593">//&nbsp;root&nbsp;URI&nbsp;prefix&nbsp;of&nbsp;handler&nbsp;or&nbsp;empty&nbsp;for&nbsp;&#34;/&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493642">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;CGI&nbsp;executable&#39;s&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493700">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;empty,&nbsp;the&nbsp;base&nbsp;directory&nbsp;of&nbsp;Path&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493757">//&nbsp;If&nbsp;Path&nbsp;has&nbsp;no&nbsp;base&nbsp;directory,&nbsp;the&nbsp;current&nbsp;working</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493812">//&nbsp;directory&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493835">Dir</span>&nbsp;<span class="builtintype" id="5493839">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493848">Env</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493859">[</span><span class="op" id="5493860">]</span><span class="builtintype" id="5493861">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493871">//&nbsp;extra&nbsp;environment&nbsp;variables&nbsp;to&nbsp;set,&nbsp;if&nbsp;any,&nbsp;as&nbsp;&#34;key=value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493934">InheritEnv</span>&nbsp;<span class="op" id="5493945">[</span><span class="op" id="5493946">]</span><span class="builtintype" id="5493947">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493957">//&nbsp;environment&nbsp;variables&nbsp;to&nbsp;inherit&nbsp;from&nbsp;host,&nbsp;as&nbsp;&#34;key&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494014">Logger</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494025">*</span><span class="ident" id="5494026"><a href="/net/http/cgi/host.go.html#5492850">log</a></span><span class="op" id="5494029">.</span><span class="ident" id="5494030">Logger</span>&nbsp;<span class="comment" id="5494037">//&nbsp;optional&nbsp;log&nbsp;for&nbsp;errors&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;log.Print</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494089">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494100">[</span><span class="op" id="5494101">]</span><span class="builtintype" id="5494102">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494112">//&nbsp;optional&nbsp;arguments&nbsp;to&nbsp;pass&nbsp;to&nbsp;child&nbsp;process</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494161">//&nbsp;PathLocationHandler&nbsp;specifies&nbsp;the&nbsp;root&nbsp;http&nbsp;Handler&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494222">//&nbsp;should&nbsp;handle&nbsp;internal&nbsp;redirects&nbsp;when&nbsp;the&nbsp;CGI&nbsp;process</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494280">//&nbsp;returns&nbsp;a&nbsp;Location&nbsp;header&nbsp;value&nbsp;starting&nbsp;with&nbsp;a&nbsp;&#34;/&#34;,&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494340">//&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;3875&nbsp;§&nbsp;6.3.2.&nbsp;This&nbsp;will&nbsp;likely&nbsp;be</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494396">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494422">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494426">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;CGI&nbsp;response&nbsp;with&nbsp;a&nbsp;local&nbsp;URI&nbsp;path&nbsp;is&nbsp;instead&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494491">//&nbsp;back&nbsp;to&nbsp;the&nbsp;client&nbsp;and&nbsp;not&nbsp;redirected&nbsp;internally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494545">PathLocationHandler</span>&nbsp;<span class="ident" id="5494565"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5494569">.</span><span class="ident" id="5494570">Handler</span><br>
<span class="lineno">70</span><span class="op" id="5494578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5494581">//&nbsp;removeLeadingDuplicates&nbsp;remove&nbsp;leading&nbsp;duplicate&nbsp;in&nbsp;environments.</span><br>
<span class="lineno"></span><span class="comment" id="5494650">//&nbsp;It&#39;s&nbsp;possible&nbsp;to&nbsp;override&nbsp;environment&nbsp;like&nbsp;following.</span><br>
<span class="lineno"></span><span class="comment" id="5494707">//&nbsp;&nbsp;&nbsp;&nbsp;cgi.Handler{</span><br>
<span class="lineno">75</span><span class="comment" id="5494726">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5494738">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Env:&nbsp;[]string{&#34;SCRIPT_FILENAME=foo.php&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="5494788">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="5494796">func</span>&nbsp;<span class="ident" id="5494801">removeLeadingDuplicates</span><span class="op" id="5494824">(</span><span class="ident" id="5494825">env</span>&nbsp;<span class="op" id="5494829">[</span><span class="op" id="5494830">]</span><span class="builtintype" id="5494831">string</span><span class="op" id="5494837">)</span>&nbsp;<span class="op" id="5494839">(</span><span class="ident" id="5494840">ret</span>&nbsp;<span class="op" id="5494844">[</span><span class="op" id="5494845">]</span><span class="builtintype" id="5494846">string</span><span class="op" id="5494852">)</span>&nbsp;<span class="op" id="5494854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494857">n</span>&nbsp;<span class="op" id="5494859">:=</span>&nbsp;<span class="builtinfunc" id="5494862">len</span><span class="op" id="5494865">(</span><span class="ident" id="5494866"><a href="/net/http/cgi/host.go.html#5494825">env</a></span><span class="op" id="5494869">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494872">for</span>&nbsp;<span class="ident" id="5494876">i</span>&nbsp;<span class="op" id="5494878">:=</span>&nbsp;<span class="num" id="5494881">0</span><span class="op" id="5494882">;</span>&nbsp;<span class="ident" id="5494884"><a href="/net/http/cgi/host.go.html#5494876">i</a></span>&nbsp;<span class="op" id="5494886">&lt;</span>&nbsp;<span class="ident" id="5494888"><a href="/net/http/cgi/host.go.html#5494857">n</a></span><span class="op" id="5494889">;</span>&nbsp;<span class="ident" id="5494891"><a href="/net/http/cgi/host.go.html#5494876">i</a></span><span class="op" id="5494892">++</span>&nbsp;<span class="op" id="5494895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494899">e</span>&nbsp;<span class="op" id="5494901">:=</span>&nbsp;<span class="ident" id="5494904"><a href="/net/http/cgi/host.go.html#5494825">env</a></span><span class="op" id="5494907">[</span><span class="ident" id="5494908"><a href="/net/http/cgi/host.go.html#5494876">i</a></span><span class="op" id="5494909">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494913">s</span>&nbsp;<span class="op" id="5494915">:=</span>&nbsp;<span class="ident" id="5494918"><a href="/net/http/cgi/host.go.html#5492935">strings</a></span><span class="op" id="5494925">.</span><span class="ident" id="5494926">SplitN</span><span class="op" id="5494932">(</span><span class="ident" id="5494933"><a href="/net/http/cgi/host.go.html#5494899">e</a></span><span class="op" id="5494934">,</span>&nbsp;<span class="string" id="5494936">&#34;=&#34;</span><span class="op" id="5494939">,</span>&nbsp;<span class="num" id="5494941">2</span><span class="op" id="5494942">)</span><span class="op" id="5494943">[</span><span class="num" id="5494944">0</span><span class="op" id="5494945">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494949">found</span>&nbsp;<span class="op" id="5494955">:=</span>&nbsp;<span class="ident" id="5494958">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494966">for</span>&nbsp;<span class="ident" id="5494970">j</span>&nbsp;<span class="op" id="5494972">:=</span>&nbsp;<span class="ident" id="5494975"><a href="/net/http/cgi/host.go.html#5494876">i</a></span>&nbsp;<span class="op" id="5494977">+</span>&nbsp;<span class="num" id="5494979">1</span><span class="op" id="5494980">;</span>&nbsp;<span class="ident" id="5494982"><a href="/net/http/cgi/host.go.html#5494970">j</a></span>&nbsp;<span class="op" id="5494984">&lt;</span>&nbsp;<span class="ident" id="5494986"><a href="/net/http/cgi/host.go.html#5494857">n</a></span><span class="op" id="5494987">;</span>&nbsp;<span class="ident" id="5494989"><a href="/net/http/cgi/host.go.html#5494970">j</a></span><span class="op" id="5494990">++</span>&nbsp;<span class="op" id="5494993">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494998">if</span>&nbsp;<span class="ident" id="5495001"><a href="/net/http/cgi/host.go.html#5494913">s</a></span>&nbsp;<span class="op" id="5495003">==</span>&nbsp;<span class="ident" id="5495006"><a href="/net/http/cgi/host.go.html#5492935">strings</a></span><span class="op" id="5495013">.</span><span class="ident" id="5495014">SplitN</span><span class="op" id="5495020">(</span><span class="ident" id="5495021"><a href="/net/http/cgi/host.go.html#5494825">env</a></span><span class="op" id="5495024">[</span><span class="ident" id="5495025"><a href="/net/http/cgi/host.go.html#5494970">j</a></span><span class="op" id="5495026">]</span><span class="op" id="5495027">,</span>&nbsp;<span class="string" id="5495029">&#34;=&#34;</span><span class="op" id="5495032">,</span>&nbsp;<span class="num" id="5495034">2</span><span class="op" id="5495035">)</span><span class="op" id="5495036">[</span><span class="num" id="5495037">0</span><span class="op" id="5495038">]</span>&nbsp;<span class="op" id="5495040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495046"><a href="/net/http/cgi/host.go.html#5494949">found</a></span>&nbsp;<span class="op" id="5495052">=</span>&nbsp;<span class="ident" id="5495054">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495063">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495076">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495080">if</span>&nbsp;<span class="op" id="5495083">!</span><span class="ident" id="5495084"><a href="/net/http/cgi/host.go.html#5494949">found</a></span>&nbsp;<span class="op" id="5495090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495095"><a href="/net/http/cgi/host.go.html#5494840">ret</a></span>&nbsp;<span class="op" id="5495099">=</span>&nbsp;<span class="builtinfunc" id="5495101">append</span><span class="op" id="5495107">(</span><span class="ident" id="5495108"><a href="/net/http/cgi/host.go.html#5494840">ret</a></span><span class="op" id="5495111">,</span>&nbsp;<span class="ident" id="5495113"><a href="/net/http/cgi/host.go.html#5494899">e</a></span><span class="op" id="5495114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495124">return</span><br>
<span class="lineno">95</span><span class="op" id="5495131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5495134">func</span>&nbsp;<span class="op" id="5495139">(</span><span class="ident" id="5495140">h</span>&nbsp;<span class="op" id="5495142">*</span><span class="ident" id="5495143"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="5495150">)</span>&nbsp;<span class="ident" id="5495152">ServeHTTP</span><span class="op" id="5495161">(</span><span class="ident" id="5495162">rw</span>&nbsp;<span class="ident" id="5495165"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5495169">.</span><span class="ident" id="5495170">ResponseWriter</span><span class="op" id="5495184">,</span>&nbsp;<span class="ident" id="5495186">req</span>&nbsp;<span class="op" id="5495190">*</span><span class="ident" id="5495191"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5495195">.</span><span class="ident" id="5495196">Request</span><span class="op" id="5495203">)</span>&nbsp;<span class="op" id="5495205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495208">root</span>&nbsp;<span class="op" id="5495213">:=</span>&nbsp;<span class="ident" id="5495216"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5495217">.</span><span class="ident" id="5495218">Root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495224">if</span>&nbsp;<span class="ident" id="5495227"><a href="/net/http/cgi/host.go.html#5495208">root</a></span>&nbsp;<span class="op" id="5495232">==</span>&nbsp;<span class="string" id="5495235">&#34;&#34;</span>&nbsp;<span class="op" id="5495238">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495242"><a href="/net/http/cgi/host.go.html#5495208">root</a></span>&nbsp;<span class="op" id="5495247">=</span>&nbsp;<span class="string" id="5495249">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495258">if</span>&nbsp;<span class="builtinfunc" id="5495261">len</span><span class="op" id="5495264">(</span><span class="ident" id="5495265"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5495268">.</span><span class="ident" id="5495269">TransferEncoding</span><span class="op" id="5495285">)</span>&nbsp;<span class="op" id="5495287">&gt;</span>&nbsp;<span class="num" id="5495289">0</span>&nbsp;<span class="op" id="5495291">&amp;&amp;</span>&nbsp;<span class="ident" id="5495294"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5495297">.</span><span class="ident" id="5495298">TransferEncoding</span><span class="op" id="5495314">[</span><span class="num" id="5495315">0</span><span class="op" id="5495316">]</span>&nbsp;<span class="op" id="5495318">==</span>&nbsp;<span class="string" id="5495321">&#34;chunked&#34;</span>&nbsp;<span class="op" id="5495331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495335"><a href="/net/http/cgi/host.go.html#5495162">rw</a></span><span class="op" id="5495337">.</span><span class="ident" id="5495338">WriteHeader</span><span class="op" id="5495349">(</span><span class="ident" id="5495350"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5495354">.</span><span class="ident" id="5495355">StatusBadRequest</span><span class="op" id="5495371">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495375"><a href="/net/http/cgi/host.go.html#5495162">rw</a></span><span class="op" id="5495377">.</span><span class="ident" id="5495378">Write</span><span class="op" id="5495383">(</span><span class="op" id="5495384">[</span><span class="op" id="5495385">]</span><span class="builtintype" id="5495386">byte</span><span class="op" id="5495390">(</span><span class="string" id="5495391">&#34;Chunked&nbsp;request&nbsp;bodies&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;CGI.&#34;</span><span class="op" id="5495441">)</span><span class="op" id="5495442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495446">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495458">pathInfo</span>&nbsp;<span class="op" id="5495467">:=</span>&nbsp;<span class="ident" id="5495470"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5495473">.</span><span class="ident" id="5495474">URL</span><span class="op" id="5495477">.</span><span class="ident" id="5495478">Path</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495484">if</span>&nbsp;<span class="ident" id="5495487"><a href="/net/http/cgi/host.go.html#5495208">root</a></span>&nbsp;<span class="op" id="5495492">!=</span>&nbsp;<span class="string" id="5495495">&#34;/&#34;</span>&nbsp;<span class="op" id="5495499">&amp;&amp;</span>&nbsp;<span class="ident" id="5495502"><a href="/net/http/cgi/host.go.html#5492935">strings</a></span><span class="op" id="5495509">.</span><span class="ident" id="5495510">HasPrefix</span><span class="op" id="5495519">(</span><span class="ident" id="5495520"><a href="/net/http/cgi/host.go.html#5495458">pathInfo</a></span><span class="op" id="5495528">,</span>&nbsp;<span class="ident" id="5495530"><a href="/net/http/cgi/host.go.html#5495208">root</a></span><span class="op" id="5495534">)</span>&nbsp;<span class="op" id="5495536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495540"><a href="/net/http/cgi/host.go.html#5495458">pathInfo</a></span>&nbsp;<span class="op" id="5495549">=</span>&nbsp;<span class="ident" id="5495551"><a href="/net/http/cgi/host.go.html#5495458">pathInfo</a></span><span class="op" id="5495559">[</span><span class="builtinfunc" id="5495560">len</span><span class="op" id="5495563">(</span><span class="ident" id="5495564"><a href="/net/http/cgi/host.go.html#5495208">root</a></span><span class="op" id="5495568">)</span><span class="op" id="5495569">:</span><span class="op" id="5495570">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495577">port</span>&nbsp;<span class="op" id="5495582">:=</span>&nbsp;<span class="string" id="5495585">&#34;80&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495591">if</span>&nbsp;<span class="ident" id="5495594">matches</span>&nbsp;<span class="op" id="5495602">:=</span>&nbsp;<span class="ident" id="5495605"><a href="/net/http/cgi/host.go.html#5492952">trailingPort</a></span><span class="op" id="5495617">.</span><span class="ident" id="5495618">FindStringSubmatch</span><span class="op" id="5495636">(</span><span class="ident" id="5495637"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5495640">.</span><span class="ident" id="5495641">Host</span><span class="op" id="5495645">)</span><span class="op" id="5495646">;</span>&nbsp;<span class="builtinfunc" id="5495648">len</span><span class="op" id="5495651">(</span><span class="ident" id="5495652"><a href="/net/http/cgi/host.go.html#5495594">matches</a></span><span class="op" id="5495659">)</span>&nbsp;<span class="op" id="5495661">!=</span>&nbsp;<span class="num" id="5495664">0</span>&nbsp;<span class="op" id="5495666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495670"><a href="/net/http/cgi/host.go.html#5495577">port</a></span>&nbsp;<span class="op" id="5495675">=</span>&nbsp;<span class="ident" id="5495677"><a href="/net/http/cgi/host.go.html#5495594">matches</a></span><span class="op" id="5495684">[</span><span class="num" id="5495685">1</span><span class="op" id="5495686">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495693">env</span>&nbsp;<span class="op" id="5495697">:=</span>&nbsp;<span class="op" id="5495700">[</span><span class="op" id="5495701">]</span><span class="builtintype" id="5495702">string</span><span class="op" id="5495708">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5495712">&#34;SERVER_SOFTWARE=go&#34;</span><span class="op" id="5495732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5495736">&#34;SERVER_NAME=&#34;</span>&nbsp;<span class="op" id="5495751">+</span>&nbsp;<span class="ident" id="5495753"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5495756">.</span><span class="ident" id="5495757">Host</span><span class="op" id="5495761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5495765">&#34;SERVER_PROTOCOL=HTTP/1.1&#34;</span><span class="op" id="5495791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5495795">&#34;HTTP_HOST=&#34;</span>&nbsp;<span class="op" id="5495808">+</span>&nbsp;<span class="ident" id="5495810"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5495813">.</span><span class="ident" id="5495814">Host</span><span class="op" id="5495818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5495822">&#34;GATEWAY_INTERFACE=CGI/1.1&#34;</span><span class="op" id="5495849">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5495853">&#34;REQUEST_METHOD=&#34;</span>&nbsp;<span class="op" id="5495871">+</span>&nbsp;<span class="ident" id="5495873"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5495876">.</span><span class="ident" id="5495877">Method</span><span class="op" id="5495883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5495887">&#34;QUERY_STRING=&#34;</span>&nbsp;<span class="op" id="5495903">+</span>&nbsp;<span class="ident" id="5495905"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5495908">.</span><span class="ident" id="5495909">URL</span><span class="op" id="5495912">.</span><span class="ident" id="5495913">RawQuery</span><span class="op" id="5495921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5495925">&#34;REQUEST_URI=&#34;</span>&nbsp;<span class="op" id="5495940">+</span>&nbsp;<span class="ident" id="5495942"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5495945">.</span><span class="ident" id="5495946">URL</span><span class="op" id="5495949">.</span><span class="ident" id="5495950">RequestURI</span><span class="op" id="5495960">(</span><span class="op" id="5495961">)</span><span class="op" id="5495962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5495966">&#34;PATH_INFO=&#34;</span>&nbsp;<span class="op" id="5495979">+</span>&nbsp;<span class="ident" id="5495981"><a href="/net/http/cgi/host.go.html#5495458">pathInfo</a></span><span class="op" id="5495989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5495993">&#34;SCRIPT_NAME=&#34;</span>&nbsp;<span class="op" id="5496008">+</span>&nbsp;<span class="ident" id="5496010"><a href="/net/http/cgi/host.go.html#5495208">root</a></span><span class="op" id="5496014">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5496018">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="5496037">+</span>&nbsp;<span class="ident" id="5496039"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5496040">.</span><span class="ident" id="5496041">Path</span><span class="op" id="5496045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5496049">&#34;REMOTE_ADDR=&#34;</span>&nbsp;<span class="op" id="5496064">+</span>&nbsp;<span class="ident" id="5496066"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5496069">.</span><span class="ident" id="5496070">RemoteAddr</span><span class="op" id="5496080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5496084">&#34;REMOTE_HOST=&#34;</span>&nbsp;<span class="op" id="5496099">+</span>&nbsp;<span class="ident" id="5496101"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5496104">.</span><span class="ident" id="5496105">RemoteAddr</span><span class="op" id="5496115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5496119">&#34;SERVER_PORT=&#34;</span>&nbsp;<span class="op" id="5496134">+</span>&nbsp;<span class="ident" id="5496136"><a href="/net/http/cgi/host.go.html#5495577">port</a></span><span class="op" id="5496140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496143">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496147">if</span>&nbsp;<span class="ident" id="5496150"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5496153">.</span><span class="ident" id="5496154">TLS</span>&nbsp;<span class="op" id="5496158">!=</span>&nbsp;<span class="ident" id="5496161">nil</span>&nbsp;<span class="op" id="5496165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496169"><a href="/net/http/cgi/host.go.html#5495693">env</a></span>&nbsp;<span class="op" id="5496173">=</span>&nbsp;<span class="builtinfunc" id="5496175">append</span><span class="op" id="5496181">(</span><span class="ident" id="5496182"><a href="/net/http/cgi/host.go.html#5495693">env</a></span><span class="op" id="5496185">,</span>&nbsp;<span class="string" id="5496187">&#34;HTTPS=on&#34;</span><span class="op" id="5496197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496204">for</span>&nbsp;<span class="ident" id="5496208">k</span><span class="op" id="5496209">,</span>&nbsp;<span class="ident" id="5496211">v</span>&nbsp;<span class="op" id="5496213">:=</span>&nbsp;<span class="keyword" id="5496216">range</span>&nbsp;<span class="ident" id="5496222"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5496225">.</span><span class="ident" id="5496226">Header</span>&nbsp;<span class="op" id="5496233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496237"><a href="/net/http/cgi/host.go.html#5496208">k</a></span>&nbsp;<span class="op" id="5496239">=</span>&nbsp;<span class="ident" id="5496241"><a href="/net/http/cgi/host.go.html#5492935">strings</a></span><span class="op" id="5496248">.</span><span class="ident" id="5496249">Map</span><span class="op" id="5496252">(</span><span class="ident" id="5496253"><a href="/net/http/cgi/host.go.html#5501544">upperCaseAndUnderscore</a></span><span class="op" id="5496275">,</span>&nbsp;<span class="ident" id="5496277"><a href="/net/http/cgi/host.go.html#5496208">k</a></span><span class="op" id="5496278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496282">joinStr</span>&nbsp;<span class="op" id="5496290">:=</span>&nbsp;<span class="string" id="5496293">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496300">if</span>&nbsp;<span class="ident" id="5496303"><a href="/net/http/cgi/host.go.html#5496208">k</a></span>&nbsp;<span class="op" id="5496305">==</span>&nbsp;<span class="string" id="5496308">&#34;COOKIE&#34;</span>&nbsp;<span class="op" id="5496317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496322"><a href="/net/http/cgi/host.go.html#5496282">joinStr</a></span>&nbsp;<span class="op" id="5496330">=</span>&nbsp;<span class="string" id="5496332">&#34;;&nbsp;&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496343"><a href="/net/http/cgi/host.go.html#5495693">env</a></span>&nbsp;<span class="op" id="5496347">=</span>&nbsp;<span class="builtinfunc" id="5496349">append</span><span class="op" id="5496355">(</span><span class="ident" id="5496356"><a href="/net/http/cgi/host.go.html#5495693">env</a></span><span class="op" id="5496359">,</span>&nbsp;<span class="string" id="5496361">&#34;HTTP_&#34;</span><span class="op" id="5496368">+</span><span class="ident" id="5496369"><a href="/net/http/cgi/host.go.html#5496208">k</a></span><span class="op" id="5496370">+</span><span class="string" id="5496371">&#34;=&#34;</span><span class="op" id="5496374">+</span><span class="ident" id="5496375"><a href="/net/http/cgi/host.go.html#5492935">strings</a></span><span class="op" id="5496382">.</span><span class="ident" id="5496383">Join</span><span class="op" id="5496387">(</span><span class="ident" id="5496388"><a href="/net/http/cgi/host.go.html#5496211">v</a></span><span class="op" id="5496389">,</span>&nbsp;<span class="ident" id="5496391"><a href="/net/http/cgi/host.go.html#5496282">joinStr</a></span><span class="op" id="5496398">)</span><span class="op" id="5496399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496406">if</span>&nbsp;<span class="ident" id="5496409"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5496412">.</span><span class="ident" id="5496413">ContentLength</span>&nbsp;<span class="op" id="5496427">&gt;</span>&nbsp;<span class="num" id="5496429">0</span>&nbsp;<span class="op" id="5496431">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496435"><a href="/net/http/cgi/host.go.html#5495693">env</a></span>&nbsp;<span class="op" id="5496439">=</span>&nbsp;<span class="builtinfunc" id="5496441">append</span><span class="op" id="5496447">(</span><span class="ident" id="5496448"><a href="/net/http/cgi/host.go.html#5495693">env</a></span><span class="op" id="5496451">,</span>&nbsp;<span class="ident" id="5496453"><a href="/net/http/cgi/host.go.html#5492837">fmt</a></span><span class="op" id="5496456">.</span><span class="ident" id="5496457">Sprintf</span><span class="op" id="5496464">(</span><span class="string" id="5496465">&#34;CONTENT_LENGTH=%d&#34;</span><span class="op" id="5496484">,</span>&nbsp;<span class="ident" id="5496486"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5496489">.</span><span class="ident" id="5496490">ContentLength</span><span class="op" id="5496503">)</span><span class="op" id="5496504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496510">if</span>&nbsp;<span class="ident" id="5496513">ctype</span>&nbsp;<span class="op" id="5496519">:=</span>&nbsp;<span class="ident" id="5496522"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5496525">.</span><span class="ident" id="5496526">Header</span><span class="op" id="5496532">.</span><span class="ident" id="5496533">Get</span><span class="op" id="5496536">(</span><span class="string" id="5496537">&#34;Content-Type&#34;</span><span class="op" id="5496551">)</span><span class="op" id="5496552">;</span>&nbsp;<span class="ident" id="5496554"><a href="/net/http/cgi/host.go.html#5496513">ctype</a></span>&nbsp;<span class="op" id="5496560">!=</span>&nbsp;<span class="string" id="5496563">&#34;&#34;</span>&nbsp;<span class="op" id="5496566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496570"><a href="/net/http/cgi/host.go.html#5495693">env</a></span>&nbsp;<span class="op" id="5496574">=</span>&nbsp;<span class="builtinfunc" id="5496576">append</span><span class="op" id="5496582">(</span><span class="ident" id="5496583"><a href="/net/http/cgi/host.go.html#5495693">env</a></span><span class="op" id="5496586">,</span>&nbsp;<span class="string" id="5496588">&#34;CONTENT_TYPE=&#34;</span><span class="op" id="5496603">+</span><span class="ident" id="5496604"><a href="/net/http/cgi/host.go.html#5496513">ctype</a></span><span class="op" id="5496609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496612">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496616">if</span>&nbsp;<span class="ident" id="5496619"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5496620">.</span><span class="ident" id="5496621">Env</span>&nbsp;<span class="op" id="5496625">!=</span>&nbsp;<span class="ident" id="5496628">nil</span>&nbsp;<span class="op" id="5496632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496636"><a href="/net/http/cgi/host.go.html#5495693">env</a></span>&nbsp;<span class="op" id="5496640">=</span>&nbsp;<span class="builtinfunc" id="5496642">append</span><span class="op" id="5496648">(</span><span class="ident" id="5496649"><a href="/net/http/cgi/host.go.html#5495693">env</a></span><span class="op" id="5496652">,</span>&nbsp;<span class="ident" id="5496654"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5496655">.</span><span class="ident" id="5496656">Env</span><span class="op" id="5496659">...</span><span class="op" id="5496662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496669">envPath</span>&nbsp;<span class="op" id="5496677">:=</span>&nbsp;<span class="ident" id="5496680"><a href="/net/http/cgi/host.go.html#5492869">os</a></span><span class="op" id="5496682">.</span><span class="ident" id="5496683">Getenv</span><span class="op" id="5496689">(</span><span class="string" id="5496690">&#34;PATH&#34;</span><span class="op" id="5496696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496699">if</span>&nbsp;<span class="ident" id="5496702"><a href="/net/http/cgi/host.go.html#5496669">envPath</a></span>&nbsp;<span class="op" id="5496710">==</span>&nbsp;<span class="string" id="5496713">&#34;&#34;</span>&nbsp;<span class="op" id="5496716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496720"><a href="/net/http/cgi/host.go.html#5496669">envPath</a></span>&nbsp;<span class="op" id="5496728">=</span>&nbsp;<span class="string" id="5496730">&#34;/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496783"><a href="/net/http/cgi/host.go.html#5495693">env</a></span>&nbsp;<span class="op" id="5496787">=</span>&nbsp;<span class="builtinfunc" id="5496789">append</span><span class="op" id="5496795">(</span><span class="ident" id="5496796"><a href="/net/http/cgi/host.go.html#5495693">env</a></span><span class="op" id="5496799">,</span>&nbsp;<span class="string" id="5496801">&#34;PATH=&#34;</span><span class="op" id="5496808">+</span><span class="ident" id="5496809"><a href="/net/http/cgi/host.go.html#5496669">envPath</a></span><span class="op" id="5496816">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496820">for</span>&nbsp;<span class="ident" id="5496824">_</span><span class="op" id="5496825">,</span>&nbsp;<span class="ident" id="5496827">e</span>&nbsp;<span class="op" id="5496829">:=</span>&nbsp;<span class="keyword" id="5496832">range</span>&nbsp;<span class="ident" id="5496838"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5496839">.</span><span class="ident" id="5496840">InheritEnv</span>&nbsp;<span class="op" id="5496851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496855">if</span>&nbsp;<span class="ident" id="5496858">v</span>&nbsp;<span class="op" id="5496860">:=</span>&nbsp;<span class="ident" id="5496863"><a href="/net/http/cgi/host.go.html#5492869">os</a></span><span class="op" id="5496865">.</span><span class="ident" id="5496866">Getenv</span><span class="op" id="5496872">(</span><span class="ident" id="5496873"><a href="/net/http/cgi/host.go.html#5496827">e</a></span><span class="op" id="5496874">)</span><span class="op" id="5496875">;</span>&nbsp;<span class="ident" id="5496877"><a href="/net/http/cgi/host.go.html#5496858">v</a></span>&nbsp;<span class="op" id="5496879">!=</span>&nbsp;<span class="string" id="5496882">&#34;&#34;</span>&nbsp;<span class="op" id="5496885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496890"><a href="/net/http/cgi/host.go.html#5495693">env</a></span>&nbsp;<span class="op" id="5496894">=</span>&nbsp;<span class="builtinfunc" id="5496896">append</span><span class="op" id="5496902">(</span><span class="ident" id="5496903"><a href="/net/http/cgi/host.go.html#5495693">env</a></span><span class="op" id="5496906">,</span>&nbsp;<span class="ident" id="5496908"><a href="/net/http/cgi/host.go.html#5496827">e</a></span><span class="op" id="5496909">+</span><span class="string" id="5496910">&#34;=&#34;</span><span class="op" id="5496913">+</span><span class="ident" id="5496914"><a href="/net/http/cgi/host.go.html#5496858">v</a></span><span class="op" id="5496915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496919">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496926">for</span>&nbsp;<span class="ident" id="5496930">_</span><span class="op" id="5496931">,</span>&nbsp;<span class="ident" id="5496933">e</span>&nbsp;<span class="op" id="5496935">:=</span>&nbsp;<span class="keyword" id="5496938">range</span>&nbsp;<span class="ident" id="5496944"><a href="/net/http/cgi/host.go.html#5493005">osDefaultInheritEnv</a></span><span class="op" id="5496963">[</span><span class="ident" id="5496964"><a href="/net/http/cgi/host.go.html#5492913">runtime</a></span><span class="op" id="5496971">.</span><span class="ident" id="5496972">GOOS</span><span class="op" id="5496976">]</span>&nbsp;<span class="op" id="5496978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496982">if</span>&nbsp;<span class="ident" id="5496985">v</span>&nbsp;<span class="op" id="5496987">:=</span>&nbsp;<span class="ident" id="5496990"><a href="/net/http/cgi/host.go.html#5492869">os</a></span><span class="op" id="5496992">.</span><span class="ident" id="5496993">Getenv</span><span class="op" id="5496999">(</span><span class="ident" id="5497000"><a href="/net/http/cgi/host.go.html#5496933">e</a></span><span class="op" id="5497001">)</span><span class="op" id="5497002">;</span>&nbsp;<span class="ident" id="5497004"><a href="/net/http/cgi/host.go.html#5496985">v</a></span>&nbsp;<span class="op" id="5497006">!=</span>&nbsp;<span class="string" id="5497009">&#34;&#34;</span>&nbsp;<span class="op" id="5497012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497017"><a href="/net/http/cgi/host.go.html#5495693">env</a></span>&nbsp;<span class="op" id="5497021">=</span>&nbsp;<span class="builtinfunc" id="5497023">append</span><span class="op" id="5497029">(</span><span class="ident" id="5497030"><a href="/net/http/cgi/host.go.html#5495693">env</a></span><span class="op" id="5497033">,</span>&nbsp;<span class="ident" id="5497035"><a href="/net/http/cgi/host.go.html#5496933">e</a></span><span class="op" id="5497036">+</span><span class="string" id="5497037">&#34;=&#34;</span><span class="op" id="5497040">+</span><span class="ident" id="5497041"><a href="/net/http/cgi/host.go.html#5496985">v</a></span><span class="op" id="5497042">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497053"><a href="/net/http/cgi/host.go.html#5495693">env</a></span>&nbsp;<span class="op" id="5497057">=</span>&nbsp;<span class="ident" id="5497059"><a href="/net/http/cgi/host.go.html#5494801">removeLeadingDuplicates</a></span><span class="op" id="5497082">(</span><span class="ident" id="5497083"><a href="/net/http/cgi/host.go.html#5495693">env</a></span><span class="op" id="5497086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497090">var</span>&nbsp;<span class="ident" id="5497094">cwd</span><span class="op" id="5497097">,</span>&nbsp;<span class="ident" id="5497099">path</span>&nbsp;<span class="builtintype" id="5497104">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497112">if</span>&nbsp;<span class="ident" id="5497115"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5497116">.</span><span class="ident" id="5497117">Dir</span>&nbsp;<span class="op" id="5497121">!=</span>&nbsp;<span class="string" id="5497124">&#34;&#34;</span>&nbsp;<span class="op" id="5497127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497131"><a href="/net/http/cgi/host.go.html#5497099">path</a></span>&nbsp;<span class="op" id="5497136">=</span>&nbsp;<span class="ident" id="5497138"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5497139">.</span><span class="ident" id="5497140">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497147"><a href="/net/http/cgi/host.go.html#5497094">cwd</a></span>&nbsp;<span class="op" id="5497151">=</span>&nbsp;<span class="ident" id="5497153"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5497154">.</span><span class="ident" id="5497155">Dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497160">}</span>&nbsp;<span class="keyword" id="5497162">else</span>&nbsp;<span class="op" id="5497167">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497171"><a href="/net/http/cgi/host.go.html#5497094">cwd</a></span><span class="op" id="5497174">,</span>&nbsp;<span class="ident" id="5497176"><a href="/net/http/cgi/host.go.html#5497099">path</a></span>&nbsp;<span class="op" id="5497181">=</span>&nbsp;<span class="ident" id="5497183"><a href="/net/http/cgi/host.go.html#5492886">filepath</a></span><span class="op" id="5497191">.</span><span class="ident" id="5497192">Split</span><span class="op" id="5497197">(</span><span class="ident" id="5497198"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5497199">.</span><span class="ident" id="5497200">Path</span><span class="op" id="5497204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497210">if</span>&nbsp;<span class="ident" id="5497213"><a href="/net/http/cgi/host.go.html#5497094">cwd</a></span>&nbsp;<span class="op" id="5497217">==</span>&nbsp;<span class="string" id="5497220">&#34;&#34;</span>&nbsp;<span class="op" id="5497223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497227"><a href="/net/http/cgi/host.go.html#5497094">cwd</a></span>&nbsp;<span class="op" id="5497231">=</span>&nbsp;<span class="string" id="5497233">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497238">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497242">internalError</span>&nbsp;<span class="op" id="5497256">:=</span>&nbsp;<span class="keyword" id="5497259">func</span><span class="op" id="5497263">(</span><span class="ident" id="5497264">err</span>&nbsp;<span class="builtintype" id="5497268">error</span><span class="op" id="5497273">)</span>&nbsp;<span class="op" id="5497275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497279"><a href="/net/http/cgi/host.go.html#5495162">rw</a></span><span class="op" id="5497281">.</span><span class="ident" id="5497282">WriteHeader</span><span class="op" id="5497293">(</span><span class="ident" id="5497294"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5497298">.</span><span class="ident" id="5497299">StatusInternalServerError</span><span class="op" id="5497324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497328"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5497329">.</span><span class="ident" id="5497330">printf</span><span class="op" id="5497336">(</span><span class="string" id="5497337">&#34;CGI&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5497352">,</span>&nbsp;<span class="ident" id="5497354"><a href="/net/http/cgi/host.go.html#5497264">err</a></span><span class="op" id="5497357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497360">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497364">cmd</span>&nbsp;<span class="op" id="5497368">:=</span>&nbsp;<span class="op" id="5497371">&amp;</span><span class="ident" id="5497372"><a href="/net/http/cgi/host.go.html#5492875">exec</a></span><span class="op" id="5497376">.</span><span class="ident" id="5497377">Cmd</span><span class="op" id="5497380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497384">Path</span><span class="op" id="5497388">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5497392"><a href="/net/http/cgi/host.go.html#5497099">path</a></span><span class="op" id="5497396">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497400">Args</span><span class="op" id="5497404">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5497408">append</span><span class="op" id="5497414">(</span><span class="op" id="5497415">[</span><span class="op" id="5497416">]</span><span class="builtintype" id="5497417">string</span><span class="op" id="5497423">{</span><span class="ident" id="5497424"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5497425">.</span><span class="ident" id="5497426">Path</span><span class="op" id="5497430">}</span><span class="op" id="5497431">,</span>&nbsp;<span class="ident" id="5497433"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5497434">.</span><span class="ident" id="5497435">Args</span><span class="op" id="5497439">...</span><span class="op" id="5497442">)</span><span class="op" id="5497443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497447">Dir</span><span class="op" id="5497450">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497455"><a href="/net/http/cgi/host.go.html#5497094">cwd</a></span><span class="op" id="5497458">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497462">Env</span><span class="op" id="5497465">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497470"><a href="/net/http/cgi/host.go.html#5495693">env</a></span><span class="op" id="5497473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497477">Stderr</span><span class="op" id="5497483">:</span>&nbsp;<span class="ident" id="5497485"><a href="/net/http/cgi/host.go.html#5492869">os</a></span><span class="op" id="5497487">.</span><span class="ident" id="5497488">Stderr</span><span class="op" id="5497494">,</span>&nbsp;<span class="comment" id="5497496">//&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497511">if</span>&nbsp;<span class="ident" id="5497514"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5497517">.</span><span class="ident" id="5497518">ContentLength</span>&nbsp;<span class="op" id="5497532">!=</span>&nbsp;<span class="num" id="5497535">0</span>&nbsp;<span class="op" id="5497537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497541"><a href="/net/http/cgi/host.go.html#5497364">cmd</a></span><span class="op" id="5497544">.</span><span class="ident" id="5497545">Stdin</span>&nbsp;<span class="op" id="5497551">=</span>&nbsp;<span class="ident" id="5497553"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5497556">.</span><span class="ident" id="5497557">Body</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497566">stdoutRead</span><span class="op" id="5497576">,</span>&nbsp;<span class="ident" id="5497578">err</span>&nbsp;<span class="op" id="5497582">:=</span>&nbsp;<span class="ident" id="5497585"><a href="/net/http/cgi/host.go.html#5497364">cmd</a></span><span class="op" id="5497588">.</span><span class="ident" id="5497589">StdoutPipe</span><span class="op" id="5497599">(</span><span class="op" id="5497600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497603">if</span>&nbsp;<span class="ident" id="5497606"><a href="/net/http/cgi/host.go.html#5497578">err</a></span>&nbsp;<span class="op" id="5497610">!=</span>&nbsp;<span class="ident" id="5497613">nil</span>&nbsp;<span class="op" id="5497617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497621"><a href="/net/http/cgi/host.go.html#5497242">internalError</a></span><span class="op" id="5497634">(</span><span class="ident" id="5497635"><a href="/net/http/cgi/host.go.html#5497578">err</a></span><span class="op" id="5497638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497642">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497654"><a href="/net/http/cgi/host.go.html#5497578">err</a></span>&nbsp;<span class="op" id="5497658">=</span>&nbsp;<span class="ident" id="5497660"><a href="/net/http/cgi/host.go.html#5497364">cmd</a></span><span class="op" id="5497663">.</span><span class="ident" id="5497664">Start</span><span class="op" id="5497669">(</span><span class="op" id="5497670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497673">if</span>&nbsp;<span class="ident" id="5497676"><a href="/net/http/cgi/host.go.html#5497578">err</a></span>&nbsp;<span class="op" id="5497680">!=</span>&nbsp;<span class="ident" id="5497683">nil</span>&nbsp;<span class="op" id="5497687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497691"><a href="/net/http/cgi/host.go.html#5497242">internalError</a></span><span class="op" id="5497704">(</span><span class="ident" id="5497705"><a href="/net/http/cgi/host.go.html#5497578">err</a></span><span class="op" id="5497708">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497712">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497723">if</span>&nbsp;<span class="ident" id="5497726">hook</span>&nbsp;<span class="op" id="5497731">:=</span>&nbsp;<span class="ident" id="5497734"><a href="/net/http/cgi/host.go.html#5501939">testHookStartProcess</a></span><span class="op" id="5497754">;</span>&nbsp;<span class="ident" id="5497756"><a href="/net/http/cgi/host.go.html#5497726">hook</a></span>&nbsp;<span class="op" id="5497761">!=</span>&nbsp;<span class="ident" id="5497764">nil</span>&nbsp;<span class="op" id="5497768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497772"><a href="/net/http/cgi/host.go.html#5497726">hook</a></span><span class="op" id="5497776">(</span><span class="ident" id="5497777"><a href="/net/http/cgi/host.go.html#5497364">cmd</a></span><span class="op" id="5497780">.</span><span class="ident" id="5497781">Process</span><span class="op" id="5497788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497791">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497794">defer</span>&nbsp;<span class="ident" id="5497800"><a href="/net/http/cgi/host.go.html#5497364">cmd</a></span><span class="op" id="5497803">.</span><span class="ident" id="5497804">Wait</span><span class="op" id="5497808">(</span><span class="op" id="5497809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497812">defer</span>&nbsp;<span class="ident" id="5497818"><a href="/net/http/cgi/host.go.html#5497566">stdoutRead</a></span><span class="op" id="5497828">.</span><span class="ident" id="5497829">Close</span><span class="op" id="5497834">(</span><span class="op" id="5497835">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497839">linebody</span>&nbsp;<span class="op" id="5497848">:=</span>&nbsp;<span class="ident" id="5497851"><a href="/net/http/cgi/host.go.html#5492828">bufio</a></span><span class="op" id="5497856">.</span><span class="ident" id="5497857">NewReaderSize</span><span class="op" id="5497870">(</span><span class="ident" id="5497871"><a href="/net/http/cgi/host.go.html#5497566">stdoutRead</a></span><span class="op" id="5497881">,</span>&nbsp;<span class="num" id="5497883">1024</span><span class="op" id="5497887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497890">headers</span>&nbsp;<span class="op" id="5497898">:=</span>&nbsp;<span class="builtinfunc" id="5497901">make</span><span class="op" id="5497905">(</span><span class="ident" id="5497906"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5497910">.</span><span class="ident" id="5497911">Header</span><span class="op" id="5497917">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497920">statusCode</span>&nbsp;<span class="op" id="5497931">:=</span>&nbsp;<span class="num" id="5497934">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497937">headerLines</span>&nbsp;<span class="op" id="5497949">:=</span>&nbsp;<span class="num" id="5497952">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497955">sawBlankLine</span>&nbsp;<span class="op" id="5497968">:=</span>&nbsp;<span class="ident" id="5497971">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497978">for</span>&nbsp;<span class="op" id="5497982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497986">line</span><span class="op" id="5497990">,</span>&nbsp;<span class="ident" id="5497992">isPrefix</span><span class="op" id="5498000">,</span>&nbsp;<span class="ident" id="5498002">err</span>&nbsp;<span class="op" id="5498006">:=</span>&nbsp;<span class="ident" id="5498009"><a href="/net/http/cgi/host.go.html#5497839">linebody</a></span><span class="op" id="5498017">.</span><span class="ident" id="5498018">ReadLine</span><span class="op" id="5498026">(</span><span class="op" id="5498027">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498031">if</span>&nbsp;<span class="ident" id="5498034"><a href="/net/http/cgi/host.go.html#5497992">isPrefix</a></span>&nbsp;<span class="op" id="5498043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498048"><a href="/net/http/cgi/host.go.html#5495162">rw</a></span><span class="op" id="5498050">.</span><span class="ident" id="5498051">WriteHeader</span><span class="op" id="5498062">(</span><span class="ident" id="5498063"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5498067">.</span><span class="ident" id="5498068">StatusInternalServerError</span><span class="op" id="5498093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498098"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5498099">.</span><span class="ident" id="5498100">printf</span><span class="op" id="5498106">(</span><span class="string" id="5498107">&#34;cgi:&nbsp;long&nbsp;header&nbsp;line&nbsp;from&nbsp;subprocess.&#34;</span><span class="op" id="5498147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498152">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498161">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498165">if</span>&nbsp;<span class="ident" id="5498168"><a href="/net/http/cgi/host.go.html#5498002">err</a></span>&nbsp;<span class="op" id="5498172">==</span>&nbsp;<span class="ident" id="5498175"><a href="/net/http/cgi/host.go.html#5492844">io</a></span><span class="op" id="5498177">.</span><span class="ident" id="5498178">EOF</span>&nbsp;<span class="op" id="5498182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498187">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498199">if</span>&nbsp;<span class="ident" id="5498202"><a href="/net/http/cgi/host.go.html#5498002">err</a></span>&nbsp;<span class="op" id="5498206">!=</span>&nbsp;<span class="ident" id="5498209">nil</span>&nbsp;<span class="op" id="5498213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498218"><a href="/net/http/cgi/host.go.html#5495162">rw</a></span><span class="op" id="5498220">.</span><span class="ident" id="5498221">WriteHeader</span><span class="op" id="5498232">(</span><span class="ident" id="5498233"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5498237">.</span><span class="ident" id="5498238">StatusInternalServerError</span><span class="op" id="5498263">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498268"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5498269">.</span><span class="ident" id="5498270">printf</span><span class="op" id="5498276">(</span><span class="string" id="5498277">&#34;cgi:&nbsp;error&nbsp;reading&nbsp;headers:&nbsp;%v&#34;</span><span class="op" id="5498309">,</span>&nbsp;<span class="ident" id="5498311"><a href="/net/http/cgi/host.go.html#5498002">err</a></span><span class="op" id="5498314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498319">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498332">if</span>&nbsp;<span class="builtinfunc" id="5498335">len</span><span class="op" id="5498338">(</span><span class="ident" id="5498339"><a href="/net/http/cgi/host.go.html#5497986">line</a></span><span class="op" id="5498343">)</span>&nbsp;<span class="op" id="5498345">==</span>&nbsp;<span class="num" id="5498348">0</span>&nbsp;<span class="op" id="5498350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498355"><a href="/net/http/cgi/host.go.html#5497955">sawBlankLine</a></span>&nbsp;<span class="op" id="5498368">=</span>&nbsp;<span class="ident" id="5498370">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498378">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498390"><a href="/net/http/cgi/host.go.html#5497937">headerLines</a></span><span class="op" id="5498401">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498406">parts</span>&nbsp;<span class="op" id="5498412">:=</span>&nbsp;<span class="ident" id="5498415"><a href="/net/http/cgi/host.go.html#5492935">strings</a></span><span class="op" id="5498422">.</span><span class="ident" id="5498423">SplitN</span><span class="op" id="5498429">(</span><span class="builtintype" id="5498430">string</span><span class="op" id="5498436">(</span><span class="ident" id="5498437"><a href="/net/http/cgi/host.go.html#5497986">line</a></span><span class="op" id="5498441">)</span><span class="op" id="5498442">,</span>&nbsp;<span class="string" id="5498444">&#34;:&#34;</span><span class="op" id="5498447">,</span>&nbsp;<span class="num" id="5498449">2</span><span class="op" id="5498450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498454">if</span>&nbsp;<span class="builtinfunc" id="5498457">len</span><span class="op" id="5498460">(</span><span class="ident" id="5498461"><a href="/net/http/cgi/host.go.html#5498406">parts</a></span><span class="op" id="5498466">)</span>&nbsp;<span class="op" id="5498468">&lt;</span>&nbsp;<span class="num" id="5498470">2</span>&nbsp;<span class="op" id="5498472">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498477"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5498478">.</span><span class="ident" id="5498479">printf</span><span class="op" id="5498485">(</span><span class="string" id="5498486">&#34;cgi:&nbsp;bogus&nbsp;header&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="5498514">,</span>&nbsp;<span class="builtintype" id="5498516">string</span><span class="op" id="5498522">(</span><span class="ident" id="5498523"><a href="/net/http/cgi/host.go.html#5497986">line</a></span><span class="op" id="5498527">)</span><span class="op" id="5498528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498533">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498548">header</span><span class="op" id="5498554">,</span>&nbsp;<span class="ident" id="5498556">val</span>&nbsp;<span class="op" id="5498560">:=</span>&nbsp;<span class="ident" id="5498563"><a href="/net/http/cgi/host.go.html#5498406">parts</a></span><span class="op" id="5498568">[</span><span class="num" id="5498569">0</span><span class="op" id="5498570">]</span><span class="op" id="5498571">,</span>&nbsp;<span class="ident" id="5498573"><a href="/net/http/cgi/host.go.html#5498406">parts</a></span><span class="op" id="5498578">[</span><span class="num" id="5498579">1</span><span class="op" id="5498580">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498584"><a href="/net/http/cgi/host.go.html#5498548">header</a></span>&nbsp;<span class="op" id="5498591">=</span>&nbsp;<span class="ident" id="5498593"><a href="/net/http/cgi/host.go.html#5492935">strings</a></span><span class="op" id="5498600">.</span><span class="ident" id="5498601">TrimSpace</span><span class="op" id="5498610">(</span><span class="ident" id="5498611"><a href="/net/http/cgi/host.go.html#5498548">header</a></span><span class="op" id="5498617">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498621"><a href="/net/http/cgi/host.go.html#5498556">val</a></span>&nbsp;<span class="op" id="5498625">=</span>&nbsp;<span class="ident" id="5498627"><a href="/net/http/cgi/host.go.html#5492935">strings</a></span><span class="op" id="5498634">.</span><span class="ident" id="5498635">TrimSpace</span><span class="op" id="5498644">(</span><span class="ident" id="5498645"><a href="/net/http/cgi/host.go.html#5498556">val</a></span><span class="op" id="5498648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498652">switch</span>&nbsp;<span class="op" id="5498659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498663">case</span>&nbsp;<span class="ident" id="5498668"><a href="/net/http/cgi/host.go.html#5498548">header</a></span>&nbsp;<span class="op" id="5498675">==</span>&nbsp;<span class="string" id="5498678">&#34;Status&#34;</span><span class="op" id="5498686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498691">if</span>&nbsp;<span class="builtinfunc" id="5498694">len</span><span class="op" id="5498697">(</span><span class="ident" id="5498698"><a href="/net/http/cgi/host.go.html#5498556">val</a></span><span class="op" id="5498701">)</span>&nbsp;<span class="op" id="5498703">&lt;</span>&nbsp;<span class="num" id="5498705">3</span>&nbsp;<span class="op" id="5498707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498713"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5498714">.</span><span class="ident" id="5498715">printf</span><span class="op" id="5498721">(</span><span class="string" id="5498722">&#34;cgi:&nbsp;bogus&nbsp;status&nbsp;(short):&nbsp;%q&#34;</span><span class="op" id="5498753">,</span>&nbsp;<span class="ident" id="5498755"><a href="/net/http/cgi/host.go.html#5498556">val</a></span><span class="op" id="5498758">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498764">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498779">code</span><span class="op" id="5498783">,</span>&nbsp;<span class="ident" id="5498785">err</span>&nbsp;<span class="op" id="5498789">:=</span>&nbsp;<span class="ident" id="5498792"><a href="/net/http/cgi/host.go.html#5492924">strconv</a></span><span class="op" id="5498799">.</span><span class="ident" id="5498800">Atoi</span><span class="op" id="5498804">(</span><span class="ident" id="5498805"><a href="/net/http/cgi/host.go.html#5498556">val</a></span><span class="op" id="5498808">[</span><span class="num" id="5498809">0</span><span class="op" id="5498810">:</span><span class="num" id="5498811">3</span><span class="op" id="5498812">]</span><span class="op" id="5498813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498818">if</span>&nbsp;<span class="ident" id="5498821"><a href="/net/http/cgi/host.go.html#5498785">err</a></span>&nbsp;<span class="op" id="5498825">!=</span>&nbsp;<span class="ident" id="5498828">nil</span>&nbsp;<span class="op" id="5498832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498838"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5498839">.</span><span class="ident" id="5498840">printf</span><span class="op" id="5498846">(</span><span class="string" id="5498847">&#34;cgi:&nbsp;bogus&nbsp;status:&nbsp;%q&#34;</span><span class="op" id="5498870">,</span>&nbsp;<span class="ident" id="5498872"><a href="/net/http/cgi/host.go.html#5498556">val</a></span><span class="op" id="5498875">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498881"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5498882">.</span><span class="ident" id="5498883">printf</span><span class="op" id="5498889">(</span><span class="string" id="5498890">&#34;cgi:&nbsp;line&nbsp;was&nbsp;%q&#34;</span><span class="op" id="5498908">,</span>&nbsp;<span class="ident" id="5498910"><a href="/net/http/cgi/host.go.html#5497986">line</a></span><span class="op" id="5498914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498920">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498935"><a href="/net/http/cgi/host.go.html#5497920">statusCode</a></span>&nbsp;<span class="op" id="5498946">=</span>&nbsp;<span class="ident" id="5498948"><a href="/net/http/cgi/host.go.html#5498779">code</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498955">default</span><span class="op" id="5498962">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498967"><a href="/net/http/cgi/host.go.html#5497890">headers</a></span><span class="op" id="5498974">.</span><span class="ident" id="5498975">Add</span><span class="op" id="5498978">(</span><span class="ident" id="5498979"><a href="/net/http/cgi/host.go.html#5498548">header</a></span><span class="op" id="5498985">,</span>&nbsp;<span class="ident" id="5498987"><a href="/net/http/cgi/host.go.html#5498556">val</a></span><span class="op" id="5498990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499000">if</span>&nbsp;<span class="ident" id="5499003"><a href="/net/http/cgi/host.go.html#5497937">headerLines</a></span>&nbsp;<span class="op" id="5499015">==</span>&nbsp;<span class="num" id="5499018">0</span>&nbsp;<span class="op" id="5499020">||</span>&nbsp;<span class="op" id="5499023">!</span><span class="ident" id="5499024"><a href="/net/http/cgi/host.go.html#5497955">sawBlankLine</a></span>&nbsp;<span class="op" id="5499037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499041"><a href="/net/http/cgi/host.go.html#5495162">rw</a></span><span class="op" id="5499043">.</span><span class="ident" id="5499044">WriteHeader</span><span class="op" id="5499055">(</span><span class="ident" id="5499056"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5499060">.</span><span class="ident" id="5499061">StatusInternalServerError</span><span class="op" id="5499086">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499090"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5499091">.</span><span class="ident" id="5499092">printf</span><span class="op" id="5499098">(</span><span class="string" id="5499099">&#34;cgi:&nbsp;no&nbsp;headers&#34;</span><span class="op" id="5499116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499120">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499132">if</span>&nbsp;<span class="ident" id="5499135">loc</span>&nbsp;<span class="op" id="5499139">:=</span>&nbsp;<span class="ident" id="5499142"><a href="/net/http/cgi/host.go.html#5497890">headers</a></span><span class="op" id="5499149">.</span><span class="ident" id="5499150">Get</span><span class="op" id="5499153">(</span><span class="string" id="5499154">&#34;Location&#34;</span><span class="op" id="5499164">)</span><span class="op" id="5499165">;</span>&nbsp;<span class="ident" id="5499167"><a href="/net/http/cgi/host.go.html#5499135">loc</a></span>&nbsp;<span class="op" id="5499171">!=</span>&nbsp;<span class="string" id="5499174">&#34;&#34;</span>&nbsp;<span class="op" id="5499177">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499181">if</span>&nbsp;<span class="ident" id="5499184"><a href="/net/http/cgi/host.go.html#5492935">strings</a></span><span class="op" id="5499191">.</span><span class="ident" id="5499192">HasPrefix</span><span class="op" id="5499201">(</span><span class="ident" id="5499202"><a href="/net/http/cgi/host.go.html#5499135">loc</a></span><span class="op" id="5499205">,</span>&nbsp;<span class="string" id="5499207">&#34;/&#34;</span><span class="op" id="5499210">)</span>&nbsp;<span class="op" id="5499212">&amp;&amp;</span>&nbsp;<span class="ident" id="5499215"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5499216">.</span><span class="ident" id="5499217">PathLocationHandler</span>&nbsp;<span class="op" id="5499237">!=</span>&nbsp;<span class="ident" id="5499240">nil</span>&nbsp;<span class="op" id="5499244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499249"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5499250">.</span><span class="ident" id="5499251">handleInternalRedirect</span><span class="op" id="5499273">(</span><span class="ident" id="5499274"><a href="/net/http/cgi/host.go.html#5495162">rw</a></span><span class="op" id="5499276">,</span>&nbsp;<span class="ident" id="5499278"><a href="/net/http/cgi/host.go.html#5495186">req</a></span><span class="op" id="5499281">,</span>&nbsp;<span class="ident" id="5499283"><a href="/net/http/cgi/host.go.html#5499135">loc</a></span><span class="op" id="5499286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499291">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499304">if</span>&nbsp;<span class="ident" id="5499307"><a href="/net/http/cgi/host.go.html#5497920">statusCode</a></span>&nbsp;<span class="op" id="5499318">==</span>&nbsp;<span class="num" id="5499321">0</span>&nbsp;<span class="op" id="5499323">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499328"><a href="/net/http/cgi/host.go.html#5497920">statusCode</a></span>&nbsp;<span class="op" id="5499339">=</span>&nbsp;<span class="ident" id="5499341"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5499345">.</span><span class="ident" id="5499346">StatusFound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499367">if</span>&nbsp;<span class="ident" id="5499370"><a href="/net/http/cgi/host.go.html#5497920">statusCode</a></span>&nbsp;<span class="op" id="5499381">==</span>&nbsp;<span class="num" id="5499384">0</span>&nbsp;<span class="op" id="5499386">&amp;&amp;</span>&nbsp;<span class="ident" id="5499389"><a href="/net/http/cgi/host.go.html#5497890">headers</a></span><span class="op" id="5499396">.</span><span class="ident" id="5499397">Get</span><span class="op" id="5499400">(</span><span class="string" id="5499401">&#34;Content-Type&#34;</span><span class="op" id="5499415">)</span>&nbsp;<span class="op" id="5499417">==</span>&nbsp;<span class="string" id="5499420">&#34;&#34;</span>&nbsp;<span class="op" id="5499423">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499427"><a href="/net/http/cgi/host.go.html#5495162">rw</a></span><span class="op" id="5499429">.</span><span class="ident" id="5499430">WriteHeader</span><span class="op" id="5499441">(</span><span class="ident" id="5499442"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5499446">.</span><span class="ident" id="5499447">StatusInternalServerError</span><span class="op" id="5499472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499476"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5499477">.</span><span class="ident" id="5499478">printf</span><span class="op" id="5499484">(</span><span class="string" id="5499485">&#34;cgi:&nbsp;missing&nbsp;required&nbsp;Content-Type&nbsp;in&nbsp;headers&#34;</span><span class="op" id="5499532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499536">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499548">if</span>&nbsp;<span class="ident" id="5499551"><a href="/net/http/cgi/host.go.html#5497920">statusCode</a></span>&nbsp;<span class="op" id="5499562">==</span>&nbsp;<span class="num" id="5499565">0</span>&nbsp;<span class="op" id="5499567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499571"><a href="/net/http/cgi/host.go.html#5497920">statusCode</a></span>&nbsp;<span class="op" id="5499582">=</span>&nbsp;<span class="ident" id="5499584"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5499588">.</span><span class="ident" id="5499589">StatusOK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499603">//&nbsp;Copy&nbsp;headers&nbsp;to&nbsp;rw&#39;s&nbsp;headers,&nbsp;after&nbsp;we&#39;ve&nbsp;decided&nbsp;not&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499664">//&nbsp;go&nbsp;into&nbsp;handleInternalRedirect,&nbsp;which&nbsp;won&#39;t&nbsp;want&nbsp;its&nbsp;rw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499724">//&nbsp;headers&nbsp;to&nbsp;have&nbsp;been&nbsp;touched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499758">for</span>&nbsp;<span class="ident" id="5499762">k</span><span class="op" id="5499763">,</span>&nbsp;<span class="ident" id="5499765">vv</span>&nbsp;<span class="op" id="5499768">:=</span>&nbsp;<span class="keyword" id="5499771">range</span>&nbsp;<span class="ident" id="5499777"><a href="/net/http/cgi/host.go.html#5497890">headers</a></span>&nbsp;<span class="op" id="5499785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499789">for</span>&nbsp;<span class="ident" id="5499793">_</span><span class="op" id="5499794">,</span>&nbsp;<span class="ident" id="5499796">v</span>&nbsp;<span class="op" id="5499798">:=</span>&nbsp;<span class="keyword" id="5499801">range</span>&nbsp;<span class="ident" id="5499807"><a href="/net/http/cgi/host.go.html#5499765">vv</a></span>&nbsp;<span class="op" id="5499810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499815"><a href="/net/http/cgi/host.go.html#5495162">rw</a></span><span class="op" id="5499817">.</span><span class="ident" id="5499818">Header</span><span class="op" id="5499824">(</span><span class="op" id="5499825">)</span><span class="op" id="5499826">.</span><span class="ident" id="5499827">Add</span><span class="op" id="5499830">(</span><span class="ident" id="5499831"><a href="/net/http/cgi/host.go.html#5499762">k</a></span><span class="op" id="5499832">,</span>&nbsp;<span class="ident" id="5499834"><a href="/net/http/cgi/host.go.html#5499796">v</a></span><span class="op" id="5499835">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499846"><a href="/net/http/cgi/host.go.html#5495162">rw</a></span><span class="op" id="5499848">.</span><span class="ident" id="5499849">WriteHeader</span><span class="op" id="5499860">(</span><span class="ident" id="5499861"><a href="/net/http/cgi/host.go.html#5497920">statusCode</a></span><span class="op" id="5499871">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499875">_</span><span class="op" id="5499876">,</span>&nbsp;<span class="ident" id="5499878"><a href="/net/http/cgi/host.go.html#5497578">err</a></span>&nbsp;<span class="op" id="5499882">=</span>&nbsp;<span class="ident" id="5499884"><a href="/net/http/cgi/host.go.html#5492844">io</a></span><span class="op" id="5499886">.</span><span class="ident" id="5499887">Copy</span><span class="op" id="5499891">(</span><span class="ident" id="5499892"><a href="/net/http/cgi/host.go.html#5495162">rw</a></span><span class="op" id="5499894">,</span>&nbsp;<span class="ident" id="5499896"><a href="/net/http/cgi/host.go.html#5497839">linebody</a></span><span class="op" id="5499904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499907">if</span>&nbsp;<span class="ident" id="5499910"><a href="/net/http/cgi/host.go.html#5497578">err</a></span>&nbsp;<span class="op" id="5499914">!=</span>&nbsp;<span class="ident" id="5499917">nil</span>&nbsp;<span class="op" id="5499921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499925"><a href="/net/http/cgi/host.go.html#5495140">h</a></span><span class="op" id="5499926">.</span><span class="ident" id="5499927">printf</span><span class="op" id="5499933">(</span><span class="string" id="5499934">&#34;cgi:&nbsp;copy&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5499955">,</span>&nbsp;<span class="ident" id="5499957"><a href="/net/http/cgi/host.go.html#5497578">err</a></span><span class="op" id="5499960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499964">//&nbsp;And&nbsp;kill&nbsp;the&nbsp;child&nbsp;CGI&nbsp;process&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;hang&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500020">//&nbsp;the&nbsp;deferred&nbsp;cmd.Wait&nbsp;above&nbsp;if&nbsp;the&nbsp;error&nbsp;was&nbsp;just</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500075">//&nbsp;the&nbsp;client&nbsp;(rw)&nbsp;going&nbsp;away.&nbsp;If&nbsp;it&nbsp;was&nbsp;a&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500131">//&nbsp;(because&nbsp;the&nbsp;child&nbsp;died&nbsp;itself),&nbsp;then&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500184">//&nbsp;kill&nbsp;of&nbsp;an&nbsp;already-dead&nbsp;process&nbsp;is&nbsp;harmless&nbsp;(the&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500242">//&nbsp;won&#39;t&nbsp;be&nbsp;reused&nbsp;until&nbsp;the&nbsp;Wait&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500286"><a href="/net/http/cgi/host.go.html#5497364">cmd</a></span><span class="op" id="5500289">.</span><span class="ident" id="5500290">Process</span><span class="op" id="5500297">.</span><span class="ident" id="5500298">Kill</span><span class="op" id="5500302">(</span><span class="op" id="5500303">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500306">}</span><br>
<span class="lineno"></span><span class="op" id="5500308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5500311">func</span>&nbsp;<span class="op" id="5500316">(</span><span class="ident" id="5500317">h</span>&nbsp;<span class="op" id="5500319">*</span><span class="ident" id="5500320"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="5500327">)</span>&nbsp;<span class="ident" id="5500329">printf</span><span class="op" id="5500335">(</span><span class="ident" id="5500336">format</span>&nbsp;<span class="builtintype" id="5500343">string</span><span class="op" id="5500349">,</span>&nbsp;<span class="ident" id="5500351">v</span>&nbsp;<span class="op" id="5500353">...</span><span class="keyword" id="5500356">interface</span><span class="op" id="5500365">{</span><span class="op" id="5500366">}</span><span class="op" id="5500367">)</span>&nbsp;<span class="op" id="5500369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500372">if</span>&nbsp;<span class="ident" id="5500375"><a href="/net/http/cgi/host.go.html#5500317">h</a></span><span class="op" id="5500376">.</span><span class="ident" id="5500377">Logger</span>&nbsp;<span class="op" id="5500384">!=</span>&nbsp;<span class="ident" id="5500387">nil</span>&nbsp;<span class="op" id="5500391">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500395"><a href="/net/http/cgi/host.go.html#5500317">h</a></span><span class="op" id="5500396">.</span><span class="ident" id="5500397">Logger</span><span class="op" id="5500403">.</span><span class="ident" id="5500404">Printf</span><span class="op" id="5500410">(</span><span class="ident" id="5500411"><a href="/net/http/cgi/host.go.html#5500336">format</a></span><span class="op" id="5500417">,</span>&nbsp;<span class="ident" id="5500419"><a href="/net/http/cgi/host.go.html#5500351">v</a></span><span class="op" id="5500420">...</span><span class="op" id="5500423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500426">}</span>&nbsp;<span class="keyword" id="5500428">else</span>&nbsp;<span class="op" id="5500433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500437"><a href="/net/http/cgi/host.go.html#5492850">log</a></span><span class="op" id="5500440">.</span><span class="ident" id="5500441">Printf</span><span class="op" id="5500447">(</span><span class="ident" id="5500448"><a href="/net/http/cgi/host.go.html#5500336">format</a></span><span class="op" id="5500454">,</span>&nbsp;<span class="ident" id="5500456"><a href="/net/http/cgi/host.go.html#5500351">v</a></span><span class="op" id="5500457">...</span><span class="op" id="5500460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500463">}</span><br>
<span class="lineno"></span><span class="op" id="5500465">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5500468">func</span>&nbsp;<span class="op" id="5500473">(</span><span class="ident" id="5500474">h</span>&nbsp;<span class="op" id="5500476">*</span><span class="ident" id="5500477"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="5500484">)</span>&nbsp;<span class="ident" id="5500486">handleInternalRedirect</span><span class="op" id="5500508">(</span><span class="ident" id="5500509">rw</span>&nbsp;<span class="ident" id="5500512"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5500516">.</span><span class="ident" id="5500517">ResponseWriter</span><span class="op" id="5500531">,</span>&nbsp;<span class="ident" id="5500533">req</span>&nbsp;<span class="op" id="5500537">*</span><span class="ident" id="5500538"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5500542">.</span><span class="ident" id="5500543">Request</span><span class="op" id="5500550">,</span>&nbsp;<span class="ident" id="5500552">path</span>&nbsp;<span class="builtintype" id="5500557">string</span><span class="op" id="5500563">)</span>&nbsp;<span class="op" id="5500565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500568">url</span><span class="op" id="5500571">,</span>&nbsp;<span class="ident" id="5500573">err</span>&nbsp;<span class="op" id="5500577">:=</span>&nbsp;<span class="ident" id="5500580"><a href="/net/http/cgi/host.go.html#5500533">req</a></span><span class="op" id="5500583">.</span><span class="ident" id="5500584">URL</span><span class="op" id="5500587">.</span><span class="ident" id="5500588">Parse</span><span class="op" id="5500593">(</span><span class="ident" id="5500594"><a href="/net/http/cgi/host.go.html#5500552">path</a></span><span class="op" id="5500598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500601">if</span>&nbsp;<span class="ident" id="5500604"><a href="/net/http/cgi/host.go.html#5500573">err</a></span>&nbsp;<span class="op" id="5500608">!=</span>&nbsp;<span class="ident" id="5500611">nil</span>&nbsp;<span class="op" id="5500615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500619"><a href="/net/http/cgi/host.go.html#5500509">rw</a></span><span class="op" id="5500621">.</span><span class="ident" id="5500622">WriteHeader</span><span class="op" id="5500633">(</span><span class="ident" id="5500634"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5500638">.</span><span class="ident" id="5500639">StatusInternalServerError</span><span class="op" id="5500664">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500668"><a href="/net/http/cgi/host.go.html#5500474">h</a></span><span class="op" id="5500669">.</span><span class="ident" id="5500670">printf</span><span class="op" id="5500676">(</span><span class="string" id="5500677">&#34;cgi:&nbsp;error&nbsp;resolving&nbsp;local&nbsp;URI&nbsp;path&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="5500721">,</span>&nbsp;<span class="ident" id="5500723"><a href="/net/http/cgi/host.go.html#5500552">path</a></span><span class="op" id="5500727">,</span>&nbsp;<span class="ident" id="5500729"><a href="/net/http/cgi/host.go.html#5500573">err</a></span><span class="op" id="5500732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500736">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500747">//&nbsp;TODO:&nbsp;RFC&nbsp;3875&nbsp;isn&#39;t&nbsp;clear&nbsp;if&nbsp;only&nbsp;GET&nbsp;is&nbsp;supported,&nbsp;but&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500811">//&nbsp;suggests&nbsp;so:&nbsp;&#34;Note&nbsp;that&nbsp;any&nbsp;message-body&nbsp;attached&nbsp;to&nbsp;the</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500872">//&nbsp;request&nbsp;(such&nbsp;as&nbsp;for&nbsp;a&nbsp;POST&nbsp;request)&nbsp;may&nbsp;not&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500934">//&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;is&nbsp;the&nbsp;target&nbsp;of&nbsp;the&nbsp;redirect.&#34;&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500995">//&nbsp;should&nbsp;do&nbsp;some&nbsp;tests&nbsp;against&nbsp;Apache&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;handles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501057">//&nbsp;POST,&nbsp;HEAD,&nbsp;etc.&nbsp;Does&nbsp;the&nbsp;internal&nbsp;redirect&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501118">//&nbsp;method&nbsp;or&nbsp;just&nbsp;GET?&nbsp;What&nbsp;about&nbsp;incoming&nbsp;headers?</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501171">//&nbsp;(e.g.&nbsp;Cookies)&nbsp;Which&nbsp;headers,&nbsp;if&nbsp;any,&nbsp;are&nbsp;copied&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501233">//&nbsp;second&nbsp;request?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501253">newReq</span>&nbsp;<span class="op" id="5501260">:=</span>&nbsp;<span class="op" id="5501263">&amp;</span><span class="ident" id="5501264"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5501268">.</span><span class="ident" id="5501269">Request</span><span class="op" id="5501276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501280">Method</span><span class="op" id="5501286">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5501292">&#34;GET&#34;</span><span class="op" id="5501297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501301">URL</span><span class="op" id="5501304">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501313"><a href="/net/http/cgi/host.go.html#5500568">url</a></span><span class="op" id="5501316">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501320">Proto</span><span class="op" id="5501325">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5501332">&#34;HTTP/1.1&#34;</span><span class="op" id="5501342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501346">ProtoMajor</span><span class="op" id="5501356">:</span>&nbsp;<span class="num" id="5501358">1</span><span class="op" id="5501359">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501363">ProtoMinor</span><span class="op" id="5501373">:</span>&nbsp;<span class="num" id="5501375">1</span><span class="op" id="5501376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501380">Header</span><span class="op" id="5501386">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5501392">make</span><span class="op" id="5501396">(</span><span class="ident" id="5501397"><a href="/net/http/cgi/host.go.html#5492857">http</a></span><span class="op" id="5501401">.</span><span class="ident" id="5501402">Header</span><span class="op" id="5501408">)</span><span class="op" id="5501409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501413">Host</span><span class="op" id="5501417">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501425"><a href="/net/http/cgi/host.go.html#5500568">url</a></span><span class="op" id="5501428">.</span><span class="ident" id="5501429">Host</span><span class="op" id="5501433">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501437">RemoteAddr</span><span class="op" id="5501447">:</span>&nbsp;<span class="ident" id="5501449"><a href="/net/http/cgi/host.go.html#5500533">req</a></span><span class="op" id="5501452">.</span><span class="ident" id="5501453">RemoteAddr</span><span class="op" id="5501463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501467">TLS</span><span class="op" id="5501470">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501479"><a href="/net/http/cgi/host.go.html#5500533">req</a></span><span class="op" id="5501482">.</span><span class="ident" id="5501483">TLS</span><span class="op" id="5501486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501492"><a href="/net/http/cgi/host.go.html#5500474">h</a></span><span class="op" id="5501493">.</span><span class="ident" id="5501494">PathLocationHandler</span><span class="op" id="5501513">.</span><span class="ident" id="5501514">ServeHTTP</span><span class="op" id="5501523">(</span><span class="ident" id="5501524"><a href="/net/http/cgi/host.go.html#5500509">rw</a></span><span class="op" id="5501526">,</span>&nbsp;<span class="ident" id="5501528"><a href="/net/http/cgi/host.go.html#5501253">newReq</a></span><span class="op" id="5501534">)</span><br>
<span class="lineno"></span><span class="op" id="5501536">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="5501539">func</span>&nbsp;<span class="ident" id="5501544">upperCaseAndUnderscore</span><span class="op" id="5501566">(</span><span class="ident" id="5501567">r</span>&nbsp;<span class="builtintype" id="5501569">rune</span><span class="op" id="5501573">)</span>&nbsp;<span class="builtintype" id="5501575">rune</span>&nbsp;<span class="op" id="5501580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501583">switch</span>&nbsp;<span class="op" id="5501590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501593">case</span>&nbsp;<span class="ident" id="5501598"><a href="/net/http/cgi/host.go.html#5501567">r</a></span>&nbsp;<span class="op" id="5501600">&gt;=</span>&nbsp;<span class="string" id="5501603">&#39;a&#39;</span>&nbsp;<span class="op" id="5501607">&amp;&amp;</span>&nbsp;<span class="ident" id="5501610"><a href="/net/http/cgi/host.go.html#5501567">r</a></span>&nbsp;<span class="op" id="5501612">&lt;=</span>&nbsp;<span class="string" id="5501615">&#39;z&#39;</span><span class="op" id="5501618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501622">return</span>&nbsp;<span class="ident" id="5501629"><a href="/net/http/cgi/host.go.html#5501567">r</a></span>&nbsp;<span class="op" id="5501631">-</span>&nbsp;<span class="op" id="5501633">(</span><span class="string" id="5501634">&#39;a&#39;</span>&nbsp;<span class="op" id="5501638">-</span>&nbsp;<span class="string" id="5501640">&#39;A&#39;</span><span class="op" id="5501643">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501646">case</span>&nbsp;<span class="ident" id="5501651"><a href="/net/http/cgi/host.go.html#5501567">r</a></span>&nbsp;<span class="op" id="5501653">==</span>&nbsp;<span class="string" id="5501656">&#39;-&#39;</span><span class="op" id="5501659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501663">return</span>&nbsp;<span class="string" id="5501670">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501675">case</span>&nbsp;<span class="ident" id="5501680"><a href="/net/http/cgi/host.go.html#5501567">r</a></span>&nbsp;<span class="op" id="5501682">==</span>&nbsp;<span class="string" id="5501685">&#39;=&#39;</span><span class="op" id="5501688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501692">//&nbsp;Maybe&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;CGI&nbsp;&#39;spec&#39;&nbsp;but&nbsp;would&nbsp;mess&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501748">//&nbsp;the&nbsp;environment&nbsp;in&nbsp;any&nbsp;case,&nbsp;as&nbsp;Go&nbsp;represents&nbsp;the</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501803">//&nbsp;environment&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;&#34;key=value&#34;&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501855">return</span>&nbsp;<span class="string" id="5501862">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501870">//&nbsp;TODO:&nbsp;other&nbsp;transformations&nbsp;in&nbsp;spec&nbsp;or&nbsp;practice?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501923">return</span>&nbsp;<span class="ident" id="5501930"><a href="/net/http/cgi/host.go.html#5501567">r</a></span><br>
<span class="lineno">375</span><span class="op" id="5501932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5501935">var</span>&nbsp;<span class="ident" id="5501939">testHookStartProcess</span>&nbsp;<span class="keyword" id="5501960">func</span><span class="op" id="5501964">(</span><span class="op" id="5501965">*</span><span class="ident" id="5501966"><a href="/net/http/cgi/host.go.html#5492869">os</a></span><span class="op" id="5501968">.</span><span class="ident" id="5501969">Process</span><span class="op" id="5501976">)</span>&nbsp;<span class="comment" id="5501978">//&nbsp;nil&nbsp;except&nbsp;for&nbsp;some&nbsp;tests</span>
</div>
</body>
</html>
