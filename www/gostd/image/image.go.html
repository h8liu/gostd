<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html" class="current">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5594876">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5594931">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5594985">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5595036">//&nbsp;Package&nbsp;image&nbsp;implements&nbsp;a&nbsp;basic&nbsp;2-D&nbsp;image&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment" id="5595091">//</span><br>
<span class="lineno"></span><span class="comment" id="5595094">//&nbsp;The&nbsp;fundamental&nbsp;interface&nbsp;is&nbsp;called&nbsp;Image.&nbsp;An&nbsp;Image&nbsp;contains&nbsp;colors,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5595172">//&nbsp;are&nbsp;described&nbsp;in&nbsp;the&nbsp;image/color&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="5595217">//</span><br>
<span class="lineno">10</span><span class="comment" id="5595220">//&nbsp;Values&nbsp;of&nbsp;the&nbsp;Image&nbsp;interface&nbsp;are&nbsp;created&nbsp;either&nbsp;by&nbsp;calling&nbsp;functions&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="5595298">//&nbsp;as&nbsp;NewRGBA&nbsp;and&nbsp;NewPaletted,&nbsp;or&nbsp;by&nbsp;calling&nbsp;Decode&nbsp;on&nbsp;an&nbsp;io.Reader&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="5595377">//&nbsp;image&nbsp;data&nbsp;in&nbsp;a&nbsp;format&nbsp;such&nbsp;as&nbsp;GIF,&nbsp;JPEG&nbsp;or&nbsp;PNG.&nbsp;Decoding&nbsp;any&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="5595453">//&nbsp;image&nbsp;format&nbsp;requires&nbsp;the&nbsp;prior&nbsp;registration&nbsp;of&nbsp;a&nbsp;decoder&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5595524">//&nbsp;Registration&nbsp;is&nbsp;typically&nbsp;automatic&nbsp;as&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;initializing&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="5595601">//&nbsp;format&#39;s&nbsp;package&nbsp;so&nbsp;that,&nbsp;to&nbsp;decode&nbsp;a&nbsp;PNG&nbsp;image,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="5595673">//&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;_&nbsp;&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5595697">//&nbsp;in&nbsp;a&nbsp;program&#39;s&nbsp;main&nbsp;package.&nbsp;The&nbsp;_&nbsp;means&nbsp;to&nbsp;import&nbsp;a&nbsp;package&nbsp;purely&nbsp;for&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5595776">//&nbsp;initialization&nbsp;side&nbsp;effects.</span><br>
<span class="lineno"></span><span class="comment" id="5595808">//</span><br>
<span class="lineno">20</span><span class="comment" id="5595811">//&nbsp;See&nbsp;&#34;The&nbsp;Go&nbsp;image&nbsp;package&#34;&nbsp;for&nbsp;more&nbsp;details:</span><br>
<span class="lineno"></span><span class="comment" id="5595859">//&nbsp;http://golang.org/doc/articles/image_package.html</span><br>
<span class="lineno"></span><span class="keyword" id="5595912">package</span>&nbsp;<span class="ident" id="5595920">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5595927">import</span>&nbsp;<span class="op" id="5595934">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5595937">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5595951">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5595954">//&nbsp;Config&nbsp;holds&nbsp;an&nbsp;image&#39;s&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions.</span><br>
<span class="lineno"></span><span class="keyword" id="5596009">type</span>&nbsp;<span class="ident" id="5596014">Config</span>&nbsp;<span class="keyword" id="5596021">struct</span>&nbsp;<span class="op" id="5596028">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596031">ColorModel</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596045">color</span><span class="op" id="5596050">.</span><span class="ident" id="5596051">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596058">Width</span><span class="op" id="5596063">,</span>&nbsp;<span class="ident" id="5596065">Height</span>&nbsp;<span class="builtintype" id="5596072">int</span><br>
<span class="lineno"></span><span class="op" id="5596076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5596079">//&nbsp;Image&nbsp;is&nbsp;a&nbsp;finite&nbsp;rectangular&nbsp;grid&nbsp;of&nbsp;color.Color&nbsp;values&nbsp;taken&nbsp;from&nbsp;a&nbsp;color</span><br>
<span class="lineno">35</span><span class="comment" id="5596158">//&nbsp;model.</span><br>
<span class="lineno"></span><span class="keyword" id="5596168">type</span>&nbsp;<span class="ident" id="5596173">Image</span>&nbsp;<span class="keyword" id="5596179">interface</span>&nbsp;<span class="op" id="5596189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5596192">//&nbsp;ColorModel&nbsp;returns&nbsp;the&nbsp;Image&#39;s&nbsp;color&nbsp;model.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596240">ColorModel</span><span class="op" id="5596250">(</span><span class="op" id="5596251">)</span>&nbsp;<span class="ident" id="5596253">color</span><span class="op" id="5596258">.</span><span class="ident" id="5596259">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5596266">//&nbsp;Bounds&nbsp;returns&nbsp;the&nbsp;domain&nbsp;for&nbsp;which&nbsp;At&nbsp;can&nbsp;return&nbsp;non-zero&nbsp;color.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5596336">//&nbsp;The&nbsp;bounds&nbsp;do&nbsp;not&nbsp;necessarily&nbsp;contain&nbsp;the&nbsp;point&nbsp;(0,&nbsp;0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596396">Bounds</span><span class="op" id="5596402">(</span><span class="op" id="5596403">)</span>&nbsp;<span class="ident" id="5596405">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5596416">//&nbsp;At&nbsp;returns&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5596465">//&nbsp;At(Bounds().Min.X,&nbsp;Bounds().Min.Y)&nbsp;returns&nbsp;the&nbsp;upper-left&nbsp;pixel&nbsp;of&nbsp;the&nbsp;grid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5596546">//&nbsp;At(Bounds().Max.X-1,&nbsp;Bounds().Max.Y-1)&nbsp;returns&nbsp;the&nbsp;lower-right&nbsp;one.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596618">At</span><span class="op" id="5596620">(</span><span class="ident" id="5596621">x</span><span class="op" id="5596622">,</span>&nbsp;<span class="ident" id="5596624">y</span>&nbsp;<span class="builtintype" id="5596626">int</span><span class="op" id="5596629">)</span>&nbsp;<span class="ident" id="5596631">color</span><span class="op" id="5596636">.</span><span class="ident" id="5596637">Color</span><br>
<span class="lineno"></span><span class="op" id="5596643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5596646">//&nbsp;PalettedImage&nbsp;is&nbsp;an&nbsp;image&nbsp;whose&nbsp;colors&nbsp;may&nbsp;come&nbsp;from&nbsp;a&nbsp;limited&nbsp;palette.</span><br>
<span class="lineno"></span><span class="comment" id="5596721">//&nbsp;If&nbsp;m&nbsp;is&nbsp;a&nbsp;PalettedImage&nbsp;and&nbsp;m.ColorModel()&nbsp;returns&nbsp;a&nbsp;PalettedColorModel&nbsp;p,</span><br>
<span class="lineno">50</span><span class="comment" id="5596799">//&nbsp;then&nbsp;m.At(x,&nbsp;y)&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;p[m.ColorIndexAt(x,&nbsp;y)].&nbsp;If&nbsp;m&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5596874">//&nbsp;color&nbsp;model&nbsp;is&nbsp;not&nbsp;a&nbsp;PalettedColorModel,&nbsp;then&nbsp;ColorIndexAt&#39;s&nbsp;behavior&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5596950">//&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="keyword" id="5596964">type</span>&nbsp;<span class="ident" id="5596969">PalettedImage</span>&nbsp;<span class="keyword" id="5596983">interface</span>&nbsp;<span class="op" id="5596993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5596996">//&nbsp;ColorIndexAt&nbsp;returns&nbsp;the&nbsp;palette&nbsp;index&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597063">ColorIndexAt</span><span class="op" id="5597075">(</span><span class="ident" id="5597076">x</span><span class="op" id="5597077">,</span>&nbsp;<span class="ident" id="5597079">y</span>&nbsp;<span class="builtintype" id="5597081">int</span><span class="op" id="5597084">)</span>&nbsp;<span class="builtintype" id="5597086">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597093">Image</span><br>
<span class="lineno"></span><span class="op" id="5597099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5597102">//&nbsp;RGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA&nbsp;values.</span><br>
<span class="lineno">60</span><span class="keyword" id="5597175">type</span>&nbsp;<span class="ident" id="5597180">RGBA</span>&nbsp;<span class="keyword" id="5597185">struct</span>&nbsp;<span class="op" id="5597192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597195">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597263">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597331">Pix</span>&nbsp;<span class="op" id="5597335">[</span><span class="op" id="5597336">]</span><span class="builtintype" id="5597337">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597344">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597420">Stride</span>&nbsp;<span class="builtintype" id="5597427">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597432">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597464">Rect</span>&nbsp;<span class="ident" id="5597469">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5597479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="5597482">func</span>&nbsp;<span class="op" id="5597487">(</span><span class="ident" id="5597488">p</span>&nbsp;<span class="op" id="5597490">*</span><span class="ident" id="5597491">RGBA</span><span class="op" id="5597495">)</span>&nbsp;<span class="ident" id="5597497">ColorModel</span><span class="op" id="5597507">(</span><span class="op" id="5597508">)</span>&nbsp;<span class="ident" id="5597510">color</span><span class="op" id="5597515">.</span><span class="ident" id="5597516">Model</span>&nbsp;<span class="op" id="5597522">{</span>&nbsp;<span class="keyword" id="5597524">return</span>&nbsp;<span class="ident" id="5597531">color</span><span class="op" id="5597536">.</span><span class="ident" id="5597537">RGBAModel</span>&nbsp;<span class="op" id="5597547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5597550">func</span>&nbsp;<span class="op" id="5597555">(</span><span class="ident" id="5597556">p</span>&nbsp;<span class="op" id="5597558">*</span><span class="ident" id="5597559">RGBA</span><span class="op" id="5597563">)</span>&nbsp;<span class="ident" id="5597565">Bounds</span><span class="op" id="5597571">(</span><span class="op" id="5597572">)</span>&nbsp;<span class="ident" id="5597574">Rectangle</span>&nbsp;<span class="op" id="5597584">{</span>&nbsp;<span class="keyword" id="5597586">return</span>&nbsp;<span class="ident" id="5597593">p</span><span class="op" id="5597594">.</span><span class="ident" id="5597595">Rect</span>&nbsp;<span class="op" id="5597600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5597603">func</span>&nbsp;<span class="op" id="5597608">(</span><span class="ident" id="5597609">p</span>&nbsp;<span class="op" id="5597611">*</span><span class="ident" id="5597612">RGBA</span><span class="op" id="5597616">)</span>&nbsp;<span class="ident" id="5597618">At</span><span class="op" id="5597620">(</span><span class="ident" id="5597621">x</span><span class="op" id="5597622">,</span>&nbsp;<span class="ident" id="5597624">y</span>&nbsp;<span class="builtintype" id="5597626">int</span><span class="op" id="5597629">)</span>&nbsp;<span class="ident" id="5597631">color</span><span class="op" id="5597636">.</span><span class="ident" id="5597637">Color</span>&nbsp;<span class="op" id="5597643">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597646">return</span>&nbsp;<span class="ident" id="5597653">p</span><span class="op" id="5597654">.</span><span class="ident" id="5597655">RGBAAt</span><span class="op" id="5597661">(</span><span class="ident" id="5597662">x</span><span class="op" id="5597663">,</span>&nbsp;<span class="ident" id="5597665">y</span><span class="op" id="5597666">)</span><br>
<span class="lineno"></span><span class="op" id="5597668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5597671">func</span>&nbsp;<span class="op" id="5597676">(</span><span class="ident" id="5597677">p</span>&nbsp;<span class="op" id="5597679">*</span><span class="ident" id="5597680">RGBA</span><span class="op" id="5597684">)</span>&nbsp;<span class="ident" id="5597686">RGBAAt</span><span class="op" id="5597692">(</span><span class="ident" id="5597693">x</span><span class="op" id="5597694">,</span>&nbsp;<span class="ident" id="5597696">y</span>&nbsp;<span class="builtintype" id="5597698">int</span><span class="op" id="5597701">)</span>&nbsp;<span class="ident" id="5597703">color</span><span class="op" id="5597708">.</span><span class="ident" id="5597709">RGBA</span>&nbsp;<span class="op" id="5597714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597717">if</span>&nbsp;<span class="op" id="5597720">!</span><span class="op" id="5597721">(</span><span class="ident" id="5597722">Point</span><span class="op" id="5597727">{</span><span class="ident" id="5597728">x</span><span class="op" id="5597729">,</span>&nbsp;<span class="ident" id="5597731">y</span><span class="op" id="5597732">}</span><span class="op" id="5597733">.</span><span class="ident" id="5597734">In</span><span class="op" id="5597736">(</span><span class="ident" id="5597737">p</span><span class="op" id="5597738">.</span><span class="ident" id="5597739">Rect</span><span class="op" id="5597743">)</span><span class="op" id="5597744">)</span>&nbsp;<span class="op" id="5597746">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597750">return</span>&nbsp;<span class="ident" id="5597757">color</span><span class="op" id="5597762">.</span><span class="ident" id="5597763">RGBA</span><span class="op" id="5597767">{</span><span class="op" id="5597768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5597771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597774">i</span>&nbsp;<span class="op" id="5597776">:=</span>&nbsp;<span class="ident" id="5597779">p</span><span class="op" id="5597780">.</span><span class="ident" id="5597781">PixOffset</span><span class="op" id="5597790">(</span><span class="ident" id="5597791">x</span><span class="op" id="5597792">,</span>&nbsp;<span class="ident" id="5597794">y</span><span class="op" id="5597795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597798">return</span>&nbsp;<span class="ident" id="5597805">color</span><span class="op" id="5597810">.</span><span class="ident" id="5597811">RGBA</span><span class="op" id="5597815">{</span><span class="ident" id="5597816">p</span><span class="op" id="5597817">.</span><span class="ident" id="5597818">Pix</span><span class="op" id="5597821">[</span><span class="ident" id="5597822">i</span><span class="op" id="5597823">+</span><span class="num" id="5597824">0</span><span class="op" id="5597825">]</span><span class="op" id="5597826">,</span>&nbsp;<span class="ident" id="5597828">p</span><span class="op" id="5597829">.</span><span class="ident" id="5597830">Pix</span><span class="op" id="5597833">[</span><span class="ident" id="5597834">i</span><span class="op" id="5597835">+</span><span class="num" id="5597836">1</span><span class="op" id="5597837">]</span><span class="op" id="5597838">,</span>&nbsp;<span class="ident" id="5597840">p</span><span class="op" id="5597841">.</span><span class="ident" id="5597842">Pix</span><span class="op" id="5597845">[</span><span class="ident" id="5597846">i</span><span class="op" id="5597847">+</span><span class="num" id="5597848">2</span><span class="op" id="5597849">]</span><span class="op" id="5597850">,</span>&nbsp;<span class="ident" id="5597852">p</span><span class="op" id="5597853">.</span><span class="ident" id="5597854">Pix</span><span class="op" id="5597857">[</span><span class="ident" id="5597858">i</span><span class="op" id="5597859">+</span><span class="num" id="5597860">3</span><span class="op" id="5597861">]</span><span class="op" id="5597862">}</span><br>
<span class="lineno"></span><span class="op" id="5597864">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="5597867">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5597946">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5597970">func</span>&nbsp;<span class="op" id="5597975">(</span><span class="ident" id="5597976">p</span>&nbsp;<span class="op" id="5597978">*</span><span class="ident" id="5597979">RGBA</span><span class="op" id="5597983">)</span>&nbsp;<span class="ident" id="5597985">PixOffset</span><span class="op" id="5597994">(</span><span class="ident" id="5597995">x</span><span class="op" id="5597996">,</span>&nbsp;<span class="ident" id="5597998">y</span>&nbsp;<span class="builtintype" id="5598000">int</span><span class="op" id="5598003">)</span>&nbsp;<span class="builtintype" id="5598005">int</span>&nbsp;<span class="op" id="5598009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598012">return</span>&nbsp;<span class="op" id="5598019">(</span><span class="ident" id="5598020">y</span><span class="op" id="5598021">-</span><span class="ident" id="5598022">p</span><span class="op" id="5598023">.</span><span class="ident" id="5598024">Rect</span><span class="op" id="5598028">.</span><span class="ident" id="5598029">Min</span><span class="op" id="5598032">.</span><span class="ident" id="5598033">Y</span><span class="op" id="5598034">)</span><span class="op" id="5598035">*</span><span class="ident" id="5598036">p</span><span class="op" id="5598037">.</span><span class="ident" id="5598038">Stride</span>&nbsp;<span class="op" id="5598045">+</span>&nbsp;<span class="op" id="5598047">(</span><span class="ident" id="5598048">x</span><span class="op" id="5598049">-</span><span class="ident" id="5598050">p</span><span class="op" id="5598051">.</span><span class="ident" id="5598052">Rect</span><span class="op" id="5598056">.</span><span class="ident" id="5598057">Min</span><span class="op" id="5598060">.</span><span class="ident" id="5598061">X</span><span class="op" id="5598062">)</span><span class="op" id="5598063">*</span><span class="num" id="5598064">4</span><br>
<span class="lineno">90</span><span class="op" id="5598066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5598069">func</span>&nbsp;<span class="op" id="5598074">(</span><span class="ident" id="5598075">p</span>&nbsp;<span class="op" id="5598077">*</span><span class="ident" id="5598078">RGBA</span><span class="op" id="5598082">)</span>&nbsp;<span class="ident" id="5598084">Set</span><span class="op" id="5598087">(</span><span class="ident" id="5598088">x</span><span class="op" id="5598089">,</span>&nbsp;<span class="ident" id="5598091">y</span>&nbsp;<span class="builtintype" id="5598093">int</span><span class="op" id="5598096">,</span>&nbsp;<span class="ident" id="5598098">c</span>&nbsp;<span class="ident" id="5598100">color</span><span class="op" id="5598105">.</span><span class="ident" id="5598106">Color</span><span class="op" id="5598111">)</span>&nbsp;<span class="op" id="5598113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598116">if</span>&nbsp;<span class="op" id="5598119">!</span><span class="op" id="5598120">(</span><span class="ident" id="5598121">Point</span><span class="op" id="5598126">{</span><span class="ident" id="5598127">x</span><span class="op" id="5598128">,</span>&nbsp;<span class="ident" id="5598130">y</span><span class="op" id="5598131">}</span><span class="op" id="5598132">.</span><span class="ident" id="5598133">In</span><span class="op" id="5598135">(</span><span class="ident" id="5598136">p</span><span class="op" id="5598137">.</span><span class="ident" id="5598138">Rect</span><span class="op" id="5598142">)</span><span class="op" id="5598143">)</span>&nbsp;<span class="op" id="5598145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598149">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5598157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598160">i</span>&nbsp;<span class="op" id="5598162">:=</span>&nbsp;<span class="ident" id="5598165">p</span><span class="op" id="5598166">.</span><span class="ident" id="5598167">PixOffset</span><span class="op" id="5598176">(</span><span class="ident" id="5598177">x</span><span class="op" id="5598178">,</span>&nbsp;<span class="ident" id="5598180">y</span><span class="op" id="5598181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598184">c1</span>&nbsp;<span class="op" id="5598187">:=</span>&nbsp;<span class="ident" id="5598190">color</span><span class="op" id="5598195">.</span><span class="ident" id="5598196">RGBAModel</span><span class="op" id="5598205">.</span><span class="ident" id="5598206">Convert</span><span class="op" id="5598213">(</span><span class="ident" id="5598214">c</span><span class="op" id="5598215">)</span><span class="op" id="5598216">.</span><span class="op" id="5598217">(</span><span class="ident" id="5598218">color</span><span class="op" id="5598223">.</span><span class="ident" id="5598224">RGBA</span><span class="op" id="5598228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598231">p</span><span class="op" id="5598232">.</span><span class="ident" id="5598233">Pix</span><span class="op" id="5598236">[</span><span class="ident" id="5598237">i</span><span class="op" id="5598238">+</span><span class="num" id="5598239">0</span><span class="op" id="5598240">]</span>&nbsp;<span class="op" id="5598242">=</span>&nbsp;<span class="ident" id="5598244">c1</span><span class="op" id="5598246">.</span><span class="ident" id="5598247">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598250">p</span><span class="op" id="5598251">.</span><span class="ident" id="5598252">Pix</span><span class="op" id="5598255">[</span><span class="ident" id="5598256">i</span><span class="op" id="5598257">+</span><span class="num" id="5598258">1</span><span class="op" id="5598259">]</span>&nbsp;<span class="op" id="5598261">=</span>&nbsp;<span class="ident" id="5598263">c1</span><span class="op" id="5598265">.</span><span class="ident" id="5598266">G</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598269">p</span><span class="op" id="5598270">.</span><span class="ident" id="5598271">Pix</span><span class="op" id="5598274">[</span><span class="ident" id="5598275">i</span><span class="op" id="5598276">+</span><span class="num" id="5598277">2</span><span class="op" id="5598278">]</span>&nbsp;<span class="op" id="5598280">=</span>&nbsp;<span class="ident" id="5598282">c1</span><span class="op" id="5598284">.</span><span class="ident" id="5598285">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598288">p</span><span class="op" id="5598289">.</span><span class="ident" id="5598290">Pix</span><span class="op" id="5598293">[</span><span class="ident" id="5598294">i</span><span class="op" id="5598295">+</span><span class="num" id="5598296">3</span><span class="op" id="5598297">]</span>&nbsp;<span class="op" id="5598299">=</span>&nbsp;<span class="ident" id="5598301">c1</span><span class="op" id="5598303">.</span><span class="ident" id="5598304">A</span><br>
<span class="lineno"></span><span class="op" id="5598306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5598309">func</span>&nbsp;<span class="op" id="5598314">(</span><span class="ident" id="5598315">p</span>&nbsp;<span class="op" id="5598317">*</span><span class="ident" id="5598318">RGBA</span><span class="op" id="5598322">)</span>&nbsp;<span class="ident" id="5598324">SetRGBA</span><span class="op" id="5598331">(</span><span class="ident" id="5598332">x</span><span class="op" id="5598333">,</span>&nbsp;<span class="ident" id="5598335">y</span>&nbsp;<span class="builtintype" id="5598337">int</span><span class="op" id="5598340">,</span>&nbsp;<span class="ident" id="5598342">c</span>&nbsp;<span class="ident" id="5598344">color</span><span class="op" id="5598349">.</span><span class="ident" id="5598350">RGBA</span><span class="op" id="5598354">)</span>&nbsp;<span class="op" id="5598356">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598359">if</span>&nbsp;<span class="op" id="5598362">!</span><span class="op" id="5598363">(</span><span class="ident" id="5598364">Point</span><span class="op" id="5598369">{</span><span class="ident" id="5598370">x</span><span class="op" id="5598371">,</span>&nbsp;<span class="ident" id="5598373">y</span><span class="op" id="5598374">}</span><span class="op" id="5598375">.</span><span class="ident" id="5598376">In</span><span class="op" id="5598378">(</span><span class="ident" id="5598379">p</span><span class="op" id="5598380">.</span><span class="ident" id="5598381">Rect</span><span class="op" id="5598385">)</span><span class="op" id="5598386">)</span>&nbsp;<span class="op" id="5598388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598392">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5598400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598403">i</span>&nbsp;<span class="op" id="5598405">:=</span>&nbsp;<span class="ident" id="5598408">p</span><span class="op" id="5598409">.</span><span class="ident" id="5598410">PixOffset</span><span class="op" id="5598419">(</span><span class="ident" id="5598420">x</span><span class="op" id="5598421">,</span>&nbsp;<span class="ident" id="5598423">y</span><span class="op" id="5598424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598427">p</span><span class="op" id="5598428">.</span><span class="ident" id="5598429">Pix</span><span class="op" id="5598432">[</span><span class="ident" id="5598433">i</span><span class="op" id="5598434">+</span><span class="num" id="5598435">0</span><span class="op" id="5598436">]</span>&nbsp;<span class="op" id="5598438">=</span>&nbsp;<span class="ident" id="5598440">c</span><span class="op" id="5598441">.</span><span class="ident" id="5598442">R</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598445">p</span><span class="op" id="5598446">.</span><span class="ident" id="5598447">Pix</span><span class="op" id="5598450">[</span><span class="ident" id="5598451">i</span><span class="op" id="5598452">+</span><span class="num" id="5598453">1</span><span class="op" id="5598454">]</span>&nbsp;<span class="op" id="5598456">=</span>&nbsp;<span class="ident" id="5598458">c</span><span class="op" id="5598459">.</span><span class="ident" id="5598460">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598463">p</span><span class="op" id="5598464">.</span><span class="ident" id="5598465">Pix</span><span class="op" id="5598468">[</span><span class="ident" id="5598469">i</span><span class="op" id="5598470">+</span><span class="num" id="5598471">2</span><span class="op" id="5598472">]</span>&nbsp;<span class="op" id="5598474">=</span>&nbsp;<span class="ident" id="5598476">c</span><span class="op" id="5598477">.</span><span class="ident" id="5598478">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598481">p</span><span class="op" id="5598482">.</span><span class="ident" id="5598483">Pix</span><span class="op" id="5598486">[</span><span class="ident" id="5598487">i</span><span class="op" id="5598488">+</span><span class="num" id="5598489">3</span><span class="op" id="5598490">]</span>&nbsp;<span class="op" id="5598492">=</span>&nbsp;<span class="ident" id="5598494">c</span><span class="op" id="5598495">.</span><span class="ident" id="5598496">A</span><br>
<span class="lineno"></span><span class="op" id="5598498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5598501">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5598578">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5598650">func</span>&nbsp;<span class="op" id="5598655">(</span><span class="ident" id="5598656">p</span>&nbsp;<span class="op" id="5598658">*</span><span class="ident" id="5598659">RGBA</span><span class="op" id="5598663">)</span>&nbsp;<span class="ident" id="5598665">SubImage</span><span class="op" id="5598673">(</span><span class="ident" id="5598674">r</span>&nbsp;<span class="ident" id="5598676">Rectangle</span><span class="op" id="5598685">)</span>&nbsp;<span class="ident" id="5598687">Image</span>&nbsp;<span class="op" id="5598693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598696">r</span>&nbsp;<span class="op" id="5598698">=</span>&nbsp;<span class="ident" id="5598700">r</span><span class="op" id="5598701">.</span><span class="ident" id="5598702">Intersect</span><span class="op" id="5598711">(</span><span class="ident" id="5598712">p</span><span class="op" id="5598713">.</span><span class="ident" id="5598714">Rect</span><span class="op" id="5598718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598721">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598802">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598884">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598934">if</span>&nbsp;<span class="ident" id="5598937">r</span><span class="op" id="5598938">.</span><span class="ident" id="5598939">Empty</span><span class="op" id="5598944">(</span><span class="op" id="5598945">)</span>&nbsp;<span class="op" id="5598947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598951">return</span>&nbsp;<span class="op" id="5598958">&amp;</span><span class="ident" id="5598959">RGBA</span><span class="op" id="5598963">{</span><span class="op" id="5598964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5598967">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598970">i</span>&nbsp;<span class="op" id="5598972">:=</span>&nbsp;<span class="ident" id="5598975">p</span><span class="op" id="5598976">.</span><span class="ident" id="5598977">PixOffset</span><span class="op" id="5598986">(</span><span class="ident" id="5598987">r</span><span class="op" id="5598988">.</span><span class="ident" id="5598989">Min</span><span class="op" id="5598992">.</span><span class="ident" id="5598993">X</span><span class="op" id="5598994">,</span>&nbsp;<span class="ident" id="5598996">r</span><span class="op" id="5598997">.</span><span class="ident" id="5598998">Min</span><span class="op" id="5599001">.</span><span class="ident" id="5599002">Y</span><span class="op" id="5599003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599006">return</span>&nbsp;<span class="op" id="5599013">&amp;</span><span class="ident" id="5599014">RGBA</span><span class="op" id="5599018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599022">Pix</span><span class="op" id="5599025">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599030">p</span><span class="op" id="5599031">.</span><span class="ident" id="5599032">Pix</span><span class="op" id="5599035">[</span><span class="ident" id="5599036">i</span><span class="op" id="5599037">:</span><span class="op" id="5599038">]</span><span class="op" id="5599039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599043">Stride</span><span class="op" id="5599049">:</span>&nbsp;<span class="ident" id="5599051">p</span><span class="op" id="5599052">.</span><span class="ident" id="5599053">Stride</span><span class="op" id="5599059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599063">Rect</span><span class="op" id="5599067">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5599071">r</span><span class="op" id="5599072">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599075">}</span><br>
<span class="lineno"></span><span class="op" id="5599077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5599080">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5599153">func</span>&nbsp;<span class="op" id="5599158">(</span><span class="ident" id="5599159">p</span>&nbsp;<span class="op" id="5599161">*</span><span class="ident" id="5599162">RGBA</span><span class="op" id="5599166">)</span>&nbsp;<span class="ident" id="5599168">Opaque</span><span class="op" id="5599174">(</span><span class="op" id="5599175">)</span>&nbsp;<span class="builtintype" id="5599177">bool</span>&nbsp;<span class="op" id="5599182">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599185">if</span>&nbsp;<span class="ident" id="5599188">p</span><span class="op" id="5599189">.</span><span class="ident" id="5599190">Rect</span><span class="op" id="5599194">.</span><span class="ident" id="5599195">Empty</span><span class="op" id="5599200">(</span><span class="op" id="5599201">)</span>&nbsp;<span class="op" id="5599203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599207">return</span>&nbsp;<span class="builtintype" id="5599214">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599223">i0</span><span class="op" id="5599225">,</span>&nbsp;<span class="ident" id="5599227">i1</span>&nbsp;<span class="op" id="5599230">:=</span>&nbsp;<span class="num" id="5599233">3</span><span class="op" id="5599234">,</span>&nbsp;<span class="ident" id="5599236">p</span><span class="op" id="5599237">.</span><span class="ident" id="5599238">Rect</span><span class="op" id="5599242">.</span><span class="ident" id="5599243">Dx</span><span class="op" id="5599245">(</span><span class="op" id="5599246">)</span><span class="op" id="5599247">*</span><span class="num" id="5599248">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599251">for</span>&nbsp;<span class="ident" id="5599255">y</span>&nbsp;<span class="op" id="5599257">:=</span>&nbsp;<span class="ident" id="5599260">p</span><span class="op" id="5599261">.</span><span class="ident" id="5599262">Rect</span><span class="op" id="5599266">.</span><span class="ident" id="5599267">Min</span><span class="op" id="5599270">.</span><span class="ident" id="5599271">Y</span><span class="op" id="5599272">;</span>&nbsp;<span class="ident" id="5599274">y</span>&nbsp;<span class="op" id="5599276">&lt;</span>&nbsp;<span class="ident" id="5599278">p</span><span class="op" id="5599279">.</span><span class="ident" id="5599280">Rect</span><span class="op" id="5599284">.</span><span class="ident" id="5599285">Max</span><span class="op" id="5599288">.</span><span class="ident" id="5599289">Y</span><span class="op" id="5599290">;</span>&nbsp;<span class="ident" id="5599292">y</span><span class="op" id="5599293">++</span>&nbsp;<span class="op" id="5599296">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599300">for</span>&nbsp;<span class="ident" id="5599304">i</span>&nbsp;<span class="op" id="5599306">:=</span>&nbsp;<span class="ident" id="5599309">i0</span><span class="op" id="5599311">;</span>&nbsp;<span class="ident" id="5599313">i</span>&nbsp;<span class="op" id="5599315">&lt;</span>&nbsp;<span class="ident" id="5599317">i1</span><span class="op" id="5599319">;</span>&nbsp;<span class="ident" id="5599321">i</span>&nbsp;<span class="op" id="5599323">+=</span>&nbsp;<span class="num" id="5599326">4</span>&nbsp;<span class="op" id="5599328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599333">if</span>&nbsp;<span class="ident" id="5599336">p</span><span class="op" id="5599337">.</span><span class="ident" id="5599338">Pix</span><span class="op" id="5599341">[</span><span class="ident" id="5599342">i</span><span class="op" id="5599343">]</span>&nbsp;<span class="op" id="5599345">!=</span>&nbsp;<span class="num" id="5599348">0xff</span>&nbsp;<span class="op" id="5599353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599359">return</span>&nbsp;<span class="builtintype" id="5599366">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599379">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599383">i0</span>&nbsp;<span class="op" id="5599386">+=</span>&nbsp;<span class="ident" id="5599389">p</span><span class="op" id="5599390">.</span><span class="ident" id="5599391">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599400">i1</span>&nbsp;<span class="op" id="5599403">+=</span>&nbsp;<span class="ident" id="5599406">p</span><span class="op" id="5599407">.</span><span class="ident" id="5599408">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599419">return</span>&nbsp;<span class="builtintype" id="5599426">true</span><br>
<span class="lineno"></span><span class="op" id="5599431">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="5599434">//&nbsp;NewRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5599487">func</span>&nbsp;<span class="ident" id="5599492">NewRGBA</span><span class="op" id="5599499">(</span><span class="ident" id="5599500">r</span>&nbsp;<span class="ident" id="5599502">Rectangle</span><span class="op" id="5599511">)</span>&nbsp;<span class="op" id="5599513">*</span><span class="ident" id="5599514">RGBA</span>&nbsp;<span class="op" id="5599519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599522">w</span><span class="op" id="5599523">,</span>&nbsp;<span class="ident" id="5599525">h</span>&nbsp;<span class="op" id="5599527">:=</span>&nbsp;<span class="ident" id="5599530">r</span><span class="op" id="5599531">.</span><span class="ident" id="5599532">Dx</span><span class="op" id="5599534">(</span><span class="op" id="5599535">)</span><span class="op" id="5599536">,</span>&nbsp;<span class="ident" id="5599538">r</span><span class="op" id="5599539">.</span><span class="ident" id="5599540">Dy</span><span class="op" id="5599542">(</span><span class="op" id="5599543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599546">buf</span>&nbsp;<span class="op" id="5599550">:=</span>&nbsp;<span class="builtinfunc" id="5599553">make</span><span class="op" id="5599557">(</span><span class="op" id="5599558">[</span><span class="op" id="5599559">]</span><span class="builtintype" id="5599560">uint8</span><span class="op" id="5599565">,</span>&nbsp;<span class="num" id="5599567">4</span><span class="op" id="5599568">*</span><span class="ident" id="5599569">w</span><span class="op" id="5599570">*</span><span class="ident" id="5599571">h</span><span class="op" id="5599572">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599575">return</span>&nbsp;<span class="op" id="5599582">&amp;</span><span class="ident" id="5599583">RGBA</span><span class="op" id="5599587">{</span><span class="ident" id="5599588">buf</span><span class="op" id="5599591">,</span>&nbsp;<span class="num" id="5599593">4</span>&nbsp;<span class="op" id="5599595">*</span>&nbsp;<span class="ident" id="5599597">w</span><span class="op" id="5599598">,</span>&nbsp;<span class="ident" id="5599600">r</span><span class="op" id="5599601">}</span><br>
<span class="lineno"></span><span class="op" id="5599603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5599606">//&nbsp;RGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5599683">type</span>&nbsp;<span class="ident" id="5599688">RGBA64</span>&nbsp;<span class="keyword" id="5599695">struct</span>&nbsp;<span class="op" id="5599702">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599705">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599795">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599863">Pix</span>&nbsp;<span class="op" id="5599867">[</span><span class="op" id="5599868">]</span><span class="builtintype" id="5599869">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599876">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599952">Stride</span>&nbsp;<span class="builtintype" id="5599959">int</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599964">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599996">Rect</span>&nbsp;<span class="ident" id="5600001">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5600011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5600014">func</span>&nbsp;<span class="op" id="5600019">(</span><span class="ident" id="5600020">p</span>&nbsp;<span class="op" id="5600022">*</span><span class="ident" id="5600023">RGBA64</span><span class="op" id="5600029">)</span>&nbsp;<span class="ident" id="5600031">ColorModel</span><span class="op" id="5600041">(</span><span class="op" id="5600042">)</span>&nbsp;<span class="ident" id="5600044">color</span><span class="op" id="5600049">.</span><span class="ident" id="5600050">Model</span>&nbsp;<span class="op" id="5600056">{</span>&nbsp;<span class="keyword" id="5600058">return</span>&nbsp;<span class="ident" id="5600065">color</span><span class="op" id="5600070">.</span><span class="ident" id="5600071">RGBA64Model</span>&nbsp;<span class="op" id="5600083">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5600086">func</span>&nbsp;<span class="op" id="5600091">(</span><span class="ident" id="5600092">p</span>&nbsp;<span class="op" id="5600094">*</span><span class="ident" id="5600095">RGBA64</span><span class="op" id="5600101">)</span>&nbsp;<span class="ident" id="5600103">Bounds</span><span class="op" id="5600109">(</span><span class="op" id="5600110">)</span>&nbsp;<span class="ident" id="5600112">Rectangle</span>&nbsp;<span class="op" id="5600122">{</span>&nbsp;<span class="keyword" id="5600124">return</span>&nbsp;<span class="ident" id="5600131">p</span><span class="op" id="5600132">.</span><span class="ident" id="5600133">Rect</span>&nbsp;<span class="op" id="5600138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5600141">func</span>&nbsp;<span class="op" id="5600146">(</span><span class="ident" id="5600147">p</span>&nbsp;<span class="op" id="5600149">*</span><span class="ident" id="5600150">RGBA64</span><span class="op" id="5600156">)</span>&nbsp;<span class="ident" id="5600158">At</span><span class="op" id="5600160">(</span><span class="ident" id="5600161">x</span><span class="op" id="5600162">,</span>&nbsp;<span class="ident" id="5600164">y</span>&nbsp;<span class="builtintype" id="5600166">int</span><span class="op" id="5600169">)</span>&nbsp;<span class="ident" id="5600171">color</span><span class="op" id="5600176">.</span><span class="ident" id="5600177">Color</span>&nbsp;<span class="op" id="5600183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600186">return</span>&nbsp;<span class="ident" id="5600193">p</span><span class="op" id="5600194">.</span><span class="ident" id="5600195">RGBA64At</span><span class="op" id="5600203">(</span><span class="ident" id="5600204">x</span><span class="op" id="5600205">,</span>&nbsp;<span class="ident" id="5600207">y</span><span class="op" id="5600208">)</span><br>
<span class="lineno">175</span><span class="op" id="5600210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5600213">func</span>&nbsp;<span class="op" id="5600218">(</span><span class="ident" id="5600219">p</span>&nbsp;<span class="op" id="5600221">*</span><span class="ident" id="5600222">RGBA64</span><span class="op" id="5600228">)</span>&nbsp;<span class="ident" id="5600230">RGBA64At</span><span class="op" id="5600238">(</span><span class="ident" id="5600239">x</span><span class="op" id="5600240">,</span>&nbsp;<span class="ident" id="5600242">y</span>&nbsp;<span class="builtintype" id="5600244">int</span><span class="op" id="5600247">)</span>&nbsp;<span class="ident" id="5600249">color</span><span class="op" id="5600254">.</span><span class="ident" id="5600255">RGBA64</span>&nbsp;<span class="op" id="5600262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600265">if</span>&nbsp;<span class="op" id="5600268">!</span><span class="op" id="5600269">(</span><span class="ident" id="5600270">Point</span><span class="op" id="5600275">{</span><span class="ident" id="5600276">x</span><span class="op" id="5600277">,</span>&nbsp;<span class="ident" id="5600279">y</span><span class="op" id="5600280">}</span><span class="op" id="5600281">.</span><span class="ident" id="5600282">In</span><span class="op" id="5600284">(</span><span class="ident" id="5600285">p</span><span class="op" id="5600286">.</span><span class="ident" id="5600287">Rect</span><span class="op" id="5600291">)</span><span class="op" id="5600292">)</span>&nbsp;<span class="op" id="5600294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600298">return</span>&nbsp;<span class="ident" id="5600305">color</span><span class="op" id="5600310">.</span><span class="ident" id="5600311">RGBA64</span><span class="op" id="5600317">{</span><span class="op" id="5600318">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5600321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600324">i</span>&nbsp;<span class="op" id="5600326">:=</span>&nbsp;<span class="ident" id="5600329">p</span><span class="op" id="5600330">.</span><span class="ident" id="5600331">PixOffset</span><span class="op" id="5600340">(</span><span class="ident" id="5600341">x</span><span class="op" id="5600342">,</span>&nbsp;<span class="ident" id="5600344">y</span><span class="op" id="5600345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600348">return</span>&nbsp;<span class="ident" id="5600355">color</span><span class="op" id="5600360">.</span><span class="ident" id="5600361">RGBA64</span><span class="op" id="5600367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5600371">uint16</span><span class="op" id="5600377">(</span><span class="ident" id="5600378">p</span><span class="op" id="5600379">.</span><span class="ident" id="5600380">Pix</span><span class="op" id="5600383">[</span><span class="ident" id="5600384">i</span><span class="op" id="5600385">+</span><span class="num" id="5600386">0</span><span class="op" id="5600387">]</span><span class="op" id="5600388">)</span><span class="op" id="5600389">&lt;&lt;</span><span class="num" id="5600391">8</span>&nbsp;<span class="op" id="5600393">|</span>&nbsp;<span class="builtintype" id="5600395">uint16</span><span class="op" id="5600401">(</span><span class="ident" id="5600402">p</span><span class="op" id="5600403">.</span><span class="ident" id="5600404">Pix</span><span class="op" id="5600407">[</span><span class="ident" id="5600408">i</span><span class="op" id="5600409">+</span><span class="num" id="5600410">1</span><span class="op" id="5600411">]</span><span class="op" id="5600412">)</span><span class="op" id="5600413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5600417">uint16</span><span class="op" id="5600423">(</span><span class="ident" id="5600424">p</span><span class="op" id="5600425">.</span><span class="ident" id="5600426">Pix</span><span class="op" id="5600429">[</span><span class="ident" id="5600430">i</span><span class="op" id="5600431">+</span><span class="num" id="5600432">2</span><span class="op" id="5600433">]</span><span class="op" id="5600434">)</span><span class="op" id="5600435">&lt;&lt;</span><span class="num" id="5600437">8</span>&nbsp;<span class="op" id="5600439">|</span>&nbsp;<span class="builtintype" id="5600441">uint16</span><span class="op" id="5600447">(</span><span class="ident" id="5600448">p</span><span class="op" id="5600449">.</span><span class="ident" id="5600450">Pix</span><span class="op" id="5600453">[</span><span class="ident" id="5600454">i</span><span class="op" id="5600455">+</span><span class="num" id="5600456">3</span><span class="op" id="5600457">]</span><span class="op" id="5600458">)</span><span class="op" id="5600459">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5600463">uint16</span><span class="op" id="5600469">(</span><span class="ident" id="5600470">p</span><span class="op" id="5600471">.</span><span class="ident" id="5600472">Pix</span><span class="op" id="5600475">[</span><span class="ident" id="5600476">i</span><span class="op" id="5600477">+</span><span class="num" id="5600478">4</span><span class="op" id="5600479">]</span><span class="op" id="5600480">)</span><span class="op" id="5600481">&lt;&lt;</span><span class="num" id="5600483">8</span>&nbsp;<span class="op" id="5600485">|</span>&nbsp;<span class="builtintype" id="5600487">uint16</span><span class="op" id="5600493">(</span><span class="ident" id="5600494">p</span><span class="op" id="5600495">.</span><span class="ident" id="5600496">Pix</span><span class="op" id="5600499">[</span><span class="ident" id="5600500">i</span><span class="op" id="5600501">+</span><span class="num" id="5600502">5</span><span class="op" id="5600503">]</span><span class="op" id="5600504">)</span><span class="op" id="5600505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5600509">uint16</span><span class="op" id="5600515">(</span><span class="ident" id="5600516">p</span><span class="op" id="5600517">.</span><span class="ident" id="5600518">Pix</span><span class="op" id="5600521">[</span><span class="ident" id="5600522">i</span><span class="op" id="5600523">+</span><span class="num" id="5600524">6</span><span class="op" id="5600525">]</span><span class="op" id="5600526">)</span><span class="op" id="5600527">&lt;&lt;</span><span class="num" id="5600529">8</span>&nbsp;<span class="op" id="5600531">|</span>&nbsp;<span class="builtintype" id="5600533">uint16</span><span class="op" id="5600539">(</span><span class="ident" id="5600540">p</span><span class="op" id="5600541">.</span><span class="ident" id="5600542">Pix</span><span class="op" id="5600545">[</span><span class="ident" id="5600546">i</span><span class="op" id="5600547">+</span><span class="num" id="5600548">7</span><span class="op" id="5600549">]</span><span class="op" id="5600550">)</span><span class="op" id="5600551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5600554">}</span><br>
<span class="lineno"></span><span class="op" id="5600556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="5600559">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5600638">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5600662">func</span>&nbsp;<span class="op" id="5600667">(</span><span class="ident" id="5600668">p</span>&nbsp;<span class="op" id="5600670">*</span><span class="ident" id="5600671">RGBA64</span><span class="op" id="5600677">)</span>&nbsp;<span class="ident" id="5600679">PixOffset</span><span class="op" id="5600688">(</span><span class="ident" id="5600689">x</span><span class="op" id="5600690">,</span>&nbsp;<span class="ident" id="5600692">y</span>&nbsp;<span class="builtintype" id="5600694">int</span><span class="op" id="5600697">)</span>&nbsp;<span class="builtintype" id="5600699">int</span>&nbsp;<span class="op" id="5600703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600706">return</span>&nbsp;<span class="op" id="5600713">(</span><span class="ident" id="5600714">y</span><span class="op" id="5600715">-</span><span class="ident" id="5600716">p</span><span class="op" id="5600717">.</span><span class="ident" id="5600718">Rect</span><span class="op" id="5600722">.</span><span class="ident" id="5600723">Min</span><span class="op" id="5600726">.</span><span class="ident" id="5600727">Y</span><span class="op" id="5600728">)</span><span class="op" id="5600729">*</span><span class="ident" id="5600730">p</span><span class="op" id="5600731">.</span><span class="ident" id="5600732">Stride</span>&nbsp;<span class="op" id="5600739">+</span>&nbsp;<span class="op" id="5600741">(</span><span class="ident" id="5600742">x</span><span class="op" id="5600743">-</span><span class="ident" id="5600744">p</span><span class="op" id="5600745">.</span><span class="ident" id="5600746">Rect</span><span class="op" id="5600750">.</span><span class="ident" id="5600751">Min</span><span class="op" id="5600754">.</span><span class="ident" id="5600755">X</span><span class="op" id="5600756">)</span><span class="op" id="5600757">*</span><span class="num" id="5600758">8</span><br>
<span class="lineno"></span><span class="op" id="5600760">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="5600763">func</span>&nbsp;<span class="op" id="5600768">(</span><span class="ident" id="5600769">p</span>&nbsp;<span class="op" id="5600771">*</span><span class="ident" id="5600772">RGBA64</span><span class="op" id="5600778">)</span>&nbsp;<span class="ident" id="5600780">Set</span><span class="op" id="5600783">(</span><span class="ident" id="5600784">x</span><span class="op" id="5600785">,</span>&nbsp;<span class="ident" id="5600787">y</span>&nbsp;<span class="builtintype" id="5600789">int</span><span class="op" id="5600792">,</span>&nbsp;<span class="ident" id="5600794">c</span>&nbsp;<span class="ident" id="5600796">color</span><span class="op" id="5600801">.</span><span class="ident" id="5600802">Color</span><span class="op" id="5600807">)</span>&nbsp;<span class="op" id="5600809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600812">if</span>&nbsp;<span class="op" id="5600815">!</span><span class="op" id="5600816">(</span><span class="ident" id="5600817">Point</span><span class="op" id="5600822">{</span><span class="ident" id="5600823">x</span><span class="op" id="5600824">,</span>&nbsp;<span class="ident" id="5600826">y</span><span class="op" id="5600827">}</span><span class="op" id="5600828">.</span><span class="ident" id="5600829">In</span><span class="op" id="5600831">(</span><span class="ident" id="5600832">p</span><span class="op" id="5600833">.</span><span class="ident" id="5600834">Rect</span><span class="op" id="5600838">)</span><span class="op" id="5600839">)</span>&nbsp;<span class="op" id="5600841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600845">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5600853">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600856">i</span>&nbsp;<span class="op" id="5600858">:=</span>&nbsp;<span class="ident" id="5600861">p</span><span class="op" id="5600862">.</span><span class="ident" id="5600863">PixOffset</span><span class="op" id="5600872">(</span><span class="ident" id="5600873">x</span><span class="op" id="5600874">,</span>&nbsp;<span class="ident" id="5600876">y</span><span class="op" id="5600877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600880">c1</span>&nbsp;<span class="op" id="5600883">:=</span>&nbsp;<span class="ident" id="5600886">color</span><span class="op" id="5600891">.</span><span class="ident" id="5600892">RGBA64Model</span><span class="op" id="5600903">.</span><span class="ident" id="5600904">Convert</span><span class="op" id="5600911">(</span><span class="ident" id="5600912">c</span><span class="op" id="5600913">)</span><span class="op" id="5600914">.</span><span class="op" id="5600915">(</span><span class="ident" id="5600916">color</span><span class="op" id="5600921">.</span><span class="ident" id="5600922">RGBA64</span><span class="op" id="5600928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600931">p</span><span class="op" id="5600932">.</span><span class="ident" id="5600933">Pix</span><span class="op" id="5600936">[</span><span class="ident" id="5600937">i</span><span class="op" id="5600938">+</span><span class="num" id="5600939">0</span><span class="op" id="5600940">]</span>&nbsp;<span class="op" id="5600942">=</span>&nbsp;<span class="builtintype" id="5600944">uint8</span><span class="op" id="5600949">(</span><span class="ident" id="5600950">c1</span><span class="op" id="5600952">.</span><span class="ident" id="5600953">R</span>&nbsp;<span class="op" id="5600955">&gt;&gt;</span>&nbsp;<span class="num" id="5600958">8</span><span class="op" id="5600959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600962">p</span><span class="op" id="5600963">.</span><span class="ident" id="5600964">Pix</span><span class="op" id="5600967">[</span><span class="ident" id="5600968">i</span><span class="op" id="5600969">+</span><span class="num" id="5600970">1</span><span class="op" id="5600971">]</span>&nbsp;<span class="op" id="5600973">=</span>&nbsp;<span class="builtintype" id="5600975">uint8</span><span class="op" id="5600980">(</span><span class="ident" id="5600981">c1</span><span class="op" id="5600983">.</span><span class="ident" id="5600984">R</span><span class="op" id="5600985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600988">p</span><span class="op" id="5600989">.</span><span class="ident" id="5600990">Pix</span><span class="op" id="5600993">[</span><span class="ident" id="5600994">i</span><span class="op" id="5600995">+</span><span class="num" id="5600996">2</span><span class="op" id="5600997">]</span>&nbsp;<span class="op" id="5600999">=</span>&nbsp;<span class="builtintype" id="5601001">uint8</span><span class="op" id="5601006">(</span><span class="ident" id="5601007">c1</span><span class="op" id="5601009">.</span><span class="ident" id="5601010">G</span>&nbsp;<span class="op" id="5601012">&gt;&gt;</span>&nbsp;<span class="num" id="5601015">8</span><span class="op" id="5601016">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601019">p</span><span class="op" id="5601020">.</span><span class="ident" id="5601021">Pix</span><span class="op" id="5601024">[</span><span class="ident" id="5601025">i</span><span class="op" id="5601026">+</span><span class="num" id="5601027">3</span><span class="op" id="5601028">]</span>&nbsp;<span class="op" id="5601030">=</span>&nbsp;<span class="builtintype" id="5601032">uint8</span><span class="op" id="5601037">(</span><span class="ident" id="5601038">c1</span><span class="op" id="5601040">.</span><span class="ident" id="5601041">G</span><span class="op" id="5601042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601045">p</span><span class="op" id="5601046">.</span><span class="ident" id="5601047">Pix</span><span class="op" id="5601050">[</span><span class="ident" id="5601051">i</span><span class="op" id="5601052">+</span><span class="num" id="5601053">4</span><span class="op" id="5601054">]</span>&nbsp;<span class="op" id="5601056">=</span>&nbsp;<span class="builtintype" id="5601058">uint8</span><span class="op" id="5601063">(</span><span class="ident" id="5601064">c1</span><span class="op" id="5601066">.</span><span class="ident" id="5601067">B</span>&nbsp;<span class="op" id="5601069">&gt;&gt;</span>&nbsp;<span class="num" id="5601072">8</span><span class="op" id="5601073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601076">p</span><span class="op" id="5601077">.</span><span class="ident" id="5601078">Pix</span><span class="op" id="5601081">[</span><span class="ident" id="5601082">i</span><span class="op" id="5601083">+</span><span class="num" id="5601084">5</span><span class="op" id="5601085">]</span>&nbsp;<span class="op" id="5601087">=</span>&nbsp;<span class="builtintype" id="5601089">uint8</span><span class="op" id="5601094">(</span><span class="ident" id="5601095">c1</span><span class="op" id="5601097">.</span><span class="ident" id="5601098">B</span><span class="op" id="5601099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601102">p</span><span class="op" id="5601103">.</span><span class="ident" id="5601104">Pix</span><span class="op" id="5601107">[</span><span class="ident" id="5601108">i</span><span class="op" id="5601109">+</span><span class="num" id="5601110">6</span><span class="op" id="5601111">]</span>&nbsp;<span class="op" id="5601113">=</span>&nbsp;<span class="builtintype" id="5601115">uint8</span><span class="op" id="5601120">(</span><span class="ident" id="5601121">c1</span><span class="op" id="5601123">.</span><span class="ident" id="5601124">A</span>&nbsp;<span class="op" id="5601126">&gt;&gt;</span>&nbsp;<span class="num" id="5601129">8</span><span class="op" id="5601130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601133">p</span><span class="op" id="5601134">.</span><span class="ident" id="5601135">Pix</span><span class="op" id="5601138">[</span><span class="ident" id="5601139">i</span><span class="op" id="5601140">+</span><span class="num" id="5601141">7</span><span class="op" id="5601142">]</span>&nbsp;<span class="op" id="5601144">=</span>&nbsp;<span class="builtintype" id="5601146">uint8</span><span class="op" id="5601151">(</span><span class="ident" id="5601152">c1</span><span class="op" id="5601154">.</span><span class="ident" id="5601155">A</span><span class="op" id="5601156">)</span><br>
<span class="lineno">210</span><span class="op" id="5601158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5601161">func</span>&nbsp;<span class="op" id="5601166">(</span><span class="ident" id="5601167">p</span>&nbsp;<span class="op" id="5601169">*</span><span class="ident" id="5601170">RGBA64</span><span class="op" id="5601176">)</span>&nbsp;<span class="ident" id="5601178">SetRGBA64</span><span class="op" id="5601187">(</span><span class="ident" id="5601188">x</span><span class="op" id="5601189">,</span>&nbsp;<span class="ident" id="5601191">y</span>&nbsp;<span class="builtintype" id="5601193">int</span><span class="op" id="5601196">,</span>&nbsp;<span class="ident" id="5601198">c</span>&nbsp;<span class="ident" id="5601200">color</span><span class="op" id="5601205">.</span><span class="ident" id="5601206">RGBA64</span><span class="op" id="5601212">)</span>&nbsp;<span class="op" id="5601214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601217">if</span>&nbsp;<span class="op" id="5601220">!</span><span class="op" id="5601221">(</span><span class="ident" id="5601222">Point</span><span class="op" id="5601227">{</span><span class="ident" id="5601228">x</span><span class="op" id="5601229">,</span>&nbsp;<span class="ident" id="5601231">y</span><span class="op" id="5601232">}</span><span class="op" id="5601233">.</span><span class="ident" id="5601234">In</span><span class="op" id="5601236">(</span><span class="ident" id="5601237">p</span><span class="op" id="5601238">.</span><span class="ident" id="5601239">Rect</span><span class="op" id="5601243">)</span><span class="op" id="5601244">)</span>&nbsp;<span class="op" id="5601246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601250">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601261">i</span>&nbsp;<span class="op" id="5601263">:=</span>&nbsp;<span class="ident" id="5601266">p</span><span class="op" id="5601267">.</span><span class="ident" id="5601268">PixOffset</span><span class="op" id="5601277">(</span><span class="ident" id="5601278">x</span><span class="op" id="5601279">,</span>&nbsp;<span class="ident" id="5601281">y</span><span class="op" id="5601282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601285">p</span><span class="op" id="5601286">.</span><span class="ident" id="5601287">Pix</span><span class="op" id="5601290">[</span><span class="ident" id="5601291">i</span><span class="op" id="5601292">+</span><span class="num" id="5601293">0</span><span class="op" id="5601294">]</span>&nbsp;<span class="op" id="5601296">=</span>&nbsp;<span class="builtintype" id="5601298">uint8</span><span class="op" id="5601303">(</span><span class="ident" id="5601304">c</span><span class="op" id="5601305">.</span><span class="ident" id="5601306">R</span>&nbsp;<span class="op" id="5601308">&gt;&gt;</span>&nbsp;<span class="num" id="5601311">8</span><span class="op" id="5601312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601315">p</span><span class="op" id="5601316">.</span><span class="ident" id="5601317">Pix</span><span class="op" id="5601320">[</span><span class="ident" id="5601321">i</span><span class="op" id="5601322">+</span><span class="num" id="5601323">1</span><span class="op" id="5601324">]</span>&nbsp;<span class="op" id="5601326">=</span>&nbsp;<span class="builtintype" id="5601328">uint8</span><span class="op" id="5601333">(</span><span class="ident" id="5601334">c</span><span class="op" id="5601335">.</span><span class="ident" id="5601336">R</span><span class="op" id="5601337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601340">p</span><span class="op" id="5601341">.</span><span class="ident" id="5601342">Pix</span><span class="op" id="5601345">[</span><span class="ident" id="5601346">i</span><span class="op" id="5601347">+</span><span class="num" id="5601348">2</span><span class="op" id="5601349">]</span>&nbsp;<span class="op" id="5601351">=</span>&nbsp;<span class="builtintype" id="5601353">uint8</span><span class="op" id="5601358">(</span><span class="ident" id="5601359">c</span><span class="op" id="5601360">.</span><span class="ident" id="5601361">G</span>&nbsp;<span class="op" id="5601363">&gt;&gt;</span>&nbsp;<span class="num" id="5601366">8</span><span class="op" id="5601367">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601370">p</span><span class="op" id="5601371">.</span><span class="ident" id="5601372">Pix</span><span class="op" id="5601375">[</span><span class="ident" id="5601376">i</span><span class="op" id="5601377">+</span><span class="num" id="5601378">3</span><span class="op" id="5601379">]</span>&nbsp;<span class="op" id="5601381">=</span>&nbsp;<span class="builtintype" id="5601383">uint8</span><span class="op" id="5601388">(</span><span class="ident" id="5601389">c</span><span class="op" id="5601390">.</span><span class="ident" id="5601391">G</span><span class="op" id="5601392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601395">p</span><span class="op" id="5601396">.</span><span class="ident" id="5601397">Pix</span><span class="op" id="5601400">[</span><span class="ident" id="5601401">i</span><span class="op" id="5601402">+</span><span class="num" id="5601403">4</span><span class="op" id="5601404">]</span>&nbsp;<span class="op" id="5601406">=</span>&nbsp;<span class="builtintype" id="5601408">uint8</span><span class="op" id="5601413">(</span><span class="ident" id="5601414">c</span><span class="op" id="5601415">.</span><span class="ident" id="5601416">B</span>&nbsp;<span class="op" id="5601418">&gt;&gt;</span>&nbsp;<span class="num" id="5601421">8</span><span class="op" id="5601422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601425">p</span><span class="op" id="5601426">.</span><span class="ident" id="5601427">Pix</span><span class="op" id="5601430">[</span><span class="ident" id="5601431">i</span><span class="op" id="5601432">+</span><span class="num" id="5601433">5</span><span class="op" id="5601434">]</span>&nbsp;<span class="op" id="5601436">=</span>&nbsp;<span class="builtintype" id="5601438">uint8</span><span class="op" id="5601443">(</span><span class="ident" id="5601444">c</span><span class="op" id="5601445">.</span><span class="ident" id="5601446">B</span><span class="op" id="5601447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601450">p</span><span class="op" id="5601451">.</span><span class="ident" id="5601452">Pix</span><span class="op" id="5601455">[</span><span class="ident" id="5601456">i</span><span class="op" id="5601457">+</span><span class="num" id="5601458">6</span><span class="op" id="5601459">]</span>&nbsp;<span class="op" id="5601461">=</span>&nbsp;<span class="builtintype" id="5601463">uint8</span><span class="op" id="5601468">(</span><span class="ident" id="5601469">c</span><span class="op" id="5601470">.</span><span class="ident" id="5601471">A</span>&nbsp;<span class="op" id="5601473">&gt;&gt;</span>&nbsp;<span class="num" id="5601476">8</span><span class="op" id="5601477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601480">p</span><span class="op" id="5601481">.</span><span class="ident" id="5601482">Pix</span><span class="op" id="5601485">[</span><span class="ident" id="5601486">i</span><span class="op" id="5601487">+</span><span class="num" id="5601488">7</span><span class="op" id="5601489">]</span>&nbsp;<span class="op" id="5601491">=</span>&nbsp;<span class="builtintype" id="5601493">uint8</span><span class="op" id="5601498">(</span><span class="ident" id="5601499">c</span><span class="op" id="5601500">.</span><span class="ident" id="5601501">A</span><span class="op" id="5601502">)</span><br>
<span class="lineno">225</span><span class="op" id="5601504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5601507">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5601584">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5601656">func</span>&nbsp;<span class="op" id="5601661">(</span><span class="ident" id="5601662">p</span>&nbsp;<span class="op" id="5601664">*</span><span class="ident" id="5601665">RGBA64</span><span class="op" id="5601671">)</span>&nbsp;<span class="ident" id="5601673">SubImage</span><span class="op" id="5601681">(</span><span class="ident" id="5601682">r</span>&nbsp;<span class="ident" id="5601684">Rectangle</span><span class="op" id="5601693">)</span>&nbsp;<span class="ident" id="5601695">Image</span>&nbsp;<span class="op" id="5601701">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601704">r</span>&nbsp;<span class="op" id="5601706">=</span>&nbsp;<span class="ident" id="5601708">r</span><span class="op" id="5601709">.</span><span class="ident" id="5601710">Intersect</span><span class="op" id="5601719">(</span><span class="ident" id="5601720">p</span><span class="op" id="5601721">.</span><span class="ident" id="5601722">Rect</span><span class="op" id="5601726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601729">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601810">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601892">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601942">if</span>&nbsp;<span class="ident" id="5601945">r</span><span class="op" id="5601946">.</span><span class="ident" id="5601947">Empty</span><span class="op" id="5601952">(</span><span class="op" id="5601953">)</span>&nbsp;<span class="op" id="5601955">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601959">return</span>&nbsp;<span class="op" id="5601966">&amp;</span><span class="ident" id="5601967">RGBA64</span><span class="op" id="5601973">{</span><span class="op" id="5601974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601980">i</span>&nbsp;<span class="op" id="5601982">:=</span>&nbsp;<span class="ident" id="5601985">p</span><span class="op" id="5601986">.</span><span class="ident" id="5601987">PixOffset</span><span class="op" id="5601996">(</span><span class="ident" id="5601997">r</span><span class="op" id="5601998">.</span><span class="ident" id="5601999">Min</span><span class="op" id="5602002">.</span><span class="ident" id="5602003">X</span><span class="op" id="5602004">,</span>&nbsp;<span class="ident" id="5602006">r</span><span class="op" id="5602007">.</span><span class="ident" id="5602008">Min</span><span class="op" id="5602011">.</span><span class="ident" id="5602012">Y</span><span class="op" id="5602013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602016">return</span>&nbsp;<span class="op" id="5602023">&amp;</span><span class="ident" id="5602024">RGBA64</span><span class="op" id="5602030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602034">Pix</span><span class="op" id="5602037">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602042">p</span><span class="op" id="5602043">.</span><span class="ident" id="5602044">Pix</span><span class="op" id="5602047">[</span><span class="ident" id="5602048">i</span><span class="op" id="5602049">:</span><span class="op" id="5602050">]</span><span class="op" id="5602051">,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602055">Stride</span><span class="op" id="5602061">:</span>&nbsp;<span class="ident" id="5602063">p</span><span class="op" id="5602064">.</span><span class="ident" id="5602065">Stride</span><span class="op" id="5602071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602075">Rect</span><span class="op" id="5602079">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5602083">r</span><span class="op" id="5602084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602087">}</span><br>
<span class="lineno"></span><span class="op" id="5602089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="5602092">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5602165">func</span>&nbsp;<span class="op" id="5602170">(</span><span class="ident" id="5602171">p</span>&nbsp;<span class="op" id="5602173">*</span><span class="ident" id="5602174">RGBA64</span><span class="op" id="5602180">)</span>&nbsp;<span class="ident" id="5602182">Opaque</span><span class="op" id="5602188">(</span><span class="op" id="5602189">)</span>&nbsp;<span class="builtintype" id="5602191">bool</span>&nbsp;<span class="op" id="5602196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602199">if</span>&nbsp;<span class="ident" id="5602202">p</span><span class="op" id="5602203">.</span><span class="ident" id="5602204">Rect</span><span class="op" id="5602208">.</span><span class="ident" id="5602209">Empty</span><span class="op" id="5602214">(</span><span class="op" id="5602215">)</span>&nbsp;<span class="op" id="5602217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602221">return</span>&nbsp;<span class="builtintype" id="5602228">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602234">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602237">i0</span><span class="op" id="5602239">,</span>&nbsp;<span class="ident" id="5602241">i1</span>&nbsp;<span class="op" id="5602244">:=</span>&nbsp;<span class="num" id="5602247">6</span><span class="op" id="5602248">,</span>&nbsp;<span class="ident" id="5602250">p</span><span class="op" id="5602251">.</span><span class="ident" id="5602252">Rect</span><span class="op" id="5602256">.</span><span class="ident" id="5602257">Dx</span><span class="op" id="5602259">(</span><span class="op" id="5602260">)</span><span class="op" id="5602261">*</span><span class="num" id="5602262">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602265">for</span>&nbsp;<span class="ident" id="5602269">y</span>&nbsp;<span class="op" id="5602271">:=</span>&nbsp;<span class="ident" id="5602274">p</span><span class="op" id="5602275">.</span><span class="ident" id="5602276">Rect</span><span class="op" id="5602280">.</span><span class="ident" id="5602281">Min</span><span class="op" id="5602284">.</span><span class="ident" id="5602285">Y</span><span class="op" id="5602286">;</span>&nbsp;<span class="ident" id="5602288">y</span>&nbsp;<span class="op" id="5602290">&lt;</span>&nbsp;<span class="ident" id="5602292">p</span><span class="op" id="5602293">.</span><span class="ident" id="5602294">Rect</span><span class="op" id="5602298">.</span><span class="ident" id="5602299">Max</span><span class="op" id="5602302">.</span><span class="ident" id="5602303">Y</span><span class="op" id="5602304">;</span>&nbsp;<span class="ident" id="5602306">y</span><span class="op" id="5602307">++</span>&nbsp;<span class="op" id="5602310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602314">for</span>&nbsp;<span class="ident" id="5602318">i</span>&nbsp;<span class="op" id="5602320">:=</span>&nbsp;<span class="ident" id="5602323">i0</span><span class="op" id="5602325">;</span>&nbsp;<span class="ident" id="5602327">i</span>&nbsp;<span class="op" id="5602329">&lt;</span>&nbsp;<span class="ident" id="5602331">i1</span><span class="op" id="5602333">;</span>&nbsp;<span class="ident" id="5602335">i</span>&nbsp;<span class="op" id="5602337">+=</span>&nbsp;<span class="num" id="5602340">8</span>&nbsp;<span class="op" id="5602342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602347">if</span>&nbsp;<span class="ident" id="5602350">p</span><span class="op" id="5602351">.</span><span class="ident" id="5602352">Pix</span><span class="op" id="5602355">[</span><span class="ident" id="5602356">i</span><span class="op" id="5602357">+</span><span class="num" id="5602358">0</span><span class="op" id="5602359">]</span>&nbsp;<span class="op" id="5602361">!=</span>&nbsp;<span class="num" id="5602364">0xff</span>&nbsp;<span class="op" id="5602369">||</span>&nbsp;<span class="ident" id="5602372">p</span><span class="op" id="5602373">.</span><span class="ident" id="5602374">Pix</span><span class="op" id="5602377">[</span><span class="ident" id="5602378">i</span><span class="op" id="5602379">+</span><span class="num" id="5602380">1</span><span class="op" id="5602381">]</span>&nbsp;<span class="op" id="5602383">!=</span>&nbsp;<span class="num" id="5602386">0xff</span>&nbsp;<span class="op" id="5602391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602397">return</span>&nbsp;<span class="builtintype" id="5602404">false</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602421">i0</span>&nbsp;<span class="op" id="5602424">+=</span>&nbsp;<span class="ident" id="5602427">p</span><span class="op" id="5602428">.</span><span class="ident" id="5602429">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602438">i1</span>&nbsp;<span class="op" id="5602441">+=</span>&nbsp;<span class="ident" id="5602444">p</span><span class="op" id="5602445">.</span><span class="ident" id="5602446">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602454">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602457">return</span>&nbsp;<span class="builtintype" id="5602464">true</span><br>
<span class="lineno"></span><span class="op" id="5602469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5602472">//&nbsp;NewRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5602529">func</span>&nbsp;<span class="ident" id="5602534">NewRGBA64</span><span class="op" id="5602543">(</span><span class="ident" id="5602544">r</span>&nbsp;<span class="ident" id="5602546">Rectangle</span><span class="op" id="5602555">)</span>&nbsp;<span class="op" id="5602557">*</span><span class="ident" id="5602558">RGBA64</span>&nbsp;<span class="op" id="5602565">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602568">w</span><span class="op" id="5602569">,</span>&nbsp;<span class="ident" id="5602571">h</span>&nbsp;<span class="op" id="5602573">:=</span>&nbsp;<span class="ident" id="5602576">r</span><span class="op" id="5602577">.</span><span class="ident" id="5602578">Dx</span><span class="op" id="5602580">(</span><span class="op" id="5602581">)</span><span class="op" id="5602582">,</span>&nbsp;<span class="ident" id="5602584">r</span><span class="op" id="5602585">.</span><span class="ident" id="5602586">Dy</span><span class="op" id="5602588">(</span><span class="op" id="5602589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602592">pix</span>&nbsp;<span class="op" id="5602596">:=</span>&nbsp;<span class="builtinfunc" id="5602599">make</span><span class="op" id="5602603">(</span><span class="op" id="5602604">[</span><span class="op" id="5602605">]</span><span class="builtintype" id="5602606">uint8</span><span class="op" id="5602611">,</span>&nbsp;<span class="num" id="5602613">8</span><span class="op" id="5602614">*</span><span class="ident" id="5602615">w</span><span class="op" id="5602616">*</span><span class="ident" id="5602617">h</span><span class="op" id="5602618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602621">return</span>&nbsp;<span class="op" id="5602628">&amp;</span><span class="ident" id="5602629">RGBA64</span><span class="op" id="5602635">{</span><span class="ident" id="5602636">pix</span><span class="op" id="5602639">,</span>&nbsp;<span class="num" id="5602641">8</span>&nbsp;<span class="op" id="5602643">*</span>&nbsp;<span class="ident" id="5602645">w</span><span class="op" id="5602646">,</span>&nbsp;<span class="ident" id="5602648">r</span><span class="op" id="5602649">}</span><br>
<span class="lineno"></span><span class="op" id="5602651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5602654">//&nbsp;NRGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5602729">type</span>&nbsp;<span class="ident" id="5602734">NRGBA</span>&nbsp;<span class="keyword" id="5602740">struct</span>&nbsp;<span class="op" id="5602747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5602750">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5602818">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602886">Pix</span>&nbsp;<span class="op" id="5602890">[</span><span class="op" id="5602891">]</span><span class="builtintype" id="5602892">uint8</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5602899">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602975">Stride</span>&nbsp;<span class="builtintype" id="5602982">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5602987">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603019">Rect</span>&nbsp;<span class="ident" id="5603024">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5603034">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="5603037">func</span>&nbsp;<span class="op" id="5603042">(</span><span class="ident" id="5603043">p</span>&nbsp;<span class="op" id="5603045">*</span><span class="ident" id="5603046">NRGBA</span><span class="op" id="5603051">)</span>&nbsp;<span class="ident" id="5603053">ColorModel</span><span class="op" id="5603063">(</span><span class="op" id="5603064">)</span>&nbsp;<span class="ident" id="5603066">color</span><span class="op" id="5603071">.</span><span class="ident" id="5603072">Model</span>&nbsp;<span class="op" id="5603078">{</span>&nbsp;<span class="keyword" id="5603080">return</span>&nbsp;<span class="ident" id="5603087">color</span><span class="op" id="5603092">.</span><span class="ident" id="5603093">NRGBAModel</span>&nbsp;<span class="op" id="5603104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5603107">func</span>&nbsp;<span class="op" id="5603112">(</span><span class="ident" id="5603113">p</span>&nbsp;<span class="op" id="5603115">*</span><span class="ident" id="5603116">NRGBA</span><span class="op" id="5603121">)</span>&nbsp;<span class="ident" id="5603123">Bounds</span><span class="op" id="5603129">(</span><span class="op" id="5603130">)</span>&nbsp;<span class="ident" id="5603132">Rectangle</span>&nbsp;<span class="op" id="5603142">{</span>&nbsp;<span class="keyword" id="5603144">return</span>&nbsp;<span class="ident" id="5603151">p</span><span class="op" id="5603152">.</span><span class="ident" id="5603153">Rect</span>&nbsp;<span class="op" id="5603158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5603161">func</span>&nbsp;<span class="op" id="5603166">(</span><span class="ident" id="5603167">p</span>&nbsp;<span class="op" id="5603169">*</span><span class="ident" id="5603170">NRGBA</span><span class="op" id="5603175">)</span>&nbsp;<span class="ident" id="5603177">At</span><span class="op" id="5603179">(</span><span class="ident" id="5603180">x</span><span class="op" id="5603181">,</span>&nbsp;<span class="ident" id="5603183">y</span>&nbsp;<span class="builtintype" id="5603185">int</span><span class="op" id="5603188">)</span>&nbsp;<span class="ident" id="5603190">color</span><span class="op" id="5603195">.</span><span class="ident" id="5603196">Color</span>&nbsp;<span class="op" id="5603202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603205">return</span>&nbsp;<span class="ident" id="5603212">p</span><span class="op" id="5603213">.</span><span class="ident" id="5603214">NRGBAAt</span><span class="op" id="5603221">(</span><span class="ident" id="5603222">x</span><span class="op" id="5603223">,</span>&nbsp;<span class="ident" id="5603225">y</span><span class="op" id="5603226">)</span><br>
<span class="lineno"></span><span class="op" id="5603228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5603231">func</span>&nbsp;<span class="op" id="5603236">(</span><span class="ident" id="5603237">p</span>&nbsp;<span class="op" id="5603239">*</span><span class="ident" id="5603240">NRGBA</span><span class="op" id="5603245">)</span>&nbsp;<span class="ident" id="5603247">NRGBAAt</span><span class="op" id="5603254">(</span><span class="ident" id="5603255">x</span><span class="op" id="5603256">,</span>&nbsp;<span class="ident" id="5603258">y</span>&nbsp;<span class="builtintype" id="5603260">int</span><span class="op" id="5603263">)</span>&nbsp;<span class="ident" id="5603265">color</span><span class="op" id="5603270">.</span><span class="ident" id="5603271">NRGBA</span>&nbsp;<span class="op" id="5603277">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603280">if</span>&nbsp;<span class="op" id="5603283">!</span><span class="op" id="5603284">(</span><span class="ident" id="5603285">Point</span><span class="op" id="5603290">{</span><span class="ident" id="5603291">x</span><span class="op" id="5603292">,</span>&nbsp;<span class="ident" id="5603294">y</span><span class="op" id="5603295">}</span><span class="op" id="5603296">.</span><span class="ident" id="5603297">In</span><span class="op" id="5603299">(</span><span class="ident" id="5603300">p</span><span class="op" id="5603301">.</span><span class="ident" id="5603302">Rect</span><span class="op" id="5603306">)</span><span class="op" id="5603307">)</span>&nbsp;<span class="op" id="5603309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603313">return</span>&nbsp;<span class="ident" id="5603320">color</span><span class="op" id="5603325">.</span><span class="ident" id="5603326">NRGBA</span><span class="op" id="5603331">{</span><span class="op" id="5603332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603338">i</span>&nbsp;<span class="op" id="5603340">:=</span>&nbsp;<span class="ident" id="5603343">p</span><span class="op" id="5603344">.</span><span class="ident" id="5603345">PixOffset</span><span class="op" id="5603354">(</span><span class="ident" id="5603355">x</span><span class="op" id="5603356">,</span>&nbsp;<span class="ident" id="5603358">y</span><span class="op" id="5603359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603362">return</span>&nbsp;<span class="ident" id="5603369">color</span><span class="op" id="5603374">.</span><span class="ident" id="5603375">NRGBA</span><span class="op" id="5603380">{</span><span class="ident" id="5603381">p</span><span class="op" id="5603382">.</span><span class="ident" id="5603383">Pix</span><span class="op" id="5603386">[</span><span class="ident" id="5603387">i</span><span class="op" id="5603388">+</span><span class="num" id="5603389">0</span><span class="op" id="5603390">]</span><span class="op" id="5603391">,</span>&nbsp;<span class="ident" id="5603393">p</span><span class="op" id="5603394">.</span><span class="ident" id="5603395">Pix</span><span class="op" id="5603398">[</span><span class="ident" id="5603399">i</span><span class="op" id="5603400">+</span><span class="num" id="5603401">1</span><span class="op" id="5603402">]</span><span class="op" id="5603403">,</span>&nbsp;<span class="ident" id="5603405">p</span><span class="op" id="5603406">.</span><span class="ident" id="5603407">Pix</span><span class="op" id="5603410">[</span><span class="ident" id="5603411">i</span><span class="op" id="5603412">+</span><span class="num" id="5603413">2</span><span class="op" id="5603414">]</span><span class="op" id="5603415">,</span>&nbsp;<span class="ident" id="5603417">p</span><span class="op" id="5603418">.</span><span class="ident" id="5603419">Pix</span><span class="op" id="5603422">[</span><span class="ident" id="5603423">i</span><span class="op" id="5603424">+</span><span class="num" id="5603425">3</span><span class="op" id="5603426">]</span><span class="op" id="5603427">}</span><br>
<span class="lineno">295</span><span class="op" id="5603429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5603432">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5603511">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5603535">func</span>&nbsp;<span class="op" id="5603540">(</span><span class="ident" id="5603541">p</span>&nbsp;<span class="op" id="5603543">*</span><span class="ident" id="5603544">NRGBA</span><span class="op" id="5603549">)</span>&nbsp;<span class="ident" id="5603551">PixOffset</span><span class="op" id="5603560">(</span><span class="ident" id="5603561">x</span><span class="op" id="5603562">,</span>&nbsp;<span class="ident" id="5603564">y</span>&nbsp;<span class="builtintype" id="5603566">int</span><span class="op" id="5603569">)</span>&nbsp;<span class="builtintype" id="5603571">int</span>&nbsp;<span class="op" id="5603575">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603578">return</span>&nbsp;<span class="op" id="5603585">(</span><span class="ident" id="5603586">y</span><span class="op" id="5603587">-</span><span class="ident" id="5603588">p</span><span class="op" id="5603589">.</span><span class="ident" id="5603590">Rect</span><span class="op" id="5603594">.</span><span class="ident" id="5603595">Min</span><span class="op" id="5603598">.</span><span class="ident" id="5603599">Y</span><span class="op" id="5603600">)</span><span class="op" id="5603601">*</span><span class="ident" id="5603602">p</span><span class="op" id="5603603">.</span><span class="ident" id="5603604">Stride</span>&nbsp;<span class="op" id="5603611">+</span>&nbsp;<span class="op" id="5603613">(</span><span class="ident" id="5603614">x</span><span class="op" id="5603615">-</span><span class="ident" id="5603616">p</span><span class="op" id="5603617">.</span><span class="ident" id="5603618">Rect</span><span class="op" id="5603622">.</span><span class="ident" id="5603623">Min</span><span class="op" id="5603626">.</span><span class="ident" id="5603627">X</span><span class="op" id="5603628">)</span><span class="op" id="5603629">*</span><span class="num" id="5603630">4</span><br>
<span class="lineno"></span><span class="op" id="5603632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5603635">func</span>&nbsp;<span class="op" id="5603640">(</span><span class="ident" id="5603641">p</span>&nbsp;<span class="op" id="5603643">*</span><span class="ident" id="5603644">NRGBA</span><span class="op" id="5603649">)</span>&nbsp;<span class="ident" id="5603651">Set</span><span class="op" id="5603654">(</span><span class="ident" id="5603655">x</span><span class="op" id="5603656">,</span>&nbsp;<span class="ident" id="5603658">y</span>&nbsp;<span class="builtintype" id="5603660">int</span><span class="op" id="5603663">,</span>&nbsp;<span class="ident" id="5603665">c</span>&nbsp;<span class="ident" id="5603667">color</span><span class="op" id="5603672">.</span><span class="ident" id="5603673">Color</span><span class="op" id="5603678">)</span>&nbsp;<span class="op" id="5603680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603683">if</span>&nbsp;<span class="op" id="5603686">!</span><span class="op" id="5603687">(</span><span class="ident" id="5603688">Point</span><span class="op" id="5603693">{</span><span class="ident" id="5603694">x</span><span class="op" id="5603695">,</span>&nbsp;<span class="ident" id="5603697">y</span><span class="op" id="5603698">}</span><span class="op" id="5603699">.</span><span class="ident" id="5603700">In</span><span class="op" id="5603702">(</span><span class="ident" id="5603703">p</span><span class="op" id="5603704">.</span><span class="ident" id="5603705">Rect</span><span class="op" id="5603709">)</span><span class="op" id="5603710">)</span>&nbsp;<span class="op" id="5603712">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603716">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603727">i</span>&nbsp;<span class="op" id="5603729">:=</span>&nbsp;<span class="ident" id="5603732">p</span><span class="op" id="5603733">.</span><span class="ident" id="5603734">PixOffset</span><span class="op" id="5603743">(</span><span class="ident" id="5603744">x</span><span class="op" id="5603745">,</span>&nbsp;<span class="ident" id="5603747">y</span><span class="op" id="5603748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603751">c1</span>&nbsp;<span class="op" id="5603754">:=</span>&nbsp;<span class="ident" id="5603757">color</span><span class="op" id="5603762">.</span><span class="ident" id="5603763">NRGBAModel</span><span class="op" id="5603773">.</span><span class="ident" id="5603774">Convert</span><span class="op" id="5603781">(</span><span class="ident" id="5603782">c</span><span class="op" id="5603783">)</span><span class="op" id="5603784">.</span><span class="op" id="5603785">(</span><span class="ident" id="5603786">color</span><span class="op" id="5603791">.</span><span class="ident" id="5603792">NRGBA</span><span class="op" id="5603797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603800">p</span><span class="op" id="5603801">.</span><span class="ident" id="5603802">Pix</span><span class="op" id="5603805">[</span><span class="ident" id="5603806">i</span><span class="op" id="5603807">+</span><span class="num" id="5603808">0</span><span class="op" id="5603809">]</span>&nbsp;<span class="op" id="5603811">=</span>&nbsp;<span class="ident" id="5603813">c1</span><span class="op" id="5603815">.</span><span class="ident" id="5603816">R</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603819">p</span><span class="op" id="5603820">.</span><span class="ident" id="5603821">Pix</span><span class="op" id="5603824">[</span><span class="ident" id="5603825">i</span><span class="op" id="5603826">+</span><span class="num" id="5603827">1</span><span class="op" id="5603828">]</span>&nbsp;<span class="op" id="5603830">=</span>&nbsp;<span class="ident" id="5603832">c1</span><span class="op" id="5603834">.</span><span class="ident" id="5603835">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603838">p</span><span class="op" id="5603839">.</span><span class="ident" id="5603840">Pix</span><span class="op" id="5603843">[</span><span class="ident" id="5603844">i</span><span class="op" id="5603845">+</span><span class="num" id="5603846">2</span><span class="op" id="5603847">]</span>&nbsp;<span class="op" id="5603849">=</span>&nbsp;<span class="ident" id="5603851">c1</span><span class="op" id="5603853">.</span><span class="ident" id="5603854">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603857">p</span><span class="op" id="5603858">.</span><span class="ident" id="5603859">Pix</span><span class="op" id="5603862">[</span><span class="ident" id="5603863">i</span><span class="op" id="5603864">+</span><span class="num" id="5603865">3</span><span class="op" id="5603866">]</span>&nbsp;<span class="op" id="5603868">=</span>&nbsp;<span class="ident" id="5603870">c1</span><span class="op" id="5603872">.</span><span class="ident" id="5603873">A</span><br>
<span class="lineno"></span><span class="op" id="5603875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="5603878">func</span>&nbsp;<span class="op" id="5603883">(</span><span class="ident" id="5603884">p</span>&nbsp;<span class="op" id="5603886">*</span><span class="ident" id="5603887">NRGBA</span><span class="op" id="5603892">)</span>&nbsp;<span class="ident" id="5603894">SetNRGBA</span><span class="op" id="5603902">(</span><span class="ident" id="5603903">x</span><span class="op" id="5603904">,</span>&nbsp;<span class="ident" id="5603906">y</span>&nbsp;<span class="builtintype" id="5603908">int</span><span class="op" id="5603911">,</span>&nbsp;<span class="ident" id="5603913">c</span>&nbsp;<span class="ident" id="5603915">color</span><span class="op" id="5603920">.</span><span class="ident" id="5603921">NRGBA</span><span class="op" id="5603926">)</span>&nbsp;<span class="op" id="5603928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603931">if</span>&nbsp;<span class="op" id="5603934">!</span><span class="op" id="5603935">(</span><span class="ident" id="5603936">Point</span><span class="op" id="5603941">{</span><span class="ident" id="5603942">x</span><span class="op" id="5603943">,</span>&nbsp;<span class="ident" id="5603945">y</span><span class="op" id="5603946">}</span><span class="op" id="5603947">.</span><span class="ident" id="5603948">In</span><span class="op" id="5603950">(</span><span class="ident" id="5603951">p</span><span class="op" id="5603952">.</span><span class="ident" id="5603953">Rect</span><span class="op" id="5603957">)</span><span class="op" id="5603958">)</span>&nbsp;<span class="op" id="5603960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603964">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603975">i</span>&nbsp;<span class="op" id="5603977">:=</span>&nbsp;<span class="ident" id="5603980">p</span><span class="op" id="5603981">.</span><span class="ident" id="5603982">PixOffset</span><span class="op" id="5603991">(</span><span class="ident" id="5603992">x</span><span class="op" id="5603993">,</span>&nbsp;<span class="ident" id="5603995">y</span><span class="op" id="5603996">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603999">p</span><span class="op" id="5604000">.</span><span class="ident" id="5604001">Pix</span><span class="op" id="5604004">[</span><span class="ident" id="5604005">i</span><span class="op" id="5604006">+</span><span class="num" id="5604007">0</span><span class="op" id="5604008">]</span>&nbsp;<span class="op" id="5604010">=</span>&nbsp;<span class="ident" id="5604012">c</span><span class="op" id="5604013">.</span><span class="ident" id="5604014">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604017">p</span><span class="op" id="5604018">.</span><span class="ident" id="5604019">Pix</span><span class="op" id="5604022">[</span><span class="ident" id="5604023">i</span><span class="op" id="5604024">+</span><span class="num" id="5604025">1</span><span class="op" id="5604026">]</span>&nbsp;<span class="op" id="5604028">=</span>&nbsp;<span class="ident" id="5604030">c</span><span class="op" id="5604031">.</span><span class="ident" id="5604032">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604035">p</span><span class="op" id="5604036">.</span><span class="ident" id="5604037">Pix</span><span class="op" id="5604040">[</span><span class="ident" id="5604041">i</span><span class="op" id="5604042">+</span><span class="num" id="5604043">2</span><span class="op" id="5604044">]</span>&nbsp;<span class="op" id="5604046">=</span>&nbsp;<span class="ident" id="5604048">c</span><span class="op" id="5604049">.</span><span class="ident" id="5604050">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604053">p</span><span class="op" id="5604054">.</span><span class="ident" id="5604055">Pix</span><span class="op" id="5604058">[</span><span class="ident" id="5604059">i</span><span class="op" id="5604060">+</span><span class="num" id="5604061">3</span><span class="op" id="5604062">]</span>&nbsp;<span class="op" id="5604064">=</span>&nbsp;<span class="ident" id="5604066">c</span><span class="op" id="5604067">.</span><span class="ident" id="5604068">A</span><br>
<span class="lineno"></span><span class="op" id="5604070">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="5604073">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5604150">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5604222">func</span>&nbsp;<span class="op" id="5604227">(</span><span class="ident" id="5604228">p</span>&nbsp;<span class="op" id="5604230">*</span><span class="ident" id="5604231">NRGBA</span><span class="op" id="5604236">)</span>&nbsp;<span class="ident" id="5604238">SubImage</span><span class="op" id="5604246">(</span><span class="ident" id="5604247">r</span>&nbsp;<span class="ident" id="5604249">Rectangle</span><span class="op" id="5604258">)</span>&nbsp;<span class="ident" id="5604260">Image</span>&nbsp;<span class="op" id="5604266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604269">r</span>&nbsp;<span class="op" id="5604271">=</span>&nbsp;<span class="ident" id="5604273">r</span><span class="op" id="5604274">.</span><span class="ident" id="5604275">Intersect</span><span class="op" id="5604284">(</span><span class="ident" id="5604285">p</span><span class="op" id="5604286">.</span><span class="ident" id="5604287">Rect</span><span class="op" id="5604291">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5604294">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5604375">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5604457">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604507">if</span>&nbsp;<span class="ident" id="5604510">r</span><span class="op" id="5604511">.</span><span class="ident" id="5604512">Empty</span><span class="op" id="5604517">(</span><span class="op" id="5604518">)</span>&nbsp;<span class="op" id="5604520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604524">return</span>&nbsp;<span class="op" id="5604531">&amp;</span><span class="ident" id="5604532">NRGBA</span><span class="op" id="5604537">{</span><span class="op" id="5604538">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5604541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604544">i</span>&nbsp;<span class="op" id="5604546">:=</span>&nbsp;<span class="ident" id="5604549">p</span><span class="op" id="5604550">.</span><span class="ident" id="5604551">PixOffset</span><span class="op" id="5604560">(</span><span class="ident" id="5604561">r</span><span class="op" id="5604562">.</span><span class="ident" id="5604563">Min</span><span class="op" id="5604566">.</span><span class="ident" id="5604567">X</span><span class="op" id="5604568">,</span>&nbsp;<span class="ident" id="5604570">r</span><span class="op" id="5604571">.</span><span class="ident" id="5604572">Min</span><span class="op" id="5604575">.</span><span class="ident" id="5604576">Y</span><span class="op" id="5604577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604580">return</span>&nbsp;<span class="op" id="5604587">&amp;</span><span class="ident" id="5604588">NRGBA</span><span class="op" id="5604593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604597">Pix</span><span class="op" id="5604600">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604605">p</span><span class="op" id="5604606">.</span><span class="ident" id="5604607">Pix</span><span class="op" id="5604610">[</span><span class="ident" id="5604611">i</span><span class="op" id="5604612">:</span><span class="op" id="5604613">]</span><span class="op" id="5604614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604618">Stride</span><span class="op" id="5604624">:</span>&nbsp;<span class="ident" id="5604626">p</span><span class="op" id="5604627">.</span><span class="ident" id="5604628">Stride</span><span class="op" id="5604634">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604638">Rect</span><span class="op" id="5604642">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5604646">r</span><span class="op" id="5604647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5604650">}</span><br>
<span class="lineno"></span><span class="op" id="5604652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5604655">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno">345</span><span class="keyword" id="5604728">func</span>&nbsp;<span class="op" id="5604733">(</span><span class="ident" id="5604734">p</span>&nbsp;<span class="op" id="5604736">*</span><span class="ident" id="5604737">NRGBA</span><span class="op" id="5604742">)</span>&nbsp;<span class="ident" id="5604744">Opaque</span><span class="op" id="5604750">(</span><span class="op" id="5604751">)</span>&nbsp;<span class="builtintype" id="5604753">bool</span>&nbsp;<span class="op" id="5604758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604761">if</span>&nbsp;<span class="ident" id="5604764">p</span><span class="op" id="5604765">.</span><span class="ident" id="5604766">Rect</span><span class="op" id="5604770">.</span><span class="ident" id="5604771">Empty</span><span class="op" id="5604776">(</span><span class="op" id="5604777">)</span>&nbsp;<span class="op" id="5604779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604783">return</span>&nbsp;<span class="builtintype" id="5604790">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5604796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604799">i0</span><span class="op" id="5604801">,</span>&nbsp;<span class="ident" id="5604803">i1</span>&nbsp;<span class="op" id="5604806">:=</span>&nbsp;<span class="num" id="5604809">3</span><span class="op" id="5604810">,</span>&nbsp;<span class="ident" id="5604812">p</span><span class="op" id="5604813">.</span><span class="ident" id="5604814">Rect</span><span class="op" id="5604818">.</span><span class="ident" id="5604819">Dx</span><span class="op" id="5604821">(</span><span class="op" id="5604822">)</span><span class="op" id="5604823">*</span><span class="num" id="5604824">4</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604827">for</span>&nbsp;<span class="ident" id="5604831">y</span>&nbsp;<span class="op" id="5604833">:=</span>&nbsp;<span class="ident" id="5604836">p</span><span class="op" id="5604837">.</span><span class="ident" id="5604838">Rect</span><span class="op" id="5604842">.</span><span class="ident" id="5604843">Min</span><span class="op" id="5604846">.</span><span class="ident" id="5604847">Y</span><span class="op" id="5604848">;</span>&nbsp;<span class="ident" id="5604850">y</span>&nbsp;<span class="op" id="5604852">&lt;</span>&nbsp;<span class="ident" id="5604854">p</span><span class="op" id="5604855">.</span><span class="ident" id="5604856">Rect</span><span class="op" id="5604860">.</span><span class="ident" id="5604861">Max</span><span class="op" id="5604864">.</span><span class="ident" id="5604865">Y</span><span class="op" id="5604866">;</span>&nbsp;<span class="ident" id="5604868">y</span><span class="op" id="5604869">++</span>&nbsp;<span class="op" id="5604872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604876">for</span>&nbsp;<span class="ident" id="5604880">i</span>&nbsp;<span class="op" id="5604882">:=</span>&nbsp;<span class="ident" id="5604885">i0</span><span class="op" id="5604887">;</span>&nbsp;<span class="ident" id="5604889">i</span>&nbsp;<span class="op" id="5604891">&lt;</span>&nbsp;<span class="ident" id="5604893">i1</span><span class="op" id="5604895">;</span>&nbsp;<span class="ident" id="5604897">i</span>&nbsp;<span class="op" id="5604899">+=</span>&nbsp;<span class="num" id="5604902">4</span>&nbsp;<span class="op" id="5604904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604909">if</span>&nbsp;<span class="ident" id="5604912">p</span><span class="op" id="5604913">.</span><span class="ident" id="5604914">Pix</span><span class="op" id="5604917">[</span><span class="ident" id="5604918">i</span><span class="op" id="5604919">]</span>&nbsp;<span class="op" id="5604921">!=</span>&nbsp;<span class="num" id="5604924">0xff</span>&nbsp;<span class="op" id="5604929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604935">return</span>&nbsp;<span class="builtintype" id="5604942">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5604951">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5604955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604959">i0</span>&nbsp;<span class="op" id="5604962">+=</span>&nbsp;<span class="ident" id="5604965">p</span><span class="op" id="5604966">.</span><span class="ident" id="5604967">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604976">i1</span>&nbsp;<span class="op" id="5604979">+=</span>&nbsp;<span class="ident" id="5604982">p</span><span class="op" id="5604983">.</span><span class="ident" id="5604984">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5604992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604995">return</span>&nbsp;<span class="builtintype" id="5605002">true</span><br>
<span class="lineno">360</span><span class="op" id="5605007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5605010">//&nbsp;NewNRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5605065">func</span>&nbsp;<span class="ident" id="5605070">NewNRGBA</span><span class="op" id="5605078">(</span><span class="ident" id="5605079">r</span>&nbsp;<span class="ident" id="5605081">Rectangle</span><span class="op" id="5605090">)</span>&nbsp;<span class="op" id="5605092">*</span><span class="ident" id="5605093">NRGBA</span>&nbsp;<span class="op" id="5605099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605102">w</span><span class="op" id="5605103">,</span>&nbsp;<span class="ident" id="5605105">h</span>&nbsp;<span class="op" id="5605107">:=</span>&nbsp;<span class="ident" id="5605110">r</span><span class="op" id="5605111">.</span><span class="ident" id="5605112">Dx</span><span class="op" id="5605114">(</span><span class="op" id="5605115">)</span><span class="op" id="5605116">,</span>&nbsp;<span class="ident" id="5605118">r</span><span class="op" id="5605119">.</span><span class="ident" id="5605120">Dy</span><span class="op" id="5605122">(</span><span class="op" id="5605123">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605126">pix</span>&nbsp;<span class="op" id="5605130">:=</span>&nbsp;<span class="builtinfunc" id="5605133">make</span><span class="op" id="5605137">(</span><span class="op" id="5605138">[</span><span class="op" id="5605139">]</span><span class="builtintype" id="5605140">uint8</span><span class="op" id="5605145">,</span>&nbsp;<span class="num" id="5605147">4</span><span class="op" id="5605148">*</span><span class="ident" id="5605149">w</span><span class="op" id="5605150">*</span><span class="ident" id="5605151">h</span><span class="op" id="5605152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605155">return</span>&nbsp;<span class="op" id="5605162">&amp;</span><span class="ident" id="5605163">NRGBA</span><span class="op" id="5605168">{</span><span class="ident" id="5605169">pix</span><span class="op" id="5605172">,</span>&nbsp;<span class="num" id="5605174">4</span>&nbsp;<span class="op" id="5605176">*</span>&nbsp;<span class="ident" id="5605178">w</span><span class="op" id="5605179">,</span>&nbsp;<span class="ident" id="5605181">r</span><span class="op" id="5605182">}</span><br>
<span class="lineno"></span><span class="op" id="5605184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5605187">//&nbsp;NRGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA64&nbsp;values.</span><br>
<span class="lineno">370</span><span class="keyword" id="5605266">type</span>&nbsp;<span class="ident" id="5605271">NRGBA64</span>&nbsp;<span class="keyword" id="5605279">struct</span>&nbsp;<span class="op" id="5605286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5605289">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5605379">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605447">Pix</span>&nbsp;<span class="op" id="5605451">[</span><span class="op" id="5605452">]</span><span class="builtintype" id="5605453">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5605460">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605536">Stride</span>&nbsp;<span class="builtintype" id="5605543">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5605548">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605580">Rect</span>&nbsp;<span class="ident" id="5605585">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5605595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="5605598">func</span>&nbsp;<span class="op" id="5605603">(</span><span class="ident" id="5605604">p</span>&nbsp;<span class="op" id="5605606">*</span><span class="ident" id="5605607">NRGBA64</span><span class="op" id="5605614">)</span>&nbsp;<span class="ident" id="5605616">ColorModel</span><span class="op" id="5605626">(</span><span class="op" id="5605627">)</span>&nbsp;<span class="ident" id="5605629">color</span><span class="op" id="5605634">.</span><span class="ident" id="5605635">Model</span>&nbsp;<span class="op" id="5605641">{</span>&nbsp;<span class="keyword" id="5605643">return</span>&nbsp;<span class="ident" id="5605650">color</span><span class="op" id="5605655">.</span><span class="ident" id="5605656">NRGBA64Model</span>&nbsp;<span class="op" id="5605669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5605672">func</span>&nbsp;<span class="op" id="5605677">(</span><span class="ident" id="5605678">p</span>&nbsp;<span class="op" id="5605680">*</span><span class="ident" id="5605681">NRGBA64</span><span class="op" id="5605688">)</span>&nbsp;<span class="ident" id="5605690">Bounds</span><span class="op" id="5605696">(</span><span class="op" id="5605697">)</span>&nbsp;<span class="ident" id="5605699">Rectangle</span>&nbsp;<span class="op" id="5605709">{</span>&nbsp;<span class="keyword" id="5605711">return</span>&nbsp;<span class="ident" id="5605718">p</span><span class="op" id="5605719">.</span><span class="ident" id="5605720">Rect</span>&nbsp;<span class="op" id="5605725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5605728">func</span>&nbsp;<span class="op" id="5605733">(</span><span class="ident" id="5605734">p</span>&nbsp;<span class="op" id="5605736">*</span><span class="ident" id="5605737">NRGBA64</span><span class="op" id="5605744">)</span>&nbsp;<span class="ident" id="5605746">At</span><span class="op" id="5605748">(</span><span class="ident" id="5605749">x</span><span class="op" id="5605750">,</span>&nbsp;<span class="ident" id="5605752">y</span>&nbsp;<span class="builtintype" id="5605754">int</span><span class="op" id="5605757">)</span>&nbsp;<span class="ident" id="5605759">color</span><span class="op" id="5605764">.</span><span class="ident" id="5605765">Color</span>&nbsp;<span class="op" id="5605771">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605774">return</span>&nbsp;<span class="ident" id="5605781">p</span><span class="op" id="5605782">.</span><span class="ident" id="5605783">NRGBA64At</span><span class="op" id="5605792">(</span><span class="ident" id="5605793">x</span><span class="op" id="5605794">,</span>&nbsp;<span class="ident" id="5605796">y</span><span class="op" id="5605797">)</span><br>
<span class="lineno"></span><span class="op" id="5605799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5605802">func</span>&nbsp;<span class="op" id="5605807">(</span><span class="ident" id="5605808">p</span>&nbsp;<span class="op" id="5605810">*</span><span class="ident" id="5605811">NRGBA64</span><span class="op" id="5605818">)</span>&nbsp;<span class="ident" id="5605820">NRGBA64At</span><span class="op" id="5605829">(</span><span class="ident" id="5605830">x</span><span class="op" id="5605831">,</span>&nbsp;<span class="ident" id="5605833">y</span>&nbsp;<span class="builtintype" id="5605835">int</span><span class="op" id="5605838">)</span>&nbsp;<span class="ident" id="5605840">color</span><span class="op" id="5605845">.</span><span class="ident" id="5605846">NRGBA64</span>&nbsp;<span class="op" id="5605854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605857">if</span>&nbsp;<span class="op" id="5605860">!</span><span class="op" id="5605861">(</span><span class="ident" id="5605862">Point</span><span class="op" id="5605867">{</span><span class="ident" id="5605868">x</span><span class="op" id="5605869">,</span>&nbsp;<span class="ident" id="5605871">y</span><span class="op" id="5605872">}</span><span class="op" id="5605873">.</span><span class="ident" id="5605874">In</span><span class="op" id="5605876">(</span><span class="ident" id="5605877">p</span><span class="op" id="5605878">.</span><span class="ident" id="5605879">Rect</span><span class="op" id="5605883">)</span><span class="op" id="5605884">)</span>&nbsp;<span class="op" id="5605886">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605890">return</span>&nbsp;<span class="ident" id="5605897">color</span><span class="op" id="5605902">.</span><span class="ident" id="5605903">NRGBA64</span><span class="op" id="5605910">{</span><span class="op" id="5605911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5605914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605917">i</span>&nbsp;<span class="op" id="5605919">:=</span>&nbsp;<span class="ident" id="5605922">p</span><span class="op" id="5605923">.</span><span class="ident" id="5605924">PixOffset</span><span class="op" id="5605933">(</span><span class="ident" id="5605934">x</span><span class="op" id="5605935">,</span>&nbsp;<span class="ident" id="5605937">y</span><span class="op" id="5605938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605941">return</span>&nbsp;<span class="ident" id="5605948">color</span><span class="op" id="5605953">.</span><span class="ident" id="5605954">NRGBA64</span><span class="op" id="5605961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5605965">uint16</span><span class="op" id="5605971">(</span><span class="ident" id="5605972">p</span><span class="op" id="5605973">.</span><span class="ident" id="5605974">Pix</span><span class="op" id="5605977">[</span><span class="ident" id="5605978">i</span><span class="op" id="5605979">+</span><span class="num" id="5605980">0</span><span class="op" id="5605981">]</span><span class="op" id="5605982">)</span><span class="op" id="5605983">&lt;&lt;</span><span class="num" id="5605985">8</span>&nbsp;<span class="op" id="5605987">|</span>&nbsp;<span class="builtintype" id="5605989">uint16</span><span class="op" id="5605995">(</span><span class="ident" id="5605996">p</span><span class="op" id="5605997">.</span><span class="ident" id="5605998">Pix</span><span class="op" id="5606001">[</span><span class="ident" id="5606002">i</span><span class="op" id="5606003">+</span><span class="num" id="5606004">1</span><span class="op" id="5606005">]</span><span class="op" id="5606006">)</span><span class="op" id="5606007">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5606011">uint16</span><span class="op" id="5606017">(</span><span class="ident" id="5606018">p</span><span class="op" id="5606019">.</span><span class="ident" id="5606020">Pix</span><span class="op" id="5606023">[</span><span class="ident" id="5606024">i</span><span class="op" id="5606025">+</span><span class="num" id="5606026">2</span><span class="op" id="5606027">]</span><span class="op" id="5606028">)</span><span class="op" id="5606029">&lt;&lt;</span><span class="num" id="5606031">8</span>&nbsp;<span class="op" id="5606033">|</span>&nbsp;<span class="builtintype" id="5606035">uint16</span><span class="op" id="5606041">(</span><span class="ident" id="5606042">p</span><span class="op" id="5606043">.</span><span class="ident" id="5606044">Pix</span><span class="op" id="5606047">[</span><span class="ident" id="5606048">i</span><span class="op" id="5606049">+</span><span class="num" id="5606050">3</span><span class="op" id="5606051">]</span><span class="op" id="5606052">)</span><span class="op" id="5606053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5606057">uint16</span><span class="op" id="5606063">(</span><span class="ident" id="5606064">p</span><span class="op" id="5606065">.</span><span class="ident" id="5606066">Pix</span><span class="op" id="5606069">[</span><span class="ident" id="5606070">i</span><span class="op" id="5606071">+</span><span class="num" id="5606072">4</span><span class="op" id="5606073">]</span><span class="op" id="5606074">)</span><span class="op" id="5606075">&lt;&lt;</span><span class="num" id="5606077">8</span>&nbsp;<span class="op" id="5606079">|</span>&nbsp;<span class="builtintype" id="5606081">uint16</span><span class="op" id="5606087">(</span><span class="ident" id="5606088">p</span><span class="op" id="5606089">.</span><span class="ident" id="5606090">Pix</span><span class="op" id="5606093">[</span><span class="ident" id="5606094">i</span><span class="op" id="5606095">+</span><span class="num" id="5606096">5</span><span class="op" id="5606097">]</span><span class="op" id="5606098">)</span><span class="op" id="5606099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5606103">uint16</span><span class="op" id="5606109">(</span><span class="ident" id="5606110">p</span><span class="op" id="5606111">.</span><span class="ident" id="5606112">Pix</span><span class="op" id="5606115">[</span><span class="ident" id="5606116">i</span><span class="op" id="5606117">+</span><span class="num" id="5606118">6</span><span class="op" id="5606119">]</span><span class="op" id="5606120">)</span><span class="op" id="5606121">&lt;&lt;</span><span class="num" id="5606123">8</span>&nbsp;<span class="op" id="5606125">|</span>&nbsp;<span class="builtintype" id="5606127">uint16</span><span class="op" id="5606133">(</span><span class="ident" id="5606134">p</span><span class="op" id="5606135">.</span><span class="ident" id="5606136">Pix</span><span class="op" id="5606139">[</span><span class="ident" id="5606140">i</span><span class="op" id="5606141">+</span><span class="num" id="5606142">7</span><span class="op" id="5606143">]</span><span class="op" id="5606144">)</span><span class="op" id="5606145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5606148">}</span><br>
<span class="lineno"></span><span class="op" id="5606150">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="comment" id="5606153">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5606232">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5606256">func</span>&nbsp;<span class="op" id="5606261">(</span><span class="ident" id="5606262">p</span>&nbsp;<span class="op" id="5606264">*</span><span class="ident" id="5606265">NRGBA64</span><span class="op" id="5606272">)</span>&nbsp;<span class="ident" id="5606274">PixOffset</span><span class="op" id="5606283">(</span><span class="ident" id="5606284">x</span><span class="op" id="5606285">,</span>&nbsp;<span class="ident" id="5606287">y</span>&nbsp;<span class="builtintype" id="5606289">int</span><span class="op" id="5606292">)</span>&nbsp;<span class="builtintype" id="5606294">int</span>&nbsp;<span class="op" id="5606298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606301">return</span>&nbsp;<span class="op" id="5606308">(</span><span class="ident" id="5606309">y</span><span class="op" id="5606310">-</span><span class="ident" id="5606311">p</span><span class="op" id="5606312">.</span><span class="ident" id="5606313">Rect</span><span class="op" id="5606317">.</span><span class="ident" id="5606318">Min</span><span class="op" id="5606321">.</span><span class="ident" id="5606322">Y</span><span class="op" id="5606323">)</span><span class="op" id="5606324">*</span><span class="ident" id="5606325">p</span><span class="op" id="5606326">.</span><span class="ident" id="5606327">Stride</span>&nbsp;<span class="op" id="5606334">+</span>&nbsp;<span class="op" id="5606336">(</span><span class="ident" id="5606337">x</span><span class="op" id="5606338">-</span><span class="ident" id="5606339">p</span><span class="op" id="5606340">.</span><span class="ident" id="5606341">Rect</span><span class="op" id="5606345">.</span><span class="ident" id="5606346">Min</span><span class="op" id="5606349">.</span><span class="ident" id="5606350">X</span><span class="op" id="5606351">)</span><span class="op" id="5606352">*</span><span class="num" id="5606353">8</span><br>
<span class="lineno">405</span><span class="op" id="5606355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5606358">func</span>&nbsp;<span class="op" id="5606363">(</span><span class="ident" id="5606364">p</span>&nbsp;<span class="op" id="5606366">*</span><span class="ident" id="5606367">NRGBA64</span><span class="op" id="5606374">)</span>&nbsp;<span class="ident" id="5606376">Set</span><span class="op" id="5606379">(</span><span class="ident" id="5606380">x</span><span class="op" id="5606381">,</span>&nbsp;<span class="ident" id="5606383">y</span>&nbsp;<span class="builtintype" id="5606385">int</span><span class="op" id="5606388">,</span>&nbsp;<span class="ident" id="5606390">c</span>&nbsp;<span class="ident" id="5606392">color</span><span class="op" id="5606397">.</span><span class="ident" id="5606398">Color</span><span class="op" id="5606403">)</span>&nbsp;<span class="op" id="5606405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606408">if</span>&nbsp;<span class="op" id="5606411">!</span><span class="op" id="5606412">(</span><span class="ident" id="5606413">Point</span><span class="op" id="5606418">{</span><span class="ident" id="5606419">x</span><span class="op" id="5606420">,</span>&nbsp;<span class="ident" id="5606422">y</span><span class="op" id="5606423">}</span><span class="op" id="5606424">.</span><span class="ident" id="5606425">In</span><span class="op" id="5606427">(</span><span class="ident" id="5606428">p</span><span class="op" id="5606429">.</span><span class="ident" id="5606430">Rect</span><span class="op" id="5606434">)</span><span class="op" id="5606435">)</span>&nbsp;<span class="op" id="5606437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606441">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5606449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606452">i</span>&nbsp;<span class="op" id="5606454">:=</span>&nbsp;<span class="ident" id="5606457">p</span><span class="op" id="5606458">.</span><span class="ident" id="5606459">PixOffset</span><span class="op" id="5606468">(</span><span class="ident" id="5606469">x</span><span class="op" id="5606470">,</span>&nbsp;<span class="ident" id="5606472">y</span><span class="op" id="5606473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606476">c1</span>&nbsp;<span class="op" id="5606479">:=</span>&nbsp;<span class="ident" id="5606482">color</span><span class="op" id="5606487">.</span><span class="ident" id="5606488">NRGBA64Model</span><span class="op" id="5606500">.</span><span class="ident" id="5606501">Convert</span><span class="op" id="5606508">(</span><span class="ident" id="5606509">c</span><span class="op" id="5606510">)</span><span class="op" id="5606511">.</span><span class="op" id="5606512">(</span><span class="ident" id="5606513">color</span><span class="op" id="5606518">.</span><span class="ident" id="5606519">NRGBA64</span><span class="op" id="5606526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606529">p</span><span class="op" id="5606530">.</span><span class="ident" id="5606531">Pix</span><span class="op" id="5606534">[</span><span class="ident" id="5606535">i</span><span class="op" id="5606536">+</span><span class="num" id="5606537">0</span><span class="op" id="5606538">]</span>&nbsp;<span class="op" id="5606540">=</span>&nbsp;<span class="builtintype" id="5606542">uint8</span><span class="op" id="5606547">(</span><span class="ident" id="5606548">c1</span><span class="op" id="5606550">.</span><span class="ident" id="5606551">R</span>&nbsp;<span class="op" id="5606553">&gt;&gt;</span>&nbsp;<span class="num" id="5606556">8</span><span class="op" id="5606557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606560">p</span><span class="op" id="5606561">.</span><span class="ident" id="5606562">Pix</span><span class="op" id="5606565">[</span><span class="ident" id="5606566">i</span><span class="op" id="5606567">+</span><span class="num" id="5606568">1</span><span class="op" id="5606569">]</span>&nbsp;<span class="op" id="5606571">=</span>&nbsp;<span class="builtintype" id="5606573">uint8</span><span class="op" id="5606578">(</span><span class="ident" id="5606579">c1</span><span class="op" id="5606581">.</span><span class="ident" id="5606582">R</span><span class="op" id="5606583">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606586">p</span><span class="op" id="5606587">.</span><span class="ident" id="5606588">Pix</span><span class="op" id="5606591">[</span><span class="ident" id="5606592">i</span><span class="op" id="5606593">+</span><span class="num" id="5606594">2</span><span class="op" id="5606595">]</span>&nbsp;<span class="op" id="5606597">=</span>&nbsp;<span class="builtintype" id="5606599">uint8</span><span class="op" id="5606604">(</span><span class="ident" id="5606605">c1</span><span class="op" id="5606607">.</span><span class="ident" id="5606608">G</span>&nbsp;<span class="op" id="5606610">&gt;&gt;</span>&nbsp;<span class="num" id="5606613">8</span><span class="op" id="5606614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606617">p</span><span class="op" id="5606618">.</span><span class="ident" id="5606619">Pix</span><span class="op" id="5606622">[</span><span class="ident" id="5606623">i</span><span class="op" id="5606624">+</span><span class="num" id="5606625">3</span><span class="op" id="5606626">]</span>&nbsp;<span class="op" id="5606628">=</span>&nbsp;<span class="builtintype" id="5606630">uint8</span><span class="op" id="5606635">(</span><span class="ident" id="5606636">c1</span><span class="op" id="5606638">.</span><span class="ident" id="5606639">G</span><span class="op" id="5606640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606643">p</span><span class="op" id="5606644">.</span><span class="ident" id="5606645">Pix</span><span class="op" id="5606648">[</span><span class="ident" id="5606649">i</span><span class="op" id="5606650">+</span><span class="num" id="5606651">4</span><span class="op" id="5606652">]</span>&nbsp;<span class="op" id="5606654">=</span>&nbsp;<span class="builtintype" id="5606656">uint8</span><span class="op" id="5606661">(</span><span class="ident" id="5606662">c1</span><span class="op" id="5606664">.</span><span class="ident" id="5606665">B</span>&nbsp;<span class="op" id="5606667">&gt;&gt;</span>&nbsp;<span class="num" id="5606670">8</span><span class="op" id="5606671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606674">p</span><span class="op" id="5606675">.</span><span class="ident" id="5606676">Pix</span><span class="op" id="5606679">[</span><span class="ident" id="5606680">i</span><span class="op" id="5606681">+</span><span class="num" id="5606682">5</span><span class="op" id="5606683">]</span>&nbsp;<span class="op" id="5606685">=</span>&nbsp;<span class="builtintype" id="5606687">uint8</span><span class="op" id="5606692">(</span><span class="ident" id="5606693">c1</span><span class="op" id="5606695">.</span><span class="ident" id="5606696">B</span><span class="op" id="5606697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606700">p</span><span class="op" id="5606701">.</span><span class="ident" id="5606702">Pix</span><span class="op" id="5606705">[</span><span class="ident" id="5606706">i</span><span class="op" id="5606707">+</span><span class="num" id="5606708">6</span><span class="op" id="5606709">]</span>&nbsp;<span class="op" id="5606711">=</span>&nbsp;<span class="builtintype" id="5606713">uint8</span><span class="op" id="5606718">(</span><span class="ident" id="5606719">c1</span><span class="op" id="5606721">.</span><span class="ident" id="5606722">A</span>&nbsp;<span class="op" id="5606724">&gt;&gt;</span>&nbsp;<span class="num" id="5606727">8</span><span class="op" id="5606728">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606731">p</span><span class="op" id="5606732">.</span><span class="ident" id="5606733">Pix</span><span class="op" id="5606736">[</span><span class="ident" id="5606737">i</span><span class="op" id="5606738">+</span><span class="num" id="5606739">7</span><span class="op" id="5606740">]</span>&nbsp;<span class="op" id="5606742">=</span>&nbsp;<span class="builtintype" id="5606744">uint8</span><span class="op" id="5606749">(</span><span class="ident" id="5606750">c1</span><span class="op" id="5606752">.</span><span class="ident" id="5606753">A</span><span class="op" id="5606754">)</span><br>
<span class="lineno"></span><span class="op" id="5606756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5606759">func</span>&nbsp;<span class="op" id="5606764">(</span><span class="ident" id="5606765">p</span>&nbsp;<span class="op" id="5606767">*</span><span class="ident" id="5606768">NRGBA64</span><span class="op" id="5606775">)</span>&nbsp;<span class="ident" id="5606777">SetNRGBA64</span><span class="op" id="5606787">(</span><span class="ident" id="5606788">x</span><span class="op" id="5606789">,</span>&nbsp;<span class="ident" id="5606791">y</span>&nbsp;<span class="builtintype" id="5606793">int</span><span class="op" id="5606796">,</span>&nbsp;<span class="ident" id="5606798">c</span>&nbsp;<span class="ident" id="5606800">color</span><span class="op" id="5606805">.</span><span class="ident" id="5606806">NRGBA64</span><span class="op" id="5606813">)</span>&nbsp;<span class="op" id="5606815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606818">if</span>&nbsp;<span class="op" id="5606821">!</span><span class="op" id="5606822">(</span><span class="ident" id="5606823">Point</span><span class="op" id="5606828">{</span><span class="ident" id="5606829">x</span><span class="op" id="5606830">,</span>&nbsp;<span class="ident" id="5606832">y</span><span class="op" id="5606833">}</span><span class="op" id="5606834">.</span><span class="ident" id="5606835">In</span><span class="op" id="5606837">(</span><span class="ident" id="5606838">p</span><span class="op" id="5606839">.</span><span class="ident" id="5606840">Rect</span><span class="op" id="5606844">)</span><span class="op" id="5606845">)</span>&nbsp;<span class="op" id="5606847">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606851">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5606859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606862">i</span>&nbsp;<span class="op" id="5606864">:=</span>&nbsp;<span class="ident" id="5606867">p</span><span class="op" id="5606868">.</span><span class="ident" id="5606869">PixOffset</span><span class="op" id="5606878">(</span><span class="ident" id="5606879">x</span><span class="op" id="5606880">,</span>&nbsp;<span class="ident" id="5606882">y</span><span class="op" id="5606883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606886">p</span><span class="op" id="5606887">.</span><span class="ident" id="5606888">Pix</span><span class="op" id="5606891">[</span><span class="ident" id="5606892">i</span><span class="op" id="5606893">+</span><span class="num" id="5606894">0</span><span class="op" id="5606895">]</span>&nbsp;<span class="op" id="5606897">=</span>&nbsp;<span class="builtintype" id="5606899">uint8</span><span class="op" id="5606904">(</span><span class="ident" id="5606905">c</span><span class="op" id="5606906">.</span><span class="ident" id="5606907">R</span>&nbsp;<span class="op" id="5606909">&gt;&gt;</span>&nbsp;<span class="num" id="5606912">8</span><span class="op" id="5606913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606916">p</span><span class="op" id="5606917">.</span><span class="ident" id="5606918">Pix</span><span class="op" id="5606921">[</span><span class="ident" id="5606922">i</span><span class="op" id="5606923">+</span><span class="num" id="5606924">1</span><span class="op" id="5606925">]</span>&nbsp;<span class="op" id="5606927">=</span>&nbsp;<span class="builtintype" id="5606929">uint8</span><span class="op" id="5606934">(</span><span class="ident" id="5606935">c</span><span class="op" id="5606936">.</span><span class="ident" id="5606937">R</span><span class="op" id="5606938">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606941">p</span><span class="op" id="5606942">.</span><span class="ident" id="5606943">Pix</span><span class="op" id="5606946">[</span><span class="ident" id="5606947">i</span><span class="op" id="5606948">+</span><span class="num" id="5606949">2</span><span class="op" id="5606950">]</span>&nbsp;<span class="op" id="5606952">=</span>&nbsp;<span class="builtintype" id="5606954">uint8</span><span class="op" id="5606959">(</span><span class="ident" id="5606960">c</span><span class="op" id="5606961">.</span><span class="ident" id="5606962">G</span>&nbsp;<span class="op" id="5606964">&gt;&gt;</span>&nbsp;<span class="num" id="5606967">8</span><span class="op" id="5606968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606971">p</span><span class="op" id="5606972">.</span><span class="ident" id="5606973">Pix</span><span class="op" id="5606976">[</span><span class="ident" id="5606977">i</span><span class="op" id="5606978">+</span><span class="num" id="5606979">3</span><span class="op" id="5606980">]</span>&nbsp;<span class="op" id="5606982">=</span>&nbsp;<span class="builtintype" id="5606984">uint8</span><span class="op" id="5606989">(</span><span class="ident" id="5606990">c</span><span class="op" id="5606991">.</span><span class="ident" id="5606992">G</span><span class="op" id="5606993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606996">p</span><span class="op" id="5606997">.</span><span class="ident" id="5606998">Pix</span><span class="op" id="5607001">[</span><span class="ident" id="5607002">i</span><span class="op" id="5607003">+</span><span class="num" id="5607004">4</span><span class="op" id="5607005">]</span>&nbsp;<span class="op" id="5607007">=</span>&nbsp;<span class="builtintype" id="5607009">uint8</span><span class="op" id="5607014">(</span><span class="ident" id="5607015">c</span><span class="op" id="5607016">.</span><span class="ident" id="5607017">B</span>&nbsp;<span class="op" id="5607019">&gt;&gt;</span>&nbsp;<span class="num" id="5607022">8</span><span class="op" id="5607023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607026">p</span><span class="op" id="5607027">.</span><span class="ident" id="5607028">Pix</span><span class="op" id="5607031">[</span><span class="ident" id="5607032">i</span><span class="op" id="5607033">+</span><span class="num" id="5607034">5</span><span class="op" id="5607035">]</span>&nbsp;<span class="op" id="5607037">=</span>&nbsp;<span class="builtintype" id="5607039">uint8</span><span class="op" id="5607044">(</span><span class="ident" id="5607045">c</span><span class="op" id="5607046">.</span><span class="ident" id="5607047">B</span><span class="op" id="5607048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607051">p</span><span class="op" id="5607052">.</span><span class="ident" id="5607053">Pix</span><span class="op" id="5607056">[</span><span class="ident" id="5607057">i</span><span class="op" id="5607058">+</span><span class="num" id="5607059">6</span><span class="op" id="5607060">]</span>&nbsp;<span class="op" id="5607062">=</span>&nbsp;<span class="builtintype" id="5607064">uint8</span><span class="op" id="5607069">(</span><span class="ident" id="5607070">c</span><span class="op" id="5607071">.</span><span class="ident" id="5607072">A</span>&nbsp;<span class="op" id="5607074">&gt;&gt;</span>&nbsp;<span class="num" id="5607077">8</span><span class="op" id="5607078">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607081">p</span><span class="op" id="5607082">.</span><span class="ident" id="5607083">Pix</span><span class="op" id="5607086">[</span><span class="ident" id="5607087">i</span><span class="op" id="5607088">+</span><span class="num" id="5607089">7</span><span class="op" id="5607090">]</span>&nbsp;<span class="op" id="5607092">=</span>&nbsp;<span class="builtintype" id="5607094">uint8</span><span class="op" id="5607099">(</span><span class="ident" id="5607100">c</span><span class="op" id="5607101">.</span><span class="ident" id="5607102">A</span><span class="op" id="5607103">)</span><br>
<span class="lineno"></span><span class="op" id="5607105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5607108">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5607185">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno">440</span><span class="keyword" id="5607257">func</span>&nbsp;<span class="op" id="5607262">(</span><span class="ident" id="5607263">p</span>&nbsp;<span class="op" id="5607265">*</span><span class="ident" id="5607266">NRGBA64</span><span class="op" id="5607273">)</span>&nbsp;<span class="ident" id="5607275">SubImage</span><span class="op" id="5607283">(</span><span class="ident" id="5607284">r</span>&nbsp;<span class="ident" id="5607286">Rectangle</span><span class="op" id="5607295">)</span>&nbsp;<span class="ident" id="5607297">Image</span>&nbsp;<span class="op" id="5607303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607306">r</span>&nbsp;<span class="op" id="5607308">=</span>&nbsp;<span class="ident" id="5607310">r</span><span class="op" id="5607311">.</span><span class="ident" id="5607312">Intersect</span><span class="op" id="5607321">(</span><span class="ident" id="5607322">p</span><span class="op" id="5607323">.</span><span class="ident" id="5607324">Rect</span><span class="op" id="5607328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5607331">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5607412">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5607494">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607544">if</span>&nbsp;<span class="ident" id="5607547">r</span><span class="op" id="5607548">.</span><span class="ident" id="5607549">Empty</span><span class="op" id="5607554">(</span><span class="op" id="5607555">)</span>&nbsp;<span class="op" id="5607557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607561">return</span>&nbsp;<span class="op" id="5607568">&amp;</span><span class="ident" id="5607569">NRGBA64</span><span class="op" id="5607576">{</span><span class="op" id="5607577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607583">i</span>&nbsp;<span class="op" id="5607585">:=</span>&nbsp;<span class="ident" id="5607588">p</span><span class="op" id="5607589">.</span><span class="ident" id="5607590">PixOffset</span><span class="op" id="5607599">(</span><span class="ident" id="5607600">r</span><span class="op" id="5607601">.</span><span class="ident" id="5607602">Min</span><span class="op" id="5607605">.</span><span class="ident" id="5607606">X</span><span class="op" id="5607607">,</span>&nbsp;<span class="ident" id="5607609">r</span><span class="op" id="5607610">.</span><span class="ident" id="5607611">Min</span><span class="op" id="5607614">.</span><span class="ident" id="5607615">Y</span><span class="op" id="5607616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607619">return</span>&nbsp;<span class="op" id="5607626">&amp;</span><span class="ident" id="5607627">NRGBA64</span><span class="op" id="5607634">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607638">Pix</span><span class="op" id="5607641">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607646">p</span><span class="op" id="5607647">.</span><span class="ident" id="5607648">Pix</span><span class="op" id="5607651">[</span><span class="ident" id="5607652">i</span><span class="op" id="5607653">:</span><span class="op" id="5607654">]</span><span class="op" id="5607655">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607659">Stride</span><span class="op" id="5607665">:</span>&nbsp;<span class="ident" id="5607667">p</span><span class="op" id="5607668">.</span><span class="ident" id="5607669">Stride</span><span class="op" id="5607675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607679">Rect</span><span class="op" id="5607683">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5607687">r</span><span class="op" id="5607688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607691">}</span><br>
<span class="lineno"></span><span class="op" id="5607693">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="5607696">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5607769">func</span>&nbsp;<span class="op" id="5607774">(</span><span class="ident" id="5607775">p</span>&nbsp;<span class="op" id="5607777">*</span><span class="ident" id="5607778">NRGBA64</span><span class="op" id="5607785">)</span>&nbsp;<span class="ident" id="5607787">Opaque</span><span class="op" id="5607793">(</span><span class="op" id="5607794">)</span>&nbsp;<span class="builtintype" id="5607796">bool</span>&nbsp;<span class="op" id="5607801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607804">if</span>&nbsp;<span class="ident" id="5607807">p</span><span class="op" id="5607808">.</span><span class="ident" id="5607809">Rect</span><span class="op" id="5607813">.</span><span class="ident" id="5607814">Empty</span><span class="op" id="5607819">(</span><span class="op" id="5607820">)</span>&nbsp;<span class="op" id="5607822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607826">return</span>&nbsp;<span class="builtintype" id="5607833">true</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607842">i0</span><span class="op" id="5607844">,</span>&nbsp;<span class="ident" id="5607846">i1</span>&nbsp;<span class="op" id="5607849">:=</span>&nbsp;<span class="num" id="5607852">6</span><span class="op" id="5607853">,</span>&nbsp;<span class="ident" id="5607855">p</span><span class="op" id="5607856">.</span><span class="ident" id="5607857">Rect</span><span class="op" id="5607861">.</span><span class="ident" id="5607862">Dx</span><span class="op" id="5607864">(</span><span class="op" id="5607865">)</span><span class="op" id="5607866">*</span><span class="num" id="5607867">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607870">for</span>&nbsp;<span class="ident" id="5607874">y</span>&nbsp;<span class="op" id="5607876">:=</span>&nbsp;<span class="ident" id="5607879">p</span><span class="op" id="5607880">.</span><span class="ident" id="5607881">Rect</span><span class="op" id="5607885">.</span><span class="ident" id="5607886">Min</span><span class="op" id="5607889">.</span><span class="ident" id="5607890">Y</span><span class="op" id="5607891">;</span>&nbsp;<span class="ident" id="5607893">y</span>&nbsp;<span class="op" id="5607895">&lt;</span>&nbsp;<span class="ident" id="5607897">p</span><span class="op" id="5607898">.</span><span class="ident" id="5607899">Rect</span><span class="op" id="5607903">.</span><span class="ident" id="5607904">Max</span><span class="op" id="5607907">.</span><span class="ident" id="5607908">Y</span><span class="op" id="5607909">;</span>&nbsp;<span class="ident" id="5607911">y</span><span class="op" id="5607912">++</span>&nbsp;<span class="op" id="5607915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607919">for</span>&nbsp;<span class="ident" id="5607923">i</span>&nbsp;<span class="op" id="5607925">:=</span>&nbsp;<span class="ident" id="5607928">i0</span><span class="op" id="5607930">;</span>&nbsp;<span class="ident" id="5607932">i</span>&nbsp;<span class="op" id="5607934">&lt;</span>&nbsp;<span class="ident" id="5607936">i1</span><span class="op" id="5607938">;</span>&nbsp;<span class="ident" id="5607940">i</span>&nbsp;<span class="op" id="5607942">+=</span>&nbsp;<span class="num" id="5607945">8</span>&nbsp;<span class="op" id="5607947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607952">if</span>&nbsp;<span class="ident" id="5607955">p</span><span class="op" id="5607956">.</span><span class="ident" id="5607957">Pix</span><span class="op" id="5607960">[</span><span class="ident" id="5607961">i</span><span class="op" id="5607962">+</span><span class="num" id="5607963">0</span><span class="op" id="5607964">]</span>&nbsp;<span class="op" id="5607966">!=</span>&nbsp;<span class="num" id="5607969">0xff</span>&nbsp;<span class="op" id="5607974">||</span>&nbsp;<span class="ident" id="5607977">p</span><span class="op" id="5607978">.</span><span class="ident" id="5607979">Pix</span><span class="op" id="5607982">[</span><span class="ident" id="5607983">i</span><span class="op" id="5607984">+</span><span class="num" id="5607985">1</span><span class="op" id="5607986">]</span>&nbsp;<span class="op" id="5607988">!=</span>&nbsp;<span class="num" id="5607991">0xff</span>&nbsp;<span class="op" id="5607996">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608002">return</span>&nbsp;<span class="builtintype" id="5608009">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608026">i0</span>&nbsp;<span class="op" id="5608029">+=</span>&nbsp;<span class="ident" id="5608032">p</span><span class="op" id="5608033">.</span><span class="ident" id="5608034">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608043">i1</span>&nbsp;<span class="op" id="5608046">+=</span>&nbsp;<span class="ident" id="5608049">p</span><span class="op" id="5608050">.</span><span class="ident" id="5608051">Stride</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608062">return</span>&nbsp;<span class="builtintype" id="5608069">true</span><br>
<span class="lineno"></span><span class="op" id="5608074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5608077">//&nbsp;NewNRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno">475</span><span class="keyword" id="5608136">func</span>&nbsp;<span class="ident" id="5608141">NewNRGBA64</span><span class="op" id="5608151">(</span><span class="ident" id="5608152">r</span>&nbsp;<span class="ident" id="5608154">Rectangle</span><span class="op" id="5608163">)</span>&nbsp;<span class="op" id="5608165">*</span><span class="ident" id="5608166">NRGBA64</span>&nbsp;<span class="op" id="5608174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608177">w</span><span class="op" id="5608178">,</span>&nbsp;<span class="ident" id="5608180">h</span>&nbsp;<span class="op" id="5608182">:=</span>&nbsp;<span class="ident" id="5608185">r</span><span class="op" id="5608186">.</span><span class="ident" id="5608187">Dx</span><span class="op" id="5608189">(</span><span class="op" id="5608190">)</span><span class="op" id="5608191">,</span>&nbsp;<span class="ident" id="5608193">r</span><span class="op" id="5608194">.</span><span class="ident" id="5608195">Dy</span><span class="op" id="5608197">(</span><span class="op" id="5608198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608201">pix</span>&nbsp;<span class="op" id="5608205">:=</span>&nbsp;<span class="builtinfunc" id="5608208">make</span><span class="op" id="5608212">(</span><span class="op" id="5608213">[</span><span class="op" id="5608214">]</span><span class="builtintype" id="5608215">uint8</span><span class="op" id="5608220">,</span>&nbsp;<span class="num" id="5608222">8</span><span class="op" id="5608223">*</span><span class="ident" id="5608224">w</span><span class="op" id="5608225">*</span><span class="ident" id="5608226">h</span><span class="op" id="5608227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608230">return</span>&nbsp;<span class="op" id="5608237">&amp;</span><span class="ident" id="5608238">NRGBA64</span><span class="op" id="5608245">{</span><span class="ident" id="5608246">pix</span><span class="op" id="5608249">,</span>&nbsp;<span class="num" id="5608251">8</span>&nbsp;<span class="op" id="5608253">*</span>&nbsp;<span class="ident" id="5608255">w</span><span class="op" id="5608256">,</span>&nbsp;<span class="ident" id="5608258">r</span><span class="op" id="5608259">}</span><br>
<span class="lineno"></span><span class="op" id="5608261">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="5608264">//&nbsp;Alpha&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5608339">type</span>&nbsp;<span class="ident" id="5608344">Alpha</span>&nbsp;<span class="keyword" id="5608350">struct</span>&nbsp;<span class="op" id="5608357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5608360">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5608424">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608492">Pix</span>&nbsp;<span class="op" id="5608496">[</span><span class="op" id="5608497">]</span><span class="builtintype" id="5608498">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5608505">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608581">Stride</span>&nbsp;<span class="builtintype" id="5608588">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5608593">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608625">Rect</span>&nbsp;<span class="ident" id="5608630">Rectangle</span><br>
<span class="lineno">490</span><span class="op" id="5608640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5608643">func</span>&nbsp;<span class="op" id="5608648">(</span><span class="ident" id="5608649">p</span>&nbsp;<span class="op" id="5608651">*</span><span class="ident" id="5608652">Alpha</span><span class="op" id="5608657">)</span>&nbsp;<span class="ident" id="5608659">ColorModel</span><span class="op" id="5608669">(</span><span class="op" id="5608670">)</span>&nbsp;<span class="ident" id="5608672">color</span><span class="op" id="5608677">.</span><span class="ident" id="5608678">Model</span>&nbsp;<span class="op" id="5608684">{</span>&nbsp;<span class="keyword" id="5608686">return</span>&nbsp;<span class="ident" id="5608693">color</span><span class="op" id="5608698">.</span><span class="ident" id="5608699">AlphaModel</span>&nbsp;<span class="op" id="5608710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5608713">func</span>&nbsp;<span class="op" id="5608718">(</span><span class="ident" id="5608719">p</span>&nbsp;<span class="op" id="5608721">*</span><span class="ident" id="5608722">Alpha</span><span class="op" id="5608727">)</span>&nbsp;<span class="ident" id="5608729">Bounds</span><span class="op" id="5608735">(</span><span class="op" id="5608736">)</span>&nbsp;<span class="ident" id="5608738">Rectangle</span>&nbsp;<span class="op" id="5608748">{</span>&nbsp;<span class="keyword" id="5608750">return</span>&nbsp;<span class="ident" id="5608757">p</span><span class="op" id="5608758">.</span><span class="ident" id="5608759">Rect</span>&nbsp;<span class="op" id="5608764">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="5608767">func</span>&nbsp;<span class="op" id="5608772">(</span><span class="ident" id="5608773">p</span>&nbsp;<span class="op" id="5608775">*</span><span class="ident" id="5608776">Alpha</span><span class="op" id="5608781">)</span>&nbsp;<span class="ident" id="5608783">At</span><span class="op" id="5608785">(</span><span class="ident" id="5608786">x</span><span class="op" id="5608787">,</span>&nbsp;<span class="ident" id="5608789">y</span>&nbsp;<span class="builtintype" id="5608791">int</span><span class="op" id="5608794">)</span>&nbsp;<span class="ident" id="5608796">color</span><span class="op" id="5608801">.</span><span class="ident" id="5608802">Color</span>&nbsp;<span class="op" id="5608808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608811">return</span>&nbsp;<span class="ident" id="5608818">p</span><span class="op" id="5608819">.</span><span class="ident" id="5608820">AlphaAt</span><span class="op" id="5608827">(</span><span class="ident" id="5608828">x</span><span class="op" id="5608829">,</span>&nbsp;<span class="ident" id="5608831">y</span><span class="op" id="5608832">)</span><br>
<span class="lineno"></span><span class="op" id="5608834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5608837">func</span>&nbsp;<span class="op" id="5608842">(</span><span class="ident" id="5608843">p</span>&nbsp;<span class="op" id="5608845">*</span><span class="ident" id="5608846">Alpha</span><span class="op" id="5608851">)</span>&nbsp;<span class="ident" id="5608853">AlphaAt</span><span class="op" id="5608860">(</span><span class="ident" id="5608861">x</span><span class="op" id="5608862">,</span>&nbsp;<span class="ident" id="5608864">y</span>&nbsp;<span class="builtintype" id="5608866">int</span><span class="op" id="5608869">)</span>&nbsp;<span class="ident" id="5608871">color</span><span class="op" id="5608876">.</span><span class="ident" id="5608877">Alpha</span>&nbsp;<span class="op" id="5608883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608886">if</span>&nbsp;<span class="op" id="5608889">!</span><span class="op" id="5608890">(</span><span class="ident" id="5608891">Point</span><span class="op" id="5608896">{</span><span class="ident" id="5608897">x</span><span class="op" id="5608898">,</span>&nbsp;<span class="ident" id="5608900">y</span><span class="op" id="5608901">}</span><span class="op" id="5608902">.</span><span class="ident" id="5608903">In</span><span class="op" id="5608905">(</span><span class="ident" id="5608906">p</span><span class="op" id="5608907">.</span><span class="ident" id="5608908">Rect</span><span class="op" id="5608912">)</span><span class="op" id="5608913">)</span>&nbsp;<span class="op" id="5608915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608919">return</span>&nbsp;<span class="ident" id="5608926">color</span><span class="op" id="5608931">.</span><span class="ident" id="5608932">Alpha</span><span class="op" id="5608937">{</span><span class="op" id="5608938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608944">i</span>&nbsp;<span class="op" id="5608946">:=</span>&nbsp;<span class="ident" id="5608949">p</span><span class="op" id="5608950">.</span><span class="ident" id="5608951">PixOffset</span><span class="op" id="5608960">(</span><span class="ident" id="5608961">x</span><span class="op" id="5608962">,</span>&nbsp;<span class="ident" id="5608964">y</span><span class="op" id="5608965">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608968">return</span>&nbsp;<span class="ident" id="5608975">color</span><span class="op" id="5608980">.</span><span class="ident" id="5608981">Alpha</span><span class="op" id="5608986">{</span><span class="ident" id="5608987">p</span><span class="op" id="5608988">.</span><span class="ident" id="5608989">Pix</span><span class="op" id="5608992">[</span><span class="ident" id="5608993">i</span><span class="op" id="5608994">]</span><span class="op" id="5608995">}</span><br>
<span class="lineno"></span><span class="op" id="5608997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5609000">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5609079">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">510</span><span class="keyword" id="5609103">func</span>&nbsp;<span class="op" id="5609108">(</span><span class="ident" id="5609109">p</span>&nbsp;<span class="op" id="5609111">*</span><span class="ident" id="5609112">Alpha</span><span class="op" id="5609117">)</span>&nbsp;<span class="ident" id="5609119">PixOffset</span><span class="op" id="5609128">(</span><span class="ident" id="5609129">x</span><span class="op" id="5609130">,</span>&nbsp;<span class="ident" id="5609132">y</span>&nbsp;<span class="builtintype" id="5609134">int</span><span class="op" id="5609137">)</span>&nbsp;<span class="builtintype" id="5609139">int</span>&nbsp;<span class="op" id="5609143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5609146">return</span>&nbsp;<span class="op" id="5609153">(</span><span class="ident" id="5609154">y</span><span class="op" id="5609155">-</span><span class="ident" id="5609156">p</span><span class="op" id="5609157">.</span><span class="ident" id="5609158">Rect</span><span class="op" id="5609162">.</span><span class="ident" id="5609163">Min</span><span class="op" id="5609166">.</span><span class="ident" id="5609167">Y</span><span class="op" id="5609168">)</span><span class="op" id="5609169">*</span><span class="ident" id="5609170">p</span><span class="op" id="5609171">.</span><span class="ident" id="5609172">Stride</span>&nbsp;<span class="op" id="5609179">+</span>&nbsp;<span class="op" id="5609181">(</span><span class="ident" id="5609182">x</span><span class="op" id="5609183">-</span><span class="ident" id="5609184">p</span><span class="op" id="5609185">.</span><span class="ident" id="5609186">Rect</span><span class="op" id="5609190">.</span><span class="ident" id="5609191">Min</span><span class="op" id="5609194">.</span><span class="ident" id="5609195">X</span><span class="op" id="5609196">)</span><span class="op" id="5609197">*</span><span class="num" id="5609198">1</span><br>
<span class="lineno"></span><span class="op" id="5609200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5609203">func</span>&nbsp;<span class="op" id="5609208">(</span><span class="ident" id="5609209">p</span>&nbsp;<span class="op" id="5609211">*</span><span class="ident" id="5609212">Alpha</span><span class="op" id="5609217">)</span>&nbsp;<span class="ident" id="5609219">Set</span><span class="op" id="5609222">(</span><span class="ident" id="5609223">x</span><span class="op" id="5609224">,</span>&nbsp;<span class="ident" id="5609226">y</span>&nbsp;<span class="builtintype" id="5609228">int</span><span class="op" id="5609231">,</span>&nbsp;<span class="ident" id="5609233">c</span>&nbsp;<span class="ident" id="5609235">color</span><span class="op" id="5609240">.</span><span class="ident" id="5609241">Color</span><span class="op" id="5609246">)</span>&nbsp;<span class="op" id="5609248">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5609251">if</span>&nbsp;<span class="op" id="5609254">!</span><span class="op" id="5609255">(</span><span class="ident" id="5609256">Point</span><span class="op" id="5609261">{</span><span class="ident" id="5609262">x</span><span class="op" id="5609263">,</span>&nbsp;<span class="ident" id="5609265">y</span><span class="op" id="5609266">}</span><span class="op" id="5609267">.</span><span class="ident" id="5609268">In</span><span class="op" id="5609270">(</span><span class="ident" id="5609271">p</span><span class="op" id="5609272">.</span><span class="ident" id="5609273">Rect</span><span class="op" id="5609277">)</span><span class="op" id="5609278">)</span>&nbsp;<span class="op" id="5609280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5609284">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5609292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5609295">i</span>&nbsp;<span class="op" id="5609297">:=</span>&nbsp;<span class="ident" id="5609300">p</span><span class="op" id="5609301">.</span><span class="ident" id="5609302">PixOffset</span><span class="op" id="5609311">(</span><span class="ident" id="5609312">x</span><span class="op" id="5609313">,</span>&nbsp;<span class="ident" id="5609315">y</span><span class="op" id="5609316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5609319">p</span><span class="op" id="5609320">.</span><span class="ident" id="5609321">Pix</span><span class="op" id="5609324">[</span><span class="ident" id="5609325">i</span><span class="op" id="5609326">]</span>&nbsp;<span class="op" id="5609328">=</span>&nbsp;<span class="ident" id="5609330">color</span><span class="op" id="5609335">.</span><span class="ident" id="5609336">AlphaModel</span><span class="op" id="5609346">.</span><span class="ident" id="5609347">Convert</span><span class="op" id="5609354">(</span><span class="ident" id="5609355">c</span><span class="op" id="5609356">)</span><span class="op" id="5609357">.</span><span class="op" id="5609358">(</span><span class="ident" id="5609359">color</span><span class="op" id="5609364">.</span><span class="ident" id="5609365">Alpha</span><span class="op" id="5609370">)</span><span class="op" id="5609371">.</span><span class="ident" id="5609372">A</span><br>
<span class="lineno">520</span><span class="op" id="5609374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5609377">func</span>&nbsp;<span class="op" id="5609382">(</span><span class="ident" id="5609383">p</span>&nbsp;<span class="op" id="5609385">*</span><span class="ident" id="5609386">Alpha</span><span class="op" id="5609391">)</span>&nbsp;<span class="ident" id="5609393">SetAlpha</span><span class="op" id="5609401">(</span><span class="ident" id="5609402">x</span><span class="op" id="5609403">,</span>&nbsp;<span class="ident" id="5609405">y</span>&nbsp;<span class="builtintype" id="5609407">int</span><span class="op" id="5609410">,</span>&nbsp;<span class="ident" id="5609412">c</span>&nbsp;<span class="ident" id="5609414">color</span><span class="op" id="5609419">.</span><span class="ident" id="5609420">Alpha</span><span class="op" id="5609425">)</span>&nbsp;<span class="op" id="5609427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5609430">if</span>&nbsp;<span class="op" id="5609433">!</span><span class="op" id="5609434">(</span><span class="ident" id="5609435">Point</span><span class="op" id="5609440">{</span><span class="ident" id="5609441">x</span><span class="op" id="5609442">,</span>&nbsp;<span class="ident" id="5609444">y</span><span class="op" id="5609445">}</span><span class="op" id="5609446">.</span><span class="ident" id="5609447">In</span><span class="op" id="5609449">(</span><span class="ident" id="5609450">p</span><span class="op" id="5609451">.</span><span class="ident" id="5609452">Rect</span><span class="op" id="5609456">)</span><span class="op" id="5609457">)</span>&nbsp;<span class="op" id="5609459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5609463">return</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5609471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5609474">i</span>&nbsp;<span class="op" id="5609476">:=</span>&nbsp;<span class="ident" id="5609479">p</span><span class="op" id="5609480">.</span><span class="ident" id="5609481">PixOffset</span><span class="op" id="5609490">(</span><span class="ident" id="5609491">x</span><span class="op" id="5609492">,</span>&nbsp;<span class="ident" id="5609494">y</span><span class="op" id="5609495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5609498">p</span><span class="op" id="5609499">.</span><span class="ident" id="5609500">Pix</span><span class="op" id="5609503">[</span><span class="ident" id="5609504">i</span><span class="op" id="5609505">]</span>&nbsp;<span class="op" id="5609507">=</span>&nbsp;<span class="ident" id="5609509">c</span><span class="op" id="5609510">.</span><span class="ident" id="5609511">A</span><br>
<span class="lineno"></span><span class="op" id="5609513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="5609516">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5609593">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5609665">func</span>&nbsp;<span class="op" id="5609670">(</span><span class="ident" id="5609671">p</span>&nbsp;<span class="op" id="5609673">*</span><span class="ident" id="5609674">Alpha</span><span class="op" id="5609679">)</span>&nbsp;<span class="ident" id="5609681">SubImage</span><span class="op" id="5609689">(</span><span class="ident" id="5609690">r</span>&nbsp;<span class="ident" id="5609692">Rectangle</span><span class="op" id="5609701">)</span>&nbsp;<span class="ident" id="5609703">Image</span>&nbsp;<span class="op" id="5609709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5609712">r</span>&nbsp;<span class="op" id="5609714">=</span>&nbsp;<span class="ident" id="5609716">r</span><span class="op" id="5609717">.</span><span class="ident" id="5609718">Intersect</span><span class="op" id="5609727">(</span><span class="ident" id="5609728">p</span><span class="op" id="5609729">.</span><span class="ident" id="5609730">Rect</span><span class="op" id="5609734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5609737">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5609818">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5609900">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5609950">if</span>&nbsp;<span class="ident" id="5609953">r</span><span class="op" id="5609954">.</span><span class="ident" id="5609955">Empty</span><span class="op" id="5609960">(</span><span class="op" id="5609961">)</span>&nbsp;<span class="op" id="5609963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5609967">return</span>&nbsp;<span class="op" id="5609974">&amp;</span><span class="ident" id="5609975">Alpha</span><span class="op" id="5609980">{</span><span class="op" id="5609981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5609984">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5609987">i</span>&nbsp;<span class="op" id="5609989">:=</span>&nbsp;<span class="ident" id="5609992">p</span><span class="op" id="5609993">.</span><span class="ident" id="5609994">PixOffset</span><span class="op" id="5610003">(</span><span class="ident" id="5610004">r</span><span class="op" id="5610005">.</span><span class="ident" id="5610006">Min</span><span class="op" id="5610009">.</span><span class="ident" id="5610010">X</span><span class="op" id="5610011">,</span>&nbsp;<span class="ident" id="5610013">r</span><span class="op" id="5610014">.</span><span class="ident" id="5610015">Min</span><span class="op" id="5610018">.</span><span class="ident" id="5610019">Y</span><span class="op" id="5610020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5610023">return</span>&nbsp;<span class="op" id="5610030">&amp;</span><span class="ident" id="5610031">Alpha</span><span class="op" id="5610036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610040">Pix</span><span class="op" id="5610043">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610048">p</span><span class="op" id="5610049">.</span><span class="ident" id="5610050">Pix</span><span class="op" id="5610053">[</span><span class="ident" id="5610054">i</span><span class="op" id="5610055">:</span><span class="op" id="5610056">]</span><span class="op" id="5610057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610061">Stride</span><span class="op" id="5610067">:</span>&nbsp;<span class="ident" id="5610069">p</span><span class="op" id="5610070">.</span><span class="ident" id="5610071">Stride</span><span class="op" id="5610077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610081">Rect</span><span class="op" id="5610085">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5610089">r</span><span class="op" id="5610090">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5610093">}</span><br>
<span class="lineno"></span><span class="op" id="5610095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5610098">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5610171">func</span>&nbsp;<span class="op" id="5610176">(</span><span class="ident" id="5610177">p</span>&nbsp;<span class="op" id="5610179">*</span><span class="ident" id="5610180">Alpha</span><span class="op" id="5610185">)</span>&nbsp;<span class="ident" id="5610187">Opaque</span><span class="op" id="5610193">(</span><span class="op" id="5610194">)</span>&nbsp;<span class="builtintype" id="5610196">bool</span>&nbsp;<span class="op" id="5610201">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5610204">if</span>&nbsp;<span class="ident" id="5610207">p</span><span class="op" id="5610208">.</span><span class="ident" id="5610209">Rect</span><span class="op" id="5610213">.</span><span class="ident" id="5610214">Empty</span><span class="op" id="5610219">(</span><span class="op" id="5610220">)</span>&nbsp;<span class="op" id="5610222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5610226">return</span>&nbsp;<span class="builtintype" id="5610233">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5610239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610242">i0</span><span class="op" id="5610244">,</span>&nbsp;<span class="ident" id="5610246">i1</span>&nbsp;<span class="op" id="5610249">:=</span>&nbsp;<span class="num" id="5610252">0</span><span class="op" id="5610253">,</span>&nbsp;<span class="ident" id="5610255">p</span><span class="op" id="5610256">.</span><span class="ident" id="5610257">Rect</span><span class="op" id="5610261">.</span><span class="ident" id="5610262">Dx</span><span class="op" id="5610264">(</span><span class="op" id="5610265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5610268">for</span>&nbsp;<span class="ident" id="5610272">y</span>&nbsp;<span class="op" id="5610274">:=</span>&nbsp;<span class="ident" id="5610277">p</span><span class="op" id="5610278">.</span><span class="ident" id="5610279">Rect</span><span class="op" id="5610283">.</span><span class="ident" id="5610284">Min</span><span class="op" id="5610287">.</span><span class="ident" id="5610288">Y</span><span class="op" id="5610289">;</span>&nbsp;<span class="ident" id="5610291">y</span>&nbsp;<span class="op" id="5610293">&lt;</span>&nbsp;<span class="ident" id="5610295">p</span><span class="op" id="5610296">.</span><span class="ident" id="5610297">Rect</span><span class="op" id="5610301">.</span><span class="ident" id="5610302">Max</span><span class="op" id="5610305">.</span><span class="ident" id="5610306">Y</span><span class="op" id="5610307">;</span>&nbsp;<span class="ident" id="5610309">y</span><span class="op" id="5610310">++</span>&nbsp;<span class="op" id="5610313">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5610317">for</span>&nbsp;<span class="ident" id="5610321">i</span>&nbsp;<span class="op" id="5610323">:=</span>&nbsp;<span class="ident" id="5610326">i0</span><span class="op" id="5610328">;</span>&nbsp;<span class="ident" id="5610330">i</span>&nbsp;<span class="op" id="5610332">&lt;</span>&nbsp;<span class="ident" id="5610334">i1</span><span class="op" id="5610336">;</span>&nbsp;<span class="ident" id="5610338">i</span><span class="op" id="5610339">++</span>&nbsp;<span class="op" id="5610342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5610347">if</span>&nbsp;<span class="ident" id="5610350">p</span><span class="op" id="5610351">.</span><span class="ident" id="5610352">Pix</span><span class="op" id="5610355">[</span><span class="ident" id="5610356">i</span><span class="op" id="5610357">]</span>&nbsp;<span class="op" id="5610359">!=</span>&nbsp;<span class="num" id="5610362">0xff</span>&nbsp;<span class="op" id="5610367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5610373">return</span>&nbsp;<span class="builtintype" id="5610380">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5610389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5610393">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610397">i0</span>&nbsp;<span class="op" id="5610400">+=</span>&nbsp;<span class="ident" id="5610403">p</span><span class="op" id="5610404">.</span><span class="ident" id="5610405">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610414">i1</span>&nbsp;<span class="op" id="5610417">+=</span>&nbsp;<span class="ident" id="5610420">p</span><span class="op" id="5610421">.</span><span class="ident" id="5610422">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5610430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5610433">return</span>&nbsp;<span class="builtintype" id="5610440">true</span><br>
<span class="lineno"></span><span class="op" id="5610445">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5610448">//&nbsp;NewAlpha&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5610503">func</span>&nbsp;<span class="ident" id="5610508">NewAlpha</span><span class="op" id="5610516">(</span><span class="ident" id="5610517">r</span>&nbsp;<span class="ident" id="5610519">Rectangle</span><span class="op" id="5610528">)</span>&nbsp;<span class="op" id="5610530">*</span><span class="ident" id="5610531">Alpha</span>&nbsp;<span class="op" id="5610537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610540">w</span><span class="op" id="5610541">,</span>&nbsp;<span class="ident" id="5610543">h</span>&nbsp;<span class="op" id="5610545">:=</span>&nbsp;<span class="ident" id="5610548">r</span><span class="op" id="5610549">.</span><span class="ident" id="5610550">Dx</span><span class="op" id="5610552">(</span><span class="op" id="5610553">)</span><span class="op" id="5610554">,</span>&nbsp;<span class="ident" id="5610556">r</span><span class="op" id="5610557">.</span><span class="ident" id="5610558">Dy</span><span class="op" id="5610560">(</span><span class="op" id="5610561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610564">pix</span>&nbsp;<span class="op" id="5610568">:=</span>&nbsp;<span class="builtinfunc" id="5610571">make</span><span class="op" id="5610575">(</span><span class="op" id="5610576">[</span><span class="op" id="5610577">]</span><span class="builtintype" id="5610578">uint8</span><span class="op" id="5610583">,</span>&nbsp;<span class="num" id="5610585">1</span><span class="op" id="5610586">*</span><span class="ident" id="5610587">w</span><span class="op" id="5610588">*</span><span class="ident" id="5610589">h</span><span class="op" id="5610590">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5610593">return</span>&nbsp;<span class="op" id="5610600">&amp;</span><span class="ident" id="5610601">Alpha</span><span class="op" id="5610606">{</span><span class="ident" id="5610607">pix</span><span class="op" id="5610610">,</span>&nbsp;<span class="num" id="5610612">1</span>&nbsp;<span class="op" id="5610614">*</span>&nbsp;<span class="ident" id="5610616">w</span><span class="op" id="5610617">,</span>&nbsp;<span class="ident" id="5610619">r</span><span class="op" id="5610620">}</span><br>
<span class="lineno"></span><span class="op" id="5610622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5610625">//&nbsp;Alpha16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5610704">type</span>&nbsp;<span class="ident" id="5610709">Alpha16</span>&nbsp;<span class="keyword" id="5610717">struct</span>&nbsp;<span class="op" id="5610724">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5610727">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5610812">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610880">Pix</span>&nbsp;<span class="op" id="5610884">[</span><span class="op" id="5610885">]</span><span class="builtintype" id="5610886">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5610893">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610969">Stride</span>&nbsp;<span class="builtintype" id="5610976">int</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5610981">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611013">Rect</span>&nbsp;<span class="ident" id="5611018">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5611028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5611031">func</span>&nbsp;<span class="op" id="5611036">(</span><span class="ident" id="5611037">p</span>&nbsp;<span class="op" id="5611039">*</span><span class="ident" id="5611040">Alpha16</span><span class="op" id="5611047">)</span>&nbsp;<span class="ident" id="5611049">ColorModel</span><span class="op" id="5611059">(</span><span class="op" id="5611060">)</span>&nbsp;<span class="ident" id="5611062">color</span><span class="op" id="5611067">.</span><span class="ident" id="5611068">Model</span>&nbsp;<span class="op" id="5611074">{</span>&nbsp;<span class="keyword" id="5611076">return</span>&nbsp;<span class="ident" id="5611083">color</span><span class="op" id="5611088">.</span><span class="ident" id="5611089">Alpha16Model</span>&nbsp;<span class="op" id="5611102">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="keyword" id="5611105">func</span>&nbsp;<span class="op" id="5611110">(</span><span class="ident" id="5611111">p</span>&nbsp;<span class="op" id="5611113">*</span><span class="ident" id="5611114">Alpha16</span><span class="op" id="5611121">)</span>&nbsp;<span class="ident" id="5611123">Bounds</span><span class="op" id="5611129">(</span><span class="op" id="5611130">)</span>&nbsp;<span class="ident" id="5611132">Rectangle</span>&nbsp;<span class="op" id="5611142">{</span>&nbsp;<span class="keyword" id="5611144">return</span>&nbsp;<span class="ident" id="5611151">p</span><span class="op" id="5611152">.</span><span class="ident" id="5611153">Rect</span>&nbsp;<span class="op" id="5611158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5611161">func</span>&nbsp;<span class="op" id="5611166">(</span><span class="ident" id="5611167">p</span>&nbsp;<span class="op" id="5611169">*</span><span class="ident" id="5611170">Alpha16</span><span class="op" id="5611177">)</span>&nbsp;<span class="ident" id="5611179">At</span><span class="op" id="5611181">(</span><span class="ident" id="5611182">x</span><span class="op" id="5611183">,</span>&nbsp;<span class="ident" id="5611185">y</span>&nbsp;<span class="builtintype" id="5611187">int</span><span class="op" id="5611190">)</span>&nbsp;<span class="ident" id="5611192">color</span><span class="op" id="5611197">.</span><span class="ident" id="5611198">Color</span>&nbsp;<span class="op" id="5611204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5611207">return</span>&nbsp;<span class="ident" id="5611214">p</span><span class="op" id="5611215">.</span><span class="ident" id="5611216">Alpha16At</span><span class="op" id="5611225">(</span><span class="ident" id="5611226">x</span><span class="op" id="5611227">,</span>&nbsp;<span class="ident" id="5611229">y</span><span class="op" id="5611230">)</span><br>
<span class="lineno">590</span><span class="op" id="5611232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5611235">func</span>&nbsp;<span class="op" id="5611240">(</span><span class="ident" id="5611241">p</span>&nbsp;<span class="op" id="5611243">*</span><span class="ident" id="5611244">Alpha16</span><span class="op" id="5611251">)</span>&nbsp;<span class="ident" id="5611253">Alpha16At</span><span class="op" id="5611262">(</span><span class="ident" id="5611263">x</span><span class="op" id="5611264">,</span>&nbsp;<span class="ident" id="5611266">y</span>&nbsp;<span class="builtintype" id="5611268">int</span><span class="op" id="5611271">)</span>&nbsp;<span class="ident" id="5611273">color</span><span class="op" id="5611278">.</span><span class="ident" id="5611279">Alpha16</span>&nbsp;<span class="op" id="5611287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5611290">if</span>&nbsp;<span class="op" id="5611293">!</span><span class="op" id="5611294">(</span><span class="ident" id="5611295">Point</span><span class="op" id="5611300">{</span><span class="ident" id="5611301">x</span><span class="op" id="5611302">,</span>&nbsp;<span class="ident" id="5611304">y</span><span class="op" id="5611305">}</span><span class="op" id="5611306">.</span><span class="ident" id="5611307">In</span><span class="op" id="5611309">(</span><span class="ident" id="5611310">p</span><span class="op" id="5611311">.</span><span class="ident" id="5611312">Rect</span><span class="op" id="5611316">)</span><span class="op" id="5611317">)</span>&nbsp;<span class="op" id="5611319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5611323">return</span>&nbsp;<span class="ident" id="5611330">color</span><span class="op" id="5611335">.</span><span class="ident" id="5611336">Alpha16</span><span class="op" id="5611343">{</span><span class="op" id="5611344">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5611347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611350">i</span>&nbsp;<span class="op" id="5611352">:=</span>&nbsp;<span class="ident" id="5611355">p</span><span class="op" id="5611356">.</span><span class="ident" id="5611357">PixOffset</span><span class="op" id="5611366">(</span><span class="ident" id="5611367">x</span><span class="op" id="5611368">,</span>&nbsp;<span class="ident" id="5611370">y</span><span class="op" id="5611371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5611374">return</span>&nbsp;<span class="ident" id="5611381">color</span><span class="op" id="5611386">.</span><span class="ident" id="5611387">Alpha16</span><span class="op" id="5611394">{</span><span class="builtintype" id="5611395">uint16</span><span class="op" id="5611401">(</span><span class="ident" id="5611402">p</span><span class="op" id="5611403">.</span><span class="ident" id="5611404">Pix</span><span class="op" id="5611407">[</span><span class="ident" id="5611408">i</span><span class="op" id="5611409">+</span><span class="num" id="5611410">0</span><span class="op" id="5611411">]</span><span class="op" id="5611412">)</span><span class="op" id="5611413">&lt;&lt;</span><span class="num" id="5611415">8</span>&nbsp;<span class="op" id="5611417">|</span>&nbsp;<span class="builtintype" id="5611419">uint16</span><span class="op" id="5611425">(</span><span class="ident" id="5611426">p</span><span class="op" id="5611427">.</span><span class="ident" id="5611428">Pix</span><span class="op" id="5611431">[</span><span class="ident" id="5611432">i</span><span class="op" id="5611433">+</span><span class="num" id="5611434">1</span><span class="op" id="5611435">]</span><span class="op" id="5611436">)</span><span class="op" id="5611437">}</span><br>
<span class="lineno"></span><span class="op" id="5611439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="5611442">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5611521">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5611545">func</span>&nbsp;<span class="op" id="5611550">(</span><span class="ident" id="5611551">p</span>&nbsp;<span class="op" id="5611553">*</span><span class="ident" id="5611554">Alpha16</span><span class="op" id="5611561">)</span>&nbsp;<span class="ident" id="5611563">PixOffset</span><span class="op" id="5611572">(</span><span class="ident" id="5611573">x</span><span class="op" id="5611574">,</span>&nbsp;<span class="ident" id="5611576">y</span>&nbsp;<span class="builtintype" id="5611578">int</span><span class="op" id="5611581">)</span>&nbsp;<span class="builtintype" id="5611583">int</span>&nbsp;<span class="op" id="5611587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5611590">return</span>&nbsp;<span class="op" id="5611597">(</span><span class="ident" id="5611598">y</span><span class="op" id="5611599">-</span><span class="ident" id="5611600">p</span><span class="op" id="5611601">.</span><span class="ident" id="5611602">Rect</span><span class="op" id="5611606">.</span><span class="ident" id="5611607">Min</span><span class="op" id="5611610">.</span><span class="ident" id="5611611">Y</span><span class="op" id="5611612">)</span><span class="op" id="5611613">*</span><span class="ident" id="5611614">p</span><span class="op" id="5611615">.</span><span class="ident" id="5611616">Stride</span>&nbsp;<span class="op" id="5611623">+</span>&nbsp;<span class="op" id="5611625">(</span><span class="ident" id="5611626">x</span><span class="op" id="5611627">-</span><span class="ident" id="5611628">p</span><span class="op" id="5611629">.</span><span class="ident" id="5611630">Rect</span><span class="op" id="5611634">.</span><span class="ident" id="5611635">Min</span><span class="op" id="5611638">.</span><span class="ident" id="5611639">X</span><span class="op" id="5611640">)</span><span class="op" id="5611641">*</span><span class="num" id="5611642">2</span><br>
<span class="lineno"></span><span class="op" id="5611644">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="keyword" id="5611647">func</span>&nbsp;<span class="op" id="5611652">(</span><span class="ident" id="5611653">p</span>&nbsp;<span class="op" id="5611655">*</span><span class="ident" id="5611656">Alpha16</span><span class="op" id="5611663">)</span>&nbsp;<span class="ident" id="5611665">Set</span><span class="op" id="5611668">(</span><span class="ident" id="5611669">x</span><span class="op" id="5611670">,</span>&nbsp;<span class="ident" id="5611672">y</span>&nbsp;<span class="builtintype" id="5611674">int</span><span class="op" id="5611677">,</span>&nbsp;<span class="ident" id="5611679">c</span>&nbsp;<span class="ident" id="5611681">color</span><span class="op" id="5611686">.</span><span class="ident" id="5611687">Color</span><span class="op" id="5611692">)</span>&nbsp;<span class="op" id="5611694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5611697">if</span>&nbsp;<span class="op" id="5611700">!</span><span class="op" id="5611701">(</span><span class="ident" id="5611702">Point</span><span class="op" id="5611707">{</span><span class="ident" id="5611708">x</span><span class="op" id="5611709">,</span>&nbsp;<span class="ident" id="5611711">y</span><span class="op" id="5611712">}</span><span class="op" id="5611713">.</span><span class="ident" id="5611714">In</span><span class="op" id="5611716">(</span><span class="ident" id="5611717">p</span><span class="op" id="5611718">.</span><span class="ident" id="5611719">Rect</span><span class="op" id="5611723">)</span><span class="op" id="5611724">)</span>&nbsp;<span class="op" id="5611726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5611730">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5611738">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611741">i</span>&nbsp;<span class="op" id="5611743">:=</span>&nbsp;<span class="ident" id="5611746">p</span><span class="op" id="5611747">.</span><span class="ident" id="5611748">PixOffset</span><span class="op" id="5611757">(</span><span class="ident" id="5611758">x</span><span class="op" id="5611759">,</span>&nbsp;<span class="ident" id="5611761">y</span><span class="op" id="5611762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611765">c1</span>&nbsp;<span class="op" id="5611768">:=</span>&nbsp;<span class="ident" id="5611771">color</span><span class="op" id="5611776">.</span><span class="ident" id="5611777">Alpha16Model</span><span class="op" id="5611789">.</span><span class="ident" id="5611790">Convert</span><span class="op" id="5611797">(</span><span class="ident" id="5611798">c</span><span class="op" id="5611799">)</span><span class="op" id="5611800">.</span><span class="op" id="5611801">(</span><span class="ident" id="5611802">color</span><span class="op" id="5611807">.</span><span class="ident" id="5611808">Alpha16</span><span class="op" id="5611815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611818">p</span><span class="op" id="5611819">.</span><span class="ident" id="5611820">Pix</span><span class="op" id="5611823">[</span><span class="ident" id="5611824">i</span><span class="op" id="5611825">+</span><span class="num" id="5611826">0</span><span class="op" id="5611827">]</span>&nbsp;<span class="op" id="5611829">=</span>&nbsp;<span class="builtintype" id="5611831">uint8</span><span class="op" id="5611836">(</span><span class="ident" id="5611837">c1</span><span class="op" id="5611839">.</span><span class="ident" id="5611840">A</span>&nbsp;<span class="op" id="5611842">&gt;&gt;</span>&nbsp;<span class="num" id="5611845">8</span><span class="op" id="5611846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611849">p</span><span class="op" id="5611850">.</span><span class="ident" id="5611851">Pix</span><span class="op" id="5611854">[</span><span class="ident" id="5611855">i</span><span class="op" id="5611856">+</span><span class="num" id="5611857">1</span><span class="op" id="5611858">]</span>&nbsp;<span class="op" id="5611860">=</span>&nbsp;<span class="builtintype" id="5611862">uint8</span><span class="op" id="5611867">(</span><span class="ident" id="5611868">c1</span><span class="op" id="5611870">.</span><span class="ident" id="5611871">A</span><span class="op" id="5611872">)</span><br>
<span class="lineno"></span><span class="op" id="5611874">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="5611877">func</span>&nbsp;<span class="op" id="5611882">(</span><span class="ident" id="5611883">p</span>&nbsp;<span class="op" id="5611885">*</span><span class="ident" id="5611886">Alpha16</span><span class="op" id="5611893">)</span>&nbsp;<span class="ident" id="5611895">SetAlpha16</span><span class="op" id="5611905">(</span><span class="ident" id="5611906">x</span><span class="op" id="5611907">,</span>&nbsp;<span class="ident" id="5611909">y</span>&nbsp;<span class="builtintype" id="5611911">int</span><span class="op" id="5611914">,</span>&nbsp;<span class="ident" id="5611916">c</span>&nbsp;<span class="ident" id="5611918">color</span><span class="op" id="5611923">.</span><span class="ident" id="5611924">Alpha16</span><span class="op" id="5611931">)</span>&nbsp;<span class="op" id="5611933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5611936">if</span>&nbsp;<span class="op" id="5611939">!</span><span class="op" id="5611940">(</span><span class="ident" id="5611941">Point</span><span class="op" id="5611946">{</span><span class="ident" id="5611947">x</span><span class="op" id="5611948">,</span>&nbsp;<span class="ident" id="5611950">y</span><span class="op" id="5611951">}</span><span class="op" id="5611952">.</span><span class="ident" id="5611953">In</span><span class="op" id="5611955">(</span><span class="ident" id="5611956">p</span><span class="op" id="5611957">.</span><span class="ident" id="5611958">Rect</span><span class="op" id="5611962">)</span><span class="op" id="5611963">)</span>&nbsp;<span class="op" id="5611965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5611969">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5611977">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611980">i</span>&nbsp;<span class="op" id="5611982">:=</span>&nbsp;<span class="ident" id="5611985">p</span><span class="op" id="5611986">.</span><span class="ident" id="5611987">PixOffset</span><span class="op" id="5611996">(</span><span class="ident" id="5611997">x</span><span class="op" id="5611998">,</span>&nbsp;<span class="ident" id="5612000">y</span><span class="op" id="5612001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5612004">p</span><span class="op" id="5612005">.</span><span class="ident" id="5612006">Pix</span><span class="op" id="5612009">[</span><span class="ident" id="5612010">i</span><span class="op" id="5612011">+</span><span class="num" id="5612012">0</span><span class="op" id="5612013">]</span>&nbsp;<span class="op" id="5612015">=</span>&nbsp;<span class="builtintype" id="5612017">uint8</span><span class="op" id="5612022">(</span><span class="ident" id="5612023">c</span><span class="op" id="5612024">.</span><span class="ident" id="5612025">A</span>&nbsp;<span class="op" id="5612027">&gt;&gt;</span>&nbsp;<span class="num" id="5612030">8</span><span class="op" id="5612031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5612034">p</span><span class="op" id="5612035">.</span><span class="ident" id="5612036">Pix</span><span class="op" id="5612039">[</span><span class="ident" id="5612040">i</span><span class="op" id="5612041">+</span><span class="num" id="5612042">1</span><span class="op" id="5612043">]</span>&nbsp;<span class="op" id="5612045">=</span>&nbsp;<span class="builtintype" id="5612047">uint8</span><span class="op" id="5612052">(</span><span class="ident" id="5612053">c</span><span class="op" id="5612054">.</span><span class="ident" id="5612055">A</span><span class="op" id="5612056">)</span><br>
<span class="lineno"></span><span class="op" id="5612058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="5612061">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5612138">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5612210">func</span>&nbsp;<span class="op" id="5612215">(</span><span class="ident" id="5612216">p</span>&nbsp;<span class="op" id="5612218">*</span><span class="ident" id="5612219">Alpha16</span><span class="op" id="5612226">)</span>&nbsp;<span class="ident" id="5612228">SubImage</span><span class="op" id="5612236">(</span><span class="ident" id="5612237">r</span>&nbsp;<span class="ident" id="5612239">Rectangle</span><span class="op" id="5612248">)</span>&nbsp;<span class="ident" id="5612250">Image</span>&nbsp;<span class="op" id="5612256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5612259">r</span>&nbsp;<span class="op" id="5612261">=</span>&nbsp;<span class="ident" id="5612263">r</span><span class="op" id="5612264">.</span><span class="ident" id="5612265">Intersect</span><span class="op" id="5612274">(</span><span class="ident" id="5612275">p</span><span class="op" id="5612276">.</span><span class="ident" id="5612277">Rect</span><span class="op" id="5612281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5612284">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5612365">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5612447">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5612497">if</span>&nbsp;<span class="ident" id="5612500">r</span><span class="op" id="5612501">.</span><span class="ident" id="5612502">Empty</span><span class="op" id="5612507">(</span><span class="op" id="5612508">)</span>&nbsp;<span class="op" id="5612510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5612514">return</span>&nbsp;<span class="op" id="5612521">&amp;</span><span class="ident" id="5612522">Alpha16</span><span class="op" id="5612529">{</span><span class="op" id="5612530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612533">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5612536">i</span>&nbsp;<span class="op" id="5612538">:=</span>&nbsp;<span class="ident" id="5612541">p</span><span class="op" id="5612542">.</span><span class="ident" id="5612543">PixOffset</span><span class="op" id="5612552">(</span><span class="ident" id="5612553">r</span><span class="op" id="5612554">.</span><span class="ident" id="5612555">Min</span><span class="op" id="5612558">.</span><span class="ident" id="5612559">X</span><span class="op" id="5612560">,</span>&nbsp;<span class="ident" id="5612562">r</span><span class="op" id="5612563">.</span><span class="ident" id="5612564">Min</span><span class="op" id="5612567">.</span><span class="ident" id="5612568">Y</span><span class="op" id="5612569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5612572">return</span>&nbsp;<span class="op" id="5612579">&amp;</span><span class="ident" id="5612580">Alpha16</span><span class="op" id="5612587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5612591">Pix</span><span class="op" id="5612594">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5612599">p</span><span class="op" id="5612600">.</span><span class="ident" id="5612601">Pix</span><span class="op" id="5612604">[</span><span class="ident" id="5612605">i</span><span class="op" id="5612606">:</span><span class="op" id="5612607">]</span><span class="op" id="5612608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5612612">Stride</span><span class="op" id="5612618">:</span>&nbsp;<span class="ident" id="5612620">p</span><span class="op" id="5612621">.</span><span class="ident" id="5612622">Stride</span><span class="op" id="5612628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5612632">Rect</span><span class="op" id="5612636">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5612640">r</span><span class="op" id="5612641">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612644">}</span><br>
<span class="lineno"></span><span class="op" id="5612646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5612649">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5612722">func</span>&nbsp;<span class="op" id="5612727">(</span><span class="ident" id="5612728">p</span>&nbsp;<span class="op" id="5612730">*</span><span class="ident" id="5612731">Alpha16</span><span class="op" id="5612738">)</span>&nbsp;<span class="ident" id="5612740">Opaque</span><span class="op" id="5612746">(</span><span class="op" id="5612747">)</span>&nbsp;<span class="builtintype" id="5612749">bool</span>&nbsp;<span class="op" id="5612754">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5612757">if</span>&nbsp;<span class="ident" id="5612760">p</span><span class="op" id="5612761">.</span><span class="ident" id="5612762">Rect</span><span class="op" id="5612766">.</span><span class="ident" id="5612767">Empty</span><span class="op" id="5612772">(</span><span class="op" id="5612773">)</span>&nbsp;<span class="op" id="5612775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5612779">return</span>&nbsp;<span class="builtintype" id="5612786">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5612795">i0</span><span class="op" id="5612797">,</span>&nbsp;<span class="ident" id="5612799">i1</span>&nbsp;<span class="op" id="5612802">:=</span>&nbsp;<span class="num" id="5612805">0</span><span class="op" id="5612806">,</span>&nbsp;<span class="ident" id="5612808">p</span><span class="op" id="5612809">.</span><span class="ident" id="5612810">Rect</span><span class="op" id="5612814">.</span><span class="ident" id="5612815">Dx</span><span class="op" id="5612817">(</span><span class="op" id="5612818">)</span><span class="op" id="5612819">*</span><span class="num" id="5612820">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5612823">for</span>&nbsp;<span class="ident" id="5612827">y</span>&nbsp;<span class="op" id="5612829">:=</span>&nbsp;<span class="ident" id="5612832">p</span><span class="op" id="5612833">.</span><span class="ident" id="5612834">Rect</span><span class="op" id="5612838">.</span><span class="ident" id="5612839">Min</span><span class="op" id="5612842">.</span><span class="ident" id="5612843">Y</span><span class="op" id="5612844">;</span>&nbsp;<span class="ident" id="5612846">y</span>&nbsp;<span class="op" id="5612848">&lt;</span>&nbsp;<span class="ident" id="5612850">p</span><span class="op" id="5612851">.</span><span class="ident" id="5612852">Rect</span><span class="op" id="5612856">.</span><span class="ident" id="5612857">Max</span><span class="op" id="5612860">.</span><span class="ident" id="5612861">Y</span><span class="op" id="5612862">;</span>&nbsp;<span class="ident" id="5612864">y</span><span class="op" id="5612865">++</span>&nbsp;<span class="op" id="5612868">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5612872">for</span>&nbsp;<span class="ident" id="5612876">i</span>&nbsp;<span class="op" id="5612878">:=</span>&nbsp;<span class="ident" id="5612881">i0</span><span class="op" id="5612883">;</span>&nbsp;<span class="ident" id="5612885">i</span>&nbsp;<span class="op" id="5612887">&lt;</span>&nbsp;<span class="ident" id="5612889">i1</span><span class="op" id="5612891">;</span>&nbsp;<span class="ident" id="5612893">i</span>&nbsp;<span class="op" id="5612895">+=</span>&nbsp;<span class="num" id="5612898">2</span>&nbsp;<span class="op" id="5612900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5612905">if</span>&nbsp;<span class="ident" id="5612908">p</span><span class="op" id="5612909">.</span><span class="ident" id="5612910">Pix</span><span class="op" id="5612913">[</span><span class="ident" id="5612914">i</span><span class="op" id="5612915">+</span><span class="num" id="5612916">0</span><span class="op" id="5612917">]</span>&nbsp;<span class="op" id="5612919">!=</span>&nbsp;<span class="num" id="5612922">0xff</span>&nbsp;<span class="op" id="5612927">||</span>&nbsp;<span class="ident" id="5612930">p</span><span class="op" id="5612931">.</span><span class="ident" id="5612932">Pix</span><span class="op" id="5612935">[</span><span class="ident" id="5612936">i</span><span class="op" id="5612937">+</span><span class="num" id="5612938">1</span><span class="op" id="5612939">]</span>&nbsp;<span class="op" id="5612941">!=</span>&nbsp;<span class="num" id="5612944">0xff</span>&nbsp;<span class="op" id="5612949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5612955">return</span>&nbsp;<span class="builtintype" id="5612962">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612975">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5612979">i0</span>&nbsp;<span class="op" id="5612982">+=</span>&nbsp;<span class="ident" id="5612985">p</span><span class="op" id="5612986">.</span><span class="ident" id="5612987">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5612996">i1</span>&nbsp;<span class="op" id="5612999">+=</span>&nbsp;<span class="ident" id="5613002">p</span><span class="op" id="5613003">.</span><span class="ident" id="5613004">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5613012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5613015">return</span>&nbsp;<span class="builtintype" id="5613022">true</span><br>
<span class="lineno"></span><span class="op" id="5613027">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="5613030">//&nbsp;NewAlpha16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5613089">func</span>&nbsp;<span class="ident" id="5613094">NewAlpha16</span><span class="op" id="5613104">(</span><span class="ident" id="5613105">r</span>&nbsp;<span class="ident" id="5613107">Rectangle</span><span class="op" id="5613116">)</span>&nbsp;<span class="op" id="5613118">*</span><span class="ident" id="5613119">Alpha16</span>&nbsp;<span class="op" id="5613127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5613130">w</span><span class="op" id="5613131">,</span>&nbsp;<span class="ident" id="5613133">h</span>&nbsp;<span class="op" id="5613135">:=</span>&nbsp;<span class="ident" id="5613138">r</span><span class="op" id="5613139">.</span><span class="ident" id="5613140">Dx</span><span class="op" id="5613142">(</span><span class="op" id="5613143">)</span><span class="op" id="5613144">,</span>&nbsp;<span class="ident" id="5613146">r</span><span class="op" id="5613147">.</span><span class="ident" id="5613148">Dy</span><span class="op" id="5613150">(</span><span class="op" id="5613151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5613154">pix</span>&nbsp;<span class="op" id="5613158">:=</span>&nbsp;<span class="builtinfunc" id="5613161">make</span><span class="op" id="5613165">(</span><span class="op" id="5613166">[</span><span class="op" id="5613167">]</span><span class="builtintype" id="5613168">uint8</span><span class="op" id="5613173">,</span>&nbsp;<span class="num" id="5613175">2</span><span class="op" id="5613176">*</span><span class="ident" id="5613177">w</span><span class="op" id="5613178">*</span><span class="ident" id="5613179">h</span><span class="op" id="5613180">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5613183">return</span>&nbsp;<span class="op" id="5613190">&amp;</span><span class="ident" id="5613191">Alpha16</span><span class="op" id="5613198">{</span><span class="ident" id="5613199">pix</span><span class="op" id="5613202">,</span>&nbsp;<span class="num" id="5613204">2</span>&nbsp;<span class="op" id="5613206">*</span>&nbsp;<span class="ident" id="5613208">w</span><span class="op" id="5613209">,</span>&nbsp;<span class="ident" id="5613211">r</span><span class="op" id="5613212">}</span><br>
<span class="lineno"></span><span class="op" id="5613214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5613217">//&nbsp;Gray&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5613290">type</span>&nbsp;<span class="ident" id="5613295">Gray</span>&nbsp;<span class="keyword" id="5613300">struct</span>&nbsp;<span class="op" id="5613307">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5613310">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5613373">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5613441">Pix</span>&nbsp;<span class="op" id="5613445">[</span><span class="op" id="5613446">]</span><span class="builtintype" id="5613447">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5613454">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5613530">Stride</span>&nbsp;<span class="builtintype" id="5613537">int</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5613542">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5613574">Rect</span>&nbsp;<span class="ident" id="5613579">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5613589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5613592">func</span>&nbsp;<span class="op" id="5613597">(</span><span class="ident" id="5613598">p</span>&nbsp;<span class="op" id="5613600">*</span><span class="ident" id="5613601">Gray</span><span class="op" id="5613605">)</span>&nbsp;<span class="ident" id="5613607">ColorModel</span><span class="op" id="5613617">(</span><span class="op" id="5613618">)</span>&nbsp;<span class="ident" id="5613620">color</span><span class="op" id="5613625">.</span><span class="ident" id="5613626">Model</span>&nbsp;<span class="op" id="5613632">{</span>&nbsp;<span class="keyword" id="5613634">return</span>&nbsp;<span class="ident" id="5613641">color</span><span class="op" id="5613646">.</span><span class="ident" id="5613647">GrayModel</span>&nbsp;<span class="op" id="5613657">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="5613660">func</span>&nbsp;<span class="op" id="5613665">(</span><span class="ident" id="5613666">p</span>&nbsp;<span class="op" id="5613668">*</span><span class="ident" id="5613669">Gray</span><span class="op" id="5613673">)</span>&nbsp;<span class="ident" id="5613675">Bounds</span><span class="op" id="5613681">(</span><span class="op" id="5613682">)</span>&nbsp;<span class="ident" id="5613684">Rectangle</span>&nbsp;<span class="op" id="5613694">{</span>&nbsp;<span class="keyword" id="5613696">return</span>&nbsp;<span class="ident" id="5613703">p</span><span class="op" id="5613704">.</span><span class="ident" id="5613705">Rect</span>&nbsp;<span class="op" id="5613710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5613713">func</span>&nbsp;<span class="op" id="5613718">(</span><span class="ident" id="5613719">p</span>&nbsp;<span class="op" id="5613721">*</span><span class="ident" id="5613722">Gray</span><span class="op" id="5613726">)</span>&nbsp;<span class="ident" id="5613728">At</span><span class="op" id="5613730">(</span><span class="ident" id="5613731">x</span><span class="op" id="5613732">,</span>&nbsp;<span class="ident" id="5613734">y</span>&nbsp;<span class="builtintype" id="5613736">int</span><span class="op" id="5613739">)</span>&nbsp;<span class="ident" id="5613741">color</span><span class="op" id="5613746">.</span><span class="ident" id="5613747">Color</span>&nbsp;<span class="op" id="5613753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5613756">return</span>&nbsp;<span class="ident" id="5613763">p</span><span class="op" id="5613764">.</span><span class="ident" id="5613765">GrayAt</span><span class="op" id="5613771">(</span><span class="ident" id="5613772">x</span><span class="op" id="5613773">,</span>&nbsp;<span class="ident" id="5613775">y</span><span class="op" id="5613776">)</span><br>
<span class="lineno">685</span><span class="op" id="5613778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5613781">func</span>&nbsp;<span class="op" id="5613786">(</span><span class="ident" id="5613787">p</span>&nbsp;<span class="op" id="5613789">*</span><span class="ident" id="5613790">Gray</span><span class="op" id="5613794">)</span>&nbsp;<span class="ident" id="5613796">GrayAt</span><span class="op" id="5613802">(</span><span class="ident" id="5613803">x</span><span class="op" id="5613804">,</span>&nbsp;<span class="ident" id="5613806">y</span>&nbsp;<span class="builtintype" id="5613808">int</span><span class="op" id="5613811">)</span>&nbsp;<span class="ident" id="5613813">color</span><span class="op" id="5613818">.</span><span class="ident" id="5613819">Gray</span>&nbsp;<span class="op" id="5613824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5613827">if</span>&nbsp;<span class="op" id="5613830">!</span><span class="op" id="5613831">(</span><span class="ident" id="5613832">Point</span><span class="op" id="5613837">{</span><span class="ident" id="5613838">x</span><span class="op" id="5613839">,</span>&nbsp;<span class="ident" id="5613841">y</span><span class="op" id="5613842">}</span><span class="op" id="5613843">.</span><span class="ident" id="5613844">In</span><span class="op" id="5613846">(</span><span class="ident" id="5613847">p</span><span class="op" id="5613848">.</span><span class="ident" id="5613849">Rect</span><span class="op" id="5613853">)</span><span class="op" id="5613854">)</span>&nbsp;<span class="op" id="5613856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5613860">return</span>&nbsp;<span class="ident" id="5613867">color</span><span class="op" id="5613872">.</span><span class="ident" id="5613873">Gray</span><span class="op" id="5613877">{</span><span class="op" id="5613878">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5613881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5613884">i</span>&nbsp;<span class="op" id="5613886">:=</span>&nbsp;<span class="ident" id="5613889">p</span><span class="op" id="5613890">.</span><span class="ident" id="5613891">PixOffset</span><span class="op" id="5613900">(</span><span class="ident" id="5613901">x</span><span class="op" id="5613902">,</span>&nbsp;<span class="ident" id="5613904">y</span><span class="op" id="5613905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5613908">return</span>&nbsp;<span class="ident" id="5613915">color</span><span class="op" id="5613920">.</span><span class="ident" id="5613921">Gray</span><span class="op" id="5613925">{</span><span class="ident" id="5613926">p</span><span class="op" id="5613927">.</span><span class="ident" id="5613928">Pix</span><span class="op" id="5613931">[</span><span class="ident" id="5613932">i</span><span class="op" id="5613933">]</span><span class="op" id="5613934">}</span><br>
<span class="lineno"></span><span class="op" id="5613936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="5613939">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5614018">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5614042">func</span>&nbsp;<span class="op" id="5614047">(</span><span class="ident" id="5614048">p</span>&nbsp;<span class="op" id="5614050">*</span><span class="ident" id="5614051">Gray</span><span class="op" id="5614055">)</span>&nbsp;<span class="ident" id="5614057">PixOffset</span><span class="op" id="5614066">(</span><span class="ident" id="5614067">x</span><span class="op" id="5614068">,</span>&nbsp;<span class="ident" id="5614070">y</span>&nbsp;<span class="builtintype" id="5614072">int</span><span class="op" id="5614075">)</span>&nbsp;<span class="builtintype" id="5614077">int</span>&nbsp;<span class="op" id="5614081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5614084">return</span>&nbsp;<span class="op" id="5614091">(</span><span class="ident" id="5614092">y</span><span class="op" id="5614093">-</span><span class="ident" id="5614094">p</span><span class="op" id="5614095">.</span><span class="ident" id="5614096">Rect</span><span class="op" id="5614100">.</span><span class="ident" id="5614101">Min</span><span class="op" id="5614104">.</span><span class="ident" id="5614105">Y</span><span class="op" id="5614106">)</span><span class="op" id="5614107">*</span><span class="ident" id="5614108">p</span><span class="op" id="5614109">.</span><span class="ident" id="5614110">Stride</span>&nbsp;<span class="op" id="5614117">+</span>&nbsp;<span class="op" id="5614119">(</span><span class="ident" id="5614120">x</span><span class="op" id="5614121">-</span><span class="ident" id="5614122">p</span><span class="op" id="5614123">.</span><span class="ident" id="5614124">Rect</span><span class="op" id="5614128">.</span><span class="ident" id="5614129">Min</span><span class="op" id="5614132">.</span><span class="ident" id="5614133">X</span><span class="op" id="5614134">)</span><span class="op" id="5614135">*</span><span class="num" id="5614136">1</span><br>
<span class="lineno"></span><span class="op" id="5614138">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="5614141">func</span>&nbsp;<span class="op" id="5614146">(</span><span class="ident" id="5614147">p</span>&nbsp;<span class="op" id="5614149">*</span><span class="ident" id="5614150">Gray</span><span class="op" id="5614154">)</span>&nbsp;<span class="ident" id="5614156">Set</span><span class="op" id="5614159">(</span><span class="ident" id="5614160">x</span><span class="op" id="5614161">,</span>&nbsp;<span class="ident" id="5614163">y</span>&nbsp;<span class="builtintype" id="5614165">int</span><span class="op" id="5614168">,</span>&nbsp;<span class="ident" id="5614170">c</span>&nbsp;<span class="ident" id="5614172">color</span><span class="op" id="5614177">.</span><span class="ident" id="5614178">Color</span><span class="op" id="5614183">)</span>&nbsp;<span class="op" id="5614185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5614188">if</span>&nbsp;<span class="op" id="5614191">!</span><span class="op" id="5614192">(</span><span class="ident" id="5614193">Point</span><span class="op" id="5614198">{</span><span class="ident" id="5614199">x</span><span class="op" id="5614200">,</span>&nbsp;<span class="ident" id="5614202">y</span><span class="op" id="5614203">}</span><span class="op" id="5614204">.</span><span class="ident" id="5614205">In</span><span class="op" id="5614207">(</span><span class="ident" id="5614208">p</span><span class="op" id="5614209">.</span><span class="ident" id="5614210">Rect</span><span class="op" id="5614214">)</span><span class="op" id="5614215">)</span>&nbsp;<span class="op" id="5614217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5614221">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5614229">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614232">i</span>&nbsp;<span class="op" id="5614234">:=</span>&nbsp;<span class="ident" id="5614237">p</span><span class="op" id="5614238">.</span><span class="ident" id="5614239">PixOffset</span><span class="op" id="5614248">(</span><span class="ident" id="5614249">x</span><span class="op" id="5614250">,</span>&nbsp;<span class="ident" id="5614252">y</span><span class="op" id="5614253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614256">p</span><span class="op" id="5614257">.</span><span class="ident" id="5614258">Pix</span><span class="op" id="5614261">[</span><span class="ident" id="5614262">i</span><span class="op" id="5614263">]</span>&nbsp;<span class="op" id="5614265">=</span>&nbsp;<span class="ident" id="5614267">color</span><span class="op" id="5614272">.</span><span class="ident" id="5614273">GrayModel</span><span class="op" id="5614282">.</span><span class="ident" id="5614283">Convert</span><span class="op" id="5614290">(</span><span class="ident" id="5614291">c</span><span class="op" id="5614292">)</span><span class="op" id="5614293">.</span><span class="op" id="5614294">(</span><span class="ident" id="5614295">color</span><span class="op" id="5614300">.</span><span class="ident" id="5614301">Gray</span><span class="op" id="5614305">)</span><span class="op" id="5614306">.</span><span class="ident" id="5614307">Y</span><br>
<span class="lineno"></span><span class="op" id="5614309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5614312">func</span>&nbsp;<span class="op" id="5614317">(</span><span class="ident" id="5614318">p</span>&nbsp;<span class="op" id="5614320">*</span><span class="ident" id="5614321">Gray</span><span class="op" id="5614325">)</span>&nbsp;<span class="ident" id="5614327">SetGray</span><span class="op" id="5614334">(</span><span class="ident" id="5614335">x</span><span class="op" id="5614336">,</span>&nbsp;<span class="ident" id="5614338">y</span>&nbsp;<span class="builtintype" id="5614340">int</span><span class="op" id="5614343">,</span>&nbsp;<span class="ident" id="5614345">c</span>&nbsp;<span class="ident" id="5614347">color</span><span class="op" id="5614352">.</span><span class="ident" id="5614353">Gray</span><span class="op" id="5614357">)</span>&nbsp;<span class="op" id="5614359">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5614362">if</span>&nbsp;<span class="op" id="5614365">!</span><span class="op" id="5614366">(</span><span class="ident" id="5614367">Point</span><span class="op" id="5614372">{</span><span class="ident" id="5614373">x</span><span class="op" id="5614374">,</span>&nbsp;<span class="ident" id="5614376">y</span><span class="op" id="5614377">}</span><span class="op" id="5614378">.</span><span class="ident" id="5614379">In</span><span class="op" id="5614381">(</span><span class="ident" id="5614382">p</span><span class="op" id="5614383">.</span><span class="ident" id="5614384">Rect</span><span class="op" id="5614388">)</span><span class="op" id="5614389">)</span>&nbsp;<span class="op" id="5614391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5614395">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5614403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614406">i</span>&nbsp;<span class="op" id="5614408">:=</span>&nbsp;<span class="ident" id="5614411">p</span><span class="op" id="5614412">.</span><span class="ident" id="5614413">PixOffset</span><span class="op" id="5614422">(</span><span class="ident" id="5614423">x</span><span class="op" id="5614424">,</span>&nbsp;<span class="ident" id="5614426">y</span><span class="op" id="5614427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614430">p</span><span class="op" id="5614431">.</span><span class="ident" id="5614432">Pix</span><span class="op" id="5614435">[</span><span class="ident" id="5614436">i</span><span class="op" id="5614437">]</span>&nbsp;<span class="op" id="5614439">=</span>&nbsp;<span class="ident" id="5614441">c</span><span class="op" id="5614442">.</span><span class="ident" id="5614443">Y</span><br>
<span class="lineno">715</span><span class="op" id="5614445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5614448">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5614525">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5614597">func</span>&nbsp;<span class="op" id="5614602">(</span><span class="ident" id="5614603">p</span>&nbsp;<span class="op" id="5614605">*</span><span class="ident" id="5614606">Gray</span><span class="op" id="5614610">)</span>&nbsp;<span class="ident" id="5614612">SubImage</span><span class="op" id="5614620">(</span><span class="ident" id="5614621">r</span>&nbsp;<span class="ident" id="5614623">Rectangle</span><span class="op" id="5614632">)</span>&nbsp;<span class="ident" id="5614634">Image</span>&nbsp;<span class="op" id="5614640">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614643">r</span>&nbsp;<span class="op" id="5614645">=</span>&nbsp;<span class="ident" id="5614647">r</span><span class="op" id="5614648">.</span><span class="ident" id="5614649">Intersect</span><span class="op" id="5614658">(</span><span class="ident" id="5614659">p</span><span class="op" id="5614660">.</span><span class="ident" id="5614661">Rect</span><span class="op" id="5614665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5614668">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5614749">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5614831">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5614881">if</span>&nbsp;<span class="ident" id="5614884">r</span><span class="op" id="5614885">.</span><span class="ident" id="5614886">Empty</span><span class="op" id="5614891">(</span><span class="op" id="5614892">)</span>&nbsp;<span class="op" id="5614894">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5614898">return</span>&nbsp;<span class="op" id="5614905">&amp;</span><span class="ident" id="5614906">Gray</span><span class="op" id="5614910">{</span><span class="op" id="5614911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5614914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614917">i</span>&nbsp;<span class="op" id="5614919">:=</span>&nbsp;<span class="ident" id="5614922">p</span><span class="op" id="5614923">.</span><span class="ident" id="5614924">PixOffset</span><span class="op" id="5614933">(</span><span class="ident" id="5614934">r</span><span class="op" id="5614935">.</span><span class="ident" id="5614936">Min</span><span class="op" id="5614939">.</span><span class="ident" id="5614940">X</span><span class="op" id="5614941">,</span>&nbsp;<span class="ident" id="5614943">r</span><span class="op" id="5614944">.</span><span class="ident" id="5614945">Min</span><span class="op" id="5614948">.</span><span class="ident" id="5614949">Y</span><span class="op" id="5614950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5614953">return</span>&nbsp;<span class="op" id="5614960">&amp;</span><span class="ident" id="5614961">Gray</span><span class="op" id="5614965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614969">Pix</span><span class="op" id="5614972">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614977">p</span><span class="op" id="5614978">.</span><span class="ident" id="5614979">Pix</span><span class="op" id="5614982">[</span><span class="ident" id="5614983">i</span><span class="op" id="5614984">:</span><span class="op" id="5614985">]</span><span class="op" id="5614986">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614990">Stride</span><span class="op" id="5614996">:</span>&nbsp;<span class="ident" id="5614998">p</span><span class="op" id="5614999">.</span><span class="ident" id="5615000">Stride</span><span class="op" id="5615006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615010">Rect</span><span class="op" id="5615014">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5615018">r</span><span class="op" id="5615019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5615022">}</span><br>
<span class="lineno"></span><span class="op" id="5615024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span><span class="comment" id="5615027">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5615100">func</span>&nbsp;<span class="op" id="5615105">(</span><span class="ident" id="5615106">p</span>&nbsp;<span class="op" id="5615108">*</span><span class="ident" id="5615109">Gray</span><span class="op" id="5615113">)</span>&nbsp;<span class="ident" id="5615115">Opaque</span><span class="op" id="5615121">(</span><span class="op" id="5615122">)</span>&nbsp;<span class="builtintype" id="5615124">bool</span>&nbsp;<span class="op" id="5615129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5615132">return</span>&nbsp;<span class="builtintype" id="5615139">true</span><br>
<span class="lineno"></span><span class="op" id="5615144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="5615147">//&nbsp;NewGray&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5615200">func</span>&nbsp;<span class="ident" id="5615205">NewGray</span><span class="op" id="5615212">(</span><span class="ident" id="5615213">r</span>&nbsp;<span class="ident" id="5615215">Rectangle</span><span class="op" id="5615224">)</span>&nbsp;<span class="op" id="5615226">*</span><span class="ident" id="5615227">Gray</span>&nbsp;<span class="op" id="5615232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615235">w</span><span class="op" id="5615236">,</span>&nbsp;<span class="ident" id="5615238">h</span>&nbsp;<span class="op" id="5615240">:=</span>&nbsp;<span class="ident" id="5615243">r</span><span class="op" id="5615244">.</span><span class="ident" id="5615245">Dx</span><span class="op" id="5615247">(</span><span class="op" id="5615248">)</span><span class="op" id="5615249">,</span>&nbsp;<span class="ident" id="5615251">r</span><span class="op" id="5615252">.</span><span class="ident" id="5615253">Dy</span><span class="op" id="5615255">(</span><span class="op" id="5615256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615259">pix</span>&nbsp;<span class="op" id="5615263">:=</span>&nbsp;<span class="builtinfunc" id="5615266">make</span><span class="op" id="5615270">(</span><span class="op" id="5615271">[</span><span class="op" id="5615272">]</span><span class="builtintype" id="5615273">uint8</span><span class="op" id="5615278">,</span>&nbsp;<span class="num" id="5615280">1</span><span class="op" id="5615281">*</span><span class="ident" id="5615282">w</span><span class="op" id="5615283">*</span><span class="ident" id="5615284">h</span><span class="op" id="5615285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5615288">return</span>&nbsp;<span class="op" id="5615295">&amp;</span><span class="ident" id="5615296">Gray</span><span class="op" id="5615300">{</span><span class="ident" id="5615301">pix</span><span class="op" id="5615304">,</span>&nbsp;<span class="num" id="5615306">1</span>&nbsp;<span class="op" id="5615308">*</span>&nbsp;<span class="ident" id="5615310">w</span><span class="op" id="5615311">,</span>&nbsp;<span class="ident" id="5615313">r</span><span class="op" id="5615314">}</span><br>
<span class="lineno">745</span><span class="op" id="5615316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5615319">//&nbsp;Gray16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray16&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5615396">type</span>&nbsp;<span class="ident" id="5615401">Gray16</span>&nbsp;<span class="keyword" id="5615408">struct</span>&nbsp;<span class="op" id="5615415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5615418">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5615502">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615570">Pix</span>&nbsp;<span class="op" id="5615574">[</span><span class="op" id="5615575">]</span><span class="builtintype" id="5615576">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5615583">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615659">Stride</span>&nbsp;<span class="builtintype" id="5615666">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5615671">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615703">Rect</span>&nbsp;<span class="ident" id="5615708">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5615718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5615721">func</span>&nbsp;<span class="op" id="5615726">(</span><span class="ident" id="5615727">p</span>&nbsp;<span class="op" id="5615729">*</span><span class="ident" id="5615730">Gray16</span><span class="op" id="5615736">)</span>&nbsp;<span class="ident" id="5615738">ColorModel</span><span class="op" id="5615748">(</span><span class="op" id="5615749">)</span>&nbsp;<span class="ident" id="5615751">color</span><span class="op" id="5615756">.</span><span class="ident" id="5615757">Model</span>&nbsp;<span class="op" id="5615763">{</span>&nbsp;<span class="keyword" id="5615765">return</span>&nbsp;<span class="ident" id="5615772">color</span><span class="op" id="5615777">.</span><span class="ident" id="5615778">Gray16Model</span>&nbsp;<span class="op" id="5615790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span><span class="keyword" id="5615793">func</span>&nbsp;<span class="op" id="5615798">(</span><span class="ident" id="5615799">p</span>&nbsp;<span class="op" id="5615801">*</span><span class="ident" id="5615802">Gray16</span><span class="op" id="5615808">)</span>&nbsp;<span class="ident" id="5615810">Bounds</span><span class="op" id="5615816">(</span><span class="op" id="5615817">)</span>&nbsp;<span class="ident" id="5615819">Rectangle</span>&nbsp;<span class="op" id="5615829">{</span>&nbsp;<span class="keyword" id="5615831">return</span>&nbsp;<span class="ident" id="5615838">p</span><span class="op" id="5615839">.</span><span class="ident" id="5615840">Rect</span>&nbsp;<span class="op" id="5615845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5615848">func</span>&nbsp;<span class="op" id="5615853">(</span><span class="ident" id="5615854">p</span>&nbsp;<span class="op" id="5615856">*</span><span class="ident" id="5615857">Gray16</span><span class="op" id="5615863">)</span>&nbsp;<span class="ident" id="5615865">At</span><span class="op" id="5615867">(</span><span class="ident" id="5615868">x</span><span class="op" id="5615869">,</span>&nbsp;<span class="ident" id="5615871">y</span>&nbsp;<span class="builtintype" id="5615873">int</span><span class="op" id="5615876">)</span>&nbsp;<span class="ident" id="5615878">color</span><span class="op" id="5615883">.</span><span class="ident" id="5615884">Color</span>&nbsp;<span class="op" id="5615890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5615893">return</span>&nbsp;<span class="ident" id="5615900">p</span><span class="op" id="5615901">.</span><span class="ident" id="5615902">Gray16At</span><span class="op" id="5615910">(</span><span class="ident" id="5615911">x</span><span class="op" id="5615912">,</span>&nbsp;<span class="ident" id="5615914">y</span><span class="op" id="5615915">)</span><br>
<span class="lineno"></span><span class="op" id="5615917">}</span><br>
<span class="lineno">765</span><br>
<span class="lineno"></span><span class="keyword" id="5615920">func</span>&nbsp;<span class="op" id="5615925">(</span><span class="ident" id="5615926">p</span>&nbsp;<span class="op" id="5615928">*</span><span class="ident" id="5615929">Gray16</span><span class="op" id="5615935">)</span>&nbsp;<span class="ident" id="5615937">Gray16At</span><span class="op" id="5615945">(</span><span class="ident" id="5615946">x</span><span class="op" id="5615947">,</span>&nbsp;<span class="ident" id="5615949">y</span>&nbsp;<span class="builtintype" id="5615951">int</span><span class="op" id="5615954">)</span>&nbsp;<span class="ident" id="5615956">color</span><span class="op" id="5615961">.</span><span class="ident" id="5615962">Gray16</span>&nbsp;<span class="op" id="5615969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5615972">if</span>&nbsp;<span class="op" id="5615975">!</span><span class="op" id="5615976">(</span><span class="ident" id="5615977">Point</span><span class="op" id="5615982">{</span><span class="ident" id="5615983">x</span><span class="op" id="5615984">,</span>&nbsp;<span class="ident" id="5615986">y</span><span class="op" id="5615987">}</span><span class="op" id="5615988">.</span><span class="ident" id="5615989">In</span><span class="op" id="5615991">(</span><span class="ident" id="5615992">p</span><span class="op" id="5615993">.</span><span class="ident" id="5615994">Rect</span><span class="op" id="5615998">)</span><span class="op" id="5615999">)</span>&nbsp;<span class="op" id="5616001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5616005">return</span>&nbsp;<span class="ident" id="5616012">color</span><span class="op" id="5616017">.</span><span class="ident" id="5616018">Gray16</span><span class="op" id="5616024">{</span><span class="op" id="5616025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5616028">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616031">i</span>&nbsp;<span class="op" id="5616033">:=</span>&nbsp;<span class="ident" id="5616036">p</span><span class="op" id="5616037">.</span><span class="ident" id="5616038">PixOffset</span><span class="op" id="5616047">(</span><span class="ident" id="5616048">x</span><span class="op" id="5616049">,</span>&nbsp;<span class="ident" id="5616051">y</span><span class="op" id="5616052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5616055">return</span>&nbsp;<span class="ident" id="5616062">color</span><span class="op" id="5616067">.</span><span class="ident" id="5616068">Gray16</span><span class="op" id="5616074">{</span><span class="builtintype" id="5616075">uint16</span><span class="op" id="5616081">(</span><span class="ident" id="5616082">p</span><span class="op" id="5616083">.</span><span class="ident" id="5616084">Pix</span><span class="op" id="5616087">[</span><span class="ident" id="5616088">i</span><span class="op" id="5616089">+</span><span class="num" id="5616090">0</span><span class="op" id="5616091">]</span><span class="op" id="5616092">)</span><span class="op" id="5616093">&lt;&lt;</span><span class="num" id="5616095">8</span>&nbsp;<span class="op" id="5616097">|</span>&nbsp;<span class="builtintype" id="5616099">uint16</span><span class="op" id="5616105">(</span><span class="ident" id="5616106">p</span><span class="op" id="5616107">.</span><span class="ident" id="5616108">Pix</span><span class="op" id="5616111">[</span><span class="ident" id="5616112">i</span><span class="op" id="5616113">+</span><span class="num" id="5616114">1</span><span class="op" id="5616115">]</span><span class="op" id="5616116">)</span><span class="op" id="5616117">}</span><br>
<span class="lineno"></span><span class="op" id="5616119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5616122">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">775</span><span class="comment" id="5616201">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5616225">func</span>&nbsp;<span class="op" id="5616230">(</span><span class="ident" id="5616231">p</span>&nbsp;<span class="op" id="5616233">*</span><span class="ident" id="5616234">Gray16</span><span class="op" id="5616240">)</span>&nbsp;<span class="ident" id="5616242">PixOffset</span><span class="op" id="5616251">(</span><span class="ident" id="5616252">x</span><span class="op" id="5616253">,</span>&nbsp;<span class="ident" id="5616255">y</span>&nbsp;<span class="builtintype" id="5616257">int</span><span class="op" id="5616260">)</span>&nbsp;<span class="builtintype" id="5616262">int</span>&nbsp;<span class="op" id="5616266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5616269">return</span>&nbsp;<span class="op" id="5616276">(</span><span class="ident" id="5616277">y</span><span class="op" id="5616278">-</span><span class="ident" id="5616279">p</span><span class="op" id="5616280">.</span><span class="ident" id="5616281">Rect</span><span class="op" id="5616285">.</span><span class="ident" id="5616286">Min</span><span class="op" id="5616289">.</span><span class="ident" id="5616290">Y</span><span class="op" id="5616291">)</span><span class="op" id="5616292">*</span><span class="ident" id="5616293">p</span><span class="op" id="5616294">.</span><span class="ident" id="5616295">Stride</span>&nbsp;<span class="op" id="5616302">+</span>&nbsp;<span class="op" id="5616304">(</span><span class="ident" id="5616305">x</span><span class="op" id="5616306">-</span><span class="ident" id="5616307">p</span><span class="op" id="5616308">.</span><span class="ident" id="5616309">Rect</span><span class="op" id="5616313">.</span><span class="ident" id="5616314">Min</span><span class="op" id="5616317">.</span><span class="ident" id="5616318">X</span><span class="op" id="5616319">)</span><span class="op" id="5616320">*</span><span class="num" id="5616321">2</span><br>
<span class="lineno"></span><span class="op" id="5616323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="keyword" id="5616326">func</span>&nbsp;<span class="op" id="5616331">(</span><span class="ident" id="5616332">p</span>&nbsp;<span class="op" id="5616334">*</span><span class="ident" id="5616335">Gray16</span><span class="op" id="5616341">)</span>&nbsp;<span class="ident" id="5616343">Set</span><span class="op" id="5616346">(</span><span class="ident" id="5616347">x</span><span class="op" id="5616348">,</span>&nbsp;<span class="ident" id="5616350">y</span>&nbsp;<span class="builtintype" id="5616352">int</span><span class="op" id="5616355">,</span>&nbsp;<span class="ident" id="5616357">c</span>&nbsp;<span class="ident" id="5616359">color</span><span class="op" id="5616364">.</span><span class="ident" id="5616365">Color</span><span class="op" id="5616370">)</span>&nbsp;<span class="op" id="5616372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5616375">if</span>&nbsp;<span class="op" id="5616378">!</span><span class="op" id="5616379">(</span><span class="ident" id="5616380">Point</span><span class="op" id="5616385">{</span><span class="ident" id="5616386">x</span><span class="op" id="5616387">,</span>&nbsp;<span class="ident" id="5616389">y</span><span class="op" id="5616390">}</span><span class="op" id="5616391">.</span><span class="ident" id="5616392">In</span><span class="op" id="5616394">(</span><span class="ident" id="5616395">p</span><span class="op" id="5616396">.</span><span class="ident" id="5616397">Rect</span><span class="op" id="5616401">)</span><span class="op" id="5616402">)</span>&nbsp;<span class="op" id="5616404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5616408">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5616416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616419">i</span>&nbsp;<span class="op" id="5616421">:=</span>&nbsp;<span class="ident" id="5616424">p</span><span class="op" id="5616425">.</span><span class="ident" id="5616426">PixOffset</span><span class="op" id="5616435">(</span><span class="ident" id="5616436">x</span><span class="op" id="5616437">,</span>&nbsp;<span class="ident" id="5616439">y</span><span class="op" id="5616440">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616443">c1</span>&nbsp;<span class="op" id="5616446">:=</span>&nbsp;<span class="ident" id="5616449">color</span><span class="op" id="5616454">.</span><span class="ident" id="5616455">Gray16Model</span><span class="op" id="5616466">.</span><span class="ident" id="5616467">Convert</span><span class="op" id="5616474">(</span><span class="ident" id="5616475">c</span><span class="op" id="5616476">)</span><span class="op" id="5616477">.</span><span class="op" id="5616478">(</span><span class="ident" id="5616479">color</span><span class="op" id="5616484">.</span><span class="ident" id="5616485">Gray16</span><span class="op" id="5616491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616494">p</span><span class="op" id="5616495">.</span><span class="ident" id="5616496">Pix</span><span class="op" id="5616499">[</span><span class="ident" id="5616500">i</span><span class="op" id="5616501">+</span><span class="num" id="5616502">0</span><span class="op" id="5616503">]</span>&nbsp;<span class="op" id="5616505">=</span>&nbsp;<span class="builtintype" id="5616507">uint8</span><span class="op" id="5616512">(</span><span class="ident" id="5616513">c1</span><span class="op" id="5616515">.</span><span class="ident" id="5616516">Y</span>&nbsp;<span class="op" id="5616518">&gt;&gt;</span>&nbsp;<span class="num" id="5616521">8</span><span class="op" id="5616522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616525">p</span><span class="op" id="5616526">.</span><span class="ident" id="5616527">Pix</span><span class="op" id="5616530">[</span><span class="ident" id="5616531">i</span><span class="op" id="5616532">+</span><span class="num" id="5616533">1</span><span class="op" id="5616534">]</span>&nbsp;<span class="op" id="5616536">=</span>&nbsp;<span class="builtintype" id="5616538">uint8</span><span class="op" id="5616543">(</span><span class="ident" id="5616544">c1</span><span class="op" id="5616546">.</span><span class="ident" id="5616547">Y</span><span class="op" id="5616548">)</span><br>
<span class="lineno"></span><span class="op" id="5616550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="keyword" id="5616553">func</span>&nbsp;<span class="op" id="5616558">(</span><span class="ident" id="5616559">p</span>&nbsp;<span class="op" id="5616561">*</span><span class="ident" id="5616562">Gray16</span><span class="op" id="5616568">)</span>&nbsp;<span class="ident" id="5616570">SetGray16</span><span class="op" id="5616579">(</span><span class="ident" id="5616580">x</span><span class="op" id="5616581">,</span>&nbsp;<span class="ident" id="5616583">y</span>&nbsp;<span class="builtintype" id="5616585">int</span><span class="op" id="5616588">,</span>&nbsp;<span class="ident" id="5616590">c</span>&nbsp;<span class="ident" id="5616592">color</span><span class="op" id="5616597">.</span><span class="ident" id="5616598">Gray16</span><span class="op" id="5616604">)</span>&nbsp;<span class="op" id="5616606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5616609">if</span>&nbsp;<span class="op" id="5616612">!</span><span class="op" id="5616613">(</span><span class="ident" id="5616614">Point</span><span class="op" id="5616619">{</span><span class="ident" id="5616620">x</span><span class="op" id="5616621">,</span>&nbsp;<span class="ident" id="5616623">y</span><span class="op" id="5616624">}</span><span class="op" id="5616625">.</span><span class="ident" id="5616626">In</span><span class="op" id="5616628">(</span><span class="ident" id="5616629">p</span><span class="op" id="5616630">.</span><span class="ident" id="5616631">Rect</span><span class="op" id="5616635">)</span><span class="op" id="5616636">)</span>&nbsp;<span class="op" id="5616638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5616642">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5616650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616653">i</span>&nbsp;<span class="op" id="5616655">:=</span>&nbsp;<span class="ident" id="5616658">p</span><span class="op" id="5616659">.</span><span class="ident" id="5616660">PixOffset</span><span class="op" id="5616669">(</span><span class="ident" id="5616670">x</span><span class="op" id="5616671">,</span>&nbsp;<span class="ident" id="5616673">y</span><span class="op" id="5616674">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616677">p</span><span class="op" id="5616678">.</span><span class="ident" id="5616679">Pix</span><span class="op" id="5616682">[</span><span class="ident" id="5616683">i</span><span class="op" id="5616684">+</span><span class="num" id="5616685">0</span><span class="op" id="5616686">]</span>&nbsp;<span class="op" id="5616688">=</span>&nbsp;<span class="builtintype" id="5616690">uint8</span><span class="op" id="5616695">(</span><span class="ident" id="5616696">c</span><span class="op" id="5616697">.</span><span class="ident" id="5616698">Y</span>&nbsp;<span class="op" id="5616700">&gt;&gt;</span>&nbsp;<span class="num" id="5616703">8</span><span class="op" id="5616704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616707">p</span><span class="op" id="5616708">.</span><span class="ident" id="5616709">Pix</span><span class="op" id="5616712">[</span><span class="ident" id="5616713">i</span><span class="op" id="5616714">+</span><span class="num" id="5616715">1</span><span class="op" id="5616716">]</span>&nbsp;<span class="op" id="5616718">=</span>&nbsp;<span class="builtintype" id="5616720">uint8</span><span class="op" id="5616725">(</span><span class="ident" id="5616726">c</span><span class="op" id="5616727">.</span><span class="ident" id="5616728">Y</span><span class="op" id="5616729">)</span><br>
<span class="lineno"></span><span class="op" id="5616731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5616734">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno">800</span><span class="comment" id="5616811">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5616883">func</span>&nbsp;<span class="op" id="5616888">(</span><span class="ident" id="5616889">p</span>&nbsp;<span class="op" id="5616891">*</span><span class="ident" id="5616892">Gray16</span><span class="op" id="5616898">)</span>&nbsp;<span class="ident" id="5616900">SubImage</span><span class="op" id="5616908">(</span><span class="ident" id="5616909">r</span>&nbsp;<span class="ident" id="5616911">Rectangle</span><span class="op" id="5616920">)</span>&nbsp;<span class="ident" id="5616922">Image</span>&nbsp;<span class="op" id="5616928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616931">r</span>&nbsp;<span class="op" id="5616933">=</span>&nbsp;<span class="ident" id="5616935">r</span><span class="op" id="5616936">.</span><span class="ident" id="5616937">Intersect</span><span class="op" id="5616946">(</span><span class="ident" id="5616947">p</span><span class="op" id="5616948">.</span><span class="ident" id="5616949">Rect</span><span class="op" id="5616953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5616956">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5617037">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5617119">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5617169">if</span>&nbsp;<span class="ident" id="5617172">r</span><span class="op" id="5617173">.</span><span class="ident" id="5617174">Empty</span><span class="op" id="5617179">(</span><span class="op" id="5617180">)</span>&nbsp;<span class="op" id="5617182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5617186">return</span>&nbsp;<span class="op" id="5617193">&amp;</span><span class="ident" id="5617194">Gray16</span><span class="op" id="5617200">{</span><span class="op" id="5617201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5617204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617207">i</span>&nbsp;<span class="op" id="5617209">:=</span>&nbsp;<span class="ident" id="5617212">p</span><span class="op" id="5617213">.</span><span class="ident" id="5617214">PixOffset</span><span class="op" id="5617223">(</span><span class="ident" id="5617224">r</span><span class="op" id="5617225">.</span><span class="ident" id="5617226">Min</span><span class="op" id="5617229">.</span><span class="ident" id="5617230">X</span><span class="op" id="5617231">,</span>&nbsp;<span class="ident" id="5617233">r</span><span class="op" id="5617234">.</span><span class="ident" id="5617235">Min</span><span class="op" id="5617238">.</span><span class="ident" id="5617239">Y</span><span class="op" id="5617240">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5617243">return</span>&nbsp;<span class="op" id="5617250">&amp;</span><span class="ident" id="5617251">Gray16</span><span class="op" id="5617257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617261">Pix</span><span class="op" id="5617264">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617269">p</span><span class="op" id="5617270">.</span><span class="ident" id="5617271">Pix</span><span class="op" id="5617274">[</span><span class="ident" id="5617275">i</span><span class="op" id="5617276">:</span><span class="op" id="5617277">]</span><span class="op" id="5617278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617282">Stride</span><span class="op" id="5617288">:</span>&nbsp;<span class="ident" id="5617290">p</span><span class="op" id="5617291">.</span><span class="ident" id="5617292">Stride</span><span class="op" id="5617298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617302">Rect</span><span class="op" id="5617306">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5617310">r</span><span class="op" id="5617311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5617314">}</span><br>
<span class="lineno">815</span><span class="op" id="5617316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5617319">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5617392">func</span>&nbsp;<span class="op" id="5617397">(</span><span class="ident" id="5617398">p</span>&nbsp;<span class="op" id="5617400">*</span><span class="ident" id="5617401">Gray16</span><span class="op" id="5617407">)</span>&nbsp;<span class="ident" id="5617409">Opaque</span><span class="op" id="5617415">(</span><span class="op" id="5617416">)</span>&nbsp;<span class="builtintype" id="5617418">bool</span>&nbsp;<span class="op" id="5617423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5617426">return</span>&nbsp;<span class="builtintype" id="5617433">true</span><br>
<span class="lineno">820</span><span class="op" id="5617438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5617441">//&nbsp;NewGray16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5617498">func</span>&nbsp;<span class="ident" id="5617503">NewGray16</span><span class="op" id="5617512">(</span><span class="ident" id="5617513">r</span>&nbsp;<span class="ident" id="5617515">Rectangle</span><span class="op" id="5617524">)</span>&nbsp;<span class="op" id="5617526">*</span><span class="ident" id="5617527">Gray16</span>&nbsp;<span class="op" id="5617534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617537">w</span><span class="op" id="5617538">,</span>&nbsp;<span class="ident" id="5617540">h</span>&nbsp;<span class="op" id="5617542">:=</span>&nbsp;<span class="ident" id="5617545">r</span><span class="op" id="5617546">.</span><span class="ident" id="5617547">Dx</span><span class="op" id="5617549">(</span><span class="op" id="5617550">)</span><span class="op" id="5617551">,</span>&nbsp;<span class="ident" id="5617553">r</span><span class="op" id="5617554">.</span><span class="ident" id="5617555">Dy</span><span class="op" id="5617557">(</span><span class="op" id="5617558">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617561">pix</span>&nbsp;<span class="op" id="5617565">:=</span>&nbsp;<span class="builtinfunc" id="5617568">make</span><span class="op" id="5617572">(</span><span class="op" id="5617573">[</span><span class="op" id="5617574">]</span><span class="builtintype" id="5617575">uint8</span><span class="op" id="5617580">,</span>&nbsp;<span class="num" id="5617582">2</span><span class="op" id="5617583">*</span><span class="ident" id="5617584">w</span><span class="op" id="5617585">*</span><span class="ident" id="5617586">h</span><span class="op" id="5617587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5617590">return</span>&nbsp;<span class="op" id="5617597">&amp;</span><span class="ident" id="5617598">Gray16</span><span class="op" id="5617604">{</span><span class="ident" id="5617605">pix</span><span class="op" id="5617608">,</span>&nbsp;<span class="num" id="5617610">2</span>&nbsp;<span class="op" id="5617612">*</span>&nbsp;<span class="ident" id="5617614">w</span><span class="op" id="5617615">,</span>&nbsp;<span class="ident" id="5617617">r</span><span class="op" id="5617618">}</span><br>
<span class="lineno"></span><span class="op" id="5617620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5617623">//&nbsp;Paletted&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;uint8&nbsp;indices&nbsp;into&nbsp;a&nbsp;given&nbsp;palette.</span><br>
<span class="lineno">830</span><span class="keyword" id="5617696">type</span>&nbsp;<span class="ident" id="5617701">Paletted</span>&nbsp;<span class="keyword" id="5617710">struct</span>&nbsp;<span class="op" id="5617717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5617720">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;palette&nbsp;indices.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5617787">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617855">Pix</span>&nbsp;<span class="op" id="5617859">[</span><span class="op" id="5617860">]</span><span class="builtintype" id="5617861">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5617868">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617944">Stride</span>&nbsp;<span class="builtintype" id="5617951">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5617956">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617988">Rect</span>&nbsp;<span class="ident" id="5617993">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5618004">//&nbsp;Palette&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618040">Palette</span>&nbsp;<span class="ident" id="5618048">color</span><span class="op" id="5618053">.</span><span class="ident" id="5618054">Palette</span><br>
<span class="lineno">840</span><span class="op" id="5618062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5618065">func</span>&nbsp;<span class="op" id="5618070">(</span><span class="ident" id="5618071">p</span>&nbsp;<span class="op" id="5618073">*</span><span class="ident" id="5618074">Paletted</span><span class="op" id="5618082">)</span>&nbsp;<span class="ident" id="5618084">ColorModel</span><span class="op" id="5618094">(</span><span class="op" id="5618095">)</span>&nbsp;<span class="ident" id="5618097">color</span><span class="op" id="5618102">.</span><span class="ident" id="5618103">Model</span>&nbsp;<span class="op" id="5618109">{</span>&nbsp;<span class="keyword" id="5618111">return</span>&nbsp;<span class="ident" id="5618118">p</span><span class="op" id="5618119">.</span><span class="ident" id="5618120">Palette</span>&nbsp;<span class="op" id="5618128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5618131">func</span>&nbsp;<span class="op" id="5618136">(</span><span class="ident" id="5618137">p</span>&nbsp;<span class="op" id="5618139">*</span><span class="ident" id="5618140">Paletted</span><span class="op" id="5618148">)</span>&nbsp;<span class="ident" id="5618150">Bounds</span><span class="op" id="5618156">(</span><span class="op" id="5618157">)</span>&nbsp;<span class="ident" id="5618159">Rectangle</span>&nbsp;<span class="op" id="5618169">{</span>&nbsp;<span class="keyword" id="5618171">return</span>&nbsp;<span class="ident" id="5618178">p</span><span class="op" id="5618179">.</span><span class="ident" id="5618180">Rect</span>&nbsp;<span class="op" id="5618185">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="5618188">func</span>&nbsp;<span class="op" id="5618193">(</span><span class="ident" id="5618194">p</span>&nbsp;<span class="op" id="5618196">*</span><span class="ident" id="5618197">Paletted</span><span class="op" id="5618205">)</span>&nbsp;<span class="ident" id="5618207">At</span><span class="op" id="5618209">(</span><span class="ident" id="5618210">x</span><span class="op" id="5618211">,</span>&nbsp;<span class="ident" id="5618213">y</span>&nbsp;<span class="builtintype" id="5618215">int</span><span class="op" id="5618218">)</span>&nbsp;<span class="ident" id="5618220">color</span><span class="op" id="5618225">.</span><span class="ident" id="5618226">Color</span>&nbsp;<span class="op" id="5618232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618235">if</span>&nbsp;<span class="builtinfunc" id="5618238">len</span><span class="op" id="5618241">(</span><span class="ident" id="5618242">p</span><span class="op" id="5618243">.</span><span class="ident" id="5618244">Palette</span><span class="op" id="5618251">)</span>&nbsp;<span class="op" id="5618253">==</span>&nbsp;<span class="num" id="5618256">0</span>&nbsp;<span class="op" id="5618258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618262">return</span>&nbsp;<span class="ident" id="5618269">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5618274">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618277">if</span>&nbsp;<span class="op" id="5618280">!</span><span class="op" id="5618281">(</span><span class="ident" id="5618282">Point</span><span class="op" id="5618287">{</span><span class="ident" id="5618288">x</span><span class="op" id="5618289">,</span>&nbsp;<span class="ident" id="5618291">y</span><span class="op" id="5618292">}</span><span class="op" id="5618293">.</span><span class="ident" id="5618294">In</span><span class="op" id="5618296">(</span><span class="ident" id="5618297">p</span><span class="op" id="5618298">.</span><span class="ident" id="5618299">Rect</span><span class="op" id="5618303">)</span><span class="op" id="5618304">)</span>&nbsp;<span class="op" id="5618306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618310">return</span>&nbsp;<span class="ident" id="5618317">p</span><span class="op" id="5618318">.</span><span class="ident" id="5618319">Palette</span><span class="op" id="5618326">[</span><span class="num" id="5618327">0</span><span class="op" id="5618328">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5618331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618334">i</span>&nbsp;<span class="op" id="5618336">:=</span>&nbsp;<span class="ident" id="5618339">p</span><span class="op" id="5618340">.</span><span class="ident" id="5618341">PixOffset</span><span class="op" id="5618350">(</span><span class="ident" id="5618351">x</span><span class="op" id="5618352">,</span>&nbsp;<span class="ident" id="5618354">y</span><span class="op" id="5618355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618358">return</span>&nbsp;<span class="ident" id="5618365">p</span><span class="op" id="5618366">.</span><span class="ident" id="5618367">Palette</span><span class="op" id="5618374">[</span><span class="ident" id="5618375">p</span><span class="op" id="5618376">.</span><span class="ident" id="5618377">Pix</span><span class="op" id="5618380">[</span><span class="ident" id="5618381">i</span><span class="op" id="5618382">]</span><span class="op" id="5618383">]</span><br>
<span class="lineno">855</span><span class="op" id="5618385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5618388">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5618467">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5618491">func</span>&nbsp;<span class="op" id="5618496">(</span><span class="ident" id="5618497">p</span>&nbsp;<span class="op" id="5618499">*</span><span class="ident" id="5618500">Paletted</span><span class="op" id="5618508">)</span>&nbsp;<span class="ident" id="5618510">PixOffset</span><span class="op" id="5618519">(</span><span class="ident" id="5618520">x</span><span class="op" id="5618521">,</span>&nbsp;<span class="ident" id="5618523">y</span>&nbsp;<span class="builtintype" id="5618525">int</span><span class="op" id="5618528">)</span>&nbsp;<span class="builtintype" id="5618530">int</span>&nbsp;<span class="op" id="5618534">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618537">return</span>&nbsp;<span class="op" id="5618544">(</span><span class="ident" id="5618545">y</span><span class="op" id="5618546">-</span><span class="ident" id="5618547">p</span><span class="op" id="5618548">.</span><span class="ident" id="5618549">Rect</span><span class="op" id="5618553">.</span><span class="ident" id="5618554">Min</span><span class="op" id="5618557">.</span><span class="ident" id="5618558">Y</span><span class="op" id="5618559">)</span><span class="op" id="5618560">*</span><span class="ident" id="5618561">p</span><span class="op" id="5618562">.</span><span class="ident" id="5618563">Stride</span>&nbsp;<span class="op" id="5618570">+</span>&nbsp;<span class="op" id="5618572">(</span><span class="ident" id="5618573">x</span><span class="op" id="5618574">-</span><span class="ident" id="5618575">p</span><span class="op" id="5618576">.</span><span class="ident" id="5618577">Rect</span><span class="op" id="5618581">.</span><span class="ident" id="5618582">Min</span><span class="op" id="5618585">.</span><span class="ident" id="5618586">X</span><span class="op" id="5618587">)</span><span class="op" id="5618588">*</span><span class="num" id="5618589">1</span><br>
<span class="lineno"></span><span class="op" id="5618591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5618594">func</span>&nbsp;<span class="op" id="5618599">(</span><span class="ident" id="5618600">p</span>&nbsp;<span class="op" id="5618602">*</span><span class="ident" id="5618603">Paletted</span><span class="op" id="5618611">)</span>&nbsp;<span class="ident" id="5618613">Set</span><span class="op" id="5618616">(</span><span class="ident" id="5618617">x</span><span class="op" id="5618618">,</span>&nbsp;<span class="ident" id="5618620">y</span>&nbsp;<span class="builtintype" id="5618622">int</span><span class="op" id="5618625">,</span>&nbsp;<span class="ident" id="5618627">c</span>&nbsp;<span class="ident" id="5618629">color</span><span class="op" id="5618634">.</span><span class="ident" id="5618635">Color</span><span class="op" id="5618640">)</span>&nbsp;<span class="op" id="5618642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618645">if</span>&nbsp;<span class="op" id="5618648">!</span><span class="op" id="5618649">(</span><span class="ident" id="5618650">Point</span><span class="op" id="5618655">{</span><span class="ident" id="5618656">x</span><span class="op" id="5618657">,</span>&nbsp;<span class="ident" id="5618659">y</span><span class="op" id="5618660">}</span><span class="op" id="5618661">.</span><span class="ident" id="5618662">In</span><span class="op" id="5618664">(</span><span class="ident" id="5618665">p</span><span class="op" id="5618666">.</span><span class="ident" id="5618667">Rect</span><span class="op" id="5618671">)</span><span class="op" id="5618672">)</span>&nbsp;<span class="op" id="5618674">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618678">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5618686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618689">i</span>&nbsp;<span class="op" id="5618691">:=</span>&nbsp;<span class="ident" id="5618694">p</span><span class="op" id="5618695">.</span><span class="ident" id="5618696">PixOffset</span><span class="op" id="5618705">(</span><span class="ident" id="5618706">x</span><span class="op" id="5618707">,</span>&nbsp;<span class="ident" id="5618709">y</span><span class="op" id="5618710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618713">p</span><span class="op" id="5618714">.</span><span class="ident" id="5618715">Pix</span><span class="op" id="5618718">[</span><span class="ident" id="5618719">i</span><span class="op" id="5618720">]</span>&nbsp;<span class="op" id="5618722">=</span>&nbsp;<span class="builtintype" id="5618724">uint8</span><span class="op" id="5618729">(</span><span class="ident" id="5618730">p</span><span class="op" id="5618731">.</span><span class="ident" id="5618732">Palette</span><span class="op" id="5618739">.</span><span class="ident" id="5618740">Index</span><span class="op" id="5618745">(</span><span class="ident" id="5618746">c</span><span class="op" id="5618747">)</span><span class="op" id="5618748">)</span><br>
<span class="lineno"></span><span class="op" id="5618750">}</span><br>
<span class="lineno">870</span><br>
<span class="lineno"></span><span class="keyword" id="5618753">func</span>&nbsp;<span class="op" id="5618758">(</span><span class="ident" id="5618759">p</span>&nbsp;<span class="op" id="5618761">*</span><span class="ident" id="5618762">Paletted</span><span class="op" id="5618770">)</span>&nbsp;<span class="ident" id="5618772">ColorIndexAt</span><span class="op" id="5618784">(</span><span class="ident" id="5618785">x</span><span class="op" id="5618786">,</span>&nbsp;<span class="ident" id="5618788">y</span>&nbsp;<span class="builtintype" id="5618790">int</span><span class="op" id="5618793">)</span>&nbsp;<span class="builtintype" id="5618795">uint8</span>&nbsp;<span class="op" id="5618801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618804">if</span>&nbsp;<span class="op" id="5618807">!</span><span class="op" id="5618808">(</span><span class="ident" id="5618809">Point</span><span class="op" id="5618814">{</span><span class="ident" id="5618815">x</span><span class="op" id="5618816">,</span>&nbsp;<span class="ident" id="5618818">y</span><span class="op" id="5618819">}</span><span class="op" id="5618820">.</span><span class="ident" id="5618821">In</span><span class="op" id="5618823">(</span><span class="ident" id="5618824">p</span><span class="op" id="5618825">.</span><span class="ident" id="5618826">Rect</span><span class="op" id="5618830">)</span><span class="op" id="5618831">)</span>&nbsp;<span class="op" id="5618833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618837">return</span>&nbsp;<span class="num" id="5618844">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5618847">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618850">i</span>&nbsp;<span class="op" id="5618852">:=</span>&nbsp;<span class="ident" id="5618855">p</span><span class="op" id="5618856">.</span><span class="ident" id="5618857">PixOffset</span><span class="op" id="5618866">(</span><span class="ident" id="5618867">x</span><span class="op" id="5618868">,</span>&nbsp;<span class="ident" id="5618870">y</span><span class="op" id="5618871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618874">return</span>&nbsp;<span class="ident" id="5618881">p</span><span class="op" id="5618882">.</span><span class="ident" id="5618883">Pix</span><span class="op" id="5618886">[</span><span class="ident" id="5618887">i</span><span class="op" id="5618888">]</span><br>
<span class="lineno"></span><span class="op" id="5618890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5618893">func</span>&nbsp;<span class="op" id="5618898">(</span><span class="ident" id="5618899">p</span>&nbsp;<span class="op" id="5618901">*</span><span class="ident" id="5618902">Paletted</span><span class="op" id="5618910">)</span>&nbsp;<span class="ident" id="5618912">SetColorIndex</span><span class="op" id="5618925">(</span><span class="ident" id="5618926">x</span><span class="op" id="5618927">,</span>&nbsp;<span class="ident" id="5618929">y</span>&nbsp;<span class="builtintype" id="5618931">int</span><span class="op" id="5618934">,</span>&nbsp;<span class="ident" id="5618936">index</span>&nbsp;<span class="builtintype" id="5618942">uint8</span><span class="op" id="5618947">)</span>&nbsp;<span class="op" id="5618949">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618952">if</span>&nbsp;<span class="op" id="5618955">!</span><span class="op" id="5618956">(</span><span class="ident" id="5618957">Point</span><span class="op" id="5618962">{</span><span class="ident" id="5618963">x</span><span class="op" id="5618964">,</span>&nbsp;<span class="ident" id="5618966">y</span><span class="op" id="5618967">}</span><span class="op" id="5618968">.</span><span class="ident" id="5618969">In</span><span class="op" id="5618971">(</span><span class="ident" id="5618972">p</span><span class="op" id="5618973">.</span><span class="ident" id="5618974">Rect</span><span class="op" id="5618978">)</span><span class="op" id="5618979">)</span>&nbsp;<span class="op" id="5618981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618985">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5618993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618996">i</span>&nbsp;<span class="op" id="5618998">:=</span>&nbsp;<span class="ident" id="5619001">p</span><span class="op" id="5619002">.</span><span class="ident" id="5619003">PixOffset</span><span class="op" id="5619012">(</span><span class="ident" id="5619013">x</span><span class="op" id="5619014">,</span>&nbsp;<span class="ident" id="5619016">y</span><span class="op" id="5619017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619020">p</span><span class="op" id="5619021">.</span><span class="ident" id="5619022">Pix</span><span class="op" id="5619025">[</span><span class="ident" id="5619026">i</span><span class="op" id="5619027">]</span>&nbsp;<span class="op" id="5619029">=</span>&nbsp;<span class="ident" id="5619031">index</span><br>
<span class="lineno">885</span><span class="op" id="5619037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5619040">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5619117">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5619189">func</span>&nbsp;<span class="op" id="5619194">(</span><span class="ident" id="5619195">p</span>&nbsp;<span class="op" id="5619197">*</span><span class="ident" id="5619198">Paletted</span><span class="op" id="5619206">)</span>&nbsp;<span class="ident" id="5619208">SubImage</span><span class="op" id="5619216">(</span><span class="ident" id="5619217">r</span>&nbsp;<span class="ident" id="5619219">Rectangle</span><span class="op" id="5619228">)</span>&nbsp;<span class="ident" id="5619230">Image</span>&nbsp;<span class="op" id="5619236">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619239">r</span>&nbsp;<span class="op" id="5619241">=</span>&nbsp;<span class="ident" id="5619243">r</span><span class="op" id="5619244">.</span><span class="ident" id="5619245">Intersect</span><span class="op" id="5619254">(</span><span class="ident" id="5619255">p</span><span class="op" id="5619256">.</span><span class="ident" id="5619257">Rect</span><span class="op" id="5619261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5619264">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5619345">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5619427">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5619477">if</span>&nbsp;<span class="ident" id="5619480">r</span><span class="op" id="5619481">.</span><span class="ident" id="5619482">Empty</span><span class="op" id="5619487">(</span><span class="op" id="5619488">)</span>&nbsp;<span class="op" id="5619490">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5619494">return</span>&nbsp;<span class="op" id="5619501">&amp;</span><span class="ident" id="5619502">Paletted</span><span class="op" id="5619510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619515">Palette</span><span class="op" id="5619522">:</span>&nbsp;<span class="ident" id="5619524">p</span><span class="op" id="5619525">.</span><span class="ident" id="5619526">Palette</span><span class="op" id="5619533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5619537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5619540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619543">i</span>&nbsp;<span class="op" id="5619545">:=</span>&nbsp;<span class="ident" id="5619548">p</span><span class="op" id="5619549">.</span><span class="ident" id="5619550">PixOffset</span><span class="op" id="5619559">(</span><span class="ident" id="5619560">r</span><span class="op" id="5619561">.</span><span class="ident" id="5619562">Min</span><span class="op" id="5619565">.</span><span class="ident" id="5619566">X</span><span class="op" id="5619567">,</span>&nbsp;<span class="ident" id="5619569">r</span><span class="op" id="5619570">.</span><span class="ident" id="5619571">Min</span><span class="op" id="5619574">.</span><span class="ident" id="5619575">Y</span><span class="op" id="5619576">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5619579">return</span>&nbsp;<span class="op" id="5619586">&amp;</span><span class="ident" id="5619587">Paletted</span><span class="op" id="5619595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619599">Pix</span><span class="op" id="5619602">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619608">p</span><span class="op" id="5619609">.</span><span class="ident" id="5619610">Pix</span><span class="op" id="5619613">[</span><span class="ident" id="5619614">i</span><span class="op" id="5619615">:</span><span class="op" id="5619616">]</span><span class="op" id="5619617">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619621">Stride</span><span class="op" id="5619627">:</span>&nbsp;&nbsp;<span class="ident" id="5619630">p</span><span class="op" id="5619631">.</span><span class="ident" id="5619632">Stride</span><span class="op" id="5619638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619642">Rect</span><span class="op" id="5619646">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619651">p</span><span class="op" id="5619652">.</span><span class="ident" id="5619653">Rect</span><span class="op" id="5619657">.</span><span class="ident" id="5619658">Intersect</span><span class="op" id="5619667">(</span><span class="ident" id="5619668">r</span><span class="op" id="5619669">)</span><span class="op" id="5619670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619674">Palette</span><span class="op" id="5619681">:</span>&nbsp;<span class="ident" id="5619683">p</span><span class="op" id="5619684">.</span><span class="ident" id="5619685">Palette</span><span class="op" id="5619692">,</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5619695">}</span><br>
<span class="lineno"></span><span class="op" id="5619697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5619700">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5619773">func</span>&nbsp;<span class="op" id="5619778">(</span><span class="ident" id="5619779">p</span>&nbsp;<span class="op" id="5619781">*</span><span class="ident" id="5619782">Paletted</span><span class="op" id="5619790">)</span>&nbsp;<span class="ident" id="5619792">Opaque</span><span class="op" id="5619798">(</span><span class="op" id="5619799">)</span>&nbsp;<span class="builtintype" id="5619801">bool</span>&nbsp;<span class="op" id="5619806">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5619809">var</span>&nbsp;<span class="ident" id="5619813">present</span>&nbsp;<span class="op" id="5619821">[</span><span class="num" id="5619822">256</span><span class="op" id="5619825">]</span><span class="builtintype" id="5619826">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619832">i0</span><span class="op" id="5619834">,</span>&nbsp;<span class="ident" id="5619836">i1</span>&nbsp;<span class="op" id="5619839">:=</span>&nbsp;<span class="num" id="5619842">0</span><span class="op" id="5619843">,</span>&nbsp;<span class="ident" id="5619845">p</span><span class="op" id="5619846">.</span><span class="ident" id="5619847">Rect</span><span class="op" id="5619851">.</span><span class="ident" id="5619852">Dx</span><span class="op" id="5619854">(</span><span class="op" id="5619855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5619858">for</span>&nbsp;<span class="ident" id="5619862">y</span>&nbsp;<span class="op" id="5619864">:=</span>&nbsp;<span class="ident" id="5619867">p</span><span class="op" id="5619868">.</span><span class="ident" id="5619869">Rect</span><span class="op" id="5619873">.</span><span class="ident" id="5619874">Min</span><span class="op" id="5619877">.</span><span class="ident" id="5619878">Y</span><span class="op" id="5619879">;</span>&nbsp;<span class="ident" id="5619881">y</span>&nbsp;<span class="op" id="5619883">&lt;</span>&nbsp;<span class="ident" id="5619885">p</span><span class="op" id="5619886">.</span><span class="ident" id="5619887">Rect</span><span class="op" id="5619891">.</span><span class="ident" id="5619892">Max</span><span class="op" id="5619895">.</span><span class="ident" id="5619896">Y</span><span class="op" id="5619897">;</span>&nbsp;<span class="ident" id="5619899">y</span><span class="op" id="5619900">++</span>&nbsp;<span class="op" id="5619903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5619907">for</span>&nbsp;<span class="ident" id="5619911">_</span><span class="op" id="5619912">,</span>&nbsp;<span class="ident" id="5619914">c</span>&nbsp;<span class="op" id="5619916">:=</span>&nbsp;<span class="keyword" id="5619919">range</span>&nbsp;<span class="ident" id="5619925">p</span><span class="op" id="5619926">.</span><span class="ident" id="5619927">Pix</span><span class="op" id="5619930">[</span><span class="ident" id="5619931">i0</span><span class="op" id="5619933">:</span><span class="ident" id="5619934">i1</span><span class="op" id="5619936">]</span>&nbsp;<span class="op" id="5619938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619943">present</span><span class="op" id="5619950">[</span><span class="ident" id="5619951">c</span><span class="op" id="5619952">]</span>&nbsp;<span class="op" id="5619954">=</span>&nbsp;<span class="builtintype" id="5619956">true</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5619963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619967">i0</span>&nbsp;<span class="op" id="5619970">+=</span>&nbsp;<span class="ident" id="5619973">p</span><span class="op" id="5619974">.</span><span class="ident" id="5619975">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619984">i1</span>&nbsp;<span class="op" id="5619987">+=</span>&nbsp;<span class="ident" id="5619990">p</span><span class="op" id="5619991">.</span><span class="ident" id="5619992">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5620000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620003">for</span>&nbsp;<span class="ident" id="5620007">i</span><span class="op" id="5620008">,</span>&nbsp;<span class="ident" id="5620010">c</span>&nbsp;<span class="op" id="5620012">:=</span>&nbsp;<span class="keyword" id="5620015">range</span>&nbsp;<span class="ident" id="5620021">p</span><span class="op" id="5620022">.</span><span class="ident" id="5620023">Palette</span>&nbsp;<span class="op" id="5620031">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620035">if</span>&nbsp;<span class="op" id="5620038">!</span><span class="ident" id="5620039">present</span><span class="op" id="5620046">[</span><span class="ident" id="5620047">i</span><span class="op" id="5620048">]</span>&nbsp;<span class="op" id="5620050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620055">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5620066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620070">_</span><span class="op" id="5620071">,</span>&nbsp;<span class="ident" id="5620073">_</span><span class="op" id="5620074">,</span>&nbsp;<span class="ident" id="5620076">_</span><span class="op" id="5620077">,</span>&nbsp;<span class="ident" id="5620079">a</span>&nbsp;<span class="op" id="5620081">:=</span>&nbsp;<span class="ident" id="5620084">c</span><span class="op" id="5620085">.</span><span class="ident" id="5620086">RGBA</span><span class="op" id="5620090">(</span><span class="op" id="5620091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620095">if</span>&nbsp;<span class="ident" id="5620098">a</span>&nbsp;<span class="op" id="5620100">!=</span>&nbsp;<span class="num" id="5620103">0xffff</span>&nbsp;<span class="op" id="5620110">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620115">return</span>&nbsp;<span class="builtintype" id="5620122">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5620130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5620133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620136">return</span>&nbsp;<span class="builtintype" id="5620143">true</span><br>
<span class="lineno"></span><span class="op" id="5620148">}</span><br>
<span class="lineno">930</span><br>
<span class="lineno"></span><span class="comment" id="5620151">//&nbsp;NewPaletted&nbsp;returns&nbsp;a&nbsp;new&nbsp;Paletted&nbsp;with&nbsp;the&nbsp;given&nbsp;width,&nbsp;height&nbsp;and&nbsp;palette.</span><br>
<span class="lineno"></span><span class="keyword" id="5620231">func</span>&nbsp;<span class="ident" id="5620236">NewPaletted</span><span class="op" id="5620247">(</span><span class="ident" id="5620248">r</span>&nbsp;<span class="ident" id="5620250">Rectangle</span><span class="op" id="5620259">,</span>&nbsp;<span class="ident" id="5620261">p</span>&nbsp;<span class="ident" id="5620263">color</span><span class="op" id="5620268">.</span><span class="ident" id="5620269">Palette</span><span class="op" id="5620276">)</span>&nbsp;<span class="op" id="5620278">*</span><span class="ident" id="5620279">Paletted</span>&nbsp;<span class="op" id="5620288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620291">w</span><span class="op" id="5620292">,</span>&nbsp;<span class="ident" id="5620294">h</span>&nbsp;<span class="op" id="5620296">:=</span>&nbsp;<span class="ident" id="5620299">r</span><span class="op" id="5620300">.</span><span class="ident" id="5620301">Dx</span><span class="op" id="5620303">(</span><span class="op" id="5620304">)</span><span class="op" id="5620305">,</span>&nbsp;<span class="ident" id="5620307">r</span><span class="op" id="5620308">.</span><span class="ident" id="5620309">Dy</span><span class="op" id="5620311">(</span><span class="op" id="5620312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620315">pix</span>&nbsp;<span class="op" id="5620319">:=</span>&nbsp;<span class="builtinfunc" id="5620322">make</span><span class="op" id="5620326">(</span><span class="op" id="5620327">[</span><span class="op" id="5620328">]</span><span class="builtintype" id="5620329">uint8</span><span class="op" id="5620334">,</span>&nbsp;<span class="num" id="5620336">1</span><span class="op" id="5620337">*</span><span class="ident" id="5620338">w</span><span class="op" id="5620339">*</span><span class="ident" id="5620340">h</span><span class="op" id="5620341">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620344">return</span>&nbsp;<span class="op" id="5620351">&amp;</span><span class="ident" id="5620352">Paletted</span><span class="op" id="5620360">{</span><span class="ident" id="5620361">pix</span><span class="op" id="5620364">,</span>&nbsp;<span class="num" id="5620366">1</span>&nbsp;<span class="op" id="5620368">*</span>&nbsp;<span class="ident" id="5620370">w</span><span class="op" id="5620371">,</span>&nbsp;<span class="ident" id="5620373">r</span><span class="op" id="5620374">,</span>&nbsp;<span class="ident" id="5620376">p</span><span class="op" id="5620377">}</span><br>
<span class="lineno"></span><span class="op" id="5620379">}</span>
</div>
</body>
</html>
