<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html" class="current">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3797775">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3797830">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3797884">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3797935">package</span>&nbsp;<span class="ident" id="3797943">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3797949">import</span>&nbsp;<span class="op" id="3797956">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3797959">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span><span class="op" id="3797974">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="3797977">//&nbsp;CertPool&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="3798015">type</span>&nbsp;<span class="ident" id="3798020">CertPool</span>&nbsp;<span class="keyword" id="3798029">struct</span>&nbsp;<span class="op" id="3798036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798039">bySubjectKeyId</span>&nbsp;<span class="keyword" id="3798054">map</span><span class="op" id="3798057">[</span><span class="builtintype" id="3798058">string</span><span class="op" id="3798064">]</span><span class="op" id="3798065">[</span><span class="op" id="3798066">]</span><span class="builtintype" id="3798067">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798072">byName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798087">map</span><span class="op" id="3798090">[</span><span class="builtintype" id="3798091">string</span><span class="op" id="3798097">]</span><span class="op" id="3798098">[</span><span class="op" id="3798099">]</span><span class="builtintype" id="3798100">int</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798105">certs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3798120">[</span><span class="op" id="3798121">]</span><span class="op" id="3798122">*</span><span class="ident" id="3798123">Certificate</span><br>
<span class="lineno"></span><span class="op" id="3798135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3798138">//&nbsp;NewCertPool&nbsp;returns&nbsp;a&nbsp;new,&nbsp;empty&nbsp;CertPool.</span><br>
<span class="lineno"></span><span class="keyword" id="3798184">func</span>&nbsp;<span class="ident" id="3798189">NewCertPool</span><span class="op" id="3798200">(</span><span class="op" id="3798201">)</span>&nbsp;<span class="op" id="3798203">*</span><span class="ident" id="3798204">CertPool</span>&nbsp;<span class="op" id="3798213">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798216">return</span>&nbsp;<span class="op" id="3798223">&amp;</span><span class="ident" id="3798224">CertPool</span><span class="op" id="3798232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3798236">make</span><span class="op" id="3798240">(</span><span class="keyword" id="3798241">map</span><span class="op" id="3798244">[</span><span class="builtintype" id="3798245">string</span><span class="op" id="3798251">]</span><span class="op" id="3798252">[</span><span class="op" id="3798253">]</span><span class="builtintype" id="3798254">int</span><span class="op" id="3798257">)</span><span class="op" id="3798258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3798262">make</span><span class="op" id="3798266">(</span><span class="keyword" id="3798267">map</span><span class="op" id="3798270">[</span><span class="builtintype" id="3798271">string</span><span class="op" id="3798277">]</span><span class="op" id="3798278">[</span><span class="op" id="3798279">]</span><span class="builtintype" id="3798280">int</span><span class="op" id="3798283">)</span><span class="op" id="3798284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798288">nil</span><span class="op" id="3798291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798294">}</span><br>
<span class="lineno">25</span><span class="op" id="3798296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3798299">//&nbsp;findVerifiedParents&nbsp;attempts&nbsp;to&nbsp;find&nbsp;certificates&nbsp;in&nbsp;s&nbsp;which&nbsp;have&nbsp;signed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3798379">//&nbsp;given&nbsp;certificate.&nbsp;If&nbsp;any&nbsp;candidates&nbsp;were&nbsp;rejected&nbsp;then&nbsp;errCert&nbsp;will&nbsp;be&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="3798458">//&nbsp;to&nbsp;one&nbsp;of&nbsp;them,&nbsp;arbitrarily,&nbsp;and&nbsp;err&nbsp;will&nbsp;contain&nbsp;the&nbsp;reason&nbsp;that&nbsp;it&nbsp;was</span><br>
<span class="lineno">30</span><span class="comment" id="3798534">//&nbsp;rejected.</span><br>
<span class="lineno"></span><span class="keyword" id="3798547">func</span>&nbsp;<span class="op" id="3798552">(</span><span class="ident" id="3798553">s</span>&nbsp;<span class="op" id="3798555">*</span><span class="ident" id="3798556">CertPool</span><span class="op" id="3798564">)</span>&nbsp;<span class="ident" id="3798566">findVerifiedParents</span><span class="op" id="3798585">(</span><span class="ident" id="3798586">cert</span>&nbsp;<span class="op" id="3798591">*</span><span class="ident" id="3798592">Certificate</span><span class="op" id="3798603">)</span>&nbsp;<span class="op" id="3798605">(</span><span class="ident" id="3798606">parents</span>&nbsp;<span class="op" id="3798614">[</span><span class="op" id="3798615">]</span><span class="builtintype" id="3798616">int</span><span class="op" id="3798619">,</span>&nbsp;<span class="ident" id="3798621">errCert</span>&nbsp;<span class="op" id="3798629">*</span><span class="ident" id="3798630">Certificate</span><span class="op" id="3798641">,</span>&nbsp;<span class="ident" id="3798643">err</span>&nbsp;<span class="builtintype" id="3798647">error</span><span class="op" id="3798652">)</span>&nbsp;<span class="op" id="3798654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798657">if</span>&nbsp;<span class="ident" id="3798660">s</span>&nbsp;<span class="op" id="3798662">==</span>&nbsp;<span class="ident" id="3798665">nil</span>&nbsp;<span class="op" id="3798669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798673">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798681">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798684">var</span>&nbsp;<span class="ident" id="3798688">candidates</span>&nbsp;<span class="op" id="3798699">[</span><span class="op" id="3798700">]</span><span class="builtintype" id="3798701">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798707">if</span>&nbsp;<span class="builtinfunc" id="3798710">len</span><span class="op" id="3798713">(</span><span class="ident" id="3798714">cert</span><span class="op" id="3798718">.</span><span class="ident" id="3798719">AuthorityKeyId</span><span class="op" id="3798733">)</span>&nbsp;<span class="op" id="3798735">&gt;</span>&nbsp;<span class="num" id="3798737">0</span>&nbsp;<span class="op" id="3798739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798743">candidates</span>&nbsp;<span class="op" id="3798754">=</span>&nbsp;<span class="ident" id="3798756">s</span><span class="op" id="3798757">.</span><span class="ident" id="3798758">bySubjectKeyId</span><span class="op" id="3798772">[</span><span class="builtintype" id="3798773">string</span><span class="op" id="3798779">(</span><span class="ident" id="3798780">cert</span><span class="op" id="3798784">.</span><span class="ident" id="3798785">AuthorityKeyId</span><span class="op" id="3798799">)</span><span class="op" id="3798800">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798803">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798806">if</span>&nbsp;<span class="builtinfunc" id="3798809">len</span><span class="op" id="3798812">(</span><span class="ident" id="3798813">candidates</span><span class="op" id="3798823">)</span>&nbsp;<span class="op" id="3798825">==</span>&nbsp;<span class="num" id="3798828">0</span>&nbsp;<span class="op" id="3798830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798834">candidates</span>&nbsp;<span class="op" id="3798845">=</span>&nbsp;<span class="ident" id="3798847">s</span><span class="op" id="3798848">.</span><span class="ident" id="3798849">byName</span><span class="op" id="3798855">[</span><span class="builtintype" id="3798856">string</span><span class="op" id="3798862">(</span><span class="ident" id="3798863">cert</span><span class="op" id="3798867">.</span><span class="ident" id="3798868">RawIssuer</span><span class="op" id="3798877">)</span><span class="op" id="3798878">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798885">for</span>&nbsp;<span class="ident" id="3798889">_</span><span class="op" id="3798890">,</span>&nbsp;<span class="ident" id="3798892">c</span>&nbsp;<span class="op" id="3798894">:=</span>&nbsp;<span class="keyword" id="3798897">range</span>&nbsp;<span class="ident" id="3798903">candidates</span>&nbsp;<span class="op" id="3798914">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798918">if</span>&nbsp;<span class="ident" id="3798921">err</span>&nbsp;<span class="op" id="3798925">=</span>&nbsp;<span class="ident" id="3798927">cert</span><span class="op" id="3798931">.</span><span class="ident" id="3798932">CheckSignatureFrom</span><span class="op" id="3798950">(</span><span class="ident" id="3798951">s</span><span class="op" id="3798952">.</span><span class="ident" id="3798953">certs</span><span class="op" id="3798958">[</span><span class="ident" id="3798959">c</span><span class="op" id="3798960">]</span><span class="op" id="3798961">)</span><span class="op" id="3798962">;</span>&nbsp;<span class="ident" id="3798964">err</span>&nbsp;<span class="op" id="3798968">==</span>&nbsp;<span class="ident" id="3798971">nil</span>&nbsp;<span class="op" id="3798975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798980">parents</span>&nbsp;<span class="op" id="3798988">=</span>&nbsp;<span class="builtinfunc" id="3798990">append</span><span class="op" id="3798996">(</span><span class="ident" id="3798997">parents</span><span class="op" id="3799004">,</span>&nbsp;<span class="ident" id="3799006">c</span><span class="op" id="3799007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799011">}</span>&nbsp;<span class="keyword" id="3799013">else</span>&nbsp;<span class="op" id="3799018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799023">errCert</span>&nbsp;<span class="op" id="3799031">=</span>&nbsp;<span class="ident" id="3799033">s</span><span class="op" id="3799034">.</span><span class="ident" id="3799035">certs</span><span class="op" id="3799040">[</span><span class="ident" id="3799041">c</span><span class="op" id="3799042">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799046">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799053">return</span><br>
<span class="lineno"></span><span class="op" id="3799060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3799063">//&nbsp;AddCert&nbsp;adds&nbsp;a&nbsp;certificate&nbsp;to&nbsp;a&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="3799104">func</span>&nbsp;<span class="op" id="3799109">(</span><span class="ident" id="3799110">s</span>&nbsp;<span class="op" id="3799112">*</span><span class="ident" id="3799113">CertPool</span><span class="op" id="3799121">)</span>&nbsp;<span class="ident" id="3799123">AddCert</span><span class="op" id="3799130">(</span><span class="ident" id="3799131">cert</span>&nbsp;<span class="op" id="3799136">*</span><span class="ident" id="3799137">Certificate</span><span class="op" id="3799148">)</span>&nbsp;<span class="op" id="3799150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799153">if</span>&nbsp;<span class="ident" id="3799156">cert</span>&nbsp;<span class="op" id="3799161">==</span>&nbsp;<span class="ident" id="3799164">nil</span>&nbsp;<span class="op" id="3799168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3799172">panic</span><span class="op" id="3799177">(</span><span class="string" id="3799178">&#34;adding&nbsp;nil&nbsp;Certificate&nbsp;to&nbsp;CertPool&#34;</span><span class="op" id="3799214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799217">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3799221">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;certificate&nbsp;isn&#39;t&nbsp;being&nbsp;added&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799277">for</span>&nbsp;<span class="ident" id="3799281">_</span><span class="op" id="3799282">,</span>&nbsp;<span class="ident" id="3799284">c</span>&nbsp;<span class="op" id="3799286">:=</span>&nbsp;<span class="keyword" id="3799289">range</span>&nbsp;<span class="ident" id="3799295">s</span><span class="op" id="3799296">.</span><span class="ident" id="3799297">certs</span>&nbsp;<span class="op" id="3799303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799307">if</span>&nbsp;<span class="ident" id="3799310">c</span><span class="op" id="3799311">.</span><span class="ident" id="3799312">Equal</span><span class="op" id="3799317">(</span><span class="ident" id="3799318">cert</span><span class="op" id="3799322">)</span>&nbsp;<span class="op" id="3799324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799329">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799345">n</span>&nbsp;<span class="op" id="3799347">:=</span>&nbsp;<span class="builtinfunc" id="3799350">len</span><span class="op" id="3799353">(</span><span class="ident" id="3799354">s</span><span class="op" id="3799355">.</span><span class="ident" id="3799356">certs</span><span class="op" id="3799361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799364">s</span><span class="op" id="3799365">.</span><span class="ident" id="3799366">certs</span>&nbsp;<span class="op" id="3799372">=</span>&nbsp;<span class="builtinfunc" id="3799374">append</span><span class="op" id="3799380">(</span><span class="ident" id="3799381">s</span><span class="op" id="3799382">.</span><span class="ident" id="3799383">certs</span><span class="op" id="3799388">,</span>&nbsp;<span class="ident" id="3799390">cert</span><span class="op" id="3799394">)</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799398">if</span>&nbsp;<span class="builtinfunc" id="3799401">len</span><span class="op" id="3799404">(</span><span class="ident" id="3799405">cert</span><span class="op" id="3799409">.</span><span class="ident" id="3799410">SubjectKeyId</span><span class="op" id="3799422">)</span>&nbsp;<span class="op" id="3799424">&gt;</span>&nbsp;<span class="num" id="3799426">0</span>&nbsp;<span class="op" id="3799428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799432">keyId</span>&nbsp;<span class="op" id="3799438">:=</span>&nbsp;<span class="builtintype" id="3799441">string</span><span class="op" id="3799447">(</span><span class="ident" id="3799448">cert</span><span class="op" id="3799452">.</span><span class="ident" id="3799453">SubjectKeyId</span><span class="op" id="3799465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799469">s</span><span class="op" id="3799470">.</span><span class="ident" id="3799471">bySubjectKeyId</span><span class="op" id="3799485">[</span><span class="ident" id="3799486">keyId</span><span class="op" id="3799491">]</span>&nbsp;<span class="op" id="3799493">=</span>&nbsp;<span class="builtinfunc" id="3799495">append</span><span class="op" id="3799501">(</span><span class="ident" id="3799502">s</span><span class="op" id="3799503">.</span><span class="ident" id="3799504">bySubjectKeyId</span><span class="op" id="3799518">[</span><span class="ident" id="3799519">keyId</span><span class="op" id="3799524">]</span><span class="op" id="3799525">,</span>&nbsp;<span class="ident" id="3799527">n</span><span class="op" id="3799528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799531">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799534">name</span>&nbsp;<span class="op" id="3799539">:=</span>&nbsp;<span class="builtintype" id="3799542">string</span><span class="op" id="3799548">(</span><span class="ident" id="3799549">cert</span><span class="op" id="3799553">.</span><span class="ident" id="3799554">RawSubject</span><span class="op" id="3799564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799567">s</span><span class="op" id="3799568">.</span><span class="ident" id="3799569">byName</span><span class="op" id="3799575">[</span><span class="ident" id="3799576">name</span><span class="op" id="3799580">]</span>&nbsp;<span class="op" id="3799582">=</span>&nbsp;<span class="builtinfunc" id="3799584">append</span><span class="op" id="3799590">(</span><span class="ident" id="3799591">s</span><span class="op" id="3799592">.</span><span class="ident" id="3799593">byName</span><span class="op" id="3799599">[</span><span class="ident" id="3799600">name</span><span class="op" id="3799604">]</span><span class="op" id="3799605">,</span>&nbsp;<span class="ident" id="3799607">n</span><span class="op" id="3799608">)</span><br>
<span class="lineno"></span><span class="op" id="3799610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3799613">//&nbsp;AppendCertsFromPEM&nbsp;attempts&nbsp;to&nbsp;parse&nbsp;a&nbsp;series&nbsp;of&nbsp;PEM&nbsp;encoded&nbsp;certificates.</span><br>
<span class="lineno">80</span><span class="comment" id="3799691">//&nbsp;It&nbsp;appends&nbsp;any&nbsp;certificates&nbsp;found&nbsp;to&nbsp;s&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;certificates</span><br>
<span class="lineno"></span><span class="comment" id="3799770">//&nbsp;were&nbsp;successfully&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="3799799">//</span><br>
<span class="lineno"></span><span class="comment" id="3799802">//&nbsp;On&nbsp;many&nbsp;Linux&nbsp;systems,&nbsp;/etc/ssl/cert.pem&nbsp;will&nbsp;contain&nbsp;the&nbsp;system&nbsp;wide&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="3799879">//&nbsp;of&nbsp;root&nbsp;CAs&nbsp;in&nbsp;a&nbsp;format&nbsp;suitable&nbsp;for&nbsp;this&nbsp;function.</span><br>
<span class="lineno">85</span><span class="keyword" id="3799934">func</span>&nbsp;<span class="op" id="3799939">(</span><span class="ident" id="3799940">s</span>&nbsp;<span class="op" id="3799942">*</span><span class="ident" id="3799943">CertPool</span><span class="op" id="3799951">)</span>&nbsp;<span class="ident" id="3799953">AppendCertsFromPEM</span><span class="op" id="3799971">(</span><span class="ident" id="3799972">pemCerts</span>&nbsp;<span class="op" id="3799981">[</span><span class="op" id="3799982">]</span><span class="builtintype" id="3799983">byte</span><span class="op" id="3799987">)</span>&nbsp;<span class="op" id="3799989">(</span><span class="ident" id="3799990">ok</span>&nbsp;<span class="builtintype" id="3799993">bool</span><span class="op" id="3799997">)</span>&nbsp;<span class="op" id="3799999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800002">for</span>&nbsp;<span class="builtinfunc" id="3800006">len</span><span class="op" id="3800009">(</span><span class="ident" id="3800010">pemCerts</span><span class="op" id="3800018">)</span>&nbsp;<span class="op" id="3800020">&gt;</span>&nbsp;<span class="num" id="3800022">0</span>&nbsp;<span class="op" id="3800024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800028">var</span>&nbsp;<span class="ident" id="3800032">block</span>&nbsp;<span class="op" id="3800038">*</span><span class="ident" id="3800039">pem</span><span class="op" id="3800042">.</span><span class="ident" id="3800043">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800051">block</span><span class="op" id="3800056">,</span>&nbsp;<span class="ident" id="3800058">pemCerts</span>&nbsp;<span class="op" id="3800067">=</span>&nbsp;<span class="ident" id="3800069">pem</span><span class="op" id="3800072">.</span><span class="ident" id="3800073">Decode</span><span class="op" id="3800079">(</span><span class="ident" id="3800080">pemCerts</span><span class="op" id="3800088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800092">if</span>&nbsp;<span class="ident" id="3800095">block</span>&nbsp;<span class="op" id="3800101">==</span>&nbsp;<span class="ident" id="3800104">nil</span>&nbsp;<span class="op" id="3800108">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800113">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800125">if</span>&nbsp;<span class="ident" id="3800128">block</span><span class="op" id="3800133">.</span><span class="ident" id="3800134">Type</span>&nbsp;<span class="op" id="3800139">!=</span>&nbsp;<span class="string" id="3800142">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="3800156">||</span>&nbsp;<span class="builtinfunc" id="3800159">len</span><span class="op" id="3800162">(</span><span class="ident" id="3800163">block</span><span class="op" id="3800168">.</span><span class="ident" id="3800169">Headers</span><span class="op" id="3800176">)</span>&nbsp;<span class="op" id="3800178">!=</span>&nbsp;<span class="num" id="3800181">0</span>&nbsp;<span class="op" id="3800183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800188">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800199">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800204">cert</span><span class="op" id="3800208">,</span>&nbsp;<span class="ident" id="3800210">err</span>&nbsp;<span class="op" id="3800214">:=</span>&nbsp;<span class="ident" id="3800217">ParseCertificate</span><span class="op" id="3800233">(</span><span class="ident" id="3800234">block</span><span class="op" id="3800239">.</span><span class="ident" id="3800240">Bytes</span><span class="op" id="3800245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800249">if</span>&nbsp;<span class="ident" id="3800252">err</span>&nbsp;<span class="op" id="3800256">!=</span>&nbsp;<span class="ident" id="3800259">nil</span>&nbsp;<span class="op" id="3800263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800268">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800279">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800284">s</span><span class="op" id="3800285">.</span><span class="ident" id="3800286">AddCert</span><span class="op" id="3800293">(</span><span class="ident" id="3800294">cert</span><span class="op" id="3800298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800302">ok</span>&nbsp;<span class="op" id="3800305">=</span>&nbsp;<span class="builtintype" id="3800307">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800317">return</span><br>
<span class="lineno"></span><span class="op" id="3800324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3800327">//&nbsp;Subjects&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;DER-encoded&nbsp;subjects&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3800385">//&nbsp;all&nbsp;of&nbsp;the&nbsp;certificates&nbsp;in&nbsp;the&nbsp;pool.</span><br>
<span class="lineno">110</span><span class="keyword" id="3800425">func</span>&nbsp;<span class="op" id="3800430">(</span><span class="ident" id="3800431">s</span>&nbsp;<span class="op" id="3800433">*</span><span class="ident" id="3800434">CertPool</span><span class="op" id="3800442">)</span>&nbsp;<span class="ident" id="3800444">Subjects</span><span class="op" id="3800452">(</span><span class="op" id="3800453">)</span>&nbsp;<span class="op" id="3800455">(</span><span class="ident" id="3800456">res</span>&nbsp;<span class="op" id="3800460">[</span><span class="op" id="3800461">]</span><span class="op" id="3800462">[</span><span class="op" id="3800463">]</span><span class="builtintype" id="3800464">byte</span><span class="op" id="3800468">)</span>&nbsp;<span class="op" id="3800470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800473">res</span>&nbsp;<span class="op" id="3800477">=</span>&nbsp;<span class="builtinfunc" id="3800479">make</span><span class="op" id="3800483">(</span><span class="op" id="3800484">[</span><span class="op" id="3800485">]</span><span class="op" id="3800486">[</span><span class="op" id="3800487">]</span><span class="builtintype" id="3800488">byte</span><span class="op" id="3800492">,</span>&nbsp;<span class="builtinfunc" id="3800494">len</span><span class="op" id="3800497">(</span><span class="ident" id="3800498">s</span><span class="op" id="3800499">.</span><span class="ident" id="3800500">certs</span><span class="op" id="3800505">)</span><span class="op" id="3800506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800509">for</span>&nbsp;<span class="ident" id="3800513">i</span><span class="op" id="3800514">,</span>&nbsp;<span class="ident" id="3800516">c</span>&nbsp;<span class="op" id="3800518">:=</span>&nbsp;<span class="keyword" id="3800521">range</span>&nbsp;<span class="ident" id="3800527">s</span><span class="op" id="3800528">.</span><span class="ident" id="3800529">certs</span>&nbsp;<span class="op" id="3800535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800539">res</span><span class="op" id="3800542">[</span><span class="ident" id="3800543">i</span><span class="op" id="3800544">]</span>&nbsp;<span class="op" id="3800546">=</span>&nbsp;<span class="ident" id="3800548">c</span><span class="op" id="3800549">.</span><span class="ident" id="3800550">RawSubject</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800562">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800565">return</span><br>
<span class="lineno"></span><span class="op" id="3800572">}</span>
</div>
</body>
</html>
