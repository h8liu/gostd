<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html" class="current">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8120082">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8120137">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8120191">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8120242">package</span>&nbsp;<span class="ident" id="8120250">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8120255">import</span>&nbsp;<span class="op" id="8120262">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8120265">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8120272">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8120278">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8120291">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8120302">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8120313">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8120320">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8120323">func</span>&nbsp;<span class="ident" id="8120328">isTimeout</span><span class="op" id="8120337">(</span><span class="ident" id="8120338">err</span>&nbsp;<span class="builtintype" id="8120342">error</span><span class="op" id="8120347">)</span>&nbsp;<span class="builtintype" id="8120349">bool</span>&nbsp;<span class="op" id="8120354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120357">e</span><span class="op" id="8120358">,</span>&nbsp;<span class="ident" id="8120360">ok</span>&nbsp;<span class="op" id="8120363">:=</span>&nbsp;<span class="ident" id="8120366">err</span><span class="op" id="8120369">.</span><span class="op" id="8120370">(</span><span class="ident" id="8120371">Error</span><span class="op" id="8120376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8120379">return</span>&nbsp;<span class="ident" id="8120386">ok</span>&nbsp;<span class="op" id="8120389">&amp;&amp;</span>&nbsp;<span class="ident" id="8120392">e</span><span class="op" id="8120393">.</span><span class="ident" id="8120394">Timeout</span><span class="op" id="8120401">(</span><span class="op" id="8120402">)</span><br>
<span class="lineno"></span><span class="op" id="8120404">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="8120407">type</span>&nbsp;<span class="ident" id="8120412">copyRes</span>&nbsp;<span class="keyword" id="8120420">struct</span>&nbsp;<span class="op" id="8120427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120430">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8120434">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120441">err</span>&nbsp;<span class="builtintype" id="8120445">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120452">d</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8120456">time</span><span class="op" id="8120460">.</span><span class="ident" id="8120461">Duration</span><br>
<span class="lineno">25</span><span class="op" id="8120470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8120473">func</span>&nbsp;<span class="ident" id="8120478">TestAcceptTimeout</span><span class="op" id="8120495">(</span><span class="ident" id="8120496">t</span>&nbsp;<span class="op" id="8120498">*</span><span class="ident" id="8120499">testing</span><span class="op" id="8120506">.</span><span class="ident" id="8120507">T</span><span class="op" id="8120508">)</span>&nbsp;<span class="op" id="8120510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8120513">switch</span>&nbsp;<span class="ident" id="8120520">runtime</span><span class="op" id="8120527">.</span><span class="ident" id="8120528">GOOS</span>&nbsp;<span class="op" id="8120533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8120536">case</span>&nbsp;<span class="string" id="8120541">&#34;plan9&#34;</span><span class="op" id="8120548">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120552">t</span><span class="op" id="8120553">.</span><span class="ident" id="8120554">Skipf</span><span class="op" id="8120559">(</span><span class="string" id="8120560">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8120581">,</span>&nbsp;<span class="ident" id="8120583">runtime</span><span class="op" id="8120590">.</span><span class="ident" id="8120591">GOOS</span><span class="op" id="8120595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8120598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120602">ln</span>&nbsp;<span class="op" id="8120605">:=</span>&nbsp;<span class="ident" id="8120608">newLocalListener</span><span class="op" id="8120624">(</span><span class="ident" id="8120625">t</span><span class="op" id="8120626">)</span><span class="op" id="8120627">.</span><span class="op" id="8120628">(</span><span class="op" id="8120629">*</span><span class="ident" id="8120630">TCPListener</span><span class="op" id="8120641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8120644">defer</span>&nbsp;<span class="ident" id="8120650">ln</span><span class="op" id="8120652">.</span><span class="ident" id="8120653">Close</span><span class="op" id="8120658">(</span><span class="op" id="8120659">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120662">ln</span><span class="op" id="8120664">.</span><span class="ident" id="8120665">SetDeadline</span><span class="op" id="8120676">(</span><span class="ident" id="8120677">time</span><span class="op" id="8120681">.</span><span class="ident" id="8120682">Now</span><span class="op" id="8120685">(</span><span class="op" id="8120686">)</span><span class="op" id="8120687">.</span><span class="ident" id="8120688">Add</span><span class="op" id="8120691">(</span><span class="op" id="8120692">-</span><span class="num" id="8120693">1</span>&nbsp;<span class="op" id="8120695">*</span>&nbsp;<span class="ident" id="8120697">time</span><span class="op" id="8120701">.</span><span class="ident" id="8120702">Second</span><span class="op" id="8120708">)</span><span class="op" id="8120709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8120712">if</span>&nbsp;<span class="ident" id="8120715">_</span><span class="op" id="8120716">,</span>&nbsp;<span class="ident" id="8120718">err</span>&nbsp;<span class="op" id="8120722">:=</span>&nbsp;<span class="ident" id="8120725">ln</span><span class="op" id="8120727">.</span><span class="ident" id="8120728">Accept</span><span class="op" id="8120734">(</span><span class="op" id="8120735">)</span><span class="op" id="8120736">;</span>&nbsp;<span class="op" id="8120738">!</span><span class="ident" id="8120739">isTimeout</span><span class="op" id="8120748">(</span><span class="ident" id="8120749">err</span><span class="op" id="8120752">)</span>&nbsp;<span class="op" id="8120754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120758">t</span><span class="op" id="8120759">.</span><span class="ident" id="8120760">Fatalf</span><span class="op" id="8120766">(</span><span class="string" id="8120767">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8120800">,</span>&nbsp;<span class="ident" id="8120802">errTimeout</span><span class="op" id="8120812">,</span>&nbsp;<span class="ident" id="8120814">err</span><span class="op" id="8120817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8120820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8120823">if</span>&nbsp;<span class="ident" id="8120826">_</span><span class="op" id="8120827">,</span>&nbsp;<span class="ident" id="8120829">err</span>&nbsp;<span class="op" id="8120833">:=</span>&nbsp;<span class="ident" id="8120836">ln</span><span class="op" id="8120838">.</span><span class="ident" id="8120839">Accept</span><span class="op" id="8120845">(</span><span class="op" id="8120846">)</span><span class="op" id="8120847">;</span>&nbsp;<span class="op" id="8120849">!</span><span class="ident" id="8120850">isTimeout</span><span class="op" id="8120859">(</span><span class="ident" id="8120860">err</span><span class="op" id="8120863">)</span>&nbsp;<span class="op" id="8120865">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120869">t</span><span class="op" id="8120870">.</span><span class="ident" id="8120871">Fatalf</span><span class="op" id="8120877">(</span><span class="string" id="8120878">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8120911">,</span>&nbsp;<span class="ident" id="8120913">errTimeout</span><span class="op" id="8120923">,</span>&nbsp;<span class="ident" id="8120925">err</span><span class="op" id="8120928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8120931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120934">ln</span><span class="op" id="8120936">.</span><span class="ident" id="8120937">SetDeadline</span><span class="op" id="8120948">(</span><span class="ident" id="8120949">time</span><span class="op" id="8120953">.</span><span class="ident" id="8120954">Now</span><span class="op" id="8120957">(</span><span class="op" id="8120958">)</span><span class="op" id="8120959">.</span><span class="ident" id="8120960">Add</span><span class="op" id="8120963">(</span><span class="num" id="8120964">100</span>&nbsp;<span class="op" id="8120968">*</span>&nbsp;<span class="ident" id="8120970">time</span><span class="op" id="8120974">.</span><span class="ident" id="8120975">Millisecond</span><span class="op" id="8120986">)</span><span class="op" id="8120987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8120990">if</span>&nbsp;<span class="ident" id="8120993">_</span><span class="op" id="8120994">,</span>&nbsp;<span class="ident" id="8120996">err</span>&nbsp;<span class="op" id="8121000">:=</span>&nbsp;<span class="ident" id="8121003">ln</span><span class="op" id="8121005">.</span><span class="ident" id="8121006">Accept</span><span class="op" id="8121012">(</span><span class="op" id="8121013">)</span><span class="op" id="8121014">;</span>&nbsp;<span class="op" id="8121016">!</span><span class="ident" id="8121017">isTimeout</span><span class="op" id="8121026">(</span><span class="ident" id="8121027">err</span><span class="op" id="8121030">)</span>&nbsp;<span class="op" id="8121032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121036">t</span><span class="op" id="8121037">.</span><span class="ident" id="8121038">Fatalf</span><span class="op" id="8121044">(</span><span class="string" id="8121045">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8121078">,</span>&nbsp;<span class="ident" id="8121080">errTimeout</span><span class="op" id="8121090">,</span>&nbsp;<span class="ident" id="8121092">err</span><span class="op" id="8121095">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8121098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121101">if</span>&nbsp;<span class="ident" id="8121104">_</span><span class="op" id="8121105">,</span>&nbsp;<span class="ident" id="8121107">err</span>&nbsp;<span class="op" id="8121111">:=</span>&nbsp;<span class="ident" id="8121114">ln</span><span class="op" id="8121116">.</span><span class="ident" id="8121117">Accept</span><span class="op" id="8121123">(</span><span class="op" id="8121124">)</span><span class="op" id="8121125">;</span>&nbsp;<span class="op" id="8121127">!</span><span class="ident" id="8121128">isTimeout</span><span class="op" id="8121137">(</span><span class="ident" id="8121138">err</span><span class="op" id="8121141">)</span>&nbsp;<span class="op" id="8121143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121147">t</span><span class="op" id="8121148">.</span><span class="ident" id="8121149">Fatalf</span><span class="op" id="8121155">(</span><span class="string" id="8121156">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8121189">,</span>&nbsp;<span class="ident" id="8121191">errTimeout</span><span class="op" id="8121201">,</span>&nbsp;<span class="ident" id="8121203">err</span><span class="op" id="8121206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8121209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121212">ln</span><span class="op" id="8121214">.</span><span class="ident" id="8121215">SetDeadline</span><span class="op" id="8121226">(</span><span class="ident" id="8121227">noDeadline</span><span class="op" id="8121237">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121240">errc</span>&nbsp;<span class="op" id="8121245">:=</span>&nbsp;<span class="builtinfunc" id="8121248">make</span><span class="op" id="8121252">(</span><span class="keyword" id="8121253">chan</span>&nbsp;<span class="builtintype" id="8121258">error</span><span class="op" id="8121263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121266">go</span>&nbsp;<span class="keyword" id="8121269">func</span><span class="op" id="8121273">(</span><span class="op" id="8121274">)</span>&nbsp;<span class="op" id="8121276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121280">_</span><span class="op" id="8121281">,</span>&nbsp;<span class="ident" id="8121283">err</span>&nbsp;<span class="op" id="8121287">:=</span>&nbsp;<span class="ident" id="8121290">ln</span><span class="op" id="8121292">.</span><span class="ident" id="8121293">Accept</span><span class="op" id="8121299">(</span><span class="op" id="8121300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121304">errc</span>&nbsp;<span class="op" id="8121309">&lt;-</span>&nbsp;<span class="ident" id="8121312">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8121317">}</span><span class="op" id="8121318">(</span><span class="op" id="8121319">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121322">time</span><span class="op" id="8121326">.</span><span class="ident" id="8121327">Sleep</span><span class="op" id="8121332">(</span><span class="num" id="8121333">100</span>&nbsp;<span class="op" id="8121337">*</span>&nbsp;<span class="ident" id="8121339">time</span><span class="op" id="8121343">.</span><span class="ident" id="8121344">Millisecond</span><span class="op" id="8121355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121358">select</span>&nbsp;<span class="op" id="8121365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121368">case</span>&nbsp;<span class="ident" id="8121373">err</span>&nbsp;<span class="op" id="8121377">:=</span>&nbsp;<span class="op" id="8121380">&lt;-</span><span class="ident" id="8121382">errc</span><span class="op" id="8121386">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121390">t</span><span class="op" id="8121391">.</span><span class="ident" id="8121392">Fatalf</span><span class="op" id="8121398">(</span><span class="string" id="8121399">&#34;Expected&nbsp;Accept()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="8121459">,</span>&nbsp;<span class="ident" id="8121461">err</span><span class="op" id="8121464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121467">default</span><span class="op" id="8121474">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8121477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121480">ln</span><span class="op" id="8121482">.</span><span class="ident" id="8121483">Close</span><span class="op" id="8121488">(</span><span class="op" id="8121489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121492">switch</span>&nbsp;<span class="ident" id="8121499">nerr</span>&nbsp;<span class="op" id="8121504">:=</span>&nbsp;<span class="op" id="8121507">&lt;-</span><span class="ident" id="8121509">errc</span><span class="op" id="8121513">;</span>&nbsp;<span class="ident" id="8121515">err</span>&nbsp;<span class="op" id="8121519">:=</span>&nbsp;<span class="ident" id="8121522">nerr</span><span class="op" id="8121526">.</span><span class="op" id="8121527">(</span><span class="keyword" id="8121528">type</span><span class="op" id="8121532">)</span>&nbsp;<span class="op" id="8121534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121537">case</span>&nbsp;<span class="op" id="8121542">*</span><span class="ident" id="8121543">OpError</span><span class="op" id="8121550">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121554">if</span>&nbsp;<span class="ident" id="8121557">err</span><span class="op" id="8121560">.</span><span class="ident" id="8121561">Err</span>&nbsp;<span class="op" id="8121565">!=</span>&nbsp;<span class="ident" id="8121568">errClosing</span>&nbsp;<span class="op" id="8121579">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121584">t</span><span class="op" id="8121585">.</span><span class="ident" id="8121586">Fatalf</span><span class="op" id="8121592">(</span><span class="string" id="8121593">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8121626">,</span>&nbsp;<span class="ident" id="8121628">errClosing</span><span class="op" id="8121638">,</span>&nbsp;<span class="ident" id="8121640">err</span><span class="op" id="8121643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8121647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121650">default</span><span class="op" id="8121657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121661">if</span>&nbsp;<span class="ident" id="8121664">err</span>&nbsp;<span class="op" id="8121668">!=</span>&nbsp;<span class="ident" id="8121671">errClosing</span>&nbsp;<span class="op" id="8121682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121687">t</span><span class="op" id="8121688">.</span><span class="ident" id="8121689">Fatalf</span><span class="op" id="8121695">(</span><span class="string" id="8121696">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8121729">,</span>&nbsp;<span class="ident" id="8121731">errClosing</span><span class="op" id="8121741">,</span>&nbsp;<span class="ident" id="8121743">err</span><span class="op" id="8121746">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8121750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8121753">}</span><br>
<span class="lineno"></span><span class="op" id="8121755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8121758">func</span>&nbsp;<span class="ident" id="8121763">TestReadTimeout</span><span class="op" id="8121778">(</span><span class="ident" id="8121779">t</span>&nbsp;<span class="op" id="8121781">*</span><span class="ident" id="8121782">testing</span><span class="op" id="8121789">.</span><span class="ident" id="8121790">T</span><span class="op" id="8121791">)</span>&nbsp;<span class="op" id="8121793">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121796">switch</span>&nbsp;<span class="ident" id="8121803">runtime</span><span class="op" id="8121810">.</span><span class="ident" id="8121811">GOOS</span>&nbsp;<span class="op" id="8121816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121819">case</span>&nbsp;<span class="string" id="8121824">&#34;plan9&#34;</span><span class="op" id="8121831">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121835">t</span><span class="op" id="8121836">.</span><span class="ident" id="8121837">Skipf</span><span class="op" id="8121842">(</span><span class="string" id="8121843">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8121864">,</span>&nbsp;<span class="ident" id="8121866">runtime</span><span class="op" id="8121873">.</span><span class="ident" id="8121874">GOOS</span><span class="op" id="8121878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8121881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121885">ln</span>&nbsp;<span class="op" id="8121888">:=</span>&nbsp;<span class="ident" id="8121891">newLocalListener</span><span class="op" id="8121907">(</span><span class="ident" id="8121908">t</span><span class="op" id="8121909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121912">defer</span>&nbsp;<span class="ident" id="8121918">ln</span><span class="op" id="8121920">.</span><span class="ident" id="8121921">Close</span><span class="op" id="8121926">(</span><span class="op" id="8121927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121930">c</span><span class="op" id="8121931">,</span>&nbsp;<span class="ident" id="8121933">err</span>&nbsp;<span class="op" id="8121937">:=</span>&nbsp;<span class="ident" id="8121940">DialTCP</span><span class="op" id="8121947">(</span><span class="string" id="8121948">&#34;tcp&#34;</span><span class="op" id="8121953">,</span>&nbsp;<span class="ident" id="8121955">nil</span><span class="op" id="8121958">,</span>&nbsp;<span class="ident" id="8121960">ln</span><span class="op" id="8121962">.</span><span class="ident" id="8121963">Addr</span><span class="op" id="8121967">(</span><span class="op" id="8121968">)</span><span class="op" id="8121969">.</span><span class="op" id="8121970">(</span><span class="op" id="8121971">*</span><span class="ident" id="8121972">TCPAddr</span><span class="op" id="8121979">)</span><span class="op" id="8121980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8121983">if</span>&nbsp;<span class="ident" id="8121986">err</span>&nbsp;<span class="op" id="8121990">!=</span>&nbsp;<span class="ident" id="8121993">nil</span>&nbsp;<span class="op" id="8121997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122001">t</span><span class="op" id="8122002">.</span><span class="ident" id="8122003">Fatalf</span><span class="op" id="8122009">(</span><span class="string" id="8122010">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="8122023">,</span>&nbsp;<span class="ident" id="8122025">err</span><span class="op" id="8122028">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8122034">defer</span>&nbsp;<span class="ident" id="8122040">c</span><span class="op" id="8122041">.</span><span class="ident" id="8122042">Close</span><span class="op" id="8122047">(</span><span class="op" id="8122048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122051">c</span><span class="op" id="8122052">.</span><span class="ident" id="8122053">SetDeadline</span><span class="op" id="8122064">(</span><span class="ident" id="8122065">time</span><span class="op" id="8122069">.</span><span class="ident" id="8122070">Now</span><span class="op" id="8122073">(</span><span class="op" id="8122074">)</span><span class="op" id="8122075">.</span><span class="ident" id="8122076">Add</span><span class="op" id="8122079">(</span><span class="ident" id="8122080">time</span><span class="op" id="8122084">.</span><span class="ident" id="8122085">Hour</span><span class="op" id="8122089">)</span><span class="op" id="8122090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122093">c</span><span class="op" id="8122094">.</span><span class="ident" id="8122095">SetReadDeadline</span><span class="op" id="8122110">(</span><span class="ident" id="8122111">time</span><span class="op" id="8122115">.</span><span class="ident" id="8122116">Now</span><span class="op" id="8122119">(</span><span class="op" id="8122120">)</span><span class="op" id="8122121">.</span><span class="ident" id="8122122">Add</span><span class="op" id="8122125">(</span><span class="op" id="8122126">-</span><span class="num" id="8122127">1</span>&nbsp;<span class="op" id="8122129">*</span>&nbsp;<span class="ident" id="8122131">time</span><span class="op" id="8122135">.</span><span class="ident" id="8122136">Second</span><span class="op" id="8122142">)</span><span class="op" id="8122143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122146">buf</span>&nbsp;<span class="op" id="8122150">:=</span>&nbsp;<span class="builtinfunc" id="8122153">make</span><span class="op" id="8122157">(</span><span class="op" id="8122158">[</span><span class="op" id="8122159">]</span><span class="builtintype" id="8122160">byte</span><span class="op" id="8122164">,</span>&nbsp;<span class="num" id="8122166">1</span><span class="op" id="8122167">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8122170">if</span>&nbsp;<span class="ident" id="8122173">_</span><span class="op" id="8122174">,</span>&nbsp;<span class="ident" id="8122176">err</span>&nbsp;<span class="op" id="8122180">=</span>&nbsp;<span class="ident" id="8122182">c</span><span class="op" id="8122183">.</span><span class="ident" id="8122184">Read</span><span class="op" id="8122188">(</span><span class="ident" id="8122189">buf</span><span class="op" id="8122192">)</span><span class="op" id="8122193">;</span>&nbsp;<span class="op" id="8122195">!</span><span class="ident" id="8122196">isTimeout</span><span class="op" id="8122205">(</span><span class="ident" id="8122206">err</span><span class="op" id="8122209">)</span>&nbsp;<span class="op" id="8122211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122215">t</span><span class="op" id="8122216">.</span><span class="ident" id="8122217">Fatalf</span><span class="op" id="8122223">(</span><span class="string" id="8122224">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8122255">,</span>&nbsp;<span class="ident" id="8122257">errTimeout</span><span class="op" id="8122267">,</span>&nbsp;<span class="ident" id="8122269">err</span><span class="op" id="8122272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8122278">if</span>&nbsp;<span class="ident" id="8122281">_</span><span class="op" id="8122282">,</span>&nbsp;<span class="ident" id="8122284">err</span>&nbsp;<span class="op" id="8122288">=</span>&nbsp;<span class="ident" id="8122290">c</span><span class="op" id="8122291">.</span><span class="ident" id="8122292">Read</span><span class="op" id="8122296">(</span><span class="ident" id="8122297">buf</span><span class="op" id="8122300">)</span><span class="op" id="8122301">;</span>&nbsp;<span class="op" id="8122303">!</span><span class="ident" id="8122304">isTimeout</span><span class="op" id="8122313">(</span><span class="ident" id="8122314">err</span><span class="op" id="8122317">)</span>&nbsp;<span class="op" id="8122319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122323">t</span><span class="op" id="8122324">.</span><span class="ident" id="8122325">Fatalf</span><span class="op" id="8122331">(</span><span class="string" id="8122332">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8122363">,</span>&nbsp;<span class="ident" id="8122365">errTimeout</span><span class="op" id="8122375">,</span>&nbsp;<span class="ident" id="8122377">err</span><span class="op" id="8122380">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122386">c</span><span class="op" id="8122387">.</span><span class="ident" id="8122388">SetDeadline</span><span class="op" id="8122399">(</span><span class="ident" id="8122400">time</span><span class="op" id="8122404">.</span><span class="ident" id="8122405">Now</span><span class="op" id="8122408">(</span><span class="op" id="8122409">)</span><span class="op" id="8122410">.</span><span class="ident" id="8122411">Add</span><span class="op" id="8122414">(</span><span class="num" id="8122415">100</span>&nbsp;<span class="op" id="8122419">*</span>&nbsp;<span class="ident" id="8122421">time</span><span class="op" id="8122425">.</span><span class="ident" id="8122426">Millisecond</span><span class="op" id="8122437">)</span><span class="op" id="8122438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8122441">if</span>&nbsp;<span class="ident" id="8122444">_</span><span class="op" id="8122445">,</span>&nbsp;<span class="ident" id="8122447">err</span>&nbsp;<span class="op" id="8122451">=</span>&nbsp;<span class="ident" id="8122453">c</span><span class="op" id="8122454">.</span><span class="ident" id="8122455">Read</span><span class="op" id="8122459">(</span><span class="ident" id="8122460">buf</span><span class="op" id="8122463">)</span><span class="op" id="8122464">;</span>&nbsp;<span class="op" id="8122466">!</span><span class="ident" id="8122467">isTimeout</span><span class="op" id="8122476">(</span><span class="ident" id="8122477">err</span><span class="op" id="8122480">)</span>&nbsp;<span class="op" id="8122482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122486">t</span><span class="op" id="8122487">.</span><span class="ident" id="8122488">Fatalf</span><span class="op" id="8122494">(</span><span class="string" id="8122495">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8122526">,</span>&nbsp;<span class="ident" id="8122528">errTimeout</span><span class="op" id="8122538">,</span>&nbsp;<span class="ident" id="8122540">err</span><span class="op" id="8122543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122546">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8122549">if</span>&nbsp;<span class="ident" id="8122552">_</span><span class="op" id="8122553">,</span>&nbsp;<span class="ident" id="8122555">err</span>&nbsp;<span class="op" id="8122559">=</span>&nbsp;<span class="ident" id="8122561">c</span><span class="op" id="8122562">.</span><span class="ident" id="8122563">Read</span><span class="op" id="8122567">(</span><span class="ident" id="8122568">buf</span><span class="op" id="8122571">)</span><span class="op" id="8122572">;</span>&nbsp;<span class="op" id="8122574">!</span><span class="ident" id="8122575">isTimeout</span><span class="op" id="8122584">(</span><span class="ident" id="8122585">err</span><span class="op" id="8122588">)</span>&nbsp;<span class="op" id="8122590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122594">t</span><span class="op" id="8122595">.</span><span class="ident" id="8122596">Fatalf</span><span class="op" id="8122602">(</span><span class="string" id="8122603">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8122634">,</span>&nbsp;<span class="ident" id="8122636">errTimeout</span><span class="op" id="8122646">,</span>&nbsp;<span class="ident" id="8122648">err</span><span class="op" id="8122651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122657">c</span><span class="op" id="8122658">.</span><span class="ident" id="8122659">SetReadDeadline</span><span class="op" id="8122674">(</span><span class="ident" id="8122675">noDeadline</span><span class="op" id="8122685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122688">c</span><span class="op" id="8122689">.</span><span class="ident" id="8122690">SetWriteDeadline</span><span class="op" id="8122706">(</span><span class="ident" id="8122707">time</span><span class="op" id="8122711">.</span><span class="ident" id="8122712">Now</span><span class="op" id="8122715">(</span><span class="op" id="8122716">)</span><span class="op" id="8122717">.</span><span class="ident" id="8122718">Add</span><span class="op" id="8122721">(</span><span class="op" id="8122722">-</span><span class="num" id="8122723">1</span>&nbsp;<span class="op" id="8122725">*</span>&nbsp;<span class="ident" id="8122727">time</span><span class="op" id="8122731">.</span><span class="ident" id="8122732">Second</span><span class="op" id="8122738">)</span><span class="op" id="8122739">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122742">errc</span>&nbsp;<span class="op" id="8122747">:=</span>&nbsp;<span class="builtinfunc" id="8122750">make</span><span class="op" id="8122754">(</span><span class="keyword" id="8122755">chan</span>&nbsp;<span class="builtintype" id="8122760">error</span><span class="op" id="8122765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8122768">go</span>&nbsp;<span class="keyword" id="8122771">func</span><span class="op" id="8122775">(</span><span class="op" id="8122776">)</span>&nbsp;<span class="op" id="8122778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122782">_</span><span class="op" id="8122783">,</span>&nbsp;<span class="ident" id="8122785">err</span>&nbsp;<span class="op" id="8122789">:=</span>&nbsp;<span class="ident" id="8122792">c</span><span class="op" id="8122793">.</span><span class="ident" id="8122794">Read</span><span class="op" id="8122798">(</span><span class="ident" id="8122799">buf</span><span class="op" id="8122802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122806">errc</span>&nbsp;<span class="op" id="8122811">&lt;-</span>&nbsp;<span class="ident" id="8122814">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122819">}</span><span class="op" id="8122820">(</span><span class="op" id="8122821">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122824">time</span><span class="op" id="8122828">.</span><span class="ident" id="8122829">Sleep</span><span class="op" id="8122834">(</span><span class="num" id="8122835">100</span>&nbsp;<span class="op" id="8122839">*</span>&nbsp;<span class="ident" id="8122841">time</span><span class="op" id="8122845">.</span><span class="ident" id="8122846">Millisecond</span><span class="op" id="8122857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8122860">select</span>&nbsp;<span class="op" id="8122867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8122870">case</span>&nbsp;<span class="ident" id="8122875">err</span>&nbsp;<span class="op" id="8122879">:=</span>&nbsp;<span class="op" id="8122882">&lt;-</span><span class="ident" id="8122884">errc</span><span class="op" id="8122888">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122892">t</span><span class="op" id="8122893">.</span><span class="ident" id="8122894">Fatalf</span><span class="op" id="8122900">(</span><span class="string" id="8122901">&#34;Expected&nbsp;Read()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="8122959">,</span>&nbsp;<span class="ident" id="8122961">err</span><span class="op" id="8122964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8122967">default</span><span class="op" id="8122974">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122980">c</span><span class="op" id="8122981">.</span><span class="ident" id="8122982">Close</span><span class="op" id="8122987">(</span><span class="op" id="8122988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8122991">switch</span>&nbsp;<span class="ident" id="8122998">nerr</span>&nbsp;<span class="op" id="8123003">:=</span>&nbsp;<span class="op" id="8123006">&lt;-</span><span class="ident" id="8123008">errc</span><span class="op" id="8123012">;</span>&nbsp;<span class="ident" id="8123014">err</span>&nbsp;<span class="op" id="8123018">:=</span>&nbsp;<span class="ident" id="8123021">nerr</span><span class="op" id="8123025">.</span><span class="op" id="8123026">(</span><span class="keyword" id="8123027">type</span><span class="op" id="8123031">)</span>&nbsp;<span class="op" id="8123033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123036">case</span>&nbsp;<span class="op" id="8123041">*</span><span class="ident" id="8123042">OpError</span><span class="op" id="8123049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123053">if</span>&nbsp;<span class="ident" id="8123056">err</span><span class="op" id="8123059">.</span><span class="ident" id="8123060">Err</span>&nbsp;<span class="op" id="8123064">!=</span>&nbsp;<span class="ident" id="8123067">errClosing</span>&nbsp;<span class="op" id="8123078">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123083">t</span><span class="op" id="8123084">.</span><span class="ident" id="8123085">Fatalf</span><span class="op" id="8123091">(</span><span class="string" id="8123092">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8123123">,</span>&nbsp;<span class="ident" id="8123125">errClosing</span><span class="op" id="8123135">,</span>&nbsp;<span class="ident" id="8123137">err</span><span class="op" id="8123140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123147">default</span><span class="op" id="8123154">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123158">if</span>&nbsp;<span class="ident" id="8123161">err</span>&nbsp;<span class="op" id="8123165">==</span>&nbsp;<span class="ident" id="8123168">io</span><span class="op" id="8123170">.</span><span class="ident" id="8123171">EOF</span>&nbsp;<span class="op" id="8123175">&amp;&amp;</span>&nbsp;<span class="ident" id="8123178">runtime</span><span class="op" id="8123185">.</span><span class="ident" id="8123186">GOOS</span>&nbsp;<span class="op" id="8123191">==</span>&nbsp;<span class="string" id="8123194">&#34;nacl&#34;</span>&nbsp;<span class="op" id="8123201">{</span>&nbsp;<span class="comment" id="8123203">//&nbsp;close&nbsp;enough;&nbsp;golang.org/issue/8044</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123245">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123257">if</span>&nbsp;<span class="ident" id="8123260">err</span>&nbsp;<span class="op" id="8123264">!=</span>&nbsp;<span class="ident" id="8123267">errClosing</span>&nbsp;<span class="op" id="8123278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123283">t</span><span class="op" id="8123284">.</span><span class="ident" id="8123285">Fatalf</span><span class="op" id="8123291">(</span><span class="string" id="8123292">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8123323">,</span>&nbsp;<span class="ident" id="8123325">errClosing</span><span class="op" id="8123335">,</span>&nbsp;<span class="ident" id="8123337">err</span><span class="op" id="8123340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123347">}</span><br>
<span class="lineno">130</span><span class="op" id="8123349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8123352">func</span>&nbsp;<span class="ident" id="8123357">TestWriteTimeout</span><span class="op" id="8123373">(</span><span class="ident" id="8123374">t</span>&nbsp;<span class="op" id="8123376">*</span><span class="ident" id="8123377">testing</span><span class="op" id="8123384">.</span><span class="ident" id="8123385">T</span><span class="op" id="8123386">)</span>&nbsp;<span class="op" id="8123388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123391">switch</span>&nbsp;<span class="ident" id="8123398">runtime</span><span class="op" id="8123405">.</span><span class="ident" id="8123406">GOOS</span>&nbsp;<span class="op" id="8123411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123414">case</span>&nbsp;<span class="string" id="8123419">&#34;plan9&#34;</span><span class="op" id="8123426">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123430">t</span><span class="op" id="8123431">.</span><span class="ident" id="8123432">Skipf</span><span class="op" id="8123437">(</span><span class="string" id="8123438">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8123459">,</span>&nbsp;<span class="ident" id="8123461">runtime</span><span class="op" id="8123468">.</span><span class="ident" id="8123469">GOOS</span><span class="op" id="8123473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123480">ln</span>&nbsp;<span class="op" id="8123483">:=</span>&nbsp;<span class="ident" id="8123486">newLocalListener</span><span class="op" id="8123502">(</span><span class="ident" id="8123503">t</span><span class="op" id="8123504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123507">defer</span>&nbsp;<span class="ident" id="8123513">ln</span><span class="op" id="8123515">.</span><span class="ident" id="8123516">Close</span><span class="op" id="8123521">(</span><span class="op" id="8123522">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123525">c</span><span class="op" id="8123526">,</span>&nbsp;<span class="ident" id="8123528">err</span>&nbsp;<span class="op" id="8123532">:=</span>&nbsp;<span class="ident" id="8123535">DialTCP</span><span class="op" id="8123542">(</span><span class="string" id="8123543">&#34;tcp&#34;</span><span class="op" id="8123548">,</span>&nbsp;<span class="ident" id="8123550">nil</span><span class="op" id="8123553">,</span>&nbsp;<span class="ident" id="8123555">ln</span><span class="op" id="8123557">.</span><span class="ident" id="8123558">Addr</span><span class="op" id="8123562">(</span><span class="op" id="8123563">)</span><span class="op" id="8123564">.</span><span class="op" id="8123565">(</span><span class="op" id="8123566">*</span><span class="ident" id="8123567">TCPAddr</span><span class="op" id="8123574">)</span><span class="op" id="8123575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123578">if</span>&nbsp;<span class="ident" id="8123581">err</span>&nbsp;<span class="op" id="8123585">!=</span>&nbsp;<span class="ident" id="8123588">nil</span>&nbsp;<span class="op" id="8123592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123596">t</span><span class="op" id="8123597">.</span><span class="ident" id="8123598">Fatalf</span><span class="op" id="8123604">(</span><span class="string" id="8123605">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="8123618">,</span>&nbsp;<span class="ident" id="8123620">err</span><span class="op" id="8123623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123629">defer</span>&nbsp;<span class="ident" id="8123635">c</span><span class="op" id="8123636">.</span><span class="ident" id="8123637">Close</span><span class="op" id="8123642">(</span><span class="op" id="8123643">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123646">c</span><span class="op" id="8123647">.</span><span class="ident" id="8123648">SetDeadline</span><span class="op" id="8123659">(</span><span class="ident" id="8123660">time</span><span class="op" id="8123664">.</span><span class="ident" id="8123665">Now</span><span class="op" id="8123668">(</span><span class="op" id="8123669">)</span><span class="op" id="8123670">.</span><span class="ident" id="8123671">Add</span><span class="op" id="8123674">(</span><span class="ident" id="8123675">time</span><span class="op" id="8123679">.</span><span class="ident" id="8123680">Hour</span><span class="op" id="8123684">)</span><span class="op" id="8123685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123688">c</span><span class="op" id="8123689">.</span><span class="ident" id="8123690">SetWriteDeadline</span><span class="op" id="8123706">(</span><span class="ident" id="8123707">time</span><span class="op" id="8123711">.</span><span class="ident" id="8123712">Now</span><span class="op" id="8123715">(</span><span class="op" id="8123716">)</span><span class="op" id="8123717">.</span><span class="ident" id="8123718">Add</span><span class="op" id="8123721">(</span><span class="op" id="8123722">-</span><span class="num" id="8123723">1</span>&nbsp;<span class="op" id="8123725">*</span>&nbsp;<span class="ident" id="8123727">time</span><span class="op" id="8123731">.</span><span class="ident" id="8123732">Second</span><span class="op" id="8123738">)</span><span class="op" id="8123739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123742">buf</span>&nbsp;<span class="op" id="8123746">:=</span>&nbsp;<span class="builtinfunc" id="8123749">make</span><span class="op" id="8123753">(</span><span class="op" id="8123754">[</span><span class="op" id="8123755">]</span><span class="builtintype" id="8123756">byte</span><span class="op" id="8123760">,</span>&nbsp;<span class="num" id="8123762">4096</span><span class="op" id="8123766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123769">writeUntilTimeout</span>&nbsp;<span class="op" id="8123787">:=</span>&nbsp;<span class="keyword" id="8123790">func</span><span class="op" id="8123794">(</span><span class="op" id="8123795">)</span>&nbsp;<span class="op" id="8123797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123801">for</span>&nbsp;<span class="op" id="8123805">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123810">_</span><span class="op" id="8123811">,</span>&nbsp;<span class="ident" id="8123813">err</span>&nbsp;<span class="op" id="8123817">:=</span>&nbsp;<span class="ident" id="8123820">c</span><span class="op" id="8123821">.</span><span class="ident" id="8123822">Write</span><span class="op" id="8123827">(</span><span class="ident" id="8123828">buf</span><span class="op" id="8123831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123836">if</span>&nbsp;<span class="ident" id="8123839">err</span>&nbsp;<span class="op" id="8123843">!=</span>&nbsp;<span class="ident" id="8123846">nil</span>&nbsp;<span class="op" id="8123850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123856">if</span>&nbsp;<span class="ident" id="8123859">isTimeout</span><span class="op" id="8123868">(</span><span class="ident" id="8123869">err</span><span class="op" id="8123872">)</span>&nbsp;<span class="op" id="8123874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123881">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123892">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123898">t</span><span class="op" id="8123899">.</span><span class="ident" id="8123900">Fatalf</span><span class="op" id="8123906">(</span><span class="string" id="8123907">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8123939">,</span>&nbsp;<span class="ident" id="8123941">errTimeout</span><span class="op" id="8123951">,</span>&nbsp;<span class="ident" id="8123953">err</span><span class="op" id="8123956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123971">writeUntilTimeout</span><span class="op" id="8123988">(</span><span class="op" id="8123989">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123992">c</span><span class="op" id="8123993">.</span><span class="ident" id="8123994">SetDeadline</span><span class="op" id="8124005">(</span><span class="ident" id="8124006">time</span><span class="op" id="8124010">.</span><span class="ident" id="8124011">Now</span><span class="op" id="8124014">(</span><span class="op" id="8124015">)</span><span class="op" id="8124016">.</span><span class="ident" id="8124017">Add</span><span class="op" id="8124020">(</span><span class="num" id="8124021">10</span>&nbsp;<span class="op" id="8124024">*</span>&nbsp;<span class="ident" id="8124026">time</span><span class="op" id="8124030">.</span><span class="ident" id="8124031">Millisecond</span><span class="op" id="8124042">)</span><span class="op" id="8124043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124046">writeUntilTimeout</span><span class="op" id="8124063">(</span><span class="op" id="8124064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124067">writeUntilTimeout</span><span class="op" id="8124084">(</span><span class="op" id="8124085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124088">c</span><span class="op" id="8124089">.</span><span class="ident" id="8124090">SetWriteDeadline</span><span class="op" id="8124106">(</span><span class="ident" id="8124107">noDeadline</span><span class="op" id="8124117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124120">c</span><span class="op" id="8124121">.</span><span class="ident" id="8124122">SetReadDeadline</span><span class="op" id="8124137">(</span><span class="ident" id="8124138">time</span><span class="op" id="8124142">.</span><span class="ident" id="8124143">Now</span><span class="op" id="8124146">(</span><span class="op" id="8124147">)</span><span class="op" id="8124148">.</span><span class="ident" id="8124149">Add</span><span class="op" id="8124152">(</span><span class="op" id="8124153">-</span><span class="num" id="8124154">1</span>&nbsp;<span class="op" id="8124156">*</span>&nbsp;<span class="ident" id="8124158">time</span><span class="op" id="8124162">.</span><span class="ident" id="8124163">Second</span><span class="op" id="8124169">)</span><span class="op" id="8124170">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124173">errc</span>&nbsp;<span class="op" id="8124178">:=</span>&nbsp;<span class="builtinfunc" id="8124181">make</span><span class="op" id="8124185">(</span><span class="keyword" id="8124186">chan</span>&nbsp;<span class="builtintype" id="8124191">error</span><span class="op" id="8124196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124199">go</span>&nbsp;<span class="keyword" id="8124202">func</span><span class="op" id="8124206">(</span><span class="op" id="8124207">)</span>&nbsp;<span class="op" id="8124209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124213">for</span>&nbsp;<span class="op" id="8124217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124222">_</span><span class="op" id="8124223">,</span>&nbsp;<span class="ident" id="8124225">err</span>&nbsp;<span class="op" id="8124229">:=</span>&nbsp;<span class="ident" id="8124232">c</span><span class="op" id="8124233">.</span><span class="ident" id="8124234">Write</span><span class="op" id="8124239">(</span><span class="ident" id="8124240">buf</span><span class="op" id="8124243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124248">if</span>&nbsp;<span class="ident" id="8124251">err</span>&nbsp;<span class="op" id="8124255">!=</span>&nbsp;<span class="ident" id="8124258">nil</span>&nbsp;<span class="op" id="8124262">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124268">errc</span>&nbsp;<span class="op" id="8124273">&lt;-</span>&nbsp;<span class="ident" id="8124276">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124290">}</span><span class="op" id="8124291">(</span><span class="op" id="8124292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124295">time</span><span class="op" id="8124299">.</span><span class="ident" id="8124300">Sleep</span><span class="op" id="8124305">(</span><span class="num" id="8124306">100</span>&nbsp;<span class="op" id="8124310">*</span>&nbsp;<span class="ident" id="8124312">time</span><span class="op" id="8124316">.</span><span class="ident" id="8124317">Millisecond</span><span class="op" id="8124328">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124331">select</span>&nbsp;<span class="op" id="8124338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124341">case</span>&nbsp;<span class="ident" id="8124346">err</span>&nbsp;<span class="op" id="8124350">:=</span>&nbsp;<span class="op" id="8124353">&lt;-</span><span class="ident" id="8124355">errc</span><span class="op" id="8124359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124363">t</span><span class="op" id="8124364">.</span><span class="ident" id="8124365">Fatalf</span><span class="op" id="8124371">(</span><span class="string" id="8124372">&#34;Expected&nbsp;Write()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="8124431">,</span>&nbsp;<span class="ident" id="8124433">err</span><span class="op" id="8124436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124439">default</span><span class="op" id="8124446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124449">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124452">c</span><span class="op" id="8124453">.</span><span class="ident" id="8124454">Close</span><span class="op" id="8124459">(</span><span class="op" id="8124460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124463">switch</span>&nbsp;<span class="ident" id="8124470">nerr</span>&nbsp;<span class="op" id="8124475">:=</span>&nbsp;<span class="op" id="8124478">&lt;-</span><span class="ident" id="8124480">errc</span><span class="op" id="8124484">;</span>&nbsp;<span class="ident" id="8124486">err</span>&nbsp;<span class="op" id="8124490">:=</span>&nbsp;<span class="ident" id="8124493">nerr</span><span class="op" id="8124497">.</span><span class="op" id="8124498">(</span><span class="keyword" id="8124499">type</span><span class="op" id="8124503">)</span>&nbsp;<span class="op" id="8124505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124508">case</span>&nbsp;<span class="op" id="8124513">*</span><span class="ident" id="8124514">OpError</span><span class="op" id="8124521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124525">if</span>&nbsp;<span class="ident" id="8124528">err</span><span class="op" id="8124531">.</span><span class="ident" id="8124532">Err</span>&nbsp;<span class="op" id="8124536">!=</span>&nbsp;<span class="ident" id="8124539">errClosing</span>&nbsp;<span class="op" id="8124550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124555">t</span><span class="op" id="8124556">.</span><span class="ident" id="8124557">Fatalf</span><span class="op" id="8124563">(</span><span class="string" id="8124564">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8124596">,</span>&nbsp;<span class="ident" id="8124598">errClosing</span><span class="op" id="8124608">,</span>&nbsp;<span class="ident" id="8124610">err</span><span class="op" id="8124613">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124620">default</span><span class="op" id="8124627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124631">if</span>&nbsp;<span class="ident" id="8124634">err</span>&nbsp;<span class="op" id="8124638">!=</span>&nbsp;<span class="ident" id="8124641">errClosing</span>&nbsp;<span class="op" id="8124652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124657">t</span><span class="op" id="8124658">.</span><span class="ident" id="8124659">Fatalf</span><span class="op" id="8124665">(</span><span class="string" id="8124666">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8124698">,</span>&nbsp;<span class="ident" id="8124700">errClosing</span><span class="op" id="8124710">,</span>&nbsp;<span class="ident" id="8124712">err</span><span class="op" id="8124715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124719">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124722">}</span><br>
<span class="lineno"></span><span class="op" id="8124724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8124727">func</span>&nbsp;<span class="ident" id="8124732">testTimeout</span><span class="op" id="8124743">(</span><span class="ident" id="8124744">t</span>&nbsp;<span class="op" id="8124746">*</span><span class="ident" id="8124747">testing</span><span class="op" id="8124754">.</span><span class="ident" id="8124755">T</span><span class="op" id="8124756">,</span>&nbsp;<span class="ident" id="8124758">net</span><span class="op" id="8124761">,</span>&nbsp;<span class="ident" id="8124763">addr</span>&nbsp;<span class="builtintype" id="8124768">string</span><span class="op" id="8124774">,</span>&nbsp;<span class="ident" id="8124776">readFrom</span>&nbsp;<span class="builtintype" id="8124785">bool</span><span class="op" id="8124789">)</span>&nbsp;<span class="op" id="8124791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124794">c</span><span class="op" id="8124795">,</span>&nbsp;<span class="ident" id="8124797">err</span>&nbsp;<span class="op" id="8124801">:=</span>&nbsp;<span class="ident" id="8124804">Dial</span><span class="op" id="8124808">(</span><span class="ident" id="8124809">net</span><span class="op" id="8124812">,</span>&nbsp;<span class="ident" id="8124814">addr</span><span class="op" id="8124818">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124821">if</span>&nbsp;<span class="ident" id="8124824">err</span>&nbsp;<span class="op" id="8124828">!=</span>&nbsp;<span class="ident" id="8124831">nil</span>&nbsp;<span class="op" id="8124835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124839">t</span><span class="op" id="8124840">.</span><span class="ident" id="8124841">Errorf</span><span class="op" id="8124847">(</span><span class="string" id="8124848">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8124873">,</span>&nbsp;<span class="ident" id="8124875">net</span><span class="op" id="8124878">,</span>&nbsp;<span class="ident" id="8124880">addr</span><span class="op" id="8124884">,</span>&nbsp;<span class="ident" id="8124886">err</span><span class="op" id="8124889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124893">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124904">defer</span>&nbsp;<span class="ident" id="8124910">c</span><span class="op" id="8124911">.</span><span class="ident" id="8124912">Close</span><span class="op" id="8124917">(</span><span class="op" id="8124918">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124921">what</span>&nbsp;<span class="op" id="8124926">:=</span>&nbsp;<span class="string" id="8124929">&#34;Read&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124937">if</span>&nbsp;<span class="ident" id="8124940">readFrom</span>&nbsp;<span class="op" id="8124949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124953">what</span>&nbsp;<span class="op" id="8124958">=</span>&nbsp;<span class="string" id="8124960">&#34;ReadFrom&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124976">errc</span>&nbsp;<span class="op" id="8124981">:=</span>&nbsp;<span class="builtinfunc" id="8124984">make</span><span class="op" id="8124988">(</span><span class="keyword" id="8124989">chan</span>&nbsp;<span class="builtintype" id="8124994">error</span><span class="op" id="8124999">,</span>&nbsp;<span class="num" id="8125001">1</span><span class="op" id="8125002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125005">go</span>&nbsp;<span class="keyword" id="8125008">func</span><span class="op" id="8125012">(</span><span class="op" id="8125013">)</span>&nbsp;<span class="op" id="8125015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125019">t0</span>&nbsp;<span class="op" id="8125022">:=</span>&nbsp;<span class="ident" id="8125025">time</span><span class="op" id="8125029">.</span><span class="ident" id="8125030">Now</span><span class="op" id="8125033">(</span><span class="op" id="8125034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125038">c</span><span class="op" id="8125039">.</span><span class="ident" id="8125040">SetReadDeadline</span><span class="op" id="8125055">(</span><span class="ident" id="8125056">time</span><span class="op" id="8125060">.</span><span class="ident" id="8125061">Now</span><span class="op" id="8125064">(</span><span class="op" id="8125065">)</span><span class="op" id="8125066">.</span><span class="ident" id="8125067">Add</span><span class="op" id="8125070">(</span><span class="num" id="8125071">100</span>&nbsp;<span class="op" id="8125075">*</span>&nbsp;<span class="ident" id="8125077">time</span><span class="op" id="8125081">.</span><span class="ident" id="8125082">Millisecond</span><span class="op" id="8125093">)</span><span class="op" id="8125094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125098">var</span>&nbsp;<span class="ident" id="8125102">b</span>&nbsp;<span class="op" id="8125104">[</span><span class="num" id="8125105">100</span><span class="op" id="8125108">]</span><span class="builtintype" id="8125109">byte</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125116">var</span>&nbsp;<span class="ident" id="8125120">n</span>&nbsp;<span class="builtintype" id="8125122">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125128">var</span>&nbsp;<span class="ident" id="8125132">err</span>&nbsp;<span class="builtintype" id="8125136">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125144">if</span>&nbsp;<span class="ident" id="8125147">readFrom</span>&nbsp;<span class="op" id="8125156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125161">n</span><span class="op" id="8125162">,</span>&nbsp;<span class="ident" id="8125164">_</span><span class="op" id="8125165">,</span>&nbsp;<span class="ident" id="8125167">err</span>&nbsp;<span class="op" id="8125171">=</span>&nbsp;<span class="ident" id="8125173">c</span><span class="op" id="8125174">.</span><span class="op" id="8125175">(</span><span class="ident" id="8125176">PacketConn</span><span class="op" id="8125186">)</span><span class="op" id="8125187">.</span><span class="ident" id="8125188">ReadFrom</span><span class="op" id="8125196">(</span><span class="ident" id="8125197">b</span><span class="op" id="8125198">[</span><span class="num" id="8125199">0</span><span class="op" id="8125200">:</span><span class="op" id="8125201">]</span><span class="op" id="8125202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125206">}</span>&nbsp;<span class="keyword" id="8125208">else</span>&nbsp;<span class="op" id="8125213">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125218">n</span><span class="op" id="8125219">,</span>&nbsp;<span class="ident" id="8125221">err</span>&nbsp;<span class="op" id="8125225">=</span>&nbsp;<span class="ident" id="8125227">c</span><span class="op" id="8125228">.</span><span class="ident" id="8125229">Read</span><span class="op" id="8125233">(</span><span class="ident" id="8125234">b</span><span class="op" id="8125235">[</span><span class="num" id="8125236">0</span><span class="op" id="8125237">:</span><span class="op" id="8125238">]</span><span class="op" id="8125239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125247">t1</span>&nbsp;<span class="op" id="8125250">:=</span>&nbsp;<span class="ident" id="8125253">time</span><span class="op" id="8125257">.</span><span class="ident" id="8125258">Now</span><span class="op" id="8125261">(</span><span class="op" id="8125262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125266">if</span>&nbsp;<span class="ident" id="8125269">n</span>&nbsp;<span class="op" id="8125271">!=</span>&nbsp;<span class="num" id="8125274">0</span>&nbsp;<span class="op" id="8125276">||</span>&nbsp;<span class="ident" id="8125279">err</span>&nbsp;<span class="op" id="8125283">==</span>&nbsp;<span class="ident" id="8125286">nil</span>&nbsp;<span class="op" id="8125290">||</span>&nbsp;<span class="op" id="8125293">!</span><span class="ident" id="8125294">err</span><span class="op" id="8125297">.</span><span class="op" id="8125298">(</span><span class="ident" id="8125299">Error</span><span class="op" id="8125304">)</span><span class="op" id="8125305">.</span><span class="ident" id="8125306">Timeout</span><span class="op" id="8125313">(</span><span class="op" id="8125314">)</span>&nbsp;<span class="op" id="8125316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125321">errc</span>&nbsp;<span class="op" id="8125326">&lt;-</span>&nbsp;<span class="ident" id="8125329">fmt</span><span class="op" id="8125332">.</span><span class="ident" id="8125333">Errorf</span><span class="op" id="8125339">(</span><span class="string" id="8125340">&#34;%s(%q,&nbsp;%q)&nbsp;did&nbsp;not&nbsp;return&nbsp;0,&nbsp;timeout:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8125386">,</span>&nbsp;<span class="ident" id="8125388">what</span><span class="op" id="8125392">,</span>&nbsp;<span class="ident" id="8125394">net</span><span class="op" id="8125397">,</span>&nbsp;<span class="ident" id="8125399">addr</span><span class="op" id="8125403">,</span>&nbsp;<span class="ident" id="8125405">n</span><span class="op" id="8125406">,</span>&nbsp;<span class="ident" id="8125408">err</span><span class="op" id="8125411">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125416">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125429">if</span>&nbsp;<span class="ident" id="8125432">dt</span>&nbsp;<span class="op" id="8125435">:=</span>&nbsp;<span class="ident" id="8125438">t1</span><span class="op" id="8125440">.</span><span class="ident" id="8125441">Sub</span><span class="op" id="8125444">(</span><span class="ident" id="8125445">t0</span><span class="op" id="8125447">)</span><span class="op" id="8125448">;</span>&nbsp;<span class="ident" id="8125450">dt</span>&nbsp;<span class="op" id="8125453">&lt;</span>&nbsp;<span class="num" id="8125455">50</span><span class="op" id="8125457">*</span><span class="ident" id="8125458">time</span><span class="op" id="8125462">.</span><span class="ident" id="8125463">Millisecond</span>&nbsp;<span class="op" id="8125475">||</span>&nbsp;<span class="op" id="8125478">!</span><span class="ident" id="8125479">testing</span><span class="op" id="8125486">.</span><span class="ident" id="8125487">Short</span><span class="op" id="8125492">(</span><span class="op" id="8125493">)</span>&nbsp;<span class="op" id="8125495">&amp;&amp;</span>&nbsp;<span class="ident" id="8125498">dt</span>&nbsp;<span class="op" id="8125501">&gt;</span>&nbsp;<span class="num" id="8125503">250</span><span class="op" id="8125506">*</span><span class="ident" id="8125507">time</span><span class="op" id="8125511">.</span><span class="ident" id="8125512">Millisecond</span>&nbsp;<span class="op" id="8125524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125529">errc</span>&nbsp;<span class="op" id="8125534">&lt;-</span>&nbsp;<span class="ident" id="8125537">fmt</span><span class="op" id="8125540">.</span><span class="ident" id="8125541">Errorf</span><span class="op" id="8125547">(</span><span class="string" id="8125548">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;%s,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="8125583">,</span>&nbsp;<span class="ident" id="8125585">what</span><span class="op" id="8125589">,</span>&nbsp;<span class="ident" id="8125591">net</span><span class="op" id="8125594">,</span>&nbsp;<span class="ident" id="8125596">addr</span><span class="op" id="8125600">,</span>&nbsp;<span class="ident" id="8125602">dt</span><span class="op" id="8125604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125609">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125622">errc</span>&nbsp;<span class="op" id="8125627">&lt;-</span>&nbsp;<span class="ident" id="8125630">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125635">}</span><span class="op" id="8125636">(</span><span class="op" id="8125637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125640">select</span>&nbsp;<span class="op" id="8125647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125650">case</span>&nbsp;<span class="ident" id="8125655">err</span>&nbsp;<span class="op" id="8125659">:=</span>&nbsp;<span class="op" id="8125662">&lt;-</span><span class="ident" id="8125664">errc</span><span class="op" id="8125668">:</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125672">if</span>&nbsp;<span class="ident" id="8125675">err</span>&nbsp;<span class="op" id="8125679">!=</span>&nbsp;<span class="ident" id="8125682">nil</span>&nbsp;<span class="op" id="8125686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125691">t</span><span class="op" id="8125692">.</span><span class="ident" id="8125693">Error</span><span class="op" id="8125698">(</span><span class="ident" id="8125699">err</span><span class="op" id="8125702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125709">case</span>&nbsp;<span class="op" id="8125714">&lt;-</span><span class="ident" id="8125716">time</span><span class="op" id="8125720">.</span><span class="ident" id="8125721">After</span><span class="op" id="8125726">(</span><span class="num" id="8125727">1</span>&nbsp;<span class="op" id="8125729">*</span>&nbsp;<span class="ident" id="8125731">time</span><span class="op" id="8125735">.</span><span class="ident" id="8125736">Second</span><span class="op" id="8125742">)</span><span class="op" id="8125743">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125747">t</span><span class="op" id="8125748">.</span><span class="ident" id="8125749">Errorf</span><span class="op" id="8125755">(</span><span class="string" id="8125756">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;over&nbsp;1&nbsp;second,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="8125802">,</span>&nbsp;<span class="ident" id="8125804">what</span><span class="op" id="8125808">,</span>&nbsp;<span class="ident" id="8125810">net</span><span class="op" id="8125813">,</span>&nbsp;<span class="ident" id="8125815">addr</span><span class="op" id="8125819">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125822">}</span><br>
<span class="lineno"></span><span class="op" id="8125824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8125827">func</span>&nbsp;<span class="ident" id="8125832">TestTimeoutUDP</span><span class="op" id="8125846">(</span><span class="ident" id="8125847">t</span>&nbsp;<span class="op" id="8125849">*</span><span class="ident" id="8125850">testing</span><span class="op" id="8125857">.</span><span class="ident" id="8125858">T</span><span class="op" id="8125859">)</span>&nbsp;<span class="op" id="8125861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125864">switch</span>&nbsp;<span class="ident" id="8125871">runtime</span><span class="op" id="8125878">.</span><span class="ident" id="8125879">GOOS</span>&nbsp;<span class="op" id="8125884">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125887">case</span>&nbsp;<span class="string" id="8125892">&#34;plan9&#34;</span><span class="op" id="8125899">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125903">t</span><span class="op" id="8125904">.</span><span class="ident" id="8125905">Skipf</span><span class="op" id="8125910">(</span><span class="string" id="8125911">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8125932">,</span>&nbsp;<span class="ident" id="8125934">runtime</span><span class="op" id="8125941">.</span><span class="ident" id="8125942">GOOS</span><span class="op" id="8125946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8125953">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125996">listening</span>&nbsp;<span class="op" id="8126006">:=</span>&nbsp;<span class="builtinfunc" id="8126009">make</span><span class="op" id="8126013">(</span><span class="keyword" id="8126014">chan</span>&nbsp;<span class="builtintype" id="8126019">string</span><span class="op" id="8126025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126028">done</span>&nbsp;<span class="op" id="8126033">:=</span>&nbsp;<span class="builtinfunc" id="8126036">make</span><span class="op" id="8126040">(</span><span class="keyword" id="8126041">chan</span>&nbsp;<span class="builtintype" id="8126046">int</span><span class="op" id="8126049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8126052">go</span>&nbsp;<span class="ident" id="8126055">runDatagramPacketConnServer</span><span class="op" id="8126082">(</span><span class="ident" id="8126083">t</span><span class="op" id="8126084">,</span>&nbsp;<span class="string" id="8126086">&#34;udp&#34;</span><span class="op" id="8126091">,</span>&nbsp;<span class="string" id="8126093">&#34;127.0.0.1:0&#34;</span><span class="op" id="8126106">,</span>&nbsp;<span class="ident" id="8126108">listening</span><span class="op" id="8126117">,</span>&nbsp;<span class="ident" id="8126119">done</span><span class="op" id="8126123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126126">addr</span>&nbsp;<span class="op" id="8126131">:=</span>&nbsp;<span class="op" id="8126134">&lt;-</span><span class="ident" id="8126136">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126148">testTimeout</span><span class="op" id="8126159">(</span><span class="ident" id="8126160">t</span><span class="op" id="8126161">,</span>&nbsp;<span class="string" id="8126163">&#34;udp&#34;</span><span class="op" id="8126168">,</span>&nbsp;<span class="ident" id="8126170">addr</span><span class="op" id="8126174">,</span>&nbsp;<span class="builtintype" id="8126176">false</span><span class="op" id="8126181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126184">testTimeout</span><span class="op" id="8126195">(</span><span class="ident" id="8126196">t</span><span class="op" id="8126197">,</span>&nbsp;<span class="string" id="8126199">&#34;udp&#34;</span><span class="op" id="8126204">,</span>&nbsp;<span class="ident" id="8126206">addr</span><span class="op" id="8126210">,</span>&nbsp;<span class="builtintype" id="8126212">true</span><span class="op" id="8126216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8126219">&lt;-</span><span class="ident" id="8126221">done</span><br>
<span class="lineno"></span><span class="op" id="8126226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="8126229">func</span>&nbsp;<span class="ident" id="8126234">TestTimeoutTCP</span><span class="op" id="8126248">(</span><span class="ident" id="8126249">t</span>&nbsp;<span class="op" id="8126251">*</span><span class="ident" id="8126252">testing</span><span class="op" id="8126259">.</span><span class="ident" id="8126260">T</span><span class="op" id="8126261">)</span>&nbsp;<span class="op" id="8126263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8126266">switch</span>&nbsp;<span class="ident" id="8126273">runtime</span><span class="op" id="8126280">.</span><span class="ident" id="8126281">GOOS</span>&nbsp;<span class="op" id="8126286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8126289">case</span>&nbsp;<span class="string" id="8126294">&#34;plan9&#34;</span><span class="op" id="8126301">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126305">t</span><span class="op" id="8126306">.</span><span class="ident" id="8126307">Skipf</span><span class="op" id="8126312">(</span><span class="string" id="8126313">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8126334">,</span>&nbsp;<span class="ident" id="8126336">runtime</span><span class="op" id="8126343">.</span><span class="ident" id="8126344">GOOS</span><span class="op" id="8126348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8126351">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8126355">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126398">listening</span>&nbsp;<span class="op" id="8126408">:=</span>&nbsp;<span class="builtinfunc" id="8126411">make</span><span class="op" id="8126415">(</span><span class="keyword" id="8126416">chan</span>&nbsp;<span class="builtintype" id="8126421">string</span><span class="op" id="8126427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126430">done</span>&nbsp;<span class="op" id="8126435">:=</span>&nbsp;<span class="builtinfunc" id="8126438">make</span><span class="op" id="8126442">(</span><span class="keyword" id="8126443">chan</span>&nbsp;<span class="builtintype" id="8126448">int</span><span class="op" id="8126451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8126454">go</span>&nbsp;<span class="ident" id="8126457">runStreamConnServer</span><span class="op" id="8126476">(</span><span class="ident" id="8126477">t</span><span class="op" id="8126478">,</span>&nbsp;<span class="string" id="8126480">&#34;tcp&#34;</span><span class="op" id="8126485">,</span>&nbsp;<span class="string" id="8126487">&#34;127.0.0.1:0&#34;</span><span class="op" id="8126500">,</span>&nbsp;<span class="ident" id="8126502">listening</span><span class="op" id="8126511">,</span>&nbsp;<span class="ident" id="8126513">done</span><span class="op" id="8126517">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126520">addr</span>&nbsp;<span class="op" id="8126525">:=</span>&nbsp;<span class="op" id="8126528">&lt;-</span><span class="ident" id="8126530">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126542">testTimeout</span><span class="op" id="8126553">(</span><span class="ident" id="8126554">t</span><span class="op" id="8126555">,</span>&nbsp;<span class="string" id="8126557">&#34;tcp&#34;</span><span class="op" id="8126562">,</span>&nbsp;<span class="ident" id="8126564">addr</span><span class="op" id="8126568">,</span>&nbsp;<span class="builtintype" id="8126570">false</span><span class="op" id="8126575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8126578">&lt;-</span><span class="ident" id="8126580">done</span><br>
<span class="lineno"></span><span class="op" id="8126585">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="8126588">func</span>&nbsp;<span class="ident" id="8126593">TestDeadlineReset</span><span class="op" id="8126610">(</span><span class="ident" id="8126611">t</span>&nbsp;<span class="op" id="8126613">*</span><span class="ident" id="8126614">testing</span><span class="op" id="8126621">.</span><span class="ident" id="8126622">T</span><span class="op" id="8126623">)</span>&nbsp;<span class="op" id="8126625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8126628">switch</span>&nbsp;<span class="ident" id="8126635">runtime</span><span class="op" id="8126642">.</span><span class="ident" id="8126643">GOOS</span>&nbsp;<span class="op" id="8126648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8126651">case</span>&nbsp;<span class="string" id="8126656">&#34;plan9&#34;</span><span class="op" id="8126663">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126667">t</span><span class="op" id="8126668">.</span><span class="ident" id="8126669">Skipf</span><span class="op" id="8126674">(</span><span class="string" id="8126675">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8126696">,</span>&nbsp;<span class="ident" id="8126698">runtime</span><span class="op" id="8126705">.</span><span class="ident" id="8126706">GOOS</span><span class="op" id="8126710">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8126713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126716">ln</span><span class="op" id="8126718">,</span>&nbsp;<span class="ident" id="8126720">err</span>&nbsp;<span class="op" id="8126724">:=</span>&nbsp;<span class="ident" id="8126727">Listen</span><span class="op" id="8126733">(</span><span class="string" id="8126734">&#34;tcp&#34;</span><span class="op" id="8126739">,</span>&nbsp;<span class="string" id="8126741">&#34;127.0.0.1:0&#34;</span><span class="op" id="8126754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8126757">if</span>&nbsp;<span class="ident" id="8126760">err</span>&nbsp;<span class="op" id="8126764">!=</span>&nbsp;<span class="ident" id="8126767">nil</span>&nbsp;<span class="op" id="8126771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126775">t</span><span class="op" id="8126776">.</span><span class="ident" id="8126777">Fatal</span><span class="op" id="8126782">(</span><span class="ident" id="8126783">err</span><span class="op" id="8126786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8126789">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8126792">defer</span>&nbsp;<span class="ident" id="8126798">ln</span><span class="op" id="8126800">.</span><span class="ident" id="8126801">Close</span><span class="op" id="8126806">(</span><span class="op" id="8126807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126810">tl</span>&nbsp;<span class="op" id="8126813">:=</span>&nbsp;<span class="ident" id="8126816">ln</span><span class="op" id="8126818">.</span><span class="op" id="8126819">(</span><span class="op" id="8126820">*</span><span class="ident" id="8126821">TCPListener</span><span class="op" id="8126832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126835">tl</span><span class="op" id="8126837">.</span><span class="ident" id="8126838">SetDeadline</span><span class="op" id="8126849">(</span><span class="ident" id="8126850">time</span><span class="op" id="8126854">.</span><span class="ident" id="8126855">Now</span><span class="op" id="8126858">(</span><span class="op" id="8126859">)</span><span class="op" id="8126860">.</span><span class="ident" id="8126861">Add</span><span class="op" id="8126864">(</span><span class="num" id="8126865">1</span>&nbsp;<span class="op" id="8126867">*</span>&nbsp;<span class="ident" id="8126869">time</span><span class="op" id="8126873">.</span><span class="ident" id="8126874">Minute</span><span class="op" id="8126880">)</span><span class="op" id="8126881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126884">tl</span><span class="op" id="8126886">.</span><span class="ident" id="8126887">SetDeadline</span><span class="op" id="8126898">(</span><span class="ident" id="8126899">noDeadline</span><span class="op" id="8126909">)</span>&nbsp;<span class="comment" id="8126911">//&nbsp;reset&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126924">errc</span>&nbsp;<span class="op" id="8126929">:=</span>&nbsp;<span class="builtinfunc" id="8126932">make</span><span class="op" id="8126936">(</span><span class="keyword" id="8126937">chan</span>&nbsp;<span class="builtintype" id="8126942">error</span><span class="op" id="8126947">,</span>&nbsp;<span class="num" id="8126949">1</span><span class="op" id="8126950">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8126953">go</span>&nbsp;<span class="keyword" id="8126956">func</span><span class="op" id="8126960">(</span><span class="op" id="8126961">)</span>&nbsp;<span class="op" id="8126963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126967">_</span><span class="op" id="8126968">,</span>&nbsp;<span class="ident" id="8126970">err</span>&nbsp;<span class="op" id="8126974">:=</span>&nbsp;<span class="ident" id="8126977">ln</span><span class="op" id="8126979">.</span><span class="ident" id="8126980">Accept</span><span class="op" id="8126986">(</span><span class="op" id="8126987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8126991">errc</span>&nbsp;<span class="op" id="8126996">&lt;-</span>&nbsp;<span class="ident" id="8126999">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8127004">}</span><span class="op" id="8127005">(</span><span class="op" id="8127006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127009">select</span>&nbsp;<span class="op" id="8127016">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127019">case</span>&nbsp;<span class="op" id="8127024">&lt;-</span><span class="ident" id="8127026">time</span><span class="op" id="8127030">.</span><span class="ident" id="8127031">After</span><span class="op" id="8127036">(</span><span class="num" id="8127037">50</span>&nbsp;<span class="op" id="8127040">*</span>&nbsp;<span class="ident" id="8127042">time</span><span class="op" id="8127046">.</span><span class="ident" id="8127047">Millisecond</span><span class="op" id="8127058">)</span><span class="op" id="8127059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8127063">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127073">case</span>&nbsp;<span class="ident" id="8127078">err</span>&nbsp;<span class="op" id="8127082">:=</span>&nbsp;<span class="op" id="8127085">&lt;-</span><span class="ident" id="8127087">errc</span><span class="op" id="8127091">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8127095">//&nbsp;Accept&nbsp;should&nbsp;never&nbsp;return;&nbsp;we&nbsp;never</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8127137">//&nbsp;connected&nbsp;to&nbsp;it.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8127159">t</span><span class="op" id="8127160">.</span><span class="ident" id="8127161">Errorf</span><span class="op" id="8127167">(</span><span class="string" id="8127168">&#34;unexpected&nbsp;return&nbsp;from&nbsp;Accept;&nbsp;err=%v&#34;</span><span class="op" id="8127207">,</span>&nbsp;<span class="ident" id="8127209">err</span><span class="op" id="8127212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8127215">}</span><br>
<span class="lineno"></span><span class="op" id="8127217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8127220">func</span>&nbsp;<span class="ident" id="8127225">TestTimeoutAccept</span><span class="op" id="8127242">(</span><span class="ident" id="8127243">t</span>&nbsp;<span class="op" id="8127245">*</span><span class="ident" id="8127246">testing</span><span class="op" id="8127253">.</span><span class="ident" id="8127254">T</span><span class="op" id="8127255">)</span>&nbsp;<span class="op" id="8127257">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127260">switch</span>&nbsp;<span class="ident" id="8127267">runtime</span><span class="op" id="8127274">.</span><span class="ident" id="8127275">GOOS</span>&nbsp;<span class="op" id="8127280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127283">case</span>&nbsp;<span class="string" id="8127288">&#34;plan9&#34;</span><span class="op" id="8127295">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8127299">t</span><span class="op" id="8127300">.</span><span class="ident" id="8127301">Skipf</span><span class="op" id="8127306">(</span><span class="string" id="8127307">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8127328">,</span>&nbsp;<span class="ident" id="8127330">runtime</span><span class="op" id="8127337">.</span><span class="ident" id="8127338">GOOS</span><span class="op" id="8127342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8127345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8127348">ln</span><span class="op" id="8127350">,</span>&nbsp;<span class="ident" id="8127352">err</span>&nbsp;<span class="op" id="8127356">:=</span>&nbsp;<span class="ident" id="8127359">Listen</span><span class="op" id="8127365">(</span><span class="string" id="8127366">&#34;tcp&#34;</span><span class="op" id="8127371">,</span>&nbsp;<span class="string" id="8127373">&#34;127.0.0.1:0&#34;</span><span class="op" id="8127386">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127389">if</span>&nbsp;<span class="ident" id="8127392">err</span>&nbsp;<span class="op" id="8127396">!=</span>&nbsp;<span class="ident" id="8127399">nil</span>&nbsp;<span class="op" id="8127403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8127407">t</span><span class="op" id="8127408">.</span><span class="ident" id="8127409">Fatal</span><span class="op" id="8127414">(</span><span class="ident" id="8127415">err</span><span class="op" id="8127418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8127421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127424">defer</span>&nbsp;<span class="ident" id="8127430">ln</span><span class="op" id="8127432">.</span><span class="ident" id="8127433">Close</span><span class="op" id="8127438">(</span><span class="op" id="8127439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8127442">tl</span>&nbsp;<span class="op" id="8127445">:=</span>&nbsp;<span class="ident" id="8127448">ln</span><span class="op" id="8127450">.</span><span class="op" id="8127451">(</span><span class="op" id="8127452">*</span><span class="ident" id="8127453">TCPListener</span><span class="op" id="8127464">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8127467">tl</span><span class="op" id="8127469">.</span><span class="ident" id="8127470">SetDeadline</span><span class="op" id="8127481">(</span><span class="ident" id="8127482">time</span><span class="op" id="8127486">.</span><span class="ident" id="8127487">Now</span><span class="op" id="8127490">(</span><span class="op" id="8127491">)</span><span class="op" id="8127492">.</span><span class="ident" id="8127493">Add</span><span class="op" id="8127496">(</span><span class="num" id="8127497">100</span>&nbsp;<span class="op" id="8127501">*</span>&nbsp;<span class="ident" id="8127503">time</span><span class="op" id="8127507">.</span><span class="ident" id="8127508">Millisecond</span><span class="op" id="8127519">)</span><span class="op" id="8127520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8127523">errc</span>&nbsp;<span class="op" id="8127528">:=</span>&nbsp;<span class="builtinfunc" id="8127531">make</span><span class="op" id="8127535">(</span><span class="keyword" id="8127536">chan</span>&nbsp;<span class="builtintype" id="8127541">error</span><span class="op" id="8127546">,</span>&nbsp;<span class="num" id="8127548">1</span><span class="op" id="8127549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127552">go</span>&nbsp;<span class="keyword" id="8127555">func</span><span class="op" id="8127559">(</span><span class="op" id="8127560">)</span>&nbsp;<span class="op" id="8127562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8127566">_</span><span class="op" id="8127567">,</span>&nbsp;<span class="ident" id="8127569">err</span>&nbsp;<span class="op" id="8127573">:=</span>&nbsp;<span class="ident" id="8127576">ln</span><span class="op" id="8127578">.</span><span class="ident" id="8127579">Accept</span><span class="op" id="8127585">(</span><span class="op" id="8127586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8127590">errc</span>&nbsp;<span class="op" id="8127595">&lt;-</span>&nbsp;<span class="ident" id="8127598">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8127603">}</span><span class="op" id="8127604">(</span><span class="op" id="8127605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127608">select</span>&nbsp;<span class="op" id="8127615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127618">case</span>&nbsp;<span class="op" id="8127623">&lt;-</span><span class="ident" id="8127625">time</span><span class="op" id="8127629">.</span><span class="ident" id="8127630">After</span><span class="op" id="8127635">(</span><span class="num" id="8127636">1</span>&nbsp;<span class="op" id="8127638">*</span>&nbsp;<span class="ident" id="8127640">time</span><span class="op" id="8127644">.</span><span class="ident" id="8127645">Second</span><span class="op" id="8127651">)</span><span class="op" id="8127652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8127656">//&nbsp;Accept&nbsp;shouldn&#39;t&nbsp;block&nbsp;indefinitely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8127697">t</span><span class="op" id="8127698">.</span><span class="ident" id="8127699">Errorf</span><span class="op" id="8127705">(</span><span class="string" id="8127706">&#34;Accept&nbsp;didn&#39;t&nbsp;return&nbsp;in&nbsp;an&nbsp;expected&nbsp;time&#34;</span><span class="op" id="8127748">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127751">case</span>&nbsp;<span class="op" id="8127756">&lt;-</span><span class="ident" id="8127758">errc</span><span class="op" id="8127762">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8127766">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8127776">}</span><br>
<span class="lineno"></span><span class="op" id="8127778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="8127781">func</span>&nbsp;<span class="ident" id="8127786">TestReadWriteDeadline</span><span class="op" id="8127807">(</span><span class="ident" id="8127808">t</span>&nbsp;<span class="op" id="8127810">*</span><span class="ident" id="8127811">testing</span><span class="op" id="8127818">.</span><span class="ident" id="8127819">T</span><span class="op" id="8127820">)</span>&nbsp;<span class="op" id="8127822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127825">switch</span>&nbsp;<span class="ident" id="8127832">runtime</span><span class="op" id="8127839">.</span><span class="ident" id="8127840">GOOS</span>&nbsp;<span class="op" id="8127845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127848">case</span>&nbsp;<span class="string" id="8127853">&#34;plan9&#34;</span><span class="op" id="8127860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8127864">t</span><span class="op" id="8127865">.</span><span class="ident" id="8127866">Skipf</span><span class="op" id="8127871">(</span><span class="string" id="8127872">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8127893">,</span>&nbsp;<span class="ident" id="8127895">runtime</span><span class="op" id="8127902">.</span><span class="ident" id="8127903">GOOS</span><span class="op" id="8127907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8127910">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8127914">const</span>&nbsp;<span class="op" id="8127920">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8127924">readTimeout</span>&nbsp;&nbsp;<span class="op" id="8127937">=</span>&nbsp;<span class="num" id="8127939">50</span>&nbsp;<span class="op" id="8127942">*</span>&nbsp;<span class="ident" id="8127944">time</span><span class="op" id="8127948">.</span><span class="ident" id="8127949">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8127963">writeTimeout</span>&nbsp;<span class="op" id="8127976">=</span>&nbsp;<span class="num" id="8127978">250</span>&nbsp;<span class="op" id="8127982">*</span>&nbsp;<span class="ident" id="8127984">time</span><span class="op" id="8127988">.</span><span class="ident" id="8127989">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8128002">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128005">checkTimeout</span>&nbsp;<span class="op" id="8128018">:=</span>&nbsp;<span class="keyword" id="8128021">func</span><span class="op" id="8128025">(</span><span class="ident" id="8128026">command</span>&nbsp;<span class="builtintype" id="8128034">string</span><span class="op" id="8128040">,</span>&nbsp;<span class="ident" id="8128042">start</span>&nbsp;<span class="ident" id="8128048">time</span><span class="op" id="8128052">.</span><span class="ident" id="8128053">Time</span><span class="op" id="8128057">,</span>&nbsp;<span class="ident" id="8128059">should</span>&nbsp;<span class="ident" id="8128066">time</span><span class="op" id="8128070">.</span><span class="ident" id="8128071">Duration</span><span class="op" id="8128079">)</span>&nbsp;<span class="op" id="8128081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128085">is</span>&nbsp;<span class="op" id="8128088">:=</span>&nbsp;<span class="ident" id="8128091">time</span><span class="op" id="8128095">.</span><span class="ident" id="8128096">Now</span><span class="op" id="8128099">(</span><span class="op" id="8128100">)</span><span class="op" id="8128101">.</span><span class="ident" id="8128102">Sub</span><span class="op" id="8128105">(</span><span class="ident" id="8128106">start</span><span class="op" id="8128111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128115">d</span>&nbsp;<span class="op" id="8128117">:=</span>&nbsp;<span class="ident" id="8128120">is</span>&nbsp;<span class="op" id="8128123">-</span>&nbsp;<span class="ident" id="8128125">should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8128134">if</span>&nbsp;<span class="ident" id="8128137">d</span>&nbsp;<span class="op" id="8128139">&lt;</span>&nbsp;<span class="op" id="8128141">-</span><span class="num" id="8128142">30</span><span class="op" id="8128144">*</span><span class="ident" id="8128145">time</span><span class="op" id="8128149">.</span><span class="ident" id="8128150">Millisecond</span>&nbsp;<span class="op" id="8128162">||</span>&nbsp;<span class="op" id="8128165">!</span><span class="ident" id="8128166">testing</span><span class="op" id="8128173">.</span><span class="ident" id="8128174">Short</span><span class="op" id="8128179">(</span><span class="op" id="8128180">)</span>&nbsp;<span class="op" id="8128182">&amp;&amp;</span>&nbsp;<span class="num" id="8128185">150</span><span class="op" id="8128188">*</span><span class="ident" id="8128189">time</span><span class="op" id="8128193">.</span><span class="ident" id="8128194">Millisecond</span>&nbsp;<span class="op" id="8128206">&lt;</span>&nbsp;<span class="ident" id="8128208">d</span>&nbsp;<span class="op" id="8128210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128215">t</span><span class="op" id="8128216">.</span><span class="ident" id="8128217">Errorf</span><span class="op" id="8128223">(</span><span class="string" id="8128224">&#34;%s&nbsp;timeout&nbsp;test&nbsp;failed:&nbsp;is=%v&nbsp;should=%v\n&#34;</span><span class="op" id="8128267">,</span>&nbsp;<span class="ident" id="8128269">command</span><span class="op" id="8128276">,</span>&nbsp;<span class="ident" id="8128278">is</span><span class="op" id="8128280">,</span>&nbsp;<span class="ident" id="8128282">should</span><span class="op" id="8128288">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8128292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8128295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128299">ln</span><span class="op" id="8128301">,</span>&nbsp;<span class="ident" id="8128303">err</span>&nbsp;<span class="op" id="8128307">:=</span>&nbsp;<span class="ident" id="8128310">Listen</span><span class="op" id="8128316">(</span><span class="string" id="8128317">&#34;tcp&#34;</span><span class="op" id="8128322">,</span>&nbsp;<span class="string" id="8128324">&#34;127.0.0.1:0&#34;</span><span class="op" id="8128337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8128340">if</span>&nbsp;<span class="ident" id="8128343">err</span>&nbsp;<span class="op" id="8128347">!=</span>&nbsp;<span class="ident" id="8128350">nil</span>&nbsp;<span class="op" id="8128354">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128358">t</span><span class="op" id="8128359">.</span><span class="ident" id="8128360">Fatalf</span><span class="op" id="8128366">(</span><span class="string" id="8128367">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="8128388">,</span>&nbsp;<span class="ident" id="8128390">err</span><span class="op" id="8128393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8128396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8128399">defer</span>&nbsp;<span class="ident" id="8128405">ln</span><span class="op" id="8128407">.</span><span class="ident" id="8128408">Close</span><span class="op" id="8128413">(</span><span class="op" id="8128414">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128418">lnquit</span>&nbsp;<span class="op" id="8128425">:=</span>&nbsp;<span class="builtinfunc" id="8128428">make</span><span class="op" id="8128432">(</span><span class="keyword" id="8128433">chan</span>&nbsp;<span class="builtintype" id="8128438">bool</span><span class="op" id="8128442">)</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8128446">go</span>&nbsp;<span class="keyword" id="8128449">func</span><span class="op" id="8128453">(</span><span class="op" id="8128454">)</span>&nbsp;<span class="op" id="8128456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128460">c</span><span class="op" id="8128461">,</span>&nbsp;<span class="ident" id="8128463">err</span>&nbsp;<span class="op" id="8128467">:=</span>&nbsp;<span class="ident" id="8128470">ln</span><span class="op" id="8128472">.</span><span class="ident" id="8128473">Accept</span><span class="op" id="8128479">(</span><span class="op" id="8128480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8128484">if</span>&nbsp;<span class="ident" id="8128487">err</span>&nbsp;<span class="op" id="8128491">!=</span>&nbsp;<span class="ident" id="8128494">nil</span>&nbsp;<span class="op" id="8128498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128503">t</span><span class="op" id="8128504">.</span><span class="ident" id="8128505">Errorf</span><span class="op" id="8128511">(</span><span class="string" id="8128512">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8128524">,</span>&nbsp;<span class="ident" id="8128526">err</span><span class="op" id="8128529">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8128534">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8128543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8128547">defer</span>&nbsp;<span class="ident" id="8128553">c</span><span class="op" id="8128554">.</span><span class="ident" id="8128555">Close</span><span class="op" id="8128560">(</span><span class="op" id="8128561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128565">lnquit</span>&nbsp;<span class="op" id="8128572">&lt;-</span>&nbsp;<span class="builtintype" id="8128575">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8128581">}</span><span class="op" id="8128582">(</span><span class="op" id="8128583">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128587">c</span><span class="op" id="8128588">,</span>&nbsp;<span class="ident" id="8128590">err</span>&nbsp;<span class="op" id="8128594">:=</span>&nbsp;<span class="ident" id="8128597">Dial</span><span class="op" id="8128601">(</span><span class="string" id="8128602">&#34;tcp&#34;</span><span class="op" id="8128607">,</span>&nbsp;<span class="ident" id="8128609">ln</span><span class="op" id="8128611">.</span><span class="ident" id="8128612">Addr</span><span class="op" id="8128616">(</span><span class="op" id="8128617">)</span><span class="op" id="8128618">.</span><span class="ident" id="8128619">String</span><span class="op" id="8128625">(</span><span class="op" id="8128626">)</span><span class="op" id="8128627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8128630">if</span>&nbsp;<span class="ident" id="8128633">err</span>&nbsp;<span class="op" id="8128637">!=</span>&nbsp;<span class="ident" id="8128640">nil</span>&nbsp;<span class="op" id="8128644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128648">t</span><span class="op" id="8128649">.</span><span class="ident" id="8128650">Fatalf</span><span class="op" id="8128656">(</span><span class="string" id="8128657">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8128667">,</span>&nbsp;<span class="ident" id="8128669">err</span><span class="op" id="8128672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8128675">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8128678">defer</span>&nbsp;<span class="ident" id="8128684">c</span><span class="op" id="8128685">.</span><span class="ident" id="8128686">Close</span><span class="op" id="8128691">(</span><span class="op" id="8128692">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128696">start</span>&nbsp;<span class="op" id="8128702">:=</span>&nbsp;<span class="ident" id="8128705">time</span><span class="op" id="8128709">.</span><span class="ident" id="8128710">Now</span><span class="op" id="8128713">(</span><span class="op" id="8128714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128717">err</span>&nbsp;<span class="op" id="8128721">=</span>&nbsp;<span class="ident" id="8128723">c</span><span class="op" id="8128724">.</span><span class="ident" id="8128725">SetReadDeadline</span><span class="op" id="8128740">(</span><span class="ident" id="8128741">start</span><span class="op" id="8128746">.</span><span class="ident" id="8128747">Add</span><span class="op" id="8128750">(</span><span class="ident" id="8128751">readTimeout</span><span class="op" id="8128762">)</span><span class="op" id="8128763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8128766">if</span>&nbsp;<span class="ident" id="8128769">err</span>&nbsp;<span class="op" id="8128773">!=</span>&nbsp;<span class="ident" id="8128776">nil</span>&nbsp;<span class="op" id="8128780">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128784">t</span><span class="op" id="8128785">.</span><span class="ident" id="8128786">Fatalf</span><span class="op" id="8128792">(</span><span class="string" id="8128793">&#34;SetReadDeadline:&nbsp;%v&#34;</span><span class="op" id="8128814">,</span>&nbsp;<span class="ident" id="8128816">err</span><span class="op" id="8128819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8128822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128825">err</span>&nbsp;<span class="op" id="8128829">=</span>&nbsp;<span class="ident" id="8128831">c</span><span class="op" id="8128832">.</span><span class="ident" id="8128833">SetWriteDeadline</span><span class="op" id="8128849">(</span><span class="ident" id="8128850">start</span><span class="op" id="8128855">.</span><span class="ident" id="8128856">Add</span><span class="op" id="8128859">(</span><span class="ident" id="8128860">writeTimeout</span><span class="op" id="8128872">)</span><span class="op" id="8128873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8128876">if</span>&nbsp;<span class="ident" id="8128879">err</span>&nbsp;<span class="op" id="8128883">!=</span>&nbsp;<span class="ident" id="8128886">nil</span>&nbsp;<span class="op" id="8128890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128894">t</span><span class="op" id="8128895">.</span><span class="ident" id="8128896">Fatalf</span><span class="op" id="8128902">(</span><span class="string" id="8128903">&#34;SetWriteDeadline:&nbsp;%v&#34;</span><span class="op" id="8128925">,</span>&nbsp;<span class="ident" id="8128927">err</span><span class="op" id="8128930">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8128933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128937">quit</span>&nbsp;<span class="op" id="8128942">:=</span>&nbsp;<span class="builtinfunc" id="8128945">make</span><span class="op" id="8128949">(</span><span class="keyword" id="8128950">chan</span>&nbsp;<span class="builtintype" id="8128955">bool</span><span class="op" id="8128959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8128963">go</span>&nbsp;<span class="keyword" id="8128966">func</span><span class="op" id="8128970">(</span><span class="op" id="8128971">)</span>&nbsp;<span class="op" id="8128973">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8128977">var</span>&nbsp;<span class="ident" id="8128981">buf</span>&nbsp;<span class="op" id="8128985">[</span><span class="num" id="8128986">10</span><span class="op" id="8128988">]</span><span class="builtintype" id="8128989">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8128996">_</span><span class="op" id="8128997">,</span>&nbsp;<span class="ident" id="8128999">err</span>&nbsp;<span class="op" id="8129003">:=</span>&nbsp;<span class="ident" id="8129006">c</span><span class="op" id="8129007">.</span><span class="ident" id="8129008">Read</span><span class="op" id="8129012">(</span><span class="ident" id="8129013">buf</span><span class="op" id="8129016">[</span><span class="op" id="8129017">:</span><span class="op" id="8129018">]</span><span class="op" id="8129019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8129023">if</span>&nbsp;<span class="ident" id="8129026">err</span>&nbsp;<span class="op" id="8129030">==</span>&nbsp;<span class="ident" id="8129033">nil</span>&nbsp;<span class="op" id="8129037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8129042">t</span><span class="op" id="8129043">.</span><span class="ident" id="8129044">Errorf</span><span class="op" id="8129050">(</span><span class="string" id="8129051">&#34;Read&nbsp;should&nbsp;not&nbsp;succeed&#34;</span><span class="op" id="8129076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8129080">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8129084">checkTimeout</span><span class="op" id="8129096">(</span><span class="string" id="8129097">&#34;Read&#34;</span><span class="op" id="8129103">,</span>&nbsp;<span class="ident" id="8129105">start</span><span class="op" id="8129110">,</span>&nbsp;<span class="ident" id="8129112">readTimeout</span><span class="op" id="8129123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8129127">quit</span>&nbsp;<span class="op" id="8129132">&lt;-</span>&nbsp;<span class="builtintype" id="8129135">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8129141">}</span><span class="op" id="8129142">(</span><span class="op" id="8129143">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8129147">go</span>&nbsp;<span class="keyword" id="8129150">func</span><span class="op" id="8129154">(</span><span class="op" id="8129155">)</span>&nbsp;<span class="op" id="8129157">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8129161">var</span>&nbsp;<span class="ident" id="8129165">buf</span>&nbsp;<span class="op" id="8129169">[</span><span class="num" id="8129170">10000</span><span class="op" id="8129175">]</span><span class="builtintype" id="8129176">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8129183">for</span>&nbsp;<span class="op" id="8129187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8129192">_</span><span class="op" id="8129193">,</span>&nbsp;<span class="ident" id="8129195">err</span>&nbsp;<span class="op" id="8129199">:=</span>&nbsp;<span class="ident" id="8129202">c</span><span class="op" id="8129203">.</span><span class="ident" id="8129204">Write</span><span class="op" id="8129209">(</span><span class="ident" id="8129210">buf</span><span class="op" id="8129213">[</span><span class="op" id="8129214">:</span><span class="op" id="8129215">]</span><span class="op" id="8129216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8129221">if</span>&nbsp;<span class="ident" id="8129224">err</span>&nbsp;<span class="op" id="8129228">!=</span>&nbsp;<span class="ident" id="8129231">nil</span>&nbsp;<span class="op" id="8129235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8129241">break</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8129250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8129254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8129258">checkTimeout</span><span class="op" id="8129270">(</span><span class="string" id="8129271">&#34;Write&#34;</span><span class="op" id="8129278">,</span>&nbsp;<span class="ident" id="8129280">start</span><span class="op" id="8129285">,</span>&nbsp;<span class="ident" id="8129287">writeTimeout</span><span class="op" id="8129299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8129303">quit</span>&nbsp;<span class="op" id="8129308">&lt;-</span>&nbsp;<span class="builtintype" id="8129311">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8129317">}</span><span class="op" id="8129318">(</span><span class="op" id="8129319">)</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8129323">&lt;-</span><span class="ident" id="8129325">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8129331">&lt;-</span><span class="ident" id="8129333">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8129339">&lt;-</span><span class="ident" id="8129341">lnquit</span><br>
<span class="lineno"></span><span class="op" id="8129348">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="8129351">type</span>&nbsp;<span class="ident" id="8129356">neverEnding</span>&nbsp;<span class="builtintype" id="8129368">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8129374">func</span>&nbsp;<span class="op" id="8129379">(</span><span class="ident" id="8129380">b</span>&nbsp;<span class="ident" id="8129382">neverEnding</span><span class="op" id="8129393">)</span>&nbsp;<span class="ident" id="8129395">Read</span><span class="op" id="8129399">(</span><span class="ident" id="8129400">p</span>&nbsp;<span class="op" id="8129402">[</span><span class="op" id="8129403">]</span><span class="builtintype" id="8129404">byte</span><span class="op" id="8129408">)</span>&nbsp;<span class="op" id="8129410">(</span><span class="ident" id="8129411">n</span>&nbsp;<span class="builtintype" id="8129413">int</span><span class="op" id="8129416">,</span>&nbsp;<span class="ident" id="8129418">err</span>&nbsp;<span class="builtintype" id="8129422">error</span><span class="op" id="8129427">)</span>&nbsp;<span class="op" id="8129429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8129432">for</span>&nbsp;<span class="ident" id="8129436">i</span>&nbsp;<span class="op" id="8129438">:=</span>&nbsp;<span class="keyword" id="8129441">range</span>&nbsp;<span class="ident" id="8129447">p</span>&nbsp;<span class="op" id="8129449">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8129453">p</span><span class="op" id="8129454">[</span><span class="ident" id="8129455">i</span><span class="op" id="8129456">]</span>&nbsp;<span class="op" id="8129458">=</span>&nbsp;<span class="builtintype" id="8129460">byte</span><span class="op" id="8129464">(</span><span class="ident" id="8129465">b</span><span class="op" id="8129466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8129469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8129472">return</span>&nbsp;<span class="builtinfunc" id="8129479">len</span><span class="op" id="8129482">(</span><span class="ident" id="8129483">p</span><span class="op" id="8129484">)</span><span class="op" id="8129485">,</span>&nbsp;<span class="ident" id="8129487">nil</span><br>
<span class="lineno"></span><span class="op" id="8129491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="8129494">func</span>&nbsp;<span class="ident" id="8129499">TestVariousDeadlines1Proc</span><span class="op" id="8129524">(</span><span class="ident" id="8129525">t</span>&nbsp;<span class="op" id="8129527">*</span><span class="ident" id="8129528">testing</span><span class="op" id="8129535">.</span><span class="ident" id="8129536">T</span><span class="op" id="8129537">)</span>&nbsp;<span class="op" id="8129539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8129542">testVariousDeadlines</span><span class="op" id="8129562">(</span><span class="ident" id="8129563">t</span><span class="op" id="8129564">,</span>&nbsp;<span class="num" id="8129566">1</span><span class="op" id="8129567">)</span><br>
<span class="lineno"></span><span class="op" id="8129569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8129572">func</span>&nbsp;<span class="ident" id="8129577">TestVariousDeadlines4Proc</span><span class="op" id="8129602">(</span><span class="ident" id="8129603">t</span>&nbsp;<span class="op" id="8129605">*</span><span class="ident" id="8129606">testing</span><span class="op" id="8129613">.</span><span class="ident" id="8129614">T</span><span class="op" id="8129615">)</span>&nbsp;<span class="op" id="8129617">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8129620">testVariousDeadlines</span><span class="op" id="8129640">(</span><span class="ident" id="8129641">t</span><span class="op" id="8129642">,</span>&nbsp;<span class="num" id="8129644">4</span><span class="op" id="8129645">)</span><br>
<span class="lineno"></span><span class="op" id="8129647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8129650">func</span>&nbsp;<span class="ident" id="8129655">testVariousDeadlines</span><span class="op" id="8129675">(</span><span class="ident" id="8129676">t</span>&nbsp;<span class="op" id="8129678">*</span><span class="ident" id="8129679">testing</span><span class="op" id="8129686">.</span><span class="ident" id="8129687">T</span><span class="op" id="8129688">,</span>&nbsp;<span class="ident" id="8129690">maxProcs</span>&nbsp;<span class="builtintype" id="8129699">int</span><span class="op" id="8129702">)</span>&nbsp;<span class="op" id="8129704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8129707">switch</span>&nbsp;<span class="ident" id="8129714">runtime</span><span class="op" id="8129721">.</span><span class="ident" id="8129722">GOOS</span>&nbsp;<span class="op" id="8129727">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8129730">case</span>&nbsp;<span class="string" id="8129735">&#34;plan9&#34;</span><span class="op" id="8129742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8129746">t</span><span class="op" id="8129747">.</span><span class="ident" id="8129748">Skipf</span><span class="op" id="8129753">(</span><span class="string" id="8129754">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8129775">,</span>&nbsp;<span class="ident" id="8129777">runtime</span><span class="op" id="8129784">.</span><span class="ident" id="8129785">GOOS</span><span class="op" id="8129789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8129792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8129796">defer</span>&nbsp;<span class="ident" id="8129802">runtime</span><span class="op" id="8129809">.</span><span class="ident" id="8129810">GOMAXPROCS</span><span class="op" id="8129820">(</span><span class="ident" id="8129821">runtime</span><span class="op" id="8129828">.</span><span class="ident" id="8129829">GOMAXPROCS</span><span class="op" id="8129839">(</span><span class="ident" id="8129840">maxProcs</span><span class="op" id="8129848">)</span><span class="op" id="8129849">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8129852">ln</span>&nbsp;<span class="op" id="8129855">:=</span>&nbsp;<span class="ident" id="8129858">newLocalListener</span><span class="op" id="8129874">(</span><span class="ident" id="8129875">t</span><span class="op" id="8129876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8129879">defer</span>&nbsp;<span class="ident" id="8129885">ln</span><span class="op" id="8129887">.</span><span class="ident" id="8129888">Close</span><span class="op" id="8129893">(</span><span class="op" id="8129894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8129897">acceptc</span>&nbsp;<span class="op" id="8129905">:=</span>&nbsp;<span class="builtinfunc" id="8129908">make</span><span class="op" id="8129912">(</span><span class="keyword" id="8129913">chan</span>&nbsp;<span class="builtintype" id="8129918">error</span><span class="op" id="8129923">,</span>&nbsp;<span class="num" id="8129925">1</span><span class="op" id="8129926">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8129930">//&nbsp;The&nbsp;server,&nbsp;with&nbsp;no&nbsp;timeouts&nbsp;of&nbsp;its&nbsp;own,&nbsp;sending&nbsp;bytes&nbsp;to&nbsp;clients</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8130000">//&nbsp;as&nbsp;fast&nbsp;as&nbsp;it&nbsp;can.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8130023">servec</span>&nbsp;<span class="op" id="8130030">:=</span>&nbsp;<span class="builtinfunc" id="8130033">make</span><span class="op" id="8130037">(</span><span class="keyword" id="8130038">chan</span>&nbsp;<span class="ident" id="8130043">copyRes</span><span class="op" id="8130050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8130053">go</span>&nbsp;<span class="keyword" id="8130056">func</span><span class="op" id="8130060">(</span><span class="op" id="8130061">)</span>&nbsp;<span class="op" id="8130063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8130067">for</span>&nbsp;<span class="op" id="8130071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8130076">c</span><span class="op" id="8130077">,</span>&nbsp;<span class="ident" id="8130079">err</span>&nbsp;<span class="op" id="8130083">:=</span>&nbsp;<span class="ident" id="8130086">ln</span><span class="op" id="8130088">.</span><span class="ident" id="8130089">Accept</span><span class="op" id="8130095">(</span><span class="op" id="8130096">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8130101">if</span>&nbsp;<span class="ident" id="8130104">err</span>&nbsp;<span class="op" id="8130108">!=</span>&nbsp;<span class="ident" id="8130111">nil</span>&nbsp;<span class="op" id="8130115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8130121">acceptc</span>&nbsp;<span class="op" id="8130129">&lt;-</span>&nbsp;<span class="ident" id="8130132">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8130140">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8130150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8130155">go</span>&nbsp;<span class="keyword" id="8130158">func</span><span class="op" id="8130162">(</span><span class="op" id="8130163">)</span>&nbsp;<span class="op" id="8130165">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8130171">t0</span>&nbsp;<span class="op" id="8130174">:=</span>&nbsp;<span class="ident" id="8130177">time</span><span class="op" id="8130181">.</span><span class="ident" id="8130182">Now</span><span class="op" id="8130185">(</span><span class="op" id="8130186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8130192">n</span><span class="op" id="8130193">,</span>&nbsp;<span class="ident" id="8130195">err</span>&nbsp;<span class="op" id="8130199">:=</span>&nbsp;<span class="ident" id="8130202">io</span><span class="op" id="8130204">.</span><span class="ident" id="8130205">Copy</span><span class="op" id="8130209">(</span><span class="ident" id="8130210">c</span><span class="op" id="8130211">,</span>&nbsp;<span class="ident" id="8130213">neverEnding</span><span class="op" id="8130224">(</span><span class="string" id="8130225">&#39;a&#39;</span><span class="op" id="8130228">)</span><span class="op" id="8130229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8130235">d</span>&nbsp;<span class="op" id="8130237">:=</span>&nbsp;<span class="ident" id="8130240">time</span><span class="op" id="8130244">.</span><span class="ident" id="8130245">Since</span><span class="op" id="8130250">(</span><span class="ident" id="8130251">t0</span><span class="op" id="8130253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8130259">c</span><span class="op" id="8130260">.</span><span class="ident" id="8130261">Close</span><span class="op" id="8130266">(</span><span class="op" id="8130267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8130273">servec</span>&nbsp;<span class="op" id="8130280">&lt;-</span>&nbsp;<span class="ident" id="8130283">copyRes</span><span class="op" id="8130290">{</span><span class="ident" id="8130291">n</span><span class="op" id="8130292">,</span>&nbsp;<span class="ident" id="8130294">err</span><span class="op" id="8130297">,</span>&nbsp;<span class="ident" id="8130299">d</span><span class="op" id="8130300">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8130305">}</span><span class="op" id="8130306">(</span><span class="op" id="8130307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8130311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8130314">}</span><span class="op" id="8130315">(</span><span class="op" id="8130316">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8130320">for</span>&nbsp;<span class="ident" id="8130324">_</span><span class="op" id="8130325">,</span>&nbsp;<span class="ident" id="8130327">timeout</span>&nbsp;<span class="op" id="8130335">:=</span>&nbsp;<span class="keyword" id="8130338">range</span>&nbsp;<span class="op" id="8130344">[</span><span class="op" id="8130345">]</span><span class="ident" id="8130346">time</span><span class="op" id="8130350">.</span><span class="ident" id="8130351">Duration</span><span class="op" id="8130359">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130363">1</span>&nbsp;<span class="op" id="8130365">*</span>&nbsp;<span class="ident" id="8130367">time</span><span class="op" id="8130371">.</span><span class="ident" id="8130372">Nanosecond</span><span class="op" id="8130382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130386">2</span>&nbsp;<span class="op" id="8130388">*</span>&nbsp;<span class="ident" id="8130390">time</span><span class="op" id="8130394">.</span><span class="ident" id="8130395">Nanosecond</span><span class="op" id="8130405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130409">5</span>&nbsp;<span class="op" id="8130411">*</span>&nbsp;<span class="ident" id="8130413">time</span><span class="op" id="8130417">.</span><span class="ident" id="8130418">Nanosecond</span><span class="op" id="8130428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130432">50</span>&nbsp;<span class="op" id="8130435">*</span>&nbsp;<span class="ident" id="8130437">time</span><span class="op" id="8130441">.</span><span class="ident" id="8130442">Nanosecond</span><span class="op" id="8130452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130456">100</span>&nbsp;<span class="op" id="8130460">*</span>&nbsp;<span class="ident" id="8130462">time</span><span class="op" id="8130466">.</span><span class="ident" id="8130467">Nanosecond</span><span class="op" id="8130477">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130481">200</span>&nbsp;<span class="op" id="8130485">*</span>&nbsp;<span class="ident" id="8130487">time</span><span class="op" id="8130491">.</span><span class="ident" id="8130492">Nanosecond</span><span class="op" id="8130502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130506">500</span>&nbsp;<span class="op" id="8130510">*</span>&nbsp;<span class="ident" id="8130512">time</span><span class="op" id="8130516">.</span><span class="ident" id="8130517">Nanosecond</span><span class="op" id="8130527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130531">750</span>&nbsp;<span class="op" id="8130535">*</span>&nbsp;<span class="ident" id="8130537">time</span><span class="op" id="8130541">.</span><span class="ident" id="8130542">Nanosecond</span><span class="op" id="8130552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130556">1</span>&nbsp;<span class="op" id="8130558">*</span>&nbsp;<span class="ident" id="8130560">time</span><span class="op" id="8130564">.</span><span class="ident" id="8130565">Microsecond</span><span class="op" id="8130576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130580">5</span>&nbsp;<span class="op" id="8130582">*</span>&nbsp;<span class="ident" id="8130584">time</span><span class="op" id="8130588">.</span><span class="ident" id="8130589">Microsecond</span><span class="op" id="8130600">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130604">25</span>&nbsp;<span class="op" id="8130607">*</span>&nbsp;<span class="ident" id="8130609">time</span><span class="op" id="8130613">.</span><span class="ident" id="8130614">Microsecond</span><span class="op" id="8130625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130629">250</span>&nbsp;<span class="op" id="8130633">*</span>&nbsp;<span class="ident" id="8130635">time</span><span class="op" id="8130639">.</span><span class="ident" id="8130640">Microsecond</span><span class="op" id="8130651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130655">500</span>&nbsp;<span class="op" id="8130659">*</span>&nbsp;<span class="ident" id="8130661">time</span><span class="op" id="8130665">.</span><span class="ident" id="8130666">Microsecond</span><span class="op" id="8130677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130681">1</span>&nbsp;<span class="op" id="8130683">*</span>&nbsp;<span class="ident" id="8130685">time</span><span class="op" id="8130689">.</span><span class="ident" id="8130690">Millisecond</span><span class="op" id="8130701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130705">5</span>&nbsp;<span class="op" id="8130707">*</span>&nbsp;<span class="ident" id="8130709">time</span><span class="op" id="8130713">.</span><span class="ident" id="8130714">Millisecond</span><span class="op" id="8130725">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130729">100</span>&nbsp;<span class="op" id="8130733">*</span>&nbsp;<span class="ident" id="8130735">time</span><span class="op" id="8130739">.</span><span class="ident" id="8130740">Millisecond</span><span class="op" id="8130751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130755">250</span>&nbsp;<span class="op" id="8130759">*</span>&nbsp;<span class="ident" id="8130761">time</span><span class="op" id="8130765">.</span><span class="ident" id="8130766">Millisecond</span><span class="op" id="8130777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130781">500</span>&nbsp;<span class="op" id="8130785">*</span>&nbsp;<span class="ident" id="8130787">time</span><span class="op" id="8130791">.</span><span class="ident" id="8130792">Millisecond</span><span class="op" id="8130803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8130807">1</span>&nbsp;<span class="op" id="8130809">*</span>&nbsp;<span class="ident" id="8130811">time</span><span class="op" id="8130815">.</span><span class="ident" id="8130816">Second</span><span class="op" id="8130822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8130825">}</span>&nbsp;<span class="op" id="8130827">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8130831">numRuns</span>&nbsp;<span class="op" id="8130839">:=</span>&nbsp;<span class="num" id="8130842">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8130846">if</span>&nbsp;<span class="ident" id="8130849">testing</span><span class="op" id="8130856">.</span><span class="ident" id="8130857">Short</span><span class="op" id="8130862">(</span><span class="op" id="8130863">)</span>&nbsp;<span class="op" id="8130865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8130870">numRuns</span>&nbsp;<span class="op" id="8130878">=</span>&nbsp;<span class="num" id="8130880">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8130885">if</span>&nbsp;<span class="ident" id="8130888">timeout</span>&nbsp;<span class="op" id="8130896">&gt;</span>&nbsp;<span class="num" id="8130898">500</span><span class="op" id="8130901">*</span><span class="ident" id="8130902">time</span><span class="op" id="8130906">.</span><span class="ident" id="8130907">Microsecond</span>&nbsp;<span class="op" id="8130919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8130925">continue</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8130937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8130941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8130945">for</span>&nbsp;<span class="ident" id="8130949">run</span>&nbsp;<span class="op" id="8130953">:=</span>&nbsp;<span class="num" id="8130956">0</span><span class="op" id="8130957">;</span>&nbsp;<span class="ident" id="8130959">run</span>&nbsp;<span class="op" id="8130963">&lt;</span>&nbsp;<span class="ident" id="8130965">numRuns</span><span class="op" id="8130972">;</span>&nbsp;<span class="ident" id="8130974">run</span><span class="op" id="8130977">++</span>&nbsp;<span class="op" id="8130980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8130985">name</span>&nbsp;<span class="op" id="8130990">:=</span>&nbsp;<span class="ident" id="8130993">fmt</span><span class="op" id="8130996">.</span><span class="ident" id="8130997">Sprintf</span><span class="op" id="8131004">(</span><span class="string" id="8131005">&#34;%v&nbsp;run&nbsp;%d/%d&#34;</span><span class="op" id="8131019">,</span>&nbsp;<span class="ident" id="8131021">timeout</span><span class="op" id="8131028">,</span>&nbsp;<span class="ident" id="8131030">run</span><span class="op" id="8131033">+</span><span class="num" id="8131034">1</span><span class="op" id="8131035">,</span>&nbsp;<span class="ident" id="8131037">numRuns</span><span class="op" id="8131044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131049">t</span><span class="op" id="8131050">.</span><span class="ident" id="8131051">Log</span><span class="op" id="8131054">(</span><span class="ident" id="8131055">name</span><span class="op" id="8131059">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131065">c</span><span class="op" id="8131066">,</span>&nbsp;<span class="ident" id="8131068">err</span>&nbsp;<span class="op" id="8131072">:=</span>&nbsp;<span class="ident" id="8131075">Dial</span><span class="op" id="8131079">(</span><span class="string" id="8131080">&#34;tcp&#34;</span><span class="op" id="8131085">,</span>&nbsp;<span class="ident" id="8131087">ln</span><span class="op" id="8131089">.</span><span class="ident" id="8131090">Addr</span><span class="op" id="8131094">(</span><span class="op" id="8131095">)</span><span class="op" id="8131096">.</span><span class="ident" id="8131097">String</span><span class="op" id="8131103">(</span><span class="op" id="8131104">)</span><span class="op" id="8131105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8131110">if</span>&nbsp;<span class="ident" id="8131113">err</span>&nbsp;<span class="op" id="8131117">!=</span>&nbsp;<span class="ident" id="8131120">nil</span>&nbsp;<span class="op" id="8131124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131130">t</span><span class="op" id="8131131">.</span><span class="ident" id="8131132">Fatalf</span><span class="op" id="8131138">(</span><span class="string" id="8131139">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8131149">,</span>&nbsp;<span class="ident" id="8131151">err</span><span class="op" id="8131154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8131159">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131164">clientc</span>&nbsp;<span class="op" id="8131172">:=</span>&nbsp;<span class="builtinfunc" id="8131175">make</span><span class="op" id="8131179">(</span><span class="keyword" id="8131180">chan</span>&nbsp;<span class="ident" id="8131185">copyRes</span><span class="op" id="8131192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8131197">go</span>&nbsp;<span class="keyword" id="8131200">func</span><span class="op" id="8131204">(</span><span class="op" id="8131205">)</span>&nbsp;<span class="op" id="8131207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131213">t0</span>&nbsp;<span class="op" id="8131216">:=</span>&nbsp;<span class="ident" id="8131219">time</span><span class="op" id="8131223">.</span><span class="ident" id="8131224">Now</span><span class="op" id="8131227">(</span><span class="op" id="8131228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131234">c</span><span class="op" id="8131235">.</span><span class="ident" id="8131236">SetDeadline</span><span class="op" id="8131247">(</span><span class="ident" id="8131248">t0</span><span class="op" id="8131250">.</span><span class="ident" id="8131251">Add</span><span class="op" id="8131254">(</span><span class="ident" id="8131255">timeout</span><span class="op" id="8131262">)</span><span class="op" id="8131263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131269">n</span><span class="op" id="8131270">,</span>&nbsp;<span class="ident" id="8131272">err</span>&nbsp;<span class="op" id="8131276">:=</span>&nbsp;<span class="ident" id="8131279">io</span><span class="op" id="8131281">.</span><span class="ident" id="8131282">Copy</span><span class="op" id="8131286">(</span><span class="ident" id="8131287">ioutil</span><span class="op" id="8131293">.</span><span class="ident" id="8131294">Discard</span><span class="op" id="8131301">,</span>&nbsp;<span class="ident" id="8131303">c</span><span class="op" id="8131304">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131310">d</span>&nbsp;<span class="op" id="8131312">:=</span>&nbsp;<span class="ident" id="8131315">time</span><span class="op" id="8131319">.</span><span class="ident" id="8131320">Since</span><span class="op" id="8131325">(</span><span class="ident" id="8131326">t0</span><span class="op" id="8131328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131334">c</span><span class="op" id="8131335">.</span><span class="ident" id="8131336">Close</span><span class="op" id="8131341">(</span><span class="op" id="8131342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131348">clientc</span>&nbsp;<span class="op" id="8131356">&lt;-</span>&nbsp;<span class="ident" id="8131359">copyRes</span><span class="op" id="8131366">{</span><span class="ident" id="8131367">n</span><span class="op" id="8131368">,</span>&nbsp;<span class="ident" id="8131370">err</span><span class="op" id="8131373">,</span>&nbsp;<span class="ident" id="8131375">d</span><span class="op" id="8131376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8131381">}</span><span class="op" id="8131382">(</span><span class="op" id="8131383">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131389">tooLong</span>&nbsp;<span class="op" id="8131397">:=</span>&nbsp;<span class="num" id="8131400">5</span>&nbsp;<span class="op" id="8131402">*</span>&nbsp;<span class="ident" id="8131404">time</span><span class="op" id="8131408">.</span><span class="ident" id="8131409">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8131419">select</span>&nbsp;<span class="op" id="8131426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8131431">case</span>&nbsp;<span class="ident" id="8131436">res</span>&nbsp;<span class="op" id="8131440">:=</span>&nbsp;<span class="op" id="8131443">&lt;-</span><span class="ident" id="8131445">clientc</span><span class="op" id="8131452">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8131458">if</span>&nbsp;<span class="ident" id="8131461">isTimeout</span><span class="op" id="8131470">(</span><span class="ident" id="8131471">res</span><span class="op" id="8131474">.</span><span class="ident" id="8131475">err</span><span class="op" id="8131478">)</span>&nbsp;<span class="op" id="8131480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131487">t</span><span class="op" id="8131488">.</span><span class="ident" id="8131489">Logf</span><span class="op" id="8131493">(</span><span class="string" id="8131494">&#34;for&nbsp;%v,&nbsp;good&nbsp;client&nbsp;timeout&nbsp;after&nbsp;%v,&nbsp;reading&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8131550">,</span>&nbsp;<span class="ident" id="8131552">name</span><span class="op" id="8131556">,</span>&nbsp;<span class="ident" id="8131558">res</span><span class="op" id="8131561">.</span><span class="ident" id="8131562">d</span><span class="op" id="8131563">,</span>&nbsp;<span class="ident" id="8131565">res</span><span class="op" id="8131568">.</span><span class="ident" id="8131569">n</span><span class="op" id="8131570">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8131576">}</span>&nbsp;<span class="keyword" id="8131578">else</span>&nbsp;<span class="op" id="8131583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131590">t</span><span class="op" id="8131591">.</span><span class="ident" id="8131592">Fatalf</span><span class="op" id="8131598">(</span><span class="string" id="8131599">&#34;for&nbsp;%v:&nbsp;client&nbsp;Copy&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;(want&nbsp;timeout)&#34;</span><span class="op" id="8131644">,</span>&nbsp;<span class="ident" id="8131646">name</span><span class="op" id="8131650">,</span>&nbsp;<span class="ident" id="8131652">res</span><span class="op" id="8131655">.</span><span class="ident" id="8131656">n</span><span class="op" id="8131657">,</span>&nbsp;<span class="ident" id="8131659">res</span><span class="op" id="8131662">.</span><span class="ident" id="8131663">err</span><span class="op" id="8131666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8131672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8131677">case</span>&nbsp;<span class="op" id="8131682">&lt;-</span><span class="ident" id="8131684">time</span><span class="op" id="8131688">.</span><span class="ident" id="8131689">After</span><span class="op" id="8131694">(</span><span class="ident" id="8131695">tooLong</span><span class="op" id="8131702">)</span><span class="op" id="8131703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131709">t</span><span class="op" id="8131710">.</span><span class="ident" id="8131711">Fatalf</span><span class="op" id="8131717">(</span><span class="string" id="8131718">&#34;for&nbsp;%v:&nbsp;timeout&nbsp;(%v)&nbsp;waiting&nbsp;for&nbsp;client&nbsp;to&nbsp;timeout&nbsp;(%v)&nbsp;reading&#34;</span><span class="op" id="8131783">,</span>&nbsp;<span class="ident" id="8131785">name</span><span class="op" id="8131789">,</span>&nbsp;<span class="ident" id="8131791">tooLong</span><span class="op" id="8131798">,</span>&nbsp;<span class="ident" id="8131800">timeout</span><span class="op" id="8131807">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8131812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8131818">select</span>&nbsp;<span class="op" id="8131825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8131830">case</span>&nbsp;<span class="ident" id="8131835">res</span>&nbsp;<span class="op" id="8131839">:=</span>&nbsp;<span class="op" id="8131842">&lt;-</span><span class="ident" id="8131844">servec</span><span class="op" id="8131850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131856">t</span><span class="op" id="8131857">.</span><span class="ident" id="8131858">Logf</span><span class="op" id="8131862">(</span><span class="string" id="8131863">&#34;for&nbsp;%v:&nbsp;server&nbsp;in&nbsp;%v&nbsp;wrote&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="8131898">,</span>&nbsp;<span class="ident" id="8131900">name</span><span class="op" id="8131904">,</span>&nbsp;<span class="ident" id="8131906">res</span><span class="op" id="8131909">.</span><span class="ident" id="8131910">d</span><span class="op" id="8131911">,</span>&nbsp;<span class="ident" id="8131913">res</span><span class="op" id="8131916">.</span><span class="ident" id="8131917">n</span><span class="op" id="8131918">,</span>&nbsp;<span class="ident" id="8131920">res</span><span class="op" id="8131923">.</span><span class="ident" id="8131924">err</span><span class="op" id="8131927">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8131932">case</span>&nbsp;<span class="ident" id="8131937">err</span>&nbsp;<span class="op" id="8131941">:=</span>&nbsp;<span class="op" id="8131944">&lt;-</span><span class="ident" id="8131946">acceptc</span><span class="op" id="8131953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8131959">t</span><span class="op" id="8131960">.</span><span class="ident" id="8131961">Fatalf</span><span class="op" id="8131967">(</span><span class="string" id="8131968">&#34;for&nbsp;%v:&nbsp;server&nbsp;Accept&nbsp;=&nbsp;%v&#34;</span><span class="op" id="8131996">,</span>&nbsp;<span class="ident" id="8131998">name</span><span class="op" id="8132002">,</span>&nbsp;<span class="ident" id="8132004">err</span><span class="op" id="8132007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132012">case</span>&nbsp;<span class="op" id="8132017">&lt;-</span><span class="ident" id="8132019">time</span><span class="op" id="8132023">.</span><span class="ident" id="8132024">After</span><span class="op" id="8132029">(</span><span class="ident" id="8132030">tooLong</span><span class="op" id="8132037">)</span><span class="op" id="8132038">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132044">t</span><span class="op" id="8132045">.</span><span class="ident" id="8132046">Fatalf</span><span class="op" id="8132052">(</span><span class="string" id="8132053">&#34;for&nbsp;%v,&nbsp;timeout&nbsp;waiting&nbsp;for&nbsp;server&nbsp;to&nbsp;finish&nbsp;writing&#34;</span><span class="op" id="8132107">,</span>&nbsp;<span class="ident" id="8132109">name</span><span class="op" id="8132113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8132118">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8132122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8132125">}</span><br>
<span class="lineno"></span><span class="op" id="8132127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8132130">//&nbsp;TestReadDeadlineDataAvailable&nbsp;tests&nbsp;that&nbsp;read&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">525</span><span class="comment" id="8132200">//&nbsp;if&nbsp;there&#39;s&nbsp;data&nbsp;ready&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="8132237">func</span>&nbsp;<span class="ident" id="8132242">TestReadDeadlineDataAvailable</span><span class="op" id="8132271">(</span><span class="ident" id="8132272">t</span>&nbsp;<span class="op" id="8132274">*</span><span class="ident" id="8132275">testing</span><span class="op" id="8132282">.</span><span class="ident" id="8132283">T</span><span class="op" id="8132284">)</span>&nbsp;<span class="op" id="8132286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132289">switch</span>&nbsp;<span class="ident" id="8132296">runtime</span><span class="op" id="8132303">.</span><span class="ident" id="8132304">GOOS</span>&nbsp;<span class="op" id="8132309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132312">case</span>&nbsp;<span class="string" id="8132317">&#34;plan9&#34;</span><span class="op" id="8132324">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132328">t</span><span class="op" id="8132329">.</span><span class="ident" id="8132330">Skipf</span><span class="op" id="8132335">(</span><span class="string" id="8132336">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8132357">,</span>&nbsp;<span class="ident" id="8132359">runtime</span><span class="op" id="8132366">.</span><span class="ident" id="8132367">GOOS</span><span class="op" id="8132371">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8132374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132378">ln</span>&nbsp;<span class="op" id="8132381">:=</span>&nbsp;<span class="ident" id="8132384">newLocalListener</span><span class="op" id="8132400">(</span><span class="ident" id="8132401">t</span><span class="op" id="8132402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132405">defer</span>&nbsp;<span class="ident" id="8132411">ln</span><span class="op" id="8132413">.</span><span class="ident" id="8132414">Close</span><span class="op" id="8132419">(</span><span class="op" id="8132420">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132424">servec</span>&nbsp;<span class="op" id="8132431">:=</span>&nbsp;<span class="builtinfunc" id="8132434">make</span><span class="op" id="8132438">(</span><span class="keyword" id="8132439">chan</span>&nbsp;<span class="ident" id="8132444">copyRes</span><span class="op" id="8132451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132454">const</span>&nbsp;<span class="ident" id="8132460">msg</span>&nbsp;<span class="op" id="8132464">=</span>&nbsp;<span class="string" id="8132466">&#34;data&nbsp;client&nbsp;shouldn&#39;t&nbsp;read,&nbsp;even&nbsp;though&nbsp;it&#39;ll&nbsp;be&nbsp;waiting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132526">go</span>&nbsp;<span class="keyword" id="8132529">func</span><span class="op" id="8132533">(</span><span class="op" id="8132534">)</span>&nbsp;<span class="op" id="8132536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132540">c</span><span class="op" id="8132541">,</span>&nbsp;<span class="ident" id="8132543">err</span>&nbsp;<span class="op" id="8132547">:=</span>&nbsp;<span class="ident" id="8132550">ln</span><span class="op" id="8132552">.</span><span class="ident" id="8132553">Accept</span><span class="op" id="8132559">(</span><span class="op" id="8132560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132564">if</span>&nbsp;<span class="ident" id="8132567">err</span>&nbsp;<span class="op" id="8132571">!=</span>&nbsp;<span class="ident" id="8132574">nil</span>&nbsp;<span class="op" id="8132578">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132583">t</span><span class="op" id="8132584">.</span><span class="ident" id="8132585">Errorf</span><span class="op" id="8132591">(</span><span class="string" id="8132592">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8132604">,</span>&nbsp;<span class="ident" id="8132606">err</span><span class="op" id="8132609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132614">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8132623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132627">defer</span>&nbsp;<span class="ident" id="8132633">c</span><span class="op" id="8132634">.</span><span class="ident" id="8132635">Close</span><span class="op" id="8132640">(</span><span class="op" id="8132641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132645">n</span><span class="op" id="8132646">,</span>&nbsp;<span class="ident" id="8132648">err</span>&nbsp;<span class="op" id="8132652">:=</span>&nbsp;<span class="ident" id="8132655">c</span><span class="op" id="8132656">.</span><span class="ident" id="8132657">Write</span><span class="op" id="8132662">(</span><span class="op" id="8132663">[</span><span class="op" id="8132664">]</span><span class="builtintype" id="8132665">byte</span><span class="op" id="8132669">(</span><span class="ident" id="8132670">msg</span><span class="op" id="8132673">)</span><span class="op" id="8132674">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132678">servec</span>&nbsp;<span class="op" id="8132685">&lt;-</span>&nbsp;<span class="ident" id="8132688">copyRes</span><span class="op" id="8132695">{</span><span class="ident" id="8132696">n</span><span class="op" id="8132697">:</span>&nbsp;<span class="ident" id="8132699">int64</span><span class="op" id="8132704">(</span><span class="ident" id="8132705">n</span><span class="op" id="8132706">)</span><span class="op" id="8132707">,</span>&nbsp;<span class="ident" id="8132709">err</span><span class="op" id="8132712">:</span>&nbsp;<span class="ident" id="8132714">err</span><span class="op" id="8132717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8132720">}</span><span class="op" id="8132721">(</span><span class="op" id="8132722">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132726">c</span><span class="op" id="8132727">,</span>&nbsp;<span class="ident" id="8132729">err</span>&nbsp;<span class="op" id="8132733">:=</span>&nbsp;<span class="ident" id="8132736">Dial</span><span class="op" id="8132740">(</span><span class="string" id="8132741">&#34;tcp&#34;</span><span class="op" id="8132746">,</span>&nbsp;<span class="ident" id="8132748">ln</span><span class="op" id="8132750">.</span><span class="ident" id="8132751">Addr</span><span class="op" id="8132755">(</span><span class="op" id="8132756">)</span><span class="op" id="8132757">.</span><span class="ident" id="8132758">String</span><span class="op" id="8132764">(</span><span class="op" id="8132765">)</span><span class="op" id="8132766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132769">if</span>&nbsp;<span class="ident" id="8132772">err</span>&nbsp;<span class="op" id="8132776">!=</span>&nbsp;<span class="ident" id="8132779">nil</span>&nbsp;<span class="op" id="8132783">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132787">t</span><span class="op" id="8132788">.</span><span class="ident" id="8132789">Fatalf</span><span class="op" id="8132795">(</span><span class="string" id="8132796">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8132806">,</span>&nbsp;<span class="ident" id="8132808">err</span><span class="op" id="8132811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8132814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132817">defer</span>&nbsp;<span class="ident" id="8132823">c</span><span class="op" id="8132824">.</span><span class="ident" id="8132825">Close</span><span class="op" id="8132830">(</span><span class="op" id="8132831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132834">if</span>&nbsp;<span class="ident" id="8132837">res</span>&nbsp;<span class="op" id="8132841">:=</span>&nbsp;<span class="op" id="8132844">&lt;-</span><span class="ident" id="8132846">servec</span><span class="op" id="8132852">;</span>&nbsp;<span class="ident" id="8132854">res</span><span class="op" id="8132857">.</span><span class="ident" id="8132858">err</span>&nbsp;<span class="op" id="8132862">!=</span>&nbsp;<span class="ident" id="8132865">nil</span>&nbsp;<span class="op" id="8132869">||</span>&nbsp;<span class="ident" id="8132872">res</span><span class="op" id="8132875">.</span><span class="ident" id="8132876">n</span>&nbsp;<span class="op" id="8132878">!=</span>&nbsp;<span class="ident" id="8132881">int64</span><span class="op" id="8132886">(</span><span class="builtinfunc" id="8132887">len</span><span class="op" id="8132890">(</span><span class="ident" id="8132891">msg</span><span class="op" id="8132894">)</span><span class="op" id="8132895">)</span>&nbsp;<span class="op" id="8132897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132901">t</span><span class="op" id="8132902">.</span><span class="ident" id="8132903">Fatalf</span><span class="op" id="8132909">(</span><span class="string" id="8132910">&#34;unexpected&nbsp;server&nbsp;Write:&nbsp;n=%d,&nbsp;err=%v;&nbsp;want&nbsp;n=%d,&nbsp;err=nil&#34;</span><span class="op" id="8132969">,</span>&nbsp;<span class="ident" id="8132971">res</span><span class="op" id="8132974">.</span><span class="ident" id="8132975">n</span><span class="op" id="8132976">,</span>&nbsp;<span class="ident" id="8132978">res</span><span class="op" id="8132981">.</span><span class="ident" id="8132982">err</span><span class="op" id="8132985">,</span>&nbsp;<span class="builtinfunc" id="8132987">len</span><span class="op" id="8132990">(</span><span class="ident" id="8132991">msg</span><span class="op" id="8132994">)</span><span class="op" id="8132995">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8132998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133001">c</span><span class="op" id="8133002">.</span><span class="ident" id="8133003">SetReadDeadline</span><span class="op" id="8133018">(</span><span class="ident" id="8133019">time</span><span class="op" id="8133023">.</span><span class="ident" id="8133024">Now</span><span class="op" id="8133027">(</span><span class="op" id="8133028">)</span><span class="op" id="8133029">.</span><span class="ident" id="8133030">Add</span><span class="op" id="8133033">(</span><span class="op" id="8133034">-</span><span class="num" id="8133035">5</span>&nbsp;<span class="op" id="8133037">*</span>&nbsp;<span class="ident" id="8133039">time</span><span class="op" id="8133043">.</span><span class="ident" id="8133044">Second</span><span class="op" id="8133050">)</span><span class="op" id="8133051">)</span>&nbsp;<span class="comment" id="8133053">//&nbsp;in&nbsp;the&nbsp;psat.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133070">buf</span>&nbsp;<span class="op" id="8133074">:=</span>&nbsp;<span class="builtinfunc" id="8133077">make</span><span class="op" id="8133081">(</span><span class="op" id="8133082">[</span><span class="op" id="8133083">]</span><span class="builtintype" id="8133084">byte</span><span class="op" id="8133088">,</span>&nbsp;<span class="builtinfunc" id="8133090">len</span><span class="op" id="8133093">(</span><span class="ident" id="8133094">msg</span><span class="op" id="8133097">)</span><span class="op" id="8133098">/</span><span class="num" id="8133099">2</span><span class="op" id="8133100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133103">n</span><span class="op" id="8133104">,</span>&nbsp;<span class="ident" id="8133106">err</span>&nbsp;<span class="op" id="8133110">:=</span>&nbsp;<span class="ident" id="8133113">c</span><span class="op" id="8133114">.</span><span class="ident" id="8133115">Read</span><span class="op" id="8133119">(</span><span class="ident" id="8133120">buf</span><span class="op" id="8133123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133126">if</span>&nbsp;<span class="ident" id="8133129">n</span>&nbsp;<span class="op" id="8133131">&gt;</span>&nbsp;<span class="num" id="8133133">0</span>&nbsp;<span class="op" id="8133135">||</span>&nbsp;<span class="op" id="8133138">!</span><span class="ident" id="8133139">isTimeout</span><span class="op" id="8133148">(</span><span class="ident" id="8133149">err</span><span class="op" id="8133152">)</span>&nbsp;<span class="op" id="8133154">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133158">t</span><span class="op" id="8133159">.</span><span class="ident" id="8133160">Fatalf</span><span class="op" id="8133166">(</span><span class="string" id="8133167">&#34;client&nbsp;read&nbsp;=&nbsp;%d&nbsp;(%q)&nbsp;err=%v;&nbsp;want&nbsp;0,&nbsp;timeout&#34;</span><span class="op" id="8133214">,</span>&nbsp;<span class="ident" id="8133216">n</span><span class="op" id="8133217">,</span>&nbsp;<span class="ident" id="8133219">buf</span><span class="op" id="8133222">[</span><span class="op" id="8133223">:</span><span class="ident" id="8133224">n</span><span class="op" id="8133225">]</span><span class="op" id="8133226">,</span>&nbsp;<span class="ident" id="8133228">err</span><span class="op" id="8133231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8133234">}</span><br>
<span class="lineno"></span><span class="op" id="8133236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8133239">//&nbsp;TestWriteDeadlineBufferAvailable&nbsp;tests&nbsp;that&nbsp;write&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">565</span><span class="comment" id="8133313">//&nbsp;if&nbsp;there&#39;s&nbsp;buffer&nbsp;space&nbsp;available&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span><span class="keyword" id="8133360">func</span>&nbsp;<span class="ident" id="8133365">TestWriteDeadlineBufferAvailable</span><span class="op" id="8133397">(</span><span class="ident" id="8133398">t</span>&nbsp;<span class="op" id="8133400">*</span><span class="ident" id="8133401">testing</span><span class="op" id="8133408">.</span><span class="ident" id="8133409">T</span><span class="op" id="8133410">)</span>&nbsp;<span class="op" id="8133412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133415">switch</span>&nbsp;<span class="ident" id="8133422">runtime</span><span class="op" id="8133429">.</span><span class="ident" id="8133430">GOOS</span>&nbsp;<span class="op" id="8133435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133438">case</span>&nbsp;<span class="string" id="8133443">&#34;plan9&#34;</span><span class="op" id="8133450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133454">t</span><span class="op" id="8133455">.</span><span class="ident" id="8133456">Skipf</span><span class="op" id="8133461">(</span><span class="string" id="8133462">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8133483">,</span>&nbsp;<span class="ident" id="8133485">runtime</span><span class="op" id="8133492">.</span><span class="ident" id="8133493">GOOS</span><span class="op" id="8133497">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8133500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133504">ln</span>&nbsp;<span class="op" id="8133507">:=</span>&nbsp;<span class="ident" id="8133510">newLocalListener</span><span class="op" id="8133526">(</span><span class="ident" id="8133527">t</span><span class="op" id="8133528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133531">defer</span>&nbsp;<span class="ident" id="8133537">ln</span><span class="op" id="8133539">.</span><span class="ident" id="8133540">Close</span><span class="op" id="8133545">(</span><span class="op" id="8133546">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133550">servec</span>&nbsp;<span class="op" id="8133557">:=</span>&nbsp;<span class="builtinfunc" id="8133560">make</span><span class="op" id="8133564">(</span><span class="keyword" id="8133565">chan</span>&nbsp;<span class="ident" id="8133570">copyRes</span><span class="op" id="8133577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133580">go</span>&nbsp;<span class="keyword" id="8133583">func</span><span class="op" id="8133587">(</span><span class="op" id="8133588">)</span>&nbsp;<span class="op" id="8133590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133594">c</span><span class="op" id="8133595">,</span>&nbsp;<span class="ident" id="8133597">err</span>&nbsp;<span class="op" id="8133601">:=</span>&nbsp;<span class="ident" id="8133604">ln</span><span class="op" id="8133606">.</span><span class="ident" id="8133607">Accept</span><span class="op" id="8133613">(</span><span class="op" id="8133614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133618">if</span>&nbsp;<span class="ident" id="8133621">err</span>&nbsp;<span class="op" id="8133625">!=</span>&nbsp;<span class="ident" id="8133628">nil</span>&nbsp;<span class="op" id="8133632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133637">t</span><span class="op" id="8133638">.</span><span class="ident" id="8133639">Errorf</span><span class="op" id="8133645">(</span><span class="string" id="8133646">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8133658">,</span>&nbsp;<span class="ident" id="8133660">err</span><span class="op" id="8133663">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133668">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8133677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133681">defer</span>&nbsp;<span class="ident" id="8133687">c</span><span class="op" id="8133688">.</span><span class="ident" id="8133689">Close</span><span class="op" id="8133694">(</span><span class="op" id="8133695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133699">c</span><span class="op" id="8133700">.</span><span class="ident" id="8133701">SetWriteDeadline</span><span class="op" id="8133717">(</span><span class="ident" id="8133718">time</span><span class="op" id="8133722">.</span><span class="ident" id="8133723">Now</span><span class="op" id="8133726">(</span><span class="op" id="8133727">)</span><span class="op" id="8133728">.</span><span class="ident" id="8133729">Add</span><span class="op" id="8133732">(</span><span class="op" id="8133733">-</span><span class="num" id="8133734">5</span>&nbsp;<span class="op" id="8133736">*</span>&nbsp;<span class="ident" id="8133738">time</span><span class="op" id="8133742">.</span><span class="ident" id="8133743">Second</span><span class="op" id="8133749">)</span><span class="op" id="8133750">)</span>&nbsp;<span class="comment" id="8133752">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133769">n</span><span class="op" id="8133770">,</span>&nbsp;<span class="ident" id="8133772">err</span>&nbsp;<span class="op" id="8133776">:=</span>&nbsp;<span class="ident" id="8133779">c</span><span class="op" id="8133780">.</span><span class="ident" id="8133781">Write</span><span class="op" id="8133786">(</span><span class="op" id="8133787">[</span><span class="op" id="8133788">]</span><span class="builtintype" id="8133789">byte</span><span class="op" id="8133793">{</span><span class="string" id="8133794">&#39;x&#39;</span><span class="op" id="8133797">}</span><span class="op" id="8133798">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133802">servec</span>&nbsp;<span class="op" id="8133809">&lt;-</span>&nbsp;<span class="ident" id="8133812">copyRes</span><span class="op" id="8133819">{</span><span class="ident" id="8133820">n</span><span class="op" id="8133821">:</span>&nbsp;<span class="ident" id="8133823">int64</span><span class="op" id="8133828">(</span><span class="ident" id="8133829">n</span><span class="op" id="8133830">)</span><span class="op" id="8133831">,</span>&nbsp;<span class="ident" id="8133833">err</span><span class="op" id="8133836">:</span>&nbsp;<span class="ident" id="8133838">err</span><span class="op" id="8133841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8133844">}</span><span class="op" id="8133845">(</span><span class="op" id="8133846">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133850">c</span><span class="op" id="8133851">,</span>&nbsp;<span class="ident" id="8133853">err</span>&nbsp;<span class="op" id="8133857">:=</span>&nbsp;<span class="ident" id="8133860">Dial</span><span class="op" id="8133864">(</span><span class="string" id="8133865">&#34;tcp&#34;</span><span class="op" id="8133870">,</span>&nbsp;<span class="ident" id="8133872">ln</span><span class="op" id="8133874">.</span><span class="ident" id="8133875">Addr</span><span class="op" id="8133879">(</span><span class="op" id="8133880">)</span><span class="op" id="8133881">.</span><span class="ident" id="8133882">String</span><span class="op" id="8133888">(</span><span class="op" id="8133889">)</span><span class="op" id="8133890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133893">if</span>&nbsp;<span class="ident" id="8133896">err</span>&nbsp;<span class="op" id="8133900">!=</span>&nbsp;<span class="ident" id="8133903">nil</span>&nbsp;<span class="op" id="8133907">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133911">t</span><span class="op" id="8133912">.</span><span class="ident" id="8133913">Fatalf</span><span class="op" id="8133919">(</span><span class="string" id="8133920">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8133930">,</span>&nbsp;<span class="ident" id="8133932">err</span><span class="op" id="8133935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8133938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133941">defer</span>&nbsp;<span class="ident" id="8133947">c</span><span class="op" id="8133948">.</span><span class="ident" id="8133949">Close</span><span class="op" id="8133954">(</span><span class="op" id="8133955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133958">res</span>&nbsp;<span class="op" id="8133962">:=</span>&nbsp;<span class="op" id="8133965">&lt;-</span><span class="ident" id="8133967">servec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133975">if</span>&nbsp;<span class="ident" id="8133978">res</span><span class="op" id="8133981">.</span><span class="ident" id="8133982">n</span>&nbsp;<span class="op" id="8133984">!=</span>&nbsp;<span class="num" id="8133987">0</span>&nbsp;<span class="op" id="8133989">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133993">t</span><span class="op" id="8133994">.</span><span class="ident" id="8133995">Errorf</span><span class="op" id="8134001">(</span><span class="string" id="8134002">&#34;Write&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="8134022">,</span>&nbsp;<span class="ident" id="8134024">res</span><span class="op" id="8134027">.</span><span class="ident" id="8134028">n</span><span class="op" id="8134029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8134032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8134035">if</span>&nbsp;<span class="op" id="8134038">!</span><span class="ident" id="8134039">isTimeout</span><span class="op" id="8134048">(</span><span class="ident" id="8134049">res</span><span class="op" id="8134052">.</span><span class="ident" id="8134053">err</span><span class="op" id="8134056">)</span>&nbsp;<span class="op" id="8134058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134062">t</span><span class="op" id="8134063">.</span><span class="ident" id="8134064">Errorf</span><span class="op" id="8134070">(</span><span class="string" id="8134071">&#34;Write&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="8134103">,</span>&nbsp;<span class="ident" id="8134105">res</span><span class="op" id="8134108">.</span><span class="ident" id="8134109">err</span><span class="op" id="8134112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8134115">}</span><br>
<span class="lineno">600</span><span class="op" id="8134117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8134120">//&nbsp;TestAcceptDeadlineConnectionAvailable&nbsp;tests&nbsp;that&nbsp;accept&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="8134200">//&nbsp;if&nbsp;there&#39;s&nbsp;incoming&nbsp;connections&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="8134246">func</span>&nbsp;<span class="ident" id="8134251">TestAcceptDeadlineConnectionAvailable</span><span class="op" id="8134288">(</span><span class="ident" id="8134289">t</span>&nbsp;<span class="op" id="8134291">*</span><span class="ident" id="8134292">testing</span><span class="op" id="8134299">.</span><span class="ident" id="8134300">T</span><span class="op" id="8134301">)</span>&nbsp;<span class="op" id="8134303">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8134306">switch</span>&nbsp;<span class="ident" id="8134313">runtime</span><span class="op" id="8134320">.</span><span class="ident" id="8134321">GOOS</span>&nbsp;<span class="op" id="8134326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8134329">case</span>&nbsp;<span class="string" id="8134334">&#34;plan9&#34;</span><span class="op" id="8134341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134345">t</span><span class="op" id="8134346">.</span><span class="ident" id="8134347">Skipf</span><span class="op" id="8134352">(</span><span class="string" id="8134353">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8134374">,</span>&nbsp;<span class="ident" id="8134376">runtime</span><span class="op" id="8134383">.</span><span class="ident" id="8134384">GOOS</span><span class="op" id="8134388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8134391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134395">ln</span>&nbsp;<span class="op" id="8134398">:=</span>&nbsp;<span class="ident" id="8134401">newLocalListener</span><span class="op" id="8134417">(</span><span class="ident" id="8134418">t</span><span class="op" id="8134419">)</span><span class="op" id="8134420">.</span><span class="op" id="8134421">(</span><span class="op" id="8134422">*</span><span class="ident" id="8134423">TCPListener</span><span class="op" id="8134434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8134437">defer</span>&nbsp;<span class="ident" id="8134443">ln</span><span class="op" id="8134445">.</span><span class="ident" id="8134446">Close</span><span class="op" id="8134451">(</span><span class="op" id="8134452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8134456">go</span>&nbsp;<span class="keyword" id="8134459">func</span><span class="op" id="8134463">(</span><span class="op" id="8134464">)</span>&nbsp;<span class="op" id="8134466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134470">c</span><span class="op" id="8134471">,</span>&nbsp;<span class="ident" id="8134473">err</span>&nbsp;<span class="op" id="8134477">:=</span>&nbsp;<span class="ident" id="8134480">Dial</span><span class="op" id="8134484">(</span><span class="string" id="8134485">&#34;tcp&#34;</span><span class="op" id="8134490">,</span>&nbsp;<span class="ident" id="8134492">ln</span><span class="op" id="8134494">.</span><span class="ident" id="8134495">Addr</span><span class="op" id="8134499">(</span><span class="op" id="8134500">)</span><span class="op" id="8134501">.</span><span class="ident" id="8134502">String</span><span class="op" id="8134508">(</span><span class="op" id="8134509">)</span><span class="op" id="8134510">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8134514">if</span>&nbsp;<span class="ident" id="8134517">err</span>&nbsp;<span class="op" id="8134521">!=</span>&nbsp;<span class="ident" id="8134524">nil</span>&nbsp;<span class="op" id="8134528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134533">t</span><span class="op" id="8134534">.</span><span class="ident" id="8134535">Errorf</span><span class="op" id="8134541">(</span><span class="string" id="8134542">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8134552">,</span>&nbsp;<span class="ident" id="8134554">err</span><span class="op" id="8134557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8134562">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8134571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8134575">defer</span>&nbsp;<span class="ident" id="8134581">c</span><span class="op" id="8134582">.</span><span class="ident" id="8134583">Close</span><span class="op" id="8134588">(</span><span class="op" id="8134589">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8134593">var</span>&nbsp;<span class="ident" id="8134597">buf</span>&nbsp;<span class="op" id="8134601">[</span><span class="num" id="8134602">1</span><span class="op" id="8134603">]</span><span class="builtintype" id="8134604">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134611">c</span><span class="op" id="8134612">.</span><span class="ident" id="8134613">Read</span><span class="op" id="8134617">(</span><span class="ident" id="8134618">buf</span><span class="op" id="8134621">[</span><span class="op" id="8134622">:</span><span class="op" id="8134623">]</span><span class="op" id="8134624">)</span>&nbsp;<span class="comment" id="8134626">//&nbsp;block&nbsp;until&nbsp;the&nbsp;connection&nbsp;or&nbsp;listener&nbsp;is&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8134679">}</span><span class="op" id="8134680">(</span><span class="op" id="8134681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134684">time</span><span class="op" id="8134688">.</span><span class="ident" id="8134689">Sleep</span><span class="op" id="8134694">(</span><span class="num" id="8134695">10</span>&nbsp;<span class="op" id="8134698">*</span>&nbsp;<span class="ident" id="8134700">time</span><span class="op" id="8134704">.</span><span class="ident" id="8134705">Millisecond</span><span class="op" id="8134716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134719">ln</span><span class="op" id="8134721">.</span><span class="ident" id="8134722">SetDeadline</span><span class="op" id="8134733">(</span><span class="ident" id="8134734">time</span><span class="op" id="8134738">.</span><span class="ident" id="8134739">Now</span><span class="op" id="8134742">(</span><span class="op" id="8134743">)</span><span class="op" id="8134744">.</span><span class="ident" id="8134745">Add</span><span class="op" id="8134748">(</span><span class="op" id="8134749">-</span><span class="num" id="8134750">5</span>&nbsp;<span class="op" id="8134752">*</span>&nbsp;<span class="ident" id="8134754">time</span><span class="op" id="8134758">.</span><span class="ident" id="8134759">Second</span><span class="op" id="8134765">)</span><span class="op" id="8134766">)</span>&nbsp;<span class="comment" id="8134768">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134784">c</span><span class="op" id="8134785">,</span>&nbsp;<span class="ident" id="8134787">err</span>&nbsp;<span class="op" id="8134791">:=</span>&nbsp;<span class="ident" id="8134794">ln</span><span class="op" id="8134796">.</span><span class="ident" id="8134797">Accept</span><span class="op" id="8134803">(</span><span class="op" id="8134804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8134807">if</span>&nbsp;<span class="ident" id="8134810">err</span>&nbsp;<span class="op" id="8134814">==</span>&nbsp;<span class="ident" id="8134817">nil</span>&nbsp;<span class="op" id="8134821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8134825">defer</span>&nbsp;<span class="ident" id="8134831">c</span><span class="op" id="8134832">.</span><span class="ident" id="8134833">Close</span><span class="op" id="8134838">(</span><span class="op" id="8134839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8134842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8134845">if</span>&nbsp;<span class="op" id="8134848">!</span><span class="ident" id="8134849">isTimeout</span><span class="op" id="8134858">(</span><span class="ident" id="8134859">err</span><span class="op" id="8134862">)</span>&nbsp;<span class="op" id="8134864">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134868">t</span><span class="op" id="8134869">.</span><span class="ident" id="8134870">Fatalf</span><span class="op" id="8134876">(</span><span class="string" id="8134877">&#34;Accept:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="8134907">,</span>&nbsp;<span class="ident" id="8134909">err</span><span class="op" id="8134912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8134915">}</span><br>
<span class="lineno"></span><span class="op" id="8134917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8134920">//&nbsp;TestConnectDeadlineInThePast&nbsp;tests&nbsp;that&nbsp;connect&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">635</span><span class="comment" id="8134992">//&nbsp;if&nbsp;the&nbsp;connection&nbsp;can&nbsp;be&nbsp;established&nbsp;w/o&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="8135046">func</span>&nbsp;<span class="ident" id="8135051">TestConnectDeadlineInThePast</span><span class="op" id="8135079">(</span><span class="ident" id="8135080">t</span>&nbsp;<span class="op" id="8135082">*</span><span class="ident" id="8135083">testing</span><span class="op" id="8135090">.</span><span class="ident" id="8135091">T</span><span class="op" id="8135092">)</span>&nbsp;<span class="op" id="8135094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135097">switch</span>&nbsp;<span class="ident" id="8135104">runtime</span><span class="op" id="8135111">.</span><span class="ident" id="8135112">GOOS</span>&nbsp;<span class="op" id="8135117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135120">case</span>&nbsp;<span class="string" id="8135125">&#34;plan9&#34;</span><span class="op" id="8135132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135136">t</span><span class="op" id="8135137">.</span><span class="ident" id="8135138">Skipf</span><span class="op" id="8135143">(</span><span class="string" id="8135144">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8135165">,</span>&nbsp;<span class="ident" id="8135167">runtime</span><span class="op" id="8135174">.</span><span class="ident" id="8135175">GOOS</span><span class="op" id="8135179">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8135182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135186">ln</span>&nbsp;<span class="op" id="8135189">:=</span>&nbsp;<span class="ident" id="8135192">newLocalListener</span><span class="op" id="8135208">(</span><span class="ident" id="8135209">t</span><span class="op" id="8135210">)</span><span class="op" id="8135211">.</span><span class="op" id="8135212">(</span><span class="op" id="8135213">*</span><span class="ident" id="8135214">TCPListener</span><span class="op" id="8135225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135228">defer</span>&nbsp;<span class="ident" id="8135234">ln</span><span class="op" id="8135236">.</span><span class="ident" id="8135237">Close</span><span class="op" id="8135242">(</span><span class="op" id="8135243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135247">go</span>&nbsp;<span class="keyword" id="8135250">func</span><span class="op" id="8135254">(</span><span class="op" id="8135255">)</span>&nbsp;<span class="op" id="8135257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135261">c</span><span class="op" id="8135262">,</span>&nbsp;<span class="ident" id="8135264">err</span>&nbsp;<span class="op" id="8135268">:=</span>&nbsp;<span class="ident" id="8135271">ln</span><span class="op" id="8135273">.</span><span class="ident" id="8135274">Accept</span><span class="op" id="8135280">(</span><span class="op" id="8135281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135285">if</span>&nbsp;<span class="ident" id="8135288">err</span>&nbsp;<span class="op" id="8135292">==</span>&nbsp;<span class="ident" id="8135295">nil</span>&nbsp;<span class="op" id="8135299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135304">defer</span>&nbsp;<span class="ident" id="8135310">c</span><span class="op" id="8135311">.</span><span class="ident" id="8135312">Close</span><span class="op" id="8135317">(</span><span class="op" id="8135318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8135322">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8135325">}</span><span class="op" id="8135326">(</span><span class="op" id="8135327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135330">time</span><span class="op" id="8135334">.</span><span class="ident" id="8135335">Sleep</span><span class="op" id="8135340">(</span><span class="num" id="8135341">10</span>&nbsp;<span class="op" id="8135344">*</span>&nbsp;<span class="ident" id="8135346">time</span><span class="op" id="8135350">.</span><span class="ident" id="8135351">Millisecond</span><span class="op" id="8135362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135365">c</span><span class="op" id="8135366">,</span>&nbsp;<span class="ident" id="8135368">err</span>&nbsp;<span class="op" id="8135372">:=</span>&nbsp;<span class="ident" id="8135375">DialTimeout</span><span class="op" id="8135386">(</span><span class="string" id="8135387">&#34;tcp&#34;</span><span class="op" id="8135392">,</span>&nbsp;<span class="ident" id="8135394">ln</span><span class="op" id="8135396">.</span><span class="ident" id="8135397">Addr</span><span class="op" id="8135401">(</span><span class="op" id="8135402">)</span><span class="op" id="8135403">.</span><span class="ident" id="8135404">String</span><span class="op" id="8135410">(</span><span class="op" id="8135411">)</span><span class="op" id="8135412">,</span>&nbsp;<span class="op" id="8135414">-</span><span class="num" id="8135415">5</span><span class="op" id="8135416">*</span><span class="ident" id="8135417">time</span><span class="op" id="8135421">.</span><span class="ident" id="8135422">Second</span><span class="op" id="8135428">)</span>&nbsp;<span class="comment" id="8135430">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135446">if</span>&nbsp;<span class="ident" id="8135449">err</span>&nbsp;<span class="op" id="8135453">==</span>&nbsp;<span class="ident" id="8135456">nil</span>&nbsp;<span class="op" id="8135460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135464">defer</span>&nbsp;<span class="ident" id="8135470">c</span><span class="op" id="8135471">.</span><span class="ident" id="8135472">Close</span><span class="op" id="8135477">(</span><span class="op" id="8135478">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8135481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135484">if</span>&nbsp;<span class="op" id="8135487">!</span><span class="ident" id="8135488">isTimeout</span><span class="op" id="8135497">(</span><span class="ident" id="8135498">err</span><span class="op" id="8135501">)</span>&nbsp;<span class="op" id="8135503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135507">t</span><span class="op" id="8135508">.</span><span class="ident" id="8135509">Fatalf</span><span class="op" id="8135515">(</span><span class="string" id="8135516">&#34;DialTimeout:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="8135551">,</span>&nbsp;<span class="ident" id="8135553">err</span><span class="op" id="8135556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8135559">}</span><br>
<span class="lineno"></span><span class="op" id="8135561">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="8135564">//&nbsp;TestProlongTimeout&nbsp;tests&nbsp;concurrent&nbsp;deadline&nbsp;modification.</span><br>
<span class="lineno"></span><span class="comment" id="8135626">//&nbsp;Known&nbsp;to&nbsp;cause&nbsp;data&nbsp;races&nbsp;in&nbsp;the&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="8135668">func</span>&nbsp;<span class="ident" id="8135673">TestProlongTimeout</span><span class="op" id="8135691">(</span><span class="ident" id="8135692">t</span>&nbsp;<span class="op" id="8135694">*</span><span class="ident" id="8135695">testing</span><span class="op" id="8135702">.</span><span class="ident" id="8135703">T</span><span class="op" id="8135704">)</span>&nbsp;<span class="op" id="8135706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135709">switch</span>&nbsp;<span class="ident" id="8135716">runtime</span><span class="op" id="8135723">.</span><span class="ident" id="8135724">GOOS</span>&nbsp;<span class="op" id="8135729">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135732">case</span>&nbsp;<span class="string" id="8135737">&#34;plan9&#34;</span><span class="op" id="8135744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135748">t</span><span class="op" id="8135749">.</span><span class="ident" id="8135750">Skipf</span><span class="op" id="8135755">(</span><span class="string" id="8135756">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8135777">,</span>&nbsp;<span class="ident" id="8135779">runtime</span><span class="op" id="8135786">.</span><span class="ident" id="8135787">GOOS</span><span class="op" id="8135791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8135794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135798">ln</span>&nbsp;<span class="op" id="8135801">:=</span>&nbsp;<span class="ident" id="8135804">newLocalListener</span><span class="op" id="8135820">(</span><span class="ident" id="8135821">t</span><span class="op" id="8135822">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135825">defer</span>&nbsp;<span class="ident" id="8135831">ln</span><span class="op" id="8135833">.</span><span class="ident" id="8135834">Close</span><span class="op" id="8135839">(</span><span class="op" id="8135840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135843">connected</span>&nbsp;<span class="op" id="8135853">:=</span>&nbsp;<span class="builtinfunc" id="8135856">make</span><span class="op" id="8135860">(</span><span class="keyword" id="8135861">chan</span>&nbsp;<span class="builtintype" id="8135866">bool</span><span class="op" id="8135870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135873">go</span>&nbsp;<span class="keyword" id="8135876">func</span><span class="op" id="8135880">(</span><span class="op" id="8135881">)</span>&nbsp;<span class="op" id="8135883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135887">s</span><span class="op" id="8135888">,</span>&nbsp;<span class="ident" id="8135890">err</span>&nbsp;<span class="op" id="8135894">:=</span>&nbsp;<span class="ident" id="8135897">ln</span><span class="op" id="8135899">.</span><span class="ident" id="8135900">Accept</span><span class="op" id="8135906">(</span><span class="op" id="8135907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135911">connected</span>&nbsp;<span class="op" id="8135921">&lt;-</span>&nbsp;<span class="builtintype" id="8135924">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135931">if</span>&nbsp;<span class="ident" id="8135934">err</span>&nbsp;<span class="op" id="8135938">!=</span>&nbsp;<span class="ident" id="8135941">nil</span>&nbsp;<span class="op" id="8135945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135950">t</span><span class="op" id="8135951">.</span><span class="ident" id="8135952">Errorf</span><span class="op" id="8135958">(</span><span class="string" id="8135959">&#34;ln.Accept:&nbsp;%v&#34;</span><span class="op" id="8135974">,</span>&nbsp;<span class="ident" id="8135976">err</span><span class="op" id="8135979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135984">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8135993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135997">defer</span>&nbsp;<span class="ident" id="8136003">s</span><span class="op" id="8136004">.</span><span class="ident" id="8136005">Close</span><span class="op" id="8136010">(</span><span class="op" id="8136011">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136015">s</span><span class="op" id="8136016">.</span><span class="ident" id="8136017">SetDeadline</span><span class="op" id="8136028">(</span><span class="ident" id="8136029">time</span><span class="op" id="8136033">.</span><span class="ident" id="8136034">Now</span><span class="op" id="8136037">(</span><span class="op" id="8136038">)</span><span class="op" id="8136039">.</span><span class="ident" id="8136040">Add</span><span class="op" id="8136043">(</span><span class="ident" id="8136044">time</span><span class="op" id="8136048">.</span><span class="ident" id="8136049">Hour</span><span class="op" id="8136053">)</span><span class="op" id="8136054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136058">go</span>&nbsp;<span class="keyword" id="8136061">func</span><span class="op" id="8136065">(</span><span class="op" id="8136066">)</span>&nbsp;<span class="op" id="8136068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136073">var</span>&nbsp;<span class="ident" id="8136077">buf</span>&nbsp;<span class="op" id="8136081">[</span><span class="num" id="8136082">4096</span><span class="op" id="8136086">]</span><span class="builtintype" id="8136087">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136095">for</span>&nbsp;<span class="op" id="8136099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136105">_</span><span class="op" id="8136106">,</span>&nbsp;<span class="ident" id="8136108">err</span>&nbsp;<span class="op" id="8136112">:=</span>&nbsp;<span class="ident" id="8136115">s</span><span class="op" id="8136116">.</span><span class="ident" id="8136117">Write</span><span class="op" id="8136122">(</span><span class="ident" id="8136123">buf</span><span class="op" id="8136126">[</span><span class="op" id="8136127">:</span><span class="op" id="8136128">]</span><span class="op" id="8136129">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136135">if</span>&nbsp;<span class="ident" id="8136138">err</span>&nbsp;<span class="op" id="8136142">!=</span>&nbsp;<span class="ident" id="8136145">nil</span>&nbsp;<span class="op" id="8136149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136156">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136172">s</span><span class="op" id="8136173">.</span><span class="ident" id="8136174">SetDeadline</span><span class="op" id="8136185">(</span><span class="ident" id="8136186">time</span><span class="op" id="8136190">.</span><span class="ident" id="8136191">Now</span><span class="op" id="8136194">(</span><span class="op" id="8136195">)</span><span class="op" id="8136196">.</span><span class="ident" id="8136197">Add</span><span class="op" id="8136200">(</span><span class="ident" id="8136201">time</span><span class="op" id="8136205">.</span><span class="ident" id="8136206">Hour</span><span class="op" id="8136210">)</span><span class="op" id="8136211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136216">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136220">}</span><span class="op" id="8136221">(</span><span class="op" id="8136222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136226">buf</span>&nbsp;<span class="op" id="8136230">:=</span>&nbsp;<span class="builtinfunc" id="8136233">make</span><span class="op" id="8136237">(</span><span class="op" id="8136238">[</span><span class="op" id="8136239">]</span><span class="builtintype" id="8136240">byte</span><span class="op" id="8136244">,</span>&nbsp;<span class="num" id="8136246">1</span><span class="op" id="8136247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136251">for</span>&nbsp;<span class="op" id="8136255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136260">_</span><span class="op" id="8136261">,</span>&nbsp;<span class="ident" id="8136263">err</span>&nbsp;<span class="op" id="8136267">:=</span>&nbsp;<span class="ident" id="8136270">s</span><span class="op" id="8136271">.</span><span class="ident" id="8136272">Read</span><span class="op" id="8136276">(</span><span class="ident" id="8136277">buf</span><span class="op" id="8136280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136285">if</span>&nbsp;<span class="ident" id="8136288">err</span>&nbsp;<span class="op" id="8136292">!=</span>&nbsp;<span class="ident" id="8136295">nil</span>&nbsp;<span class="op" id="8136299">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136305">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136319">s</span><span class="op" id="8136320">.</span><span class="ident" id="8136321">SetDeadline</span><span class="op" id="8136332">(</span><span class="ident" id="8136333">time</span><span class="op" id="8136337">.</span><span class="ident" id="8136338">Now</span><span class="op" id="8136341">(</span><span class="op" id="8136342">)</span><span class="op" id="8136343">.</span><span class="ident" id="8136344">Add</span><span class="op" id="8136347">(</span><span class="ident" id="8136348">time</span><span class="op" id="8136352">.</span><span class="ident" id="8136353">Hour</span><span class="op" id="8136357">)</span><span class="op" id="8136358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136365">}</span><span class="op" id="8136366">(</span><span class="op" id="8136367">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136370">c</span><span class="op" id="8136371">,</span>&nbsp;<span class="ident" id="8136373">err</span>&nbsp;<span class="op" id="8136377">:=</span>&nbsp;<span class="ident" id="8136380">Dial</span><span class="op" id="8136384">(</span><span class="string" id="8136385">&#34;tcp&#34;</span><span class="op" id="8136390">,</span>&nbsp;<span class="ident" id="8136392">ln</span><span class="op" id="8136394">.</span><span class="ident" id="8136395">Addr</span><span class="op" id="8136399">(</span><span class="op" id="8136400">)</span><span class="op" id="8136401">.</span><span class="ident" id="8136402">String</span><span class="op" id="8136408">(</span><span class="op" id="8136409">)</span><span class="op" id="8136410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136413">if</span>&nbsp;<span class="ident" id="8136416">err</span>&nbsp;<span class="op" id="8136420">!=</span>&nbsp;<span class="ident" id="8136423">nil</span>&nbsp;<span class="op" id="8136427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136431">t</span><span class="op" id="8136432">.</span><span class="ident" id="8136433">Fatalf</span><span class="op" id="8136439">(</span><span class="string" id="8136440">&#34;DialTCP:&nbsp;%v&#34;</span><span class="op" id="8136453">,</span>&nbsp;<span class="ident" id="8136455">err</span><span class="op" id="8136458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136464">defer</span>&nbsp;<span class="ident" id="8136470">c</span><span class="op" id="8136471">.</span><span class="ident" id="8136472">Close</span><span class="op" id="8136477">(</span><span class="op" id="8136478">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136481">&lt;-</span><span class="ident" id="8136483">connected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136494">for</span>&nbsp;<span class="ident" id="8136498">i</span>&nbsp;<span class="op" id="8136500">:=</span>&nbsp;<span class="num" id="8136503">0</span><span class="op" id="8136504">;</span>&nbsp;<span class="ident" id="8136506">i</span>&nbsp;<span class="op" id="8136508">&lt;</span>&nbsp;<span class="num" id="8136510">1024</span><span class="op" id="8136514">;</span>&nbsp;<span class="ident" id="8136516">i</span><span class="op" id="8136517">++</span>&nbsp;<span class="op" id="8136520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136524">var</span>&nbsp;<span class="ident" id="8136528">buf</span>&nbsp;<span class="op" id="8136532">[</span><span class="num" id="8136533">1</span><span class="op" id="8136534">]</span><span class="builtintype" id="8136535">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136542">c</span><span class="op" id="8136543">.</span><span class="ident" id="8136544">Write</span><span class="op" id="8136549">(</span><span class="ident" id="8136550">buf</span><span class="op" id="8136553">[</span><span class="op" id="8136554">:</span><span class="op" id="8136555">]</span><span class="op" id="8136556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136559">}</span><br>
<span class="lineno">710</span><span class="op" id="8136561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8136564">func</span>&nbsp;<span class="ident" id="8136569">TestDeadlineRace</span><span class="op" id="8136585">(</span><span class="ident" id="8136586">t</span>&nbsp;<span class="op" id="8136588">*</span><span class="ident" id="8136589">testing</span><span class="op" id="8136596">.</span><span class="ident" id="8136597">T</span><span class="op" id="8136598">)</span>&nbsp;<span class="op" id="8136600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136603">switch</span>&nbsp;<span class="ident" id="8136610">runtime</span><span class="op" id="8136617">.</span><span class="ident" id="8136618">GOOS</span>&nbsp;<span class="op" id="8136623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136626">case</span>&nbsp;<span class="string" id="8136631">&#34;nacl&#34;</span><span class="op" id="8136637">,</span>&nbsp;<span class="string" id="8136639">&#34;plan9&#34;</span><span class="op" id="8136646">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136650">t</span><span class="op" id="8136651">.</span><span class="ident" id="8136652">Skipf</span><span class="op" id="8136657">(</span><span class="string" id="8136658">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8136679">,</span>&nbsp;<span class="ident" id="8136681">runtime</span><span class="op" id="8136688">.</span><span class="ident" id="8136689">GOOS</span><span class="op" id="8136693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136700">N</span>&nbsp;<span class="op" id="8136702">:=</span>&nbsp;<span class="num" id="8136705">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136711">if</span>&nbsp;<span class="ident" id="8136714">testing</span><span class="op" id="8136721">.</span><span class="ident" id="8136722">Short</span><span class="op" id="8136727">(</span><span class="op" id="8136728">)</span>&nbsp;<span class="op" id="8136730">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136734">N</span>&nbsp;<span class="op" id="8136736">=</span>&nbsp;<span class="num" id="8136738">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136745">defer</span>&nbsp;<span class="ident" id="8136751">runtime</span><span class="op" id="8136758">.</span><span class="ident" id="8136759">GOMAXPROCS</span><span class="op" id="8136769">(</span><span class="ident" id="8136770">runtime</span><span class="op" id="8136777">.</span><span class="ident" id="8136778">GOMAXPROCS</span><span class="op" id="8136788">(</span><span class="num" id="8136789">4</span><span class="op" id="8136790">)</span><span class="op" id="8136791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136794">ln</span>&nbsp;<span class="op" id="8136797">:=</span>&nbsp;<span class="ident" id="8136800">newLocalListener</span><span class="op" id="8136816">(</span><span class="ident" id="8136817">t</span><span class="op" id="8136818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136821">defer</span>&nbsp;<span class="ident" id="8136827">ln</span><span class="op" id="8136829">.</span><span class="ident" id="8136830">Close</span><span class="op" id="8136835">(</span><span class="op" id="8136836">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136839">c</span><span class="op" id="8136840">,</span>&nbsp;<span class="ident" id="8136842">err</span>&nbsp;<span class="op" id="8136846">:=</span>&nbsp;<span class="ident" id="8136849">Dial</span><span class="op" id="8136853">(</span><span class="string" id="8136854">&#34;tcp&#34;</span><span class="op" id="8136859">,</span>&nbsp;<span class="ident" id="8136861">ln</span><span class="op" id="8136863">.</span><span class="ident" id="8136864">Addr</span><span class="op" id="8136868">(</span><span class="op" id="8136869">)</span><span class="op" id="8136870">.</span><span class="ident" id="8136871">String</span><span class="op" id="8136877">(</span><span class="op" id="8136878">)</span><span class="op" id="8136879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136882">if</span>&nbsp;<span class="ident" id="8136885">err</span>&nbsp;<span class="op" id="8136889">!=</span>&nbsp;<span class="ident" id="8136892">nil</span>&nbsp;<span class="op" id="8136896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136900">t</span><span class="op" id="8136901">.</span><span class="ident" id="8136902">Fatalf</span><span class="op" id="8136908">(</span><span class="string" id="8136909">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8136919">,</span>&nbsp;<span class="ident" id="8136921">err</span><span class="op" id="8136924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136930">defer</span>&nbsp;<span class="ident" id="8136936">c</span><span class="op" id="8136937">.</span><span class="ident" id="8136938">Close</span><span class="op" id="8136943">(</span><span class="op" id="8136944">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136947">done</span>&nbsp;<span class="op" id="8136952">:=</span>&nbsp;<span class="builtinfunc" id="8136955">make</span><span class="op" id="8136959">(</span><span class="keyword" id="8136960">chan</span>&nbsp;<span class="builtintype" id="8136965">bool</span><span class="op" id="8136969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136972">go</span>&nbsp;<span class="keyword" id="8136975">func</span><span class="op" id="8136979">(</span><span class="op" id="8136980">)</span>&nbsp;<span class="op" id="8136982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136986">t</span>&nbsp;<span class="op" id="8136988">:=</span>&nbsp;<span class="ident" id="8136991">time</span><span class="op" id="8136995">.</span><span class="ident" id="8136996">NewTicker</span><span class="op" id="8137005">(</span><span class="num" id="8137006">2</span>&nbsp;<span class="op" id="8137008">*</span>&nbsp;<span class="ident" id="8137010">time</span><span class="op" id="8137014">.</span><span class="ident" id="8137015">Microsecond</span><span class="op" id="8137026">)</span><span class="op" id="8137027">.</span><span class="ident" id="8137028">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8137032">for</span>&nbsp;<span class="ident" id="8137036">i</span>&nbsp;<span class="op" id="8137038">:=</span>&nbsp;<span class="num" id="8137041">0</span><span class="op" id="8137042">;</span>&nbsp;<span class="ident" id="8137044">i</span>&nbsp;<span class="op" id="8137046">&lt;</span>&nbsp;<span class="ident" id="8137048">N</span><span class="op" id="8137049">;</span>&nbsp;<span class="ident" id="8137051">i</span><span class="op" id="8137052">++</span>&nbsp;<span class="op" id="8137055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8137060">if</span>&nbsp;<span class="ident" id="8137063">err</span>&nbsp;<span class="op" id="8137067">:=</span>&nbsp;<span class="ident" id="8137070">c</span><span class="op" id="8137071">.</span><span class="ident" id="8137072">SetDeadline</span><span class="op" id="8137083">(</span><span class="ident" id="8137084">time</span><span class="op" id="8137088">.</span><span class="ident" id="8137089">Now</span><span class="op" id="8137092">(</span><span class="op" id="8137093">)</span><span class="op" id="8137094">.</span><span class="ident" id="8137095">Add</span><span class="op" id="8137098">(</span><span class="num" id="8137099">2</span>&nbsp;<span class="op" id="8137101">*</span>&nbsp;<span class="ident" id="8137103">time</span><span class="op" id="8137107">.</span><span class="ident" id="8137108">Microsecond</span><span class="op" id="8137119">)</span><span class="op" id="8137120">)</span><span class="op" id="8137121">;</span>&nbsp;<span class="ident" id="8137123">err</span>&nbsp;<span class="op" id="8137127">!=</span>&nbsp;<span class="ident" id="8137130">nil</span>&nbsp;<span class="op" id="8137134">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8137140">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137154">&lt;-</span><span class="ident" id="8137156">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137164">done</span>&nbsp;<span class="op" id="8137169">&lt;-</span>&nbsp;<span class="builtintype" id="8137172">true</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137178">}</span><span class="op" id="8137179">(</span><span class="op" id="8137180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8137183">var</span>&nbsp;<span class="ident" id="8137187">buf</span>&nbsp;<span class="op" id="8137191">[</span><span class="num" id="8137192">1</span><span class="op" id="8137193">]</span><span class="builtintype" id="8137194">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8137200">for</span>&nbsp;<span class="ident" id="8137204">i</span>&nbsp;<span class="op" id="8137206">:=</span>&nbsp;<span class="num" id="8137209">0</span><span class="op" id="8137210">;</span>&nbsp;<span class="ident" id="8137212">i</span>&nbsp;<span class="op" id="8137214">&lt;</span>&nbsp;<span class="ident" id="8137216">N</span><span class="op" id="8137217">;</span>&nbsp;<span class="ident" id="8137219">i</span><span class="op" id="8137220">++</span>&nbsp;<span class="op" id="8137223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137227">c</span><span class="op" id="8137228">.</span><span class="ident" id="8137229">Read</span><span class="op" id="8137233">(</span><span class="ident" id="8137234">buf</span><span class="op" id="8137237">[</span><span class="op" id="8137238">:</span><span class="op" id="8137239">]</span><span class="op" id="8137240">)</span>&nbsp;<span class="comment" id="8137242">//&nbsp;ignore&nbsp;possible&nbsp;timeout&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137277">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137280">c</span><span class="op" id="8137281">.</span><span class="ident" id="8137282">Close</span><span class="op" id="8137287">(</span><span class="op" id="8137288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137291">&lt;-</span><span class="ident" id="8137293">done</span><br>
<span class="lineno"></span><span class="op" id="8137298">}</span>
</div>
</body>
</html>
