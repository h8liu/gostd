<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6375229">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6375284">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6375338">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6375389">package</span>&nbsp;<span class="ident" id="6375397">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6375403">import</span>&nbsp;<span class="op" id="6375410">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6375413">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="6375421">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="6375424">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6375484">func</span>&nbsp;<span class="op" id="6375489">(</span><span class="ident" id="6375490">d</span>&nbsp;<span class="op" id="6375492">*</span><span class="ident" id="6375493">decoder</span><span class="op" id="6375500">)</span>&nbsp;<span class="ident" id="6375502">makeImg</span><span class="op" id="6375509">(</span><span class="ident" id="6375510">h0</span><span class="op" id="6375512">,</span>&nbsp;<span class="ident" id="6375514">v0</span><span class="op" id="6375516">,</span>&nbsp;<span class="ident" id="6375518">mxx</span><span class="op" id="6375521">,</span>&nbsp;<span class="ident" id="6375523">myy</span>&nbsp;<span class="builtintype" id="6375527">int</span><span class="op" id="6375530">)</span>&nbsp;<span class="op" id="6375532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375535">if</span>&nbsp;<span class="ident" id="6375538">d</span><span class="op" id="6375539">.</span><span class="ident" id="6375540">nComp</span>&nbsp;<span class="op" id="6375546">==</span>&nbsp;<span class="ident" id="6375549">nGrayComponent</span>&nbsp;<span class="op" id="6375564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375568">m</span>&nbsp;<span class="op" id="6375570">:=</span>&nbsp;<span class="ident" id="6375573">image</span><span class="op" id="6375578">.</span><span class="ident" id="6375579">NewGray</span><span class="op" id="6375586">(</span><span class="ident" id="6375587">image</span><span class="op" id="6375592">.</span><span class="ident" id="6375593">Rect</span><span class="op" id="6375597">(</span><span class="num" id="6375598">0</span><span class="op" id="6375599">,</span>&nbsp;<span class="num" id="6375601">0</span><span class="op" id="6375602">,</span>&nbsp;<span class="num" id="6375604">8</span><span class="op" id="6375605">*</span><span class="ident" id="6375606">mxx</span><span class="op" id="6375609">,</span>&nbsp;<span class="num" id="6375611">8</span><span class="op" id="6375612">*</span><span class="ident" id="6375613">myy</span><span class="op" id="6375616">)</span><span class="op" id="6375617">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375621">d</span><span class="op" id="6375622">.</span><span class="ident" id="6375623">img1</span>&nbsp;<span class="op" id="6375628">=</span>&nbsp;<span class="ident" id="6375630">m</span><span class="op" id="6375631">.</span><span class="ident" id="6375632">SubImage</span><span class="op" id="6375640">(</span><span class="ident" id="6375641">image</span><span class="op" id="6375646">.</span><span class="ident" id="6375647">Rect</span><span class="op" id="6375651">(</span><span class="num" id="6375652">0</span><span class="op" id="6375653">,</span>&nbsp;<span class="num" id="6375655">0</span><span class="op" id="6375656">,</span>&nbsp;<span class="ident" id="6375658">d</span><span class="op" id="6375659">.</span><span class="ident" id="6375660">width</span><span class="op" id="6375665">,</span>&nbsp;<span class="ident" id="6375667">d</span><span class="op" id="6375668">.</span><span class="ident" id="6375669">height</span><span class="op" id="6375675">)</span><span class="op" id="6375676">)</span><span class="op" id="6375677">.</span><span class="op" id="6375678">(</span><span class="op" id="6375679">*</span><span class="ident" id="6375680">image</span><span class="op" id="6375685">.</span><span class="ident" id="6375686">Gray</span><span class="op" id="6375690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375694">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6375702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375705">var</span>&nbsp;<span class="ident" id="6375709">subsampleRatio</span>&nbsp;<span class="ident" id="6375724">image</span><span class="op" id="6375729">.</span><span class="ident" id="6375730">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375751">switch</span>&nbsp;<span class="op" id="6375758">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375761">case</span>&nbsp;<span class="ident" id="6375766">h0</span>&nbsp;<span class="op" id="6375769">==</span>&nbsp;<span class="num" id="6375772">1</span>&nbsp;<span class="op" id="6375774">&amp;&amp;</span>&nbsp;<span class="ident" id="6375777">v0</span>&nbsp;<span class="op" id="6375780">==</span>&nbsp;<span class="num" id="6375783">1</span><span class="op" id="6375784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375788">subsampleRatio</span>&nbsp;<span class="op" id="6375803">=</span>&nbsp;<span class="ident" id="6375805">image</span><span class="op" id="6375810">.</span><span class="ident" id="6375811">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375835">case</span>&nbsp;<span class="ident" id="6375840">h0</span>&nbsp;<span class="op" id="6375843">==</span>&nbsp;<span class="num" id="6375846">1</span>&nbsp;<span class="op" id="6375848">&amp;&amp;</span>&nbsp;<span class="ident" id="6375851">v0</span>&nbsp;<span class="op" id="6375854">==</span>&nbsp;<span class="num" id="6375857">2</span><span class="op" id="6375858">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375862">subsampleRatio</span>&nbsp;<span class="op" id="6375877">=</span>&nbsp;<span class="ident" id="6375879">image</span><span class="op" id="6375884">.</span><span class="ident" id="6375885">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375909">case</span>&nbsp;<span class="ident" id="6375914">h0</span>&nbsp;<span class="op" id="6375917">==</span>&nbsp;<span class="num" id="6375920">2</span>&nbsp;<span class="op" id="6375922">&amp;&amp;</span>&nbsp;<span class="ident" id="6375925">v0</span>&nbsp;<span class="op" id="6375928">==</span>&nbsp;<span class="num" id="6375931">1</span><span class="op" id="6375932">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375936">subsampleRatio</span>&nbsp;<span class="op" id="6375951">=</span>&nbsp;<span class="ident" id="6375953">image</span><span class="op" id="6375958">.</span><span class="ident" id="6375959">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375983">case</span>&nbsp;<span class="ident" id="6375988">h0</span>&nbsp;<span class="op" id="6375991">==</span>&nbsp;<span class="num" id="6375994">2</span>&nbsp;<span class="op" id="6375996">&amp;&amp;</span>&nbsp;<span class="ident" id="6375999">v0</span>&nbsp;<span class="op" id="6376002">==</span>&nbsp;<span class="num" id="6376005">2</span><span class="op" id="6376006">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376010">subsampleRatio</span>&nbsp;<span class="op" id="6376025">=</span>&nbsp;<span class="ident" id="6376027">image</span><span class="op" id="6376032">.</span><span class="ident" id="6376033">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376057">default</span><span class="op" id="6376064">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6376068">panic</span><span class="op" id="6376073">(</span><span class="string" id="6376074">&#34;unreachable&#34;</span><span class="op" id="6376087">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376093">m</span>&nbsp;<span class="op" id="6376095">:=</span>&nbsp;<span class="ident" id="6376098">image</span><span class="op" id="6376103">.</span><span class="ident" id="6376104">NewYCbCr</span><span class="op" id="6376112">(</span><span class="ident" id="6376113">image</span><span class="op" id="6376118">.</span><span class="ident" id="6376119">Rect</span><span class="op" id="6376123">(</span><span class="num" id="6376124">0</span><span class="op" id="6376125">,</span>&nbsp;<span class="num" id="6376127">0</span><span class="op" id="6376128">,</span>&nbsp;<span class="num" id="6376130">8</span><span class="op" id="6376131">*</span><span class="ident" id="6376132">h0</span><span class="op" id="6376134">*</span><span class="ident" id="6376135">mxx</span><span class="op" id="6376138">,</span>&nbsp;<span class="num" id="6376140">8</span><span class="op" id="6376141">*</span><span class="ident" id="6376142">v0</span><span class="op" id="6376144">*</span><span class="ident" id="6376145">myy</span><span class="op" id="6376148">)</span><span class="op" id="6376149">,</span>&nbsp;<span class="ident" id="6376151">subsampleRatio</span><span class="op" id="6376165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376168">d</span><span class="op" id="6376169">.</span><span class="ident" id="6376170">img3</span>&nbsp;<span class="op" id="6376175">=</span>&nbsp;<span class="ident" id="6376177">m</span><span class="op" id="6376178">.</span><span class="ident" id="6376179">SubImage</span><span class="op" id="6376187">(</span><span class="ident" id="6376188">image</span><span class="op" id="6376193">.</span><span class="ident" id="6376194">Rect</span><span class="op" id="6376198">(</span><span class="num" id="6376199">0</span><span class="op" id="6376200">,</span>&nbsp;<span class="num" id="6376202">0</span><span class="op" id="6376203">,</span>&nbsp;<span class="ident" id="6376205">d</span><span class="op" id="6376206">.</span><span class="ident" id="6376207">width</span><span class="op" id="6376212">,</span>&nbsp;<span class="ident" id="6376214">d</span><span class="op" id="6376215">.</span><span class="ident" id="6376216">height</span><span class="op" id="6376222">)</span><span class="op" id="6376223">)</span><span class="op" id="6376224">.</span><span class="op" id="6376225">(</span><span class="op" id="6376226">*</span><span class="ident" id="6376227">image</span><span class="op" id="6376232">.</span><span class="ident" id="6376233">YCbCr</span><span class="op" id="6376238">)</span><br>
<span class="lineno"></span><span class="op" id="6376240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6376243">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="6376274">func</span>&nbsp;<span class="op" id="6376279">(</span><span class="ident" id="6376280">d</span>&nbsp;<span class="op" id="6376282">*</span><span class="ident" id="6376283">decoder</span><span class="op" id="6376290">)</span>&nbsp;<span class="ident" id="6376292">processSOS</span><span class="op" id="6376302">(</span><span class="ident" id="6376303">n</span>&nbsp;<span class="builtintype" id="6376305">int</span><span class="op" id="6376308">)</span>&nbsp;<span class="builtintype" id="6376310">error</span>&nbsp;<span class="op" id="6376316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376319">if</span>&nbsp;<span class="ident" id="6376322">d</span><span class="op" id="6376323">.</span><span class="ident" id="6376324">nComp</span>&nbsp;<span class="op" id="6376330">==</span>&nbsp;<span class="num" id="6376333">0</span>&nbsp;<span class="op" id="6376335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376339">return</span>&nbsp;<span class="ident" id="6376346">FormatError</span><span class="op" id="6376357">(</span><span class="string" id="6376358">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="6376378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376381">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376384">if</span>&nbsp;<span class="ident" id="6376387">n</span>&nbsp;<span class="op" id="6376389">&lt;</span>&nbsp;<span class="num" id="6376391">6</span>&nbsp;<span class="op" id="6376393">||</span>&nbsp;<span class="num" id="6376396">4</span><span class="op" id="6376397">+</span><span class="num" id="6376398">2</span><span class="op" id="6376399">*</span><span class="ident" id="6376400">d</span><span class="op" id="6376401">.</span><span class="ident" id="6376402">nComp</span>&nbsp;<span class="op" id="6376408">&lt;</span>&nbsp;<span class="ident" id="6376410">n</span>&nbsp;<span class="op" id="6376412">||</span>&nbsp;<span class="ident" id="6376415">n</span><span class="op" id="6376416">%</span><span class="num" id="6376417">2</span>&nbsp;<span class="op" id="6376419">!=</span>&nbsp;<span class="num" id="6376422">0</span>&nbsp;<span class="op" id="6376424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376428">return</span>&nbsp;<span class="ident" id="6376435">FormatError</span><span class="op" id="6376446">(</span><span class="string" id="6376447">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="6376469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376475">if</span>&nbsp;<span class="ident" id="6376478">err</span>&nbsp;<span class="op" id="6376482">:=</span>&nbsp;<span class="ident" id="6376485">d</span><span class="op" id="6376486">.</span><span class="ident" id="6376487">readFull</span><span class="op" id="6376495">(</span><span class="ident" id="6376496">d</span><span class="op" id="6376497">.</span><span class="ident" id="6376498">tmp</span><span class="op" id="6376501">[</span><span class="op" id="6376502">:</span><span class="ident" id="6376503">n</span><span class="op" id="6376504">]</span><span class="op" id="6376505">)</span><span class="op" id="6376506">;</span>&nbsp;<span class="ident" id="6376508">err</span>&nbsp;<span class="op" id="6376512">!=</span>&nbsp;<span class="ident" id="6376515">nil</span>&nbsp;<span class="op" id="6376519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376523">return</span>&nbsp;<span class="ident" id="6376530">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376538">nComp</span>&nbsp;<span class="op" id="6376544">:=</span>&nbsp;<span class="builtintype" id="6376547">int</span><span class="op" id="6376550">(</span><span class="ident" id="6376551">d</span><span class="op" id="6376552">.</span><span class="ident" id="6376553">tmp</span><span class="op" id="6376556">[</span><span class="num" id="6376557">0</span><span class="op" id="6376558">]</span><span class="op" id="6376559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376562">if</span>&nbsp;<span class="ident" id="6376565">n</span>&nbsp;<span class="op" id="6376567">!=</span>&nbsp;<span class="num" id="6376570">4</span><span class="op" id="6376571">+</span><span class="num" id="6376572">2</span><span class="op" id="6376573">*</span><span class="ident" id="6376574">nComp</span>&nbsp;<span class="op" id="6376580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376584">return</span>&nbsp;<span class="ident" id="6376591">FormatError</span><span class="op" id="6376602">(</span><span class="string" id="6376603">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="6376654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376657">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376660">var</span>&nbsp;<span class="ident" id="6376664">scan</span>&nbsp;<span class="op" id="6376669">[</span><span class="ident" id="6376670">nColorComponent</span><span class="op" id="6376685">]</span><span class="keyword" id="6376686">struct</span>&nbsp;<span class="op" id="6376693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376697">compIndex</span>&nbsp;<span class="builtintype" id="6376707">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376715">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6376725">uint8</span>&nbsp;<span class="comment" id="6376731">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376755">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6376765">uint8</span>&nbsp;<span class="comment" id="6376771">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376794">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376797">for</span>&nbsp;<span class="ident" id="6376801">i</span>&nbsp;<span class="op" id="6376803">:=</span>&nbsp;<span class="num" id="6376806">0</span><span class="op" id="6376807">;</span>&nbsp;<span class="ident" id="6376809">i</span>&nbsp;<span class="op" id="6376811">&lt;</span>&nbsp;<span class="ident" id="6376813">nComp</span><span class="op" id="6376818">;</span>&nbsp;<span class="ident" id="6376820">i</span><span class="op" id="6376821">++</span>&nbsp;<span class="op" id="6376824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376828">cs</span>&nbsp;<span class="op" id="6376831">:=</span>&nbsp;<span class="ident" id="6376834">d</span><span class="op" id="6376835">.</span><span class="ident" id="6376836">tmp</span><span class="op" id="6376839">[</span><span class="num" id="6376840">1</span><span class="op" id="6376841">+</span><span class="num" id="6376842">2</span><span class="op" id="6376843">*</span><span class="ident" id="6376844">i</span><span class="op" id="6376845">]</span>&nbsp;<span class="comment" id="6376847">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376872">compIndex</span>&nbsp;<span class="op" id="6376882">:=</span>&nbsp;<span class="op" id="6376885">-</span><span class="num" id="6376886">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376890">for</span>&nbsp;<span class="ident" id="6376894">j</span><span class="op" id="6376895">,</span>&nbsp;<span class="ident" id="6376897">comp</span>&nbsp;<span class="op" id="6376902">:=</span>&nbsp;<span class="keyword" id="6376905">range</span>&nbsp;<span class="ident" id="6376911">d</span><span class="op" id="6376912">.</span><span class="ident" id="6376913">comp</span>&nbsp;<span class="op" id="6376918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376923">if</span>&nbsp;<span class="ident" id="6376926">cs</span>&nbsp;<span class="op" id="6376929">==</span>&nbsp;<span class="ident" id="6376932">comp</span><span class="op" id="6376936">.</span><span class="ident" id="6376937">c</span>&nbsp;<span class="op" id="6376939">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376945">compIndex</span>&nbsp;<span class="op" id="6376955">=</span>&nbsp;<span class="ident" id="6376957">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376970">if</span>&nbsp;<span class="ident" id="6376973">compIndex</span>&nbsp;<span class="op" id="6376983">&lt;</span>&nbsp;<span class="num" id="6376985">0</span>&nbsp;<span class="op" id="6376987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376992">return</span>&nbsp;<span class="ident" id="6376999">FormatError</span><span class="op" id="6377010">(</span><span class="string" id="6377011">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="6377039">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6377043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377047">scan</span><span class="op" id="6377051">[</span><span class="ident" id="6377052">i</span><span class="op" id="6377053">]</span><span class="op" id="6377054">.</span><span class="ident" id="6377055">compIndex</span>&nbsp;<span class="op" id="6377065">=</span>&nbsp;<span class="builtintype" id="6377067">uint8</span><span class="op" id="6377072">(</span><span class="ident" id="6377073">compIndex</span><span class="op" id="6377082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377086">scan</span><span class="op" id="6377090">[</span><span class="ident" id="6377091">i</span><span class="op" id="6377092">]</span><span class="op" id="6377093">.</span><span class="ident" id="6377094">td</span>&nbsp;<span class="op" id="6377097">=</span>&nbsp;<span class="ident" id="6377099">d</span><span class="op" id="6377100">.</span><span class="ident" id="6377101">tmp</span><span class="op" id="6377104">[</span><span class="num" id="6377105">2</span><span class="op" id="6377106">+</span><span class="num" id="6377107">2</span><span class="op" id="6377108">*</span><span class="ident" id="6377109">i</span><span class="op" id="6377110">]</span>&nbsp;<span class="op" id="6377112">&gt;&gt;</span>&nbsp;<span class="num" id="6377115">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377119">if</span>&nbsp;<span class="ident" id="6377122">scan</span><span class="op" id="6377126">[</span><span class="ident" id="6377127">i</span><span class="op" id="6377128">]</span><span class="op" id="6377129">.</span><span class="ident" id="6377130">td</span>&nbsp;<span class="op" id="6377133">&gt;</span>&nbsp;<span class="ident" id="6377135">maxTh</span>&nbsp;<span class="op" id="6377141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377146">return</span>&nbsp;<span class="ident" id="6377153">FormatError</span><span class="op" id="6377164">(</span><span class="string" id="6377165">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="6377179">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6377183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377187">scan</span><span class="op" id="6377191">[</span><span class="ident" id="6377192">i</span><span class="op" id="6377193">]</span><span class="op" id="6377194">.</span><span class="ident" id="6377195">ta</span>&nbsp;<span class="op" id="6377198">=</span>&nbsp;<span class="ident" id="6377200">d</span><span class="op" id="6377201">.</span><span class="ident" id="6377202">tmp</span><span class="op" id="6377205">[</span><span class="num" id="6377206">2</span><span class="op" id="6377207">+</span><span class="num" id="6377208">2</span><span class="op" id="6377209">*</span><span class="ident" id="6377210">i</span><span class="op" id="6377211">]</span>&nbsp;<span class="op" id="6377213">&amp;</span>&nbsp;<span class="num" id="6377215">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377222">if</span>&nbsp;<span class="ident" id="6377225">scan</span><span class="op" id="6377229">[</span><span class="ident" id="6377230">i</span><span class="op" id="6377231">]</span><span class="op" id="6377232">.</span><span class="ident" id="6377233">ta</span>&nbsp;<span class="op" id="6377236">&gt;</span>&nbsp;<span class="ident" id="6377238">maxTh</span>&nbsp;<span class="op" id="6377244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377249">return</span>&nbsp;<span class="ident" id="6377256">FormatError</span><span class="op" id="6377267">(</span><span class="string" id="6377268">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="6377282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6377286">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6377289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377293">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377352">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377420">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377471">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377475">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377545">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377616">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377686">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377753">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377821">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377890">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377957">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378027">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378090">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378111">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378115">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378184">zigStart</span><span class="op" id="6378192">,</span>&nbsp;<span class="ident" id="6378194">zigEnd</span><span class="op" id="6378200">,</span>&nbsp;<span class="ident" id="6378202">ah</span><span class="op" id="6378204">,</span>&nbsp;<span class="ident" id="6378206">al</span>&nbsp;<span class="op" id="6378209">:=</span>&nbsp;<span class="builtintype" id="6378212">int32</span><span class="op" id="6378217">(</span><span class="num" id="6378218">0</span><span class="op" id="6378219">)</span><span class="op" id="6378220">,</span>&nbsp;<span class="builtintype" id="6378222">int32</span><span class="op" id="6378227">(</span><span class="ident" id="6378228">blockSize</span><span class="op" id="6378237">-</span><span class="num" id="6378238">1</span><span class="op" id="6378239">)</span><span class="op" id="6378240">,</span>&nbsp;<span class="builtintype" id="6378242">uint32</span><span class="op" id="6378248">(</span><span class="num" id="6378249">0</span><span class="op" id="6378250">)</span><span class="op" id="6378251">,</span>&nbsp;<span class="builtintype" id="6378253">uint32</span><span class="op" id="6378259">(</span><span class="num" id="6378260">0</span><span class="op" id="6378261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378264">if</span>&nbsp;<span class="ident" id="6378267">d</span><span class="op" id="6378268">.</span><span class="ident" id="6378269">progressive</span>&nbsp;<span class="op" id="6378281">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378285">zigStart</span>&nbsp;<span class="op" id="6378294">=</span>&nbsp;<span class="builtintype" id="6378296">int32</span><span class="op" id="6378301">(</span><span class="ident" id="6378302">d</span><span class="op" id="6378303">.</span><span class="ident" id="6378304">tmp</span><span class="op" id="6378307">[</span><span class="num" id="6378308">1</span><span class="op" id="6378309">+</span><span class="num" id="6378310">2</span><span class="op" id="6378311">*</span><span class="ident" id="6378312">nComp</span><span class="op" id="6378317">]</span><span class="op" id="6378318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378322">zigEnd</span>&nbsp;<span class="op" id="6378329">=</span>&nbsp;<span class="builtintype" id="6378331">int32</span><span class="op" id="6378336">(</span><span class="ident" id="6378337">d</span><span class="op" id="6378338">.</span><span class="ident" id="6378339">tmp</span><span class="op" id="6378342">[</span><span class="num" id="6378343">2</span><span class="op" id="6378344">+</span><span class="num" id="6378345">2</span><span class="op" id="6378346">*</span><span class="ident" id="6378347">nComp</span><span class="op" id="6378352">]</span><span class="op" id="6378353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378357">ah</span>&nbsp;<span class="op" id="6378360">=</span>&nbsp;<span class="builtintype" id="6378362">uint32</span><span class="op" id="6378368">(</span><span class="ident" id="6378369">d</span><span class="op" id="6378370">.</span><span class="ident" id="6378371">tmp</span><span class="op" id="6378374">[</span><span class="num" id="6378375">3</span><span class="op" id="6378376">+</span><span class="num" id="6378377">2</span><span class="op" id="6378378">*</span><span class="ident" id="6378379">nComp</span><span class="op" id="6378384">]</span>&nbsp;<span class="op" id="6378386">&gt;&gt;</span>&nbsp;<span class="num" id="6378389">4</span><span class="op" id="6378390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378394">al</span>&nbsp;<span class="op" id="6378397">=</span>&nbsp;<span class="builtintype" id="6378399">uint32</span><span class="op" id="6378405">(</span><span class="ident" id="6378406">d</span><span class="op" id="6378407">.</span><span class="ident" id="6378408">tmp</span><span class="op" id="6378411">[</span><span class="num" id="6378412">3</span><span class="op" id="6378413">+</span><span class="num" id="6378414">2</span><span class="op" id="6378415">*</span><span class="ident" id="6378416">nComp</span><span class="op" id="6378421">]</span>&nbsp;<span class="op" id="6378423">&amp;</span>&nbsp;<span class="num" id="6378425">0x0f</span><span class="op" id="6378429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378433">if</span>&nbsp;<span class="op" id="6378436">(</span><span class="ident" id="6378437">zigStart</span>&nbsp;<span class="op" id="6378446">==</span>&nbsp;<span class="num" id="6378449">0</span>&nbsp;<span class="op" id="6378451">&amp;&amp;</span>&nbsp;<span class="ident" id="6378454">zigEnd</span>&nbsp;<span class="op" id="6378461">!=</span>&nbsp;<span class="num" id="6378464">0</span><span class="op" id="6378465">)</span>&nbsp;<span class="op" id="6378467">||</span>&nbsp;<span class="ident" id="6378470">zigStart</span>&nbsp;<span class="op" id="6378479">&gt;</span>&nbsp;<span class="ident" id="6378481">zigEnd</span>&nbsp;<span class="op" id="6378488">||</span>&nbsp;<span class="ident" id="6378491">blockSize</span>&nbsp;<span class="op" id="6378501">&lt;=</span>&nbsp;<span class="ident" id="6378504">zigEnd</span>&nbsp;<span class="op" id="6378511">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378516">return</span>&nbsp;<span class="ident" id="6378523">FormatError</span><span class="op" id="6378534">(</span><span class="string" id="6378535">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="6378566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6378570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378574">if</span>&nbsp;<span class="ident" id="6378577">zigStart</span>&nbsp;<span class="op" id="6378586">!=</span>&nbsp;<span class="num" id="6378589">0</span>&nbsp;<span class="op" id="6378591">&amp;&amp;</span>&nbsp;<span class="ident" id="6378594">nComp</span>&nbsp;<span class="op" id="6378600">!=</span>&nbsp;<span class="num" id="6378603">1</span>&nbsp;<span class="op" id="6378605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378610">return</span>&nbsp;<span class="ident" id="6378617">FormatError</span><span class="op" id="6378628">(</span><span class="string" id="6378629">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="6378686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6378690">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378694">if</span>&nbsp;<span class="ident" id="6378697">ah</span>&nbsp;<span class="op" id="6378700">!=</span>&nbsp;<span class="num" id="6378703">0</span>&nbsp;<span class="op" id="6378705">&amp;&amp;</span>&nbsp;<span class="ident" id="6378708">ah</span>&nbsp;<span class="op" id="6378711">!=</span>&nbsp;<span class="ident" id="6378714">al</span><span class="op" id="6378716">+</span><span class="num" id="6378717">1</span>&nbsp;<span class="op" id="6378719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378724">return</span>&nbsp;<span class="ident" id="6378731">FormatError</span><span class="op" id="6378742">(</span><span class="string" id="6378743">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="6378780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6378784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6378787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378791">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378866">h0</span><span class="op" id="6378868">,</span>&nbsp;<span class="ident" id="6378870">v0</span>&nbsp;<span class="op" id="6378873">:=</span>&nbsp;<span class="ident" id="6378876">d</span><span class="op" id="6378877">.</span><span class="ident" id="6378878">comp</span><span class="op" id="6378882">[</span><span class="num" id="6378883">0</span><span class="op" id="6378884">]</span><span class="op" id="6378885">.</span><span class="ident" id="6378886">h</span><span class="op" id="6378887">,</span>&nbsp;<span class="ident" id="6378889">d</span><span class="op" id="6378890">.</span><span class="ident" id="6378891">comp</span><span class="op" id="6378895">[</span><span class="num" id="6378896">0</span><span class="op" id="6378897">]</span><span class="op" id="6378898">.</span><span class="ident" id="6378899">v</span>&nbsp;<span class="comment" id="6378901">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378947">mxx</span>&nbsp;<span class="op" id="6378951">:=</span>&nbsp;<span class="op" id="6378954">(</span><span class="ident" id="6378955">d</span><span class="op" id="6378956">.</span><span class="ident" id="6378957">width</span>&nbsp;<span class="op" id="6378963">+</span>&nbsp;<span class="num" id="6378965">8</span><span class="op" id="6378966">*</span><span class="ident" id="6378967">h0</span>&nbsp;<span class="op" id="6378970">-</span>&nbsp;<span class="num" id="6378972">1</span><span class="op" id="6378973">)</span>&nbsp;<span class="op" id="6378975">/</span>&nbsp;<span class="op" id="6378977">(</span><span class="num" id="6378978">8</span>&nbsp;<span class="op" id="6378980">*</span>&nbsp;<span class="ident" id="6378982">h0</span><span class="op" id="6378984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378987">myy</span>&nbsp;<span class="op" id="6378991">:=</span>&nbsp;<span class="op" id="6378994">(</span><span class="ident" id="6378995">d</span><span class="op" id="6378996">.</span><span class="ident" id="6378997">height</span>&nbsp;<span class="op" id="6379004">+</span>&nbsp;<span class="num" id="6379006">8</span><span class="op" id="6379007">*</span><span class="ident" id="6379008">v0</span>&nbsp;<span class="op" id="6379011">-</span>&nbsp;<span class="num" id="6379013">1</span><span class="op" id="6379014">)</span>&nbsp;<span class="op" id="6379016">/</span>&nbsp;<span class="op" id="6379018">(</span><span class="num" id="6379019">8</span>&nbsp;<span class="op" id="6379021">*</span>&nbsp;<span class="ident" id="6379023">v0</span><span class="op" id="6379025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379028">if</span>&nbsp;<span class="ident" id="6379031">d</span><span class="op" id="6379032">.</span><span class="ident" id="6379033">img1</span>&nbsp;<span class="op" id="6379038">==</span>&nbsp;<span class="ident" id="6379041">nil</span>&nbsp;<span class="op" id="6379045">&amp;&amp;</span>&nbsp;<span class="ident" id="6379048">d</span><span class="op" id="6379049">.</span><span class="ident" id="6379050">img3</span>&nbsp;<span class="op" id="6379055">==</span>&nbsp;<span class="ident" id="6379058">nil</span>&nbsp;<span class="op" id="6379062">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379066">d</span><span class="op" id="6379067">.</span><span class="ident" id="6379068">makeImg</span><span class="op" id="6379075">(</span><span class="ident" id="6379076">h0</span><span class="op" id="6379078">,</span>&nbsp;<span class="ident" id="6379080">v0</span><span class="op" id="6379082">,</span>&nbsp;<span class="ident" id="6379084">mxx</span><span class="op" id="6379087">,</span>&nbsp;<span class="ident" id="6379089">myy</span><span class="op" id="6379092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6379095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379098">if</span>&nbsp;<span class="ident" id="6379101">d</span><span class="op" id="6379102">.</span><span class="ident" id="6379103">progressive</span>&nbsp;<span class="op" id="6379115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379119">for</span>&nbsp;<span class="ident" id="6379123">i</span>&nbsp;<span class="op" id="6379125">:=</span>&nbsp;<span class="num" id="6379128">0</span><span class="op" id="6379129">;</span>&nbsp;<span class="ident" id="6379131">i</span>&nbsp;<span class="op" id="6379133">&lt;</span>&nbsp;<span class="ident" id="6379135">nComp</span><span class="op" id="6379140">;</span>&nbsp;<span class="ident" id="6379142">i</span><span class="op" id="6379143">++</span>&nbsp;<span class="op" id="6379146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379151">compIndex</span>&nbsp;<span class="op" id="6379161">:=</span>&nbsp;<span class="ident" id="6379164">scan</span><span class="op" id="6379168">[</span><span class="ident" id="6379169">i</span><span class="op" id="6379170">]</span><span class="op" id="6379171">.</span><span class="ident" id="6379172">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379185">if</span>&nbsp;<span class="ident" id="6379188">d</span><span class="op" id="6379189">.</span><span class="ident" id="6379190">progCoeffs</span><span class="op" id="6379200">[</span><span class="ident" id="6379201">compIndex</span><span class="op" id="6379210">]</span>&nbsp;<span class="op" id="6379212">==</span>&nbsp;<span class="ident" id="6379215">nil</span>&nbsp;<span class="op" id="6379219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379225">d</span><span class="op" id="6379226">.</span><span class="ident" id="6379227">progCoeffs</span><span class="op" id="6379237">[</span><span class="ident" id="6379238">compIndex</span><span class="op" id="6379247">]</span>&nbsp;<span class="op" id="6379249">=</span>&nbsp;<span class="builtinfunc" id="6379251">make</span><span class="op" id="6379255">(</span><span class="op" id="6379256">[</span><span class="op" id="6379257">]</span><span class="ident" id="6379258">block</span><span class="op" id="6379263">,</span>&nbsp;<span class="ident" id="6379265">mxx</span><span class="op" id="6379268">*</span><span class="ident" id="6379269">myy</span><span class="op" id="6379272">*</span><span class="ident" id="6379273">d</span><span class="op" id="6379274">.</span><span class="ident" id="6379275">comp</span><span class="op" id="6379279">[</span><span class="ident" id="6379280">compIndex</span><span class="op" id="6379289">]</span><span class="op" id="6379290">.</span><span class="ident" id="6379291">h</span><span class="op" id="6379292">*</span><span class="ident" id="6379293">d</span><span class="op" id="6379294">.</span><span class="ident" id="6379295">comp</span><span class="op" id="6379299">[</span><span class="ident" id="6379300">compIndex</span><span class="op" id="6379309">]</span><span class="op" id="6379310">.</span><span class="ident" id="6379311">v</span><span class="op" id="6379312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6379317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6379321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6379324">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379328">d</span><span class="op" id="6379329">.</span><span class="ident" id="6379330">bits</span>&nbsp;<span class="op" id="6379335">=</span>&nbsp;<span class="ident" id="6379337">bits</span><span class="op" id="6379341">{</span><span class="op" id="6379342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379345">mcu</span><span class="op" id="6379348">,</span>&nbsp;<span class="ident" id="6379350">expectedRST</span>&nbsp;<span class="op" id="6379362">:=</span>&nbsp;<span class="num" id="6379365">0</span><span class="op" id="6379366">,</span>&nbsp;<span class="builtintype" id="6379368">uint8</span><span class="op" id="6379373">(</span><span class="ident" id="6379374">rst0Marker</span><span class="op" id="6379384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379387">var</span>&nbsp;<span class="op" id="6379391">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379395">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379463">b</span>&nbsp;&nbsp;<span class="ident" id="6379466">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379474">dc</span>&nbsp;<span class="op" id="6379477">[</span><span class="ident" id="6379478">nColorComponent</span><span class="op" id="6379493">]</span><span class="builtintype" id="6379494">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379502">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379575">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379649">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379722">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379792">bx</span><span class="op" id="6379794">,</span>&nbsp;<span class="ident" id="6379796">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6379803">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379809">blockCount</span>&nbsp;<span class="builtintype" id="6379820">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6379825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379828">for</span>&nbsp;<span class="ident" id="6379832">my</span>&nbsp;<span class="op" id="6379835">:=</span>&nbsp;<span class="num" id="6379838">0</span><span class="op" id="6379839">;</span>&nbsp;<span class="ident" id="6379841">my</span>&nbsp;<span class="op" id="6379844">&lt;</span>&nbsp;<span class="ident" id="6379846">myy</span><span class="op" id="6379849">;</span>&nbsp;<span class="ident" id="6379851">my</span><span class="op" id="6379853">++</span>&nbsp;<span class="op" id="6379856">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379860">for</span>&nbsp;<span class="ident" id="6379864">mx</span>&nbsp;<span class="op" id="6379867">:=</span>&nbsp;<span class="num" id="6379870">0</span><span class="op" id="6379871">;</span>&nbsp;<span class="ident" id="6379873">mx</span>&nbsp;<span class="op" id="6379876">&lt;</span>&nbsp;<span class="ident" id="6379878">mxx</span><span class="op" id="6379881">;</span>&nbsp;<span class="ident" id="6379883">mx</span><span class="op" id="6379885">++</span>&nbsp;<span class="op" id="6379888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379893">for</span>&nbsp;<span class="ident" id="6379897">i</span>&nbsp;<span class="op" id="6379899">:=</span>&nbsp;<span class="num" id="6379902">0</span><span class="op" id="6379903">;</span>&nbsp;<span class="ident" id="6379905">i</span>&nbsp;<span class="op" id="6379907">&lt;</span>&nbsp;<span class="ident" id="6379909">nComp</span><span class="op" id="6379914">;</span>&nbsp;<span class="ident" id="6379916">i</span><span class="op" id="6379917">++</span>&nbsp;<span class="op" id="6379920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379926">compIndex</span>&nbsp;<span class="op" id="6379936">:=</span>&nbsp;<span class="ident" id="6379939">scan</span><span class="op" id="6379943">[</span><span class="ident" id="6379944">i</span><span class="op" id="6379945">]</span><span class="op" id="6379946">.</span><span class="ident" id="6379947">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379961">qt</span>&nbsp;<span class="op" id="6379964">:=</span>&nbsp;<span class="op" id="6379967">&amp;</span><span class="ident" id="6379968">d</span><span class="op" id="6379969">.</span><span class="ident" id="6379970">quant</span><span class="op" id="6379975">[</span><span class="ident" id="6379976">d</span><span class="op" id="6379977">.</span><span class="ident" id="6379978">comp</span><span class="op" id="6379982">[</span><span class="ident" id="6379983">compIndex</span><span class="op" id="6379992">]</span><span class="op" id="6379993">.</span><span class="ident" id="6379994">tq</span><span class="op" id="6379996">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380002">for</span>&nbsp;<span class="ident" id="6380006">j</span>&nbsp;<span class="op" id="6380008">:=</span>&nbsp;<span class="num" id="6380011">0</span><span class="op" id="6380012">;</span>&nbsp;<span class="ident" id="6380014">j</span>&nbsp;<span class="op" id="6380016">&lt;</span>&nbsp;<span class="ident" id="6380018">d</span><span class="op" id="6380019">.</span><span class="ident" id="6380020">comp</span><span class="op" id="6380024">[</span><span class="ident" id="6380025">compIndex</span><span class="op" id="6380034">]</span><span class="op" id="6380035">.</span><span class="ident" id="6380036">h</span><span class="op" id="6380037">*</span><span class="ident" id="6380038">d</span><span class="op" id="6380039">.</span><span class="ident" id="6380040">comp</span><span class="op" id="6380044">[</span><span class="ident" id="6380045">compIndex</span><span class="op" id="6380054">]</span><span class="op" id="6380055">.</span><span class="ident" id="6380056">v</span><span class="op" id="6380057">;</span>&nbsp;<span class="ident" id="6380059">j</span><span class="op" id="6380060">++</span>&nbsp;<span class="op" id="6380063">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380070">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380139">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380208">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380216">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380290">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380306">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380322">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380330">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380407">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380484">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380517">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380533">//&nbsp;&nbsp;&nbsp;&nbsp4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380549">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380626">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380654">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380662">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380740">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380815">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380894">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380970">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381003">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381019">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381035">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381099">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381113">//&nbsp;&nbsp;&nbsp;&nbsp3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381127">if</span>&nbsp;<span class="ident" id="6381130">nComp</span>&nbsp;<span class="op" id="6381136">!=</span>&nbsp;<span class="num" id="6381139">1</span>&nbsp;<span class="op" id="6381141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381149">bx</span><span class="op" id="6381151">,</span>&nbsp;<span class="ident" id="6381153">by</span>&nbsp;<span class="op" id="6381156">=</span>&nbsp;<span class="ident" id="6381158">d</span><span class="op" id="6381159">.</span><span class="ident" id="6381160">comp</span><span class="op" id="6381164">[</span><span class="ident" id="6381165">compIndex</span><span class="op" id="6381174">]</span><span class="op" id="6381175">.</span><span class="ident" id="6381176">h</span><span class="op" id="6381177">*</span><span class="ident" id="6381178">mx</span><span class="op" id="6381180">,</span>&nbsp;<span class="ident" id="6381182">d</span><span class="op" id="6381183">.</span><span class="ident" id="6381184">comp</span><span class="op" id="6381188">[</span><span class="ident" id="6381189">compIndex</span><span class="op" id="6381198">]</span><span class="op" id="6381199">.</span><span class="ident" id="6381200">v</span><span class="op" id="6381201">*</span><span class="ident" id="6381202">my</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381211">if</span>&nbsp;<span class="ident" id="6381214">h0</span>&nbsp;<span class="op" id="6381217">==</span>&nbsp;<span class="num" id="6381220">1</span>&nbsp;<span class="op" id="6381222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381231">by</span>&nbsp;<span class="op" id="6381234">+=</span>&nbsp;<span class="ident" id="6381237">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381245">}</span>&nbsp;<span class="keyword" id="6381247">else</span>&nbsp;<span class="op" id="6381252">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381261">bx</span>&nbsp;<span class="op" id="6381264">+=</span>&nbsp;<span class="ident" id="6381267">j</span>&nbsp;<span class="op" id="6381269">%</span>&nbsp;<span class="num" id="6381271">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381280">by</span>&nbsp;<span class="op" id="6381283">+=</span>&nbsp;<span class="ident" id="6381286">j</span>&nbsp;<span class="op" id="6381288">/</span>&nbsp;<span class="num" id="6381290">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381305">}</span>&nbsp;<span class="keyword" id="6381307">else</span>&nbsp;<span class="op" id="6381312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381320">q</span>&nbsp;<span class="op" id="6381322">:=</span>&nbsp;<span class="ident" id="6381325">mxx</span>&nbsp;<span class="op" id="6381329">*</span>&nbsp;<span class="ident" id="6381331">d</span><span class="op" id="6381332">.</span><span class="ident" id="6381333">comp</span><span class="op" id="6381337">[</span><span class="ident" id="6381338">compIndex</span><span class="op" id="6381347">]</span><span class="op" id="6381348">.</span><span class="ident" id="6381349">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381357">bx</span>&nbsp;<span class="op" id="6381360">=</span>&nbsp;<span class="ident" id="6381362">blockCount</span>&nbsp;<span class="op" id="6381373">%</span>&nbsp;<span class="ident" id="6381375">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381383">by</span>&nbsp;<span class="op" id="6381386">=</span>&nbsp;<span class="ident" id="6381388">blockCount</span>&nbsp;<span class="op" id="6381399">/</span>&nbsp;<span class="ident" id="6381401">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381409">blockCount</span><span class="op" id="6381419">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381428">if</span>&nbsp;<span class="ident" id="6381431">bx</span><span class="op" id="6381433">*</span><span class="num" id="6381434">8</span>&nbsp;<span class="op" id="6381436">&gt;=</span>&nbsp;<span class="ident" id="6381439">d</span><span class="op" id="6381440">.</span><span class="ident" id="6381441">width</span>&nbsp;<span class="op" id="6381447">||</span>&nbsp;<span class="ident" id="6381450">by</span><span class="op" id="6381452">*</span><span class="num" id="6381453">8</span>&nbsp;<span class="op" id="6381455">&gt;=</span>&nbsp;<span class="ident" id="6381458">d</span><span class="op" id="6381459">.</span><span class="ident" id="6381460">height</span>&nbsp;<span class="op" id="6381467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381476">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381506">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381579">if</span>&nbsp;<span class="ident" id="6381582">d</span><span class="op" id="6381583">.</span><span class="ident" id="6381584">progressive</span>&nbsp;<span class="op" id="6381596">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381604">b</span>&nbsp;<span class="op" id="6381606">=</span>&nbsp;<span class="ident" id="6381608">d</span><span class="op" id="6381609">.</span><span class="ident" id="6381610">progCoeffs</span><span class="op" id="6381620">[</span><span class="ident" id="6381621">compIndex</span><span class="op" id="6381630">]</span><span class="op" id="6381631">[</span><span class="ident" id="6381632">by</span><span class="op" id="6381634">*</span><span class="ident" id="6381635">mxx</span><span class="op" id="6381638">*</span><span class="ident" id="6381639">d</span><span class="op" id="6381640">.</span><span class="ident" id="6381641">comp</span><span class="op" id="6381645">[</span><span class="ident" id="6381646">compIndex</span><span class="op" id="6381655">]</span><span class="op" id="6381656">.</span><span class="ident" id="6381657">h</span><span class="op" id="6381658">+</span><span class="ident" id="6381659">bx</span><span class="op" id="6381661">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381668">}</span>&nbsp;<span class="keyword" id="6381670">else</span>&nbsp;<span class="op" id="6381675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381683">b</span>&nbsp;<span class="op" id="6381685">=</span>&nbsp;<span class="ident" id="6381687">block</span><span class="op" id="6381692">{</span><span class="op" id="6381693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381708">if</span>&nbsp;<span class="ident" id="6381711">ah</span>&nbsp;<span class="op" id="6381714">!=</span>&nbsp;<span class="num" id="6381717">0</span>&nbsp;<span class="op" id="6381719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381727">if</span>&nbsp;<span class="ident" id="6381730">err</span>&nbsp;<span class="op" id="6381734">:=</span>&nbsp;<span class="ident" id="6381737">d</span><span class="op" id="6381738">.</span><span class="ident" id="6381739">refine</span><span class="op" id="6381745">(</span><span class="op" id="6381746">&amp;</span><span class="ident" id="6381747">b</span><span class="op" id="6381748">,</span>&nbsp;<span class="op" id="6381750">&amp;</span><span class="ident" id="6381751">d</span><span class="op" id="6381752">.</span><span class="ident" id="6381753">huff</span><span class="op" id="6381757">[</span><span class="ident" id="6381758">acTable</span><span class="op" id="6381765">]</span><span class="op" id="6381766">[</span><span class="ident" id="6381767">scan</span><span class="op" id="6381771">[</span><span class="ident" id="6381772">i</span><span class="op" id="6381773">]</span><span class="op" id="6381774">.</span><span class="ident" id="6381775">ta</span><span class="op" id="6381777">]</span><span class="op" id="6381778">,</span>&nbsp;<span class="ident" id="6381780">zigStart</span><span class="op" id="6381788">,</span>&nbsp;<span class="ident" id="6381790">zigEnd</span><span class="op" id="6381796">,</span>&nbsp;<span class="num" id="6381798">1</span><span class="op" id="6381799">&lt;&lt;</span><span class="ident" id="6381801">al</span><span class="op" id="6381803">)</span><span class="op" id="6381804">;</span>&nbsp;<span class="ident" id="6381806">err</span>&nbsp;<span class="op" id="6381810">!=</span>&nbsp;<span class="ident" id="6381813">nil</span>&nbsp;<span class="op" id="6381817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381826">return</span>&nbsp;<span class="ident" id="6381833">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381850">}</span>&nbsp;<span class="keyword" id="6381852">else</span>&nbsp;<span class="op" id="6381857">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381865">zig</span>&nbsp;<span class="op" id="6381869">:=</span>&nbsp;<span class="ident" id="6381872">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381887">if</span>&nbsp;<span class="ident" id="6381890">zig</span>&nbsp;<span class="op" id="6381894">==</span>&nbsp;<span class="num" id="6381897">0</span>&nbsp;<span class="op" id="6381899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381908">zig</span><span class="op" id="6381911">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381921">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381991">value</span><span class="op" id="6381996">,</span>&nbsp;<span class="ident" id="6381998">err</span>&nbsp;<span class="op" id="6382002">:=</span>&nbsp;<span class="ident" id="6382005">d</span><span class="op" id="6382006">.</span><span class="ident" id="6382007">decodeHuffman</span><span class="op" id="6382020">(</span><span class="op" id="6382021">&amp;</span><span class="ident" id="6382022">d</span><span class="op" id="6382023">.</span><span class="ident" id="6382024">huff</span><span class="op" id="6382028">[</span><span class="ident" id="6382029">dcTable</span><span class="op" id="6382036">]</span><span class="op" id="6382037">[</span><span class="ident" id="6382038">scan</span><span class="op" id="6382042">[</span><span class="ident" id="6382043">i</span><span class="op" id="6382044">]</span><span class="op" id="6382045">.</span><span class="ident" id="6382046">td</span><span class="op" id="6382048">]</span><span class="op" id="6382049">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382058">if</span>&nbsp;<span class="ident" id="6382061">err</span>&nbsp;<span class="op" id="6382065">!=</span>&nbsp;<span class="ident" id="6382068">nil</span>&nbsp;<span class="op" id="6382072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382082">return</span>&nbsp;<span class="ident" id="6382089">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382109">if</span>&nbsp;<span class="ident" id="6382112">value</span>&nbsp;<span class="op" id="6382118">&gt;</span>&nbsp;<span class="num" id="6382120">16</span>&nbsp;<span class="op" id="6382123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382133">return</span>&nbsp;<span class="ident" id="6382140">UnsupportedError</span><span class="op" id="6382156">(</span><span class="string" id="6382157">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="6382181">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382199">dcDelta</span><span class="op" id="6382206">,</span>&nbsp;<span class="ident" id="6382208">err</span>&nbsp;<span class="op" id="6382212">:=</span>&nbsp;<span class="ident" id="6382215">d</span><span class="op" id="6382216">.</span><span class="ident" id="6382217">receiveExtend</span><span class="op" id="6382230">(</span><span class="ident" id="6382231">value</span><span class="op" id="6382236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382245">if</span>&nbsp;<span class="ident" id="6382248">err</span>&nbsp;<span class="op" id="6382252">!=</span>&nbsp;<span class="ident" id="6382255">nil</span>&nbsp;<span class="op" id="6382259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382269">return</span>&nbsp;<span class="ident" id="6382276">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382287">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382296">dc</span><span class="op" id="6382298">[</span><span class="ident" id="6382299">compIndex</span><span class="op" id="6382308">]</span>&nbsp;<span class="op" id="6382310">+=</span>&nbsp;<span class="ident" id="6382313">dcDelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382328">b</span><span class="op" id="6382329">[</span><span class="num" id="6382330">0</span><span class="op" id="6382331">]</span>&nbsp;<span class="op" id="6382333">=</span>&nbsp;<span class="ident" id="6382335">dc</span><span class="op" id="6382337">[</span><span class="ident" id="6382338">compIndex</span><span class="op" id="6382347">]</span>&nbsp;<span class="op" id="6382349">&lt;&lt;</span>&nbsp;<span class="ident" id="6382352">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382370">if</span>&nbsp;<span class="ident" id="6382373">zig</span>&nbsp;<span class="op" id="6382377">&lt;=</span>&nbsp;<span class="ident" id="6382380">zigEnd</span>&nbsp;<span class="op" id="6382387">&amp;&amp;</span>&nbsp;<span class="ident" id="6382390">d</span><span class="op" id="6382391">.</span><span class="ident" id="6382392">eobRun</span>&nbsp;<span class="op" id="6382399">&gt;</span>&nbsp;<span class="num" id="6382401">0</span>&nbsp;<span class="op" id="6382403">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382412">d</span><span class="op" id="6382413">.</span><span class="ident" id="6382414">eobRun</span><span class="op" id="6382420">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382429">}</span>&nbsp;<span class="keyword" id="6382431">else</span>&nbsp;<span class="op" id="6382436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382445">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382516">huff</span>&nbsp;<span class="op" id="6382521">:=</span>&nbsp;<span class="op" id="6382524">&amp;</span><span class="ident" id="6382525">d</span><span class="op" id="6382526">.</span><span class="ident" id="6382527">huff</span><span class="op" id="6382531">[</span><span class="ident" id="6382532">acTable</span><span class="op" id="6382539">]</span><span class="op" id="6382540">[</span><span class="ident" id="6382541">scan</span><span class="op" id="6382545">[</span><span class="ident" id="6382546">i</span><span class="op" id="6382547">]</span><span class="op" id="6382548">.</span><span class="ident" id="6382549">ta</span><span class="op" id="6382551">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382560">for</span>&nbsp;<span class="op" id="6382564">;</span>&nbsp;<span class="ident" id="6382566">zig</span>&nbsp;<span class="op" id="6382570">&lt;=</span>&nbsp;<span class="ident" id="6382573">zigEnd</span><span class="op" id="6382579">;</span>&nbsp;<span class="ident" id="6382581">zig</span><span class="op" id="6382584">++</span>&nbsp;<span class="op" id="6382587">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382597">value</span><span class="op" id="6382602">,</span>&nbsp;<span class="ident" id="6382604">err</span>&nbsp;<span class="op" id="6382608">:=</span>&nbsp;<span class="ident" id="6382611">d</span><span class="op" id="6382612">.</span><span class="ident" id="6382613">decodeHuffman</span><span class="op" id="6382626">(</span><span class="ident" id="6382627">huff</span><span class="op" id="6382631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382641">if</span>&nbsp;<span class="ident" id="6382644">err</span>&nbsp;<span class="op" id="6382648">!=</span>&nbsp;<span class="ident" id="6382651">nil</span>&nbsp;<span class="op" id="6382655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382666">return</span>&nbsp;<span class="ident" id="6382673">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382695">val0</span>&nbsp;<span class="op" id="6382700">:=</span>&nbsp;<span class="ident" id="6382703">value</span>&nbsp;<span class="op" id="6382709">&gt;&gt;</span>&nbsp;<span class="num" id="6382712">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382722">val1</span>&nbsp;<span class="op" id="6382727">:=</span>&nbsp;<span class="ident" id="6382730">value</span>&nbsp;<span class="op" id="6382736">&amp;</span>&nbsp;<span class="num" id="6382738">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382751">if</span>&nbsp;<span class="ident" id="6382754">val1</span>&nbsp;<span class="op" id="6382759">!=</span>&nbsp;<span class="num" id="6382762">0</span>&nbsp;<span class="op" id="6382764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382775">zig</span>&nbsp;<span class="op" id="6382779">+=</span>&nbsp;<span class="builtintype" id="6382782">int32</span><span class="op" id="6382787">(</span><span class="ident" id="6382788">val0</span><span class="op" id="6382792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382803">if</span>&nbsp;<span class="ident" id="6382806">zig</span>&nbsp;<span class="op" id="6382810">&gt;</span>&nbsp;<span class="ident" id="6382812">zigEnd</span>&nbsp;<span class="op" id="6382819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382831">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382857">ac</span><span class="op" id="6382859">,</span>&nbsp;<span class="ident" id="6382861">err</span>&nbsp;<span class="op" id="6382865">:=</span>&nbsp;<span class="ident" id="6382868">d</span><span class="op" id="6382869">.</span><span class="ident" id="6382870">receiveExtend</span><span class="op" id="6382883">(</span><span class="ident" id="6382884">val1</span><span class="op" id="6382888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382899">if</span>&nbsp;<span class="ident" id="6382902">err</span>&nbsp;<span class="op" id="6382906">!=</span>&nbsp;<span class="ident" id="6382909">nil</span>&nbsp;<span class="op" id="6382913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382925">return</span>&nbsp;<span class="ident" id="6382932">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382945">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382956">b</span><span class="op" id="6382957">[</span><span class="ident" id="6382958">unzig</span><span class="op" id="6382963">[</span><span class="ident" id="6382964">zig</span><span class="op" id="6382967">]</span><span class="op" id="6382968">]</span>&nbsp;<span class="op" id="6382970">=</span>&nbsp;<span class="ident" id="6382972">ac</span>&nbsp;<span class="op" id="6382975">&lt;&lt;</span>&nbsp;<span class="ident" id="6382978">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382989">}</span>&nbsp;<span class="keyword" id="6382991">else</span>&nbsp;<span class="op" id="6382996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383007">if</span>&nbsp;<span class="ident" id="6383010">val0</span>&nbsp;<span class="op" id="6383015">!=</span>&nbsp;<span class="num" id="6383018">0x0f</span>&nbsp;<span class="op" id="6383023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383035">d</span><span class="op" id="6383036">.</span><span class="ident" id="6383037">eobRun</span>&nbsp;<span class="op" id="6383044">=</span>&nbsp;<span class="builtintype" id="6383046">uint16</span><span class="op" id="6383052">(</span><span class="num" id="6383053">1</span>&nbsp;<span class="op" id="6383055">&lt;&lt;</span>&nbsp;<span class="ident" id="6383058">val0</span><span class="op" id="6383062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383074">if</span>&nbsp;<span class="ident" id="6383077">val0</span>&nbsp;<span class="op" id="6383082">!=</span>&nbsp;<span class="num" id="6383085">0</span>&nbsp;<span class="op" id="6383087">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383100">bits</span><span class="op" id="6383104">,</span>&nbsp;<span class="ident" id="6383106">err</span>&nbsp;<span class="op" id="6383110">:=</span>&nbsp;<span class="ident" id="6383113">d</span><span class="op" id="6383114">.</span><span class="ident" id="6383115">decodeBits</span><span class="op" id="6383125">(</span><span class="builtintype" id="6383126">int32</span><span class="op" id="6383131">(</span><span class="ident" id="6383132">val0</span><span class="op" id="6383136">)</span><span class="op" id="6383137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383150">if</span>&nbsp;<span class="ident" id="6383153">err</span>&nbsp;<span class="op" id="6383157">!=</span>&nbsp;<span class="ident" id="6383160">nil</span>&nbsp;<span class="op" id="6383164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383178">return</span>&nbsp;<span class="ident" id="6383185">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383213">d</span><span class="op" id="6383214">.</span><span class="ident" id="6383215">eobRun</span>&nbsp;<span class="op" id="6383222">|=</span>&nbsp;<span class="builtintype" id="6383225">uint16</span><span class="op" id="6383231">(</span><span class="ident" id="6383232">bits</span><span class="op" id="6383236">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383260">d</span><span class="op" id="6383261">.</span><span class="ident" id="6383262">eobRun</span><span class="op" id="6383268">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383281">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383307">zig</span>&nbsp;<span class="op" id="6383311">+=</span>&nbsp;<span class="num" id="6383314">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383359">if</span>&nbsp;<span class="ident" id="6383362">d</span><span class="op" id="6383363">.</span><span class="ident" id="6383364">progressive</span>&nbsp;<span class="op" id="6383376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383384">if</span>&nbsp;<span class="ident" id="6383387">zigEnd</span>&nbsp;<span class="op" id="6383394">!=</span>&nbsp;<span class="ident" id="6383397">blockSize</span><span class="op" id="6383406">-</span><span class="num" id="6383407">1</span>&nbsp;<span class="op" id="6383409">||</span>&nbsp;<span class="ident" id="6383412">al</span>&nbsp;<span class="op" id="6383415">!=</span>&nbsp;<span class="num" id="6383418">0</span>&nbsp;<span class="op" id="6383420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383429">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383508">d</span><span class="op" id="6383509">.</span><span class="ident" id="6383510">progCoeffs</span><span class="op" id="6383520">[</span><span class="ident" id="6383521">compIndex</span><span class="op" id="6383530">]</span><span class="op" id="6383531">[</span><span class="ident" id="6383532">by</span><span class="op" id="6383534">*</span><span class="ident" id="6383535">mxx</span><span class="op" id="6383538">*</span><span class="ident" id="6383539">d</span><span class="op" id="6383540">.</span><span class="ident" id="6383541">comp</span><span class="op" id="6383545">[</span><span class="ident" id="6383546">compIndex</span><span class="op" id="6383555">]</span><span class="op" id="6383556">.</span><span class="ident" id="6383557">h</span><span class="op" id="6383558">+</span><span class="ident" id="6383559">bx</span><span class="op" id="6383561">]</span>&nbsp;<span class="op" id="6383563">=</span>&nbsp;<span class="ident" id="6383565">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383574">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383660">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383746">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383831">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383917">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383978">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384008">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384086">for</span>&nbsp;<span class="ident" id="6384090">zig</span>&nbsp;<span class="op" id="6384094">:=</span>&nbsp;<span class="num" id="6384097">0</span><span class="op" id="6384098">;</span>&nbsp;<span class="ident" id="6384100">zig</span>&nbsp;<span class="op" id="6384104">&lt;</span>&nbsp;<span class="ident" id="6384106">blockSize</span><span class="op" id="6384115">;</span>&nbsp;<span class="ident" id="6384117">zig</span><span class="op" id="6384120">++</span>&nbsp;<span class="op" id="6384123">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384131">b</span><span class="op" id="6384132">[</span><span class="ident" id="6384133">unzig</span><span class="op" id="6384138">[</span><span class="ident" id="6384139">zig</span><span class="op" id="6384142">]</span><span class="op" id="6384143">]</span>&nbsp;<span class="op" id="6384145">*=</span>&nbsp;<span class="ident" id="6384148">qt</span><span class="op" id="6384150">[</span><span class="ident" id="6384151">zig</span><span class="op" id="6384154">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384168">idct</span><span class="op" id="6384172">(</span><span class="op" id="6384173">&amp;</span><span class="ident" id="6384174">b</span><span class="op" id="6384175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384182">dst</span><span class="op" id="6384185">,</span>&nbsp;<span class="ident" id="6384187">stride</span>&nbsp;<span class="op" id="6384194">:=</span>&nbsp;<span class="op" id="6384197">[</span><span class="op" id="6384198">]</span><span class="builtintype" id="6384199">byte</span><span class="op" id="6384203">(</span><span class="ident" id="6384204">nil</span><span class="op" id="6384207">)</span><span class="op" id="6384208">,</span>&nbsp;<span class="num" id="6384210">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384217">if</span>&nbsp;<span class="ident" id="6384220">d</span><span class="op" id="6384221">.</span><span class="ident" id="6384222">nComp</span>&nbsp;<span class="op" id="6384228">==</span>&nbsp;<span class="ident" id="6384231">nGrayComponent</span>&nbsp;<span class="op" id="6384246">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384254">dst</span><span class="op" id="6384257">,</span>&nbsp;<span class="ident" id="6384259">stride</span>&nbsp;<span class="op" id="6384266">=</span>&nbsp;<span class="ident" id="6384268">d</span><span class="op" id="6384269">.</span><span class="ident" id="6384270">img1</span><span class="op" id="6384274">.</span><span class="ident" id="6384275">Pix</span><span class="op" id="6384278">[</span><span class="num" id="6384279">8</span><span class="op" id="6384280">*</span><span class="op" id="6384281">(</span><span class="ident" id="6384282">by</span><span class="op" id="6384284">*</span><span class="ident" id="6384285">d</span><span class="op" id="6384286">.</span><span class="ident" id="6384287">img1</span><span class="op" id="6384291">.</span><span class="ident" id="6384292">Stride</span><span class="op" id="6384298">+</span><span class="ident" id="6384299">bx</span><span class="op" id="6384301">)</span><span class="op" id="6384302">:</span><span class="op" id="6384303">]</span><span class="op" id="6384304">,</span>&nbsp;<span class="ident" id="6384306">d</span><span class="op" id="6384307">.</span><span class="ident" id="6384308">img1</span><span class="op" id="6384312">.</span><span class="ident" id="6384313">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384325">}</span>&nbsp;<span class="keyword" id="6384327">else</span>&nbsp;<span class="op" id="6384332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384340">switch</span>&nbsp;<span class="ident" id="6384347">compIndex</span>&nbsp;<span class="op" id="6384357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384365">case</span>&nbsp;<span class="num" id="6384370">0</span><span class="op" id="6384371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384380">dst</span><span class="op" id="6384383">,</span>&nbsp;<span class="ident" id="6384385">stride</span>&nbsp;<span class="op" id="6384392">=</span>&nbsp;<span class="ident" id="6384394">d</span><span class="op" id="6384395">.</span><span class="ident" id="6384396">img3</span><span class="op" id="6384400">.</span><span class="ident" id="6384401">Y</span><span class="op" id="6384402">[</span><span class="num" id="6384403">8</span><span class="op" id="6384404">*</span><span class="op" id="6384405">(</span><span class="ident" id="6384406">by</span><span class="op" id="6384408">*</span><span class="ident" id="6384409">d</span><span class="op" id="6384410">.</span><span class="ident" id="6384411">img3</span><span class="op" id="6384415">.</span><span class="ident" id="6384416">YStride</span><span class="op" id="6384423">+</span><span class="ident" id="6384424">bx</span><span class="op" id="6384426">)</span><span class="op" id="6384427">:</span><span class="op" id="6384428">]</span><span class="op" id="6384429">,</span>&nbsp;<span class="ident" id="6384431">d</span><span class="op" id="6384432">.</span><span class="ident" id="6384433">img3</span><span class="op" id="6384437">.</span><span class="ident" id="6384438">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384452">case</span>&nbsp;<span class="num" id="6384457">1</span><span class="op" id="6384458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384467">dst</span><span class="op" id="6384470">,</span>&nbsp;<span class="ident" id="6384472">stride</span>&nbsp;<span class="op" id="6384479">=</span>&nbsp;<span class="ident" id="6384481">d</span><span class="op" id="6384482">.</span><span class="ident" id="6384483">img3</span><span class="op" id="6384487">.</span><span class="ident" id="6384488">Cb</span><span class="op" id="6384490">[</span><span class="num" id="6384491">8</span><span class="op" id="6384492">*</span><span class="op" id="6384493">(</span><span class="ident" id="6384494">by</span><span class="op" id="6384496">*</span><span class="ident" id="6384497">d</span><span class="op" id="6384498">.</span><span class="ident" id="6384499">img3</span><span class="op" id="6384503">.</span><span class="ident" id="6384504">CStride</span><span class="op" id="6384511">+</span><span class="ident" id="6384512">bx</span><span class="op" id="6384514">)</span><span class="op" id="6384515">:</span><span class="op" id="6384516">]</span><span class="op" id="6384517">,</span>&nbsp;<span class="ident" id="6384519">d</span><span class="op" id="6384520">.</span><span class="ident" id="6384521">img3</span><span class="op" id="6384525">.</span><span class="ident" id="6384526">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384540">case</span>&nbsp;<span class="num" id="6384545">2</span><span class="op" id="6384546">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384555">dst</span><span class="op" id="6384558">,</span>&nbsp;<span class="ident" id="6384560">stride</span>&nbsp;<span class="op" id="6384567">=</span>&nbsp;<span class="ident" id="6384569">d</span><span class="op" id="6384570">.</span><span class="ident" id="6384571">img3</span><span class="op" id="6384575">.</span><span class="ident" id="6384576">Cr</span><span class="op" id="6384578">[</span><span class="num" id="6384579">8</span><span class="op" id="6384580">*</span><span class="op" id="6384581">(</span><span class="ident" id="6384582">by</span><span class="op" id="6384584">*</span><span class="ident" id="6384585">d</span><span class="op" id="6384586">.</span><span class="ident" id="6384587">img3</span><span class="op" id="6384591">.</span><span class="ident" id="6384592">CStride</span><span class="op" id="6384599">+</span><span class="ident" id="6384600">bx</span><span class="op" id="6384602">)</span><span class="op" id="6384603">:</span><span class="op" id="6384604">]</span><span class="op" id="6384605">,</span>&nbsp;<span class="ident" id="6384607">d</span><span class="op" id="6384608">.</span><span class="ident" id="6384609">img3</span><span class="op" id="6384613">.</span><span class="ident" id="6384614">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384628">default</span><span class="op" id="6384635">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384644">return</span>&nbsp;<span class="ident" id="6384651">UnsupportedError</span><span class="op" id="6384667">(</span><span class="string" id="6384668">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="6384689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384711">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384776">for</span>&nbsp;<span class="ident" id="6384780">y</span>&nbsp;<span class="op" id="6384782">:=</span>&nbsp;<span class="num" id="6384785">0</span><span class="op" id="6384786">;</span>&nbsp;<span class="ident" id="6384788">y</span>&nbsp;<span class="op" id="6384790">&lt;</span>&nbsp;<span class="num" id="6384792">8</span><span class="op" id="6384793">;</span>&nbsp;<span class="ident" id="6384795">y</span><span class="op" id="6384796">++</span>&nbsp;<span class="op" id="6384799">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384807">y8</span>&nbsp;<span class="op" id="6384810">:=</span>&nbsp;<span class="ident" id="6384813">y</span>&nbsp;<span class="op" id="6384815">*</span>&nbsp;<span class="num" id="6384817">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384825">yStride</span>&nbsp;<span class="op" id="6384833">:=</span>&nbsp;<span class="ident" id="6384836">y</span>&nbsp;<span class="op" id="6384838">*</span>&nbsp;<span class="ident" id="6384840">stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384853">for</span>&nbsp;<span class="ident" id="6384857">x</span>&nbsp;<span class="op" id="6384859">:=</span>&nbsp;<span class="num" id="6384862">0</span><span class="op" id="6384863">;</span>&nbsp;<span class="ident" id="6384865">x</span>&nbsp;<span class="op" id="6384867">&lt;</span>&nbsp;<span class="num" id="6384869">8</span><span class="op" id="6384870">;</span>&nbsp;<span class="ident" id="6384872">x</span><span class="op" id="6384873">++</span>&nbsp;<span class="op" id="6384876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384885">c</span>&nbsp;<span class="op" id="6384887">:=</span>&nbsp;<span class="ident" id="6384890">b</span><span class="op" id="6384891">[</span><span class="ident" id="6384892">y8</span><span class="op" id="6384894">+</span><span class="ident" id="6384895">x</span><span class="op" id="6384896">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384905">if</span>&nbsp;<span class="ident" id="6384908">c</span>&nbsp;<span class="op" id="6384910">&lt;</span>&nbsp;<span class="op" id="6384912">-</span><span class="num" id="6384913">128</span>&nbsp;<span class="op" id="6384917">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384927">c</span>&nbsp;<span class="op" id="6384929">=</span>&nbsp;<span class="num" id="6384931">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384940">}</span>&nbsp;<span class="keyword" id="6384942">else</span>&nbsp;<span class="keyword" id="6384947">if</span>&nbsp;<span class="ident" id="6384950">c</span>&nbsp;<span class="op" id="6384952">&gt;</span>&nbsp;<span class="num" id="6384954">127</span>&nbsp;<span class="op" id="6384958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384968">c</span>&nbsp;<span class="op" id="6384970">=</span>&nbsp;<span class="num" id="6384972">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384983">}</span>&nbsp;<span class="keyword" id="6384985">else</span>&nbsp;<span class="op" id="6384990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385000">c</span>&nbsp;<span class="op" id="6385002">+=</span>&nbsp;<span class="num" id="6385005">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385025">dst</span><span class="op" id="6385028">[</span><span class="ident" id="6385029">yStride</span><span class="op" id="6385036">+</span><span class="ident" id="6385037">x</span><span class="op" id="6385038">]</span>&nbsp;<span class="op" id="6385040">=</span>&nbsp;<span class="builtintype" id="6385042">uint8</span><span class="op" id="6385047">(</span><span class="ident" id="6385048">c</span><span class="op" id="6385049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385070">}</span>&nbsp;<span class="comment" id="6385072">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385084">}</span>&nbsp;<span class="comment" id="6385086">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385098">mcu</span><span class="op" id="6385101">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385107">if</span>&nbsp;<span class="ident" id="6385110">d</span><span class="op" id="6385111">.</span><span class="ident" id="6385112">ri</span>&nbsp;<span class="op" id="6385115">&gt;</span>&nbsp;<span class="num" id="6385117">0</span>&nbsp;<span class="op" id="6385119">&amp;&amp;</span>&nbsp;<span class="ident" id="6385122">mcu</span><span class="op" id="6385125">%</span><span class="ident" id="6385126">d</span><span class="op" id="6385127">.</span><span class="ident" id="6385128">ri</span>&nbsp;<span class="op" id="6385131">==</span>&nbsp;<span class="num" id="6385134">0</span>&nbsp;<span class="op" id="6385136">&amp;&amp;</span>&nbsp;<span class="ident" id="6385139">mcu</span>&nbsp;<span class="op" id="6385143">&lt;</span>&nbsp;<span class="ident" id="6385145">mxx</span><span class="op" id="6385148">*</span><span class="ident" id="6385149">myy</span>&nbsp;<span class="op" id="6385153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385159">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385259">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385356">if</span>&nbsp;<span class="ident" id="6385359">err</span>&nbsp;<span class="op" id="6385363">:=</span>&nbsp;<span class="ident" id="6385366">d</span><span class="op" id="6385367">.</span><span class="ident" id="6385368">readFull</span><span class="op" id="6385376">(</span><span class="ident" id="6385377">d</span><span class="op" id="6385378">.</span><span class="ident" id="6385379">tmp</span><span class="op" id="6385382">[</span><span class="op" id="6385383">:</span><span class="num" id="6385384">2</span><span class="op" id="6385385">]</span><span class="op" id="6385386">)</span><span class="op" id="6385387">;</span>&nbsp;<span class="ident" id="6385389">err</span>&nbsp;<span class="op" id="6385393">!=</span>&nbsp;<span class="ident" id="6385396">nil</span>&nbsp;<span class="op" id="6385400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385407">return</span>&nbsp;<span class="ident" id="6385414">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385428">if</span>&nbsp;<span class="ident" id="6385431">d</span><span class="op" id="6385432">.</span><span class="ident" id="6385433">tmp</span><span class="op" id="6385436">[</span><span class="num" id="6385437">0</span><span class="op" id="6385438">]</span>&nbsp;<span class="op" id="6385440">!=</span>&nbsp;<span class="num" id="6385443">0xff</span>&nbsp;<span class="op" id="6385448">||</span>&nbsp;<span class="ident" id="6385451">d</span><span class="op" id="6385452">.</span><span class="ident" id="6385453">tmp</span><span class="op" id="6385456">[</span><span class="num" id="6385457">1</span><span class="op" id="6385458">]</span>&nbsp;<span class="op" id="6385460">!=</span>&nbsp;<span class="ident" id="6385463">expectedRST</span>&nbsp;<span class="op" id="6385475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385482">return</span>&nbsp;<span class="ident" id="6385489">FormatError</span><span class="op" id="6385500">(</span><span class="string" id="6385501">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="6385517">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385529">expectedRST</span><span class="op" id="6385540">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385547">if</span>&nbsp;<span class="ident" id="6385550">expectedRST</span>&nbsp;<span class="op" id="6385562">==</span>&nbsp;<span class="ident" id="6385565">rst7Marker</span><span class="op" id="6385575">+</span><span class="num" id="6385576">1</span>&nbsp;<span class="op" id="6385578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385585">expectedRST</span>&nbsp;<span class="op" id="6385597">=</span>&nbsp;<span class="ident" id="6385599">rst0Marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385614">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385620">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385654">d</span><span class="op" id="6385655">.</span><span class="ident" id="6385656">bits</span>&nbsp;<span class="op" id="6385661">=</span>&nbsp;<span class="ident" id="6385663">bits</span><span class="op" id="6385667">{</span><span class="op" id="6385668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385674">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385732">dc</span>&nbsp;<span class="op" id="6385735">=</span>&nbsp;<span class="op" id="6385737">[</span><span class="ident" id="6385738">nColorComponent</span><span class="op" id="6385753">]</span><span class="builtintype" id="6385754">int32</span><span class="op" id="6385759">{</span><span class="op" id="6385760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385766">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385834">d</span><span class="op" id="6385835">.</span><span class="ident" id="6385836">eobRun</span>&nbsp;<span class="op" id="6385843">=</span>&nbsp;<span class="num" id="6385845">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385854">}</span>&nbsp;<span class="comment" id="6385856">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385867">}</span>&nbsp;<span class="comment" id="6385869">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385881">return</span>&nbsp;<span class="ident" id="6385888">nil</span><br>
<span class="lineno"></span><span class="op" id="6385892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6385895">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6385974">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="6385992">func</span>&nbsp;<span class="op" id="6385997">(</span><span class="ident" id="6385998">d</span>&nbsp;<span class="op" id="6386000">*</span><span class="ident" id="6386001">decoder</span><span class="op" id="6386008">)</span>&nbsp;<span class="ident" id="6386010">refine</span><span class="op" id="6386016">(</span><span class="ident" id="6386017">b</span>&nbsp;<span class="op" id="6386019">*</span><span class="ident" id="6386020">block</span><span class="op" id="6386025">,</span>&nbsp;<span class="ident" id="6386027">h</span>&nbsp;<span class="op" id="6386029">*</span><span class="ident" id="6386030">huffman</span><span class="op" id="6386037">,</span>&nbsp;<span class="ident" id="6386039">zigStart</span><span class="op" id="6386047">,</span>&nbsp;<span class="ident" id="6386049">zigEnd</span><span class="op" id="6386055">,</span>&nbsp;<span class="ident" id="6386057">delta</span>&nbsp;<span class="builtintype" id="6386063">int32</span><span class="op" id="6386068">)</span>&nbsp;<span class="builtintype" id="6386070">error</span>&nbsp;<span class="op" id="6386076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386079">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386119">if</span>&nbsp;<span class="ident" id="6386122">zigStart</span>&nbsp;<span class="op" id="6386131">==</span>&nbsp;<span class="num" id="6386134">0</span>&nbsp;<span class="op" id="6386136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386140">if</span>&nbsp;<span class="ident" id="6386143">zigEnd</span>&nbsp;<span class="op" id="6386150">!=</span>&nbsp;<span class="num" id="6386153">0</span>&nbsp;<span class="op" id="6386155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6386160">panic</span><span class="op" id="6386165">(</span><span class="string" id="6386166">&#34;unreachable&#34;</span><span class="op" id="6386179">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386187">bit</span><span class="op" id="6386190">,</span>&nbsp;<span class="ident" id="6386192">err</span>&nbsp;<span class="op" id="6386196">:=</span>&nbsp;<span class="ident" id="6386199">d</span><span class="op" id="6386200">.</span><span class="ident" id="6386201">decodeBit</span><span class="op" id="6386210">(</span><span class="op" id="6386211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386215">if</span>&nbsp;<span class="ident" id="6386218">err</span>&nbsp;<span class="op" id="6386222">!=</span>&nbsp;<span class="ident" id="6386225">nil</span>&nbsp;<span class="op" id="6386229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386234">return</span>&nbsp;<span class="ident" id="6386241">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386247">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386251">if</span>&nbsp;<span class="ident" id="6386254">bit</span>&nbsp;<span class="op" id="6386258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386263">b</span><span class="op" id="6386264">[</span><span class="num" id="6386265">0</span><span class="op" id="6386266">]</span>&nbsp;<span class="op" id="6386268">|=</span>&nbsp;<span class="ident" id="6386271">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386283">return</span>&nbsp;<span class="ident" id="6386290">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386295">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386299">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386381">zig</span>&nbsp;<span class="op" id="6386385">:=</span>&nbsp;<span class="ident" id="6386388">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386398">if</span>&nbsp;<span class="ident" id="6386401">d</span><span class="op" id="6386402">.</span><span class="ident" id="6386403">eobRun</span>&nbsp;<span class="op" id="6386410">==</span>&nbsp;<span class="num" id="6386413">0</span>&nbsp;<span class="op" id="6386415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386418">loop</span><span class="op" id="6386422">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386426">for</span>&nbsp;<span class="op" id="6386430">;</span>&nbsp;<span class="ident" id="6386432">zig</span>&nbsp;<span class="op" id="6386436">&lt;=</span>&nbsp;<span class="ident" id="6386439">zigEnd</span><span class="op" id="6386445">;</span>&nbsp;<span class="ident" id="6386447">zig</span><span class="op" id="6386450">++</span>&nbsp;<span class="op" id="6386453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386458">z</span>&nbsp;<span class="op" id="6386460">:=</span>&nbsp;<span class="builtintype" id="6386463">int32</span><span class="op" id="6386468">(</span><span class="num" id="6386469">0</span><span class="op" id="6386470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386475">value</span><span class="op" id="6386480">,</span>&nbsp;<span class="ident" id="6386482">err</span>&nbsp;<span class="op" id="6386486">:=</span>&nbsp;<span class="ident" id="6386489">d</span><span class="op" id="6386490">.</span><span class="ident" id="6386491">decodeHuffman</span><span class="op" id="6386504">(</span><span class="ident" id="6386505">h</span><span class="op" id="6386506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386511">if</span>&nbsp;<span class="ident" id="6386514">err</span>&nbsp;<span class="op" id="6386518">!=</span>&nbsp;<span class="ident" id="6386521">nil</span>&nbsp;<span class="op" id="6386525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386531">return</span>&nbsp;<span class="ident" id="6386538">err</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386550">val0</span>&nbsp;<span class="op" id="6386555">:=</span>&nbsp;<span class="ident" id="6386558">value</span>&nbsp;<span class="op" id="6386564">&gt;&gt;</span>&nbsp;<span class="num" id="6386567">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386572">val1</span>&nbsp;<span class="op" id="6386577">:=</span>&nbsp;<span class="ident" id="6386580">value</span>&nbsp;<span class="op" id="6386586">&amp;</span>&nbsp;<span class="num" id="6386588">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386597">switch</span>&nbsp;<span class="ident" id="6386604">val1</span>&nbsp;<span class="op" id="6386609">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386614">case</span>&nbsp;<span class="num" id="6386619">0</span><span class="op" id="6386620">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386626">if</span>&nbsp;<span class="ident" id="6386629">val0</span>&nbsp;<span class="op" id="6386634">!=</span>&nbsp;<span class="num" id="6386637">0x0f</span>&nbsp;<span class="op" id="6386642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386649">d</span><span class="op" id="6386650">.</span><span class="ident" id="6386651">eobRun</span>&nbsp;<span class="op" id="6386658">=</span>&nbsp;<span class="builtintype" id="6386660">uint16</span><span class="op" id="6386666">(</span><span class="num" id="6386667">1</span>&nbsp;<span class="op" id="6386669">&lt;&lt;</span>&nbsp;<span class="ident" id="6386672">val0</span><span class="op" id="6386676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386683">if</span>&nbsp;<span class="ident" id="6386686">val0</span>&nbsp;<span class="op" id="6386691">!=</span>&nbsp;<span class="num" id="6386694">0</span>&nbsp;<span class="op" id="6386696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386704">bits</span><span class="op" id="6386708">,</span>&nbsp;<span class="ident" id="6386710">err</span>&nbsp;<span class="op" id="6386714">:=</span>&nbsp;<span class="ident" id="6386717">d</span><span class="op" id="6386718">.</span><span class="ident" id="6386719">decodeBits</span><span class="op" id="6386729">(</span><span class="builtintype" id="6386730">int32</span><span class="op" id="6386735">(</span><span class="ident" id="6386736">val0</span><span class="op" id="6386740">)</span><span class="op" id="6386741">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386749">if</span>&nbsp;<span class="ident" id="6386752">err</span>&nbsp;<span class="op" id="6386756">!=</span>&nbsp;<span class="ident" id="6386759">nil</span>&nbsp;<span class="op" id="6386763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386772">return</span>&nbsp;<span class="ident" id="6386779">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386797">d</span><span class="op" id="6386798">.</span><span class="ident" id="6386799">eobRun</span>&nbsp;<span class="op" id="6386806">|=</span>&nbsp;<span class="builtintype" id="6386809">uint16</span><span class="op" id="6386815">(</span><span class="ident" id="6386816">bits</span><span class="op" id="6386820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386827">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386834">break</span>&nbsp;<span class="ident" id="6386840">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386854">case</span>&nbsp;<span class="num" id="6386859">1</span><span class="op" id="6386860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386866">z</span>&nbsp;<span class="op" id="6386868">=</span>&nbsp;<span class="ident" id="6386870">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386880">bit</span><span class="op" id="6386883">,</span>&nbsp;<span class="ident" id="6386885">err</span>&nbsp;<span class="op" id="6386889">:=</span>&nbsp;<span class="ident" id="6386892">d</span><span class="op" id="6386893">.</span><span class="ident" id="6386894">decodeBit</span><span class="op" id="6386903">(</span><span class="op" id="6386904">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386910">if</span>&nbsp;<span class="ident" id="6386913">err</span>&nbsp;<span class="op" id="6386917">!=</span>&nbsp;<span class="ident" id="6386920">nil</span>&nbsp;<span class="op" id="6386924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386931">return</span>&nbsp;<span class="ident" id="6386938">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386952">if</span>&nbsp;<span class="op" id="6386955">!</span><span class="ident" id="6386956">bit</span>&nbsp;<span class="op" id="6386960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386967">z</span>&nbsp;<span class="op" id="6386969">=</span>&nbsp;<span class="op" id="6386971">-</span><span class="ident" id="6386972">z</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386983">default</span><span class="op" id="6386990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386996">return</span>&nbsp;<span class="ident" id="6387003">FormatError</span><span class="op" id="6387014">(</span><span class="string" id="6387015">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="6387040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387051">zig</span><span class="op" id="6387054">,</span>&nbsp;<span class="ident" id="6387056">err</span>&nbsp;<span class="op" id="6387060">=</span>&nbsp;<span class="ident" id="6387062">d</span><span class="op" id="6387063">.</span><span class="ident" id="6387064">refineNonZeroes</span><span class="op" id="6387079">(</span><span class="ident" id="6387080">b</span><span class="op" id="6387081">,</span>&nbsp;<span class="ident" id="6387083">zig</span><span class="op" id="6387086">,</span>&nbsp;<span class="ident" id="6387088">zigEnd</span><span class="op" id="6387094">,</span>&nbsp;<span class="builtintype" id="6387096">int32</span><span class="op" id="6387101">(</span><span class="ident" id="6387102">val0</span><span class="op" id="6387106">)</span><span class="op" id="6387107">,</span>&nbsp;<span class="ident" id="6387109">delta</span><span class="op" id="6387114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387119">if</span>&nbsp;<span class="ident" id="6387122">err</span>&nbsp;<span class="op" id="6387126">!=</span>&nbsp;<span class="ident" id="6387129">nil</span>&nbsp;<span class="op" id="6387133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387139">return</span>&nbsp;<span class="ident" id="6387146">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387158">if</span>&nbsp;<span class="ident" id="6387161">zig</span>&nbsp;<span class="op" id="6387165">&gt;</span>&nbsp;<span class="ident" id="6387167">zigEnd</span>&nbsp;<span class="op" id="6387174">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387180">return</span>&nbsp;<span class="ident" id="6387187">FormatError</span><span class="op" id="6387198">(</span><span class="string" id="6387199">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="6387222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387232">if</span>&nbsp;<span class="ident" id="6387235">z</span>&nbsp;<span class="op" id="6387237">!=</span>&nbsp;<span class="num" id="6387240">0</span>&nbsp;<span class="op" id="6387242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387248">b</span><span class="op" id="6387249">[</span><span class="ident" id="6387250">unzig</span><span class="op" id="6387255">[</span><span class="ident" id="6387256">zig</span><span class="op" id="6387259">]</span><span class="op" id="6387260">]</span>&nbsp;<span class="op" id="6387262">=</span>&nbsp;<span class="ident" id="6387264">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387269">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387279">if</span>&nbsp;<span class="ident" id="6387282">d</span><span class="op" id="6387283">.</span><span class="ident" id="6387284">eobRun</span>&nbsp;<span class="op" id="6387291">&gt;</span>&nbsp;<span class="num" id="6387293">0</span>&nbsp;<span class="op" id="6387295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387299">d</span><span class="op" id="6387300">.</span><span class="ident" id="6387301">eobRun</span><span class="op" id="6387307">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387312">if</span>&nbsp;<span class="ident" id="6387315">_</span><span class="op" id="6387316">,</span>&nbsp;<span class="ident" id="6387318">err</span>&nbsp;<span class="op" id="6387322">:=</span>&nbsp;<span class="ident" id="6387325">d</span><span class="op" id="6387326">.</span><span class="ident" id="6387327">refineNonZeroes</span><span class="op" id="6387342">(</span><span class="ident" id="6387343">b</span><span class="op" id="6387344">,</span>&nbsp;<span class="ident" id="6387346">zig</span><span class="op" id="6387349">,</span>&nbsp;<span class="ident" id="6387351">zigEnd</span><span class="op" id="6387357">,</span>&nbsp;<span class="op" id="6387359">-</span><span class="num" id="6387360">1</span><span class="op" id="6387361">,</span>&nbsp;<span class="ident" id="6387363">delta</span><span class="op" id="6387368">)</span><span class="op" id="6387369">;</span>&nbsp;<span class="ident" id="6387371">err</span>&nbsp;<span class="op" id="6387375">!=</span>&nbsp;<span class="ident" id="6387378">nil</span>&nbsp;<span class="op" id="6387382">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387387">return</span>&nbsp;<span class="ident" id="6387394">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387406">return</span>&nbsp;<span class="ident" id="6387413">nil</span><br>
<span class="lineno"></span><span class="op" id="6387417">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="6387420">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="6387499">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="6387546">func</span>&nbsp;<span class="op" id="6387551">(</span><span class="ident" id="6387552">d</span>&nbsp;<span class="op" id="6387554">*</span><span class="ident" id="6387555">decoder</span><span class="op" id="6387562">)</span>&nbsp;<span class="ident" id="6387564">refineNonZeroes</span><span class="op" id="6387579">(</span><span class="ident" id="6387580">b</span>&nbsp;<span class="op" id="6387582">*</span><span class="ident" id="6387583">block</span><span class="op" id="6387588">,</span>&nbsp;<span class="ident" id="6387590">zig</span><span class="op" id="6387593">,</span>&nbsp;<span class="ident" id="6387595">zigEnd</span><span class="op" id="6387601">,</span>&nbsp;<span class="ident" id="6387603">nz</span><span class="op" id="6387605">,</span>&nbsp;<span class="ident" id="6387607">delta</span>&nbsp;<span class="builtintype" id="6387613">int32</span><span class="op" id="6387618">)</span>&nbsp;<span class="op" id="6387620">(</span><span class="builtintype" id="6387621">int32</span><span class="op" id="6387626">,</span>&nbsp;<span class="builtintype" id="6387628">error</span><span class="op" id="6387633">)</span>&nbsp;<span class="op" id="6387635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387638">for</span>&nbsp;<span class="op" id="6387642">;</span>&nbsp;<span class="ident" id="6387644">zig</span>&nbsp;<span class="op" id="6387648">&lt;=</span>&nbsp;<span class="ident" id="6387651">zigEnd</span><span class="op" id="6387657">;</span>&nbsp;<span class="ident" id="6387659">zig</span><span class="op" id="6387662">++</span>&nbsp;<span class="op" id="6387665">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387669">u</span>&nbsp;<span class="op" id="6387671">:=</span>&nbsp;<span class="ident" id="6387674">unzig</span><span class="op" id="6387679">[</span><span class="ident" id="6387680">zig</span><span class="op" id="6387683">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387687">if</span>&nbsp;<span class="ident" id="6387690">b</span><span class="op" id="6387691">[</span><span class="ident" id="6387692">u</span><span class="op" id="6387693">]</span>&nbsp;<span class="op" id="6387695">==</span>&nbsp;<span class="num" id="6387698">0</span>&nbsp;<span class="op" id="6387700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387705">if</span>&nbsp;<span class="ident" id="6387708">nz</span>&nbsp;<span class="op" id="6387711">==</span>&nbsp;<span class="num" id="6387714">0</span>&nbsp;<span class="op" id="6387716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387722">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387731">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387736">nz</span><span class="op" id="6387738">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387744">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387759">bit</span><span class="op" id="6387762">,</span>&nbsp;<span class="ident" id="6387764">err</span>&nbsp;<span class="op" id="6387768">:=</span>&nbsp;<span class="ident" id="6387771">d</span><span class="op" id="6387772">.</span><span class="ident" id="6387773">decodeBit</span><span class="op" id="6387782">(</span><span class="op" id="6387783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387787">if</span>&nbsp;<span class="ident" id="6387790">err</span>&nbsp;<span class="op" id="6387794">!=</span>&nbsp;<span class="ident" id="6387797">nil</span>&nbsp;<span class="op" id="6387801">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387806">return</span>&nbsp;<span class="num" id="6387813">0</span><span class="op" id="6387814">,</span>&nbsp;<span class="ident" id="6387816">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387826">if</span>&nbsp;<span class="op" id="6387829">!</span><span class="ident" id="6387830">bit</span>&nbsp;<span class="op" id="6387834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387839">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387850">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387854">if</span>&nbsp;<span class="ident" id="6387857">b</span><span class="op" id="6387858">[</span><span class="ident" id="6387859">u</span><span class="op" id="6387860">]</span>&nbsp;<span class="op" id="6387862">&gt;=</span>&nbsp;<span class="num" id="6387865">0</span>&nbsp;<span class="op" id="6387867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387872">b</span><span class="op" id="6387873">[</span><span class="ident" id="6387874">u</span><span class="op" id="6387875">]</span>&nbsp;<span class="op" id="6387877">+=</span>&nbsp;<span class="ident" id="6387880">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387888">}</span>&nbsp;<span class="keyword" id="6387890">else</span>&nbsp;<span class="op" id="6387895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387900">b</span><span class="op" id="6387901">[</span><span class="ident" id="6387902">u</span><span class="op" id="6387903">]</span>&nbsp;<span class="op" id="6387905">-=</span>&nbsp;<span class="ident" id="6387908">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387916">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387922">return</span>&nbsp;<span class="ident" id="6387929">zig</span><span class="op" id="6387932">,</span>&nbsp;<span class="ident" id="6387934">nil</span><br>
<span class="lineno"></span><span class="op" id="6387938">}</span>
</div>
</body>
</html>
