<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html" class="current">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7491978">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7492033">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7492087">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7492138">package</span>&nbsp;<span class="ident" id="7492146">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7492155">import</span>&nbsp;<span class="op" id="7492162">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492165">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492174">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492180">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492193">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492204">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7492214">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7492217">type</span>&nbsp;<span class="ident" id="7492222">testpair</span>&nbsp;<span class="keyword" id="7492231">struct</span>&nbsp;<span class="op" id="7492238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7492241">decoded</span><span class="op" id="7492248">,</span>&nbsp;<span class="ident" id="7492250">encoded</span>&nbsp;<span class="builtintype" id="7492258">string</span><br>
<span class="lineno"></span><span class="op" id="7492265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7492268">var</span>&nbsp;<span class="ident" id="7492272">pairs</span>&nbsp;<span class="op" id="7492278">=</span>&nbsp;<span class="op" id="7492280">[</span><span class="op" id="7492281">]</span><span class="ident" id="7492282">testpair</span><span class="op" id="7492290">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7492293">//&nbsp;Encode&nbsp;returns&nbsp;0&nbsp;when&nbsp;len(src)&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7492333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492337">&#34;&#34;</span><span class="op" id="7492339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492343">&#34;&#34;</span><span class="op" id="7492345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7492348">}</span><span class="op" id="7492349">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7492352">//&nbsp;Wikipedia&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7492374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492378">&#34;Man&nbsp;is&nbsp;distinguished,&nbsp;not&nbsp;only&nbsp;by&nbsp;his&nbsp;reason,&nbsp;but&nbsp;by&nbsp;this&nbsp;singular&nbsp;passion&nbsp;from&nbsp;&#34;</span>&nbsp;<span class="op" id="7492461">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492466">&#34;other&nbsp;animals,&nbsp;which&nbsp;is&nbsp;a&nbsp;lust&nbsp;of&nbsp;the&nbsp;mind,&nbsp;that&nbsp;by&nbsp;a&nbsp;perseverance&nbsp;of&nbsp;delight&nbsp;in&nbsp;&#34;</span>&nbsp;<span class="op" id="7492550">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492555">&#34;the&nbsp;continued&nbsp;and&nbsp;indefatigable&nbsp;generation&nbsp;of&nbsp;knowledge,&nbsp;exceeds&nbsp;the&nbsp;short&nbsp;&#34;</span>&nbsp;<span class="op" id="7492633">+</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492638">&#34;vehemence&nbsp;of&nbsp;any&nbsp;carnal&nbsp;pleasure.&#34;</span><span class="op" id="7492673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492677">&#34;9jqo^BlbD-BleB1DJ+*+F(f,q/0JhKF&lt;GL&gt;Cj@.4Gp$d7F!,L7@&lt;6@)/0JDEF&lt;G%&lt;+EV:2F!,\n&#34;</span>&nbsp;<span class="op" id="7492755">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492760">&#34;O&lt;DJ+*.@&lt;*K0@&lt;6L(Df-\\0Ec5e;DffZ(EZee.Bl.9pF\&#34;AGXBPCsi+DGm&gt;@3BB/F*&amp;OCAfu2/AKY\n&#34;</span>&nbsp;<span class="op" id="7492842">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492847">&#34;i(DIb:@FD,*)+C]U=@3BN#EcYf8ATD3s@q?d$AftVqCh[NqF&lt;G:8+EV:.+Cf&gt;-FD5W8ARlolDIa\n&#34;</span>&nbsp;<span class="op" id="7492927">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7492932">&#34;l(DId&lt;j@&lt;?3r@:F%a+D58&#39;ATD4$Bl@l3De:,-DJs`8ARoFb/0JMK@qB4^F!,R&lt;AKZ&amp;-DfTqBG%G\n&#34;</span>&nbsp;<span class="op" id="7493012">+</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7493017">&#34;&gt;uD.RTpAKYo&#39;+CT/5+Cei#DII?(E,9)oF*2M7/c\n&#34;</span><span class="op" id="7493060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7493063">}</span><span class="op" id="7493064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7493067">//&nbsp;Special&nbsp;case&nbsp;when&nbsp;shortening&nbsp;!!!!!&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7493112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7493116">&#34;\000\000\000\000&#34;</span><span class="op" id="7493134">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7493138">&#34;z&#34;</span><span class="op" id="7493141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7493144">}</span><span class="op" id="7493145">,</span><br>
<span class="lineno"></span><span class="op" id="7493147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7493150">var</span>&nbsp;<span class="ident" id="7493154">bigtest</span>&nbsp;<span class="op" id="7493162">=</span>&nbsp;<span class="ident" id="7493164">pairs</span><span class="op" id="7493169">[</span><span class="builtinfunc" id="7493170">len</span><span class="op" id="7493173">(</span><span class="ident" id="7493174">pairs</span><span class="op" id="7493179">)</span><span class="op" id="7493180">-</span><span class="num" id="7493181">1</span><span class="op" id="7493182">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7493185">func</span>&nbsp;<span class="ident" id="7493190">testEqual</span><span class="op" id="7493199">(</span><span class="ident" id="7493200">t</span>&nbsp;<span class="op" id="7493202">*</span><span class="ident" id="7493203">testing</span><span class="op" id="7493210">.</span><span class="ident" id="7493211">T</span><span class="op" id="7493212">,</span>&nbsp;<span class="ident" id="7493214">msg</span>&nbsp;<span class="builtintype" id="7493218">string</span><span class="op" id="7493224">,</span>&nbsp;<span class="ident" id="7493226">args</span>&nbsp;<span class="op" id="7493231">...</span><span class="keyword" id="7493234">interface</span><span class="op" id="7493243">{</span><span class="op" id="7493244">}</span><span class="op" id="7493245">)</span>&nbsp;<span class="builtintype" id="7493247">bool</span>&nbsp;<span class="op" id="7493252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7493255">if</span>&nbsp;<span class="ident" id="7493258">args</span><span class="op" id="7493262">[</span><span class="builtinfunc" id="7493263">len</span><span class="op" id="7493266">(</span><span class="ident" id="7493267">args</span><span class="op" id="7493271">)</span><span class="op" id="7493272">-</span><span class="num" id="7493273">2</span><span class="op" id="7493274">]</span>&nbsp;<span class="op" id="7493276">!=</span>&nbsp;<span class="ident" id="7493279">args</span><span class="op" id="7493283">[</span><span class="builtinfunc" id="7493284">len</span><span class="op" id="7493287">(</span><span class="ident" id="7493288">args</span><span class="op" id="7493292">)</span><span class="op" id="7493293">-</span><span class="num" id="7493294">1</span><span class="op" id="7493295">]</span>&nbsp;<span class="op" id="7493297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493301">t</span><span class="op" id="7493302">.</span><span class="ident" id="7493303">Errorf</span><span class="op" id="7493309">(</span><span class="ident" id="7493310">msg</span><span class="op" id="7493313">,</span>&nbsp;<span class="ident" id="7493315">args</span><span class="op" id="7493319">...</span><span class="op" id="7493322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7493326">return</span>&nbsp;<span class="builtintype" id="7493333">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7493340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7493343">return</span>&nbsp;<span class="builtintype" id="7493350">true</span><br>
<span class="lineno"></span><span class="op" id="7493355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7493358">func</span>&nbsp;<span class="ident" id="7493363">strip85</span><span class="op" id="7493370">(</span><span class="ident" id="7493371">s</span>&nbsp;<span class="builtintype" id="7493373">string</span><span class="op" id="7493379">)</span>&nbsp;<span class="builtintype" id="7493381">string</span>&nbsp;<span class="op" id="7493388">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493391">t</span>&nbsp;<span class="op" id="7493393">:=</span>&nbsp;<span class="builtinfunc" id="7493396">make</span><span class="op" id="7493400">(</span><span class="op" id="7493401">[</span><span class="op" id="7493402">]</span><span class="builtintype" id="7493403">byte</span><span class="op" id="7493407">,</span>&nbsp;<span class="builtinfunc" id="7493409">len</span><span class="op" id="7493412">(</span><span class="ident" id="7493413">s</span><span class="op" id="7493414">)</span><span class="op" id="7493415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493418">w</span>&nbsp;<span class="op" id="7493420">:=</span>&nbsp;<span class="num" id="7493423">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7493426">for</span>&nbsp;<span class="ident" id="7493430">r</span>&nbsp;<span class="op" id="7493432">:=</span>&nbsp;<span class="num" id="7493435">0</span><span class="op" id="7493436">;</span>&nbsp;<span class="ident" id="7493438">r</span>&nbsp;<span class="op" id="7493440">&lt;</span>&nbsp;<span class="builtinfunc" id="7493442">len</span><span class="op" id="7493445">(</span><span class="ident" id="7493446">s</span><span class="op" id="7493447">)</span><span class="op" id="7493448">;</span>&nbsp;<span class="ident" id="7493450">r</span><span class="op" id="7493451">++</span>&nbsp;<span class="op" id="7493454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493458">c</span>&nbsp;<span class="op" id="7493460">:=</span>&nbsp;<span class="ident" id="7493463">s</span><span class="op" id="7493464">[</span><span class="ident" id="7493465">r</span><span class="op" id="7493466">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7493470">if</span>&nbsp;<span class="ident" id="7493473">c</span>&nbsp;<span class="op" id="7493475">&gt;</span>&nbsp;<span class="string" id="7493477">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="7493481">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493486">t</span><span class="op" id="7493487">[</span><span class="ident" id="7493488">w</span><span class="op" id="7493489">]</span>&nbsp;<span class="op" id="7493491">=</span>&nbsp;<span class="ident" id="7493493">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493498">w</span><span class="op" id="7493499">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7493504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7493507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7493510">return</span>&nbsp;<span class="builtintype" id="7493517">string</span><span class="op" id="7493523">(</span><span class="ident" id="7493524">t</span><span class="op" id="7493525">[</span><span class="num" id="7493526">0</span><span class="op" id="7493527">:</span><span class="ident" id="7493528">w</span><span class="op" id="7493529">]</span><span class="op" id="7493530">)</span><br>
<span class="lineno">65</span><span class="op" id="7493532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7493535">func</span>&nbsp;<span class="ident" id="7493540">TestEncode</span><span class="op" id="7493550">(</span><span class="ident" id="7493551">t</span>&nbsp;<span class="op" id="7493553">*</span><span class="ident" id="7493554">testing</span><span class="op" id="7493561">.</span><span class="ident" id="7493562">T</span><span class="op" id="7493563">)</span>&nbsp;<span class="op" id="7493565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7493568">for</span>&nbsp;<span class="ident" id="7493572">_</span><span class="op" id="7493573">,</span>&nbsp;<span class="ident" id="7493575">p</span>&nbsp;<span class="op" id="7493577">:=</span>&nbsp;<span class="keyword" id="7493580">range</span>&nbsp;<span class="ident" id="7493586">pairs</span>&nbsp;<span class="op" id="7493592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493596">buf</span>&nbsp;<span class="op" id="7493600">:=</span>&nbsp;<span class="builtinfunc" id="7493603">make</span><span class="op" id="7493607">(</span><span class="op" id="7493608">[</span><span class="op" id="7493609">]</span><span class="builtintype" id="7493610">byte</span><span class="op" id="7493614">,</span>&nbsp;<span class="ident" id="7493616">MaxEncodedLen</span><span class="op" id="7493629">(</span><span class="builtinfunc" id="7493630">len</span><span class="op" id="7493633">(</span><span class="ident" id="7493634">p</span><span class="op" id="7493635">.</span><span class="ident" id="7493636">decoded</span><span class="op" id="7493643">)</span><span class="op" id="7493644">)</span><span class="op" id="7493645">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493649">n</span>&nbsp;<span class="op" id="7493651">:=</span>&nbsp;<span class="ident" id="7493654">Encode</span><span class="op" id="7493660">(</span><span class="ident" id="7493661">buf</span><span class="op" id="7493664">,</span>&nbsp;<span class="op" id="7493666">[</span><span class="op" id="7493667">]</span><span class="builtintype" id="7493668">byte</span><span class="op" id="7493672">(</span><span class="ident" id="7493673">p</span><span class="op" id="7493674">.</span><span class="ident" id="7493675">decoded</span><span class="op" id="7493682">)</span><span class="op" id="7493683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493687">buf</span>&nbsp;<span class="op" id="7493691">=</span>&nbsp;<span class="ident" id="7493693">buf</span><span class="op" id="7493696">[</span><span class="num" id="7493697">0</span><span class="op" id="7493698">:</span><span class="ident" id="7493699">n</span><span class="op" id="7493700">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493704">testEqual</span><span class="op" id="7493713">(</span><span class="ident" id="7493714">t</span><span class="op" id="7493715">,</span>&nbsp;<span class="string" id="7493717">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7493743">,</span>&nbsp;<span class="ident" id="7493745">p</span><span class="op" id="7493746">.</span><span class="ident" id="7493747">decoded</span><span class="op" id="7493754">,</span>&nbsp;<span class="ident" id="7493756">strip85</span><span class="op" id="7493763">(</span><span class="builtintype" id="7493764">string</span><span class="op" id="7493770">(</span><span class="ident" id="7493771">buf</span><span class="op" id="7493774">)</span><span class="op" id="7493775">)</span><span class="op" id="7493776">,</span>&nbsp;<span class="ident" id="7493778">strip85</span><span class="op" id="7493785">(</span><span class="ident" id="7493786">p</span><span class="op" id="7493787">.</span><span class="ident" id="7493788">encoded</span><span class="op" id="7493795">)</span><span class="op" id="7493796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7493799">}</span><br>
<span class="lineno"></span><span class="op" id="7493801">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7493804">func</span>&nbsp;<span class="ident" id="7493809">TestEncoder</span><span class="op" id="7493820">(</span><span class="ident" id="7493821">t</span>&nbsp;<span class="op" id="7493823">*</span><span class="ident" id="7493824">testing</span><span class="op" id="7493831">.</span><span class="ident" id="7493832">T</span><span class="op" id="7493833">)</span>&nbsp;<span class="op" id="7493835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7493838">for</span>&nbsp;<span class="ident" id="7493842">_</span><span class="op" id="7493843">,</span>&nbsp;<span class="ident" id="7493845">p</span>&nbsp;<span class="op" id="7493847">:=</span>&nbsp;<span class="keyword" id="7493850">range</span>&nbsp;<span class="ident" id="7493856">pairs</span>&nbsp;<span class="op" id="7493862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493866">bb</span>&nbsp;<span class="op" id="7493869">:=</span>&nbsp;<span class="op" id="7493872">&amp;</span><span class="ident" id="7493873">bytes</span><span class="op" id="7493878">.</span><span class="ident" id="7493879">Buffer</span><span class="op" id="7493885">{</span><span class="op" id="7493886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493890">encoder</span>&nbsp;<span class="op" id="7493898">:=</span>&nbsp;<span class="ident" id="7493901">NewEncoder</span><span class="op" id="7493911">(</span><span class="ident" id="7493912">bb</span><span class="op" id="7493914">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493918">encoder</span><span class="op" id="7493925">.</span><span class="ident" id="7493926">Write</span><span class="op" id="7493931">(</span><span class="op" id="7493932">[</span><span class="op" id="7493933">]</span><span class="builtintype" id="7493934">byte</span><span class="op" id="7493938">(</span><span class="ident" id="7493939">p</span><span class="op" id="7493940">.</span><span class="ident" id="7493941">decoded</span><span class="op" id="7493948">)</span><span class="op" id="7493949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493953">encoder</span><span class="op" id="7493960">.</span><span class="ident" id="7493961">Close</span><span class="op" id="7493966">(</span><span class="op" id="7493967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7493971">testEqual</span><span class="op" id="7493980">(</span><span class="ident" id="7493981">t</span><span class="op" id="7493982">,</span>&nbsp;<span class="string" id="7493984">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7494010">,</span>&nbsp;<span class="ident" id="7494012">p</span><span class="op" id="7494013">.</span><span class="ident" id="7494014">decoded</span><span class="op" id="7494021">,</span>&nbsp;<span class="ident" id="7494023">strip85</span><span class="op" id="7494030">(</span><span class="ident" id="7494031">bb</span><span class="op" id="7494033">.</span><span class="ident" id="7494034">String</span><span class="op" id="7494040">(</span><span class="op" id="7494041">)</span><span class="op" id="7494042">)</span><span class="op" id="7494043">,</span>&nbsp;<span class="ident" id="7494045">strip85</span><span class="op" id="7494052">(</span><span class="ident" id="7494053">p</span><span class="op" id="7494054">.</span><span class="ident" id="7494055">encoded</span><span class="op" id="7494062">)</span><span class="op" id="7494063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7494066">}</span><br>
<span class="lineno"></span><span class="op" id="7494068">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7494071">func</span>&nbsp;<span class="ident" id="7494076">TestEncoderBuffering</span><span class="op" id="7494096">(</span><span class="ident" id="7494097">t</span>&nbsp;<span class="op" id="7494099">*</span><span class="ident" id="7494100">testing</span><span class="op" id="7494107">.</span><span class="ident" id="7494108">T</span><span class="op" id="7494109">)</span>&nbsp;<span class="op" id="7494111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494114">input</span>&nbsp;<span class="op" id="7494120">:=</span>&nbsp;<span class="op" id="7494123">[</span><span class="op" id="7494124">]</span><span class="builtintype" id="7494125">byte</span><span class="op" id="7494129">(</span><span class="ident" id="7494130">bigtest</span><span class="op" id="7494137">.</span><span class="ident" id="7494138">decoded</span><span class="op" id="7494145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7494148">for</span>&nbsp;<span class="ident" id="7494152">bs</span>&nbsp;<span class="op" id="7494155">:=</span>&nbsp;<span class="num" id="7494158">1</span><span class="op" id="7494159">;</span>&nbsp;<span class="ident" id="7494161">bs</span>&nbsp;<span class="op" id="7494164">&lt;=</span>&nbsp;<span class="num" id="7494167">12</span><span class="op" id="7494169">;</span>&nbsp;<span class="ident" id="7494171">bs</span><span class="op" id="7494173">++</span>&nbsp;<span class="op" id="7494176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494180">bb</span>&nbsp;<span class="op" id="7494183">:=</span>&nbsp;<span class="op" id="7494186">&amp;</span><span class="ident" id="7494187">bytes</span><span class="op" id="7494192">.</span><span class="ident" id="7494193">Buffer</span><span class="op" id="7494199">{</span><span class="op" id="7494200">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494204">encoder</span>&nbsp;<span class="op" id="7494212">:=</span>&nbsp;<span class="ident" id="7494215">NewEncoder</span><span class="op" id="7494225">(</span><span class="ident" id="7494226">bb</span><span class="op" id="7494228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7494232">for</span>&nbsp;<span class="ident" id="7494236">pos</span>&nbsp;<span class="op" id="7494240">:=</span>&nbsp;<span class="num" id="7494243">0</span><span class="op" id="7494244">;</span>&nbsp;<span class="ident" id="7494246">pos</span>&nbsp;<span class="op" id="7494250">&lt;</span>&nbsp;<span class="builtinfunc" id="7494252">len</span><span class="op" id="7494255">(</span><span class="ident" id="7494256">input</span><span class="op" id="7494261">)</span><span class="op" id="7494262">;</span>&nbsp;<span class="ident" id="7494264">pos</span>&nbsp;<span class="op" id="7494268">+=</span>&nbsp;<span class="ident" id="7494271">bs</span>&nbsp;<span class="op" id="7494274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494279">end</span>&nbsp;<span class="op" id="7494283">:=</span>&nbsp;<span class="ident" id="7494286">pos</span>&nbsp;<span class="op" id="7494290">+</span>&nbsp;<span class="ident" id="7494292">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7494298">if</span>&nbsp;<span class="ident" id="7494301">end</span>&nbsp;<span class="op" id="7494305">&gt;</span>&nbsp;<span class="builtinfunc" id="7494307">len</span><span class="op" id="7494310">(</span><span class="ident" id="7494311">input</span><span class="op" id="7494316">)</span>&nbsp;<span class="op" id="7494318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494324">end</span>&nbsp;<span class="op" id="7494328">=</span>&nbsp;<span class="builtinfunc" id="7494330">len</span><span class="op" id="7494333">(</span><span class="ident" id="7494334">input</span><span class="op" id="7494339">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7494344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494349">n</span><span class="op" id="7494350">,</span>&nbsp;<span class="ident" id="7494352">err</span>&nbsp;<span class="op" id="7494356">:=</span>&nbsp;<span class="ident" id="7494359">encoder</span><span class="op" id="7494366">.</span><span class="ident" id="7494367">Write</span><span class="op" id="7494372">(</span><span class="ident" id="7494373">input</span><span class="op" id="7494378">[</span><span class="ident" id="7494379">pos</span><span class="op" id="7494382">:</span><span class="ident" id="7494383">end</span><span class="op" id="7494386">]</span><span class="op" id="7494387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494392">testEqual</span><span class="op" id="7494401">(</span><span class="ident" id="7494402">t</span><span class="op" id="7494403">,</span>&nbsp;<span class="string" id="7494405">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7494439">,</span>&nbsp;<span class="ident" id="7494441">input</span><span class="op" id="7494446">[</span><span class="ident" id="7494447">pos</span><span class="op" id="7494450">:</span><span class="ident" id="7494451">end</span><span class="op" id="7494454">]</span><span class="op" id="7494455">,</span>&nbsp;<span class="ident" id="7494457">err</span><span class="op" id="7494460">,</span>&nbsp;<span class="builtintype" id="7494462">error</span><span class="op" id="7494467">(</span><span class="builtintype" id="7494468">nil</span><span class="op" id="7494471">)</span><span class="op" id="7494472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494477">testEqual</span><span class="op" id="7494486">(</span><span class="ident" id="7494487">t</span><span class="op" id="7494488">,</span>&nbsp;<span class="string" id="7494490">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7494525">,</span>&nbsp;<span class="ident" id="7494527">input</span><span class="op" id="7494532">[</span><span class="ident" id="7494533">pos</span><span class="op" id="7494536">:</span><span class="ident" id="7494537">end</span><span class="op" id="7494540">]</span><span class="op" id="7494541">,</span>&nbsp;<span class="ident" id="7494543">n</span><span class="op" id="7494544">,</span>&nbsp;<span class="ident" id="7494546">end</span><span class="op" id="7494549">-</span><span class="ident" id="7494550">pos</span><span class="op" id="7494553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7494557">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494561">err</span>&nbsp;<span class="op" id="7494565">:=</span>&nbsp;<span class="ident" id="7494568">encoder</span><span class="op" id="7494575">.</span><span class="ident" id="7494576">Close</span><span class="op" id="7494581">(</span><span class="op" id="7494582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494586">testEqual</span><span class="op" id="7494595">(</span><span class="ident" id="7494596">t</span><span class="op" id="7494597">,</span>&nbsp;<span class="string" id="7494599">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7494629">,</span>&nbsp;<span class="ident" id="7494631">err</span><span class="op" id="7494634">,</span>&nbsp;<span class="builtintype" id="7494636">error</span><span class="op" id="7494641">(</span><span class="builtintype" id="7494642">nil</span><span class="op" id="7494645">)</span><span class="op" id="7494646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494650">testEqual</span><span class="op" id="7494659">(</span><span class="ident" id="7494660">t</span><span class="op" id="7494661">,</span>&nbsp;<span class="string" id="7494663">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7494696">,</span>&nbsp;<span class="ident" id="7494698">bs</span><span class="op" id="7494700">,</span>&nbsp;<span class="ident" id="7494702">bigtest</span><span class="op" id="7494709">.</span><span class="ident" id="7494710">decoded</span><span class="op" id="7494717">,</span>&nbsp;<span class="ident" id="7494719">strip85</span><span class="op" id="7494726">(</span><span class="ident" id="7494727">bb</span><span class="op" id="7494729">.</span><span class="ident" id="7494730">String</span><span class="op" id="7494736">(</span><span class="op" id="7494737">)</span><span class="op" id="7494738">)</span><span class="op" id="7494739">,</span>&nbsp;<span class="ident" id="7494741">strip85</span><span class="op" id="7494748">(</span><span class="ident" id="7494749">bigtest</span><span class="op" id="7494756">.</span><span class="ident" id="7494757">encoded</span><span class="op" id="7494764">)</span><span class="op" id="7494765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7494768">}</span><br>
<span class="lineno"></span><span class="op" id="7494770">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7494773">func</span>&nbsp;<span class="ident" id="7494778">TestDecode</span><span class="op" id="7494788">(</span><span class="ident" id="7494789">t</span>&nbsp;<span class="op" id="7494791">*</span><span class="ident" id="7494792">testing</span><span class="op" id="7494799">.</span><span class="ident" id="7494800">T</span><span class="op" id="7494801">)</span>&nbsp;<span class="op" id="7494803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7494806">for</span>&nbsp;<span class="ident" id="7494810">_</span><span class="op" id="7494811">,</span>&nbsp;<span class="ident" id="7494813">p</span>&nbsp;<span class="op" id="7494815">:=</span>&nbsp;<span class="keyword" id="7494818">range</span>&nbsp;<span class="ident" id="7494824">pairs</span>&nbsp;<span class="op" id="7494830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494834">dbuf</span>&nbsp;<span class="op" id="7494839">:=</span>&nbsp;<span class="builtinfunc" id="7494842">make</span><span class="op" id="7494846">(</span><span class="op" id="7494847">[</span><span class="op" id="7494848">]</span><span class="builtintype" id="7494849">byte</span><span class="op" id="7494853">,</span>&nbsp;<span class="num" id="7494855">4</span><span class="op" id="7494856">*</span><span class="builtinfunc" id="7494857">len</span><span class="op" id="7494860">(</span><span class="ident" id="7494861">p</span><span class="op" id="7494862">.</span><span class="ident" id="7494863">encoded</span><span class="op" id="7494870">)</span><span class="op" id="7494871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494875">ndst</span><span class="op" id="7494879">,</span>&nbsp;<span class="ident" id="7494881">nsrc</span><span class="op" id="7494885">,</span>&nbsp;<span class="ident" id="7494887">err</span>&nbsp;<span class="op" id="7494891">:=</span>&nbsp;<span class="ident" id="7494894">Decode</span><span class="op" id="7494900">(</span><span class="ident" id="7494901">dbuf</span><span class="op" id="7494905">,</span>&nbsp;<span class="op" id="7494907">[</span><span class="op" id="7494908">]</span><span class="builtintype" id="7494909">byte</span><span class="op" id="7494913">(</span><span class="ident" id="7494914">p</span><span class="op" id="7494915">.</span><span class="ident" id="7494916">encoded</span><span class="op" id="7494923">)</span><span class="op" id="7494924">,</span>&nbsp;<span class="builtintype" id="7494926">true</span><span class="op" id="7494930">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7494934">testEqual</span><span class="op" id="7494943">(</span><span class="ident" id="7494944">t</span><span class="op" id="7494945">,</span>&nbsp;<span class="string" id="7494947">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7494979">,</span>&nbsp;<span class="ident" id="7494981">p</span><span class="op" id="7494982">.</span><span class="ident" id="7494983">encoded</span><span class="op" id="7494990">,</span>&nbsp;<span class="ident" id="7494992">err</span><span class="op" id="7494995">,</span>&nbsp;<span class="builtintype" id="7494997">error</span><span class="op" id="7495002">(</span><span class="builtintype" id="7495003">nil</span><span class="op" id="7495006">)</span><span class="op" id="7495007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7495011">testEqual</span><span class="op" id="7495020">(</span><span class="ident" id="7495021">t</span><span class="op" id="7495022">,</span>&nbsp;<span class="string" id="7495024">&#34;Decode(%q)&nbsp;=&nbsp;nsrc&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7495055">,</span>&nbsp;<span class="ident" id="7495057">p</span><span class="op" id="7495058">.</span><span class="ident" id="7495059">encoded</span><span class="op" id="7495066">,</span>&nbsp;<span class="ident" id="7495068">nsrc</span><span class="op" id="7495072">,</span>&nbsp;<span class="builtinfunc" id="7495074">len</span><span class="op" id="7495077">(</span><span class="ident" id="7495078">p</span><span class="op" id="7495079">.</span><span class="ident" id="7495080">encoded</span><span class="op" id="7495087">)</span><span class="op" id="7495088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7495092">testEqual</span><span class="op" id="7495101">(</span><span class="ident" id="7495102">t</span><span class="op" id="7495103">,</span>&nbsp;<span class="string" id="7495105">&#34;Decode(%q)&nbsp;=&nbsp;ndst&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7495136">,</span>&nbsp;<span class="ident" id="7495138">p</span><span class="op" id="7495139">.</span><span class="ident" id="7495140">encoded</span><span class="op" id="7495147">,</span>&nbsp;<span class="ident" id="7495149">ndst</span><span class="op" id="7495153">,</span>&nbsp;<span class="builtinfunc" id="7495155">len</span><span class="op" id="7495158">(</span><span class="ident" id="7495159">p</span><span class="op" id="7495160">.</span><span class="ident" id="7495161">decoded</span><span class="op" id="7495168">)</span><span class="op" id="7495169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7495173">testEqual</span><span class="op" id="7495182">(</span><span class="ident" id="7495183">t</span><span class="op" id="7495184">,</span>&nbsp;<span class="string" id="7495186">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7495212">,</span>&nbsp;<span class="ident" id="7495214">p</span><span class="op" id="7495215">.</span><span class="ident" id="7495216">encoded</span><span class="op" id="7495223">,</span>&nbsp;<span class="builtintype" id="7495225">string</span><span class="op" id="7495231">(</span><span class="ident" id="7495232">dbuf</span><span class="op" id="7495236">[</span><span class="num" id="7495237">0</span><span class="op" id="7495238">:</span><span class="ident" id="7495239">ndst</span><span class="op" id="7495243">]</span><span class="op" id="7495244">)</span><span class="op" id="7495245">,</span>&nbsp;<span class="ident" id="7495247">p</span><span class="op" id="7495248">.</span><span class="ident" id="7495249">decoded</span><span class="op" id="7495256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7495259">}</span><br>
<span class="lineno">115</span><span class="op" id="7495261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7495264">func</span>&nbsp;<span class="ident" id="7495269">TestDecoder</span><span class="op" id="7495280">(</span><span class="ident" id="7495281">t</span>&nbsp;<span class="op" id="7495283">*</span><span class="ident" id="7495284">testing</span><span class="op" id="7495291">.</span><span class="ident" id="7495292">T</span><span class="op" id="7495293">)</span>&nbsp;<span class="op" id="7495295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7495298">for</span>&nbsp;<span class="ident" id="7495302">_</span><span class="op" id="7495303">,</span>&nbsp;<span class="ident" id="7495305">p</span>&nbsp;<span class="op" id="7495307">:=</span>&nbsp;<span class="keyword" id="7495310">range</span>&nbsp;<span class="ident" id="7495316">pairs</span>&nbsp;<span class="op" id="7495322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7495326">decoder</span>&nbsp;<span class="op" id="7495334">:=</span>&nbsp;<span class="ident" id="7495337">NewDecoder</span><span class="op" id="7495347">(</span><span class="ident" id="7495348">strings</span><span class="op" id="7495355">.</span><span class="ident" id="7495356">NewReader</span><span class="op" id="7495365">(</span><span class="ident" id="7495366">p</span><span class="op" id="7495367">.</span><span class="ident" id="7495368">encoded</span><span class="op" id="7495375">)</span><span class="op" id="7495376">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7495380">dbuf</span><span class="op" id="7495384">,</span>&nbsp;<span class="ident" id="7495386">err</span>&nbsp;<span class="op" id="7495390">:=</span>&nbsp;<span class="ident" id="7495393">ioutil</span><span class="op" id="7495399">.</span><span class="ident" id="7495400">ReadAll</span><span class="op" id="7495407">(</span><span class="ident" id="7495408">decoder</span><span class="op" id="7495415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7495419">if</span>&nbsp;<span class="ident" id="7495422">err</span>&nbsp;<span class="op" id="7495426">!=</span>&nbsp;<span class="builtintype" id="7495429">nil</span>&nbsp;<span class="op" id="7495433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7495438">t</span><span class="op" id="7495439">.</span><span class="ident" id="7495440">Fatal</span><span class="op" id="7495445">(</span><span class="string" id="7495446">&#34;Read&nbsp;failed&#34;</span><span class="op" id="7495459">,</span>&nbsp;<span class="ident" id="7495461">err</span><span class="op" id="7495464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7495468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7495472">testEqual</span><span class="op" id="7495481">(</span><span class="ident" id="7495482">t</span><span class="op" id="7495483">,</span>&nbsp;<span class="string" id="7495485">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7495520">,</span>&nbsp;<span class="ident" id="7495522">p</span><span class="op" id="7495523">.</span><span class="ident" id="7495524">encoded</span><span class="op" id="7495531">,</span>&nbsp;<span class="builtinfunc" id="7495533">len</span><span class="op" id="7495536">(</span><span class="ident" id="7495537">dbuf</span><span class="op" id="7495541">)</span><span class="op" id="7495542">,</span>&nbsp;<span class="builtinfunc" id="7495544">len</span><span class="op" id="7495547">(</span><span class="ident" id="7495548">p</span><span class="op" id="7495549">.</span><span class="ident" id="7495550">decoded</span><span class="op" id="7495557">)</span><span class="op" id="7495558">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7495562">testEqual</span><span class="op" id="7495571">(</span><span class="ident" id="7495572">t</span><span class="op" id="7495573">,</span>&nbsp;<span class="string" id="7495575">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7495605">,</span>&nbsp;<span class="ident" id="7495607">p</span><span class="op" id="7495608">.</span><span class="ident" id="7495609">encoded</span><span class="op" id="7495616">,</span>&nbsp;<span class="builtintype" id="7495618">string</span><span class="op" id="7495624">(</span><span class="ident" id="7495625">dbuf</span><span class="op" id="7495629">)</span><span class="op" id="7495630">,</span>&nbsp;<span class="ident" id="7495632">p</span><span class="op" id="7495633">.</span><span class="ident" id="7495634">decoded</span><span class="op" id="7495641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7495645">if</span>&nbsp;<span class="ident" id="7495648">err</span>&nbsp;<span class="op" id="7495652">!=</span>&nbsp;<span class="builtintype" id="7495655">nil</span>&nbsp;<span class="op" id="7495659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7495664">testEqual</span><span class="op" id="7495673">(</span><span class="ident" id="7495674">t</span><span class="op" id="7495675">,</span>&nbsp;<span class="string" id="7495677">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7495705">,</span>&nbsp;<span class="ident" id="7495707">p</span><span class="op" id="7495708">.</span><span class="ident" id="7495709">encoded</span><span class="op" id="7495716">,</span>&nbsp;<span class="ident" id="7495718">err</span><span class="op" id="7495721">,</span>&nbsp;<span class="ident" id="7495723">io</span><span class="op" id="7495725">.</span><span class="ident" id="7495726">EOF</span><span class="op" id="7495729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7495733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7495736">}</span><br>
<span class="lineno">130</span><span class="op" id="7495738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7495741">func</span>&nbsp;<span class="ident" id="7495746">TestDecoderBuffering</span><span class="op" id="7495766">(</span><span class="ident" id="7495767">t</span>&nbsp;<span class="op" id="7495769">*</span><span class="ident" id="7495770">testing</span><span class="op" id="7495777">.</span><span class="ident" id="7495778">T</span><span class="op" id="7495779">)</span>&nbsp;<span class="op" id="7495781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7495784">for</span>&nbsp;<span class="ident" id="7495788">bs</span>&nbsp;<span class="op" id="7495791">:=</span>&nbsp;<span class="num" id="7495794">1</span><span class="op" id="7495795">;</span>&nbsp;<span class="ident" id="7495797">bs</span>&nbsp;<span class="op" id="7495800">&lt;=</span>&nbsp;<span class="num" id="7495803">12</span><span class="op" id="7495805">;</span>&nbsp;<span class="ident" id="7495807">bs</span><span class="op" id="7495809">++</span>&nbsp;<span class="op" id="7495812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7495816">decoder</span>&nbsp;<span class="op" id="7495824">:=</span>&nbsp;<span class="ident" id="7495827">NewDecoder</span><span class="op" id="7495837">(</span><span class="ident" id="7495838">strings</span><span class="op" id="7495845">.</span><span class="ident" id="7495846">NewReader</span><span class="op" id="7495855">(</span><span class="ident" id="7495856">bigtest</span><span class="op" id="7495863">.</span><span class="ident" id="7495864">encoded</span><span class="op" id="7495871">)</span><span class="op" id="7495872">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7495876">buf</span>&nbsp;<span class="op" id="7495880">:=</span>&nbsp;<span class="builtinfunc" id="7495883">make</span><span class="op" id="7495887">(</span><span class="op" id="7495888">[</span><span class="op" id="7495889">]</span><span class="builtintype" id="7495890">byte</span><span class="op" id="7495894">,</span>&nbsp;<span class="builtinfunc" id="7495896">len</span><span class="op" id="7495899">(</span><span class="ident" id="7495900">bigtest</span><span class="op" id="7495907">.</span><span class="ident" id="7495908">decoded</span><span class="op" id="7495915">)</span><span class="op" id="7495916">+</span><span class="num" id="7495917">12</span><span class="op" id="7495919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7495923">var</span>&nbsp;<span class="ident" id="7495927">total</span>&nbsp;<span class="builtintype" id="7495933">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7495939">for</span>&nbsp;<span class="ident" id="7495943">total</span>&nbsp;<span class="op" id="7495949">=</span>&nbsp;<span class="num" id="7495951">0</span><span class="op" id="7495952">;</span>&nbsp;<span class="ident" id="7495954">total</span>&nbsp;<span class="op" id="7495960">&lt;</span>&nbsp;<span class="builtinfunc" id="7495962">len</span><span class="op" id="7495965">(</span><span class="ident" id="7495966">bigtest</span><span class="op" id="7495973">.</span><span class="ident" id="7495974">decoded</span><span class="op" id="7495981">)</span><span class="op" id="7495982">;</span>&nbsp;<span class="op" id="7495984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7495989">n</span><span class="op" id="7495990">,</span>&nbsp;<span class="ident" id="7495992">err</span>&nbsp;<span class="op" id="7495996">:=</span>&nbsp;<span class="ident" id="7495999">decoder</span><span class="op" id="7496006">.</span><span class="ident" id="7496007">Read</span><span class="op" id="7496011">(</span><span class="ident" id="7496012">buf</span><span class="op" id="7496015">[</span><span class="ident" id="7496016">total</span>&nbsp;<span class="op" id="7496022">:</span>&nbsp;<span class="ident" id="7496024">total</span><span class="op" id="7496029">+</span><span class="ident" id="7496030">bs</span><span class="op" id="7496032">]</span><span class="op" id="7496033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496038">testEqual</span><span class="op" id="7496047">(</span><span class="ident" id="7496048">t</span><span class="op" id="7496049">,</span>&nbsp;<span class="string" id="7496051">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7496096">,</span>&nbsp;<span class="ident" id="7496098">bigtest</span><span class="op" id="7496105">.</span><span class="ident" id="7496106">encoded</span><span class="op" id="7496113">,</span>&nbsp;<span class="ident" id="7496115">total</span><span class="op" id="7496120">,</span>&nbsp;<span class="ident" id="7496122">n</span><span class="op" id="7496123">,</span>&nbsp;<span class="ident" id="7496125">err</span><span class="op" id="7496128">,</span>&nbsp;<span class="builtintype" id="7496130">error</span><span class="op" id="7496135">(</span><span class="builtintype" id="7496136">nil</span><span class="op" id="7496139">)</span><span class="op" id="7496140">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496145">total</span>&nbsp;<span class="op" id="7496151">+=</span>&nbsp;<span class="ident" id="7496154">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7496158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496162">testEqual</span><span class="op" id="7496171">(</span><span class="ident" id="7496172">t</span><span class="op" id="7496173">,</span>&nbsp;<span class="string" id="7496175">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7496208">,</span>&nbsp;<span class="ident" id="7496210">bs</span><span class="op" id="7496212">,</span>&nbsp;<span class="ident" id="7496214">bigtest</span><span class="op" id="7496221">.</span><span class="ident" id="7496222">encoded</span><span class="op" id="7496229">,</span>&nbsp;<span class="builtintype" id="7496231">string</span><span class="op" id="7496237">(</span><span class="ident" id="7496238">buf</span><span class="op" id="7496241">[</span><span class="num" id="7496242">0</span><span class="op" id="7496243">:</span><span class="ident" id="7496244">total</span><span class="op" id="7496249">]</span><span class="op" id="7496250">)</span><span class="op" id="7496251">,</span>&nbsp;<span class="ident" id="7496253">bigtest</span><span class="op" id="7496260">.</span><span class="ident" id="7496261">decoded</span><span class="op" id="7496268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7496271">}</span><br>
<span class="lineno"></span><span class="op" id="7496273">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="7496276">func</span>&nbsp;<span class="ident" id="7496281">TestDecodeCorrupt</span><span class="op" id="7496298">(</span><span class="ident" id="7496299">t</span>&nbsp;<span class="op" id="7496301">*</span><span class="ident" id="7496302">testing</span><span class="op" id="7496309">.</span><span class="ident" id="7496310">T</span><span class="op" id="7496311">)</span>&nbsp;<span class="op" id="7496313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7496316">type</span>&nbsp;<span class="ident" id="7496321">corrupt</span>&nbsp;<span class="keyword" id="7496329">struct</span>&nbsp;<span class="op" id="7496336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496340">e</span>&nbsp;<span class="builtintype" id="7496342">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496351">p</span>&nbsp;<span class="builtintype" id="7496353">int</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7496358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496361">examples</span>&nbsp;<span class="op" id="7496370">:=</span>&nbsp;<span class="op" id="7496373">[</span><span class="op" id="7496374">]</span><span class="ident" id="7496375">corrupt</span><span class="op" id="7496382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7496386">{</span><span class="string" id="7496387">&#34;v&#34;</span><span class="op" id="7496390">,</span>&nbsp;<span class="num" id="7496392">0</span><span class="op" id="7496393">}</span><span class="op" id="7496394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7496398">{</span><span class="string" id="7496399">&#34;!z!!!!!!!!!&#34;</span><span class="op" id="7496412">,</span>&nbsp;<span class="num" id="7496414">1</span><span class="op" id="7496415">}</span><span class="op" id="7496416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7496419">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7496423">for</span>&nbsp;<span class="ident" id="7496427">_</span><span class="op" id="7496428">,</span>&nbsp;<span class="ident" id="7496430">e</span>&nbsp;<span class="op" id="7496432">:=</span>&nbsp;<span class="keyword" id="7496435">range</span>&nbsp;<span class="ident" id="7496441">examples</span>&nbsp;<span class="op" id="7496450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496454">dbuf</span>&nbsp;<span class="op" id="7496459">:=</span>&nbsp;<span class="builtinfunc" id="7496462">make</span><span class="op" id="7496466">(</span><span class="op" id="7496467">[</span><span class="op" id="7496468">]</span><span class="builtintype" id="7496469">byte</span><span class="op" id="7496473">,</span>&nbsp;<span class="num" id="7496475">4</span><span class="op" id="7496476">*</span><span class="builtinfunc" id="7496477">len</span><span class="op" id="7496480">(</span><span class="ident" id="7496481">e</span><span class="op" id="7496482">.</span><span class="ident" id="7496483">e</span><span class="op" id="7496484">)</span><span class="op" id="7496485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496489">_</span><span class="op" id="7496490">,</span>&nbsp;<span class="ident" id="7496492">_</span><span class="op" id="7496493">,</span>&nbsp;<span class="ident" id="7496495">err</span>&nbsp;<span class="op" id="7496499">:=</span>&nbsp;<span class="ident" id="7496502">Decode</span><span class="op" id="7496508">(</span><span class="ident" id="7496509">dbuf</span><span class="op" id="7496513">,</span>&nbsp;<span class="op" id="7496515">[</span><span class="op" id="7496516">]</span><span class="builtintype" id="7496517">byte</span><span class="op" id="7496521">(</span><span class="ident" id="7496522">e</span><span class="op" id="7496523">.</span><span class="ident" id="7496524">e</span><span class="op" id="7496525">)</span><span class="op" id="7496526">,</span>&nbsp;<span class="builtintype" id="7496528">true</span><span class="op" id="7496532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7496536">switch</span>&nbsp;<span class="ident" id="7496543">err</span>&nbsp;<span class="op" id="7496547">:=</span>&nbsp;<span class="ident" id="7496550">err</span><span class="op" id="7496553">.</span><span class="op" id="7496554">(</span><span class="keyword" id="7496555">type</span><span class="op" id="7496559">)</span>&nbsp;<span class="op" id="7496561">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7496565">case</span>&nbsp;<span class="ident" id="7496570">CorruptInputError</span><span class="op" id="7496587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496592">testEqual</span><span class="op" id="7496601">(</span><span class="ident" id="7496602">t</span><span class="op" id="7496603">,</span>&nbsp;<span class="string" id="7496605">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7496645">,</span>&nbsp;<span class="ident" id="7496647">e</span><span class="op" id="7496648">.</span><span class="ident" id="7496649">e</span><span class="op" id="7496650">,</span>&nbsp;<span class="builtintype" id="7496652">int</span><span class="op" id="7496655">(</span><span class="ident" id="7496656">err</span><span class="op" id="7496659">)</span><span class="op" id="7496660">,</span>&nbsp;<span class="ident" id="7496662">e</span><span class="op" id="7496663">.</span><span class="ident" id="7496664">p</span><span class="op" id="7496665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7496669">default</span><span class="op" id="7496676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496681">t</span><span class="op" id="7496682">.</span><span class="ident" id="7496683">Error</span><span class="op" id="7496688">(</span><span class="string" id="7496689">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="7496729">,</span>&nbsp;<span class="ident" id="7496731">e</span><span class="op" id="7496732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7496736">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7496739">}</span><br>
<span class="lineno"></span><span class="op" id="7496741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7496744">func</span>&nbsp;<span class="ident" id="7496749">TestBig</span><span class="op" id="7496756">(</span><span class="ident" id="7496757">t</span>&nbsp;<span class="op" id="7496759">*</span><span class="ident" id="7496760">testing</span><span class="op" id="7496767">.</span><span class="ident" id="7496768">T</span><span class="op" id="7496769">)</span>&nbsp;<span class="op" id="7496771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496774">n</span>&nbsp;<span class="op" id="7496776">:=</span>&nbsp;<span class="num" id="7496779">3</span><span class="op" id="7496780">*</span><span class="num" id="7496781">1000</span>&nbsp;<span class="op" id="7496786">+</span>&nbsp;<span class="num" id="7496788">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496791">raw</span>&nbsp;<span class="op" id="7496795">:=</span>&nbsp;<span class="builtinfunc" id="7496798">make</span><span class="op" id="7496802">(</span><span class="op" id="7496803">[</span><span class="op" id="7496804">]</span><span class="builtintype" id="7496805">byte</span><span class="op" id="7496809">,</span>&nbsp;<span class="ident" id="7496811">n</span><span class="op" id="7496812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7496815">const</span>&nbsp;<span class="ident" id="7496821">alpha</span>&nbsp;<span class="op" id="7496827">=</span>&nbsp;<span class="string" id="7496829">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7496895">for</span>&nbsp;<span class="ident" id="7496899">i</span>&nbsp;<span class="op" id="7496901">:=</span>&nbsp;<span class="num" id="7496904">0</span><span class="op" id="7496905">;</span>&nbsp;<span class="ident" id="7496907">i</span>&nbsp;<span class="op" id="7496909">&lt;</span>&nbsp;<span class="ident" id="7496911">n</span><span class="op" id="7496912">;</span>&nbsp;<span class="ident" id="7496914">i</span><span class="op" id="7496915">++</span>&nbsp;<span class="op" id="7496918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496922">raw</span><span class="op" id="7496925">[</span><span class="ident" id="7496926">i</span><span class="op" id="7496927">]</span>&nbsp;<span class="op" id="7496929">=</span>&nbsp;<span class="ident" id="7496931">alpha</span><span class="op" id="7496936">[</span><span class="ident" id="7496937">i</span><span class="op" id="7496938">%</span><span class="builtinfunc" id="7496939">len</span><span class="op" id="7496942">(</span><span class="ident" id="7496943">alpha</span><span class="op" id="7496948">)</span><span class="op" id="7496949">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7496952">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496955">encoded</span>&nbsp;<span class="op" id="7496963">:=</span>&nbsp;<span class="builtinfunc" id="7496966">new</span><span class="op" id="7496969">(</span><span class="ident" id="7496970">bytes</span><span class="op" id="7496975">.</span><span class="ident" id="7496976">Buffer</span><span class="op" id="7496982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7496985">w</span>&nbsp;<span class="op" id="7496987">:=</span>&nbsp;<span class="ident" id="7496990">NewEncoder</span><span class="op" id="7497000">(</span><span class="ident" id="7497001">encoded</span><span class="op" id="7497008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7497011">nn</span><span class="op" id="7497013">,</span>&nbsp;<span class="ident" id="7497015">err</span>&nbsp;<span class="op" id="7497019">:=</span>&nbsp;<span class="ident" id="7497022">w</span><span class="op" id="7497023">.</span><span class="ident" id="7497024">Write</span><span class="op" id="7497029">(</span><span class="ident" id="7497030">raw</span><span class="op" id="7497033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7497036">if</span>&nbsp;<span class="ident" id="7497039">nn</span>&nbsp;<span class="op" id="7497042">!=</span>&nbsp;<span class="ident" id="7497045">n</span>&nbsp;<span class="op" id="7497047">||</span>&nbsp;<span class="ident" id="7497050">err</span>&nbsp;<span class="op" id="7497054">!=</span>&nbsp;<span class="builtintype" id="7497057">nil</span>&nbsp;<span class="op" id="7497061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7497065">t</span><span class="op" id="7497066">.</span><span class="ident" id="7497067">Fatalf</span><span class="op" id="7497073">(</span><span class="string" id="7497074">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7497116">,</span>&nbsp;<span class="ident" id="7497118">nn</span><span class="op" id="7497120">,</span>&nbsp;<span class="ident" id="7497122">err</span><span class="op" id="7497125">,</span>&nbsp;<span class="ident" id="7497127">n</span><span class="op" id="7497128">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7497131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7497134">err</span>&nbsp;<span class="op" id="7497138">=</span>&nbsp;<span class="ident" id="7497140">w</span><span class="op" id="7497141">.</span><span class="ident" id="7497142">Close</span><span class="op" id="7497147">(</span><span class="op" id="7497148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7497151">if</span>&nbsp;<span class="ident" id="7497154">err</span>&nbsp;<span class="op" id="7497158">!=</span>&nbsp;<span class="builtintype" id="7497161">nil</span>&nbsp;<span class="op" id="7497165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7497169">t</span><span class="op" id="7497170">.</span><span class="ident" id="7497171">Fatalf</span><span class="op" id="7497177">(</span><span class="string" id="7497178">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7497209">,</span>&nbsp;<span class="ident" id="7497211">err</span><span class="op" id="7497214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7497217">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7497220">decoded</span><span class="op" id="7497227">,</span>&nbsp;<span class="ident" id="7497229">err</span>&nbsp;<span class="op" id="7497233">:=</span>&nbsp;<span class="ident" id="7497236">ioutil</span><span class="op" id="7497242">.</span><span class="ident" id="7497243">ReadAll</span><span class="op" id="7497250">(</span><span class="ident" id="7497251">NewDecoder</span><span class="op" id="7497261">(</span><span class="ident" id="7497262">encoded</span><span class="op" id="7497269">)</span><span class="op" id="7497270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7497273">if</span>&nbsp;<span class="ident" id="7497276">err</span>&nbsp;<span class="op" id="7497280">!=</span>&nbsp;<span class="builtintype" id="7497283">nil</span>&nbsp;<span class="op" id="7497287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7497291">t</span><span class="op" id="7497292">.</span><span class="ident" id="7497293">Fatalf</span><span class="op" id="7497299">(</span><span class="string" id="7497300">&#34;io.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="7497333">,</span>&nbsp;<span class="ident" id="7497335">err</span><span class="op" id="7497338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7497341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7497345">if</span>&nbsp;<span class="op" id="7497348">!</span><span class="ident" id="7497349">bytes</span><span class="op" id="7497354">.</span><span class="ident" id="7497355">Equal</span><span class="op" id="7497360">(</span><span class="ident" id="7497361">raw</span><span class="op" id="7497364">,</span>&nbsp;<span class="ident" id="7497366">decoded</span><span class="op" id="7497373">)</span>&nbsp;<span class="op" id="7497375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7497379">var</span>&nbsp;<span class="ident" id="7497383">i</span>&nbsp;<span class="builtintype" id="7497385">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7497391">for</span>&nbsp;<span class="ident" id="7497395">i</span>&nbsp;<span class="op" id="7497397">=</span>&nbsp;<span class="num" id="7497399">0</span><span class="op" id="7497400">;</span>&nbsp;<span class="ident" id="7497402">i</span>&nbsp;<span class="op" id="7497404">&lt;</span>&nbsp;<span class="builtinfunc" id="7497406">len</span><span class="op" id="7497409">(</span><span class="ident" id="7497410">decoded</span><span class="op" id="7497417">)</span>&nbsp;<span class="op" id="7497419">&amp;&amp;</span>&nbsp;<span class="ident" id="7497422">i</span>&nbsp;<span class="op" id="7497424">&lt;</span>&nbsp;<span class="builtinfunc" id="7497426">len</span><span class="op" id="7497429">(</span><span class="ident" id="7497430">raw</span><span class="op" id="7497433">)</span><span class="op" id="7497434">;</span>&nbsp;<span class="ident" id="7497436">i</span><span class="op" id="7497437">++</span>&nbsp;<span class="op" id="7497440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7497445">if</span>&nbsp;<span class="ident" id="7497448">decoded</span><span class="op" id="7497455">[</span><span class="ident" id="7497456">i</span><span class="op" id="7497457">]</span>&nbsp;<span class="op" id="7497459">!=</span>&nbsp;<span class="ident" id="7497462">raw</span><span class="op" id="7497465">[</span><span class="ident" id="7497466">i</span><span class="op" id="7497467">]</span>&nbsp;<span class="op" id="7497469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7497475">break</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7497484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7497488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7497492">t</span><span class="op" id="7497493">.</span><span class="ident" id="7497494">Errorf</span><span class="op" id="7497500">(</span><span class="string" id="7497501">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="7497553">,</span>&nbsp;<span class="ident" id="7497555">n</span><span class="op" id="7497556">,</span>&nbsp;<span class="ident" id="7497558">i</span><span class="op" id="7497559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7497562">}</span><br>
<span class="lineno"></span><span class="op" id="7497564">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="7497567">func</span>&nbsp;<span class="ident" id="7497572">TestDecoderInternalWhitespace</span><span class="op" id="7497601">(</span><span class="ident" id="7497602">t</span>&nbsp;<span class="op" id="7497604">*</span><span class="ident" id="7497605">testing</span><span class="op" id="7497612">.</span><span class="ident" id="7497613">T</span><span class="op" id="7497614">)</span>&nbsp;<span class="op" id="7497616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7497619">s</span>&nbsp;<span class="op" id="7497621">:=</span>&nbsp;<span class="ident" id="7497624">strings</span><span class="op" id="7497631">.</span><span class="ident" id="7497632">Repeat</span><span class="op" id="7497638">(</span><span class="string" id="7497639">&#34;&nbsp;&#34;</span><span class="op" id="7497642">,</span>&nbsp;<span class="num" id="7497644">2048</span><span class="op" id="7497648">)</span>&nbsp;<span class="op" id="7497650">+</span>&nbsp;<span class="string" id="7497652">&#34;z&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7497657">decoded</span><span class="op" id="7497664">,</span>&nbsp;<span class="ident" id="7497666">err</span>&nbsp;<span class="op" id="7497670">:=</span>&nbsp;<span class="ident" id="7497673">ioutil</span><span class="op" id="7497679">.</span><span class="ident" id="7497680">ReadAll</span><span class="op" id="7497687">(</span><span class="ident" id="7497688">NewDecoder</span><span class="op" id="7497698">(</span><span class="ident" id="7497699">strings</span><span class="op" id="7497706">.</span><span class="ident" id="7497707">NewReader</span><span class="op" id="7497716">(</span><span class="ident" id="7497717">s</span><span class="op" id="7497718">)</span><span class="op" id="7497719">)</span><span class="op" id="7497720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7497723">if</span>&nbsp;<span class="ident" id="7497726">err</span>&nbsp;<span class="op" id="7497730">!=</span>&nbsp;<span class="builtintype" id="7497733">nil</span>&nbsp;<span class="op" id="7497737">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7497741">t</span><span class="op" id="7497742">.</span><span class="ident" id="7497743">Errorf</span><span class="op" id="7497749">(</span><span class="string" id="7497750">&#34;Decode&nbsp;gave&nbsp;error&nbsp;%v&#34;</span><span class="op" id="7497772">,</span>&nbsp;<span class="ident" id="7497774">err</span><span class="op" id="7497777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7497780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7497783">if</span>&nbsp;<span class="ident" id="7497786">want</span>&nbsp;<span class="op" id="7497791">:=</span>&nbsp;<span class="op" id="7497794">[</span><span class="op" id="7497795">]</span><span class="builtintype" id="7497796">byte</span><span class="op" id="7497800">(</span><span class="string" id="7497801">&#34;\000\000\000\000&#34;</span><span class="op" id="7497819">)</span><span class="op" id="7497820">;</span>&nbsp;<span class="op" id="7497822">!</span><span class="ident" id="7497823">bytes</span><span class="op" id="7497828">.</span><span class="ident" id="7497829">Equal</span><span class="op" id="7497834">(</span><span class="ident" id="7497835">want</span><span class="op" id="7497839">,</span>&nbsp;<span class="ident" id="7497841">decoded</span><span class="op" id="7497848">)</span>&nbsp;<span class="op" id="7497850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7497854">t</span><span class="op" id="7497855">.</span><span class="ident" id="7497856">Errorf</span><span class="op" id="7497862">(</span><span class="string" id="7497863">&#34;Decode&nbsp;failed:&nbsp;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7497895">,</span>&nbsp;<span class="ident" id="7497897">decoded</span><span class="op" id="7497904">,</span>&nbsp;<span class="ident" id="7497906">want</span><span class="op" id="7497910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7497913">}</span><br>
<span class="lineno">210</span><span class="op" id="7497915">}</span>
</div>
</body>
</html>
