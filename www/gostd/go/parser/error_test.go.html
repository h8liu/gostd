<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html" class="current">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8290197">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8290252">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8290306">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8290357">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;parser&nbsp;test&nbsp;harness.&nbsp;The&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata</span><br>
<span class="lineno"></span><span class="comment" id="8290430">//&nbsp;directory&nbsp;are&nbsp;parsed&nbsp;and&nbsp;the&nbsp;errors&nbsp;reported&nbsp;are&nbsp;compared&nbsp;against&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8290503">//&nbsp;error&nbsp;messages&nbsp;expected&nbsp;in&nbsp;the&nbsp;test&nbsp;files.&nbsp;The&nbsp;test&nbsp;files&nbsp;must&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8290576">//&nbsp;.src&nbsp;rather&nbsp;than&nbsp;.go&nbsp;so&nbsp;that&nbsp;they&nbsp;are&nbsp;not&nbsp;disturbed&nbsp;by&nbsp;gofmt&nbsp;runs.</span><br>
<span class="lineno"></span><span class="comment" id="8290646">//</span><br>
<span class="lineno">10</span><span class="comment" id="8290649">//&nbsp;Expected&nbsp;errors&nbsp;are&nbsp;indicated&nbsp;in&nbsp;the&nbsp;test&nbsp;files&nbsp;by&nbsp;putting&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="8290721">//&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;immediately&nbsp;following&nbsp;an&nbsp;offending&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="8290795">//&nbsp;The&nbsp;harness&nbsp;will&nbsp;verify&nbsp;that&nbsp;an&nbsp;error&nbsp;matching&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="8290868">//&nbsp;rx&nbsp;is&nbsp;reported&nbsp;at&nbsp;that&nbsp;source&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="8290911">//</span><br>
<span class="lineno">15</span><span class="comment" id="8290914">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;following&nbsp;test&nbsp;file&nbsp;indicates&nbsp;that&nbsp;a&nbsp;&#34;not&nbsp;declared&#34;</span><br>
<span class="lineno"></span><span class="comment" id="8290987">//&nbsp;error&nbsp;should&nbsp;be&nbsp;reported&nbsp;for&nbsp;the&nbsp;undeclared&nbsp;variable&nbsp;x:</span><br>
<span class="lineno"></span><span class="comment" id="8291046">//</span><br>
<span class="lineno"></span><span class="comment" id="8291049">//&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="8291062">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;f()&nbsp;{</span><br>
<span class="lineno">20</span><span class="comment" id="8291076">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp_&nbsp;=&nbsp;x&nbsp;/*&nbsp;ERROR&nbsp;&#34;not&nbsp;declared&#34;&nbsp;*/&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="8291117">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8291123">package</span>&nbsp;<span class="ident" id="8291131">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8291139">import</span>&nbsp;<span class="op" id="8291146">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8291149">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8291163">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8291175">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8291188">&#34;path/filepath&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8291205">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8291215">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8291226">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8291236">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="8291239">const</span>&nbsp;<span class="ident" id="8291245">testdata</span>&nbsp;<span class="op" id="8291254">=</span>&nbsp;<span class="string" id="8291256">&#34;testdata&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8291268">var</span>&nbsp;<span class="ident" id="8291272">fsetErrs</span>&nbsp;<span class="op" id="8291281">=</span>&nbsp;<span class="ident" id="8291283">token</span><span class="op" id="8291288">.</span><span class="ident" id="8291289">NewFileSet</span><span class="op" id="8291299">(</span><span class="op" id="8291300">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8291303">//&nbsp;getFile&nbsp;assumes&nbsp;that&nbsp;each&nbsp;filename&nbsp;occurs&nbsp;at&nbsp;most&nbsp;once</span><br>
<span class="lineno">40</span><span class="keyword" id="8291361">func</span>&nbsp;<span class="ident" id="8291366">getFile</span><span class="op" id="8291373">(</span><span class="ident" id="8291374">filename</span>&nbsp;<span class="builtintype" id="8291383">string</span><span class="op" id="8291389">)</span>&nbsp;<span class="op" id="8291391">(</span><span class="ident" id="8291392">file</span>&nbsp;<span class="op" id="8291397">*</span><span class="ident" id="8291398">token</span><span class="op" id="8291403">.</span><span class="ident" id="8291404">File</span><span class="op" id="8291408">)</span>&nbsp;<span class="op" id="8291410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291413">fsetErrs</span><span class="op" id="8291421">.</span><span class="ident" id="8291422">Iterate</span><span class="op" id="8291429">(</span><span class="keyword" id="8291430">func</span><span class="op" id="8291434">(</span><span class="ident" id="8291435">f</span>&nbsp;<span class="op" id="8291437">*</span><span class="ident" id="8291438">token</span><span class="op" id="8291443">.</span><span class="ident" id="8291444">File</span><span class="op" id="8291448">)</span>&nbsp;<span class="builtintype" id="8291450">bool</span>&nbsp;<span class="op" id="8291455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291459">if</span>&nbsp;<span class="ident" id="8291462">f</span><span class="op" id="8291463">.</span><span class="ident" id="8291464">Name</span><span class="op" id="8291468">(</span><span class="op" id="8291469">)</span>&nbsp;<span class="op" id="8291471">==</span>&nbsp;<span class="ident" id="8291474">filename</span>&nbsp;<span class="op" id="8291483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291488">if</span>&nbsp;<span class="ident" id="8291491">file</span>&nbsp;<span class="op" id="8291496">!=</span>&nbsp;<span class="ident" id="8291499">nil</span>&nbsp;<span class="op" id="8291503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8291509">panic</span><span class="op" id="8291514">(</span><span class="ident" id="8291515">filename</span>&nbsp;<span class="op" id="8291524">+</span>&nbsp;<span class="string" id="8291526">&#34;&nbsp;used&nbsp;multiple&nbsp;times&#34;</span><span class="op" id="8291548">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291558">file</span>&nbsp;<span class="op" id="8291563">=</span>&nbsp;<span class="ident" id="8291565">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291573">return</span>&nbsp;<span class="builtintype" id="8291580">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291586">}</span><span class="op" id="8291587">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291590">return</span>&nbsp;<span class="ident" id="8291597">file</span><br>
<span class="lineno"></span><span class="op" id="8291602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8291605">func</span>&nbsp;<span class="ident" id="8291610">getPos</span><span class="op" id="8291616">(</span><span class="ident" id="8291617">filename</span>&nbsp;<span class="builtintype" id="8291626">string</span><span class="op" id="8291632">,</span>&nbsp;<span class="ident" id="8291634">offset</span>&nbsp;<span class="builtintype" id="8291641">int</span><span class="op" id="8291644">)</span>&nbsp;<span class="ident" id="8291646">token</span><span class="op" id="8291651">.</span><span class="ident" id="8291652">Pos</span>&nbsp;<span class="op" id="8291656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291659">if</span>&nbsp;<span class="ident" id="8291662">f</span>&nbsp;<span class="op" id="8291664">:=</span>&nbsp;<span class="ident" id="8291667">getFile</span><span class="op" id="8291674">(</span><span class="ident" id="8291675">filename</span><span class="op" id="8291683">)</span><span class="op" id="8291684">;</span>&nbsp;<span class="ident" id="8291686">f</span>&nbsp;<span class="op" id="8291688">!=</span>&nbsp;<span class="ident" id="8291691">nil</span>&nbsp;<span class="op" id="8291695">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291699">return</span>&nbsp;<span class="ident" id="8291706">f</span><span class="op" id="8291707">.</span><span class="ident" id="8291708">Pos</span><span class="op" id="8291711">(</span><span class="ident" id="8291712">offset</span><span class="op" id="8291718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291724">return</span>&nbsp;<span class="ident" id="8291731">token</span><span class="op" id="8291736">.</span><span class="ident" id="8291737">NoPos</span><br>
<span class="lineno"></span><span class="op" id="8291743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="8291746">//&nbsp;ERROR&nbsp;comments&nbsp;must&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;and&nbsp;rx&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="8291811">//&nbsp;a&nbsp;regular&nbsp;expression&nbsp;that&nbsp;matches&nbsp;the&nbsp;expected&nbsp;error&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="8291876">//&nbsp;The&nbsp;special&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;HERE&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;must&nbsp;be&nbsp;used&nbsp;for&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="8291941">//&nbsp;messages&nbsp;that&nbsp;appear&nbsp;immediately&nbsp;after&nbsp;a&nbsp;token,&nbsp;rather&nbsp;than&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="8292007">//&nbsp;a&nbsp;token&#39;s&nbsp;position.</span><br>
<span class="lineno">65</span><span class="comment" id="8292030">//</span><br>
<span class="lineno"></span><span class="keyword" id="8292033">var</span>&nbsp;<span class="ident" id="8292037">errRx</span>&nbsp;<span class="op" id="8292043">=</span>&nbsp;<span class="ident" id="8292045">regexp</span><span class="op" id="8292051">.</span><span class="ident" id="8292052">MustCompile</span><span class="op" id="8292063">(</span><span class="string" id="8292064">`^/\*&nbsp;*ERROR&nbsp;*(HERE)?&nbsp;*&#34;([^&#34;]*)&#34;&nbsp;*\*/$`</span><span class="op" id="8292103">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8292106">//&nbsp;expectedErrors&nbsp;collects&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;of&nbsp;ERROR&nbsp;comments&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="8292181">//&nbsp;in&nbsp;files&nbsp;and&nbsp;returns&nbsp;them&nbsp;as&nbsp;a&nbsp;map&nbsp;of&nbsp;error&nbsp;positions&nbsp;to&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">70</span><span class="comment" id="8292257">//</span><br>
<span class="lineno"></span><span class="keyword" id="8292260">func</span>&nbsp;<span class="ident" id="8292265">expectedErrors</span><span class="op" id="8292279">(</span><span class="ident" id="8292280">t</span>&nbsp;<span class="op" id="8292282">*</span><span class="ident" id="8292283">testing</span><span class="op" id="8292290">.</span><span class="ident" id="8292291">T</span><span class="op" id="8292292">,</span>&nbsp;<span class="ident" id="8292294">filename</span>&nbsp;<span class="builtintype" id="8292303">string</span><span class="op" id="8292309">,</span>&nbsp;<span class="ident" id="8292311">src</span>&nbsp;<span class="op" id="8292315">[</span><span class="op" id="8292316">]</span><span class="builtintype" id="8292317">byte</span><span class="op" id="8292321">)</span>&nbsp;<span class="keyword" id="8292323">map</span><span class="op" id="8292326">[</span><span class="ident" id="8292327">token</span><span class="op" id="8292332">.</span><span class="ident" id="8292333">Pos</span><span class="op" id="8292336">]</span><span class="builtintype" id="8292337">string</span>&nbsp;<span class="op" id="8292344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292347">errors</span>&nbsp;<span class="op" id="8292354">:=</span>&nbsp;<span class="builtinfunc" id="8292357">make</span><span class="op" id="8292361">(</span><span class="keyword" id="8292362">map</span><span class="op" id="8292365">[</span><span class="ident" id="8292366">token</span><span class="op" id="8292371">.</span><span class="ident" id="8292372">Pos</span><span class="op" id="8292375">]</span><span class="builtintype" id="8292376">string</span><span class="op" id="8292382">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292386">var</span>&nbsp;<span class="ident" id="8292390">s</span>&nbsp;<span class="ident" id="8292392">scanner</span><span class="op" id="8292399">.</span><span class="ident" id="8292400">Scanner</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8292409">//&nbsp;file&nbsp;was&nbsp;parsed&nbsp;already&nbsp;-&nbsp;do&nbsp;not&nbsp;add&nbsp;it&nbsp;again&nbsp;to&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8292471">//&nbsp;set&nbsp;otherwise&nbsp;the&nbsp;position&nbsp;information&nbsp;returned&nbsp;here&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8292533">//&nbsp;not&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;collected&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292596">s</span><span class="op" id="8292597">.</span><span class="ident" id="8292598">Init</span><span class="op" id="8292602">(</span><span class="ident" id="8292603">getFile</span><span class="op" id="8292610">(</span><span class="ident" id="8292611">filename</span><span class="op" id="8292619">)</span><span class="op" id="8292620">,</span>&nbsp;<span class="ident" id="8292622">src</span><span class="op" id="8292625">,</span>&nbsp;<span class="ident" id="8292627">nil</span><span class="op" id="8292630">,</span>&nbsp;<span class="ident" id="8292632">scanner</span><span class="op" id="8292639">.</span><span class="ident" id="8292640">ScanComments</span><span class="op" id="8292652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292655">var</span>&nbsp;<span class="ident" id="8292659">prev</span>&nbsp;<span class="ident" id="8292664">token</span><span class="op" id="8292669">.</span><span class="ident" id="8292670">Pos</span>&nbsp;<span class="comment" id="8292674">//&nbsp;position&nbsp;of&nbsp;last&nbsp;non-comment,&nbsp;non-semicolon&nbsp;token</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292728">var</span>&nbsp;<span class="ident" id="8292732">here</span>&nbsp;<span class="ident" id="8292737">token</span><span class="op" id="8292742">.</span><span class="ident" id="8292743">Pos</span>&nbsp;<span class="comment" id="8292747">//&nbsp;position&nbsp;immediately&nbsp;after&nbsp;the&nbsp;token&nbsp;at&nbsp;position&nbsp;prev</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292806">for</span>&nbsp;<span class="op" id="8292810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292814">pos</span><span class="op" id="8292817">,</span>&nbsp;<span class="ident" id="8292819">tok</span><span class="op" id="8292822">,</span>&nbsp;<span class="ident" id="8292824">lit</span>&nbsp;<span class="op" id="8292828">:=</span>&nbsp;<span class="ident" id="8292831">s</span><span class="op" id="8292832">.</span><span class="ident" id="8292833">Scan</span><span class="op" id="8292837">(</span><span class="op" id="8292838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292842">switch</span>&nbsp;<span class="ident" id="8292849">tok</span>&nbsp;<span class="op" id="8292853">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292857">case</span>&nbsp;<span class="ident" id="8292862">token</span><span class="op" id="8292867">.</span><span class="ident" id="8292868">EOF</span><span class="op" id="8292871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292876">return</span>&nbsp;<span class="ident" id="8292883">errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292892">case</span>&nbsp;<span class="ident" id="8292897">token</span><span class="op" id="8292902">.</span><span class="ident" id="8292903">COMMENT</span><span class="op" id="8292910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292915">s</span>&nbsp;<span class="op" id="8292917">:=</span>&nbsp;<span class="ident" id="8292920">errRx</span><span class="op" id="8292925">.</span><span class="ident" id="8292926">FindStringSubmatch</span><span class="op" id="8292944">(</span><span class="ident" id="8292945">lit</span><span class="op" id="8292948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292953">if</span>&nbsp;<span class="builtinfunc" id="8292956">len</span><span class="op" id="8292959">(</span><span class="ident" id="8292960">s</span><span class="op" id="8292961">)</span>&nbsp;<span class="op" id="8292963">==</span>&nbsp;<span class="num" id="8292966">3</span>&nbsp;<span class="op" id="8292968">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292974">pos</span>&nbsp;<span class="op" id="8292978">:=</span>&nbsp;<span class="ident" id="8292981">prev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292990">if</span>&nbsp;<span class="ident" id="8292993">s</span><span class="op" id="8292994">[</span><span class="num" id="8292995">1</span><span class="op" id="8292996">]</span>&nbsp;<span class="op" id="8292998">==</span>&nbsp;<span class="string" id="8293001">&#34;HERE&#34;</span>&nbsp;<span class="op" id="8293008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293015">pos</span>&nbsp;<span class="op" id="8293019">=</span>&nbsp;<span class="ident" id="8293021">here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293036">errors</span><span class="op" id="8293042">[</span><span class="ident" id="8293043">pos</span><span class="op" id="8293046">]</span>&nbsp;<span class="op" id="8293048">=</span>&nbsp;<span class="builtintype" id="8293050">string</span><span class="op" id="8293056">(</span><span class="ident" id="8293057">s</span><span class="op" id="8293058">[</span><span class="num" id="8293059">2</span><span class="op" id="8293060">]</span><span class="op" id="8293061">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293070">default</span><span class="op" id="8293077">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293082">prev</span>&nbsp;<span class="op" id="8293087">=</span>&nbsp;<span class="ident" id="8293089">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293096">var</span>&nbsp;<span class="ident" id="8293100">l</span>&nbsp;<span class="builtintype" id="8293102">int</span>&nbsp;<span class="comment" id="8293106">//&nbsp;token&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293125">if</span>&nbsp;<span class="ident" id="8293128">tok</span><span class="op" id="8293131">.</span><span class="ident" id="8293132">IsLiteral</span><span class="op" id="8293141">(</span><span class="op" id="8293142">)</span>&nbsp;<span class="op" id="8293144">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293150">l</span>&nbsp;<span class="op" id="8293152">=</span>&nbsp;<span class="builtinfunc" id="8293154">len</span><span class="op" id="8293157">(</span><span class="ident" id="8293158">lit</span><span class="op" id="8293161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293166">}</span>&nbsp;<span class="keyword" id="8293168">else</span>&nbsp;<span class="op" id="8293173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293179">l</span>&nbsp;<span class="op" id="8293181">=</span>&nbsp;<span class="builtinfunc" id="8293183">len</span><span class="op" id="8293186">(</span><span class="ident" id="8293187">tok</span><span class="op" id="8293190">.</span><span class="ident" id="8293191">String</span><span class="op" id="8293197">(</span><span class="op" id="8293198">)</span><span class="op" id="8293199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293209">here</span>&nbsp;<span class="op" id="8293214">=</span>&nbsp;<span class="ident" id="8293216">prev</span>&nbsp;<span class="op" id="8293221">+</span>&nbsp;<span class="ident" id="8293223">token</span><span class="op" id="8293228">.</span><span class="ident" id="8293229">Pos</span><span class="op" id="8293232">(</span><span class="ident" id="8293233">l</span><span class="op" id="8293234">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293241">}</span><br>
<span class="lineno"></span><span class="op" id="8293243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8293246">//&nbsp;compareErrors&nbsp;compares&nbsp;the&nbsp;map&nbsp;of&nbsp;expected&nbsp;error&nbsp;messages&nbsp;with&nbsp;the&nbsp;list</span><br>
<span class="lineno">110</span><span class="comment" id="8293321">//&nbsp;of&nbsp;found&nbsp;errors&nbsp;and&nbsp;reports&nbsp;discrepancies.</span><br>
<span class="lineno"></span><span class="comment" id="8293367">//</span><br>
<span class="lineno"></span><span class="keyword" id="8293370">func</span>&nbsp;<span class="ident" id="8293375">compareErrors</span><span class="op" id="8293388">(</span><span class="ident" id="8293389">t</span>&nbsp;<span class="op" id="8293391">*</span><span class="ident" id="8293392">testing</span><span class="op" id="8293399">.</span><span class="ident" id="8293400">T</span><span class="op" id="8293401">,</span>&nbsp;<span class="ident" id="8293403">expected</span>&nbsp;<span class="keyword" id="8293412">map</span><span class="op" id="8293415">[</span><span class="ident" id="8293416">token</span><span class="op" id="8293421">.</span><span class="ident" id="8293422">Pos</span><span class="op" id="8293425">]</span><span class="builtintype" id="8293426">string</span><span class="op" id="8293432">,</span>&nbsp;<span class="ident" id="8293434">found</span>&nbsp;<span class="ident" id="8293440">scanner</span><span class="op" id="8293447">.</span><span class="ident" id="8293448">ErrorList</span><span class="op" id="8293457">)</span>&nbsp;<span class="op" id="8293459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293462">for</span>&nbsp;<span class="ident" id="8293466">_</span><span class="op" id="8293467">,</span>&nbsp;<span class="builtintype" id="8293469">error</span>&nbsp;<span class="op" id="8293475">:=</span>&nbsp;<span class="keyword" id="8293478">range</span>&nbsp;<span class="ident" id="8293484">found</span>&nbsp;<span class="op" id="8293490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8293494">//&nbsp;error.Pos&nbsp;is&nbsp;a&nbsp;token.Position,&nbsp;but&nbsp;we&nbsp;want</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8293542">//&nbsp;a&nbsp;token.Pos&nbsp;so&nbsp;we&nbsp;can&nbsp;do&nbsp;a&nbsp;map&nbsp;lookup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293585">pos</span>&nbsp;<span class="op" id="8293589">:=</span>&nbsp;<span class="ident" id="8293592">getPos</span><span class="op" id="8293598">(</span><span class="builtintype" id="8293599">error</span><span class="op" id="8293604">.</span><span class="ident" id="8293605">Pos</span><span class="op" id="8293608">.</span><span class="ident" id="8293609">Filename</span><span class="op" id="8293617">,</span>&nbsp;<span class="builtintype" id="8293619">error</span><span class="op" id="8293624">.</span><span class="ident" id="8293625">Pos</span><span class="op" id="8293628">.</span><span class="ident" id="8293629">Offset</span><span class="op" id="8293635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293639">if</span>&nbsp;<span class="ident" id="8293642">msg</span><span class="op" id="8293645">,</span>&nbsp;<span class="ident" id="8293647">found</span>&nbsp;<span class="op" id="8293653">:=</span>&nbsp;<span class="ident" id="8293656">expected</span><span class="op" id="8293664">[</span><span class="ident" id="8293665">pos</span><span class="op" id="8293668">]</span><span class="op" id="8293669">;</span>&nbsp;<span class="ident" id="8293671">found</span>&nbsp;<span class="op" id="8293677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8293682">//&nbsp;we&nbsp;expect&nbsp;a&nbsp;message&nbsp;at&nbsp;pos;&nbsp;check&nbsp;if&nbsp;it&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293736">rx</span><span class="op" id="8293738">,</span>&nbsp;<span class="ident" id="8293740">err</span>&nbsp;<span class="op" id="8293744">:=</span>&nbsp;<span class="ident" id="8293747">regexp</span><span class="op" id="8293753">.</span><span class="ident" id="8293754">Compile</span><span class="op" id="8293761">(</span><span class="ident" id="8293762">msg</span><span class="op" id="8293765">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293770">if</span>&nbsp;<span class="ident" id="8293773">err</span>&nbsp;<span class="op" id="8293777">!=</span>&nbsp;<span class="ident" id="8293780">nil</span>&nbsp;<span class="op" id="8293784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293790">t</span><span class="op" id="8293791">.</span><span class="ident" id="8293792">Errorf</span><span class="op" id="8293798">(</span><span class="string" id="8293799">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8293807">,</span>&nbsp;<span class="builtintype" id="8293809">error</span><span class="op" id="8293814">.</span><span class="ident" id="8293815">Pos</span><span class="op" id="8293818">,</span>&nbsp;<span class="ident" id="8293820">err</span><span class="op" id="8293823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293829">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293846">if</span>&nbsp;<span class="ident" id="8293849">match</span>&nbsp;<span class="op" id="8293855">:=</span>&nbsp;<span class="ident" id="8293858">rx</span><span class="op" id="8293860">.</span><span class="ident" id="8293861">MatchString</span><span class="op" id="8293872">(</span><span class="builtintype" id="8293873">error</span><span class="op" id="8293878">.</span><span class="ident" id="8293879">Msg</span><span class="op" id="8293882">)</span><span class="op" id="8293883">;</span>&nbsp;<span class="op" id="8293885">!</span><span class="ident" id="8293886">match</span>&nbsp;<span class="op" id="8293892">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293898">t</span><span class="op" id="8293899">.</span><span class="ident" id="8293900">Errorf</span><span class="op" id="8293906">(</span><span class="string" id="8293907">&#34;%s:&nbsp;%q&nbsp;does&nbsp;not&nbsp;match&nbsp;%q&#34;</span><span class="op" id="8293933">,</span>&nbsp;<span class="builtintype" id="8293935">error</span><span class="op" id="8293940">.</span><span class="ident" id="8293941">Pos</span><span class="op" id="8293944">,</span>&nbsp;<span class="builtintype" id="8293946">error</span><span class="op" id="8293951">.</span><span class="ident" id="8293952">Msg</span><span class="op" id="8293955">,</span>&nbsp;<span class="ident" id="8293957">msg</span><span class="op" id="8293960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293966">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8293983">//&nbsp;we&nbsp;have&nbsp;a&nbsp;match&nbsp;-&nbsp;eliminate&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8294028">delete</span><span class="op" id="8294034">(</span><span class="ident" id="8294035">expected</span><span class="op" id="8294043">,</span>&nbsp;<span class="ident" id="8294045">pos</span><span class="op" id="8294048">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294052">}</span>&nbsp;<span class="keyword" id="8294054">else</span>&nbsp;<span class="op" id="8294059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8294064">//&nbsp;To&nbsp;keep&nbsp;in&nbsp;mind&nbsp;when&nbsp;analyzing&nbsp;failed&nbsp;test&nbsp;output:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8294121">//&nbsp;If&nbsp;the&nbsp;same&nbsp;error&nbsp;position&nbsp;occurs&nbsp;multiple&nbsp;times&nbsp;in&nbsp;errors,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8294187">//&nbsp;this&nbsp;message&nbsp;will&nbsp;be&nbsp;triggered&nbsp;(because&nbsp;the&nbsp;first&nbsp;error&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8294252">//&nbsp;the&nbsp;position&nbsp;removes&nbsp;this&nbsp;position&nbsp;from&nbsp;the&nbsp;expected&nbsp;errors).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294320">t</span><span class="op" id="8294321">.</span><span class="ident" id="8294322">Errorf</span><span class="op" id="8294328">(</span><span class="string" id="8294329">&#34;%s:&nbsp;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8294355">,</span>&nbsp;<span class="builtintype" id="8294357">error</span><span class="op" id="8294362">.</span><span class="ident" id="8294363">Pos</span><span class="op" id="8294366">,</span>&nbsp;<span class="builtintype" id="8294368">error</span><span class="op" id="8294373">.</span><span class="ident" id="8294374">Msg</span><span class="op" id="8294377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8294388">//&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;expected&nbsp;errors&nbsp;left</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294432">if</span>&nbsp;<span class="builtinfunc" id="8294435">len</span><span class="op" id="8294438">(</span><span class="ident" id="8294439">expected</span><span class="op" id="8294447">)</span>&nbsp;<span class="op" id="8294449">&gt;</span>&nbsp;<span class="num" id="8294451">0</span>&nbsp;<span class="op" id="8294453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294457">t</span><span class="op" id="8294458">.</span><span class="ident" id="8294459">Errorf</span><span class="op" id="8294465">(</span><span class="string" id="8294466">&#34;%d&nbsp;errors&nbsp;not&nbsp;reported:&#34;</span><span class="op" id="8294491">,</span>&nbsp;<span class="builtinfunc" id="8294493">len</span><span class="op" id="8294496">(</span><span class="ident" id="8294497">expected</span><span class="op" id="8294505">)</span><span class="op" id="8294506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294510">for</span>&nbsp;<span class="ident" id="8294514">pos</span><span class="op" id="8294517">,</span>&nbsp;<span class="ident" id="8294519">msg</span>&nbsp;<span class="op" id="8294523">:=</span>&nbsp;<span class="keyword" id="8294526">range</span>&nbsp;<span class="ident" id="8294532">expected</span>&nbsp;<span class="op" id="8294541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294546">t</span><span class="op" id="8294547">.</span><span class="ident" id="8294548">Errorf</span><span class="op" id="8294554">(</span><span class="string" id="8294555">&#34;%s:&nbsp;%s\n&#34;</span><span class="op" id="8294565">,</span>&nbsp;<span class="ident" id="8294567">fsetErrs</span><span class="op" id="8294575">.</span><span class="ident" id="8294576">Position</span><span class="op" id="8294584">(</span><span class="ident" id="8294585">pos</span><span class="op" id="8294588">)</span><span class="op" id="8294589">,</span>&nbsp;<span class="ident" id="8294591">msg</span><span class="op" id="8294594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294598">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294601">}</span><br>
<span class="lineno"></span><span class="op" id="8294603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8294606">func</span>&nbsp;<span class="ident" id="8294611">checkErrors</span><span class="op" id="8294622">(</span><span class="ident" id="8294623">t</span>&nbsp;<span class="op" id="8294625">*</span><span class="ident" id="8294626">testing</span><span class="op" id="8294633">.</span><span class="ident" id="8294634">T</span><span class="op" id="8294635">,</span>&nbsp;<span class="ident" id="8294637">filename</span>&nbsp;<span class="builtintype" id="8294646">string</span><span class="op" id="8294652">,</span>&nbsp;<span class="ident" id="8294654">input</span>&nbsp;<span class="keyword" id="8294660">interface</span><span class="op" id="8294669">{</span><span class="op" id="8294670">}</span><span class="op" id="8294671">)</span>&nbsp;<span class="op" id="8294673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294676">src</span><span class="op" id="8294679">,</span>&nbsp;<span class="ident" id="8294681">err</span>&nbsp;<span class="op" id="8294685">:=</span>&nbsp;<span class="ident" id="8294688">readSource</span><span class="op" id="8294698">(</span><span class="ident" id="8294699">filename</span><span class="op" id="8294707">,</span>&nbsp;<span class="ident" id="8294709">input</span><span class="op" id="8294714">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294717">if</span>&nbsp;<span class="ident" id="8294720">err</span>&nbsp;<span class="op" id="8294724">!=</span>&nbsp;<span class="ident" id="8294727">nil</span>&nbsp;<span class="op" id="8294731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294735">t</span><span class="op" id="8294736">.</span><span class="ident" id="8294737">Error</span><span class="op" id="8294742">(</span><span class="ident" id="8294743">err</span><span class="op" id="8294746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294750">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294762">_</span><span class="op" id="8294763">,</span>&nbsp;<span class="ident" id="8294765">err</span>&nbsp;<span class="op" id="8294769">=</span>&nbsp;<span class="ident" id="8294771">ParseFile</span><span class="op" id="8294780">(</span><span class="ident" id="8294781">fsetErrs</span><span class="op" id="8294789">,</span>&nbsp;<span class="ident" id="8294791">filename</span><span class="op" id="8294799">,</span>&nbsp;<span class="ident" id="8294801">src</span><span class="op" id="8294804">,</span>&nbsp;<span class="ident" id="8294806">DeclarationErrors</span><span class="op" id="8294823">|</span><span class="ident" id="8294824">AllErrors</span><span class="op" id="8294833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294836">found</span><span class="op" id="8294841">,</span>&nbsp;<span class="ident" id="8294843">ok</span>&nbsp;<span class="op" id="8294846">:=</span>&nbsp;<span class="ident" id="8294849">err</span><span class="op" id="8294852">.</span><span class="op" id="8294853">(</span><span class="ident" id="8294854">scanner</span><span class="op" id="8294861">.</span><span class="ident" id="8294862">ErrorList</span><span class="op" id="8294871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294874">if</span>&nbsp;<span class="ident" id="8294877">err</span>&nbsp;<span class="op" id="8294881">!=</span>&nbsp;<span class="ident" id="8294884">nil</span>&nbsp;<span class="op" id="8294888">&amp;&amp;</span>&nbsp;<span class="op" id="8294891">!</span><span class="ident" id="8294892">ok</span>&nbsp;<span class="op" id="8294895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294899">t</span><span class="op" id="8294900">.</span><span class="ident" id="8294901">Error</span><span class="op" id="8294906">(</span><span class="ident" id="8294907">err</span><span class="op" id="8294910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294914">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294925">found</span><span class="op" id="8294930">.</span><span class="ident" id="8294931">RemoveMultiples</span><span class="op" id="8294946">(</span><span class="op" id="8294947">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8294951">//&nbsp;we&nbsp;are&nbsp;expecting&nbsp;the&nbsp;following&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8294993">//&nbsp;(collect&nbsp;these&nbsp;after&nbsp;parsing&nbsp;a&nbsp;file&nbsp;so&nbsp;that&nbsp;it&nbsp;is&nbsp;found&nbsp;in&nbsp;the&nbsp;file&nbsp;set)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295070">expected</span>&nbsp;<span class="op" id="8295079">:=</span>&nbsp;<span class="ident" id="8295082">expectedErrors</span><span class="op" id="8295096">(</span><span class="ident" id="8295097">t</span><span class="op" id="8295098">,</span>&nbsp;<span class="ident" id="8295100">filename</span><span class="op" id="8295108">,</span>&nbsp;<span class="ident" id="8295110">src</span><span class="op" id="8295113">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8295117">//&nbsp;verify&nbsp;errors&nbsp;returned&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295158">compareErrors</span><span class="op" id="8295171">(</span><span class="ident" id="8295172">t</span><span class="op" id="8295173">,</span>&nbsp;<span class="ident" id="8295175">expected</span><span class="op" id="8295183">,</span>&nbsp;<span class="ident" id="8295185">found</span><span class="op" id="8295190">)</span><br>
<span class="lineno"></span><span class="op" id="8295192">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="8295195">func</span>&nbsp;<span class="ident" id="8295200">TestErrors</span><span class="op" id="8295210">(</span><span class="ident" id="8295211">t</span>&nbsp;<span class="op" id="8295213">*</span><span class="ident" id="8295214">testing</span><span class="op" id="8295221">.</span><span class="ident" id="8295222">T</span><span class="op" id="8295223">)</span>&nbsp;<span class="op" id="8295225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295228">list</span><span class="op" id="8295232">,</span>&nbsp;<span class="ident" id="8295234">err</span>&nbsp;<span class="op" id="8295238">:=</span>&nbsp;<span class="ident" id="8295241">ioutil</span><span class="op" id="8295247">.</span><span class="ident" id="8295248">ReadDir</span><span class="op" id="8295255">(</span><span class="ident" id="8295256">testdata</span><span class="op" id="8295264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8295267">if</span>&nbsp;<span class="ident" id="8295270">err</span>&nbsp;<span class="op" id="8295274">!=</span>&nbsp;<span class="ident" id="8295277">nil</span>&nbsp;<span class="op" id="8295281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295285">t</span><span class="op" id="8295286">.</span><span class="ident" id="8295287">Fatal</span><span class="op" id="8295292">(</span><span class="ident" id="8295293">err</span><span class="op" id="8295296">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8295299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8295302">for</span>&nbsp;<span class="ident" id="8295306">_</span><span class="op" id="8295307">,</span>&nbsp;<span class="ident" id="8295309">fi</span>&nbsp;<span class="op" id="8295312">:=</span>&nbsp;<span class="keyword" id="8295315">range</span>&nbsp;<span class="ident" id="8295321">list</span>&nbsp;<span class="op" id="8295326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295330">name</span>&nbsp;<span class="op" id="8295335">:=</span>&nbsp;<span class="ident" id="8295338">fi</span><span class="op" id="8295340">.</span><span class="ident" id="8295341">Name</span><span class="op" id="8295345">(</span><span class="op" id="8295346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8295350">if</span>&nbsp;<span class="op" id="8295353">!</span><span class="ident" id="8295354">fi</span><span class="op" id="8295356">.</span><span class="ident" id="8295357">IsDir</span><span class="op" id="8295362">(</span><span class="op" id="8295363">)</span>&nbsp;<span class="op" id="8295365">&amp;&amp;</span>&nbsp;<span class="op" id="8295368">!</span><span class="ident" id="8295369">strings</span><span class="op" id="8295376">.</span><span class="ident" id="8295377">HasPrefix</span><span class="op" id="8295386">(</span><span class="ident" id="8295387">name</span><span class="op" id="8295391">,</span>&nbsp;<span class="string" id="8295393">&#34;.&#34;</span><span class="op" id="8295396">)</span>&nbsp;<span class="op" id="8295398">&amp;&amp;</span>&nbsp;<span class="ident" id="8295401">strings</span><span class="op" id="8295408">.</span><span class="ident" id="8295409">HasSuffix</span><span class="op" id="8295418">(</span><span class="ident" id="8295419">name</span><span class="op" id="8295423">,</span>&nbsp;<span class="string" id="8295425">&#34;.src&#34;</span><span class="op" id="8295431">)</span>&nbsp;<span class="op" id="8295433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295438">checkErrors</span><span class="op" id="8295449">(</span><span class="ident" id="8295450">t</span><span class="op" id="8295451">,</span>&nbsp;<span class="ident" id="8295453">filepath</span><span class="op" id="8295461">.</span><span class="ident" id="8295462">Join</span><span class="op" id="8295466">(</span><span class="ident" id="8295467">testdata</span><span class="op" id="8295475">,</span>&nbsp;<span class="ident" id="8295477">name</span><span class="op" id="8295481">)</span><span class="op" id="8295482">,</span>&nbsp;<span class="ident" id="8295484">nil</span><span class="op" id="8295487">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8295491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8295494">}</span><br>
<span class="lineno"></span><span class="op" id="8295496">}</span>
</div>
</body>
</html>
