<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5946409">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5946464">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5946518">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5946569">//&nbsp;Package&nbsp;parser&nbsp;implements&nbsp;a&nbsp;parser&nbsp;for&nbsp;Go&nbsp;source&nbsp;files.&nbsp;Input&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5946641">//&nbsp;provided&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;forms&nbsp;(see&nbsp;the&nbsp;various&nbsp;Parse*&nbsp;functions);&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5946715">//&nbsp;output&nbsp;is&nbsp;an&nbsp;abstract&nbsp;syntax&nbsp;tree&nbsp;(AST)&nbsp;representing&nbsp;the&nbsp;Go&nbsp;source.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5946790">//&nbsp;parser&nbsp;is&nbsp;invoked&nbsp;through&nbsp;one&nbsp;of&nbsp;the&nbsp;Parse*&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5946848">//</span><br>
<span class="lineno">10</span><span class="keyword" id="5946851">package</span>&nbsp;<span class="ident" id="5946859">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5946867">import</span>&nbsp;<span class="op" id="5946874">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5946877">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5946884">&#34;go/ast&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5946894">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5946908">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5946920">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5946931">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5946942">&#34;unicode&#34;</span><br>
<span class="lineno">20</span><span class="op" id="5946952">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5946955">//&nbsp;The&nbsp;parser&nbsp;structure&nbsp;holds&nbsp;the&nbsp;parser&#39;s&nbsp;internal&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5947014">type</span>&nbsp;<span class="ident" id="5947019">parser</span>&nbsp;<span class="keyword" id="5947026">struct</span>&nbsp;<span class="op" id="5947033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947036">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5947044">*</span><span class="ident" id="5947045">token</span><span class="op" id="5947050">.</span><span class="ident" id="5947051">File</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947057">errors</span>&nbsp;&nbsp;<span class="ident" id="5947065">scanner</span><span class="op" id="5947072">.</span><span class="ident" id="5947073">ErrorList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947084">scanner</span>&nbsp;<span class="ident" id="5947092">scanner</span><span class="op" id="5947099">.</span><span class="ident" id="5947100">Scanner</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947110">//&nbsp;Tracing/debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947132">mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5947139">Mode</span>&nbsp;<span class="comment" id="5947144">//&nbsp;parsing&nbsp;mode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947161">trace</span>&nbsp;&nbsp;<span class="builtintype" id="5947168">bool</span>&nbsp;<span class="comment" id="5947173">//&nbsp;==&nbsp;(mode&nbsp;&amp;&nbsp;Trace&nbsp;!=&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947200">indent</span>&nbsp;<span class="builtintype" id="5947207">int</span>&nbsp;&nbsp;<span class="comment" id="5947212">//&nbsp;indentation&nbsp;used&nbsp;for&nbsp;tracing&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947253">//&nbsp;Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947266">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5947278">[</span><span class="op" id="5947279">]</span><span class="op" id="5947280">*</span><span class="ident" id="5947281">ast</span><span class="op" id="5947284">.</span><span class="ident" id="5947285">CommentGroup</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947299">leadComment</span>&nbsp;<span class="op" id="5947311">*</span><span class="ident" id="5947312">ast</span><span class="op" id="5947315">.</span><span class="ident" id="5947316">CommentGroup</span>&nbsp;<span class="comment" id="5947329">//&nbsp;last&nbsp;lead&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947351">lineComment</span>&nbsp;<span class="op" id="5947363">*</span><span class="ident" id="5947364">ast</span><span class="op" id="5947367">.</span><span class="ident" id="5947368">CommentGroup</span>&nbsp;<span class="comment" id="5947381">//&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947404">//&nbsp;Next&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947419">pos</span>&nbsp;<span class="ident" id="5947423">token</span><span class="op" id="5947428">.</span><span class="ident" id="5947429">Pos</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5947435">//&nbsp;token&nbsp;position</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947454">tok</span>&nbsp;<span class="ident" id="5947458">token</span><span class="op" id="5947463">.</span><span class="ident" id="5947464">Token</span>&nbsp;<span class="comment" id="5947470">//&nbsp;one&nbsp;token&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947495">lit</span>&nbsp;<span class="builtintype" id="5947499">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5947511">//&nbsp;token&nbsp;literal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947530">//&nbsp;Error&nbsp;recovery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947549">//&nbsp;(used&nbsp;to&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;functions</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947609">//&nbsp;w/o&nbsp;making&nbsp;scanning&nbsp;progress&nbsp;-&nbsp;avoids&nbsp;potential&nbsp;endless</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947669">//&nbsp;loops&nbsp;across&nbsp;multiple&nbsp;parser&nbsp;functions&nbsp;during&nbsp;error&nbsp;recovery)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947735">syncPos</span>&nbsp;<span class="ident" id="5947743">token</span><span class="op" id="5947748">.</span><span class="ident" id="5947749">Pos</span>&nbsp;<span class="comment" id="5947753">//&nbsp;last&nbsp;synchronization&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947787">syncCnt</span>&nbsp;<span class="builtintype" id="5947795">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5947805">//&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;without&nbsp;progress</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947854">//&nbsp;Non-syntactic&nbsp;parser&nbsp;control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947887">exprLev</span>&nbsp;<span class="builtintype" id="5947895">int</span>&nbsp;&nbsp;<span class="comment" id="5947900">//&nbsp;&lt;&nbsp;0:&nbsp;in&nbsp;control&nbsp;clause,&nbsp;&gt;=&nbsp;0:&nbsp;in&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947948">inRhs</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5947956">bool</span>&nbsp;<span class="comment" id="5947961">//&nbsp;if&nbsp;set,&nbsp;the&nbsp;parser&nbsp;is&nbsp;parsing&nbsp;a&nbsp;rhs&nbsp;expression</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948013">//&nbsp;Ordinary&nbsp;identifier&nbsp;scopes</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948044">pkgScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5948055">*</span><span class="ident" id="5948056">ast</span><span class="op" id="5948059">.</span><span class="ident" id="5948060">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5948073">//&nbsp;pkgScope.Outer&nbsp;==&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948099">topScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5948110">*</span><span class="ident" id="5948111">ast</span><span class="op" id="5948114">.</span><span class="ident" id="5948115">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5948128">//&nbsp;top-most&nbsp;scope;&nbsp;may&nbsp;be&nbsp;pkgScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948164">unresolved</span>&nbsp;<span class="op" id="5948175">[</span><span class="op" id="5948176">]</span><span class="op" id="5948177">*</span><span class="ident" id="5948178">ast</span><span class="op" id="5948181">.</span><span class="ident" id="5948182">Ident</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5948193">//&nbsp;unresolved&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948220">imports</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5948231">[</span><span class="op" id="5948232">]</span><span class="op" id="5948233">*</span><span class="ident" id="5948234">ast</span><span class="op" id="5948237">.</span><span class="ident" id="5948238">ImportSpec</span>&nbsp;<span class="comment" id="5948249">//&nbsp;list&nbsp;of&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948270">//&nbsp;Label&nbsp;scopes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948287">//&nbsp;(maintained&nbsp;by&nbsp;open/close&nbsp;LabelScope)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948329">labelScope</span>&nbsp;&nbsp;<span class="op" id="5948341">*</span><span class="ident" id="5948342">ast</span><span class="op" id="5948345">.</span><span class="ident" id="5948346">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5948356">//&nbsp;label&nbsp;scope&nbsp;for&nbsp;current&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948393">targetStack</span>&nbsp;<span class="op" id="5948405">[</span><span class="op" id="5948406">]</span><span class="op" id="5948407">[</span><span class="op" id="5948408">]</span><span class="op" id="5948409">*</span><span class="ident" id="5948410">ast</span><span class="op" id="5948413">.</span><span class="ident" id="5948414">Ident</span>&nbsp;<span class="comment" id="5948420">//&nbsp;stack&nbsp;of&nbsp;unresolved&nbsp;labels</span><br>
<span class="lineno"></span><span class="op" id="5948450">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="5948453">func</span>&nbsp;<span class="op" id="5948458">(</span><span class="ident" id="5948459">p</span>&nbsp;<span class="op" id="5948461">*</span><span class="ident" id="5948462">parser</span><span class="op" id="5948468">)</span>&nbsp;<span class="ident" id="5948470">init</span><span class="op" id="5948474">(</span><span class="ident" id="5948475">fset</span>&nbsp;<span class="op" id="5948480">*</span><span class="ident" id="5948481">token</span><span class="op" id="5948486">.</span><span class="ident" id="5948487">FileSet</span><span class="op" id="5948494">,</span>&nbsp;<span class="ident" id="5948496">filename</span>&nbsp;<span class="builtintype" id="5948505">string</span><span class="op" id="5948511">,</span>&nbsp;<span class="ident" id="5948513">src</span>&nbsp;<span class="op" id="5948517">[</span><span class="op" id="5948518">]</span><span class="builtintype" id="5948519">byte</span><span class="op" id="5948523">,</span>&nbsp;<span class="ident" id="5948525">mode</span>&nbsp;<span class="ident" id="5948530">Mode</span><span class="op" id="5948534">)</span>&nbsp;<span class="op" id="5948536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948539">p</span><span class="op" id="5948540">.</span><span class="ident" id="5948541">file</span>&nbsp;<span class="op" id="5948546">=</span>&nbsp;<span class="ident" id="5948548">fset</span><span class="op" id="5948552">.</span><span class="ident" id="5948553">AddFile</span><span class="op" id="5948560">(</span><span class="ident" id="5948561">filename</span><span class="op" id="5948569">,</span>&nbsp;<span class="op" id="5948571">-</span><span class="num" id="5948572">1</span><span class="op" id="5948573">,</span>&nbsp;<span class="builtinfunc" id="5948575">len</span><span class="op" id="5948578">(</span><span class="ident" id="5948579">src</span><span class="op" id="5948582">)</span><span class="op" id="5948583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948586">var</span>&nbsp;<span class="ident" id="5948590">m</span>&nbsp;<span class="ident" id="5948592">scanner</span><span class="op" id="5948599">.</span><span class="ident" id="5948600">Mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948606">if</span>&nbsp;<span class="ident" id="5948609">mode</span><span class="op" id="5948613">&amp;</span><span class="ident" id="5948614">ParseComments</span>&nbsp;<span class="op" id="5948628">!=</span>&nbsp;<span class="num" id="5948631">0</span>&nbsp;<span class="op" id="5948633">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948637">m</span>&nbsp;<span class="op" id="5948639">=</span>&nbsp;<span class="ident" id="5948641">scanner</span><span class="op" id="5948648">.</span><span class="ident" id="5948649">ScanComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948666">eh</span>&nbsp;<span class="op" id="5948669">:=</span>&nbsp;<span class="keyword" id="5948672">func</span><span class="op" id="5948676">(</span><span class="ident" id="5948677">pos</span>&nbsp;<span class="ident" id="5948681">token</span><span class="op" id="5948686">.</span><span class="ident" id="5948687">Position</span><span class="op" id="5948695">,</span>&nbsp;<span class="ident" id="5948697">msg</span>&nbsp;<span class="builtintype" id="5948701">string</span><span class="op" id="5948707">)</span>&nbsp;<span class="op" id="5948709">{</span>&nbsp;<span class="ident" id="5948711">p</span><span class="op" id="5948712">.</span><span class="ident" id="5948713">errors</span><span class="op" id="5948719">.</span><span class="ident" id="5948720">Add</span><span class="op" id="5948723">(</span><span class="ident" id="5948724">pos</span><span class="op" id="5948727">,</span>&nbsp;<span class="ident" id="5948729">msg</span><span class="op" id="5948732">)</span>&nbsp;<span class="op" id="5948734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948737">p</span><span class="op" id="5948738">.</span><span class="ident" id="5948739">scanner</span><span class="op" id="5948746">.</span><span class="ident" id="5948747">Init</span><span class="op" id="5948751">(</span><span class="ident" id="5948752">p</span><span class="op" id="5948753">.</span><span class="ident" id="5948754">file</span><span class="op" id="5948758">,</span>&nbsp;<span class="ident" id="5948760">src</span><span class="op" id="5948763">,</span>&nbsp;<span class="ident" id="5948765">eh</span><span class="op" id="5948767">,</span>&nbsp;<span class="ident" id="5948769">m</span><span class="op" id="5948770">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948774">p</span><span class="op" id="5948775">.</span><span class="ident" id="5948776">mode</span>&nbsp;<span class="op" id="5948781">=</span>&nbsp;<span class="ident" id="5948783">mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948789">p</span><span class="op" id="5948790">.</span><span class="ident" id="5948791">trace</span>&nbsp;<span class="op" id="5948797">=</span>&nbsp;<span class="ident" id="5948799">mode</span><span class="op" id="5948803">&amp;</span><span class="ident" id="5948804">Trace</span>&nbsp;<span class="op" id="5948810">!=</span>&nbsp;<span class="num" id="5948813">0</span>&nbsp;<span class="comment" id="5948815">//&nbsp;for&nbsp;convenience&nbsp;(p.trace&nbsp;is&nbsp;used&nbsp;frequently)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948865">p</span><span class="op" id="5948866">.</span><span class="ident" id="5948867">next</span><span class="op" id="5948871">(</span><span class="op" id="5948872">)</span><br>
<span class="lineno"></span><span class="op" id="5948874">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="5948877">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5948957">//&nbsp;Scoping&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5948977">func</span>&nbsp;<span class="op" id="5948982">(</span><span class="ident" id="5948983">p</span>&nbsp;<span class="op" id="5948985">*</span><span class="ident" id="5948986">parser</span><span class="op" id="5948992">)</span>&nbsp;<span class="ident" id="5948994">openScope</span><span class="op" id="5949003">(</span><span class="op" id="5949004">)</span>&nbsp;<span class="op" id="5949006">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949009">p</span><span class="op" id="5949010">.</span><span class="ident" id="5949011">topScope</span>&nbsp;<span class="op" id="5949020">=</span>&nbsp;<span class="ident" id="5949022">ast</span><span class="op" id="5949025">.</span><span class="ident" id="5949026">NewScope</span><span class="op" id="5949034">(</span><span class="ident" id="5949035">p</span><span class="op" id="5949036">.</span><span class="ident" id="5949037">topScope</span><span class="op" id="5949045">)</span><br>
<span class="lineno"></span><span class="op" id="5949047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5949050">func</span>&nbsp;<span class="op" id="5949055">(</span><span class="ident" id="5949056">p</span>&nbsp;<span class="op" id="5949058">*</span><span class="ident" id="5949059">parser</span><span class="op" id="5949065">)</span>&nbsp;<span class="ident" id="5949067">closeScope</span><span class="op" id="5949077">(</span><span class="op" id="5949078">)</span>&nbsp;<span class="op" id="5949080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949083">p</span><span class="op" id="5949084">.</span><span class="ident" id="5949085">topScope</span>&nbsp;<span class="op" id="5949094">=</span>&nbsp;<span class="ident" id="5949096">p</span><span class="op" id="5949097">.</span><span class="ident" id="5949098">topScope</span><span class="op" id="5949106">.</span><span class="ident" id="5949107">Outer</span><br>
<span class="lineno">90</span><span class="op" id="5949113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5949116">func</span>&nbsp;<span class="op" id="5949121">(</span><span class="ident" id="5949122">p</span>&nbsp;<span class="op" id="5949124">*</span><span class="ident" id="5949125">parser</span><span class="op" id="5949131">)</span>&nbsp;<span class="ident" id="5949133">openLabelScope</span><span class="op" id="5949147">(</span><span class="op" id="5949148">)</span>&nbsp;<span class="op" id="5949150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949153">p</span><span class="op" id="5949154">.</span><span class="ident" id="5949155">labelScope</span>&nbsp;<span class="op" id="5949166">=</span>&nbsp;<span class="ident" id="5949168">ast</span><span class="op" id="5949171">.</span><span class="ident" id="5949172">NewScope</span><span class="op" id="5949180">(</span><span class="ident" id="5949181">p</span><span class="op" id="5949182">.</span><span class="ident" id="5949183">labelScope</span><span class="op" id="5949193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949196">p</span><span class="op" id="5949197">.</span><span class="ident" id="5949198">targetStack</span>&nbsp;<span class="op" id="5949210">=</span>&nbsp;<span class="builtinfunc" id="5949212">append</span><span class="op" id="5949218">(</span><span class="ident" id="5949219">p</span><span class="op" id="5949220">.</span><span class="ident" id="5949221">targetStack</span><span class="op" id="5949232">,</span>&nbsp;<span class="ident" id="5949234">nil</span><span class="op" id="5949237">)</span><br>
<span class="lineno">95</span><span class="op" id="5949239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5949242">func</span>&nbsp;<span class="op" id="5949247">(</span><span class="ident" id="5949248">p</span>&nbsp;<span class="op" id="5949250">*</span><span class="ident" id="5949251">parser</span><span class="op" id="5949257">)</span>&nbsp;<span class="ident" id="5949259">closeLabelScope</span><span class="op" id="5949274">(</span><span class="op" id="5949275">)</span>&nbsp;<span class="op" id="5949277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949280">//&nbsp;resolve&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949299">n</span>&nbsp;<span class="op" id="5949301">:=</span>&nbsp;<span class="builtinfunc" id="5949304">len</span><span class="op" id="5949307">(</span><span class="ident" id="5949308">p</span><span class="op" id="5949309">.</span><span class="ident" id="5949310">targetStack</span><span class="op" id="5949321">)</span>&nbsp;<span class="op" id="5949323">-</span>&nbsp;<span class="num" id="5949325">1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949328">scope</span>&nbsp;<span class="op" id="5949334">:=</span>&nbsp;<span class="ident" id="5949337">p</span><span class="op" id="5949338">.</span><span class="ident" id="5949339">labelScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949351">for</span>&nbsp;<span class="ident" id="5949355">_</span><span class="op" id="5949356">,</span>&nbsp;<span class="ident" id="5949358">ident</span>&nbsp;<span class="op" id="5949364">:=</span>&nbsp;<span class="keyword" id="5949367">range</span>&nbsp;<span class="ident" id="5949373">p</span><span class="op" id="5949374">.</span><span class="ident" id="5949375">targetStack</span><span class="op" id="5949386">[</span><span class="ident" id="5949387">n</span><span class="op" id="5949388">]</span>&nbsp;<span class="op" id="5949390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949394">ident</span><span class="op" id="5949399">.</span><span class="ident" id="5949400">Obj</span>&nbsp;<span class="op" id="5949404">=</span>&nbsp;<span class="ident" id="5949406">scope</span><span class="op" id="5949411">.</span><span class="ident" id="5949412">Lookup</span><span class="op" id="5949418">(</span><span class="ident" id="5949419">ident</span><span class="op" id="5949424">.</span><span class="ident" id="5949425">Name</span><span class="op" id="5949429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949433">if</span>&nbsp;<span class="ident" id="5949436">ident</span><span class="op" id="5949441">.</span><span class="ident" id="5949442">Obj</span>&nbsp;<span class="op" id="5949446">==</span>&nbsp;<span class="ident" id="5949449">nil</span>&nbsp;<span class="op" id="5949453">&amp;&amp;</span>&nbsp;<span class="ident" id="5949456">p</span><span class="op" id="5949457">.</span><span class="ident" id="5949458">mode</span><span class="op" id="5949462">&amp;</span><span class="ident" id="5949463">DeclarationErrors</span>&nbsp;<span class="op" id="5949481">!=</span>&nbsp;<span class="num" id="5949484">0</span>&nbsp;<span class="op" id="5949486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949491">p</span><span class="op" id="5949492">.</span><span class="builtintype" id="5949493">error</span><span class="op" id="5949498">(</span><span class="ident" id="5949499">ident</span><span class="op" id="5949504">.</span><span class="ident" id="5949505">Pos</span><span class="op" id="5949508">(</span><span class="op" id="5949509">)</span><span class="op" id="5949510">,</span>&nbsp;<span class="ident" id="5949512">fmt</span><span class="op" id="5949515">.</span><span class="ident" id="5949516">Sprintf</span><span class="op" id="5949523">(</span><span class="string" id="5949524">&#34;label&nbsp;%s&nbsp;undefined&#34;</span><span class="op" id="5949544">,</span>&nbsp;<span class="ident" id="5949546">ident</span><span class="op" id="5949551">.</span><span class="ident" id="5949552">Name</span><span class="op" id="5949556">)</span><span class="op" id="5949557">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5949561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5949564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949567">//&nbsp;pop&nbsp;label&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949587">p</span><span class="op" id="5949588">.</span><span class="ident" id="5949589">targetStack</span>&nbsp;<span class="op" id="5949601">=</span>&nbsp;<span class="ident" id="5949603">p</span><span class="op" id="5949604">.</span><span class="ident" id="5949605">targetStack</span><span class="op" id="5949616">[</span><span class="num" id="5949617">0</span><span class="op" id="5949618">:</span><span class="ident" id="5949619">n</span><span class="op" id="5949620">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949623">p</span><span class="op" id="5949624">.</span><span class="ident" id="5949625">labelScope</span>&nbsp;<span class="op" id="5949636">=</span>&nbsp;<span class="ident" id="5949638">p</span><span class="op" id="5949639">.</span><span class="ident" id="5949640">labelScope</span><span class="op" id="5949650">.</span><span class="ident" id="5949651">Outer</span><br>
<span class="lineno">110</span><span class="op" id="5949657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5949660">func</span>&nbsp;<span class="op" id="5949665">(</span><span class="ident" id="5949666">p</span>&nbsp;<span class="op" id="5949668">*</span><span class="ident" id="5949669">parser</span><span class="op" id="5949675">)</span>&nbsp;<span class="ident" id="5949677">declare</span><span class="op" id="5949684">(</span><span class="ident" id="5949685">decl</span><span class="op" id="5949689">,</span>&nbsp;<span class="ident" id="5949691">data</span>&nbsp;<span class="keyword" id="5949696">interface</span><span class="op" id="5949705">{</span><span class="op" id="5949706">}</span><span class="op" id="5949707">,</span>&nbsp;<span class="ident" id="5949709">scope</span>&nbsp;<span class="op" id="5949715">*</span><span class="ident" id="5949716">ast</span><span class="op" id="5949719">.</span><span class="ident" id="5949720">Scope</span><span class="op" id="5949725">,</span>&nbsp;<span class="ident" id="5949727">kind</span>&nbsp;<span class="ident" id="5949732">ast</span><span class="op" id="5949735">.</span><span class="ident" id="5949736">ObjKind</span><span class="op" id="5949743">,</span>&nbsp;<span class="ident" id="5949745">idents</span>&nbsp;<span class="op" id="5949752">...</span><span class="op" id="5949755">*</span><span class="ident" id="5949756">ast</span><span class="op" id="5949759">.</span><span class="ident" id="5949760">Ident</span><span class="op" id="5949765">)</span>&nbsp;<span class="op" id="5949767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949770">for</span>&nbsp;<span class="ident" id="5949774">_</span><span class="op" id="5949775">,</span>&nbsp;<span class="ident" id="5949777">ident</span>&nbsp;<span class="op" id="5949783">:=</span>&nbsp;<span class="keyword" id="5949786">range</span>&nbsp;<span class="ident" id="5949792">idents</span>&nbsp;<span class="op" id="5949799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949803">assert</span><span class="op" id="5949809">(</span><span class="ident" id="5949810">ident</span><span class="op" id="5949815">.</span><span class="ident" id="5949816">Obj</span>&nbsp;<span class="op" id="5949820">==</span>&nbsp;<span class="ident" id="5949823">nil</span><span class="op" id="5949826">,</span>&nbsp;<span class="string" id="5949828">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5949869">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949873">obj</span>&nbsp;<span class="op" id="5949877">:=</span>&nbsp;<span class="ident" id="5949880">ast</span><span class="op" id="5949883">.</span><span class="ident" id="5949884">NewObj</span><span class="op" id="5949890">(</span><span class="ident" id="5949891">kind</span><span class="op" id="5949895">,</span>&nbsp;<span class="ident" id="5949897">ident</span><span class="op" id="5949902">.</span><span class="ident" id="5949903">Name</span><span class="op" id="5949907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949911">//&nbsp;remember&nbsp;the&nbsp;corresponding&nbsp;declaration&nbsp;for&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949973">//&nbsp;errors&nbsp;and&nbsp;global&nbsp;variable&nbsp;resolution/typechecking&nbsp;phase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950035">obj</span><span class="op" id="5950038">.</span><span class="ident" id="5950039">Decl</span>&nbsp;<span class="op" id="5950044">=</span>&nbsp;<span class="ident" id="5950046">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950053">obj</span><span class="op" id="5950056">.</span><span class="ident" id="5950057">Data</span>&nbsp;<span class="op" id="5950062">=</span>&nbsp;<span class="ident" id="5950064">data</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950071">ident</span><span class="op" id="5950076">.</span><span class="ident" id="5950077">Obj</span>&nbsp;<span class="op" id="5950081">=</span>&nbsp;<span class="ident" id="5950083">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950089">if</span>&nbsp;<span class="ident" id="5950092">ident</span><span class="op" id="5950097">.</span><span class="ident" id="5950098">Name</span>&nbsp;<span class="op" id="5950103">!=</span>&nbsp;<span class="string" id="5950106">&#34;_&#34;</span>&nbsp;<span class="op" id="5950110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950115">if</span>&nbsp;<span class="ident" id="5950118">alt</span>&nbsp;<span class="op" id="5950122">:=</span>&nbsp;<span class="ident" id="5950125">scope</span><span class="op" id="5950130">.</span><span class="ident" id="5950131">Insert</span><span class="op" id="5950137">(</span><span class="ident" id="5950138">obj</span><span class="op" id="5950141">)</span><span class="op" id="5950142">;</span>&nbsp;<span class="ident" id="5950144">alt</span>&nbsp;<span class="op" id="5950148">!=</span>&nbsp;<span class="ident" id="5950151">nil</span>&nbsp;<span class="op" id="5950155">&amp;&amp;</span>&nbsp;<span class="ident" id="5950158">p</span><span class="op" id="5950159">.</span><span class="ident" id="5950160">mode</span><span class="op" id="5950164">&amp;</span><span class="ident" id="5950165">DeclarationErrors</span>&nbsp;<span class="op" id="5950183">!=</span>&nbsp;<span class="num" id="5950186">0</span>&nbsp;<span class="op" id="5950188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950194">prevDecl</span>&nbsp;<span class="op" id="5950203">:=</span>&nbsp;<span class="string" id="5950206">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950213">if</span>&nbsp;<span class="ident" id="5950216">pos</span>&nbsp;<span class="op" id="5950220">:=</span>&nbsp;<span class="ident" id="5950223">alt</span><span class="op" id="5950226">.</span><span class="ident" id="5950227">Pos</span><span class="op" id="5950230">(</span><span class="op" id="5950231">)</span><span class="op" id="5950232">;</span>&nbsp;<span class="ident" id="5950234">pos</span><span class="op" id="5950237">.</span><span class="ident" id="5950238">IsValid</span><span class="op" id="5950245">(</span><span class="op" id="5950246">)</span>&nbsp;<span class="op" id="5950248">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950255">prevDecl</span>&nbsp;<span class="op" id="5950264">=</span>&nbsp;<span class="ident" id="5950266">fmt</span><span class="op" id="5950269">.</span><span class="ident" id="5950270">Sprintf</span><span class="op" id="5950277">(</span><span class="string" id="5950278">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="5950310">,</span>&nbsp;<span class="ident" id="5950312">p</span><span class="op" id="5950313">.</span><span class="ident" id="5950314">file</span><span class="op" id="5950318">.</span><span class="ident" id="5950319">Position</span><span class="op" id="5950327">(</span><span class="ident" id="5950328">pos</span><span class="op" id="5950331">)</span><span class="op" id="5950332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950344">p</span><span class="op" id="5950345">.</span><span class="builtintype" id="5950346">error</span><span class="op" id="5950351">(</span><span class="ident" id="5950352">ident</span><span class="op" id="5950357">.</span><span class="ident" id="5950358">Pos</span><span class="op" id="5950361">(</span><span class="op" id="5950362">)</span><span class="op" id="5950363">,</span>&nbsp;<span class="ident" id="5950365">fmt</span><span class="op" id="5950368">.</span><span class="ident" id="5950369">Sprintf</span><span class="op" id="5950376">(</span><span class="string" id="5950377">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="5950408">,</span>&nbsp;<span class="ident" id="5950410">ident</span><span class="op" id="5950415">.</span><span class="ident" id="5950416">Name</span><span class="op" id="5950420">,</span>&nbsp;<span class="ident" id="5950422">prevDecl</span><span class="op" id="5950430">)</span><span class="op" id="5950431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950440">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950443">}</span><br>
<span class="lineno"></span><span class="op" id="5950445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5950448">func</span>&nbsp;<span class="op" id="5950453">(</span><span class="ident" id="5950454">p</span>&nbsp;<span class="op" id="5950456">*</span><span class="ident" id="5950457">parser</span><span class="op" id="5950463">)</span>&nbsp;<span class="ident" id="5950465">shortVarDecl</span><span class="op" id="5950477">(</span><span class="ident" id="5950478">decl</span>&nbsp;<span class="op" id="5950483">*</span><span class="ident" id="5950484">ast</span><span class="op" id="5950487">.</span><span class="ident" id="5950488">AssignStmt</span><span class="op" id="5950498">,</span>&nbsp;<span class="ident" id="5950500">list</span>&nbsp;<span class="op" id="5950505">[</span><span class="op" id="5950506">]</span><span class="ident" id="5950507">ast</span><span class="op" id="5950510">.</span><span class="ident" id="5950511">Expr</span><span class="op" id="5950515">)</span>&nbsp;<span class="op" id="5950517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950520">//&nbsp;Go&nbsp;spec:&nbsp;A&nbsp;short&nbsp;variable&nbsp;declaration&nbsp;may&nbsp;redeclare&nbsp;variables</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950586">//&nbsp;provided&nbsp;they&nbsp;were&nbsp;originally&nbsp;declared&nbsp;in&nbsp;the&nbsp;same&nbsp;block&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950652">//&nbsp;the&nbsp;same&nbsp;type,&nbsp;and&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;non-blank&nbsp;variables&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950723">n</span>&nbsp;<span class="op" id="5950725">:=</span>&nbsp;<span class="num" id="5950728">0</span>&nbsp;<span class="comment" id="5950730">//&nbsp;number&nbsp;of&nbsp;new&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950758">for</span>&nbsp;<span class="ident" id="5950762">_</span><span class="op" id="5950763">,</span>&nbsp;<span class="ident" id="5950765">x</span>&nbsp;<span class="op" id="5950767">:=</span>&nbsp;<span class="keyword" id="5950770">range</span>&nbsp;<span class="ident" id="5950776">list</span>&nbsp;<span class="op" id="5950781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950785">if</span>&nbsp;<span class="ident" id="5950788">ident</span><span class="op" id="5950793">,</span>&nbsp;<span class="ident" id="5950795">isIdent</span>&nbsp;<span class="op" id="5950803">:=</span>&nbsp;<span class="ident" id="5950806">x</span><span class="op" id="5950807">.</span><span class="op" id="5950808">(</span><span class="op" id="5950809">*</span><span class="ident" id="5950810">ast</span><span class="op" id="5950813">.</span><span class="ident" id="5950814">Ident</span><span class="op" id="5950819">)</span><span class="op" id="5950820">;</span>&nbsp;<span class="ident" id="5950822">isIdent</span>&nbsp;<span class="op" id="5950830">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950835">assert</span><span class="op" id="5950841">(</span><span class="ident" id="5950842">ident</span><span class="op" id="5950847">.</span><span class="ident" id="5950848">Obj</span>&nbsp;<span class="op" id="5950852">==</span>&nbsp;<span class="ident" id="5950855">nil</span><span class="op" id="5950858">,</span>&nbsp;<span class="string" id="5950860">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5950901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950906">obj</span>&nbsp;<span class="op" id="5950910">:=</span>&nbsp;<span class="ident" id="5950913">ast</span><span class="op" id="5950916">.</span><span class="ident" id="5950917">NewObj</span><span class="op" id="5950923">(</span><span class="ident" id="5950924">ast</span><span class="op" id="5950927">.</span><span class="ident" id="5950928">Var</span><span class="op" id="5950931">,</span>&nbsp;<span class="ident" id="5950933">ident</span><span class="op" id="5950938">.</span><span class="ident" id="5950939">Name</span><span class="op" id="5950943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950948">//&nbsp;remember&nbsp;corresponding&nbsp;assignment&nbsp;for&nbsp;other&nbsp;tools</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951004">obj</span><span class="op" id="5951007">.</span><span class="ident" id="5951008">Decl</span>&nbsp;<span class="op" id="5951013">=</span>&nbsp;<span class="ident" id="5951015">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951023">ident</span><span class="op" id="5951028">.</span><span class="ident" id="5951029">Obj</span>&nbsp;<span class="op" id="5951033">=</span>&nbsp;<span class="ident" id="5951035">obj</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951042">if</span>&nbsp;<span class="ident" id="5951045">ident</span><span class="op" id="5951050">.</span><span class="ident" id="5951051">Name</span>&nbsp;<span class="op" id="5951056">!=</span>&nbsp;<span class="string" id="5951059">&#34;_&#34;</span>&nbsp;<span class="op" id="5951063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951069">if</span>&nbsp;<span class="ident" id="5951072">alt</span>&nbsp;<span class="op" id="5951076">:=</span>&nbsp;<span class="ident" id="5951079">p</span><span class="op" id="5951080">.</span><span class="ident" id="5951081">topScope</span><span class="op" id="5951089">.</span><span class="ident" id="5951090">Insert</span><span class="op" id="5951096">(</span><span class="ident" id="5951097">obj</span><span class="op" id="5951100">)</span><span class="op" id="5951101">;</span>&nbsp;<span class="ident" id="5951103">alt</span>&nbsp;<span class="op" id="5951107">!=</span>&nbsp;<span class="ident" id="5951110">nil</span>&nbsp;<span class="op" id="5951114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951121">ident</span><span class="op" id="5951126">.</span><span class="ident" id="5951127">Obj</span>&nbsp;<span class="op" id="5951131">=</span>&nbsp;<span class="ident" id="5951133">alt</span>&nbsp;<span class="comment" id="5951137">//&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951158">}</span>&nbsp;<span class="keyword" id="5951160">else</span>&nbsp;<span class="op" id="5951165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951172">n</span><span class="op" id="5951173">++</span>&nbsp;<span class="comment" id="5951176">//&nbsp;new&nbsp;declaration</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951208">}</span>&nbsp;<span class="keyword" id="5951210">else</span>&nbsp;<span class="op" id="5951215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951220">p</span><span class="op" id="5951221">.</span><span class="ident" id="5951222">errorExpected</span><span class="op" id="5951235">(</span><span class="ident" id="5951236">x</span><span class="op" id="5951237">.</span><span class="ident" id="5951238">Pos</span><span class="op" id="5951241">(</span><span class="op" id="5951242">)</span><span class="op" id="5951243">,</span>&nbsp;<span class="string" id="5951245">&#34;identifier&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="5951276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951280">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951286">if</span>&nbsp;<span class="ident" id="5951289">n</span>&nbsp;<span class="op" id="5951291">==</span>&nbsp;<span class="num" id="5951294">0</span>&nbsp;<span class="op" id="5951296">&amp;&amp;</span>&nbsp;<span class="ident" id="5951299">p</span><span class="op" id="5951300">.</span><span class="ident" id="5951301">mode</span><span class="op" id="5951305">&amp;</span><span class="ident" id="5951306">DeclarationErrors</span>&nbsp;<span class="op" id="5951324">!=</span>&nbsp;<span class="num" id="5951327">0</span>&nbsp;<span class="op" id="5951329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951333">p</span><span class="op" id="5951334">.</span><span class="builtintype" id="5951335">error</span><span class="op" id="5951340">(</span><span class="ident" id="5951341">list</span><span class="op" id="5951345">[</span><span class="num" id="5951346">0</span><span class="op" id="5951347">]</span><span class="op" id="5951348">.</span><span class="ident" id="5951349">Pos</span><span class="op" id="5951352">(</span><span class="op" id="5951353">)</span><span class="op" id="5951354">,</span>&nbsp;<span class="string" id="5951356">&#34;no&nbsp;new&nbsp;variables&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="5951393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951396">}</span><br>
<span class="lineno"></span><span class="op" id="5951398">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="5951401">//&nbsp;The&nbsp;unresolved&nbsp;object&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;to&nbsp;mark&nbsp;identifiers&nbsp;that&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5951481">//&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;identifiers.&nbsp;The&nbsp;sentinel&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;verifying</span><br>
<span class="lineno"></span><span class="comment" id="5951563">//&nbsp;internal&nbsp;consistency.</span><br>
<span class="lineno"></span><span class="keyword" id="5951588">var</span>&nbsp;<span class="ident" id="5951592">unresolved</span>&nbsp;<span class="op" id="5951603">=</span>&nbsp;<span class="builtinfunc" id="5951605">new</span><span class="op" id="5951608">(</span><span class="ident" id="5951609">ast</span><span class="op" id="5951612">.</span><span class="ident" id="5951613">Object</span><span class="op" id="5951619">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5951622">//&nbsp;If&nbsp;x&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;tryResolve&nbsp;attempts&nbsp;to&nbsp;resolve&nbsp;x&nbsp;by&nbsp;looking&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="5951695">//&nbsp;the&nbsp;object&nbsp;it&nbsp;denotes.&nbsp;If&nbsp;no&nbsp;object&nbsp;is&nbsp;found&nbsp;and&nbsp;collectUnresolved&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5951768">//&nbsp;set,&nbsp;x&nbsp;is&nbsp;marked&nbsp;as&nbsp;unresolved&nbsp;and&nbsp;collected&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved</span><br>
<span class="lineno"></span><span class="comment" id="5951842">//&nbsp;identifiers.</span><br>
<span class="lineno">170</span><span class="comment" id="5951858">//</span><br>
<span class="lineno"></span><span class="keyword" id="5951861">func</span>&nbsp;<span class="op" id="5951866">(</span><span class="ident" id="5951867">p</span>&nbsp;<span class="op" id="5951869">*</span><span class="ident" id="5951870">parser</span><span class="op" id="5951876">)</span>&nbsp;<span class="ident" id="5951878">tryResolve</span><span class="op" id="5951888">(</span><span class="ident" id="5951889">x</span>&nbsp;<span class="ident" id="5951891">ast</span><span class="op" id="5951894">.</span><span class="ident" id="5951895">Expr</span><span class="op" id="5951899">,</span>&nbsp;<span class="ident" id="5951901">collectUnresolved</span>&nbsp;<span class="builtintype" id="5951919">bool</span><span class="op" id="5951923">)</span>&nbsp;<span class="op" id="5951925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951928">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;if&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;identifier&nbsp;or&nbsp;the&nbsp;blank&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951996">ident</span><span class="op" id="5952001">,</span>&nbsp;<span class="ident" id="5952003">_</span>&nbsp;<span class="op" id="5952005">:=</span>&nbsp;<span class="ident" id="5952008">x</span><span class="op" id="5952009">.</span><span class="op" id="5952010">(</span><span class="op" id="5952011">*</span><span class="ident" id="5952012">ast</span><span class="op" id="5952015">.</span><span class="ident" id="5952016">Ident</span><span class="op" id="5952021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952024">if</span>&nbsp;<span class="ident" id="5952027">ident</span>&nbsp;<span class="op" id="5952033">==</span>&nbsp;<span class="ident" id="5952036">nil</span>&nbsp;<span class="op" id="5952040">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952044">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952055">assert</span><span class="op" id="5952061">(</span><span class="ident" id="5952062">ident</span><span class="op" id="5952067">.</span><span class="ident" id="5952068">Obj</span>&nbsp;<span class="op" id="5952072">==</span>&nbsp;<span class="ident" id="5952075">nil</span><span class="op" id="5952078">,</span>&nbsp;<span class="string" id="5952080">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5952121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952124">if</span>&nbsp;<span class="ident" id="5952127">ident</span><span class="op" id="5952132">.</span><span class="ident" id="5952133">Name</span>&nbsp;<span class="op" id="5952138">==</span>&nbsp;<span class="string" id="5952141">&#34;_&#34;</span>&nbsp;<span class="op" id="5952145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952149">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952160">//&nbsp;try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952194">for</span>&nbsp;<span class="ident" id="5952198">s</span>&nbsp;<span class="op" id="5952200">:=</span>&nbsp;<span class="ident" id="5952203">p</span><span class="op" id="5952204">.</span><span class="ident" id="5952205">topScope</span><span class="op" id="5952213">;</span>&nbsp;<span class="ident" id="5952215">s</span>&nbsp;<span class="op" id="5952217">!=</span>&nbsp;<span class="ident" id="5952220">nil</span><span class="op" id="5952223">;</span>&nbsp;<span class="ident" id="5952225">s</span>&nbsp;<span class="op" id="5952227">=</span>&nbsp;<span class="ident" id="5952229">s</span><span class="op" id="5952230">.</span><span class="ident" id="5952231">Outer</span>&nbsp;<span class="op" id="5952237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952241">if</span>&nbsp;<span class="ident" id="5952244">obj</span>&nbsp;<span class="op" id="5952248">:=</span>&nbsp;<span class="ident" id="5952251">s</span><span class="op" id="5952252">.</span><span class="ident" id="5952253">Lookup</span><span class="op" id="5952259">(</span><span class="ident" id="5952260">ident</span><span class="op" id="5952265">.</span><span class="ident" id="5952266">Name</span><span class="op" id="5952270">)</span><span class="op" id="5952271">;</span>&nbsp;<span class="ident" id="5952273">obj</span>&nbsp;<span class="op" id="5952277">!=</span>&nbsp;<span class="ident" id="5952280">nil</span>&nbsp;<span class="op" id="5952284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952289">ident</span><span class="op" id="5952294">.</span><span class="ident" id="5952295">Obj</span>&nbsp;<span class="op" id="5952299">=</span>&nbsp;<span class="ident" id="5952301">obj</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952308">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952323">//&nbsp;all&nbsp;local&nbsp;scopes&nbsp;are&nbsp;known,&nbsp;so&nbsp;any&nbsp;unresolved&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952384">//&nbsp;must&nbsp;be&nbsp;found&nbsp;either&nbsp;in&nbsp;the&nbsp;file&nbsp;scope,&nbsp;package&nbsp;scope</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952442">//&nbsp;(perhaps&nbsp;in&nbsp;another&nbsp;file),&nbsp;or&nbsp;universe&nbsp;scope&nbsp;---&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952503">//&nbsp;them&nbsp;so&nbsp;that&nbsp;they&nbsp;can&nbsp;be&nbsp;resolved&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952547">if</span>&nbsp;<span class="ident" id="5952550">collectUnresolved</span>&nbsp;<span class="op" id="5952568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952572">ident</span><span class="op" id="5952577">.</span><span class="ident" id="5952578">Obj</span>&nbsp;<span class="op" id="5952582">=</span>&nbsp;<span class="ident" id="5952584">unresolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952597">p</span><span class="op" id="5952598">.</span><span class="ident" id="5952599">unresolved</span>&nbsp;<span class="op" id="5952610">=</span>&nbsp;<span class="builtinfunc" id="5952612">append</span><span class="op" id="5952618">(</span><span class="ident" id="5952619">p</span><span class="op" id="5952620">.</span><span class="ident" id="5952621">unresolved</span><span class="op" id="5952631">,</span>&nbsp;<span class="ident" id="5952633">ident</span><span class="op" id="5952638">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952641">}</span><br>
<span class="lineno"></span><span class="op" id="5952643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5952646">func</span>&nbsp;<span class="op" id="5952651">(</span><span class="ident" id="5952652">p</span>&nbsp;<span class="op" id="5952654">*</span><span class="ident" id="5952655">parser</span><span class="op" id="5952661">)</span>&nbsp;<span class="ident" id="5952663">resolve</span><span class="op" id="5952670">(</span><span class="ident" id="5952671">x</span>&nbsp;<span class="ident" id="5952673">ast</span><span class="op" id="5952676">.</span><span class="ident" id="5952677">Expr</span><span class="op" id="5952681">)</span>&nbsp;<span class="op" id="5952683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952686">p</span><span class="op" id="5952687">.</span><span class="ident" id="5952688">tryResolve</span><span class="op" id="5952698">(</span><span class="ident" id="5952699">x</span><span class="op" id="5952700">,</span>&nbsp;<span class="ident" id="5952702">true</span><span class="op" id="5952706">)</span><br>
<span class="lineno">200</span><span class="op" id="5952708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5952711">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5952791">//&nbsp;Parsing&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="5952811">func</span>&nbsp;<span class="op" id="5952816">(</span><span class="ident" id="5952817">p</span>&nbsp;<span class="op" id="5952819">*</span><span class="ident" id="5952820">parser</span><span class="op" id="5952826">)</span>&nbsp;<span class="ident" id="5952828">printTrace</span><span class="op" id="5952838">(</span><span class="ident" id="5952839">a</span>&nbsp;<span class="op" id="5952841">...</span><span class="keyword" id="5952844">interface</span><span class="op" id="5952853">{</span><span class="op" id="5952854">}</span><span class="op" id="5952855">)</span>&nbsp;<span class="op" id="5952857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952860">const</span>&nbsp;<span class="ident" id="5952866">dots</span>&nbsp;<span class="op" id="5952871">=</span>&nbsp;<span class="string" id="5952873">&#34;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952941">const</span>&nbsp;<span class="ident" id="5952947">n</span>&nbsp;<span class="op" id="5952949">=</span>&nbsp;<span class="builtinfunc" id="5952951">len</span><span class="op" id="5952954">(</span><span class="ident" id="5952955">dots</span><span class="op" id="5952959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952962">pos</span>&nbsp;<span class="op" id="5952966">:=</span>&nbsp;<span class="ident" id="5952969">p</span><span class="op" id="5952970">.</span><span class="ident" id="5952971">file</span><span class="op" id="5952975">.</span><span class="ident" id="5952976">Position</span><span class="op" id="5952984">(</span><span class="ident" id="5952985">p</span><span class="op" id="5952986">.</span><span class="ident" id="5952987">pos</span><span class="op" id="5952990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952993">fmt</span><span class="op" id="5952996">.</span><span class="ident" id="5952997">Printf</span><span class="op" id="5953003">(</span><span class="string" id="5953004">&#34;%5d:%3d:&nbsp;&#34;</span><span class="op" id="5953015">,</span>&nbsp;<span class="ident" id="5953017">pos</span><span class="op" id="5953020">.</span><span class="ident" id="5953021">Line</span><span class="op" id="5953025">,</span>&nbsp;<span class="ident" id="5953027">pos</span><span class="op" id="5953030">.</span><span class="ident" id="5953031">Column</span><span class="op" id="5953037">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953040">i</span>&nbsp;<span class="op" id="5953042">:=</span>&nbsp;<span class="num" id="5953045">2</span>&nbsp;<span class="op" id="5953047">*</span>&nbsp;<span class="ident" id="5953049">p</span><span class="op" id="5953050">.</span><span class="ident" id="5953051">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953059">for</span>&nbsp;<span class="ident" id="5953063">i</span>&nbsp;<span class="op" id="5953065">&gt;</span>&nbsp;<span class="ident" id="5953067">n</span>&nbsp;<span class="op" id="5953069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953073">fmt</span><span class="op" id="5953076">.</span><span class="ident" id="5953077">Print</span><span class="op" id="5953082">(</span><span class="ident" id="5953083">dots</span><span class="op" id="5953087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953091">i</span>&nbsp;<span class="op" id="5953093">-=</span>&nbsp;<span class="ident" id="5953096">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953099">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953102">//&nbsp;i&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953113">fmt</span><span class="op" id="5953116">.</span><span class="ident" id="5953117">Print</span><span class="op" id="5953122">(</span><span class="ident" id="5953123">dots</span><span class="op" id="5953127">[</span><span class="num" id="5953128">0</span><span class="op" id="5953129">:</span><span class="ident" id="5953130">i</span><span class="op" id="5953131">]</span><span class="op" id="5953132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953135">fmt</span><span class="op" id="5953138">.</span><span class="ident" id="5953139">Println</span><span class="op" id="5953146">(</span><span class="ident" id="5953147">a</span><span class="op" id="5953148">...</span><span class="op" id="5953151">)</span><br>
<span class="lineno"></span><span class="op" id="5953153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="keyword" id="5953156">func</span>&nbsp;<span class="ident" id="5953161">trace</span><span class="op" id="5953166">(</span><span class="ident" id="5953167">p</span>&nbsp;<span class="op" id="5953169">*</span><span class="ident" id="5953170">parser</span><span class="op" id="5953176">,</span>&nbsp;<span class="ident" id="5953178">msg</span>&nbsp;<span class="builtintype" id="5953182">string</span><span class="op" id="5953188">)</span>&nbsp;<span class="op" id="5953190">*</span><span class="ident" id="5953191">parser</span>&nbsp;<span class="op" id="5953198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953201">p</span><span class="op" id="5953202">.</span><span class="ident" id="5953203">printTrace</span><span class="op" id="5953213">(</span><span class="ident" id="5953214">msg</span><span class="op" id="5953217">,</span>&nbsp;<span class="string" id="5953219">&#34;(&#34;</span><span class="op" id="5953222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953225">p</span><span class="op" id="5953226">.</span><span class="ident" id="5953227">indent</span><span class="op" id="5953233">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953237">return</span>&nbsp;<span class="ident" id="5953244">p</span><br>
<span class="lineno"></span><span class="op" id="5953246">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="5953249">//&nbsp;Usage&nbsp;pattern:&nbsp;defer&nbsp;un(trace(p,&nbsp;&#34;...&#34;))</span><br>
<span class="lineno"></span><span class="keyword" id="5953293">func</span>&nbsp;<span class="ident" id="5953298">un</span><span class="op" id="5953300">(</span><span class="ident" id="5953301">p</span>&nbsp;<span class="op" id="5953303">*</span><span class="ident" id="5953304">parser</span><span class="op" id="5953310">)</span>&nbsp;<span class="op" id="5953312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953315">p</span><span class="op" id="5953316">.</span><span class="ident" id="5953317">indent</span><span class="op" id="5953323">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953327">p</span><span class="op" id="5953328">.</span><span class="ident" id="5953329">printTrace</span><span class="op" id="5953339">(</span><span class="string" id="5953340">&#34;)&#34;</span><span class="op" id="5953343">)</span><br>
<span class="lineno">230</span><span class="op" id="5953345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5953348">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="5953378">func</span>&nbsp;<span class="op" id="5953383">(</span><span class="ident" id="5953384">p</span>&nbsp;<span class="op" id="5953386">*</span><span class="ident" id="5953387">parser</span><span class="op" id="5953393">)</span>&nbsp;<span class="ident" id="5953395">next0</span><span class="op" id="5953400">(</span><span class="op" id="5953401">)</span>&nbsp;<span class="op" id="5953403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953406">//&nbsp;Because&nbsp;of&nbsp;one-token&nbsp;look-ahead,&nbsp;print&nbsp;the&nbsp;previous&nbsp;token</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953468">//&nbsp;when&nbsp;tracing&nbsp;as&nbsp;it&nbsp;provides&nbsp;a&nbsp;more&nbsp;readable&nbsp;output.&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953528">//&nbsp;very&nbsp;first&nbsp;token&nbsp;(!p.pos.IsValid())&nbsp;is&nbsp;not&nbsp;initialized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953587">//&nbsp;(it&nbsp;is&nbsp;token.ILLEGAL),&nbsp;so&nbsp;don&#39;t&nbsp;print&nbsp;it&nbsp;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953634">if</span>&nbsp;<span class="ident" id="5953637">p</span><span class="op" id="5953638">.</span><span class="ident" id="5953639">trace</span>&nbsp;<span class="op" id="5953645">&amp;&amp;</span>&nbsp;<span class="ident" id="5953648">p</span><span class="op" id="5953649">.</span><span class="ident" id="5953650">pos</span><span class="op" id="5953653">.</span><span class="ident" id="5953654">IsValid</span><span class="op" id="5953661">(</span><span class="op" id="5953662">)</span>&nbsp;<span class="op" id="5953664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953668">s</span>&nbsp;<span class="op" id="5953670">:=</span>&nbsp;<span class="ident" id="5953673">p</span><span class="op" id="5953674">.</span><span class="ident" id="5953675">tok</span><span class="op" id="5953678">.</span><span class="ident" id="5953679">String</span><span class="op" id="5953685">(</span><span class="op" id="5953686">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953690">switch</span>&nbsp;<span class="op" id="5953697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953701">case</span>&nbsp;<span class="ident" id="5953706">p</span><span class="op" id="5953707">.</span><span class="ident" id="5953708">tok</span><span class="op" id="5953711">.</span><span class="ident" id="5953712">IsLiteral</span><span class="op" id="5953721">(</span><span class="op" id="5953722">)</span><span class="op" id="5953723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953728">p</span><span class="op" id="5953729">.</span><span class="ident" id="5953730">printTrace</span><span class="op" id="5953740">(</span><span class="ident" id="5953741">s</span><span class="op" id="5953742">,</span>&nbsp;<span class="ident" id="5953744">p</span><span class="op" id="5953745">.</span><span class="ident" id="5953746">lit</span><span class="op" id="5953749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953753">case</span>&nbsp;<span class="ident" id="5953758">p</span><span class="op" id="5953759">.</span><span class="ident" id="5953760">tok</span><span class="op" id="5953763">.</span><span class="ident" id="5953764">IsOperator</span><span class="op" id="5953774">(</span><span class="op" id="5953775">)</span><span class="op" id="5953776">,</span>&nbsp;<span class="ident" id="5953778">p</span><span class="op" id="5953779">.</span><span class="ident" id="5953780">tok</span><span class="op" id="5953783">.</span><span class="ident" id="5953784">IsKeyword</span><span class="op" id="5953793">(</span><span class="op" id="5953794">)</span><span class="op" id="5953795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953800">p</span><span class="op" id="5953801">.</span><span class="ident" id="5953802">printTrace</span><span class="op" id="5953812">(</span><span class="string" id="5953813">&#34;\&#34;&#34;</span>&nbsp;<span class="op" id="5953818">+</span>&nbsp;<span class="ident" id="5953820">s</span>&nbsp;<span class="op" id="5953822">+</span>&nbsp;<span class="string" id="5953824">&#34;\&#34;&#34;</span><span class="op" id="5953828">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953832">default</span><span class="op" id="5953839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953844">p</span><span class="op" id="5953845">.</span><span class="ident" id="5953846">printTrace</span><span class="op" id="5953856">(</span><span class="ident" id="5953857">s</span><span class="op" id="5953858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953869">p</span><span class="op" id="5953870">.</span><span class="ident" id="5953871">pos</span><span class="op" id="5953874">,</span>&nbsp;<span class="ident" id="5953876">p</span><span class="op" id="5953877">.</span><span class="ident" id="5953878">tok</span><span class="op" id="5953881">,</span>&nbsp;<span class="ident" id="5953883">p</span><span class="op" id="5953884">.</span><span class="ident" id="5953885">lit</span>&nbsp;<span class="op" id="5953889">=</span>&nbsp;<span class="ident" id="5953891">p</span><span class="op" id="5953892">.</span><span class="ident" id="5953893">scanner</span><span class="op" id="5953900">.</span><span class="ident" id="5953901">Scan</span><span class="op" id="5953905">(</span><span class="op" id="5953906">)</span><br>
<span class="lineno"></span><span class="op" id="5953908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5953911">//&nbsp;Consume&nbsp;a&nbsp;comment&nbsp;and&nbsp;return&nbsp;it&nbsp;and&nbsp;the&nbsp;line&nbsp;on&nbsp;which&nbsp;it&nbsp;ends.</span><br>
<span class="lineno"></span><span class="keyword" id="5953977">func</span>&nbsp;<span class="op" id="5953982">(</span><span class="ident" id="5953983">p</span>&nbsp;<span class="op" id="5953985">*</span><span class="ident" id="5953986">parser</span><span class="op" id="5953992">)</span>&nbsp;<span class="ident" id="5953994">consumeComment</span><span class="op" id="5954008">(</span><span class="op" id="5954009">)</span>&nbsp;<span class="op" id="5954011">(</span><span class="ident" id="5954012">comment</span>&nbsp;<span class="op" id="5954020">*</span><span class="ident" id="5954021">ast</span><span class="op" id="5954024">.</span><span class="ident" id="5954025">Comment</span><span class="op" id="5954032">,</span>&nbsp;<span class="ident" id="5954034">endline</span>&nbsp;<span class="builtintype" id="5954042">int</span><span class="op" id="5954045">)</span>&nbsp;<span class="op" id="5954047">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954050">//&nbsp;/*-style&nbsp;comments&nbsp;may&nbsp;end&nbsp;on&nbsp;a&nbsp;different&nbsp;line&nbsp;than&nbsp;where&nbsp;they&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954123">//&nbsp;Scan&nbsp;the&nbsp;comment&nbsp;for&nbsp;&#39;\n&#39;&nbsp;chars&nbsp;and&nbsp;adjust&nbsp;endline&nbsp;accordingly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954191">endline</span>&nbsp;<span class="op" id="5954199">=</span>&nbsp;<span class="ident" id="5954201">p</span><span class="op" id="5954202">.</span><span class="ident" id="5954203">file</span><span class="op" id="5954207">.</span><span class="ident" id="5954208">Line</span><span class="op" id="5954212">(</span><span class="ident" id="5954213">p</span><span class="op" id="5954214">.</span><span class="ident" id="5954215">pos</span><span class="op" id="5954218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954221">if</span>&nbsp;<span class="ident" id="5954224">p</span><span class="op" id="5954225">.</span><span class="ident" id="5954226">lit</span><span class="op" id="5954229">[</span><span class="num" id="5954230">1</span><span class="op" id="5954231">]</span>&nbsp;<span class="op" id="5954233">==</span>&nbsp;<span class="string" id="5954236">&#39;*&#39;</span>&nbsp;<span class="op" id="5954240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954244">//&nbsp;don&#39;t&nbsp;use&nbsp;range&nbsp;here&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;decode&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954310">for</span>&nbsp;<span class="ident" id="5954314">i</span>&nbsp;<span class="op" id="5954316">:=</span>&nbsp;<span class="num" id="5954319">0</span><span class="op" id="5954320">;</span>&nbsp;<span class="ident" id="5954322">i</span>&nbsp;<span class="op" id="5954324">&lt;</span>&nbsp;<span class="builtinfunc" id="5954326">len</span><span class="op" id="5954329">(</span><span class="ident" id="5954330">p</span><span class="op" id="5954331">.</span><span class="ident" id="5954332">lit</span><span class="op" id="5954335">)</span><span class="op" id="5954336">;</span>&nbsp;<span class="ident" id="5954338">i</span><span class="op" id="5954339">++</span>&nbsp;<span class="op" id="5954342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954347">if</span>&nbsp;<span class="ident" id="5954350">p</span><span class="op" id="5954351">.</span><span class="ident" id="5954352">lit</span><span class="op" id="5954355">[</span><span class="ident" id="5954356">i</span><span class="op" id="5954357">]</span>&nbsp;<span class="op" id="5954359">==</span>&nbsp;<span class="string" id="5954362">&#39;\n&#39;</span>&nbsp;<span class="op" id="5954367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954373">endline</span><span class="op" id="5954380">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954390">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954397">comment</span>&nbsp;<span class="op" id="5954405">=</span>&nbsp;<span class="op" id="5954407">&amp;</span><span class="ident" id="5954408">ast</span><span class="op" id="5954411">.</span><span class="ident" id="5954412">Comment</span><span class="op" id="5954419">{</span><span class="ident" id="5954420">Slash</span><span class="op" id="5954425">:</span>&nbsp;<span class="ident" id="5954427">p</span><span class="op" id="5954428">.</span><span class="ident" id="5954429">pos</span><span class="op" id="5954432">,</span>&nbsp;<span class="ident" id="5954434">Text</span><span class="op" id="5954438">:</span>&nbsp;<span class="ident" id="5954440">p</span><span class="op" id="5954441">.</span><span class="ident" id="5954442">lit</span><span class="op" id="5954445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954448">p</span><span class="op" id="5954449">.</span><span class="ident" id="5954450">next0</span><span class="op" id="5954455">(</span><span class="op" id="5954456">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954460">return</span><br>
<span class="lineno"></span><span class="op" id="5954467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5954470">//&nbsp;Consume&nbsp;a&nbsp;group&nbsp;of&nbsp;adjacent&nbsp;comments,&nbsp;add&nbsp;it&nbsp;to&nbsp;the&nbsp;parser&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5954534">//&nbsp;comments&nbsp;list,&nbsp;and&nbsp;return&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;line&nbsp;at&nbsp;which</span><br>
<span class="lineno">275</span><span class="comment" id="5954598">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;in&nbsp;the&nbsp;group&nbsp;ends.&nbsp;A&nbsp;non-comment&nbsp;token&nbsp;or&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5954662">//&nbsp;empty&nbsp;lines&nbsp;terminate&nbsp;a&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="5954704">//</span><br>
<span class="lineno"></span><span class="keyword" id="5954707">func</span>&nbsp;<span class="op" id="5954712">(</span><span class="ident" id="5954713">p</span>&nbsp;<span class="op" id="5954715">*</span><span class="ident" id="5954716">parser</span><span class="op" id="5954722">)</span>&nbsp;<span class="ident" id="5954724">consumeCommentGroup</span><span class="op" id="5954743">(</span><span class="ident" id="5954744">n</span>&nbsp;<span class="builtintype" id="5954746">int</span><span class="op" id="5954749">)</span>&nbsp;<span class="op" id="5954751">(</span><span class="ident" id="5954752">comments</span>&nbsp;<span class="op" id="5954761">*</span><span class="ident" id="5954762">ast</span><span class="op" id="5954765">.</span><span class="ident" id="5954766">CommentGroup</span><span class="op" id="5954778">,</span>&nbsp;<span class="ident" id="5954780">endline</span>&nbsp;<span class="builtintype" id="5954788">int</span><span class="op" id="5954791">)</span>&nbsp;<span class="op" id="5954793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954796">var</span>&nbsp;<span class="ident" id="5954800">list</span>&nbsp;<span class="op" id="5954805">[</span><span class="op" id="5954806">]</span><span class="op" id="5954807">*</span><span class="ident" id="5954808">ast</span><span class="op" id="5954811">.</span><span class="ident" id="5954812">Comment</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954821">endline</span>&nbsp;<span class="op" id="5954829">=</span>&nbsp;<span class="ident" id="5954831">p</span><span class="op" id="5954832">.</span><span class="ident" id="5954833">file</span><span class="op" id="5954837">.</span><span class="ident" id="5954838">Line</span><span class="op" id="5954842">(</span><span class="ident" id="5954843">p</span><span class="op" id="5954844">.</span><span class="ident" id="5954845">pos</span><span class="op" id="5954848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954851">for</span>&nbsp;<span class="ident" id="5954855">p</span><span class="op" id="5954856">.</span><span class="ident" id="5954857">tok</span>&nbsp;<span class="op" id="5954861">==</span>&nbsp;<span class="ident" id="5954864">token</span><span class="op" id="5954869">.</span><span class="ident" id="5954870">COMMENT</span>&nbsp;<span class="op" id="5954878">&amp;&amp;</span>&nbsp;<span class="ident" id="5954881">p</span><span class="op" id="5954882">.</span><span class="ident" id="5954883">file</span><span class="op" id="5954887">.</span><span class="ident" id="5954888">Line</span><span class="op" id="5954892">(</span><span class="ident" id="5954893">p</span><span class="op" id="5954894">.</span><span class="ident" id="5954895">pos</span><span class="op" id="5954898">)</span>&nbsp;<span class="op" id="5954900">&lt;=</span>&nbsp;<span class="ident" id="5954903">endline</span><span class="op" id="5954910">+</span><span class="ident" id="5954911">n</span>&nbsp;<span class="op" id="5954913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954917">var</span>&nbsp;<span class="ident" id="5954921">comment</span>&nbsp;<span class="op" id="5954929">*</span><span class="ident" id="5954930">ast</span><span class="op" id="5954933">.</span><span class="ident" id="5954934">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954944">comment</span><span class="op" id="5954951">,</span>&nbsp;<span class="ident" id="5954953">endline</span>&nbsp;<span class="op" id="5954961">=</span>&nbsp;<span class="ident" id="5954963">p</span><span class="op" id="5954964">.</span><span class="ident" id="5954965">consumeComment</span><span class="op" id="5954979">(</span><span class="op" id="5954980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954984">list</span>&nbsp;<span class="op" id="5954989">=</span>&nbsp;<span class="builtinfunc" id="5954991">append</span><span class="op" id="5954997">(</span><span class="ident" id="5954998">list</span><span class="op" id="5955002">,</span>&nbsp;<span class="ident" id="5955004">comment</span><span class="op" id="5955011">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955018">//&nbsp;add&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;comments&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955061">comments</span>&nbsp;<span class="op" id="5955070">=</span>&nbsp;<span class="op" id="5955072">&amp;</span><span class="ident" id="5955073">ast</span><span class="op" id="5955076">.</span><span class="ident" id="5955077">CommentGroup</span><span class="op" id="5955089">{</span><span class="ident" id="5955090">List</span><span class="op" id="5955094">:</span>&nbsp;<span class="ident" id="5955096">list</span><span class="op" id="5955100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955103">p</span><span class="op" id="5955104">.</span><span class="ident" id="5955105">comments</span>&nbsp;<span class="op" id="5955114">=</span>&nbsp;<span class="builtinfunc" id="5955116">append</span><span class="op" id="5955122">(</span><span class="ident" id="5955123">p</span><span class="op" id="5955124">.</span><span class="ident" id="5955125">comments</span><span class="op" id="5955133">,</span>&nbsp;<span class="ident" id="5955135">comments</span><span class="op" id="5955143">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955147">return</span><br>
<span class="lineno"></span><span class="op" id="5955154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5955157">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;non-comment&nbsp;token.&nbsp;In&nbsp;the&nbsp;process,&nbsp;collect</span><br>
<span class="lineno">295</span><span class="comment" id="5955223">//&nbsp;any&nbsp;comment&nbsp;groups&nbsp;encountered,&nbsp;and&nbsp;remember&nbsp;the&nbsp;last&nbsp;lead&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5955289">//&nbsp;and&nbsp;line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5955311">//</span><br>
<span class="lineno"></span><span class="comment" id="5955314">//&nbsp;A&nbsp;lead&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;starts&nbsp;and&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5955377">//&nbsp;line&nbsp;without&nbsp;any&nbsp;other&nbsp;tokens&nbsp;and&nbsp;that&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno">300</span><span class="comment" id="5955448">//&nbsp;token&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="5955506">//</span><br>
<span class="lineno"></span><span class="comment" id="5955509">//&nbsp;A&nbsp;line&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;follows&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno"></span><span class="comment" id="5955573">//&nbsp;token&nbsp;on&nbsp;the&nbsp;same&nbsp;line,&nbsp;and&nbsp;that&nbsp;has&nbsp;no&nbsp;tokens&nbsp;after&nbsp;it&nbsp;on&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5955644">//&nbsp;where&nbsp;it&nbsp;ends.</span><br>
<span class="lineno">305</span><span class="comment" id="5955662">//</span><br>
<span class="lineno"></span><span class="comment" id="5955665">//&nbsp;Lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;may&nbsp;be&nbsp;considered&nbsp;documentation&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5955731">//&nbsp;stored&nbsp;in&nbsp;the&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="5955753">//</span><br>
<span class="lineno"></span><span class="keyword" id="5955756">func</span>&nbsp;<span class="op" id="5955761">(</span><span class="ident" id="5955762">p</span>&nbsp;<span class="op" id="5955764">*</span><span class="ident" id="5955765">parser</span><span class="op" id="5955771">)</span>&nbsp;<span class="ident" id="5955773">next</span><span class="op" id="5955777">(</span><span class="op" id="5955778">)</span>&nbsp;<span class="op" id="5955780">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955783">p</span><span class="op" id="5955784">.</span><span class="ident" id="5955785">leadComment</span>&nbsp;<span class="op" id="5955797">=</span>&nbsp;<span class="ident" id="5955799">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955804">p</span><span class="op" id="5955805">.</span><span class="ident" id="5955806">lineComment</span>&nbsp;<span class="op" id="5955818">=</span>&nbsp;<span class="ident" id="5955820">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955825">prev</span>&nbsp;<span class="op" id="5955830">:=</span>&nbsp;<span class="ident" id="5955833">p</span><span class="op" id="5955834">.</span><span class="ident" id="5955835">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955840">p</span><span class="op" id="5955841">.</span><span class="ident" id="5955842">next0</span><span class="op" id="5955847">(</span><span class="op" id="5955848">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955852">if</span>&nbsp;<span class="ident" id="5955855">p</span><span class="op" id="5955856">.</span><span class="ident" id="5955857">tok</span>&nbsp;<span class="op" id="5955861">==</span>&nbsp;<span class="ident" id="5955864">token</span><span class="op" id="5955869">.</span><span class="ident" id="5955870">COMMENT</span>&nbsp;<span class="op" id="5955878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955882">var</span>&nbsp;<span class="ident" id="5955886">comment</span>&nbsp;<span class="op" id="5955894">*</span><span class="ident" id="5955895">ast</span><span class="op" id="5955898">.</span><span class="ident" id="5955899">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955914">var</span>&nbsp;<span class="ident" id="5955918">endline</span>&nbsp;<span class="builtintype" id="5955926">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955933">if</span>&nbsp;<span class="ident" id="5955936">p</span><span class="op" id="5955937">.</span><span class="ident" id="5955938">file</span><span class="op" id="5955942">.</span><span class="ident" id="5955943">Line</span><span class="op" id="5955947">(</span><span class="ident" id="5955948">p</span><span class="op" id="5955949">.</span><span class="ident" id="5955950">pos</span><span class="op" id="5955953">)</span>&nbsp;<span class="op" id="5955955">==</span>&nbsp;<span class="ident" id="5955958">p</span><span class="op" id="5955959">.</span><span class="ident" id="5955960">file</span><span class="op" id="5955964">.</span><span class="ident" id="5955965">Line</span><span class="op" id="5955969">(</span><span class="ident" id="5955970">prev</span><span class="op" id="5955974">)</span>&nbsp;<span class="op" id="5955976">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955981">//&nbsp;The&nbsp;comment&nbsp;is&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;token;&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956041">//&nbsp;cannot&nbsp;be&nbsp;a&nbsp;lead&nbsp;comment&nbsp;but&nbsp;may&nbsp;be&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956099">comment</span><span class="op" id="5956106">,</span>&nbsp;<span class="ident" id="5956108">endline</span>&nbsp;<span class="op" id="5956116">=</span>&nbsp;<span class="ident" id="5956118">p</span><span class="op" id="5956119">.</span><span class="ident" id="5956120">consumeCommentGroup</span><span class="op" id="5956139">(</span><span class="num" id="5956140">0</span><span class="op" id="5956141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956146">if</span>&nbsp;<span class="ident" id="5956149">p</span><span class="op" id="5956150">.</span><span class="ident" id="5956151">file</span><span class="op" id="5956155">.</span><span class="ident" id="5956156">Line</span><span class="op" id="5956160">(</span><span class="ident" id="5956161">p</span><span class="op" id="5956162">.</span><span class="ident" id="5956163">pos</span><span class="op" id="5956166">)</span>&nbsp;<span class="op" id="5956168">!=</span>&nbsp;<span class="ident" id="5956171">endline</span>&nbsp;<span class="op" id="5956179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956185">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;different&nbsp;line,&nbsp;thus</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956236">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956285">p</span><span class="op" id="5956286">.</span><span class="ident" id="5956287">lineComment</span>&nbsp;<span class="op" id="5956299">=</span>&nbsp;<span class="ident" id="5956301">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956321">//&nbsp;consume&nbsp;successor&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956361">endline</span>&nbsp;<span class="op" id="5956369">=</span>&nbsp;<span class="op" id="5956371">-</span><span class="num" id="5956372">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956376">for</span>&nbsp;<span class="ident" id="5956380">p</span><span class="op" id="5956381">.</span><span class="ident" id="5956382">tok</span>&nbsp;<span class="op" id="5956386">==</span>&nbsp;<span class="ident" id="5956389">token</span><span class="op" id="5956394">.</span><span class="ident" id="5956395">COMMENT</span>&nbsp;<span class="op" id="5956403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956408">comment</span><span class="op" id="5956415">,</span>&nbsp;<span class="ident" id="5956417">endline</span>&nbsp;<span class="op" id="5956425">=</span>&nbsp;<span class="ident" id="5956427">p</span><span class="op" id="5956428">.</span><span class="ident" id="5956429">consumeCommentGroup</span><span class="op" id="5956448">(</span><span class="num" id="5956449">1</span><span class="op" id="5956450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956454">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956459">if</span>&nbsp;<span class="ident" id="5956462">endline</span><span class="op" id="5956469">+</span><span class="num" id="5956470">1</span>&nbsp;<span class="op" id="5956472">==</span>&nbsp;<span class="ident" id="5956475">p</span><span class="op" id="5956476">.</span><span class="ident" id="5956477">file</span><span class="op" id="5956481">.</span><span class="ident" id="5956482">Line</span><span class="op" id="5956486">(</span><span class="ident" id="5956487">p</span><span class="op" id="5956488">.</span><span class="ident" id="5956489">pos</span><span class="op" id="5956492">)</span>&nbsp;<span class="op" id="5956494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956499">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;following&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956567">//&nbsp;comment&nbsp;group,&nbsp;thus&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;lead&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956635">p</span><span class="op" id="5956636">.</span><span class="ident" id="5956637">leadComment</span>&nbsp;<span class="op" id="5956649">=</span>&nbsp;<span class="ident" id="5956651">comment</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956664">}</span><br>
<span class="lineno"></span><span class="op" id="5956666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5956669">//&nbsp;A&nbsp;bailout&nbsp;panic&nbsp;is&nbsp;raised&nbsp;to&nbsp;indicate&nbsp;early&nbsp;termination.</span><br>
<span class="lineno">345</span><span class="keyword" id="5956729">type</span>&nbsp;<span class="ident" id="5956734">bailout</span>&nbsp;<span class="keyword" id="5956742">struct</span><span class="op" id="5956748">{</span><span class="op" id="5956749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5956752">func</span>&nbsp;<span class="op" id="5956757">(</span><span class="ident" id="5956758">p</span>&nbsp;<span class="op" id="5956760">*</span><span class="ident" id="5956761">parser</span><span class="op" id="5956767">)</span>&nbsp;<span class="builtintype" id="5956769">error</span><span class="op" id="5956774">(</span><span class="ident" id="5956775">pos</span>&nbsp;<span class="ident" id="5956779">token</span><span class="op" id="5956784">.</span><span class="ident" id="5956785">Pos</span><span class="op" id="5956788">,</span>&nbsp;<span class="ident" id="5956790">msg</span>&nbsp;<span class="builtintype" id="5956794">string</span><span class="op" id="5956800">)</span>&nbsp;<span class="op" id="5956802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956805">epos</span>&nbsp;<span class="op" id="5956810">:=</span>&nbsp;<span class="ident" id="5956813">p</span><span class="op" id="5956814">.</span><span class="ident" id="5956815">file</span><span class="op" id="5956819">.</span><span class="ident" id="5956820">Position</span><span class="op" id="5956828">(</span><span class="ident" id="5956829">pos</span><span class="op" id="5956832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956836">//&nbsp;If&nbsp;AllErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;discard&nbsp;errors&nbsp;reported&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956906">//&nbsp;as&nbsp;the&nbsp;last&nbsp;recorded&nbsp;error&nbsp;and&nbsp;stop&nbsp;parsing&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956977">//&nbsp;10&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956992">if</span>&nbsp;<span class="ident" id="5956995">p</span><span class="op" id="5956996">.</span><span class="ident" id="5956997">mode</span><span class="op" id="5957001">&amp;</span><span class="ident" id="5957002">AllErrors</span>&nbsp;<span class="op" id="5957012">==</span>&nbsp;<span class="num" id="5957015">0</span>&nbsp;<span class="op" id="5957017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957021">n</span>&nbsp;<span class="op" id="5957023">:=</span>&nbsp;<span class="builtinfunc" id="5957026">len</span><span class="op" id="5957029">(</span><span class="ident" id="5957030">p</span><span class="op" id="5957031">.</span><span class="ident" id="5957032">errors</span><span class="op" id="5957038">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957042">if</span>&nbsp;<span class="ident" id="5957045">n</span>&nbsp;<span class="op" id="5957047">&gt;</span>&nbsp;<span class="num" id="5957049">0</span>&nbsp;<span class="op" id="5957051">&amp;&amp;</span>&nbsp;<span class="ident" id="5957054">p</span><span class="op" id="5957055">.</span><span class="ident" id="5957056">errors</span><span class="op" id="5957062">[</span><span class="ident" id="5957063">n</span><span class="op" id="5957064">-</span><span class="num" id="5957065">1</span><span class="op" id="5957066">]</span><span class="op" id="5957067">.</span><span class="ident" id="5957068">Pos</span><span class="op" id="5957071">.</span><span class="ident" id="5957072">Line</span>&nbsp;<span class="op" id="5957077">==</span>&nbsp;<span class="ident" id="5957080">epos</span><span class="op" id="5957084">.</span><span class="ident" id="5957085">Line</span>&nbsp;<span class="op" id="5957090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957095">return</span>&nbsp;<span class="comment" id="5957102">//&nbsp;discard&nbsp;-&nbsp;likely&nbsp;a&nbsp;spurious&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957145">if</span>&nbsp;<span class="ident" id="5957148">n</span>&nbsp;<span class="op" id="5957150">&gt;</span>&nbsp;<span class="num" id="5957152">10</span>&nbsp;<span class="op" id="5957155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5957160">panic</span><span class="op" id="5957165">(</span><span class="ident" id="5957166">bailout</span><span class="op" id="5957173">{</span><span class="op" id="5957174">}</span><span class="op" id="5957175">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957186">p</span><span class="op" id="5957187">.</span><span class="ident" id="5957188">errors</span><span class="op" id="5957194">.</span><span class="ident" id="5957195">Add</span><span class="op" id="5957198">(</span><span class="ident" id="5957199">epos</span><span class="op" id="5957203">,</span>&nbsp;<span class="ident" id="5957205">msg</span><span class="op" id="5957208">)</span><br>
<span class="lineno"></span><span class="op" id="5957210">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="5957213">func</span>&nbsp;<span class="op" id="5957218">(</span><span class="ident" id="5957219">p</span>&nbsp;<span class="op" id="5957221">*</span><span class="ident" id="5957222">parser</span><span class="op" id="5957228">)</span>&nbsp;<span class="ident" id="5957230">errorExpected</span><span class="op" id="5957243">(</span><span class="ident" id="5957244">pos</span>&nbsp;<span class="ident" id="5957248">token</span><span class="op" id="5957253">.</span><span class="ident" id="5957254">Pos</span><span class="op" id="5957257">,</span>&nbsp;<span class="ident" id="5957259">msg</span>&nbsp;<span class="builtintype" id="5957263">string</span><span class="op" id="5957269">)</span>&nbsp;<span class="op" id="5957271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957274">msg</span>&nbsp;<span class="op" id="5957278">=</span>&nbsp;<span class="string" id="5957280">&#34;expected&nbsp;&#34;</span>&nbsp;<span class="op" id="5957292">+</span>&nbsp;<span class="ident" id="5957294">msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957299">if</span>&nbsp;<span class="ident" id="5957302">pos</span>&nbsp;<span class="op" id="5957306">==</span>&nbsp;<span class="ident" id="5957309">p</span><span class="op" id="5957310">.</span><span class="ident" id="5957311">pos</span>&nbsp;<span class="op" id="5957315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957319">//&nbsp;the&nbsp;error&nbsp;happened&nbsp;at&nbsp;the&nbsp;current&nbsp;position;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957368">//&nbsp;make&nbsp;the&nbsp;error&nbsp;message&nbsp;more&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957410">if</span>&nbsp;<span class="ident" id="5957413">p</span><span class="op" id="5957414">.</span><span class="ident" id="5957415">tok</span>&nbsp;<span class="op" id="5957419">==</span>&nbsp;<span class="ident" id="5957422">token</span><span class="op" id="5957427">.</span><span class="ident" id="5957428">SEMICOLON</span>&nbsp;<span class="op" id="5957438">&amp;&amp;</span>&nbsp;<span class="ident" id="5957441">p</span><span class="op" id="5957442">.</span><span class="ident" id="5957443">lit</span>&nbsp;<span class="op" id="5957447">==</span>&nbsp;<span class="string" id="5957450">&#34;\n&#34;</span>&nbsp;<span class="op" id="5957455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957460">msg</span>&nbsp;<span class="op" id="5957464">+=</span>&nbsp;<span class="string" id="5957467">&#34;,&nbsp;found&nbsp;newline&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957487">}</span>&nbsp;<span class="keyword" id="5957489">else</span>&nbsp;<span class="op" id="5957494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957499">msg</span>&nbsp;<span class="op" id="5957503">+=</span>&nbsp;<span class="string" id="5957506">&#34;,&nbsp;found&nbsp;&#39;&#34;</span>&nbsp;<span class="op" id="5957518">+</span>&nbsp;<span class="ident" id="5957520">p</span><span class="op" id="5957521">.</span><span class="ident" id="5957522">tok</span><span class="op" id="5957525">.</span><span class="ident" id="5957526">String</span><span class="op" id="5957532">(</span><span class="op" id="5957533">)</span>&nbsp;<span class="op" id="5957535">+</span>&nbsp;<span class="string" id="5957537">&#34;&#39;&#34;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957544">if</span>&nbsp;<span class="ident" id="5957547">p</span><span class="op" id="5957548">.</span><span class="ident" id="5957549">tok</span><span class="op" id="5957552">.</span><span class="ident" id="5957553">IsLiteral</span><span class="op" id="5957562">(</span><span class="op" id="5957563">)</span>&nbsp;<span class="op" id="5957565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957571">msg</span>&nbsp;<span class="op" id="5957575">+=</span>&nbsp;<span class="string" id="5957578">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5957582">+</span>&nbsp;<span class="ident" id="5957584">p</span><span class="op" id="5957585">.</span><span class="ident" id="5957586">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957600">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957603">p</span><span class="op" id="5957604">.</span><span class="builtintype" id="5957605">error</span><span class="op" id="5957610">(</span><span class="ident" id="5957611">pos</span><span class="op" id="5957614">,</span>&nbsp;<span class="ident" id="5957616">msg</span><span class="op" id="5957619">)</span><br>
<span class="lineno"></span><span class="op" id="5957621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5957624">func</span>&nbsp;<span class="op" id="5957629">(</span><span class="ident" id="5957630">p</span>&nbsp;<span class="op" id="5957632">*</span><span class="ident" id="5957633">parser</span><span class="op" id="5957639">)</span>&nbsp;<span class="ident" id="5957641">expect</span><span class="op" id="5957647">(</span><span class="ident" id="5957648">tok</span>&nbsp;<span class="ident" id="5957652">token</span><span class="op" id="5957657">.</span><span class="ident" id="5957658">Token</span><span class="op" id="5957663">)</span>&nbsp;<span class="ident" id="5957665">token</span><span class="op" id="5957670">.</span><span class="ident" id="5957671">Pos</span>&nbsp;<span class="op" id="5957675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957678">pos</span>&nbsp;<span class="op" id="5957682">:=</span>&nbsp;<span class="ident" id="5957685">p</span><span class="op" id="5957686">.</span><span class="ident" id="5957687">pos</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957692">if</span>&nbsp;<span class="ident" id="5957695">p</span><span class="op" id="5957696">.</span><span class="ident" id="5957697">tok</span>&nbsp;<span class="op" id="5957701">!=</span>&nbsp;<span class="ident" id="5957704">tok</span>&nbsp;<span class="op" id="5957708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957712">p</span><span class="op" id="5957713">.</span><span class="ident" id="5957714">errorExpected</span><span class="op" id="5957727">(</span><span class="ident" id="5957728">pos</span><span class="op" id="5957731">,</span>&nbsp;<span class="string" id="5957733">&#34;&#39;&#34;</span><span class="op" id="5957736">+</span><span class="ident" id="5957737">tok</span><span class="op" id="5957740">.</span><span class="ident" id="5957741">String</span><span class="op" id="5957747">(</span><span class="op" id="5957748">)</span><span class="op" id="5957749">+</span><span class="string" id="5957750">&#34;&#39;&#34;</span><span class="op" id="5957753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957759">p</span><span class="op" id="5957760">.</span><span class="ident" id="5957761">next</span><span class="op" id="5957765">(</span><span class="op" id="5957766">)</span>&nbsp;<span class="comment" id="5957768">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957786">return</span>&nbsp;<span class="ident" id="5957793">pos</span><br>
<span class="lineno">390</span><span class="op" id="5957797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5957800">//&nbsp;expectClosing&nbsp;is&nbsp;like&nbsp;expect&nbsp;but&nbsp;provides&nbsp;a&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="5957868">//&nbsp;for&nbsp;the&nbsp;common&nbsp;case&nbsp;of&nbsp;a&nbsp;missing&nbsp;comma&nbsp;before&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="comment" id="5957928">//</span><br>
<span class="lineno">395</span><span class="keyword" id="5957931">func</span>&nbsp;<span class="op" id="5957936">(</span><span class="ident" id="5957937">p</span>&nbsp;<span class="op" id="5957939">*</span><span class="ident" id="5957940">parser</span><span class="op" id="5957946">)</span>&nbsp;<span class="ident" id="5957948">expectClosing</span><span class="op" id="5957961">(</span><span class="ident" id="5957962">tok</span>&nbsp;<span class="ident" id="5957966">token</span><span class="op" id="5957971">.</span><span class="ident" id="5957972">Token</span><span class="op" id="5957977">,</span>&nbsp;<span class="ident" id="5957979">context</span>&nbsp;<span class="builtintype" id="5957987">string</span><span class="op" id="5957993">)</span>&nbsp;<span class="ident" id="5957995">token</span><span class="op" id="5958000">.</span><span class="ident" id="5958001">Pos</span>&nbsp;<span class="op" id="5958005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958008">if</span>&nbsp;<span class="ident" id="5958011">p</span><span class="op" id="5958012">.</span><span class="ident" id="5958013">tok</span>&nbsp;<span class="op" id="5958017">!=</span>&nbsp;<span class="ident" id="5958020">tok</span>&nbsp;<span class="op" id="5958024">&amp;&amp;</span>&nbsp;<span class="ident" id="5958027">p</span><span class="op" id="5958028">.</span><span class="ident" id="5958029">tok</span>&nbsp;<span class="op" id="5958033">==</span>&nbsp;<span class="ident" id="5958036">token</span><span class="op" id="5958041">.</span><span class="ident" id="5958042">SEMICOLON</span>&nbsp;<span class="op" id="5958052">&amp;&amp;</span>&nbsp;<span class="ident" id="5958055">p</span><span class="op" id="5958056">.</span><span class="ident" id="5958057">lit</span>&nbsp;<span class="op" id="5958061">==</span>&nbsp;<span class="string" id="5958064">&#34;\n&#34;</span>&nbsp;<span class="op" id="5958069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958073">p</span><span class="op" id="5958074">.</span><span class="builtintype" id="5958075">error</span><span class="op" id="5958080">(</span><span class="ident" id="5958081">p</span><span class="op" id="5958082">.</span><span class="ident" id="5958083">pos</span><span class="op" id="5958086">,</span>&nbsp;<span class="string" id="5958088">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="5958120">+</span><span class="ident" id="5958121">context</span><span class="op" id="5958128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958132">p</span><span class="op" id="5958133">.</span><span class="ident" id="5958134">next</span><span class="op" id="5958138">(</span><span class="op" id="5958139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958142">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958145">return</span>&nbsp;<span class="ident" id="5958152">p</span><span class="op" id="5958153">.</span><span class="ident" id="5958154">expect</span><span class="op" id="5958160">(</span><span class="ident" id="5958161">tok</span><span class="op" id="5958164">)</span><br>
<span class="lineno"></span><span class="op" id="5958166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5958169">func</span>&nbsp;<span class="op" id="5958174">(</span><span class="ident" id="5958175">p</span>&nbsp;<span class="op" id="5958177">*</span><span class="ident" id="5958178">parser</span><span class="op" id="5958184">)</span>&nbsp;<span class="ident" id="5958186">expectSemi</span><span class="op" id="5958196">(</span><span class="op" id="5958197">)</span>&nbsp;<span class="op" id="5958199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958202">//&nbsp;semicolon&nbsp;is&nbsp;optional&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;}&#39;</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958256">if</span>&nbsp;<span class="ident" id="5958259">p</span><span class="op" id="5958260">.</span><span class="ident" id="5958261">tok</span>&nbsp;<span class="op" id="5958265">!=</span>&nbsp;<span class="ident" id="5958268">token</span><span class="op" id="5958273">.</span><span class="ident" id="5958274">RPAREN</span>&nbsp;<span class="op" id="5958281">&amp;&amp;</span>&nbsp;<span class="ident" id="5958284">p</span><span class="op" id="5958285">.</span><span class="ident" id="5958286">tok</span>&nbsp;<span class="op" id="5958290">!=</span>&nbsp;<span class="ident" id="5958293">token</span><span class="op" id="5958298">.</span><span class="ident" id="5958299">RBRACE</span>&nbsp;<span class="op" id="5958306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958310">if</span>&nbsp;<span class="ident" id="5958313">p</span><span class="op" id="5958314">.</span><span class="ident" id="5958315">tok</span>&nbsp;<span class="op" id="5958319">==</span>&nbsp;<span class="ident" id="5958322">token</span><span class="op" id="5958327">.</span><span class="ident" id="5958328">SEMICOLON</span>&nbsp;<span class="op" id="5958338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958343">p</span><span class="op" id="5958344">.</span><span class="ident" id="5958345">next</span><span class="op" id="5958349">(</span><span class="op" id="5958350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958354">}</span>&nbsp;<span class="keyword" id="5958356">else</span>&nbsp;<span class="op" id="5958361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958366">p</span><span class="op" id="5958367">.</span><span class="ident" id="5958368">errorExpected</span><span class="op" id="5958381">(</span><span class="ident" id="5958382">p</span><span class="op" id="5958383">.</span><span class="ident" id="5958384">pos</span><span class="op" id="5958387">,</span>&nbsp;<span class="string" id="5958389">&#34;&#39;;&#39;&#34;</span><span class="op" id="5958394">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958399">syncStmt</span><span class="op" id="5958407">(</span><span class="ident" id="5958408">p</span><span class="op" id="5958409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958416">}</span><br>
<span class="lineno"></span><span class="op" id="5958418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="5958421">func</span>&nbsp;<span class="op" id="5958426">(</span><span class="ident" id="5958427">p</span>&nbsp;<span class="op" id="5958429">*</span><span class="ident" id="5958430">parser</span><span class="op" id="5958436">)</span>&nbsp;<span class="ident" id="5958438">atComma</span><span class="op" id="5958445">(</span><span class="ident" id="5958446">context</span>&nbsp;<span class="builtintype" id="5958454">string</span><span class="op" id="5958460">)</span>&nbsp;<span class="builtintype" id="5958462">bool</span>&nbsp;<span class="op" id="5958467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958470">if</span>&nbsp;<span class="ident" id="5958473">p</span><span class="op" id="5958474">.</span><span class="ident" id="5958475">tok</span>&nbsp;<span class="op" id="5958479">==</span>&nbsp;<span class="ident" id="5958482">token</span><span class="op" id="5958487">.</span><span class="ident" id="5958488">COMMA</span>&nbsp;<span class="op" id="5958494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958498">return</span>&nbsp;<span class="ident" id="5958505">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958514">if</span>&nbsp;<span class="ident" id="5958517">p</span><span class="op" id="5958518">.</span><span class="ident" id="5958519">tok</span>&nbsp;<span class="op" id="5958523">==</span>&nbsp;<span class="ident" id="5958526">token</span><span class="op" id="5958531">.</span><span class="ident" id="5958532">SEMICOLON</span>&nbsp;<span class="op" id="5958542">&amp;&amp;</span>&nbsp;<span class="ident" id="5958545">p</span><span class="op" id="5958546">.</span><span class="ident" id="5958547">lit</span>&nbsp;<span class="op" id="5958551">==</span>&nbsp;<span class="string" id="5958554">&#34;\n&#34;</span>&nbsp;<span class="op" id="5958559">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958563">p</span><span class="op" id="5958564">.</span><span class="builtintype" id="5958565">error</span><span class="op" id="5958570">(</span><span class="ident" id="5958571">p</span><span class="op" id="5958572">.</span><span class="ident" id="5958573">pos</span><span class="op" id="5958576">,</span>&nbsp;<span class="string" id="5958578">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="5958610">+</span><span class="ident" id="5958611">context</span><span class="op" id="5958618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958622">return</span>&nbsp;<span class="ident" id="5958629">true</span>&nbsp;<span class="comment" id="5958634">//&nbsp;&#34;insert&#34;&nbsp;the&nbsp;comma&nbsp;and&nbsp;continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958674">return</span>&nbsp;<span class="ident" id="5958681">false</span><br>
<span class="lineno">425</span><span class="op" id="5958687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5958690">func</span>&nbsp;<span class="ident" id="5958695">assert</span><span class="op" id="5958701">(</span><span class="ident" id="5958702">cond</span>&nbsp;<span class="builtintype" id="5958707">bool</span><span class="op" id="5958711">,</span>&nbsp;<span class="ident" id="5958713">msg</span>&nbsp;<span class="builtintype" id="5958717">string</span><span class="op" id="5958723">)</span>&nbsp;<span class="op" id="5958725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958728">if</span>&nbsp;<span class="op" id="5958731">!</span><span class="ident" id="5958732">cond</span>&nbsp;<span class="op" id="5958737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5958741">panic</span><span class="op" id="5958746">(</span><span class="string" id="5958747">&#34;go/parser&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="5958776">+</span>&nbsp;<span class="ident" id="5958778">msg</span><span class="op" id="5958781">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958784">}</span><br>
<span class="lineno"></span><span class="op" id="5958786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5958789">//&nbsp;syncStmt&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5958833">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno">435</span><span class="comment" id="5958877">//</span><br>
<span class="lineno"></span><span class="keyword" id="5958880">func</span>&nbsp;<span class="ident" id="5958885">syncStmt</span><span class="op" id="5958893">(</span><span class="ident" id="5958894">p</span>&nbsp;<span class="op" id="5958896">*</span><span class="ident" id="5958897">parser</span><span class="op" id="5958903">)</span>&nbsp;<span class="op" id="5958905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958908">for</span>&nbsp;<span class="op" id="5958912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958916">switch</span>&nbsp;<span class="ident" id="5958923">p</span><span class="op" id="5958924">.</span><span class="ident" id="5958925">tok</span>&nbsp;<span class="op" id="5958929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958933">case</span>&nbsp;<span class="ident" id="5958938">token</span><span class="op" id="5958943">.</span><span class="ident" id="5958944">BREAK</span><span class="op" id="5958949">,</span>&nbsp;<span class="ident" id="5958951">token</span><span class="op" id="5958956">.</span><span class="ident" id="5958957">CONST</span><span class="op" id="5958962">,</span>&nbsp;<span class="ident" id="5958964">token</span><span class="op" id="5958969">.</span><span class="ident" id="5958970">CONTINUE</span><span class="op" id="5958978">,</span>&nbsp;<span class="ident" id="5958980">token</span><span class="op" id="5958985">.</span><span class="ident" id="5958986">DEFER</span><span class="op" id="5958991">,</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958996">token</span><span class="op" id="5959001">.</span><span class="ident" id="5959002">FALLTHROUGH</span><span class="op" id="5959013">,</span>&nbsp;<span class="ident" id="5959015">token</span><span class="op" id="5959020">.</span><span class="ident" id="5959021">FOR</span><span class="op" id="5959024">,</span>&nbsp;<span class="ident" id="5959026">token</span><span class="op" id="5959031">.</span><span class="ident" id="5959032">GO</span><span class="op" id="5959034">,</span>&nbsp;<span class="ident" id="5959036">token</span><span class="op" id="5959041">.</span><span class="ident" id="5959042">GOTO</span><span class="op" id="5959046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959051">token</span><span class="op" id="5959056">.</span><span class="ident" id="5959057">IF</span><span class="op" id="5959059">,</span>&nbsp;<span class="ident" id="5959061">token</span><span class="op" id="5959066">.</span><span class="ident" id="5959067">RETURN</span><span class="op" id="5959073">,</span>&nbsp;<span class="ident" id="5959075">token</span><span class="op" id="5959080">.</span><span class="ident" id="5959081">SELECT</span><span class="op" id="5959087">,</span>&nbsp;<span class="ident" id="5959089">token</span><span class="op" id="5959094">.</span><span class="ident" id="5959095">SWITCH</span><span class="op" id="5959101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959106">token</span><span class="op" id="5959111">.</span><span class="ident" id="5959112">TYPE</span><span class="op" id="5959116">,</span>&nbsp;<span class="ident" id="5959118">token</span><span class="op" id="5959123">.</span><span class="ident" id="5959124">VAR</span><span class="op" id="5959127">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959132">//&nbsp;Return&nbsp;only&nbsp;if&nbsp;parser&nbsp;made&nbsp;some&nbsp;progress&nbsp;since&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959190">//&nbsp;sync&nbsp;or&nbsp;if&nbsp;it&nbsp;has&nbsp;not&nbsp;reached&nbsp;10&nbsp;sync&nbsp;calls&nbsp;without</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959248">//&nbsp;progress.&nbsp;Otherwise&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;token&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959304">//&nbsp;avoid&nbsp;an&nbsp;endless&nbsp;parser&nbsp;loop&nbsp;(it&nbsp;is&nbsp;possible&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959360">//&nbsp;both&nbsp;parseOperand&nbsp;and&nbsp;parseStmt&nbsp;call&nbsp;syncStmt&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959416">//&nbsp;correctly&nbsp;do&nbsp;not&nbsp;advance,&nbsp;thus&nbsp;the&nbsp;need&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959470">//&nbsp;invocation&nbsp;limit&nbsp;p.syncCnt).</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959505">if</span>&nbsp;<span class="ident" id="5959508">p</span><span class="op" id="5959509">.</span><span class="ident" id="5959510">pos</span>&nbsp;<span class="op" id="5959514">==</span>&nbsp;<span class="ident" id="5959517">p</span><span class="op" id="5959518">.</span><span class="ident" id="5959519">syncPos</span>&nbsp;<span class="op" id="5959527">&amp;&amp;</span>&nbsp;<span class="ident" id="5959530">p</span><span class="op" id="5959531">.</span><span class="ident" id="5959532">syncCnt</span>&nbsp;<span class="op" id="5959540">&lt;</span>&nbsp;<span class="num" id="5959542">10</span>&nbsp;<span class="op" id="5959545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959551">p</span><span class="op" id="5959552">.</span><span class="ident" id="5959553">syncCnt</span><span class="op" id="5959560">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959567">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959582">if</span>&nbsp;<span class="ident" id="5959585">p</span><span class="op" id="5959586">.</span><span class="ident" id="5959587">pos</span>&nbsp;<span class="op" id="5959591">&gt;</span>&nbsp;<span class="ident" id="5959593">p</span><span class="op" id="5959594">.</span><span class="ident" id="5959595">syncPos</span>&nbsp;<span class="op" id="5959603">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959609">p</span><span class="op" id="5959610">.</span><span class="ident" id="5959611">syncPos</span>&nbsp;<span class="op" id="5959619">=</span>&nbsp;<span class="ident" id="5959621">p</span><span class="op" id="5959622">.</span><span class="ident" id="5959623">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959631">p</span><span class="op" id="5959632">.</span><span class="ident" id="5959633">syncCnt</span>&nbsp;<span class="op" id="5959641">=</span>&nbsp;<span class="num" id="5959643">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959649">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959664">//&nbsp;Reaching&nbsp;here&nbsp;indicates&nbsp;a&nbsp;parser&nbsp;bug,&nbsp;likely&nbsp;an</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959718">//&nbsp;incorrect&nbsp;token&nbsp;list&nbsp;in&nbsp;this&nbsp;function,&nbsp;but&nbsp;it&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959775">//&nbsp;leads&nbsp;to&nbsp;skipping&nbsp;of&nbsp;possibly&nbsp;correct&nbsp;code&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959829">//&nbsp;previous&nbsp;error&nbsp;is&nbsp;present,&nbsp;and&nbsp;thus&nbsp;is&nbsp;preferred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959884">//&nbsp;over&nbsp;a&nbsp;non-terminating&nbsp;parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959919">case</span>&nbsp;<span class="ident" id="5959924">token</span><span class="op" id="5959929">.</span><span class="ident" id="5959930">EOF</span><span class="op" id="5959933">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959938">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959951">p</span><span class="op" id="5959952">.</span><span class="ident" id="5959953">next</span><span class="op" id="5959957">(</span><span class="op" id="5959958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959961">}</span><br>
<span class="lineno"></span><span class="op" id="5959963">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="5959966">//&nbsp;syncDecl&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;declaration.</span><br>
<span class="lineno"></span><span class="comment" id="5960012">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="5960056">//</span><br>
<span class="lineno"></span><span class="keyword" id="5960059">func</span>&nbsp;<span class="ident" id="5960064">syncDecl</span><span class="op" id="5960072">(</span><span class="ident" id="5960073">p</span>&nbsp;<span class="op" id="5960075">*</span><span class="ident" id="5960076">parser</span><span class="op" id="5960082">)</span>&nbsp;<span class="op" id="5960084">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960087">for</span>&nbsp;<span class="op" id="5960091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960095">switch</span>&nbsp;<span class="ident" id="5960102">p</span><span class="op" id="5960103">.</span><span class="ident" id="5960104">tok</span>&nbsp;<span class="op" id="5960108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960112">case</span>&nbsp;<span class="ident" id="5960117">token</span><span class="op" id="5960122">.</span><span class="ident" id="5960123">CONST</span><span class="op" id="5960128">,</span>&nbsp;<span class="ident" id="5960130">token</span><span class="op" id="5960135">.</span><span class="ident" id="5960136">TYPE</span><span class="op" id="5960140">,</span>&nbsp;<span class="ident" id="5960142">token</span><span class="op" id="5960147">.</span><span class="ident" id="5960148">VAR</span><span class="op" id="5960151">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960156">//&nbsp;see&nbsp;comments&nbsp;in&nbsp;syncStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960187">if</span>&nbsp;<span class="ident" id="5960190">p</span><span class="op" id="5960191">.</span><span class="ident" id="5960192">pos</span>&nbsp;<span class="op" id="5960196">==</span>&nbsp;<span class="ident" id="5960199">p</span><span class="op" id="5960200">.</span><span class="ident" id="5960201">syncPos</span>&nbsp;<span class="op" id="5960209">&amp;&amp;</span>&nbsp;<span class="ident" id="5960212">p</span><span class="op" id="5960213">.</span><span class="ident" id="5960214">syncCnt</span>&nbsp;<span class="op" id="5960222">&lt;</span>&nbsp;<span class="num" id="5960224">10</span>&nbsp;<span class="op" id="5960227">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960233">p</span><span class="op" id="5960234">.</span><span class="ident" id="5960235">syncCnt</span><span class="op" id="5960242">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960249">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960264">if</span>&nbsp;<span class="ident" id="5960267">p</span><span class="op" id="5960268">.</span><span class="ident" id="5960269">pos</span>&nbsp;<span class="op" id="5960273">&gt;</span>&nbsp;<span class="ident" id="5960275">p</span><span class="op" id="5960276">.</span><span class="ident" id="5960277">syncPos</span>&nbsp;<span class="op" id="5960285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960291">p</span><span class="op" id="5960292">.</span><span class="ident" id="5960293">syncPos</span>&nbsp;<span class="op" id="5960301">=</span>&nbsp;<span class="ident" id="5960303">p</span><span class="op" id="5960304">.</span><span class="ident" id="5960305">pos</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960313">p</span><span class="op" id="5960314">.</span><span class="ident" id="5960315">syncCnt</span>&nbsp;<span class="op" id="5960323">=</span>&nbsp;<span class="num" id="5960325">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960331">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960345">case</span>&nbsp;<span class="ident" id="5960350">token</span><span class="op" id="5960355">.</span><span class="ident" id="5960356">EOF</span><span class="op" id="5960359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960364">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960377">p</span><span class="op" id="5960378">.</span><span class="ident" id="5960379">next</span><span class="op" id="5960383">(</span><span class="op" id="5960384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960387">}</span><br>
<span class="lineno"></span><span class="op" id="5960389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="5960392">//&nbsp;safePos&nbsp;returns&nbsp;a&nbsp;valid&nbsp;file&nbsp;position&nbsp;for&nbsp;a&nbsp;given&nbsp;position:&nbsp;If&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="5960462">//&nbsp;is&nbsp;valid&nbsp;to&nbsp;begin&nbsp;with,&nbsp;safePos&nbsp;returns&nbsp;pos.&nbsp;If&nbsp;pos&nbsp;is&nbsp;out-of-range,</span><br>
<span class="lineno"></span><span class="comment" id="5960534">//&nbsp;safePos&nbsp;returns&nbsp;the&nbsp;EOF&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5960571">//</span><br>
<span class="lineno"></span><span class="comment" id="5960574">//&nbsp;This&nbsp;is&nbsp;hack&nbsp;to&nbsp;work&nbsp;around&nbsp;&#34;artificial&#34;&nbsp;end&nbsp;positions&nbsp;in&nbsp;the&nbsp;AST&nbsp;which</span><br>
<span class="lineno">500</span><span class="comment" id="5960649">//&nbsp;are&nbsp;computed&nbsp;by&nbsp;adding&nbsp;1&nbsp;to&nbsp;(presumably&nbsp;valid)&nbsp;token&nbsp;positions.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5960723">//&nbsp;token&nbsp;positions&nbsp;are&nbsp;invalid&nbsp;due&nbsp;to&nbsp;parse&nbsp;errors,&nbsp;the&nbsp;resulting&nbsp;end&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5960802">//&nbsp;may&nbsp;be&nbsp;past&nbsp;the&nbsp;file&#39;s&nbsp;EOF&nbsp;position,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to&nbsp;panics&nbsp;if&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="5960877">//&nbsp;later&nbsp;on.</span><br>
<span class="lineno"></span><span class="comment" id="5960890">//</span><br>
<span class="lineno">505</span><span class="keyword" id="5960893">func</span>&nbsp;<span class="op" id="5960898">(</span><span class="ident" id="5960899">p</span>&nbsp;<span class="op" id="5960901">*</span><span class="ident" id="5960902">parser</span><span class="op" id="5960908">)</span>&nbsp;<span class="ident" id="5960910">safePos</span><span class="op" id="5960917">(</span><span class="ident" id="5960918">pos</span>&nbsp;<span class="ident" id="5960922">token</span><span class="op" id="5960927">.</span><span class="ident" id="5960928">Pos</span><span class="op" id="5960931">)</span>&nbsp;<span class="op" id="5960933">(</span><span class="ident" id="5960934">res</span>&nbsp;<span class="ident" id="5960938">token</span><span class="op" id="5960943">.</span><span class="ident" id="5960944">Pos</span><span class="op" id="5960947">)</span>&nbsp;<span class="op" id="5960949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960952">defer</span>&nbsp;<span class="keyword" id="5960958">func</span><span class="op" id="5960962">(</span><span class="op" id="5960963">)</span>&nbsp;<span class="op" id="5960965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960969">if</span>&nbsp;<span class="builtinfunc" id="5960972">recover</span><span class="op" id="5960979">(</span><span class="op" id="5960980">)</span>&nbsp;<span class="op" id="5960982">!=</span>&nbsp;<span class="ident" id="5960985">nil</span>&nbsp;<span class="op" id="5960989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960994">res</span>&nbsp;<span class="op" id="5960998">=</span>&nbsp;<span class="ident" id="5961000">token</span><span class="op" id="5961005">.</span><span class="ident" id="5961006">Pos</span><span class="op" id="5961009">(</span><span class="ident" id="5961010">p</span><span class="op" id="5961011">.</span><span class="ident" id="5961012">file</span><span class="op" id="5961016">.</span><span class="ident" id="5961017">Base</span><span class="op" id="5961021">(</span><span class="op" id="5961022">)</span>&nbsp;<span class="op" id="5961024">+</span>&nbsp;<span class="ident" id="5961026">p</span><span class="op" id="5961027">.</span><span class="ident" id="5961028">file</span><span class="op" id="5961032">.</span><span class="ident" id="5961033">Size</span><span class="op" id="5961037">(</span><span class="op" id="5961038">)</span><span class="op" id="5961039">)</span>&nbsp;<span class="comment" id="5961041">//&nbsp;EOF&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961059">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961062">}</span><span class="op" id="5961063">(</span><span class="op" id="5961064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961067">_</span>&nbsp;<span class="op" id="5961069">=</span>&nbsp;<span class="ident" id="5961071">p</span><span class="op" id="5961072">.</span><span class="ident" id="5961073">file</span><span class="op" id="5961077">.</span><span class="ident" id="5961078">Offset</span><span class="op" id="5961084">(</span><span class="ident" id="5961085">pos</span><span class="op" id="5961088">)</span>&nbsp;<span class="comment" id="5961090">//&nbsp;trigger&nbsp;a&nbsp;panic&nbsp;if&nbsp;position&nbsp;is&nbsp;out-of-range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961138">return</span>&nbsp;<span class="ident" id="5961145">pos</span><br>
<span class="lineno"></span><span class="op" id="5961149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="comment" id="5961152">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5961232">//&nbsp;Identifiers</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5961248">func</span>&nbsp;<span class="op" id="5961253">(</span><span class="ident" id="5961254">p</span>&nbsp;<span class="op" id="5961256">*</span><span class="ident" id="5961257">parser</span><span class="op" id="5961263">)</span>&nbsp;<span class="ident" id="5961265">parseIdent</span><span class="op" id="5961275">(</span><span class="op" id="5961276">)</span>&nbsp;<span class="op" id="5961278">*</span><span class="ident" id="5961279">ast</span><span class="op" id="5961282">.</span><span class="ident" id="5961283">Ident</span>&nbsp;<span class="op" id="5961289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961292">pos</span>&nbsp;<span class="op" id="5961296">:=</span>&nbsp;<span class="ident" id="5961299">p</span><span class="op" id="5961300">.</span><span class="ident" id="5961301">pos</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961306">name</span>&nbsp;<span class="op" id="5961311">:=</span>&nbsp;<span class="string" id="5961314">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961319">if</span>&nbsp;<span class="ident" id="5961322">p</span><span class="op" id="5961323">.</span><span class="ident" id="5961324">tok</span>&nbsp;<span class="op" id="5961328">==</span>&nbsp;<span class="ident" id="5961331">token</span><span class="op" id="5961336">.</span><span class="ident" id="5961337">IDENT</span>&nbsp;<span class="op" id="5961343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961347">name</span>&nbsp;<span class="op" id="5961352">=</span>&nbsp;<span class="ident" id="5961354">p</span><span class="op" id="5961355">.</span><span class="ident" id="5961356">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961362">p</span><span class="op" id="5961363">.</span><span class="ident" id="5961364">next</span><span class="op" id="5961368">(</span><span class="op" id="5961369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961372">}</span>&nbsp;<span class="keyword" id="5961374">else</span>&nbsp;<span class="op" id="5961379">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961383">p</span><span class="op" id="5961384">.</span><span class="ident" id="5961385">expect</span><span class="op" id="5961391">(</span><span class="ident" id="5961392">token</span><span class="op" id="5961397">.</span><span class="ident" id="5961398">IDENT</span><span class="op" id="5961403">)</span>&nbsp;<span class="comment" id="5961405">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961440">return</span>&nbsp;<span class="op" id="5961447">&amp;</span><span class="ident" id="5961448">ast</span><span class="op" id="5961451">.</span><span class="ident" id="5961452">Ident</span><span class="op" id="5961457">{</span><span class="ident" id="5961458">NamePos</span><span class="op" id="5961465">:</span>&nbsp;<span class="ident" id="5961467">pos</span><span class="op" id="5961470">,</span>&nbsp;<span class="ident" id="5961472">Name</span><span class="op" id="5961476">:</span>&nbsp;<span class="ident" id="5961478">name</span><span class="op" id="5961482">}</span><br>
<span class="lineno"></span><span class="op" id="5961484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="keyword" id="5961487">func</span>&nbsp;<span class="op" id="5961492">(</span><span class="ident" id="5961493">p</span>&nbsp;<span class="op" id="5961495">*</span><span class="ident" id="5961496">parser</span><span class="op" id="5961502">)</span>&nbsp;<span class="ident" id="5961504">parseIdentList</span><span class="op" id="5961518">(</span><span class="op" id="5961519">)</span>&nbsp;<span class="op" id="5961521">(</span><span class="ident" id="5961522">list</span>&nbsp;<span class="op" id="5961527">[</span><span class="op" id="5961528">]</span><span class="op" id="5961529">*</span><span class="ident" id="5961530">ast</span><span class="op" id="5961533">.</span><span class="ident" id="5961534">Ident</span><span class="op" id="5961539">)</span>&nbsp;<span class="op" id="5961541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961544">if</span>&nbsp;<span class="ident" id="5961547">p</span><span class="op" id="5961548">.</span><span class="ident" id="5961549">trace</span>&nbsp;<span class="op" id="5961555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961559">defer</span>&nbsp;<span class="ident" id="5961565">un</span><span class="op" id="5961567">(</span><span class="ident" id="5961568">trace</span><span class="op" id="5961573">(</span><span class="ident" id="5961574">p</span><span class="op" id="5961575">,</span>&nbsp;<span class="string" id="5961577">&#34;IdentList&#34;</span><span class="op" id="5961588">)</span><span class="op" id="5961589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961596">list</span>&nbsp;<span class="op" id="5961601">=</span>&nbsp;<span class="builtinfunc" id="5961603">append</span><span class="op" id="5961609">(</span><span class="ident" id="5961610">list</span><span class="op" id="5961614">,</span>&nbsp;<span class="ident" id="5961616">p</span><span class="op" id="5961617">.</span><span class="ident" id="5961618">parseIdent</span><span class="op" id="5961628">(</span><span class="op" id="5961629">)</span><span class="op" id="5961630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961633">for</span>&nbsp;<span class="ident" id="5961637">p</span><span class="op" id="5961638">.</span><span class="ident" id="5961639">tok</span>&nbsp;<span class="op" id="5961643">==</span>&nbsp;<span class="ident" id="5961646">token</span><span class="op" id="5961651">.</span><span class="ident" id="5961652">COMMA</span>&nbsp;<span class="op" id="5961658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961662">p</span><span class="op" id="5961663">.</span><span class="ident" id="5961664">next</span><span class="op" id="5961668">(</span><span class="op" id="5961669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961673">list</span>&nbsp;<span class="op" id="5961678">=</span>&nbsp;<span class="builtinfunc" id="5961680">append</span><span class="op" id="5961686">(</span><span class="ident" id="5961687">list</span><span class="op" id="5961691">,</span>&nbsp;<span class="ident" id="5961693">p</span><span class="op" id="5961694">.</span><span class="ident" id="5961695">parseIdent</span><span class="op" id="5961705">(</span><span class="op" id="5961706">)</span><span class="op" id="5961707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961710">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961714">return</span><br>
<span class="lineno"></span><span class="op" id="5961721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5961724">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">545</span><span class="comment" id="5961804">//&nbsp;Common&nbsp;productions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5961827">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set,&nbsp;result&nbsp;list&nbsp;elements&nbsp;which&nbsp;are&nbsp;identifiers&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5961906">func</span>&nbsp;<span class="op" id="5961911">(</span><span class="ident" id="5961912">p</span>&nbsp;<span class="op" id="5961914">*</span><span class="ident" id="5961915">parser</span><span class="op" id="5961921">)</span>&nbsp;<span class="ident" id="5961923">parseExprList</span><span class="op" id="5961936">(</span><span class="ident" id="5961937">lhs</span>&nbsp;<span class="builtintype" id="5961941">bool</span><span class="op" id="5961945">)</span>&nbsp;<span class="op" id="5961947">(</span><span class="ident" id="5961948">list</span>&nbsp;<span class="op" id="5961953">[</span><span class="op" id="5961954">]</span><span class="ident" id="5961955">ast</span><span class="op" id="5961958">.</span><span class="ident" id="5961959">Expr</span><span class="op" id="5961963">)</span>&nbsp;<span class="op" id="5961965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961968">if</span>&nbsp;<span class="ident" id="5961971">p</span><span class="op" id="5961972">.</span><span class="ident" id="5961973">trace</span>&nbsp;<span class="op" id="5961979">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961983">defer</span>&nbsp;<span class="ident" id="5961989">un</span><span class="op" id="5961991">(</span><span class="ident" id="5961992">trace</span><span class="op" id="5961997">(</span><span class="ident" id="5961998">p</span><span class="op" id="5961999">,</span>&nbsp;<span class="string" id="5962001">&#34;ExpressionList&#34;</span><span class="op" id="5962017">)</span><span class="op" id="5962018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962025">list</span>&nbsp;<span class="op" id="5962030">=</span>&nbsp;<span class="builtinfunc" id="5962032">append</span><span class="op" id="5962038">(</span><span class="ident" id="5962039">list</span><span class="op" id="5962043">,</span>&nbsp;<span class="ident" id="5962045">p</span><span class="op" id="5962046">.</span><span class="ident" id="5962047">checkExpr</span><span class="op" id="5962056">(</span><span class="ident" id="5962057">p</span><span class="op" id="5962058">.</span><span class="ident" id="5962059">parseExpr</span><span class="op" id="5962068">(</span><span class="ident" id="5962069">lhs</span><span class="op" id="5962072">)</span><span class="op" id="5962073">)</span><span class="op" id="5962074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962077">for</span>&nbsp;<span class="ident" id="5962081">p</span><span class="op" id="5962082">.</span><span class="ident" id="5962083">tok</span>&nbsp;<span class="op" id="5962087">==</span>&nbsp;<span class="ident" id="5962090">token</span><span class="op" id="5962095">.</span><span class="ident" id="5962096">COMMA</span>&nbsp;<span class="op" id="5962102">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962106">p</span><span class="op" id="5962107">.</span><span class="ident" id="5962108">next</span><span class="op" id="5962112">(</span><span class="op" id="5962113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962117">list</span>&nbsp;<span class="op" id="5962122">=</span>&nbsp;<span class="builtinfunc" id="5962124">append</span><span class="op" id="5962130">(</span><span class="ident" id="5962131">list</span><span class="op" id="5962135">,</span>&nbsp;<span class="ident" id="5962137">p</span><span class="op" id="5962138">.</span><span class="ident" id="5962139">checkExpr</span><span class="op" id="5962148">(</span><span class="ident" id="5962149">p</span><span class="op" id="5962150">.</span><span class="ident" id="5962151">parseExpr</span><span class="op" id="5962160">(</span><span class="ident" id="5962161">lhs</span><span class="op" id="5962164">)</span><span class="op" id="5962165">)</span><span class="op" id="5962166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962173">return</span><br>
<span class="lineno">560</span><span class="op" id="5962180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5962183">func</span>&nbsp;<span class="op" id="5962188">(</span><span class="ident" id="5962189">p</span>&nbsp;<span class="op" id="5962191">*</span><span class="ident" id="5962192">parser</span><span class="op" id="5962198">)</span>&nbsp;<span class="ident" id="5962200">parseLhsList</span><span class="op" id="5962212">(</span><span class="op" id="5962213">)</span>&nbsp;<span class="op" id="5962215">[</span><span class="op" id="5962216">]</span><span class="ident" id="5962217">ast</span><span class="op" id="5962220">.</span><span class="ident" id="5962221">Expr</span>&nbsp;<span class="op" id="5962226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962229">old</span>&nbsp;<span class="op" id="5962233">:=</span>&nbsp;<span class="ident" id="5962236">p</span><span class="op" id="5962237">.</span><span class="ident" id="5962238">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962245">p</span><span class="op" id="5962246">.</span><span class="ident" id="5962247">inRhs</span>&nbsp;<span class="op" id="5962253">=</span>&nbsp;<span class="ident" id="5962255">false</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962262">list</span>&nbsp;<span class="op" id="5962267">:=</span>&nbsp;<span class="ident" id="5962270">p</span><span class="op" id="5962271">.</span><span class="ident" id="5962272">parseExprList</span><span class="op" id="5962285">(</span><span class="ident" id="5962286">true</span><span class="op" id="5962290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962293">switch</span>&nbsp;<span class="ident" id="5962300">p</span><span class="op" id="5962301">.</span><span class="ident" id="5962302">tok</span>&nbsp;<span class="op" id="5962306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962309">case</span>&nbsp;<span class="ident" id="5962314">token</span><span class="op" id="5962319">.</span><span class="ident" id="5962320">DEFINE</span><span class="op" id="5962326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962330">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;short&nbsp;variable&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962371">//&nbsp;but&nbsp;doesn&#39;t&nbsp;enter&nbsp;scope&nbsp;until&nbsp;later:</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962413">//&nbsp;caller&nbsp;must&nbsp;call&nbsp;p.shortVarDecl(p.makeIdentList(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962473">//&nbsp;at&nbsp;appropriate&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962498">case</span>&nbsp;<span class="ident" id="5962503">token</span><span class="op" id="5962508">.</span><span class="ident" id="5962509">COLON</span><span class="op" id="5962514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962518">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;label&nbsp;declaration&nbsp;or&nbsp;a&nbsp;communication&nbsp;clause&nbsp;of&nbsp;a&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962588">//&nbsp;statement&nbsp;(parseLhsList&nbsp;is&nbsp;not&nbsp;called&nbsp;when&nbsp;parsing&nbsp;the&nbsp;case&nbsp;clause</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962660">//&nbsp;of&nbsp;a&nbsp;switch&nbsp;statement):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962689">//&nbsp;-&nbsp;labels&nbsp;are&nbsp;declared&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;parseLhsList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962746">//&nbsp;-&nbsp;for&nbsp;communication&nbsp;clauses,&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;stand-alone&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962817">//&nbsp;&nbsp;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;we&nbsp;have&nbsp;a&nbsp;syntax&nbsp;error;&nbsp;there&nbsp;is&nbsp;no&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962886">//&nbsp;&nbsp;&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962931">default</span><span class="op" id="5962938">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962942">//&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;declared&nbsp;elsewhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962986">for</span>&nbsp;<span class="ident" id="5962990">_</span><span class="op" id="5962991">,</span>&nbsp;<span class="ident" id="5962993">x</span>&nbsp;<span class="op" id="5962995">:=</span>&nbsp;<span class="keyword" id="5962998">range</span>&nbsp;<span class="ident" id="5963004">list</span>&nbsp;<span class="op" id="5963009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963014">p</span><span class="op" id="5963015">.</span><span class="ident" id="5963016">resolve</span><span class="op" id="5963023">(</span><span class="ident" id="5963024">x</span><span class="op" id="5963025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963029">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963035">p</span><span class="op" id="5963036">.</span><span class="ident" id="5963037">inRhs</span>&nbsp;<span class="op" id="5963043">=</span>&nbsp;<span class="ident" id="5963045">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963050">return</span>&nbsp;<span class="ident" id="5963057">list</span><br>
<span class="lineno"></span><span class="op" id="5963062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="5963065">func</span>&nbsp;<span class="op" id="5963070">(</span><span class="ident" id="5963071">p</span>&nbsp;<span class="op" id="5963073">*</span><span class="ident" id="5963074">parser</span><span class="op" id="5963080">)</span>&nbsp;<span class="ident" id="5963082">parseRhsList</span><span class="op" id="5963094">(</span><span class="op" id="5963095">)</span>&nbsp;<span class="op" id="5963097">[</span><span class="op" id="5963098">]</span><span class="ident" id="5963099">ast</span><span class="op" id="5963102">.</span><span class="ident" id="5963103">Expr</span>&nbsp;<span class="op" id="5963108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963111">old</span>&nbsp;<span class="op" id="5963115">:=</span>&nbsp;<span class="ident" id="5963118">p</span><span class="op" id="5963119">.</span><span class="ident" id="5963120">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963127">p</span><span class="op" id="5963128">.</span><span class="ident" id="5963129">inRhs</span>&nbsp;<span class="op" id="5963135">=</span>&nbsp;<span class="ident" id="5963137">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963143">list</span>&nbsp;<span class="op" id="5963148">:=</span>&nbsp;<span class="ident" id="5963151">p</span><span class="op" id="5963152">.</span><span class="ident" id="5963153">parseExprList</span><span class="op" id="5963166">(</span><span class="ident" id="5963167">false</span><span class="op" id="5963172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963175">p</span><span class="op" id="5963176">.</span><span class="ident" id="5963177">inRhs</span>&nbsp;<span class="op" id="5963183">=</span>&nbsp;<span class="ident" id="5963185">old</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963190">return</span>&nbsp;<span class="ident" id="5963197">list</span><br>
<span class="lineno"></span><span class="op" id="5963202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5963205">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5963285">//&nbsp;Types</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="5963295">func</span>&nbsp;<span class="op" id="5963300">(</span><span class="ident" id="5963301">p</span>&nbsp;<span class="op" id="5963303">*</span><span class="ident" id="5963304">parser</span><span class="op" id="5963310">)</span>&nbsp;<span class="ident" id="5963312">parseType</span><span class="op" id="5963321">(</span><span class="op" id="5963322">)</span>&nbsp;<span class="ident" id="5963324">ast</span><span class="op" id="5963327">.</span><span class="ident" id="5963328">Expr</span>&nbsp;<span class="op" id="5963333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963336">if</span>&nbsp;<span class="ident" id="5963339">p</span><span class="op" id="5963340">.</span><span class="ident" id="5963341">trace</span>&nbsp;<span class="op" id="5963347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963351">defer</span>&nbsp;<span class="ident" id="5963357">un</span><span class="op" id="5963359">(</span><span class="ident" id="5963360">trace</span><span class="op" id="5963365">(</span><span class="ident" id="5963366">p</span><span class="op" id="5963367">,</span>&nbsp;<span class="string" id="5963369">&#34;Type&#34;</span><span class="op" id="5963375">)</span><span class="op" id="5963376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963379">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963383">typ</span>&nbsp;<span class="op" id="5963387">:=</span>&nbsp;<span class="ident" id="5963390">p</span><span class="op" id="5963391">.</span><span class="ident" id="5963392">tryType</span><span class="op" id="5963399">(</span><span class="op" id="5963400">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963404">if</span>&nbsp;<span class="ident" id="5963407">typ</span>&nbsp;<span class="op" id="5963411">==</span>&nbsp;<span class="ident" id="5963414">nil</span>&nbsp;<span class="op" id="5963418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963422">pos</span>&nbsp;<span class="op" id="5963426">:=</span>&nbsp;<span class="ident" id="5963429">p</span><span class="op" id="5963430">.</span><span class="ident" id="5963431">pos</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963437">p</span><span class="op" id="5963438">.</span><span class="ident" id="5963439">errorExpected</span><span class="op" id="5963452">(</span><span class="ident" id="5963453">pos</span><span class="op" id="5963456">,</span>&nbsp;<span class="string" id="5963458">&#34;type&#34;</span><span class="op" id="5963464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963468">p</span><span class="op" id="5963469">.</span><span class="ident" id="5963470">next</span><span class="op" id="5963474">(</span><span class="op" id="5963475">)</span>&nbsp;<span class="comment" id="5963477">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963496">return</span>&nbsp;<span class="op" id="5963503">&amp;</span><span class="ident" id="5963504">ast</span><span class="op" id="5963507">.</span><span class="ident" id="5963508">BadExpr</span><span class="op" id="5963515">{</span><span class="ident" id="5963516">From</span><span class="op" id="5963520">:</span>&nbsp;<span class="ident" id="5963522">pos</span><span class="op" id="5963525">,</span>&nbsp;<span class="ident" id="5963527">To</span><span class="op" id="5963529">:</span>&nbsp;<span class="ident" id="5963531">p</span><span class="op" id="5963532">.</span><span class="ident" id="5963533">pos</span><span class="op" id="5963536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963543">return</span>&nbsp;<span class="ident" id="5963550">typ</span><br>
<span class="lineno"></span><span class="op" id="5963554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5963557">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5963612">func</span>&nbsp;<span class="op" id="5963617">(</span><span class="ident" id="5963618">p</span>&nbsp;<span class="op" id="5963620">*</span><span class="ident" id="5963621">parser</span><span class="op" id="5963627">)</span>&nbsp;<span class="ident" id="5963629">parseTypeName</span><span class="op" id="5963642">(</span><span class="op" id="5963643">)</span>&nbsp;<span class="ident" id="5963645">ast</span><span class="op" id="5963648">.</span><span class="ident" id="5963649">Expr</span>&nbsp;<span class="op" id="5963654">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963657">if</span>&nbsp;<span class="ident" id="5963660">p</span><span class="op" id="5963661">.</span><span class="ident" id="5963662">trace</span>&nbsp;<span class="op" id="5963668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963672">defer</span>&nbsp;<span class="ident" id="5963678">un</span><span class="op" id="5963680">(</span><span class="ident" id="5963681">trace</span><span class="op" id="5963686">(</span><span class="ident" id="5963687">p</span><span class="op" id="5963688">,</span>&nbsp;<span class="string" id="5963690">&#34;TypeName&#34;</span><span class="op" id="5963700">)</span><span class="op" id="5963701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963708">ident</span>&nbsp;<span class="op" id="5963714">:=</span>&nbsp;<span class="ident" id="5963717">p</span><span class="op" id="5963718">.</span><span class="ident" id="5963719">parseIdent</span><span class="op" id="5963729">(</span><span class="op" id="5963730">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5963733">//&nbsp;don&#39;t&nbsp;resolve&nbsp;ident&nbsp;yet&nbsp;-&nbsp;it&nbsp;may&nbsp;be&nbsp;a&nbsp;parameter&nbsp;or&nbsp;field&nbsp;name</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963800">if</span>&nbsp;<span class="ident" id="5963803">p</span><span class="op" id="5963804">.</span><span class="ident" id="5963805">tok</span>&nbsp;<span class="op" id="5963809">==</span>&nbsp;<span class="ident" id="5963812">token</span><span class="op" id="5963817">.</span><span class="ident" id="5963818">PERIOD</span>&nbsp;<span class="op" id="5963825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5963829">//&nbsp;ident&nbsp;is&nbsp;a&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963858">p</span><span class="op" id="5963859">.</span><span class="ident" id="5963860">next</span><span class="op" id="5963864">(</span><span class="op" id="5963865">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963869">p</span><span class="op" id="5963870">.</span><span class="ident" id="5963871">resolve</span><span class="op" id="5963878">(</span><span class="ident" id="5963879">ident</span><span class="op" id="5963884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963888">sel</span>&nbsp;<span class="op" id="5963892">:=</span>&nbsp;<span class="ident" id="5963895">p</span><span class="op" id="5963896">.</span><span class="ident" id="5963897">parseIdent</span><span class="op" id="5963907">(</span><span class="op" id="5963908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963912">return</span>&nbsp;<span class="op" id="5963919">&amp;</span><span class="ident" id="5963920">ast</span><span class="op" id="5963923">.</span><span class="ident" id="5963924">SelectorExpr</span><span class="op" id="5963936">{</span><span class="ident" id="5963937">X</span><span class="op" id="5963938">:</span>&nbsp;<span class="ident" id="5963940">ident</span><span class="op" id="5963945">,</span>&nbsp;<span class="ident" id="5963947">Sel</span><span class="op" id="5963950">:</span>&nbsp;<span class="ident" id="5963952">sel</span><span class="op" id="5963955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963962">return</span>&nbsp;<span class="ident" id="5963969">ident</span><br>
<span class="lineno"></span><span class="op" id="5963975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5963978">func</span>&nbsp;<span class="op" id="5963983">(</span><span class="ident" id="5963984">p</span>&nbsp;<span class="op" id="5963986">*</span><span class="ident" id="5963987">parser</span><span class="op" id="5963993">)</span>&nbsp;<span class="ident" id="5963995">parseArrayType</span><span class="op" id="5964009">(</span><span class="op" id="5964010">)</span>&nbsp;<span class="ident" id="5964012">ast</span><span class="op" id="5964015">.</span><span class="ident" id="5964016">Expr</span>&nbsp;<span class="op" id="5964021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964024">if</span>&nbsp;<span class="ident" id="5964027">p</span><span class="op" id="5964028">.</span><span class="ident" id="5964029">trace</span>&nbsp;<span class="op" id="5964035">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964039">defer</span>&nbsp;<span class="ident" id="5964045">un</span><span class="op" id="5964047">(</span><span class="ident" id="5964048">trace</span><span class="op" id="5964053">(</span><span class="ident" id="5964054">p</span><span class="op" id="5964055">,</span>&nbsp;<span class="string" id="5964057">&#34;ArrayType&#34;</span><span class="op" id="5964068">)</span><span class="op" id="5964069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964076">lbrack</span>&nbsp;<span class="op" id="5964083">:=</span>&nbsp;<span class="ident" id="5964086">p</span><span class="op" id="5964087">.</span><span class="ident" id="5964088">expect</span><span class="op" id="5964094">(</span><span class="ident" id="5964095">token</span><span class="op" id="5964100">.</span><span class="ident" id="5964101">LBRACK</span><span class="op" id="5964107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964110">p</span><span class="op" id="5964111">.</span><span class="ident" id="5964112">exprLev</span><span class="op" id="5964119">++</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964123">var</span>&nbsp;<span class="builtinfunc" id="5964127">len</span>&nbsp;<span class="ident" id="5964131">ast</span><span class="op" id="5964134">.</span><span class="ident" id="5964135">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5964141">//&nbsp;always&nbsp;permit&nbsp;ellipsis&nbsp;for&nbsp;more&nbsp;fault-tolerant&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964200">if</span>&nbsp;<span class="ident" id="5964203">p</span><span class="op" id="5964204">.</span><span class="ident" id="5964205">tok</span>&nbsp;<span class="op" id="5964209">==</span>&nbsp;<span class="ident" id="5964212">token</span><span class="op" id="5964217">.</span><span class="ident" id="5964218">ELLIPSIS</span>&nbsp;<span class="op" id="5964227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5964231">len</span>&nbsp;<span class="op" id="5964235">=</span>&nbsp;<span class="op" id="5964237">&amp;</span><span class="ident" id="5964238">ast</span><span class="op" id="5964241">.</span><span class="ident" id="5964242">Ellipsis</span><span class="op" id="5964250">{</span><span class="ident" id="5964251">Ellipsis</span><span class="op" id="5964259">:</span>&nbsp;<span class="ident" id="5964261">p</span><span class="op" id="5964262">.</span><span class="ident" id="5964263">pos</span><span class="op" id="5964266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964270">p</span><span class="op" id="5964271">.</span><span class="ident" id="5964272">next</span><span class="op" id="5964276">(</span><span class="op" id="5964277">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964280">}</span>&nbsp;<span class="keyword" id="5964282">else</span>&nbsp;<span class="keyword" id="5964287">if</span>&nbsp;<span class="ident" id="5964290">p</span><span class="op" id="5964291">.</span><span class="ident" id="5964292">tok</span>&nbsp;<span class="op" id="5964296">!=</span>&nbsp;<span class="ident" id="5964299">token</span><span class="op" id="5964304">.</span><span class="ident" id="5964305">RBRACK</span>&nbsp;<span class="op" id="5964312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5964316">len</span>&nbsp;<span class="op" id="5964320">=</span>&nbsp;<span class="ident" id="5964322">p</span><span class="op" id="5964323">.</span><span class="ident" id="5964324">parseRhs</span><span class="op" id="5964332">(</span><span class="op" id="5964333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964339">p</span><span class="op" id="5964340">.</span><span class="ident" id="5964341">exprLev</span><span class="op" id="5964348">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964352">p</span><span class="op" id="5964353">.</span><span class="ident" id="5964354">expect</span><span class="op" id="5964360">(</span><span class="ident" id="5964361">token</span><span class="op" id="5964366">.</span><span class="ident" id="5964367">RBRACK</span><span class="op" id="5964373">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964376">elt</span>&nbsp;<span class="op" id="5964380">:=</span>&nbsp;<span class="ident" id="5964383">p</span><span class="op" id="5964384">.</span><span class="ident" id="5964385">parseType</span><span class="op" id="5964394">(</span><span class="op" id="5964395">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964399">return</span>&nbsp;<span class="op" id="5964406">&amp;</span><span class="ident" id="5964407">ast</span><span class="op" id="5964410">.</span><span class="ident" id="5964411">ArrayType</span><span class="op" id="5964420">{</span><span class="ident" id="5964421">Lbrack</span><span class="op" id="5964427">:</span>&nbsp;<span class="ident" id="5964429">lbrack</span><span class="op" id="5964435">,</span>&nbsp;<span class="ident" id="5964437">Len</span><span class="op" id="5964440">:</span>&nbsp;<span class="builtinfunc" id="5964442">len</span><span class="op" id="5964445">,</span>&nbsp;<span class="ident" id="5964447">Elt</span><span class="op" id="5964450">:</span>&nbsp;<span class="ident" id="5964452">elt</span><span class="op" id="5964455">}</span><br>
<span class="lineno"></span><span class="op" id="5964457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="keyword" id="5964460">func</span>&nbsp;<span class="op" id="5964465">(</span><span class="ident" id="5964466">p</span>&nbsp;<span class="op" id="5964468">*</span><span class="ident" id="5964469">parser</span><span class="op" id="5964475">)</span>&nbsp;<span class="ident" id="5964477">makeIdentList</span><span class="op" id="5964490">(</span><span class="ident" id="5964491">list</span>&nbsp;<span class="op" id="5964496">[</span><span class="op" id="5964497">]</span><span class="ident" id="5964498">ast</span><span class="op" id="5964501">.</span><span class="ident" id="5964502">Expr</span><span class="op" id="5964506">)</span>&nbsp;<span class="op" id="5964508">[</span><span class="op" id="5964509">]</span><span class="op" id="5964510">*</span><span class="ident" id="5964511">ast</span><span class="op" id="5964514">.</span><span class="ident" id="5964515">Ident</span>&nbsp;<span class="op" id="5964521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964524">idents</span>&nbsp;<span class="op" id="5964531">:=</span>&nbsp;<span class="builtinfunc" id="5964534">make</span><span class="op" id="5964538">(</span><span class="op" id="5964539">[</span><span class="op" id="5964540">]</span><span class="op" id="5964541">*</span><span class="ident" id="5964542">ast</span><span class="op" id="5964545">.</span><span class="ident" id="5964546">Ident</span><span class="op" id="5964551">,</span>&nbsp;<span class="builtinfunc" id="5964553">len</span><span class="op" id="5964556">(</span><span class="ident" id="5964557">list</span><span class="op" id="5964561">)</span><span class="op" id="5964562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964565">for</span>&nbsp;<span class="ident" id="5964569">i</span><span class="op" id="5964570">,</span>&nbsp;<span class="ident" id="5964572">x</span>&nbsp;<span class="op" id="5964574">:=</span>&nbsp;<span class="keyword" id="5964577">range</span>&nbsp;<span class="ident" id="5964583">list</span>&nbsp;<span class="op" id="5964588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964592">ident</span><span class="op" id="5964597">,</span>&nbsp;<span class="ident" id="5964599">isIdent</span>&nbsp;<span class="op" id="5964607">:=</span>&nbsp;<span class="ident" id="5964610">x</span><span class="op" id="5964611">.</span><span class="op" id="5964612">(</span><span class="op" id="5964613">*</span><span class="ident" id="5964614">ast</span><span class="op" id="5964617">.</span><span class="ident" id="5964618">Ident</span><span class="op" id="5964623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964627">if</span>&nbsp;<span class="op" id="5964630">!</span><span class="ident" id="5964631">isIdent</span>&nbsp;<span class="op" id="5964639">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964644">if</span>&nbsp;<span class="ident" id="5964647">_</span><span class="op" id="5964648">,</span>&nbsp;<span class="ident" id="5964650">isBad</span>&nbsp;<span class="op" id="5964656">:=</span>&nbsp;<span class="ident" id="5964659">x</span><span class="op" id="5964660">.</span><span class="op" id="5964661">(</span><span class="op" id="5964662">*</span><span class="ident" id="5964663">ast</span><span class="op" id="5964666">.</span><span class="ident" id="5964667">BadExpr</span><span class="op" id="5964674">)</span><span class="op" id="5964675">;</span>&nbsp;<span class="op" id="5964677">!</span><span class="ident" id="5964678">isBad</span>&nbsp;<span class="op" id="5964684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5964690">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964733">p</span><span class="op" id="5964734">.</span><span class="ident" id="5964735">errorExpected</span><span class="op" id="5964748">(</span><span class="ident" id="5964749">x</span><span class="op" id="5964750">.</span><span class="ident" id="5964751">Pos</span><span class="op" id="5964754">(</span><span class="op" id="5964755">)</span><span class="op" id="5964756">,</span>&nbsp;<span class="string" id="5964758">&#34;identifier&#34;</span><span class="op" id="5964770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964780">ident</span>&nbsp;<span class="op" id="5964786">=</span>&nbsp;<span class="op" id="5964788">&amp;</span><span class="ident" id="5964789">ast</span><span class="op" id="5964792">.</span><span class="ident" id="5964793">Ident</span><span class="op" id="5964798">{</span><span class="ident" id="5964799">NamePos</span><span class="op" id="5964806">:</span>&nbsp;<span class="ident" id="5964808">x</span><span class="op" id="5964809">.</span><span class="ident" id="5964810">Pos</span><span class="op" id="5964813">(</span><span class="op" id="5964814">)</span><span class="op" id="5964815">,</span>&nbsp;<span class="ident" id="5964817">Name</span><span class="op" id="5964821">:</span>&nbsp;<span class="string" id="5964823">&#34;_&#34;</span><span class="op" id="5964826">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964834">idents</span><span class="op" id="5964840">[</span><span class="ident" id="5964841">i</span><span class="op" id="5964842">]</span>&nbsp;<span class="op" id="5964844">=</span>&nbsp;<span class="ident" id="5964846">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964856">return</span>&nbsp;<span class="ident" id="5964863">idents</span><br>
<span class="lineno"></span><span class="op" id="5964870">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="5964873">func</span>&nbsp;<span class="op" id="5964878">(</span><span class="ident" id="5964879">p</span>&nbsp;<span class="op" id="5964881">*</span><span class="ident" id="5964882">parser</span><span class="op" id="5964888">)</span>&nbsp;<span class="ident" id="5964890">parseFieldDecl</span><span class="op" id="5964904">(</span><span class="ident" id="5964905">scope</span>&nbsp;<span class="op" id="5964911">*</span><span class="ident" id="5964912">ast</span><span class="op" id="5964915">.</span><span class="ident" id="5964916">Scope</span><span class="op" id="5964921">)</span>&nbsp;<span class="op" id="5964923">*</span><span class="ident" id="5964924">ast</span><span class="op" id="5964927">.</span><span class="ident" id="5964928">Field</span>&nbsp;<span class="op" id="5964934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964937">if</span>&nbsp;<span class="ident" id="5964940">p</span><span class="op" id="5964941">.</span><span class="ident" id="5964942">trace</span>&nbsp;<span class="op" id="5964948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964952">defer</span>&nbsp;<span class="ident" id="5964958">un</span><span class="op" id="5964960">(</span><span class="ident" id="5964961">trace</span><span class="op" id="5964966">(</span><span class="ident" id="5964967">p</span><span class="op" id="5964968">,</span>&nbsp;<span class="string" id="5964970">&#34;FieldDecl&#34;</span><span class="op" id="5964981">)</span><span class="op" id="5964982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964985">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964989">doc</span>&nbsp;<span class="op" id="5964993">:=</span>&nbsp;<span class="ident" id="5964996">p</span><span class="op" id="5964997">.</span><span class="ident" id="5964998">leadComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5965012">//&nbsp;FieldDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965026">list</span><span class="op" id="5965030">,</span>&nbsp;<span class="ident" id="5965032">typ</span>&nbsp;<span class="op" id="5965036">:=</span>&nbsp;<span class="ident" id="5965039">p</span><span class="op" id="5965040">.</span><span class="ident" id="5965041">parseVarList</span><span class="op" id="5965053">(</span><span class="ident" id="5965054">false</span><span class="op" id="5965059">)</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5965063">//&nbsp;Tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965071">var</span>&nbsp;<span class="ident" id="5965075">tag</span>&nbsp;<span class="op" id="5965079">*</span><span class="ident" id="5965080">ast</span><span class="op" id="5965083">.</span><span class="ident" id="5965084">BasicLit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965094">if</span>&nbsp;<span class="ident" id="5965097">p</span><span class="op" id="5965098">.</span><span class="ident" id="5965099">tok</span>&nbsp;<span class="op" id="5965103">==</span>&nbsp;<span class="ident" id="5965106">token</span><span class="op" id="5965111">.</span><span class="ident" id="5965112">STRING</span>&nbsp;<span class="op" id="5965119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965123">tag</span>&nbsp;<span class="op" id="5965127">=</span>&nbsp;<span class="op" id="5965129">&amp;</span><span class="ident" id="5965130">ast</span><span class="op" id="5965133">.</span><span class="ident" id="5965134">BasicLit</span><span class="op" id="5965142">{</span><span class="ident" id="5965143">ValuePos</span><span class="op" id="5965151">:</span>&nbsp;<span class="ident" id="5965153">p</span><span class="op" id="5965154">.</span><span class="ident" id="5965155">pos</span><span class="op" id="5965158">,</span>&nbsp;<span class="ident" id="5965160">Kind</span><span class="op" id="5965164">:</span>&nbsp;<span class="ident" id="5965166">p</span><span class="op" id="5965167">.</span><span class="ident" id="5965168">tok</span><span class="op" id="5965171">,</span>&nbsp;<span class="ident" id="5965173">Value</span><span class="op" id="5965178">:</span>&nbsp;<span class="ident" id="5965180">p</span><span class="op" id="5965181">.</span><span class="ident" id="5965182">lit</span><span class="op" id="5965185">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965189">p</span><span class="op" id="5965190">.</span><span class="ident" id="5965191">next</span><span class="op" id="5965195">(</span><span class="op" id="5965196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5965203">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965220">var</span>&nbsp;<span class="ident" id="5965224">idents</span>&nbsp;<span class="op" id="5965231">[</span><span class="op" id="5965232">]</span><span class="op" id="5965233">*</span><span class="ident" id="5965234">ast</span><span class="op" id="5965237">.</span><span class="ident" id="5965238">Ident</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965245">if</span>&nbsp;<span class="ident" id="5965248">typ</span>&nbsp;<span class="op" id="5965252">!=</span>&nbsp;<span class="ident" id="5965255">nil</span>&nbsp;<span class="op" id="5965259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5965263">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965288">idents</span>&nbsp;<span class="op" id="5965295">=</span>&nbsp;<span class="ident" id="5965297">p</span><span class="op" id="5965298">.</span><span class="ident" id="5965299">makeIdentList</span><span class="op" id="5965312">(</span><span class="ident" id="5965313">list</span><span class="op" id="5965317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965320">}</span>&nbsp;<span class="keyword" id="5965322">else</span>&nbsp;<span class="op" id="5965327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5965331">//&nbsp;[&#34;*&#34;]&nbsp;TypeName&nbsp;(AnonymousField)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965368">typ</span>&nbsp;<span class="op" id="5965372">=</span>&nbsp;<span class="ident" id="5965374">list</span><span class="op" id="5965378">[</span><span class="num" id="5965379">0</span><span class="op" id="5965380">]</span>&nbsp;<span class="comment" id="5965382">//&nbsp;we&nbsp;always&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965423">if</span>&nbsp;<span class="ident" id="5965426">n</span>&nbsp;<span class="op" id="5965428">:=</span>&nbsp;<span class="builtinfunc" id="5965431">len</span><span class="op" id="5965434">(</span><span class="ident" id="5965435">list</span><span class="op" id="5965439">)</span><span class="op" id="5965440">;</span>&nbsp;<span class="ident" id="5965442">n</span>&nbsp;<span class="op" id="5965444">&gt;</span>&nbsp;<span class="num" id="5965446">1</span>&nbsp;<span class="op" id="5965448">||</span>&nbsp;<span class="op" id="5965451">!</span><span class="ident" id="5965452">isTypeName</span><span class="op" id="5965462">(</span><span class="ident" id="5965463">deref</span><span class="op" id="5965468">(</span><span class="ident" id="5965469">typ</span><span class="op" id="5965472">)</span><span class="op" id="5965473">)</span>&nbsp;<span class="op" id="5965475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965480">pos</span>&nbsp;<span class="op" id="5965484">:=</span>&nbsp;<span class="ident" id="5965487">typ</span><span class="op" id="5965490">.</span><span class="ident" id="5965491">Pos</span><span class="op" id="5965494">(</span><span class="op" id="5965495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965500">p</span><span class="op" id="5965501">.</span><span class="ident" id="5965502">errorExpected</span><span class="op" id="5965515">(</span><span class="ident" id="5965516">pos</span><span class="op" id="5965519">,</span>&nbsp;<span class="string" id="5965521">&#34;anonymous&nbsp;field&#34;</span><span class="op" id="5965538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965543">typ</span>&nbsp;<span class="op" id="5965547">=</span>&nbsp;<span class="op" id="5965549">&amp;</span><span class="ident" id="5965550">ast</span><span class="op" id="5965553">.</span><span class="ident" id="5965554">BadExpr</span><span class="op" id="5965561">{</span><span class="ident" id="5965562">From</span><span class="op" id="5965566">:</span>&nbsp;<span class="ident" id="5965568">pos</span><span class="op" id="5965571">,</span>&nbsp;<span class="ident" id="5965573">To</span><span class="op" id="5965575">:</span>&nbsp;<span class="ident" id="5965577">p</span><span class="op" id="5965578">.</span><span class="ident" id="5965579">safePos</span><span class="op" id="5965586">(</span><span class="ident" id="5965587">list</span><span class="op" id="5965591">[</span><span class="ident" id="5965592">n</span><span class="op" id="5965593">-</span><span class="num" id="5965594">1</span><span class="op" id="5965595">]</span><span class="op" id="5965596">.</span><span class="ident" id="5965597">End</span><span class="op" id="5965600">(</span><span class="op" id="5965601">)</span><span class="op" id="5965602">)</span><span class="op" id="5965603">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965614">p</span><span class="op" id="5965615">.</span><span class="ident" id="5965616">expectSemi</span><span class="op" id="5965626">(</span><span class="op" id="5965627">)</span>&nbsp;<span class="comment" id="5965629">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965670">field</span>&nbsp;<span class="op" id="5965676">:=</span>&nbsp;<span class="op" id="5965679">&amp;</span><span class="ident" id="5965680">ast</span><span class="op" id="5965683">.</span><span class="ident" id="5965684">Field</span><span class="op" id="5965689">{</span><span class="ident" id="5965690">Doc</span><span class="op" id="5965693">:</span>&nbsp;<span class="ident" id="5965695">doc</span><span class="op" id="5965698">,</span>&nbsp;<span class="ident" id="5965700">Names</span><span class="op" id="5965705">:</span>&nbsp;<span class="ident" id="5965707">idents</span><span class="op" id="5965713">,</span>&nbsp;<span class="ident" id="5965715">Type</span><span class="op" id="5965719">:</span>&nbsp;<span class="ident" id="5965721">typ</span><span class="op" id="5965724">,</span>&nbsp;<span class="ident" id="5965726">Tag</span><span class="op" id="5965729">:</span>&nbsp;<span class="ident" id="5965731">tag</span><span class="op" id="5965734">,</span>&nbsp;<span class="ident" id="5965736">Comment</span><span class="op" id="5965743">:</span>&nbsp;<span class="ident" id="5965745">p</span><span class="op" id="5965746">.</span><span class="ident" id="5965747">lineComment</span><span class="op" id="5965758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965761">p</span><span class="op" id="5965762">.</span><span class="ident" id="5965763">declare</span><span class="op" id="5965770">(</span><span class="ident" id="5965771">field</span><span class="op" id="5965776">,</span>&nbsp;<span class="ident" id="5965778">nil</span><span class="op" id="5965781">,</span>&nbsp;<span class="ident" id="5965783">scope</span><span class="op" id="5965788">,</span>&nbsp;<span class="ident" id="5965790">ast</span><span class="op" id="5965793">.</span><span class="ident" id="5965794">Var</span><span class="op" id="5965797">,</span>&nbsp;<span class="ident" id="5965799">idents</span><span class="op" id="5965805">...</span><span class="op" id="5965808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965811">p</span><span class="op" id="5965812">.</span><span class="ident" id="5965813">resolve</span><span class="op" id="5965820">(</span><span class="ident" id="5965821">typ</span><span class="op" id="5965824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965828">return</span>&nbsp;<span class="ident" id="5965835">field</span><br>
<span class="lineno">715</span><span class="op" id="5965841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5965844">func</span>&nbsp;<span class="op" id="5965849">(</span><span class="ident" id="5965850">p</span>&nbsp;<span class="op" id="5965852">*</span><span class="ident" id="5965853">parser</span><span class="op" id="5965859">)</span>&nbsp;<span class="ident" id="5965861">parseStructType</span><span class="op" id="5965876">(</span><span class="op" id="5965877">)</span>&nbsp;<span class="op" id="5965879">*</span><span class="ident" id="5965880">ast</span><span class="op" id="5965883">.</span><span class="ident" id="5965884">StructType</span>&nbsp;<span class="op" id="5965895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965898">if</span>&nbsp;<span class="ident" id="5965901">p</span><span class="op" id="5965902">.</span><span class="ident" id="5965903">trace</span>&nbsp;<span class="op" id="5965909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965913">defer</span>&nbsp;<span class="ident" id="5965919">un</span><span class="op" id="5965921">(</span><span class="ident" id="5965922">trace</span><span class="op" id="5965927">(</span><span class="ident" id="5965928">p</span><span class="op" id="5965929">,</span>&nbsp;<span class="string" id="5965931">&#34;StructType&#34;</span><span class="op" id="5965943">)</span><span class="op" id="5965944">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965951">pos</span>&nbsp;<span class="op" id="5965955">:=</span>&nbsp;<span class="ident" id="5965958">p</span><span class="op" id="5965959">.</span><span class="ident" id="5965960">expect</span><span class="op" id="5965966">(</span><span class="ident" id="5965967">token</span><span class="op" id="5965972">.</span><span class="ident" id="5965973">STRUCT</span><span class="op" id="5965979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965982">lbrace</span>&nbsp;<span class="op" id="5965989">:=</span>&nbsp;<span class="ident" id="5965992">p</span><span class="op" id="5965993">.</span><span class="ident" id="5965994">expect</span><span class="op" id="5966000">(</span><span class="ident" id="5966001">token</span><span class="op" id="5966006">.</span><span class="ident" id="5966007">LBRACE</span><span class="op" id="5966013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966016">scope</span>&nbsp;<span class="op" id="5966022">:=</span>&nbsp;<span class="ident" id="5966025">ast</span><span class="op" id="5966028">.</span><span class="ident" id="5966029">NewScope</span><span class="op" id="5966037">(</span><span class="ident" id="5966038">nil</span><span class="op" id="5966041">)</span>&nbsp;<span class="comment" id="5966043">//&nbsp;struct&nbsp;scope</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966060">var</span>&nbsp;<span class="ident" id="5966064">list</span>&nbsp;<span class="op" id="5966069">[</span><span class="op" id="5966070">]</span><span class="op" id="5966071">*</span><span class="ident" id="5966072">ast</span><span class="op" id="5966075">.</span><span class="ident" id="5966076">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966083">for</span>&nbsp;<span class="ident" id="5966087">p</span><span class="op" id="5966088">.</span><span class="ident" id="5966089">tok</span>&nbsp;<span class="op" id="5966093">==</span>&nbsp;<span class="ident" id="5966096">token</span><span class="op" id="5966101">.</span><span class="ident" id="5966102">IDENT</span>&nbsp;<span class="op" id="5966108">||</span>&nbsp;<span class="ident" id="5966111">p</span><span class="op" id="5966112">.</span><span class="ident" id="5966113">tok</span>&nbsp;<span class="op" id="5966117">==</span>&nbsp;<span class="ident" id="5966120">token</span><span class="op" id="5966125">.</span><span class="ident" id="5966126">MUL</span>&nbsp;<span class="op" id="5966130">||</span>&nbsp;<span class="ident" id="5966133">p</span><span class="op" id="5966134">.</span><span class="ident" id="5966135">tok</span>&nbsp;<span class="op" id="5966139">==</span>&nbsp;<span class="ident" id="5966142">token</span><span class="op" id="5966147">.</span><span class="ident" id="5966148">LPAREN</span>&nbsp;<span class="op" id="5966155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5966159">//&nbsp;a&nbsp;field&nbsp;declaration&nbsp;cannot&nbsp;start&nbsp;with&nbsp;a&nbsp;&#39;(&#39;&nbsp;but&nbsp;we&nbsp;accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5966222">//&nbsp;it&nbsp;here&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;better&nbsp;error&nbsp;messages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5966285">//&nbsp;(parseFieldDecl&nbsp;will&nbsp;check&nbsp;and&nbsp;complain&nbsp;if&nbsp;necessary)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966344">list</span>&nbsp;<span class="op" id="5966349">=</span>&nbsp;<span class="builtinfunc" id="5966351">append</span><span class="op" id="5966357">(</span><span class="ident" id="5966358">list</span><span class="op" id="5966362">,</span>&nbsp;<span class="ident" id="5966364">p</span><span class="op" id="5966365">.</span><span class="ident" id="5966366">parseFieldDecl</span><span class="op" id="5966380">(</span><span class="ident" id="5966381">scope</span><span class="op" id="5966386">)</span><span class="op" id="5966387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966393">rbrace</span>&nbsp;<span class="op" id="5966400">:=</span>&nbsp;<span class="ident" id="5966403">p</span><span class="op" id="5966404">.</span><span class="ident" id="5966405">expect</span><span class="op" id="5966411">(</span><span class="ident" id="5966412">token</span><span class="op" id="5966417">.</span><span class="ident" id="5966418">RBRACE</span><span class="op" id="5966424">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966428">return</span>&nbsp;<span class="op" id="5966435">&amp;</span><span class="ident" id="5966436">ast</span><span class="op" id="5966439">.</span><span class="ident" id="5966440">StructType</span><span class="op" id="5966450">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966454">Struct</span><span class="op" id="5966460">:</span>&nbsp;<span class="ident" id="5966462">pos</span><span class="op" id="5966465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966469">Fields</span><span class="op" id="5966475">:</span>&nbsp;<span class="op" id="5966477">&amp;</span><span class="ident" id="5966478">ast</span><span class="op" id="5966481">.</span><span class="ident" id="5966482">FieldList</span><span class="op" id="5966491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966496">Opening</span><span class="op" id="5966503">:</span>&nbsp;<span class="ident" id="5966505">lbrace</span><span class="op" id="5966511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966516">List</span><span class="op" id="5966520">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966525">list</span><span class="op" id="5966529">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966534">Closing</span><span class="op" id="5966541">:</span>&nbsp;<span class="ident" id="5966543">rbrace</span><span class="op" id="5966549">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966553">}</span><span class="op" id="5966554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966557">}</span><br>
<span class="lineno"></span><span class="op" id="5966559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5966562">func</span>&nbsp;<span class="op" id="5966567">(</span><span class="ident" id="5966568">p</span>&nbsp;<span class="op" id="5966570">*</span><span class="ident" id="5966571">parser</span><span class="op" id="5966577">)</span>&nbsp;<span class="ident" id="5966579">parsePointerType</span><span class="op" id="5966595">(</span><span class="op" id="5966596">)</span>&nbsp;<span class="op" id="5966598">*</span><span class="ident" id="5966599">ast</span><span class="op" id="5966602">.</span><span class="ident" id="5966603">StarExpr</span>&nbsp;<span class="op" id="5966612">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966615">if</span>&nbsp;<span class="ident" id="5966618">p</span><span class="op" id="5966619">.</span><span class="ident" id="5966620">trace</span>&nbsp;<span class="op" id="5966626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966630">defer</span>&nbsp;<span class="ident" id="5966636">un</span><span class="op" id="5966638">(</span><span class="ident" id="5966639">trace</span><span class="op" id="5966644">(</span><span class="ident" id="5966645">p</span><span class="op" id="5966646">,</span>&nbsp;<span class="string" id="5966648">&#34;PointerType&#34;</span><span class="op" id="5966661">)</span><span class="op" id="5966662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966669">star</span>&nbsp;<span class="op" id="5966674">:=</span>&nbsp;<span class="ident" id="5966677">p</span><span class="op" id="5966678">.</span><span class="ident" id="5966679">expect</span><span class="op" id="5966685">(</span><span class="ident" id="5966686">token</span><span class="op" id="5966691">.</span><span class="ident" id="5966692">MUL</span><span class="op" id="5966695">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966698">base</span>&nbsp;<span class="op" id="5966703">:=</span>&nbsp;<span class="ident" id="5966706">p</span><span class="op" id="5966707">.</span><span class="ident" id="5966708">parseType</span><span class="op" id="5966717">(</span><span class="op" id="5966718">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966722">return</span>&nbsp;<span class="op" id="5966729">&amp;</span><span class="ident" id="5966730">ast</span><span class="op" id="5966733">.</span><span class="ident" id="5966734">StarExpr</span><span class="op" id="5966742">{</span><span class="ident" id="5966743">Star</span><span class="op" id="5966747">:</span>&nbsp;<span class="ident" id="5966749">star</span><span class="op" id="5966753">,</span>&nbsp;<span class="ident" id="5966755">X</span><span class="op" id="5966756">:</span>&nbsp;<span class="ident" id="5966758">base</span><span class="op" id="5966762">}</span><br>
<span class="lineno"></span><span class="op" id="5966764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="5966767">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5966822">func</span>&nbsp;<span class="op" id="5966827">(</span><span class="ident" id="5966828">p</span>&nbsp;<span class="op" id="5966830">*</span><span class="ident" id="5966831">parser</span><span class="op" id="5966837">)</span>&nbsp;<span class="ident" id="5966839">tryVarType</span><span class="op" id="5966849">(</span><span class="ident" id="5966850">isParam</span>&nbsp;<span class="builtintype" id="5966858">bool</span><span class="op" id="5966862">)</span>&nbsp;<span class="ident" id="5966864">ast</span><span class="op" id="5966867">.</span><span class="ident" id="5966868">Expr</span>&nbsp;<span class="op" id="5966873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966876">if</span>&nbsp;<span class="ident" id="5966879">isParam</span>&nbsp;<span class="op" id="5966887">&amp;&amp;</span>&nbsp;<span class="ident" id="5966890">p</span><span class="op" id="5966891">.</span><span class="ident" id="5966892">tok</span>&nbsp;<span class="op" id="5966896">==</span>&nbsp;<span class="ident" id="5966899">token</span><span class="op" id="5966904">.</span><span class="ident" id="5966905">ELLIPSIS</span>&nbsp;<span class="op" id="5966914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966918">pos</span>&nbsp;<span class="op" id="5966922">:=</span>&nbsp;<span class="ident" id="5966925">p</span><span class="op" id="5966926">.</span><span class="ident" id="5966927">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966933">p</span><span class="op" id="5966934">.</span><span class="ident" id="5966935">next</span><span class="op" id="5966939">(</span><span class="op" id="5966940">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966944">typ</span>&nbsp;<span class="op" id="5966948">:=</span>&nbsp;<span class="ident" id="5966951">p</span><span class="op" id="5966952">.</span><span class="ident" id="5966953">tryIdentOrType</span><span class="op" id="5966967">(</span><span class="op" id="5966968">)</span>&nbsp;<span class="comment" id="5966970">//&nbsp;don&#39;t&nbsp;use&nbsp;parseType&nbsp;so&nbsp;we&nbsp;can&nbsp;provide&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967034">if</span>&nbsp;<span class="ident" id="5967037">typ</span>&nbsp;<span class="op" id="5967041">!=</span>&nbsp;<span class="ident" id="5967044">nil</span>&nbsp;<span class="op" id="5967048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967053">p</span><span class="op" id="5967054">.</span><span class="ident" id="5967055">resolve</span><span class="op" id="5967062">(</span><span class="ident" id="5967063">typ</span><span class="op" id="5967066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967070">}</span>&nbsp;<span class="keyword" id="5967072">else</span>&nbsp;<span class="op" id="5967077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967082">p</span><span class="op" id="5967083">.</span><span class="builtintype" id="5967084">error</span><span class="op" id="5967089">(</span><span class="ident" id="5967090">pos</span><span class="op" id="5967093">,</span>&nbsp;<span class="string" id="5967095">&#34;&#39;...&#39;&nbsp;parameter&nbsp;is&nbsp;missing&nbsp;type&#34;</span><span class="op" id="5967128">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967133">typ</span>&nbsp;<span class="op" id="5967137">=</span>&nbsp;<span class="op" id="5967139">&amp;</span><span class="ident" id="5967140">ast</span><span class="op" id="5967143">.</span><span class="ident" id="5967144">BadExpr</span><span class="op" id="5967151">{</span><span class="ident" id="5967152">From</span><span class="op" id="5967156">:</span>&nbsp;<span class="ident" id="5967158">pos</span><span class="op" id="5967161">,</span>&nbsp;<span class="ident" id="5967163">To</span><span class="op" id="5967165">:</span>&nbsp;<span class="ident" id="5967167">p</span><span class="op" id="5967168">.</span><span class="ident" id="5967169">pos</span><span class="op" id="5967172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967180">return</span>&nbsp;<span class="op" id="5967187">&amp;</span><span class="ident" id="5967188">ast</span><span class="op" id="5967191">.</span><span class="ident" id="5967192">Ellipsis</span><span class="op" id="5967200">{</span><span class="ident" id="5967201">Ellipsis</span><span class="op" id="5967209">:</span>&nbsp;<span class="ident" id="5967211">pos</span><span class="op" id="5967214">,</span>&nbsp;<span class="ident" id="5967216">Elt</span><span class="op" id="5967219">:</span>&nbsp;<span class="ident" id="5967221">typ</span><span class="op" id="5967224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967230">return</span>&nbsp;<span class="ident" id="5967237">p</span><span class="op" id="5967238">.</span><span class="ident" id="5967239">tryIdentOrType</span><span class="op" id="5967253">(</span><span class="op" id="5967254">)</span><br>
<span class="lineno">770</span><span class="op" id="5967256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5967259">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5967314">func</span>&nbsp;<span class="op" id="5967319">(</span><span class="ident" id="5967320">p</span>&nbsp;<span class="op" id="5967322">*</span><span class="ident" id="5967323">parser</span><span class="op" id="5967329">)</span>&nbsp;<span class="ident" id="5967331">parseVarType</span><span class="op" id="5967343">(</span><span class="ident" id="5967344">isParam</span>&nbsp;<span class="builtintype" id="5967352">bool</span><span class="op" id="5967356">)</span>&nbsp;<span class="ident" id="5967358">ast</span><span class="op" id="5967361">.</span><span class="ident" id="5967362">Expr</span>&nbsp;<span class="op" id="5967367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967370">typ</span>&nbsp;<span class="op" id="5967374">:=</span>&nbsp;<span class="ident" id="5967377">p</span><span class="op" id="5967378">.</span><span class="ident" id="5967379">tryVarType</span><span class="op" id="5967389">(</span><span class="ident" id="5967390">isParam</span><span class="op" id="5967397">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967400">if</span>&nbsp;<span class="ident" id="5967403">typ</span>&nbsp;<span class="op" id="5967407">==</span>&nbsp;<span class="ident" id="5967410">nil</span>&nbsp;<span class="op" id="5967414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967418">pos</span>&nbsp;<span class="op" id="5967422">:=</span>&nbsp;<span class="ident" id="5967425">p</span><span class="op" id="5967426">.</span><span class="ident" id="5967427">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967433">p</span><span class="op" id="5967434">.</span><span class="ident" id="5967435">errorExpected</span><span class="op" id="5967448">(</span><span class="ident" id="5967449">pos</span><span class="op" id="5967452">,</span>&nbsp;<span class="string" id="5967454">&#34;type&#34;</span><span class="op" id="5967460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967464">p</span><span class="op" id="5967465">.</span><span class="ident" id="5967466">next</span><span class="op" id="5967470">(</span><span class="op" id="5967471">)</span>&nbsp;<span class="comment" id="5967473">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967492">typ</span>&nbsp;<span class="op" id="5967496">=</span>&nbsp;<span class="op" id="5967498">&amp;</span><span class="ident" id="5967499">ast</span><span class="op" id="5967502">.</span><span class="ident" id="5967503">BadExpr</span><span class="op" id="5967510">{</span><span class="ident" id="5967511">From</span><span class="op" id="5967515">:</span>&nbsp;<span class="ident" id="5967517">pos</span><span class="op" id="5967520">,</span>&nbsp;<span class="ident" id="5967522">To</span><span class="op" id="5967524">:</span>&nbsp;<span class="ident" id="5967526">p</span><span class="op" id="5967527">.</span><span class="ident" id="5967528">pos</span><span class="op" id="5967531">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967537">return</span>&nbsp;<span class="ident" id="5967544">typ</span><br>
<span class="lineno"></span><span class="op" id="5967548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5967551">//&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;results&nbsp;are&nbsp;identifiers,&nbsp;they&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">785</span><span class="keyword" id="5967616">func</span>&nbsp;<span class="op" id="5967621">(</span><span class="ident" id="5967622">p</span>&nbsp;<span class="op" id="5967624">*</span><span class="ident" id="5967625">parser</span><span class="op" id="5967631">)</span>&nbsp;<span class="ident" id="5967633">parseVarList</span><span class="op" id="5967645">(</span><span class="ident" id="5967646">isParam</span>&nbsp;<span class="builtintype" id="5967654">bool</span><span class="op" id="5967658">)</span>&nbsp;<span class="op" id="5967660">(</span><span class="ident" id="5967661">list</span>&nbsp;<span class="op" id="5967666">[</span><span class="op" id="5967667">]</span><span class="ident" id="5967668">ast</span><span class="op" id="5967671">.</span><span class="ident" id="5967672">Expr</span><span class="op" id="5967676">,</span>&nbsp;<span class="ident" id="5967678">typ</span>&nbsp;<span class="ident" id="5967682">ast</span><span class="op" id="5967685">.</span><span class="ident" id="5967686">Expr</span><span class="op" id="5967690">)</span>&nbsp;<span class="op" id="5967692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967695">if</span>&nbsp;<span class="ident" id="5967698">p</span><span class="op" id="5967699">.</span><span class="ident" id="5967700">trace</span>&nbsp;<span class="op" id="5967706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967710">defer</span>&nbsp;<span class="ident" id="5967716">un</span><span class="op" id="5967718">(</span><span class="ident" id="5967719">trace</span><span class="op" id="5967724">(</span><span class="ident" id="5967725">p</span><span class="op" id="5967726">,</span>&nbsp;<span class="string" id="5967728">&#34;VarList&#34;</span><span class="op" id="5967737">)</span><span class="op" id="5967738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967745">//&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers&nbsp;looks&nbsp;like&nbsp;a&nbsp;list&nbsp;of&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967803">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967807">//&nbsp;parse/tryVarType&nbsp;accepts&nbsp;any&nbsp;type&nbsp;(including&nbsp;parenthesized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967870">//&nbsp;ones)&nbsp;even&nbsp;though&nbsp;the&nbsp;syntax&nbsp;does&nbsp;not&nbsp;permit&nbsp;them&nbsp;here:&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967933">//&nbsp;accept&nbsp;them&nbsp;all&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;complain&nbsp;later</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967996">for</span>&nbsp;<span class="ident" id="5968000">typ</span>&nbsp;<span class="op" id="5968004">:=</span>&nbsp;<span class="ident" id="5968007">p</span><span class="op" id="5968008">.</span><span class="ident" id="5968009">parseVarType</span><span class="op" id="5968021">(</span><span class="ident" id="5968022">isParam</span><span class="op" id="5968029">)</span><span class="op" id="5968030">;</span>&nbsp;<span class="ident" id="5968032">typ</span>&nbsp;<span class="op" id="5968036">!=</span>&nbsp;<span class="ident" id="5968039">nil</span><span class="op" id="5968042">;</span>&nbsp;<span class="op" id="5968044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968048">list</span>&nbsp;<span class="op" id="5968053">=</span>&nbsp;<span class="builtinfunc" id="5968055">append</span><span class="op" id="5968061">(</span><span class="ident" id="5968062">list</span><span class="op" id="5968066">,</span>&nbsp;<span class="ident" id="5968068">typ</span><span class="op" id="5968071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968075">if</span>&nbsp;<span class="ident" id="5968078">p</span><span class="op" id="5968079">.</span><span class="ident" id="5968080">tok</span>&nbsp;<span class="op" id="5968084">!=</span>&nbsp;<span class="ident" id="5968087">token</span><span class="op" id="5968092">.</span><span class="ident" id="5968093">COMMA</span>&nbsp;<span class="op" id="5968099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968104">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968112">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968116">p</span><span class="op" id="5968117">.</span><span class="ident" id="5968118">next</span><span class="op" id="5968122">(</span><span class="op" id="5968123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968127">typ</span>&nbsp;<span class="op" id="5968131">=</span>&nbsp;<span class="ident" id="5968133">p</span><span class="op" id="5968134">.</span><span class="ident" id="5968135">tryVarType</span><span class="op" id="5968145">(</span><span class="ident" id="5968146">isParam</span><span class="op" id="5968153">)</span>&nbsp;<span class="comment" id="5968155">//&nbsp;maybe&nbsp;nil&nbsp;as&nbsp;in:&nbsp;func&nbsp;f(int,)&nbsp;{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968196">//&nbsp;if&nbsp;we&nbsp;had&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers,&nbsp;it&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;type</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968263">typ</span>&nbsp;<span class="op" id="5968267">=</span>&nbsp;<span class="ident" id="5968269">p</span><span class="op" id="5968270">.</span><span class="ident" id="5968271">tryVarType</span><span class="op" id="5968281">(</span><span class="ident" id="5968282">isParam</span><span class="op" id="5968289">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968293">return</span><br>
<span class="lineno"></span><span class="op" id="5968300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="5968303">func</span>&nbsp;<span class="op" id="5968308">(</span><span class="ident" id="5968309">p</span>&nbsp;<span class="op" id="5968311">*</span><span class="ident" id="5968312">parser</span><span class="op" id="5968318">)</span>&nbsp;<span class="ident" id="5968320">parseParameterList</span><span class="op" id="5968338">(</span><span class="ident" id="5968339">scope</span>&nbsp;<span class="op" id="5968345">*</span><span class="ident" id="5968346">ast</span><span class="op" id="5968349">.</span><span class="ident" id="5968350">Scope</span><span class="op" id="5968355">,</span>&nbsp;<span class="ident" id="5968357">ellipsisOk</span>&nbsp;<span class="builtintype" id="5968368">bool</span><span class="op" id="5968372">)</span>&nbsp;<span class="op" id="5968374">(</span><span class="ident" id="5968375">params</span>&nbsp;<span class="op" id="5968382">[</span><span class="op" id="5968383">]</span><span class="op" id="5968384">*</span><span class="ident" id="5968385">ast</span><span class="op" id="5968388">.</span><span class="ident" id="5968389">Field</span><span class="op" id="5968394">)</span>&nbsp;<span class="op" id="5968396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968399">if</span>&nbsp;<span class="ident" id="5968402">p</span><span class="op" id="5968403">.</span><span class="ident" id="5968404">trace</span>&nbsp;<span class="op" id="5968410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968414">defer</span>&nbsp;<span class="ident" id="5968420">un</span><span class="op" id="5968422">(</span><span class="ident" id="5968423">trace</span><span class="op" id="5968428">(</span><span class="ident" id="5968429">p</span><span class="op" id="5968430">,</span>&nbsp;<span class="string" id="5968432">&#34;ParameterList&#34;</span><span class="op" id="5968447">)</span><span class="op" id="5968448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968455">//&nbsp;ParameterDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968473">list</span><span class="op" id="5968477">,</span>&nbsp;<span class="ident" id="5968479">typ</span>&nbsp;<span class="op" id="5968483">:=</span>&nbsp;<span class="ident" id="5968486">p</span><span class="op" id="5968487">.</span><span class="ident" id="5968488">parseVarList</span><span class="op" id="5968500">(</span><span class="ident" id="5968501">ellipsisOk</span><span class="op" id="5968511">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968515">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968532">if</span>&nbsp;<span class="ident" id="5968535">typ</span>&nbsp;<span class="op" id="5968539">!=</span>&nbsp;<span class="ident" id="5968542">nil</span>&nbsp;<span class="op" id="5968546">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968550">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968575">idents</span>&nbsp;<span class="op" id="5968582">:=</span>&nbsp;<span class="ident" id="5968585">p</span><span class="op" id="5968586">.</span><span class="ident" id="5968587">makeIdentList</span><span class="op" id="5968600">(</span><span class="ident" id="5968601">list</span><span class="op" id="5968605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968609">field</span>&nbsp;<span class="op" id="5968615">:=</span>&nbsp;<span class="op" id="5968618">&amp;</span><span class="ident" id="5968619">ast</span><span class="op" id="5968622">.</span><span class="ident" id="5968623">Field</span><span class="op" id="5968628">{</span><span class="ident" id="5968629">Names</span><span class="op" id="5968634">:</span>&nbsp;<span class="ident" id="5968636">idents</span><span class="op" id="5968642">,</span>&nbsp;<span class="ident" id="5968644">Type</span><span class="op" id="5968648">:</span>&nbsp;<span class="ident" id="5968650">typ</span><span class="op" id="5968653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968657">params</span>&nbsp;<span class="op" id="5968664">=</span>&nbsp;<span class="builtinfunc" id="5968666">append</span><span class="op" id="5968672">(</span><span class="ident" id="5968673">params</span><span class="op" id="5968679">,</span>&nbsp;<span class="ident" id="5968681">field</span><span class="op" id="5968686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968690">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968751">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968807">p</span><span class="op" id="5968808">.</span><span class="ident" id="5968809">declare</span><span class="op" id="5968816">(</span><span class="ident" id="5968817">field</span><span class="op" id="5968822">,</span>&nbsp;<span class="ident" id="5968824">nil</span><span class="op" id="5968827">,</span>&nbsp;<span class="ident" id="5968829">scope</span><span class="op" id="5968834">,</span>&nbsp;<span class="ident" id="5968836">ast</span><span class="op" id="5968839">.</span><span class="ident" id="5968840">Var</span><span class="op" id="5968843">,</span>&nbsp;<span class="ident" id="5968845">idents</span><span class="op" id="5968851">...</span><span class="op" id="5968854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968858">p</span><span class="op" id="5968859">.</span><span class="ident" id="5968860">resolve</span><span class="op" id="5968867">(</span><span class="ident" id="5968868">typ</span><span class="op" id="5968871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968875">if</span>&nbsp;<span class="op" id="5968878">!</span><span class="ident" id="5968879">p</span><span class="op" id="5968880">.</span><span class="ident" id="5968881">atComma</span><span class="op" id="5968888">(</span><span class="string" id="5968889">&#34;parameter&nbsp;list&#34;</span><span class="op" id="5968905">)</span>&nbsp;<span class="op" id="5968907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968912">return</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968925">p</span><span class="op" id="5968926">.</span><span class="ident" id="5968927">next</span><span class="op" id="5968931">(</span><span class="op" id="5968932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968936">for</span>&nbsp;<span class="ident" id="5968940">p</span><span class="op" id="5968941">.</span><span class="ident" id="5968942">tok</span>&nbsp;<span class="op" id="5968946">!=</span>&nbsp;<span class="ident" id="5968949">token</span><span class="op" id="5968954">.</span><span class="ident" id="5968955">RPAREN</span>&nbsp;<span class="op" id="5968962">&amp;&amp;</span>&nbsp;<span class="ident" id="5968965">p</span><span class="op" id="5968966">.</span><span class="ident" id="5968967">tok</span>&nbsp;<span class="op" id="5968971">!=</span>&nbsp;<span class="ident" id="5968974">token</span><span class="op" id="5968979">.</span><span class="ident" id="5968980">EOF</span>&nbsp;<span class="op" id="5968984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968989">idents</span>&nbsp;<span class="op" id="5968996">:=</span>&nbsp;<span class="ident" id="5968999">p</span><span class="op" id="5969000">.</span><span class="ident" id="5969001">parseIdentList</span><span class="op" id="5969015">(</span><span class="op" id="5969016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969021">typ</span>&nbsp;<span class="op" id="5969025">:=</span>&nbsp;<span class="ident" id="5969028">p</span><span class="op" id="5969029">.</span><span class="ident" id="5969030">parseVarType</span><span class="op" id="5969042">(</span><span class="ident" id="5969043">ellipsisOk</span><span class="op" id="5969053">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969058">field</span>&nbsp;<span class="op" id="5969064">:=</span>&nbsp;<span class="op" id="5969067">&amp;</span><span class="ident" id="5969068">ast</span><span class="op" id="5969071">.</span><span class="ident" id="5969072">Field</span><span class="op" id="5969077">{</span><span class="ident" id="5969078">Names</span><span class="op" id="5969083">:</span>&nbsp;<span class="ident" id="5969085">idents</span><span class="op" id="5969091">,</span>&nbsp;<span class="ident" id="5969093">Type</span><span class="op" id="5969097">:</span>&nbsp;<span class="ident" id="5969099">typ</span><span class="op" id="5969102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969107">params</span>&nbsp;<span class="op" id="5969114">=</span>&nbsp;<span class="builtinfunc" id="5969116">append</span><span class="op" id="5969122">(</span><span class="ident" id="5969123">params</span><span class="op" id="5969129">,</span>&nbsp;<span class="ident" id="5969131">field</span><span class="op" id="5969136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969141">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969203">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969260">p</span><span class="op" id="5969261">.</span><span class="ident" id="5969262">declare</span><span class="op" id="5969269">(</span><span class="ident" id="5969270">field</span><span class="op" id="5969275">,</span>&nbsp;<span class="ident" id="5969277">nil</span><span class="op" id="5969280">,</span>&nbsp;<span class="ident" id="5969282">scope</span><span class="op" id="5969287">,</span>&nbsp;<span class="ident" id="5969289">ast</span><span class="op" id="5969292">.</span><span class="ident" id="5969293">Var</span><span class="op" id="5969296">,</span>&nbsp;<span class="ident" id="5969298">idents</span><span class="op" id="5969304">...</span><span class="op" id="5969307">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969312">p</span><span class="op" id="5969313">.</span><span class="ident" id="5969314">resolve</span><span class="op" id="5969321">(</span><span class="ident" id="5969322">typ</span><span class="op" id="5969325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969330">if</span>&nbsp;<span class="op" id="5969333">!</span><span class="ident" id="5969334">p</span><span class="op" id="5969335">.</span><span class="ident" id="5969336">atComma</span><span class="op" id="5969343">(</span><span class="string" id="5969344">&#34;parameter&nbsp;list&#34;</span><span class="op" id="5969360">)</span>&nbsp;<span class="op" id="5969362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969368">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969382">p</span><span class="op" id="5969383">.</span><span class="ident" id="5969384">next</span><span class="op" id="5969388">(</span><span class="op" id="5969389">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969397">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969409">//&nbsp;Type&nbsp;{&nbsp;&#34;,&#34;&nbsp;Type&nbsp;}&nbsp;(anonymous&nbsp;parameters)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969454">params</span>&nbsp;<span class="op" id="5969461">=</span>&nbsp;<span class="builtinfunc" id="5969463">make</span><span class="op" id="5969467">(</span><span class="op" id="5969468">[</span><span class="op" id="5969469">]</span><span class="op" id="5969470">*</span><span class="ident" id="5969471">ast</span><span class="op" id="5969474">.</span><span class="ident" id="5969475">Field</span><span class="op" id="5969480">,</span>&nbsp;<span class="builtinfunc" id="5969482">len</span><span class="op" id="5969485">(</span><span class="ident" id="5969486">list</span><span class="op" id="5969490">)</span><span class="op" id="5969491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969494">for</span>&nbsp;<span class="ident" id="5969498">i</span><span class="op" id="5969499">,</span>&nbsp;<span class="ident" id="5969501">typ</span>&nbsp;<span class="op" id="5969505">:=</span>&nbsp;<span class="keyword" id="5969508">range</span>&nbsp;<span class="ident" id="5969514">list</span>&nbsp;<span class="op" id="5969519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969523">p</span><span class="op" id="5969524">.</span><span class="ident" id="5969525">resolve</span><span class="op" id="5969532">(</span><span class="ident" id="5969533">typ</span><span class="op" id="5969536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969540">params</span><span class="op" id="5969546">[</span><span class="ident" id="5969547">i</span><span class="op" id="5969548">]</span>&nbsp;<span class="op" id="5969550">=</span>&nbsp;<span class="op" id="5969552">&amp;</span><span class="ident" id="5969553">ast</span><span class="op" id="5969556">.</span><span class="ident" id="5969557">Field</span><span class="op" id="5969562">{</span><span class="ident" id="5969563">Type</span><span class="op" id="5969567">:</span>&nbsp;<span class="ident" id="5969569">typ</span><span class="op" id="5969572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969575">}</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969578">return</span><br>
<span class="lineno"></span><span class="op" id="5969585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5969588">func</span>&nbsp;<span class="op" id="5969593">(</span><span class="ident" id="5969594">p</span>&nbsp;<span class="op" id="5969596">*</span><span class="ident" id="5969597">parser</span><span class="op" id="5969603">)</span>&nbsp;<span class="ident" id="5969605">parseParameters</span><span class="op" id="5969620">(</span><span class="ident" id="5969621">scope</span>&nbsp;<span class="op" id="5969627">*</span><span class="ident" id="5969628">ast</span><span class="op" id="5969631">.</span><span class="ident" id="5969632">Scope</span><span class="op" id="5969637">,</span>&nbsp;<span class="ident" id="5969639">ellipsisOk</span>&nbsp;<span class="builtintype" id="5969650">bool</span><span class="op" id="5969654">)</span>&nbsp;<span class="op" id="5969656">*</span><span class="ident" id="5969657">ast</span><span class="op" id="5969660">.</span><span class="ident" id="5969661">FieldList</span>&nbsp;<span class="op" id="5969671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969674">if</span>&nbsp;<span class="ident" id="5969677">p</span><span class="op" id="5969678">.</span><span class="ident" id="5969679">trace</span>&nbsp;<span class="op" id="5969685">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969689">defer</span>&nbsp;<span class="ident" id="5969695">un</span><span class="op" id="5969697">(</span><span class="ident" id="5969698">trace</span><span class="op" id="5969703">(</span><span class="ident" id="5969704">p</span><span class="op" id="5969705">,</span>&nbsp;<span class="string" id="5969707">&#34;Parameters&#34;</span><span class="op" id="5969719">)</span><span class="op" id="5969720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969727">var</span>&nbsp;<span class="ident" id="5969731">params</span>&nbsp;<span class="op" id="5969738">[</span><span class="op" id="5969739">]</span><span class="op" id="5969740">*</span><span class="ident" id="5969741">ast</span><span class="op" id="5969744">.</span><span class="ident" id="5969745">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969752">lparen</span>&nbsp;<span class="op" id="5969759">:=</span>&nbsp;<span class="ident" id="5969762">p</span><span class="op" id="5969763">.</span><span class="ident" id="5969764">expect</span><span class="op" id="5969770">(</span><span class="ident" id="5969771">token</span><span class="op" id="5969776">.</span><span class="ident" id="5969777">LPAREN</span><span class="op" id="5969783">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969786">if</span>&nbsp;<span class="ident" id="5969789">p</span><span class="op" id="5969790">.</span><span class="ident" id="5969791">tok</span>&nbsp;<span class="op" id="5969795">!=</span>&nbsp;<span class="ident" id="5969798">token</span><span class="op" id="5969803">.</span><span class="ident" id="5969804">RPAREN</span>&nbsp;<span class="op" id="5969811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969815">params</span>&nbsp;<span class="op" id="5969822">=</span>&nbsp;<span class="ident" id="5969824">p</span><span class="op" id="5969825">.</span><span class="ident" id="5969826">parseParameterList</span><span class="op" id="5969844">(</span><span class="ident" id="5969845">scope</span><span class="op" id="5969850">,</span>&nbsp;<span class="ident" id="5969852">ellipsisOk</span><span class="op" id="5969862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969868">rparen</span>&nbsp;<span class="op" id="5969875">:=</span>&nbsp;<span class="ident" id="5969878">p</span><span class="op" id="5969879">.</span><span class="ident" id="5969880">expect</span><span class="op" id="5969886">(</span><span class="ident" id="5969887">token</span><span class="op" id="5969892">.</span><span class="ident" id="5969893">RPAREN</span><span class="op" id="5969899">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969903">return</span>&nbsp;<span class="op" id="5969910">&amp;</span><span class="ident" id="5969911">ast</span><span class="op" id="5969914">.</span><span class="ident" id="5969915">FieldList</span><span class="op" id="5969924">{</span><span class="ident" id="5969925">Opening</span><span class="op" id="5969932">:</span>&nbsp;<span class="ident" id="5969934">lparen</span><span class="op" id="5969940">,</span>&nbsp;<span class="ident" id="5969942">List</span><span class="op" id="5969946">:</span>&nbsp;<span class="ident" id="5969948">params</span><span class="op" id="5969954">,</span>&nbsp;<span class="ident" id="5969956">Closing</span><span class="op" id="5969963">:</span>&nbsp;<span class="ident" id="5969965">rparen</span><span class="op" id="5969971">}</span><br>
<span class="lineno"></span><span class="op" id="5969973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5969976">func</span>&nbsp;<span class="op" id="5969981">(</span><span class="ident" id="5969982">p</span>&nbsp;<span class="op" id="5969984">*</span><span class="ident" id="5969985">parser</span><span class="op" id="5969991">)</span>&nbsp;<span class="ident" id="5969993">parseResult</span><span class="op" id="5970004">(</span><span class="ident" id="5970005">scope</span>&nbsp;<span class="op" id="5970011">*</span><span class="ident" id="5970012">ast</span><span class="op" id="5970015">.</span><span class="ident" id="5970016">Scope</span><span class="op" id="5970021">)</span>&nbsp;<span class="op" id="5970023">*</span><span class="ident" id="5970024">ast</span><span class="op" id="5970027">.</span><span class="ident" id="5970028">FieldList</span>&nbsp;<span class="op" id="5970038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970041">if</span>&nbsp;<span class="ident" id="5970044">p</span><span class="op" id="5970045">.</span><span class="ident" id="5970046">trace</span>&nbsp;<span class="op" id="5970052">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970056">defer</span>&nbsp;<span class="ident" id="5970062">un</span><span class="op" id="5970064">(</span><span class="ident" id="5970065">trace</span><span class="op" id="5970070">(</span><span class="ident" id="5970071">p</span><span class="op" id="5970072">,</span>&nbsp;<span class="string" id="5970074">&#34;Result&#34;</span><span class="op" id="5970082">)</span><span class="op" id="5970083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970090">if</span>&nbsp;<span class="ident" id="5970093">p</span><span class="op" id="5970094">.</span><span class="ident" id="5970095">tok</span>&nbsp;<span class="op" id="5970099">==</span>&nbsp;<span class="ident" id="5970102">token</span><span class="op" id="5970107">.</span><span class="ident" id="5970108">LPAREN</span>&nbsp;<span class="op" id="5970115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970119">return</span>&nbsp;<span class="ident" id="5970126">p</span><span class="op" id="5970127">.</span><span class="ident" id="5970128">parseParameters</span><span class="op" id="5970143">(</span><span class="ident" id="5970144">scope</span><span class="op" id="5970149">,</span>&nbsp;<span class="ident" id="5970151">false</span><span class="op" id="5970156">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970163">typ</span>&nbsp;<span class="op" id="5970167">:=</span>&nbsp;<span class="ident" id="5970170">p</span><span class="op" id="5970171">.</span><span class="ident" id="5970172">tryType</span><span class="op" id="5970179">(</span><span class="op" id="5970180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970183">if</span>&nbsp;<span class="ident" id="5970186">typ</span>&nbsp;<span class="op" id="5970190">!=</span>&nbsp;<span class="ident" id="5970193">nil</span>&nbsp;<span class="op" id="5970197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970201">list</span>&nbsp;<span class="op" id="5970206">:=</span>&nbsp;<span class="builtinfunc" id="5970209">make</span><span class="op" id="5970213">(</span><span class="op" id="5970214">[</span><span class="op" id="5970215">]</span><span class="op" id="5970216">*</span><span class="ident" id="5970217">ast</span><span class="op" id="5970220">.</span><span class="ident" id="5970221">Field</span><span class="op" id="5970226">,</span>&nbsp;<span class="num" id="5970228">1</span><span class="op" id="5970229">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970233">list</span><span class="op" id="5970237">[</span><span class="num" id="5970238">0</span><span class="op" id="5970239">]</span>&nbsp;<span class="op" id="5970241">=</span>&nbsp;<span class="op" id="5970243">&amp;</span><span class="ident" id="5970244">ast</span><span class="op" id="5970247">.</span><span class="ident" id="5970248">Field</span><span class="op" id="5970253">{</span><span class="ident" id="5970254">Type</span><span class="op" id="5970258">:</span>&nbsp;<span class="ident" id="5970260">typ</span><span class="op" id="5970263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970267">return</span>&nbsp;<span class="op" id="5970274">&amp;</span><span class="ident" id="5970275">ast</span><span class="op" id="5970278">.</span><span class="ident" id="5970279">FieldList</span><span class="op" id="5970288">{</span><span class="ident" id="5970289">List</span><span class="op" id="5970293">:</span>&nbsp;<span class="ident" id="5970295">list</span><span class="op" id="5970299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970306">return</span>&nbsp;<span class="ident" id="5970313">nil</span><br>
<span class="lineno">890</span><span class="op" id="5970317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5970320">func</span>&nbsp;<span class="op" id="5970325">(</span><span class="ident" id="5970326">p</span>&nbsp;<span class="op" id="5970328">*</span><span class="ident" id="5970329">parser</span><span class="op" id="5970335">)</span>&nbsp;<span class="ident" id="5970337">parseSignature</span><span class="op" id="5970351">(</span><span class="ident" id="5970352">scope</span>&nbsp;<span class="op" id="5970358">*</span><span class="ident" id="5970359">ast</span><span class="op" id="5970362">.</span><span class="ident" id="5970363">Scope</span><span class="op" id="5970368">)</span>&nbsp;<span class="op" id="5970370">(</span><span class="ident" id="5970371">params</span><span class="op" id="5970377">,</span>&nbsp;<span class="ident" id="5970379">results</span>&nbsp;<span class="op" id="5970387">*</span><span class="ident" id="5970388">ast</span><span class="op" id="5970391">.</span><span class="ident" id="5970392">FieldList</span><span class="op" id="5970401">)</span>&nbsp;<span class="op" id="5970403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970406">if</span>&nbsp;<span class="ident" id="5970409">p</span><span class="op" id="5970410">.</span><span class="ident" id="5970411">trace</span>&nbsp;<span class="op" id="5970417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970421">defer</span>&nbsp;<span class="ident" id="5970427">un</span><span class="op" id="5970429">(</span><span class="ident" id="5970430">trace</span><span class="op" id="5970435">(</span><span class="ident" id="5970436">p</span><span class="op" id="5970437">,</span>&nbsp;<span class="string" id="5970439">&#34;Signature&#34;</span><span class="op" id="5970450">)</span><span class="op" id="5970451">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970458">params</span>&nbsp;<span class="op" id="5970465">=</span>&nbsp;<span class="ident" id="5970467">p</span><span class="op" id="5970468">.</span><span class="ident" id="5970469">parseParameters</span><span class="op" id="5970484">(</span><span class="ident" id="5970485">scope</span><span class="op" id="5970490">,</span>&nbsp;<span class="ident" id="5970492">true</span><span class="op" id="5970496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970499">results</span>&nbsp;<span class="op" id="5970507">=</span>&nbsp;<span class="ident" id="5970509">p</span><span class="op" id="5970510">.</span><span class="ident" id="5970511">parseResult</span><span class="op" id="5970522">(</span><span class="ident" id="5970523">scope</span><span class="op" id="5970528">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970532">return</span><br>
<span class="lineno"></span><span class="op" id="5970539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5970542">func</span>&nbsp;<span class="op" id="5970547">(</span><span class="ident" id="5970548">p</span>&nbsp;<span class="op" id="5970550">*</span><span class="ident" id="5970551">parser</span><span class="op" id="5970557">)</span>&nbsp;<span class="ident" id="5970559">parseFuncType</span><span class="op" id="5970572">(</span><span class="op" id="5970573">)</span>&nbsp;<span class="op" id="5970575">(</span><span class="op" id="5970576">*</span><span class="ident" id="5970577">ast</span><span class="op" id="5970580">.</span><span class="ident" id="5970581">FuncType</span><span class="op" id="5970589">,</span>&nbsp;<span class="op" id="5970591">*</span><span class="ident" id="5970592">ast</span><span class="op" id="5970595">.</span><span class="ident" id="5970596">Scope</span><span class="op" id="5970601">)</span>&nbsp;<span class="op" id="5970603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970606">if</span>&nbsp;<span class="ident" id="5970609">p</span><span class="op" id="5970610">.</span><span class="ident" id="5970611">trace</span>&nbsp;<span class="op" id="5970617">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970621">defer</span>&nbsp;<span class="ident" id="5970627">un</span><span class="op" id="5970629">(</span><span class="ident" id="5970630">trace</span><span class="op" id="5970635">(</span><span class="ident" id="5970636">p</span><span class="op" id="5970637">,</span>&nbsp;<span class="string" id="5970639">&#34;FuncType&#34;</span><span class="op" id="5970649">)</span><span class="op" id="5970650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970657">pos</span>&nbsp;<span class="op" id="5970661">:=</span>&nbsp;<span class="ident" id="5970664">p</span><span class="op" id="5970665">.</span><span class="ident" id="5970666">expect</span><span class="op" id="5970672">(</span><span class="ident" id="5970673">token</span><span class="op" id="5970678">.</span><span class="ident" id="5970679">FUNC</span><span class="op" id="5970683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970686">scope</span>&nbsp;<span class="op" id="5970692">:=</span>&nbsp;<span class="ident" id="5970695">ast</span><span class="op" id="5970698">.</span><span class="ident" id="5970699">NewScope</span><span class="op" id="5970707">(</span><span class="ident" id="5970708">p</span><span class="op" id="5970709">.</span><span class="ident" id="5970710">topScope</span><span class="op" id="5970718">)</span>&nbsp;<span class="comment" id="5970720">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970739">params</span><span class="op" id="5970745">,</span>&nbsp;<span class="ident" id="5970747">results</span>&nbsp;<span class="op" id="5970755">:=</span>&nbsp;<span class="ident" id="5970758">p</span><span class="op" id="5970759">.</span><span class="ident" id="5970760">parseSignature</span><span class="op" id="5970774">(</span><span class="ident" id="5970775">scope</span><span class="op" id="5970780">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970784">return</span>&nbsp;<span class="op" id="5970791">&amp;</span><span class="ident" id="5970792">ast</span><span class="op" id="5970795">.</span><span class="ident" id="5970796">FuncType</span><span class="op" id="5970804">{</span><span class="ident" id="5970805">Func</span><span class="op" id="5970809">:</span>&nbsp;<span class="ident" id="5970811">pos</span><span class="op" id="5970814">,</span>&nbsp;<span class="ident" id="5970816">Params</span><span class="op" id="5970822">:</span>&nbsp;<span class="ident" id="5970824">params</span><span class="op" id="5970830">,</span>&nbsp;<span class="ident" id="5970832">Results</span><span class="op" id="5970839">:</span>&nbsp;<span class="ident" id="5970841">results</span><span class="op" id="5970848">}</span><span class="op" id="5970849">,</span>&nbsp;<span class="ident" id="5970851">scope</span><br>
<span class="lineno"></span><span class="op" id="5970857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="5970860">func</span>&nbsp;<span class="op" id="5970865">(</span><span class="ident" id="5970866">p</span>&nbsp;<span class="op" id="5970868">*</span><span class="ident" id="5970869">parser</span><span class="op" id="5970875">)</span>&nbsp;<span class="ident" id="5970877">parseMethodSpec</span><span class="op" id="5970892">(</span><span class="ident" id="5970893">scope</span>&nbsp;<span class="op" id="5970899">*</span><span class="ident" id="5970900">ast</span><span class="op" id="5970903">.</span><span class="ident" id="5970904">Scope</span><span class="op" id="5970909">)</span>&nbsp;<span class="op" id="5970911">*</span><span class="ident" id="5970912">ast</span><span class="op" id="5970915">.</span><span class="ident" id="5970916">Field</span>&nbsp;<span class="op" id="5970922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970925">if</span>&nbsp;<span class="ident" id="5970928">p</span><span class="op" id="5970929">.</span><span class="ident" id="5970930">trace</span>&nbsp;<span class="op" id="5970936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970940">defer</span>&nbsp;<span class="ident" id="5970946">un</span><span class="op" id="5970948">(</span><span class="ident" id="5970949">trace</span><span class="op" id="5970954">(</span><span class="ident" id="5970955">p</span><span class="op" id="5970956">,</span>&nbsp;<span class="string" id="5970958">&#34;MethodSpec&#34;</span><span class="op" id="5970970">)</span><span class="op" id="5970971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970978">doc</span>&nbsp;<span class="op" id="5970982">:=</span>&nbsp;<span class="ident" id="5970985">p</span><span class="op" id="5970986">.</span><span class="ident" id="5970987">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971000">var</span>&nbsp;<span class="ident" id="5971004">idents</span>&nbsp;<span class="op" id="5971011">[</span><span class="op" id="5971012">]</span><span class="op" id="5971013">*</span><span class="ident" id="5971014">ast</span><span class="op" id="5971017">.</span><span class="ident" id="5971018">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971025">var</span>&nbsp;<span class="ident" id="5971029">typ</span>&nbsp;<span class="ident" id="5971033">ast</span><span class="op" id="5971036">.</span><span class="ident" id="5971037">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971043">x</span>&nbsp;<span class="op" id="5971045">:=</span>&nbsp;<span class="ident" id="5971048">p</span><span class="op" id="5971049">.</span><span class="ident" id="5971050">parseTypeName</span><span class="op" id="5971063">(</span><span class="op" id="5971064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971067">if</span>&nbsp;<span class="ident" id="5971070">ident</span><span class="op" id="5971075">,</span>&nbsp;<span class="ident" id="5971077">isIdent</span>&nbsp;<span class="op" id="5971085">:=</span>&nbsp;<span class="ident" id="5971088">x</span><span class="op" id="5971089">.</span><span class="op" id="5971090">(</span><span class="op" id="5971091">*</span><span class="ident" id="5971092">ast</span><span class="op" id="5971095">.</span><span class="ident" id="5971096">Ident</span><span class="op" id="5971101">)</span><span class="op" id="5971102">;</span>&nbsp;<span class="ident" id="5971104">isIdent</span>&nbsp;<span class="op" id="5971112">&amp;&amp;</span>&nbsp;<span class="ident" id="5971115">p</span><span class="op" id="5971116">.</span><span class="ident" id="5971117">tok</span>&nbsp;<span class="op" id="5971121">==</span>&nbsp;<span class="ident" id="5971124">token</span><span class="op" id="5971129">.</span><span class="ident" id="5971130">LPAREN</span>&nbsp;<span class="op" id="5971137">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5971141">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971153">idents</span>&nbsp;<span class="op" id="5971160">=</span>&nbsp;<span class="op" id="5971162">[</span><span class="op" id="5971163">]</span><span class="op" id="5971164">*</span><span class="ident" id="5971165">ast</span><span class="op" id="5971168">.</span><span class="ident" id="5971169">Ident</span><span class="op" id="5971174">{</span><span class="ident" id="5971175">ident</span><span class="op" id="5971180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971184">scope</span>&nbsp;<span class="op" id="5971190">:=</span>&nbsp;<span class="ident" id="5971193">ast</span><span class="op" id="5971196">.</span><span class="ident" id="5971197">NewScope</span><span class="op" id="5971205">(</span><span class="ident" id="5971206">nil</span><span class="op" id="5971209">)</span>&nbsp;<span class="comment" id="5971211">//&nbsp;method&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971229">params</span><span class="op" id="5971235">,</span>&nbsp;<span class="ident" id="5971237">results</span>&nbsp;<span class="op" id="5971245">:=</span>&nbsp;<span class="ident" id="5971248">p</span><span class="op" id="5971249">.</span><span class="ident" id="5971250">parseSignature</span><span class="op" id="5971264">(</span><span class="ident" id="5971265">scope</span><span class="op" id="5971270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971274">typ</span>&nbsp;<span class="op" id="5971278">=</span>&nbsp;<span class="op" id="5971280">&amp;</span><span class="ident" id="5971281">ast</span><span class="op" id="5971284">.</span><span class="ident" id="5971285">FuncType</span><span class="op" id="5971293">{</span><span class="ident" id="5971294">Func</span><span class="op" id="5971298">:</span>&nbsp;<span class="ident" id="5971300">token</span><span class="op" id="5971305">.</span><span class="ident" id="5971306">NoPos</span><span class="op" id="5971311">,</span>&nbsp;<span class="ident" id="5971313">Params</span><span class="op" id="5971319">:</span>&nbsp;<span class="ident" id="5971321">params</span><span class="op" id="5971327">,</span>&nbsp;<span class="ident" id="5971329">Results</span><span class="op" id="5971336">:</span>&nbsp;<span class="ident" id="5971338">results</span><span class="op" id="5971345">}</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971348">}</span>&nbsp;<span class="keyword" id="5971350">else</span>&nbsp;<span class="op" id="5971355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5971359">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971383">typ</span>&nbsp;<span class="op" id="5971387">=</span>&nbsp;<span class="ident" id="5971389">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971393">p</span><span class="op" id="5971394">.</span><span class="ident" id="5971395">resolve</span><span class="op" id="5971402">(</span><span class="ident" id="5971403">typ</span><span class="op" id="5971406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971409">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971412">p</span><span class="op" id="5971413">.</span><span class="ident" id="5971414">expectSemi</span><span class="op" id="5971424">(</span><span class="op" id="5971425">)</span>&nbsp;<span class="comment" id="5971427">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971468">spec</span>&nbsp;<span class="op" id="5971473">:=</span>&nbsp;<span class="op" id="5971476">&amp;</span><span class="ident" id="5971477">ast</span><span class="op" id="5971480">.</span><span class="ident" id="5971481">Field</span><span class="op" id="5971486">{</span><span class="ident" id="5971487">Doc</span><span class="op" id="5971490">:</span>&nbsp;<span class="ident" id="5971492">doc</span><span class="op" id="5971495">,</span>&nbsp;<span class="ident" id="5971497">Names</span><span class="op" id="5971502">:</span>&nbsp;<span class="ident" id="5971504">idents</span><span class="op" id="5971510">,</span>&nbsp;<span class="ident" id="5971512">Type</span><span class="op" id="5971516">:</span>&nbsp;<span class="ident" id="5971518">typ</span><span class="op" id="5971521">,</span>&nbsp;<span class="ident" id="5971523">Comment</span><span class="op" id="5971530">:</span>&nbsp;<span class="ident" id="5971532">p</span><span class="op" id="5971533">.</span><span class="ident" id="5971534">lineComment</span><span class="op" id="5971545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971548">p</span><span class="op" id="5971549">.</span><span class="ident" id="5971550">declare</span><span class="op" id="5971557">(</span><span class="ident" id="5971558">spec</span><span class="op" id="5971562">,</span>&nbsp;<span class="ident" id="5971564">nil</span><span class="op" id="5971567">,</span>&nbsp;<span class="ident" id="5971569">scope</span><span class="op" id="5971574">,</span>&nbsp;<span class="ident" id="5971576">ast</span><span class="op" id="5971579">.</span><span class="ident" id="5971580">Fun</span><span class="op" id="5971583">,</span>&nbsp;<span class="ident" id="5971585">idents</span><span class="op" id="5971591">...</span><span class="op" id="5971594">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971598">return</span>&nbsp;<span class="ident" id="5971605">spec</span><br>
<span class="lineno"></span><span class="op" id="5971610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5971613">func</span>&nbsp;<span class="op" id="5971618">(</span><span class="ident" id="5971619">p</span>&nbsp;<span class="op" id="5971621">*</span><span class="ident" id="5971622">parser</span><span class="op" id="5971628">)</span>&nbsp;<span class="ident" id="5971630">parseInterfaceType</span><span class="op" id="5971648">(</span><span class="op" id="5971649">)</span>&nbsp;<span class="op" id="5971651">*</span><span class="ident" id="5971652">ast</span><span class="op" id="5971655">.</span><span class="ident" id="5971656">InterfaceType</span>&nbsp;<span class="op" id="5971670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971673">if</span>&nbsp;<span class="ident" id="5971676">p</span><span class="op" id="5971677">.</span><span class="ident" id="5971678">trace</span>&nbsp;<span class="op" id="5971684">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971688">defer</span>&nbsp;<span class="ident" id="5971694">un</span><span class="op" id="5971696">(</span><span class="ident" id="5971697">trace</span><span class="op" id="5971702">(</span><span class="ident" id="5971703">p</span><span class="op" id="5971704">,</span>&nbsp;<span class="string" id="5971706">&#34;InterfaceType&#34;</span><span class="op" id="5971721">)</span><span class="op" id="5971722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971729">pos</span>&nbsp;<span class="op" id="5971733">:=</span>&nbsp;<span class="ident" id="5971736">p</span><span class="op" id="5971737">.</span><span class="ident" id="5971738">expect</span><span class="op" id="5971744">(</span><span class="ident" id="5971745">token</span><span class="op" id="5971750">.</span><span class="ident" id="5971751">INTERFACE</span><span class="op" id="5971760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971763">lbrace</span>&nbsp;<span class="op" id="5971770">:=</span>&nbsp;<span class="ident" id="5971773">p</span><span class="op" id="5971774">.</span><span class="ident" id="5971775">expect</span><span class="op" id="5971781">(</span><span class="ident" id="5971782">token</span><span class="op" id="5971787">.</span><span class="ident" id="5971788">LBRACE</span><span class="op" id="5971794">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971797">scope</span>&nbsp;<span class="op" id="5971803">:=</span>&nbsp;<span class="ident" id="5971806">ast</span><span class="op" id="5971809">.</span><span class="ident" id="5971810">NewScope</span><span class="op" id="5971818">(</span><span class="ident" id="5971819">nil</span><span class="op" id="5971822">)</span>&nbsp;<span class="comment" id="5971824">//&nbsp;interface&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971844">var</span>&nbsp;<span class="ident" id="5971848">list</span>&nbsp;<span class="op" id="5971853">[</span><span class="op" id="5971854">]</span><span class="op" id="5971855">*</span><span class="ident" id="5971856">ast</span><span class="op" id="5971859">.</span><span class="ident" id="5971860">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971867">for</span>&nbsp;<span class="ident" id="5971871">p</span><span class="op" id="5971872">.</span><span class="ident" id="5971873">tok</span>&nbsp;<span class="op" id="5971877">==</span>&nbsp;<span class="ident" id="5971880">token</span><span class="op" id="5971885">.</span><span class="ident" id="5971886">IDENT</span>&nbsp;<span class="op" id="5971892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971896">list</span>&nbsp;<span class="op" id="5971901">=</span>&nbsp;<span class="builtinfunc" id="5971903">append</span><span class="op" id="5971909">(</span><span class="ident" id="5971910">list</span><span class="op" id="5971914">,</span>&nbsp;<span class="ident" id="5971916">p</span><span class="op" id="5971917">.</span><span class="ident" id="5971918">parseMethodSpec</span><span class="op" id="5971933">(</span><span class="ident" id="5971934">scope</span><span class="op" id="5971939">)</span><span class="op" id="5971940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971943">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971946">rbrace</span>&nbsp;<span class="op" id="5971953">:=</span>&nbsp;<span class="ident" id="5971956">p</span><span class="op" id="5971957">.</span><span class="ident" id="5971958">expect</span><span class="op" id="5971964">(</span><span class="ident" id="5971965">token</span><span class="op" id="5971970">.</span><span class="ident" id="5971971">RBRACE</span><span class="op" id="5971977">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971981">return</span>&nbsp;<span class="op" id="5971988">&amp;</span><span class="ident" id="5971989">ast</span><span class="op" id="5971992">.</span><span class="ident" id="5971993">InterfaceType</span><span class="op" id="5972006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972010">Interface</span><span class="op" id="5972019">:</span>&nbsp;<span class="ident" id="5972021">pos</span><span class="op" id="5972024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972028">Methods</span><span class="op" id="5972035">:</span>&nbsp;<span class="op" id="5972037">&amp;</span><span class="ident" id="5972038">ast</span><span class="op" id="5972041">.</span><span class="ident" id="5972042">FieldList</span><span class="op" id="5972051">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972056">Opening</span><span class="op" id="5972063">:</span>&nbsp;<span class="ident" id="5972065">lbrace</span><span class="op" id="5972071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972076">List</span><span class="op" id="5972080">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5972085">list</span><span class="op" id="5972089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972094">Closing</span><span class="op" id="5972101">:</span>&nbsp;<span class="ident" id="5972103">rbrace</span><span class="op" id="5972109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972113">}</span><span class="op" id="5972114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972117">}</span><br>
<span class="lineno">965</span><span class="op" id="5972119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5972122">func</span>&nbsp;<span class="op" id="5972127">(</span><span class="ident" id="5972128">p</span>&nbsp;<span class="op" id="5972130">*</span><span class="ident" id="5972131">parser</span><span class="op" id="5972137">)</span>&nbsp;<span class="ident" id="5972139">parseMapType</span><span class="op" id="5972151">(</span><span class="op" id="5972152">)</span>&nbsp;<span class="op" id="5972154">*</span><span class="ident" id="5972155">ast</span><span class="op" id="5972158">.</span><span class="ident" id="5972159">MapType</span>&nbsp;<span class="op" id="5972167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972170">if</span>&nbsp;<span class="ident" id="5972173">p</span><span class="op" id="5972174">.</span><span class="ident" id="5972175">trace</span>&nbsp;<span class="op" id="5972181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972185">defer</span>&nbsp;<span class="ident" id="5972191">un</span><span class="op" id="5972193">(</span><span class="ident" id="5972194">trace</span><span class="op" id="5972199">(</span><span class="ident" id="5972200">p</span><span class="op" id="5972201">,</span>&nbsp;<span class="string" id="5972203">&#34;MapType&#34;</span><span class="op" id="5972212">)</span><span class="op" id="5972213">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972220">pos</span>&nbsp;<span class="op" id="5972224">:=</span>&nbsp;<span class="ident" id="5972227">p</span><span class="op" id="5972228">.</span><span class="ident" id="5972229">expect</span><span class="op" id="5972235">(</span><span class="ident" id="5972236">token</span><span class="op" id="5972241">.</span><span class="ident" id="5972242">MAP</span><span class="op" id="5972245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972248">p</span><span class="op" id="5972249">.</span><span class="ident" id="5972250">expect</span><span class="op" id="5972256">(</span><span class="ident" id="5972257">token</span><span class="op" id="5972262">.</span><span class="ident" id="5972263">LBRACK</span><span class="op" id="5972269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972272">key</span>&nbsp;<span class="op" id="5972276">:=</span>&nbsp;<span class="ident" id="5972279">p</span><span class="op" id="5972280">.</span><span class="ident" id="5972281">parseType</span><span class="op" id="5972290">(</span><span class="op" id="5972291">)</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972294">p</span><span class="op" id="5972295">.</span><span class="ident" id="5972296">expect</span><span class="op" id="5972302">(</span><span class="ident" id="5972303">token</span><span class="op" id="5972308">.</span><span class="ident" id="5972309">RBRACK</span><span class="op" id="5972315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972318">value</span>&nbsp;<span class="op" id="5972324">:=</span>&nbsp;<span class="ident" id="5972327">p</span><span class="op" id="5972328">.</span><span class="ident" id="5972329">parseType</span><span class="op" id="5972338">(</span><span class="op" id="5972339">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972343">return</span>&nbsp;<span class="op" id="5972350">&amp;</span><span class="ident" id="5972351">ast</span><span class="op" id="5972354">.</span><span class="ident" id="5972355">MapType</span><span class="op" id="5972362">{</span><span class="ident" id="5972363">Map</span><span class="op" id="5972366">:</span>&nbsp;<span class="ident" id="5972368">pos</span><span class="op" id="5972371">,</span>&nbsp;<span class="ident" id="5972373">Key</span><span class="op" id="5972376">:</span>&nbsp;<span class="ident" id="5972378">key</span><span class="op" id="5972381">,</span>&nbsp;<span class="ident" id="5972383">Value</span><span class="op" id="5972388">:</span>&nbsp;<span class="ident" id="5972390">value</span><span class="op" id="5972395">}</span><br>
<span class="lineno"></span><span class="op" id="5972397">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span><span class="keyword" id="5972400">func</span>&nbsp;<span class="op" id="5972405">(</span><span class="ident" id="5972406">p</span>&nbsp;<span class="op" id="5972408">*</span><span class="ident" id="5972409">parser</span><span class="op" id="5972415">)</span>&nbsp;<span class="ident" id="5972417">parseChanType</span><span class="op" id="5972430">(</span><span class="op" id="5972431">)</span>&nbsp;<span class="op" id="5972433">*</span><span class="ident" id="5972434">ast</span><span class="op" id="5972437">.</span><span class="ident" id="5972438">ChanType</span>&nbsp;<span class="op" id="5972447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972450">if</span>&nbsp;<span class="ident" id="5972453">p</span><span class="op" id="5972454">.</span><span class="ident" id="5972455">trace</span>&nbsp;<span class="op" id="5972461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972465">defer</span>&nbsp;<span class="ident" id="5972471">un</span><span class="op" id="5972473">(</span><span class="ident" id="5972474">trace</span><span class="op" id="5972479">(</span><span class="ident" id="5972480">p</span><span class="op" id="5972481">,</span>&nbsp;<span class="string" id="5972483">&#34;ChanType&#34;</span><span class="op" id="5972493">)</span><span class="op" id="5972494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972497">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972501">pos</span>&nbsp;<span class="op" id="5972505">:=</span>&nbsp;<span class="ident" id="5972508">p</span><span class="op" id="5972509">.</span><span class="ident" id="5972510">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972515">dir</span>&nbsp;<span class="op" id="5972519">:=</span>&nbsp;<span class="ident" id="5972522">ast</span><span class="op" id="5972525">.</span><span class="ident" id="5972526">SEND</span>&nbsp;<span class="op" id="5972531">|</span>&nbsp;<span class="ident" id="5972533">ast</span><span class="op" id="5972536">.</span><span class="ident" id="5972537">RECV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972543">var</span>&nbsp;<span class="ident" id="5972547">arrow</span>&nbsp;<span class="ident" id="5972553">token</span><span class="op" id="5972558">.</span><span class="ident" id="5972559">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972564">if</span>&nbsp;<span class="ident" id="5972567">p</span><span class="op" id="5972568">.</span><span class="ident" id="5972569">tok</span>&nbsp;<span class="op" id="5972573">==</span>&nbsp;<span class="ident" id="5972576">token</span><span class="op" id="5972581">.</span><span class="ident" id="5972582">CHAN</span>&nbsp;<span class="op" id="5972587">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972591">p</span><span class="op" id="5972592">.</span><span class="ident" id="5972593">next</span><span class="op" id="5972597">(</span><span class="op" id="5972598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972602">if</span>&nbsp;<span class="ident" id="5972605">p</span><span class="op" id="5972606">.</span><span class="ident" id="5972607">tok</span>&nbsp;<span class="op" id="5972611">==</span>&nbsp;<span class="ident" id="5972614">token</span><span class="op" id="5972619">.</span><span class="ident" id="5972620">ARROW</span>&nbsp;<span class="op" id="5972626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972631">arrow</span>&nbsp;<span class="op" id="5972637">=</span>&nbsp;<span class="ident" id="5972639">p</span><span class="op" id="5972640">.</span><span class="ident" id="5972641">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972648">p</span><span class="op" id="5972649">.</span><span class="ident" id="5972650">next</span><span class="op" id="5972654">(</span><span class="op" id="5972655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972660">dir</span>&nbsp;<span class="op" id="5972664">=</span>&nbsp;<span class="ident" id="5972666">ast</span><span class="op" id="5972669">.</span><span class="ident" id="5972670">SEND</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972680">}</span>&nbsp;<span class="keyword" id="5972682">else</span>&nbsp;<span class="op" id="5972687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972691">arrow</span>&nbsp;<span class="op" id="5972697">=</span>&nbsp;<span class="ident" id="5972699">p</span><span class="op" id="5972700">.</span><span class="ident" id="5972701">expect</span><span class="op" id="5972707">(</span><span class="ident" id="5972708">token</span><span class="op" id="5972713">.</span><span class="ident" id="5972714">ARROW</span><span class="op" id="5972719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972723">p</span><span class="op" id="5972724">.</span><span class="ident" id="5972725">expect</span><span class="op" id="5972731">(</span><span class="ident" id="5972732">token</span><span class="op" id="5972737">.</span><span class="ident" id="5972738">CHAN</span><span class="op" id="5972742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972746">dir</span>&nbsp;<span class="op" id="5972750">=</span>&nbsp;<span class="ident" id="5972752">ast</span><span class="op" id="5972755">.</span><span class="ident" id="5972756">RECV</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972765">value</span>&nbsp;<span class="op" id="5972771">:=</span>&nbsp;<span class="ident" id="5972774">p</span><span class="op" id="5972775">.</span><span class="ident" id="5972776">parseType</span><span class="op" id="5972785">(</span><span class="op" id="5972786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972790">return</span>&nbsp;<span class="op" id="5972797">&amp;</span><span class="ident" id="5972798">ast</span><span class="op" id="5972801">.</span><span class="ident" id="5972802">ChanType</span><span class="op" id="5972810">{</span><span class="ident" id="5972811">Begin</span><span class="op" id="5972816">:</span>&nbsp;<span class="ident" id="5972818">pos</span><span class="op" id="5972821">,</span>&nbsp;<span class="ident" id="5972823">Arrow</span><span class="op" id="5972828">:</span>&nbsp;<span class="ident" id="5972830">arrow</span><span class="op" id="5972835">,</span>&nbsp;<span class="ident" id="5972837">Dir</span><span class="op" id="5972840">:</span>&nbsp;<span class="ident" id="5972842">dir</span><span class="op" id="5972845">,</span>&nbsp;<span class="ident" id="5972847">Value</span><span class="op" id="5972852">:</span>&nbsp;<span class="ident" id="5972854">value</span><span class="op" id="5972859">}</span><br>
<span class="lineno"></span><span class="op" id="5972861">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="5972864">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5972919">func</span>&nbsp;<span class="op" id="5972924">(</span><span class="ident" id="5972925">p</span>&nbsp;<span class="op" id="5972927">*</span><span class="ident" id="5972928">parser</span><span class="op" id="5972934">)</span>&nbsp;<span class="ident" id="5972936">tryIdentOrType</span><span class="op" id="5972950">(</span><span class="op" id="5972951">)</span>&nbsp;<span class="ident" id="5972953">ast</span><span class="op" id="5972956">.</span><span class="ident" id="5972957">Expr</span>&nbsp;<span class="op" id="5972962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972965">switch</span>&nbsp;<span class="ident" id="5972972">p</span><span class="op" id="5972973">.</span><span class="ident" id="5972974">tok</span>&nbsp;<span class="op" id="5972978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972981">case</span>&nbsp;<span class="ident" id="5972986">token</span><span class="op" id="5972991">.</span><span class="ident" id="5972992">IDENT</span><span class="op" id="5972997">:</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973001">return</span>&nbsp;<span class="ident" id="5973008">p</span><span class="op" id="5973009">.</span><span class="ident" id="5973010">parseTypeName</span><span class="op" id="5973023">(</span><span class="op" id="5973024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973027">case</span>&nbsp;<span class="ident" id="5973032">token</span><span class="op" id="5973037">.</span><span class="ident" id="5973038">LBRACK</span><span class="op" id="5973044">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973048">return</span>&nbsp;<span class="ident" id="5973055">p</span><span class="op" id="5973056">.</span><span class="ident" id="5973057">parseArrayType</span><span class="op" id="5973071">(</span><span class="op" id="5973072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973075">case</span>&nbsp;<span class="ident" id="5973080">token</span><span class="op" id="5973085">.</span><span class="ident" id="5973086">STRUCT</span><span class="op" id="5973092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973096">return</span>&nbsp;<span class="ident" id="5973103">p</span><span class="op" id="5973104">.</span><span class="ident" id="5973105">parseStructType</span><span class="op" id="5973120">(</span><span class="op" id="5973121">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973124">case</span>&nbsp;<span class="ident" id="5973129">token</span><span class="op" id="5973134">.</span><span class="ident" id="5973135">MUL</span><span class="op" id="5973138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973142">return</span>&nbsp;<span class="ident" id="5973149">p</span><span class="op" id="5973150">.</span><span class="ident" id="5973151">parsePointerType</span><span class="op" id="5973167">(</span><span class="op" id="5973168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973171">case</span>&nbsp;<span class="ident" id="5973176">token</span><span class="op" id="5973181">.</span><span class="ident" id="5973182">FUNC</span><span class="op" id="5973186">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973190">typ</span><span class="op" id="5973193">,</span>&nbsp;<span class="ident" id="5973195">_</span>&nbsp;<span class="op" id="5973197">:=</span>&nbsp;<span class="ident" id="5973200">p</span><span class="op" id="5973201">.</span><span class="ident" id="5973202">parseFuncType</span><span class="op" id="5973215">(</span><span class="op" id="5973216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973220">return</span>&nbsp;<span class="ident" id="5973227">typ</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973232">case</span>&nbsp;<span class="ident" id="5973237">token</span><span class="op" id="5973242">.</span><span class="ident" id="5973243">INTERFACE</span><span class="op" id="5973252">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973256">return</span>&nbsp;<span class="ident" id="5973263">p</span><span class="op" id="5973264">.</span><span class="ident" id="5973265">parseInterfaceType</span><span class="op" id="5973283">(</span><span class="op" id="5973284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973287">case</span>&nbsp;<span class="ident" id="5973292">token</span><span class="op" id="5973297">.</span><span class="ident" id="5973298">MAP</span><span class="op" id="5973301">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973305">return</span>&nbsp;<span class="ident" id="5973312">p</span><span class="op" id="5973313">.</span><span class="ident" id="5973314">parseMapType</span><span class="op" id="5973326">(</span><span class="op" id="5973327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973330">case</span>&nbsp;<span class="ident" id="5973335">token</span><span class="op" id="5973340">.</span><span class="ident" id="5973341">CHAN</span><span class="op" id="5973345">,</span>&nbsp;<span class="ident" id="5973347">token</span><span class="op" id="5973352">.</span><span class="ident" id="5973353">ARROW</span><span class="op" id="5973358">:</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973362">return</span>&nbsp;<span class="ident" id="5973369">p</span><span class="op" id="5973370">.</span><span class="ident" id="5973371">parseChanType</span><span class="op" id="5973384">(</span><span class="op" id="5973385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973388">case</span>&nbsp;<span class="ident" id="5973393">token</span><span class="op" id="5973398">.</span><span class="ident" id="5973399">LPAREN</span><span class="op" id="5973405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973409">lparen</span>&nbsp;<span class="op" id="5973416">:=</span>&nbsp;<span class="ident" id="5973419">p</span><span class="op" id="5973420">.</span><span class="ident" id="5973421">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973427">p</span><span class="op" id="5973428">.</span><span class="ident" id="5973429">next</span><span class="op" id="5973433">(</span><span class="op" id="5973434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973438">typ</span>&nbsp;<span class="op" id="5973442">:=</span>&nbsp;<span class="ident" id="5973445">p</span><span class="op" id="5973446">.</span><span class="ident" id="5973447">parseType</span><span class="op" id="5973456">(</span><span class="op" id="5973457">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973461">rparen</span>&nbsp;<span class="op" id="5973468">:=</span>&nbsp;<span class="ident" id="5973471">p</span><span class="op" id="5973472">.</span><span class="ident" id="5973473">expect</span><span class="op" id="5973479">(</span><span class="ident" id="5973480">token</span><span class="op" id="5973485">.</span><span class="ident" id="5973486">RPAREN</span><span class="op" id="5973492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973496">return</span>&nbsp;<span class="op" id="5973503">&amp;</span><span class="ident" id="5973504">ast</span><span class="op" id="5973507">.</span><span class="ident" id="5973508">ParenExpr</span><span class="op" id="5973517">{</span><span class="ident" id="5973518">Lparen</span><span class="op" id="5973524">:</span>&nbsp;<span class="ident" id="5973526">lparen</span><span class="op" id="5973532">,</span>&nbsp;<span class="ident" id="5973534">X</span><span class="op" id="5973535">:</span>&nbsp;<span class="ident" id="5973537">typ</span><span class="op" id="5973540">,</span>&nbsp;<span class="ident" id="5973542">Rparen</span><span class="op" id="5973548">:</span>&nbsp;<span class="ident" id="5973550">rparen</span><span class="op" id="5973556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973563">//&nbsp;no&nbsp;type&nbsp;found</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973581">return</span>&nbsp;<span class="ident" id="5973588">nil</span><br>
<span class="lineno"></span><span class="op" id="5973592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5973595">func</span>&nbsp;<span class="op" id="5973600">(</span><span class="ident" id="5973601">p</span>&nbsp;<span class="op" id="5973603">*</span><span class="ident" id="5973604">parser</span><span class="op" id="5973610">)</span>&nbsp;<span class="ident" id="5973612">tryType</span><span class="op" id="5973619">(</span><span class="op" id="5973620">)</span>&nbsp;<span class="ident" id="5973622">ast</span><span class="op" id="5973625">.</span><span class="ident" id="5973626">Expr</span>&nbsp;<span class="op" id="5973631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973634">typ</span>&nbsp;<span class="op" id="5973638">:=</span>&nbsp;<span class="ident" id="5973641">p</span><span class="op" id="5973642">.</span><span class="ident" id="5973643">tryIdentOrType</span><span class="op" id="5973657">(</span><span class="op" id="5973658">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973661">if</span>&nbsp;<span class="ident" id="5973664">typ</span>&nbsp;<span class="op" id="5973668">!=</span>&nbsp;<span class="ident" id="5973671">nil</span>&nbsp;<span class="op" id="5973675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973679">p</span><span class="op" id="5973680">.</span><span class="ident" id="5973681">resolve</span><span class="op" id="5973688">(</span><span class="ident" id="5973689">typ</span><span class="op" id="5973692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973698">return</span>&nbsp;<span class="ident" id="5973705">typ</span><br>
<span class="lineno"></span><span class="op" id="5973709">}</span><br>
<span class="lineno">1045</span><br>
<span class="lineno"></span><span class="comment" id="5973712">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5973792">//&nbsp;Blocks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5973803">func</span>&nbsp;<span class="op" id="5973808">(</span><span class="ident" id="5973809">p</span>&nbsp;<span class="op" id="5973811">*</span><span class="ident" id="5973812">parser</span><span class="op" id="5973818">)</span>&nbsp;<span class="ident" id="5973820">parseStmtList</span><span class="op" id="5973833">(</span><span class="op" id="5973834">)</span>&nbsp;<span class="op" id="5973836">(</span><span class="ident" id="5973837">list</span>&nbsp;<span class="op" id="5973842">[</span><span class="op" id="5973843">]</span><span class="ident" id="5973844">ast</span><span class="op" id="5973847">.</span><span class="ident" id="5973848">Stmt</span><span class="op" id="5973852">)</span>&nbsp;<span class="op" id="5973854">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973857">if</span>&nbsp;<span class="ident" id="5973860">p</span><span class="op" id="5973861">.</span><span class="ident" id="5973862">trace</span>&nbsp;<span class="op" id="5973868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973872">defer</span>&nbsp;<span class="ident" id="5973878">un</span><span class="op" id="5973880">(</span><span class="ident" id="5973881">trace</span><span class="op" id="5973886">(</span><span class="ident" id="5973887">p</span><span class="op" id="5973888">,</span>&nbsp;<span class="string" id="5973890">&#34;StatementList&#34;</span><span class="op" id="5973905">)</span><span class="op" id="5973906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973913">for</span>&nbsp;<span class="ident" id="5973917">p</span><span class="op" id="5973918">.</span><span class="ident" id="5973919">tok</span>&nbsp;<span class="op" id="5973923">!=</span>&nbsp;<span class="ident" id="5973926">token</span><span class="op" id="5973931">.</span><span class="ident" id="5973932">CASE</span>&nbsp;<span class="op" id="5973937">&amp;&amp;</span>&nbsp;<span class="ident" id="5973940">p</span><span class="op" id="5973941">.</span><span class="ident" id="5973942">tok</span>&nbsp;<span class="op" id="5973946">!=</span>&nbsp;<span class="ident" id="5973949">token</span><span class="op" id="5973954">.</span><span class="ident" id="5973955">DEFAULT</span>&nbsp;<span class="op" id="5973963">&amp;&amp;</span>&nbsp;<span class="ident" id="5973966">p</span><span class="op" id="5973967">.</span><span class="ident" id="5973968">tok</span>&nbsp;<span class="op" id="5973972">!=</span>&nbsp;<span class="ident" id="5973975">token</span><span class="op" id="5973980">.</span><span class="ident" id="5973981">RBRACE</span>&nbsp;<span class="op" id="5973988">&amp;&amp;</span>&nbsp;<span class="ident" id="5973991">p</span><span class="op" id="5973992">.</span><span class="ident" id="5973993">tok</span>&nbsp;<span class="op" id="5973997">!=</span>&nbsp;<span class="ident" id="5974000">token</span><span class="op" id="5974005">.</span><span class="ident" id="5974006">EOF</span>&nbsp;<span class="op" id="5974010">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974014">list</span>&nbsp;<span class="op" id="5974019">=</span>&nbsp;<span class="builtinfunc" id="5974021">append</span><span class="op" id="5974027">(</span><span class="ident" id="5974028">list</span><span class="op" id="5974032">,</span>&nbsp;<span class="ident" id="5974034">p</span><span class="op" id="5974035">.</span><span class="ident" id="5974036">parseStmt</span><span class="op" id="5974045">(</span><span class="op" id="5974046">)</span><span class="op" id="5974047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974054">return</span><br>
<span class="lineno"></span><span class="op" id="5974061">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span><span class="keyword" id="5974064">func</span>&nbsp;<span class="op" id="5974069">(</span><span class="ident" id="5974070">p</span>&nbsp;<span class="op" id="5974072">*</span><span class="ident" id="5974073">parser</span><span class="op" id="5974079">)</span>&nbsp;<span class="ident" id="5974081">parseBody</span><span class="op" id="5974090">(</span><span class="ident" id="5974091">scope</span>&nbsp;<span class="op" id="5974097">*</span><span class="ident" id="5974098">ast</span><span class="op" id="5974101">.</span><span class="ident" id="5974102">Scope</span><span class="op" id="5974107">)</span>&nbsp;<span class="op" id="5974109">*</span><span class="ident" id="5974110">ast</span><span class="op" id="5974113">.</span><span class="ident" id="5974114">BlockStmt</span>&nbsp;<span class="op" id="5974124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974127">if</span>&nbsp;<span class="ident" id="5974130">p</span><span class="op" id="5974131">.</span><span class="ident" id="5974132">trace</span>&nbsp;<span class="op" id="5974138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974142">defer</span>&nbsp;<span class="ident" id="5974148">un</span><span class="op" id="5974150">(</span><span class="ident" id="5974151">trace</span><span class="op" id="5974156">(</span><span class="ident" id="5974157">p</span><span class="op" id="5974158">,</span>&nbsp;<span class="string" id="5974160">&#34;Body&#34;</span><span class="op" id="5974166">)</span><span class="op" id="5974167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974170">}</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974174">lbrace</span>&nbsp;<span class="op" id="5974181">:=</span>&nbsp;<span class="ident" id="5974184">p</span><span class="op" id="5974185">.</span><span class="ident" id="5974186">expect</span><span class="op" id="5974192">(</span><span class="ident" id="5974193">token</span><span class="op" id="5974198">.</span><span class="ident" id="5974199">LBRACE</span><span class="op" id="5974205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974208">p</span><span class="op" id="5974209">.</span><span class="ident" id="5974210">topScope</span>&nbsp;<span class="op" id="5974219">=</span>&nbsp;<span class="ident" id="5974221">scope</span>&nbsp;<span class="comment" id="5974227">//&nbsp;open&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974251">p</span><span class="op" id="5974252">.</span><span class="ident" id="5974253">openLabelScope</span><span class="op" id="5974267">(</span><span class="op" id="5974268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974271">list</span>&nbsp;<span class="op" id="5974276">:=</span>&nbsp;<span class="ident" id="5974279">p</span><span class="op" id="5974280">.</span><span class="ident" id="5974281">parseStmtList</span><span class="op" id="5974294">(</span><span class="op" id="5974295">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974298">p</span><span class="op" id="5974299">.</span><span class="ident" id="5974300">closeLabelScope</span><span class="op" id="5974315">(</span><span class="op" id="5974316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974319">p</span><span class="op" id="5974320">.</span><span class="ident" id="5974321">closeScope</span><span class="op" id="5974331">(</span><span class="op" id="5974332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974335">rbrace</span>&nbsp;<span class="op" id="5974342">:=</span>&nbsp;<span class="ident" id="5974345">p</span><span class="op" id="5974346">.</span><span class="ident" id="5974347">expect</span><span class="op" id="5974353">(</span><span class="ident" id="5974354">token</span><span class="op" id="5974359">.</span><span class="ident" id="5974360">RBRACE</span><span class="op" id="5974366">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974370">return</span>&nbsp;<span class="op" id="5974377">&amp;</span><span class="ident" id="5974378">ast</span><span class="op" id="5974381">.</span><span class="ident" id="5974382">BlockStmt</span><span class="op" id="5974391">{</span><span class="ident" id="5974392">Lbrace</span><span class="op" id="5974398">:</span>&nbsp;<span class="ident" id="5974400">lbrace</span><span class="op" id="5974406">,</span>&nbsp;<span class="ident" id="5974408">List</span><span class="op" id="5974412">:</span>&nbsp;<span class="ident" id="5974414">list</span><span class="op" id="5974418">,</span>&nbsp;<span class="ident" id="5974420">Rbrace</span><span class="op" id="5974426">:</span>&nbsp;<span class="ident" id="5974428">rbrace</span><span class="op" id="5974434">}</span><br>
<span class="lineno">1075</span><span class="op" id="5974436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5974439">func</span>&nbsp;<span class="op" id="5974444">(</span><span class="ident" id="5974445">p</span>&nbsp;<span class="op" id="5974447">*</span><span class="ident" id="5974448">parser</span><span class="op" id="5974454">)</span>&nbsp;<span class="ident" id="5974456">parseBlockStmt</span><span class="op" id="5974470">(</span><span class="op" id="5974471">)</span>&nbsp;<span class="op" id="5974473">*</span><span class="ident" id="5974474">ast</span><span class="op" id="5974477">.</span><span class="ident" id="5974478">BlockStmt</span>&nbsp;<span class="op" id="5974488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974491">if</span>&nbsp;<span class="ident" id="5974494">p</span><span class="op" id="5974495">.</span><span class="ident" id="5974496">trace</span>&nbsp;<span class="op" id="5974502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974506">defer</span>&nbsp;<span class="ident" id="5974512">un</span><span class="op" id="5974514">(</span><span class="ident" id="5974515">trace</span><span class="op" id="5974520">(</span><span class="ident" id="5974521">p</span><span class="op" id="5974522">,</span>&nbsp;<span class="string" id="5974524">&#34;BlockStmt&#34;</span><span class="op" id="5974535">)</span><span class="op" id="5974536">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974543">lbrace</span>&nbsp;<span class="op" id="5974550">:=</span>&nbsp;<span class="ident" id="5974553">p</span><span class="op" id="5974554">.</span><span class="ident" id="5974555">expect</span><span class="op" id="5974561">(</span><span class="ident" id="5974562">token</span><span class="op" id="5974567">.</span><span class="ident" id="5974568">LBRACE</span><span class="op" id="5974574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974577">p</span><span class="op" id="5974578">.</span><span class="ident" id="5974579">openScope</span><span class="op" id="5974588">(</span><span class="op" id="5974589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974592">list</span>&nbsp;<span class="op" id="5974597">:=</span>&nbsp;<span class="ident" id="5974600">p</span><span class="op" id="5974601">.</span><span class="ident" id="5974602">parseStmtList</span><span class="op" id="5974615">(</span><span class="op" id="5974616">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974619">p</span><span class="op" id="5974620">.</span><span class="ident" id="5974621">closeScope</span><span class="op" id="5974631">(</span><span class="op" id="5974632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974635">rbrace</span>&nbsp;<span class="op" id="5974642">:=</span>&nbsp;<span class="ident" id="5974645">p</span><span class="op" id="5974646">.</span><span class="ident" id="5974647">expect</span><span class="op" id="5974653">(</span><span class="ident" id="5974654">token</span><span class="op" id="5974659">.</span><span class="ident" id="5974660">RBRACE</span><span class="op" id="5974666">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974670">return</span>&nbsp;<span class="op" id="5974677">&amp;</span><span class="ident" id="5974678">ast</span><span class="op" id="5974681">.</span><span class="ident" id="5974682">BlockStmt</span><span class="op" id="5974691">{</span><span class="ident" id="5974692">Lbrace</span><span class="op" id="5974698">:</span>&nbsp;<span class="ident" id="5974700">lbrace</span><span class="op" id="5974706">,</span>&nbsp;<span class="ident" id="5974708">List</span><span class="op" id="5974712">:</span>&nbsp;<span class="ident" id="5974714">list</span><span class="op" id="5974718">,</span>&nbsp;<span class="ident" id="5974720">Rbrace</span><span class="op" id="5974726">:</span>&nbsp;<span class="ident" id="5974728">rbrace</span><span class="op" id="5974734">}</span><br>
<span class="lineno"></span><span class="op" id="5974736">}</span><br>
<span class="lineno">1090</span><br>
<span class="lineno"></span><span class="comment" id="5974739">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5974819">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5974835">func</span>&nbsp;<span class="op" id="5974840">(</span><span class="ident" id="5974841">p</span>&nbsp;<span class="op" id="5974843">*</span><span class="ident" id="5974844">parser</span><span class="op" id="5974850">)</span>&nbsp;<span class="ident" id="5974852">parseFuncTypeOrLit</span><span class="op" id="5974870">(</span><span class="op" id="5974871">)</span>&nbsp;<span class="ident" id="5974873">ast</span><span class="op" id="5974876">.</span><span class="ident" id="5974877">Expr</span>&nbsp;<span class="op" id="5974882">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974885">if</span>&nbsp;<span class="ident" id="5974888">p</span><span class="op" id="5974889">.</span><span class="ident" id="5974890">trace</span>&nbsp;<span class="op" id="5974896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974900">defer</span>&nbsp;<span class="ident" id="5974906">un</span><span class="op" id="5974908">(</span><span class="ident" id="5974909">trace</span><span class="op" id="5974914">(</span><span class="ident" id="5974915">p</span><span class="op" id="5974916">,</span>&nbsp;<span class="string" id="5974918">&#34;FuncTypeOrLit&#34;</span><span class="op" id="5974933">)</span><span class="op" id="5974934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974941">typ</span><span class="op" id="5974944">,</span>&nbsp;<span class="ident" id="5974946">scope</span>&nbsp;<span class="op" id="5974952">:=</span>&nbsp;<span class="ident" id="5974955">p</span><span class="op" id="5974956">.</span><span class="ident" id="5974957">parseFuncType</span><span class="op" id="5974970">(</span><span class="op" id="5974971">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974974">if</span>&nbsp;<span class="ident" id="5974977">p</span><span class="op" id="5974978">.</span><span class="ident" id="5974979">tok</span>&nbsp;<span class="op" id="5974983">!=</span>&nbsp;<span class="ident" id="5974986">token</span><span class="op" id="5974991">.</span><span class="ident" id="5974992">LBRACE</span>&nbsp;<span class="op" id="5974999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975003">//&nbsp;function&nbsp;type&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975027">return</span>&nbsp;<span class="ident" id="5975034">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975043">p</span><span class="op" id="5975044">.</span><span class="ident" id="5975045">exprLev</span><span class="op" id="5975052">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975056">body</span>&nbsp;<span class="op" id="5975061">:=</span>&nbsp;<span class="ident" id="5975064">p</span><span class="op" id="5975065">.</span><span class="ident" id="5975066">parseBody</span><span class="op" id="5975075">(</span><span class="ident" id="5975076">scope</span><span class="op" id="5975081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975084">p</span><span class="op" id="5975085">.</span><span class="ident" id="5975086">exprLev</span><span class="op" id="5975093">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975098">return</span>&nbsp;<span class="op" id="5975105">&amp;</span><span class="ident" id="5975106">ast</span><span class="op" id="5975109">.</span><span class="ident" id="5975110">FuncLit</span><span class="op" id="5975117">{</span><span class="ident" id="5975118">Type</span><span class="op" id="5975122">:</span>&nbsp;<span class="ident" id="5975124">typ</span><span class="op" id="5975127">,</span>&nbsp;<span class="ident" id="5975129">Body</span><span class="op" id="5975133">:</span>&nbsp;<span class="ident" id="5975135">body</span><span class="op" id="5975139">}</span><br>
<span class="lineno">1110</span><span class="op" id="5975141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5975144">//&nbsp;parseOperand&nbsp;may&nbsp;return&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;raw&nbsp;type&nbsp;(incl.&nbsp;array</span><br>
<span class="lineno"></span><span class="comment" id="5975212">//&nbsp;types&nbsp;of&nbsp;the&nbsp;form&nbsp;[...]T.&nbsp;Callers&nbsp;must&nbsp;verify&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="5975273">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1115</span><span class="comment" id="5975343">//</span><br>
<span class="lineno"></span><span class="keyword" id="5975346">func</span>&nbsp;<span class="op" id="5975351">(</span><span class="ident" id="5975352">p</span>&nbsp;<span class="op" id="5975354">*</span><span class="ident" id="5975355">parser</span><span class="op" id="5975361">)</span>&nbsp;<span class="ident" id="5975363">parseOperand</span><span class="op" id="5975375">(</span><span class="ident" id="5975376">lhs</span>&nbsp;<span class="builtintype" id="5975380">bool</span><span class="op" id="5975384">)</span>&nbsp;<span class="ident" id="5975386">ast</span><span class="op" id="5975389">.</span><span class="ident" id="5975390">Expr</span>&nbsp;<span class="op" id="5975395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975398">if</span>&nbsp;<span class="ident" id="5975401">p</span><span class="op" id="5975402">.</span><span class="ident" id="5975403">trace</span>&nbsp;<span class="op" id="5975409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975413">defer</span>&nbsp;<span class="ident" id="5975419">un</span><span class="op" id="5975421">(</span><span class="ident" id="5975422">trace</span><span class="op" id="5975427">(</span><span class="ident" id="5975428">p</span><span class="op" id="5975429">,</span>&nbsp;<span class="string" id="5975431">&#34;Operand&#34;</span><span class="op" id="5975440">)</span><span class="op" id="5975441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975444">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975448">switch</span>&nbsp;<span class="ident" id="5975455">p</span><span class="op" id="5975456">.</span><span class="ident" id="5975457">tok</span>&nbsp;<span class="op" id="5975461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975464">case</span>&nbsp;<span class="ident" id="5975469">token</span><span class="op" id="5975474">.</span><span class="ident" id="5975475">IDENT</span><span class="op" id="5975480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975484">x</span>&nbsp;<span class="op" id="5975486">:=</span>&nbsp;<span class="ident" id="5975489">p</span><span class="op" id="5975490">.</span><span class="ident" id="5975491">parseIdent</span><span class="op" id="5975501">(</span><span class="op" id="5975502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975506">if</span>&nbsp;<span class="op" id="5975509">!</span><span class="ident" id="5975510">lhs</span>&nbsp;<span class="op" id="5975514">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975519">p</span><span class="op" id="5975520">.</span><span class="ident" id="5975521">resolve</span><span class="op" id="5975528">(</span><span class="ident" id="5975529">x</span><span class="op" id="5975530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975538">return</span>&nbsp;<span class="ident" id="5975545">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975549">case</span>&nbsp;<span class="ident" id="5975554">token</span><span class="op" id="5975559">.</span><span class="ident" id="5975560">INT</span><span class="op" id="5975563">,</span>&nbsp;<span class="ident" id="5975565">token</span><span class="op" id="5975570">.</span><span class="ident" id="5975571">FLOAT</span><span class="op" id="5975576">,</span>&nbsp;<span class="ident" id="5975578">token</span><span class="op" id="5975583">.</span><span class="ident" id="5975584">IMAG</span><span class="op" id="5975588">,</span>&nbsp;<span class="ident" id="5975590">token</span><span class="op" id="5975595">.</span><span class="ident" id="5975596">CHAR</span><span class="op" id="5975600">,</span>&nbsp;<span class="ident" id="5975602">token</span><span class="op" id="5975607">.</span><span class="ident" id="5975608">STRING</span><span class="op" id="5975614">:</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975618">x</span>&nbsp;<span class="op" id="5975620">:=</span>&nbsp;<span class="op" id="5975623">&amp;</span><span class="ident" id="5975624">ast</span><span class="op" id="5975627">.</span><span class="ident" id="5975628">BasicLit</span><span class="op" id="5975636">{</span><span class="ident" id="5975637">ValuePos</span><span class="op" id="5975645">:</span>&nbsp;<span class="ident" id="5975647">p</span><span class="op" id="5975648">.</span><span class="ident" id="5975649">pos</span><span class="op" id="5975652">,</span>&nbsp;<span class="ident" id="5975654">Kind</span><span class="op" id="5975658">:</span>&nbsp;<span class="ident" id="5975660">p</span><span class="op" id="5975661">.</span><span class="ident" id="5975662">tok</span><span class="op" id="5975665">,</span>&nbsp;<span class="ident" id="5975667">Value</span><span class="op" id="5975672">:</span>&nbsp;<span class="ident" id="5975674">p</span><span class="op" id="5975675">.</span><span class="ident" id="5975676">lit</span><span class="op" id="5975679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975683">p</span><span class="op" id="5975684">.</span><span class="ident" id="5975685">next</span><span class="op" id="5975689">(</span><span class="op" id="5975690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975694">return</span>&nbsp;<span class="ident" id="5975701">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975705">case</span>&nbsp;<span class="ident" id="5975710">token</span><span class="op" id="5975715">.</span><span class="ident" id="5975716">LPAREN</span><span class="op" id="5975722">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975726">lparen</span>&nbsp;<span class="op" id="5975733">:=</span>&nbsp;<span class="ident" id="5975736">p</span><span class="op" id="5975737">.</span><span class="ident" id="5975738">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975744">p</span><span class="op" id="5975745">.</span><span class="ident" id="5975746">next</span><span class="op" id="5975750">(</span><span class="op" id="5975751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975755">p</span><span class="op" id="5975756">.</span><span class="ident" id="5975757">exprLev</span><span class="op" id="5975764">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975769">x</span>&nbsp;<span class="op" id="5975771">:=</span>&nbsp;<span class="ident" id="5975774">p</span><span class="op" id="5975775">.</span><span class="ident" id="5975776">parseRhsOrType</span><span class="op" id="5975790">(</span><span class="op" id="5975791">)</span>&nbsp;<span class="comment" id="5975793">//&nbsp;types&nbsp;may&nbsp;be&nbsp;parenthesized:&nbsp;(some&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975838">p</span><span class="op" id="5975839">.</span><span class="ident" id="5975840">exprLev</span><span class="op" id="5975847">--</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975852">rparen</span>&nbsp;<span class="op" id="5975859">:=</span>&nbsp;<span class="ident" id="5975862">p</span><span class="op" id="5975863">.</span><span class="ident" id="5975864">expect</span><span class="op" id="5975870">(</span><span class="ident" id="5975871">token</span><span class="op" id="5975876">.</span><span class="ident" id="5975877">RPAREN</span><span class="op" id="5975883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975887">return</span>&nbsp;<span class="op" id="5975894">&amp;</span><span class="ident" id="5975895">ast</span><span class="op" id="5975898">.</span><span class="ident" id="5975899">ParenExpr</span><span class="op" id="5975908">{</span><span class="ident" id="5975909">Lparen</span><span class="op" id="5975915">:</span>&nbsp;<span class="ident" id="5975917">lparen</span><span class="op" id="5975923">,</span>&nbsp;<span class="ident" id="5975925">X</span><span class="op" id="5975926">:</span>&nbsp;<span class="ident" id="5975928">x</span><span class="op" id="5975929">,</span>&nbsp;<span class="ident" id="5975931">Rparen</span><span class="op" id="5975937">:</span>&nbsp;<span class="ident" id="5975939">rparen</span><span class="op" id="5975945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975949">case</span>&nbsp;<span class="ident" id="5975954">token</span><span class="op" id="5975959">.</span><span class="ident" id="5975960">FUNC</span><span class="op" id="5975964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975968">return</span>&nbsp;<span class="ident" id="5975975">p</span><span class="op" id="5975976">.</span><span class="ident" id="5975977">parseFuncTypeOrLit</span><span class="op" id="5975995">(</span><span class="op" id="5975996">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976003">if</span>&nbsp;<span class="ident" id="5976006">typ</span>&nbsp;<span class="op" id="5976010">:=</span>&nbsp;<span class="ident" id="5976013">p</span><span class="op" id="5976014">.</span><span class="ident" id="5976015">tryIdentOrType</span><span class="op" id="5976029">(</span><span class="op" id="5976030">)</span><span class="op" id="5976031">;</span>&nbsp;<span class="ident" id="5976033">typ</span>&nbsp;<span class="op" id="5976037">!=</span>&nbsp;<span class="ident" id="5976040">nil</span>&nbsp;<span class="op" id="5976044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976048">//&nbsp;could&nbsp;be&nbsp;type&nbsp;for&nbsp;composite&nbsp;literal&nbsp;or&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976103">_</span><span class="op" id="5976104">,</span>&nbsp;<span class="ident" id="5976106">isIdent</span>&nbsp;<span class="op" id="5976114">:=</span>&nbsp;<span class="ident" id="5976117">typ</span><span class="op" id="5976120">.</span><span class="op" id="5976121">(</span><span class="op" id="5976122">*</span><span class="ident" id="5976123">ast</span><span class="op" id="5976126">.</span><span class="ident" id="5976127">Ident</span><span class="op" id="5976132">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976136">assert</span><span class="op" id="5976142">(</span><span class="op" id="5976143">!</span><span class="ident" id="5976144">isIdent</span><span class="op" id="5976151">,</span>&nbsp;<span class="string" id="5976153">&#34;type&nbsp;cannot&nbsp;be&nbsp;identifier&#34;</span><span class="op" id="5976180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976184">return</span>&nbsp;<span class="ident" id="5976191">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976200">//&nbsp;we&nbsp;have&nbsp;an&nbsp;error</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976221">pos</span>&nbsp;<span class="op" id="5976225">:=</span>&nbsp;<span class="ident" id="5976228">p</span><span class="op" id="5976229">.</span><span class="ident" id="5976230">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976235">p</span><span class="op" id="5976236">.</span><span class="ident" id="5976237">errorExpected</span><span class="op" id="5976250">(</span><span class="ident" id="5976251">pos</span><span class="op" id="5976254">,</span>&nbsp;<span class="string" id="5976256">&#34;operand&#34;</span><span class="op" id="5976265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976268">syncStmt</span><span class="op" id="5976276">(</span><span class="ident" id="5976277">p</span><span class="op" id="5976278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976281">return</span>&nbsp;<span class="op" id="5976288">&amp;</span><span class="ident" id="5976289">ast</span><span class="op" id="5976292">.</span><span class="ident" id="5976293">BadExpr</span><span class="op" id="5976300">{</span><span class="ident" id="5976301">From</span><span class="op" id="5976305">:</span>&nbsp;<span class="ident" id="5976307">pos</span><span class="op" id="5976310">,</span>&nbsp;<span class="ident" id="5976312">To</span><span class="op" id="5976314">:</span>&nbsp;<span class="ident" id="5976316">p</span><span class="op" id="5976317">.</span><span class="ident" id="5976318">pos</span><span class="op" id="5976321">}</span><br>
<span class="lineno"></span><span class="op" id="5976323">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span><span class="keyword" id="5976326">func</span>&nbsp;<span class="op" id="5976331">(</span><span class="ident" id="5976332">p</span>&nbsp;<span class="op" id="5976334">*</span><span class="ident" id="5976335">parser</span><span class="op" id="5976341">)</span>&nbsp;<span class="ident" id="5976343">parseSelector</span><span class="op" id="5976356">(</span><span class="ident" id="5976357">x</span>&nbsp;<span class="ident" id="5976359">ast</span><span class="op" id="5976362">.</span><span class="ident" id="5976363">Expr</span><span class="op" id="5976367">)</span>&nbsp;<span class="ident" id="5976369">ast</span><span class="op" id="5976372">.</span><span class="ident" id="5976373">Expr</span>&nbsp;<span class="op" id="5976378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976381">if</span>&nbsp;<span class="ident" id="5976384">p</span><span class="op" id="5976385">.</span><span class="ident" id="5976386">trace</span>&nbsp;<span class="op" id="5976392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976396">defer</span>&nbsp;<span class="ident" id="5976402">un</span><span class="op" id="5976404">(</span><span class="ident" id="5976405">trace</span><span class="op" id="5976410">(</span><span class="ident" id="5976411">p</span><span class="op" id="5976412">,</span>&nbsp;<span class="string" id="5976414">&#34;Selector&#34;</span><span class="op" id="5976424">)</span><span class="op" id="5976425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976428">}</span><br>
<span class="lineno">1165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976432">sel</span>&nbsp;<span class="op" id="5976436">:=</span>&nbsp;<span class="ident" id="5976439">p</span><span class="op" id="5976440">.</span><span class="ident" id="5976441">parseIdent</span><span class="op" id="5976451">(</span><span class="op" id="5976452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976456">return</span>&nbsp;<span class="op" id="5976463">&amp;</span><span class="ident" id="5976464">ast</span><span class="op" id="5976467">.</span><span class="ident" id="5976468">SelectorExpr</span><span class="op" id="5976480">{</span><span class="ident" id="5976481">X</span><span class="op" id="5976482">:</span>&nbsp;<span class="ident" id="5976484">x</span><span class="op" id="5976485">,</span>&nbsp;<span class="ident" id="5976487">Sel</span><span class="op" id="5976490">:</span>&nbsp;<span class="ident" id="5976492">sel</span><span class="op" id="5976495">}</span><br>
<span class="lineno"></span><span class="op" id="5976497">}</span><br>
<span class="lineno">1170</span><br>
<span class="lineno"></span><span class="keyword" id="5976500">func</span>&nbsp;<span class="op" id="5976505">(</span><span class="ident" id="5976506">p</span>&nbsp;<span class="op" id="5976508">*</span><span class="ident" id="5976509">parser</span><span class="op" id="5976515">)</span>&nbsp;<span class="ident" id="5976517">parseTypeAssertion</span><span class="op" id="5976535">(</span><span class="ident" id="5976536">x</span>&nbsp;<span class="ident" id="5976538">ast</span><span class="op" id="5976541">.</span><span class="ident" id="5976542">Expr</span><span class="op" id="5976546">)</span>&nbsp;<span class="ident" id="5976548">ast</span><span class="op" id="5976551">.</span><span class="ident" id="5976552">Expr</span>&nbsp;<span class="op" id="5976557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976560">if</span>&nbsp;<span class="ident" id="5976563">p</span><span class="op" id="5976564">.</span><span class="ident" id="5976565">trace</span>&nbsp;<span class="op" id="5976571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976575">defer</span>&nbsp;<span class="ident" id="5976581">un</span><span class="op" id="5976583">(</span><span class="ident" id="5976584">trace</span><span class="op" id="5976589">(</span><span class="ident" id="5976590">p</span><span class="op" id="5976591">,</span>&nbsp;<span class="string" id="5976593">&#34;TypeAssertion&#34;</span><span class="op" id="5976608">)</span><span class="op" id="5976609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976612">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976616">lparen</span>&nbsp;<span class="op" id="5976623">:=</span>&nbsp;<span class="ident" id="5976626">p</span><span class="op" id="5976627">.</span><span class="ident" id="5976628">expect</span><span class="op" id="5976634">(</span><span class="ident" id="5976635">token</span><span class="op" id="5976640">.</span><span class="ident" id="5976641">LPAREN</span><span class="op" id="5976647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976650">var</span>&nbsp;<span class="ident" id="5976654">typ</span>&nbsp;<span class="ident" id="5976658">ast</span><span class="op" id="5976661">.</span><span class="ident" id="5976662">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976668">if</span>&nbsp;<span class="ident" id="5976671">p</span><span class="op" id="5976672">.</span><span class="ident" id="5976673">tok</span>&nbsp;<span class="op" id="5976677">==</span>&nbsp;<span class="ident" id="5976680">token</span><span class="op" id="5976685">.</span><span class="ident" id="5976686">TYPE</span>&nbsp;<span class="op" id="5976691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976695">//&nbsp;type&nbsp;switch:&nbsp;typ&nbsp;==&nbsp;nil</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976724">p</span><span class="op" id="5976725">.</span><span class="ident" id="5976726">next</span><span class="op" id="5976730">(</span><span class="op" id="5976731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976734">}</span>&nbsp;<span class="keyword" id="5976736">else</span>&nbsp;<span class="op" id="5976741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976745">typ</span>&nbsp;<span class="op" id="5976749">=</span>&nbsp;<span class="ident" id="5976751">p</span><span class="op" id="5976752">.</span><span class="ident" id="5976753">parseType</span><span class="op" id="5976762">(</span><span class="op" id="5976763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976769">rparen</span>&nbsp;<span class="op" id="5976776">:=</span>&nbsp;<span class="ident" id="5976779">p</span><span class="op" id="5976780">.</span><span class="ident" id="5976781">expect</span><span class="op" id="5976787">(</span><span class="ident" id="5976788">token</span><span class="op" id="5976793">.</span><span class="ident" id="5976794">RPAREN</span><span class="op" id="5976800">)</span><br>
<span class="lineno">1185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976804">return</span>&nbsp;<span class="op" id="5976811">&amp;</span><span class="ident" id="5976812">ast</span><span class="op" id="5976815">.</span><span class="ident" id="5976816">TypeAssertExpr</span><span class="op" id="5976830">{</span><span class="ident" id="5976831">X</span><span class="op" id="5976832">:</span>&nbsp;<span class="ident" id="5976834">x</span><span class="op" id="5976835">,</span>&nbsp;<span class="ident" id="5976837">Type</span><span class="op" id="5976841">:</span>&nbsp;<span class="ident" id="5976843">typ</span><span class="op" id="5976846">,</span>&nbsp;<span class="ident" id="5976848">Lparen</span><span class="op" id="5976854">:</span>&nbsp;<span class="ident" id="5976856">lparen</span><span class="op" id="5976862">,</span>&nbsp;<span class="ident" id="5976864">Rparen</span><span class="op" id="5976870">:</span>&nbsp;<span class="ident" id="5976872">rparen</span><span class="op" id="5976878">}</span><br>
<span class="lineno"></span><span class="op" id="5976880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5976883">func</span>&nbsp;<span class="op" id="5976888">(</span><span class="ident" id="5976889">p</span>&nbsp;<span class="op" id="5976891">*</span><span class="ident" id="5976892">parser</span><span class="op" id="5976898">)</span>&nbsp;<span class="ident" id="5976900">parseIndexOrSlice</span><span class="op" id="5976917">(</span><span class="ident" id="5976918">x</span>&nbsp;<span class="ident" id="5976920">ast</span><span class="op" id="5976923">.</span><span class="ident" id="5976924">Expr</span><span class="op" id="5976928">)</span>&nbsp;<span class="ident" id="5976930">ast</span><span class="op" id="5976933">.</span><span class="ident" id="5976934">Expr</span>&nbsp;<span class="op" id="5976939">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976942">if</span>&nbsp;<span class="ident" id="5976945">p</span><span class="op" id="5976946">.</span><span class="ident" id="5976947">trace</span>&nbsp;<span class="op" id="5976953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976957">defer</span>&nbsp;<span class="ident" id="5976963">un</span><span class="op" id="5976965">(</span><span class="ident" id="5976966">trace</span><span class="op" id="5976971">(</span><span class="ident" id="5976972">p</span><span class="op" id="5976973">,</span>&nbsp;<span class="string" id="5976975">&#34;IndexOrSlice&#34;</span><span class="op" id="5976989">)</span><span class="op" id="5976990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976997">const</span>&nbsp;<span class="ident" id="5977003">N</span>&nbsp;<span class="op" id="5977005">=</span>&nbsp;<span class="num" id="5977007">3</span>&nbsp;<span class="comment" id="5977009">//&nbsp;change&nbsp;the&nbsp;3&nbsp;to&nbsp;2&nbsp;to&nbsp;disable&nbsp;3-index&nbsp;slices</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977057">lbrack</span>&nbsp;<span class="op" id="5977064">:=</span>&nbsp;<span class="ident" id="5977067">p</span><span class="op" id="5977068">.</span><span class="ident" id="5977069">expect</span><span class="op" id="5977075">(</span><span class="ident" id="5977076">token</span><span class="op" id="5977081">.</span><span class="ident" id="5977082">LBRACK</span><span class="op" id="5977088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977091">p</span><span class="op" id="5977092">.</span><span class="ident" id="5977093">exprLev</span><span class="op" id="5977100">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977104">var</span>&nbsp;<span class="ident" id="5977108">index</span>&nbsp;<span class="op" id="5977114">[</span><span class="ident" id="5977115">N</span><span class="op" id="5977116">]</span><span class="ident" id="5977117">ast</span><span class="op" id="5977120">.</span><span class="ident" id="5977121">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977127">var</span>&nbsp;<span class="ident" id="5977131">colons</span>&nbsp;<span class="op" id="5977138">[</span><span class="ident" id="5977139">N</span>&nbsp;<span class="op" id="5977141">-</span>&nbsp;<span class="num" id="5977143">1</span><span class="op" id="5977144">]</span><span class="ident" id="5977145">token</span><span class="op" id="5977150">.</span><span class="ident" id="5977151">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977156">if</span>&nbsp;<span class="ident" id="5977159">p</span><span class="op" id="5977160">.</span><span class="ident" id="5977161">tok</span>&nbsp;<span class="op" id="5977165">!=</span>&nbsp;<span class="ident" id="5977168">token</span><span class="op" id="5977173">.</span><span class="ident" id="5977174">COLON</span>&nbsp;<span class="op" id="5977180">{</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977184">index</span><span class="op" id="5977189">[</span><span class="num" id="5977190">0</span><span class="op" id="5977191">]</span>&nbsp;<span class="op" id="5977193">=</span>&nbsp;<span class="ident" id="5977195">p</span><span class="op" id="5977196">.</span><span class="ident" id="5977197">parseRhs</span><span class="op" id="5977205">(</span><span class="op" id="5977206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977212">ncolons</span>&nbsp;<span class="op" id="5977220">:=</span>&nbsp;<span class="num" id="5977223">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977226">for</span>&nbsp;<span class="ident" id="5977230">p</span><span class="op" id="5977231">.</span><span class="ident" id="5977232">tok</span>&nbsp;<span class="op" id="5977236">==</span>&nbsp;<span class="ident" id="5977239">token</span><span class="op" id="5977244">.</span><span class="ident" id="5977245">COLON</span>&nbsp;<span class="op" id="5977251">&amp;&amp;</span>&nbsp;<span class="ident" id="5977254">ncolons</span>&nbsp;<span class="op" id="5977262">&lt;</span>&nbsp;<span class="builtinfunc" id="5977264">len</span><span class="op" id="5977267">(</span><span class="ident" id="5977268">colons</span><span class="op" id="5977274">)</span>&nbsp;<span class="op" id="5977276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977280">colons</span><span class="op" id="5977286">[</span><span class="ident" id="5977287">ncolons</span><span class="op" id="5977294">]</span>&nbsp;<span class="op" id="5977296">=</span>&nbsp;<span class="ident" id="5977298">p</span><span class="op" id="5977299">.</span><span class="ident" id="5977300">pos</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977306">ncolons</span><span class="op" id="5977313">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977318">p</span><span class="op" id="5977319">.</span><span class="ident" id="5977320">next</span><span class="op" id="5977324">(</span><span class="op" id="5977325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977329">if</span>&nbsp;<span class="ident" id="5977332">p</span><span class="op" id="5977333">.</span><span class="ident" id="5977334">tok</span>&nbsp;<span class="op" id="5977338">!=</span>&nbsp;<span class="ident" id="5977341">token</span><span class="op" id="5977346">.</span><span class="ident" id="5977347">COLON</span>&nbsp;<span class="op" id="5977353">&amp;&amp;</span>&nbsp;<span class="ident" id="5977356">p</span><span class="op" id="5977357">.</span><span class="ident" id="5977358">tok</span>&nbsp;<span class="op" id="5977362">!=</span>&nbsp;<span class="ident" id="5977365">token</span><span class="op" id="5977370">.</span><span class="ident" id="5977371">RBRACK</span>&nbsp;<span class="op" id="5977378">&amp;&amp;</span>&nbsp;<span class="ident" id="5977381">p</span><span class="op" id="5977382">.</span><span class="ident" id="5977383">tok</span>&nbsp;<span class="op" id="5977387">!=</span>&nbsp;<span class="ident" id="5977390">token</span><span class="op" id="5977395">.</span><span class="ident" id="5977396">EOF</span>&nbsp;<span class="op" id="5977400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977405">index</span><span class="op" id="5977410">[</span><span class="ident" id="5977411">ncolons</span><span class="op" id="5977418">]</span>&nbsp;<span class="op" id="5977420">=</span>&nbsp;<span class="ident" id="5977422">p</span><span class="op" id="5977423">.</span><span class="ident" id="5977424">parseRhs</span><span class="op" id="5977432">(</span><span class="op" id="5977433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977437">}</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977443">p</span><span class="op" id="5977444">.</span><span class="ident" id="5977445">exprLev</span><span class="op" id="5977452">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977456">rbrack</span>&nbsp;<span class="op" id="5977463">:=</span>&nbsp;<span class="ident" id="5977466">p</span><span class="op" id="5977467">.</span><span class="ident" id="5977468">expect</span><span class="op" id="5977474">(</span><span class="ident" id="5977475">token</span><span class="op" id="5977480">.</span><span class="ident" id="5977481">RBRACK</span><span class="op" id="5977487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977491">if</span>&nbsp;<span class="ident" id="5977494">ncolons</span>&nbsp;<span class="op" id="5977502">&gt;</span>&nbsp;<span class="num" id="5977504">0</span>&nbsp;<span class="op" id="5977506">{</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5977510">//&nbsp;slice&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977532">slice3</span>&nbsp;<span class="op" id="5977539">:=</span>&nbsp;<span class="ident" id="5977542">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977550">if</span>&nbsp;<span class="ident" id="5977553">ncolons</span>&nbsp;<span class="op" id="5977561">==</span>&nbsp;<span class="num" id="5977564">2</span>&nbsp;<span class="op" id="5977566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977571">slice3</span>&nbsp;<span class="op" id="5977578">=</span>&nbsp;<span class="ident" id="5977580">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5977588">//&nbsp;Check&nbsp;presence&nbsp;of&nbsp;2nd&nbsp;and&nbsp;3rd&nbsp;index&nbsp;here&nbsp;rather&nbsp;than&nbsp;during&nbsp;type-checking</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5977668">//&nbsp;to&nbsp;prevent&nbsp;erroneous&nbsp;programs&nbsp;from&nbsp;passing&nbsp;through&nbsp;gofmt&nbsp;(was&nbsp;issue&nbsp;7305).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977749">if</span>&nbsp;<span class="ident" id="5977752">index</span><span class="op" id="5977757">[</span><span class="num" id="5977758">1</span><span class="op" id="5977759">]</span>&nbsp;<span class="op" id="5977761">==</span>&nbsp;<span class="ident" id="5977764">nil</span>&nbsp;<span class="op" id="5977768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977774">p</span><span class="op" id="5977775">.</span><span class="builtintype" id="5977776">error</span><span class="op" id="5977781">(</span><span class="ident" id="5977782">colons</span><span class="op" id="5977788">[</span><span class="num" id="5977789">0</span><span class="op" id="5977790">]</span><span class="op" id="5977791">,</span>&nbsp;<span class="string" id="5977793">&#34;2nd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="5977830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977836">index</span><span class="op" id="5977841">[</span><span class="num" id="5977842">1</span><span class="op" id="5977843">]</span>&nbsp;<span class="op" id="5977845">=</span>&nbsp;<span class="op" id="5977847">&amp;</span><span class="ident" id="5977848">ast</span><span class="op" id="5977851">.</span><span class="ident" id="5977852">BadExpr</span><span class="op" id="5977859">{</span><span class="ident" id="5977860">From</span><span class="op" id="5977864">:</span>&nbsp;<span class="ident" id="5977866">colons</span><span class="op" id="5977872">[</span><span class="num" id="5977873">0</span><span class="op" id="5977874">]</span>&nbsp;<span class="op" id="5977876">+</span>&nbsp;<span class="num" id="5977878">1</span><span class="op" id="5977879">,</span>&nbsp;<span class="ident" id="5977881">To</span><span class="op" id="5977883">:</span>&nbsp;<span class="ident" id="5977885">colons</span><span class="op" id="5977891">[</span><span class="num" id="5977892">1</span><span class="op" id="5977893">]</span><span class="op" id="5977894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977899">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977904">if</span>&nbsp;<span class="ident" id="5977907">index</span><span class="op" id="5977912">[</span><span class="num" id="5977913">2</span><span class="op" id="5977914">]</span>&nbsp;<span class="op" id="5977916">==</span>&nbsp;<span class="ident" id="5977919">nil</span>&nbsp;<span class="op" id="5977923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977929">p</span><span class="op" id="5977930">.</span><span class="builtintype" id="5977931">error</span><span class="op" id="5977936">(</span><span class="ident" id="5977937">colons</span><span class="op" id="5977943">[</span><span class="num" id="5977944">1</span><span class="op" id="5977945">]</span><span class="op" id="5977946">,</span>&nbsp;<span class="string" id="5977948">&#34;3rd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="5977985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977991">index</span><span class="op" id="5977996">[</span><span class="num" id="5977997">2</span><span class="op" id="5977998">]</span>&nbsp;<span class="op" id="5978000">=</span>&nbsp;<span class="op" id="5978002">&amp;</span><span class="ident" id="5978003">ast</span><span class="op" id="5978006">.</span><span class="ident" id="5978007">BadExpr</span><span class="op" id="5978014">{</span><span class="ident" id="5978015">From</span><span class="op" id="5978019">:</span>&nbsp;<span class="ident" id="5978021">colons</span><span class="op" id="5978027">[</span><span class="num" id="5978028">1</span><span class="op" id="5978029">]</span>&nbsp;<span class="op" id="5978031">+</span>&nbsp;<span class="num" id="5978033">1</span><span class="op" id="5978034">,</span>&nbsp;<span class="ident" id="5978036">To</span><span class="op" id="5978038">:</span>&nbsp;<span class="ident" id="5978040">rbrack</span><span class="op" id="5978046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978055">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978059">return</span>&nbsp;<span class="op" id="5978066">&amp;</span><span class="ident" id="5978067">ast</span><span class="op" id="5978070">.</span><span class="ident" id="5978071">SliceExpr</span><span class="op" id="5978080">{</span><span class="ident" id="5978081">X</span><span class="op" id="5978082">:</span>&nbsp;<span class="ident" id="5978084">x</span><span class="op" id="5978085">,</span>&nbsp;<span class="ident" id="5978087">Lbrack</span><span class="op" id="5978093">:</span>&nbsp;<span class="ident" id="5978095">lbrack</span><span class="op" id="5978101">,</span>&nbsp;<span class="ident" id="5978103">Low</span><span class="op" id="5978106">:</span>&nbsp;<span class="ident" id="5978108">index</span><span class="op" id="5978113">[</span><span class="num" id="5978114">0</span><span class="op" id="5978115">]</span><span class="op" id="5978116">,</span>&nbsp;<span class="ident" id="5978118">High</span><span class="op" id="5978122">:</span>&nbsp;<span class="ident" id="5978124">index</span><span class="op" id="5978129">[</span><span class="num" id="5978130">1</span><span class="op" id="5978131">]</span><span class="op" id="5978132">,</span>&nbsp;<span class="ident" id="5978134">Max</span><span class="op" id="5978137">:</span>&nbsp;<span class="ident" id="5978139">index</span><span class="op" id="5978144">[</span><span class="num" id="5978145">2</span><span class="op" id="5978146">]</span><span class="op" id="5978147">,</span>&nbsp;<span class="ident" id="5978149">Slice3</span><span class="op" id="5978155">:</span>&nbsp;<span class="ident" id="5978157">slice3</span><span class="op" id="5978163">,</span>&nbsp;<span class="ident" id="5978165">Rbrack</span><span class="op" id="5978171">:</span>&nbsp;<span class="ident" id="5978173">rbrack</span><span class="op" id="5978179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978186">return</span>&nbsp;<span class="op" id="5978193">&amp;</span><span class="ident" id="5978194">ast</span><span class="op" id="5978197">.</span><span class="ident" id="5978198">IndexExpr</span><span class="op" id="5978207">{</span><span class="ident" id="5978208">X</span><span class="op" id="5978209">:</span>&nbsp;<span class="ident" id="5978211">x</span><span class="op" id="5978212">,</span>&nbsp;<span class="ident" id="5978214">Lbrack</span><span class="op" id="5978220">:</span>&nbsp;<span class="ident" id="5978222">lbrack</span><span class="op" id="5978228">,</span>&nbsp;<span class="ident" id="5978230">Index</span><span class="op" id="5978235">:</span>&nbsp;<span class="ident" id="5978237">index</span><span class="op" id="5978242">[</span><span class="num" id="5978243">0</span><span class="op" id="5978244">]</span><span class="op" id="5978245">,</span>&nbsp;<span class="ident" id="5978247">Rbrack</span><span class="op" id="5978253">:</span>&nbsp;<span class="ident" id="5978255">rbrack</span><span class="op" id="5978261">}</span><br>
<span class="lineno"></span><span class="op" id="5978263">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span><span class="keyword" id="5978266">func</span>&nbsp;<span class="op" id="5978271">(</span><span class="ident" id="5978272">p</span>&nbsp;<span class="op" id="5978274">*</span><span class="ident" id="5978275">parser</span><span class="op" id="5978281">)</span>&nbsp;<span class="ident" id="5978283">parseCallOrConversion</span><span class="op" id="5978304">(</span><span class="ident" id="5978305">fun</span>&nbsp;<span class="ident" id="5978309">ast</span><span class="op" id="5978312">.</span><span class="ident" id="5978313">Expr</span><span class="op" id="5978317">)</span>&nbsp;<span class="op" id="5978319">*</span><span class="ident" id="5978320">ast</span><span class="op" id="5978323">.</span><span class="ident" id="5978324">CallExpr</span>&nbsp;<span class="op" id="5978333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978336">if</span>&nbsp;<span class="ident" id="5978339">p</span><span class="op" id="5978340">.</span><span class="ident" id="5978341">trace</span>&nbsp;<span class="op" id="5978347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978351">defer</span>&nbsp;<span class="ident" id="5978357">un</span><span class="op" id="5978359">(</span><span class="ident" id="5978360">trace</span><span class="op" id="5978365">(</span><span class="ident" id="5978366">p</span><span class="op" id="5978367">,</span>&nbsp;<span class="string" id="5978369">&#34;CallOrConversion&#34;</span><span class="op" id="5978387">)</span><span class="op" id="5978388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978391">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978395">lparen</span>&nbsp;<span class="op" id="5978402">:=</span>&nbsp;<span class="ident" id="5978405">p</span><span class="op" id="5978406">.</span><span class="ident" id="5978407">expect</span><span class="op" id="5978413">(</span><span class="ident" id="5978414">token</span><span class="op" id="5978419">.</span><span class="ident" id="5978420">LPAREN</span><span class="op" id="5978426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978429">p</span><span class="op" id="5978430">.</span><span class="ident" id="5978431">exprLev</span><span class="op" id="5978438">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978442">var</span>&nbsp;<span class="ident" id="5978446">list</span>&nbsp;<span class="op" id="5978451">[</span><span class="op" id="5978452">]</span><span class="ident" id="5978453">ast</span><span class="op" id="5978456">.</span><span class="ident" id="5978457">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978463">var</span>&nbsp;<span class="ident" id="5978467">ellipsis</span>&nbsp;<span class="ident" id="5978476">token</span><span class="op" id="5978481">.</span><span class="ident" id="5978482">Pos</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978487">for</span>&nbsp;<span class="ident" id="5978491">p</span><span class="op" id="5978492">.</span><span class="ident" id="5978493">tok</span>&nbsp;<span class="op" id="5978497">!=</span>&nbsp;<span class="ident" id="5978500">token</span><span class="op" id="5978505">.</span><span class="ident" id="5978506">RPAREN</span>&nbsp;<span class="op" id="5978513">&amp;&amp;</span>&nbsp;<span class="ident" id="5978516">p</span><span class="op" id="5978517">.</span><span class="ident" id="5978518">tok</span>&nbsp;<span class="op" id="5978522">!=</span>&nbsp;<span class="ident" id="5978525">token</span><span class="op" id="5978530">.</span><span class="ident" id="5978531">EOF</span>&nbsp;<span class="op" id="5978535">&amp;&amp;</span>&nbsp;<span class="op" id="5978538">!</span><span class="ident" id="5978539">ellipsis</span><span class="op" id="5978547">.</span><span class="ident" id="5978548">IsValid</span><span class="op" id="5978555">(</span><span class="op" id="5978556">)</span>&nbsp;<span class="op" id="5978558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978562">list</span>&nbsp;<span class="op" id="5978567">=</span>&nbsp;<span class="builtinfunc" id="5978569">append</span><span class="op" id="5978575">(</span><span class="ident" id="5978576">list</span><span class="op" id="5978580">,</span>&nbsp;<span class="ident" id="5978582">p</span><span class="op" id="5978583">.</span><span class="ident" id="5978584">parseRhsOrType</span><span class="op" id="5978598">(</span><span class="op" id="5978599">)</span><span class="op" id="5978600">)</span>&nbsp;<span class="comment" id="5978602">//&nbsp;builtins&nbsp;may&nbsp;expect&nbsp;a&nbsp;type:&nbsp;make(some&nbsp;type,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978656">if</span>&nbsp;<span class="ident" id="5978659">p</span><span class="op" id="5978660">.</span><span class="ident" id="5978661">tok</span>&nbsp;<span class="op" id="5978665">==</span>&nbsp;<span class="ident" id="5978668">token</span><span class="op" id="5978673">.</span><span class="ident" id="5978674">ELLIPSIS</span>&nbsp;<span class="op" id="5978683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978688">ellipsis</span>&nbsp;<span class="op" id="5978697">=</span>&nbsp;<span class="ident" id="5978699">p</span><span class="op" id="5978700">.</span><span class="ident" id="5978701">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978708">p</span><span class="op" id="5978709">.</span><span class="ident" id="5978710">next</span><span class="op" id="5978714">(</span><span class="op" id="5978715">)</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978723">if</span>&nbsp;<span class="op" id="5978726">!</span><span class="ident" id="5978727">p</span><span class="op" id="5978728">.</span><span class="ident" id="5978729">atComma</span><span class="op" id="5978736">(</span><span class="string" id="5978737">&#34;argument&nbsp;list&#34;</span><span class="op" id="5978752">)</span>&nbsp;<span class="op" id="5978754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978759">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978771">p</span><span class="op" id="5978772">.</span><span class="ident" id="5978773">next</span><span class="op" id="5978777">(</span><span class="op" id="5978778">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978784">p</span><span class="op" id="5978785">.</span><span class="ident" id="5978786">exprLev</span><span class="op" id="5978793">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978797">rparen</span>&nbsp;<span class="op" id="5978804">:=</span>&nbsp;<span class="ident" id="5978807">p</span><span class="op" id="5978808">.</span><span class="ident" id="5978809">expectClosing</span><span class="op" id="5978822">(</span><span class="ident" id="5978823">token</span><span class="op" id="5978828">.</span><span class="ident" id="5978829">RPAREN</span><span class="op" id="5978835">,</span>&nbsp;<span class="string" id="5978837">&#34;argument&nbsp;list&#34;</span><span class="op" id="5978852">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978856">return</span>&nbsp;<span class="op" id="5978863">&amp;</span><span class="ident" id="5978864">ast</span><span class="op" id="5978867">.</span><span class="ident" id="5978868">CallExpr</span><span class="op" id="5978876">{</span><span class="ident" id="5978877">Fun</span><span class="op" id="5978880">:</span>&nbsp;<span class="ident" id="5978882">fun</span><span class="op" id="5978885">,</span>&nbsp;<span class="ident" id="5978887">Lparen</span><span class="op" id="5978893">:</span>&nbsp;<span class="ident" id="5978895">lparen</span><span class="op" id="5978901">,</span>&nbsp;<span class="ident" id="5978903">Args</span><span class="op" id="5978907">:</span>&nbsp;<span class="ident" id="5978909">list</span><span class="op" id="5978913">,</span>&nbsp;<span class="ident" id="5978915">Ellipsis</span><span class="op" id="5978923">:</span>&nbsp;<span class="ident" id="5978925">ellipsis</span><span class="op" id="5978933">,</span>&nbsp;<span class="ident" id="5978935">Rparen</span><span class="op" id="5978941">:</span>&nbsp;<span class="ident" id="5978943">rparen</span><span class="op" id="5978949">}</span><br>
<span class="lineno">1260</span><span class="op" id="5978951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5978954">func</span>&nbsp;<span class="op" id="5978959">(</span><span class="ident" id="5978960">p</span>&nbsp;<span class="op" id="5978962">*</span><span class="ident" id="5978963">parser</span><span class="op" id="5978969">)</span>&nbsp;<span class="ident" id="5978971">parseElement</span><span class="op" id="5978983">(</span><span class="ident" id="5978984">keyOk</span>&nbsp;<span class="builtintype" id="5978990">bool</span><span class="op" id="5978994">)</span>&nbsp;<span class="ident" id="5978996">ast</span><span class="op" id="5978999">.</span><span class="ident" id="5979000">Expr</span>&nbsp;<span class="op" id="5979005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979008">if</span>&nbsp;<span class="ident" id="5979011">p</span><span class="op" id="5979012">.</span><span class="ident" id="5979013">trace</span>&nbsp;<span class="op" id="5979019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979023">defer</span>&nbsp;<span class="ident" id="5979029">un</span><span class="op" id="5979031">(</span><span class="ident" id="5979032">trace</span><span class="op" id="5979037">(</span><span class="ident" id="5979038">p</span><span class="op" id="5979039">,</span>&nbsp;<span class="string" id="5979041">&#34;Element&#34;</span><span class="op" id="5979050">)</span><span class="op" id="5979051">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5979054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979058">if</span>&nbsp;<span class="ident" id="5979061">p</span><span class="op" id="5979062">.</span><span class="ident" id="5979063">tok</span>&nbsp;<span class="op" id="5979067">==</span>&nbsp;<span class="ident" id="5979070">token</span><span class="op" id="5979075">.</span><span class="ident" id="5979076">LBRACE</span>&nbsp;<span class="op" id="5979083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979087">return</span>&nbsp;<span class="ident" id="5979094">p</span><span class="op" id="5979095">.</span><span class="ident" id="5979096">parseLiteralValue</span><span class="op" id="5979113">(</span><span class="ident" id="5979114">nil</span><span class="op" id="5979117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5979120">}</span><br>
<span class="lineno">1270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979124">//&nbsp;Because&nbsp;the&nbsp;parser&nbsp;doesn&#39;t&nbsp;know&nbsp;the&nbsp;composite&nbsp;literal&nbsp;type,&nbsp;it&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979198">//&nbsp;know&nbsp;if&nbsp;a&nbsp;key&nbsp;that&#39;s&nbsp;an&nbsp;identifier&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;name&nbsp;or&nbsp;a&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979270">//&nbsp;denoting&nbsp;a&nbsp;value.&nbsp;The&nbsp;former&nbsp;is&nbsp;not&nbsp;resolved&nbsp;by&nbsp;the&nbsp;parser&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979340">//&nbsp;resolver.</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979354">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979358">//&nbsp;Instead,&nbsp;_try_&nbsp;to&nbsp;resolve&nbsp;such&nbsp;a&nbsp;key&nbsp;if&nbsp;possible.&nbsp;If&nbsp;it&nbsp;resolves,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979428">//&nbsp;it&nbsp;a)&nbsp;has&nbsp;correctly&nbsp;resolved,&nbsp;or&nbsp;b)&nbsp;incorrectly&nbsp;resolved&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979497">//&nbsp;the&nbsp;key&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;matching&nbsp;another&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979568">//&nbsp;In&nbsp;the&nbsp;former&nbsp;case&nbsp;we&nbsp;are&nbsp;done,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979636">//&nbsp;care&nbsp;because&nbsp;the&nbsp;type&nbsp;checker&nbsp;will&nbsp;do&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979703">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979707">//&nbsp;If&nbsp;the&nbsp;key&nbsp;does&nbsp;not&nbsp;resolve,&nbsp;it&nbsp;a)&nbsp;must&nbsp;be&nbsp;defined&nbsp;at&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979773">//&nbsp;level&nbsp;in&nbsp;another&nbsp;file&nbsp;of&nbsp;the&nbsp;same&nbsp;package,&nbsp;the&nbsp;universe&nbsp;scope,&nbsp;or&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979846">//&nbsp;undeclared;&nbsp;or&nbsp;b)&nbsp;it&nbsp;is&nbsp;a&nbsp;struct&nbsp;field.&nbsp;In&nbsp;the&nbsp;former&nbsp;case,&nbsp;the&nbsp;type</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979919">//&nbsp;checker&nbsp;can&nbsp;do&nbsp;a&nbsp;top-level&nbsp;lookup,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;it&nbsp;will&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979992">//&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980021">x</span>&nbsp;<span class="op" id="5980023">:=</span>&nbsp;<span class="ident" id="5980026">p</span><span class="op" id="5980027">.</span><span class="ident" id="5980028">checkExpr</span><span class="op" id="5980037">(</span><span class="ident" id="5980038">p</span><span class="op" id="5980039">.</span><span class="ident" id="5980040">parseExpr</span><span class="op" id="5980049">(</span><span class="ident" id="5980050">keyOk</span><span class="op" id="5980055">)</span><span class="op" id="5980056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980059">if</span>&nbsp;<span class="ident" id="5980062">keyOk</span>&nbsp;<span class="op" id="5980068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980072">if</span>&nbsp;<span class="ident" id="5980075">p</span><span class="op" id="5980076">.</span><span class="ident" id="5980077">tok</span>&nbsp;<span class="op" id="5980081">==</span>&nbsp;<span class="ident" id="5980084">token</span><span class="op" id="5980089">.</span><span class="ident" id="5980090">COLON</span>&nbsp;<span class="op" id="5980096">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980101">colon</span>&nbsp;<span class="op" id="5980107">:=</span>&nbsp;<span class="ident" id="5980110">p</span><span class="op" id="5980111">.</span><span class="ident" id="5980112">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980119">p</span><span class="op" id="5980120">.</span><span class="ident" id="5980121">next</span><span class="op" id="5980125">(</span><span class="op" id="5980126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980131">//&nbsp;Try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;key&nbsp;but&nbsp;don&#39;t&nbsp;collect&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980181">//&nbsp;as&nbsp;unresolved&nbsp;identifier&nbsp;if&nbsp;it&nbsp;fails&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980232">//&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;(possibly&nbsp;false)&nbsp;errors&nbsp;about</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980281">//&nbsp;undeclared&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980305">p</span><span class="op" id="5980306">.</span><span class="ident" id="5980307">tryResolve</span><span class="op" id="5980317">(</span><span class="ident" id="5980318">x</span><span class="op" id="5980319">,</span>&nbsp;<span class="ident" id="5980321">false</span><span class="op" id="5980326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980331">return</span>&nbsp;<span class="op" id="5980338">&amp;</span><span class="ident" id="5980339">ast</span><span class="op" id="5980342">.</span><span class="ident" id="5980343">KeyValueExpr</span><span class="op" id="5980355">{</span><span class="ident" id="5980356">Key</span><span class="op" id="5980359">:</span>&nbsp;<span class="ident" id="5980361">x</span><span class="op" id="5980362">,</span>&nbsp;<span class="ident" id="5980364">Colon</span><span class="op" id="5980369">:</span>&nbsp;<span class="ident" id="5980371">colon</span><span class="op" id="5980376">,</span>&nbsp;<span class="ident" id="5980378">Value</span><span class="op" id="5980383">:</span>&nbsp;<span class="ident" id="5980385">p</span><span class="op" id="5980386">.</span><span class="ident" id="5980387">parseElement</span><span class="op" id="5980399">(</span><span class="ident" id="5980400">false</span><span class="op" id="5980405">)</span><span class="op" id="5980406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980414">p</span><span class="op" id="5980415">.</span><span class="ident" id="5980416">resolve</span><span class="op" id="5980423">(</span><span class="ident" id="5980424">x</span><span class="op" id="5980425">)</span>&nbsp;<span class="comment" id="5980427">//&nbsp;not&nbsp;a&nbsp;key</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980445">return</span>&nbsp;<span class="ident" id="5980452">x</span><br>
<span class="lineno"></span><span class="op" id="5980454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span><span class="keyword" id="5980457">func</span>&nbsp;<span class="op" id="5980462">(</span><span class="ident" id="5980463">p</span>&nbsp;<span class="op" id="5980465">*</span><span class="ident" id="5980466">parser</span><span class="op" id="5980472">)</span>&nbsp;<span class="ident" id="5980474">parseElementList</span><span class="op" id="5980490">(</span><span class="op" id="5980491">)</span>&nbsp;<span class="op" id="5980493">(</span><span class="ident" id="5980494">list</span>&nbsp;<span class="op" id="5980499">[</span><span class="op" id="5980500">]</span><span class="ident" id="5980501">ast</span><span class="op" id="5980504">.</span><span class="ident" id="5980505">Expr</span><span class="op" id="5980509">)</span>&nbsp;<span class="op" id="5980511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980514">if</span>&nbsp;<span class="ident" id="5980517">p</span><span class="op" id="5980518">.</span><span class="ident" id="5980519">trace</span>&nbsp;<span class="op" id="5980525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980529">defer</span>&nbsp;<span class="ident" id="5980535">un</span><span class="op" id="5980537">(</span><span class="ident" id="5980538">trace</span><span class="op" id="5980543">(</span><span class="ident" id="5980544">p</span><span class="op" id="5980545">,</span>&nbsp;<span class="string" id="5980547">&#34;ElementList&#34;</span><span class="op" id="5980560">)</span><span class="op" id="5980561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980568">for</span>&nbsp;<span class="ident" id="5980572">p</span><span class="op" id="5980573">.</span><span class="ident" id="5980574">tok</span>&nbsp;<span class="op" id="5980578">!=</span>&nbsp;<span class="ident" id="5980581">token</span><span class="op" id="5980586">.</span><span class="ident" id="5980587">RBRACE</span>&nbsp;<span class="op" id="5980594">&amp;&amp;</span>&nbsp;<span class="ident" id="5980597">p</span><span class="op" id="5980598">.</span><span class="ident" id="5980599">tok</span>&nbsp;<span class="op" id="5980603">!=</span>&nbsp;<span class="ident" id="5980606">token</span><span class="op" id="5980611">.</span><span class="ident" id="5980612">EOF</span>&nbsp;<span class="op" id="5980616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980620">list</span>&nbsp;<span class="op" id="5980625">=</span>&nbsp;<span class="builtinfunc" id="5980627">append</span><span class="op" id="5980633">(</span><span class="ident" id="5980634">list</span><span class="op" id="5980638">,</span>&nbsp;<span class="ident" id="5980640">p</span><span class="op" id="5980641">.</span><span class="ident" id="5980642">parseElement</span><span class="op" id="5980654">(</span><span class="ident" id="5980655">true</span><span class="op" id="5980659">)</span><span class="op" id="5980660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980664">if</span>&nbsp;<span class="op" id="5980667">!</span><span class="ident" id="5980668">p</span><span class="op" id="5980669">.</span><span class="ident" id="5980670">atComma</span><span class="op" id="5980677">(</span><span class="string" id="5980678">&#34;composite&nbsp;literal&#34;</span><span class="op" id="5980697">)</span>&nbsp;<span class="op" id="5980699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980704">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980712">}</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980716">p</span><span class="op" id="5980717">.</span><span class="ident" id="5980718">next</span><span class="op" id="5980722">(</span><span class="op" id="5980723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980730">return</span><br>
<span class="lineno"></span><span class="op" id="5980737">}</span><br>
<span class="lineno">1320</span><br>
<span class="lineno"></span><span class="keyword" id="5980740">func</span>&nbsp;<span class="op" id="5980745">(</span><span class="ident" id="5980746">p</span>&nbsp;<span class="op" id="5980748">*</span><span class="ident" id="5980749">parser</span><span class="op" id="5980755">)</span>&nbsp;<span class="ident" id="5980757">parseLiteralValue</span><span class="op" id="5980774">(</span><span class="ident" id="5980775">typ</span>&nbsp;<span class="ident" id="5980779">ast</span><span class="op" id="5980782">.</span><span class="ident" id="5980783">Expr</span><span class="op" id="5980787">)</span>&nbsp;<span class="ident" id="5980789">ast</span><span class="op" id="5980792">.</span><span class="ident" id="5980793">Expr</span>&nbsp;<span class="op" id="5980798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980801">if</span>&nbsp;<span class="ident" id="5980804">p</span><span class="op" id="5980805">.</span><span class="ident" id="5980806">trace</span>&nbsp;<span class="op" id="5980812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980816">defer</span>&nbsp;<span class="ident" id="5980822">un</span><span class="op" id="5980824">(</span><span class="ident" id="5980825">trace</span><span class="op" id="5980830">(</span><span class="ident" id="5980831">p</span><span class="op" id="5980832">,</span>&nbsp;<span class="string" id="5980834">&#34;LiteralValue&#34;</span><span class="op" id="5980848">)</span><span class="op" id="5980849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980852">}</span><br>
<span class="lineno">1325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980856">lbrace</span>&nbsp;<span class="op" id="5980863">:=</span>&nbsp;<span class="ident" id="5980866">p</span><span class="op" id="5980867">.</span><span class="ident" id="5980868">expect</span><span class="op" id="5980874">(</span><span class="ident" id="5980875">token</span><span class="op" id="5980880">.</span><span class="ident" id="5980881">LBRACE</span><span class="op" id="5980887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980890">var</span>&nbsp;<span class="ident" id="5980894">elts</span>&nbsp;<span class="op" id="5980899">[</span><span class="op" id="5980900">]</span><span class="ident" id="5980901">ast</span><span class="op" id="5980904">.</span><span class="ident" id="5980905">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980911">p</span><span class="op" id="5980912">.</span><span class="ident" id="5980913">exprLev</span><span class="op" id="5980920">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980924">if</span>&nbsp;<span class="ident" id="5980927">p</span><span class="op" id="5980928">.</span><span class="ident" id="5980929">tok</span>&nbsp;<span class="op" id="5980933">!=</span>&nbsp;<span class="ident" id="5980936">token</span><span class="op" id="5980941">.</span><span class="ident" id="5980942">RBRACE</span>&nbsp;<span class="op" id="5980949">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980953">elts</span>&nbsp;<span class="op" id="5980958">=</span>&nbsp;<span class="ident" id="5980960">p</span><span class="op" id="5980961">.</span><span class="ident" id="5980962">parseElementList</span><span class="op" id="5980978">(</span><span class="op" id="5980979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980985">p</span><span class="op" id="5980986">.</span><span class="ident" id="5980987">exprLev</span><span class="op" id="5980994">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980998">rbrace</span>&nbsp;<span class="op" id="5981005">:=</span>&nbsp;<span class="ident" id="5981008">p</span><span class="op" id="5981009">.</span><span class="ident" id="5981010">expectClosing</span><span class="op" id="5981023">(</span><span class="ident" id="5981024">token</span><span class="op" id="5981029">.</span><span class="ident" id="5981030">RBRACE</span><span class="op" id="5981036">,</span>&nbsp;<span class="string" id="5981038">&#34;composite&nbsp;literal&#34;</span><span class="op" id="5981057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981060">return</span>&nbsp;<span class="op" id="5981067">&amp;</span><span class="ident" id="5981068">ast</span><span class="op" id="5981071">.</span><span class="ident" id="5981072">CompositeLit</span><span class="op" id="5981084">{</span><span class="ident" id="5981085">Type</span><span class="op" id="5981089">:</span>&nbsp;<span class="ident" id="5981091">typ</span><span class="op" id="5981094">,</span>&nbsp;<span class="ident" id="5981096">Lbrace</span><span class="op" id="5981102">:</span>&nbsp;<span class="ident" id="5981104">lbrace</span><span class="op" id="5981110">,</span>&nbsp;<span class="ident" id="5981112">Elts</span><span class="op" id="5981116">:</span>&nbsp;<span class="ident" id="5981118">elts</span><span class="op" id="5981122">,</span>&nbsp;<span class="ident" id="5981124">Rbrace</span><span class="op" id="5981130">:</span>&nbsp;<span class="ident" id="5981132">rbrace</span><span class="op" id="5981138">}</span><br>
<span class="lineno">1335</span><span class="op" id="5981140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5981143">//&nbsp;checkExpr&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;(and&nbsp;not&nbsp;a&nbsp;type).</span><br>
<span class="lineno"></span><span class="keyword" id="5981205">func</span>&nbsp;<span class="op" id="5981210">(</span><span class="ident" id="5981211">p</span>&nbsp;<span class="op" id="5981213">*</span><span class="ident" id="5981214">parser</span><span class="op" id="5981220">)</span>&nbsp;<span class="ident" id="5981222">checkExpr</span><span class="op" id="5981231">(</span><span class="ident" id="5981232">x</span>&nbsp;<span class="ident" id="5981234">ast</span><span class="op" id="5981237">.</span><span class="ident" id="5981238">Expr</span><span class="op" id="5981242">)</span>&nbsp;<span class="ident" id="5981244">ast</span><span class="op" id="5981247">.</span><span class="ident" id="5981248">Expr</span>&nbsp;<span class="op" id="5981253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981256">switch</span>&nbsp;<span class="ident" id="5981263">unparen</span><span class="op" id="5981270">(</span><span class="ident" id="5981271">x</span><span class="op" id="5981272">)</span><span class="op" id="5981273">.</span><span class="op" id="5981274">(</span><span class="keyword" id="5981275">type</span><span class="op" id="5981279">)</span>&nbsp;<span class="op" id="5981281">{</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981284">case</span>&nbsp;<span class="op" id="5981289">*</span><span class="ident" id="5981290">ast</span><span class="op" id="5981293">.</span><span class="ident" id="5981294">BadExpr</span><span class="op" id="5981301">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981304">case</span>&nbsp;<span class="op" id="5981309">*</span><span class="ident" id="5981310">ast</span><span class="op" id="5981313">.</span><span class="ident" id="5981314">Ident</span><span class="op" id="5981319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981322">case</span>&nbsp;<span class="op" id="5981327">*</span><span class="ident" id="5981328">ast</span><span class="op" id="5981331">.</span><span class="ident" id="5981332">BasicLit</span><span class="op" id="5981340">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981343">case</span>&nbsp;<span class="op" id="5981348">*</span><span class="ident" id="5981349">ast</span><span class="op" id="5981352">.</span><span class="ident" id="5981353">FuncLit</span><span class="op" id="5981360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981363">case</span>&nbsp;<span class="op" id="5981368">*</span><span class="ident" id="5981369">ast</span><span class="op" id="5981372">.</span><span class="ident" id="5981373">CompositeLit</span><span class="op" id="5981385">:</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981388">case</span>&nbsp;<span class="op" id="5981393">*</span><span class="ident" id="5981394">ast</span><span class="op" id="5981397">.</span><span class="ident" id="5981398">ParenExpr</span><span class="op" id="5981407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5981411">panic</span><span class="op" id="5981416">(</span><span class="string" id="5981417">&#34;unreachable&#34;</span><span class="op" id="5981430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981433">case</span>&nbsp;<span class="op" id="5981438">*</span><span class="ident" id="5981439">ast</span><span class="op" id="5981442">.</span><span class="ident" id="5981443">SelectorExpr</span><span class="op" id="5981455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981458">case</span>&nbsp;<span class="op" id="5981463">*</span><span class="ident" id="5981464">ast</span><span class="op" id="5981467">.</span><span class="ident" id="5981468">IndexExpr</span><span class="op" id="5981477">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981480">case</span>&nbsp;<span class="op" id="5981485">*</span><span class="ident" id="5981486">ast</span><span class="op" id="5981489">.</span><span class="ident" id="5981490">SliceExpr</span><span class="op" id="5981499">:</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981502">case</span>&nbsp;<span class="op" id="5981507">*</span><span class="ident" id="5981508">ast</span><span class="op" id="5981511">.</span><span class="ident" id="5981512">TypeAssertExpr</span><span class="op" id="5981526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981530">//&nbsp;If&nbsp;t.Type&nbsp;==&nbsp;nil&nbsp;we&nbsp;have&nbsp;a&nbsp;type&nbsp;assertion&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981589">//&nbsp;y.(type),&nbsp;which&nbsp;is&nbsp;only&nbsp;allowed&nbsp;in&nbsp;type&nbsp;switch&nbsp;expressions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981654">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;exclude&nbsp;those&nbsp;but&nbsp;for&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981719">//&nbsp;a&nbsp;type&nbsp;switch.&nbsp;Instead&nbsp;be&nbsp;lenient&nbsp;and&nbsp;test&nbsp;this&nbsp;in&nbsp;the&nbsp;type</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981784">//&nbsp;checker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981797">case</span>&nbsp;<span class="op" id="5981802">*</span><span class="ident" id="5981803">ast</span><span class="op" id="5981806">.</span><span class="ident" id="5981807">CallExpr</span><span class="op" id="5981815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981818">case</span>&nbsp;<span class="op" id="5981823">*</span><span class="ident" id="5981824">ast</span><span class="op" id="5981827">.</span><span class="ident" id="5981828">StarExpr</span><span class="op" id="5981836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981839">case</span>&nbsp;<span class="op" id="5981844">*</span><span class="ident" id="5981845">ast</span><span class="op" id="5981848">.</span><span class="ident" id="5981849">UnaryExpr</span><span class="op" id="5981858">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981861">case</span>&nbsp;<span class="op" id="5981866">*</span><span class="ident" id="5981867">ast</span><span class="op" id="5981870">.</span><span class="ident" id="5981871">BinaryExpr</span><span class="op" id="5981881">:</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981884">default</span><span class="op" id="5981891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981895">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;proper&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981943">p</span><span class="op" id="5981944">.</span><span class="ident" id="5981945">errorExpected</span><span class="op" id="5981958">(</span><span class="ident" id="5981959">x</span><span class="op" id="5981960">.</span><span class="ident" id="5981961">Pos</span><span class="op" id="5981964">(</span><span class="op" id="5981965">)</span><span class="op" id="5981966">,</span>&nbsp;<span class="string" id="5981968">&#34;expression&#34;</span><span class="op" id="5981980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981984">x</span>&nbsp;<span class="op" id="5981986">=</span>&nbsp;<span class="op" id="5981988">&amp;</span><span class="ident" id="5981989">ast</span><span class="op" id="5981992">.</span><span class="ident" id="5981993">BadExpr</span><span class="op" id="5982000">{</span><span class="ident" id="5982001">From</span><span class="op" id="5982005">:</span>&nbsp;<span class="ident" id="5982007">x</span><span class="op" id="5982008">.</span><span class="ident" id="5982009">Pos</span><span class="op" id="5982012">(</span><span class="op" id="5982013">)</span><span class="op" id="5982014">,</span>&nbsp;<span class="ident" id="5982016">To</span><span class="op" id="5982018">:</span>&nbsp;<span class="ident" id="5982020">p</span><span class="op" id="5982021">.</span><span class="ident" id="5982022">safePos</span><span class="op" id="5982029">(</span><span class="ident" id="5982030">x</span><span class="op" id="5982031">.</span><span class="ident" id="5982032">End</span><span class="op" id="5982035">(</span><span class="op" id="5982036">)</span><span class="op" id="5982037">)</span><span class="op" id="5982038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982041">}</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982044">return</span>&nbsp;<span class="ident" id="5982051">x</span><br>
<span class="lineno"></span><span class="op" id="5982053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5982056">//&nbsp;isTypeName&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;(qualified)&nbsp;TypeName.</span><br>
<span class="lineno"></span><span class="keyword" id="5982116">func</span>&nbsp;<span class="ident" id="5982121">isTypeName</span><span class="op" id="5982131">(</span><span class="ident" id="5982132">x</span>&nbsp;<span class="ident" id="5982134">ast</span><span class="op" id="5982137">.</span><span class="ident" id="5982138">Expr</span><span class="op" id="5982142">)</span>&nbsp;<span class="builtintype" id="5982144">bool</span>&nbsp;<span class="op" id="5982149">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982152">switch</span>&nbsp;<span class="ident" id="5982159">t</span>&nbsp;<span class="op" id="5982161">:=</span>&nbsp;<span class="ident" id="5982164">x</span><span class="op" id="5982165">.</span><span class="op" id="5982166">(</span><span class="keyword" id="5982167">type</span><span class="op" id="5982171">)</span>&nbsp;<span class="op" id="5982173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982176">case</span>&nbsp;<span class="op" id="5982181">*</span><span class="ident" id="5982182">ast</span><span class="op" id="5982185">.</span><span class="ident" id="5982186">BadExpr</span><span class="op" id="5982193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982196">case</span>&nbsp;<span class="op" id="5982201">*</span><span class="ident" id="5982202">ast</span><span class="op" id="5982205">.</span><span class="ident" id="5982206">Ident</span><span class="op" id="5982211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982214">case</span>&nbsp;<span class="op" id="5982219">*</span><span class="ident" id="5982220">ast</span><span class="op" id="5982223">.</span><span class="ident" id="5982224">SelectorExpr</span><span class="op" id="5982236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982240">_</span><span class="op" id="5982241">,</span>&nbsp;<span class="ident" id="5982243">isIdent</span>&nbsp;<span class="op" id="5982251">:=</span>&nbsp;<span class="ident" id="5982254">t</span><span class="op" id="5982255">.</span><span class="ident" id="5982256">X</span><span class="op" id="5982257">.</span><span class="op" id="5982258">(</span><span class="op" id="5982259">*</span><span class="ident" id="5982260">ast</span><span class="op" id="5982263">.</span><span class="ident" id="5982264">Ident</span><span class="op" id="5982269">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982273">return</span>&nbsp;<span class="ident" id="5982280">isIdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982289">default</span><span class="op" id="5982296">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982300">return</span>&nbsp;<span class="ident" id="5982307">false</span>&nbsp;<span class="comment" id="5982313">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982355">return</span>&nbsp;<span class="ident" id="5982362">true</span><br>
<span class="lineno">1380</span><span class="op" id="5982367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5982370">//&nbsp;isLiteralType&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5982441">func</span>&nbsp;<span class="ident" id="5982446">isLiteralType</span><span class="op" id="5982459">(</span><span class="ident" id="5982460">x</span>&nbsp;<span class="ident" id="5982462">ast</span><span class="op" id="5982465">.</span><span class="ident" id="5982466">Expr</span><span class="op" id="5982470">)</span>&nbsp;<span class="builtintype" id="5982472">bool</span>&nbsp;<span class="op" id="5982477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982480">switch</span>&nbsp;<span class="ident" id="5982487">t</span>&nbsp;<span class="op" id="5982489">:=</span>&nbsp;<span class="ident" id="5982492">x</span><span class="op" id="5982493">.</span><span class="op" id="5982494">(</span><span class="keyword" id="5982495">type</span><span class="op" id="5982499">)</span>&nbsp;<span class="op" id="5982501">{</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982504">case</span>&nbsp;<span class="op" id="5982509">*</span><span class="ident" id="5982510">ast</span><span class="op" id="5982513">.</span><span class="ident" id="5982514">BadExpr</span><span class="op" id="5982521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982524">case</span>&nbsp;<span class="op" id="5982529">*</span><span class="ident" id="5982530">ast</span><span class="op" id="5982533">.</span><span class="ident" id="5982534">Ident</span><span class="op" id="5982539">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982542">case</span>&nbsp;<span class="op" id="5982547">*</span><span class="ident" id="5982548">ast</span><span class="op" id="5982551">.</span><span class="ident" id="5982552">SelectorExpr</span><span class="op" id="5982564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982568">_</span><span class="op" id="5982569">,</span>&nbsp;<span class="ident" id="5982571">isIdent</span>&nbsp;<span class="op" id="5982579">:=</span>&nbsp;<span class="ident" id="5982582">t</span><span class="op" id="5982583">.</span><span class="ident" id="5982584">X</span><span class="op" id="5982585">.</span><span class="op" id="5982586">(</span><span class="op" id="5982587">*</span><span class="ident" id="5982588">ast</span><span class="op" id="5982591">.</span><span class="ident" id="5982592">Ident</span><span class="op" id="5982597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982601">return</span>&nbsp;<span class="ident" id="5982608">isIdent</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982617">case</span>&nbsp;<span class="op" id="5982622">*</span><span class="ident" id="5982623">ast</span><span class="op" id="5982626">.</span><span class="ident" id="5982627">ArrayType</span><span class="op" id="5982636">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982639">case</span>&nbsp;<span class="op" id="5982644">*</span><span class="ident" id="5982645">ast</span><span class="op" id="5982648">.</span><span class="ident" id="5982649">StructType</span><span class="op" id="5982659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982662">case</span>&nbsp;<span class="op" id="5982667">*</span><span class="ident" id="5982668">ast</span><span class="op" id="5982671">.</span><span class="ident" id="5982672">MapType</span><span class="op" id="5982679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982682">default</span><span class="op" id="5982689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982693">return</span>&nbsp;<span class="ident" id="5982700">false</span>&nbsp;<span class="comment" id="5982706">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;types</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982767">return</span>&nbsp;<span class="ident" id="5982774">true</span><br>
<span class="lineno"></span><span class="op" id="5982779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5982782">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;*T,&nbsp;deref&nbsp;returns&nbsp;T,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno">1400</span><span class="keyword" id="5982850">func</span>&nbsp;<span class="ident" id="5982855">deref</span><span class="op" id="5982860">(</span><span class="ident" id="5982861">x</span>&nbsp;<span class="ident" id="5982863">ast</span><span class="op" id="5982866">.</span><span class="ident" id="5982867">Expr</span><span class="op" id="5982871">)</span>&nbsp;<span class="ident" id="5982873">ast</span><span class="op" id="5982876">.</span><span class="ident" id="5982877">Expr</span>&nbsp;<span class="op" id="5982882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982885">if</span>&nbsp;<span class="ident" id="5982888">p</span><span class="op" id="5982889">,</span>&nbsp;<span class="ident" id="5982891">isPtr</span>&nbsp;<span class="op" id="5982897">:=</span>&nbsp;<span class="ident" id="5982900">x</span><span class="op" id="5982901">.</span><span class="op" id="5982902">(</span><span class="op" id="5982903">*</span><span class="ident" id="5982904">ast</span><span class="op" id="5982907">.</span><span class="ident" id="5982908">StarExpr</span><span class="op" id="5982916">)</span><span class="op" id="5982917">;</span>&nbsp;<span class="ident" id="5982919">isPtr</span>&nbsp;<span class="op" id="5982925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982929">x</span>&nbsp;<span class="op" id="5982931">=</span>&nbsp;<span class="ident" id="5982933">p</span><span class="op" id="5982934">.</span><span class="ident" id="5982935">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982941">return</span>&nbsp;<span class="ident" id="5982948">x</span><br>
<span class="lineno">1405</span><span class="op" id="5982950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5982953">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;(T),&nbsp;unparen&nbsp;returns&nbsp;unparen(T),&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="5983033">func</span>&nbsp;<span class="ident" id="5983038">unparen</span><span class="op" id="5983045">(</span><span class="ident" id="5983046">x</span>&nbsp;<span class="ident" id="5983048">ast</span><span class="op" id="5983051">.</span><span class="ident" id="5983052">Expr</span><span class="op" id="5983056">)</span>&nbsp;<span class="ident" id="5983058">ast</span><span class="op" id="5983061">.</span><span class="ident" id="5983062">Expr</span>&nbsp;<span class="op" id="5983067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983070">if</span>&nbsp;<span class="ident" id="5983073">p</span><span class="op" id="5983074">,</span>&nbsp;<span class="ident" id="5983076">isParen</span>&nbsp;<span class="op" id="5983084">:=</span>&nbsp;<span class="ident" id="5983087">x</span><span class="op" id="5983088">.</span><span class="op" id="5983089">(</span><span class="op" id="5983090">*</span><span class="ident" id="5983091">ast</span><span class="op" id="5983094">.</span><span class="ident" id="5983095">ParenExpr</span><span class="op" id="5983104">)</span><span class="op" id="5983105">;</span>&nbsp;<span class="ident" id="5983107">isParen</span>&nbsp;<span class="op" id="5983115">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983119">x</span>&nbsp;<span class="op" id="5983121">=</span>&nbsp;<span class="ident" id="5983123">unparen</span><span class="op" id="5983130">(</span><span class="ident" id="5983131">p</span><span class="op" id="5983132">.</span><span class="ident" id="5983133">X</span><span class="op" id="5983134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983140">return</span>&nbsp;<span class="ident" id="5983147">x</span><br>
<span class="lineno"></span><span class="op" id="5983149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1415</span><span class="comment" id="5983152">//&nbsp;checkExprOrType&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5983212">//&nbsp;(and&nbsp;not&nbsp;a&nbsp;raw&nbsp;type&nbsp;such&nbsp;as&nbsp;[...]T).</span><br>
<span class="lineno"></span><span class="comment" id="5983252">//</span><br>
<span class="lineno"></span><span class="keyword" id="5983255">func</span>&nbsp;<span class="op" id="5983260">(</span><span class="ident" id="5983261">p</span>&nbsp;<span class="op" id="5983263">*</span><span class="ident" id="5983264">parser</span><span class="op" id="5983270">)</span>&nbsp;<span class="ident" id="5983272">checkExprOrType</span><span class="op" id="5983287">(</span><span class="ident" id="5983288">x</span>&nbsp;<span class="ident" id="5983290">ast</span><span class="op" id="5983293">.</span><span class="ident" id="5983294">Expr</span><span class="op" id="5983298">)</span>&nbsp;<span class="ident" id="5983300">ast</span><span class="op" id="5983303">.</span><span class="ident" id="5983304">Expr</span>&nbsp;<span class="op" id="5983309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983312">switch</span>&nbsp;<span class="ident" id="5983319">t</span>&nbsp;<span class="op" id="5983321">:=</span>&nbsp;<span class="ident" id="5983324">unparen</span><span class="op" id="5983331">(</span><span class="ident" id="5983332">x</span><span class="op" id="5983333">)</span><span class="op" id="5983334">.</span><span class="op" id="5983335">(</span><span class="keyword" id="5983336">type</span><span class="op" id="5983340">)</span>&nbsp;<span class="op" id="5983342">{</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983345">case</span>&nbsp;<span class="op" id="5983350">*</span><span class="ident" id="5983351">ast</span><span class="op" id="5983354">.</span><span class="ident" id="5983355">ParenExpr</span><span class="op" id="5983364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5983368">panic</span><span class="op" id="5983373">(</span><span class="string" id="5983374">&#34;unreachable&#34;</span><span class="op" id="5983387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983390">case</span>&nbsp;<span class="op" id="5983395">*</span><span class="ident" id="5983396">ast</span><span class="op" id="5983399">.</span><span class="ident" id="5983400">UnaryExpr</span><span class="op" id="5983409">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983412">case</span>&nbsp;<span class="op" id="5983417">*</span><span class="ident" id="5983418">ast</span><span class="op" id="5983421">.</span><span class="ident" id="5983422">ArrayType</span><span class="op" id="5983431">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983435">if</span>&nbsp;<span class="builtinfunc" id="5983438">len</span><span class="op" id="5983441">,</span>&nbsp;<span class="ident" id="5983443">isEllipsis</span>&nbsp;<span class="op" id="5983454">:=</span>&nbsp;<span class="ident" id="5983457">t</span><span class="op" id="5983458">.</span><span class="ident" id="5983459">Len</span><span class="op" id="5983462">.</span><span class="op" id="5983463">(</span><span class="op" id="5983464">*</span><span class="ident" id="5983465">ast</span><span class="op" id="5983468">.</span><span class="ident" id="5983469">Ellipsis</span><span class="op" id="5983477">)</span><span class="op" id="5983478">;</span>&nbsp;<span class="ident" id="5983480">isEllipsis</span>&nbsp;<span class="op" id="5983491">{</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983496">p</span><span class="op" id="5983497">.</span><span class="builtintype" id="5983498">error</span><span class="op" id="5983503">(</span><span class="builtinfunc" id="5983504">len</span><span class="op" id="5983507">.</span><span class="ident" id="5983508">Pos</span><span class="op" id="5983511">(</span><span class="op" id="5983512">)</span><span class="op" id="5983513">,</span>&nbsp;<span class="string" id="5983515">&#34;expected&nbsp;array&nbsp;length,&nbsp;found&nbsp;&#39;...&#39;&#34;</span><span class="op" id="5983551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983556">x</span>&nbsp;<span class="op" id="5983558">=</span>&nbsp;<span class="op" id="5983560">&amp;</span><span class="ident" id="5983561">ast</span><span class="op" id="5983564">.</span><span class="ident" id="5983565">BadExpr</span><span class="op" id="5983572">{</span><span class="ident" id="5983573">From</span><span class="op" id="5983577">:</span>&nbsp;<span class="ident" id="5983579">x</span><span class="op" id="5983580">.</span><span class="ident" id="5983581">Pos</span><span class="op" id="5983584">(</span><span class="op" id="5983585">)</span><span class="op" id="5983586">,</span>&nbsp;<span class="ident" id="5983588">To</span><span class="op" id="5983590">:</span>&nbsp;<span class="ident" id="5983592">p</span><span class="op" id="5983593">.</span><span class="ident" id="5983594">safePos</span><span class="op" id="5983601">(</span><span class="ident" id="5983602">x</span><span class="op" id="5983603">.</span><span class="ident" id="5983604">End</span><span class="op" id="5983607">(</span><span class="op" id="5983608">)</span><span class="op" id="5983609">)</span><span class="op" id="5983610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5983621">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;expressions&nbsp;or&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983666">return</span>&nbsp;<span class="ident" id="5983673">x</span><br>
<span class="lineno"></span><span class="op" id="5983675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5983678">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1435</span><span class="keyword" id="5983748">func</span>&nbsp;<span class="op" id="5983753">(</span><span class="ident" id="5983754">p</span>&nbsp;<span class="op" id="5983756">*</span><span class="ident" id="5983757">parser</span><span class="op" id="5983763">)</span>&nbsp;<span class="ident" id="5983765">parsePrimaryExpr</span><span class="op" id="5983781">(</span><span class="ident" id="5983782">lhs</span>&nbsp;<span class="builtintype" id="5983786">bool</span><span class="op" id="5983790">)</span>&nbsp;<span class="ident" id="5983792">ast</span><span class="op" id="5983795">.</span><span class="ident" id="5983796">Expr</span>&nbsp;<span class="op" id="5983801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983804">if</span>&nbsp;<span class="ident" id="5983807">p</span><span class="op" id="5983808">.</span><span class="ident" id="5983809">trace</span>&nbsp;<span class="op" id="5983815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983819">defer</span>&nbsp;<span class="ident" id="5983825">un</span><span class="op" id="5983827">(</span><span class="ident" id="5983828">trace</span><span class="op" id="5983833">(</span><span class="ident" id="5983834">p</span><span class="op" id="5983835">,</span>&nbsp;<span class="string" id="5983837">&#34;PrimaryExpr&#34;</span><span class="op" id="5983850">)</span><span class="op" id="5983851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983858">x</span>&nbsp;<span class="op" id="5983860">:=</span>&nbsp;<span class="ident" id="5983863">p</span><span class="op" id="5983864">.</span><span class="ident" id="5983865">parseOperand</span><span class="op" id="5983877">(</span><span class="ident" id="5983878">lhs</span><span class="op" id="5983881">)</span><br>
<span class="lineno"></span><span class="ident" id="5983883">L</span><span class="op" id="5983884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983887">for</span>&nbsp;<span class="op" id="5983891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983895">switch</span>&nbsp;<span class="ident" id="5983902">p</span><span class="op" id="5983903">.</span><span class="ident" id="5983904">tok</span>&nbsp;<span class="op" id="5983908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983912">case</span>&nbsp;<span class="ident" id="5983917">token</span><span class="op" id="5983922">.</span><span class="ident" id="5983923">PERIOD</span><span class="op" id="5983929">:</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983934">p</span><span class="op" id="5983935">.</span><span class="ident" id="5983936">next</span><span class="op" id="5983940">(</span><span class="op" id="5983941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983946">if</span>&nbsp;<span class="ident" id="5983949">lhs</span>&nbsp;<span class="op" id="5983953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983959">p</span><span class="op" id="5983960">.</span><span class="ident" id="5983961">resolve</span><span class="op" id="5983968">(</span><span class="ident" id="5983969">x</span><span class="op" id="5983970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983980">switch</span>&nbsp;<span class="ident" id="5983987">p</span><span class="op" id="5983988">.</span><span class="ident" id="5983989">tok</span>&nbsp;<span class="op" id="5983993">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983998">case</span>&nbsp;<span class="ident" id="5984003">token</span><span class="op" id="5984008">.</span><span class="ident" id="5984009">IDENT</span><span class="op" id="5984014">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984020">x</span>&nbsp;<span class="op" id="5984022">=</span>&nbsp;<span class="ident" id="5984024">p</span><span class="op" id="5984025">.</span><span class="ident" id="5984026">parseSelector</span><span class="op" id="5984039">(</span><span class="ident" id="5984040">p</span><span class="op" id="5984041">.</span><span class="ident" id="5984042">checkExprOrType</span><span class="op" id="5984057">(</span><span class="ident" id="5984058">x</span><span class="op" id="5984059">)</span><span class="op" id="5984060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984065">case</span>&nbsp;<span class="ident" id="5984070">token</span><span class="op" id="5984075">.</span><span class="ident" id="5984076">LPAREN</span><span class="op" id="5984082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984088">x</span>&nbsp;<span class="op" id="5984090">=</span>&nbsp;<span class="ident" id="5984092">p</span><span class="op" id="5984093">.</span><span class="ident" id="5984094">parseTypeAssertion</span><span class="op" id="5984112">(</span><span class="ident" id="5984113">p</span><span class="op" id="5984114">.</span><span class="ident" id="5984115">checkExpr</span><span class="op" id="5984124">(</span><span class="ident" id="5984125">x</span><span class="op" id="5984126">)</span><span class="op" id="5984127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984132">default</span><span class="op" id="5984139">:</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984145">pos</span>&nbsp;<span class="op" id="5984149">:=</span>&nbsp;<span class="ident" id="5984152">p</span><span class="op" id="5984153">.</span><span class="ident" id="5984154">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984162">p</span><span class="op" id="5984163">.</span><span class="ident" id="5984164">errorExpected</span><span class="op" id="5984177">(</span><span class="ident" id="5984178">pos</span><span class="op" id="5984181">,</span>&nbsp;<span class="string" id="5984183">&#34;selector&nbsp;or&nbsp;type&nbsp;assertion&#34;</span><span class="op" id="5984211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984217">p</span><span class="op" id="5984218">.</span><span class="ident" id="5984219">next</span><span class="op" id="5984223">(</span><span class="op" id="5984224">)</span>&nbsp;<span class="comment" id="5984226">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984247">x</span>&nbsp;<span class="op" id="5984249">=</span>&nbsp;<span class="op" id="5984251">&amp;</span><span class="ident" id="5984252">ast</span><span class="op" id="5984255">.</span><span class="ident" id="5984256">BadExpr</span><span class="op" id="5984263">{</span><span class="ident" id="5984264">From</span><span class="op" id="5984268">:</span>&nbsp;<span class="ident" id="5984270">pos</span><span class="op" id="5984273">,</span>&nbsp;<span class="ident" id="5984275">To</span><span class="op" id="5984277">:</span>&nbsp;<span class="ident" id="5984279">p</span><span class="op" id="5984280">.</span><span class="ident" id="5984281">pos</span><span class="op" id="5984284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984289">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984293">case</span>&nbsp;<span class="ident" id="5984298">token</span><span class="op" id="5984303">.</span><span class="ident" id="5984304">LBRACK</span><span class="op" id="5984310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984315">if</span>&nbsp;<span class="ident" id="5984318">lhs</span>&nbsp;<span class="op" id="5984322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984328">p</span><span class="op" id="5984329">.</span><span class="ident" id="5984330">resolve</span><span class="op" id="5984337">(</span><span class="ident" id="5984338">x</span><span class="op" id="5984339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984349">x</span>&nbsp;<span class="op" id="5984351">=</span>&nbsp;<span class="ident" id="5984353">p</span><span class="op" id="5984354">.</span><span class="ident" id="5984355">parseIndexOrSlice</span><span class="op" id="5984372">(</span><span class="ident" id="5984373">p</span><span class="op" id="5984374">.</span><span class="ident" id="5984375">checkExpr</span><span class="op" id="5984384">(</span><span class="ident" id="5984385">x</span><span class="op" id="5984386">)</span><span class="op" id="5984387">)</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984391">case</span>&nbsp;<span class="ident" id="5984396">token</span><span class="op" id="5984401">.</span><span class="ident" id="5984402">LPAREN</span><span class="op" id="5984408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984413">if</span>&nbsp;<span class="ident" id="5984416">lhs</span>&nbsp;<span class="op" id="5984420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984426">p</span><span class="op" id="5984427">.</span><span class="ident" id="5984428">resolve</span><span class="op" id="5984435">(</span><span class="ident" id="5984436">x</span><span class="op" id="5984437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984447">x</span>&nbsp;<span class="op" id="5984449">=</span>&nbsp;<span class="ident" id="5984451">p</span><span class="op" id="5984452">.</span><span class="ident" id="5984453">parseCallOrConversion</span><span class="op" id="5984474">(</span><span class="ident" id="5984475">p</span><span class="op" id="5984476">.</span><span class="ident" id="5984477">checkExprOrType</span><span class="op" id="5984492">(</span><span class="ident" id="5984493">x</span><span class="op" id="5984494">)</span><span class="op" id="5984495">)</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984499">case</span>&nbsp;<span class="ident" id="5984504">token</span><span class="op" id="5984509">.</span><span class="ident" id="5984510">LBRACE</span><span class="op" id="5984516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984521">if</span>&nbsp;<span class="ident" id="5984524">isLiteralType</span><span class="op" id="5984537">(</span><span class="ident" id="5984538">x</span><span class="op" id="5984539">)</span>&nbsp;<span class="op" id="5984541">&amp;&amp;</span>&nbsp;<span class="op" id="5984544">(</span><span class="ident" id="5984545">p</span><span class="op" id="5984546">.</span><span class="ident" id="5984547">exprLev</span>&nbsp;<span class="op" id="5984555">&gt;=</span>&nbsp;<span class="num" id="5984558">0</span>&nbsp;<span class="op" id="5984560">||</span>&nbsp;<span class="op" id="5984563">!</span><span class="ident" id="5984564">isTypeName</span><span class="op" id="5984574">(</span><span class="ident" id="5984575">x</span><span class="op" id="5984576">)</span><span class="op" id="5984577">)</span>&nbsp;<span class="op" id="5984579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984585">if</span>&nbsp;<span class="ident" id="5984588">lhs</span>&nbsp;<span class="op" id="5984592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984599">p</span><span class="op" id="5984600">.</span><span class="ident" id="5984601">resolve</span><span class="op" id="5984608">(</span><span class="ident" id="5984609">x</span><span class="op" id="5984610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984616">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984622">x</span>&nbsp;<span class="op" id="5984624">=</span>&nbsp;<span class="ident" id="5984626">p</span><span class="op" id="5984627">.</span><span class="ident" id="5984628">parseLiteralValue</span><span class="op" id="5984645">(</span><span class="ident" id="5984646">x</span><span class="op" id="5984647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984652">}</span>&nbsp;<span class="keyword" id="5984654">else</span>&nbsp;<span class="op" id="5984659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984665">break</span>&nbsp;<span class="ident" id="5984671">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984680">default</span><span class="op" id="5984687">:</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984692">break</span>&nbsp;<span class="ident" id="5984698">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984706">lhs</span>&nbsp;<span class="op" id="5984710">=</span>&nbsp;<span class="ident" id="5984712">false</span>&nbsp;<span class="comment" id="5984718">//&nbsp;no&nbsp;need&nbsp;to&nbsp;try&nbsp;to&nbsp;resolve&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984758">return</span>&nbsp;<span class="ident" id="5984765">x</span><br>
<span class="lineno"></span><span class="op" id="5984767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5984770">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5984840">func</span>&nbsp;<span class="op" id="5984845">(</span><span class="ident" id="5984846">p</span>&nbsp;<span class="op" id="5984848">*</span><span class="ident" id="5984849">parser</span><span class="op" id="5984855">)</span>&nbsp;<span class="ident" id="5984857">parseUnaryExpr</span><span class="op" id="5984871">(</span><span class="ident" id="5984872">lhs</span>&nbsp;<span class="builtintype" id="5984876">bool</span><span class="op" id="5984880">)</span>&nbsp;<span class="ident" id="5984882">ast</span><span class="op" id="5984885">.</span><span class="ident" id="5984886">Expr</span>&nbsp;<span class="op" id="5984891">{</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984894">if</span>&nbsp;<span class="ident" id="5984897">p</span><span class="op" id="5984898">.</span><span class="ident" id="5984899">trace</span>&nbsp;<span class="op" id="5984905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984909">defer</span>&nbsp;<span class="ident" id="5984915">un</span><span class="op" id="5984917">(</span><span class="ident" id="5984918">trace</span><span class="op" id="5984923">(</span><span class="ident" id="5984924">p</span><span class="op" id="5984925">,</span>&nbsp;<span class="string" id="5984927">&#34;UnaryExpr&#34;</span><span class="op" id="5984938">)</span><span class="op" id="5984939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984946">switch</span>&nbsp;<span class="ident" id="5984953">p</span><span class="op" id="5984954">.</span><span class="ident" id="5984955">tok</span>&nbsp;<span class="op" id="5984959">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984962">case</span>&nbsp;<span class="ident" id="5984967">token</span><span class="op" id="5984972">.</span><span class="ident" id="5984973">ADD</span><span class="op" id="5984976">,</span>&nbsp;<span class="ident" id="5984978">token</span><span class="op" id="5984983">.</span><span class="ident" id="5984984">SUB</span><span class="op" id="5984987">,</span>&nbsp;<span class="ident" id="5984989">token</span><span class="op" id="5984994">.</span><span class="ident" id="5984995">NOT</span><span class="op" id="5984998">,</span>&nbsp;<span class="ident" id="5985000">token</span><span class="op" id="5985005">.</span><span class="ident" id="5985006">XOR</span><span class="op" id="5985009">,</span>&nbsp;<span class="ident" id="5985011">token</span><span class="op" id="5985016">.</span><span class="ident" id="5985017">AND</span><span class="op" id="5985020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985024">pos</span><span class="op" id="5985027">,</span>&nbsp;<span class="ident" id="5985029">op</span>&nbsp;<span class="op" id="5985032">:=</span>&nbsp;<span class="ident" id="5985035">p</span><span class="op" id="5985036">.</span><span class="ident" id="5985037">pos</span><span class="op" id="5985040">,</span>&nbsp;<span class="ident" id="5985042">p</span><span class="op" id="5985043">.</span><span class="ident" id="5985044">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985050">p</span><span class="op" id="5985051">.</span><span class="ident" id="5985052">next</span><span class="op" id="5985056">(</span><span class="op" id="5985057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985061">x</span>&nbsp;<span class="op" id="5985063">:=</span>&nbsp;<span class="ident" id="5985066">p</span><span class="op" id="5985067">.</span><span class="ident" id="5985068">parseUnaryExpr</span><span class="op" id="5985082">(</span><span class="ident" id="5985083">false</span><span class="op" id="5985088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985092">return</span>&nbsp;<span class="op" id="5985099">&amp;</span><span class="ident" id="5985100">ast</span><span class="op" id="5985103">.</span><span class="ident" id="5985104">UnaryExpr</span><span class="op" id="5985113">{</span><span class="ident" id="5985114">OpPos</span><span class="op" id="5985119">:</span>&nbsp;<span class="ident" id="5985121">pos</span><span class="op" id="5985124">,</span>&nbsp;<span class="ident" id="5985126">Op</span><span class="op" id="5985128">:</span>&nbsp;<span class="ident" id="5985130">op</span><span class="op" id="5985132">,</span>&nbsp;<span class="ident" id="5985134">X</span><span class="op" id="5985135">:</span>&nbsp;<span class="ident" id="5985137">p</span><span class="op" id="5985138">.</span><span class="ident" id="5985139">checkExpr</span><span class="op" id="5985148">(</span><span class="ident" id="5985149">x</span><span class="op" id="5985150">)</span><span class="op" id="5985151">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985155">case</span>&nbsp;<span class="ident" id="5985160">token</span><span class="op" id="5985165">.</span><span class="ident" id="5985166">ARROW</span><span class="op" id="5985171">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985175">//&nbsp;channel&nbsp;type&nbsp;or&nbsp;receive&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985215">arrow</span>&nbsp;<span class="op" id="5985221">:=</span>&nbsp;<span class="ident" id="5985224">p</span><span class="op" id="5985225">.</span><span class="ident" id="5985226">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985232">p</span><span class="op" id="5985233">.</span><span class="ident" id="5985234">next</span><span class="op" id="5985238">(</span><span class="op" id="5985239">)</span><br>
<span class="lineno">1505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985244">//&nbsp;If&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;token.CHAN&nbsp;we&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985307">//&nbsp;is&nbsp;a&nbsp;channel&nbsp;type&nbsp;or&nbsp;a&nbsp;receive&nbsp;operation&nbsp;-&nbsp;we&nbsp;only&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985368">//&nbsp;once&nbsp;we&nbsp;have&nbsp;found&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;unary&nbsp;expression.&nbsp;There</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985431">//&nbsp;are&nbsp;two&nbsp;cases:</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985451">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985456">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;type&nbsp;&nbsp;=&gt;&nbsp;(&lt;-type)&nbsp;must&nbsp;be&nbsp;channel&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985505">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;expr&nbsp;&nbsp;=&gt;&nbsp;&lt;-(expr)&nbsp;is&nbsp;a&nbsp;receive&nbsp;from&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985565">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985570">//&nbsp;In&nbsp;the&nbsp;first&nbsp;case,&nbsp;the&nbsp;arrow&nbsp;must&nbsp;be&nbsp;re-associated&nbsp;with</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985631">//&nbsp;the&nbsp;channel&nbsp;type&nbsp;parsed&nbsp;already:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985669">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985674">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&nbsp;type)&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985717">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&lt;-&nbsp;type)&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;(&lt;-type))</span><br>
<span class="lineno"></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985765">x</span>&nbsp;<span class="op" id="5985767">:=</span>&nbsp;<span class="ident" id="5985770">p</span><span class="op" id="5985771">.</span><span class="ident" id="5985772">parseUnaryExpr</span><span class="op" id="5985786">(</span><span class="ident" id="5985787">false</span><span class="op" id="5985792">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985797">//&nbsp;determine&nbsp;which&nbsp;case&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985831">if</span>&nbsp;<span class="ident" id="5985834">typ</span><span class="op" id="5985837">,</span>&nbsp;<span class="ident" id="5985839">ok</span>&nbsp;<span class="op" id="5985842">:=</span>&nbsp;<span class="ident" id="5985845">x</span><span class="op" id="5985846">.</span><span class="op" id="5985847">(</span><span class="op" id="5985848">*</span><span class="ident" id="5985849">ast</span><span class="op" id="5985852">.</span><span class="ident" id="5985853">ChanType</span><span class="op" id="5985861">)</span><span class="op" id="5985862">;</span>&nbsp;<span class="ident" id="5985864">ok</span>&nbsp;<span class="op" id="5985867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985872">//&nbsp;(&lt;-type)</span><br>
<span class="lineno">1525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985888">//&nbsp;re-associate&nbsp;position&nbsp;info&nbsp;and&nbsp;&lt;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985928">dir</span>&nbsp;<span class="op" id="5985932">:=</span>&nbsp;<span class="ident" id="5985935">ast</span><span class="op" id="5985938">.</span><span class="ident" id="5985939">SEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985947">for</span>&nbsp;<span class="ident" id="5985951">ok</span>&nbsp;<span class="op" id="5985954">&amp;&amp;</span>&nbsp;<span class="ident" id="5985957">dir</span>&nbsp;<span class="op" id="5985961">==</span>&nbsp;<span class="ident" id="5985964">ast</span><span class="op" id="5985967">.</span><span class="ident" id="5985968">SEND</span>&nbsp;<span class="op" id="5985973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985979">if</span>&nbsp;<span class="ident" id="5985982">typ</span><span class="op" id="5985985">.</span><span class="ident" id="5985986">Dir</span>&nbsp;<span class="op" id="5985990">==</span>&nbsp;<span class="ident" id="5985993">ast</span><span class="op" id="5985996">.</span><span class="ident" id="5985997">RECV</span>&nbsp;<span class="op" id="5986002">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5986009">//&nbsp;error:&nbsp;(&lt;-type)&nbsp;is&nbsp;(&lt;-(&lt;-chan&nbsp;T))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986051">p</span><span class="op" id="5986052">.</span><span class="ident" id="5986053">errorExpected</span><span class="op" id="5986066">(</span><span class="ident" id="5986067">typ</span><span class="op" id="5986070">.</span><span class="ident" id="5986071">Arrow</span><span class="op" id="5986076">,</span>&nbsp;<span class="string" id="5986078">&#34;&#39;chan&#39;&#34;</span><span class="op" id="5986086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986098">arrow</span><span class="op" id="5986103">,</span>&nbsp;<span class="ident" id="5986105">typ</span><span class="op" id="5986108">.</span><span class="ident" id="5986109">Begin</span><span class="op" id="5986114">,</span>&nbsp;<span class="ident" id="5986116">typ</span><span class="op" id="5986119">.</span><span class="ident" id="5986120">Arrow</span>&nbsp;<span class="op" id="5986126">=</span>&nbsp;<span class="ident" id="5986128">typ</span><span class="op" id="5986131">.</span><span class="ident" id="5986132">Arrow</span><span class="op" id="5986137">,</span>&nbsp;<span class="ident" id="5986139">arrow</span><span class="op" id="5986144">,</span>&nbsp;<span class="ident" id="5986146">arrow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986156">dir</span><span class="op" id="5986159">,</span>&nbsp;<span class="ident" id="5986161">typ</span><span class="op" id="5986164">.</span><span class="ident" id="5986165">Dir</span>&nbsp;<span class="op" id="5986169">=</span>&nbsp;<span class="ident" id="5986171">typ</span><span class="op" id="5986174">.</span><span class="ident" id="5986175">Dir</span><span class="op" id="5986178">,</span>&nbsp;<span class="ident" id="5986180">ast</span><span class="op" id="5986183">.</span><span class="ident" id="5986184">RECV</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986193">typ</span><span class="op" id="5986196">,</span>&nbsp;<span class="ident" id="5986198">ok</span>&nbsp;<span class="op" id="5986201">=</span>&nbsp;<span class="ident" id="5986203">typ</span><span class="op" id="5986206">.</span><span class="ident" id="5986207">Value</span><span class="op" id="5986212">.</span><span class="op" id="5986213">(</span><span class="op" id="5986214">*</span><span class="ident" id="5986215">ast</span><span class="op" id="5986218">.</span><span class="ident" id="5986219">ChanType</span><span class="op" id="5986227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986237">if</span>&nbsp;<span class="ident" id="5986240">dir</span>&nbsp;<span class="op" id="5986244">==</span>&nbsp;<span class="ident" id="5986247">ast</span><span class="op" id="5986250">.</span><span class="ident" id="5986251">SEND</span>&nbsp;<span class="op" id="5986256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986262">p</span><span class="op" id="5986263">.</span><span class="ident" id="5986264">errorExpected</span><span class="op" id="5986277">(</span><span class="ident" id="5986278">arrow</span><span class="op" id="5986283">,</span>&nbsp;<span class="string" id="5986285">&#34;channel&nbsp;type&#34;</span><span class="op" id="5986299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986304">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986310">return</span>&nbsp;<span class="ident" id="5986317">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5986326">//&nbsp;&lt;-(expr)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986340">return</span>&nbsp;<span class="op" id="5986347">&amp;</span><span class="ident" id="5986348">ast</span><span class="op" id="5986351">.</span><span class="ident" id="5986352">UnaryExpr</span><span class="op" id="5986361">{</span><span class="ident" id="5986362">OpPos</span><span class="op" id="5986367">:</span>&nbsp;<span class="ident" id="5986369">arrow</span><span class="op" id="5986374">,</span>&nbsp;<span class="ident" id="5986376">Op</span><span class="op" id="5986378">:</span>&nbsp;<span class="ident" id="5986380">token</span><span class="op" id="5986385">.</span><span class="ident" id="5986386">ARROW</span><span class="op" id="5986391">,</span>&nbsp;<span class="ident" id="5986393">X</span><span class="op" id="5986394">:</span>&nbsp;<span class="ident" id="5986396">p</span><span class="op" id="5986397">.</span><span class="ident" id="5986398">checkExpr</span><span class="op" id="5986407">(</span><span class="ident" id="5986408">x</span><span class="op" id="5986409">)</span><span class="op" id="5986410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986414">case</span>&nbsp;<span class="ident" id="5986419">token</span><span class="op" id="5986424">.</span><span class="ident" id="5986425">MUL</span><span class="op" id="5986428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5986432">//&nbsp;pointer&nbsp;type&nbsp;or&nbsp;unary&nbsp;&#34;*&#34;&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986474">pos</span>&nbsp;<span class="op" id="5986478">:=</span>&nbsp;<span class="ident" id="5986481">p</span><span class="op" id="5986482">.</span><span class="ident" id="5986483">pos</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986489">p</span><span class="op" id="5986490">.</span><span class="ident" id="5986491">next</span><span class="op" id="5986495">(</span><span class="op" id="5986496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986500">x</span>&nbsp;<span class="op" id="5986502">:=</span>&nbsp;<span class="ident" id="5986505">p</span><span class="op" id="5986506">.</span><span class="ident" id="5986507">parseUnaryExpr</span><span class="op" id="5986521">(</span><span class="ident" id="5986522">false</span><span class="op" id="5986527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986531">return</span>&nbsp;<span class="op" id="5986538">&amp;</span><span class="ident" id="5986539">ast</span><span class="op" id="5986542">.</span><span class="ident" id="5986543">StarExpr</span><span class="op" id="5986551">{</span><span class="ident" id="5986552">Star</span><span class="op" id="5986556">:</span>&nbsp;<span class="ident" id="5986558">pos</span><span class="op" id="5986561">,</span>&nbsp;<span class="ident" id="5986563">X</span><span class="op" id="5986564">:</span>&nbsp;<span class="ident" id="5986566">p</span><span class="op" id="5986567">.</span><span class="ident" id="5986568">checkExprOrType</span><span class="op" id="5986583">(</span><span class="ident" id="5986584">x</span><span class="op" id="5986585">)</span><span class="op" id="5986586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986593">return</span>&nbsp;<span class="ident" id="5986600">p</span><span class="op" id="5986601">.</span><span class="ident" id="5986602">parsePrimaryExpr</span><span class="op" id="5986618">(</span><span class="ident" id="5986619">lhs</span><span class="op" id="5986622">)</span><br>
<span class="lineno"></span><span class="op" id="5986624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5986627">func</span>&nbsp;<span class="op" id="5986632">(</span><span class="ident" id="5986633">p</span>&nbsp;<span class="op" id="5986635">*</span><span class="ident" id="5986636">parser</span><span class="op" id="5986642">)</span>&nbsp;<span class="ident" id="5986644">tokPrec</span><span class="op" id="5986651">(</span><span class="op" id="5986652">)</span>&nbsp;<span class="op" id="5986654">(</span><span class="ident" id="5986655">token</span><span class="op" id="5986660">.</span><span class="ident" id="5986661">Token</span><span class="op" id="5986666">,</span>&nbsp;<span class="builtintype" id="5986668">int</span><span class="op" id="5986671">)</span>&nbsp;<span class="op" id="5986673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986676">tok</span>&nbsp;<span class="op" id="5986680">:=</span>&nbsp;<span class="ident" id="5986683">p</span><span class="op" id="5986684">.</span><span class="ident" id="5986685">tok</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986690">if</span>&nbsp;<span class="ident" id="5986693">p</span><span class="op" id="5986694">.</span><span class="ident" id="5986695">inRhs</span>&nbsp;<span class="op" id="5986701">&amp;&amp;</span>&nbsp;<span class="ident" id="5986704">tok</span>&nbsp;<span class="op" id="5986708">==</span>&nbsp;<span class="ident" id="5986711">token</span><span class="op" id="5986716">.</span><span class="ident" id="5986717">ASSIGN</span>&nbsp;<span class="op" id="5986724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986728">tok</span>&nbsp;<span class="op" id="5986732">=</span>&nbsp;<span class="ident" id="5986734">token</span><span class="op" id="5986739">.</span><span class="ident" id="5986740">EQL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986748">return</span>&nbsp;<span class="ident" id="5986755">tok</span><span class="op" id="5986758">,</span>&nbsp;<span class="ident" id="5986760">tok</span><span class="op" id="5986763">.</span><span class="ident" id="5986764">Precedence</span><span class="op" id="5986774">(</span><span class="op" id="5986775">)</span><br>
<span class="lineno"></span><span class="op" id="5986777">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="comment" id="5986780">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5986850">func</span>&nbsp;<span class="op" id="5986855">(</span><span class="ident" id="5986856">p</span>&nbsp;<span class="op" id="5986858">*</span><span class="ident" id="5986859">parser</span><span class="op" id="5986865">)</span>&nbsp;<span class="ident" id="5986867">parseBinaryExpr</span><span class="op" id="5986882">(</span><span class="ident" id="5986883">lhs</span>&nbsp;<span class="builtintype" id="5986887">bool</span><span class="op" id="5986891">,</span>&nbsp;<span class="ident" id="5986893">prec1</span>&nbsp;<span class="builtintype" id="5986899">int</span><span class="op" id="5986902">)</span>&nbsp;<span class="ident" id="5986904">ast</span><span class="op" id="5986907">.</span><span class="ident" id="5986908">Expr</span>&nbsp;<span class="op" id="5986913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986916">if</span>&nbsp;<span class="ident" id="5986919">p</span><span class="op" id="5986920">.</span><span class="ident" id="5986921">trace</span>&nbsp;<span class="op" id="5986927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986931">defer</span>&nbsp;<span class="ident" id="5986937">un</span><span class="op" id="5986939">(</span><span class="ident" id="5986940">trace</span><span class="op" id="5986945">(</span><span class="ident" id="5986946">p</span><span class="op" id="5986947">,</span>&nbsp;<span class="string" id="5986949">&#34;BinaryExpr&#34;</span><span class="op" id="5986961">)</span><span class="op" id="5986962">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986969">x</span>&nbsp;<span class="op" id="5986971">:=</span>&nbsp;<span class="ident" id="5986974">p</span><span class="op" id="5986975">.</span><span class="ident" id="5986976">parseUnaryExpr</span><span class="op" id="5986990">(</span><span class="ident" id="5986991">lhs</span><span class="op" id="5986994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986997">for</span>&nbsp;<span class="ident" id="5987001">_</span><span class="op" id="5987002">,</span>&nbsp;<span class="ident" id="5987004">prec</span>&nbsp;<span class="op" id="5987009">:=</span>&nbsp;<span class="ident" id="5987012">p</span><span class="op" id="5987013">.</span><span class="ident" id="5987014">tokPrec</span><span class="op" id="5987021">(</span><span class="op" id="5987022">)</span><span class="op" id="5987023">;</span>&nbsp;<span class="ident" id="5987025">prec</span>&nbsp;<span class="op" id="5987030">&gt;=</span>&nbsp;<span class="ident" id="5987033">prec1</span><span class="op" id="5987038">;</span>&nbsp;<span class="ident" id="5987040">prec</span><span class="op" id="5987044">--</span>&nbsp;<span class="op" id="5987047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987051">for</span>&nbsp;<span class="op" id="5987055">{</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987060">op</span><span class="op" id="5987062">,</span>&nbsp;<span class="ident" id="5987064">oprec</span>&nbsp;<span class="op" id="5987070">:=</span>&nbsp;<span class="ident" id="5987073">p</span><span class="op" id="5987074">.</span><span class="ident" id="5987075">tokPrec</span><span class="op" id="5987082">(</span><span class="op" id="5987083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987088">if</span>&nbsp;<span class="ident" id="5987091">oprec</span>&nbsp;<span class="op" id="5987097">!=</span>&nbsp;<span class="ident" id="5987100">prec</span>&nbsp;<span class="op" id="5987105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987111">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987125">pos</span>&nbsp;<span class="op" id="5987129">:=</span>&nbsp;<span class="ident" id="5987132">p</span><span class="op" id="5987133">.</span><span class="ident" id="5987134">expect</span><span class="op" id="5987140">(</span><span class="ident" id="5987141">op</span><span class="op" id="5987143">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987148">if</span>&nbsp;<span class="ident" id="5987151">lhs</span>&nbsp;<span class="op" id="5987155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987161">p</span><span class="op" id="5987162">.</span><span class="ident" id="5987163">resolve</span><span class="op" id="5987170">(</span><span class="ident" id="5987171">x</span><span class="op" id="5987172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987178">lhs</span>&nbsp;<span class="op" id="5987182">=</span>&nbsp;<span class="ident" id="5987184">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987198">y</span>&nbsp;<span class="op" id="5987200">:=</span>&nbsp;<span class="ident" id="5987203">p</span><span class="op" id="5987204">.</span><span class="ident" id="5987205">parseBinaryExpr</span><span class="op" id="5987220">(</span><span class="ident" id="5987221">false</span><span class="op" id="5987226">,</span>&nbsp;<span class="ident" id="5987228">prec</span><span class="op" id="5987232">+</span><span class="num" id="5987233">1</span><span class="op" id="5987234">)</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987239">x</span>&nbsp;<span class="op" id="5987241">=</span>&nbsp;<span class="op" id="5987243">&amp;</span><span class="ident" id="5987244">ast</span><span class="op" id="5987247">.</span><span class="ident" id="5987248">BinaryExpr</span><span class="op" id="5987258">{</span><span class="ident" id="5987259">X</span><span class="op" id="5987260">:</span>&nbsp;<span class="ident" id="5987262">p</span><span class="op" id="5987263">.</span><span class="ident" id="5987264">checkExpr</span><span class="op" id="5987273">(</span><span class="ident" id="5987274">x</span><span class="op" id="5987275">)</span><span class="op" id="5987276">,</span>&nbsp;<span class="ident" id="5987278">OpPos</span><span class="op" id="5987283">:</span>&nbsp;<span class="ident" id="5987285">pos</span><span class="op" id="5987288">,</span>&nbsp;<span class="ident" id="5987290">Op</span><span class="op" id="5987292">:</span>&nbsp;<span class="ident" id="5987294">op</span><span class="op" id="5987296">,</span>&nbsp;<span class="ident" id="5987298">Y</span><span class="op" id="5987299">:</span>&nbsp;<span class="ident" id="5987301">p</span><span class="op" id="5987302">.</span><span class="ident" id="5987303">checkExpr</span><span class="op" id="5987312">(</span><span class="ident" id="5987313">y</span><span class="op" id="5987314">)</span><span class="op" id="5987315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987326">return</span>&nbsp;<span class="ident" id="5987333">x</span><br>
<span class="lineno">1590</span><span class="op" id="5987335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5987338">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="comment" id="5987408">//&nbsp;The&nbsp;result&nbsp;may&nbsp;be&nbsp;a&nbsp;type&nbsp;or&nbsp;even&nbsp;a&nbsp;raw&nbsp;type&nbsp;([...]int).&nbsp;Callers&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5987480">//&nbsp;check&nbsp;the&nbsp;result&nbsp;(using&nbsp;checkExpr&nbsp;or&nbsp;checkExprOrType),&nbsp;depending&nbsp;on</span><br>
<span class="lineno">1595</span><span class="comment" id="5987551">//&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="5987563">func</span>&nbsp;<span class="op" id="5987568">(</span><span class="ident" id="5987569">p</span>&nbsp;<span class="op" id="5987571">*</span><span class="ident" id="5987572">parser</span><span class="op" id="5987578">)</span>&nbsp;<span class="ident" id="5987580">parseExpr</span><span class="op" id="5987589">(</span><span class="ident" id="5987590">lhs</span>&nbsp;<span class="builtintype" id="5987594">bool</span><span class="op" id="5987598">)</span>&nbsp;<span class="ident" id="5987600">ast</span><span class="op" id="5987603">.</span><span class="ident" id="5987604">Expr</span>&nbsp;<span class="op" id="5987609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987612">if</span>&nbsp;<span class="ident" id="5987615">p</span><span class="op" id="5987616">.</span><span class="ident" id="5987617">trace</span>&nbsp;<span class="op" id="5987623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987627">defer</span>&nbsp;<span class="ident" id="5987633">un</span><span class="op" id="5987635">(</span><span class="ident" id="5987636">trace</span><span class="op" id="5987641">(</span><span class="ident" id="5987642">p</span><span class="op" id="5987643">,</span>&nbsp;<span class="string" id="5987645">&#34;Expression&#34;</span><span class="op" id="5987657">)</span><span class="op" id="5987658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987661">}</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987665">return</span>&nbsp;<span class="ident" id="5987672">p</span><span class="op" id="5987673">.</span><span class="ident" id="5987674">parseBinaryExpr</span><span class="op" id="5987689">(</span><span class="ident" id="5987690">lhs</span><span class="op" id="5987693">,</span>&nbsp;<span class="ident" id="5987695">token</span><span class="op" id="5987700">.</span><span class="ident" id="5987701">LowestPrec</span><span class="op" id="5987711">+</span><span class="num" id="5987712">1</span><span class="op" id="5987713">)</span><br>
<span class="lineno"></span><span class="op" id="5987715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5987718">func</span>&nbsp;<span class="op" id="5987723">(</span><span class="ident" id="5987724">p</span>&nbsp;<span class="op" id="5987726">*</span><span class="ident" id="5987727">parser</span><span class="op" id="5987733">)</span>&nbsp;<span class="ident" id="5987735">parseRhs</span><span class="op" id="5987743">(</span><span class="op" id="5987744">)</span>&nbsp;<span class="ident" id="5987746">ast</span><span class="op" id="5987749">.</span><span class="ident" id="5987750">Expr</span>&nbsp;<span class="op" id="5987755">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987758">old</span>&nbsp;<span class="op" id="5987762">:=</span>&nbsp;<span class="ident" id="5987765">p</span><span class="op" id="5987766">.</span><span class="ident" id="5987767">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987774">p</span><span class="op" id="5987775">.</span><span class="ident" id="5987776">inRhs</span>&nbsp;<span class="op" id="5987782">=</span>&nbsp;<span class="ident" id="5987784">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987790">x</span>&nbsp;<span class="op" id="5987792">:=</span>&nbsp;<span class="ident" id="5987795">p</span><span class="op" id="5987796">.</span><span class="ident" id="5987797">checkExpr</span><span class="op" id="5987806">(</span><span class="ident" id="5987807">p</span><span class="op" id="5987808">.</span><span class="ident" id="5987809">parseExpr</span><span class="op" id="5987818">(</span><span class="ident" id="5987819">false</span><span class="op" id="5987824">)</span><span class="op" id="5987825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987828">p</span><span class="op" id="5987829">.</span><span class="ident" id="5987830">inRhs</span>&nbsp;<span class="op" id="5987836">=</span>&nbsp;<span class="ident" id="5987838">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987843">return</span>&nbsp;<span class="ident" id="5987850">x</span><br>
<span class="lineno">1610</span><span class="op" id="5987852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5987855">func</span>&nbsp;<span class="op" id="5987860">(</span><span class="ident" id="5987861">p</span>&nbsp;<span class="op" id="5987863">*</span><span class="ident" id="5987864">parser</span><span class="op" id="5987870">)</span>&nbsp;<span class="ident" id="5987872">parseRhsOrType</span><span class="op" id="5987886">(</span><span class="op" id="5987887">)</span>&nbsp;<span class="ident" id="5987889">ast</span><span class="op" id="5987892">.</span><span class="ident" id="5987893">Expr</span>&nbsp;<span class="op" id="5987898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987901">old</span>&nbsp;<span class="op" id="5987905">:=</span>&nbsp;<span class="ident" id="5987908">p</span><span class="op" id="5987909">.</span><span class="ident" id="5987910">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987917">p</span><span class="op" id="5987918">.</span><span class="ident" id="5987919">inRhs</span>&nbsp;<span class="op" id="5987925">=</span>&nbsp;<span class="ident" id="5987927">true</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987933">x</span>&nbsp;<span class="op" id="5987935">:=</span>&nbsp;<span class="ident" id="5987938">p</span><span class="op" id="5987939">.</span><span class="ident" id="5987940">checkExprOrType</span><span class="op" id="5987955">(</span><span class="ident" id="5987956">p</span><span class="op" id="5987957">.</span><span class="ident" id="5987958">parseExpr</span><span class="op" id="5987967">(</span><span class="ident" id="5987968">false</span><span class="op" id="5987973">)</span><span class="op" id="5987974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987977">p</span><span class="op" id="5987978">.</span><span class="ident" id="5987979">inRhs</span>&nbsp;<span class="op" id="5987985">=</span>&nbsp;<span class="ident" id="5987987">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987992">return</span>&nbsp;<span class="ident" id="5987999">x</span><br>
<span class="lineno"></span><span class="op" id="5988001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1620</span><span class="comment" id="5988004">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5988084">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5988099">//&nbsp;Parsing&nbsp;modes&nbsp;for&nbsp;parseSimpleStmt.</span><br>
<span class="lineno"></span><span class="keyword" id="5988137">const</span>&nbsp;<span class="op" id="5988143">(</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988146">basic</span>&nbsp;<span class="op" id="5988152">=</span>&nbsp;<span class="ident" id="5988154">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988160">labelOk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988169">rangeOk</span><br>
<span class="lineno"></span><span class="op" id="5988177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="comment" id="5988180">//&nbsp;parseSimpleStmt&nbsp;returns&nbsp;true&nbsp;as&nbsp;2nd&nbsp;result&nbsp;if&nbsp;it&nbsp;parsed&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span><span class="comment" id="5988254">//&nbsp;of&nbsp;a&nbsp;range&nbsp;clause&nbsp;(with&nbsp;mode&nbsp;==&nbsp;rangeOk).&nbsp;The&nbsp;returned&nbsp;statement&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5988328">//&nbsp;assignment&nbsp;with&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5988402">//&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;.&nbsp;No&nbsp;guarantees&nbsp;are&nbsp;given&nbsp;for&nbsp;the&nbsp;left-hand&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="5988473">func</span>&nbsp;<span class="op" id="5988478">(</span><span class="ident" id="5988479">p</span>&nbsp;<span class="op" id="5988481">*</span><span class="ident" id="5988482">parser</span><span class="op" id="5988488">)</span>&nbsp;<span class="ident" id="5988490">parseSimpleStmt</span><span class="op" id="5988505">(</span><span class="ident" id="5988506">mode</span>&nbsp;<span class="builtintype" id="5988511">int</span><span class="op" id="5988514">)</span>&nbsp;<span class="op" id="5988516">(</span><span class="ident" id="5988517">ast</span><span class="op" id="5988520">.</span><span class="ident" id="5988521">Stmt</span><span class="op" id="5988525">,</span>&nbsp;<span class="builtintype" id="5988527">bool</span><span class="op" id="5988531">)</span>&nbsp;<span class="op" id="5988533">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988536">if</span>&nbsp;<span class="ident" id="5988539">p</span><span class="op" id="5988540">.</span><span class="ident" id="5988541">trace</span>&nbsp;<span class="op" id="5988547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988551">defer</span>&nbsp;<span class="ident" id="5988557">un</span><span class="op" id="5988559">(</span><span class="ident" id="5988560">trace</span><span class="op" id="5988565">(</span><span class="ident" id="5988566">p</span><span class="op" id="5988567">,</span>&nbsp;<span class="string" id="5988569">&#34;SimpleStmt&#34;</span><span class="op" id="5988581">)</span><span class="op" id="5988582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988589">x</span>&nbsp;<span class="op" id="5988591">:=</span>&nbsp;<span class="ident" id="5988594">p</span><span class="op" id="5988595">.</span><span class="ident" id="5988596">parseLhsList</span><span class="op" id="5988608">(</span><span class="op" id="5988609">)</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988613">switch</span>&nbsp;<span class="ident" id="5988620">p</span><span class="op" id="5988621">.</span><span class="ident" id="5988622">tok</span>&nbsp;<span class="op" id="5988626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988629">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988636">token</span><span class="op" id="5988641">.</span><span class="ident" id="5988642">DEFINE</span><span class="op" id="5988648">,</span>&nbsp;<span class="ident" id="5988650">token</span><span class="op" id="5988655">.</span><span class="ident" id="5988656">ASSIGN</span><span class="op" id="5988662">,</span>&nbsp;<span class="ident" id="5988664">token</span><span class="op" id="5988669">.</span><span class="ident" id="5988670">ADD_ASSIGN</span><span class="op" id="5988680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988684">token</span><span class="op" id="5988689">.</span><span class="ident" id="5988690">SUB_ASSIGN</span><span class="op" id="5988700">,</span>&nbsp;<span class="ident" id="5988702">token</span><span class="op" id="5988707">.</span><span class="ident" id="5988708">MUL_ASSIGN</span><span class="op" id="5988718">,</span>&nbsp;<span class="ident" id="5988720">token</span><span class="op" id="5988725">.</span><span class="ident" id="5988726">QUO_ASSIGN</span><span class="op" id="5988736">,</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988740">token</span><span class="op" id="5988745">.</span><span class="ident" id="5988746">REM_ASSIGN</span><span class="op" id="5988756">,</span>&nbsp;<span class="ident" id="5988758">token</span><span class="op" id="5988763">.</span><span class="ident" id="5988764">AND_ASSIGN</span><span class="op" id="5988774">,</span>&nbsp;<span class="ident" id="5988776">token</span><span class="op" id="5988781">.</span><span class="ident" id="5988782">OR_ASSIGN</span><span class="op" id="5988791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988795">token</span><span class="op" id="5988800">.</span><span class="ident" id="5988801">XOR_ASSIGN</span><span class="op" id="5988811">,</span>&nbsp;<span class="ident" id="5988813">token</span><span class="op" id="5988818">.</span><span class="ident" id="5988819">SHL_ASSIGN</span><span class="op" id="5988829">,</span>&nbsp;<span class="ident" id="5988831">token</span><span class="op" id="5988836">.</span><span class="ident" id="5988837">SHR_ASSIGN</span><span class="op" id="5988847">,</span>&nbsp;<span class="ident" id="5988849">token</span><span class="op" id="5988854">.</span><span class="ident" id="5988855">AND_NOT_ASSIGN</span><span class="op" id="5988869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988873">//&nbsp;assignment&nbsp;statement,&nbsp;possibly&nbsp;part&nbsp;of&nbsp;a&nbsp;range&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988932">pos</span><span class="op" id="5988935">,</span>&nbsp;<span class="ident" id="5988937">tok</span>&nbsp;<span class="op" id="5988941">:=</span>&nbsp;<span class="ident" id="5988944">p</span><span class="op" id="5988945">.</span><span class="ident" id="5988946">pos</span><span class="op" id="5988949">,</span>&nbsp;<span class="ident" id="5988951">p</span><span class="op" id="5988952">.</span><span class="ident" id="5988953">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988959">p</span><span class="op" id="5988960">.</span><span class="ident" id="5988961">next</span><span class="op" id="5988965">(</span><span class="op" id="5988966">)</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988970">var</span>&nbsp;<span class="ident" id="5988974">y</span>&nbsp;<span class="op" id="5988976">[</span><span class="op" id="5988977">]</span><span class="ident" id="5988978">ast</span><span class="op" id="5988981">.</span><span class="ident" id="5988982">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988989">isRange</span>&nbsp;<span class="op" id="5988997">:=</span>&nbsp;<span class="ident" id="5989000">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989008">if</span>&nbsp;<span class="ident" id="5989011">mode</span>&nbsp;<span class="op" id="5989016">==</span>&nbsp;<span class="ident" id="5989019">rangeOk</span>&nbsp;<span class="op" id="5989027">&amp;&amp;</span>&nbsp;<span class="ident" id="5989030">p</span><span class="op" id="5989031">.</span><span class="ident" id="5989032">tok</span>&nbsp;<span class="op" id="5989036">==</span>&nbsp;<span class="ident" id="5989039">token</span><span class="op" id="5989044">.</span><span class="ident" id="5989045">RANGE</span>&nbsp;<span class="op" id="5989051">&amp;&amp;</span>&nbsp;<span class="op" id="5989054">(</span><span class="ident" id="5989055">tok</span>&nbsp;<span class="op" id="5989059">==</span>&nbsp;<span class="ident" id="5989062">token</span><span class="op" id="5989067">.</span><span class="ident" id="5989068">DEFINE</span>&nbsp;<span class="op" id="5989075">||</span>&nbsp;<span class="ident" id="5989078">tok</span>&nbsp;<span class="op" id="5989082">==</span>&nbsp;<span class="ident" id="5989085">token</span><span class="op" id="5989090">.</span><span class="ident" id="5989091">ASSIGN</span><span class="op" id="5989097">)</span>&nbsp;<span class="op" id="5989099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989104">pos</span>&nbsp;<span class="op" id="5989108">:=</span>&nbsp;<span class="ident" id="5989111">p</span><span class="op" id="5989112">.</span><span class="ident" id="5989113">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989120">p</span><span class="op" id="5989121">.</span><span class="ident" id="5989122">next</span><span class="op" id="5989126">(</span><span class="op" id="5989127">)</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989132">y</span>&nbsp;<span class="op" id="5989134">=</span>&nbsp;<span class="op" id="5989136">[</span><span class="op" id="5989137">]</span><span class="ident" id="5989138">ast</span><span class="op" id="5989141">.</span><span class="ident" id="5989142">Expr</span><span class="op" id="5989146">{</span><span class="op" id="5989147">&amp;</span><span class="ident" id="5989148">ast</span><span class="op" id="5989151">.</span><span class="ident" id="5989152">UnaryExpr</span><span class="op" id="5989161">{</span><span class="ident" id="5989162">OpPos</span><span class="op" id="5989167">:</span>&nbsp;<span class="ident" id="5989169">pos</span><span class="op" id="5989172">,</span>&nbsp;<span class="ident" id="5989174">Op</span><span class="op" id="5989176">:</span>&nbsp;<span class="ident" id="5989178">token</span><span class="op" id="5989183">.</span><span class="ident" id="5989184">RANGE</span><span class="op" id="5989189">,</span>&nbsp;<span class="ident" id="5989191">X</span><span class="op" id="5989192">:</span>&nbsp;<span class="ident" id="5989194">p</span><span class="op" id="5989195">.</span><span class="ident" id="5989196">parseRhs</span><span class="op" id="5989204">(</span><span class="op" id="5989205">)</span><span class="op" id="5989206">}</span><span class="op" id="5989207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989212">isRange</span>&nbsp;<span class="op" id="5989220">=</span>&nbsp;<span class="ident" id="5989222">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989229">}</span>&nbsp;<span class="keyword" id="5989231">else</span>&nbsp;<span class="op" id="5989236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989241">y</span>&nbsp;<span class="op" id="5989243">=</span>&nbsp;<span class="ident" id="5989245">p</span><span class="op" id="5989246">.</span><span class="ident" id="5989247">parseRhsList</span><span class="op" id="5989259">(</span><span class="op" id="5989260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989264">}</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989268">as</span>&nbsp;<span class="op" id="5989271">:=</span>&nbsp;<span class="op" id="5989274">&amp;</span><span class="ident" id="5989275">ast</span><span class="op" id="5989278">.</span><span class="ident" id="5989279">AssignStmt</span><span class="op" id="5989289">{</span><span class="ident" id="5989290">Lhs</span><span class="op" id="5989293">:</span>&nbsp;<span class="ident" id="5989295">x</span><span class="op" id="5989296">,</span>&nbsp;<span class="ident" id="5989298">TokPos</span><span class="op" id="5989304">:</span>&nbsp;<span class="ident" id="5989306">pos</span><span class="op" id="5989309">,</span>&nbsp;<span class="ident" id="5989311">Tok</span><span class="op" id="5989314">:</span>&nbsp;<span class="ident" id="5989316">tok</span><span class="op" id="5989319">,</span>&nbsp;<span class="ident" id="5989321">Rhs</span><span class="op" id="5989324">:</span>&nbsp;<span class="ident" id="5989326">y</span><span class="op" id="5989327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989331">if</span>&nbsp;<span class="ident" id="5989334">tok</span>&nbsp;<span class="op" id="5989338">==</span>&nbsp;<span class="ident" id="5989341">token</span><span class="op" id="5989346">.</span><span class="ident" id="5989347">DEFINE</span>&nbsp;<span class="op" id="5989354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989359">p</span><span class="op" id="5989360">.</span><span class="ident" id="5989361">shortVarDecl</span><span class="op" id="5989373">(</span><span class="ident" id="5989374">as</span><span class="op" id="5989376">,</span>&nbsp;<span class="ident" id="5989378">x</span><span class="op" id="5989379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989387">return</span>&nbsp;<span class="ident" id="5989394">as</span><span class="op" id="5989396">,</span>&nbsp;<span class="ident" id="5989398">isRange</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989411">if</span>&nbsp;<span class="builtinfunc" id="5989414">len</span><span class="op" id="5989417">(</span><span class="ident" id="5989418">x</span><span class="op" id="5989419">)</span>&nbsp;<span class="op" id="5989421">&gt;</span>&nbsp;<span class="num" id="5989423">1</span>&nbsp;<span class="op" id="5989425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989429">p</span><span class="op" id="5989430">.</span><span class="ident" id="5989431">errorExpected</span><span class="op" id="5989444">(</span><span class="ident" id="5989445">x</span><span class="op" id="5989446">[</span><span class="num" id="5989447">0</span><span class="op" id="5989448">]</span><span class="op" id="5989449">.</span><span class="ident" id="5989450">Pos</span><span class="op" id="5989453">(</span><span class="op" id="5989454">)</span><span class="op" id="5989455">,</span>&nbsp;<span class="string" id="5989457">&#34;1&nbsp;expression&#34;</span><span class="op" id="5989471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989475">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989514">switch</span>&nbsp;<span class="ident" id="5989521">p</span><span class="op" id="5989522">.</span><span class="ident" id="5989523">tok</span>&nbsp;<span class="op" id="5989527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989530">case</span>&nbsp;<span class="ident" id="5989535">token</span><span class="op" id="5989540">.</span><span class="ident" id="5989541">COLON</span><span class="op" id="5989546">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989550">//&nbsp;labeled&nbsp;statement</span><br>
<span class="lineno">1675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989573">colon</span>&nbsp;<span class="op" id="5989579">:=</span>&nbsp;<span class="ident" id="5989582">p</span><span class="op" id="5989583">.</span><span class="ident" id="5989584">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989590">p</span><span class="op" id="5989591">.</span><span class="ident" id="5989592">next</span><span class="op" id="5989596">(</span><span class="op" id="5989597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989601">if</span>&nbsp;<span class="ident" id="5989604">label</span><span class="op" id="5989609">,</span>&nbsp;<span class="ident" id="5989611">isIdent</span>&nbsp;<span class="op" id="5989619">:=</span>&nbsp;<span class="ident" id="5989622">x</span><span class="op" id="5989623">[</span><span class="num" id="5989624">0</span><span class="op" id="5989625">]</span><span class="op" id="5989626">.</span><span class="op" id="5989627">(</span><span class="op" id="5989628">*</span><span class="ident" id="5989629">ast</span><span class="op" id="5989632">.</span><span class="ident" id="5989633">Ident</span><span class="op" id="5989638">)</span><span class="op" id="5989639">;</span>&nbsp;<span class="ident" id="5989641">mode</span>&nbsp;<span class="op" id="5989646">==</span>&nbsp;<span class="ident" id="5989649">labelOk</span>&nbsp;<span class="op" id="5989657">&amp;&amp;</span>&nbsp;<span class="ident" id="5989660">isIdent</span>&nbsp;<span class="op" id="5989668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989673">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;label&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989737">//&nbsp;in&nbsp;which&nbsp;it&nbsp;is&nbsp;declared&nbsp;and&nbsp;excludes&nbsp;the&nbsp;body&nbsp;of&nbsp;any&nbsp;nested</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989803">//&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989819">stmt</span>&nbsp;<span class="op" id="5989824">:=</span>&nbsp;<span class="op" id="5989827">&amp;</span><span class="ident" id="5989828">ast</span><span class="op" id="5989831">.</span><span class="ident" id="5989832">LabeledStmt</span><span class="op" id="5989843">{</span><span class="ident" id="5989844">Label</span><span class="op" id="5989849">:</span>&nbsp;<span class="ident" id="5989851">label</span><span class="op" id="5989856">,</span>&nbsp;<span class="ident" id="5989858">Colon</span><span class="op" id="5989863">:</span>&nbsp;<span class="ident" id="5989865">colon</span><span class="op" id="5989870">,</span>&nbsp;<span class="ident" id="5989872">Stmt</span><span class="op" id="5989876">:</span>&nbsp;<span class="ident" id="5989878">p</span><span class="op" id="5989879">.</span><span class="ident" id="5989880">parseStmt</span><span class="op" id="5989889">(</span><span class="op" id="5989890">)</span><span class="op" id="5989891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989896">p</span><span class="op" id="5989897">.</span><span class="ident" id="5989898">declare</span><span class="op" id="5989905">(</span><span class="ident" id="5989906">stmt</span><span class="op" id="5989910">,</span>&nbsp;<span class="ident" id="5989912">nil</span><span class="op" id="5989915">,</span>&nbsp;<span class="ident" id="5989917">p</span><span class="op" id="5989918">.</span><span class="ident" id="5989919">labelScope</span><span class="op" id="5989929">,</span>&nbsp;<span class="ident" id="5989931">ast</span><span class="op" id="5989934">.</span><span class="ident" id="5989935">Lbl</span><span class="op" id="5989938">,</span>&nbsp;<span class="ident" id="5989940">label</span><span class="op" id="5989945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989950">return</span>&nbsp;<span class="ident" id="5989957">stmt</span><span class="op" id="5989961">,</span>&nbsp;<span class="ident" id="5989963">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989971">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989975">//&nbsp;The&nbsp;label&nbsp;declaration&nbsp;typically&nbsp;starts&nbsp;at&nbsp;x[0].Pos(),&nbsp;but&nbsp;the&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990048">//&nbsp;declaration&nbsp;may&nbsp;be&nbsp;erroneous&nbsp;due&nbsp;to&nbsp;a&nbsp;token&nbsp;after&nbsp;that&nbsp;position&nbsp;(and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990122">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;).&nbsp;If&nbsp;SpuriousErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;the&nbsp;(only)&nbsp;error&nbsp;re-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990195">//&nbsp;ported&nbsp;for&nbsp;the&nbsp;line&nbsp;is&nbsp;the&nbsp;illegal&nbsp;label&nbsp;error&nbsp;instead&nbsp;of&nbsp;the&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990268">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;&nbsp;that&nbsp;caused&nbsp;the&nbsp;problem.&nbsp;Thus,&nbsp;use&nbsp;the&nbsp;(latest)&nbsp;colon</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990342">//&nbsp;position&nbsp;for&nbsp;error&nbsp;reporting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990377">p</span><span class="op" id="5990378">.</span><span class="builtintype" id="5990379">error</span><span class="op" id="5990384">(</span><span class="ident" id="5990385">colon</span><span class="op" id="5990390">,</span>&nbsp;<span class="string" id="5990392">&#34;illegal&nbsp;label&nbsp;declaration&#34;</span><span class="op" id="5990419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990423">return</span>&nbsp;<span class="op" id="5990430">&amp;</span><span class="ident" id="5990431">ast</span><span class="op" id="5990434">.</span><span class="ident" id="5990435">BadStmt</span><span class="op" id="5990442">{</span><span class="ident" id="5990443">From</span><span class="op" id="5990447">:</span>&nbsp;<span class="ident" id="5990449">x</span><span class="op" id="5990450">[</span><span class="num" id="5990451">0</span><span class="op" id="5990452">]</span><span class="op" id="5990453">.</span><span class="ident" id="5990454">Pos</span><span class="op" id="5990457">(</span><span class="op" id="5990458">)</span><span class="op" id="5990459">,</span>&nbsp;<span class="ident" id="5990461">To</span><span class="op" id="5990463">:</span>&nbsp;<span class="ident" id="5990465">colon</span>&nbsp;<span class="op" id="5990471">+</span>&nbsp;<span class="num" id="5990473">1</span><span class="op" id="5990474">}</span><span class="op" id="5990475">,</span>&nbsp;<span class="ident" id="5990477">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990485">case</span>&nbsp;<span class="ident" id="5990490">token</span><span class="op" id="5990495">.</span><span class="ident" id="5990496">ARROW</span><span class="op" id="5990501">:</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990505">//&nbsp;send&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990525">arrow</span>&nbsp;<span class="op" id="5990531">:=</span>&nbsp;<span class="ident" id="5990534">p</span><span class="op" id="5990535">.</span><span class="ident" id="5990536">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990542">p</span><span class="op" id="5990543">.</span><span class="ident" id="5990544">next</span><span class="op" id="5990548">(</span><span class="op" id="5990549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990553">y</span>&nbsp;<span class="op" id="5990555">:=</span>&nbsp;<span class="ident" id="5990558">p</span><span class="op" id="5990559">.</span><span class="ident" id="5990560">parseRhs</span><span class="op" id="5990568">(</span><span class="op" id="5990569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990573">return</span>&nbsp;<span class="op" id="5990580">&amp;</span><span class="ident" id="5990581">ast</span><span class="op" id="5990584">.</span><span class="ident" id="5990585">SendStmt</span><span class="op" id="5990593">{</span><span class="ident" id="5990594">Chan</span><span class="op" id="5990598">:</span>&nbsp;<span class="ident" id="5990600">x</span><span class="op" id="5990601">[</span><span class="num" id="5990602">0</span><span class="op" id="5990603">]</span><span class="op" id="5990604">,</span>&nbsp;<span class="ident" id="5990606">Arrow</span><span class="op" id="5990611">:</span>&nbsp;<span class="ident" id="5990613">arrow</span><span class="op" id="5990618">,</span>&nbsp;<span class="ident" id="5990620">Value</span><span class="op" id="5990625">:</span>&nbsp;<span class="ident" id="5990627">y</span><span class="op" id="5990628">}</span><span class="op" id="5990629">,</span>&nbsp;<span class="ident" id="5990631">false</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990639">case</span>&nbsp;<span class="ident" id="5990644">token</span><span class="op" id="5990649">.</span><span class="ident" id="5990650">INC</span><span class="op" id="5990653">,</span>&nbsp;<span class="ident" id="5990655">token</span><span class="op" id="5990660">.</span><span class="ident" id="5990661">DEC</span><span class="op" id="5990664">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990668">//&nbsp;increment&nbsp;or&nbsp;decrement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990696">s</span>&nbsp;<span class="op" id="5990698">:=</span>&nbsp;<span class="op" id="5990701">&amp;</span><span class="ident" id="5990702">ast</span><span class="op" id="5990705">.</span><span class="ident" id="5990706">IncDecStmt</span><span class="op" id="5990716">{</span><span class="ident" id="5990717">X</span><span class="op" id="5990718">:</span>&nbsp;<span class="ident" id="5990720">x</span><span class="op" id="5990721">[</span><span class="num" id="5990722">0</span><span class="op" id="5990723">]</span><span class="op" id="5990724">,</span>&nbsp;<span class="ident" id="5990726">TokPos</span><span class="op" id="5990732">:</span>&nbsp;<span class="ident" id="5990734">p</span><span class="op" id="5990735">.</span><span class="ident" id="5990736">pos</span><span class="op" id="5990739">,</span>&nbsp;<span class="ident" id="5990741">Tok</span><span class="op" id="5990744">:</span>&nbsp;<span class="ident" id="5990746">p</span><span class="op" id="5990747">.</span><span class="ident" id="5990748">tok</span><span class="op" id="5990751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990755">p</span><span class="op" id="5990756">.</span><span class="ident" id="5990757">next</span><span class="op" id="5990761">(</span><span class="op" id="5990762">)</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990766">return</span>&nbsp;<span class="ident" id="5990773">s</span><span class="op" id="5990774">,</span>&nbsp;<span class="ident" id="5990776">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990787">//&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990802">return</span>&nbsp;<span class="op" id="5990809">&amp;</span><span class="ident" id="5990810">ast</span><span class="op" id="5990813">.</span><span class="ident" id="5990814">ExprStmt</span><span class="op" id="5990822">{</span><span class="ident" id="5990823">X</span><span class="op" id="5990824">:</span>&nbsp;<span class="ident" id="5990826">x</span><span class="op" id="5990827">[</span><span class="num" id="5990828">0</span><span class="op" id="5990829">]</span><span class="op" id="5990830">}</span><span class="op" id="5990831">,</span>&nbsp;<span class="ident" id="5990833">false</span><br>
<span class="lineno">1710</span><span class="op" id="5990839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5990842">func</span>&nbsp;<span class="op" id="5990847">(</span><span class="ident" id="5990848">p</span>&nbsp;<span class="op" id="5990850">*</span><span class="ident" id="5990851">parser</span><span class="op" id="5990857">)</span>&nbsp;<span class="ident" id="5990859">parseCallExpr</span><span class="op" id="5990872">(</span><span class="ident" id="5990873">callType</span>&nbsp;<span class="builtintype" id="5990882">string</span><span class="op" id="5990888">)</span>&nbsp;<span class="op" id="5990890">*</span><span class="ident" id="5990891">ast</span><span class="op" id="5990894">.</span><span class="ident" id="5990895">CallExpr</span>&nbsp;<span class="op" id="5990904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990907">x</span>&nbsp;<span class="op" id="5990909">:=</span>&nbsp;<span class="ident" id="5990912">p</span><span class="op" id="5990913">.</span><span class="ident" id="5990914">parseRhsOrType</span><span class="op" id="5990928">(</span><span class="op" id="5990929">)</span>&nbsp;<span class="comment" id="5990931">//&nbsp;could&nbsp;be&nbsp;a&nbsp;conversion:&nbsp;(some&nbsp;type)(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990973">if</span>&nbsp;<span class="ident" id="5990976">call</span><span class="op" id="5990980">,</span>&nbsp;<span class="ident" id="5990982">isCall</span>&nbsp;<span class="op" id="5990989">:=</span>&nbsp;<span class="ident" id="5990992">x</span><span class="op" id="5990993">.</span><span class="op" id="5990994">(</span><span class="op" id="5990995">*</span><span class="ident" id="5990996">ast</span><span class="op" id="5990999">.</span><span class="ident" id="5991000">CallExpr</span><span class="op" id="5991008">)</span><span class="op" id="5991009">;</span>&nbsp;<span class="ident" id="5991011">isCall</span>&nbsp;<span class="op" id="5991018">{</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991022">return</span>&nbsp;<span class="ident" id="5991029">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991038">if</span>&nbsp;<span class="ident" id="5991041">_</span><span class="op" id="5991042">,</span>&nbsp;<span class="ident" id="5991044">isBad</span>&nbsp;<span class="op" id="5991050">:=</span>&nbsp;<span class="ident" id="5991053">x</span><span class="op" id="5991054">.</span><span class="op" id="5991055">(</span><span class="op" id="5991056">*</span><span class="ident" id="5991057">ast</span><span class="op" id="5991060">.</span><span class="ident" id="5991061">BadExpr</span><span class="op" id="5991068">)</span><span class="op" id="5991069">;</span>&nbsp;<span class="op" id="5991071">!</span><span class="ident" id="5991072">isBad</span>&nbsp;<span class="op" id="5991078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991082">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991123">p</span><span class="op" id="5991124">.</span><span class="builtintype" id="5991125">error</span><span class="op" id="5991130">(</span><span class="ident" id="5991131">p</span><span class="op" id="5991132">.</span><span class="ident" id="5991133">safePos</span><span class="op" id="5991140">(</span><span class="ident" id="5991141">x</span><span class="op" id="5991142">.</span><span class="ident" id="5991143">End</span><span class="op" id="5991146">(</span><span class="op" id="5991147">)</span><span class="op" id="5991148">)</span><span class="op" id="5991149">,</span>&nbsp;<span class="ident" id="5991151">fmt</span><span class="op" id="5991154">.</span><span class="ident" id="5991155">Sprintf</span><span class="op" id="5991162">(</span><span class="string" id="5991163">&#34;function&nbsp;must&nbsp;be&nbsp;invoked&nbsp;in&nbsp;%s&nbsp;statement&#34;</span><span class="op" id="5991205">,</span>&nbsp;<span class="ident" id="5991207">callType</span><span class="op" id="5991215">)</span><span class="op" id="5991216">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991222">return</span>&nbsp;<span class="ident" id="5991229">nil</span><br>
<span class="lineno"></span><span class="op" id="5991233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5991236">func</span>&nbsp;<span class="op" id="5991241">(</span><span class="ident" id="5991242">p</span>&nbsp;<span class="op" id="5991244">*</span><span class="ident" id="5991245">parser</span><span class="op" id="5991251">)</span>&nbsp;<span class="ident" id="5991253">parseGoStmt</span><span class="op" id="5991264">(</span><span class="op" id="5991265">)</span>&nbsp;<span class="ident" id="5991267">ast</span><span class="op" id="5991270">.</span><span class="ident" id="5991271">Stmt</span>&nbsp;<span class="op" id="5991276">{</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991279">if</span>&nbsp;<span class="ident" id="5991282">p</span><span class="op" id="5991283">.</span><span class="ident" id="5991284">trace</span>&nbsp;<span class="op" id="5991290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991294">defer</span>&nbsp;<span class="ident" id="5991300">un</span><span class="op" id="5991302">(</span><span class="ident" id="5991303">trace</span><span class="op" id="5991308">(</span><span class="ident" id="5991309">p</span><span class="op" id="5991310">,</span>&nbsp;<span class="string" id="5991312">&#34;GoStmt&#34;</span><span class="op" id="5991320">)</span><span class="op" id="5991321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991328">pos</span>&nbsp;<span class="op" id="5991332">:=</span>&nbsp;<span class="ident" id="5991335">p</span><span class="op" id="5991336">.</span><span class="ident" id="5991337">expect</span><span class="op" id="5991343">(</span><span class="ident" id="5991344">token</span><span class="op" id="5991349">.</span><span class="ident" id="5991350">GO</span><span class="op" id="5991352">)</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991355">call</span>&nbsp;<span class="op" id="5991360">:=</span>&nbsp;<span class="ident" id="5991363">p</span><span class="op" id="5991364">.</span><span class="ident" id="5991365">parseCallExpr</span><span class="op" id="5991378">(</span><span class="string" id="5991379">&#34;go&#34;</span><span class="op" id="5991383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991386">p</span><span class="op" id="5991387">.</span><span class="ident" id="5991388">expectSemi</span><span class="op" id="5991398">(</span><span class="op" id="5991399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991402">if</span>&nbsp;<span class="ident" id="5991405">call</span>&nbsp;<span class="op" id="5991410">==</span>&nbsp;<span class="ident" id="5991413">nil</span>&nbsp;<span class="op" id="5991417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991421">return</span>&nbsp;<span class="op" id="5991428">&amp;</span><span class="ident" id="5991429">ast</span><span class="op" id="5991432">.</span><span class="ident" id="5991433">BadStmt</span><span class="op" id="5991440">{</span><span class="ident" id="5991441">From</span><span class="op" id="5991445">:</span>&nbsp;<span class="ident" id="5991447">pos</span><span class="op" id="5991450">,</span>&nbsp;<span class="ident" id="5991452">To</span><span class="op" id="5991454">:</span>&nbsp;<span class="ident" id="5991456">pos</span>&nbsp;<span class="op" id="5991460">+</span>&nbsp;<span class="num" id="5991462">2</span><span class="op" id="5991463">}</span>&nbsp;<span class="comment" id="5991465">//&nbsp;len(&#34;go&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991479">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991483">return</span>&nbsp;<span class="op" id="5991490">&amp;</span><span class="ident" id="5991491">ast</span><span class="op" id="5991494">.</span><span class="ident" id="5991495">GoStmt</span><span class="op" id="5991501">{</span><span class="ident" id="5991502">Go</span><span class="op" id="5991504">:</span>&nbsp;<span class="ident" id="5991506">pos</span><span class="op" id="5991509">,</span>&nbsp;<span class="ident" id="5991511">Call</span><span class="op" id="5991515">:</span>&nbsp;<span class="ident" id="5991517">call</span><span class="op" id="5991521">}</span><br>
<span class="lineno"></span><span class="op" id="5991523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5991526">func</span>&nbsp;<span class="op" id="5991531">(</span><span class="ident" id="5991532">p</span>&nbsp;<span class="op" id="5991534">*</span><span class="ident" id="5991535">parser</span><span class="op" id="5991541">)</span>&nbsp;<span class="ident" id="5991543">parseDeferStmt</span><span class="op" id="5991557">(</span><span class="op" id="5991558">)</span>&nbsp;<span class="ident" id="5991560">ast</span><span class="op" id="5991563">.</span><span class="ident" id="5991564">Stmt</span>&nbsp;<span class="op" id="5991569">{</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991572">if</span>&nbsp;<span class="ident" id="5991575">p</span><span class="op" id="5991576">.</span><span class="ident" id="5991577">trace</span>&nbsp;<span class="op" id="5991583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991587">defer</span>&nbsp;<span class="ident" id="5991593">un</span><span class="op" id="5991595">(</span><span class="ident" id="5991596">trace</span><span class="op" id="5991601">(</span><span class="ident" id="5991602">p</span><span class="op" id="5991603">,</span>&nbsp;<span class="string" id="5991605">&#34;DeferStmt&#34;</span><span class="op" id="5991616">)</span><span class="op" id="5991617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991624">pos</span>&nbsp;<span class="op" id="5991628">:=</span>&nbsp;<span class="ident" id="5991631">p</span><span class="op" id="5991632">.</span><span class="ident" id="5991633">expect</span><span class="op" id="5991639">(</span><span class="ident" id="5991640">token</span><span class="op" id="5991645">.</span><span class="ident" id="5991646">DEFER</span><span class="op" id="5991651">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991654">call</span>&nbsp;<span class="op" id="5991659">:=</span>&nbsp;<span class="ident" id="5991662">p</span><span class="op" id="5991663">.</span><span class="ident" id="5991664">parseCallExpr</span><span class="op" id="5991677">(</span><span class="string" id="5991678">&#34;defer&#34;</span><span class="op" id="5991685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991688">p</span><span class="op" id="5991689">.</span><span class="ident" id="5991690">expectSemi</span><span class="op" id="5991700">(</span><span class="op" id="5991701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991704">if</span>&nbsp;<span class="ident" id="5991707">call</span>&nbsp;<span class="op" id="5991712">==</span>&nbsp;<span class="ident" id="5991715">nil</span>&nbsp;<span class="op" id="5991719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991723">return</span>&nbsp;<span class="op" id="5991730">&amp;</span><span class="ident" id="5991731">ast</span><span class="op" id="5991734">.</span><span class="ident" id="5991735">BadStmt</span><span class="op" id="5991742">{</span><span class="ident" id="5991743">From</span><span class="op" id="5991747">:</span>&nbsp;<span class="ident" id="5991749">pos</span><span class="op" id="5991752">,</span>&nbsp;<span class="ident" id="5991754">To</span><span class="op" id="5991756">:</span>&nbsp;<span class="ident" id="5991758">pos</span>&nbsp;<span class="op" id="5991762">+</span>&nbsp;<span class="num" id="5991764">5</span><span class="op" id="5991765">}</span>&nbsp;<span class="comment" id="5991767">//&nbsp;len(&#34;defer&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991784">}</span><br>
<span class="lineno">1750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991788">return</span>&nbsp;<span class="op" id="5991795">&amp;</span><span class="ident" id="5991796">ast</span><span class="op" id="5991799">.</span><span class="ident" id="5991800">DeferStmt</span><span class="op" id="5991809">{</span><span class="ident" id="5991810">Defer</span><span class="op" id="5991815">:</span>&nbsp;<span class="ident" id="5991817">pos</span><span class="op" id="5991820">,</span>&nbsp;<span class="ident" id="5991822">Call</span><span class="op" id="5991826">:</span>&nbsp;<span class="ident" id="5991828">call</span><span class="op" id="5991832">}</span><br>
<span class="lineno"></span><span class="op" id="5991834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5991837">func</span>&nbsp;<span class="op" id="5991842">(</span><span class="ident" id="5991843">p</span>&nbsp;<span class="op" id="5991845">*</span><span class="ident" id="5991846">parser</span><span class="op" id="5991852">)</span>&nbsp;<span class="ident" id="5991854">parseReturnStmt</span><span class="op" id="5991869">(</span><span class="op" id="5991870">)</span>&nbsp;<span class="op" id="5991872">*</span><span class="ident" id="5991873">ast</span><span class="op" id="5991876">.</span><span class="ident" id="5991877">ReturnStmt</span>&nbsp;<span class="op" id="5991888">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991891">if</span>&nbsp;<span class="ident" id="5991894">p</span><span class="op" id="5991895">.</span><span class="ident" id="5991896">trace</span>&nbsp;<span class="op" id="5991902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991906">defer</span>&nbsp;<span class="ident" id="5991912">un</span><span class="op" id="5991914">(</span><span class="ident" id="5991915">trace</span><span class="op" id="5991920">(</span><span class="ident" id="5991921">p</span><span class="op" id="5991922">,</span>&nbsp;<span class="string" id="5991924">&#34;ReturnStmt&#34;</span><span class="op" id="5991936">)</span><span class="op" id="5991937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991944">pos</span>&nbsp;<span class="op" id="5991948">:=</span>&nbsp;<span class="ident" id="5991951">p</span><span class="op" id="5991952">.</span><span class="ident" id="5991953">pos</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991958">p</span><span class="op" id="5991959">.</span><span class="ident" id="5991960">expect</span><span class="op" id="5991966">(</span><span class="ident" id="5991967">token</span><span class="op" id="5991972">.</span><span class="ident" id="5991973">RETURN</span><span class="op" id="5991979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991982">var</span>&nbsp;<span class="ident" id="5991986">x</span>&nbsp;<span class="op" id="5991988">[</span><span class="op" id="5991989">]</span><span class="ident" id="5991990">ast</span><span class="op" id="5991993">.</span><span class="ident" id="5991994">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992000">if</span>&nbsp;<span class="ident" id="5992003">p</span><span class="op" id="5992004">.</span><span class="ident" id="5992005">tok</span>&nbsp;<span class="op" id="5992009">!=</span>&nbsp;<span class="ident" id="5992012">token</span><span class="op" id="5992017">.</span><span class="ident" id="5992018">SEMICOLON</span>&nbsp;<span class="op" id="5992028">&amp;&amp;</span>&nbsp;<span class="ident" id="5992031">p</span><span class="op" id="5992032">.</span><span class="ident" id="5992033">tok</span>&nbsp;<span class="op" id="5992037">!=</span>&nbsp;<span class="ident" id="5992040">token</span><span class="op" id="5992045">.</span><span class="ident" id="5992046">RBRACE</span>&nbsp;<span class="op" id="5992053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992057">x</span>&nbsp;<span class="op" id="5992059">=</span>&nbsp;<span class="ident" id="5992061">p</span><span class="op" id="5992062">.</span><span class="ident" id="5992063">parseRhsList</span><span class="op" id="5992075">(</span><span class="op" id="5992076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992079">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992082">p</span><span class="op" id="5992083">.</span><span class="ident" id="5992084">expectSemi</span><span class="op" id="5992094">(</span><span class="op" id="5992095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992099">return</span>&nbsp;<span class="op" id="5992106">&amp;</span><span class="ident" id="5992107">ast</span><span class="op" id="5992110">.</span><span class="ident" id="5992111">ReturnStmt</span><span class="op" id="5992121">{</span><span class="ident" id="5992122">Return</span><span class="op" id="5992128">:</span>&nbsp;<span class="ident" id="5992130">pos</span><span class="op" id="5992133">,</span>&nbsp;<span class="ident" id="5992135">Results</span><span class="op" id="5992142">:</span>&nbsp;<span class="ident" id="5992144">x</span><span class="op" id="5992145">}</span><br>
<span class="lineno"></span><span class="op" id="5992147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1770</span><span class="keyword" id="5992150">func</span>&nbsp;<span class="op" id="5992155">(</span><span class="ident" id="5992156">p</span>&nbsp;<span class="op" id="5992158">*</span><span class="ident" id="5992159">parser</span><span class="op" id="5992165">)</span>&nbsp;<span class="ident" id="5992167">parseBranchStmt</span><span class="op" id="5992182">(</span><span class="ident" id="5992183">tok</span>&nbsp;<span class="ident" id="5992187">token</span><span class="op" id="5992192">.</span><span class="ident" id="5992193">Token</span><span class="op" id="5992198">)</span>&nbsp;<span class="op" id="5992200">*</span><span class="ident" id="5992201">ast</span><span class="op" id="5992204">.</span><span class="ident" id="5992205">BranchStmt</span>&nbsp;<span class="op" id="5992216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992219">if</span>&nbsp;<span class="ident" id="5992222">p</span><span class="op" id="5992223">.</span><span class="ident" id="5992224">trace</span>&nbsp;<span class="op" id="5992230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992234">defer</span>&nbsp;<span class="ident" id="5992240">un</span><span class="op" id="5992242">(</span><span class="ident" id="5992243">trace</span><span class="op" id="5992248">(</span><span class="ident" id="5992249">p</span><span class="op" id="5992250">,</span>&nbsp;<span class="string" id="5992252">&#34;BranchStmt&#34;</span><span class="op" id="5992264">)</span><span class="op" id="5992265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992272">pos</span>&nbsp;<span class="op" id="5992276">:=</span>&nbsp;<span class="ident" id="5992279">p</span><span class="op" id="5992280">.</span><span class="ident" id="5992281">expect</span><span class="op" id="5992287">(</span><span class="ident" id="5992288">tok</span><span class="op" id="5992291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992294">var</span>&nbsp;<span class="ident" id="5992298">label</span>&nbsp;<span class="op" id="5992304">*</span><span class="ident" id="5992305">ast</span><span class="op" id="5992308">.</span><span class="ident" id="5992309">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992316">if</span>&nbsp;<span class="ident" id="5992319">tok</span>&nbsp;<span class="op" id="5992323">!=</span>&nbsp;<span class="ident" id="5992326">token</span><span class="op" id="5992331">.</span><span class="ident" id="5992332">FALLTHROUGH</span>&nbsp;<span class="op" id="5992344">&amp;&amp;</span>&nbsp;<span class="ident" id="5992347">p</span><span class="op" id="5992348">.</span><span class="ident" id="5992349">tok</span>&nbsp;<span class="op" id="5992353">==</span>&nbsp;<span class="ident" id="5992356">token</span><span class="op" id="5992361">.</span><span class="ident" id="5992362">IDENT</span>&nbsp;<span class="op" id="5992368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992372">label</span>&nbsp;<span class="op" id="5992378">=</span>&nbsp;<span class="ident" id="5992380">p</span><span class="op" id="5992381">.</span><span class="ident" id="5992382">parseIdent</span><span class="op" id="5992392">(</span><span class="op" id="5992393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992397">//&nbsp;add&nbsp;to&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;targets</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992436">n</span>&nbsp;<span class="op" id="5992438">:=</span>&nbsp;<span class="builtinfunc" id="5992441">len</span><span class="op" id="5992444">(</span><span class="ident" id="5992445">p</span><span class="op" id="5992446">.</span><span class="ident" id="5992447">targetStack</span><span class="op" id="5992458">)</span>&nbsp;<span class="op" id="5992460">-</span>&nbsp;<span class="num" id="5992462">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992466">p</span><span class="op" id="5992467">.</span><span class="ident" id="5992468">targetStack</span><span class="op" id="5992479">[</span><span class="ident" id="5992480">n</span><span class="op" id="5992481">]</span>&nbsp;<span class="op" id="5992483">=</span>&nbsp;<span class="builtinfunc" id="5992485">append</span><span class="op" id="5992491">(</span><span class="ident" id="5992492">p</span><span class="op" id="5992493">.</span><span class="ident" id="5992494">targetStack</span><span class="op" id="5992505">[</span><span class="ident" id="5992506">n</span><span class="op" id="5992507">]</span><span class="op" id="5992508">,</span>&nbsp;<span class="ident" id="5992510">label</span><span class="op" id="5992515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992521">p</span><span class="op" id="5992522">.</span><span class="ident" id="5992523">expectSemi</span><span class="op" id="5992533">(</span><span class="op" id="5992534">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992538">return</span>&nbsp;<span class="op" id="5992545">&amp;</span><span class="ident" id="5992546">ast</span><span class="op" id="5992549">.</span><span class="ident" id="5992550">BranchStmt</span><span class="op" id="5992560">{</span><span class="ident" id="5992561">TokPos</span><span class="op" id="5992567">:</span>&nbsp;<span class="ident" id="5992569">pos</span><span class="op" id="5992572">,</span>&nbsp;<span class="ident" id="5992574">Tok</span><span class="op" id="5992577">:</span>&nbsp;<span class="ident" id="5992579">tok</span><span class="op" id="5992582">,</span>&nbsp;<span class="ident" id="5992584">Label</span><span class="op" id="5992589">:</span>&nbsp;<span class="ident" id="5992591">label</span><span class="op" id="5992596">}</span><br>
<span class="lineno"></span><span class="op" id="5992598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5992601">func</span>&nbsp;<span class="op" id="5992606">(</span><span class="ident" id="5992607">p</span>&nbsp;<span class="op" id="5992609">*</span><span class="ident" id="5992610">parser</span><span class="op" id="5992616">)</span>&nbsp;<span class="ident" id="5992618">makeExpr</span><span class="op" id="5992626">(</span><span class="ident" id="5992627">s</span>&nbsp;<span class="ident" id="5992629">ast</span><span class="op" id="5992632">.</span><span class="ident" id="5992633">Stmt</span><span class="op" id="5992637">,</span>&nbsp;<span class="ident" id="5992639">kind</span>&nbsp;<span class="builtintype" id="5992644">string</span><span class="op" id="5992650">)</span>&nbsp;<span class="ident" id="5992652">ast</span><span class="op" id="5992655">.</span><span class="ident" id="5992656">Expr</span>&nbsp;<span class="op" id="5992661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992664">if</span>&nbsp;<span class="ident" id="5992667">s</span>&nbsp;<span class="op" id="5992669">==</span>&nbsp;<span class="ident" id="5992672">nil</span>&nbsp;<span class="op" id="5992676">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992680">return</span>&nbsp;<span class="ident" id="5992687">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992695">if</span>&nbsp;<span class="ident" id="5992698">es</span><span class="op" id="5992700">,</span>&nbsp;<span class="ident" id="5992702">isExpr</span>&nbsp;<span class="op" id="5992709">:=</span>&nbsp;<span class="ident" id="5992712">s</span><span class="op" id="5992713">.</span><span class="op" id="5992714">(</span><span class="op" id="5992715">*</span><span class="ident" id="5992716">ast</span><span class="op" id="5992719">.</span><span class="ident" id="5992720">ExprStmt</span><span class="op" id="5992728">)</span><span class="op" id="5992729">;</span>&nbsp;<span class="ident" id="5992731">isExpr</span>&nbsp;<span class="op" id="5992738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992742">return</span>&nbsp;<span class="ident" id="5992749">p</span><span class="op" id="5992750">.</span><span class="ident" id="5992751">checkExpr</span><span class="op" id="5992760">(</span><span class="ident" id="5992761">es</span><span class="op" id="5992763">.</span><span class="ident" id="5992764">X</span><span class="op" id="5992765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992768">}</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992771">p</span><span class="op" id="5992772">.</span><span class="builtintype" id="5992773">error</span><span class="op" id="5992778">(</span><span class="ident" id="5992779">s</span><span class="op" id="5992780">.</span><span class="ident" id="5992781">Pos</span><span class="op" id="5992784">(</span><span class="op" id="5992785">)</span><span class="op" id="5992786">,</span>&nbsp;<span class="ident" id="5992788">fmt</span><span class="op" id="5992791">.</span><span class="ident" id="5992792">Sprintf</span><span class="op" id="5992799">(</span><span class="string" id="5992800">&#34;expected&nbsp;%s,&nbsp;found&nbsp;simple&nbsp;statement&nbsp;(missing&nbsp;parentheses&nbsp;around&nbsp;composite&nbsp;literal?)&#34;</span><span class="op" id="5992885">,</span>&nbsp;<span class="ident" id="5992887">kind</span><span class="op" id="5992891">)</span><span class="op" id="5992892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992895">return</span>&nbsp;<span class="op" id="5992902">&amp;</span><span class="ident" id="5992903">ast</span><span class="op" id="5992906">.</span><span class="ident" id="5992907">BadExpr</span><span class="op" id="5992914">{</span><span class="ident" id="5992915">From</span><span class="op" id="5992919">:</span>&nbsp;<span class="ident" id="5992921">s</span><span class="op" id="5992922">.</span><span class="ident" id="5992923">Pos</span><span class="op" id="5992926">(</span><span class="op" id="5992927">)</span><span class="op" id="5992928">,</span>&nbsp;<span class="ident" id="5992930">To</span><span class="op" id="5992932">:</span>&nbsp;<span class="ident" id="5992934">p</span><span class="op" id="5992935">.</span><span class="ident" id="5992936">safePos</span><span class="op" id="5992943">(</span><span class="ident" id="5992944">s</span><span class="op" id="5992945">.</span><span class="ident" id="5992946">End</span><span class="op" id="5992949">(</span><span class="op" id="5992950">)</span><span class="op" id="5992951">)</span><span class="op" id="5992952">}</span><br>
<span class="lineno"></span><span class="op" id="5992954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5992957">func</span>&nbsp;<span class="op" id="5992962">(</span><span class="ident" id="5992963">p</span>&nbsp;<span class="op" id="5992965">*</span><span class="ident" id="5992966">parser</span><span class="op" id="5992972">)</span>&nbsp;<span class="ident" id="5992974">parseIfStmt</span><span class="op" id="5992985">(</span><span class="op" id="5992986">)</span>&nbsp;<span class="op" id="5992988">*</span><span class="ident" id="5992989">ast</span><span class="op" id="5992992">.</span><span class="ident" id="5992993">IfStmt</span>&nbsp;<span class="op" id="5993000">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993003">if</span>&nbsp;<span class="ident" id="5993006">p</span><span class="op" id="5993007">.</span><span class="ident" id="5993008">trace</span>&nbsp;<span class="op" id="5993014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993018">defer</span>&nbsp;<span class="ident" id="5993024">un</span><span class="op" id="5993026">(</span><span class="ident" id="5993027">trace</span><span class="op" id="5993032">(</span><span class="ident" id="5993033">p</span><span class="op" id="5993034">,</span>&nbsp;<span class="string" id="5993036">&#34;IfStmt&#34;</span><span class="op" id="5993044">)</span><span class="op" id="5993045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993052">pos</span>&nbsp;<span class="op" id="5993056">:=</span>&nbsp;<span class="ident" id="5993059">p</span><span class="op" id="5993060">.</span><span class="ident" id="5993061">expect</span><span class="op" id="5993067">(</span><span class="ident" id="5993068">token</span><span class="op" id="5993073">.</span><span class="ident" id="5993074">IF</span><span class="op" id="5993076">)</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993079">p</span><span class="op" id="5993080">.</span><span class="ident" id="5993081">openScope</span><span class="op" id="5993090">(</span><span class="op" id="5993091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993094">defer</span>&nbsp;<span class="ident" id="5993100">p</span><span class="op" id="5993101">.</span><span class="ident" id="5993102">closeScope</span><span class="op" id="5993112">(</span><span class="op" id="5993113">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993117">var</span>&nbsp;<span class="ident" id="5993121">s</span>&nbsp;<span class="ident" id="5993123">ast</span><span class="op" id="5993126">.</span><span class="ident" id="5993127">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993133">var</span>&nbsp;<span class="ident" id="5993137">x</span>&nbsp;<span class="ident" id="5993139">ast</span><span class="op" id="5993142">.</span><span class="ident" id="5993143">Expr</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993153">prevLev</span>&nbsp;<span class="op" id="5993161">:=</span>&nbsp;<span class="ident" id="5993164">p</span><span class="op" id="5993165">.</span><span class="ident" id="5993166">exprLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993176">p</span><span class="op" id="5993177">.</span><span class="ident" id="5993178">exprLev</span>&nbsp;<span class="op" id="5993186">=</span>&nbsp;<span class="op" id="5993188">-</span><span class="num" id="5993189">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993193">if</span>&nbsp;<span class="ident" id="5993196">p</span><span class="op" id="5993197">.</span><span class="ident" id="5993198">tok</span>&nbsp;<span class="op" id="5993202">==</span>&nbsp;<span class="ident" id="5993205">token</span><span class="op" id="5993210">.</span><span class="ident" id="5993211">SEMICOLON</span>&nbsp;<span class="op" id="5993221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993226">p</span><span class="op" id="5993227">.</span><span class="ident" id="5993228">next</span><span class="op" id="5993232">(</span><span class="op" id="5993233">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993238">x</span>&nbsp;<span class="op" id="5993240">=</span>&nbsp;<span class="ident" id="5993242">p</span><span class="op" id="5993243">.</span><span class="ident" id="5993244">parseRhs</span><span class="op" id="5993252">(</span><span class="op" id="5993253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993257">}</span>&nbsp;<span class="keyword" id="5993259">else</span>&nbsp;<span class="op" id="5993264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993269">s</span><span class="op" id="5993270">,</span>&nbsp;<span class="ident" id="5993272">_</span>&nbsp;<span class="op" id="5993274">=</span>&nbsp;<span class="ident" id="5993276">p</span><span class="op" id="5993277">.</span><span class="ident" id="5993278">parseSimpleStmt</span><span class="op" id="5993293">(</span><span class="ident" id="5993294">basic</span><span class="op" id="5993299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993304">if</span>&nbsp;<span class="ident" id="5993307">p</span><span class="op" id="5993308">.</span><span class="ident" id="5993309">tok</span>&nbsp;<span class="op" id="5993313">==</span>&nbsp;<span class="ident" id="5993316">token</span><span class="op" id="5993321">.</span><span class="ident" id="5993322">SEMICOLON</span>&nbsp;<span class="op" id="5993332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993338">p</span><span class="op" id="5993339">.</span><span class="ident" id="5993340">next</span><span class="op" id="5993344">(</span><span class="op" id="5993345">)</span><br>
<span class="lineno">1820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993351">x</span>&nbsp;<span class="op" id="5993353">=</span>&nbsp;<span class="ident" id="5993355">p</span><span class="op" id="5993356">.</span><span class="ident" id="5993357">parseRhs</span><span class="op" id="5993365">(</span><span class="op" id="5993366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993371">}</span>&nbsp;<span class="keyword" id="5993373">else</span>&nbsp;<span class="op" id="5993378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993384">x</span>&nbsp;<span class="op" id="5993386">=</span>&nbsp;<span class="ident" id="5993388">p</span><span class="op" id="5993389">.</span><span class="ident" id="5993390">makeExpr</span><span class="op" id="5993398">(</span><span class="ident" id="5993399">s</span><span class="op" id="5993400">,</span>&nbsp;<span class="string" id="5993402">&#34;boolean&nbsp;expression&#34;</span><span class="op" id="5993422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993428">s</span>&nbsp;<span class="op" id="5993430">=</span>&nbsp;<span class="ident" id="5993432">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993439">}</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993447">p</span><span class="op" id="5993448">.</span><span class="ident" id="5993449">exprLev</span>&nbsp;<span class="op" id="5993457">=</span>&nbsp;<span class="ident" id="5993459">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993472">body</span>&nbsp;<span class="op" id="5993477">:=</span>&nbsp;<span class="ident" id="5993480">p</span><span class="op" id="5993481">.</span><span class="ident" id="5993482">parseBlockStmt</span><span class="op" id="5993496">(</span><span class="op" id="5993497">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993500">var</span>&nbsp;<span class="ident" id="5993504">else_</span>&nbsp;<span class="ident" id="5993510">ast</span><span class="op" id="5993513">.</span><span class="ident" id="5993514">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993520">if</span>&nbsp;<span class="ident" id="5993523">p</span><span class="op" id="5993524">.</span><span class="ident" id="5993525">tok</span>&nbsp;<span class="op" id="5993529">==</span>&nbsp;<span class="ident" id="5993532">token</span><span class="op" id="5993537">.</span><span class="ident" id="5993538">ELSE</span>&nbsp;<span class="op" id="5993543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993547">p</span><span class="op" id="5993548">.</span><span class="ident" id="5993549">next</span><span class="op" id="5993553">(</span><span class="op" id="5993554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993558">else_</span>&nbsp;<span class="op" id="5993564">=</span>&nbsp;<span class="ident" id="5993566">p</span><span class="op" id="5993567">.</span><span class="ident" id="5993568">parseStmt</span><span class="op" id="5993577">(</span><span class="op" id="5993578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993581">}</span>&nbsp;<span class="keyword" id="5993583">else</span>&nbsp;<span class="op" id="5993588">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993592">p</span><span class="op" id="5993593">.</span><span class="ident" id="5993594">expectSemi</span><span class="op" id="5993604">(</span><span class="op" id="5993605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993612">return</span>&nbsp;<span class="op" id="5993619">&amp;</span><span class="ident" id="5993620">ast</span><span class="op" id="5993623">.</span><span class="ident" id="5993624">IfStmt</span><span class="op" id="5993630">{</span><span class="ident" id="5993631">If</span><span class="op" id="5993633">:</span>&nbsp;<span class="ident" id="5993635">pos</span><span class="op" id="5993638">,</span>&nbsp;<span class="ident" id="5993640">Init</span><span class="op" id="5993644">:</span>&nbsp;<span class="ident" id="5993646">s</span><span class="op" id="5993647">,</span>&nbsp;<span class="ident" id="5993649">Cond</span><span class="op" id="5993653">:</span>&nbsp;<span class="ident" id="5993655">x</span><span class="op" id="5993656">,</span>&nbsp;<span class="ident" id="5993658">Body</span><span class="op" id="5993662">:</span>&nbsp;<span class="ident" id="5993664">body</span><span class="op" id="5993668">,</span>&nbsp;<span class="ident" id="5993670">Else</span><span class="op" id="5993674">:</span>&nbsp;<span class="ident" id="5993676">else_</span><span class="op" id="5993681">}</span><br>
<span class="lineno"></span><span class="op" id="5993683">}</span><br>
<span class="lineno">1840</span><br>
<span class="lineno"></span><span class="keyword" id="5993686">func</span>&nbsp;<span class="op" id="5993691">(</span><span class="ident" id="5993692">p</span>&nbsp;<span class="op" id="5993694">*</span><span class="ident" id="5993695">parser</span><span class="op" id="5993701">)</span>&nbsp;<span class="ident" id="5993703">parseTypeList</span><span class="op" id="5993716">(</span><span class="op" id="5993717">)</span>&nbsp;<span class="op" id="5993719">(</span><span class="ident" id="5993720">list</span>&nbsp;<span class="op" id="5993725">[</span><span class="op" id="5993726">]</span><span class="ident" id="5993727">ast</span><span class="op" id="5993730">.</span><span class="ident" id="5993731">Expr</span><span class="op" id="5993735">)</span>&nbsp;<span class="op" id="5993737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993740">if</span>&nbsp;<span class="ident" id="5993743">p</span><span class="op" id="5993744">.</span><span class="ident" id="5993745">trace</span>&nbsp;<span class="op" id="5993751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993755">defer</span>&nbsp;<span class="ident" id="5993761">un</span><span class="op" id="5993763">(</span><span class="ident" id="5993764">trace</span><span class="op" id="5993769">(</span><span class="ident" id="5993770">p</span><span class="op" id="5993771">,</span>&nbsp;<span class="string" id="5993773">&#34;TypeList&#34;</span><span class="op" id="5993783">)</span><span class="op" id="5993784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993787">}</span><br>
<span class="lineno">1845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993791">list</span>&nbsp;<span class="op" id="5993796">=</span>&nbsp;<span class="builtinfunc" id="5993798">append</span><span class="op" id="5993804">(</span><span class="ident" id="5993805">list</span><span class="op" id="5993809">,</span>&nbsp;<span class="ident" id="5993811">p</span><span class="op" id="5993812">.</span><span class="ident" id="5993813">parseType</span><span class="op" id="5993822">(</span><span class="op" id="5993823">)</span><span class="op" id="5993824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993827">for</span>&nbsp;<span class="ident" id="5993831">p</span><span class="op" id="5993832">.</span><span class="ident" id="5993833">tok</span>&nbsp;<span class="op" id="5993837">==</span>&nbsp;<span class="ident" id="5993840">token</span><span class="op" id="5993845">.</span><span class="ident" id="5993846">COMMA</span>&nbsp;<span class="op" id="5993852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993856">p</span><span class="op" id="5993857">.</span><span class="ident" id="5993858">next</span><span class="op" id="5993862">(</span><span class="op" id="5993863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993867">list</span>&nbsp;<span class="op" id="5993872">=</span>&nbsp;<span class="builtinfunc" id="5993874">append</span><span class="op" id="5993880">(</span><span class="ident" id="5993881">list</span><span class="op" id="5993885">,</span>&nbsp;<span class="ident" id="5993887">p</span><span class="op" id="5993888">.</span><span class="ident" id="5993889">parseType</span><span class="op" id="5993898">(</span><span class="op" id="5993899">)</span><span class="op" id="5993900">)</span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993907">return</span><br>
<span class="lineno"></span><span class="op" id="5993914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1855</span><span class="keyword" id="5993917">func</span>&nbsp;<span class="op" id="5993922">(</span><span class="ident" id="5993923">p</span>&nbsp;<span class="op" id="5993925">*</span><span class="ident" id="5993926">parser</span><span class="op" id="5993932">)</span>&nbsp;<span class="ident" id="5993934">parseCaseClause</span><span class="op" id="5993949">(</span><span class="ident" id="5993950">typeSwitch</span>&nbsp;<span class="builtintype" id="5993961">bool</span><span class="op" id="5993965">)</span>&nbsp;<span class="op" id="5993967">*</span><span class="ident" id="5993968">ast</span><span class="op" id="5993971">.</span><span class="ident" id="5993972">CaseClause</span>&nbsp;<span class="op" id="5993983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993986">if</span>&nbsp;<span class="ident" id="5993989">p</span><span class="op" id="5993990">.</span><span class="ident" id="5993991">trace</span>&nbsp;<span class="op" id="5993997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994001">defer</span>&nbsp;<span class="ident" id="5994007">un</span><span class="op" id="5994009">(</span><span class="ident" id="5994010">trace</span><span class="op" id="5994015">(</span><span class="ident" id="5994016">p</span><span class="op" id="5994017">,</span>&nbsp;<span class="string" id="5994019">&#34;CaseClause&#34;</span><span class="op" id="5994031">)</span><span class="op" id="5994032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994039">pos</span>&nbsp;<span class="op" id="5994043">:=</span>&nbsp;<span class="ident" id="5994046">p</span><span class="op" id="5994047">.</span><span class="ident" id="5994048">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994053">var</span>&nbsp;<span class="ident" id="5994057">list</span>&nbsp;<span class="op" id="5994062">[</span><span class="op" id="5994063">]</span><span class="ident" id="5994064">ast</span><span class="op" id="5994067">.</span><span class="ident" id="5994068">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994074">if</span>&nbsp;<span class="ident" id="5994077">p</span><span class="op" id="5994078">.</span><span class="ident" id="5994079">tok</span>&nbsp;<span class="op" id="5994083">==</span>&nbsp;<span class="ident" id="5994086">token</span><span class="op" id="5994091">.</span><span class="ident" id="5994092">CASE</span>&nbsp;<span class="op" id="5994097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994101">p</span><span class="op" id="5994102">.</span><span class="ident" id="5994103">next</span><span class="op" id="5994107">(</span><span class="op" id="5994108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994112">if</span>&nbsp;<span class="ident" id="5994115">typeSwitch</span>&nbsp;<span class="op" id="5994126">{</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994131">list</span>&nbsp;<span class="op" id="5994136">=</span>&nbsp;<span class="ident" id="5994138">p</span><span class="op" id="5994139">.</span><span class="ident" id="5994140">parseTypeList</span><span class="op" id="5994153">(</span><span class="op" id="5994154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994158">}</span>&nbsp;<span class="keyword" id="5994160">else</span>&nbsp;<span class="op" id="5994165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994170">list</span>&nbsp;<span class="op" id="5994175">=</span>&nbsp;<span class="ident" id="5994177">p</span><span class="op" id="5994178">.</span><span class="ident" id="5994179">parseRhsList</span><span class="op" id="5994191">(</span><span class="op" id="5994192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994199">}</span>&nbsp;<span class="keyword" id="5994201">else</span>&nbsp;<span class="op" id="5994206">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994210">p</span><span class="op" id="5994211">.</span><span class="ident" id="5994212">expect</span><span class="op" id="5994218">(</span><span class="ident" id="5994219">token</span><span class="op" id="5994224">.</span><span class="ident" id="5994225">DEFAULT</span><span class="op" id="5994232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994239">colon</span>&nbsp;<span class="op" id="5994245">:=</span>&nbsp;<span class="ident" id="5994248">p</span><span class="op" id="5994249">.</span><span class="ident" id="5994250">expect</span><span class="op" id="5994256">(</span><span class="ident" id="5994257">token</span><span class="op" id="5994262">.</span><span class="ident" id="5994263">COLON</span><span class="op" id="5994268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994271">p</span><span class="op" id="5994272">.</span><span class="ident" id="5994273">openScope</span><span class="op" id="5994282">(</span><span class="op" id="5994283">)</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994286">body</span>&nbsp;<span class="op" id="5994291">:=</span>&nbsp;<span class="ident" id="5994294">p</span><span class="op" id="5994295">.</span><span class="ident" id="5994296">parseStmtList</span><span class="op" id="5994309">(</span><span class="op" id="5994310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994313">p</span><span class="op" id="5994314">.</span><span class="ident" id="5994315">closeScope</span><span class="op" id="5994325">(</span><span class="op" id="5994326">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994330">return</span>&nbsp;<span class="op" id="5994337">&amp;</span><span class="ident" id="5994338">ast</span><span class="op" id="5994341">.</span><span class="ident" id="5994342">CaseClause</span><span class="op" id="5994352">{</span><span class="ident" id="5994353">Case</span><span class="op" id="5994357">:</span>&nbsp;<span class="ident" id="5994359">pos</span><span class="op" id="5994362">,</span>&nbsp;<span class="ident" id="5994364">List</span><span class="op" id="5994368">:</span>&nbsp;<span class="ident" id="5994370">list</span><span class="op" id="5994374">,</span>&nbsp;<span class="ident" id="5994376">Colon</span><span class="op" id="5994381">:</span>&nbsp;<span class="ident" id="5994383">colon</span><span class="op" id="5994388">,</span>&nbsp;<span class="ident" id="5994390">Body</span><span class="op" id="5994394">:</span>&nbsp;<span class="ident" id="5994396">body</span><span class="op" id="5994400">}</span><br>
<span class="lineno"></span><span class="op" id="5994402">}</span><br>
<span class="lineno">1880</span><br>
<span class="lineno"></span><span class="keyword" id="5994405">func</span>&nbsp;<span class="ident" id="5994410">isTypeSwitchAssert</span><span class="op" id="5994428">(</span><span class="ident" id="5994429">x</span>&nbsp;<span class="ident" id="5994431">ast</span><span class="op" id="5994434">.</span><span class="ident" id="5994435">Expr</span><span class="op" id="5994439">)</span>&nbsp;<span class="builtintype" id="5994441">bool</span>&nbsp;<span class="op" id="5994446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994449">a</span><span class="op" id="5994450">,</span>&nbsp;<span class="ident" id="5994452">ok</span>&nbsp;<span class="op" id="5994455">:=</span>&nbsp;<span class="ident" id="5994458">x</span><span class="op" id="5994459">.</span><span class="op" id="5994460">(</span><span class="op" id="5994461">*</span><span class="ident" id="5994462">ast</span><span class="op" id="5994465">.</span><span class="ident" id="5994466">TypeAssertExpr</span><span class="op" id="5994480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994483">return</span>&nbsp;<span class="ident" id="5994490">ok</span>&nbsp;<span class="op" id="5994493">&amp;&amp;</span>&nbsp;<span class="ident" id="5994496">a</span><span class="op" id="5994497">.</span><span class="ident" id="5994498">Type</span>&nbsp;<span class="op" id="5994503">==</span>&nbsp;<span class="ident" id="5994506">nil</span><br>
<span class="lineno"></span><span class="op" id="5994510">}</span><br>
<span class="lineno">1885</span><br>
<span class="lineno"></span><span class="keyword" id="5994513">func</span>&nbsp;<span class="ident" id="5994518">isTypeSwitchGuard</span><span class="op" id="5994535">(</span><span class="ident" id="5994536">s</span>&nbsp;<span class="ident" id="5994538">ast</span><span class="op" id="5994541">.</span><span class="ident" id="5994542">Stmt</span><span class="op" id="5994546">)</span>&nbsp;<span class="builtintype" id="5994548">bool</span>&nbsp;<span class="op" id="5994553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994556">switch</span>&nbsp;<span class="ident" id="5994563">t</span>&nbsp;<span class="op" id="5994565">:=</span>&nbsp;<span class="ident" id="5994568">s</span><span class="op" id="5994569">.</span><span class="op" id="5994570">(</span><span class="keyword" id="5994571">type</span><span class="op" id="5994575">)</span>&nbsp;<span class="op" id="5994577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994580">case</span>&nbsp;<span class="op" id="5994585">*</span><span class="ident" id="5994586">ast</span><span class="op" id="5994589">.</span><span class="ident" id="5994590">ExprStmt</span><span class="op" id="5994598">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994602">//&nbsp;x.(nil)</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994615">return</span>&nbsp;<span class="ident" id="5994622">isTypeSwitchAssert</span><span class="op" id="5994640">(</span><span class="ident" id="5994641">t</span><span class="op" id="5994642">.</span><span class="ident" id="5994643">X</span><span class="op" id="5994644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994647">case</span>&nbsp;<span class="op" id="5994652">*</span><span class="ident" id="5994653">ast</span><span class="op" id="5994656">.</span><span class="ident" id="5994657">AssignStmt</span><span class="op" id="5994667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994671">//&nbsp;v&nbsp;:=&nbsp;x.(nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994689">return</span>&nbsp;<span class="builtinfunc" id="5994696">len</span><span class="op" id="5994699">(</span><span class="ident" id="5994700">t</span><span class="op" id="5994701">.</span><span class="ident" id="5994702">Lhs</span><span class="op" id="5994705">)</span>&nbsp;<span class="op" id="5994707">==</span>&nbsp;<span class="num" id="5994710">1</span>&nbsp;<span class="op" id="5994712">&amp;&amp;</span>&nbsp;<span class="ident" id="5994715">t</span><span class="op" id="5994716">.</span><span class="ident" id="5994717">Tok</span>&nbsp;<span class="op" id="5994721">==</span>&nbsp;<span class="ident" id="5994724">token</span><span class="op" id="5994729">.</span><span class="ident" id="5994730">DEFINE</span>&nbsp;<span class="op" id="5994737">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5994740">len</span><span class="op" id="5994743">(</span><span class="ident" id="5994744">t</span><span class="op" id="5994745">.</span><span class="ident" id="5994746">Rhs</span><span class="op" id="5994749">)</span>&nbsp;<span class="op" id="5994751">==</span>&nbsp;<span class="num" id="5994754">1</span>&nbsp;<span class="op" id="5994756">&amp;&amp;</span>&nbsp;<span class="ident" id="5994759">isTypeSwitchAssert</span><span class="op" id="5994777">(</span><span class="ident" id="5994778">t</span><span class="op" id="5994779">.</span><span class="ident" id="5994780">Rhs</span><span class="op" id="5994783">[</span><span class="num" id="5994784">0</span><span class="op" id="5994785">]</span><span class="op" id="5994786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994789">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994792">return</span>&nbsp;<span class="ident" id="5994799">false</span><br>
<span class="lineno"></span><span class="op" id="5994805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5994808">func</span>&nbsp;<span class="op" id="5994813">(</span><span class="ident" id="5994814">p</span>&nbsp;<span class="op" id="5994816">*</span><span class="ident" id="5994817">parser</span><span class="op" id="5994823">)</span>&nbsp;<span class="ident" id="5994825">parseSwitchStmt</span><span class="op" id="5994840">(</span><span class="op" id="5994841">)</span>&nbsp;<span class="ident" id="5994843">ast</span><span class="op" id="5994846">.</span><span class="ident" id="5994847">Stmt</span>&nbsp;<span class="op" id="5994852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994855">if</span>&nbsp;<span class="ident" id="5994858">p</span><span class="op" id="5994859">.</span><span class="ident" id="5994860">trace</span>&nbsp;<span class="op" id="5994866">{</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994870">defer</span>&nbsp;<span class="ident" id="5994876">un</span><span class="op" id="5994878">(</span><span class="ident" id="5994879">trace</span><span class="op" id="5994884">(</span><span class="ident" id="5994885">p</span><span class="op" id="5994886">,</span>&nbsp;<span class="string" id="5994888">&#34;SwitchStmt&#34;</span><span class="op" id="5994900">)</span><span class="op" id="5994901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994908">pos</span>&nbsp;<span class="op" id="5994912">:=</span>&nbsp;<span class="ident" id="5994915">p</span><span class="op" id="5994916">.</span><span class="ident" id="5994917">expect</span><span class="op" id="5994923">(</span><span class="ident" id="5994924">token</span><span class="op" id="5994929">.</span><span class="ident" id="5994930">SWITCH</span><span class="op" id="5994936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994939">p</span><span class="op" id="5994940">.</span><span class="ident" id="5994941">openScope</span><span class="op" id="5994950">(</span><span class="op" id="5994951">)</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994954">defer</span>&nbsp;<span class="ident" id="5994960">p</span><span class="op" id="5994961">.</span><span class="ident" id="5994962">closeScope</span><span class="op" id="5994972">(</span><span class="op" id="5994973">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994977">var</span>&nbsp;<span class="ident" id="5994981">s1</span><span class="op" id="5994983">,</span>&nbsp;<span class="ident" id="5994985">s2</span>&nbsp;<span class="ident" id="5994988">ast</span><span class="op" id="5994991">.</span><span class="ident" id="5994992">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994998">if</span>&nbsp;<span class="ident" id="5995001">p</span><span class="op" id="5995002">.</span><span class="ident" id="5995003">tok</span>&nbsp;<span class="op" id="5995007">!=</span>&nbsp;<span class="ident" id="5995010">token</span><span class="op" id="5995015">.</span><span class="ident" id="5995016">LBRACE</span>&nbsp;<span class="op" id="5995023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995027">prevLev</span>&nbsp;<span class="op" id="5995035">:=</span>&nbsp;<span class="ident" id="5995038">p</span><span class="op" id="5995039">.</span><span class="ident" id="5995040">exprLev</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995050">p</span><span class="op" id="5995051">.</span><span class="ident" id="5995052">exprLev</span>&nbsp;<span class="op" id="5995060">=</span>&nbsp;<span class="op" id="5995062">-</span><span class="num" id="5995063">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995067">if</span>&nbsp;<span class="ident" id="5995070">p</span><span class="op" id="5995071">.</span><span class="ident" id="5995072">tok</span>&nbsp;<span class="op" id="5995076">!=</span>&nbsp;<span class="ident" id="5995079">token</span><span class="op" id="5995084">.</span><span class="ident" id="5995085">SEMICOLON</span>&nbsp;<span class="op" id="5995095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995100">s2</span><span class="op" id="5995102">,</span>&nbsp;<span class="ident" id="5995104">_</span>&nbsp;<span class="op" id="5995106">=</span>&nbsp;<span class="ident" id="5995108">p</span><span class="op" id="5995109">.</span><span class="ident" id="5995110">parseSimpleStmt</span><span class="op" id="5995125">(</span><span class="ident" id="5995126">basic</span><span class="op" id="5995131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995139">if</span>&nbsp;<span class="ident" id="5995142">p</span><span class="op" id="5995143">.</span><span class="ident" id="5995144">tok</span>&nbsp;<span class="op" id="5995148">==</span>&nbsp;<span class="ident" id="5995151">token</span><span class="op" id="5995156">.</span><span class="ident" id="5995157">SEMICOLON</span>&nbsp;<span class="op" id="5995167">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995172">p</span><span class="op" id="5995173">.</span><span class="ident" id="5995174">next</span><span class="op" id="5995178">(</span><span class="op" id="5995179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995184">s1</span>&nbsp;<span class="op" id="5995187">=</span>&nbsp;<span class="ident" id="5995189">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995195">s2</span>&nbsp;<span class="op" id="5995198">=</span>&nbsp;<span class="ident" id="5995200">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995207">if</span>&nbsp;<span class="ident" id="5995210">p</span><span class="op" id="5995211">.</span><span class="ident" id="5995212">tok</span>&nbsp;<span class="op" id="5995216">!=</span>&nbsp;<span class="ident" id="5995219">token</span><span class="op" id="5995224">.</span><span class="ident" id="5995225">LBRACE</span>&nbsp;<span class="op" id="5995232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995238">//&nbsp;A&nbsp;TypeSwitchGuard&nbsp;may&nbsp;declare&nbsp;a&nbsp;variable&nbsp;in&nbsp;addition</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995298">//&nbsp;to&nbsp;the&nbsp;variable&nbsp;declared&nbsp;in&nbsp;the&nbsp;initial&nbsp;SimpleStmt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995357">//&nbsp;Introduce&nbsp;extra&nbsp;scope&nbsp;to&nbsp;avoid&nbsp;redeclaration&nbsp;errors:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995417">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995424">//&nbsp;&nbsp;&nbsp;&nbspswitch&nbsp;t&nbsp;:=&nbsp;0;&nbsp;t&nbsp;:=&nbsp;x.(T)&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995465">//</span><br>
<span class="lineno">1925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995472">//&nbsp;(this&nbsp;code&nbsp;is&nbsp;not&nbsp;valid&nbsp;Go&nbsp;because&nbsp;the&nbsp;first&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995526">//&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;and&nbsp;thus&nbsp;is&nbsp;never&nbsp;used,&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995586">//&nbsp;scope&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;correct&nbsp;error&nbsp;message).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995641">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995648">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;type&nbsp;switch,&nbsp;s2&nbsp;must&nbsp;be&nbsp;an&nbsp;expression.</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995713">//&nbsp;Having&nbsp;the&nbsp;extra&nbsp;nested&nbsp;but&nbsp;empty&nbsp;scope&nbsp;won&#39;t&nbsp;affect&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995777">p</span><span class="op" id="5995778">.</span><span class="ident" id="5995779">openScope</span><span class="op" id="5995788">(</span><span class="op" id="5995789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995795">defer</span>&nbsp;<span class="ident" id="5995801">p</span><span class="op" id="5995802">.</span><span class="ident" id="5995803">closeScope</span><span class="op" id="5995813">(</span><span class="op" id="5995814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995820">s2</span><span class="op" id="5995822">,</span>&nbsp;<span class="ident" id="5995824">_</span>&nbsp;<span class="op" id="5995826">=</span>&nbsp;<span class="ident" id="5995828">p</span><span class="op" id="5995829">.</span><span class="ident" id="5995830">parseSimpleStmt</span><span class="op" id="5995845">(</span><span class="ident" id="5995846">basic</span><span class="op" id="5995851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995856">}</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995864">p</span><span class="op" id="5995865">.</span><span class="ident" id="5995866">exprLev</span>&nbsp;<span class="op" id="5995874">=</span>&nbsp;<span class="ident" id="5995876">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995889">typeSwitch</span>&nbsp;<span class="op" id="5995900">:=</span>&nbsp;<span class="ident" id="5995903">isTypeSwitchGuard</span><span class="op" id="5995920">(</span><span class="ident" id="5995921">s2</span><span class="op" id="5995923">)</span><br>
<span class="lineno">1940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995926">lbrace</span>&nbsp;<span class="op" id="5995933">:=</span>&nbsp;<span class="ident" id="5995936">p</span><span class="op" id="5995937">.</span><span class="ident" id="5995938">expect</span><span class="op" id="5995944">(</span><span class="ident" id="5995945">token</span><span class="op" id="5995950">.</span><span class="ident" id="5995951">LBRACE</span><span class="op" id="5995957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995960">var</span>&nbsp;<span class="ident" id="5995964">list</span>&nbsp;<span class="op" id="5995969">[</span><span class="op" id="5995970">]</span><span class="ident" id="5995971">ast</span><span class="op" id="5995974">.</span><span class="ident" id="5995975">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995981">for</span>&nbsp;<span class="ident" id="5995985">p</span><span class="op" id="5995986">.</span><span class="ident" id="5995987">tok</span>&nbsp;<span class="op" id="5995991">==</span>&nbsp;<span class="ident" id="5995994">token</span><span class="op" id="5995999">.</span><span class="ident" id="5996000">CASE</span>&nbsp;<span class="op" id="5996005">||</span>&nbsp;<span class="ident" id="5996008">p</span><span class="op" id="5996009">.</span><span class="ident" id="5996010">tok</span>&nbsp;<span class="op" id="5996014">==</span>&nbsp;<span class="ident" id="5996017">token</span><span class="op" id="5996022">.</span><span class="ident" id="5996023">DEFAULT</span>&nbsp;<span class="op" id="5996031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996035">list</span>&nbsp;<span class="op" id="5996040">=</span>&nbsp;<span class="builtinfunc" id="5996042">append</span><span class="op" id="5996048">(</span><span class="ident" id="5996049">list</span><span class="op" id="5996053">,</span>&nbsp;<span class="ident" id="5996055">p</span><span class="op" id="5996056">.</span><span class="ident" id="5996057">parseCaseClause</span><span class="op" id="5996072">(</span><span class="ident" id="5996073">typeSwitch</span><span class="op" id="5996083">)</span><span class="op" id="5996084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996087">}</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996090">rbrace</span>&nbsp;<span class="op" id="5996097">:=</span>&nbsp;<span class="ident" id="5996100">p</span><span class="op" id="5996101">.</span><span class="ident" id="5996102">expect</span><span class="op" id="5996108">(</span><span class="ident" id="5996109">token</span><span class="op" id="5996114">.</span><span class="ident" id="5996115">RBRACE</span><span class="op" id="5996121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996124">p</span><span class="op" id="5996125">.</span><span class="ident" id="5996126">expectSemi</span><span class="op" id="5996136">(</span><span class="op" id="5996137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996140">body</span>&nbsp;<span class="op" id="5996145">:=</span>&nbsp;<span class="op" id="5996148">&amp;</span><span class="ident" id="5996149">ast</span><span class="op" id="5996152">.</span><span class="ident" id="5996153">BlockStmt</span><span class="op" id="5996162">{</span><span class="ident" id="5996163">Lbrace</span><span class="op" id="5996169">:</span>&nbsp;<span class="ident" id="5996171">lbrace</span><span class="op" id="5996177">,</span>&nbsp;<span class="ident" id="5996179">List</span><span class="op" id="5996183">:</span>&nbsp;<span class="ident" id="5996185">list</span><span class="op" id="5996189">,</span>&nbsp;<span class="ident" id="5996191">Rbrace</span><span class="op" id="5996197">:</span>&nbsp;<span class="ident" id="5996199">rbrace</span><span class="op" id="5996205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996209">if</span>&nbsp;<span class="ident" id="5996212">typeSwitch</span>&nbsp;<span class="op" id="5996223">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996227">return</span>&nbsp;<span class="op" id="5996234">&amp;</span><span class="ident" id="5996235">ast</span><span class="op" id="5996238">.</span><span class="ident" id="5996239">TypeSwitchStmt</span><span class="op" id="5996253">{</span><span class="ident" id="5996254">Switch</span><span class="op" id="5996260">:</span>&nbsp;<span class="ident" id="5996262">pos</span><span class="op" id="5996265">,</span>&nbsp;<span class="ident" id="5996267">Init</span><span class="op" id="5996271">:</span>&nbsp;<span class="ident" id="5996273">s1</span><span class="op" id="5996275">,</span>&nbsp;<span class="ident" id="5996277">Assign</span><span class="op" id="5996283">:</span>&nbsp;<span class="ident" id="5996285">s2</span><span class="op" id="5996287">,</span>&nbsp;<span class="ident" id="5996289">Body</span><span class="op" id="5996293">:</span>&nbsp;<span class="ident" id="5996295">body</span><span class="op" id="5996299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996306">return</span>&nbsp;<span class="op" id="5996313">&amp;</span><span class="ident" id="5996314">ast</span><span class="op" id="5996317">.</span><span class="ident" id="5996318">SwitchStmt</span><span class="op" id="5996328">{</span><span class="ident" id="5996329">Switch</span><span class="op" id="5996335">:</span>&nbsp;<span class="ident" id="5996337">pos</span><span class="op" id="5996340">,</span>&nbsp;<span class="ident" id="5996342">Init</span><span class="op" id="5996346">:</span>&nbsp;<span class="ident" id="5996348">s1</span><span class="op" id="5996350">,</span>&nbsp;<span class="ident" id="5996352">Tag</span><span class="op" id="5996355">:</span>&nbsp;<span class="ident" id="5996357">p</span><span class="op" id="5996358">.</span><span class="ident" id="5996359">makeExpr</span><span class="op" id="5996367">(</span><span class="ident" id="5996368">s2</span><span class="op" id="5996370">,</span>&nbsp;<span class="string" id="5996372">&#34;switch&nbsp;expression&#34;</span><span class="op" id="5996391">)</span><span class="op" id="5996392">,</span>&nbsp;<span class="ident" id="5996394">Body</span><span class="op" id="5996398">:</span>&nbsp;<span class="ident" id="5996400">body</span><span class="op" id="5996404">}</span><br>
<span class="lineno"></span><span class="op" id="5996406">}</span><br>
<span class="lineno">1955</span><br>
<span class="lineno"></span><span class="keyword" id="5996409">func</span>&nbsp;<span class="op" id="5996414">(</span><span class="ident" id="5996415">p</span>&nbsp;<span class="op" id="5996417">*</span><span class="ident" id="5996418">parser</span><span class="op" id="5996424">)</span>&nbsp;<span class="ident" id="5996426">parseCommClause</span><span class="op" id="5996441">(</span><span class="op" id="5996442">)</span>&nbsp;<span class="op" id="5996444">*</span><span class="ident" id="5996445">ast</span><span class="op" id="5996448">.</span><span class="ident" id="5996449">CommClause</span>&nbsp;<span class="op" id="5996460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996463">if</span>&nbsp;<span class="ident" id="5996466">p</span><span class="op" id="5996467">.</span><span class="ident" id="5996468">trace</span>&nbsp;<span class="op" id="5996474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996478">defer</span>&nbsp;<span class="ident" id="5996484">un</span><span class="op" id="5996486">(</span><span class="ident" id="5996487">trace</span><span class="op" id="5996492">(</span><span class="ident" id="5996493">p</span><span class="op" id="5996494">,</span>&nbsp;<span class="string" id="5996496">&#34;CommClause&#34;</span><span class="op" id="5996508">)</span><span class="op" id="5996509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996512">}</span><br>
<span class="lineno">1960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996516">p</span><span class="op" id="5996517">.</span><span class="ident" id="5996518">openScope</span><span class="op" id="5996527">(</span><span class="op" id="5996528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996531">pos</span>&nbsp;<span class="op" id="5996535">:=</span>&nbsp;<span class="ident" id="5996538">p</span><span class="op" id="5996539">.</span><span class="ident" id="5996540">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996545">var</span>&nbsp;<span class="ident" id="5996549">comm</span>&nbsp;<span class="ident" id="5996554">ast</span><span class="op" id="5996557">.</span><span class="ident" id="5996558">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996564">if</span>&nbsp;<span class="ident" id="5996567">p</span><span class="op" id="5996568">.</span><span class="ident" id="5996569">tok</span>&nbsp;<span class="op" id="5996573">==</span>&nbsp;<span class="ident" id="5996576">token</span><span class="op" id="5996581">.</span><span class="ident" id="5996582">CASE</span>&nbsp;<span class="op" id="5996587">{</span><br>
<span class="lineno">1965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996591">p</span><span class="op" id="5996592">.</span><span class="ident" id="5996593">next</span><span class="op" id="5996597">(</span><span class="op" id="5996598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996602">lhs</span>&nbsp;<span class="op" id="5996606">:=</span>&nbsp;<span class="ident" id="5996609">p</span><span class="op" id="5996610">.</span><span class="ident" id="5996611">parseLhsList</span><span class="op" id="5996623">(</span><span class="op" id="5996624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996628">if</span>&nbsp;<span class="ident" id="5996631">p</span><span class="op" id="5996632">.</span><span class="ident" id="5996633">tok</span>&nbsp;<span class="op" id="5996637">==</span>&nbsp;<span class="ident" id="5996640">token</span><span class="op" id="5996645">.</span><span class="ident" id="5996646">ARROW</span>&nbsp;<span class="op" id="5996652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996657">//&nbsp;SendStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996672">if</span>&nbsp;<span class="builtinfunc" id="5996675">len</span><span class="op" id="5996678">(</span><span class="ident" id="5996679">lhs</span><span class="op" id="5996682">)</span>&nbsp;<span class="op" id="5996684">&gt;</span>&nbsp;<span class="num" id="5996686">1</span>&nbsp;<span class="op" id="5996688">{</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996694">p</span><span class="op" id="5996695">.</span><span class="ident" id="5996696">errorExpected</span><span class="op" id="5996709">(</span><span class="ident" id="5996710">lhs</span><span class="op" id="5996713">[</span><span class="num" id="5996714">0</span><span class="op" id="5996715">]</span><span class="op" id="5996716">.</span><span class="ident" id="5996717">Pos</span><span class="op" id="5996720">(</span><span class="op" id="5996721">)</span><span class="op" id="5996722">,</span>&nbsp;<span class="string" id="5996724">&#34;1&nbsp;expression&#34;</span><span class="op" id="5996738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996744">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996786">arrow</span>&nbsp;<span class="op" id="5996792">:=</span>&nbsp;<span class="ident" id="5996795">p</span><span class="op" id="5996796">.</span><span class="ident" id="5996797">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996804">p</span><span class="op" id="5996805">.</span><span class="ident" id="5996806">next</span><span class="op" id="5996810">(</span><span class="op" id="5996811">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996816">rhs</span>&nbsp;<span class="op" id="5996820">:=</span>&nbsp;<span class="ident" id="5996823">p</span><span class="op" id="5996824">.</span><span class="ident" id="5996825">parseRhs</span><span class="op" id="5996833">(</span><span class="op" id="5996834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996839">comm</span>&nbsp;<span class="op" id="5996844">=</span>&nbsp;<span class="op" id="5996846">&amp;</span><span class="ident" id="5996847">ast</span><span class="op" id="5996850">.</span><span class="ident" id="5996851">SendStmt</span><span class="op" id="5996859">{</span><span class="ident" id="5996860">Chan</span><span class="op" id="5996864">:</span>&nbsp;<span class="ident" id="5996866">lhs</span><span class="op" id="5996869">[</span><span class="num" id="5996870">0</span><span class="op" id="5996871">]</span><span class="op" id="5996872">,</span>&nbsp;<span class="ident" id="5996874">Arrow</span><span class="op" id="5996879">:</span>&nbsp;<span class="ident" id="5996881">arrow</span><span class="op" id="5996886">,</span>&nbsp;<span class="ident" id="5996888">Value</span><span class="op" id="5996893">:</span>&nbsp;<span class="ident" id="5996895">rhs</span><span class="op" id="5996898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996902">}</span>&nbsp;<span class="keyword" id="5996904">else</span>&nbsp;<span class="op" id="5996909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996914">//&nbsp;RecvStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996929">if</span>&nbsp;<span class="ident" id="5996932">tok</span>&nbsp;<span class="op" id="5996936">:=</span>&nbsp;<span class="ident" id="5996939">p</span><span class="op" id="5996940">.</span><span class="ident" id="5996941">tok</span><span class="op" id="5996944">;</span>&nbsp;<span class="ident" id="5996946">tok</span>&nbsp;<span class="op" id="5996950">==</span>&nbsp;<span class="ident" id="5996953">token</span><span class="op" id="5996958">.</span><span class="ident" id="5996959">ASSIGN</span>&nbsp;<span class="op" id="5996966">||</span>&nbsp;<span class="ident" id="5996969">tok</span>&nbsp;<span class="op" id="5996973">==</span>&nbsp;<span class="ident" id="5996976">token</span><span class="op" id="5996981">.</span><span class="ident" id="5996982">DEFINE</span>&nbsp;<span class="op" id="5996989">{</span><br>
<span class="lineno">1980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996995">//&nbsp;RecvStmt&nbsp;with&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997027">if</span>&nbsp;<span class="builtinfunc" id="5997030">len</span><span class="op" id="5997033">(</span><span class="ident" id="5997034">lhs</span><span class="op" id="5997037">)</span>&nbsp;<span class="op" id="5997039">&gt;</span>&nbsp;<span class="num" id="5997041">2</span>&nbsp;<span class="op" id="5997043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997050">p</span><span class="op" id="5997051">.</span><span class="ident" id="5997052">errorExpected</span><span class="op" id="5997065">(</span><span class="ident" id="5997066">lhs</span><span class="op" id="5997069">[</span><span class="num" id="5997070">0</span><span class="op" id="5997071">]</span><span class="op" id="5997072">.</span><span class="ident" id="5997073">Pos</span><span class="op" id="5997076">(</span><span class="op" id="5997077">)</span><span class="op" id="5997078">,</span>&nbsp;<span class="string" id="5997080">&#34;1&nbsp;or&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="5997100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997107">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;two&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997151">lhs</span>&nbsp;<span class="op" id="5997155">=</span>&nbsp;<span class="ident" id="5997157">lhs</span><span class="op" id="5997160">[</span><span class="num" id="5997161">0</span><span class="op" id="5997162">:</span><span class="num" id="5997163">2</span><span class="op" id="5997164">]</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997176">pos</span>&nbsp;<span class="op" id="5997180">:=</span>&nbsp;<span class="ident" id="5997183">p</span><span class="op" id="5997184">.</span><span class="ident" id="5997185">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997193">p</span><span class="op" id="5997194">.</span><span class="ident" id="5997195">next</span><span class="op" id="5997199">(</span><span class="op" id="5997200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997206">rhs</span>&nbsp;<span class="op" id="5997210">:=</span>&nbsp;<span class="ident" id="5997213">p</span><span class="op" id="5997214">.</span><span class="ident" id="5997215">parseRhs</span><span class="op" id="5997223">(</span><span class="op" id="5997224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997230">as</span>&nbsp;<span class="op" id="5997233">:=</span>&nbsp;<span class="op" id="5997236">&amp;</span><span class="ident" id="5997237">ast</span><span class="op" id="5997240">.</span><span class="ident" id="5997241">AssignStmt</span><span class="op" id="5997251">{</span><span class="ident" id="5997252">Lhs</span><span class="op" id="5997255">:</span>&nbsp;<span class="ident" id="5997257">lhs</span><span class="op" id="5997260">,</span>&nbsp;<span class="ident" id="5997262">TokPos</span><span class="op" id="5997268">:</span>&nbsp;<span class="ident" id="5997270">pos</span><span class="op" id="5997273">,</span>&nbsp;<span class="ident" id="5997275">Tok</span><span class="op" id="5997278">:</span>&nbsp;<span class="ident" id="5997280">tok</span><span class="op" id="5997283">,</span>&nbsp;<span class="ident" id="5997285">Rhs</span><span class="op" id="5997288">:</span>&nbsp;<span class="op" id="5997290">[</span><span class="op" id="5997291">]</span><span class="ident" id="5997292">ast</span><span class="op" id="5997295">.</span><span class="ident" id="5997296">Expr</span><span class="op" id="5997300">{</span><span class="ident" id="5997301">rhs</span><span class="op" id="5997304">}</span><span class="op" id="5997305">}</span><br>
<span class="lineno">1990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997311">if</span>&nbsp;<span class="ident" id="5997314">tok</span>&nbsp;<span class="op" id="5997318">==</span>&nbsp;<span class="ident" id="5997321">token</span><span class="op" id="5997326">.</span><span class="ident" id="5997327">DEFINE</span>&nbsp;<span class="op" id="5997334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997341">p</span><span class="op" id="5997342">.</span><span class="ident" id="5997343">shortVarDecl</span><span class="op" id="5997355">(</span><span class="ident" id="5997356">as</span><span class="op" id="5997358">,</span>&nbsp;<span class="ident" id="5997360">lhs</span><span class="op" id="5997363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997375">comm</span>&nbsp;<span class="op" id="5997380">=</span>&nbsp;<span class="ident" id="5997382">as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997388">}</span>&nbsp;<span class="keyword" id="5997390">else</span>&nbsp;<span class="op" id="5997395">{</span><br>
<span class="lineno">1995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997401">//&nbsp;lhs&nbsp;must&nbsp;be&nbsp;single&nbsp;receive&nbsp;operation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997445">if</span>&nbsp;<span class="builtinfunc" id="5997448">len</span><span class="op" id="5997451">(</span><span class="ident" id="5997452">lhs</span><span class="op" id="5997455">)</span>&nbsp;<span class="op" id="5997457">&gt;</span>&nbsp;<span class="num" id="5997459">1</span>&nbsp;<span class="op" id="5997461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997468">p</span><span class="op" id="5997469">.</span><span class="ident" id="5997470">errorExpected</span><span class="op" id="5997483">(</span><span class="ident" id="5997484">lhs</span><span class="op" id="5997487">[</span><span class="num" id="5997488">0</span><span class="op" id="5997489">]</span><span class="op" id="5997490">.</span><span class="ident" id="5997491">Pos</span><span class="op" id="5997494">(</span><span class="op" id="5997495">)</span><span class="op" id="5997496">,</span>&nbsp;<span class="string" id="5997498">&#34;1&nbsp;expression&#34;</span><span class="op" id="5997512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997519">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997557">}</span><br>
<span class="lineno">2000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997563">comm</span>&nbsp;<span class="op" id="5997568">=</span>&nbsp;<span class="op" id="5997570">&amp;</span><span class="ident" id="5997571">ast</span><span class="op" id="5997574">.</span><span class="ident" id="5997575">ExprStmt</span><span class="op" id="5997583">{</span><span class="ident" id="5997584">X</span><span class="op" id="5997585">:</span>&nbsp;<span class="ident" id="5997587">lhs</span><span class="op" id="5997590">[</span><span class="num" id="5997591">0</span><span class="op" id="5997592">]</span><span class="op" id="5997593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997605">}</span>&nbsp;<span class="keyword" id="5997607">else</span>&nbsp;<span class="op" id="5997612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997616">p</span><span class="op" id="5997617">.</span><span class="ident" id="5997618">expect</span><span class="op" id="5997624">(</span><span class="ident" id="5997625">token</span><span class="op" id="5997630">.</span><span class="ident" id="5997631">DEFAULT</span><span class="op" id="5997638">)</span><br>
<span class="lineno">2005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997645">colon</span>&nbsp;<span class="op" id="5997651">:=</span>&nbsp;<span class="ident" id="5997654">p</span><span class="op" id="5997655">.</span><span class="ident" id="5997656">expect</span><span class="op" id="5997662">(</span><span class="ident" id="5997663">token</span><span class="op" id="5997668">.</span><span class="ident" id="5997669">COLON</span><span class="op" id="5997674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997677">body</span>&nbsp;<span class="op" id="5997682">:=</span>&nbsp;<span class="ident" id="5997685">p</span><span class="op" id="5997686">.</span><span class="ident" id="5997687">parseStmtList</span><span class="op" id="5997700">(</span><span class="op" id="5997701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997704">p</span><span class="op" id="5997705">.</span><span class="ident" id="5997706">closeScope</span><span class="op" id="5997716">(</span><span class="op" id="5997717">)</span><br>
<span class="lineno">2010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997721">return</span>&nbsp;<span class="op" id="5997728">&amp;</span><span class="ident" id="5997729">ast</span><span class="op" id="5997732">.</span><span class="ident" id="5997733">CommClause</span><span class="op" id="5997743">{</span><span class="ident" id="5997744">Case</span><span class="op" id="5997748">:</span>&nbsp;<span class="ident" id="5997750">pos</span><span class="op" id="5997753">,</span>&nbsp;<span class="ident" id="5997755">Comm</span><span class="op" id="5997759">:</span>&nbsp;<span class="ident" id="5997761">comm</span><span class="op" id="5997765">,</span>&nbsp;<span class="ident" id="5997767">Colon</span><span class="op" id="5997772">:</span>&nbsp;<span class="ident" id="5997774">colon</span><span class="op" id="5997779">,</span>&nbsp;<span class="ident" id="5997781">Body</span><span class="op" id="5997785">:</span>&nbsp;<span class="ident" id="5997787">body</span><span class="op" id="5997791">}</span><br>
<span class="lineno"></span><span class="op" id="5997793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5997796">func</span>&nbsp;<span class="op" id="5997801">(</span><span class="ident" id="5997802">p</span>&nbsp;<span class="op" id="5997804">*</span><span class="ident" id="5997805">parser</span><span class="op" id="5997811">)</span>&nbsp;<span class="ident" id="5997813">parseSelectStmt</span><span class="op" id="5997828">(</span><span class="op" id="5997829">)</span>&nbsp;<span class="op" id="5997831">*</span><span class="ident" id="5997832">ast</span><span class="op" id="5997835">.</span><span class="ident" id="5997836">SelectStmt</span>&nbsp;<span class="op" id="5997847">{</span><br>
<span class="lineno">2015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997850">if</span>&nbsp;<span class="ident" id="5997853">p</span><span class="op" id="5997854">.</span><span class="ident" id="5997855">trace</span>&nbsp;<span class="op" id="5997861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997865">defer</span>&nbsp;<span class="ident" id="5997871">un</span><span class="op" id="5997873">(</span><span class="ident" id="5997874">trace</span><span class="op" id="5997879">(</span><span class="ident" id="5997880">p</span><span class="op" id="5997881">,</span>&nbsp;<span class="string" id="5997883">&#34;SelectStmt&#34;</span><span class="op" id="5997895">)</span><span class="op" id="5997896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997903">pos</span>&nbsp;<span class="op" id="5997907">:=</span>&nbsp;<span class="ident" id="5997910">p</span><span class="op" id="5997911">.</span><span class="ident" id="5997912">expect</span><span class="op" id="5997918">(</span><span class="ident" id="5997919">token</span><span class="op" id="5997924">.</span><span class="ident" id="5997925">SELECT</span><span class="op" id="5997931">)</span><br>
<span class="lineno">2020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997934">lbrace</span>&nbsp;<span class="op" id="5997941">:=</span>&nbsp;<span class="ident" id="5997944">p</span><span class="op" id="5997945">.</span><span class="ident" id="5997946">expect</span><span class="op" id="5997952">(</span><span class="ident" id="5997953">token</span><span class="op" id="5997958">.</span><span class="ident" id="5997959">LBRACE</span><span class="op" id="5997965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997968">var</span>&nbsp;<span class="ident" id="5997972">list</span>&nbsp;<span class="op" id="5997977">[</span><span class="op" id="5997978">]</span><span class="ident" id="5997979">ast</span><span class="op" id="5997982">.</span><span class="ident" id="5997983">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997989">for</span>&nbsp;<span class="ident" id="5997993">p</span><span class="op" id="5997994">.</span><span class="ident" id="5997995">tok</span>&nbsp;<span class="op" id="5997999">==</span>&nbsp;<span class="ident" id="5998002">token</span><span class="op" id="5998007">.</span><span class="ident" id="5998008">CASE</span>&nbsp;<span class="op" id="5998013">||</span>&nbsp;<span class="ident" id="5998016">p</span><span class="op" id="5998017">.</span><span class="ident" id="5998018">tok</span>&nbsp;<span class="op" id="5998022">==</span>&nbsp;<span class="ident" id="5998025">token</span><span class="op" id="5998030">.</span><span class="ident" id="5998031">DEFAULT</span>&nbsp;<span class="op" id="5998039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998043">list</span>&nbsp;<span class="op" id="5998048">=</span>&nbsp;<span class="builtinfunc" id="5998050">append</span><span class="op" id="5998056">(</span><span class="ident" id="5998057">list</span><span class="op" id="5998061">,</span>&nbsp;<span class="ident" id="5998063">p</span><span class="op" id="5998064">.</span><span class="ident" id="5998065">parseCommClause</span><span class="op" id="5998080">(</span><span class="op" id="5998081">)</span><span class="op" id="5998082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998085">}</span><br>
<span class="lineno">2025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998088">rbrace</span>&nbsp;<span class="op" id="5998095">:=</span>&nbsp;<span class="ident" id="5998098">p</span><span class="op" id="5998099">.</span><span class="ident" id="5998100">expect</span><span class="op" id="5998106">(</span><span class="ident" id="5998107">token</span><span class="op" id="5998112">.</span><span class="ident" id="5998113">RBRACE</span><span class="op" id="5998119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998122">p</span><span class="op" id="5998123">.</span><span class="ident" id="5998124">expectSemi</span><span class="op" id="5998134">(</span><span class="op" id="5998135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998138">body</span>&nbsp;<span class="op" id="5998143">:=</span>&nbsp;<span class="op" id="5998146">&amp;</span><span class="ident" id="5998147">ast</span><span class="op" id="5998150">.</span><span class="ident" id="5998151">BlockStmt</span><span class="op" id="5998160">{</span><span class="ident" id="5998161">Lbrace</span><span class="op" id="5998167">:</span>&nbsp;<span class="ident" id="5998169">lbrace</span><span class="op" id="5998175">,</span>&nbsp;<span class="ident" id="5998177">List</span><span class="op" id="5998181">:</span>&nbsp;<span class="ident" id="5998183">list</span><span class="op" id="5998187">,</span>&nbsp;<span class="ident" id="5998189">Rbrace</span><span class="op" id="5998195">:</span>&nbsp;<span class="ident" id="5998197">rbrace</span><span class="op" id="5998203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998207">return</span>&nbsp;<span class="op" id="5998214">&amp;</span><span class="ident" id="5998215">ast</span><span class="op" id="5998218">.</span><span class="ident" id="5998219">SelectStmt</span><span class="op" id="5998229">{</span><span class="ident" id="5998230">Select</span><span class="op" id="5998236">:</span>&nbsp;<span class="ident" id="5998238">pos</span><span class="op" id="5998241">,</span>&nbsp;<span class="ident" id="5998243">Body</span><span class="op" id="5998247">:</span>&nbsp;<span class="ident" id="5998249">body</span><span class="op" id="5998253">}</span><br>
<span class="lineno">2030</span><span class="op" id="5998255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5998258">func</span>&nbsp;<span class="op" id="5998263">(</span><span class="ident" id="5998264">p</span>&nbsp;<span class="op" id="5998266">*</span><span class="ident" id="5998267">parser</span><span class="op" id="5998273">)</span>&nbsp;<span class="ident" id="5998275">parseForStmt</span><span class="op" id="5998287">(</span><span class="op" id="5998288">)</span>&nbsp;<span class="ident" id="5998290">ast</span><span class="op" id="5998293">.</span><span class="ident" id="5998294">Stmt</span>&nbsp;<span class="op" id="5998299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998302">if</span>&nbsp;<span class="ident" id="5998305">p</span><span class="op" id="5998306">.</span><span class="ident" id="5998307">trace</span>&nbsp;<span class="op" id="5998313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998317">defer</span>&nbsp;<span class="ident" id="5998323">un</span><span class="op" id="5998325">(</span><span class="ident" id="5998326">trace</span><span class="op" id="5998331">(</span><span class="ident" id="5998332">p</span><span class="op" id="5998333">,</span>&nbsp;<span class="string" id="5998335">&#34;ForStmt&#34;</span><span class="op" id="5998344">)</span><span class="op" id="5998345">)</span><br>
<span class="lineno">2035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998352">pos</span>&nbsp;<span class="op" id="5998356">:=</span>&nbsp;<span class="ident" id="5998359">p</span><span class="op" id="5998360">.</span><span class="ident" id="5998361">expect</span><span class="op" id="5998367">(</span><span class="ident" id="5998368">token</span><span class="op" id="5998373">.</span><span class="ident" id="5998374">FOR</span><span class="op" id="5998377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998380">p</span><span class="op" id="5998381">.</span><span class="ident" id="5998382">openScope</span><span class="op" id="5998391">(</span><span class="op" id="5998392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998395">defer</span>&nbsp;<span class="ident" id="5998401">p</span><span class="op" id="5998402">.</span><span class="ident" id="5998403">closeScope</span><span class="op" id="5998413">(</span><span class="op" id="5998414">)</span><br>
<span class="lineno">2040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998418">var</span>&nbsp;<span class="ident" id="5998422">s1</span><span class="op" id="5998424">,</span>&nbsp;<span class="ident" id="5998426">s2</span><span class="op" id="5998428">,</span>&nbsp;<span class="ident" id="5998430">s3</span>&nbsp;<span class="ident" id="5998433">ast</span><span class="op" id="5998436">.</span><span class="ident" id="5998437">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998443">var</span>&nbsp;<span class="ident" id="5998447">isRange</span>&nbsp;<span class="builtintype" id="5998455">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998461">if</span>&nbsp;<span class="ident" id="5998464">p</span><span class="op" id="5998465">.</span><span class="ident" id="5998466">tok</span>&nbsp;<span class="op" id="5998470">!=</span>&nbsp;<span class="ident" id="5998473">token</span><span class="op" id="5998478">.</span><span class="ident" id="5998479">LBRACE</span>&nbsp;<span class="op" id="5998486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998490">prevLev</span>&nbsp;<span class="op" id="5998498">:=</span>&nbsp;<span class="ident" id="5998501">p</span><span class="op" id="5998502">.</span><span class="ident" id="5998503">exprLev</span><br>
<span class="lineno">2045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998513">p</span><span class="op" id="5998514">.</span><span class="ident" id="5998515">exprLev</span>&nbsp;<span class="op" id="5998523">=</span>&nbsp;<span class="op" id="5998525">-</span><span class="num" id="5998526">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998530">if</span>&nbsp;<span class="ident" id="5998533">p</span><span class="op" id="5998534">.</span><span class="ident" id="5998535">tok</span>&nbsp;<span class="op" id="5998539">!=</span>&nbsp;<span class="ident" id="5998542">token</span><span class="op" id="5998547">.</span><span class="ident" id="5998548">SEMICOLON</span>&nbsp;<span class="op" id="5998558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998563">if</span>&nbsp;<span class="ident" id="5998566">p</span><span class="op" id="5998567">.</span><span class="ident" id="5998568">tok</span>&nbsp;<span class="op" id="5998572">==</span>&nbsp;<span class="ident" id="5998575">token</span><span class="op" id="5998580">.</span><span class="ident" id="5998581">RANGE</span>&nbsp;<span class="op" id="5998587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998593">//&nbsp;&#34;for&nbsp;range&nbsp;x&#34;&nbsp;(nil&nbsp;lhs&nbsp;in&nbsp;assignment)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998638">pos</span>&nbsp;<span class="op" id="5998642">:=</span>&nbsp;<span class="ident" id="5998645">p</span><span class="op" id="5998646">.</span><span class="ident" id="5998647">pos</span><br>
<span class="lineno">2050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998655">p</span><span class="op" id="5998656">.</span><span class="ident" id="5998657">next</span><span class="op" id="5998661">(</span><span class="op" id="5998662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998668">y</span>&nbsp;<span class="op" id="5998670">:=</span>&nbsp;<span class="op" id="5998673">[</span><span class="op" id="5998674">]</span><span class="ident" id="5998675">ast</span><span class="op" id="5998678">.</span><span class="ident" id="5998679">Expr</span><span class="op" id="5998683">{</span><span class="op" id="5998684">&amp;</span><span class="ident" id="5998685">ast</span><span class="op" id="5998688">.</span><span class="ident" id="5998689">UnaryExpr</span><span class="op" id="5998698">{</span><span class="ident" id="5998699">OpPos</span><span class="op" id="5998704">:</span>&nbsp;<span class="ident" id="5998706">pos</span><span class="op" id="5998709">,</span>&nbsp;<span class="ident" id="5998711">Op</span><span class="op" id="5998713">:</span>&nbsp;<span class="ident" id="5998715">token</span><span class="op" id="5998720">.</span><span class="ident" id="5998721">RANGE</span><span class="op" id="5998726">,</span>&nbsp;<span class="ident" id="5998728">X</span><span class="op" id="5998729">:</span>&nbsp;<span class="ident" id="5998731">p</span><span class="op" id="5998732">.</span><span class="ident" id="5998733">parseRhs</span><span class="op" id="5998741">(</span><span class="op" id="5998742">)</span><span class="op" id="5998743">}</span><span class="op" id="5998744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998750">s2</span>&nbsp;<span class="op" id="5998753">=</span>&nbsp;<span class="op" id="5998755">&amp;</span><span class="ident" id="5998756">ast</span><span class="op" id="5998759">.</span><span class="ident" id="5998760">AssignStmt</span><span class="op" id="5998770">{</span><span class="ident" id="5998771">Rhs</span><span class="op" id="5998774">:</span>&nbsp;<span class="ident" id="5998776">y</span><span class="op" id="5998777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998783">isRange</span>&nbsp;<span class="op" id="5998791">=</span>&nbsp;<span class="ident" id="5998793">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998801">}</span>&nbsp;<span class="keyword" id="5998803">else</span>&nbsp;<span class="op" id="5998808">{</span><br>
<span class="lineno">2055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998814">s2</span><span class="op" id="5998816">,</span>&nbsp;<span class="ident" id="5998818">isRange</span>&nbsp;<span class="op" id="5998826">=</span>&nbsp;<span class="ident" id="5998828">p</span><span class="op" id="5998829">.</span><span class="ident" id="5998830">parseSimpleStmt</span><span class="op" id="5998845">(</span><span class="ident" id="5998846">rangeOk</span><span class="op" id="5998853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998866">if</span>&nbsp;<span class="op" id="5998869">!</span><span class="ident" id="5998870">isRange</span>&nbsp;<span class="op" id="5998878">&amp;&amp;</span>&nbsp;<span class="ident" id="5998881">p</span><span class="op" id="5998882">.</span><span class="ident" id="5998883">tok</span>&nbsp;<span class="op" id="5998887">==</span>&nbsp;<span class="ident" id="5998890">token</span><span class="op" id="5998895">.</span><span class="ident" id="5998896">SEMICOLON</span>&nbsp;<span class="op" id="5998906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998911">p</span><span class="op" id="5998912">.</span><span class="ident" id="5998913">next</span><span class="op" id="5998917">(</span><span class="op" id="5998918">)</span><br>
<span class="lineno">2060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998923">s1</span>&nbsp;<span class="op" id="5998926">=</span>&nbsp;<span class="ident" id="5998928">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998934">s2</span>&nbsp;<span class="op" id="5998937">=</span>&nbsp;<span class="ident" id="5998939">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998946">if</span>&nbsp;<span class="ident" id="5998949">p</span><span class="op" id="5998950">.</span><span class="ident" id="5998951">tok</span>&nbsp;<span class="op" id="5998955">!=</span>&nbsp;<span class="ident" id="5998958">token</span><span class="op" id="5998963">.</span><span class="ident" id="5998964">SEMICOLON</span>&nbsp;<span class="op" id="5998974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998980">s2</span><span class="op" id="5998982">,</span>&nbsp;<span class="ident" id="5998984">_</span>&nbsp;<span class="op" id="5998986">=</span>&nbsp;<span class="ident" id="5998988">p</span><span class="op" id="5998989">.</span><span class="ident" id="5998990">parseSimpleStmt</span><span class="op" id="5999005">(</span><span class="ident" id="5999006">basic</span><span class="op" id="5999011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999016">}</span><br>
<span class="lineno">2065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999021">p</span><span class="op" id="5999022">.</span><span class="ident" id="5999023">expectSemi</span><span class="op" id="5999033">(</span><span class="op" id="5999034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999039">if</span>&nbsp;<span class="ident" id="5999042">p</span><span class="op" id="5999043">.</span><span class="ident" id="5999044">tok</span>&nbsp;<span class="op" id="5999048">!=</span>&nbsp;<span class="ident" id="5999051">token</span><span class="op" id="5999056">.</span><span class="ident" id="5999057">LBRACE</span>&nbsp;<span class="op" id="5999064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999070">s3</span><span class="op" id="5999072">,</span>&nbsp;<span class="ident" id="5999074">_</span>&nbsp;<span class="op" id="5999076">=</span>&nbsp;<span class="ident" id="5999078">p</span><span class="op" id="5999079">.</span><span class="ident" id="5999080">parseSimpleStmt</span><span class="op" id="5999095">(</span><span class="ident" id="5999096">basic</span><span class="op" id="5999101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999110">}</span><br>
<span class="lineno">2070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999114">p</span><span class="op" id="5999115">.</span><span class="ident" id="5999116">exprLev</span>&nbsp;<span class="op" id="5999124">=</span>&nbsp;<span class="ident" id="5999126">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999139">body</span>&nbsp;<span class="op" id="5999144">:=</span>&nbsp;<span class="ident" id="5999147">p</span><span class="op" id="5999148">.</span><span class="ident" id="5999149">parseBlockStmt</span><span class="op" id="5999163">(</span><span class="op" id="5999164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999167">p</span><span class="op" id="5999168">.</span><span class="ident" id="5999169">expectSemi</span><span class="op" id="5999179">(</span><span class="op" id="5999180">)</span><br>
<span class="lineno">2075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999184">if</span>&nbsp;<span class="ident" id="5999187">isRange</span>&nbsp;<span class="op" id="5999195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999199">as</span>&nbsp;<span class="op" id="5999202">:=</span>&nbsp;<span class="ident" id="5999205">s2</span><span class="op" id="5999207">.</span><span class="op" id="5999208">(</span><span class="op" id="5999209">*</span><span class="ident" id="5999210">ast</span><span class="op" id="5999213">.</span><span class="ident" id="5999214">AssignStmt</span><span class="op" id="5999224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5999228">//&nbsp;check&nbsp;lhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999243">var</span>&nbsp;<span class="ident" id="5999247">key</span><span class="op" id="5999250">,</span>&nbsp;<span class="ident" id="5999252">value</span>&nbsp;<span class="ident" id="5999258">ast</span><span class="op" id="5999261">.</span><span class="ident" id="5999262">Expr</span><br>
<span class="lineno">2080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999269">switch</span>&nbsp;<span class="builtinfunc" id="5999276">len</span><span class="op" id="5999279">(</span><span class="ident" id="5999280">as</span><span class="op" id="5999282">.</span><span class="ident" id="5999283">Lhs</span><span class="op" id="5999286">)</span>&nbsp;<span class="op" id="5999288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999292">case</span>&nbsp;<span class="num" id="5999297">0</span><span class="op" id="5999298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5999303">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999322">case</span>&nbsp;<span class="num" id="5999327">1</span><span class="op" id="5999328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999333">key</span>&nbsp;<span class="op" id="5999337">=</span>&nbsp;<span class="ident" id="5999339">as</span><span class="op" id="5999341">.</span><span class="ident" id="5999342">Lhs</span><span class="op" id="5999345">[</span><span class="num" id="5999346">0</span><span class="op" id="5999347">]</span><br>
<span class="lineno">2085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999351">case</span>&nbsp;<span class="num" id="5999356">2</span><span class="op" id="5999357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999362">key</span><span class="op" id="5999365">,</span>&nbsp;<span class="ident" id="5999367">value</span>&nbsp;<span class="op" id="5999373">=</span>&nbsp;<span class="ident" id="5999375">as</span><span class="op" id="5999377">.</span><span class="ident" id="5999378">Lhs</span><span class="op" id="5999381">[</span><span class="num" id="5999382">0</span><span class="op" id="5999383">]</span><span class="op" id="5999384">,</span>&nbsp;<span class="ident" id="5999386">as</span><span class="op" id="5999388">.</span><span class="ident" id="5999389">Lhs</span><span class="op" id="5999392">[</span><span class="num" id="5999393">1</span><span class="op" id="5999394">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999398">default</span><span class="op" id="5999405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999410">p</span><span class="op" id="5999411">.</span><span class="ident" id="5999412">errorExpected</span><span class="op" id="5999425">(</span><span class="ident" id="5999426">as</span><span class="op" id="5999428">.</span><span class="ident" id="5999429">Lhs</span><span class="op" id="5999432">[</span><span class="builtinfunc" id="5999433">len</span><span class="op" id="5999436">(</span><span class="ident" id="5999437">as</span><span class="op" id="5999439">.</span><span class="ident" id="5999440">Lhs</span><span class="op" id="5999443">)</span><span class="op" id="5999444">-</span><span class="num" id="5999445">1</span><span class="op" id="5999446">]</span><span class="op" id="5999447">.</span><span class="ident" id="5999448">Pos</span><span class="op" id="5999451">(</span><span class="op" id="5999452">)</span><span class="op" id="5999453">,</span>&nbsp;<span class="string" id="5999455">&#34;at&nbsp;most&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="5999478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999483">return</span>&nbsp;<span class="op" id="5999490">&amp;</span><span class="ident" id="5999491">ast</span><span class="op" id="5999494">.</span><span class="ident" id="5999495">BadStmt</span><span class="op" id="5999502">{</span><span class="ident" id="5999503">From</span><span class="op" id="5999507">:</span>&nbsp;<span class="ident" id="5999509">pos</span><span class="op" id="5999512">,</span>&nbsp;<span class="ident" id="5999514">To</span><span class="op" id="5999516">:</span>&nbsp;<span class="ident" id="5999518">p</span><span class="op" id="5999519">.</span><span class="ident" id="5999520">safePos</span><span class="op" id="5999527">(</span><span class="ident" id="5999528">body</span><span class="op" id="5999532">.</span><span class="ident" id="5999533">End</span><span class="op" id="5999536">(</span><span class="op" id="5999537">)</span><span class="op" id="5999538">)</span><span class="op" id="5999539">}</span><br>
<span class="lineno">2090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5999547">//&nbsp;parseSimpleStmt&nbsp;returned&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5999600">//&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999656">x</span>&nbsp;<span class="op" id="5999658">:=</span>&nbsp;<span class="ident" id="5999661">as</span><span class="op" id="5999663">.</span><span class="ident" id="5999664">Rhs</span><span class="op" id="5999667">[</span><span class="num" id="5999668">0</span><span class="op" id="5999669">]</span><span class="op" id="5999670">.</span><span class="op" id="5999671">(</span><span class="op" id="5999672">*</span><span class="ident" id="5999673">ast</span><span class="op" id="5999676">.</span><span class="ident" id="5999677">UnaryExpr</span><span class="op" id="5999686">)</span><span class="op" id="5999687">.</span><span class="ident" id="5999688">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999692">return</span>&nbsp;<span class="op" id="5999699">&amp;</span><span class="ident" id="5999700">ast</span><span class="op" id="5999703">.</span><span class="ident" id="5999704">RangeStmt</span><span class="op" id="5999713">{</span><br>
<span class="lineno">2095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999718">For</span><span class="op" id="5999721">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5999726">pos</span><span class="op" id="5999729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999734">Key</span><span class="op" id="5999737">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5999742">key</span><span class="op" id="5999745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999750">Value</span><span class="op" id="5999755">:</span>&nbsp;&nbsp;<span class="ident" id="5999758">value</span><span class="op" id="5999763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999768">TokPos</span><span class="op" id="5999774">:</span>&nbsp;<span class="ident" id="5999776">as</span><span class="op" id="5999778">.</span><span class="ident" id="5999779">TokPos</span><span class="op" id="5999785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999790">Tok</span><span class="op" id="5999793">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5999798">as</span><span class="op" id="5999800">.</span><span class="ident" id="5999801">Tok</span><span class="op" id="5999804">,</span><br>
<span class="lineno">2100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999809">X</span><span class="op" id="5999810">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5999817">x</span><span class="op" id="5999818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999823">Body</span><span class="op" id="5999827">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5999831">body</span><span class="op" id="5999835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5999846">//&nbsp;regular&nbsp;for&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999872">return</span>&nbsp;<span class="op" id="5999879">&amp;</span><span class="ident" id="5999880">ast</span><span class="op" id="5999883">.</span><span class="ident" id="5999884">ForStmt</span><span class="op" id="5999891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999895">For</span><span class="op" id="5999898">:</span>&nbsp;&nbsp;<span class="ident" id="5999901">pos</span><span class="op" id="5999904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999908">Init</span><span class="op" id="5999912">:</span>&nbsp;<span class="ident" id="5999914">s1</span><span class="op" id="5999916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999920">Cond</span><span class="op" id="5999924">:</span>&nbsp;<span class="ident" id="5999926">p</span><span class="op" id="5999927">.</span><span class="ident" id="5999928">makeExpr</span><span class="op" id="5999936">(</span><span class="ident" id="5999937">s2</span><span class="op" id="5999939">,</span>&nbsp;<span class="string" id="5999941">&#34;boolean&nbsp;or&nbsp;range&nbsp;expression&#34;</span><span class="op" id="5999970">)</span><span class="op" id="5999971">,</span><br>
<span class="lineno">2110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999975">Post</span><span class="op" id="5999979">:</span>&nbsp;<span class="ident" id="5999981">s3</span><span class="op" id="5999983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999987">Body</span><span class="op" id="5999991">:</span>&nbsp;<span class="ident" id="5999993">body</span><span class="op" id="5999997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000000">}</span><br>
<span class="lineno"></span><span class="op" id="6000002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2115</span><span class="keyword" id="6000005">func</span>&nbsp;<span class="op" id="6000010">(</span><span class="ident" id="6000011">p</span>&nbsp;<span class="op" id="6000013">*</span><span class="ident" id="6000014">parser</span><span class="op" id="6000020">)</span>&nbsp;<span class="ident" id="6000022">parseStmt</span><span class="op" id="6000031">(</span><span class="op" id="6000032">)</span>&nbsp;<span class="op" id="6000034">(</span><span class="ident" id="6000035">s</span>&nbsp;<span class="ident" id="6000037">ast</span><span class="op" id="6000040">.</span><span class="ident" id="6000041">Stmt</span><span class="op" id="6000045">)</span>&nbsp;<span class="op" id="6000047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000050">if</span>&nbsp;<span class="ident" id="6000053">p</span><span class="op" id="6000054">.</span><span class="ident" id="6000055">trace</span>&nbsp;<span class="op" id="6000061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000065">defer</span>&nbsp;<span class="ident" id="6000071">un</span><span class="op" id="6000073">(</span><span class="ident" id="6000074">trace</span><span class="op" id="6000079">(</span><span class="ident" id="6000080">p</span><span class="op" id="6000081">,</span>&nbsp;<span class="string" id="6000083">&#34;Statement&#34;</span><span class="op" id="6000094">)</span><span class="op" id="6000095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000102">switch</span>&nbsp;<span class="ident" id="6000109">p</span><span class="op" id="6000110">.</span><span class="ident" id="6000111">tok</span>&nbsp;<span class="op" id="6000115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000118">case</span>&nbsp;<span class="ident" id="6000123">token</span><span class="op" id="6000128">.</span><span class="ident" id="6000129">CONST</span><span class="op" id="6000134">,</span>&nbsp;<span class="ident" id="6000136">token</span><span class="op" id="6000141">.</span><span class="ident" id="6000142">TYPE</span><span class="op" id="6000146">,</span>&nbsp;<span class="ident" id="6000148">token</span><span class="op" id="6000153">.</span><span class="ident" id="6000154">VAR</span><span class="op" id="6000157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000161">s</span>&nbsp;<span class="op" id="6000163">=</span>&nbsp;<span class="op" id="6000165">&amp;</span><span class="ident" id="6000166">ast</span><span class="op" id="6000169">.</span><span class="ident" id="6000170">DeclStmt</span><span class="op" id="6000178">{</span><span class="ident" id="6000179">Decl</span><span class="op" id="6000183">:</span>&nbsp;<span class="ident" id="6000185">p</span><span class="op" id="6000186">.</span><span class="ident" id="6000187">parseDecl</span><span class="op" id="6000196">(</span><span class="ident" id="6000197">syncStmt</span><span class="op" id="6000205">)</span><span class="op" id="6000206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000209">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000216">//&nbsp;tokens&nbsp;that&nbsp;may&nbsp;start&nbsp;an&nbsp;expression</span><br>
<span class="lineno">2125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000257">token</span><span class="op" id="6000262">.</span><span class="ident" id="6000263">IDENT</span><span class="op" id="6000268">,</span>&nbsp;<span class="ident" id="6000270">token</span><span class="op" id="6000275">.</span><span class="ident" id="6000276">INT</span><span class="op" id="6000279">,</span>&nbsp;<span class="ident" id="6000281">token</span><span class="op" id="6000286">.</span><span class="ident" id="6000287">FLOAT</span><span class="op" id="6000292">,</span>&nbsp;<span class="ident" id="6000294">token</span><span class="op" id="6000299">.</span><span class="ident" id="6000300">IMAG</span><span class="op" id="6000304">,</span>&nbsp;<span class="ident" id="6000306">token</span><span class="op" id="6000311">.</span><span class="ident" id="6000312">CHAR</span><span class="op" id="6000316">,</span>&nbsp;<span class="ident" id="6000318">token</span><span class="op" id="6000323">.</span><span class="ident" id="6000324">STRING</span><span class="op" id="6000330">,</span>&nbsp;<span class="ident" id="6000332">token</span><span class="op" id="6000337">.</span><span class="ident" id="6000338">FUNC</span><span class="op" id="6000342">,</span>&nbsp;<span class="ident" id="6000344">token</span><span class="op" id="6000349">.</span><span class="ident" id="6000350">LPAREN</span><span class="op" id="6000356">,</span>&nbsp;<span class="comment" id="6000358">//&nbsp;operands</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000372">token</span><span class="op" id="6000377">.</span><span class="ident" id="6000378">LBRACK</span><span class="op" id="6000384">,</span>&nbsp;<span class="ident" id="6000386">token</span><span class="op" id="6000391">.</span><span class="ident" id="6000392">STRUCT</span><span class="op" id="6000398">,</span>&nbsp;<span class="comment" id="6000400">//&nbsp;composite&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000421">token</span><span class="op" id="6000426">.</span><span class="ident" id="6000427">ADD</span><span class="op" id="6000430">,</span>&nbsp;<span class="ident" id="6000432">token</span><span class="op" id="6000437">.</span><span class="ident" id="6000438">SUB</span><span class="op" id="6000441">,</span>&nbsp;<span class="ident" id="6000443">token</span><span class="op" id="6000448">.</span><span class="ident" id="6000449">MUL</span><span class="op" id="6000452">,</span>&nbsp;<span class="ident" id="6000454">token</span><span class="op" id="6000459">.</span><span class="ident" id="6000460">AND</span><span class="op" id="6000463">,</span>&nbsp;<span class="ident" id="6000465">token</span><span class="op" id="6000470">.</span><span class="ident" id="6000471">XOR</span><span class="op" id="6000474">,</span>&nbsp;<span class="ident" id="6000476">token</span><span class="op" id="6000481">.</span><span class="ident" id="6000482">ARROW</span><span class="op" id="6000487">,</span>&nbsp;<span class="ident" id="6000489">token</span><span class="op" id="6000494">.</span><span class="ident" id="6000495">NOT</span><span class="op" id="6000498">:</span>&nbsp;<span class="comment" id="6000500">//&nbsp;unary&nbsp;operators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000521">s</span><span class="op" id="6000522">,</span>&nbsp;<span class="ident" id="6000524">_</span>&nbsp;<span class="op" id="6000526">=</span>&nbsp;<span class="ident" id="6000528">p</span><span class="op" id="6000529">.</span><span class="ident" id="6000530">parseSimpleStmt</span><span class="op" id="6000545">(</span><span class="ident" id="6000546">labelOk</span><span class="op" id="6000553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000557">//&nbsp;because&nbsp;of&nbsp;the&nbsp;required&nbsp;look-ahead,&nbsp;labeled&nbsp;statements&nbsp;are</span><br>
<span class="lineno">2130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000621">//&nbsp;parsed&nbsp;by&nbsp;parseSimpleStmt&nbsp;-&nbsp;don&#39;t&nbsp;expect&nbsp;a&nbsp;semicolon&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000685">//&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000695">if</span>&nbsp;<span class="ident" id="6000698">_</span><span class="op" id="6000699">,</span>&nbsp;<span class="ident" id="6000701">isLabeledStmt</span>&nbsp;<span class="op" id="6000715">:=</span>&nbsp;<span class="ident" id="6000718">s</span><span class="op" id="6000719">.</span><span class="op" id="6000720">(</span><span class="op" id="6000721">*</span><span class="ident" id="6000722">ast</span><span class="op" id="6000725">.</span><span class="ident" id="6000726">LabeledStmt</span><span class="op" id="6000737">)</span><span class="op" id="6000738">;</span>&nbsp;<span class="op" id="6000740">!</span><span class="ident" id="6000741">isLabeledStmt</span>&nbsp;<span class="op" id="6000755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000760">p</span><span class="op" id="6000761">.</span><span class="ident" id="6000762">expectSemi</span><span class="op" id="6000772">(</span><span class="op" id="6000773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000777">}</span><br>
<span class="lineno">2135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000780">case</span>&nbsp;<span class="ident" id="6000785">token</span><span class="op" id="6000790">.</span><span class="ident" id="6000791">GO</span><span class="op" id="6000793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000797">s</span>&nbsp;<span class="op" id="6000799">=</span>&nbsp;<span class="ident" id="6000801">p</span><span class="op" id="6000802">.</span><span class="ident" id="6000803">parseGoStmt</span><span class="op" id="6000814">(</span><span class="op" id="6000815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000818">case</span>&nbsp;<span class="ident" id="6000823">token</span><span class="op" id="6000828">.</span><span class="ident" id="6000829">DEFER</span><span class="op" id="6000834">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000838">s</span>&nbsp;<span class="op" id="6000840">=</span>&nbsp;<span class="ident" id="6000842">p</span><span class="op" id="6000843">.</span><span class="ident" id="6000844">parseDeferStmt</span><span class="op" id="6000858">(</span><span class="op" id="6000859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000862">case</span>&nbsp;<span class="ident" id="6000867">token</span><span class="op" id="6000872">.</span><span class="ident" id="6000873">RETURN</span><span class="op" id="6000879">:</span><br>
<span class="lineno">2140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000883">s</span>&nbsp;<span class="op" id="6000885">=</span>&nbsp;<span class="ident" id="6000887">p</span><span class="op" id="6000888">.</span><span class="ident" id="6000889">parseReturnStmt</span><span class="op" id="6000904">(</span><span class="op" id="6000905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000908">case</span>&nbsp;<span class="ident" id="6000913">token</span><span class="op" id="6000918">.</span><span class="ident" id="6000919">BREAK</span><span class="op" id="6000924">,</span>&nbsp;<span class="ident" id="6000926">token</span><span class="op" id="6000931">.</span><span class="ident" id="6000932">CONTINUE</span><span class="op" id="6000940">,</span>&nbsp;<span class="ident" id="6000942">token</span><span class="op" id="6000947">.</span><span class="ident" id="6000948">GOTO</span><span class="op" id="6000952">,</span>&nbsp;<span class="ident" id="6000954">token</span><span class="op" id="6000959">.</span><span class="ident" id="6000960">FALLTHROUGH</span><span class="op" id="6000971">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000975">s</span>&nbsp;<span class="op" id="6000977">=</span>&nbsp;<span class="ident" id="6000979">p</span><span class="op" id="6000980">.</span><span class="ident" id="6000981">parseBranchStmt</span><span class="op" id="6000996">(</span><span class="ident" id="6000997">p</span><span class="op" id="6000998">.</span><span class="ident" id="6000999">tok</span><span class="op" id="6001002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001005">case</span>&nbsp;<span class="ident" id="6001010">token</span><span class="op" id="6001015">.</span><span class="ident" id="6001016">LBRACE</span><span class="op" id="6001022">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001026">s</span>&nbsp;<span class="op" id="6001028">=</span>&nbsp;<span class="ident" id="6001030">p</span><span class="op" id="6001031">.</span><span class="ident" id="6001032">parseBlockStmt</span><span class="op" id="6001046">(</span><span class="op" id="6001047">)</span><br>
<span class="lineno">2145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001051">p</span><span class="op" id="6001052">.</span><span class="ident" id="6001053">expectSemi</span><span class="op" id="6001063">(</span><span class="op" id="6001064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001067">case</span>&nbsp;<span class="ident" id="6001072">token</span><span class="op" id="6001077">.</span><span class="ident" id="6001078">IF</span><span class="op" id="6001080">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001084">s</span>&nbsp;<span class="op" id="6001086">=</span>&nbsp;<span class="ident" id="6001088">p</span><span class="op" id="6001089">.</span><span class="ident" id="6001090">parseIfStmt</span><span class="op" id="6001101">(</span><span class="op" id="6001102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001105">case</span>&nbsp;<span class="ident" id="6001110">token</span><span class="op" id="6001115">.</span><span class="ident" id="6001116">SWITCH</span><span class="op" id="6001122">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001126">s</span>&nbsp;<span class="op" id="6001128">=</span>&nbsp;<span class="ident" id="6001130">p</span><span class="op" id="6001131">.</span><span class="ident" id="6001132">parseSwitchStmt</span><span class="op" id="6001147">(</span><span class="op" id="6001148">)</span><br>
<span class="lineno">2150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001151">case</span>&nbsp;<span class="ident" id="6001156">token</span><span class="op" id="6001161">.</span><span class="ident" id="6001162">SELECT</span><span class="op" id="6001168">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001172">s</span>&nbsp;<span class="op" id="6001174">=</span>&nbsp;<span class="ident" id="6001176">p</span><span class="op" id="6001177">.</span><span class="ident" id="6001178">parseSelectStmt</span><span class="op" id="6001193">(</span><span class="op" id="6001194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001197">case</span>&nbsp;<span class="ident" id="6001202">token</span><span class="op" id="6001207">.</span><span class="ident" id="6001208">FOR</span><span class="op" id="6001211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001215">s</span>&nbsp;<span class="op" id="6001217">=</span>&nbsp;<span class="ident" id="6001219">p</span><span class="op" id="6001220">.</span><span class="ident" id="6001221">parseForStmt</span><span class="op" id="6001233">(</span><span class="op" id="6001234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001237">case</span>&nbsp;<span class="ident" id="6001242">token</span><span class="op" id="6001247">.</span><span class="ident" id="6001248">SEMICOLON</span><span class="op" id="6001257">:</span><br>
<span class="lineno">2155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001261">s</span>&nbsp;<span class="op" id="6001263">=</span>&nbsp;<span class="op" id="6001265">&amp;</span><span class="ident" id="6001266">ast</span><span class="op" id="6001269">.</span><span class="ident" id="6001270">EmptyStmt</span><span class="op" id="6001279">{</span><span class="ident" id="6001280">Semicolon</span><span class="op" id="6001289">:</span>&nbsp;<span class="ident" id="6001291">p</span><span class="op" id="6001292">.</span><span class="ident" id="6001293">pos</span><span class="op" id="6001296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001300">p</span><span class="op" id="6001301">.</span><span class="ident" id="6001302">next</span><span class="op" id="6001306">(</span><span class="op" id="6001307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001310">case</span>&nbsp;<span class="ident" id="6001315">token</span><span class="op" id="6001320">.</span><span class="ident" id="6001321">RBRACE</span><span class="op" id="6001327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001331">//&nbsp;a&nbsp;semicolon&nbsp;may&nbsp;be&nbsp;omitted&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#34;}&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001384">s</span>&nbsp;<span class="op" id="6001386">=</span>&nbsp;<span class="op" id="6001388">&amp;</span><span class="ident" id="6001389">ast</span><span class="op" id="6001392">.</span><span class="ident" id="6001393">EmptyStmt</span><span class="op" id="6001402">{</span><span class="ident" id="6001403">Semicolon</span><span class="op" id="6001412">:</span>&nbsp;<span class="ident" id="6001414">p</span><span class="op" id="6001415">.</span><span class="ident" id="6001416">pos</span><span class="op" id="6001419">}</span><br>
<span class="lineno">2160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001422">default</span><span class="op" id="6001429">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001433">//&nbsp;no&nbsp;statement&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001457">pos</span>&nbsp;<span class="op" id="6001461">:=</span>&nbsp;<span class="ident" id="6001464">p</span><span class="op" id="6001465">.</span><span class="ident" id="6001466">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001472">p</span><span class="op" id="6001473">.</span><span class="ident" id="6001474">errorExpected</span><span class="op" id="6001487">(</span><span class="ident" id="6001488">pos</span><span class="op" id="6001491">,</span>&nbsp;<span class="string" id="6001493">&#34;statement&#34;</span><span class="op" id="6001504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001508">syncStmt</span><span class="op" id="6001516">(</span><span class="ident" id="6001517">p</span><span class="op" id="6001518">)</span><br>
<span class="lineno">2165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001522">s</span>&nbsp;<span class="op" id="6001524">=</span>&nbsp;<span class="op" id="6001526">&amp;</span><span class="ident" id="6001527">ast</span><span class="op" id="6001530">.</span><span class="ident" id="6001531">BadStmt</span><span class="op" id="6001538">{</span><span class="ident" id="6001539">From</span><span class="op" id="6001543">:</span>&nbsp;<span class="ident" id="6001545">pos</span><span class="op" id="6001548">,</span>&nbsp;<span class="ident" id="6001550">To</span><span class="op" id="6001552">:</span>&nbsp;<span class="ident" id="6001554">p</span><span class="op" id="6001555">.</span><span class="ident" id="6001556">pos</span><span class="op" id="6001559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001566">return</span><br>
<span class="lineno"></span><span class="op" id="6001573">}</span><br>
<span class="lineno">2170</span><br>
<span class="lineno"></span><span class="comment" id="6001576">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6001656">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6001673">type</span>&nbsp;<span class="ident" id="6001678">parseSpecFunction</span>&nbsp;<span class="keyword" id="6001696">func</span><span class="op" id="6001700">(</span><span class="ident" id="6001701">doc</span>&nbsp;<span class="op" id="6001705">*</span><span class="ident" id="6001706">ast</span><span class="op" id="6001709">.</span><span class="ident" id="6001710">CommentGroup</span><span class="op" id="6001722">,</span>&nbsp;<span class="ident" id="6001724">keyword</span>&nbsp;<span class="ident" id="6001732">token</span><span class="op" id="6001737">.</span><span class="ident" id="6001738">Token</span><span class="op" id="6001743">,</span>&nbsp;<span class="ident" id="6001745">iota</span>&nbsp;<span class="builtintype" id="6001750">int</span><span class="op" id="6001753">)</span>&nbsp;<span class="ident" id="6001755">ast</span><span class="op" id="6001758">.</span><span class="ident" id="6001759">Spec</span><br>
<span class="lineno">2175</span><br>
<span class="lineno"></span><span class="keyword" id="6001765">func</span>&nbsp;<span class="ident" id="6001770">isValidImport</span><span class="op" id="6001783">(</span><span class="ident" id="6001784">lit</span>&nbsp;<span class="builtintype" id="6001788">string</span><span class="op" id="6001794">)</span>&nbsp;<span class="builtintype" id="6001796">bool</span>&nbsp;<span class="op" id="6001801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001804">const</span>&nbsp;<span class="ident" id="6001810">illegalChars</span>&nbsp;<span class="op" id="6001823">=</span>&nbsp;<span class="string" id="6001825">`!&#34;#$%&amp;&#39;()*,:;&lt;=&gt;?[\]^{|}`</span>&nbsp;<span class="op" id="6001852">+</span>&nbsp;<span class="string" id="6001854">&#34;`\uFFFD&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001865">s</span><span class="op" id="6001866">,</span>&nbsp;<span class="ident" id="6001868">_</span>&nbsp;<span class="op" id="6001870">:=</span>&nbsp;<span class="ident" id="6001873">strconv</span><span class="op" id="6001880">.</span><span class="ident" id="6001881">Unquote</span><span class="op" id="6001888">(</span><span class="ident" id="6001889">lit</span><span class="op" id="6001892">)</span>&nbsp;<span class="comment" id="6001894">//&nbsp;go/scanner&nbsp;returns&nbsp;a&nbsp;legal&nbsp;string&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001940">for</span>&nbsp;<span class="ident" id="6001944">_</span><span class="op" id="6001945">,</span>&nbsp;<span class="ident" id="6001947">r</span>&nbsp;<span class="op" id="6001949">:=</span>&nbsp;<span class="keyword" id="6001952">range</span>&nbsp;<span class="ident" id="6001958">s</span>&nbsp;<span class="op" id="6001960">{</span><br>
<span class="lineno">2180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001964">if</span>&nbsp;<span class="op" id="6001967">!</span><span class="ident" id="6001968">unicode</span><span class="op" id="6001975">.</span><span class="ident" id="6001976">IsGraphic</span><span class="op" id="6001985">(</span><span class="ident" id="6001986">r</span><span class="op" id="6001987">)</span>&nbsp;<span class="op" id="6001989">||</span>&nbsp;<span class="ident" id="6001992">unicode</span><span class="op" id="6001999">.</span><span class="ident" id="6002000">IsSpace</span><span class="op" id="6002007">(</span><span class="ident" id="6002008">r</span><span class="op" id="6002009">)</span>&nbsp;<span class="op" id="6002011">||</span>&nbsp;<span class="ident" id="6002014">strings</span><span class="op" id="6002021">.</span><span class="ident" id="6002022">ContainsRune</span><span class="op" id="6002034">(</span><span class="ident" id="6002035">illegalChars</span><span class="op" id="6002047">,</span>&nbsp;<span class="ident" id="6002049">r</span><span class="op" id="6002050">)</span>&nbsp;<span class="op" id="6002052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002057">return</span>&nbsp;<span class="ident" id="6002064">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002078">return</span>&nbsp;<span class="ident" id="6002085">s</span>&nbsp;<span class="op" id="6002087">!=</span>&nbsp;<span class="string" id="6002090">&#34;&#34;</span><br>
<span class="lineno">2185</span><span class="op" id="6002093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6002096">func</span>&nbsp;<span class="op" id="6002101">(</span><span class="ident" id="6002102">p</span>&nbsp;<span class="op" id="6002104">*</span><span class="ident" id="6002105">parser</span><span class="op" id="6002111">)</span>&nbsp;<span class="ident" id="6002113">parseImportSpec</span><span class="op" id="6002128">(</span><span class="ident" id="6002129">doc</span>&nbsp;<span class="op" id="6002133">*</span><span class="ident" id="6002134">ast</span><span class="op" id="6002137">.</span><span class="ident" id="6002138">CommentGroup</span><span class="op" id="6002150">,</span>&nbsp;<span class="ident" id="6002152">_</span>&nbsp;<span class="ident" id="6002154">token</span><span class="op" id="6002159">.</span><span class="ident" id="6002160">Token</span><span class="op" id="6002165">,</span>&nbsp;<span class="ident" id="6002167">_</span>&nbsp;<span class="builtintype" id="6002169">int</span><span class="op" id="6002172">)</span>&nbsp;<span class="ident" id="6002174">ast</span><span class="op" id="6002177">.</span><span class="ident" id="6002178">Spec</span>&nbsp;<span class="op" id="6002183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002186">if</span>&nbsp;<span class="ident" id="6002189">p</span><span class="op" id="6002190">.</span><span class="ident" id="6002191">trace</span>&nbsp;<span class="op" id="6002197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002201">defer</span>&nbsp;<span class="ident" id="6002207">un</span><span class="op" id="6002209">(</span><span class="ident" id="6002210">trace</span><span class="op" id="6002215">(</span><span class="ident" id="6002216">p</span><span class="op" id="6002217">,</span>&nbsp;<span class="string" id="6002219">&#34;ImportSpec&#34;</span><span class="op" id="6002231">)</span><span class="op" id="6002232">)</span><br>
<span class="lineno">2190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002239">var</span>&nbsp;<span class="ident" id="6002243">ident</span>&nbsp;<span class="op" id="6002249">*</span><span class="ident" id="6002250">ast</span><span class="op" id="6002253">.</span><span class="ident" id="6002254">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002261">switch</span>&nbsp;<span class="ident" id="6002268">p</span><span class="op" id="6002269">.</span><span class="ident" id="6002270">tok</span>&nbsp;<span class="op" id="6002274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002277">case</span>&nbsp;<span class="ident" id="6002282">token</span><span class="op" id="6002287">.</span><span class="ident" id="6002288">PERIOD</span><span class="op" id="6002294">:</span><br>
<span class="lineno">2195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002298">ident</span>&nbsp;<span class="op" id="6002304">=</span>&nbsp;<span class="op" id="6002306">&amp;</span><span class="ident" id="6002307">ast</span><span class="op" id="6002310">.</span><span class="ident" id="6002311">Ident</span><span class="op" id="6002316">{</span><span class="ident" id="6002317">NamePos</span><span class="op" id="6002324">:</span>&nbsp;<span class="ident" id="6002326">p</span><span class="op" id="6002327">.</span><span class="ident" id="6002328">pos</span><span class="op" id="6002331">,</span>&nbsp;<span class="ident" id="6002333">Name</span><span class="op" id="6002337">:</span>&nbsp;<span class="string" id="6002339">&#34;.&#34;</span><span class="op" id="6002342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002346">p</span><span class="op" id="6002347">.</span><span class="ident" id="6002348">next</span><span class="op" id="6002352">(</span><span class="op" id="6002353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002356">case</span>&nbsp;<span class="ident" id="6002361">token</span><span class="op" id="6002366">.</span><span class="ident" id="6002367">IDENT</span><span class="op" id="6002372">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002376">ident</span>&nbsp;<span class="op" id="6002382">=</span>&nbsp;<span class="ident" id="6002384">p</span><span class="op" id="6002385">.</span><span class="ident" id="6002386">parseIdent</span><span class="op" id="6002396">(</span><span class="op" id="6002397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002400">}</span><br>
<span class="lineno">2200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002404">pos</span>&nbsp;<span class="op" id="6002408">:=</span>&nbsp;<span class="ident" id="6002411">p</span><span class="op" id="6002412">.</span><span class="ident" id="6002413">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002418">var</span>&nbsp;<span class="ident" id="6002422">path</span>&nbsp;<span class="builtintype" id="6002427">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002435">if</span>&nbsp;<span class="ident" id="6002438">p</span><span class="op" id="6002439">.</span><span class="ident" id="6002440">tok</span>&nbsp;<span class="op" id="6002444">==</span>&nbsp;<span class="ident" id="6002447">token</span><span class="op" id="6002452">.</span><span class="ident" id="6002453">STRING</span>&nbsp;<span class="op" id="6002460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002464">path</span>&nbsp;<span class="op" id="6002469">=</span>&nbsp;<span class="ident" id="6002471">p</span><span class="op" id="6002472">.</span><span class="ident" id="6002473">lit</span><br>
<span class="lineno">2205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002479">if</span>&nbsp;<span class="op" id="6002482">!</span><span class="ident" id="6002483">isValidImport</span><span class="op" id="6002496">(</span><span class="ident" id="6002497">path</span><span class="op" id="6002501">)</span>&nbsp;<span class="op" id="6002503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002508">p</span><span class="op" id="6002509">.</span><span class="builtintype" id="6002510">error</span><span class="op" id="6002515">(</span><span class="ident" id="6002516">pos</span><span class="op" id="6002519">,</span>&nbsp;<span class="string" id="6002521">&#34;invalid&nbsp;import&nbsp;path:&nbsp;&#34;</span><span class="op" id="6002544">+</span><span class="ident" id="6002545">path</span><span class="op" id="6002549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002557">p</span><span class="op" id="6002558">.</span><span class="ident" id="6002559">next</span><span class="op" id="6002563">(</span><span class="op" id="6002564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002567">}</span>&nbsp;<span class="keyword" id="6002569">else</span>&nbsp;<span class="op" id="6002574">{</span><br>
<span class="lineno">2210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002578">p</span><span class="op" id="6002579">.</span><span class="ident" id="6002580">expect</span><span class="op" id="6002586">(</span><span class="ident" id="6002587">token</span><span class="op" id="6002592">.</span><span class="ident" id="6002593">STRING</span><span class="op" id="6002599">)</span>&nbsp;<span class="comment" id="6002601">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002636">p</span><span class="op" id="6002637">.</span><span class="ident" id="6002638">expectSemi</span><span class="op" id="6002648">(</span><span class="op" id="6002649">)</span>&nbsp;<span class="comment" id="6002651">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002692">//&nbsp;collect&nbsp;imports</span><br>
<span class="lineno">2215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002712">spec</span>&nbsp;<span class="op" id="6002717">:=</span>&nbsp;<span class="op" id="6002720">&amp;</span><span class="ident" id="6002721">ast</span><span class="op" id="6002724">.</span><span class="ident" id="6002725">ImportSpec</span><span class="op" id="6002735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002739">Doc</span><span class="op" id="6002742">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6002748">doc</span><span class="op" id="6002751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002755">Name</span><span class="op" id="6002759">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6002764">ident</span><span class="op" id="6002769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002773">Path</span><span class="op" id="6002777">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6002782">&amp;</span><span class="ident" id="6002783">ast</span><span class="op" id="6002786">.</span><span class="ident" id="6002787">BasicLit</span><span class="op" id="6002795">{</span><span class="ident" id="6002796">ValuePos</span><span class="op" id="6002804">:</span>&nbsp;<span class="ident" id="6002806">pos</span><span class="op" id="6002809">,</span>&nbsp;<span class="ident" id="6002811">Kind</span><span class="op" id="6002815">:</span>&nbsp;<span class="ident" id="6002817">token</span><span class="op" id="6002822">.</span><span class="ident" id="6002823">STRING</span><span class="op" id="6002829">,</span>&nbsp;<span class="ident" id="6002831">Value</span><span class="op" id="6002836">:</span>&nbsp;<span class="ident" id="6002838">path</span><span class="op" id="6002842">}</span><span class="op" id="6002843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002847">Comment</span><span class="op" id="6002854">:</span>&nbsp;<span class="ident" id="6002856">p</span><span class="op" id="6002857">.</span><span class="ident" id="6002858">lineComment</span><span class="op" id="6002869">,</span><br>
<span class="lineno">2220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002875">p</span><span class="op" id="6002876">.</span><span class="ident" id="6002877">imports</span>&nbsp;<span class="op" id="6002885">=</span>&nbsp;<span class="builtinfunc" id="6002887">append</span><span class="op" id="6002893">(</span><span class="ident" id="6002894">p</span><span class="op" id="6002895">.</span><span class="ident" id="6002896">imports</span><span class="op" id="6002903">,</span>&nbsp;<span class="ident" id="6002905">spec</span><span class="op" id="6002909">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002913">return</span>&nbsp;<span class="ident" id="6002920">spec</span><br>
<span class="lineno"></span><span class="op" id="6002925">}</span><br>
<span class="lineno">2225</span><br>
<span class="lineno"></span><span class="keyword" id="6002928">func</span>&nbsp;<span class="op" id="6002933">(</span><span class="ident" id="6002934">p</span>&nbsp;<span class="op" id="6002936">*</span><span class="ident" id="6002937">parser</span><span class="op" id="6002943">)</span>&nbsp;<span class="ident" id="6002945">parseValueSpec</span><span class="op" id="6002959">(</span><span class="ident" id="6002960">doc</span>&nbsp;<span class="op" id="6002964">*</span><span class="ident" id="6002965">ast</span><span class="op" id="6002968">.</span><span class="ident" id="6002969">CommentGroup</span><span class="op" id="6002981">,</span>&nbsp;<span class="ident" id="6002983">keyword</span>&nbsp;<span class="ident" id="6002991">token</span><span class="op" id="6002996">.</span><span class="ident" id="6002997">Token</span><span class="op" id="6003002">,</span>&nbsp;<span class="ident" id="6003004">iota</span>&nbsp;<span class="builtintype" id="6003009">int</span><span class="op" id="6003012">)</span>&nbsp;<span class="ident" id="6003014">ast</span><span class="op" id="6003017">.</span><span class="ident" id="6003018">Spec</span>&nbsp;<span class="op" id="6003023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003026">if</span>&nbsp;<span class="ident" id="6003029">p</span><span class="op" id="6003030">.</span><span class="ident" id="6003031">trace</span>&nbsp;<span class="op" id="6003037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003041">defer</span>&nbsp;<span class="ident" id="6003047">un</span><span class="op" id="6003049">(</span><span class="ident" id="6003050">trace</span><span class="op" id="6003055">(</span><span class="ident" id="6003056">p</span><span class="op" id="6003057">,</span>&nbsp;<span class="ident" id="6003059">keyword</span><span class="op" id="6003066">.</span><span class="ident" id="6003067">String</span><span class="op" id="6003073">(</span><span class="op" id="6003074">)</span><span class="op" id="6003075">+</span><span class="string" id="6003076">&#34;Spec&#34;</span><span class="op" id="6003082">)</span><span class="op" id="6003083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003086">}</span><br>
<span class="lineno">2230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003090">idents</span>&nbsp;<span class="op" id="6003097">:=</span>&nbsp;<span class="ident" id="6003100">p</span><span class="op" id="6003101">.</span><span class="ident" id="6003102">parseIdentList</span><span class="op" id="6003116">(</span><span class="op" id="6003117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003120">typ</span>&nbsp;<span class="op" id="6003124">:=</span>&nbsp;<span class="ident" id="6003127">p</span><span class="op" id="6003128">.</span><span class="ident" id="6003129">tryType</span><span class="op" id="6003136">(</span><span class="op" id="6003137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003140">var</span>&nbsp;<span class="ident" id="6003144">values</span>&nbsp;<span class="op" id="6003151">[</span><span class="op" id="6003152">]</span><span class="ident" id="6003153">ast</span><span class="op" id="6003156">.</span><span class="ident" id="6003157">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003163">//&nbsp;always&nbsp;permit&nbsp;optional&nbsp;initialization&nbsp;for&nbsp;more&nbsp;tolerant&nbsp;parsing</span><br>
<span class="lineno">2235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003231">if</span>&nbsp;<span class="ident" id="6003234">p</span><span class="op" id="6003235">.</span><span class="ident" id="6003236">tok</span>&nbsp;<span class="op" id="6003240">==</span>&nbsp;<span class="ident" id="6003243">token</span><span class="op" id="6003248">.</span><span class="ident" id="6003249">ASSIGN</span>&nbsp;<span class="op" id="6003256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003260">p</span><span class="op" id="6003261">.</span><span class="ident" id="6003262">next</span><span class="op" id="6003266">(</span><span class="op" id="6003267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003271">values</span>&nbsp;<span class="op" id="6003278">=</span>&nbsp;<span class="ident" id="6003280">p</span><span class="op" id="6003281">.</span><span class="ident" id="6003282">parseRhsList</span><span class="op" id="6003294">(</span><span class="op" id="6003295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003301">p</span><span class="op" id="6003302">.</span><span class="ident" id="6003303">expectSemi</span><span class="op" id="6003313">(</span><span class="op" id="6003314">)</span>&nbsp;<span class="comment" id="6003316">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno">2240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003357">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;constant&nbsp;or&nbsp;variable&nbsp;identifier&nbsp;declared&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003433">//&nbsp;a&nbsp;function&nbsp;begins&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;ConstSpec&nbsp;or&nbsp;VarSpec&nbsp;and&nbsp;ends&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003506">//&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003553">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno">2245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003626">spec</span>&nbsp;<span class="op" id="6003631">:=</span>&nbsp;<span class="op" id="6003634">&amp;</span><span class="ident" id="6003635">ast</span><span class="op" id="6003638">.</span><span class="ident" id="6003639">ValueSpec</span><span class="op" id="6003648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003652">Doc</span><span class="op" id="6003655">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6003661">doc</span><span class="op" id="6003664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003668">Names</span><span class="op" id="6003673">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6003677">idents</span><span class="op" id="6003683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003687">Type</span><span class="op" id="6003691">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6003696">typ</span><span class="op" id="6003699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003703">Values</span><span class="op" id="6003709">:</span>&nbsp;&nbsp;<span class="ident" id="6003712">values</span><span class="op" id="6003718">,</span><br>
<span class="lineno">2250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003722">Comment</span><span class="op" id="6003729">:</span>&nbsp;<span class="ident" id="6003731">p</span><span class="op" id="6003732">.</span><span class="ident" id="6003733">lineComment</span><span class="op" id="6003744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003750">kind</span>&nbsp;<span class="op" id="6003755">:=</span>&nbsp;<span class="ident" id="6003758">ast</span><span class="op" id="6003761">.</span><span class="ident" id="6003762">Con</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003767">if</span>&nbsp;<span class="ident" id="6003770">keyword</span>&nbsp;<span class="op" id="6003778">==</span>&nbsp;<span class="ident" id="6003781">token</span><span class="op" id="6003786">.</span><span class="ident" id="6003787">VAR</span>&nbsp;<span class="op" id="6003791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003795">kind</span>&nbsp;<span class="op" id="6003800">=</span>&nbsp;<span class="ident" id="6003802">ast</span><span class="op" id="6003805">.</span><span class="ident" id="6003806">Var</span><br>
<span class="lineno">2255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003814">p</span><span class="op" id="6003815">.</span><span class="ident" id="6003816">declare</span><span class="op" id="6003823">(</span><span class="ident" id="6003824">spec</span><span class="op" id="6003828">,</span>&nbsp;<span class="ident" id="6003830">iota</span><span class="op" id="6003834">,</span>&nbsp;<span class="ident" id="6003836">p</span><span class="op" id="6003837">.</span><span class="ident" id="6003838">topScope</span><span class="op" id="6003846">,</span>&nbsp;<span class="ident" id="6003848">kind</span><span class="op" id="6003852">,</span>&nbsp;<span class="ident" id="6003854">idents</span><span class="op" id="6003860">...</span><span class="op" id="6003863">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003867">return</span>&nbsp;<span class="ident" id="6003874">spec</span><br>
<span class="lineno"></span><span class="op" id="6003879">}</span><br>
<span class="lineno">2260</span><br>
<span class="lineno"></span><span class="keyword" id="6003882">func</span>&nbsp;<span class="op" id="6003887">(</span><span class="ident" id="6003888">p</span>&nbsp;<span class="op" id="6003890">*</span><span class="ident" id="6003891">parser</span><span class="op" id="6003897">)</span>&nbsp;<span class="ident" id="6003899">parseTypeSpec</span><span class="op" id="6003912">(</span><span class="ident" id="6003913">doc</span>&nbsp;<span class="op" id="6003917">*</span><span class="ident" id="6003918">ast</span><span class="op" id="6003921">.</span><span class="ident" id="6003922">CommentGroup</span><span class="op" id="6003934">,</span>&nbsp;<span class="ident" id="6003936">_</span>&nbsp;<span class="ident" id="6003938">token</span><span class="op" id="6003943">.</span><span class="ident" id="6003944">Token</span><span class="op" id="6003949">,</span>&nbsp;<span class="ident" id="6003951">_</span>&nbsp;<span class="builtintype" id="6003953">int</span><span class="op" id="6003956">)</span>&nbsp;<span class="ident" id="6003958">ast</span><span class="op" id="6003961">.</span><span class="ident" id="6003962">Spec</span>&nbsp;<span class="op" id="6003967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003970">if</span>&nbsp;<span class="ident" id="6003973">p</span><span class="op" id="6003974">.</span><span class="ident" id="6003975">trace</span>&nbsp;<span class="op" id="6003981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003985">defer</span>&nbsp;<span class="ident" id="6003991">un</span><span class="op" id="6003993">(</span><span class="ident" id="6003994">trace</span><span class="op" id="6003999">(</span><span class="ident" id="6004000">p</span><span class="op" id="6004001">,</span>&nbsp;<span class="string" id="6004003">&#34;TypeSpec&#34;</span><span class="op" id="6004013">)</span><span class="op" id="6004014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004017">}</span><br>
<span class="lineno">2265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004021">ident</span>&nbsp;<span class="op" id="6004027">:=</span>&nbsp;<span class="ident" id="6004030">p</span><span class="op" id="6004031">.</span><span class="ident" id="6004032">parseIdent</span><span class="op" id="6004042">(</span><span class="op" id="6004043">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004047">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;type&nbsp;identifier&nbsp;declared&nbsp;inside&nbsp;a&nbsp;function&nbsp;begins</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004125">//&nbsp;at&nbsp;the&nbsp;identifier&nbsp;in&nbsp;the&nbsp;TypeSpec&nbsp;and&nbsp;ends&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost</span><br>
<span class="lineno">2270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004200">//&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004222">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004295">spec</span>&nbsp;<span class="op" id="6004300">:=</span>&nbsp;<span class="op" id="6004303">&amp;</span><span class="ident" id="6004304">ast</span><span class="op" id="6004307">.</span><span class="ident" id="6004308">TypeSpec</span><span class="op" id="6004316">{</span><span class="ident" id="6004317">Doc</span><span class="op" id="6004320">:</span>&nbsp;<span class="ident" id="6004322">doc</span><span class="op" id="6004325">,</span>&nbsp;<span class="ident" id="6004327">Name</span><span class="op" id="6004331">:</span>&nbsp;<span class="ident" id="6004333">ident</span><span class="op" id="6004338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004341">p</span><span class="op" id="6004342">.</span><span class="ident" id="6004343">declare</span><span class="op" id="6004350">(</span><span class="ident" id="6004351">spec</span><span class="op" id="6004355">,</span>&nbsp;<span class="ident" id="6004357">nil</span><span class="op" id="6004360">,</span>&nbsp;<span class="ident" id="6004362">p</span><span class="op" id="6004363">.</span><span class="ident" id="6004364">topScope</span><span class="op" id="6004372">,</span>&nbsp;<span class="ident" id="6004374">ast</span><span class="op" id="6004377">.</span><span class="ident" id="6004378">Typ</span><span class="op" id="6004381">,</span>&nbsp;<span class="ident" id="6004383">ident</span><span class="op" id="6004388">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004392">spec</span><span class="op" id="6004396">.</span><span class="ident" id="6004397">Type</span>&nbsp;<span class="op" id="6004402">=</span>&nbsp;<span class="ident" id="6004404">p</span><span class="op" id="6004405">.</span><span class="ident" id="6004406">parseType</span><span class="op" id="6004415">(</span><span class="op" id="6004416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004419">p</span><span class="op" id="6004420">.</span><span class="ident" id="6004421">expectSemi</span><span class="op" id="6004431">(</span><span class="op" id="6004432">)</span>&nbsp;<span class="comment" id="6004434">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004474">spec</span><span class="op" id="6004478">.</span><span class="ident" id="6004479">Comment</span>&nbsp;<span class="op" id="6004487">=</span>&nbsp;<span class="ident" id="6004489">p</span><span class="op" id="6004490">.</span><span class="ident" id="6004491">lineComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004505">return</span>&nbsp;<span class="ident" id="6004512">spec</span><br>
<span class="lineno">2280</span><span class="op" id="6004517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6004520">func</span>&nbsp;<span class="op" id="6004525">(</span><span class="ident" id="6004526">p</span>&nbsp;<span class="op" id="6004528">*</span><span class="ident" id="6004529">parser</span><span class="op" id="6004535">)</span>&nbsp;<span class="ident" id="6004537">parseGenDecl</span><span class="op" id="6004549">(</span><span class="ident" id="6004550">keyword</span>&nbsp;<span class="ident" id="6004558">token</span><span class="op" id="6004563">.</span><span class="ident" id="6004564">Token</span><span class="op" id="6004569">,</span>&nbsp;<span class="ident" id="6004571">f</span>&nbsp;<span class="ident" id="6004573">parseSpecFunction</span><span class="op" id="6004590">)</span>&nbsp;<span class="op" id="6004592">*</span><span class="ident" id="6004593">ast</span><span class="op" id="6004596">.</span><span class="ident" id="6004597">GenDecl</span>&nbsp;<span class="op" id="6004605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004608">if</span>&nbsp;<span class="ident" id="6004611">p</span><span class="op" id="6004612">.</span><span class="ident" id="6004613">trace</span>&nbsp;<span class="op" id="6004619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004623">defer</span>&nbsp;<span class="ident" id="6004629">un</span><span class="op" id="6004631">(</span><span class="ident" id="6004632">trace</span><span class="op" id="6004637">(</span><span class="ident" id="6004638">p</span><span class="op" id="6004639">,</span>&nbsp;<span class="string" id="6004641">&#34;GenDecl(&#34;</span><span class="op" id="6004651">+</span><span class="ident" id="6004652">keyword</span><span class="op" id="6004659">.</span><span class="ident" id="6004660">String</span><span class="op" id="6004666">(</span><span class="op" id="6004667">)</span><span class="op" id="6004668">+</span><span class="string" id="6004669">&#34;)&#34;</span><span class="op" id="6004672">)</span><span class="op" id="6004673">)</span><br>
<span class="lineno">2285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004680">doc</span>&nbsp;<span class="op" id="6004684">:=</span>&nbsp;<span class="ident" id="6004687">p</span><span class="op" id="6004688">.</span><span class="ident" id="6004689">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004702">pos</span>&nbsp;<span class="op" id="6004706">:=</span>&nbsp;<span class="ident" id="6004709">p</span><span class="op" id="6004710">.</span><span class="ident" id="6004711">expect</span><span class="op" id="6004717">(</span><span class="ident" id="6004718">keyword</span><span class="op" id="6004725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004728">var</span>&nbsp;<span class="ident" id="6004732">lparen</span><span class="op" id="6004738">,</span>&nbsp;<span class="ident" id="6004740">rparen</span>&nbsp;<span class="ident" id="6004747">token</span><span class="op" id="6004752">.</span><span class="ident" id="6004753">Pos</span><br>
<span class="lineno">2290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004758">var</span>&nbsp;<span class="ident" id="6004762">list</span>&nbsp;<span class="op" id="6004767">[</span><span class="op" id="6004768">]</span><span class="ident" id="6004769">ast</span><span class="op" id="6004772">.</span><span class="ident" id="6004773">Spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004779">if</span>&nbsp;<span class="ident" id="6004782">p</span><span class="op" id="6004783">.</span><span class="ident" id="6004784">tok</span>&nbsp;<span class="op" id="6004788">==</span>&nbsp;<span class="ident" id="6004791">token</span><span class="op" id="6004796">.</span><span class="ident" id="6004797">LPAREN</span>&nbsp;<span class="op" id="6004804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004808">lparen</span>&nbsp;<span class="op" id="6004815">=</span>&nbsp;<span class="ident" id="6004817">p</span><span class="op" id="6004818">.</span><span class="ident" id="6004819">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004825">p</span><span class="op" id="6004826">.</span><span class="ident" id="6004827">next</span><span class="op" id="6004831">(</span><span class="op" id="6004832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004836">for</span>&nbsp;<span class="ident" id="6004840">iota</span>&nbsp;<span class="op" id="6004845">:=</span>&nbsp;<span class="num" id="6004848">0</span><span class="op" id="6004849">;</span>&nbsp;<span class="ident" id="6004851">p</span><span class="op" id="6004852">.</span><span class="ident" id="6004853">tok</span>&nbsp;<span class="op" id="6004857">!=</span>&nbsp;<span class="ident" id="6004860">token</span><span class="op" id="6004865">.</span><span class="ident" id="6004866">RPAREN</span>&nbsp;<span class="op" id="6004873">&amp;&amp;</span>&nbsp;<span class="ident" id="6004876">p</span><span class="op" id="6004877">.</span><span class="ident" id="6004878">tok</span>&nbsp;<span class="op" id="6004882">!=</span>&nbsp;<span class="ident" id="6004885">token</span><span class="op" id="6004890">.</span><span class="ident" id="6004891">EOF</span><span class="op" id="6004894">;</span>&nbsp;<span class="ident" id="6004896">iota</span><span class="op" id="6004900">++</span>&nbsp;<span class="op" id="6004903">{</span><br>
<span class="lineno">2295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004908">list</span>&nbsp;<span class="op" id="6004913">=</span>&nbsp;<span class="builtinfunc" id="6004915">append</span><span class="op" id="6004921">(</span><span class="ident" id="6004922">list</span><span class="op" id="6004926">,</span>&nbsp;<span class="ident" id="6004928">f</span><span class="op" id="6004929">(</span><span class="ident" id="6004930">p</span><span class="op" id="6004931">.</span><span class="ident" id="6004932">leadComment</span><span class="op" id="6004943">,</span>&nbsp;<span class="ident" id="6004945">keyword</span><span class="op" id="6004952">,</span>&nbsp;<span class="ident" id="6004954">iota</span><span class="op" id="6004958">)</span><span class="op" id="6004959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004967">rparen</span>&nbsp;<span class="op" id="6004974">=</span>&nbsp;<span class="ident" id="6004976">p</span><span class="op" id="6004977">.</span><span class="ident" id="6004978">expect</span><span class="op" id="6004984">(</span><span class="ident" id="6004985">token</span><span class="op" id="6004990">.</span><span class="ident" id="6004991">RPAREN</span><span class="op" id="6004997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005001">p</span><span class="op" id="6005002">.</span><span class="ident" id="6005003">expectSemi</span><span class="op" id="6005013">(</span><span class="op" id="6005014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005017">}</span>&nbsp;<span class="keyword" id="6005019">else</span>&nbsp;<span class="op" id="6005024">{</span><br>
<span class="lineno">2300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005028">list</span>&nbsp;<span class="op" id="6005033">=</span>&nbsp;<span class="builtinfunc" id="6005035">append</span><span class="op" id="6005041">(</span><span class="ident" id="6005042">list</span><span class="op" id="6005046">,</span>&nbsp;<span class="ident" id="6005048">f</span><span class="op" id="6005049">(</span><span class="ident" id="6005050">nil</span><span class="op" id="6005053">,</span>&nbsp;<span class="ident" id="6005055">keyword</span><span class="op" id="6005062">,</span>&nbsp;<span class="num" id="6005064">0</span><span class="op" id="6005065">)</span><span class="op" id="6005066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005073">return</span>&nbsp;<span class="op" id="6005080">&amp;</span><span class="ident" id="6005081">ast</span><span class="op" id="6005084">.</span><span class="ident" id="6005085">GenDecl</span><span class="op" id="6005092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005096">Doc</span><span class="op" id="6005099">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005104">doc</span><span class="op" id="6005107">,</span><br>
<span class="lineno">2305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005111">TokPos</span><span class="op" id="6005117">:</span>&nbsp;<span class="ident" id="6005119">pos</span><span class="op" id="6005122">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005126">Tok</span><span class="op" id="6005129">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005134">keyword</span><span class="op" id="6005141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005145">Lparen</span><span class="op" id="6005151">:</span>&nbsp;<span class="ident" id="6005153">lparen</span><span class="op" id="6005159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005163">Specs</span><span class="op" id="6005168">:</span>&nbsp;&nbsp;<span class="ident" id="6005171">list</span><span class="op" id="6005175">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005179">Rparen</span><span class="op" id="6005185">:</span>&nbsp;<span class="ident" id="6005187">rparen</span><span class="op" id="6005193">,</span><br>
<span class="lineno">2310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005196">}</span><br>
<span class="lineno"></span><span class="op" id="6005198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6005201">func</span>&nbsp;<span class="op" id="6005206">(</span><span class="ident" id="6005207">p</span>&nbsp;<span class="op" id="6005209">*</span><span class="ident" id="6005210">parser</span><span class="op" id="6005216">)</span>&nbsp;<span class="ident" id="6005218">parseFuncDecl</span><span class="op" id="6005231">(</span><span class="op" id="6005232">)</span>&nbsp;<span class="op" id="6005234">*</span><span class="ident" id="6005235">ast</span><span class="op" id="6005238">.</span><span class="ident" id="6005239">FuncDecl</span>&nbsp;<span class="op" id="6005248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005251">if</span>&nbsp;<span class="ident" id="6005254">p</span><span class="op" id="6005255">.</span><span class="ident" id="6005256">trace</span>&nbsp;<span class="op" id="6005262">{</span><br>
<span class="lineno">2315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005266">defer</span>&nbsp;<span class="ident" id="6005272">un</span><span class="op" id="6005274">(</span><span class="ident" id="6005275">trace</span><span class="op" id="6005280">(</span><span class="ident" id="6005281">p</span><span class="op" id="6005282">,</span>&nbsp;<span class="string" id="6005284">&#34;FunctionDecl&#34;</span><span class="op" id="6005298">)</span><span class="op" id="6005299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005306">doc</span>&nbsp;<span class="op" id="6005310">:=</span>&nbsp;<span class="ident" id="6005313">p</span><span class="op" id="6005314">.</span><span class="ident" id="6005315">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005328">pos</span>&nbsp;<span class="op" id="6005332">:=</span>&nbsp;<span class="ident" id="6005335">p</span><span class="op" id="6005336">.</span><span class="ident" id="6005337">expect</span><span class="op" id="6005343">(</span><span class="ident" id="6005344">token</span><span class="op" id="6005349">.</span><span class="ident" id="6005350">FUNC</span><span class="op" id="6005354">)</span><br>
<span class="lineno">2320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005357">scope</span>&nbsp;<span class="op" id="6005363">:=</span>&nbsp;<span class="ident" id="6005366">ast</span><span class="op" id="6005369">.</span><span class="ident" id="6005370">NewScope</span><span class="op" id="6005378">(</span><span class="ident" id="6005379">p</span><span class="op" id="6005380">.</span><span class="ident" id="6005381">topScope</span><span class="op" id="6005389">)</span>&nbsp;<span class="comment" id="6005391">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005411">var</span>&nbsp;<span class="ident" id="6005415">recv</span>&nbsp;<span class="op" id="6005420">*</span><span class="ident" id="6005421">ast</span><span class="op" id="6005424">.</span><span class="ident" id="6005425">FieldList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005436">if</span>&nbsp;<span class="ident" id="6005439">p</span><span class="op" id="6005440">.</span><span class="ident" id="6005441">tok</span>&nbsp;<span class="op" id="6005445">==</span>&nbsp;<span class="ident" id="6005448">token</span><span class="op" id="6005453">.</span><span class="ident" id="6005454">LPAREN</span>&nbsp;<span class="op" id="6005461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005465">recv</span>&nbsp;<span class="op" id="6005470">=</span>&nbsp;<span class="ident" id="6005472">p</span><span class="op" id="6005473">.</span><span class="ident" id="6005474">parseParameters</span><span class="op" id="6005489">(</span><span class="ident" id="6005490">scope</span><span class="op" id="6005495">,</span>&nbsp;<span class="ident" id="6005497">false</span><span class="op" id="6005502">)</span><br>
<span class="lineno">2325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005509">ident</span>&nbsp;<span class="op" id="6005515">:=</span>&nbsp;<span class="ident" id="6005518">p</span><span class="op" id="6005519">.</span><span class="ident" id="6005520">parseIdent</span><span class="op" id="6005530">(</span><span class="op" id="6005531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005535">params</span><span class="op" id="6005541">,</span>&nbsp;<span class="ident" id="6005543">results</span>&nbsp;<span class="op" id="6005551">:=</span>&nbsp;<span class="ident" id="6005554">p</span><span class="op" id="6005555">.</span><span class="ident" id="6005556">parseSignature</span><span class="op" id="6005570">(</span><span class="ident" id="6005571">scope</span><span class="op" id="6005576">)</span><br>
<span class="lineno">2330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005580">var</span>&nbsp;<span class="ident" id="6005584">body</span>&nbsp;<span class="op" id="6005589">*</span><span class="ident" id="6005590">ast</span><span class="op" id="6005593">.</span><span class="ident" id="6005594">BlockStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005605">if</span>&nbsp;<span class="ident" id="6005608">p</span><span class="op" id="6005609">.</span><span class="ident" id="6005610">tok</span>&nbsp;<span class="op" id="6005614">==</span>&nbsp;<span class="ident" id="6005617">token</span><span class="op" id="6005622">.</span><span class="ident" id="6005623">LBRACE</span>&nbsp;<span class="op" id="6005630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005634">body</span>&nbsp;<span class="op" id="6005639">=</span>&nbsp;<span class="ident" id="6005641">p</span><span class="op" id="6005642">.</span><span class="ident" id="6005643">parseBody</span><span class="op" id="6005652">(</span><span class="ident" id="6005653">scope</span><span class="op" id="6005658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005661">}</span><br>
<span class="lineno">2335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005664">p</span><span class="op" id="6005665">.</span><span class="ident" id="6005666">expectSemi</span><span class="op" id="6005676">(</span><span class="op" id="6005677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005681">decl</span>&nbsp;<span class="op" id="6005686">:=</span>&nbsp;<span class="op" id="6005689">&amp;</span><span class="ident" id="6005690">ast</span><span class="op" id="6005693">.</span><span class="ident" id="6005694">FuncDecl</span><span class="op" id="6005702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005706">Doc</span><span class="op" id="6005709">:</span>&nbsp;&nbsp;<span class="ident" id="6005712">doc</span><span class="op" id="6005715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005719">Recv</span><span class="op" id="6005723">:</span>&nbsp;<span class="ident" id="6005725">recv</span><span class="op" id="6005729">,</span><br>
<span class="lineno">2340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005733">Name</span><span class="op" id="6005737">:</span>&nbsp;<span class="ident" id="6005739">ident</span><span class="op" id="6005744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005748">Type</span><span class="op" id="6005752">:</span>&nbsp;<span class="op" id="6005754">&amp;</span><span class="ident" id="6005755">ast</span><span class="op" id="6005758">.</span><span class="ident" id="6005759">FuncType</span><span class="op" id="6005767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005772">Func</span><span class="op" id="6005776">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005781">pos</span><span class="op" id="6005784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005789">Params</span><span class="op" id="6005795">:</span>&nbsp;&nbsp;<span class="ident" id="6005798">params</span><span class="op" id="6005804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005809">Results</span><span class="op" id="6005816">:</span>&nbsp;<span class="ident" id="6005818">results</span><span class="op" id="6005825">,</span><br>
<span class="lineno">2345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005829">}</span><span class="op" id="6005830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005834">Body</span><span class="op" id="6005838">:</span>&nbsp;<span class="ident" id="6005840">body</span><span class="op" id="6005844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005850">if</span>&nbsp;<span class="ident" id="6005853">recv</span>&nbsp;<span class="op" id="6005858">==</span>&nbsp;<span class="ident" id="6005861">nil</span>&nbsp;<span class="op" id="6005865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005869">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;constant,&nbsp;type,</span><br>
<span class="lineno">2350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005937">//&nbsp;variable,&nbsp;or&nbsp;function&nbsp;(but&nbsp;not&nbsp;method)&nbsp;declared&nbsp;at&nbsp;top&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006003">//&nbsp;(outside&nbsp;any&nbsp;function)&nbsp;is&nbsp;the&nbsp;package&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006053">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006058">//&nbsp;init()&nbsp;functions&nbsp;cannot&nbsp;be&nbsp;referred&nbsp;to&nbsp;and&nbsp;there&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006116">//&nbsp;be&nbsp;more&nbsp;than&nbsp;one&nbsp;-&nbsp;don&#39;t&nbsp;put&nbsp;them&nbsp;in&nbsp;the&nbsp;pkgScope</span><br>
<span class="lineno">2355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006171">if</span>&nbsp;<span class="ident" id="6006174">ident</span><span class="op" id="6006179">.</span><span class="ident" id="6006180">Name</span>&nbsp;<span class="op" id="6006185">!=</span>&nbsp;<span class="string" id="6006188">&#34;init&#34;</span>&nbsp;<span class="op" id="6006195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006200">p</span><span class="op" id="6006201">.</span><span class="ident" id="6006202">declare</span><span class="op" id="6006209">(</span><span class="ident" id="6006210">decl</span><span class="op" id="6006214">,</span>&nbsp;<span class="ident" id="6006216">nil</span><span class="op" id="6006219">,</span>&nbsp;<span class="ident" id="6006221">p</span><span class="op" id="6006222">.</span><span class="ident" id="6006223">pkgScope</span><span class="op" id="6006231">,</span>&nbsp;<span class="ident" id="6006233">ast</span><span class="op" id="6006236">.</span><span class="ident" id="6006237">Fun</span><span class="op" id="6006240">,</span>&nbsp;<span class="ident" id="6006242">ident</span><span class="op" id="6006247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006258">return</span>&nbsp;<span class="ident" id="6006265">decl</span><br>
<span class="lineno"></span><span class="op" id="6006270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6006273">func</span>&nbsp;<span class="op" id="6006278">(</span><span class="ident" id="6006279">p</span>&nbsp;<span class="op" id="6006281">*</span><span class="ident" id="6006282">parser</span><span class="op" id="6006288">)</span>&nbsp;<span class="ident" id="6006290">parseDecl</span><span class="op" id="6006299">(</span><span class="ident" id="6006300">sync</span>&nbsp;<span class="keyword" id="6006305">func</span><span class="op" id="6006309">(</span><span class="op" id="6006310">*</span><span class="ident" id="6006311">parser</span><span class="op" id="6006317">)</span><span class="op" id="6006318">)</span>&nbsp;<span class="ident" id="6006320">ast</span><span class="op" id="6006323">.</span><span class="ident" id="6006324">Decl</span>&nbsp;<span class="op" id="6006329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006332">if</span>&nbsp;<span class="ident" id="6006335">p</span><span class="op" id="6006336">.</span><span class="ident" id="6006337">trace</span>&nbsp;<span class="op" id="6006343">{</span><br>
<span class="lineno">2365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006347">defer</span>&nbsp;<span class="ident" id="6006353">un</span><span class="op" id="6006355">(</span><span class="ident" id="6006356">trace</span><span class="op" id="6006361">(</span><span class="ident" id="6006362">p</span><span class="op" id="6006363">,</span>&nbsp;<span class="string" id="6006365">&#34;Declaration&#34;</span><span class="op" id="6006378">)</span><span class="op" id="6006379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006386">var</span>&nbsp;<span class="ident" id="6006390">f</span>&nbsp;<span class="ident" id="6006392">parseSpecFunction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006411">switch</span>&nbsp;<span class="ident" id="6006418">p</span><span class="op" id="6006419">.</span><span class="ident" id="6006420">tok</span>&nbsp;<span class="op" id="6006424">{</span><br>
<span class="lineno">2370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006427">case</span>&nbsp;<span class="ident" id="6006432">token</span><span class="op" id="6006437">.</span><span class="ident" id="6006438">CONST</span><span class="op" id="6006443">,</span>&nbsp;<span class="ident" id="6006445">token</span><span class="op" id="6006450">.</span><span class="ident" id="6006451">VAR</span><span class="op" id="6006454">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006458">f</span>&nbsp;<span class="op" id="6006460">=</span>&nbsp;<span class="ident" id="6006462">p</span><span class="op" id="6006463">.</span><span class="ident" id="6006464">parseValueSpec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006481">case</span>&nbsp;<span class="ident" id="6006486">token</span><span class="op" id="6006491">.</span><span class="ident" id="6006492">TYPE</span><span class="op" id="6006496">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006500">f</span>&nbsp;<span class="op" id="6006502">=</span>&nbsp;<span class="ident" id="6006504">p</span><span class="op" id="6006505">.</span><span class="ident" id="6006506">parseTypeSpec</span><br>
<span class="lineno">2375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006522">case</span>&nbsp;<span class="ident" id="6006527">token</span><span class="op" id="6006532">.</span><span class="ident" id="6006533">FUNC</span><span class="op" id="6006537">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006541">return</span>&nbsp;<span class="ident" id="6006548">p</span><span class="op" id="6006549">.</span><span class="ident" id="6006550">parseFuncDecl</span><span class="op" id="6006563">(</span><span class="op" id="6006564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006568">default</span><span class="op" id="6006575">:</span><br>
<span class="lineno">2380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006579">pos</span>&nbsp;<span class="op" id="6006583">:=</span>&nbsp;<span class="ident" id="6006586">p</span><span class="op" id="6006587">.</span><span class="ident" id="6006588">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006594">p</span><span class="op" id="6006595">.</span><span class="ident" id="6006596">errorExpected</span><span class="op" id="6006609">(</span><span class="ident" id="6006610">pos</span><span class="op" id="6006613">,</span>&nbsp;<span class="string" id="6006615">&#34;declaration&#34;</span><span class="op" id="6006628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006632">sync</span><span class="op" id="6006636">(</span><span class="ident" id="6006637">p</span><span class="op" id="6006638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006642">return</span>&nbsp;<span class="op" id="6006649">&amp;</span><span class="ident" id="6006650">ast</span><span class="op" id="6006653">.</span><span class="ident" id="6006654">BadDecl</span><span class="op" id="6006661">{</span><span class="ident" id="6006662">From</span><span class="op" id="6006666">:</span>&nbsp;<span class="ident" id="6006668">pos</span><span class="op" id="6006671">,</span>&nbsp;<span class="ident" id="6006673">To</span><span class="op" id="6006675">:</span>&nbsp;<span class="ident" id="6006677">p</span><span class="op" id="6006678">.</span><span class="ident" id="6006679">pos</span><span class="op" id="6006682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006685">}</span><br>
<span class="lineno">2385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006689">return</span>&nbsp;<span class="ident" id="6006696">p</span><span class="op" id="6006697">.</span><span class="ident" id="6006698">parseGenDecl</span><span class="op" id="6006710">(</span><span class="ident" id="6006711">p</span><span class="op" id="6006712">.</span><span class="ident" id="6006713">tok</span><span class="op" id="6006716">,</span>&nbsp;<span class="ident" id="6006718">f</span><span class="op" id="6006719">)</span><br>
<span class="lineno"></span><span class="op" id="6006721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6006724">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">2390</span><span class="comment" id="6006804">//&nbsp;Source&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6006821">func</span>&nbsp;<span class="op" id="6006826">(</span><span class="ident" id="6006827">p</span>&nbsp;<span class="op" id="6006829">*</span><span class="ident" id="6006830">parser</span><span class="op" id="6006836">)</span>&nbsp;<span class="ident" id="6006838">parseFile</span><span class="op" id="6006847">(</span><span class="op" id="6006848">)</span>&nbsp;<span class="op" id="6006850">*</span><span class="ident" id="6006851">ast</span><span class="op" id="6006854">.</span><span class="ident" id="6006855">File</span>&nbsp;<span class="op" id="6006860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006863">if</span>&nbsp;<span class="ident" id="6006866">p</span><span class="op" id="6006867">.</span><span class="ident" id="6006868">trace</span>&nbsp;<span class="op" id="6006874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006878">defer</span>&nbsp;<span class="ident" id="6006884">un</span><span class="op" id="6006886">(</span><span class="ident" id="6006887">trace</span><span class="op" id="6006892">(</span><span class="ident" id="6006893">p</span><span class="op" id="6006894">,</span>&nbsp;<span class="string" id="6006896">&#34;File&#34;</span><span class="op" id="6006902">)</span><span class="op" id="6006903">)</span><br>
<span class="lineno">2395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006910">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;scanning&nbsp;the&nbsp;first&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006987">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007027">if</span>&nbsp;<span class="ident" id="6007030">p</span><span class="op" id="6007031">.</span><span class="ident" id="6007032">errors</span><span class="op" id="6007038">.</span><span class="ident" id="6007039">Len</span><span class="op" id="6007042">(</span><span class="op" id="6007043">)</span>&nbsp;<span class="op" id="6007045">!=</span>&nbsp;<span class="num" id="6007048">0</span>&nbsp;<span class="op" id="6007050">{</span><br>
<span class="lineno">2400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007054">return</span>&nbsp;<span class="ident" id="6007061">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007070">//&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007089">doc</span>&nbsp;<span class="op" id="6007093">:=</span>&nbsp;<span class="ident" id="6007096">p</span><span class="op" id="6007097">.</span><span class="ident" id="6007098">leadComment</span><br>
<span class="lineno">2405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007111">pos</span>&nbsp;<span class="op" id="6007115">:=</span>&nbsp;<span class="ident" id="6007118">p</span><span class="op" id="6007119">.</span><span class="ident" id="6007120">expect</span><span class="op" id="6007126">(</span><span class="ident" id="6007127">token</span><span class="op" id="6007132">.</span><span class="ident" id="6007133">PACKAGE</span><span class="op" id="6007140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007143">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;package&nbsp;clause&nbsp;is&nbsp;not&nbsp;a&nbsp;declaration;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007197">//&nbsp;the&nbsp;package&nbsp;name&nbsp;does&nbsp;not&nbsp;appear&nbsp;in&nbsp;any&nbsp;scope.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007248">ident</span>&nbsp;<span class="op" id="6007254">:=</span>&nbsp;<span class="ident" id="6007257">p</span><span class="op" id="6007258">.</span><span class="ident" id="6007259">parseIdent</span><span class="op" id="6007269">(</span><span class="op" id="6007270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007273">if</span>&nbsp;<span class="ident" id="6007276">ident</span><span class="op" id="6007281">.</span><span class="ident" id="6007282">Name</span>&nbsp;<span class="op" id="6007287">==</span>&nbsp;<span class="string" id="6007290">&#34;_&#34;</span>&nbsp;<span class="op" id="6007294">&amp;&amp;</span>&nbsp;<span class="ident" id="6007297">p</span><span class="op" id="6007298">.</span><span class="ident" id="6007299">mode</span><span class="op" id="6007303">&amp;</span><span class="ident" id="6007304">DeclarationErrors</span>&nbsp;<span class="op" id="6007322">!=</span>&nbsp;<span class="num" id="6007325">0</span>&nbsp;<span class="op" id="6007327">{</span><br>
<span class="lineno">2410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007331">p</span><span class="op" id="6007332">.</span><span class="builtintype" id="6007333">error</span><span class="op" id="6007338">(</span><span class="ident" id="6007339">p</span><span class="op" id="6007340">.</span><span class="ident" id="6007341">pos</span><span class="op" id="6007344">,</span>&nbsp;<span class="string" id="6007346">&#34;invalid&nbsp;package&nbsp;name&nbsp;_&#34;</span><span class="op" id="6007370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007376">p</span><span class="op" id="6007377">.</span><span class="ident" id="6007378">expectSemi</span><span class="op" id="6007388">(</span><span class="op" id="6007389">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007393">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;parsing&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno">2415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007472">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007512">if</span>&nbsp;<span class="ident" id="6007515">p</span><span class="op" id="6007516">.</span><span class="ident" id="6007517">errors</span><span class="op" id="6007523">.</span><span class="ident" id="6007524">Len</span><span class="op" id="6007527">(</span><span class="op" id="6007528">)</span>&nbsp;<span class="op" id="6007530">!=</span>&nbsp;<span class="num" id="6007533">0</span>&nbsp;<span class="op" id="6007535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007539">return</span>&nbsp;<span class="ident" id="6007546">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007555">p</span><span class="op" id="6007556">.</span><span class="ident" id="6007557">openScope</span><span class="op" id="6007566">(</span><span class="op" id="6007567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007570">p</span><span class="op" id="6007571">.</span><span class="ident" id="6007572">pkgScope</span>&nbsp;<span class="op" id="6007581">=</span>&nbsp;<span class="ident" id="6007583">p</span><span class="op" id="6007584">.</span><span class="ident" id="6007585">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007595">var</span>&nbsp;<span class="ident" id="6007599">decls</span>&nbsp;<span class="op" id="6007605">[</span><span class="op" id="6007606">]</span><span class="ident" id="6007607">ast</span><span class="op" id="6007610">.</span><span class="ident" id="6007611">Decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007617">if</span>&nbsp;<span class="ident" id="6007620">p</span><span class="op" id="6007621">.</span><span class="ident" id="6007622">mode</span><span class="op" id="6007626">&amp;</span><span class="ident" id="6007627">PackageClauseOnly</span>&nbsp;<span class="op" id="6007645">==</span>&nbsp;<span class="num" id="6007648">0</span>&nbsp;<span class="op" id="6007650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007654">//&nbsp;import&nbsp;decls</span><br>
<span class="lineno">2425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007672">for</span>&nbsp;<span class="ident" id="6007676">p</span><span class="op" id="6007677">.</span><span class="ident" id="6007678">tok</span>&nbsp;<span class="op" id="6007682">==</span>&nbsp;<span class="ident" id="6007685">token</span><span class="op" id="6007690">.</span><span class="ident" id="6007691">IMPORT</span>&nbsp;<span class="op" id="6007698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007703">decls</span>&nbsp;<span class="op" id="6007709">=</span>&nbsp;<span class="builtinfunc" id="6007711">append</span><span class="op" id="6007717">(</span><span class="ident" id="6007718">decls</span><span class="op" id="6007723">,</span>&nbsp;<span class="ident" id="6007725">p</span><span class="op" id="6007726">.</span><span class="ident" id="6007727">parseGenDecl</span><span class="op" id="6007739">(</span><span class="ident" id="6007740">token</span><span class="op" id="6007745">.</span><span class="ident" id="6007746">IMPORT</span><span class="op" id="6007752">,</span>&nbsp;<span class="ident" id="6007754">p</span><span class="op" id="6007755">.</span><span class="ident" id="6007756">parseImportSpec</span><span class="op" id="6007771">)</span><span class="op" id="6007772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007781">if</span>&nbsp;<span class="ident" id="6007784">p</span><span class="op" id="6007785">.</span><span class="ident" id="6007786">mode</span><span class="op" id="6007790">&amp;</span><span class="ident" id="6007791">ImportsOnly</span>&nbsp;<span class="op" id="6007803">==</span>&nbsp;<span class="num" id="6007806">0</span>&nbsp;<span class="op" id="6007808">{</span><br>
<span class="lineno">2430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007813">//&nbsp;rest&nbsp;of&nbsp;package&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007840">for</span>&nbsp;<span class="ident" id="6007844">p</span><span class="op" id="6007845">.</span><span class="ident" id="6007846">tok</span>&nbsp;<span class="op" id="6007850">!=</span>&nbsp;<span class="ident" id="6007853">token</span><span class="op" id="6007858">.</span><span class="ident" id="6007859">EOF</span>&nbsp;<span class="op" id="6007863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007869">decls</span>&nbsp;<span class="op" id="6007875">=</span>&nbsp;<span class="builtinfunc" id="6007877">append</span><span class="op" id="6007883">(</span><span class="ident" id="6007884">decls</span><span class="op" id="6007889">,</span>&nbsp;<span class="ident" id="6007891">p</span><span class="op" id="6007892">.</span><span class="ident" id="6007893">parseDecl</span><span class="op" id="6007902">(</span><span class="ident" id="6007903">syncDecl</span><span class="op" id="6007911">)</span><span class="op" id="6007912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007921">}</span><br>
<span class="lineno">2435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007927">p</span><span class="op" id="6007928">.</span><span class="ident" id="6007929">closeScope</span><span class="op" id="6007939">(</span><span class="op" id="6007940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007943">assert</span><span class="op" id="6007949">(</span><span class="ident" id="6007950">p</span><span class="op" id="6007951">.</span><span class="ident" id="6007952">topScope</span>&nbsp;<span class="op" id="6007961">==</span>&nbsp;<span class="ident" id="6007964">nil</span><span class="op" id="6007967">,</span>&nbsp;<span class="string" id="6007969">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="6007988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007991">assert</span><span class="op" id="6007997">(</span><span class="ident" id="6007998">p</span><span class="op" id="6007999">.</span><span class="ident" id="6008000">labelScope</span>&nbsp;<span class="op" id="6008011">==</span>&nbsp;<span class="ident" id="6008014">nil</span><span class="op" id="6008017">,</span>&nbsp;<span class="string" id="6008019">&#34;unbalanced&nbsp;label&nbsp;scopes&#34;</span><span class="op" id="6008044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008048">//&nbsp;resolve&nbsp;global&nbsp;identifiers&nbsp;within&nbsp;the&nbsp;same&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008100">i</span>&nbsp;<span class="op" id="6008102">:=</span>&nbsp;<span class="num" id="6008105">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008108">for</span>&nbsp;<span class="ident" id="6008112">_</span><span class="op" id="6008113">,</span>&nbsp;<span class="ident" id="6008115">ident</span>&nbsp;<span class="op" id="6008121">:=</span>&nbsp;<span class="keyword" id="6008124">range</span>&nbsp;<span class="ident" id="6008130">p</span><span class="op" id="6008131">.</span><span class="ident" id="6008132">unresolved</span>&nbsp;<span class="op" id="6008143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008147">//&nbsp;i&nbsp;&lt;=&nbsp;index&nbsp;for&nbsp;current&nbsp;ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008181">assert</span><span class="op" id="6008187">(</span><span class="ident" id="6008188">ident</span><span class="op" id="6008193">.</span><span class="ident" id="6008194">Obj</span>&nbsp;<span class="op" id="6008198">==</span>&nbsp;<span class="ident" id="6008201">unresolved</span><span class="op" id="6008211">,</span>&nbsp;<span class="string" id="6008213">&#34;object&nbsp;already&nbsp;resolved&#34;</span><span class="op" id="6008238">)</span><br>
<span class="lineno">2445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008242">ident</span><span class="op" id="6008247">.</span><span class="ident" id="6008248">Obj</span>&nbsp;<span class="op" id="6008252">=</span>&nbsp;<span class="ident" id="6008254">p</span><span class="op" id="6008255">.</span><span class="ident" id="6008256">pkgScope</span><span class="op" id="6008264">.</span><span class="ident" id="6008265">Lookup</span><span class="op" id="6008271">(</span><span class="ident" id="6008272">ident</span><span class="op" id="6008277">.</span><span class="ident" id="6008278">Name</span><span class="op" id="6008282">)</span>&nbsp;<span class="comment" id="6008284">//&nbsp;also&nbsp;removes&nbsp;unresolved&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008322">if</span>&nbsp;<span class="ident" id="6008325">ident</span><span class="op" id="6008330">.</span><span class="ident" id="6008331">Obj</span>&nbsp;<span class="op" id="6008335">==</span>&nbsp;<span class="ident" id="6008338">nil</span>&nbsp;<span class="op" id="6008342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008347">p</span><span class="op" id="6008348">.</span><span class="ident" id="6008349">unresolved</span><span class="op" id="6008359">[</span><span class="ident" id="6008360">i</span><span class="op" id="6008361">]</span>&nbsp;<span class="op" id="6008363">=</span>&nbsp;<span class="ident" id="6008365">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008374">i</span><span class="op" id="6008375">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008380">}</span><br>
<span class="lineno">2450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008387">return</span>&nbsp;<span class="op" id="6008394">&amp;</span><span class="ident" id="6008395">ast</span><span class="op" id="6008398">.</span><span class="ident" id="6008399">File</span><span class="op" id="6008403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008407">Doc</span><span class="op" id="6008410">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008419">doc</span><span class="op" id="6008422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008426">Package</span><span class="op" id="6008433">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008438">pos</span><span class="op" id="6008441">,</span><br>
<span class="lineno">2455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008445">Name</span><span class="op" id="6008449">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008457">ident</span><span class="op" id="6008462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008466">Decls</span><span class="op" id="6008471">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008478">decls</span><span class="op" id="6008483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008487">Scope</span><span class="op" id="6008492">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008499">p</span><span class="op" id="6008500">.</span><span class="ident" id="6008501">pkgScope</span><span class="op" id="6008509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008513">Imports</span><span class="op" id="6008520">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008525">p</span><span class="op" id="6008526">.</span><span class="ident" id="6008527">imports</span><span class="op" id="6008534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008538">Unresolved</span><span class="op" id="6008548">:</span>&nbsp;<span class="ident" id="6008550">p</span><span class="op" id="6008551">.</span><span class="ident" id="6008552">unresolved</span><span class="op" id="6008562">[</span><span class="num" id="6008563">0</span><span class="op" id="6008564">:</span><span class="ident" id="6008565">i</span><span class="op" id="6008566">]</span><span class="op" id="6008567">,</span><br>
<span class="lineno">2460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008571">Comments</span><span class="op" id="6008579">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6008583">p</span><span class="op" id="6008584">.</span><span class="ident" id="6008585">comments</span><span class="op" id="6008593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008596">}</span><br>
<span class="lineno"></span><span class="op" id="6008598">}</span>
</div>
</body>
</html>
