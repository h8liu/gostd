<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5676601">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5676656">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5676710">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5676761">package</span>&nbsp;<span class="ident" id="5676769">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5676774">import</span>&nbsp;<span class="op" id="5676781">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5676784">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5676793">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5676812">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5676822">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5676830">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5676844">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5676849">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5676852">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="5676892">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5676940">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="5676980">type</span>&nbsp;<span class="ident" id="5676985">Writer</span>&nbsp;<span class="keyword" id="5676992">struct</span>&nbsp;<span class="op" id="5676999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677002">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5677009">*</span><span class="ident" id="5677010"><a href="/gostd/archive/zip/writer.go.html#5685638">countWriter</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677023">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5677030">[</span><span class="op" id="5677031">]</span><span class="op" id="5677032">*</span><span class="ident" id="5677033"><a href="/gostd/archive/zip/writer.go.html#5677081">header</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677041">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5677048">*</span><span class="ident" id="5677049"><a href="/gostd/archive/zip/writer.go.html#5683887">fileWriter</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677061">closed</span>&nbsp;<span class="builtintype" id="5677068">bool</span><br>
<span class="lineno">25</span><span class="op" id="5677073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5677076">type</span>&nbsp;<span class="ident" id="5677081">header</span>&nbsp;<span class="keyword" id="5677088">struct</span>&nbsp;<span class="op" id="5677095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5677098">*</span><span class="ident" id="5677099"><a href="/gostd/archive/zip/struct.go.html#5670169">FileHeader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677111">offset</span>&nbsp;<span class="builtintype" id="5677118">uint64</span><br>
<span class="lineno">30</span><span class="op" id="5677125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5677128">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5677187">func</span>&nbsp;<span class="ident" id="5677192">NewWriter</span><span class="op" id="5677201">(</span><span class="ident" id="5677202">w</span>&nbsp;<span class="ident" id="5677204"><a href="/gostd/archive/zip/writer.go.html#5676844">io</a></span><span class="op" id="5677206">.</span><span class="ident" id="5677207"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="5677213">)</span>&nbsp;<span class="op" id="5677215">*</span><span class="ident" id="5677216"><a href="/gostd/archive/zip/writer.go.html#5676985">Writer</a></span>&nbsp;<span class="op" id="5677223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677226">return</span>&nbsp;<span class="op" id="5677233">&amp;</span><span class="ident" id="5677234"><a href="/gostd/archive/zip/writer.go.html#5676985">Writer</a></span><span class="op" id="5677240">{</span><span class="ident" id="5677241"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5677243">:</span>&nbsp;<span class="op" id="5677245">&amp;</span><span class="ident" id="5677246"><a href="/gostd/archive/zip/writer.go.html#5685638">countWriter</a></span><span class="op" id="5677257">{</span><span class="ident" id="5677258"><a href="/gostd/archive/zip/writer.go.html#5685660">w</a></span><span class="op" id="5677259">:</span>&nbsp;<span class="ident" id="5677261"><a href="/gostd/archive/zip/writer.go.html#5676784">bufio</a></span><span class="op" id="5677266">.</span><span class="ident" id="5677267"><a href="/gostd/bufio/bufio.go.html#1367149">NewWriter</a></span><span class="op" id="5677276">(</span><span class="ident" id="5677277"><a href="/gostd/archive/zip/writer.go.html#5677202">w</a></span><span class="op" id="5677278">)</span><span class="op" id="5677279">}</span><span class="op" id="5677280">}</span><br>
<span class="lineno">35</span><span class="op" id="5677282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5677285">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="5677346">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="5677419">func</span>&nbsp;<span class="op" id="5677424">(</span><span class="ident" id="5677425">w</span>&nbsp;<span class="op" id="5677427">*</span><span class="ident" id="5677428"><a href="/gostd/archive/zip/writer.go.html#5676985">Writer</a></span><span class="op" id="5677434">)</span>&nbsp;<span class="ident" id="5677436">Flush</span><span class="op" id="5677441">(</span><span class="op" id="5677442">)</span>&nbsp;<span class="builtintype" id="5677444">error</span>&nbsp;<span class="op" id="5677450">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677453">return</span>&nbsp;<span class="ident" id="5677460"><a href="/gostd/archive/zip/writer.go.html#5677425">w</a></span><span class="op" id="5677461">.</span><span class="ident" id="5677462"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5677464">.</span><span class="ident" id="5677465"><a href="/gostd/archive/zip/writer.go.html#5685660">w</a></span><span class="op" id="5677466">.</span><span class="op" id="5677467">(</span><span class="op" id="5677468">*</span><span class="ident" id="5677469"><a href="/gostd/archive/zip/writer.go.html#5676784">bufio</a></span><span class="op" id="5677474">.</span><span class="ident" id="5677475"><a href="/gostd/bufio/bufio.go.html#1366565">Writer</a></span><span class="op" id="5677481">)</span><span class="op" id="5677482">.</span><span class="ident" id="5677483"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="5677488">(</span><span class="op" id="5677489">)</span><br>
<span class="lineno"></span><span class="op" id="5677491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5677494">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="5677567">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="5677625">func</span>&nbsp;<span class="op" id="5677630">(</span><span class="ident" id="5677631">w</span>&nbsp;<span class="op" id="5677633">*</span><span class="ident" id="5677634"><a href="/gostd/archive/zip/writer.go.html#5676985">Writer</a></span><span class="op" id="5677640">)</span>&nbsp;<span class="ident" id="5677642">Close</span><span class="op" id="5677647">(</span><span class="op" id="5677648">)</span>&nbsp;<span class="builtintype" id="5677650">error</span>&nbsp;<span class="op" id="5677656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677659">if</span>&nbsp;<span class="ident" id="5677662"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5677663">.</span><span class="ident" id="5677664"><a href="/gostd/archive/zip/writer.go.html#5677041">last</a></span>&nbsp;<span class="op" id="5677669">!=</span>&nbsp;<span class="builtintype" id="5677672">nil</span>&nbsp;<span class="op" id="5677676">&amp;&amp;</span>&nbsp;<span class="op" id="5677679">!</span><span class="ident" id="5677680"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5677681">.</span><span class="ident" id="5677682"><a href="/gostd/archive/zip/writer.go.html#5677041">last</a></span><span class="op" id="5677686">.</span><span class="ident" id="5677687"><a href="/gostd/archive/zip/writer.go.html#5684035">closed</a></span>&nbsp;<span class="op" id="5677694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677698">if</span>&nbsp;<span class="ident" id="5677701">err</span>&nbsp;<span class="op" id="5677705">:=</span>&nbsp;<span class="ident" id="5677708"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5677709">.</span><span class="ident" id="5677710"><a href="/gostd/archive/zip/writer.go.html#5677041">last</a></span><span class="op" id="5677714">.</span><span class="builtinfunc" id="5677715"><a href="/gostd/archive/zip/writer.go.html#5684245">close</a></span><span class="op" id="5677720">(</span><span class="op" id="5677721">)</span><span class="op" id="5677722">;</span>&nbsp;<span class="ident" id="5677724"><a href="/gostd/archive/zip/writer.go.html#5677701">err</a></span>&nbsp;<span class="op" id="5677728">!=</span>&nbsp;<span class="builtintype" id="5677731">nil</span>&nbsp;<span class="op" id="5677735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677740">return</span>&nbsp;<span class="ident" id="5677747"><a href="/gostd/archive/zip/writer.go.html#5677701">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5677753">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677757"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5677758">.</span><span class="ident" id="5677759"><a href="/gostd/archive/zip/writer.go.html#5677041">last</a></span>&nbsp;<span class="op" id="5677764">=</span>&nbsp;<span class="builtintype" id="5677766">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5677771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677774">if</span>&nbsp;<span class="ident" id="5677777"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5677778">.</span><span class="ident" id="5677779"><a href="/gostd/archive/zip/writer.go.html#5677061">closed</a></span>&nbsp;<span class="op" id="5677786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677790">return</span>&nbsp;<span class="ident" id="5677797"><a href="/gostd/archive/zip/writer.go.html#5676812">errors</a></span><span class="op" id="5677803">.</span><span class="ident" id="5677804"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5677807">(</span><span class="string" id="5677808">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="5677834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5677837">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677840"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5677841">.</span><span class="ident" id="5677842"><a href="/gostd/archive/zip/writer.go.html#5677061">closed</a></span>&nbsp;<span class="op" id="5677849">=</span>&nbsp;<span class="builtintype" id="5677851">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5677858">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677886">start</span>&nbsp;<span class="op" id="5677892">:=</span>&nbsp;<span class="ident" id="5677895"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5677896">.</span><span class="ident" id="5677897"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5677899">.</span><span class="ident" id="5677900"><a href="/gostd/archive/zip/writer.go.html#5685677">count</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677907">for</span>&nbsp;<span class="ident" id="5677911">_</span><span class="op" id="5677912">,</span>&nbsp;<span class="ident" id="5677914">h</span>&nbsp;<span class="op" id="5677916">:=</span>&nbsp;<span class="keyword" id="5677919">range</span>&nbsp;<span class="ident" id="5677925"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5677926">.</span><span class="ident" id="5677927"><a href="/gostd/archive/zip/writer.go.html#5677023">dir</a></span>&nbsp;<span class="op" id="5677931">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677935">var</span>&nbsp;<span class="ident" id="5677939">buf</span>&nbsp;<span class="op" id="5677943">[</span><span class="ident" id="5677944"><a href="/gostd/archive/zip/struct.go.html#5669256">directoryHeaderLen</a></span><span class="op" id="5677962">]</span><span class="builtintype" id="5677963">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677970">b</span>&nbsp;<span class="op" id="5677972">:=</span>&nbsp;<span class="ident" id="5677975"><a href="/gostd/archive/zip/writer.go.html#5685901">writeBuf</a></span><span class="op" id="5677983">(</span><span class="ident" id="5677984"><a href="/gostd/archive/zip/writer.go.html#5677939">buf</a></span><span class="op" id="5677987">[</span><span class="op" id="5677988">:</span><span class="op" id="5677989">]</span><span class="op" id="5677990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677994"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5677995">.</span><span class="builtintype" id="5677996"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5678002">(</span><span class="builtintype" id="5678003">uint32</span><span class="op" id="5678009">(</span><span class="ident" id="5678010"><a href="/gostd/archive/zip/struct.go.html#5668954">directoryHeaderSignature</a></span><span class="op" id="5678034">)</span><span class="op" id="5678035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678039"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678040">.</span><span class="builtintype" id="5678041"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5678047">(</span><span class="ident" id="5678048"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678049">.</span><span class="ident" id="5678050"><a href="/gostd/archive/zip/struct.go.html#5670382">CreatorVersion</a></span><span class="op" id="5678064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678068"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678069">.</span><span class="builtintype" id="5678070"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5678076">(</span><span class="ident" id="5678077"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678078">.</span><span class="ident" id="5678079"><a href="/gostd/archive/zip/struct.go.html#5670409">ReaderVersion</a></span><span class="op" id="5678092">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678096"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678097">.</span><span class="builtintype" id="5678098"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5678104">(</span><span class="ident" id="5678105"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678106">.</span><span class="ident" id="5678107"><a href="/gostd/archive/zip/struct.go.html#5670436">Flags</a></span><span class="op" id="5678112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678116"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678117">.</span><span class="builtintype" id="5678118"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5678124">(</span><span class="ident" id="5678125"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678126">.</span><span class="ident" id="5678127"><a href="/gostd/archive/zip/struct.go.html#5670463">Method</a></span><span class="op" id="5678133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678137"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678138">.</span><span class="builtintype" id="5678139"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5678145">(</span><span class="ident" id="5678146"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678147">.</span><span class="ident" id="5678148"><a href="/gostd/archive/zip/struct.go.html#5670490">ModifiedTime</a></span><span class="op" id="5678160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678164"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678165">.</span><span class="builtintype" id="5678166"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5678172">(</span><span class="ident" id="5678173"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678174">.</span><span class="ident" id="5678175"><a href="/gostd/archive/zip/struct.go.html#5670532">ModifiedDate</a></span><span class="op" id="5678187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678191"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678192">.</span><span class="builtintype" id="5678193"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5678199">(</span><span class="ident" id="5678200"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678201">.</span><span class="ident" id="5678202"><a href="/gostd/archive/zip/struct.go.html#5670574">CRC32</a></span><span class="op" id="5678207">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5678211">if</span>&nbsp;<span class="ident" id="5678214"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678215">.</span><span class="ident" id="5678216"><a href="/gostd/archive/zip/struct.go.html#5675216">isZip64</a></span><span class="op" id="5678223">(</span><span class="op" id="5678224">)</span>&nbsp;<span class="op" id="5678226">||</span>&nbsp;<span class="ident" id="5678229"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678230">.</span><span class="ident" id="5678231"><a href="/gostd/archive/zip/writer.go.html#5677111">offset</a></span>&nbsp;<span class="op" id="5678238">&gt;</span>&nbsp;<span class="ident" id="5678240"><a href="/gostd/archive/zip/struct.go.html#5669964">uint32max</a></span>&nbsp;<span class="op" id="5678250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5678255">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5678313">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5678376">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678417"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678418">.</span><span class="builtintype" id="5678419"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5678425">(</span><span class="ident" id="5678426"><a href="/gostd/archive/zip/struct.go.html#5669964">uint32max</a></span><span class="op" id="5678435">)</span>&nbsp;<span class="comment" id="5678437">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678459"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678460">.</span><span class="builtintype" id="5678461"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5678467">(</span><span class="ident" id="5678468"><a href="/gostd/archive/zip/struct.go.html#5669964">uint32max</a></span><span class="op" id="5678477">)</span>&nbsp;<span class="comment" id="5678479">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5678504">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5678546">var</span>&nbsp;<span class="ident" id="5678550">buf</span>&nbsp;<span class="op" id="5678554">[</span><span class="num" id="5678555">28</span><span class="op" id="5678557">]</span><span class="builtintype" id="5678558">byte</span>&nbsp;<span class="comment" id="5678563">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678591">eb</span>&nbsp;<span class="op" id="5678594">:=</span>&nbsp;<span class="ident" id="5678597"><a href="/gostd/archive/zip/writer.go.html#5685901">writeBuf</a></span><span class="op" id="5678605">(</span><span class="ident" id="5678606"><a href="/gostd/archive/zip/writer.go.html#5678550">buf</a></span><span class="op" id="5678609">[</span><span class="op" id="5678610">:</span><span class="op" id="5678611">]</span><span class="op" id="5678612">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678617"><a href="/gostd/archive/zip/writer.go.html#5678591">eb</a></span><span class="op" id="5678619">.</span><span class="builtintype" id="5678620"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5678626">(</span><span class="ident" id="5678627"><a href="/gostd/archive/zip/struct.go.html#5670014">zip64ExtraId</a></span><span class="op" id="5678639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678644"><a href="/gostd/archive/zip/writer.go.html#5678591">eb</a></span><span class="op" id="5678646">.</span><span class="builtintype" id="5678647"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5678653">(</span><span class="num" id="5678654">24</span><span class="op" id="5678656">)</span>&nbsp;<span class="comment" id="5678658">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678681"><a href="/gostd/archive/zip/writer.go.html#5678591">eb</a></span><span class="op" id="5678683">.</span><span class="builtintype" id="5678684"><a href="/gostd/archive/zip/writer.go.html#5686125">uint64</a></span><span class="op" id="5678690">(</span><span class="ident" id="5678691"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678692">.</span><span class="ident" id="5678693"><a href="/gostd/archive/zip/struct.go.html#5670756">UncompressedSize64</a></span><span class="op" id="5678711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678716"><a href="/gostd/archive/zip/writer.go.html#5678591">eb</a></span><span class="op" id="5678718">.</span><span class="builtintype" id="5678719"><a href="/gostd/archive/zip/writer.go.html#5686125">uint64</a></span><span class="op" id="5678725">(</span><span class="ident" id="5678726"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678727">.</span><span class="ident" id="5678728"><a href="/gostd/archive/zip/struct.go.html#5670729">CompressedSize64</a></span><span class="op" id="5678744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678749"><a href="/gostd/archive/zip/writer.go.html#5678591">eb</a></span><span class="op" id="5678751">.</span><span class="builtintype" id="5678752"><a href="/gostd/archive/zip/writer.go.html#5686125">uint64</a></span><span class="op" id="5678758">(</span><span class="ident" id="5678759"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678760">.</span><span class="ident" id="5678761"><a href="/gostd/archive/zip/writer.go.html#5677111">offset</a></span><span class="op" id="5678767">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678772"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678773">.</span><span class="ident" id="5678774"><a href="/gostd/archive/zip/struct.go.html#5670783">Extra</a></span>&nbsp;<span class="op" id="5678780">=</span>&nbsp;<span class="builtinfunc" id="5678782">append</span><span class="op" id="5678788">(</span><span class="ident" id="5678789"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678790">.</span><span class="ident" id="5678791"><a href="/gostd/archive/zip/struct.go.html#5670783">Extra</a></span><span class="op" id="5678796">,</span>&nbsp;<span class="ident" id="5678798"><a href="/gostd/archive/zip/writer.go.html#5678550">buf</a></span><span class="op" id="5678801">[</span><span class="op" id="5678802">:</span><span class="op" id="5678803">]</span><span class="op" id="5678804">...</span><span class="op" id="5678807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5678811">}</span>&nbsp;<span class="keyword" id="5678813">else</span>&nbsp;<span class="op" id="5678818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678823"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678824">.</span><span class="builtintype" id="5678825"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5678831">(</span><span class="ident" id="5678832"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678833">.</span><span class="ident" id="5678834"><a href="/gostd/archive/zip/struct.go.html#5670601">CompressedSize</a></span><span class="op" id="5678848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678853"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678854">.</span><span class="builtintype" id="5678855"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5678861">(</span><span class="ident" id="5678862"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678863">.</span><span class="ident" id="5678864"><a href="/gostd/archive/zip/struct.go.html#5670664">UncompressedSize</a></span><span class="op" id="5678880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5678884">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678888"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678889">.</span><span class="builtintype" id="5678890"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5678896">(</span><span class="builtintype" id="5678897">uint16</span><span class="op" id="5678903">(</span><span class="builtinfunc" id="5678904">len</span><span class="op" id="5678907">(</span><span class="ident" id="5678908"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678909">.</span><span class="ident" id="5678910"><a href="/gostd/archive/zip/struct.go.html#5670368">Name</a></span><span class="op" id="5678914">)</span><span class="op" id="5678915">)</span><span class="op" id="5678916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678920"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678921">.</span><span class="builtintype" id="5678922"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5678928">(</span><span class="builtintype" id="5678929">uint16</span><span class="op" id="5678935">(</span><span class="builtinfunc" id="5678936">len</span><span class="op" id="5678939">(</span><span class="ident" id="5678940"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678941">.</span><span class="ident" id="5678942"><a href="/gostd/archive/zip/struct.go.html#5670783">Extra</a></span><span class="op" id="5678947">)</span><span class="op" id="5678948">)</span><span class="op" id="5678949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678953"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678954">.</span><span class="builtintype" id="5678955"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5678961">(</span><span class="builtintype" id="5678962">uint16</span><span class="op" id="5678968">(</span><span class="builtinfunc" id="5678969">len</span><span class="op" id="5678972">(</span><span class="ident" id="5678973"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5678974">.</span><span class="ident" id="5678975"><a href="/gostd/archive/zip/struct.go.html#5670874">Comment</a></span><span class="op" id="5678982">)</span><span class="op" id="5678983">)</span><span class="op" id="5678984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678988"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span>&nbsp;<span class="op" id="5678990">=</span>&nbsp;<span class="ident" id="5678992"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5678993">[</span><span class="num" id="5678994">4</span><span class="op" id="5678995">:</span><span class="op" id="5678996">]</span>&nbsp;<span class="comment" id="5678998">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679061"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5679062">.</span><span class="builtintype" id="5679063"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5679069">(</span><span class="ident" id="5679070"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5679071">.</span><span class="ident" id="5679072"><a href="/gostd/archive/zip/struct.go.html#5670810">ExternalAttrs</a></span><span class="op" id="5679085">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679089">if</span>&nbsp;<span class="ident" id="5679092"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5679093">.</span><span class="ident" id="5679094"><a href="/gostd/archive/zip/writer.go.html#5677111">offset</a></span>&nbsp;<span class="op" id="5679101">&gt;</span>&nbsp;<span class="ident" id="5679103"><a href="/gostd/archive/zip/struct.go.html#5669964">uint32max</a></span>&nbsp;<span class="op" id="5679113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679118"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5679119">.</span><span class="builtintype" id="5679120"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5679126">(</span><span class="ident" id="5679127"><a href="/gostd/archive/zip/struct.go.html#5669964">uint32max</a></span><span class="op" id="5679136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679140">}</span>&nbsp;<span class="keyword" id="5679142">else</span>&nbsp;<span class="op" id="5679147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679152"><a href="/gostd/archive/zip/writer.go.html#5677970">b</a></span><span class="op" id="5679153">.</span><span class="builtintype" id="5679154"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5679160">(</span><span class="builtintype" id="5679161">uint32</span><span class="op" id="5679167">(</span><span class="ident" id="5679168"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5679169">.</span><span class="ident" id="5679170"><a href="/gostd/archive/zip/writer.go.html#5677111">offset</a></span><span class="op" id="5679176">)</span><span class="op" id="5679177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679181">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679185">if</span>&nbsp;<span class="ident" id="5679188">_</span><span class="op" id="5679189">,</span>&nbsp;<span class="ident" id="5679191">err</span>&nbsp;<span class="op" id="5679195">:=</span>&nbsp;<span class="ident" id="5679198"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5679199">.</span><span class="ident" id="5679200"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5679202">.</span><span class="ident" id="5679203"><a href="/gostd/archive/zip/writer.go.html#5685714">Write</a></span><span class="op" id="5679208">(</span><span class="ident" id="5679209"><a href="/gostd/archive/zip/writer.go.html#5677939">buf</a></span><span class="op" id="5679212">[</span><span class="op" id="5679213">:</span><span class="op" id="5679214">]</span><span class="op" id="5679215">)</span><span class="op" id="5679216">;</span>&nbsp;<span class="ident" id="5679218"><a href="/gostd/archive/zip/writer.go.html#5679191">err</a></span>&nbsp;<span class="op" id="5679222">!=</span>&nbsp;<span class="builtintype" id="5679225">nil</span>&nbsp;<span class="op" id="5679229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679234">return</span>&nbsp;<span class="ident" id="5679241"><a href="/gostd/archive/zip/writer.go.html#5679191">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679251">if</span>&nbsp;<span class="ident" id="5679254">_</span><span class="op" id="5679255">,</span>&nbsp;<span class="ident" id="5679257">err</span>&nbsp;<span class="op" id="5679261">:=</span>&nbsp;<span class="ident" id="5679264"><a href="/gostd/archive/zip/writer.go.html#5676844">io</a></span><span class="op" id="5679266">.</span><span class="ident" id="5679267"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="5679278">(</span><span class="ident" id="5679279"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5679280">.</span><span class="ident" id="5679281"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5679283">,</span>&nbsp;<span class="ident" id="5679285"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5679286">.</span><span class="ident" id="5679287"><a href="/gostd/archive/zip/struct.go.html#5670368">Name</a></span><span class="op" id="5679291">)</span><span class="op" id="5679292">;</span>&nbsp;<span class="ident" id="5679294"><a href="/gostd/archive/zip/writer.go.html#5679257">err</a></span>&nbsp;<span class="op" id="5679298">!=</span>&nbsp;<span class="builtintype" id="5679301">nil</span>&nbsp;<span class="op" id="5679305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679310">return</span>&nbsp;<span class="ident" id="5679317"><a href="/gostd/archive/zip/writer.go.html#5679257">err</a></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679327">if</span>&nbsp;<span class="ident" id="5679330">_</span><span class="op" id="5679331">,</span>&nbsp;<span class="ident" id="5679333">err</span>&nbsp;<span class="op" id="5679337">:=</span>&nbsp;<span class="ident" id="5679340"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5679341">.</span><span class="ident" id="5679342"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5679344">.</span><span class="ident" id="5679345"><a href="/gostd/archive/zip/writer.go.html#5685714">Write</a></span><span class="op" id="5679350">(</span><span class="ident" id="5679351"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5679352">.</span><span class="ident" id="5679353"><a href="/gostd/archive/zip/struct.go.html#5670783">Extra</a></span><span class="op" id="5679358">)</span><span class="op" id="5679359">;</span>&nbsp;<span class="ident" id="5679361"><a href="/gostd/archive/zip/writer.go.html#5679333">err</a></span>&nbsp;<span class="op" id="5679365">!=</span>&nbsp;<span class="builtintype" id="5679368">nil</span>&nbsp;<span class="op" id="5679372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679377">return</span>&nbsp;<span class="ident" id="5679384"><a href="/gostd/archive/zip/writer.go.html#5679333">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679394">if</span>&nbsp;<span class="ident" id="5679397">_</span><span class="op" id="5679398">,</span>&nbsp;<span class="ident" id="5679400">err</span>&nbsp;<span class="op" id="5679404">:=</span>&nbsp;<span class="ident" id="5679407"><a href="/gostd/archive/zip/writer.go.html#5676844">io</a></span><span class="op" id="5679409">.</span><span class="ident" id="5679410"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="5679421">(</span><span class="ident" id="5679422"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5679423">.</span><span class="ident" id="5679424"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5679426">,</span>&nbsp;<span class="ident" id="5679428"><a href="/gostd/archive/zip/writer.go.html#5677914">h</a></span><span class="op" id="5679429">.</span><span class="ident" id="5679430"><a href="/gostd/archive/zip/struct.go.html#5670874">Comment</a></span><span class="op" id="5679437">)</span><span class="op" id="5679438">;</span>&nbsp;<span class="ident" id="5679440"><a href="/gostd/archive/zip/writer.go.html#5679400">err</a></span>&nbsp;<span class="op" id="5679444">!=</span>&nbsp;<span class="builtintype" id="5679447">nil</span>&nbsp;<span class="op" id="5679451">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679456">return</span>&nbsp;<span class="ident" id="5679463"><a href="/gostd/archive/zip/writer.go.html#5679400">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679475">end</span>&nbsp;<span class="op" id="5679479">:=</span>&nbsp;<span class="ident" id="5679482"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5679483">.</span><span class="ident" id="5679484"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5679486">.</span><span class="ident" id="5679487"><a href="/gostd/archive/zip/writer.go.html#5685677">count</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679495">records</span>&nbsp;<span class="op" id="5679503">:=</span>&nbsp;<span class="builtintype" id="5679506">uint64</span><span class="op" id="5679512">(</span><span class="builtinfunc" id="5679513">len</span><span class="op" id="5679516">(</span><span class="ident" id="5679517"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5679518">.</span><span class="ident" id="5679519"><a href="/gostd/archive/zip/writer.go.html#5677023">dir</a></span><span class="op" id="5679522">)</span><span class="op" id="5679523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679526">size</span>&nbsp;<span class="op" id="5679531">:=</span>&nbsp;<span class="builtintype" id="5679534">uint64</span><span class="op" id="5679540">(</span><span class="ident" id="5679541"><a href="/gostd/archive/zip/writer.go.html#5679475">end</a></span>&nbsp;<span class="op" id="5679545">-</span>&nbsp;<span class="ident" id="5679547"><a href="/gostd/archive/zip/writer.go.html#5677886">start</a></span><span class="op" id="5679552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679555">offset</span>&nbsp;<span class="op" id="5679562">:=</span>&nbsp;<span class="builtintype" id="5679565">uint64</span><span class="op" id="5679571">(</span><span class="ident" id="5679572"><a href="/gostd/archive/zip/writer.go.html#5677886">start</a></span><span class="op" id="5679577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679581">if</span>&nbsp;<span class="ident" id="5679584"><a href="/gostd/archive/zip/writer.go.html#5679495">records</a></span>&nbsp;<span class="op" id="5679592">&gt;</span>&nbsp;<span class="ident" id="5679594"><a href="/gostd/archive/zip/struct.go.html#5669937">uint16max</a></span>&nbsp;<span class="op" id="5679604">||</span>&nbsp;<span class="ident" id="5679607"><a href="/gostd/archive/zip/writer.go.html#5679526">size</a></span>&nbsp;<span class="op" id="5679612">&gt;</span>&nbsp;<span class="ident" id="5679614"><a href="/gostd/archive/zip/struct.go.html#5669964">uint32max</a></span>&nbsp;<span class="op" id="5679624">||</span>&nbsp;<span class="ident" id="5679627"><a href="/gostd/archive/zip/writer.go.html#5679555">offset</a></span>&nbsp;<span class="op" id="5679634">&gt;</span>&nbsp;<span class="ident" id="5679636"><a href="/gostd/archive/zip/struct.go.html#5669964">uint32max</a></span>&nbsp;<span class="op" id="5679646">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679650">var</span>&nbsp;<span class="ident" id="5679654">buf</span>&nbsp;<span class="op" id="5679658">[</span><span class="ident" id="5679659"><a href="/gostd/archive/zip/struct.go.html#5669598">directory64EndLen</a></span>&nbsp;<span class="op" id="5679677">+</span>&nbsp;<span class="ident" id="5679679"><a href="/gostd/archive/zip/struct.go.html#5669556">directory64LocLen</a></span><span class="op" id="5679696">]</span><span class="builtintype" id="5679697">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679704">b</span>&nbsp;<span class="op" id="5679706">:=</span>&nbsp;<span class="ident" id="5679709"><a href="/gostd/archive/zip/writer.go.html#5685901">writeBuf</a></span><span class="op" id="5679717">(</span><span class="ident" id="5679718"><a href="/gostd/archive/zip/writer.go.html#5679654">buf</a></span><span class="op" id="5679721">[</span><span class="op" id="5679722">:</span><span class="op" id="5679723">]</span><span class="op" id="5679724">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5679729">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679772"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5679773">.</span><span class="builtintype" id="5679774"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5679780">(</span><span class="ident" id="5679781"><a href="/gostd/archive/zip/struct.go.html#5669071">directory64EndSignature</a></span><span class="op" id="5679804">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679808"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5679809">.</span><span class="builtintype" id="5679810"><a href="/gostd/archive/zip/writer.go.html#5686125">uint64</a></span><span class="op" id="5679816">(</span><span class="ident" id="5679817"><a href="/gostd/archive/zip/struct.go.html#5669598">directory64EndLen</a></span><span class="op" id="5679834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679838"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5679839">.</span><span class="builtintype" id="5679840"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5679846">(</span><span class="ident" id="5679847"><a href="/gostd/archive/zip/struct.go.html#5669845">zipVersion45</a></span><span class="op" id="5679859">)</span>&nbsp;<span class="comment" id="5679861">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679882"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5679883">.</span><span class="builtintype" id="5679884"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5679890">(</span><span class="ident" id="5679891"><a href="/gostd/archive/zip/struct.go.html#5669845">zipVersion45</a></span><span class="op" id="5679903">)</span>&nbsp;<span class="comment" id="5679905">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679936"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5679937">.</span><span class="builtintype" id="5679938"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5679944">(</span><span class="num" id="5679945">0</span><span class="op" id="5679946">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5679959">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679984"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5679985">.</span><span class="builtintype" id="5679986"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5679992">(</span><span class="num" id="5679993">0</span><span class="op" id="5679994">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680007">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680071"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5680072">.</span><span class="builtintype" id="5680073"><a href="/gostd/archive/zip/writer.go.html#5686125">uint64</a></span><span class="op" id="5680079">(</span><span class="ident" id="5680080"><a href="/gostd/archive/zip/writer.go.html#5679495">records</a></span><span class="op" id="5680087">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680094">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680161"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5680162">.</span><span class="builtintype" id="5680163"><a href="/gostd/archive/zip/writer.go.html#5686125">uint64</a></span><span class="op" id="5680169">(</span><span class="ident" id="5680170"><a href="/gostd/archive/zip/writer.go.html#5679495">records</a></span><span class="op" id="5680177">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680184">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680238"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5680239">.</span><span class="builtintype" id="5680240"><a href="/gostd/archive/zip/writer.go.html#5686125">uint64</a></span><span class="op" id="5680246">(</span><span class="ident" id="5680247"><a href="/gostd/archive/zip/writer.go.html#5679526">size</a></span><span class="op" id="5680251">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680261">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680296"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5680297">.</span><span class="builtintype" id="5680298"><a href="/gostd/archive/zip/writer.go.html#5686125">uint64</a></span><span class="op" id="5680304">(</span><span class="ident" id="5680305"><a href="/gostd/archive/zip/writer.go.html#5679555">offset</a></span><span class="op" id="5680311">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680319">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680403">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680447"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5680448">.</span><span class="builtintype" id="5680449"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5680455">(</span><span class="ident" id="5680456"><a href="/gostd/archive/zip/struct.go.html#5669032">directory64LocSignature</a></span><span class="op" id="5680479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680483"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5680484">.</span><span class="builtintype" id="5680485"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5680491">(</span><span class="num" id="5680492">0</span><span class="op" id="5680493">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680505">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680582"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5680583">.</span><span class="builtintype" id="5680584"><a href="/gostd/archive/zip/writer.go.html#5686125">uint64</a></span><span class="op" id="5680590">(</span><span class="builtintype" id="5680591">uint64</span><span class="op" id="5680597">(</span><span class="ident" id="5680598"><a href="/gostd/archive/zip/writer.go.html#5679475">end</a></span><span class="op" id="5680601">)</span><span class="op" id="5680602">)</span>&nbsp;<span class="comment" id="5680604">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680670"><a href="/gostd/archive/zip/writer.go.html#5679704">b</a></span><span class="op" id="5680671">.</span><span class="builtintype" id="5680672"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5680678">(</span><span class="num" id="5680679">1</span><span class="op" id="5680680">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680692">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680720">if</span>&nbsp;<span class="ident" id="5680723">_</span><span class="op" id="5680724">,</span>&nbsp;<span class="ident" id="5680726">err</span>&nbsp;<span class="op" id="5680730">:=</span>&nbsp;<span class="ident" id="5680733"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5680734">.</span><span class="ident" id="5680735"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5680737">.</span><span class="ident" id="5680738"><a href="/gostd/archive/zip/writer.go.html#5685714">Write</a></span><span class="op" id="5680743">(</span><span class="ident" id="5680744"><a href="/gostd/archive/zip/writer.go.html#5679654">buf</a></span><span class="op" id="5680747">[</span><span class="op" id="5680748">:</span><span class="op" id="5680749">]</span><span class="op" id="5680750">)</span><span class="op" id="5680751">;</span>&nbsp;<span class="ident" id="5680753"><a href="/gostd/archive/zip/writer.go.html#5680726">err</a></span>&nbsp;<span class="op" id="5680757">!=</span>&nbsp;<span class="builtintype" id="5680760">nil</span>&nbsp;<span class="op" id="5680764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680769">return</span>&nbsp;<span class="ident" id="5680776"><a href="/gostd/archive/zip/writer.go.html#5680726">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5680782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680787">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680850">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680900"><a href="/gostd/archive/zip/writer.go.html#5679495">records</a></span>&nbsp;<span class="op" id="5680908">=</span>&nbsp;<span class="ident" id="5680910"><a href="/gostd/archive/zip/struct.go.html#5669937">uint16max</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680922"><a href="/gostd/archive/zip/writer.go.html#5679526">size</a></span>&nbsp;<span class="op" id="5680927">=</span>&nbsp;<span class="ident" id="5680929"><a href="/gostd/archive/zip/struct.go.html#5669964">uint32max</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680941"><a href="/gostd/archive/zip/writer.go.html#5679555">offset</a></span>&nbsp;<span class="op" id="5680948">=</span>&nbsp;<span class="ident" id="5680950"><a href="/gostd/archive/zip/struct.go.html#5669964">uint32max</a></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5680961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680965">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680986">var</span>&nbsp;<span class="ident" id="5680990">buf</span>&nbsp;<span class="op" id="5680994">[</span><span class="ident" id="5680995"><a href="/gostd/archive/zip/struct.go.html#5669327">directoryEndLen</a></span><span class="op" id="5681010">]</span><span class="builtintype" id="5681011">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681017">b</span>&nbsp;<span class="op" id="5681019">:=</span>&nbsp;<span class="ident" id="5681022"><a href="/gostd/archive/zip/writer.go.html#5685901">writeBuf</a></span><span class="op" id="5681030">(</span><span class="ident" id="5681031"><a href="/gostd/archive/zip/writer.go.html#5680990">buf</a></span><span class="op" id="5681034">[</span><span class="op" id="5681035">:</span><span class="op" id="5681036">]</span><span class="op" id="5681037">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681040"><a href="/gostd/archive/zip/writer.go.html#5681017">b</a></span><span class="op" id="5681041">.</span><span class="builtintype" id="5681042"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5681048">(</span><span class="builtintype" id="5681049">uint32</span><span class="op" id="5681055">(</span><span class="ident" id="5681056"><a href="/gostd/archive/zip/struct.go.html#5668993">directoryEndSignature</a></span><span class="op" id="5681077">)</span><span class="op" id="5681078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681081"><a href="/gostd/archive/zip/writer.go.html#5681017">b</a></span>&nbsp;<span class="op" id="5681083">=</span>&nbsp;<span class="ident" id="5681085"><a href="/gostd/archive/zip/writer.go.html#5681017">b</a></span><span class="op" id="5681086">[</span><span class="num" id="5681087">4</span><span class="op" id="5681088">:</span><span class="op" id="5681089">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5681107">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681167"><a href="/gostd/archive/zip/writer.go.html#5681017">b</a></span><span class="op" id="5681168">.</span><span class="builtintype" id="5681169"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5681175">(</span><span class="builtintype" id="5681176">uint16</span><span class="op" id="5681182">(</span><span class="ident" id="5681183"><a href="/gostd/archive/zip/writer.go.html#5679495">records</a></span><span class="op" id="5681190">)</span><span class="op" id="5681191">)</span>&nbsp;<span class="comment" id="5681193">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681225"><a href="/gostd/archive/zip/writer.go.html#5681017">b</a></span><span class="op" id="5681226">.</span><span class="builtintype" id="5681227"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5681233">(</span><span class="builtintype" id="5681234">uint16</span><span class="op" id="5681240">(</span><span class="ident" id="5681241"><a href="/gostd/archive/zip/writer.go.html#5679495">records</a></span><span class="op" id="5681248">)</span><span class="op" id="5681249">)</span>&nbsp;<span class="comment" id="5681251">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681279"><a href="/gostd/archive/zip/writer.go.html#5681017">b</a></span><span class="op" id="5681280">.</span><span class="builtintype" id="5681281"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5681287">(</span><span class="builtintype" id="5681288">uint32</span><span class="op" id="5681294">(</span><span class="ident" id="5681295"><a href="/gostd/archive/zip/writer.go.html#5679526">size</a></span><span class="op" id="5681299">)</span><span class="op" id="5681300">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5681305">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681327"><a href="/gostd/archive/zip/writer.go.html#5681017">b</a></span><span class="op" id="5681328">.</span><span class="builtintype" id="5681329"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5681335">(</span><span class="builtintype" id="5681336">uint32</span><span class="op" id="5681342">(</span><span class="ident" id="5681343"><a href="/gostd/archive/zip/writer.go.html#5679555">offset</a></span><span class="op" id="5681349">)</span><span class="op" id="5681350">)</span>&nbsp;&nbsp;<span class="comment" id="5681353">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5681376">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681418">if</span>&nbsp;<span class="ident" id="5681421">_</span><span class="op" id="5681422">,</span>&nbsp;<span class="ident" id="5681424">err</span>&nbsp;<span class="op" id="5681428">:=</span>&nbsp;<span class="ident" id="5681431"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5681432">.</span><span class="ident" id="5681433"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5681435">.</span><span class="ident" id="5681436"><a href="/gostd/archive/zip/writer.go.html#5685714">Write</a></span><span class="op" id="5681441">(</span><span class="ident" id="5681442"><a href="/gostd/archive/zip/writer.go.html#5680990">buf</a></span><span class="op" id="5681445">[</span><span class="op" id="5681446">:</span><span class="op" id="5681447">]</span><span class="op" id="5681448">)</span><span class="op" id="5681449">;</span>&nbsp;<span class="ident" id="5681451"><a href="/gostd/archive/zip/writer.go.html#5681424">err</a></span>&nbsp;<span class="op" id="5681455">!=</span>&nbsp;<span class="builtintype" id="5681458">nil</span>&nbsp;<span class="op" id="5681462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681466">return</span>&nbsp;<span class="ident" id="5681473"><a href="/gostd/archive/zip/writer.go.html#5681424">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5681478">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681482">return</span>&nbsp;<span class="ident" id="5681489"><a href="/gostd/archive/zip/writer.go.html#5677631">w</a></span><span class="op" id="5681490">.</span><span class="ident" id="5681491"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5681493">.</span><span class="ident" id="5681494"><a href="/gostd/archive/zip/writer.go.html#5685660">w</a></span><span class="op" id="5681495">.</span><span class="op" id="5681496">(</span><span class="op" id="5681497">*</span><span class="ident" id="5681498"><a href="/gostd/archive/zip/writer.go.html#5676784">bufio</a></span><span class="op" id="5681503">.</span><span class="ident" id="5681504"><a href="/gostd/bufio/bufio.go.html#1366565">Writer</a></span><span class="op" id="5681510">)</span><span class="op" id="5681511">.</span><span class="ident" id="5681512"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="5681517">(</span><span class="op" id="5681518">)</span><br>
<span class="lineno"></span><span class="op" id="5681520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5681523">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="5681586">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="5681655">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="5681723">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5681790">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="5681802">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="5681874">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5681917">func</span>&nbsp;<span class="op" id="5681922">(</span><span class="ident" id="5681923">w</span>&nbsp;<span class="op" id="5681925">*</span><span class="ident" id="5681926"><a href="/gostd/archive/zip/writer.go.html#5676985">Writer</a></span><span class="op" id="5681932">)</span>&nbsp;<span class="ident" id="5681934">Create</span><span class="op" id="5681940">(</span><span class="ident" id="5681941">name</span>&nbsp;<span class="builtintype" id="5681946">string</span><span class="op" id="5681952">)</span>&nbsp;<span class="op" id="5681954">(</span><span class="ident" id="5681955"><a href="/gostd/archive/zip/writer.go.html#5676844">io</a></span><span class="op" id="5681957">.</span><span class="ident" id="5681958"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="5681964">,</span>&nbsp;<span class="builtintype" id="5681966">error</span><span class="op" id="5681971">)</span>&nbsp;<span class="op" id="5681973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681976">header</span>&nbsp;<span class="op" id="5681983">:=</span>&nbsp;<span class="op" id="5681986">&amp;</span><span class="ident" id="5681987"><a href="/gostd/archive/zip/struct.go.html#5670169">FileHeader</a></span><span class="op" id="5681997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682001"><a href="/gostd/archive/zip/struct.go.html#5670368">Name</a></span><span class="op" id="5682005">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5682009"><a href="/gostd/archive/zip/writer.go.html#5681941">name</a></span><span class="op" id="5682013">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682017"><a href="/gostd/archive/zip/struct.go.html#5670463">Method</a></span><span class="op" id="5682023">:</span>&nbsp;<span class="ident" id="5682025"><a href="/gostd/archive/zip/struct.go.html#5668884">Deflate</a></span><span class="op" id="5682032">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5682035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682038">return</span>&nbsp;<span class="ident" id="5682045"><a href="/gostd/archive/zip/writer.go.html#5681923">w</a></span><span class="op" id="5682046">.</span><span class="ident" id="5682047"><a href="/gostd/archive/zip/writer.go.html#5682372">CreateHeader</a></span><span class="op" id="5682059">(</span><span class="ident" id="5682060"><a href="/gostd/archive/zip/writer.go.html#5681976">header</a></span><span class="op" id="5682066">)</span><br>
<span class="lineno"></span><span class="op" id="5682068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5682071">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="5682145">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="5682171">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="5682240">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="5682312">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5682355">func</span>&nbsp;<span class="op" id="5682360">(</span><span class="ident" id="5682361">w</span>&nbsp;<span class="op" id="5682363">*</span><span class="ident" id="5682364"><a href="/gostd/archive/zip/writer.go.html#5676985">Writer</a></span><span class="op" id="5682370">)</span>&nbsp;<span class="ident" id="5682372">CreateHeader</span><span class="op" id="5682384">(</span><span class="ident" id="5682385">fh</span>&nbsp;<span class="op" id="5682388">*</span><span class="ident" id="5682389"><a href="/gostd/archive/zip/struct.go.html#5670169">FileHeader</a></span><span class="op" id="5682399">)</span>&nbsp;<span class="op" id="5682401">(</span><span class="ident" id="5682402"><a href="/gostd/archive/zip/writer.go.html#5676844">io</a></span><span class="op" id="5682404">.</span><span class="ident" id="5682405"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="5682411">,</span>&nbsp;<span class="builtintype" id="5682413">error</span><span class="op" id="5682418">)</span>&nbsp;<span class="op" id="5682420">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682423">if</span>&nbsp;<span class="ident" id="5682426"><a href="/gostd/archive/zip/writer.go.html#5682361">w</a></span><span class="op" id="5682427">.</span><span class="ident" id="5682428"><a href="/gostd/archive/zip/writer.go.html#5677041">last</a></span>&nbsp;<span class="op" id="5682433">!=</span>&nbsp;<span class="builtintype" id="5682436">nil</span>&nbsp;<span class="op" id="5682440">&amp;&amp;</span>&nbsp;<span class="op" id="5682443">!</span><span class="ident" id="5682444"><a href="/gostd/archive/zip/writer.go.html#5682361">w</a></span><span class="op" id="5682445">.</span><span class="ident" id="5682446"><a href="/gostd/archive/zip/writer.go.html#5677041">last</a></span><span class="op" id="5682450">.</span><span class="ident" id="5682451"><a href="/gostd/archive/zip/writer.go.html#5684035">closed</a></span>&nbsp;<span class="op" id="5682458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682462">if</span>&nbsp;<span class="ident" id="5682465">err</span>&nbsp;<span class="op" id="5682469">:=</span>&nbsp;<span class="ident" id="5682472"><a href="/gostd/archive/zip/writer.go.html#5682361">w</a></span><span class="op" id="5682473">.</span><span class="ident" id="5682474"><a href="/gostd/archive/zip/writer.go.html#5677041">last</a></span><span class="op" id="5682478">.</span><span class="builtinfunc" id="5682479"><a href="/gostd/archive/zip/writer.go.html#5684245">close</a></span><span class="op" id="5682484">(</span><span class="op" id="5682485">)</span><span class="op" id="5682486">;</span>&nbsp;<span class="ident" id="5682488"><a href="/gostd/archive/zip/writer.go.html#5682465">err</a></span>&nbsp;<span class="op" id="5682492">!=</span>&nbsp;<span class="builtintype" id="5682495">nil</span>&nbsp;<span class="op" id="5682499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682504">return</span>&nbsp;<span class="builtintype" id="5682511">nil</span><span class="op" id="5682514">,</span>&nbsp;<span class="ident" id="5682516"><a href="/gostd/archive/zip/writer.go.html#5682465">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5682522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5682525">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682529"><a href="/gostd/archive/zip/writer.go.html#5682385">fh</a></span><span class="op" id="5682531">.</span><span class="ident" id="5682532"><a href="/gostd/archive/zip/struct.go.html#5670436">Flags</a></span>&nbsp;<span class="op" id="5682538">|=</span>&nbsp;<span class="num" id="5682541">0x8</span>&nbsp;<span class="comment" id="5682545">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682582"><a href="/gostd/archive/zip/writer.go.html#5682385">fh</a></span><span class="op" id="5682584">.</span><span class="ident" id="5682585"><a href="/gostd/archive/zip/struct.go.html#5670382">CreatorVersion</a></span>&nbsp;<span class="op" id="5682600">=</span>&nbsp;<span class="ident" id="5682602"><a href="/gostd/archive/zip/writer.go.html#5682385">fh</a></span><span class="op" id="5682604">.</span><span class="ident" id="5682605"><a href="/gostd/archive/zip/struct.go.html#5670382">CreatorVersion</a></span><span class="op" id="5682619">&amp;</span><span class="num" id="5682620">0xff00</span>&nbsp;<span class="op" id="5682627">|</span>&nbsp;<span class="ident" id="5682629"><a href="/gostd/archive/zip/struct.go.html#5669819">zipVersion20</a></span>&nbsp;<span class="comment" id="5682642">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682674"><a href="/gostd/archive/zip/writer.go.html#5682385">fh</a></span><span class="op" id="5682676">.</span><span class="ident" id="5682677"><a href="/gostd/archive/zip/struct.go.html#5670409">ReaderVersion</a></span>&nbsp;<span class="op" id="5682691">=</span>&nbsp;<span class="ident" id="5682693"><a href="/gostd/archive/zip/struct.go.html#5669819">zipVersion20</a></span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682708">fw</span>&nbsp;<span class="op" id="5682711">:=</span>&nbsp;<span class="op" id="5682714">&amp;</span><span class="ident" id="5682715"><a href="/gostd/archive/zip/writer.go.html#5683887">fileWriter</a></span><span class="op" id="5682725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682729"><a href="/gostd/archive/zip/writer.go.html#5683917">zipw</a></span><span class="op" id="5682733">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682740"><a href="/gostd/archive/zip/writer.go.html#5682361">w</a></span><span class="op" id="5682741">.</span><span class="ident" id="5682742"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5682744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682748"><a href="/gostd/archive/zip/writer.go.html#5683988">compCount</a></span><span class="op" id="5682757">:</span>&nbsp;<span class="op" id="5682759">&amp;</span><span class="ident" id="5682760"><a href="/gostd/archive/zip/writer.go.html#5685638">countWriter</a></span><span class="op" id="5682771">{</span><span class="ident" id="5682772"><a href="/gostd/archive/zip/writer.go.html#5685660">w</a></span><span class="op" id="5682773">:</span>&nbsp;<span class="ident" id="5682775"><a href="/gostd/archive/zip/writer.go.html#5682361">w</a></span><span class="op" id="5682776">.</span><span class="ident" id="5682777"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5682779">}</span><span class="op" id="5682780">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682784"><a href="/gostd/archive/zip/writer.go.html#5684012">crc32</a></span><span class="op" id="5682789">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682795"><a href="/gostd/archive/zip/writer.go.html#5676830">crc32</a></span><span class="op" id="5682800">.</span><span class="ident" id="5682801"><a href="/gostd/hash/crc32/crc32.go.html#4859679">NewIEEE</a></span><span class="op" id="5682808">(</span><span class="op" id="5682809">)</span><span class="op" id="5682810">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5682813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682816">comp</span>&nbsp;<span class="op" id="5682821">:=</span>&nbsp;<span class="ident" id="5682824"><a href="/gostd/archive/zip/register.go.html#5667900">compressor</a></span><span class="op" id="5682834">(</span><span class="ident" id="5682835"><a href="/gostd/archive/zip/writer.go.html#5682385">fh</a></span><span class="op" id="5682837">.</span><span class="ident" id="5682838"><a href="/gostd/archive/zip/struct.go.html#5670463">Method</a></span><span class="op" id="5682844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682847">if</span>&nbsp;<span class="ident" id="5682850"><a href="/gostd/archive/zip/writer.go.html#5682816">comp</a></span>&nbsp;<span class="op" id="5682855">==</span>&nbsp;<span class="builtintype" id="5682858">nil</span>&nbsp;<span class="op" id="5682862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682866">return</span>&nbsp;<span class="builtintype" id="5682873">nil</span><span class="op" id="5682876">,</span>&nbsp;<span class="ident" id="5682878"><a href="/gostd/archive/zip/reader.go.html#5653364">ErrAlgorithm</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5682892">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682895">var</span>&nbsp;<span class="ident" id="5682899">err</span>&nbsp;<span class="builtintype" id="5682903">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682910"><a href="/gostd/archive/zip/writer.go.html#5682708">fw</a></span><span class="op" id="5682912">.</span><span class="ident" id="5682913"><a href="/gostd/archive/zip/writer.go.html#5683962">comp</a></span><span class="op" id="5682917">,</span>&nbsp;<span class="ident" id="5682919"><a href="/gostd/archive/zip/writer.go.html#5682899">err</a></span>&nbsp;<span class="op" id="5682923">=</span>&nbsp;<span class="ident" id="5682925"><a href="/gostd/archive/zip/writer.go.html#5682816">comp</a></span><span class="op" id="5682929">(</span><span class="ident" id="5682930"><a href="/gostd/archive/zip/writer.go.html#5682708">fw</a></span><span class="op" id="5682932">.</span><span class="ident" id="5682933"><a href="/gostd/archive/zip/writer.go.html#5683988">compCount</a></span><span class="op" id="5682942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682945">if</span>&nbsp;<span class="ident" id="5682948"><a href="/gostd/archive/zip/writer.go.html#5682899">err</a></span>&nbsp;<span class="op" id="5682952">!=</span>&nbsp;<span class="builtintype" id="5682955">nil</span>&nbsp;<span class="op" id="5682959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682963">return</span>&nbsp;<span class="builtintype" id="5682970">nil</span><span class="op" id="5682973">,</span>&nbsp;<span class="ident" id="5682975"><a href="/gostd/archive/zip/writer.go.html#5682899">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5682980">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682983"><a href="/gostd/archive/zip/writer.go.html#5682708">fw</a></span><span class="op" id="5682985">.</span><span class="ident" id="5682986"><a href="/gostd/archive/zip/writer.go.html#5683938">rawCount</a></span>&nbsp;<span class="op" id="5682995">=</span>&nbsp;<span class="op" id="5682997">&amp;</span><span class="ident" id="5682998"><a href="/gostd/archive/zip/writer.go.html#5685638">countWriter</a></span><span class="op" id="5683009">{</span><span class="ident" id="5683010"><a href="/gostd/archive/zip/writer.go.html#5685660">w</a></span><span class="op" id="5683011">:</span>&nbsp;<span class="ident" id="5683013"><a href="/gostd/archive/zip/writer.go.html#5682708">fw</a></span><span class="op" id="5683015">.</span><span class="ident" id="5683016"><a href="/gostd/archive/zip/writer.go.html#5683962">comp</a></span><span class="op" id="5683020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683024">h</span>&nbsp;<span class="op" id="5683026">:=</span>&nbsp;<span class="op" id="5683029">&amp;</span><span class="ident" id="5683030"><a href="/gostd/archive/zip/writer.go.html#5677081">header</a></span><span class="op" id="5683036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683040"><a href="/gostd/archive/zip/writer.go.html#5677098">FileHeader</a></span><span class="op" id="5683050">:</span>&nbsp;<span class="ident" id="5683052"><a href="/gostd/archive/zip/writer.go.html#5682385">fh</a></span><span class="op" id="5683054">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683058"><a href="/gostd/archive/zip/writer.go.html#5677111">offset</a></span><span class="op" id="5683064">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5683070">uint64</span><span class="op" id="5683076">(</span><span class="ident" id="5683077"><a href="/gostd/archive/zip/writer.go.html#5682361">w</a></span><span class="op" id="5683078">.</span><span class="ident" id="5683079"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5683081">.</span><span class="ident" id="5683082"><a href="/gostd/archive/zip/writer.go.html#5685677">count</a></span><span class="op" id="5683087">)</span><span class="op" id="5683088">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5683091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683094"><a href="/gostd/archive/zip/writer.go.html#5682361">w</a></span><span class="op" id="5683095">.</span><span class="ident" id="5683096"><a href="/gostd/archive/zip/writer.go.html#5677023">dir</a></span>&nbsp;<span class="op" id="5683100">=</span>&nbsp;<span class="builtinfunc" id="5683102">append</span><span class="op" id="5683108">(</span><span class="ident" id="5683109"><a href="/gostd/archive/zip/writer.go.html#5682361">w</a></span><span class="op" id="5683110">.</span><span class="ident" id="5683111"><a href="/gostd/archive/zip/writer.go.html#5677023">dir</a></span><span class="op" id="5683114">,</span>&nbsp;<span class="ident" id="5683116"><a href="/gostd/archive/zip/writer.go.html#5683024">h</a></span><span class="op" id="5683117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683120"><a href="/gostd/archive/zip/writer.go.html#5682708">fw</a></span><span class="op" id="5683122">.</span><span class="ident" id="5683123"><a href="/gostd/archive/zip/writer.go.html#5683908">header</a></span>&nbsp;<span class="op" id="5683130">=</span>&nbsp;<span class="ident" id="5683132"><a href="/gostd/archive/zip/writer.go.html#5683024">h</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683136">if</span>&nbsp;<span class="ident" id="5683139">err</span>&nbsp;<span class="op" id="5683143">:=</span>&nbsp;<span class="ident" id="5683146"><a href="/gostd/archive/zip/writer.go.html#5683241">writeHeader</a></span><span class="op" id="5683157">(</span><span class="ident" id="5683158"><a href="/gostd/archive/zip/writer.go.html#5682361">w</a></span><span class="op" id="5683159">.</span><span class="ident" id="5683160"><a href="/gostd/archive/zip/writer.go.html#5677002">cw</a></span><span class="op" id="5683162">,</span>&nbsp;<span class="ident" id="5683164"><a href="/gostd/archive/zip/writer.go.html#5682385">fh</a></span><span class="op" id="5683166">)</span><span class="op" id="5683167">;</span>&nbsp;<span class="ident" id="5683169"><a href="/gostd/archive/zip/writer.go.html#5683139">err</a></span>&nbsp;<span class="op" id="5683173">!=</span>&nbsp;<span class="builtintype" id="5683176">nil</span>&nbsp;<span class="op" id="5683180">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683184">return</span>&nbsp;<span class="builtintype" id="5683191">nil</span><span class="op" id="5683194">,</span>&nbsp;<span class="ident" id="5683196"><a href="/gostd/archive/zip/writer.go.html#5683139">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5683201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683205"><a href="/gostd/archive/zip/writer.go.html#5682361">w</a></span><span class="op" id="5683206">.</span><span class="ident" id="5683207"><a href="/gostd/archive/zip/writer.go.html#5677041">last</a></span>&nbsp;<span class="op" id="5683212">=</span>&nbsp;<span class="ident" id="5683214"><a href="/gostd/archive/zip/writer.go.html#5682708">fw</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683218">return</span>&nbsp;<span class="ident" id="5683225"><a href="/gostd/archive/zip/writer.go.html#5682708">fw</a></span><span class="op" id="5683227">,</span>&nbsp;<span class="builtintype" id="5683229">nil</span><br>
<span class="lineno">230</span><span class="op" id="5683233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5683236">func</span>&nbsp;<span class="ident" id="5683241">writeHeader</span><span class="op" id="5683252">(</span><span class="ident" id="5683253">w</span>&nbsp;<span class="ident" id="5683255"><a href="/gostd/archive/zip/writer.go.html#5676844">io</a></span><span class="op" id="5683257">.</span><span class="ident" id="5683258"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="5683264">,</span>&nbsp;<span class="ident" id="5683266">h</span>&nbsp;<span class="op" id="5683268">*</span><span class="ident" id="5683269"><a href="/gostd/archive/zip/struct.go.html#5670169">FileHeader</a></span><span class="op" id="5683279">)</span>&nbsp;<span class="builtintype" id="5683281">error</span>&nbsp;<span class="op" id="5683287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683290">var</span>&nbsp;<span class="ident" id="5683294">buf</span>&nbsp;<span class="op" id="5683298">[</span><span class="ident" id="5683299"><a href="/gostd/archive/zip/struct.go.html#5669195">fileHeaderLen</a></span><span class="op" id="5683312">]</span><span class="builtintype" id="5683313">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683319">b</span>&nbsp;<span class="op" id="5683321">:=</span>&nbsp;<span class="ident" id="5683324"><a href="/gostd/archive/zip/writer.go.html#5685901">writeBuf</a></span><span class="op" id="5683332">(</span><span class="ident" id="5683333"><a href="/gostd/archive/zip/writer.go.html#5683294">buf</a></span><span class="op" id="5683336">[</span><span class="op" id="5683337">:</span><span class="op" id="5683338">]</span><span class="op" id="5683339">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683342"><a href="/gostd/archive/zip/writer.go.html#5683319">b</a></span><span class="op" id="5683343">.</span><span class="builtintype" id="5683344"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5683350">(</span><span class="builtintype" id="5683351">uint32</span><span class="op" id="5683357">(</span><span class="ident" id="5683358"><a href="/gostd/archive/zip/struct.go.html#5668915">fileHeaderSignature</a></span><span class="op" id="5683377">)</span><span class="op" id="5683378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683381"><a href="/gostd/archive/zip/writer.go.html#5683319">b</a></span><span class="op" id="5683382">.</span><span class="builtintype" id="5683383"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5683389">(</span><span class="ident" id="5683390"><a href="/gostd/archive/zip/writer.go.html#5683266">h</a></span><span class="op" id="5683391">.</span><span class="ident" id="5683392"><a href="/gostd/archive/zip/struct.go.html#5670409">ReaderVersion</a></span><span class="op" id="5683405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683408"><a href="/gostd/archive/zip/writer.go.html#5683319">b</a></span><span class="op" id="5683409">.</span><span class="builtintype" id="5683410"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5683416">(</span><span class="ident" id="5683417"><a href="/gostd/archive/zip/writer.go.html#5683266">h</a></span><span class="op" id="5683418">.</span><span class="ident" id="5683419"><a href="/gostd/archive/zip/struct.go.html#5670436">Flags</a></span><span class="op" id="5683424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683427"><a href="/gostd/archive/zip/writer.go.html#5683319">b</a></span><span class="op" id="5683428">.</span><span class="builtintype" id="5683429"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5683435">(</span><span class="ident" id="5683436"><a href="/gostd/archive/zip/writer.go.html#5683266">h</a></span><span class="op" id="5683437">.</span><span class="ident" id="5683438"><a href="/gostd/archive/zip/struct.go.html#5670463">Method</a></span><span class="op" id="5683444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683447"><a href="/gostd/archive/zip/writer.go.html#5683319">b</a></span><span class="op" id="5683448">.</span><span class="builtintype" id="5683449"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5683455">(</span><span class="ident" id="5683456"><a href="/gostd/archive/zip/writer.go.html#5683266">h</a></span><span class="op" id="5683457">.</span><span class="ident" id="5683458"><a href="/gostd/archive/zip/struct.go.html#5670490">ModifiedTime</a></span><span class="op" id="5683470">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683473"><a href="/gostd/archive/zip/writer.go.html#5683319">b</a></span><span class="op" id="5683474">.</span><span class="builtintype" id="5683475"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5683481">(</span><span class="ident" id="5683482"><a href="/gostd/archive/zip/writer.go.html#5683266">h</a></span><span class="op" id="5683483">.</span><span class="ident" id="5683484"><a href="/gostd/archive/zip/struct.go.html#5670532">ModifiedDate</a></span><span class="op" id="5683496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683499"><a href="/gostd/archive/zip/writer.go.html#5683319">b</a></span><span class="op" id="5683500">.</span><span class="builtintype" id="5683501"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5683507">(</span><span class="num" id="5683508">0</span><span class="op" id="5683509">)</span>&nbsp;<span class="comment" id="5683511">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683561"><a href="/gostd/archive/zip/writer.go.html#5683319">b</a></span><span class="op" id="5683562">.</span><span class="builtintype" id="5683563"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5683569">(</span><span class="num" id="5683570">0</span><span class="op" id="5683571">)</span>&nbsp;<span class="comment" id="5683573">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683594"><a href="/gostd/archive/zip/writer.go.html#5683319">b</a></span><span class="op" id="5683595">.</span><span class="builtintype" id="5683596"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5683602">(</span><span class="num" id="5683603">0</span><span class="op" id="5683604">)</span>&nbsp;<span class="comment" id="5683606">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683647"><a href="/gostd/archive/zip/writer.go.html#5683319">b</a></span><span class="op" id="5683648">.</span><span class="builtintype" id="5683649"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5683655">(</span><span class="builtintype" id="5683656">uint16</span><span class="op" id="5683662">(</span><span class="builtinfunc" id="5683663">len</span><span class="op" id="5683666">(</span><span class="ident" id="5683667"><a href="/gostd/archive/zip/writer.go.html#5683266">h</a></span><span class="op" id="5683668">.</span><span class="ident" id="5683669"><a href="/gostd/archive/zip/struct.go.html#5670368">Name</a></span><span class="op" id="5683673">)</span><span class="op" id="5683674">)</span><span class="op" id="5683675">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683678"><a href="/gostd/archive/zip/writer.go.html#5683319">b</a></span><span class="op" id="5683679">.</span><span class="builtintype" id="5683680"><a href="/gostd/archive/zip/writer.go.html#5685937">uint16</a></span><span class="op" id="5683686">(</span><span class="builtintype" id="5683687">uint16</span><span class="op" id="5683693">(</span><span class="builtinfunc" id="5683694">len</span><span class="op" id="5683697">(</span><span class="ident" id="5683698"><a href="/gostd/archive/zip/writer.go.html#5683266">h</a></span><span class="op" id="5683699">.</span><span class="ident" id="5683700"><a href="/gostd/archive/zip/struct.go.html#5670783">Extra</a></span><span class="op" id="5683705">)</span><span class="op" id="5683706">)</span><span class="op" id="5683707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683710">if</span>&nbsp;<span class="ident" id="5683713">_</span><span class="op" id="5683714">,</span>&nbsp;<span class="ident" id="5683716">err</span>&nbsp;<span class="op" id="5683720">:=</span>&nbsp;<span class="ident" id="5683723"><a href="/gostd/archive/zip/writer.go.html#5683253">w</a></span><span class="op" id="5683724">.</span><span class="ident" id="5683725"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="5683730">(</span><span class="ident" id="5683731"><a href="/gostd/archive/zip/writer.go.html#5683294">buf</a></span><span class="op" id="5683734">[</span><span class="op" id="5683735">:</span><span class="op" id="5683736">]</span><span class="op" id="5683737">)</span><span class="op" id="5683738">;</span>&nbsp;<span class="ident" id="5683740"><a href="/gostd/archive/zip/writer.go.html#5683716">err</a></span>&nbsp;<span class="op" id="5683744">!=</span>&nbsp;<span class="builtintype" id="5683747">nil</span>&nbsp;<span class="op" id="5683751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683755">return</span>&nbsp;<span class="ident" id="5683762"><a href="/gostd/archive/zip/writer.go.html#5683716">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5683767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683770">if</span>&nbsp;<span class="ident" id="5683773">_</span><span class="op" id="5683774">,</span>&nbsp;<span class="ident" id="5683776">err</span>&nbsp;<span class="op" id="5683780">:=</span>&nbsp;<span class="ident" id="5683783"><a href="/gostd/archive/zip/writer.go.html#5676844">io</a></span><span class="op" id="5683785">.</span><span class="ident" id="5683786"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="5683797">(</span><span class="ident" id="5683798"><a href="/gostd/archive/zip/writer.go.html#5683253">w</a></span><span class="op" id="5683799">,</span>&nbsp;<span class="ident" id="5683801"><a href="/gostd/archive/zip/writer.go.html#5683266">h</a></span><span class="op" id="5683802">.</span><span class="ident" id="5683803"><a href="/gostd/archive/zip/struct.go.html#5670368">Name</a></span><span class="op" id="5683807">)</span><span class="op" id="5683808">;</span>&nbsp;<span class="ident" id="5683810"><a href="/gostd/archive/zip/writer.go.html#5683776">err</a></span>&nbsp;<span class="op" id="5683814">!=</span>&nbsp;<span class="builtintype" id="5683817">nil</span>&nbsp;<span class="op" id="5683821">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683825">return</span>&nbsp;<span class="ident" id="5683832"><a href="/gostd/archive/zip/writer.go.html#5683776">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5683837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683840">_</span><span class="op" id="5683841">,</span>&nbsp;<span class="ident" id="5683843">err</span>&nbsp;<span class="op" id="5683847">:=</span>&nbsp;<span class="ident" id="5683850"><a href="/gostd/archive/zip/writer.go.html#5683253">w</a></span><span class="op" id="5683851">.</span><span class="ident" id="5683852"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="5683857">(</span><span class="ident" id="5683858"><a href="/gostd/archive/zip/writer.go.html#5683266">h</a></span><span class="op" id="5683859">.</span><span class="ident" id="5683860"><a href="/gostd/archive/zip/struct.go.html#5670783">Extra</a></span><span class="op" id="5683865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683868">return</span>&nbsp;<span class="ident" id="5683875"><a href="/gostd/archive/zip/writer.go.html#5683843">err</a></span><br>
<span class="lineno"></span><span class="op" id="5683879">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="5683882">type</span>&nbsp;<span class="ident" id="5683887">fileWriter</span>&nbsp;<span class="keyword" id="5683898">struct</span>&nbsp;<span class="op" id="5683905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5683908">*</span><span class="ident" id="5683909"><a href="/gostd/archive/zip/writer.go.html#5677081">header</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683917">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683927"><a href="/gostd/archive/zip/writer.go.html#5676844">io</a></span><span class="op" id="5683929">.</span><span class="ident" id="5683930"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683938">rawCount</span>&nbsp;&nbsp;<span class="op" id="5683948">*</span><span class="ident" id="5683949"><a href="/gostd/archive/zip/writer.go.html#5685638">countWriter</a></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683962">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683972"><a href="/gostd/archive/zip/writer.go.html#5676844">io</a></span><span class="op" id="5683974">.</span><span class="ident" id="5683975"><a href="/gostd/io/io.go.html#1423540">WriteCloser</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683988">compCount</span>&nbsp;<span class="op" id="5683998">*</span><span class="ident" id="5683999"><a href="/gostd/archive/zip/writer.go.html#5685638">countWriter</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684012">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684022"><a href="/gostd/archive/zip/writer.go.html#5676822">hash</a></span><span class="op" id="5684026">.</span><span class="ident" id="5684027"><a href="/gostd/hash/hash.go.html#3014832">Hash32</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684035">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5684045">bool</span><br>
<span class="lineno"></span><span class="op" id="5684050">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="5684053">func</span>&nbsp;<span class="op" id="5684058">(</span><span class="ident" id="5684059">w</span>&nbsp;<span class="op" id="5684061">*</span><span class="ident" id="5684062"><a href="/gostd/archive/zip/writer.go.html#5683887">fileWriter</a></span><span class="op" id="5684072">)</span>&nbsp;<span class="ident" id="5684074">Write</span><span class="op" id="5684079">(</span><span class="ident" id="5684080">p</span>&nbsp;<span class="op" id="5684082">[</span><span class="op" id="5684083">]</span><span class="builtintype" id="5684084">byte</span><span class="op" id="5684088">)</span>&nbsp;<span class="op" id="5684090">(</span><span class="builtintype" id="5684091">int</span><span class="op" id="5684094">,</span>&nbsp;<span class="builtintype" id="5684096">error</span><span class="op" id="5684101">)</span>&nbsp;<span class="op" id="5684103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5684106">if</span>&nbsp;<span class="ident" id="5684109"><a href="/gostd/archive/zip/writer.go.html#5684059">w</a></span><span class="op" id="5684110">.</span><span class="ident" id="5684111"><a href="/gostd/archive/zip/writer.go.html#5684035">closed</a></span>&nbsp;<span class="op" id="5684118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5684122">return</span>&nbsp;<span class="num" id="5684129">0</span><span class="op" id="5684130">,</span>&nbsp;<span class="ident" id="5684132"><a href="/gostd/archive/zip/writer.go.html#5676812">errors</a></span><span class="op" id="5684138">.</span><span class="ident" id="5684139"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5684142">(</span><span class="string" id="5684143">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="5684170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5684173">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684176"><a href="/gostd/archive/zip/writer.go.html#5684059">w</a></span><span class="op" id="5684177">.</span><span class="ident" id="5684178"><a href="/gostd/archive/zip/writer.go.html#5684012">crc32</a></span><span class="op" id="5684183">.</span><span class="ident" id="5684184"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="5684189">(</span><span class="ident" id="5684190"><a href="/gostd/archive/zip/writer.go.html#5684080">p</a></span><span class="op" id="5684191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5684194">return</span>&nbsp;<span class="ident" id="5684201"><a href="/gostd/archive/zip/writer.go.html#5684059">w</a></span><span class="op" id="5684202">.</span><span class="ident" id="5684203"><a href="/gostd/archive/zip/writer.go.html#5683938">rawCount</a></span><span class="op" id="5684211">.</span><span class="ident" id="5684212"><a href="/gostd/archive/zip/writer.go.html#5685714">Write</a></span><span class="op" id="5684217">(</span><span class="ident" id="5684218"><a href="/gostd/archive/zip/writer.go.html#5684080">p</a></span><span class="op" id="5684219">)</span><br>
<span class="lineno"></span><span class="op" id="5684221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5684224">func</span>&nbsp;<span class="op" id="5684229">(</span><span class="ident" id="5684230">w</span>&nbsp;<span class="op" id="5684232">*</span><span class="ident" id="5684233"><a href="/gostd/archive/zip/writer.go.html#5683887">fileWriter</a></span><span class="op" id="5684243">)</span>&nbsp;<span class="builtinfunc" id="5684245">close</span><span class="op" id="5684250">(</span><span class="op" id="5684251">)</span>&nbsp;<span class="builtintype" id="5684253">error</span>&nbsp;<span class="op" id="5684259">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5684262">if</span>&nbsp;<span class="ident" id="5684265"><a href="/gostd/archive/zip/writer.go.html#5684230">w</a></span><span class="op" id="5684266">.</span><span class="ident" id="5684267"><a href="/gostd/archive/zip/writer.go.html#5684035">closed</a></span>&nbsp;<span class="op" id="5684274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5684278">return</span>&nbsp;<span class="ident" id="5684285"><a href="/gostd/archive/zip/writer.go.html#5676812">errors</a></span><span class="op" id="5684291">.</span><span class="ident" id="5684292"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5684295">(</span><span class="string" id="5684296">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="5684320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5684323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684326"><a href="/gostd/archive/zip/writer.go.html#5684230">w</a></span><span class="op" id="5684327">.</span><span class="ident" id="5684328"><a href="/gostd/archive/zip/writer.go.html#5684035">closed</a></span>&nbsp;<span class="op" id="5684335">=</span>&nbsp;<span class="builtintype" id="5684337">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5684343">if</span>&nbsp;<span class="ident" id="5684346">err</span>&nbsp;<span class="op" id="5684350">:=</span>&nbsp;<span class="ident" id="5684353"><a href="/gostd/archive/zip/writer.go.html#5684230">w</a></span><span class="op" id="5684354">.</span><span class="ident" id="5684355"><a href="/gostd/archive/zip/writer.go.html#5683962">comp</a></span><span class="op" id="5684359">.</span><span class="ident" id="5684360"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="5684365">(</span><span class="op" id="5684366">)</span><span class="op" id="5684367">;</span>&nbsp;<span class="ident" id="5684369"><a href="/gostd/archive/zip/writer.go.html#5684346">err</a></span>&nbsp;<span class="op" id="5684373">!=</span>&nbsp;<span class="builtintype" id="5684376">nil</span>&nbsp;<span class="op" id="5684380">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5684384">return</span>&nbsp;<span class="ident" id="5684391"><a href="/gostd/archive/zip/writer.go.html#5684346">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5684396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5684400">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684422">fh</span>&nbsp;<span class="op" id="5684425">:=</span>&nbsp;<span class="ident" id="5684428"><a href="/gostd/archive/zip/writer.go.html#5684230">w</a></span><span class="op" id="5684429">.</span><span class="ident" id="5684430"><a href="/gostd/archive/zip/writer.go.html#5683908">header</a></span><span class="op" id="5684436">.</span><span class="ident" id="5684437"><a href="/gostd/archive/zip/writer.go.html#5677098">FileHeader</a></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684449"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5684451">.</span><span class="ident" id="5684452"><a href="/gostd/archive/zip/struct.go.html#5670574">CRC32</a></span>&nbsp;<span class="op" id="5684458">=</span>&nbsp;<span class="ident" id="5684460"><a href="/gostd/archive/zip/writer.go.html#5684230">w</a></span><span class="op" id="5684461">.</span><span class="ident" id="5684462"><a href="/gostd/archive/zip/writer.go.html#5684012">crc32</a></span><span class="op" id="5684467">.</span><span class="ident" id="5684468"><a href="/gostd/hash/hash.go.html#3014858">Sum32</a></span><span class="op" id="5684473">(</span><span class="op" id="5684474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684477"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5684479">.</span><span class="ident" id="5684480"><a href="/gostd/archive/zip/struct.go.html#5670729">CompressedSize64</a></span>&nbsp;<span class="op" id="5684497">=</span>&nbsp;<span class="builtintype" id="5684499">uint64</span><span class="op" id="5684505">(</span><span class="ident" id="5684506"><a href="/gostd/archive/zip/writer.go.html#5684230">w</a></span><span class="op" id="5684507">.</span><span class="ident" id="5684508"><a href="/gostd/archive/zip/writer.go.html#5683988">compCount</a></span><span class="op" id="5684517">.</span><span class="ident" id="5684518"><a href="/gostd/archive/zip/writer.go.html#5685677">count</a></span><span class="op" id="5684523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684526"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5684528">.</span><span class="ident" id="5684529"><a href="/gostd/archive/zip/struct.go.html#5670756">UncompressedSize64</a></span>&nbsp;<span class="op" id="5684548">=</span>&nbsp;<span class="builtintype" id="5684550">uint64</span><span class="op" id="5684556">(</span><span class="ident" id="5684557"><a href="/gostd/archive/zip/writer.go.html#5684230">w</a></span><span class="op" id="5684558">.</span><span class="ident" id="5684559"><a href="/gostd/archive/zip/writer.go.html#5683938">rawCount</a></span><span class="op" id="5684567">.</span><span class="ident" id="5684568"><a href="/gostd/archive/zip/writer.go.html#5685677">count</a></span><span class="op" id="5684573">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5684577">if</span>&nbsp;<span class="ident" id="5684580"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5684582">.</span><span class="ident" id="5684583"><a href="/gostd/archive/zip/struct.go.html#5675216">isZip64</a></span><span class="op" id="5684590">(</span><span class="op" id="5684591">)</span>&nbsp;<span class="op" id="5684593">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684597"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5684599">.</span><span class="ident" id="5684600"><a href="/gostd/archive/zip/struct.go.html#5670601">CompressedSize</a></span>&nbsp;<span class="op" id="5684615">=</span>&nbsp;<span class="ident" id="5684617"><a href="/gostd/archive/zip/struct.go.html#5669964">uint32max</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684629"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5684631">.</span><span class="ident" id="5684632"><a href="/gostd/archive/zip/struct.go.html#5670664">UncompressedSize</a></span>&nbsp;<span class="op" id="5684649">=</span>&nbsp;<span class="ident" id="5684651"><a href="/gostd/archive/zip/struct.go.html#5669964">uint32max</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684663"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5684665">.</span><span class="ident" id="5684666"><a href="/gostd/archive/zip/struct.go.html#5670409">ReaderVersion</a></span>&nbsp;<span class="op" id="5684680">=</span>&nbsp;<span class="ident" id="5684682"><a href="/gostd/archive/zip/struct.go.html#5669845">zipVersion45</a></span>&nbsp;<span class="comment" id="5684695">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5684748">}</span>&nbsp;<span class="keyword" id="5684750">else</span>&nbsp;<span class="op" id="5684755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684759"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5684761">.</span><span class="ident" id="5684762"><a href="/gostd/archive/zip/struct.go.html#5670601">CompressedSize</a></span>&nbsp;<span class="op" id="5684777">=</span>&nbsp;<span class="builtintype" id="5684779">uint32</span><span class="op" id="5684785">(</span><span class="ident" id="5684786"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5684788">.</span><span class="ident" id="5684789"><a href="/gostd/archive/zip/struct.go.html#5670729">CompressedSize64</a></span><span class="op" id="5684805">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684809"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5684811">.</span><span class="ident" id="5684812"><a href="/gostd/archive/zip/struct.go.html#5670664">UncompressedSize</a></span>&nbsp;<span class="op" id="5684829">=</span>&nbsp;<span class="builtintype" id="5684831">uint32</span><span class="op" id="5684837">(</span><span class="ident" id="5684838"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5684840">.</span><span class="ident" id="5684841"><a href="/gostd/archive/zip/struct.go.html#5670756">UncompressedSize64</a></span><span class="op" id="5684859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5684862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5684866">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5684933">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5684993">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5685057">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5685122">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685186">var</span>&nbsp;<span class="ident" id="5685190">buf</span>&nbsp;<span class="op" id="5685194">[</span><span class="op" id="5685195">]</span><span class="builtintype" id="5685196">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685202">if</span>&nbsp;<span class="ident" id="5685205"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5685207">.</span><span class="ident" id="5685208"><a href="/gostd/archive/zip/struct.go.html#5675216">isZip64</a></span><span class="op" id="5685215">(</span><span class="op" id="5685216">)</span>&nbsp;<span class="op" id="5685218">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685222"><a href="/gostd/archive/zip/writer.go.html#5685190">buf</a></span>&nbsp;<span class="op" id="5685226">=</span>&nbsp;<span class="builtinfunc" id="5685228">make</span><span class="op" id="5685232">(</span><span class="op" id="5685233">[</span><span class="op" id="5685234">]</span><span class="builtintype" id="5685235">byte</span><span class="op" id="5685239">,</span>&nbsp;<span class="ident" id="5685241"><a href="/gostd/archive/zip/struct.go.html#5669485">dataDescriptor64Len</a></span><span class="op" id="5685260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5685263">}</span>&nbsp;<span class="keyword" id="5685265">else</span>&nbsp;<span class="op" id="5685270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685274"><a href="/gostd/archive/zip/writer.go.html#5685190">buf</a></span>&nbsp;<span class="op" id="5685278">=</span>&nbsp;<span class="builtinfunc" id="5685280">make</span><span class="op" id="5685284">(</span><span class="op" id="5685285">[</span><span class="op" id="5685286">]</span><span class="builtintype" id="5685287">byte</span><span class="op" id="5685291">,</span>&nbsp;<span class="ident" id="5685293"><a href="/gostd/archive/zip/struct.go.html#5669379">dataDescriptorLen</a></span><span class="op" id="5685310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5685313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685316">b</span>&nbsp;<span class="op" id="5685318">:=</span>&nbsp;<span class="ident" id="5685321"><a href="/gostd/archive/zip/writer.go.html#5685901">writeBuf</a></span><span class="op" id="5685329">(</span><span class="ident" id="5685330"><a href="/gostd/archive/zip/writer.go.html#5685190">buf</a></span><span class="op" id="5685333">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685336"><a href="/gostd/archive/zip/writer.go.html#5685316">b</a></span><span class="op" id="5685337">.</span><span class="builtintype" id="5685338"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5685344">(</span><span class="ident" id="5685345"><a href="/gostd/archive/zip/struct.go.html#5669110">dataDescriptorSignature</a></span><span class="op" id="5685368">)</span>&nbsp;<span class="comment" id="5685370">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685410"><a href="/gostd/archive/zip/writer.go.html#5685316">b</a></span><span class="op" id="5685411">.</span><span class="builtintype" id="5685412"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5685418">(</span><span class="ident" id="5685419"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5685421">.</span><span class="ident" id="5685422"><a href="/gostd/archive/zip/struct.go.html#5670574">CRC32</a></span><span class="op" id="5685427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685430">if</span>&nbsp;<span class="ident" id="5685433"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5685435">.</span><span class="ident" id="5685436"><a href="/gostd/archive/zip/struct.go.html#5675216">isZip64</a></span><span class="op" id="5685443">(</span><span class="op" id="5685444">)</span>&nbsp;<span class="op" id="5685446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685450"><a href="/gostd/archive/zip/writer.go.html#5685316">b</a></span><span class="op" id="5685451">.</span><span class="builtintype" id="5685452"><a href="/gostd/archive/zip/writer.go.html#5686125">uint64</a></span><span class="op" id="5685458">(</span><span class="ident" id="5685459"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5685461">.</span><span class="ident" id="5685462"><a href="/gostd/archive/zip/struct.go.html#5670729">CompressedSize64</a></span><span class="op" id="5685478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685482"><a href="/gostd/archive/zip/writer.go.html#5685316">b</a></span><span class="op" id="5685483">.</span><span class="builtintype" id="5685484"><a href="/gostd/archive/zip/writer.go.html#5686125">uint64</a></span><span class="op" id="5685490">(</span><span class="ident" id="5685491"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5685493">.</span><span class="ident" id="5685494"><a href="/gostd/archive/zip/struct.go.html#5670756">UncompressedSize64</a></span><span class="op" id="5685512">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5685515">}</span>&nbsp;<span class="keyword" id="5685517">else</span>&nbsp;<span class="op" id="5685522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685526"><a href="/gostd/archive/zip/writer.go.html#5685316">b</a></span><span class="op" id="5685527">.</span><span class="builtintype" id="5685528"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5685534">(</span><span class="ident" id="5685535"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5685537">.</span><span class="ident" id="5685538"><a href="/gostd/archive/zip/struct.go.html#5670601">CompressedSize</a></span><span class="op" id="5685552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685556"><a href="/gostd/archive/zip/writer.go.html#5685316">b</a></span><span class="op" id="5685557">.</span><span class="builtintype" id="5685558"><a href="/gostd/archive/zip/writer.go.html#5686031">uint32</a></span><span class="op" id="5685564">(</span><span class="ident" id="5685565"><a href="/gostd/archive/zip/writer.go.html#5684422">fh</a></span><span class="op" id="5685567">.</span><span class="ident" id="5685568"><a href="/gostd/archive/zip/struct.go.html#5670664">UncompressedSize</a></span><span class="op" id="5685584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5685587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685590">_</span><span class="op" id="5685591">,</span>&nbsp;<span class="ident" id="5685593">err</span>&nbsp;<span class="op" id="5685597">:=</span>&nbsp;<span class="ident" id="5685600"><a href="/gostd/archive/zip/writer.go.html#5684230">w</a></span><span class="op" id="5685601">.</span><span class="ident" id="5685602"><a href="/gostd/archive/zip/writer.go.html#5683917">zipw</a></span><span class="op" id="5685606">.</span><span class="ident" id="5685607"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="5685612">(</span><span class="ident" id="5685613"><a href="/gostd/archive/zip/writer.go.html#5685190">buf</a></span><span class="op" id="5685616">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685619">return</span>&nbsp;<span class="ident" id="5685626"><a href="/gostd/archive/zip/writer.go.html#5685593">err</a></span><br>
<span class="lineno"></span><span class="op" id="5685630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5685633">type</span>&nbsp;<span class="ident" id="5685638">countWriter</span>&nbsp;<span class="keyword" id="5685650">struct</span>&nbsp;<span class="op" id="5685657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685660">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685666"><a href="/gostd/archive/zip/writer.go.html#5676844">io</a></span><span class="op" id="5685668">.</span><span class="ident" id="5685669"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685677">count</span>&nbsp;<span class="builtintype" id="5685683">int64</span><br>
<span class="lineno"></span><span class="op" id="5685689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5685692">func</span>&nbsp;<span class="op" id="5685697">(</span><span class="ident" id="5685698">w</span>&nbsp;<span class="op" id="5685700">*</span><span class="ident" id="5685701"><a href="/gostd/archive/zip/writer.go.html#5685638">countWriter</a></span><span class="op" id="5685712">)</span>&nbsp;<span class="ident" id="5685714">Write</span><span class="op" id="5685719">(</span><span class="ident" id="5685720">p</span>&nbsp;<span class="op" id="5685722">[</span><span class="op" id="5685723">]</span><span class="builtintype" id="5685724">byte</span><span class="op" id="5685728">)</span>&nbsp;<span class="op" id="5685730">(</span><span class="builtintype" id="5685731">int</span><span class="op" id="5685734">,</span>&nbsp;<span class="builtintype" id="5685736">error</span><span class="op" id="5685741">)</span>&nbsp;<span class="op" id="5685743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685746">n</span><span class="op" id="5685747">,</span>&nbsp;<span class="ident" id="5685749">err</span>&nbsp;<span class="op" id="5685753">:=</span>&nbsp;<span class="ident" id="5685756"><a href="/gostd/archive/zip/writer.go.html#5685698">w</a></span><span class="op" id="5685757">.</span><span class="ident" id="5685758"><a href="/gostd/archive/zip/writer.go.html#5685660">w</a></span><span class="op" id="5685759">.</span><span class="ident" id="5685760"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="5685765">(</span><span class="ident" id="5685766"><a href="/gostd/archive/zip/writer.go.html#5685720">p</a></span><span class="op" id="5685767">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685770"><a href="/gostd/archive/zip/writer.go.html#5685698">w</a></span><span class="op" id="5685771">.</span><span class="ident" id="5685772"><a href="/gostd/archive/zip/writer.go.html#5685677">count</a></span>&nbsp;<span class="op" id="5685778">+=</span>&nbsp;<span class="builtintype" id="5685781">int64</span><span class="op" id="5685786">(</span><span class="ident" id="5685787"><a href="/gostd/archive/zip/writer.go.html#5685746">n</a></span><span class="op" id="5685788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685791">return</span>&nbsp;<span class="ident" id="5685798"><a href="/gostd/archive/zip/writer.go.html#5685746">n</a></span><span class="op" id="5685799">,</span>&nbsp;<span class="ident" id="5685801"><a href="/gostd/archive/zip/writer.go.html#5685749">err</a></span><br>
<span class="lineno"></span><span class="op" id="5685805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5685808">type</span>&nbsp;<span class="ident" id="5685813">nopCloser</span>&nbsp;<span class="keyword" id="5685823">struct</span>&nbsp;<span class="op" id="5685830">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685833"><a href="/gostd/archive/zip/writer.go.html#5676844">io</a></span><span class="op" id="5685835">.</span><span class="ident" id="5685836"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><br>
<span class="lineno"></span><span class="op" id="5685843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5685846">func</span>&nbsp;<span class="op" id="5685851">(</span><span class="ident" id="5685852">w</span>&nbsp;<span class="ident" id="5685854"><a href="/gostd/archive/zip/writer.go.html#5685813">nopCloser</a></span><span class="op" id="5685863">)</span>&nbsp;<span class="ident" id="5685865">Close</span><span class="op" id="5685870">(</span><span class="op" id="5685871">)</span>&nbsp;<span class="builtintype" id="5685873">error</span>&nbsp;<span class="op" id="5685879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685882">return</span>&nbsp;<span class="builtintype" id="5685889">nil</span><br>
<span class="lineno">340</span><span class="op" id="5685893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5685896">type</span>&nbsp;<span class="ident" id="5685901">writeBuf</span>&nbsp;<span class="op" id="5685910">[</span><span class="op" id="5685911">]</span><span class="builtintype" id="5685912">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5685918">func</span>&nbsp;<span class="op" id="5685923">(</span><span class="ident" id="5685924">b</span>&nbsp;<span class="op" id="5685926">*</span><span class="ident" id="5685927"><a href="/gostd/archive/zip/writer.go.html#5685901">writeBuf</a></span><span class="op" id="5685935">)</span>&nbsp;<span class="builtintype" id="5685937">uint16</span><span class="op" id="5685943">(</span><span class="ident" id="5685944">v</span>&nbsp;<span class="builtintype" id="5685946">uint16</span><span class="op" id="5685952">)</span>&nbsp;<span class="op" id="5685954">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685957"><a href="/gostd/archive/zip/writer.go.html#5676793">binary</a></span><span class="op" id="5685963">.</span><span class="ident" id="5685964"><a href="/gostd/encoding/binary/binary.go.html#2987055">LittleEndian</a></span><span class="op" id="5685976">.</span><span class="ident" id="5685977"><a href="/gostd/encoding/binary/binary.go.html#2987302">PutUint16</a></span><span class="op" id="5685986">(</span><span class="op" id="5685987">*</span><span class="ident" id="5685988"><a href="/gostd/archive/zip/writer.go.html#5685924">b</a></span><span class="op" id="5685989">,</span>&nbsp;<span class="ident" id="5685991"><a href="/gostd/archive/zip/writer.go.html#5685944">v</a></span><span class="op" id="5685992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5685995">*</span><span class="ident" id="5685996"><a href="/gostd/archive/zip/writer.go.html#5685924">b</a></span>&nbsp;<span class="op" id="5685998">=</span>&nbsp;<span class="op" id="5686000">(</span><span class="op" id="5686001">*</span><span class="ident" id="5686002"><a href="/gostd/archive/zip/writer.go.html#5685924">b</a></span><span class="op" id="5686003">)</span><span class="op" id="5686004">[</span><span class="num" id="5686005">2</span><span class="op" id="5686006">:</span><span class="op" id="5686007">]</span><br>
<span class="lineno"></span><span class="op" id="5686009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5686012">func</span>&nbsp;<span class="op" id="5686017">(</span><span class="ident" id="5686018">b</span>&nbsp;<span class="op" id="5686020">*</span><span class="ident" id="5686021"><a href="/gostd/archive/zip/writer.go.html#5685901">writeBuf</a></span><span class="op" id="5686029">)</span>&nbsp;<span class="builtintype" id="5686031">uint32</span><span class="op" id="5686037">(</span><span class="ident" id="5686038">v</span>&nbsp;<span class="builtintype" id="5686040">uint32</span><span class="op" id="5686046">)</span>&nbsp;<span class="op" id="5686048">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5686051"><a href="/gostd/archive/zip/writer.go.html#5676793">binary</a></span><span class="op" id="5686057">.</span><span class="ident" id="5686058"><a href="/gostd/encoding/binary/binary.go.html#2987055">LittleEndian</a></span><span class="op" id="5686070">.</span><span class="ident" id="5686071"><a href="/gostd/encoding/binary/binary.go.html#2987520">PutUint32</a></span><span class="op" id="5686080">(</span><span class="op" id="5686081">*</span><span class="ident" id="5686082"><a href="/gostd/archive/zip/writer.go.html#5686018">b</a></span><span class="op" id="5686083">,</span>&nbsp;<span class="ident" id="5686085"><a href="/gostd/archive/zip/writer.go.html#5686038">v</a></span><span class="op" id="5686086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5686089">*</span><span class="ident" id="5686090"><a href="/gostd/archive/zip/writer.go.html#5686018">b</a></span>&nbsp;<span class="op" id="5686092">=</span>&nbsp;<span class="op" id="5686094">(</span><span class="op" id="5686095">*</span><span class="ident" id="5686096"><a href="/gostd/archive/zip/writer.go.html#5686018">b</a></span><span class="op" id="5686097">)</span><span class="op" id="5686098">[</span><span class="num" id="5686099">4</span><span class="op" id="5686100">:</span><span class="op" id="5686101">]</span><br>
<span class="lineno"></span><span class="op" id="5686103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5686106">func</span>&nbsp;<span class="op" id="5686111">(</span><span class="ident" id="5686112">b</span>&nbsp;<span class="op" id="5686114">*</span><span class="ident" id="5686115"><a href="/gostd/archive/zip/writer.go.html#5685901">writeBuf</a></span><span class="op" id="5686123">)</span>&nbsp;<span class="builtintype" id="5686125">uint64</span><span class="op" id="5686131">(</span><span class="ident" id="5686132">v</span>&nbsp;<span class="builtintype" id="5686134">uint64</span><span class="op" id="5686140">)</span>&nbsp;<span class="op" id="5686142">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5686145"><a href="/gostd/archive/zip/writer.go.html#5676793">binary</a></span><span class="op" id="5686151">.</span><span class="ident" id="5686152"><a href="/gostd/encoding/binary/binary.go.html#2987055">LittleEndian</a></span><span class="op" id="5686164">.</span><span class="ident" id="5686165"><a href="/gostd/encoding/binary/binary.go.html#2987860">PutUint64</a></span><span class="op" id="5686174">(</span><span class="op" id="5686175">*</span><span class="ident" id="5686176"><a href="/gostd/archive/zip/writer.go.html#5686112">b</a></span><span class="op" id="5686177">,</span>&nbsp;<span class="ident" id="5686179"><a href="/gostd/archive/zip/writer.go.html#5686132">v</a></span><span class="op" id="5686180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5686183">*</span><span class="ident" id="5686184"><a href="/gostd/archive/zip/writer.go.html#5686112">b</a></span>&nbsp;<span class="op" id="5686186">=</span>&nbsp;<span class="op" id="5686188">(</span><span class="op" id="5686189">*</span><span class="ident" id="5686190"><a href="/gostd/archive/zip/writer.go.html#5686112">b</a></span><span class="op" id="5686191">)</span><span class="op" id="5686192">[</span><span class="num" id="5686193">8</span><span class="op" id="5686194">:</span><span class="op" id="5686195">]</span><br>
<span class="lineno"></span><span class="op" id="5686197">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
