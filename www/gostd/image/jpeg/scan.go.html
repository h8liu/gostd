<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5676252">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5676307">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5676361">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5676412">package</span>&nbsp;<span class="ident" id="5676420">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5676426">import</span>&nbsp;<span class="op" id="5676433">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5676436">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="5676444">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5676447">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5676507">func</span>&nbsp;<span class="op" id="5676512">(</span><span class="ident" id="5676513">d</span>&nbsp;<span class="op" id="5676515">*</span><span class="ident" id="5676516">decoder</span><span class="op" id="5676523">)</span>&nbsp;<span class="ident" id="5676525">makeImg</span><span class="op" id="5676532">(</span><span class="ident" id="5676533">h0</span><span class="op" id="5676535">,</span>&nbsp;<span class="ident" id="5676537">v0</span><span class="op" id="5676539">,</span>&nbsp;<span class="ident" id="5676541">mxx</span><span class="op" id="5676544">,</span>&nbsp;<span class="ident" id="5676546">myy</span>&nbsp;<span class="builtintype" id="5676550">int</span><span class="op" id="5676553">)</span>&nbsp;<span class="op" id="5676555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676558">if</span>&nbsp;<span class="ident" id="5676561">d</span><span class="op" id="5676562">.</span><span class="ident" id="5676563">nComp</span>&nbsp;<span class="op" id="5676569">==</span>&nbsp;<span class="ident" id="5676572">nGrayComponent</span>&nbsp;<span class="op" id="5676587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676591">m</span>&nbsp;<span class="op" id="5676593">:=</span>&nbsp;<span class="ident" id="5676596">image</span><span class="op" id="5676601">.</span><span class="ident" id="5676602">NewGray</span><span class="op" id="5676609">(</span><span class="ident" id="5676610">image</span><span class="op" id="5676615">.</span><span class="ident" id="5676616">Rect</span><span class="op" id="5676620">(</span><span class="num" id="5676621">0</span><span class="op" id="5676622">,</span>&nbsp;<span class="num" id="5676624">0</span><span class="op" id="5676625">,</span>&nbsp;<span class="num" id="5676627">8</span><span class="op" id="5676628">*</span><span class="ident" id="5676629">mxx</span><span class="op" id="5676632">,</span>&nbsp;<span class="num" id="5676634">8</span><span class="op" id="5676635">*</span><span class="ident" id="5676636">myy</span><span class="op" id="5676639">)</span><span class="op" id="5676640">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676644">d</span><span class="op" id="5676645">.</span><span class="ident" id="5676646">img1</span>&nbsp;<span class="op" id="5676651">=</span>&nbsp;<span class="ident" id="5676653">m</span><span class="op" id="5676654">.</span><span class="ident" id="5676655">SubImage</span><span class="op" id="5676663">(</span><span class="ident" id="5676664">image</span><span class="op" id="5676669">.</span><span class="ident" id="5676670">Rect</span><span class="op" id="5676674">(</span><span class="num" id="5676675">0</span><span class="op" id="5676676">,</span>&nbsp;<span class="num" id="5676678">0</span><span class="op" id="5676679">,</span>&nbsp;<span class="ident" id="5676681">d</span><span class="op" id="5676682">.</span><span class="ident" id="5676683">width</span><span class="op" id="5676688">,</span>&nbsp;<span class="ident" id="5676690">d</span><span class="op" id="5676691">.</span><span class="ident" id="5676692">height</span><span class="op" id="5676698">)</span><span class="op" id="5676699">)</span><span class="op" id="5676700">.</span><span class="op" id="5676701">(</span><span class="op" id="5676702">*</span><span class="ident" id="5676703">image</span><span class="op" id="5676708">.</span><span class="ident" id="5676709">Gray</span><span class="op" id="5676713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676717">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676728">var</span>&nbsp;<span class="ident" id="5676732">subsampleRatio</span>&nbsp;<span class="ident" id="5676747">image</span><span class="op" id="5676752">.</span><span class="ident" id="5676753">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676774">switch</span>&nbsp;<span class="op" id="5676781">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676784">case</span>&nbsp;<span class="ident" id="5676789">h0</span>&nbsp;<span class="op" id="5676792">==</span>&nbsp;<span class="num" id="5676795">1</span>&nbsp;<span class="op" id="5676797">&amp;&amp;</span>&nbsp;<span class="ident" id="5676800">v0</span>&nbsp;<span class="op" id="5676803">==</span>&nbsp;<span class="num" id="5676806">1</span><span class="op" id="5676807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676811">subsampleRatio</span>&nbsp;<span class="op" id="5676826">=</span>&nbsp;<span class="ident" id="5676828">image</span><span class="op" id="5676833">.</span><span class="ident" id="5676834">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676858">case</span>&nbsp;<span class="ident" id="5676863">h0</span>&nbsp;<span class="op" id="5676866">==</span>&nbsp;<span class="num" id="5676869">1</span>&nbsp;<span class="op" id="5676871">&amp;&amp;</span>&nbsp;<span class="ident" id="5676874">v0</span>&nbsp;<span class="op" id="5676877">==</span>&nbsp;<span class="num" id="5676880">2</span><span class="op" id="5676881">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676885">subsampleRatio</span>&nbsp;<span class="op" id="5676900">=</span>&nbsp;<span class="ident" id="5676902">image</span><span class="op" id="5676907">.</span><span class="ident" id="5676908">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676932">case</span>&nbsp;<span class="ident" id="5676937">h0</span>&nbsp;<span class="op" id="5676940">==</span>&nbsp;<span class="num" id="5676943">2</span>&nbsp;<span class="op" id="5676945">&amp;&amp;</span>&nbsp;<span class="ident" id="5676948">v0</span>&nbsp;<span class="op" id="5676951">==</span>&nbsp;<span class="num" id="5676954">1</span><span class="op" id="5676955">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676959">subsampleRatio</span>&nbsp;<span class="op" id="5676974">=</span>&nbsp;<span class="ident" id="5676976">image</span><span class="op" id="5676981">.</span><span class="ident" id="5676982">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677006">case</span>&nbsp;<span class="ident" id="5677011">h0</span>&nbsp;<span class="op" id="5677014">==</span>&nbsp;<span class="num" id="5677017">2</span>&nbsp;<span class="op" id="5677019">&amp;&amp;</span>&nbsp;<span class="ident" id="5677022">v0</span>&nbsp;<span class="op" id="5677025">==</span>&nbsp;<span class="num" id="5677028">2</span><span class="op" id="5677029">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677033">subsampleRatio</span>&nbsp;<span class="op" id="5677048">=</span>&nbsp;<span class="ident" id="5677050">image</span><span class="op" id="5677055">.</span><span class="ident" id="5677056">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677080">default</span><span class="op" id="5677087">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5677091">panic</span><span class="op" id="5677096">(</span><span class="string" id="5677097">&#34;unreachable&#34;</span><span class="op" id="5677110">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677116">m</span>&nbsp;<span class="op" id="5677118">:=</span>&nbsp;<span class="ident" id="5677121">image</span><span class="op" id="5677126">.</span><span class="ident" id="5677127">NewYCbCr</span><span class="op" id="5677135">(</span><span class="ident" id="5677136">image</span><span class="op" id="5677141">.</span><span class="ident" id="5677142">Rect</span><span class="op" id="5677146">(</span><span class="num" id="5677147">0</span><span class="op" id="5677148">,</span>&nbsp;<span class="num" id="5677150">0</span><span class="op" id="5677151">,</span>&nbsp;<span class="num" id="5677153">8</span><span class="op" id="5677154">*</span><span class="ident" id="5677155">h0</span><span class="op" id="5677157">*</span><span class="ident" id="5677158">mxx</span><span class="op" id="5677161">,</span>&nbsp;<span class="num" id="5677163">8</span><span class="op" id="5677164">*</span><span class="ident" id="5677165">v0</span><span class="op" id="5677167">*</span><span class="ident" id="5677168">myy</span><span class="op" id="5677171">)</span><span class="op" id="5677172">,</span>&nbsp;<span class="ident" id="5677174">subsampleRatio</span><span class="op" id="5677188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677191">d</span><span class="op" id="5677192">.</span><span class="ident" id="5677193">img3</span>&nbsp;<span class="op" id="5677198">=</span>&nbsp;<span class="ident" id="5677200">m</span><span class="op" id="5677201">.</span><span class="ident" id="5677202">SubImage</span><span class="op" id="5677210">(</span><span class="ident" id="5677211">image</span><span class="op" id="5677216">.</span><span class="ident" id="5677217">Rect</span><span class="op" id="5677221">(</span><span class="num" id="5677222">0</span><span class="op" id="5677223">,</span>&nbsp;<span class="num" id="5677225">0</span><span class="op" id="5677226">,</span>&nbsp;<span class="ident" id="5677228">d</span><span class="op" id="5677229">.</span><span class="ident" id="5677230">width</span><span class="op" id="5677235">,</span>&nbsp;<span class="ident" id="5677237">d</span><span class="op" id="5677238">.</span><span class="ident" id="5677239">height</span><span class="op" id="5677245">)</span><span class="op" id="5677246">)</span><span class="op" id="5677247">.</span><span class="op" id="5677248">(</span><span class="op" id="5677249">*</span><span class="ident" id="5677250">image</span><span class="op" id="5677255">.</span><span class="ident" id="5677256">YCbCr</span><span class="op" id="5677261">)</span><br>
<span class="lineno"></span><span class="op" id="5677263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5677266">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="5677297">func</span>&nbsp;<span class="op" id="5677302">(</span><span class="ident" id="5677303">d</span>&nbsp;<span class="op" id="5677305">*</span><span class="ident" id="5677306">decoder</span><span class="op" id="5677313">)</span>&nbsp;<span class="ident" id="5677315">processSOS</span><span class="op" id="5677325">(</span><span class="ident" id="5677326">n</span>&nbsp;<span class="builtintype" id="5677328">int</span><span class="op" id="5677331">)</span>&nbsp;<span class="builtintype" id="5677333">error</span>&nbsp;<span class="op" id="5677339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677342">if</span>&nbsp;<span class="ident" id="5677345">d</span><span class="op" id="5677346">.</span><span class="ident" id="5677347">nComp</span>&nbsp;<span class="op" id="5677353">==</span>&nbsp;<span class="num" id="5677356">0</span>&nbsp;<span class="op" id="5677358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677362">return</span>&nbsp;<span class="ident" id="5677369">FormatError</span><span class="op" id="5677380">(</span><span class="string" id="5677381">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="5677401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677404">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677407">if</span>&nbsp;<span class="ident" id="5677410">n</span>&nbsp;<span class="op" id="5677412">&lt;</span>&nbsp;<span class="num" id="5677414">6</span>&nbsp;<span class="op" id="5677416">||</span>&nbsp;<span class="num" id="5677419">4</span><span class="op" id="5677420">+</span><span class="num" id="5677421">2</span><span class="op" id="5677422">*</span><span class="ident" id="5677423">d</span><span class="op" id="5677424">.</span><span class="ident" id="5677425">nComp</span>&nbsp;<span class="op" id="5677431">&lt;</span>&nbsp;<span class="ident" id="5677433">n</span>&nbsp;<span class="op" id="5677435">||</span>&nbsp;<span class="ident" id="5677438">n</span><span class="op" id="5677439">%</span><span class="num" id="5677440">2</span>&nbsp;<span class="op" id="5677442">!=</span>&nbsp;<span class="num" id="5677445">0</span>&nbsp;<span class="op" id="5677447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677451">return</span>&nbsp;<span class="ident" id="5677458">FormatError</span><span class="op" id="5677469">(</span><span class="string" id="5677470">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5677492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677498">if</span>&nbsp;<span class="ident" id="5677501">err</span>&nbsp;<span class="op" id="5677505">:=</span>&nbsp;<span class="ident" id="5677508">d</span><span class="op" id="5677509">.</span><span class="ident" id="5677510">readFull</span><span class="op" id="5677518">(</span><span class="ident" id="5677519">d</span><span class="op" id="5677520">.</span><span class="ident" id="5677521">tmp</span><span class="op" id="5677524">[</span><span class="op" id="5677525">:</span><span class="ident" id="5677526">n</span><span class="op" id="5677527">]</span><span class="op" id="5677528">)</span><span class="op" id="5677529">;</span>&nbsp;<span class="ident" id="5677531">err</span>&nbsp;<span class="op" id="5677535">!=</span>&nbsp;<span class="ident" id="5677538">nil</span>&nbsp;<span class="op" id="5677542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677546">return</span>&nbsp;<span class="ident" id="5677553">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677561">nComp</span>&nbsp;<span class="op" id="5677567">:=</span>&nbsp;<span class="builtintype" id="5677570">int</span><span class="op" id="5677573">(</span><span class="ident" id="5677574">d</span><span class="op" id="5677575">.</span><span class="ident" id="5677576">tmp</span><span class="op" id="5677579">[</span><span class="num" id="5677580">0</span><span class="op" id="5677581">]</span><span class="op" id="5677582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677585">if</span>&nbsp;<span class="ident" id="5677588">n</span>&nbsp;<span class="op" id="5677590">!=</span>&nbsp;<span class="num" id="5677593">4</span><span class="op" id="5677594">+</span><span class="num" id="5677595">2</span><span class="op" id="5677596">*</span><span class="ident" id="5677597">nComp</span>&nbsp;<span class="op" id="5677603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677607">return</span>&nbsp;<span class="ident" id="5677614">FormatError</span><span class="op" id="5677625">(</span><span class="string" id="5677626">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="5677677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677680">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677683">var</span>&nbsp;<span class="ident" id="5677687">scan</span>&nbsp;<span class="op" id="5677692">[</span><span class="ident" id="5677693">nColorComponent</span><span class="op" id="5677708">]</span><span class="keyword" id="5677709">struct</span>&nbsp;<span class="op" id="5677716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677720">compIndex</span>&nbsp;<span class="builtintype" id="5677730">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677738">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5677748">uint8</span>&nbsp;<span class="comment" id="5677754">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677778">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5677788">uint8</span>&nbsp;<span class="comment" id="5677794">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677817">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677820">for</span>&nbsp;<span class="ident" id="5677824">i</span>&nbsp;<span class="op" id="5677826">:=</span>&nbsp;<span class="num" id="5677829">0</span><span class="op" id="5677830">;</span>&nbsp;<span class="ident" id="5677832">i</span>&nbsp;<span class="op" id="5677834">&lt;</span>&nbsp;<span class="ident" id="5677836">nComp</span><span class="op" id="5677841">;</span>&nbsp;<span class="ident" id="5677843">i</span><span class="op" id="5677844">++</span>&nbsp;<span class="op" id="5677847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677851">cs</span>&nbsp;<span class="op" id="5677854">:=</span>&nbsp;<span class="ident" id="5677857">d</span><span class="op" id="5677858">.</span><span class="ident" id="5677859">tmp</span><span class="op" id="5677862">[</span><span class="num" id="5677863">1</span><span class="op" id="5677864">+</span><span class="num" id="5677865">2</span><span class="op" id="5677866">*</span><span class="ident" id="5677867">i</span><span class="op" id="5677868">]</span>&nbsp;<span class="comment" id="5677870">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677895">compIndex</span>&nbsp;<span class="op" id="5677905">:=</span>&nbsp;<span class="op" id="5677908">-</span><span class="num" id="5677909">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677913">for</span>&nbsp;<span class="ident" id="5677917">j</span><span class="op" id="5677918">,</span>&nbsp;<span class="ident" id="5677920">comp</span>&nbsp;<span class="op" id="5677925">:=</span>&nbsp;<span class="keyword" id="5677928">range</span>&nbsp;<span class="ident" id="5677934">d</span><span class="op" id="5677935">.</span><span class="ident" id="5677936">comp</span>&nbsp;<span class="op" id="5677941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677946">if</span>&nbsp;<span class="ident" id="5677949">cs</span>&nbsp;<span class="op" id="5677952">==</span>&nbsp;<span class="ident" id="5677955">comp</span><span class="op" id="5677959">.</span><span class="ident" id="5677960">c</span>&nbsp;<span class="op" id="5677962">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677968">compIndex</span>&nbsp;<span class="op" id="5677978">=</span>&nbsp;<span class="ident" id="5677980">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677993">if</span>&nbsp;<span class="ident" id="5677996">compIndex</span>&nbsp;<span class="op" id="5678006">&lt;</span>&nbsp;<span class="num" id="5678008">0</span>&nbsp;<span class="op" id="5678010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678015">return</span>&nbsp;<span class="ident" id="5678022">FormatError</span><span class="op" id="5678033">(</span><span class="string" id="5678034">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="5678062">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678070">scan</span><span class="op" id="5678074">[</span><span class="ident" id="5678075">i</span><span class="op" id="5678076">]</span><span class="op" id="5678077">.</span><span class="ident" id="5678078">compIndex</span>&nbsp;<span class="op" id="5678088">=</span>&nbsp;<span class="builtintype" id="5678090">uint8</span><span class="op" id="5678095">(</span><span class="ident" id="5678096">compIndex</span><span class="op" id="5678105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678109">scan</span><span class="op" id="5678113">[</span><span class="ident" id="5678114">i</span><span class="op" id="5678115">]</span><span class="op" id="5678116">.</span><span class="ident" id="5678117">td</span>&nbsp;<span class="op" id="5678120">=</span>&nbsp;<span class="ident" id="5678122">d</span><span class="op" id="5678123">.</span><span class="ident" id="5678124">tmp</span><span class="op" id="5678127">[</span><span class="num" id="5678128">2</span><span class="op" id="5678129">+</span><span class="num" id="5678130">2</span><span class="op" id="5678131">*</span><span class="ident" id="5678132">i</span><span class="op" id="5678133">]</span>&nbsp;<span class="op" id="5678135">&gt;&gt;</span>&nbsp;<span class="num" id="5678138">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678142">if</span>&nbsp;<span class="ident" id="5678145">scan</span><span class="op" id="5678149">[</span><span class="ident" id="5678150">i</span><span class="op" id="5678151">]</span><span class="op" id="5678152">.</span><span class="ident" id="5678153">td</span>&nbsp;<span class="op" id="5678156">&gt;</span>&nbsp;<span class="ident" id="5678158">maxTh</span>&nbsp;<span class="op" id="5678164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678169">return</span>&nbsp;<span class="ident" id="5678176">FormatError</span><span class="op" id="5678187">(</span><span class="string" id="5678188">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="5678202">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678210">scan</span><span class="op" id="5678214">[</span><span class="ident" id="5678215">i</span><span class="op" id="5678216">]</span><span class="op" id="5678217">.</span><span class="ident" id="5678218">ta</span>&nbsp;<span class="op" id="5678221">=</span>&nbsp;<span class="ident" id="5678223">d</span><span class="op" id="5678224">.</span><span class="ident" id="5678225">tmp</span><span class="op" id="5678228">[</span><span class="num" id="5678229">2</span><span class="op" id="5678230">+</span><span class="num" id="5678231">2</span><span class="op" id="5678232">*</span><span class="ident" id="5678233">i</span><span class="op" id="5678234">]</span>&nbsp;<span class="op" id="5678236">&amp;</span>&nbsp;<span class="num" id="5678238">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678245">if</span>&nbsp;<span class="ident" id="5678248">scan</span><span class="op" id="5678252">[</span><span class="ident" id="5678253">i</span><span class="op" id="5678254">]</span><span class="op" id="5678255">.</span><span class="ident" id="5678256">ta</span>&nbsp;<span class="op" id="5678259">&gt;</span>&nbsp;<span class="ident" id="5678261">maxTh</span>&nbsp;<span class="op" id="5678267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678272">return</span>&nbsp;<span class="ident" id="5678279">FormatError</span><span class="op" id="5678290">(</span><span class="string" id="5678291">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="5678305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678309">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678316">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678375">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678443">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678494">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678498">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678568">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678639">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678709">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678776">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678844">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678913">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678980">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679050">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679113">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679134">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679138">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679207">zigStart</span><span class="op" id="5679215">,</span>&nbsp;<span class="ident" id="5679217">zigEnd</span><span class="op" id="5679223">,</span>&nbsp;<span class="ident" id="5679225">ah</span><span class="op" id="5679227">,</span>&nbsp;<span class="ident" id="5679229">al</span>&nbsp;<span class="op" id="5679232">:=</span>&nbsp;<span class="builtintype" id="5679235">int32</span><span class="op" id="5679240">(</span><span class="num" id="5679241">0</span><span class="op" id="5679242">)</span><span class="op" id="5679243">,</span>&nbsp;<span class="builtintype" id="5679245">int32</span><span class="op" id="5679250">(</span><span class="ident" id="5679251">blockSize</span><span class="op" id="5679260">-</span><span class="num" id="5679261">1</span><span class="op" id="5679262">)</span><span class="op" id="5679263">,</span>&nbsp;<span class="builtintype" id="5679265">uint32</span><span class="op" id="5679271">(</span><span class="num" id="5679272">0</span><span class="op" id="5679273">)</span><span class="op" id="5679274">,</span>&nbsp;<span class="builtintype" id="5679276">uint32</span><span class="op" id="5679282">(</span><span class="num" id="5679283">0</span><span class="op" id="5679284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679287">if</span>&nbsp;<span class="ident" id="5679290">d</span><span class="op" id="5679291">.</span><span class="ident" id="5679292">progressive</span>&nbsp;<span class="op" id="5679304">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679308">zigStart</span>&nbsp;<span class="op" id="5679317">=</span>&nbsp;<span class="builtintype" id="5679319">int32</span><span class="op" id="5679324">(</span><span class="ident" id="5679325">d</span><span class="op" id="5679326">.</span><span class="ident" id="5679327">tmp</span><span class="op" id="5679330">[</span><span class="num" id="5679331">1</span><span class="op" id="5679332">+</span><span class="num" id="5679333">2</span><span class="op" id="5679334">*</span><span class="ident" id="5679335">nComp</span><span class="op" id="5679340">]</span><span class="op" id="5679341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679345">zigEnd</span>&nbsp;<span class="op" id="5679352">=</span>&nbsp;<span class="builtintype" id="5679354">int32</span><span class="op" id="5679359">(</span><span class="ident" id="5679360">d</span><span class="op" id="5679361">.</span><span class="ident" id="5679362">tmp</span><span class="op" id="5679365">[</span><span class="num" id="5679366">2</span><span class="op" id="5679367">+</span><span class="num" id="5679368">2</span><span class="op" id="5679369">*</span><span class="ident" id="5679370">nComp</span><span class="op" id="5679375">]</span><span class="op" id="5679376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679380">ah</span>&nbsp;<span class="op" id="5679383">=</span>&nbsp;<span class="builtintype" id="5679385">uint32</span><span class="op" id="5679391">(</span><span class="ident" id="5679392">d</span><span class="op" id="5679393">.</span><span class="ident" id="5679394">tmp</span><span class="op" id="5679397">[</span><span class="num" id="5679398">3</span><span class="op" id="5679399">+</span><span class="num" id="5679400">2</span><span class="op" id="5679401">*</span><span class="ident" id="5679402">nComp</span><span class="op" id="5679407">]</span>&nbsp;<span class="op" id="5679409">&gt;&gt;</span>&nbsp;<span class="num" id="5679412">4</span><span class="op" id="5679413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679417">al</span>&nbsp;<span class="op" id="5679420">=</span>&nbsp;<span class="builtintype" id="5679422">uint32</span><span class="op" id="5679428">(</span><span class="ident" id="5679429">d</span><span class="op" id="5679430">.</span><span class="ident" id="5679431">tmp</span><span class="op" id="5679434">[</span><span class="num" id="5679435">3</span><span class="op" id="5679436">+</span><span class="num" id="5679437">2</span><span class="op" id="5679438">*</span><span class="ident" id="5679439">nComp</span><span class="op" id="5679444">]</span>&nbsp;<span class="op" id="5679446">&amp;</span>&nbsp;<span class="num" id="5679448">0x0f</span><span class="op" id="5679452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679456">if</span>&nbsp;<span class="op" id="5679459">(</span><span class="ident" id="5679460">zigStart</span>&nbsp;<span class="op" id="5679469">==</span>&nbsp;<span class="num" id="5679472">0</span>&nbsp;<span class="op" id="5679474">&amp;&amp;</span>&nbsp;<span class="ident" id="5679477">zigEnd</span>&nbsp;<span class="op" id="5679484">!=</span>&nbsp;<span class="num" id="5679487">0</span><span class="op" id="5679488">)</span>&nbsp;<span class="op" id="5679490">||</span>&nbsp;<span class="ident" id="5679493">zigStart</span>&nbsp;<span class="op" id="5679502">&gt;</span>&nbsp;<span class="ident" id="5679504">zigEnd</span>&nbsp;<span class="op" id="5679511">||</span>&nbsp;<span class="ident" id="5679514">blockSize</span>&nbsp;<span class="op" id="5679524">&lt;=</span>&nbsp;<span class="ident" id="5679527">zigEnd</span>&nbsp;<span class="op" id="5679534">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679539">return</span>&nbsp;<span class="ident" id="5679546">FormatError</span><span class="op" id="5679557">(</span><span class="string" id="5679558">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="5679589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679597">if</span>&nbsp;<span class="ident" id="5679600">zigStart</span>&nbsp;<span class="op" id="5679609">!=</span>&nbsp;<span class="num" id="5679612">0</span>&nbsp;<span class="op" id="5679614">&amp;&amp;</span>&nbsp;<span class="ident" id="5679617">nComp</span>&nbsp;<span class="op" id="5679623">!=</span>&nbsp;<span class="num" id="5679626">1</span>&nbsp;<span class="op" id="5679628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679633">return</span>&nbsp;<span class="ident" id="5679640">FormatError</span><span class="op" id="5679651">(</span><span class="string" id="5679652">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="5679709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679713">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679717">if</span>&nbsp;<span class="ident" id="5679720">ah</span>&nbsp;<span class="op" id="5679723">!=</span>&nbsp;<span class="num" id="5679726">0</span>&nbsp;<span class="op" id="5679728">&amp;&amp;</span>&nbsp;<span class="ident" id="5679731">ah</span>&nbsp;<span class="op" id="5679734">!=</span>&nbsp;<span class="ident" id="5679737">al</span><span class="op" id="5679739">+</span><span class="num" id="5679740">1</span>&nbsp;<span class="op" id="5679742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679747">return</span>&nbsp;<span class="ident" id="5679754">FormatError</span><span class="op" id="5679765">(</span><span class="string" id="5679766">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="5679803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679814">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679889">h0</span><span class="op" id="5679891">,</span>&nbsp;<span class="ident" id="5679893">v0</span>&nbsp;<span class="op" id="5679896">:=</span>&nbsp;<span class="ident" id="5679899">d</span><span class="op" id="5679900">.</span><span class="ident" id="5679901">comp</span><span class="op" id="5679905">[</span><span class="num" id="5679906">0</span><span class="op" id="5679907">]</span><span class="op" id="5679908">.</span><span class="ident" id="5679909">h</span><span class="op" id="5679910">,</span>&nbsp;<span class="ident" id="5679912">d</span><span class="op" id="5679913">.</span><span class="ident" id="5679914">comp</span><span class="op" id="5679918">[</span><span class="num" id="5679919">0</span><span class="op" id="5679920">]</span><span class="op" id="5679921">.</span><span class="ident" id="5679922">v</span>&nbsp;<span class="comment" id="5679924">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679970">mxx</span>&nbsp;<span class="op" id="5679974">:=</span>&nbsp;<span class="op" id="5679977">(</span><span class="ident" id="5679978">d</span><span class="op" id="5679979">.</span><span class="ident" id="5679980">width</span>&nbsp;<span class="op" id="5679986">+</span>&nbsp;<span class="num" id="5679988">8</span><span class="op" id="5679989">*</span><span class="ident" id="5679990">h0</span>&nbsp;<span class="op" id="5679993">-</span>&nbsp;<span class="num" id="5679995">1</span><span class="op" id="5679996">)</span>&nbsp;<span class="op" id="5679998">/</span>&nbsp;<span class="op" id="5680000">(</span><span class="num" id="5680001">8</span>&nbsp;<span class="op" id="5680003">*</span>&nbsp;<span class="ident" id="5680005">h0</span><span class="op" id="5680007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680010">myy</span>&nbsp;<span class="op" id="5680014">:=</span>&nbsp;<span class="op" id="5680017">(</span><span class="ident" id="5680018">d</span><span class="op" id="5680019">.</span><span class="ident" id="5680020">height</span>&nbsp;<span class="op" id="5680027">+</span>&nbsp;<span class="num" id="5680029">8</span><span class="op" id="5680030">*</span><span class="ident" id="5680031">v0</span>&nbsp;<span class="op" id="5680034">-</span>&nbsp;<span class="num" id="5680036">1</span><span class="op" id="5680037">)</span>&nbsp;<span class="op" id="5680039">/</span>&nbsp;<span class="op" id="5680041">(</span><span class="num" id="5680042">8</span>&nbsp;<span class="op" id="5680044">*</span>&nbsp;<span class="ident" id="5680046">v0</span><span class="op" id="5680048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680051">if</span>&nbsp;<span class="ident" id="5680054">d</span><span class="op" id="5680055">.</span><span class="ident" id="5680056">img1</span>&nbsp;<span class="op" id="5680061">==</span>&nbsp;<span class="ident" id="5680064">nil</span>&nbsp;<span class="op" id="5680068">&amp;&amp;</span>&nbsp;<span class="ident" id="5680071">d</span><span class="op" id="5680072">.</span><span class="ident" id="5680073">img3</span>&nbsp;<span class="op" id="5680078">==</span>&nbsp;<span class="ident" id="5680081">nil</span>&nbsp;<span class="op" id="5680085">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680089">d</span><span class="op" id="5680090">.</span><span class="ident" id="5680091">makeImg</span><span class="op" id="5680098">(</span><span class="ident" id="5680099">h0</span><span class="op" id="5680101">,</span>&nbsp;<span class="ident" id="5680103">v0</span><span class="op" id="5680105">,</span>&nbsp;<span class="ident" id="5680107">mxx</span><span class="op" id="5680110">,</span>&nbsp;<span class="ident" id="5680112">myy</span><span class="op" id="5680115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680121">if</span>&nbsp;<span class="ident" id="5680124">d</span><span class="op" id="5680125">.</span><span class="ident" id="5680126">progressive</span>&nbsp;<span class="op" id="5680138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680142">for</span>&nbsp;<span class="ident" id="5680146">i</span>&nbsp;<span class="op" id="5680148">:=</span>&nbsp;<span class="num" id="5680151">0</span><span class="op" id="5680152">;</span>&nbsp;<span class="ident" id="5680154">i</span>&nbsp;<span class="op" id="5680156">&lt;</span>&nbsp;<span class="ident" id="5680158">nComp</span><span class="op" id="5680163">;</span>&nbsp;<span class="ident" id="5680165">i</span><span class="op" id="5680166">++</span>&nbsp;<span class="op" id="5680169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680174">compIndex</span>&nbsp;<span class="op" id="5680184">:=</span>&nbsp;<span class="ident" id="5680187">scan</span><span class="op" id="5680191">[</span><span class="ident" id="5680192">i</span><span class="op" id="5680193">]</span><span class="op" id="5680194">.</span><span class="ident" id="5680195">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680208">if</span>&nbsp;<span class="ident" id="5680211">d</span><span class="op" id="5680212">.</span><span class="ident" id="5680213">progCoeffs</span><span class="op" id="5680223">[</span><span class="ident" id="5680224">compIndex</span><span class="op" id="5680233">]</span>&nbsp;<span class="op" id="5680235">==</span>&nbsp;<span class="ident" id="5680238">nil</span>&nbsp;<span class="op" id="5680242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680248">d</span><span class="op" id="5680249">.</span><span class="ident" id="5680250">progCoeffs</span><span class="op" id="5680260">[</span><span class="ident" id="5680261">compIndex</span><span class="op" id="5680270">]</span>&nbsp;<span class="op" id="5680272">=</span>&nbsp;<span class="builtinfunc" id="5680274">make</span><span class="op" id="5680278">(</span><span class="op" id="5680279">[</span><span class="op" id="5680280">]</span><span class="ident" id="5680281">block</span><span class="op" id="5680286">,</span>&nbsp;<span class="ident" id="5680288">mxx</span><span class="op" id="5680291">*</span><span class="ident" id="5680292">myy</span><span class="op" id="5680295">*</span><span class="ident" id="5680296">d</span><span class="op" id="5680297">.</span><span class="ident" id="5680298">comp</span><span class="op" id="5680302">[</span><span class="ident" id="5680303">compIndex</span><span class="op" id="5680312">]</span><span class="op" id="5680313">.</span><span class="ident" id="5680314">h</span><span class="op" id="5680315">*</span><span class="ident" id="5680316">d</span><span class="op" id="5680317">.</span><span class="ident" id="5680318">comp</span><span class="op" id="5680322">[</span><span class="ident" id="5680323">compIndex</span><span class="op" id="5680332">]</span><span class="op" id="5680333">.</span><span class="ident" id="5680334">v</span><span class="op" id="5680335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680347">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680351">d</span><span class="op" id="5680352">.</span><span class="ident" id="5680353">bits</span>&nbsp;<span class="op" id="5680358">=</span>&nbsp;<span class="ident" id="5680360">bits</span><span class="op" id="5680364">{</span><span class="op" id="5680365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680368">mcu</span><span class="op" id="5680371">,</span>&nbsp;<span class="ident" id="5680373">expectedRST</span>&nbsp;<span class="op" id="5680385">:=</span>&nbsp;<span class="num" id="5680388">0</span><span class="op" id="5680389">,</span>&nbsp;<span class="builtintype" id="5680391">uint8</span><span class="op" id="5680396">(</span><span class="ident" id="5680397">rst0Marker</span><span class="op" id="5680407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680410">var</span>&nbsp;<span class="op" id="5680414">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680418">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680486">b</span>&nbsp;&nbsp;<span class="ident" id="5680489">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680497">dc</span>&nbsp;<span class="op" id="5680500">[</span><span class="ident" id="5680501">nColorComponent</span><span class="op" id="5680516">]</span><span class="builtintype" id="5680517">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680525">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680598">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680672">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680745">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680815">bx</span><span class="op" id="5680817">,</span>&nbsp;<span class="ident" id="5680819">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5680826">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680832">blockCount</span>&nbsp;<span class="builtintype" id="5680843">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680851">for</span>&nbsp;<span class="ident" id="5680855">my</span>&nbsp;<span class="op" id="5680858">:=</span>&nbsp;<span class="num" id="5680861">0</span><span class="op" id="5680862">;</span>&nbsp;<span class="ident" id="5680864">my</span>&nbsp;<span class="op" id="5680867">&lt;</span>&nbsp;<span class="ident" id="5680869">myy</span><span class="op" id="5680872">;</span>&nbsp;<span class="ident" id="5680874">my</span><span class="op" id="5680876">++</span>&nbsp;<span class="op" id="5680879">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680883">for</span>&nbsp;<span class="ident" id="5680887">mx</span>&nbsp;<span class="op" id="5680890">:=</span>&nbsp;<span class="num" id="5680893">0</span><span class="op" id="5680894">;</span>&nbsp;<span class="ident" id="5680896">mx</span>&nbsp;<span class="op" id="5680899">&lt;</span>&nbsp;<span class="ident" id="5680901">mxx</span><span class="op" id="5680904">;</span>&nbsp;<span class="ident" id="5680906">mx</span><span class="op" id="5680908">++</span>&nbsp;<span class="op" id="5680911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680916">for</span>&nbsp;<span class="ident" id="5680920">i</span>&nbsp;<span class="op" id="5680922">:=</span>&nbsp;<span class="num" id="5680925">0</span><span class="op" id="5680926">;</span>&nbsp;<span class="ident" id="5680928">i</span>&nbsp;<span class="op" id="5680930">&lt;</span>&nbsp;<span class="ident" id="5680932">nComp</span><span class="op" id="5680937">;</span>&nbsp;<span class="ident" id="5680939">i</span><span class="op" id="5680940">++</span>&nbsp;<span class="op" id="5680943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680949">compIndex</span>&nbsp;<span class="op" id="5680959">:=</span>&nbsp;<span class="ident" id="5680962">scan</span><span class="op" id="5680966">[</span><span class="ident" id="5680967">i</span><span class="op" id="5680968">]</span><span class="op" id="5680969">.</span><span class="ident" id="5680970">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680984">qt</span>&nbsp;<span class="op" id="5680987">:=</span>&nbsp;<span class="op" id="5680990">&amp;</span><span class="ident" id="5680991">d</span><span class="op" id="5680992">.</span><span class="ident" id="5680993">quant</span><span class="op" id="5680998">[</span><span class="ident" id="5680999">d</span><span class="op" id="5681000">.</span><span class="ident" id="5681001">comp</span><span class="op" id="5681005">[</span><span class="ident" id="5681006">compIndex</span><span class="op" id="5681015">]</span><span class="op" id="5681016">.</span><span class="ident" id="5681017">tq</span><span class="op" id="5681019">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681025">for</span>&nbsp;<span class="ident" id="5681029">j</span>&nbsp;<span class="op" id="5681031">:=</span>&nbsp;<span class="num" id="5681034">0</span><span class="op" id="5681035">;</span>&nbsp;<span class="ident" id="5681037">j</span>&nbsp;<span class="op" id="5681039">&lt;</span>&nbsp;<span class="ident" id="5681041">d</span><span class="op" id="5681042">.</span><span class="ident" id="5681043">comp</span><span class="op" id="5681047">[</span><span class="ident" id="5681048">compIndex</span><span class="op" id="5681057">]</span><span class="op" id="5681058">.</span><span class="ident" id="5681059">h</span><span class="op" id="5681060">*</span><span class="ident" id="5681061">d</span><span class="op" id="5681062">.</span><span class="ident" id="5681063">comp</span><span class="op" id="5681067">[</span><span class="ident" id="5681068">compIndex</span><span class="op" id="5681077">]</span><span class="op" id="5681078">.</span><span class="ident" id="5681079">v</span><span class="op" id="5681080">;</span>&nbsp;<span class="ident" id="5681082">j</span><span class="op" id="5681083">++</span>&nbsp;<span class="op" id="5681086">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681093">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681162">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681231">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681239">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681313">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681329">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681345">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681353">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681430">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681507">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681540">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681556">//&nbsp;&nbsp;&nbsp;&nbsp4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681572">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681649">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681677">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681685">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681763">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681838">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681917">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681993">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682026">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682042">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682058">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682122">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682136">//&nbsp;&nbsp;&nbsp;&nbsp3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682150">if</span>&nbsp;<span class="ident" id="5682153">nComp</span>&nbsp;<span class="op" id="5682159">!=</span>&nbsp;<span class="num" id="5682162">1</span>&nbsp;<span class="op" id="5682164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682172">bx</span><span class="op" id="5682174">,</span>&nbsp;<span class="ident" id="5682176">by</span>&nbsp;<span class="op" id="5682179">=</span>&nbsp;<span class="ident" id="5682181">d</span><span class="op" id="5682182">.</span><span class="ident" id="5682183">comp</span><span class="op" id="5682187">[</span><span class="ident" id="5682188">compIndex</span><span class="op" id="5682197">]</span><span class="op" id="5682198">.</span><span class="ident" id="5682199">h</span><span class="op" id="5682200">*</span><span class="ident" id="5682201">mx</span><span class="op" id="5682203">,</span>&nbsp;<span class="ident" id="5682205">d</span><span class="op" id="5682206">.</span><span class="ident" id="5682207">comp</span><span class="op" id="5682211">[</span><span class="ident" id="5682212">compIndex</span><span class="op" id="5682221">]</span><span class="op" id="5682222">.</span><span class="ident" id="5682223">v</span><span class="op" id="5682224">*</span><span class="ident" id="5682225">my</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682234">if</span>&nbsp;<span class="ident" id="5682237">h0</span>&nbsp;<span class="op" id="5682240">==</span>&nbsp;<span class="num" id="5682243">1</span>&nbsp;<span class="op" id="5682245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682254">by</span>&nbsp;<span class="op" id="5682257">+=</span>&nbsp;<span class="ident" id="5682260">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682268">}</span>&nbsp;<span class="keyword" id="5682270">else</span>&nbsp;<span class="op" id="5682275">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682284">bx</span>&nbsp;<span class="op" id="5682287">+=</span>&nbsp;<span class="ident" id="5682290">j</span>&nbsp;<span class="op" id="5682292">%</span>&nbsp;<span class="num" id="5682294">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682303">by</span>&nbsp;<span class="op" id="5682306">+=</span>&nbsp;<span class="ident" id="5682309">j</span>&nbsp;<span class="op" id="5682311">/</span>&nbsp;<span class="num" id="5682313">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682328">}</span>&nbsp;<span class="keyword" id="5682330">else</span>&nbsp;<span class="op" id="5682335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682343">q</span>&nbsp;<span class="op" id="5682345">:=</span>&nbsp;<span class="ident" id="5682348">mxx</span>&nbsp;<span class="op" id="5682352">*</span>&nbsp;<span class="ident" id="5682354">d</span><span class="op" id="5682355">.</span><span class="ident" id="5682356">comp</span><span class="op" id="5682360">[</span><span class="ident" id="5682361">compIndex</span><span class="op" id="5682370">]</span><span class="op" id="5682371">.</span><span class="ident" id="5682372">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682380">bx</span>&nbsp;<span class="op" id="5682383">=</span>&nbsp;<span class="ident" id="5682385">blockCount</span>&nbsp;<span class="op" id="5682396">%</span>&nbsp;<span class="ident" id="5682398">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682406">by</span>&nbsp;<span class="op" id="5682409">=</span>&nbsp;<span class="ident" id="5682411">blockCount</span>&nbsp;<span class="op" id="5682422">/</span>&nbsp;<span class="ident" id="5682424">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682432">blockCount</span><span class="op" id="5682442">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682451">if</span>&nbsp;<span class="ident" id="5682454">bx</span><span class="op" id="5682456">*</span><span class="num" id="5682457">8</span>&nbsp;<span class="op" id="5682459">&gt;=</span>&nbsp;<span class="ident" id="5682462">d</span><span class="op" id="5682463">.</span><span class="ident" id="5682464">width</span>&nbsp;<span class="op" id="5682470">||</span>&nbsp;<span class="ident" id="5682473">by</span><span class="op" id="5682475">*</span><span class="num" id="5682476">8</span>&nbsp;<span class="op" id="5682478">&gt;=</span>&nbsp;<span class="ident" id="5682481">d</span><span class="op" id="5682482">.</span><span class="ident" id="5682483">height</span>&nbsp;<span class="op" id="5682490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682499">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682529">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682602">if</span>&nbsp;<span class="ident" id="5682605">d</span><span class="op" id="5682606">.</span><span class="ident" id="5682607">progressive</span>&nbsp;<span class="op" id="5682619">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682627">b</span>&nbsp;<span class="op" id="5682629">=</span>&nbsp;<span class="ident" id="5682631">d</span><span class="op" id="5682632">.</span><span class="ident" id="5682633">progCoeffs</span><span class="op" id="5682643">[</span><span class="ident" id="5682644">compIndex</span><span class="op" id="5682653">]</span><span class="op" id="5682654">[</span><span class="ident" id="5682655">by</span><span class="op" id="5682657">*</span><span class="ident" id="5682658">mxx</span><span class="op" id="5682661">*</span><span class="ident" id="5682662">d</span><span class="op" id="5682663">.</span><span class="ident" id="5682664">comp</span><span class="op" id="5682668">[</span><span class="ident" id="5682669">compIndex</span><span class="op" id="5682678">]</span><span class="op" id="5682679">.</span><span class="ident" id="5682680">h</span><span class="op" id="5682681">+</span><span class="ident" id="5682682">bx</span><span class="op" id="5682684">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682691">}</span>&nbsp;<span class="keyword" id="5682693">else</span>&nbsp;<span class="op" id="5682698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682706">b</span>&nbsp;<span class="op" id="5682708">=</span>&nbsp;<span class="ident" id="5682710">block</span><span class="op" id="5682715">{</span><span class="op" id="5682716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682731">if</span>&nbsp;<span class="ident" id="5682734">ah</span>&nbsp;<span class="op" id="5682737">!=</span>&nbsp;<span class="num" id="5682740">0</span>&nbsp;<span class="op" id="5682742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682750">if</span>&nbsp;<span class="ident" id="5682753">err</span>&nbsp;<span class="op" id="5682757">:=</span>&nbsp;<span class="ident" id="5682760">d</span><span class="op" id="5682761">.</span><span class="ident" id="5682762">refine</span><span class="op" id="5682768">(</span><span class="op" id="5682769">&amp;</span><span class="ident" id="5682770">b</span><span class="op" id="5682771">,</span>&nbsp;<span class="op" id="5682773">&amp;</span><span class="ident" id="5682774">d</span><span class="op" id="5682775">.</span><span class="ident" id="5682776">huff</span><span class="op" id="5682780">[</span><span class="ident" id="5682781">acTable</span><span class="op" id="5682788">]</span><span class="op" id="5682789">[</span><span class="ident" id="5682790">scan</span><span class="op" id="5682794">[</span><span class="ident" id="5682795">i</span><span class="op" id="5682796">]</span><span class="op" id="5682797">.</span><span class="ident" id="5682798">ta</span><span class="op" id="5682800">]</span><span class="op" id="5682801">,</span>&nbsp;<span class="ident" id="5682803">zigStart</span><span class="op" id="5682811">,</span>&nbsp;<span class="ident" id="5682813">zigEnd</span><span class="op" id="5682819">,</span>&nbsp;<span class="num" id="5682821">1</span><span class="op" id="5682822">&lt;&lt;</span><span class="ident" id="5682824">al</span><span class="op" id="5682826">)</span><span class="op" id="5682827">;</span>&nbsp;<span class="ident" id="5682829">err</span>&nbsp;<span class="op" id="5682833">!=</span>&nbsp;<span class="ident" id="5682836">nil</span>&nbsp;<span class="op" id="5682840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682849">return</span>&nbsp;<span class="ident" id="5682856">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682873">}</span>&nbsp;<span class="keyword" id="5682875">else</span>&nbsp;<span class="op" id="5682880">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682888">zig</span>&nbsp;<span class="op" id="5682892">:=</span>&nbsp;<span class="ident" id="5682895">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682910">if</span>&nbsp;<span class="ident" id="5682913">zig</span>&nbsp;<span class="op" id="5682917">==</span>&nbsp;<span class="num" id="5682920">0</span>&nbsp;<span class="op" id="5682922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682931">zig</span><span class="op" id="5682934">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682944">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683014">value</span><span class="op" id="5683019">,</span>&nbsp;<span class="ident" id="5683021">err</span>&nbsp;<span class="op" id="5683025">:=</span>&nbsp;<span class="ident" id="5683028">d</span><span class="op" id="5683029">.</span><span class="ident" id="5683030">decodeHuffman</span><span class="op" id="5683043">(</span><span class="op" id="5683044">&amp;</span><span class="ident" id="5683045">d</span><span class="op" id="5683046">.</span><span class="ident" id="5683047">huff</span><span class="op" id="5683051">[</span><span class="ident" id="5683052">dcTable</span><span class="op" id="5683059">]</span><span class="op" id="5683060">[</span><span class="ident" id="5683061">scan</span><span class="op" id="5683065">[</span><span class="ident" id="5683066">i</span><span class="op" id="5683067">]</span><span class="op" id="5683068">.</span><span class="ident" id="5683069">td</span><span class="op" id="5683071">]</span><span class="op" id="5683072">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683081">if</span>&nbsp;<span class="ident" id="5683084">err</span>&nbsp;<span class="op" id="5683088">!=</span>&nbsp;<span class="ident" id="5683091">nil</span>&nbsp;<span class="op" id="5683095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683105">return</span>&nbsp;<span class="ident" id="5683112">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683132">if</span>&nbsp;<span class="ident" id="5683135">value</span>&nbsp;<span class="op" id="5683141">&gt;</span>&nbsp;<span class="num" id="5683143">16</span>&nbsp;<span class="op" id="5683146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683156">return</span>&nbsp;<span class="ident" id="5683163">UnsupportedError</span><span class="op" id="5683179">(</span><span class="string" id="5683180">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="5683204">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683222">dcDelta</span><span class="op" id="5683229">,</span>&nbsp;<span class="ident" id="5683231">err</span>&nbsp;<span class="op" id="5683235">:=</span>&nbsp;<span class="ident" id="5683238">d</span><span class="op" id="5683239">.</span><span class="ident" id="5683240">receiveExtend</span><span class="op" id="5683253">(</span><span class="ident" id="5683254">value</span><span class="op" id="5683259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683268">if</span>&nbsp;<span class="ident" id="5683271">err</span>&nbsp;<span class="op" id="5683275">!=</span>&nbsp;<span class="ident" id="5683278">nil</span>&nbsp;<span class="op" id="5683282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683292">return</span>&nbsp;<span class="ident" id="5683299">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683310">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683319">dc</span><span class="op" id="5683321">[</span><span class="ident" id="5683322">compIndex</span><span class="op" id="5683331">]</span>&nbsp;<span class="op" id="5683333">+=</span>&nbsp;<span class="ident" id="5683336">dcDelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683351">b</span><span class="op" id="5683352">[</span><span class="num" id="5683353">0</span><span class="op" id="5683354">]</span>&nbsp;<span class="op" id="5683356">=</span>&nbsp;<span class="ident" id="5683358">dc</span><span class="op" id="5683360">[</span><span class="ident" id="5683361">compIndex</span><span class="op" id="5683370">]</span>&nbsp;<span class="op" id="5683372">&lt;&lt;</span>&nbsp;<span class="ident" id="5683375">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683393">if</span>&nbsp;<span class="ident" id="5683396">zig</span>&nbsp;<span class="op" id="5683400">&lt;=</span>&nbsp;<span class="ident" id="5683403">zigEnd</span>&nbsp;<span class="op" id="5683410">&amp;&amp;</span>&nbsp;<span class="ident" id="5683413">d</span><span class="op" id="5683414">.</span><span class="ident" id="5683415">eobRun</span>&nbsp;<span class="op" id="5683422">&gt;</span>&nbsp;<span class="num" id="5683424">0</span>&nbsp;<span class="op" id="5683426">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683435">d</span><span class="op" id="5683436">.</span><span class="ident" id="5683437">eobRun</span><span class="op" id="5683443">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683452">}</span>&nbsp;<span class="keyword" id="5683454">else</span>&nbsp;<span class="op" id="5683459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683468">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683539">huff</span>&nbsp;<span class="op" id="5683544">:=</span>&nbsp;<span class="op" id="5683547">&amp;</span><span class="ident" id="5683548">d</span><span class="op" id="5683549">.</span><span class="ident" id="5683550">huff</span><span class="op" id="5683554">[</span><span class="ident" id="5683555">acTable</span><span class="op" id="5683562">]</span><span class="op" id="5683563">[</span><span class="ident" id="5683564">scan</span><span class="op" id="5683568">[</span><span class="ident" id="5683569">i</span><span class="op" id="5683570">]</span><span class="op" id="5683571">.</span><span class="ident" id="5683572">ta</span><span class="op" id="5683574">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683583">for</span>&nbsp;<span class="op" id="5683587">;</span>&nbsp;<span class="ident" id="5683589">zig</span>&nbsp;<span class="op" id="5683593">&lt;=</span>&nbsp;<span class="ident" id="5683596">zigEnd</span><span class="op" id="5683602">;</span>&nbsp;<span class="ident" id="5683604">zig</span><span class="op" id="5683607">++</span>&nbsp;<span class="op" id="5683610">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683620">value</span><span class="op" id="5683625">,</span>&nbsp;<span class="ident" id="5683627">err</span>&nbsp;<span class="op" id="5683631">:=</span>&nbsp;<span class="ident" id="5683634">d</span><span class="op" id="5683635">.</span><span class="ident" id="5683636">decodeHuffman</span><span class="op" id="5683649">(</span><span class="ident" id="5683650">huff</span><span class="op" id="5683654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683664">if</span>&nbsp;<span class="ident" id="5683667">err</span>&nbsp;<span class="op" id="5683671">!=</span>&nbsp;<span class="ident" id="5683674">nil</span>&nbsp;<span class="op" id="5683678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683689">return</span>&nbsp;<span class="ident" id="5683696">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683718">val0</span>&nbsp;<span class="op" id="5683723">:=</span>&nbsp;<span class="ident" id="5683726">value</span>&nbsp;<span class="op" id="5683732">&gt;&gt;</span>&nbsp;<span class="num" id="5683735">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683745">val1</span>&nbsp;<span class="op" id="5683750">:=</span>&nbsp;<span class="ident" id="5683753">value</span>&nbsp;<span class="op" id="5683759">&amp;</span>&nbsp;<span class="num" id="5683761">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683774">if</span>&nbsp;<span class="ident" id="5683777">val1</span>&nbsp;<span class="op" id="5683782">!=</span>&nbsp;<span class="num" id="5683785">0</span>&nbsp;<span class="op" id="5683787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683798">zig</span>&nbsp;<span class="op" id="5683802">+=</span>&nbsp;<span class="builtintype" id="5683805">int32</span><span class="op" id="5683810">(</span><span class="ident" id="5683811">val0</span><span class="op" id="5683815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683826">if</span>&nbsp;<span class="ident" id="5683829">zig</span>&nbsp;<span class="op" id="5683833">&gt;</span>&nbsp;<span class="ident" id="5683835">zigEnd</span>&nbsp;<span class="op" id="5683842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683854">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683880">ac</span><span class="op" id="5683882">,</span>&nbsp;<span class="ident" id="5683884">err</span>&nbsp;<span class="op" id="5683888">:=</span>&nbsp;<span class="ident" id="5683891">d</span><span class="op" id="5683892">.</span><span class="ident" id="5683893">receiveExtend</span><span class="op" id="5683906">(</span><span class="ident" id="5683907">val1</span><span class="op" id="5683911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683922">if</span>&nbsp;<span class="ident" id="5683925">err</span>&nbsp;<span class="op" id="5683929">!=</span>&nbsp;<span class="ident" id="5683932">nil</span>&nbsp;<span class="op" id="5683936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683948">return</span>&nbsp;<span class="ident" id="5683955">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683968">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683979">b</span><span class="op" id="5683980">[</span><span class="ident" id="5683981">unzig</span><span class="op" id="5683986">[</span><span class="ident" id="5683987">zig</span><span class="op" id="5683990">]</span><span class="op" id="5683991">]</span>&nbsp;<span class="op" id="5683993">=</span>&nbsp;<span class="ident" id="5683995">ac</span>&nbsp;<span class="op" id="5683998">&lt;&lt;</span>&nbsp;<span class="ident" id="5684001">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684012">}</span>&nbsp;<span class="keyword" id="5684014">else</span>&nbsp;<span class="op" id="5684019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684030">if</span>&nbsp;<span class="ident" id="5684033">val0</span>&nbsp;<span class="op" id="5684038">!=</span>&nbsp;<span class="num" id="5684041">0x0f</span>&nbsp;<span class="op" id="5684046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684058">d</span><span class="op" id="5684059">.</span><span class="ident" id="5684060">eobRun</span>&nbsp;<span class="op" id="5684067">=</span>&nbsp;<span class="builtintype" id="5684069">uint16</span><span class="op" id="5684075">(</span><span class="num" id="5684076">1</span>&nbsp;<span class="op" id="5684078">&lt;&lt;</span>&nbsp;<span class="ident" id="5684081">val0</span><span class="op" id="5684085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684097">if</span>&nbsp;<span class="ident" id="5684100">val0</span>&nbsp;<span class="op" id="5684105">!=</span>&nbsp;<span class="num" id="5684108">0</span>&nbsp;<span class="op" id="5684110">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684123">bits</span><span class="op" id="5684127">,</span>&nbsp;<span class="ident" id="5684129">err</span>&nbsp;<span class="op" id="5684133">:=</span>&nbsp;<span class="ident" id="5684136">d</span><span class="op" id="5684137">.</span><span class="ident" id="5684138">decodeBits</span><span class="op" id="5684148">(</span><span class="builtintype" id="5684149">int32</span><span class="op" id="5684154">(</span><span class="ident" id="5684155">val0</span><span class="op" id="5684159">)</span><span class="op" id="5684160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684173">if</span>&nbsp;<span class="ident" id="5684176">err</span>&nbsp;<span class="op" id="5684180">!=</span>&nbsp;<span class="ident" id="5684183">nil</span>&nbsp;<span class="op" id="5684187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684201">return</span>&nbsp;<span class="ident" id="5684208">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684236">d</span><span class="op" id="5684237">.</span><span class="ident" id="5684238">eobRun</span>&nbsp;<span class="op" id="5684245">|=</span>&nbsp;<span class="builtintype" id="5684248">uint16</span><span class="op" id="5684254">(</span><span class="ident" id="5684255">bits</span><span class="op" id="5684259">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684283">d</span><span class="op" id="5684284">.</span><span class="ident" id="5684285">eobRun</span><span class="op" id="5684291">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684304">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684330">zig</span>&nbsp;<span class="op" id="5684334">+=</span>&nbsp;<span class="num" id="5684337">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684382">if</span>&nbsp;<span class="ident" id="5684385">d</span><span class="op" id="5684386">.</span><span class="ident" id="5684387">progressive</span>&nbsp;<span class="op" id="5684399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684407">if</span>&nbsp;<span class="ident" id="5684410">zigEnd</span>&nbsp;<span class="op" id="5684417">!=</span>&nbsp;<span class="ident" id="5684420">blockSize</span><span class="op" id="5684429">-</span><span class="num" id="5684430">1</span>&nbsp;<span class="op" id="5684432">||</span>&nbsp;<span class="ident" id="5684435">al</span>&nbsp;<span class="op" id="5684438">!=</span>&nbsp;<span class="num" id="5684441">0</span>&nbsp;<span class="op" id="5684443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684452">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684531">d</span><span class="op" id="5684532">.</span><span class="ident" id="5684533">progCoeffs</span><span class="op" id="5684543">[</span><span class="ident" id="5684544">compIndex</span><span class="op" id="5684553">]</span><span class="op" id="5684554">[</span><span class="ident" id="5684555">by</span><span class="op" id="5684557">*</span><span class="ident" id="5684558">mxx</span><span class="op" id="5684561">*</span><span class="ident" id="5684562">d</span><span class="op" id="5684563">.</span><span class="ident" id="5684564">comp</span><span class="op" id="5684568">[</span><span class="ident" id="5684569">compIndex</span><span class="op" id="5684578">]</span><span class="op" id="5684579">.</span><span class="ident" id="5684580">h</span><span class="op" id="5684581">+</span><span class="ident" id="5684582">bx</span><span class="op" id="5684584">]</span>&nbsp;<span class="op" id="5684586">=</span>&nbsp;<span class="ident" id="5684588">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684597">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684683">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684769">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684854">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684940">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685001">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685031">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685109">for</span>&nbsp;<span class="ident" id="5685113">zig</span>&nbsp;<span class="op" id="5685117">:=</span>&nbsp;<span class="num" id="5685120">0</span><span class="op" id="5685121">;</span>&nbsp;<span class="ident" id="5685123">zig</span>&nbsp;<span class="op" id="5685127">&lt;</span>&nbsp;<span class="ident" id="5685129">blockSize</span><span class="op" id="5685138">;</span>&nbsp;<span class="ident" id="5685140">zig</span><span class="op" id="5685143">++</span>&nbsp;<span class="op" id="5685146">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685154">b</span><span class="op" id="5685155">[</span><span class="ident" id="5685156">unzig</span><span class="op" id="5685161">[</span><span class="ident" id="5685162">zig</span><span class="op" id="5685165">]</span><span class="op" id="5685166">]</span>&nbsp;<span class="op" id="5685168">*=</span>&nbsp;<span class="ident" id="5685171">qt</span><span class="op" id="5685173">[</span><span class="ident" id="5685174">zig</span><span class="op" id="5685177">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685191">idct</span><span class="op" id="5685195">(</span><span class="op" id="5685196">&amp;</span><span class="ident" id="5685197">b</span><span class="op" id="5685198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685205">dst</span><span class="op" id="5685208">,</span>&nbsp;<span class="ident" id="5685210">stride</span>&nbsp;<span class="op" id="5685217">:=</span>&nbsp;<span class="op" id="5685220">[</span><span class="op" id="5685221">]</span><span class="builtintype" id="5685222">byte</span><span class="op" id="5685226">(</span><span class="ident" id="5685227">nil</span><span class="op" id="5685230">)</span><span class="op" id="5685231">,</span>&nbsp;<span class="num" id="5685233">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685240">if</span>&nbsp;<span class="ident" id="5685243">d</span><span class="op" id="5685244">.</span><span class="ident" id="5685245">nComp</span>&nbsp;<span class="op" id="5685251">==</span>&nbsp;<span class="ident" id="5685254">nGrayComponent</span>&nbsp;<span class="op" id="5685269">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685277">dst</span><span class="op" id="5685280">,</span>&nbsp;<span class="ident" id="5685282">stride</span>&nbsp;<span class="op" id="5685289">=</span>&nbsp;<span class="ident" id="5685291">d</span><span class="op" id="5685292">.</span><span class="ident" id="5685293">img1</span><span class="op" id="5685297">.</span><span class="ident" id="5685298">Pix</span><span class="op" id="5685301">[</span><span class="num" id="5685302">8</span><span class="op" id="5685303">*</span><span class="op" id="5685304">(</span><span class="ident" id="5685305">by</span><span class="op" id="5685307">*</span><span class="ident" id="5685308">d</span><span class="op" id="5685309">.</span><span class="ident" id="5685310">img1</span><span class="op" id="5685314">.</span><span class="ident" id="5685315">Stride</span><span class="op" id="5685321">+</span><span class="ident" id="5685322">bx</span><span class="op" id="5685324">)</span><span class="op" id="5685325">:</span><span class="op" id="5685326">]</span><span class="op" id="5685327">,</span>&nbsp;<span class="ident" id="5685329">d</span><span class="op" id="5685330">.</span><span class="ident" id="5685331">img1</span><span class="op" id="5685335">.</span><span class="ident" id="5685336">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685348">}</span>&nbsp;<span class="keyword" id="5685350">else</span>&nbsp;<span class="op" id="5685355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685363">switch</span>&nbsp;<span class="ident" id="5685370">compIndex</span>&nbsp;<span class="op" id="5685380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685388">case</span>&nbsp;<span class="num" id="5685393">0</span><span class="op" id="5685394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685403">dst</span><span class="op" id="5685406">,</span>&nbsp;<span class="ident" id="5685408">stride</span>&nbsp;<span class="op" id="5685415">=</span>&nbsp;<span class="ident" id="5685417">d</span><span class="op" id="5685418">.</span><span class="ident" id="5685419">img3</span><span class="op" id="5685423">.</span><span class="ident" id="5685424">Y</span><span class="op" id="5685425">[</span><span class="num" id="5685426">8</span><span class="op" id="5685427">*</span><span class="op" id="5685428">(</span><span class="ident" id="5685429">by</span><span class="op" id="5685431">*</span><span class="ident" id="5685432">d</span><span class="op" id="5685433">.</span><span class="ident" id="5685434">img3</span><span class="op" id="5685438">.</span><span class="ident" id="5685439">YStride</span><span class="op" id="5685446">+</span><span class="ident" id="5685447">bx</span><span class="op" id="5685449">)</span><span class="op" id="5685450">:</span><span class="op" id="5685451">]</span><span class="op" id="5685452">,</span>&nbsp;<span class="ident" id="5685454">d</span><span class="op" id="5685455">.</span><span class="ident" id="5685456">img3</span><span class="op" id="5685460">.</span><span class="ident" id="5685461">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685475">case</span>&nbsp;<span class="num" id="5685480">1</span><span class="op" id="5685481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685490">dst</span><span class="op" id="5685493">,</span>&nbsp;<span class="ident" id="5685495">stride</span>&nbsp;<span class="op" id="5685502">=</span>&nbsp;<span class="ident" id="5685504">d</span><span class="op" id="5685505">.</span><span class="ident" id="5685506">img3</span><span class="op" id="5685510">.</span><span class="ident" id="5685511">Cb</span><span class="op" id="5685513">[</span><span class="num" id="5685514">8</span><span class="op" id="5685515">*</span><span class="op" id="5685516">(</span><span class="ident" id="5685517">by</span><span class="op" id="5685519">*</span><span class="ident" id="5685520">d</span><span class="op" id="5685521">.</span><span class="ident" id="5685522">img3</span><span class="op" id="5685526">.</span><span class="ident" id="5685527">CStride</span><span class="op" id="5685534">+</span><span class="ident" id="5685535">bx</span><span class="op" id="5685537">)</span><span class="op" id="5685538">:</span><span class="op" id="5685539">]</span><span class="op" id="5685540">,</span>&nbsp;<span class="ident" id="5685542">d</span><span class="op" id="5685543">.</span><span class="ident" id="5685544">img3</span><span class="op" id="5685548">.</span><span class="ident" id="5685549">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685563">case</span>&nbsp;<span class="num" id="5685568">2</span><span class="op" id="5685569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685578">dst</span><span class="op" id="5685581">,</span>&nbsp;<span class="ident" id="5685583">stride</span>&nbsp;<span class="op" id="5685590">=</span>&nbsp;<span class="ident" id="5685592">d</span><span class="op" id="5685593">.</span><span class="ident" id="5685594">img3</span><span class="op" id="5685598">.</span><span class="ident" id="5685599">Cr</span><span class="op" id="5685601">[</span><span class="num" id="5685602">8</span><span class="op" id="5685603">*</span><span class="op" id="5685604">(</span><span class="ident" id="5685605">by</span><span class="op" id="5685607">*</span><span class="ident" id="5685608">d</span><span class="op" id="5685609">.</span><span class="ident" id="5685610">img3</span><span class="op" id="5685614">.</span><span class="ident" id="5685615">CStride</span><span class="op" id="5685622">+</span><span class="ident" id="5685623">bx</span><span class="op" id="5685625">)</span><span class="op" id="5685626">:</span><span class="op" id="5685627">]</span><span class="op" id="5685628">,</span>&nbsp;<span class="ident" id="5685630">d</span><span class="op" id="5685631">.</span><span class="ident" id="5685632">img3</span><span class="op" id="5685636">.</span><span class="ident" id="5685637">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685651">default</span><span class="op" id="5685658">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685667">return</span>&nbsp;<span class="ident" id="5685674">UnsupportedError</span><span class="op" id="5685690">(</span><span class="string" id="5685691">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="5685712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685734">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685799">for</span>&nbsp;<span class="ident" id="5685803">y</span>&nbsp;<span class="op" id="5685805">:=</span>&nbsp;<span class="num" id="5685808">0</span><span class="op" id="5685809">;</span>&nbsp;<span class="ident" id="5685811">y</span>&nbsp;<span class="op" id="5685813">&lt;</span>&nbsp;<span class="num" id="5685815">8</span><span class="op" id="5685816">;</span>&nbsp;<span class="ident" id="5685818">y</span><span class="op" id="5685819">++</span>&nbsp;<span class="op" id="5685822">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685830">y8</span>&nbsp;<span class="op" id="5685833">:=</span>&nbsp;<span class="ident" id="5685836">y</span>&nbsp;<span class="op" id="5685838">*</span>&nbsp;<span class="num" id="5685840">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685848">yStride</span>&nbsp;<span class="op" id="5685856">:=</span>&nbsp;<span class="ident" id="5685859">y</span>&nbsp;<span class="op" id="5685861">*</span>&nbsp;<span class="ident" id="5685863">stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685876">for</span>&nbsp;<span class="ident" id="5685880">x</span>&nbsp;<span class="op" id="5685882">:=</span>&nbsp;<span class="num" id="5685885">0</span><span class="op" id="5685886">;</span>&nbsp;<span class="ident" id="5685888">x</span>&nbsp;<span class="op" id="5685890">&lt;</span>&nbsp;<span class="num" id="5685892">8</span><span class="op" id="5685893">;</span>&nbsp;<span class="ident" id="5685895">x</span><span class="op" id="5685896">++</span>&nbsp;<span class="op" id="5685899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685908">c</span>&nbsp;<span class="op" id="5685910">:=</span>&nbsp;<span class="ident" id="5685913">b</span><span class="op" id="5685914">[</span><span class="ident" id="5685915">y8</span><span class="op" id="5685917">+</span><span class="ident" id="5685918">x</span><span class="op" id="5685919">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685928">if</span>&nbsp;<span class="ident" id="5685931">c</span>&nbsp;<span class="op" id="5685933">&lt;</span>&nbsp;<span class="op" id="5685935">-</span><span class="num" id="5685936">128</span>&nbsp;<span class="op" id="5685940">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685950">c</span>&nbsp;<span class="op" id="5685952">=</span>&nbsp;<span class="num" id="5685954">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685963">}</span>&nbsp;<span class="keyword" id="5685965">else</span>&nbsp;<span class="keyword" id="5685970">if</span>&nbsp;<span class="ident" id="5685973">c</span>&nbsp;<span class="op" id="5685975">&gt;</span>&nbsp;<span class="num" id="5685977">127</span>&nbsp;<span class="op" id="5685981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685991">c</span>&nbsp;<span class="op" id="5685993">=</span>&nbsp;<span class="num" id="5685995">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686006">}</span>&nbsp;<span class="keyword" id="5686008">else</span>&nbsp;<span class="op" id="5686013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686023">c</span>&nbsp;<span class="op" id="5686025">+=</span>&nbsp;<span class="num" id="5686028">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686048">dst</span><span class="op" id="5686051">[</span><span class="ident" id="5686052">yStride</span><span class="op" id="5686059">+</span><span class="ident" id="5686060">x</span><span class="op" id="5686061">]</span>&nbsp;<span class="op" id="5686063">=</span>&nbsp;<span class="builtintype" id="5686065">uint8</span><span class="op" id="5686070">(</span><span class="ident" id="5686071">c</span><span class="op" id="5686072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686093">}</span>&nbsp;<span class="comment" id="5686095">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686107">}</span>&nbsp;<span class="comment" id="5686109">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686121">mcu</span><span class="op" id="5686124">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686130">if</span>&nbsp;<span class="ident" id="5686133">d</span><span class="op" id="5686134">.</span><span class="ident" id="5686135">ri</span>&nbsp;<span class="op" id="5686138">&gt;</span>&nbsp;<span class="num" id="5686140">0</span>&nbsp;<span class="op" id="5686142">&amp;&amp;</span>&nbsp;<span class="ident" id="5686145">mcu</span><span class="op" id="5686148">%</span><span class="ident" id="5686149">d</span><span class="op" id="5686150">.</span><span class="ident" id="5686151">ri</span>&nbsp;<span class="op" id="5686154">==</span>&nbsp;<span class="num" id="5686157">0</span>&nbsp;<span class="op" id="5686159">&amp;&amp;</span>&nbsp;<span class="ident" id="5686162">mcu</span>&nbsp;<span class="op" id="5686166">&lt;</span>&nbsp;<span class="ident" id="5686168">mxx</span><span class="op" id="5686171">*</span><span class="ident" id="5686172">myy</span>&nbsp;<span class="op" id="5686176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5686182">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5686282">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686379">if</span>&nbsp;<span class="ident" id="5686382">err</span>&nbsp;<span class="op" id="5686386">:=</span>&nbsp;<span class="ident" id="5686389">d</span><span class="op" id="5686390">.</span><span class="ident" id="5686391">readFull</span><span class="op" id="5686399">(</span><span class="ident" id="5686400">d</span><span class="op" id="5686401">.</span><span class="ident" id="5686402">tmp</span><span class="op" id="5686405">[</span><span class="op" id="5686406">:</span><span class="num" id="5686407">2</span><span class="op" id="5686408">]</span><span class="op" id="5686409">)</span><span class="op" id="5686410">;</span>&nbsp;<span class="ident" id="5686412">err</span>&nbsp;<span class="op" id="5686416">!=</span>&nbsp;<span class="ident" id="5686419">nil</span>&nbsp;<span class="op" id="5686423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686430">return</span>&nbsp;<span class="ident" id="5686437">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686451">if</span>&nbsp;<span class="ident" id="5686454">d</span><span class="op" id="5686455">.</span><span class="ident" id="5686456">tmp</span><span class="op" id="5686459">[</span><span class="num" id="5686460">0</span><span class="op" id="5686461">]</span>&nbsp;<span class="op" id="5686463">!=</span>&nbsp;<span class="num" id="5686466">0xff</span>&nbsp;<span class="op" id="5686471">||</span>&nbsp;<span class="ident" id="5686474">d</span><span class="op" id="5686475">.</span><span class="ident" id="5686476">tmp</span><span class="op" id="5686479">[</span><span class="num" id="5686480">1</span><span class="op" id="5686481">]</span>&nbsp;<span class="op" id="5686483">!=</span>&nbsp;<span class="ident" id="5686486">expectedRST</span>&nbsp;<span class="op" id="5686498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686505">return</span>&nbsp;<span class="ident" id="5686512">FormatError</span><span class="op" id="5686523">(</span><span class="string" id="5686524">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="5686540">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686552">expectedRST</span><span class="op" id="5686563">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686570">if</span>&nbsp;<span class="ident" id="5686573">expectedRST</span>&nbsp;<span class="op" id="5686585">==</span>&nbsp;<span class="ident" id="5686588">rst7Marker</span><span class="op" id="5686598">+</span><span class="num" id="5686599">1</span>&nbsp;<span class="op" id="5686601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686608">expectedRST</span>&nbsp;<span class="op" id="5686620">=</span>&nbsp;<span class="ident" id="5686622">rst0Marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686637">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5686643">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686677">d</span><span class="op" id="5686678">.</span><span class="ident" id="5686679">bits</span>&nbsp;<span class="op" id="5686684">=</span>&nbsp;<span class="ident" id="5686686">bits</span><span class="op" id="5686690">{</span><span class="op" id="5686691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5686697">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686755">dc</span>&nbsp;<span class="op" id="5686758">=</span>&nbsp;<span class="op" id="5686760">[</span><span class="ident" id="5686761">nColorComponent</span><span class="op" id="5686776">]</span><span class="builtintype" id="5686777">int32</span><span class="op" id="5686782">{</span><span class="op" id="5686783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5686789">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686857">d</span><span class="op" id="5686858">.</span><span class="ident" id="5686859">eobRun</span>&nbsp;<span class="op" id="5686866">=</span>&nbsp;<span class="num" id="5686868">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686877">}</span>&nbsp;<span class="comment" id="5686879">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686890">}</span>&nbsp;<span class="comment" id="5686892">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686904">return</span>&nbsp;<span class="ident" id="5686911">nil</span><br>
<span class="lineno"></span><span class="op" id="5686915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5686918">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5686997">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="5687015">func</span>&nbsp;<span class="op" id="5687020">(</span><span class="ident" id="5687021">d</span>&nbsp;<span class="op" id="5687023">*</span><span class="ident" id="5687024">decoder</span><span class="op" id="5687031">)</span>&nbsp;<span class="ident" id="5687033">refine</span><span class="op" id="5687039">(</span><span class="ident" id="5687040">b</span>&nbsp;<span class="op" id="5687042">*</span><span class="ident" id="5687043">block</span><span class="op" id="5687048">,</span>&nbsp;<span class="ident" id="5687050">h</span>&nbsp;<span class="op" id="5687052">*</span><span class="ident" id="5687053">huffman</span><span class="op" id="5687060">,</span>&nbsp;<span class="ident" id="5687062">zigStart</span><span class="op" id="5687070">,</span>&nbsp;<span class="ident" id="5687072">zigEnd</span><span class="op" id="5687078">,</span>&nbsp;<span class="ident" id="5687080">delta</span>&nbsp;<span class="builtintype" id="5687086">int32</span><span class="op" id="5687091">)</span>&nbsp;<span class="builtintype" id="5687093">error</span>&nbsp;<span class="op" id="5687099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5687102">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687142">if</span>&nbsp;<span class="ident" id="5687145">zigStart</span>&nbsp;<span class="op" id="5687154">==</span>&nbsp;<span class="num" id="5687157">0</span>&nbsp;<span class="op" id="5687159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687163">if</span>&nbsp;<span class="ident" id="5687166">zigEnd</span>&nbsp;<span class="op" id="5687173">!=</span>&nbsp;<span class="num" id="5687176">0</span>&nbsp;<span class="op" id="5687178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5687183">panic</span><span class="op" id="5687188">(</span><span class="string" id="5687189">&#34;unreachable&#34;</span><span class="op" id="5687202">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687210">bit</span><span class="op" id="5687213">,</span>&nbsp;<span class="ident" id="5687215">err</span>&nbsp;<span class="op" id="5687219">:=</span>&nbsp;<span class="ident" id="5687222">d</span><span class="op" id="5687223">.</span><span class="ident" id="5687224">decodeBit</span><span class="op" id="5687233">(</span><span class="op" id="5687234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687238">if</span>&nbsp;<span class="ident" id="5687241">err</span>&nbsp;<span class="op" id="5687245">!=</span>&nbsp;<span class="ident" id="5687248">nil</span>&nbsp;<span class="op" id="5687252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687257">return</span>&nbsp;<span class="ident" id="5687264">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687270">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687274">if</span>&nbsp;<span class="ident" id="5687277">bit</span>&nbsp;<span class="op" id="5687281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687286">b</span><span class="op" id="5687287">[</span><span class="num" id="5687288">0</span><span class="op" id="5687289">]</span>&nbsp;<span class="op" id="5687291">|=</span>&nbsp;<span class="ident" id="5687294">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687306">return</span>&nbsp;<span class="ident" id="5687313">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687318">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5687322">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687404">zig</span>&nbsp;<span class="op" id="5687408">:=</span>&nbsp;<span class="ident" id="5687411">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687421">if</span>&nbsp;<span class="ident" id="5687424">d</span><span class="op" id="5687425">.</span><span class="ident" id="5687426">eobRun</span>&nbsp;<span class="op" id="5687433">==</span>&nbsp;<span class="num" id="5687436">0</span>&nbsp;<span class="op" id="5687438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687441">loop</span><span class="op" id="5687445">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687449">for</span>&nbsp;<span class="op" id="5687453">;</span>&nbsp;<span class="ident" id="5687455">zig</span>&nbsp;<span class="op" id="5687459">&lt;=</span>&nbsp;<span class="ident" id="5687462">zigEnd</span><span class="op" id="5687468">;</span>&nbsp;<span class="ident" id="5687470">zig</span><span class="op" id="5687473">++</span>&nbsp;<span class="op" id="5687476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687481">z</span>&nbsp;<span class="op" id="5687483">:=</span>&nbsp;<span class="builtintype" id="5687486">int32</span><span class="op" id="5687491">(</span><span class="num" id="5687492">0</span><span class="op" id="5687493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687498">value</span><span class="op" id="5687503">,</span>&nbsp;<span class="ident" id="5687505">err</span>&nbsp;<span class="op" id="5687509">:=</span>&nbsp;<span class="ident" id="5687512">d</span><span class="op" id="5687513">.</span><span class="ident" id="5687514">decodeHuffman</span><span class="op" id="5687527">(</span><span class="ident" id="5687528">h</span><span class="op" id="5687529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687534">if</span>&nbsp;<span class="ident" id="5687537">err</span>&nbsp;<span class="op" id="5687541">!=</span>&nbsp;<span class="ident" id="5687544">nil</span>&nbsp;<span class="op" id="5687548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687554">return</span>&nbsp;<span class="ident" id="5687561">err</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687573">val0</span>&nbsp;<span class="op" id="5687578">:=</span>&nbsp;<span class="ident" id="5687581">value</span>&nbsp;<span class="op" id="5687587">&gt;&gt;</span>&nbsp;<span class="num" id="5687590">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687595">val1</span>&nbsp;<span class="op" id="5687600">:=</span>&nbsp;<span class="ident" id="5687603">value</span>&nbsp;<span class="op" id="5687609">&amp;</span>&nbsp;<span class="num" id="5687611">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687620">switch</span>&nbsp;<span class="ident" id="5687627">val1</span>&nbsp;<span class="op" id="5687632">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687637">case</span>&nbsp;<span class="num" id="5687642">0</span><span class="op" id="5687643">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687649">if</span>&nbsp;<span class="ident" id="5687652">val0</span>&nbsp;<span class="op" id="5687657">!=</span>&nbsp;<span class="num" id="5687660">0x0f</span>&nbsp;<span class="op" id="5687665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687672">d</span><span class="op" id="5687673">.</span><span class="ident" id="5687674">eobRun</span>&nbsp;<span class="op" id="5687681">=</span>&nbsp;<span class="builtintype" id="5687683">uint16</span><span class="op" id="5687689">(</span><span class="num" id="5687690">1</span>&nbsp;<span class="op" id="5687692">&lt;&lt;</span>&nbsp;<span class="ident" id="5687695">val0</span><span class="op" id="5687699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687706">if</span>&nbsp;<span class="ident" id="5687709">val0</span>&nbsp;<span class="op" id="5687714">!=</span>&nbsp;<span class="num" id="5687717">0</span>&nbsp;<span class="op" id="5687719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687727">bits</span><span class="op" id="5687731">,</span>&nbsp;<span class="ident" id="5687733">err</span>&nbsp;<span class="op" id="5687737">:=</span>&nbsp;<span class="ident" id="5687740">d</span><span class="op" id="5687741">.</span><span class="ident" id="5687742">decodeBits</span><span class="op" id="5687752">(</span><span class="builtintype" id="5687753">int32</span><span class="op" id="5687758">(</span><span class="ident" id="5687759">val0</span><span class="op" id="5687763">)</span><span class="op" id="5687764">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687772">if</span>&nbsp;<span class="ident" id="5687775">err</span>&nbsp;<span class="op" id="5687779">!=</span>&nbsp;<span class="ident" id="5687782">nil</span>&nbsp;<span class="op" id="5687786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687795">return</span>&nbsp;<span class="ident" id="5687802">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687820">d</span><span class="op" id="5687821">.</span><span class="ident" id="5687822">eobRun</span>&nbsp;<span class="op" id="5687829">|=</span>&nbsp;<span class="builtintype" id="5687832">uint16</span><span class="op" id="5687838">(</span><span class="ident" id="5687839">bits</span><span class="op" id="5687843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687850">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687857">break</span>&nbsp;<span class="ident" id="5687863">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687877">case</span>&nbsp;<span class="num" id="5687882">1</span><span class="op" id="5687883">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687889">z</span>&nbsp;<span class="op" id="5687891">=</span>&nbsp;<span class="ident" id="5687893">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687903">bit</span><span class="op" id="5687906">,</span>&nbsp;<span class="ident" id="5687908">err</span>&nbsp;<span class="op" id="5687912">:=</span>&nbsp;<span class="ident" id="5687915">d</span><span class="op" id="5687916">.</span><span class="ident" id="5687917">decodeBit</span><span class="op" id="5687926">(</span><span class="op" id="5687927">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687933">if</span>&nbsp;<span class="ident" id="5687936">err</span>&nbsp;<span class="op" id="5687940">!=</span>&nbsp;<span class="ident" id="5687943">nil</span>&nbsp;<span class="op" id="5687947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687954">return</span>&nbsp;<span class="ident" id="5687961">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687975">if</span>&nbsp;<span class="op" id="5687978">!</span><span class="ident" id="5687979">bit</span>&nbsp;<span class="op" id="5687983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687990">z</span>&nbsp;<span class="op" id="5687992">=</span>&nbsp;<span class="op" id="5687994">-</span><span class="ident" id="5687995">z</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688006">default</span><span class="op" id="5688013">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688019">return</span>&nbsp;<span class="ident" id="5688026">FormatError</span><span class="op" id="5688037">(</span><span class="string" id="5688038">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="5688063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688074">zig</span><span class="op" id="5688077">,</span>&nbsp;<span class="ident" id="5688079">err</span>&nbsp;<span class="op" id="5688083">=</span>&nbsp;<span class="ident" id="5688085">d</span><span class="op" id="5688086">.</span><span class="ident" id="5688087">refineNonZeroes</span><span class="op" id="5688102">(</span><span class="ident" id="5688103">b</span><span class="op" id="5688104">,</span>&nbsp;<span class="ident" id="5688106">zig</span><span class="op" id="5688109">,</span>&nbsp;<span class="ident" id="5688111">zigEnd</span><span class="op" id="5688117">,</span>&nbsp;<span class="builtintype" id="5688119">int32</span><span class="op" id="5688124">(</span><span class="ident" id="5688125">val0</span><span class="op" id="5688129">)</span><span class="op" id="5688130">,</span>&nbsp;<span class="ident" id="5688132">delta</span><span class="op" id="5688137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688142">if</span>&nbsp;<span class="ident" id="5688145">err</span>&nbsp;<span class="op" id="5688149">!=</span>&nbsp;<span class="ident" id="5688152">nil</span>&nbsp;<span class="op" id="5688156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688162">return</span>&nbsp;<span class="ident" id="5688169">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688181">if</span>&nbsp;<span class="ident" id="5688184">zig</span>&nbsp;<span class="op" id="5688188">&gt;</span>&nbsp;<span class="ident" id="5688190">zigEnd</span>&nbsp;<span class="op" id="5688197">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688203">return</span>&nbsp;<span class="ident" id="5688210">FormatError</span><span class="op" id="5688221">(</span><span class="string" id="5688222">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="5688245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688255">if</span>&nbsp;<span class="ident" id="5688258">z</span>&nbsp;<span class="op" id="5688260">!=</span>&nbsp;<span class="num" id="5688263">0</span>&nbsp;<span class="op" id="5688265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688271">b</span><span class="op" id="5688272">[</span><span class="ident" id="5688273">unzig</span><span class="op" id="5688278">[</span><span class="ident" id="5688279">zig</span><span class="op" id="5688282">]</span><span class="op" id="5688283">]</span>&nbsp;<span class="op" id="5688285">=</span>&nbsp;<span class="ident" id="5688287">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688292">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688302">if</span>&nbsp;<span class="ident" id="5688305">d</span><span class="op" id="5688306">.</span><span class="ident" id="5688307">eobRun</span>&nbsp;<span class="op" id="5688314">&gt;</span>&nbsp;<span class="num" id="5688316">0</span>&nbsp;<span class="op" id="5688318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688322">d</span><span class="op" id="5688323">.</span><span class="ident" id="5688324">eobRun</span><span class="op" id="5688330">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688335">if</span>&nbsp;<span class="ident" id="5688338">_</span><span class="op" id="5688339">,</span>&nbsp;<span class="ident" id="5688341">err</span>&nbsp;<span class="op" id="5688345">:=</span>&nbsp;<span class="ident" id="5688348">d</span><span class="op" id="5688349">.</span><span class="ident" id="5688350">refineNonZeroes</span><span class="op" id="5688365">(</span><span class="ident" id="5688366">b</span><span class="op" id="5688367">,</span>&nbsp;<span class="ident" id="5688369">zig</span><span class="op" id="5688372">,</span>&nbsp;<span class="ident" id="5688374">zigEnd</span><span class="op" id="5688380">,</span>&nbsp;<span class="op" id="5688382">-</span><span class="num" id="5688383">1</span><span class="op" id="5688384">,</span>&nbsp;<span class="ident" id="5688386">delta</span><span class="op" id="5688391">)</span><span class="op" id="5688392">;</span>&nbsp;<span class="ident" id="5688394">err</span>&nbsp;<span class="op" id="5688398">!=</span>&nbsp;<span class="ident" id="5688401">nil</span>&nbsp;<span class="op" id="5688405">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688410">return</span>&nbsp;<span class="ident" id="5688417">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688429">return</span>&nbsp;<span class="ident" id="5688436">nil</span><br>
<span class="lineno"></span><span class="op" id="5688440">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="5688443">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="5688522">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="5688569">func</span>&nbsp;<span class="op" id="5688574">(</span><span class="ident" id="5688575">d</span>&nbsp;<span class="op" id="5688577">*</span><span class="ident" id="5688578">decoder</span><span class="op" id="5688585">)</span>&nbsp;<span class="ident" id="5688587">refineNonZeroes</span><span class="op" id="5688602">(</span><span class="ident" id="5688603">b</span>&nbsp;<span class="op" id="5688605">*</span><span class="ident" id="5688606">block</span><span class="op" id="5688611">,</span>&nbsp;<span class="ident" id="5688613">zig</span><span class="op" id="5688616">,</span>&nbsp;<span class="ident" id="5688618">zigEnd</span><span class="op" id="5688624">,</span>&nbsp;<span class="ident" id="5688626">nz</span><span class="op" id="5688628">,</span>&nbsp;<span class="ident" id="5688630">delta</span>&nbsp;<span class="builtintype" id="5688636">int32</span><span class="op" id="5688641">)</span>&nbsp;<span class="op" id="5688643">(</span><span class="builtintype" id="5688644">int32</span><span class="op" id="5688649">,</span>&nbsp;<span class="builtintype" id="5688651">error</span><span class="op" id="5688656">)</span>&nbsp;<span class="op" id="5688658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688661">for</span>&nbsp;<span class="op" id="5688665">;</span>&nbsp;<span class="ident" id="5688667">zig</span>&nbsp;<span class="op" id="5688671">&lt;=</span>&nbsp;<span class="ident" id="5688674">zigEnd</span><span class="op" id="5688680">;</span>&nbsp;<span class="ident" id="5688682">zig</span><span class="op" id="5688685">++</span>&nbsp;<span class="op" id="5688688">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688692">u</span>&nbsp;<span class="op" id="5688694">:=</span>&nbsp;<span class="ident" id="5688697">unzig</span><span class="op" id="5688702">[</span><span class="ident" id="5688703">zig</span><span class="op" id="5688706">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688710">if</span>&nbsp;<span class="ident" id="5688713">b</span><span class="op" id="5688714">[</span><span class="ident" id="5688715">u</span><span class="op" id="5688716">]</span>&nbsp;<span class="op" id="5688718">==</span>&nbsp;<span class="num" id="5688721">0</span>&nbsp;<span class="op" id="5688723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688728">if</span>&nbsp;<span class="ident" id="5688731">nz</span>&nbsp;<span class="op" id="5688734">==</span>&nbsp;<span class="num" id="5688737">0</span>&nbsp;<span class="op" id="5688739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688745">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688754">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688759">nz</span><span class="op" id="5688761">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688767">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688782">bit</span><span class="op" id="5688785">,</span>&nbsp;<span class="ident" id="5688787">err</span>&nbsp;<span class="op" id="5688791">:=</span>&nbsp;<span class="ident" id="5688794">d</span><span class="op" id="5688795">.</span><span class="ident" id="5688796">decodeBit</span><span class="op" id="5688805">(</span><span class="op" id="5688806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688810">if</span>&nbsp;<span class="ident" id="5688813">err</span>&nbsp;<span class="op" id="5688817">!=</span>&nbsp;<span class="ident" id="5688820">nil</span>&nbsp;<span class="op" id="5688824">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688829">return</span>&nbsp;<span class="num" id="5688836">0</span><span class="op" id="5688837">,</span>&nbsp;<span class="ident" id="5688839">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688849">if</span>&nbsp;<span class="op" id="5688852">!</span><span class="ident" id="5688853">bit</span>&nbsp;<span class="op" id="5688857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688862">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688873">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688877">if</span>&nbsp;<span class="ident" id="5688880">b</span><span class="op" id="5688881">[</span><span class="ident" id="5688882">u</span><span class="op" id="5688883">]</span>&nbsp;<span class="op" id="5688885">&gt;=</span>&nbsp;<span class="num" id="5688888">0</span>&nbsp;<span class="op" id="5688890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688895">b</span><span class="op" id="5688896">[</span><span class="ident" id="5688897">u</span><span class="op" id="5688898">]</span>&nbsp;<span class="op" id="5688900">+=</span>&nbsp;<span class="ident" id="5688903">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688911">}</span>&nbsp;<span class="keyword" id="5688913">else</span>&nbsp;<span class="op" id="5688918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688923">b</span><span class="op" id="5688924">[</span><span class="ident" id="5688925">u</span><span class="op" id="5688926">]</span>&nbsp;<span class="op" id="5688928">-=</span>&nbsp;<span class="ident" id="5688931">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688939">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688945">return</span>&nbsp;<span class="ident" id="5688952">zig</span><span class="op" id="5688955">,</span>&nbsp;<span class="ident" id="5688957">nil</span><br>
<span class="lineno"></span><span class="op" id="5688961">}</span>
</div>
</body>
</html>
