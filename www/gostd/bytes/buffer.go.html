<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html" class="current">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1342227">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1342282">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1342336">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1342387">package</span>&nbsp;<span class="ident" id="1342395">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1342402">//&nbsp;Simple&nbsp;byte&nbsp;buffer&nbsp;for&nbsp;marshaling&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1342446">import</span>&nbsp;<span class="op" id="1342453">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1342456">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1342466">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1342472">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="1342487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1342490">//&nbsp;A&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;variable-sized&nbsp;buffer&nbsp;of&nbsp;bytes&nbsp;with&nbsp;Read&nbsp;and&nbsp;Write&nbsp;methods.</span><br>
<span class="lineno"></span><span class="comment" id="1342567">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Buffer&nbsp;is&nbsp;an&nbsp;empty&nbsp;buffer&nbsp;ready&nbsp;to&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="1342629">type</span>&nbsp;<span class="ident" id="1342634">Buffer</span>&nbsp;<span class="keyword" id="1342641">struct</span>&nbsp;<span class="op" id="1342648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1342651">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1342661">[</span><span class="op" id="1342662">]</span><span class="builtintype" id="1342663">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342679">//&nbsp;contents&nbsp;are&nbsp;the&nbsp;bytes&nbsp;buf[off&nbsp;:&nbsp;len(buf)]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1342726">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1342736">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342754">//&nbsp;read&nbsp;at&nbsp;&amp;buf[off],&nbsp;write&nbsp;at&nbsp;&amp;buf[len(buf)]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1342801">runeBytes</span>&nbsp;<span class="op" id="1342811">[</span><span class="ident" id="1342812">utf8</span><span class="op" id="1342816">.</span><span class="ident" id="1342817">UTFMax</span><span class="op" id="1342823">]</span><span class="builtintype" id="1342824">byte</span>&nbsp;<span class="comment" id="1342829">//&nbsp;avoid&nbsp;allocation&nbsp;of&nbsp;slice&nbsp;on&nbsp;each&nbsp;WriteByte&nbsp;or&nbsp;Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1342885">bootstrap</span>&nbsp;<span class="op" id="1342895">[</span><span class="num" id="1342896">64</span><span class="op" id="1342898">]</span><span class="builtintype" id="1342899">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342913">//&nbsp;memory&nbsp;to&nbsp;hold&nbsp;first&nbsp;slice;&nbsp;helps&nbsp;small&nbsp;buffers&nbsp;(Printf)&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1342992">lastRead</span>&nbsp;&nbsp;<span class="ident" id="1343002">readOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1343020">//&nbsp;last&nbsp;read&nbsp;operation,&nbsp;so&nbsp;that&nbsp;Unread*&nbsp;can&nbsp;work&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="op" id="1343080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1343083">//&nbsp;The&nbsp;readOp&nbsp;constants&nbsp;describe&nbsp;the&nbsp;last&nbsp;action&nbsp;performed&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1343145">//&nbsp;the&nbsp;buffer,&nbsp;so&nbsp;that&nbsp;UnreadRune&nbsp;and&nbsp;UnreadByte&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="1343198">//&nbsp;check&nbsp;for&nbsp;invalid&nbsp;usage.</span><br>
<span class="lineno"></span><span class="keyword" id="1343226">type</span>&nbsp;<span class="ident" id="1343231">readOp</span>&nbsp;<span class="builtintype" id="1343238">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="1343243">const</span>&nbsp;<span class="op" id="1343249">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1343252">opInvalid</span>&nbsp;&nbsp;<span class="ident" id="1343263">readOp</span>&nbsp;<span class="op" id="1343270">=</span>&nbsp;<span class="ident" id="1343272">iota</span>&nbsp;<span class="comment" id="1343277">//&nbsp;Non-read&nbsp;operation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1343301">opReadRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1343326">//&nbsp;Read&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1343341">opRead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1343366">//&nbsp;Any&nbsp;other&nbsp;read&nbsp;operation.</span><br>
<span class="lineno"></span><span class="op" id="1343395">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1343398">//&nbsp;ErrTooLarge&nbsp;is&nbsp;passed&nbsp;to&nbsp;panic&nbsp;if&nbsp;memory&nbsp;cannot&nbsp;be&nbsp;allocated&nbsp;to&nbsp;store&nbsp;data&nbsp;in&nbsp;a&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1343489">var</span>&nbsp;<span class="ident" id="1343493">ErrTooLarge</span>&nbsp;<span class="op" id="1343505">=</span>&nbsp;<span class="ident" id="1343507">errors</span><span class="op" id="1343513">.</span><span class="ident" id="1343514">New</span><span class="op" id="1343517">(</span><span class="string" id="1343518">&#34;bytes.Buffer:&nbsp;too&nbsp;large&#34;</span><span class="op" id="1343543">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1343546">//&nbsp;Bytes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno">40</span><span class="comment" id="1343624">//&nbsp;len(b.Bytes())&nbsp;==&nbsp;b.Len().&nbsp;&nbsp;If&nbsp;the&nbsp;caller&nbsp;changes&nbsp;the&nbsp;contents&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1343697">//&nbsp;returned&nbsp;slice,&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;buffer&nbsp;will&nbsp;change&nbsp;provided&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="1343770">//&nbsp;are&nbsp;no&nbsp;intervening&nbsp;method&nbsp;calls&nbsp;on&nbsp;the&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1343820">func</span>&nbsp;<span class="op" id="1343825">(</span><span class="ident" id="1343826">b</span>&nbsp;<span class="op" id="1343828">*</span><span class="ident" id="1343829">Buffer</span><span class="op" id="1343835">)</span>&nbsp;<span class="ident" id="1343837">Bytes</span><span class="op" id="1343842">(</span><span class="op" id="1343843">)</span>&nbsp;<span class="op" id="1343845">[</span><span class="op" id="1343846">]</span><span class="builtintype" id="1343847">byte</span>&nbsp;<span class="op" id="1343852">{</span>&nbsp;<span class="keyword" id="1343854">return</span>&nbsp;<span class="ident" id="1343861">b</span><span class="op" id="1343862">.</span><span class="ident" id="1343863">buf</span><span class="op" id="1343866">[</span><span class="ident" id="1343867">b</span><span class="op" id="1343868">.</span><span class="ident" id="1343869">off</span><span class="op" id="1343872">:</span><span class="op" id="1343873">]</span>&nbsp;<span class="op" id="1343875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="1343878">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1343945">//&nbsp;as&nbsp;a&nbsp;string.&nbsp;&nbsp;If&nbsp;the&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;it&nbsp;returns&nbsp;&#34;&lt;nil&gt;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="1344014">func</span>&nbsp;<span class="op" id="1344019">(</span><span class="ident" id="1344020">b</span>&nbsp;<span class="op" id="1344022">*</span><span class="ident" id="1344023">Buffer</span><span class="op" id="1344029">)</span>&nbsp;<span class="ident" id="1344031">String</span><span class="op" id="1344037">(</span><span class="op" id="1344038">)</span>&nbsp;<span class="builtintype" id="1344040">string</span>&nbsp;<span class="op" id="1344047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1344050">if</span>&nbsp;<span class="ident" id="1344053">b</span>&nbsp;<span class="op" id="1344055">==</span>&nbsp;<span class="builtintype" id="1344058">nil</span>&nbsp;<span class="op" id="1344062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1344066">//&nbsp;Special&nbsp;case,&nbsp;useful&nbsp;in&nbsp;debugging.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1344106">return</span>&nbsp;<span class="string" id="1344113">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1344122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1344125">return</span>&nbsp;<span class="builtintype" id="1344132">string</span><span class="op" id="1344138">(</span><span class="ident" id="1344139">b</span><span class="op" id="1344140">.</span><span class="ident" id="1344141">buf</span><span class="op" id="1344144">[</span><span class="ident" id="1344145">b</span><span class="op" id="1344146">.</span><span class="ident" id="1344147">off</span><span class="op" id="1344150">:</span><span class="op" id="1344151">]</span><span class="op" id="1344152">)</span><br>
<span class="lineno"></span><span class="op" id="1344154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1344157">//&nbsp;Len&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno"></span><span class="comment" id="1344229">//&nbsp;b.Len()&nbsp;==&nbsp;len(b.Bytes()).</span><br>
<span class="lineno"></span><span class="keyword" id="1344259">func</span>&nbsp;<span class="op" id="1344264">(</span><span class="ident" id="1344265">b</span>&nbsp;<span class="op" id="1344267">*</span><span class="ident" id="1344268">Buffer</span><span class="op" id="1344274">)</span>&nbsp;<span class="ident" id="1344276">Len</span><span class="op" id="1344279">(</span><span class="op" id="1344280">)</span>&nbsp;<span class="builtintype" id="1344282">int</span>&nbsp;<span class="op" id="1344286">{</span>&nbsp;<span class="keyword" id="1344288">return</span>&nbsp;<span class="builtinfunc" id="1344295">len</span><span class="op" id="1344298">(</span><span class="ident" id="1344299">b</span><span class="op" id="1344300">.</span><span class="ident" id="1344301">buf</span><span class="op" id="1344304">)</span>&nbsp;<span class="op" id="1344306">-</span>&nbsp;<span class="ident" id="1344308">b</span><span class="op" id="1344309">.</span><span class="ident" id="1344310">off</span>&nbsp;<span class="op" id="1344314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1344317">//&nbsp;Truncate&nbsp;discards&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;n&nbsp;unread&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">60</span><span class="comment" id="1344388">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;n&nbsp;is&nbsp;negative&nbsp;or&nbsp;greater&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1344460">func</span>&nbsp;<span class="op" id="1344465">(</span><span class="ident" id="1344466">b</span>&nbsp;<span class="op" id="1344468">*</span><span class="ident" id="1344469">Buffer</span><span class="op" id="1344475">)</span>&nbsp;<span class="ident" id="1344477">Truncate</span><span class="op" id="1344485">(</span><span class="ident" id="1344486">n</span>&nbsp;<span class="builtintype" id="1344488">int</span><span class="op" id="1344491">)</span>&nbsp;<span class="op" id="1344493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344496">b</span><span class="op" id="1344497">.</span><span class="ident" id="1344498">lastRead</span>&nbsp;<span class="op" id="1344507">=</span>&nbsp;<span class="ident" id="1344509">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1344520">switch</span>&nbsp;<span class="op" id="1344527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1344530">case</span>&nbsp;<span class="ident" id="1344535">n</span>&nbsp;<span class="op" id="1344537">&lt;</span>&nbsp;<span class="num" id="1344539">0</span>&nbsp;<span class="op" id="1344541">||</span>&nbsp;<span class="ident" id="1344544">n</span>&nbsp;<span class="op" id="1344546">&gt;</span>&nbsp;<span class="ident" id="1344548">b</span><span class="op" id="1344549">.</span><span class="ident" id="1344550">Len</span><span class="op" id="1344553">(</span><span class="op" id="1344554">)</span><span class="op" id="1344555">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1344559">panic</span><span class="op" id="1344564">(</span><span class="string" id="1344565">&#34;bytes.Buffer:&nbsp;truncation&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1344604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1344607">case</span>&nbsp;<span class="ident" id="1344612">n</span>&nbsp;<span class="op" id="1344614">==</span>&nbsp;<span class="num" id="1344617">0</span><span class="op" id="1344618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1344622">//&nbsp;Reuse&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344647">b</span><span class="op" id="1344648">.</span><span class="ident" id="1344649">off</span>&nbsp;<span class="op" id="1344653">=</span>&nbsp;<span class="num" id="1344655">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1344658">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344661">b</span><span class="op" id="1344662">.</span><span class="ident" id="1344663">buf</span>&nbsp;<span class="op" id="1344667">=</span>&nbsp;<span class="ident" id="1344669">b</span><span class="op" id="1344670">.</span><span class="ident" id="1344671">buf</span><span class="op" id="1344674">[</span><span class="num" id="1344675">0</span>&nbsp;<span class="op" id="1344677">:</span>&nbsp;<span class="ident" id="1344679">b</span><span class="op" id="1344680">.</span><span class="ident" id="1344681">off</span><span class="op" id="1344684">+</span><span class="ident" id="1344685">n</span><span class="op" id="1344686">]</span><br>
<span class="lineno"></span><span class="op" id="1344688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1344691">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;buffer&nbsp;so&nbsp;it&nbsp;has&nbsp;no&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="1344740">//&nbsp;b.Reset()&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;b.Truncate(0).</span><br>
<span class="lineno">75</span><span class="keyword" id="1344783">func</span>&nbsp;<span class="op" id="1344788">(</span><span class="ident" id="1344789">b</span>&nbsp;<span class="op" id="1344791">*</span><span class="ident" id="1344792">Buffer</span><span class="op" id="1344798">)</span>&nbsp;<span class="ident" id="1344800">Reset</span><span class="op" id="1344805">(</span><span class="op" id="1344806">)</span>&nbsp;<span class="op" id="1344808">{</span>&nbsp;<span class="ident" id="1344810">b</span><span class="op" id="1344811">.</span><span class="ident" id="1344812">Truncate</span><span class="op" id="1344820">(</span><span class="num" id="1344821">0</span><span class="op" id="1344822">)</span>&nbsp;<span class="op" id="1344824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1344827">//&nbsp;grow&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for&nbsp;n&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1344889">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;bytes&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="1344944">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">80</span><span class="keyword" id="1345004">func</span>&nbsp;<span class="op" id="1345009">(</span><span class="ident" id="1345010">b</span>&nbsp;<span class="op" id="1345012">*</span><span class="ident" id="1345013">Buffer</span><span class="op" id="1345019">)</span>&nbsp;<span class="ident" id="1345021">grow</span><span class="op" id="1345025">(</span><span class="ident" id="1345026">n</span>&nbsp;<span class="builtintype" id="1345028">int</span><span class="op" id="1345031">)</span>&nbsp;<span class="builtintype" id="1345033">int</span>&nbsp;<span class="op" id="1345037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1345040">m</span>&nbsp;<span class="op" id="1345042">:=</span>&nbsp;<span class="ident" id="1345045">b</span><span class="op" id="1345046">.</span><span class="ident" id="1345047">Len</span><span class="op" id="1345050">(</span><span class="op" id="1345051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1345054">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1345102">if</span>&nbsp;<span class="ident" id="1345105">m</span>&nbsp;<span class="op" id="1345107">==</span>&nbsp;<span class="num" id="1345110">0</span>&nbsp;<span class="op" id="1345112">&amp;&amp;</span>&nbsp;<span class="ident" id="1345115">b</span><span class="op" id="1345116">.</span><span class="ident" id="1345117">off</span>&nbsp;<span class="op" id="1345121">!=</span>&nbsp;<span class="num" id="1345124">0</span>&nbsp;<span class="op" id="1345126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1345130">b</span><span class="op" id="1345131">.</span><span class="ident" id="1345132">Truncate</span><span class="op" id="1345140">(</span><span class="num" id="1345141">0</span><span class="op" id="1345142">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1345145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1345148">if</span>&nbsp;<span class="builtinfunc" id="1345151">len</span><span class="op" id="1345154">(</span><span class="ident" id="1345155">b</span><span class="op" id="1345156">.</span><span class="ident" id="1345157">buf</span><span class="op" id="1345160">)</span><span class="op" id="1345161">+</span><span class="ident" id="1345162">n</span>&nbsp;<span class="op" id="1345164">&gt;</span>&nbsp;<span class="builtinfunc" id="1345166">cap</span><span class="op" id="1345169">(</span><span class="ident" id="1345170">b</span><span class="op" id="1345171">.</span><span class="ident" id="1345172">buf</span><span class="op" id="1345175">)</span>&nbsp;<span class="op" id="1345177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1345181">var</span>&nbsp;<span class="ident" id="1345185">buf</span>&nbsp;<span class="op" id="1345189">[</span><span class="op" id="1345190">]</span><span class="builtintype" id="1345191">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1345198">if</span>&nbsp;<span class="ident" id="1345201">b</span><span class="op" id="1345202">.</span><span class="ident" id="1345203">buf</span>&nbsp;<span class="op" id="1345207">==</span>&nbsp;<span class="builtintype" id="1345210">nil</span>&nbsp;<span class="op" id="1345214">&amp;&amp;</span>&nbsp;<span class="ident" id="1345217">n</span>&nbsp;<span class="op" id="1345219">&lt;=</span>&nbsp;<span class="builtinfunc" id="1345222">len</span><span class="op" id="1345225">(</span><span class="ident" id="1345226">b</span><span class="op" id="1345227">.</span><span class="ident" id="1345228">bootstrap</span><span class="op" id="1345237">)</span>&nbsp;<span class="op" id="1345239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1345244">buf</span>&nbsp;<span class="op" id="1345248">=</span>&nbsp;<span class="ident" id="1345250">b</span><span class="op" id="1345251">.</span><span class="ident" id="1345252">bootstrap</span><span class="op" id="1345261">[</span><span class="num" id="1345262">0</span><span class="op" id="1345263">:</span><span class="op" id="1345264">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1345268">}</span>&nbsp;<span class="keyword" id="1345270">else</span>&nbsp;<span class="keyword" id="1345275">if</span>&nbsp;<span class="ident" id="1345278">m</span><span class="op" id="1345279">+</span><span class="ident" id="1345280">n</span>&nbsp;<span class="op" id="1345282">&lt;=</span>&nbsp;<span class="builtinfunc" id="1345285">cap</span><span class="op" id="1345288">(</span><span class="ident" id="1345289">b</span><span class="op" id="1345290">.</span><span class="ident" id="1345291">buf</span><span class="op" id="1345294">)</span><span class="op" id="1345295">/</span><span class="num" id="1345296">2</span>&nbsp;<span class="op" id="1345298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1345303">//&nbsp;We&nbsp;can&nbsp;slide&nbsp;things&nbsp;down&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1345362">//&nbsp;slice.&nbsp;We&nbsp;only&nbsp;need&nbsp;m+n&nbsp;&lt;=&nbsp;cap(b.buf)&nbsp;to&nbsp;slide,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1345420">//&nbsp;we&nbsp;instead&nbsp;let&nbsp;capacity&nbsp;get&nbsp;twice&nbsp;as&nbsp;large&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1345475">//&nbsp;don&#39;t&nbsp;spend&nbsp;all&nbsp;our&nbsp;time&nbsp;copying.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1345515">copy</span><span class="op" id="1345519">(</span><span class="ident" id="1345520">b</span><span class="op" id="1345521">.</span><span class="ident" id="1345522">buf</span><span class="op" id="1345525">[</span><span class="op" id="1345526">:</span><span class="op" id="1345527">]</span><span class="op" id="1345528">,</span>&nbsp;<span class="ident" id="1345530">b</span><span class="op" id="1345531">.</span><span class="ident" id="1345532">buf</span><span class="op" id="1345535">[</span><span class="ident" id="1345536">b</span><span class="op" id="1345537">.</span><span class="ident" id="1345538">off</span><span class="op" id="1345541">:</span><span class="op" id="1345542">]</span><span class="op" id="1345543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1345548">buf</span>&nbsp;<span class="op" id="1345552">=</span>&nbsp;<span class="ident" id="1345554">b</span><span class="op" id="1345555">.</span><span class="ident" id="1345556">buf</span><span class="op" id="1345559">[</span><span class="op" id="1345560">:</span><span class="ident" id="1345561">m</span><span class="op" id="1345562">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1345566">}</span>&nbsp;<span class="keyword" id="1345568">else</span>&nbsp;<span class="op" id="1345573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1345578">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;anywhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1345610">buf</span>&nbsp;<span class="op" id="1345614">=</span>&nbsp;<span class="ident" id="1345616">makeSlice</span><span class="op" id="1345625">(</span><span class="num" id="1345626">2</span><span class="op" id="1345627">*</span><span class="builtinfunc" id="1345628">cap</span><span class="op" id="1345631">(</span><span class="ident" id="1345632">b</span><span class="op" id="1345633">.</span><span class="ident" id="1345634">buf</span><span class="op" id="1345637">)</span>&nbsp;<span class="op" id="1345639">+</span>&nbsp;<span class="ident" id="1345641">n</span><span class="op" id="1345642">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1345647">copy</span><span class="op" id="1345651">(</span><span class="ident" id="1345652">buf</span><span class="op" id="1345655">,</span>&nbsp;<span class="ident" id="1345657">b</span><span class="op" id="1345658">.</span><span class="ident" id="1345659">buf</span><span class="op" id="1345662">[</span><span class="ident" id="1345663">b</span><span class="op" id="1345664">.</span><span class="ident" id="1345665">off</span><span class="op" id="1345668">:</span><span class="op" id="1345669">]</span><span class="op" id="1345670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1345674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1345678">b</span><span class="op" id="1345679">.</span><span class="ident" id="1345680">buf</span>&nbsp;<span class="op" id="1345684">=</span>&nbsp;<span class="ident" id="1345686">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1345692">b</span><span class="op" id="1345693">.</span><span class="ident" id="1345694">off</span>&nbsp;<span class="op" id="1345698">=</span>&nbsp;<span class="num" id="1345700">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1345703">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1345706">b</span><span class="op" id="1345707">.</span><span class="ident" id="1345708">buf</span>&nbsp;<span class="op" id="1345712">=</span>&nbsp;<span class="ident" id="1345714">b</span><span class="op" id="1345715">.</span><span class="ident" id="1345716">buf</span><span class="op" id="1345719">[</span><span class="num" id="1345720">0</span>&nbsp;<span class="op" id="1345722">:</span>&nbsp;<span class="ident" id="1345724">b</span><span class="op" id="1345725">.</span><span class="ident" id="1345726">off</span><span class="op" id="1345729">+</span><span class="ident" id="1345730">m</span><span class="op" id="1345731">+</span><span class="ident" id="1345732">n</span><span class="op" id="1345733">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1345736">return</span>&nbsp;<span class="ident" id="1345743">b</span><span class="op" id="1345744">.</span><span class="ident" id="1345745">off</span>&nbsp;<span class="op" id="1345749">+</span>&nbsp;<span class="ident" id="1345751">m</span><br>
<span class="lineno"></span><span class="op" id="1345753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1345756">//&nbsp;Grow&nbsp;grows&nbsp;the&nbsp;buffer&#39;s&nbsp;capacity,&nbsp;if&nbsp;necessary,&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for</span><br>
<span class="lineno">110</span><span class="comment" id="1345830">//&nbsp;another&nbsp;n&nbsp;bytes.&nbsp;After&nbsp;Grow(n),&nbsp;at&nbsp;least&nbsp;n&nbsp;bytes&nbsp;can&nbsp;be&nbsp;written&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1345904">//&nbsp;buffer&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="1345942">//&nbsp;If&nbsp;n&nbsp;is&nbsp;negative,&nbsp;Grow&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="comment" id="1345980">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1346040">func</span>&nbsp;<span class="op" id="1346045">(</span><span class="ident" id="1346046">b</span>&nbsp;<span class="op" id="1346048">*</span><span class="ident" id="1346049">Buffer</span><span class="op" id="1346055">)</span>&nbsp;<span class="ident" id="1346057">Grow</span><span class="op" id="1346061">(</span><span class="ident" id="1346062">n</span>&nbsp;<span class="builtintype" id="1346064">int</span><span class="op" id="1346067">)</span>&nbsp;<span class="op" id="1346069">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346072">if</span>&nbsp;<span class="ident" id="1346075">n</span>&nbsp;<span class="op" id="1346077">&lt;</span>&nbsp;<span class="num" id="1346079">0</span>&nbsp;<span class="op" id="1346081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1346085">panic</span><span class="op" id="1346090">(</span><span class="string" id="1346091">&#34;bytes.Buffer.Grow:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="1346126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1346129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346132">m</span>&nbsp;<span class="op" id="1346134">:=</span>&nbsp;<span class="ident" id="1346137">b</span><span class="op" id="1346138">.</span><span class="ident" id="1346139">grow</span><span class="op" id="1346143">(</span><span class="ident" id="1346144">n</span><span class="op" id="1346145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346148">b</span><span class="op" id="1346149">.</span><span class="ident" id="1346150">buf</span>&nbsp;<span class="op" id="1346154">=</span>&nbsp;<span class="ident" id="1346156">b</span><span class="op" id="1346157">.</span><span class="ident" id="1346158">buf</span><span class="op" id="1346161">[</span><span class="num" id="1346162">0</span><span class="op" id="1346163">:</span><span class="ident" id="1346164">m</span><span class="op" id="1346165">]</span><br>
<span class="lineno">120</span><span class="op" id="1346167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1346170">//&nbsp;Write&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1346242">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;p;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1346318">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;Write&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">125</span><span class="keyword" id="1346382">func</span>&nbsp;<span class="op" id="1346387">(</span><span class="ident" id="1346388">b</span>&nbsp;<span class="op" id="1346390">*</span><span class="ident" id="1346391">Buffer</span><span class="op" id="1346397">)</span>&nbsp;<span class="ident" id="1346399">Write</span><span class="op" id="1346404">(</span><span class="ident" id="1346405">p</span>&nbsp;<span class="op" id="1346407">[</span><span class="op" id="1346408">]</span><span class="builtintype" id="1346409">byte</span><span class="op" id="1346413">)</span>&nbsp;<span class="op" id="1346415">(</span><span class="ident" id="1346416">n</span>&nbsp;<span class="builtintype" id="1346418">int</span><span class="op" id="1346421">,</span>&nbsp;<span class="ident" id="1346423">err</span>&nbsp;<span class="builtintype" id="1346427">error</span><span class="op" id="1346432">)</span>&nbsp;<span class="op" id="1346434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346437">b</span><span class="op" id="1346438">.</span><span class="ident" id="1346439">lastRead</span>&nbsp;<span class="op" id="1346448">=</span>&nbsp;<span class="ident" id="1346450">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346461">m</span>&nbsp;<span class="op" id="1346463">:=</span>&nbsp;<span class="ident" id="1346466">b</span><span class="op" id="1346467">.</span><span class="ident" id="1346468">grow</span><span class="op" id="1346472">(</span><span class="builtinfunc" id="1346473">len</span><span class="op" id="1346476">(</span><span class="ident" id="1346477">p</span><span class="op" id="1346478">)</span><span class="op" id="1346479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346482">return</span>&nbsp;<span class="builtinfunc" id="1346489">copy</span><span class="op" id="1346493">(</span><span class="ident" id="1346494">b</span><span class="op" id="1346495">.</span><span class="ident" id="1346496">buf</span><span class="op" id="1346499">[</span><span class="ident" id="1346500">m</span><span class="op" id="1346501">:</span><span class="op" id="1346502">]</span><span class="op" id="1346503">,</span>&nbsp;<span class="ident" id="1346505">p</span><span class="op" id="1346506">)</span><span class="op" id="1346507">,</span>&nbsp;<span class="builtintype" id="1346509">nil</span><br>
<span class="lineno"></span><span class="op" id="1346513">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1346516">//&nbsp;WriteString&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;s&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1346594">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;s;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1346670">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteString&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1346740">func</span>&nbsp;<span class="op" id="1346745">(</span><span class="ident" id="1346746">b</span>&nbsp;<span class="op" id="1346748">*</span><span class="ident" id="1346749">Buffer</span><span class="op" id="1346755">)</span>&nbsp;<span class="ident" id="1346757">WriteString</span><span class="op" id="1346768">(</span><span class="ident" id="1346769">s</span>&nbsp;<span class="builtintype" id="1346771">string</span><span class="op" id="1346777">)</span>&nbsp;<span class="op" id="1346779">(</span><span class="ident" id="1346780">n</span>&nbsp;<span class="builtintype" id="1346782">int</span><span class="op" id="1346785">,</span>&nbsp;<span class="ident" id="1346787">err</span>&nbsp;<span class="builtintype" id="1346791">error</span><span class="op" id="1346796">)</span>&nbsp;<span class="op" id="1346798">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346801">b</span><span class="op" id="1346802">.</span><span class="ident" id="1346803">lastRead</span>&nbsp;<span class="op" id="1346812">=</span>&nbsp;<span class="ident" id="1346814">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346825">m</span>&nbsp;<span class="op" id="1346827">:=</span>&nbsp;<span class="ident" id="1346830">b</span><span class="op" id="1346831">.</span><span class="ident" id="1346832">grow</span><span class="op" id="1346836">(</span><span class="builtinfunc" id="1346837">len</span><span class="op" id="1346840">(</span><span class="ident" id="1346841">s</span><span class="op" id="1346842">)</span><span class="op" id="1346843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346846">return</span>&nbsp;<span class="builtinfunc" id="1346853">copy</span><span class="op" id="1346857">(</span><span class="ident" id="1346858">b</span><span class="op" id="1346859">.</span><span class="ident" id="1346860">buf</span><span class="op" id="1346863">[</span><span class="ident" id="1346864">m</span><span class="op" id="1346865">:</span><span class="op" id="1346866">]</span><span class="op" id="1346867">,</span>&nbsp;<span class="ident" id="1346869">s</span><span class="op" id="1346870">)</span><span class="op" id="1346871">,</span>&nbsp;<span class="builtintype" id="1346873">nil</span><br>
<span class="lineno"></span><span class="op" id="1346877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1346880">//&nbsp;MinRead&nbsp;is&nbsp;the&nbsp;minimum&nbsp;slice&nbsp;size&nbsp;passed&nbsp;to&nbsp;a&nbsp;Read&nbsp;call&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1346942">//&nbsp;Buffer.ReadFrom.&nbsp;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;Buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;MinRead&nbsp;bytes&nbsp;beyond</span><br>
<span class="lineno"></span><span class="comment" id="1347019">//&nbsp;what&nbsp;is&nbsp;required&nbsp;to&nbsp;hold&nbsp;the&nbsp;contents&nbsp;of&nbsp;r,&nbsp;ReadFrom&nbsp;will&nbsp;not&nbsp;grow&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1347093">//&nbsp;underlying&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1347115">const</span>&nbsp;<span class="ident" id="1347121">MinRead</span>&nbsp;<span class="op" id="1347129">=</span>&nbsp;<span class="num" id="1347131">512</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1347136">//&nbsp;ReadFrom&nbsp;reads&nbsp;data&nbsp;from&nbsp;r&nbsp;until&nbsp;EOF&nbsp;and&nbsp;appends&nbsp;it&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing</span><br>
<span class="lineno"></span><span class="comment" id="1347214">//&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="1347291">//&nbsp;error&nbsp;except&nbsp;io.EOF&nbsp;encountered&nbsp;during&nbsp;the&nbsp;read&nbsp;is&nbsp;also&nbsp;returned.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1347367">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;ReadFrom&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">150</span><span class="keyword" id="1347434">func</span>&nbsp;<span class="op" id="1347439">(</span><span class="ident" id="1347440">b</span>&nbsp;<span class="op" id="1347442">*</span><span class="ident" id="1347443">Buffer</span><span class="op" id="1347449">)</span>&nbsp;<span class="ident" id="1347451">ReadFrom</span><span class="op" id="1347459">(</span><span class="ident" id="1347460">r</span>&nbsp;<span class="ident" id="1347462">io</span><span class="op" id="1347464">.</span><span class="ident" id="1347465">Reader</span><span class="op" id="1347471">)</span>&nbsp;<span class="op" id="1347473">(</span><span class="ident" id="1347474">n</span>&nbsp;<span class="ident" id="1347476">int64</span><span class="op" id="1347481">,</span>&nbsp;<span class="ident" id="1347483">err</span>&nbsp;<span class="builtintype" id="1347487">error</span><span class="op" id="1347492">)</span>&nbsp;<span class="op" id="1347494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347497">b</span><span class="op" id="1347498">.</span><span class="ident" id="1347499">lastRead</span>&nbsp;<span class="op" id="1347508">=</span>&nbsp;<span class="ident" id="1347510">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347521">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347569">if</span>&nbsp;<span class="ident" id="1347572">b</span><span class="op" id="1347573">.</span><span class="ident" id="1347574">off</span>&nbsp;<span class="op" id="1347578">&gt;=</span>&nbsp;<span class="builtinfunc" id="1347581">len</span><span class="op" id="1347584">(</span><span class="ident" id="1347585">b</span><span class="op" id="1347586">.</span><span class="ident" id="1347587">buf</span><span class="op" id="1347590">)</span>&nbsp;<span class="op" id="1347592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347596">b</span><span class="op" id="1347597">.</span><span class="ident" id="1347598">Truncate</span><span class="op" id="1347606">(</span><span class="num" id="1347607">0</span><span class="op" id="1347608">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1347611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347614">for</span>&nbsp;<span class="op" id="1347618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347622">if</span>&nbsp;<span class="ident" id="1347625">free</span>&nbsp;<span class="op" id="1347630">:=</span>&nbsp;<span class="builtinfunc" id="1347633">cap</span><span class="op" id="1347636">(</span><span class="ident" id="1347637">b</span><span class="op" id="1347638">.</span><span class="ident" id="1347639">buf</span><span class="op" id="1347642">)</span>&nbsp;<span class="op" id="1347644">-</span>&nbsp;<span class="builtinfunc" id="1347646">len</span><span class="op" id="1347649">(</span><span class="ident" id="1347650">b</span><span class="op" id="1347651">.</span><span class="ident" id="1347652">buf</span><span class="op" id="1347655">)</span><span class="op" id="1347656">;</span>&nbsp;<span class="ident" id="1347658">free</span>&nbsp;<span class="op" id="1347663">&lt;</span>&nbsp;<span class="ident" id="1347665">MinRead</span>&nbsp;<span class="op" id="1347673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347678">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347708">newBuf</span>&nbsp;<span class="op" id="1347715">:=</span>&nbsp;<span class="ident" id="1347718">b</span><span class="op" id="1347719">.</span><span class="ident" id="1347720">buf</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347727">if</span>&nbsp;<span class="ident" id="1347730">b</span><span class="op" id="1347731">.</span><span class="ident" id="1347732">off</span><span class="op" id="1347735">+</span><span class="ident" id="1347736">free</span>&nbsp;<span class="op" id="1347741">&lt;</span>&nbsp;<span class="ident" id="1347743">MinRead</span>&nbsp;<span class="op" id="1347751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347757">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;using&nbsp;beginning&nbsp;of&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347808">//&nbsp;double&nbsp;buffer&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347838">newBuf</span>&nbsp;<span class="op" id="1347845">=</span>&nbsp;<span class="ident" id="1347847">makeSlice</span><span class="op" id="1347856">(</span><span class="num" id="1347857">2</span><span class="op" id="1347858">*</span><span class="builtinfunc" id="1347859">cap</span><span class="op" id="1347862">(</span><span class="ident" id="1347863">b</span><span class="op" id="1347864">.</span><span class="ident" id="1347865">buf</span><span class="op" id="1347868">)</span>&nbsp;<span class="op" id="1347870">+</span>&nbsp;<span class="ident" id="1347872">MinRead</span><span class="op" id="1347879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1347884">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1347889">copy</span><span class="op" id="1347893">(</span><span class="ident" id="1347894">newBuf</span><span class="op" id="1347900">,</span>&nbsp;<span class="ident" id="1347902">b</span><span class="op" id="1347903">.</span><span class="ident" id="1347904">buf</span><span class="op" id="1347907">[</span><span class="ident" id="1347908">b</span><span class="op" id="1347909">.</span><span class="ident" id="1347910">off</span><span class="op" id="1347913">:</span><span class="op" id="1347914">]</span><span class="op" id="1347915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347920">b</span><span class="op" id="1347921">.</span><span class="ident" id="1347922">buf</span>&nbsp;<span class="op" id="1347926">=</span>&nbsp;<span class="ident" id="1347928">newBuf</span><span class="op" id="1347934">[</span><span class="op" id="1347935">:</span><span class="builtinfunc" id="1347936">len</span><span class="op" id="1347939">(</span><span class="ident" id="1347940">b</span><span class="op" id="1347941">.</span><span class="ident" id="1347942">buf</span><span class="op" id="1347945">)</span><span class="op" id="1347946">-</span><span class="ident" id="1347947">b</span><span class="op" id="1347948">.</span><span class="ident" id="1347949">off</span><span class="op" id="1347952">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347957">b</span><span class="op" id="1347958">.</span><span class="ident" id="1347959">off</span>&nbsp;<span class="op" id="1347963">=</span>&nbsp;<span class="num" id="1347965">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1347969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347973">m</span><span class="op" id="1347974">,</span>&nbsp;<span class="ident" id="1347976">e</span>&nbsp;<span class="op" id="1347978">:=</span>&nbsp;<span class="ident" id="1347981">r</span><span class="op" id="1347982">.</span><span class="ident" id="1347983">Read</span><span class="op" id="1347987">(</span><span class="ident" id="1347988">b</span><span class="op" id="1347989">.</span><span class="ident" id="1347990">buf</span><span class="op" id="1347993">[</span><span class="builtinfunc" id="1347994">len</span><span class="op" id="1347997">(</span><span class="ident" id="1347998">b</span><span class="op" id="1347999">.</span><span class="ident" id="1348000">buf</span><span class="op" id="1348003">)</span><span class="op" id="1348004">:</span><span class="builtinfunc" id="1348005">cap</span><span class="op" id="1348008">(</span><span class="ident" id="1348009">b</span><span class="op" id="1348010">.</span><span class="ident" id="1348011">buf</span><span class="op" id="1348014">)</span><span class="op" id="1348015">]</span><span class="op" id="1348016">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348020">b</span><span class="op" id="1348021">.</span><span class="ident" id="1348022">buf</span>&nbsp;<span class="op" id="1348026">=</span>&nbsp;<span class="ident" id="1348028">b</span><span class="op" id="1348029">.</span><span class="ident" id="1348030">buf</span><span class="op" id="1348033">[</span><span class="num" id="1348034">0</span>&nbsp;<span class="op" id="1348036">:</span>&nbsp;<span class="builtinfunc" id="1348038">len</span><span class="op" id="1348041">(</span><span class="ident" id="1348042">b</span><span class="op" id="1348043">.</span><span class="ident" id="1348044">buf</span><span class="op" id="1348047">)</span><span class="op" id="1348048">+</span><span class="ident" id="1348049">m</span><span class="op" id="1348050">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348054">n</span>&nbsp;<span class="op" id="1348056">+=</span>&nbsp;<span class="ident" id="1348059">int64</span><span class="op" id="1348064">(</span><span class="ident" id="1348065">m</span><span class="op" id="1348066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1348070">if</span>&nbsp;<span class="ident" id="1348073">e</span>&nbsp;<span class="op" id="1348075">==</span>&nbsp;<span class="ident" id="1348078">io</span><span class="op" id="1348080">.</span><span class="ident" id="1348081">EOF</span>&nbsp;<span class="op" id="1348085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1348090">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1348098">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1348102">if</span>&nbsp;<span class="ident" id="1348105">e</span>&nbsp;<span class="op" id="1348107">!=</span>&nbsp;<span class="builtintype" id="1348110">nil</span>&nbsp;<span class="op" id="1348114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1348119">return</span>&nbsp;<span class="ident" id="1348126">n</span><span class="op" id="1348127">,</span>&nbsp;<span class="ident" id="1348129">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1348133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1348136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1348139">return</span>&nbsp;<span class="ident" id="1348146">n</span><span class="op" id="1348147">,</span>&nbsp;<span class="builtintype" id="1348149">nil</span>&nbsp;<span class="comment" id="1348153">//&nbsp;err&nbsp;is&nbsp;EOF,&nbsp;so&nbsp;return&nbsp;nil&nbsp;explicitly</span><br>
<span class="lineno">180</span><span class="op" id="1348193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1348196">//&nbsp;makeSlice&nbsp;allocates&nbsp;a&nbsp;slice&nbsp;of&nbsp;size&nbsp;n.&nbsp;If&nbsp;the&nbsp;allocation&nbsp;fails,&nbsp;it&nbsp;panics</span><br>
<span class="lineno"></span><span class="comment" id="1348273">//&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1348294">func</span>&nbsp;<span class="ident" id="1348299">makeSlice</span><span class="op" id="1348308">(</span><span class="ident" id="1348309">n</span>&nbsp;<span class="builtintype" id="1348311">int</span><span class="op" id="1348314">)</span>&nbsp;<span class="op" id="1348316">[</span><span class="op" id="1348317">]</span><span class="builtintype" id="1348318">byte</span>&nbsp;<span class="op" id="1348323">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1348326">//&nbsp;If&nbsp;the&nbsp;make&nbsp;fails,&nbsp;give&nbsp;a&nbsp;known&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1348369">defer</span>&nbsp;<span class="keyword" id="1348375">func</span><span class="op" id="1348379">(</span><span class="op" id="1348380">)</span>&nbsp;<span class="op" id="1348382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1348386">if</span>&nbsp;<span class="builtinfunc" id="1348389">recover</span><span class="op" id="1348396">(</span><span class="op" id="1348397">)</span>&nbsp;<span class="op" id="1348399">!=</span>&nbsp;<span class="builtintype" id="1348402">nil</span>&nbsp;<span class="op" id="1348406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1348411">panic</span><span class="op" id="1348416">(</span><span class="ident" id="1348417">ErrTooLarge</span><span class="op" id="1348428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1348432">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1348435">}</span><span class="op" id="1348436">(</span><span class="op" id="1348437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1348440">return</span>&nbsp;<span class="builtinfunc" id="1348447">make</span><span class="op" id="1348451">(</span><span class="op" id="1348452">[</span><span class="op" id="1348453">]</span><span class="builtintype" id="1348454">byte</span><span class="op" id="1348458">,</span>&nbsp;<span class="ident" id="1348460">n</span><span class="op" id="1348461">)</span><br>
<span class="lineno"></span><span class="op" id="1348463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1348466">//&nbsp;WriteTo&nbsp;writes&nbsp;data&nbsp;to&nbsp;w&nbsp;until&nbsp;the&nbsp;buffer&nbsp;is&nbsp;drained&nbsp;or&nbsp;an&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno">195</span><span class="comment" id="1348542">//&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written;&nbsp;it&nbsp;always&nbsp;fits&nbsp;into&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="1348619">//&nbsp;int,&nbsp;but&nbsp;it&nbsp;is&nbsp;int64&nbsp;to&nbsp;match&nbsp;the&nbsp;io.WriterTo&nbsp;interface.&nbsp;Any&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="1348689">//&nbsp;encountered&nbsp;during&nbsp;the&nbsp;write&nbsp;is&nbsp;also&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="1348739">func</span>&nbsp;<span class="op" id="1348744">(</span><span class="ident" id="1348745">b</span>&nbsp;<span class="op" id="1348747">*</span><span class="ident" id="1348748">Buffer</span><span class="op" id="1348754">)</span>&nbsp;<span class="ident" id="1348756">WriteTo</span><span class="op" id="1348763">(</span><span class="ident" id="1348764">w</span>&nbsp;<span class="ident" id="1348766">io</span><span class="op" id="1348768">.</span><span class="ident" id="1348769">Writer</span><span class="op" id="1348775">)</span>&nbsp;<span class="op" id="1348777">(</span><span class="ident" id="1348778">n</span>&nbsp;<span class="ident" id="1348780">int64</span><span class="op" id="1348785">,</span>&nbsp;<span class="ident" id="1348787">err</span>&nbsp;<span class="builtintype" id="1348791">error</span><span class="op" id="1348796">)</span>&nbsp;<span class="op" id="1348798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348801">b</span><span class="op" id="1348802">.</span><span class="ident" id="1348803">lastRead</span>&nbsp;<span class="op" id="1348812">=</span>&nbsp;<span class="ident" id="1348814">opInvalid</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1348825">if</span>&nbsp;<span class="ident" id="1348828">b</span><span class="op" id="1348829">.</span><span class="ident" id="1348830">off</span>&nbsp;<span class="op" id="1348834">&lt;</span>&nbsp;<span class="builtinfunc" id="1348836">len</span><span class="op" id="1348839">(</span><span class="ident" id="1348840">b</span><span class="op" id="1348841">.</span><span class="ident" id="1348842">buf</span><span class="op" id="1348845">)</span>&nbsp;<span class="op" id="1348847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348851">nBytes</span>&nbsp;<span class="op" id="1348858">:=</span>&nbsp;<span class="ident" id="1348861">b</span><span class="op" id="1348862">.</span><span class="ident" id="1348863">Len</span><span class="op" id="1348866">(</span><span class="op" id="1348867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348871">m</span><span class="op" id="1348872">,</span>&nbsp;<span class="ident" id="1348874">e</span>&nbsp;<span class="op" id="1348876">:=</span>&nbsp;<span class="ident" id="1348879">w</span><span class="op" id="1348880">.</span><span class="ident" id="1348881">Write</span><span class="op" id="1348886">(</span><span class="ident" id="1348887">b</span><span class="op" id="1348888">.</span><span class="ident" id="1348889">buf</span><span class="op" id="1348892">[</span><span class="ident" id="1348893">b</span><span class="op" id="1348894">.</span><span class="ident" id="1348895">off</span><span class="op" id="1348898">:</span><span class="op" id="1348899">]</span><span class="op" id="1348900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1348904">if</span>&nbsp;<span class="ident" id="1348907">m</span>&nbsp;<span class="op" id="1348909">&gt;</span>&nbsp;<span class="ident" id="1348911">nBytes</span>&nbsp;<span class="op" id="1348918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1348923">panic</span><span class="op" id="1348928">(</span><span class="string" id="1348929">&#34;bytes.Buffer.WriteTo:&nbsp;invalid&nbsp;Write&nbsp;count&#34;</span><span class="op" id="1348972">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1348976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348980">b</span><span class="op" id="1348981">.</span><span class="ident" id="1348982">off</span>&nbsp;<span class="op" id="1348986">+=</span>&nbsp;<span class="ident" id="1348989">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348993">n</span>&nbsp;<span class="op" id="1348995">=</span>&nbsp;<span class="ident" id="1348997">int64</span><span class="op" id="1349002">(</span><span class="ident" id="1349003">m</span><span class="op" id="1349004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349008">if</span>&nbsp;<span class="ident" id="1349011">e</span>&nbsp;<span class="op" id="1349013">!=</span>&nbsp;<span class="builtintype" id="1349016">nil</span>&nbsp;<span class="op" id="1349020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349025">return</span>&nbsp;<span class="ident" id="1349032">n</span><span class="op" id="1349033">,</span>&nbsp;<span class="ident" id="1349035">e</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1349039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1349043">//&nbsp;all&nbsp;bytes&nbsp;should&nbsp;have&nbsp;been&nbsp;written,&nbsp;by&nbsp;definition&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1349101">//&nbsp;Write&nbsp;method&nbsp;in&nbsp;io.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349132">if</span>&nbsp;<span class="ident" id="1349135">m</span>&nbsp;<span class="op" id="1349137">!=</span>&nbsp;<span class="ident" id="1349140">nBytes</span>&nbsp;<span class="op" id="1349147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349152">return</span>&nbsp;<span class="ident" id="1349159">n</span><span class="op" id="1349160">,</span>&nbsp;<span class="ident" id="1349162">io</span><span class="op" id="1349164">.</span><span class="ident" id="1349165">ErrShortWrite</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1349181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1349184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1349187">//&nbsp;Buffer&nbsp;is&nbsp;now&nbsp;empty;&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1349219">b</span><span class="op" id="1349220">.</span><span class="ident" id="1349221">Truncate</span><span class="op" id="1349229">(</span><span class="num" id="1349230">0</span><span class="op" id="1349231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349234">return</span><br>
<span class="lineno">220</span><span class="op" id="1349241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1349244">//&nbsp;WriteByte&nbsp;appends&nbsp;the&nbsp;byte&nbsp;c&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="comment" id="1349321">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;always&nbsp;nil,&nbsp;but&nbsp;is&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1349398">//&nbsp;WriteByte.&nbsp;If&nbsp;the&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteByte&nbsp;will&nbsp;panic&nbsp;with</span><br>
<span class="lineno">225</span><span class="comment" id="1349471">//&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1349487">func</span>&nbsp;<span class="op" id="1349492">(</span><span class="ident" id="1349493">b</span>&nbsp;<span class="op" id="1349495">*</span><span class="ident" id="1349496">Buffer</span><span class="op" id="1349502">)</span>&nbsp;<span class="ident" id="1349504">WriteByte</span><span class="op" id="1349513">(</span><span class="ident" id="1349514">c</span>&nbsp;<span class="builtintype" id="1349516">byte</span><span class="op" id="1349520">)</span>&nbsp;<span class="builtintype" id="1349522">error</span>&nbsp;<span class="op" id="1349528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1349531">b</span><span class="op" id="1349532">.</span><span class="ident" id="1349533">lastRead</span>&nbsp;<span class="op" id="1349542">=</span>&nbsp;<span class="ident" id="1349544">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1349555">m</span>&nbsp;<span class="op" id="1349557">:=</span>&nbsp;<span class="ident" id="1349560">b</span><span class="op" id="1349561">.</span><span class="ident" id="1349562">grow</span><span class="op" id="1349566">(</span><span class="num" id="1349567">1</span><span class="op" id="1349568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1349571">b</span><span class="op" id="1349572">.</span><span class="ident" id="1349573">buf</span><span class="op" id="1349576">[</span><span class="ident" id="1349577">m</span><span class="op" id="1349578">]</span>&nbsp;<span class="op" id="1349580">=</span>&nbsp;<span class="ident" id="1349582">c</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349585">return</span>&nbsp;<span class="builtintype" id="1349592">nil</span><br>
<span class="lineno"></span><span class="op" id="1349596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1349599">//&nbsp;WriteRune&nbsp;appends&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1349670">//&nbsp;buffer,&nbsp;returning&nbsp;its&nbsp;length&nbsp;and&nbsp;an&nbsp;error,&nbsp;which&nbsp;is&nbsp;always&nbsp;nil&nbsp;but&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="1349743">//&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s&nbsp;WriteRune.&nbsp;The&nbsp;buffer&nbsp;is&nbsp;grown&nbsp;as&nbsp;needed;</span><br>
<span class="lineno"></span><span class="comment" id="1349821">//&nbsp;if&nbsp;it&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteRune&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1349888">func</span>&nbsp;<span class="op" id="1349893">(</span><span class="ident" id="1349894">b</span>&nbsp;<span class="op" id="1349896">*</span><span class="ident" id="1349897">Buffer</span><span class="op" id="1349903">)</span>&nbsp;<span class="ident" id="1349905">WriteRune</span><span class="op" id="1349914">(</span><span class="ident" id="1349915">r</span>&nbsp;<span class="builtintype" id="1349917">rune</span><span class="op" id="1349921">)</span>&nbsp;<span class="op" id="1349923">(</span><span class="ident" id="1349924">n</span>&nbsp;<span class="builtintype" id="1349926">int</span><span class="op" id="1349929">,</span>&nbsp;<span class="ident" id="1349931">err</span>&nbsp;<span class="builtintype" id="1349935">error</span><span class="op" id="1349940">)</span>&nbsp;<span class="op" id="1349942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349945">if</span>&nbsp;<span class="ident" id="1349948">r</span>&nbsp;<span class="op" id="1349950">&lt;</span>&nbsp;<span class="ident" id="1349952">utf8</span><span class="op" id="1349956">.</span><span class="ident" id="1349957">RuneSelf</span>&nbsp;<span class="op" id="1349966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1349970">b</span><span class="op" id="1349971">.</span><span class="ident" id="1349972">WriteByte</span><span class="op" id="1349981">(</span><span class="builtintype" id="1349982">byte</span><span class="op" id="1349986">(</span><span class="ident" id="1349987">r</span><span class="op" id="1349988">)</span><span class="op" id="1349989">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349993">return</span>&nbsp;<span class="num" id="1350000">1</span><span class="op" id="1350001">,</span>&nbsp;<span class="builtintype" id="1350003">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1350008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350011">n</span>&nbsp;<span class="op" id="1350013">=</span>&nbsp;<span class="ident" id="1350015">utf8</span><span class="op" id="1350019">.</span><span class="ident" id="1350020">EncodeRune</span><span class="op" id="1350030">(</span><span class="ident" id="1350031">b</span><span class="op" id="1350032">.</span><span class="ident" id="1350033">runeBytes</span><span class="op" id="1350042">[</span><span class="num" id="1350043">0</span><span class="op" id="1350044">:</span><span class="op" id="1350045">]</span><span class="op" id="1350046">,</span>&nbsp;<span class="ident" id="1350048">r</span><span class="op" id="1350049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350052">b</span><span class="op" id="1350053">.</span><span class="ident" id="1350054">Write</span><span class="op" id="1350059">(</span><span class="ident" id="1350060">b</span><span class="op" id="1350061">.</span><span class="ident" id="1350062">runeBytes</span><span class="op" id="1350071">[</span><span class="num" id="1350072">0</span><span class="op" id="1350073">:</span><span class="ident" id="1350074">n</span><span class="op" id="1350075">]</span><span class="op" id="1350076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1350079">return</span>&nbsp;<span class="ident" id="1350086">n</span><span class="op" id="1350087">,</span>&nbsp;<span class="builtintype" id="1350089">nil</span><br>
<span class="lineno">245</span><span class="op" id="1350093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1350096">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;len(p)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer&nbsp;or&nbsp;until&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1350168">//&nbsp;is&nbsp;drained.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1350240">//&nbsp;buffer&nbsp;has&nbsp;no&nbsp;data&nbsp;to&nbsp;return,&nbsp;err&nbsp;is&nbsp;io.EOF&nbsp;(unless&nbsp;len(p)&nbsp;is&nbsp;zero);</span><br>
<span class="lineno">250</span><span class="comment" id="1350312">//&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="1350336">func</span>&nbsp;<span class="op" id="1350341">(</span><span class="ident" id="1350342">b</span>&nbsp;<span class="op" id="1350344">*</span><span class="ident" id="1350345">Buffer</span><span class="op" id="1350351">)</span>&nbsp;<span class="ident" id="1350353">Read</span><span class="op" id="1350357">(</span><span class="ident" id="1350358">p</span>&nbsp;<span class="op" id="1350360">[</span><span class="op" id="1350361">]</span><span class="builtintype" id="1350362">byte</span><span class="op" id="1350366">)</span>&nbsp;<span class="op" id="1350368">(</span><span class="ident" id="1350369">n</span>&nbsp;<span class="builtintype" id="1350371">int</span><span class="op" id="1350374">,</span>&nbsp;<span class="ident" id="1350376">err</span>&nbsp;<span class="builtintype" id="1350380">error</span><span class="op" id="1350385">)</span>&nbsp;<span class="op" id="1350387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350390">b</span><span class="op" id="1350391">.</span><span class="ident" id="1350392">lastRead</span>&nbsp;<span class="op" id="1350401">=</span>&nbsp;<span class="ident" id="1350403">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1350414">if</span>&nbsp;<span class="ident" id="1350417">b</span><span class="op" id="1350418">.</span><span class="ident" id="1350419">off</span>&nbsp;<span class="op" id="1350423">&gt;=</span>&nbsp;<span class="builtinfunc" id="1350426">len</span><span class="op" id="1350429">(</span><span class="ident" id="1350430">b</span><span class="op" id="1350431">.</span><span class="ident" id="1350432">buf</span><span class="op" id="1350435">)</span>&nbsp;<span class="op" id="1350437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1350441">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350487">b</span><span class="op" id="1350488">.</span><span class="ident" id="1350489">Truncate</span><span class="op" id="1350497">(</span><span class="num" id="1350498">0</span><span class="op" id="1350499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1350503">if</span>&nbsp;<span class="builtinfunc" id="1350506">len</span><span class="op" id="1350509">(</span><span class="ident" id="1350510">p</span><span class="op" id="1350511">)</span>&nbsp;<span class="op" id="1350513">==</span>&nbsp;<span class="num" id="1350516">0</span>&nbsp;<span class="op" id="1350518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1350523">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1350532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1350536">return</span>&nbsp;<span class="num" id="1350543">0</span><span class="op" id="1350544">,</span>&nbsp;<span class="ident" id="1350546">io</span><span class="op" id="1350548">.</span><span class="ident" id="1350549">EOF</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1350554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350557">n</span>&nbsp;<span class="op" id="1350559">=</span>&nbsp;<span class="builtinfunc" id="1350561">copy</span><span class="op" id="1350565">(</span><span class="ident" id="1350566">p</span><span class="op" id="1350567">,</span>&nbsp;<span class="ident" id="1350569">b</span><span class="op" id="1350570">.</span><span class="ident" id="1350571">buf</span><span class="op" id="1350574">[</span><span class="ident" id="1350575">b</span><span class="op" id="1350576">.</span><span class="ident" id="1350577">off</span><span class="op" id="1350580">:</span><span class="op" id="1350581">]</span><span class="op" id="1350582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350585">b</span><span class="op" id="1350586">.</span><span class="ident" id="1350587">off</span>&nbsp;<span class="op" id="1350591">+=</span>&nbsp;<span class="ident" id="1350594">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1350597">if</span>&nbsp;<span class="ident" id="1350600">n</span>&nbsp;<span class="op" id="1350602">&gt;</span>&nbsp;<span class="num" id="1350604">0</span>&nbsp;<span class="op" id="1350606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350610">b</span><span class="op" id="1350611">.</span><span class="ident" id="1350612">lastRead</span>&nbsp;<span class="op" id="1350621">=</span>&nbsp;<span class="ident" id="1350623">opRead</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1350631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1350634">return</span><br>
<span class="lineno"></span><span class="op" id="1350641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1350644">//&nbsp;Next&nbsp;returns&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer,</span><br>
<span class="lineno">270</span><span class="comment" id="1350713">//&nbsp;advancing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;if&nbsp;the&nbsp;bytes&nbsp;had&nbsp;been&nbsp;returned&nbsp;by&nbsp;Read.</span><br>
<span class="lineno"></span><span class="comment" id="1350780">//&nbsp;If&nbsp;there&nbsp;are&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;Next&nbsp;returns&nbsp;the&nbsp;entire&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1350862">//&nbsp;The&nbsp;slice&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;read&nbsp;or&nbsp;write&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="1350936">func</span>&nbsp;<span class="op" id="1350941">(</span><span class="ident" id="1350942">b</span>&nbsp;<span class="op" id="1350944">*</span><span class="ident" id="1350945">Buffer</span><span class="op" id="1350951">)</span>&nbsp;<span class="ident" id="1350953">Next</span><span class="op" id="1350957">(</span><span class="ident" id="1350958">n</span>&nbsp;<span class="builtintype" id="1350960">int</span><span class="op" id="1350963">)</span>&nbsp;<span class="op" id="1350965">[</span><span class="op" id="1350966">]</span><span class="builtintype" id="1350967">byte</span>&nbsp;<span class="op" id="1350972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350975">b</span><span class="op" id="1350976">.</span><span class="ident" id="1350977">lastRead</span>&nbsp;<span class="op" id="1350986">=</span>&nbsp;<span class="ident" id="1350988">opInvalid</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350999">m</span>&nbsp;<span class="op" id="1351001">:=</span>&nbsp;<span class="ident" id="1351004">b</span><span class="op" id="1351005">.</span><span class="ident" id="1351006">Len</span><span class="op" id="1351009">(</span><span class="op" id="1351010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351013">if</span>&nbsp;<span class="ident" id="1351016">n</span>&nbsp;<span class="op" id="1351018">&gt;</span>&nbsp;<span class="ident" id="1351020">m</span>&nbsp;<span class="op" id="1351022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351026">n</span>&nbsp;<span class="op" id="1351028">=</span>&nbsp;<span class="ident" id="1351030">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1351033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351036">data</span>&nbsp;<span class="op" id="1351041">:=</span>&nbsp;<span class="ident" id="1351044">b</span><span class="op" id="1351045">.</span><span class="ident" id="1351046">buf</span><span class="op" id="1351049">[</span><span class="ident" id="1351050">b</span><span class="op" id="1351051">.</span><span class="ident" id="1351052">off</span>&nbsp;<span class="op" id="1351056">:</span>&nbsp;<span class="ident" id="1351058">b</span><span class="op" id="1351059">.</span><span class="ident" id="1351060">off</span><span class="op" id="1351063">+</span><span class="ident" id="1351064">n</span><span class="op" id="1351065">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351068">b</span><span class="op" id="1351069">.</span><span class="ident" id="1351070">off</span>&nbsp;<span class="op" id="1351074">+=</span>&nbsp;<span class="ident" id="1351077">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351080">if</span>&nbsp;<span class="ident" id="1351083">n</span>&nbsp;<span class="op" id="1351085">&gt;</span>&nbsp;<span class="num" id="1351087">0</span>&nbsp;<span class="op" id="1351089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351093">b</span><span class="op" id="1351094">.</span><span class="ident" id="1351095">lastRead</span>&nbsp;<span class="op" id="1351104">=</span>&nbsp;<span class="ident" id="1351106">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1351114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351117">return</span>&nbsp;<span class="ident" id="1351124">data</span><br>
<span class="lineno">285</span><span class="op" id="1351129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1351132">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1351193">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;it&nbsp;returns&nbsp;error&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1351246">func</span>&nbsp;<span class="op" id="1351251">(</span><span class="ident" id="1351252">b</span>&nbsp;<span class="op" id="1351254">*</span><span class="ident" id="1351255">Buffer</span><span class="op" id="1351261">)</span>&nbsp;<span class="ident" id="1351263">ReadByte</span><span class="op" id="1351271">(</span><span class="op" id="1351272">)</span>&nbsp;<span class="op" id="1351274">(</span><span class="ident" id="1351275">c</span>&nbsp;<span class="builtintype" id="1351277">byte</span><span class="op" id="1351281">,</span>&nbsp;<span class="ident" id="1351283">err</span>&nbsp;<span class="builtintype" id="1351287">error</span><span class="op" id="1351292">)</span>&nbsp;<span class="op" id="1351294">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351297">b</span><span class="op" id="1351298">.</span><span class="ident" id="1351299">lastRead</span>&nbsp;<span class="op" id="1351308">=</span>&nbsp;<span class="ident" id="1351310">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351321">if</span>&nbsp;<span class="ident" id="1351324">b</span><span class="op" id="1351325">.</span><span class="ident" id="1351326">off</span>&nbsp;<span class="op" id="1351330">&gt;=</span>&nbsp;<span class="builtinfunc" id="1351333">len</span><span class="op" id="1351336">(</span><span class="ident" id="1351337">b</span><span class="op" id="1351338">.</span><span class="ident" id="1351339">buf</span><span class="op" id="1351342">)</span>&nbsp;<span class="op" id="1351344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351348">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351394">b</span><span class="op" id="1351395">.</span><span class="ident" id="1351396">Truncate</span><span class="op" id="1351404">(</span><span class="num" id="1351405">0</span><span class="op" id="1351406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351410">return</span>&nbsp;<span class="num" id="1351417">0</span><span class="op" id="1351418">,</span>&nbsp;<span class="ident" id="1351420">io</span><span class="op" id="1351422">.</span><span class="ident" id="1351423">EOF</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1351428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351431">c</span>&nbsp;<span class="op" id="1351433">=</span>&nbsp;<span class="ident" id="1351435">b</span><span class="op" id="1351436">.</span><span class="ident" id="1351437">buf</span><span class="op" id="1351440">[</span><span class="ident" id="1351441">b</span><span class="op" id="1351442">.</span><span class="ident" id="1351443">off</span><span class="op" id="1351446">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351449">b</span><span class="op" id="1351450">.</span><span class="ident" id="1351451">off</span><span class="op" id="1351454">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351458">b</span><span class="op" id="1351459">.</span><span class="ident" id="1351460">lastRead</span>&nbsp;<span class="op" id="1351469">=</span>&nbsp;<span class="ident" id="1351471">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351479">return</span>&nbsp;<span class="ident" id="1351486">c</span><span class="op" id="1351487">,</span>&nbsp;<span class="builtintype" id="1351489">nil</span><br>
<span class="lineno">300</span><span class="op" id="1351493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1351496">//&nbsp;ReadRune&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="1351549">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1351588">//&nbsp;If&nbsp;no&nbsp;bytes&nbsp;are&nbsp;available,&nbsp;the&nbsp;error&nbsp;returned&nbsp;is&nbsp;io.EOF.</span><br>
<span class="lineno">305</span><span class="comment" id="1351648">//&nbsp;If&nbsp;the&nbsp;bytes&nbsp;are&nbsp;an&nbsp;erroneous&nbsp;UTF-8&nbsp;encoding,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1351700">//&nbsp;consumes&nbsp;one&nbsp;byte&nbsp;and&nbsp;returns&nbsp;U+FFFD,&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="1351744">func</span>&nbsp;<span class="op" id="1351749">(</span><span class="ident" id="1351750">b</span>&nbsp;<span class="op" id="1351752">*</span><span class="ident" id="1351753">Buffer</span><span class="op" id="1351759">)</span>&nbsp;<span class="ident" id="1351761">ReadRune</span><span class="op" id="1351769">(</span><span class="op" id="1351770">)</span>&nbsp;<span class="op" id="1351772">(</span><span class="ident" id="1351773">r</span>&nbsp;<span class="builtintype" id="1351775">rune</span><span class="op" id="1351779">,</span>&nbsp;<span class="ident" id="1351781">size</span>&nbsp;<span class="builtintype" id="1351786">int</span><span class="op" id="1351789">,</span>&nbsp;<span class="ident" id="1351791">err</span>&nbsp;<span class="builtintype" id="1351795">error</span><span class="op" id="1351800">)</span>&nbsp;<span class="op" id="1351802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351805">b</span><span class="op" id="1351806">.</span><span class="ident" id="1351807">lastRead</span>&nbsp;<span class="op" id="1351816">=</span>&nbsp;<span class="ident" id="1351818">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351829">if</span>&nbsp;<span class="ident" id="1351832">b</span><span class="op" id="1351833">.</span><span class="ident" id="1351834">off</span>&nbsp;<span class="op" id="1351838">&gt;=</span>&nbsp;<span class="builtinfunc" id="1351841">len</span><span class="op" id="1351844">(</span><span class="ident" id="1351845">b</span><span class="op" id="1351846">.</span><span class="ident" id="1351847">buf</span><span class="op" id="1351850">)</span>&nbsp;<span class="op" id="1351852">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351856">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351902">b</span><span class="op" id="1351903">.</span><span class="ident" id="1351904">Truncate</span><span class="op" id="1351912">(</span><span class="num" id="1351913">0</span><span class="op" id="1351914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351918">return</span>&nbsp;<span class="num" id="1351925">0</span><span class="op" id="1351926">,</span>&nbsp;<span class="num" id="1351928">0</span><span class="op" id="1351929">,</span>&nbsp;<span class="ident" id="1351931">io</span><span class="op" id="1351933">.</span><span class="ident" id="1351934">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1351939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351942">b</span><span class="op" id="1351943">.</span><span class="ident" id="1351944">lastRead</span>&nbsp;<span class="op" id="1351953">=</span>&nbsp;<span class="ident" id="1351955">opReadRune</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351967">c</span>&nbsp;<span class="op" id="1351969">:=</span>&nbsp;<span class="ident" id="1351972">b</span><span class="op" id="1351973">.</span><span class="ident" id="1351974">buf</span><span class="op" id="1351977">[</span><span class="ident" id="1351978">b</span><span class="op" id="1351979">.</span><span class="ident" id="1351980">off</span><span class="op" id="1351983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351986">if</span>&nbsp;<span class="ident" id="1351989">c</span>&nbsp;<span class="op" id="1351991">&lt;</span>&nbsp;<span class="ident" id="1351993">utf8</span><span class="op" id="1351997">.</span><span class="ident" id="1351998">RuneSelf</span>&nbsp;<span class="op" id="1352007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1352011">b</span><span class="op" id="1352012">.</span><span class="ident" id="1352013">off</span><span class="op" id="1352016">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1352021">return</span>&nbsp;<span class="builtintype" id="1352028">rune</span><span class="op" id="1352032">(</span><span class="ident" id="1352033">c</span><span class="op" id="1352034">)</span><span class="op" id="1352035">,</span>&nbsp;<span class="num" id="1352037">1</span><span class="op" id="1352038">,</span>&nbsp;<span class="builtintype" id="1352040">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1352045">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1352048">r</span><span class="op" id="1352049">,</span>&nbsp;<span class="ident" id="1352051">n</span>&nbsp;<span class="op" id="1352053">:=</span>&nbsp;<span class="ident" id="1352056">utf8</span><span class="op" id="1352060">.</span><span class="ident" id="1352061">DecodeRune</span><span class="op" id="1352071">(</span><span class="ident" id="1352072">b</span><span class="op" id="1352073">.</span><span class="ident" id="1352074">buf</span><span class="op" id="1352077">[</span><span class="ident" id="1352078">b</span><span class="op" id="1352079">.</span><span class="ident" id="1352080">off</span><span class="op" id="1352083">:</span><span class="op" id="1352084">]</span><span class="op" id="1352085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1352088">b</span><span class="op" id="1352089">.</span><span class="ident" id="1352090">off</span>&nbsp;<span class="op" id="1352094">+=</span>&nbsp;<span class="ident" id="1352097">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1352100">return</span>&nbsp;<span class="ident" id="1352107">r</span><span class="op" id="1352108">,</span>&nbsp;<span class="ident" id="1352110">n</span><span class="op" id="1352111">,</span>&nbsp;<span class="builtintype" id="1352113">nil</span><br>
<span class="lineno"></span><span class="op" id="1352117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="1352120">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune&nbsp;returned&nbsp;by&nbsp;ReadRune.</span><br>
<span class="lineno"></span><span class="comment" id="1352178">//&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;or&nbsp;write&nbsp;operation&nbsp;on&nbsp;the&nbsp;buffer&nbsp;was</span><br>
<span class="lineno"></span><span class="comment" id="1352242">//&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this&nbsp;regard</span><br>
<span class="lineno"></span><span class="comment" id="1352307">//&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="1352374">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno">330</span><span class="keyword" id="1352403">func</span>&nbsp;<span class="op" id="1352408">(</span><span class="ident" id="1352409">b</span>&nbsp;<span class="op" id="1352411">*</span><span class="ident" id="1352412">Buffer</span><span class="op" id="1352418">)</span>&nbsp;<span class="ident" id="1352420">UnreadRune</span><span class="op" id="1352430">(</span><span class="op" id="1352431">)</span>&nbsp;<span class="builtintype" id="1352433">error</span>&nbsp;<span class="op" id="1352439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1352442">if</span>&nbsp;<span class="ident" id="1352445">b</span><span class="op" id="1352446">.</span><span class="ident" id="1352447">lastRead</span>&nbsp;<span class="op" id="1352456">!=</span>&nbsp;<span class="ident" id="1352459">opReadRune</span>&nbsp;<span class="op" id="1352470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1352474">return</span>&nbsp;<span class="ident" id="1352481">errors</span><span class="op" id="1352487">.</span><span class="ident" id="1352488">New</span><span class="op" id="1352491">(</span><span class="string" id="1352492">&#34;bytes.Buffer:&nbsp;UnreadRune:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;ReadRune&#34;</span><span class="op" id="1352555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1352558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1352561">b</span><span class="op" id="1352562">.</span><span class="ident" id="1352563">lastRead</span>&nbsp;<span class="op" id="1352572">=</span>&nbsp;<span class="ident" id="1352574">opInvalid</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1352585">if</span>&nbsp;<span class="ident" id="1352588">b</span><span class="op" id="1352589">.</span><span class="ident" id="1352590">off</span>&nbsp;<span class="op" id="1352594">&gt;</span>&nbsp;<span class="num" id="1352596">0</span>&nbsp;<span class="op" id="1352598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1352602">_</span><span class="op" id="1352603">,</span>&nbsp;<span class="ident" id="1352605">n</span>&nbsp;<span class="op" id="1352607">:=</span>&nbsp;<span class="ident" id="1352610">utf8</span><span class="op" id="1352614">.</span><span class="ident" id="1352615">DecodeLastRune</span><span class="op" id="1352629">(</span><span class="ident" id="1352630">b</span><span class="op" id="1352631">.</span><span class="ident" id="1352632">buf</span><span class="op" id="1352635">[</span><span class="num" id="1352636">0</span><span class="op" id="1352637">:</span><span class="ident" id="1352638">b</span><span class="op" id="1352639">.</span><span class="ident" id="1352640">off</span><span class="op" id="1352643">]</span><span class="op" id="1352644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1352648">b</span><span class="op" id="1352649">.</span><span class="ident" id="1352650">off</span>&nbsp;<span class="op" id="1352654">-=</span>&nbsp;<span class="ident" id="1352657">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1352660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1352663">return</span>&nbsp;<span class="builtintype" id="1352670">nil</span><br>
<span class="lineno">340</span><span class="op" id="1352674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1352677">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte&nbsp;returned&nbsp;by&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span><span class="comment" id="1352741">//&nbsp;read&nbsp;operation.&nbsp;&nbsp;If&nbsp;write&nbsp;has&nbsp;happened&nbsp;since&nbsp;the&nbsp;last&nbsp;read,&nbsp;UnreadByte</span><br>
<span class="lineno"></span><span class="comment" id="1352815">//&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">345</span><span class="keyword" id="1352836">func</span>&nbsp;<span class="op" id="1352841">(</span><span class="ident" id="1352842">b</span>&nbsp;<span class="op" id="1352844">*</span><span class="ident" id="1352845">Buffer</span><span class="op" id="1352851">)</span>&nbsp;<span class="ident" id="1352853">UnreadByte</span><span class="op" id="1352863">(</span><span class="op" id="1352864">)</span>&nbsp;<span class="builtintype" id="1352866">error</span>&nbsp;<span class="op" id="1352872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1352875">if</span>&nbsp;<span class="ident" id="1352878">b</span><span class="op" id="1352879">.</span><span class="ident" id="1352880">lastRead</span>&nbsp;<span class="op" id="1352889">!=</span>&nbsp;<span class="ident" id="1352892">opReadRune</span>&nbsp;<span class="op" id="1352903">&amp;&amp;</span>&nbsp;<span class="ident" id="1352906">b</span><span class="op" id="1352907">.</span><span class="ident" id="1352908">lastRead</span>&nbsp;<span class="op" id="1352917">!=</span>&nbsp;<span class="ident" id="1352920">opRead</span>&nbsp;<span class="op" id="1352927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1352931">return</span>&nbsp;<span class="ident" id="1352938">errors</span><span class="op" id="1352944">.</span><span class="ident" id="1352945">New</span><span class="op" id="1352948">(</span><span class="string" id="1352949">&#34;bytes.Buffer:&nbsp;UnreadByte:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;a&nbsp;read&#34;</span><span class="op" id="1353010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1353013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1353016">b</span><span class="op" id="1353017">.</span><span class="ident" id="1353018">lastRead</span>&nbsp;<span class="op" id="1353027">=</span>&nbsp;<span class="ident" id="1353029">opInvalid</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1353040">if</span>&nbsp;<span class="ident" id="1353043">b</span><span class="op" id="1353044">.</span><span class="ident" id="1353045">off</span>&nbsp;<span class="op" id="1353049">&gt;</span>&nbsp;<span class="num" id="1353051">0</span>&nbsp;<span class="op" id="1353053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1353057">b</span><span class="op" id="1353058">.</span><span class="ident" id="1353059">off</span><span class="op" id="1353062">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1353066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1353069">return</span>&nbsp;<span class="builtintype" id="1353076">nil</span><br>
<span class="lineno"></span><span class="op" id="1353080">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="1353083">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="1353152">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1353228">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1353292">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">360</span><span class="comment" id="1353374">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1353455">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="keyword" id="1353465">func</span>&nbsp;<span class="op" id="1353470">(</span><span class="ident" id="1353471">b</span>&nbsp;<span class="op" id="1353473">*</span><span class="ident" id="1353474">Buffer</span><span class="op" id="1353480">)</span>&nbsp;<span class="ident" id="1353482">ReadBytes</span><span class="op" id="1353491">(</span><span class="ident" id="1353492">delim</span>&nbsp;<span class="builtintype" id="1353498">byte</span><span class="op" id="1353502">)</span>&nbsp;<span class="op" id="1353504">(</span><span class="ident" id="1353505">line</span>&nbsp;<span class="op" id="1353510">[</span><span class="op" id="1353511">]</span><span class="builtintype" id="1353512">byte</span><span class="op" id="1353516">,</span>&nbsp;<span class="ident" id="1353518">err</span>&nbsp;<span class="builtintype" id="1353522">error</span><span class="op" id="1353527">)</span>&nbsp;<span class="op" id="1353529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1353532">slice</span><span class="op" id="1353537">,</span>&nbsp;<span class="ident" id="1353539">err</span>&nbsp;<span class="op" id="1353543">:=</span>&nbsp;<span class="ident" id="1353546">b</span><span class="op" id="1353547">.</span><span class="ident" id="1353548">readSlice</span><span class="op" id="1353557">(</span><span class="ident" id="1353558">delim</span><span class="op" id="1353563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1353566">//&nbsp;return&nbsp;a&nbsp;copy&nbsp;of&nbsp;slice.&nbsp;The&nbsp;buffer&#39;s&nbsp;backing&nbsp;array&nbsp;may</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1353625">//&nbsp;be&nbsp;overwritten&nbsp;by&nbsp;later&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1353660">line</span>&nbsp;<span class="op" id="1353665">=</span>&nbsp;<span class="builtinfunc" id="1353667">append</span><span class="op" id="1353673">(</span><span class="ident" id="1353674">line</span><span class="op" id="1353678">,</span>&nbsp;<span class="ident" id="1353680">slice</span><span class="op" id="1353685">...</span><span class="op" id="1353688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1353691">return</span><br>
<span class="lineno"></span><span class="op" id="1353698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="comment" id="1353701">//&nbsp;readSlice&nbsp;is&nbsp;like&nbsp;ReadBytes&nbsp;but&nbsp;returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;internal&nbsp;buffer&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1353781">func</span>&nbsp;<span class="op" id="1353786">(</span><span class="ident" id="1353787">b</span>&nbsp;<span class="op" id="1353789">*</span><span class="ident" id="1353790">Buffer</span><span class="op" id="1353796">)</span>&nbsp;<span class="ident" id="1353798">readSlice</span><span class="op" id="1353807">(</span><span class="ident" id="1353808">delim</span>&nbsp;<span class="builtintype" id="1353814">byte</span><span class="op" id="1353818">)</span>&nbsp;<span class="op" id="1353820">(</span><span class="ident" id="1353821">line</span>&nbsp;<span class="op" id="1353826">[</span><span class="op" id="1353827">]</span><span class="builtintype" id="1353828">byte</span><span class="op" id="1353832">,</span>&nbsp;<span class="ident" id="1353834">err</span>&nbsp;<span class="builtintype" id="1353838">error</span><span class="op" id="1353843">)</span>&nbsp;<span class="op" id="1353845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1353848">i</span>&nbsp;<span class="op" id="1353850">:=</span>&nbsp;<span class="ident" id="1353853">IndexByte</span><span class="op" id="1353862">(</span><span class="ident" id="1353863">b</span><span class="op" id="1353864">.</span><span class="ident" id="1353865">buf</span><span class="op" id="1353868">[</span><span class="ident" id="1353869">b</span><span class="op" id="1353870">.</span><span class="ident" id="1353871">off</span><span class="op" id="1353874">:</span><span class="op" id="1353875">]</span><span class="op" id="1353876">,</span>&nbsp;<span class="ident" id="1353878">delim</span><span class="op" id="1353883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1353886">end</span>&nbsp;<span class="op" id="1353890">:=</span>&nbsp;<span class="ident" id="1353893">b</span><span class="op" id="1353894">.</span><span class="ident" id="1353895">off</span>&nbsp;<span class="op" id="1353899">+</span>&nbsp;<span class="ident" id="1353901">i</span>&nbsp;<span class="op" id="1353903">+</span>&nbsp;<span class="num" id="1353905">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1353908">if</span>&nbsp;<span class="ident" id="1353911">i</span>&nbsp;<span class="op" id="1353913">&lt;</span>&nbsp;<span class="num" id="1353915">0</span>&nbsp;<span class="op" id="1353917">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1353921">end</span>&nbsp;<span class="op" id="1353925">=</span>&nbsp;<span class="builtinfunc" id="1353927">len</span><span class="op" id="1353930">(</span><span class="ident" id="1353931">b</span><span class="op" id="1353932">.</span><span class="ident" id="1353933">buf</span><span class="op" id="1353936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1353940">err</span>&nbsp;<span class="op" id="1353944">=</span>&nbsp;<span class="ident" id="1353946">io</span><span class="op" id="1353948">.</span><span class="ident" id="1353949">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1353954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1353957">line</span>&nbsp;<span class="op" id="1353962">=</span>&nbsp;<span class="ident" id="1353964">b</span><span class="op" id="1353965">.</span><span class="ident" id="1353966">buf</span><span class="op" id="1353969">[</span><span class="ident" id="1353970">b</span><span class="op" id="1353971">.</span><span class="ident" id="1353972">off</span><span class="op" id="1353975">:</span><span class="ident" id="1353976">end</span><span class="op" id="1353979">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1353982">b</span><span class="op" id="1353983">.</span><span class="ident" id="1353984">off</span>&nbsp;<span class="op" id="1353988">=</span>&nbsp;<span class="ident" id="1353990">end</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1353995">b</span><span class="op" id="1353996">.</span><span class="ident" id="1353997">lastRead</span>&nbsp;<span class="op" id="1354006">=</span>&nbsp;<span class="ident" id="1354008">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1354016">return</span>&nbsp;<span class="ident" id="1354023">line</span><span class="op" id="1354027">,</span>&nbsp;<span class="ident" id="1354029">err</span><br>
<span class="lineno"></span><span class="op" id="1354033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1354036">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno">385</span><span class="comment" id="1354106">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1354183">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1354248">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="1354330">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="1354409">//&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">390</span><span class="keyword" id="1354422">func</span>&nbsp;<span class="op" id="1354427">(</span><span class="ident" id="1354428">b</span>&nbsp;<span class="op" id="1354430">*</span><span class="ident" id="1354431">Buffer</span><span class="op" id="1354437">)</span>&nbsp;<span class="ident" id="1354439">ReadString</span><span class="op" id="1354449">(</span><span class="ident" id="1354450">delim</span>&nbsp;<span class="builtintype" id="1354456">byte</span><span class="op" id="1354460">)</span>&nbsp;<span class="op" id="1354462">(</span><span class="ident" id="1354463">line</span>&nbsp;<span class="builtintype" id="1354468">string</span><span class="op" id="1354474">,</span>&nbsp;<span class="ident" id="1354476">err</span>&nbsp;<span class="builtintype" id="1354480">error</span><span class="op" id="1354485">)</span>&nbsp;<span class="op" id="1354487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1354490">slice</span><span class="op" id="1354495">,</span>&nbsp;<span class="ident" id="1354497">err</span>&nbsp;<span class="op" id="1354501">:=</span>&nbsp;<span class="ident" id="1354504">b</span><span class="op" id="1354505">.</span><span class="ident" id="1354506">readSlice</span><span class="op" id="1354515">(</span><span class="ident" id="1354516">delim</span><span class="op" id="1354521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1354524">return</span>&nbsp;<span class="builtintype" id="1354531">string</span><span class="op" id="1354537">(</span><span class="ident" id="1354538">slice</span><span class="op" id="1354543">)</span><span class="op" id="1354544">,</span>&nbsp;<span class="ident" id="1354546">err</span><br>
<span class="lineno"></span><span class="op" id="1354550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="comment" id="1354553">//&nbsp;NewBuffer&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;buf&nbsp;as&nbsp;its&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="1354628">//&nbsp;contents.&nbsp;&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;Buffer&nbsp;to&nbsp;read&nbsp;existing&nbsp;data.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="1354704">//&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;size&nbsp;the&nbsp;internal&nbsp;buffer&nbsp;for&nbsp;writing.&nbsp;To&nbsp;do&nbsp;that,</span><br>
<span class="lineno"></span><span class="comment" id="1354777">//&nbsp;buf&nbsp;should&nbsp;have&nbsp;the&nbsp;desired&nbsp;capacity&nbsp;but&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="1354839">//</span><br>
<span class="lineno">400</span><span class="comment" id="1354842">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1354913">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1354951">func</span>&nbsp;<span class="ident" id="1354956">NewBuffer</span><span class="op" id="1354965">(</span><span class="ident" id="1354966">buf</span>&nbsp;<span class="op" id="1354970">[</span><span class="op" id="1354971">]</span><span class="builtintype" id="1354972">byte</span><span class="op" id="1354976">)</span>&nbsp;<span class="op" id="1354978">*</span><span class="ident" id="1354979">Buffer</span>&nbsp;<span class="op" id="1354986">{</span>&nbsp;<span class="keyword" id="1354988">return</span>&nbsp;<span class="op" id="1354995">&amp;</span><span class="ident" id="1354996">Buffer</span><span class="op" id="1355002">{</span><span class="ident" id="1355003">buf</span><span class="op" id="1355006">:</span>&nbsp;<span class="ident" id="1355008">buf</span><span class="op" id="1355011">}</span>&nbsp;<span class="op" id="1355013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1355016">//&nbsp;NewBufferString&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;string&nbsp;s&nbsp;as&nbsp;its</span><br>
<span class="lineno">405</span><span class="comment" id="1355094">//&nbsp;initial&nbsp;contents.&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;buffer&nbsp;to&nbsp;read&nbsp;an&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="1355170">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1355181">//</span><br>
<span class="lineno"></span><span class="comment" id="1355184">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1355255">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno">410</span><span class="keyword" id="1355293">func</span>&nbsp;<span class="ident" id="1355298">NewBufferString</span><span class="op" id="1355313">(</span><span class="ident" id="1355314">s</span>&nbsp;<span class="builtintype" id="1355316">string</span><span class="op" id="1355322">)</span>&nbsp;<span class="op" id="1355324">*</span><span class="ident" id="1355325">Buffer</span>&nbsp;<span class="op" id="1355332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1355335">return</span>&nbsp;<span class="op" id="1355342">&amp;</span><span class="ident" id="1355343">Buffer</span><span class="op" id="1355349">{</span><span class="ident" id="1355350">buf</span><span class="op" id="1355353">:</span>&nbsp;<span class="op" id="1355355">[</span><span class="op" id="1355356">]</span><span class="builtintype" id="1355357">byte</span><span class="op" id="1355361">(</span><span class="ident" id="1355362">s</span><span class="op" id="1355363">)</span><span class="op" id="1355364">}</span><br>
<span class="lineno"></span><span class="op" id="1355366">}</span>
</div>
</body>
</html>
