<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/tabwriter</h2>
<ul>
<li><a href="/gostd/text/tabwriter/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter.go.html" class="current">tabwriter.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter_test.go.html">tabwriter_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5079111">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5079166">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5079220">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5079271">//&nbsp;Package&nbsp;tabwriter&nbsp;implements&nbsp;a&nbsp;write&nbsp;filter&nbsp;(tabwriter.Writer)&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5079342">//&nbsp;translates&nbsp;tabbed&nbsp;columns&nbsp;in&nbsp;input&nbsp;into&nbsp;properly&nbsp;aligned&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="5079408">//</span><br>
<span class="lineno"></span><span class="comment" id="5079411">//&nbsp;The&nbsp;package&nbsp;is&nbsp;using&nbsp;the&nbsp;Elastic&nbsp;Tabstops&nbsp;algorithm&nbsp;described&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5079479">//&nbsp;http://nickgravgaard.com/elastictabstops/index.html.</span><br>
<span class="lineno">10</span><span class="comment" id="5079535">//</span><br>
<span class="lineno"></span><span class="keyword" id="5079538">package</span>&nbsp;<span class="ident" id="5079546">tabwriter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5079557">import</span>&nbsp;<span class="op" id="5079564">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5079567">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5079576">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5079582">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5079597">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5079600">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">20</span><span class="comment" id="5079680">//&nbsp;Filter&nbsp;implementation</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5079706">//&nbsp;A&nbsp;cell&nbsp;represents&nbsp;a&nbsp;segment&nbsp;of&nbsp;text&nbsp;terminated&nbsp;by&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks.</span><br>
<span class="lineno"></span><span class="comment" id="5079780">//&nbsp;The&nbsp;text&nbsp;itself&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;separate&nbsp;buffer;&nbsp;cell&nbsp;only&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5079855">//&nbsp;segment&#39;s&nbsp;size&nbsp;in&nbsp;bytes,&nbsp;its&nbsp;width&nbsp;in&nbsp;runes,&nbsp;and&nbsp;whether&nbsp;it&#39;s&nbsp;an&nbsp;htab</span><br>
<span class="lineno">25</span><span class="comment" id="5079928">//&nbsp;(&#39;\t&#39;)&nbsp;terminated&nbsp;cell.</span><br>
<span class="lineno"></span><span class="comment" id="5079955">//</span><br>
<span class="lineno"></span><span class="keyword" id="5079958">type</span>&nbsp;<span class="ident" id="5079963">cell</span>&nbsp;<span class="keyword" id="5079968">struct</span>&nbsp;<span class="op" id="5079975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079978">size</span>&nbsp;&nbsp;<span class="builtintype" id="5079984">int</span>&nbsp;&nbsp;<span class="comment" id="5079989">//&nbsp;cell&nbsp;size&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080012">width</span>&nbsp;<span class="builtintype" id="5080018">int</span>&nbsp;&nbsp;<span class="comment" id="5080023">//&nbsp;cell&nbsp;width&nbsp;in&nbsp;runes</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080047">htab</span>&nbsp;&nbsp;<span class="builtintype" id="5080053">bool</span>&nbsp;<span class="comment" id="5080058">//&nbsp;true&nbsp;if&nbsp;the&nbsp;cell&nbsp;is&nbsp;terminated&nbsp;by&nbsp;an&nbsp;htab&nbsp;(&#39;\t&#39;)</span><br>
<span class="lineno"></span><span class="op" id="5080110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5080113">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;filter&nbsp;that&nbsp;inserts&nbsp;padding&nbsp;around&nbsp;tab-delimited</span><br>
<span class="lineno"></span><span class="comment" id="5080179">//&nbsp;columns&nbsp;in&nbsp;its&nbsp;input&nbsp;to&nbsp;align&nbsp;them&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno">35</span><span class="comment" id="5080232">//</span><br>
<span class="lineno"></span><span class="comment" id="5080235">//&nbsp;The&nbsp;Writer&nbsp;treats&nbsp;incoming&nbsp;bytes&nbsp;as&nbsp;UTF-8&nbsp;encoded&nbsp;text&nbsp;consisting</span><br>
<span class="lineno"></span><span class="comment" id="5080304">//&nbsp;of&nbsp;cells&nbsp;terminated&nbsp;by&nbsp;(horizontal&nbsp;or&nbsp;vertical)&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5080368">//&nbsp;breaks&nbsp;(newline&nbsp;or&nbsp;formfeed&nbsp;characters).&nbsp;Cells&nbsp;in&nbsp;adjacent&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="5080436">//&nbsp;constitute&nbsp;a&nbsp;column.&nbsp;The&nbsp;Writer&nbsp;inserts&nbsp;padding&nbsp;as&nbsp;needed&nbsp;to</span><br>
<span class="lineno">40</span><span class="comment" id="5080500">//&nbsp;make&nbsp;all&nbsp;cells&nbsp;in&nbsp;a&nbsp;column&nbsp;have&nbsp;the&nbsp;same&nbsp;width,&nbsp;effectively</span><br>
<span class="lineno"></span><span class="comment" id="5080563">//&nbsp;aligning&nbsp;the&nbsp;columns.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;all&nbsp;characters&nbsp;have&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5080628">//&nbsp;same&nbsp;width&nbsp;except&nbsp;for&nbsp;tabs&nbsp;for&nbsp;which&nbsp;a&nbsp;tabwidth&nbsp;must&nbsp;be&nbsp;specified.</span><br>
<span class="lineno"></span><span class="comment" id="5080698">//&nbsp;Note&nbsp;that&nbsp;cells&nbsp;are&nbsp;tab-terminated,&nbsp;not&nbsp;tab-separated:&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="5080765">//&nbsp;non-tab&nbsp;text&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;does&nbsp;not&nbsp;form&nbsp;a&nbsp;column&nbsp;cell.</span><br>
<span class="lineno">45</span><span class="comment" id="5080831">//</span><br>
<span class="lineno"></span><span class="comment" id="5080834">//&nbsp;The&nbsp;Writer&nbsp;assumes&nbsp;that&nbsp;all&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;have&nbsp;the&nbsp;same&nbsp;width;</span><br>
<span class="lineno"></span><span class="comment" id="5080906">//&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;true&nbsp;in&nbsp;some&nbsp;fonts.</span><br>
<span class="lineno"></span><span class="comment" id="5080945">//</span><br>
<span class="lineno"></span><span class="comment" id="5080948">//&nbsp;If&nbsp;DiscardEmptyColumns&nbsp;is&nbsp;set,&nbsp;empty&nbsp;columns&nbsp;that&nbsp;are&nbsp;terminated</span><br>
<span class="lineno">50</span><span class="comment" id="5081016">//&nbsp;entirely&nbsp;by&nbsp;vertical&nbsp;(or&nbsp;&#34;soft&#34;)&nbsp;tabs&nbsp;are&nbsp;discarded.&nbsp;Columns</span><br>
<span class="lineno"></span><span class="comment" id="5081080">//&nbsp;terminated&nbsp;by&nbsp;horizontal&nbsp;(or&nbsp;&#34;hard&#34;)&nbsp;tabs&nbsp;are&nbsp;not&nbsp;affected&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5081145">//&nbsp;this&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="5081159">//</span><br>
<span class="lineno"></span><span class="comment" id="5081162">//&nbsp;If&nbsp;a&nbsp;Writer&nbsp;is&nbsp;configured&nbsp;to&nbsp;filter&nbsp;HTML,&nbsp;HTML&nbsp;tags&nbsp;and&nbsp;entities</span><br>
<span class="lineno">55</span><span class="comment" id="5081230">//&nbsp;are&nbsp;passed&nbsp;through.&nbsp;The&nbsp;widths&nbsp;of&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5081289">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;(tags)&nbsp;and&nbsp;one&nbsp;(entities)&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="5081362">//</span><br>
<span class="lineno"></span><span class="comment" id="5081365">//&nbsp;A&nbsp;segment&nbsp;of&nbsp;text&nbsp;may&nbsp;be&nbsp;escaped&nbsp;by&nbsp;bracketing&nbsp;it&nbsp;with&nbsp;Escape</span><br>
<span class="lineno"></span><span class="comment" id="5081430">//&nbsp;characters.&nbsp;The&nbsp;tabwriter&nbsp;passes&nbsp;escaped&nbsp;text&nbsp;segments&nbsp;through</span><br>
<span class="lineno">60</span><span class="comment" id="5081496">//&nbsp;unchanged.&nbsp;In&nbsp;particular,&nbsp;it&nbsp;does&nbsp;not&nbsp;interpret&nbsp;any&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5081564">//&nbsp;breaks&nbsp;within&nbsp;the&nbsp;segment.&nbsp;If&nbsp;the&nbsp;StripEscape&nbsp;flag&nbsp;is&nbsp;set,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5081630">//&nbsp;Escape&nbsp;characters&nbsp;are&nbsp;stripped&nbsp;from&nbsp;the&nbsp;output;&nbsp;otherwise&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="5081696">//&nbsp;are&nbsp;passed&nbsp;through&nbsp;as&nbsp;well.&nbsp;For&nbsp;the&nbsp;purpose&nbsp;of&nbsp;formatting,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5081762">//&nbsp;width&nbsp;of&nbsp;the&nbsp;escaped&nbsp;text&nbsp;is&nbsp;always&nbsp;computed&nbsp;excluding&nbsp;the&nbsp;Escape</span><br>
<span class="lineno">65</span><span class="comment" id="5081831">//&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="5081846">//</span><br>
<span class="lineno"></span><span class="comment" id="5081849">//&nbsp;The&nbsp;formfeed&nbsp;character&nbsp;(&#39;\f&#39;)&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline&nbsp;but&nbsp;it&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="5081914">//&nbsp;terminates&nbsp;all&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;line&nbsp;(effectively&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="5081981">//&nbsp;Flush).&nbsp;Cells&nbsp;in&nbsp;the&nbsp;next&nbsp;line&nbsp;start&nbsp;new&nbsp;columns.&nbsp;Unless&nbsp;found</span><br>
<span class="lineno">70</span><span class="comment" id="5082047">//&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;tag&nbsp;or&nbsp;inside&nbsp;an&nbsp;escaped&nbsp;text&nbsp;segment,&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="5082113">//&nbsp;characters&nbsp;appear&nbsp;as&nbsp;newlines&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5082161">//</span><br>
<span class="lineno"></span><span class="comment" id="5082164">//&nbsp;The&nbsp;Writer&nbsp;must&nbsp;buffer&nbsp;input&nbsp;internally,&nbsp;because&nbsp;proper&nbsp;spacing</span><br>
<span class="lineno"></span><span class="comment" id="5082231">//&nbsp;of&nbsp;one&nbsp;line&nbsp;may&nbsp;depend&nbsp;on&nbsp;the&nbsp;cells&nbsp;in&nbsp;future&nbsp;lines.&nbsp;Clients&nbsp;must</span><br>
<span class="lineno">75</span><span class="comment" id="5082300">//&nbsp;call&nbsp;Flush&nbsp;when&nbsp;done&nbsp;calling&nbsp;Write.</span><br>
<span class="lineno"></span><span class="comment" id="5082339">//</span><br>
<span class="lineno"></span><span class="keyword" id="5082342">type</span>&nbsp;<span class="ident" id="5082347">Writer</span>&nbsp;<span class="keyword" id="5082354">struct</span>&nbsp;<span class="op" id="5082361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5082364">//&nbsp;configuration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082382">output</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5082391">io</span><span class="op" id="5082393">.</span><span class="ident" id="5082394">Writer</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082402">minwidth</span>&nbsp;<span class="builtintype" id="5082411">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082416">tabwidth</span>&nbsp;<span class="builtintype" id="5082425">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082430">padding</span>&nbsp;&nbsp;<span class="builtintype" id="5082439">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082444">padbytes</span>&nbsp;<span class="op" id="5082453">[</span><span class="num" id="5082454">8</span><span class="op" id="5082455">]</span><span class="builtintype" id="5082456">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082462">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5082471">uint</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5082478">//&nbsp;current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082496">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082504">bytes</span><span class="op" id="5082509">.</span><span class="ident" id="5082510">Buffer</span>&nbsp;<span class="comment" id="5082517">//&nbsp;collected&nbsp;text&nbsp;excluding&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082566">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5082574">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082587">//&nbsp;buffer&nbsp;position&nbsp;up&nbsp;to&nbsp;which&nbsp;cell.width&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;has&nbsp;been&nbsp;computed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082667">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082675">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082688">//&nbsp;current&nbsp;incomplete&nbsp;cell;&nbsp;cell.width&nbsp;is&nbsp;up&nbsp;to&nbsp;buf[pos]&nbsp;excluding&nbsp;ignored&nbsp;sections</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082773">endChar</span>&nbsp;<span class="builtintype" id="5082781">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082794">//&nbsp;terminating&nbsp;char&nbsp;of&nbsp;escaped&nbsp;sequence&nbsp;(Escape&nbsp;for&nbsp;escapes,&nbsp;&#39;&gt;&#39;,&nbsp;&#39;;&#39;&nbsp;for&nbsp;HTML&nbsp;tags/entities,&nbsp;or&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082895">lines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5082903">[</span><span class="op" id="5082904">]</span><span class="op" id="5082905">[</span><span class="op" id="5082906">]</span><span class="ident" id="5082907">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082916">//&nbsp;list&nbsp;of&nbsp;lines;&nbsp;each&nbsp;line&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082964">widths</span>&nbsp;&nbsp;<span class="op" id="5082972">[</span><span class="op" id="5082973">]</span><span class="builtintype" id="5082974">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082985">//&nbsp;list&nbsp;of&nbsp;column&nbsp;widths&nbsp;in&nbsp;runes&nbsp;-&nbsp;re-used&nbsp;during&nbsp;formatting</span><br>
<span class="lineno"></span><span class="op" id="5083047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5083050">func</span>&nbsp;<span class="op" id="5083055">(</span><span class="ident" id="5083056">b</span>&nbsp;<span class="op" id="5083058">*</span><span class="ident" id="5083059">Writer</span><span class="op" id="5083065">)</span>&nbsp;<span class="ident" id="5083067">addLine</span><span class="op" id="5083074">(</span><span class="op" id="5083075">)</span>&nbsp;<span class="op" id="5083077">{</span>&nbsp;<span class="ident" id="5083079">b</span><span class="op" id="5083080">.</span><span class="ident" id="5083081">lines</span>&nbsp;<span class="op" id="5083087">=</span>&nbsp;<span class="builtinfunc" id="5083089">append</span><span class="op" id="5083095">(</span><span class="ident" id="5083096">b</span><span class="op" id="5083097">.</span><span class="ident" id="5083098">lines</span><span class="op" id="5083103">,</span>&nbsp;<span class="op" id="5083105">[</span><span class="op" id="5083106">]</span><span class="ident" id="5083107">cell</span><span class="op" id="5083111">{</span><span class="op" id="5083112">}</span><span class="op" id="5083113">)</span>&nbsp;<span class="op" id="5083115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5083118">//&nbsp;Reset&nbsp;the&nbsp;current&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5083146">func</span>&nbsp;<span class="op" id="5083151">(</span><span class="ident" id="5083152">b</span>&nbsp;<span class="op" id="5083154">*</span><span class="ident" id="5083155">Writer</span><span class="op" id="5083161">)</span>&nbsp;<span class="ident" id="5083163">reset</span><span class="op" id="5083168">(</span><span class="op" id="5083169">)</span>&nbsp;<span class="op" id="5083171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083174">b</span><span class="op" id="5083175">.</span><span class="ident" id="5083176">buf</span><span class="op" id="5083179">.</span><span class="ident" id="5083180">Reset</span><span class="op" id="5083185">(</span><span class="op" id="5083186">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083189">b</span><span class="op" id="5083190">.</span><span class="ident" id="5083191">pos</span>&nbsp;<span class="op" id="5083195">=</span>&nbsp;<span class="num" id="5083197">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083200">b</span><span class="op" id="5083201">.</span><span class="ident" id="5083202">cell</span>&nbsp;<span class="op" id="5083207">=</span>&nbsp;<span class="ident" id="5083209">cell</span><span class="op" id="5083213">{</span><span class="op" id="5083214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083217">b</span><span class="op" id="5083218">.</span><span class="ident" id="5083219">endChar</span>&nbsp;<span class="op" id="5083227">=</span>&nbsp;<span class="num" id="5083229">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083232">b</span><span class="op" id="5083233">.</span><span class="ident" id="5083234">lines</span>&nbsp;<span class="op" id="5083240">=</span>&nbsp;<span class="ident" id="5083242">b</span><span class="op" id="5083243">.</span><span class="ident" id="5083244">lines</span><span class="op" id="5083249">[</span><span class="num" id="5083250">0</span><span class="op" id="5083251">:</span><span class="num" id="5083252">0</span><span class="op" id="5083253">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083256">b</span><span class="op" id="5083257">.</span><span class="ident" id="5083258">widths</span>&nbsp;<span class="op" id="5083265">=</span>&nbsp;<span class="ident" id="5083267">b</span><span class="op" id="5083268">.</span><span class="ident" id="5083269">widths</span><span class="op" id="5083275">[</span><span class="num" id="5083276">0</span><span class="op" id="5083277">:</span><span class="num" id="5083278">0</span><span class="op" id="5083279">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083282">b</span><span class="op" id="5083283">.</span><span class="ident" id="5083284">addLine</span><span class="op" id="5083291">(</span><span class="op" id="5083292">)</span><br>
<span class="lineno"></span><span class="op" id="5083294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5083297">//&nbsp;Internal&nbsp;representation&nbsp;(current&nbsp;state):</span><br>
<span class="lineno"></span><span class="comment" id="5083341">//</span><br>
<span class="lineno">110</span><span class="comment" id="5083344">//&nbsp;-&nbsp;all&nbsp;text&nbsp;written&nbsp;is&nbsp;appended&nbsp;to&nbsp;buf;&nbsp;tabs&nbsp;and&nbsp;line&nbsp;breaks&nbsp;are&nbsp;stripped&nbsp;away</span><br>
<span class="lineno"></span><span class="comment" id="5083425">//&nbsp;-&nbsp;at&nbsp;any&nbsp;given&nbsp;time&nbsp;there&nbsp;is&nbsp;a&nbsp;(possibly&nbsp;empty)&nbsp;incomplete&nbsp;cell&nbsp;at&nbsp;the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="5083503">//&nbsp;&nbsp;&nbsp;(the&nbsp;cell&nbsp;starts&nbsp;after&nbsp;a&nbsp;tab&nbsp;or&nbsp;line&nbsp;break)</span><br>
<span class="lineno"></span><span class="comment" id="5083552">//&nbsp;-&nbsp;cell.size&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;belonging&nbsp;to&nbsp;the&nbsp;cell&nbsp;so&nbsp;far</span><br>
<span class="lineno"></span><span class="comment" id="5083619">//&nbsp;-&nbsp;cell.width&nbsp;is&nbsp;text&nbsp;width&nbsp;in&nbsp;runes&nbsp;of&nbsp;that&nbsp;cell&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;cell&nbsp;to</span><br>
<span class="lineno">115</span><span class="comment" id="5083701">//&nbsp;&nbsp;&nbsp;position&nbsp;pos;&nbsp;html&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are&nbsp;excluded&nbsp;from&nbsp;this&nbsp;width&nbsp;if&nbsp;html</span><br>
<span class="lineno"></span><span class="comment" id="5083780">//&nbsp;&nbsp;&nbsp;filtering&nbsp;is&nbsp;enabled</span><br>
<span class="lineno"></span><span class="comment" id="5083806">//&nbsp;-&nbsp;the&nbsp;sizes&nbsp;and&nbsp;widths&nbsp;of&nbsp;processed&nbsp;text&nbsp;are&nbsp;kept&nbsp;in&nbsp;the&nbsp;lines&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5083877">//&nbsp;&nbsp;&nbsp;which&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;cells&nbsp;for&nbsp;each&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5083927">//&nbsp;-&nbsp;the&nbsp;widths&nbsp;list&nbsp;is&nbsp;a&nbsp;temporary&nbsp;list&nbsp;with&nbsp;current&nbsp;widths&nbsp;used&nbsp;during</span><br>
<span class="lineno">120</span><span class="comment" id="5084000">//&nbsp;&nbsp;&nbsp;formatting;&nbsp;it&nbsp;is&nbsp;kept&nbsp;in&nbsp;Writer&nbsp;because&nbsp;it&#39;s&nbsp;re-used</span><br>
<span class="lineno"></span><span class="comment" id="5084059">//</span><br>
<span class="lineno"></span><span class="comment" id="5084062">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;----------&nbsp;size&nbsp;----------&gt;|</span><br>
<span class="lineno"></span><span class="comment" id="5084115">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="5084168">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;-&nbsp;width&nbsp;-&gt;|&lt;-&nbsp;ignored&nbsp;-&gt;|&nbsp;&nbsp;|</span><br>
<span class="lineno">125</span><span class="comment" id="5084221">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="5084274">//&nbsp;[---processed---tab------------&lt;tag&gt;...&lt;/tag&gt;...]</span><br>
<span class="lineno"></span><span class="comment" id="5084327">//&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="5084377">//&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="5084427">//&nbsp;buf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;&nbsp;pos</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="5084480">//&nbsp;Formatting&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;these&nbsp;flags.</span><br>
<span class="lineno"></span><span class="keyword" id="5084530">const</span>&nbsp;<span class="op" id="5084536">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5084539">//&nbsp;Ignore&nbsp;html&nbsp;tags&nbsp;and&nbsp;treat&nbsp;entities&nbsp;(starting&nbsp;with&nbsp;&#39;&amp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5084598">//&nbsp;and&nbsp;ending&nbsp;in&nbsp;&#39;;&#39;)&nbsp;as&nbsp;single&nbsp;characters&nbsp;(width&nbsp;=&nbsp;1).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084655">FilterHTML</span>&nbsp;<span class="builtintype" id="5084666">uint</span>&nbsp;<span class="op" id="5084671">=</span>&nbsp;<span class="num" id="5084673">1</span>&nbsp;<span class="op" id="5084675">&lt;&lt;</span>&nbsp;<span class="ident" id="5084678">iota</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5084685">//&nbsp;Strip&nbsp;Escape&nbsp;characters&nbsp;bracketing&nbsp;escaped&nbsp;text&nbsp;segments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5084746">//&nbsp;instead&nbsp;of&nbsp;passing&nbsp;them&nbsp;through&nbsp;unchanged&nbsp;with&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084807">StripEscape</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5084821">//&nbsp;Force&nbsp;right-alignment&nbsp;of&nbsp;cell&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5084864">//&nbsp;Default&nbsp;is&nbsp;left-alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084895">AlignRight</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5084908">//&nbsp;Handle&nbsp;empty&nbsp;columns&nbsp;as&nbsp;if&nbsp;they&nbsp;were&nbsp;not&nbsp;present&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5084964">//&nbsp;the&nbsp;input&nbsp;in&nbsp;the&nbsp;first&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084998">DiscardEmptyColumns</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5085020">//&nbsp;Always&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;columns&nbsp;(i.e.,&nbsp;padding&nbsp;of</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5085082">//&nbsp;leading&nbsp;empty&nbsp;cells&nbsp;on&nbsp;the&nbsp;left)&nbsp;independent&nbsp;of&nbsp;padchar.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085143">TabIndent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5085155">//&nbsp;Print&nbsp;a&nbsp;vertical&nbsp;bar&nbsp;(&#39;|&#39;)&nbsp;between&nbsp;columns&nbsp;(after&nbsp;formatting).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5085222">//&nbsp;Discarded&nbsp;columns&nbsp;appear&nbsp;as&nbsp;zero-width&nbsp;columns&nbsp;(&#34;||&#34;).</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085281">Debug</span><br>
<span class="lineno"></span><span class="op" id="5085287">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5085290">//&nbsp;A&nbsp;Writer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Init.&nbsp;The&nbsp;first&nbsp;parameter&nbsp;(output)</span><br>
<span class="lineno"></span><span class="comment" id="5085372">//&nbsp;specifies&nbsp;the&nbsp;filter&nbsp;output.&nbsp;The&nbsp;remaining&nbsp;parameters&nbsp;control&nbsp;the&nbsp;formatting:</span><br>
<span class="lineno">160</span><span class="comment" id="5085453">//</span><br>
<span class="lineno"></span><span class="comment" id="5085456">//&nbsp;&nbsp;&nbsp;&nbspminwidth&nbsp;&nbsp;&nbsp;&nbspminimal&nbsp;cell&nbsp;width&nbsp;including&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span><span class="comment" id="5085509">//&nbsp;&nbsp;&nbsp;&nbsptabwidth&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;tab&nbsp;characters&nbsp;(equivalent&nbsp;number&nbsp;of&nbsp;spaces)</span><br>
<span class="lineno"></span><span class="comment" id="5085575">//&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;added&nbsp;to&nbsp;a&nbsp;cell&nbsp;before&nbsp;computing&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="5085638">//&nbsp;&nbsp;&nbsp;&nbsppadchar&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspASCII&nbsp;char&nbsp;used&nbsp;for&nbsp;padding</span><br>
<span class="lineno">165</span><span class="comment" id="5085678">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;padchar&nbsp;==&nbsp;&#39;\t&#39;,&nbsp;the&nbsp;Writer&nbsp;will&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5085735">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;a&nbsp;&#39;\t&#39;&nbsp;in&nbsp;the&nbsp;formatted&nbsp;output&nbsp;is&nbsp;tabwidth,</span><br>
<span class="lineno"></span><span class="comment" id="5085793">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspand&nbsp;cells&nbsp;are&nbsp;left-aligned&nbsp;independent&nbsp;of&nbsp;align_left</span><br>
<span class="lineno"></span><span class="comment" id="5085851">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(for&nbsp;correct-looking&nbsp;results,&nbsp;tabwidth&nbsp;must&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="5085911">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspto&nbsp;the&nbsp;tab&nbsp;width&nbsp;in&nbsp;the&nbsp;viewer&nbsp;displaying&nbsp;the&nbsp;result)</span><br>
<span class="lineno">170</span><span class="comment" id="5085970">//&nbsp;&nbsp;&nbsp;&nbspflags&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspformatting&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="5085999">//</span><br>
<span class="lineno"></span><span class="keyword" id="5086002">func</span>&nbsp;<span class="op" id="5086007">(</span><span class="ident" id="5086008">b</span>&nbsp;<span class="op" id="5086010">*</span><span class="ident" id="5086011">Writer</span><span class="op" id="5086017">)</span>&nbsp;<span class="ident" id="5086019">Init</span><span class="op" id="5086023">(</span><span class="ident" id="5086024">output</span>&nbsp;<span class="ident" id="5086031">io</span><span class="op" id="5086033">.</span><span class="ident" id="5086034">Writer</span><span class="op" id="5086040">,</span>&nbsp;<span class="ident" id="5086042">minwidth</span><span class="op" id="5086050">,</span>&nbsp;<span class="ident" id="5086052">tabwidth</span><span class="op" id="5086060">,</span>&nbsp;<span class="ident" id="5086062">padding</span>&nbsp;<span class="builtintype" id="5086070">int</span><span class="op" id="5086073">,</span>&nbsp;<span class="ident" id="5086075">padchar</span>&nbsp;<span class="builtintype" id="5086083">byte</span><span class="op" id="5086087">,</span>&nbsp;<span class="ident" id="5086089">flags</span>&nbsp;<span class="builtintype" id="5086095">uint</span><span class="op" id="5086099">)</span>&nbsp;<span class="op" id="5086101">*</span><span class="ident" id="5086102">Writer</span>&nbsp;<span class="op" id="5086109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086112">if</span>&nbsp;<span class="ident" id="5086115">minwidth</span>&nbsp;<span class="op" id="5086124">&lt;</span>&nbsp;<span class="num" id="5086126">0</span>&nbsp;<span class="op" id="5086128">||</span>&nbsp;<span class="ident" id="5086131">tabwidth</span>&nbsp;<span class="op" id="5086140">&lt;</span>&nbsp;<span class="num" id="5086142">0</span>&nbsp;<span class="op" id="5086144">||</span>&nbsp;<span class="ident" id="5086147">padding</span>&nbsp;<span class="op" id="5086155">&lt;</span>&nbsp;<span class="num" id="5086157">0</span>&nbsp;<span class="op" id="5086159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5086163">panic</span><span class="op" id="5086168">(</span><span class="string" id="5086169">&#34;negative&nbsp;minwidth,&nbsp;tabwidth,&nbsp;or&nbsp;padding&#34;</span><span class="op" id="5086210">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086216">b</span><span class="op" id="5086217">.</span><span class="ident" id="5086218">output</span>&nbsp;<span class="op" id="5086225">=</span>&nbsp;<span class="ident" id="5086227">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086235">b</span><span class="op" id="5086236">.</span><span class="ident" id="5086237">minwidth</span>&nbsp;<span class="op" id="5086246">=</span>&nbsp;<span class="ident" id="5086248">minwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086258">b</span><span class="op" id="5086259">.</span><span class="ident" id="5086260">tabwidth</span>&nbsp;<span class="op" id="5086269">=</span>&nbsp;<span class="ident" id="5086271">tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086281">b</span><span class="op" id="5086282">.</span><span class="ident" id="5086283">padding</span>&nbsp;<span class="op" id="5086291">=</span>&nbsp;<span class="ident" id="5086293">padding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086302">for</span>&nbsp;<span class="ident" id="5086306">i</span>&nbsp;<span class="op" id="5086308">:=</span>&nbsp;<span class="keyword" id="5086311">range</span>&nbsp;<span class="ident" id="5086317">b</span><span class="op" id="5086318">.</span><span class="ident" id="5086319">padbytes</span>&nbsp;<span class="op" id="5086328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086332">b</span><span class="op" id="5086333">.</span><span class="ident" id="5086334">padbytes</span><span class="op" id="5086342">[</span><span class="ident" id="5086343">i</span><span class="op" id="5086344">]</span>&nbsp;<span class="op" id="5086346">=</span>&nbsp;<span class="ident" id="5086348">padchar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086360">if</span>&nbsp;<span class="ident" id="5086363">padchar</span>&nbsp;<span class="op" id="5086371">==</span>&nbsp;<span class="string" id="5086374">&#39;\t&#39;</span>&nbsp;<span class="op" id="5086379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5086383">//&nbsp;tab&nbsp;padding&nbsp;enforces&nbsp;left-alignment</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086424">flags</span>&nbsp;<span class="op" id="5086430">&amp;^=</span>&nbsp;<span class="ident" id="5086434">AlignRight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086449">b</span><span class="op" id="5086450">.</span><span class="ident" id="5086451">flags</span>&nbsp;<span class="op" id="5086457">=</span>&nbsp;<span class="ident" id="5086459">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086467">b</span><span class="op" id="5086468">.</span><span class="ident" id="5086469">reset</span><span class="op" id="5086474">(</span><span class="op" id="5086475">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086479">return</span>&nbsp;<span class="ident" id="5086486">b</span><br>
<span class="lineno"></span><span class="op" id="5086488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5086491">//&nbsp;debugging&nbsp;support&nbsp;(keep&nbsp;code&nbsp;around)</span><br>
<span class="lineno">195</span><span class="keyword" id="5086531">func</span>&nbsp;<span class="op" id="5086536">(</span><span class="ident" id="5086537">b</span>&nbsp;<span class="op" id="5086539">*</span><span class="ident" id="5086540">Writer</span><span class="op" id="5086546">)</span>&nbsp;<span class="ident" id="5086548">dump</span><span class="op" id="5086552">(</span><span class="op" id="5086553">)</span>&nbsp;<span class="op" id="5086555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086558">pos</span>&nbsp;<span class="op" id="5086562">:=</span>&nbsp;<span class="num" id="5086565">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086568">for</span>&nbsp;<span class="ident" id="5086572">i</span><span class="op" id="5086573">,</span>&nbsp;<span class="ident" id="5086575">line</span>&nbsp;<span class="op" id="5086580">:=</span>&nbsp;<span class="keyword" id="5086583">range</span>&nbsp;<span class="ident" id="5086589">b</span><span class="op" id="5086590">.</span><span class="ident" id="5086591">lines</span>&nbsp;<span class="op" id="5086597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5086601">print</span><span class="op" id="5086606">(</span><span class="string" id="5086607">&#34;(&#34;</span><span class="op" id="5086610">,</span>&nbsp;<span class="ident" id="5086612">i</span><span class="op" id="5086613">,</span>&nbsp;<span class="string" id="5086615">&#34;)&nbsp;&#34;</span><span class="op" id="5086619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086623">for</span>&nbsp;<span class="ident" id="5086627">_</span><span class="op" id="5086628">,</span>&nbsp;<span class="ident" id="5086630">c</span>&nbsp;<span class="op" id="5086632">:=</span>&nbsp;<span class="keyword" id="5086635">range</span>&nbsp;<span class="ident" id="5086641">line</span>&nbsp;<span class="op" id="5086646">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5086651">print</span><span class="op" id="5086656">(</span><span class="string" id="5086657">&#34;[&#34;</span><span class="op" id="5086660">,</span>&nbsp;<span class="builtintype" id="5086662">string</span><span class="op" id="5086668">(</span><span class="ident" id="5086669">b</span><span class="op" id="5086670">.</span><span class="ident" id="5086671">buf</span><span class="op" id="5086674">.</span><span class="ident" id="5086675">Bytes</span><span class="op" id="5086680">(</span><span class="op" id="5086681">)</span><span class="op" id="5086682">[</span><span class="ident" id="5086683">pos</span><span class="op" id="5086686">:</span><span class="ident" id="5086687">pos</span><span class="op" id="5086690">+</span><span class="ident" id="5086691">c</span><span class="op" id="5086692">.</span><span class="ident" id="5086693">size</span><span class="op" id="5086697">]</span><span class="op" id="5086698">)</span><span class="op" id="5086699">,</span>&nbsp;<span class="string" id="5086701">&#34;]&#34;</span><span class="op" id="5086704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086709">pos</span>&nbsp;<span class="op" id="5086713">+=</span>&nbsp;<span class="ident" id="5086716">c</span><span class="op" id="5086717">.</span><span class="ident" id="5086718">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5086729">print</span><span class="op" id="5086734">(</span><span class="string" id="5086735">&#34;\n&#34;</span><span class="op" id="5086739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086742">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5086745">print</span><span class="op" id="5086750">(</span><span class="string" id="5086751">&#34;\n&#34;</span><span class="op" id="5086755">)</span><br>
<span class="lineno"></span><span class="op" id="5086757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5086760">//&nbsp;local&nbsp;error&nbsp;wrapper&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish&nbsp;errors&nbsp;we&nbsp;want&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5086830">//&nbsp;as&nbsp;errors&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;(which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors)</span><br>
<span class="lineno">210</span><span class="keyword" id="5086905">type</span>&nbsp;<span class="ident" id="5086910">osError</span>&nbsp;<span class="keyword" id="5086918">struct</span>&nbsp;<span class="op" id="5086925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086928">err</span>&nbsp;<span class="builtintype" id="5086932">error</span><br>
<span class="lineno"></span><span class="op" id="5086938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5086941">func</span>&nbsp;<span class="op" id="5086946">(</span><span class="ident" id="5086947">b</span>&nbsp;<span class="op" id="5086949">*</span><span class="ident" id="5086950">Writer</span><span class="op" id="5086956">)</span>&nbsp;<span class="ident" id="5086958">write0</span><span class="op" id="5086964">(</span><span class="ident" id="5086965">buf</span>&nbsp;<span class="op" id="5086969">[</span><span class="op" id="5086970">]</span><span class="builtintype" id="5086971">byte</span><span class="op" id="5086975">)</span>&nbsp;<span class="op" id="5086977">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086980">n</span><span class="op" id="5086981">,</span>&nbsp;<span class="ident" id="5086983">err</span>&nbsp;<span class="op" id="5086987">:=</span>&nbsp;<span class="ident" id="5086990">b</span><span class="op" id="5086991">.</span><span class="ident" id="5086992">output</span><span class="op" id="5086998">.</span><span class="ident" id="5086999">Write</span><span class="op" id="5087004">(</span><span class="ident" id="5087005">buf</span><span class="op" id="5087008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5087011">if</span>&nbsp;<span class="ident" id="5087014">n</span>&nbsp;<span class="op" id="5087016">!=</span>&nbsp;<span class="builtinfunc" id="5087019">len</span><span class="op" id="5087022">(</span><span class="ident" id="5087023">buf</span><span class="op" id="5087026">)</span>&nbsp;<span class="op" id="5087028">&amp;&amp;</span>&nbsp;<span class="ident" id="5087031">err</span>&nbsp;<span class="op" id="5087035">==</span>&nbsp;<span class="ident" id="5087038">nil</span>&nbsp;<span class="op" id="5087042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087046">err</span>&nbsp;<span class="op" id="5087050">=</span>&nbsp;<span class="ident" id="5087052">io</span><span class="op" id="5087054">.</span><span class="ident" id="5087055">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5087070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5087073">if</span>&nbsp;<span class="ident" id="5087076">err</span>&nbsp;<span class="op" id="5087080">!=</span>&nbsp;<span class="ident" id="5087083">nil</span>&nbsp;<span class="op" id="5087087">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5087091">panic</span><span class="op" id="5087096">(</span><span class="ident" id="5087097">osError</span><span class="op" id="5087104">{</span><span class="ident" id="5087105">err</span><span class="op" id="5087108">}</span><span class="op" id="5087109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5087112">}</span><br>
<span class="lineno"></span><span class="op" id="5087114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5087117">func</span>&nbsp;<span class="op" id="5087122">(</span><span class="ident" id="5087123">b</span>&nbsp;<span class="op" id="5087125">*</span><span class="ident" id="5087126">Writer</span><span class="op" id="5087132">)</span>&nbsp;<span class="ident" id="5087134">writeN</span><span class="op" id="5087140">(</span><span class="ident" id="5087141">src</span>&nbsp;<span class="op" id="5087145">[</span><span class="op" id="5087146">]</span><span class="builtintype" id="5087147">byte</span><span class="op" id="5087151">,</span>&nbsp;<span class="ident" id="5087153">n</span>&nbsp;<span class="builtintype" id="5087155">int</span><span class="op" id="5087158">)</span>&nbsp;<span class="op" id="5087160">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5087163">for</span>&nbsp;<span class="ident" id="5087167">n</span>&nbsp;<span class="op" id="5087169">&gt;</span>&nbsp;<span class="builtinfunc" id="5087171">len</span><span class="op" id="5087174">(</span><span class="ident" id="5087175">src</span><span class="op" id="5087178">)</span>&nbsp;<span class="op" id="5087180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087184">b</span><span class="op" id="5087185">.</span><span class="ident" id="5087186">write0</span><span class="op" id="5087192">(</span><span class="ident" id="5087193">src</span><span class="op" id="5087196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087200">n</span>&nbsp;<span class="op" id="5087202">-=</span>&nbsp;<span class="builtinfunc" id="5087205">len</span><span class="op" id="5087208">(</span><span class="ident" id="5087209">src</span><span class="op" id="5087212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5087215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087218">b</span><span class="op" id="5087219">.</span><span class="ident" id="5087220">write0</span><span class="op" id="5087226">(</span><span class="ident" id="5087227">src</span><span class="op" id="5087230">[</span><span class="num" id="5087231">0</span><span class="op" id="5087232">:</span><span class="ident" id="5087233">n</span><span class="op" id="5087234">]</span><span class="op" id="5087235">)</span><br>
<span class="lineno">230</span><span class="op" id="5087237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5087240">var</span>&nbsp;<span class="op" id="5087244">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087247">newline</span>&nbsp;<span class="op" id="5087255">=</span>&nbsp;<span class="op" id="5087257">[</span><span class="op" id="5087258">]</span><span class="builtintype" id="5087259">byte</span><span class="op" id="5087263">{</span><span class="string" id="5087264">&#39;\n&#39;</span><span class="op" id="5087268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087271">tabs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087279">=</span>&nbsp;<span class="op" id="5087281">[</span><span class="op" id="5087282">]</span><span class="builtintype" id="5087283">byte</span><span class="op" id="5087287">(</span><span class="string" id="5087288">&#34;\t\t\t\t\t\t\t\t&#34;</span><span class="op" id="5087306">)</span><br>
<span class="lineno">235</span><span class="op" id="5087308">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5087311">func</span>&nbsp;<span class="op" id="5087316">(</span><span class="ident" id="5087317">b</span>&nbsp;<span class="op" id="5087319">*</span><span class="ident" id="5087320">Writer</span><span class="op" id="5087326">)</span>&nbsp;<span class="ident" id="5087328">writePadding</span><span class="op" id="5087340">(</span><span class="ident" id="5087341">textw</span><span class="op" id="5087346">,</span>&nbsp;<span class="ident" id="5087348">cellw</span>&nbsp;<span class="builtintype" id="5087354">int</span><span class="op" id="5087357">,</span>&nbsp;<span class="ident" id="5087359">useTabs</span>&nbsp;<span class="builtintype" id="5087367">bool</span><span class="op" id="5087371">)</span>&nbsp;<span class="op" id="5087373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5087376">if</span>&nbsp;<span class="ident" id="5087379">b</span><span class="op" id="5087380">.</span><span class="ident" id="5087381">padbytes</span><span class="op" id="5087389">[</span><span class="num" id="5087390">0</span><span class="op" id="5087391">]</span>&nbsp;<span class="op" id="5087393">==</span>&nbsp;<span class="string" id="5087396">&#39;\t&#39;</span>&nbsp;<span class="op" id="5087401">||</span>&nbsp;<span class="ident" id="5087404">useTabs</span>&nbsp;<span class="op" id="5087412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5087416">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;tabs</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5087447">if</span>&nbsp;<span class="ident" id="5087450">b</span><span class="op" id="5087451">.</span><span class="ident" id="5087452">tabwidth</span>&nbsp;<span class="op" id="5087461">==</span>&nbsp;<span class="num" id="5087464">0</span>&nbsp;<span class="op" id="5087466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5087471">return</span>&nbsp;<span class="comment" id="5087478">//&nbsp;tabs&nbsp;have&nbsp;no&nbsp;width&nbsp;-&nbsp;can&#39;t&nbsp;do&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5087525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5087529">//&nbsp;make&nbsp;cellw&nbsp;the&nbsp;smallest&nbsp;multiple&nbsp;of&nbsp;b.tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087581">cellw</span>&nbsp;<span class="op" id="5087587">=</span>&nbsp;<span class="op" id="5087589">(</span><span class="ident" id="5087590">cellw</span>&nbsp;<span class="op" id="5087596">+</span>&nbsp;<span class="ident" id="5087598">b</span><span class="op" id="5087599">.</span><span class="ident" id="5087600">tabwidth</span>&nbsp;<span class="op" id="5087609">-</span>&nbsp;<span class="num" id="5087611">1</span><span class="op" id="5087612">)</span>&nbsp;<span class="op" id="5087614">/</span>&nbsp;<span class="ident" id="5087616">b</span><span class="op" id="5087617">.</span><span class="ident" id="5087618">tabwidth</span>&nbsp;<span class="op" id="5087627">*</span>&nbsp;<span class="ident" id="5087629">b</span><span class="op" id="5087630">.</span><span class="ident" id="5087631">tabwidth</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087642">n</span>&nbsp;<span class="op" id="5087644">:=</span>&nbsp;<span class="ident" id="5087647">cellw</span>&nbsp;<span class="op" id="5087653">-</span>&nbsp;<span class="ident" id="5087655">textw</span>&nbsp;<span class="comment" id="5087661">//&nbsp;amount&nbsp;of&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5087684">if</span>&nbsp;<span class="ident" id="5087687">n</span>&nbsp;<span class="op" id="5087689">&lt;</span>&nbsp;<span class="num" id="5087691">0</span>&nbsp;<span class="op" id="5087693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5087698">panic</span><span class="op" id="5087703">(</span><span class="string" id="5087704">&#34;internal&nbsp;error&#34;</span><span class="op" id="5087720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5087724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087728">b</span><span class="op" id="5087729">.</span><span class="ident" id="5087730">writeN</span><span class="op" id="5087736">(</span><span class="ident" id="5087737">tabs</span><span class="op" id="5087741">,</span>&nbsp;<span class="op" id="5087743">(</span><span class="ident" id="5087744">n</span><span class="op" id="5087745">+</span><span class="ident" id="5087746">b</span><span class="op" id="5087747">.</span><span class="ident" id="5087748">tabwidth</span><span class="op" id="5087756">-</span><span class="num" id="5087757">1</span><span class="op" id="5087758">)</span><span class="op" id="5087759">/</span><span class="ident" id="5087760">b</span><span class="op" id="5087761">.</span><span class="ident" id="5087762">tabwidth</span><span class="op" id="5087770">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5087774">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5087782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5087786">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;non-tab&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087830">b</span><span class="op" id="5087831">.</span><span class="ident" id="5087832">writeN</span><span class="op" id="5087838">(</span><span class="ident" id="5087839">b</span><span class="op" id="5087840">.</span><span class="ident" id="5087841">padbytes</span><span class="op" id="5087849">[</span><span class="num" id="5087850">0</span><span class="op" id="5087851">:</span><span class="op" id="5087852">]</span><span class="op" id="5087853">,</span>&nbsp;<span class="ident" id="5087855">cellw</span><span class="op" id="5087860">-</span><span class="ident" id="5087861">textw</span><span class="op" id="5087866">)</span><br>
<span class="lineno">255</span><span class="op" id="5087868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5087871">var</span>&nbsp;<span class="ident" id="5087875">vbar</span>&nbsp;<span class="op" id="5087880">=</span>&nbsp;<span class="op" id="5087882">[</span><span class="op" id="5087883">]</span><span class="builtintype" id="5087884">byte</span><span class="op" id="5087888">{</span><span class="string" id="5087889">&#39;|&#39;</span><span class="op" id="5087892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5087895">func</span>&nbsp;<span class="op" id="5087900">(</span><span class="ident" id="5087901">b</span>&nbsp;<span class="op" id="5087903">*</span><span class="ident" id="5087904">Writer</span><span class="op" id="5087910">)</span>&nbsp;<span class="ident" id="5087912">writeLines</span><span class="op" id="5087922">(</span><span class="ident" id="5087923">pos0</span>&nbsp;<span class="builtintype" id="5087928">int</span><span class="op" id="5087931">,</span>&nbsp;<span class="ident" id="5087933">line0</span><span class="op" id="5087938">,</span>&nbsp;<span class="ident" id="5087940">line1</span>&nbsp;<span class="builtintype" id="5087946">int</span><span class="op" id="5087949">)</span>&nbsp;<span class="op" id="5087951">(</span><span class="ident" id="5087952">pos</span>&nbsp;<span class="builtintype" id="5087956">int</span><span class="op" id="5087959">)</span>&nbsp;<span class="op" id="5087961">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087964">pos</span>&nbsp;<span class="op" id="5087968">=</span>&nbsp;<span class="ident" id="5087970">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5087976">for</span>&nbsp;<span class="ident" id="5087980">i</span>&nbsp;<span class="op" id="5087982">:=</span>&nbsp;<span class="ident" id="5087985">line0</span><span class="op" id="5087990">;</span>&nbsp;<span class="ident" id="5087992">i</span>&nbsp;<span class="op" id="5087994">&lt;</span>&nbsp;<span class="ident" id="5087996">line1</span><span class="op" id="5088001">;</span>&nbsp;<span class="ident" id="5088003">i</span><span class="op" id="5088004">++</span>&nbsp;<span class="op" id="5088007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088011">line</span>&nbsp;<span class="op" id="5088016">:=</span>&nbsp;<span class="ident" id="5088019">b</span><span class="op" id="5088020">.</span><span class="ident" id="5088021">lines</span><span class="op" id="5088026">[</span><span class="ident" id="5088027">i</span><span class="op" id="5088028">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088033">//&nbsp;if&nbsp;TabIndent&nbsp;is&nbsp;set,&nbsp;use&nbsp;tabs&nbsp;to&nbsp;pad&nbsp;leading&nbsp;empty&nbsp;cells</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088095">useTabs</span>&nbsp;<span class="op" id="5088103">:=</span>&nbsp;<span class="ident" id="5088106">b</span><span class="op" id="5088107">.</span><span class="ident" id="5088108">flags</span><span class="op" id="5088113">&amp;</span><span class="ident" id="5088114">TabIndent</span>&nbsp;<span class="op" id="5088124">!=</span>&nbsp;<span class="num" id="5088127">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088132">for</span>&nbsp;<span class="ident" id="5088136">j</span><span class="op" id="5088137">,</span>&nbsp;<span class="ident" id="5088139">c</span>&nbsp;<span class="op" id="5088141">:=</span>&nbsp;<span class="keyword" id="5088144">range</span>&nbsp;<span class="ident" id="5088150">line</span>&nbsp;<span class="op" id="5088155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088160">if</span>&nbsp;<span class="ident" id="5088163">j</span>&nbsp;<span class="op" id="5088165">&gt;</span>&nbsp;<span class="num" id="5088167">0</span>&nbsp;<span class="op" id="5088169">&amp;&amp;</span>&nbsp;<span class="ident" id="5088172">b</span><span class="op" id="5088173">.</span><span class="ident" id="5088174">flags</span><span class="op" id="5088179">&amp;</span><span class="ident" id="5088180">Debug</span>&nbsp;<span class="op" id="5088186">!=</span>&nbsp;<span class="num" id="5088189">0</span>&nbsp;<span class="op" id="5088191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088197">//&nbsp;indicate&nbsp;column&nbsp;break</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088226">b</span><span class="op" id="5088227">.</span><span class="ident" id="5088228">write0</span><span class="op" id="5088234">(</span><span class="ident" id="5088235">vbar</span><span class="op" id="5088239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088250">if</span>&nbsp;<span class="ident" id="5088253">c</span><span class="op" id="5088254">.</span><span class="ident" id="5088255">size</span>&nbsp;<span class="op" id="5088260">==</span>&nbsp;<span class="num" id="5088263">0</span>&nbsp;<span class="op" id="5088265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088271">//&nbsp;empty&nbsp;cell</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088289">if</span>&nbsp;<span class="ident" id="5088292">j</span>&nbsp;<span class="op" id="5088294">&lt;</span>&nbsp;<span class="builtinfunc" id="5088296">len</span><span class="op" id="5088299">(</span><span class="ident" id="5088300">b</span><span class="op" id="5088301">.</span><span class="ident" id="5088302">widths</span><span class="op" id="5088308">)</span>&nbsp;<span class="op" id="5088310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088317">b</span><span class="op" id="5088318">.</span><span class="ident" id="5088319">writePadding</span><span class="op" id="5088331">(</span><span class="ident" id="5088332">c</span><span class="op" id="5088333">.</span><span class="ident" id="5088334">width</span><span class="op" id="5088339">,</span>&nbsp;<span class="ident" id="5088341">b</span><span class="op" id="5088342">.</span><span class="ident" id="5088343">widths</span><span class="op" id="5088349">[</span><span class="ident" id="5088350">j</span><span class="op" id="5088351">]</span><span class="op" id="5088352">,</span>&nbsp;<span class="ident" id="5088354">useTabs</span><span class="op" id="5088361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088372">}</span>&nbsp;<span class="keyword" id="5088374">else</span>&nbsp;<span class="op" id="5088379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088385">//&nbsp;non-empty&nbsp;cell</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088407">useTabs</span>&nbsp;<span class="op" id="5088415">=</span>&nbsp;<span class="builtintype" id="5088417">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088427">if</span>&nbsp;<span class="ident" id="5088430">b</span><span class="op" id="5088431">.</span><span class="ident" id="5088432">flags</span><span class="op" id="5088437">&amp;</span><span class="ident" id="5088438">AlignRight</span>&nbsp;<span class="op" id="5088449">==</span>&nbsp;<span class="num" id="5088452">0</span>&nbsp;<span class="op" id="5088454">{</span>&nbsp;<span class="comment" id="5088456">//&nbsp;align&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088475">b</span><span class="op" id="5088476">.</span><span class="ident" id="5088477">write0</span><span class="op" id="5088483">(</span><span class="ident" id="5088484">b</span><span class="op" id="5088485">.</span><span class="ident" id="5088486">buf</span><span class="op" id="5088489">.</span><span class="ident" id="5088490">Bytes</span><span class="op" id="5088495">(</span><span class="op" id="5088496">)</span><span class="op" id="5088497">[</span><span class="ident" id="5088498">pos</span>&nbsp;<span class="op" id="5088502">:</span>&nbsp;<span class="ident" id="5088504">pos</span><span class="op" id="5088507">+</span><span class="ident" id="5088508">c</span><span class="op" id="5088509">.</span><span class="ident" id="5088510">size</span><span class="op" id="5088514">]</span><span class="op" id="5088515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088522">pos</span>&nbsp;<span class="op" id="5088526">+=</span>&nbsp;<span class="ident" id="5088529">c</span><span class="op" id="5088530">.</span><span class="ident" id="5088531">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088541">if</span>&nbsp;<span class="ident" id="5088544">j</span>&nbsp;<span class="op" id="5088546">&lt;</span>&nbsp;<span class="builtinfunc" id="5088548">len</span><span class="op" id="5088551">(</span><span class="ident" id="5088552">b</span><span class="op" id="5088553">.</span><span class="ident" id="5088554">widths</span><span class="op" id="5088560">)</span>&nbsp;<span class="op" id="5088562">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088570">b</span><span class="op" id="5088571">.</span><span class="ident" id="5088572">writePadding</span><span class="op" id="5088584">(</span><span class="ident" id="5088585">c</span><span class="op" id="5088586">.</span><span class="ident" id="5088587">width</span><span class="op" id="5088592">,</span>&nbsp;<span class="ident" id="5088594">b</span><span class="op" id="5088595">.</span><span class="ident" id="5088596">widths</span><span class="op" id="5088602">[</span><span class="ident" id="5088603">j</span><span class="op" id="5088604">]</span><span class="op" id="5088605">,</span>&nbsp;<span class="builtintype" id="5088607">false</span><span class="op" id="5088612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088625">}</span>&nbsp;<span class="keyword" id="5088627">else</span>&nbsp;<span class="op" id="5088632">{</span>&nbsp;<span class="comment" id="5088634">//&nbsp;align&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088654">if</span>&nbsp;<span class="ident" id="5088657">j</span>&nbsp;<span class="op" id="5088659">&lt;</span>&nbsp;<span class="builtinfunc" id="5088661">len</span><span class="op" id="5088664">(</span><span class="ident" id="5088665">b</span><span class="op" id="5088666">.</span><span class="ident" id="5088667">widths</span><span class="op" id="5088673">)</span>&nbsp;<span class="op" id="5088675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088683">b</span><span class="op" id="5088684">.</span><span class="ident" id="5088685">writePadding</span><span class="op" id="5088697">(</span><span class="ident" id="5088698">c</span><span class="op" id="5088699">.</span><span class="ident" id="5088700">width</span><span class="op" id="5088705">,</span>&nbsp;<span class="ident" id="5088707">b</span><span class="op" id="5088708">.</span><span class="ident" id="5088709">widths</span><span class="op" id="5088715">[</span><span class="ident" id="5088716">j</span><span class="op" id="5088717">]</span><span class="op" id="5088718">,</span>&nbsp;<span class="builtintype" id="5088720">false</span><span class="op" id="5088725">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088739">b</span><span class="op" id="5088740">.</span><span class="ident" id="5088741">write0</span><span class="op" id="5088747">(</span><span class="ident" id="5088748">b</span><span class="op" id="5088749">.</span><span class="ident" id="5088750">buf</span><span class="op" id="5088753">.</span><span class="ident" id="5088754">Bytes</span><span class="op" id="5088759">(</span><span class="op" id="5088760">)</span><span class="op" id="5088761">[</span><span class="ident" id="5088762">pos</span>&nbsp;<span class="op" id="5088766">:</span>&nbsp;<span class="ident" id="5088768">pos</span><span class="op" id="5088771">+</span><span class="ident" id="5088772">c</span><span class="op" id="5088773">.</span><span class="ident" id="5088774">size</span><span class="op" id="5088778">]</span><span class="op" id="5088779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088786">pos</span>&nbsp;<span class="op" id="5088790">+=</span>&nbsp;<span class="ident" id="5088793">c</span><span class="op" id="5088794">.</span><span class="ident" id="5088795">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088809">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088818">if</span>&nbsp;<span class="ident" id="5088821">i</span><span class="op" id="5088822">+</span><span class="num" id="5088823">1</span>&nbsp;<span class="op" id="5088825">==</span>&nbsp;<span class="builtinfunc" id="5088828">len</span><span class="op" id="5088831">(</span><span class="ident" id="5088832">b</span><span class="op" id="5088833">.</span><span class="ident" id="5088834">lines</span><span class="op" id="5088839">)</span>&nbsp;<span class="op" id="5088841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088846">//&nbsp;last&nbsp;buffered&nbsp;line&nbsp;-&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;newline,&nbsp;so&nbsp;just&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088912">//&nbsp;any&nbsp;outstanding&nbsp;buffered&nbsp;data</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088948">b</span><span class="op" id="5088949">.</span><span class="ident" id="5088950">write0</span><span class="op" id="5088956">(</span><span class="ident" id="5088957">b</span><span class="op" id="5088958">.</span><span class="ident" id="5088959">buf</span><span class="op" id="5088962">.</span><span class="ident" id="5088963">Bytes</span><span class="op" id="5088968">(</span><span class="op" id="5088969">)</span><span class="op" id="5088970">[</span><span class="ident" id="5088971">pos</span>&nbsp;<span class="op" id="5088975">:</span>&nbsp;<span class="ident" id="5088977">pos</span><span class="op" id="5088980">+</span><span class="ident" id="5088981">b</span><span class="op" id="5088982">.</span><span class="ident" id="5088983">cell</span><span class="op" id="5088987">.</span><span class="ident" id="5088988">size</span><span class="op" id="5088992">]</span><span class="op" id="5088993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088998">pos</span>&nbsp;<span class="op" id="5089002">+=</span>&nbsp;<span class="ident" id="5089005">b</span><span class="op" id="5089006">.</span><span class="ident" id="5089007">cell</span><span class="op" id="5089011">.</span><span class="ident" id="5089012">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5089019">}</span>&nbsp;<span class="keyword" id="5089021">else</span>&nbsp;<span class="op" id="5089026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089031">//&nbsp;not&nbsp;the&nbsp;last&nbsp;line&nbsp;-&nbsp;write&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089071">b</span><span class="op" id="5089072">.</span><span class="ident" id="5089073">write0</span><span class="op" id="5089079">(</span><span class="ident" id="5089080">newline</span><span class="op" id="5089087">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5089091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5089094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089097">return</span><br>
<span class="lineno"></span><span class="op" id="5089104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="5089107">//&nbsp;Format&nbsp;the&nbsp;text&nbsp;between&nbsp;line0&nbsp;and&nbsp;line1&nbsp;(excluding&nbsp;line1);&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="5089173">//&nbsp;is&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;line0.</span><br>
<span class="lineno"></span><span class="comment" id="5089240">//&nbsp;Returns&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5089305">//&nbsp;line1&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="5089336">//</span><br>
<span class="lineno">315</span><span class="keyword" id="5089339">func</span>&nbsp;<span class="op" id="5089344">(</span><span class="ident" id="5089345">b</span>&nbsp;<span class="op" id="5089347">*</span><span class="ident" id="5089348">Writer</span><span class="op" id="5089354">)</span>&nbsp;<span class="ident" id="5089356">format</span><span class="op" id="5089362">(</span><span class="ident" id="5089363">pos0</span>&nbsp;<span class="builtintype" id="5089368">int</span><span class="op" id="5089371">,</span>&nbsp;<span class="ident" id="5089373">line0</span><span class="op" id="5089378">,</span>&nbsp;<span class="ident" id="5089380">line1</span>&nbsp;<span class="builtintype" id="5089386">int</span><span class="op" id="5089389">)</span>&nbsp;<span class="op" id="5089391">(</span><span class="ident" id="5089392">pos</span>&nbsp;<span class="builtintype" id="5089396">int</span><span class="op" id="5089399">)</span>&nbsp;<span class="op" id="5089401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089404">pos</span>&nbsp;<span class="op" id="5089408">=</span>&nbsp;<span class="ident" id="5089410">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089416">column</span>&nbsp;<span class="op" id="5089423">:=</span>&nbsp;<span class="builtinfunc" id="5089426">len</span><span class="op" id="5089429">(</span><span class="ident" id="5089430">b</span><span class="op" id="5089431">.</span><span class="ident" id="5089432">widths</span><span class="op" id="5089438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089441">for</span>&nbsp;<span class="ident" id="5089445">this</span>&nbsp;<span class="op" id="5089450">:=</span>&nbsp;<span class="ident" id="5089453">line0</span><span class="op" id="5089458">;</span>&nbsp;<span class="ident" id="5089460">this</span>&nbsp;<span class="op" id="5089465">&lt;</span>&nbsp;<span class="ident" id="5089467">line1</span><span class="op" id="5089472">;</span>&nbsp;<span class="ident" id="5089474">this</span><span class="op" id="5089478">++</span>&nbsp;<span class="op" id="5089481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089485">line</span>&nbsp;<span class="op" id="5089490">:=</span>&nbsp;<span class="ident" id="5089493">b</span><span class="op" id="5089494">.</span><span class="ident" id="5089495">lines</span><span class="op" id="5089500">[</span><span class="ident" id="5089501">this</span><span class="op" id="5089505">]</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089510">if</span>&nbsp;<span class="ident" id="5089513">column</span>&nbsp;<span class="op" id="5089520">&lt;</span>&nbsp;<span class="builtinfunc" id="5089522">len</span><span class="op" id="5089525">(</span><span class="ident" id="5089526">line</span><span class="op" id="5089530">)</span><span class="op" id="5089531">-</span><span class="num" id="5089532">1</span>&nbsp;<span class="op" id="5089534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089539">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column&nbsp;=&gt;&nbsp;this&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089585">//&nbsp;has&nbsp;more&nbsp;cells&nbsp;than&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089629">//&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;is&nbsp;ignored&nbsp;because&nbsp;cells&nbsp;are</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089688">//&nbsp;tab-terminated;&nbsp;the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089747">//&nbsp;text&nbsp;before&nbsp;the&nbsp;newline/formfeed&nbsp;and&nbsp;does&nbsp;not&nbsp;belong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089806">//&nbsp;to&nbsp;a&nbsp;column)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089826">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;beginning&nbsp;of&nbsp;block</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089879">pos</span>&nbsp;<span class="op" id="5089883">=</span>&nbsp;<span class="ident" id="5089885">b</span><span class="op" id="5089886">.</span><span class="ident" id="5089887">writeLines</span><span class="op" id="5089897">(</span><span class="ident" id="5089898">pos</span><span class="op" id="5089901">,</span>&nbsp;<span class="ident" id="5089903">line0</span><span class="op" id="5089908">,</span>&nbsp;<span class="ident" id="5089910">this</span><span class="op" id="5089914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089919">line0</span>&nbsp;<span class="op" id="5089925">=</span>&nbsp;<span class="ident" id="5089927">this</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089936">//&nbsp;column&nbsp;block&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089961">width</span>&nbsp;<span class="op" id="5089967">:=</span>&nbsp;<span class="ident" id="5089970">b</span><span class="op" id="5089971">.</span><span class="ident" id="5089972">minwidth</span>&nbsp;<span class="comment" id="5089981">//&nbsp;minimal&nbsp;column&nbsp;width</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090008">discardable</span>&nbsp;<span class="op" id="5090020">:=</span>&nbsp;<span class="builtintype" id="5090023">true</span>&nbsp;<span class="comment" id="5090028">//&nbsp;true&nbsp;if&nbsp;all&nbsp;cells&nbsp;in&nbsp;this&nbsp;column&nbsp;are&nbsp;empty&nbsp;and&nbsp;&#34;soft&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090088">for</span>&nbsp;<span class="op" id="5090092">;</span>&nbsp;<span class="ident" id="5090094">this</span>&nbsp;<span class="op" id="5090099">&lt;</span>&nbsp;<span class="ident" id="5090101">line1</span><span class="op" id="5090106">;</span>&nbsp;<span class="ident" id="5090108">this</span><span class="op" id="5090112">++</span>&nbsp;<span class="op" id="5090115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090121">line</span>&nbsp;<span class="op" id="5090126">=</span>&nbsp;<span class="ident" id="5090128">b</span><span class="op" id="5090129">.</span><span class="ident" id="5090130">lines</span><span class="op" id="5090135">[</span><span class="ident" id="5090136">this</span><span class="op" id="5090140">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090146">if</span>&nbsp;<span class="ident" id="5090149">column</span>&nbsp;<span class="op" id="5090156">&lt;</span>&nbsp;<span class="builtinfunc" id="5090158">len</span><span class="op" id="5090161">(</span><span class="ident" id="5090162">line</span><span class="op" id="5090166">)</span><span class="op" id="5090167">-</span><span class="num" id="5090168">1</span>&nbsp;<span class="op" id="5090170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5090177">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090212">c</span>&nbsp;<span class="op" id="5090214">:=</span>&nbsp;<span class="ident" id="5090217">line</span><span class="op" id="5090221">[</span><span class="ident" id="5090222">column</span><span class="op" id="5090228">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5090235">//&nbsp;update&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090256">if</span>&nbsp;<span class="ident" id="5090259">w</span>&nbsp;<span class="op" id="5090261">:=</span>&nbsp;<span class="ident" id="5090264">c</span><span class="op" id="5090265">.</span><span class="ident" id="5090266">width</span>&nbsp;<span class="op" id="5090272">+</span>&nbsp;<span class="ident" id="5090274">b</span><span class="op" id="5090275">.</span><span class="ident" id="5090276">padding</span><span class="op" id="5090283">;</span>&nbsp;<span class="ident" id="5090285">w</span>&nbsp;<span class="op" id="5090287">&gt;</span>&nbsp;<span class="ident" id="5090289">width</span>&nbsp;<span class="op" id="5090295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090303">width</span>&nbsp;<span class="op" id="5090309">=</span>&nbsp;<span class="ident" id="5090311">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090318">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5090325">//&nbsp;update&nbsp;discardable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090352">if</span>&nbsp;<span class="ident" id="5090355">c</span><span class="op" id="5090356">.</span><span class="ident" id="5090357">width</span>&nbsp;<span class="op" id="5090363">&gt;</span>&nbsp;<span class="num" id="5090365">0</span>&nbsp;<span class="op" id="5090367">||</span>&nbsp;<span class="ident" id="5090370">c</span><span class="op" id="5090371">.</span><span class="ident" id="5090372">htab</span>&nbsp;<span class="op" id="5090377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090385">discardable</span>&nbsp;<span class="op" id="5090397">=</span>&nbsp;<span class="builtintype" id="5090399">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090416">}</span>&nbsp;<span class="keyword" id="5090418">else</span>&nbsp;<span class="op" id="5090423">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090430">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5090450">//&nbsp;column&nbsp;block&nbsp;end</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5090474">//&nbsp;discard&nbsp;empty&nbsp;columns&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090515">if</span>&nbsp;<span class="ident" id="5090518">discardable</span>&nbsp;<span class="op" id="5090530">&amp;&amp;</span>&nbsp;<span class="ident" id="5090533">b</span><span class="op" id="5090534">.</span><span class="ident" id="5090535">flags</span><span class="op" id="5090540">&amp;</span><span class="ident" id="5090541">DiscardEmptyColumns</span>&nbsp;<span class="op" id="5090561">!=</span>&nbsp;<span class="num" id="5090564">0</span>&nbsp;<span class="op" id="5090566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090572">width</span>&nbsp;<span class="op" id="5090578">=</span>&nbsp;<span class="num" id="5090580">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5090591">//&nbsp;format&nbsp;and&nbsp;print&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;right&nbsp;of&nbsp;this&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5090654">//&nbsp;(we&nbsp;know&nbsp;the&nbsp;widths&nbsp;of&nbsp;this&nbsp;column&nbsp;and&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;left)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090724">b</span><span class="op" id="5090725">.</span><span class="ident" id="5090726">widths</span>&nbsp;<span class="op" id="5090733">=</span>&nbsp;<span class="builtinfunc" id="5090735">append</span><span class="op" id="5090741">(</span><span class="ident" id="5090742">b</span><span class="op" id="5090743">.</span><span class="ident" id="5090744">widths</span><span class="op" id="5090750">,</span>&nbsp;<span class="ident" id="5090752">width</span><span class="op" id="5090757">)</span>&nbsp;<span class="comment" id="5090759">//&nbsp;push&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090776">pos</span>&nbsp;<span class="op" id="5090780">=</span>&nbsp;<span class="ident" id="5090782">b</span><span class="op" id="5090783">.</span><span class="ident" id="5090784">format</span><span class="op" id="5090790">(</span><span class="ident" id="5090791">pos</span><span class="op" id="5090794">,</span>&nbsp;<span class="ident" id="5090796">line0</span><span class="op" id="5090801">,</span>&nbsp;<span class="ident" id="5090803">this</span><span class="op" id="5090807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090812">b</span><span class="op" id="5090813">.</span><span class="ident" id="5090814">widths</span>&nbsp;<span class="op" id="5090821">=</span>&nbsp;<span class="ident" id="5090823">b</span><span class="op" id="5090824">.</span><span class="ident" id="5090825">widths</span><span class="op" id="5090831">[</span><span class="num" id="5090832">0</span>&nbsp;<span class="op" id="5090834">:</span>&nbsp;<span class="builtinfunc" id="5090836">len</span><span class="op" id="5090839">(</span><span class="ident" id="5090840">b</span><span class="op" id="5090841">.</span><span class="ident" id="5090842">widths</span><span class="op" id="5090848">)</span><span class="op" id="5090849">-</span><span class="num" id="5090850">1</span><span class="op" id="5090851">]</span>&nbsp;<span class="comment" id="5090853">//&nbsp;pop&nbsp;width</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090869">line0</span>&nbsp;<span class="op" id="5090875">=</span>&nbsp;<span class="ident" id="5090877">this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5090891">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;end</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090927">return</span>&nbsp;<span class="ident" id="5090934">b</span><span class="op" id="5090935">.</span><span class="ident" id="5090936">writeLines</span><span class="op" id="5090946">(</span><span class="ident" id="5090947">pos</span><span class="op" id="5090950">,</span>&nbsp;<span class="ident" id="5090952">line0</span><span class="op" id="5090957">,</span>&nbsp;<span class="ident" id="5090959">line1</span><span class="op" id="5090964">)</span><br>
<span class="lineno"></span><span class="op" id="5090966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5090969">//&nbsp;Append&nbsp;text&nbsp;to&nbsp;current&nbsp;cell.</span><br>
<span class="lineno"></span><span class="keyword" id="5091001">func</span>&nbsp;<span class="op" id="5091006">(</span><span class="ident" id="5091007">b</span>&nbsp;<span class="op" id="5091009">*</span><span class="ident" id="5091010">Writer</span><span class="op" id="5091016">)</span>&nbsp;<span class="builtinfunc" id="5091018">append</span><span class="op" id="5091024">(</span><span class="ident" id="5091025">text</span>&nbsp;<span class="op" id="5091030">[</span><span class="op" id="5091031">]</span><span class="builtintype" id="5091032">byte</span><span class="op" id="5091036">)</span>&nbsp;<span class="op" id="5091038">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091041">b</span><span class="op" id="5091042">.</span><span class="ident" id="5091043">buf</span><span class="op" id="5091046">.</span><span class="ident" id="5091047">Write</span><span class="op" id="5091052">(</span><span class="ident" id="5091053">text</span><span class="op" id="5091057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091060">b</span><span class="op" id="5091061">.</span><span class="ident" id="5091062">cell</span><span class="op" id="5091066">.</span><span class="ident" id="5091067">size</span>&nbsp;<span class="op" id="5091072">+=</span>&nbsp;<span class="builtinfunc" id="5091075">len</span><span class="op" id="5091078">(</span><span class="ident" id="5091079">text</span><span class="op" id="5091083">)</span><br>
<span class="lineno"></span><span class="op" id="5091085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5091088">//&nbsp;Update&nbsp;the&nbsp;cell&nbsp;width.</span><br>
<span class="lineno">380</span><span class="keyword" id="5091114">func</span>&nbsp;<span class="op" id="5091119">(</span><span class="ident" id="5091120">b</span>&nbsp;<span class="op" id="5091122">*</span><span class="ident" id="5091123">Writer</span><span class="op" id="5091129">)</span>&nbsp;<span class="ident" id="5091131">updateWidth</span><span class="op" id="5091142">(</span><span class="op" id="5091143">)</span>&nbsp;<span class="op" id="5091145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091148">b</span><span class="op" id="5091149">.</span><span class="ident" id="5091150">cell</span><span class="op" id="5091154">.</span><span class="ident" id="5091155">width</span>&nbsp;<span class="op" id="5091161">+=</span>&nbsp;<span class="ident" id="5091164">utf8</span><span class="op" id="5091168">.</span><span class="ident" id="5091169">RuneCount</span><span class="op" id="5091178">(</span><span class="ident" id="5091179">b</span><span class="op" id="5091180">.</span><span class="ident" id="5091181">buf</span><span class="op" id="5091184">.</span><span class="ident" id="5091185">Bytes</span><span class="op" id="5091190">(</span><span class="op" id="5091191">)</span><span class="op" id="5091192">[</span><span class="ident" id="5091193">b</span><span class="op" id="5091194">.</span><span class="ident" id="5091195">pos</span><span class="op" id="5091198">:</span><span class="ident" id="5091199">b</span><span class="op" id="5091200">.</span><span class="ident" id="5091201">buf</span><span class="op" id="5091204">.</span><span class="ident" id="5091205">Len</span><span class="op" id="5091208">(</span><span class="op" id="5091209">)</span><span class="op" id="5091210">]</span><span class="op" id="5091211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091214">b</span><span class="op" id="5091215">.</span><span class="ident" id="5091216">pos</span>&nbsp;<span class="op" id="5091220">=</span>&nbsp;<span class="ident" id="5091222">b</span><span class="op" id="5091223">.</span><span class="ident" id="5091224">buf</span><span class="op" id="5091227">.</span><span class="ident" id="5091228">Len</span><span class="op" id="5091231">(</span><span class="op" id="5091232">)</span><br>
<span class="lineno"></span><span class="op" id="5091234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5091237">//&nbsp;To&nbsp;escape&nbsp;a&nbsp;text&nbsp;segment,&nbsp;bracket&nbsp;it&nbsp;with&nbsp;Escape&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="5091301">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;tab&nbsp;in&nbsp;this&nbsp;string&nbsp;&#34;Ignore&nbsp;this&nbsp;tab:&nbsp;\xff\t\xff&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5091371">//&nbsp;does&nbsp;not&nbsp;terminate&nbsp;a&nbsp;cell&nbsp;and&nbsp;constitutes&nbsp;a&nbsp;single&nbsp;character&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5091438">//&nbsp;width&nbsp;one&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="5091476">//</span><br>
<span class="lineno">390</span><span class="comment" id="5091479">//&nbsp;The&nbsp;value&nbsp;0xff&nbsp;was&nbsp;chosen&nbsp;because&nbsp;it&nbsp;cannot&nbsp;appear&nbsp;in&nbsp;a&nbsp;valid&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="5091560">//</span><br>
<span class="lineno"></span><span class="keyword" id="5091563">const</span>&nbsp;<span class="ident" id="5091569">Escape</span>&nbsp;<span class="op" id="5091576">=</span>&nbsp;<span class="string" id="5091578">&#39;\xff&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5091586">//&nbsp;Start&nbsp;escaped&nbsp;mode.</span><br>
<span class="lineno">395</span><span class="keyword" id="5091609">func</span>&nbsp;<span class="op" id="5091614">(</span><span class="ident" id="5091615">b</span>&nbsp;<span class="op" id="5091617">*</span><span class="ident" id="5091618">Writer</span><span class="op" id="5091624">)</span>&nbsp;<span class="ident" id="5091626">startEscape</span><span class="op" id="5091637">(</span><span class="ident" id="5091638">ch</span>&nbsp;<span class="builtintype" id="5091641">byte</span><span class="op" id="5091645">)</span>&nbsp;<span class="op" id="5091647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091650">switch</span>&nbsp;<span class="ident" id="5091657">ch</span>&nbsp;<span class="op" id="5091660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091663">case</span>&nbsp;<span class="ident" id="5091668">Escape</span><span class="op" id="5091674">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091678">b</span><span class="op" id="5091679">.</span><span class="ident" id="5091680">endChar</span>&nbsp;<span class="op" id="5091688">=</span>&nbsp;<span class="ident" id="5091690">Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091698">case</span>&nbsp;<span class="string" id="5091703">&#39;&lt;&#39;</span><span class="op" id="5091706">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091710">b</span><span class="op" id="5091711">.</span><span class="ident" id="5091712">endChar</span>&nbsp;<span class="op" id="5091720">=</span>&nbsp;<span class="string" id="5091722">&#39;&gt;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091727">case</span>&nbsp;<span class="string" id="5091732">&#39;&amp;&#39;</span><span class="op" id="5091735">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091739">b</span><span class="op" id="5091740">.</span><span class="ident" id="5091741">endChar</span>&nbsp;<span class="op" id="5091749">=</span>&nbsp;<span class="string" id="5091751">&#39;;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5091756">}</span><br>
<span class="lineno"></span><span class="op" id="5091758">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="5091761">//&nbsp;Terminate&nbsp;escaped&nbsp;mode.&nbsp;If&nbsp;the&nbsp;escaped&nbsp;text&nbsp;was&nbsp;an&nbsp;HTML&nbsp;tag,&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="5091835">//&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;for&nbsp;formatting&nbsp;purposes;&nbsp;if&nbsp;it&nbsp;was&nbsp;an&nbsp;HTML&nbsp;entity,</span><br>
<span class="lineno"></span><span class="comment" id="5091911">//&nbsp;its&nbsp;width&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;one.&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;the&nbsp;width&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5091983">//&nbsp;unicode&nbsp;width&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno">410</span><span class="comment" id="5092013">//</span><br>
<span class="lineno"></span><span class="keyword" id="5092016">func</span>&nbsp;<span class="op" id="5092021">(</span><span class="ident" id="5092022">b</span>&nbsp;<span class="op" id="5092024">*</span><span class="ident" id="5092025">Writer</span><span class="op" id="5092031">)</span>&nbsp;<span class="ident" id="5092033">endEscape</span><span class="op" id="5092042">(</span><span class="op" id="5092043">)</span>&nbsp;<span class="op" id="5092045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092048">switch</span>&nbsp;<span class="ident" id="5092055">b</span><span class="op" id="5092056">.</span><span class="ident" id="5092057">endChar</span>&nbsp;<span class="op" id="5092065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092068">case</span>&nbsp;<span class="ident" id="5092073">Escape</span><span class="op" id="5092079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092083">b</span><span class="op" id="5092084">.</span><span class="ident" id="5092085">updateWidth</span><span class="op" id="5092096">(</span><span class="op" id="5092097">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092101">if</span>&nbsp;<span class="ident" id="5092104">b</span><span class="op" id="5092105">.</span><span class="ident" id="5092106">flags</span><span class="op" id="5092111">&amp;</span><span class="ident" id="5092112">StripEscape</span>&nbsp;<span class="op" id="5092124">==</span>&nbsp;<span class="num" id="5092127">0</span>&nbsp;<span class="op" id="5092129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092134">b</span><span class="op" id="5092135">.</span><span class="ident" id="5092136">cell</span><span class="op" id="5092140">.</span><span class="ident" id="5092141">width</span>&nbsp;<span class="op" id="5092147">-=</span>&nbsp;<span class="num" id="5092150">2</span>&nbsp;<span class="comment" id="5092152">//&nbsp;don&#39;t&nbsp;count&nbsp;the&nbsp;Escape&nbsp;chars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092189">case</span>&nbsp;<span class="string" id="5092194">&#39;&gt;&#39;</span><span class="op" id="5092197">:</span>&nbsp;<span class="comment" id="5092199">//&nbsp;tag&nbsp;of&nbsp;zero&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092221">case</span>&nbsp;<span class="string" id="5092226">&#39;;&#39;</span><span class="op" id="5092229">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092233">b</span><span class="op" id="5092234">.</span><span class="ident" id="5092235">cell</span><span class="op" id="5092239">.</span><span class="ident" id="5092240">width</span><span class="op" id="5092245">++</span>&nbsp;<span class="comment" id="5092248">//&nbsp;entity,&nbsp;count&nbsp;as&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092281">b</span><span class="op" id="5092282">.</span><span class="ident" id="5092283">pos</span>&nbsp;<span class="op" id="5092287">=</span>&nbsp;<span class="ident" id="5092289">b</span><span class="op" id="5092290">.</span><span class="ident" id="5092291">buf</span><span class="op" id="5092294">.</span><span class="ident" id="5092295">Len</span><span class="op" id="5092298">(</span><span class="op" id="5092299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092302">b</span><span class="op" id="5092303">.</span><span class="ident" id="5092304">endChar</span>&nbsp;<span class="op" id="5092312">=</span>&nbsp;<span class="num" id="5092314">0</span><br>
<span class="lineno"></span><span class="op" id="5092316">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="5092319">//&nbsp;Terminate&nbsp;the&nbsp;current&nbsp;cell&nbsp;by&nbsp;adding&nbsp;it&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;cells&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5092390">//&nbsp;current&nbsp;line.&nbsp;Returns&nbsp;the&nbsp;number&nbsp;of&nbsp;cells&nbsp;in&nbsp;that&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="5092449">//</span><br>
<span class="lineno"></span><span class="keyword" id="5092452">func</span>&nbsp;<span class="op" id="5092457">(</span><span class="ident" id="5092458">b</span>&nbsp;<span class="op" id="5092460">*</span><span class="ident" id="5092461">Writer</span><span class="op" id="5092467">)</span>&nbsp;<span class="ident" id="5092469">terminateCell</span><span class="op" id="5092482">(</span><span class="ident" id="5092483">htab</span>&nbsp;<span class="builtintype" id="5092488">bool</span><span class="op" id="5092492">)</span>&nbsp;<span class="builtintype" id="5092494">int</span>&nbsp;<span class="op" id="5092498">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092501">b</span><span class="op" id="5092502">.</span><span class="ident" id="5092503">cell</span><span class="op" id="5092507">.</span><span class="ident" id="5092508">htab</span>&nbsp;<span class="op" id="5092513">=</span>&nbsp;<span class="ident" id="5092515">htab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092521">line</span>&nbsp;<span class="op" id="5092526">:=</span>&nbsp;<span class="op" id="5092529">&amp;</span><span class="ident" id="5092530">b</span><span class="op" id="5092531">.</span><span class="ident" id="5092532">lines</span><span class="op" id="5092537">[</span><span class="builtinfunc" id="5092538">len</span><span class="op" id="5092541">(</span><span class="ident" id="5092542">b</span><span class="op" id="5092543">.</span><span class="ident" id="5092544">lines</span><span class="op" id="5092549">)</span><span class="op" id="5092550">-</span><span class="num" id="5092551">1</span><span class="op" id="5092552">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092555">*</span><span class="ident" id="5092556">line</span>&nbsp;<span class="op" id="5092561">=</span>&nbsp;<span class="builtinfunc" id="5092563">append</span><span class="op" id="5092569">(</span><span class="op" id="5092570">*</span><span class="ident" id="5092571">line</span><span class="op" id="5092575">,</span>&nbsp;<span class="ident" id="5092577">b</span><span class="op" id="5092578">.</span><span class="ident" id="5092579">cell</span><span class="op" id="5092583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092586">b</span><span class="op" id="5092587">.</span><span class="ident" id="5092588">cell</span>&nbsp;<span class="op" id="5092593">=</span>&nbsp;<span class="ident" id="5092595">cell</span><span class="op" id="5092599">{</span><span class="op" id="5092600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092603">return</span>&nbsp;<span class="builtinfunc" id="5092610">len</span><span class="op" id="5092613">(</span><span class="op" id="5092614">*</span><span class="ident" id="5092615">line</span><span class="op" id="5092619">)</span><br>
<span class="lineno">435</span><span class="op" id="5092621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5092624">func</span>&nbsp;<span class="ident" id="5092629">handlePanic</span><span class="op" id="5092640">(</span><span class="ident" id="5092641">err</span>&nbsp;<span class="op" id="5092645">*</span><span class="builtintype" id="5092646">error</span><span class="op" id="5092651">,</span>&nbsp;<span class="ident" id="5092653">op</span>&nbsp;<span class="builtintype" id="5092656">string</span><span class="op" id="5092662">)</span>&nbsp;<span class="op" id="5092664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092667">if</span>&nbsp;<span class="ident" id="5092670">e</span>&nbsp;<span class="op" id="5092672">:=</span>&nbsp;<span class="builtinfunc" id="5092675">recover</span><span class="op" id="5092682">(</span><span class="op" id="5092683">)</span><span class="op" id="5092684">;</span>&nbsp;<span class="ident" id="5092686">e</span>&nbsp;<span class="op" id="5092688">!=</span>&nbsp;<span class="ident" id="5092691">nil</span>&nbsp;<span class="op" id="5092695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092699">if</span>&nbsp;<span class="ident" id="5092702">nerr</span><span class="op" id="5092706">,</span>&nbsp;<span class="ident" id="5092708">ok</span>&nbsp;<span class="op" id="5092711">:=</span>&nbsp;<span class="ident" id="5092714">e</span><span class="op" id="5092715">.</span><span class="op" id="5092716">(</span><span class="ident" id="5092717">osError</span><span class="op" id="5092724">)</span><span class="op" id="5092725">;</span>&nbsp;<span class="ident" id="5092727">ok</span>&nbsp;<span class="op" id="5092730">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092735">*</span><span class="ident" id="5092736">err</span>&nbsp;<span class="op" id="5092740">=</span>&nbsp;<span class="ident" id="5092742">nerr</span><span class="op" id="5092746">.</span><span class="ident" id="5092747">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092754">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5092767">panic</span><span class="op" id="5092772">(</span><span class="string" id="5092773">&#34;tabwriter:&nbsp;panic&nbsp;during&nbsp;&#34;</span>&nbsp;<span class="op" id="5092800">+</span>&nbsp;<span class="ident" id="5092802">op</span><span class="op" id="5092804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092807">}</span><br>
<span class="lineno">445</span><span class="op" id="5092809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5092812">//&nbsp;Flush&nbsp;should&nbsp;be&nbsp;called&nbsp;after&nbsp;the&nbsp;last&nbsp;call&nbsp;to&nbsp;Write&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="5092877">//&nbsp;that&nbsp;any&nbsp;data&nbsp;buffered&nbsp;in&nbsp;the&nbsp;Writer&nbsp;is&nbsp;written&nbsp;to&nbsp;output.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="5092943">//&nbsp;incomplete&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;end&nbsp;is&nbsp;considered</span><br>
<span class="lineno">450</span><span class="comment" id="5092998">//&nbsp;complete&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="5093035">//</span><br>
<span class="lineno"></span><span class="keyword" id="5093038">func</span>&nbsp;<span class="op" id="5093043">(</span><span class="ident" id="5093044">b</span>&nbsp;<span class="op" id="5093046">*</span><span class="ident" id="5093047">Writer</span><span class="op" id="5093053">)</span>&nbsp;<span class="ident" id="5093055">Flush</span><span class="op" id="5093060">(</span><span class="op" id="5093061">)</span>&nbsp;<span class="op" id="5093063">(</span><span class="ident" id="5093064">err</span>&nbsp;<span class="builtintype" id="5093068">error</span><span class="op" id="5093073">)</span>&nbsp;<span class="op" id="5093075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093078">defer</span>&nbsp;<span class="ident" id="5093084">b</span><span class="op" id="5093085">.</span><span class="ident" id="5093086">reset</span><span class="op" id="5093091">(</span><span class="op" id="5093092">)</span>&nbsp;<span class="comment" id="5093094">//&nbsp;even&nbsp;in&nbsp;the&nbsp;presence&nbsp;of&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093129">defer</span>&nbsp;<span class="ident" id="5093135">handlePanic</span><span class="op" id="5093146">(</span><span class="op" id="5093147">&amp;</span><span class="ident" id="5093148">err</span><span class="op" id="5093151">,</span>&nbsp;<span class="string" id="5093153">&#34;Flush&#34;</span><span class="op" id="5093160">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093164">//&nbsp;add&nbsp;current&nbsp;cell&nbsp;if&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093198">if</span>&nbsp;<span class="ident" id="5093201">b</span><span class="op" id="5093202">.</span><span class="ident" id="5093203">cell</span><span class="op" id="5093207">.</span><span class="ident" id="5093208">size</span>&nbsp;<span class="op" id="5093213">&gt;</span>&nbsp;<span class="num" id="5093215">0</span>&nbsp;<span class="op" id="5093217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093221">if</span>&nbsp;<span class="ident" id="5093224">b</span><span class="op" id="5093225">.</span><span class="ident" id="5093226">endChar</span>&nbsp;<span class="op" id="5093234">!=</span>&nbsp;<span class="num" id="5093237">0</span>&nbsp;<span class="op" id="5093239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093244">//&nbsp;inside&nbsp;escape&nbsp;-&nbsp;terminate&nbsp;it&nbsp;even&nbsp;if&nbsp;incomplete</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093298">b</span><span class="op" id="5093299">.</span><span class="ident" id="5093300">endEscape</span><span class="op" id="5093309">(</span><span class="op" id="5093310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5093314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093318">b</span><span class="op" id="5093319">.</span><span class="ident" id="5093320">terminateCell</span><span class="op" id="5093333">(</span><span class="builtintype" id="5093334">false</span><span class="op" id="5093339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5093342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093346">//&nbsp;format&nbsp;contents&nbsp;of&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093376">b</span><span class="op" id="5093377">.</span><span class="ident" id="5093378">format</span><span class="op" id="5093384">(</span><span class="num" id="5093385">0</span><span class="op" id="5093386">,</span>&nbsp;<span class="num" id="5093388">0</span><span class="op" id="5093389">,</span>&nbsp;<span class="builtinfunc" id="5093391">len</span><span class="op" id="5093394">(</span><span class="ident" id="5093395">b</span><span class="op" id="5093396">.</span><span class="ident" id="5093397">lines</span><span class="op" id="5093402">)</span><span class="op" id="5093403">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093407">return</span><br>
<span class="lineno"></span><span class="op" id="5093414">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="5093417">var</span>&nbsp;<span class="ident" id="5093421">hbar</span>&nbsp;<span class="op" id="5093426">=</span>&nbsp;<span class="op" id="5093428">[</span><span class="op" id="5093429">]</span><span class="builtintype" id="5093430">byte</span><span class="op" id="5093434">(</span><span class="string" id="5093435">&#34;---\n&#34;</span><span class="op" id="5093442">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5093445">//&nbsp;Write&nbsp;writes&nbsp;buf&nbsp;to&nbsp;the&nbsp;writer&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="5093482">//&nbsp;The&nbsp;only&nbsp;errors&nbsp;returned&nbsp;are&nbsp;ones&nbsp;encountered</span><br>
<span class="lineno">475</span><span class="comment" id="5093531">//&nbsp;while&nbsp;writing&nbsp;to&nbsp;the&nbsp;underlying&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="5093581">//</span><br>
<span class="lineno"></span><span class="keyword" id="5093584">func</span>&nbsp;<span class="op" id="5093589">(</span><span class="ident" id="5093590">b</span>&nbsp;<span class="op" id="5093592">*</span><span class="ident" id="5093593">Writer</span><span class="op" id="5093599">)</span>&nbsp;<span class="ident" id="5093601">Write</span><span class="op" id="5093606">(</span><span class="ident" id="5093607">buf</span>&nbsp;<span class="op" id="5093611">[</span><span class="op" id="5093612">]</span><span class="builtintype" id="5093613">byte</span><span class="op" id="5093617">)</span>&nbsp;<span class="op" id="5093619">(</span><span class="ident" id="5093620">n</span>&nbsp;<span class="builtintype" id="5093622">int</span><span class="op" id="5093625">,</span>&nbsp;<span class="ident" id="5093627">err</span>&nbsp;<span class="builtintype" id="5093631">error</span><span class="op" id="5093636">)</span>&nbsp;<span class="op" id="5093638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093641">defer</span>&nbsp;<span class="ident" id="5093647">handlePanic</span><span class="op" id="5093658">(</span><span class="op" id="5093659">&amp;</span><span class="ident" id="5093660">err</span><span class="op" id="5093663">,</span>&nbsp;<span class="string" id="5093665">&#34;Write&#34;</span><span class="op" id="5093672">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093676">//&nbsp;split&nbsp;text&nbsp;into&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093702">n</span>&nbsp;<span class="op" id="5093704">=</span>&nbsp;<span class="num" id="5093706">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093709">for</span>&nbsp;<span class="ident" id="5093713">i</span><span class="op" id="5093714">,</span>&nbsp;<span class="ident" id="5093716">ch</span>&nbsp;<span class="op" id="5093719">:=</span>&nbsp;<span class="keyword" id="5093722">range</span>&nbsp;<span class="ident" id="5093728">buf</span>&nbsp;<span class="op" id="5093732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093736">if</span>&nbsp;<span class="ident" id="5093739">b</span><span class="op" id="5093740">.</span><span class="ident" id="5093741">endChar</span>&nbsp;<span class="op" id="5093749">==</span>&nbsp;<span class="num" id="5093752">0</span>&nbsp;<span class="op" id="5093754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093759">//&nbsp;outside&nbsp;escape</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093780">switch</span>&nbsp;<span class="ident" id="5093787">ch</span>&nbsp;<span class="op" id="5093790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093795">case</span>&nbsp;<span class="string" id="5093800">&#39;\t&#39;</span><span class="op" id="5093804">,</span>&nbsp;<span class="string" id="5093806">&#39;\v&#39;</span><span class="op" id="5093810">,</span>&nbsp;<span class="string" id="5093812">&#39;\n&#39;</span><span class="op" id="5093816">,</span>&nbsp;<span class="string" id="5093818">&#39;\f&#39;</span><span class="op" id="5093822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093828">//&nbsp;end&nbsp;of&nbsp;cell</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093847">b</span><span class="op" id="5093848">.</span><span class="builtinfunc" id="5093849">append</span><span class="op" id="5093855">(</span><span class="ident" id="5093856">buf</span><span class="op" id="5093859">[</span><span class="ident" id="5093860">n</span><span class="op" id="5093861">:</span><span class="ident" id="5093862">i</span><span class="op" id="5093863">]</span><span class="op" id="5093864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093870">b</span><span class="op" id="5093871">.</span><span class="ident" id="5093872">updateWidth</span><span class="op" id="5093883">(</span><span class="op" id="5093884">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093890">n</span>&nbsp;<span class="op" id="5093892">=</span>&nbsp;<span class="ident" id="5093894">i</span>&nbsp;<span class="op" id="5093896">+</span>&nbsp;<span class="num" id="5093898">1</span>&nbsp;<span class="comment" id="5093900">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093919">ncells</span>&nbsp;<span class="op" id="5093926">:=</span>&nbsp;<span class="ident" id="5093929">b</span><span class="op" id="5093930">.</span><span class="ident" id="5093931">terminateCell</span><span class="op" id="5093944">(</span><span class="ident" id="5093945">ch</span>&nbsp;<span class="op" id="5093948">==</span>&nbsp;<span class="string" id="5093951">&#39;\t&#39;</span><span class="op" id="5093955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093961">if</span>&nbsp;<span class="ident" id="5093964">ch</span>&nbsp;<span class="op" id="5093967">==</span>&nbsp;<span class="string" id="5093970">&#39;\n&#39;</span>&nbsp;<span class="op" id="5093975">||</span>&nbsp;<span class="ident" id="5093978">ch</span>&nbsp;<span class="op" id="5093981">==</span>&nbsp;<span class="string" id="5093984">&#39;\f&#39;</span>&nbsp;<span class="op" id="5093989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093996">//&nbsp;terminate&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094019">b</span><span class="op" id="5094020">.</span><span class="ident" id="5094021">addLine</span><span class="op" id="5094028">(</span><span class="op" id="5094029">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094036">if</span>&nbsp;<span class="ident" id="5094039">ch</span>&nbsp;<span class="op" id="5094042">==</span>&nbsp;<span class="string" id="5094045">&#39;\f&#39;</span>&nbsp;<span class="op" id="5094050">||</span>&nbsp;<span class="ident" id="5094053">ncells</span>&nbsp;<span class="op" id="5094060">==</span>&nbsp;<span class="num" id="5094063">1</span>&nbsp;<span class="op" id="5094065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094073">//&nbsp;A&nbsp;&#39;\f&#39;&nbsp;always&nbsp;forces&nbsp;a&nbsp;flush.&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;previous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094139">//&nbsp;line&nbsp;has&nbsp;only&nbsp;one&nbsp;cell&nbsp;which&nbsp;does&nbsp;not&nbsp;have&nbsp;an&nbsp;impact&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094204">//&nbsp;the&nbsp;formatting&nbsp;of&nbsp;the&nbsp;following&nbsp;lines&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094270">//&nbsp;line&nbsp;is&nbsp;ignored&nbsp;by&nbsp;format()),&nbsp;thus&nbsp;we&nbsp;can&nbsp;flush&nbsp;the</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094331">//&nbsp;Writer&nbsp;contents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094357">if</span>&nbsp;<span class="ident" id="5094360">err</span>&nbsp;<span class="op" id="5094364">=</span>&nbsp;<span class="ident" id="5094366">b</span><span class="op" id="5094367">.</span><span class="ident" id="5094368">Flush</span><span class="op" id="5094373">(</span><span class="op" id="5094374">)</span><span class="op" id="5094375">;</span>&nbsp;<span class="ident" id="5094377">err</span>&nbsp;<span class="op" id="5094381">!=</span>&nbsp;<span class="ident" id="5094384">nil</span>&nbsp;<span class="op" id="5094388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094397">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094418">if</span>&nbsp;<span class="ident" id="5094421">ch</span>&nbsp;<span class="op" id="5094424">==</span>&nbsp;<span class="string" id="5094427">&#39;\f&#39;</span>&nbsp;<span class="op" id="5094432">&amp;&amp;</span>&nbsp;<span class="ident" id="5094435">b</span><span class="op" id="5094436">.</span><span class="ident" id="5094437">flags</span><span class="op" id="5094442">&amp;</span><span class="ident" id="5094443">Debug</span>&nbsp;<span class="op" id="5094449">!=</span>&nbsp;<span class="num" id="5094452">0</span>&nbsp;<span class="op" id="5094454">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094463">//&nbsp;indicate&nbsp;section&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094496">b</span><span class="op" id="5094497">.</span><span class="ident" id="5094498">write0</span><span class="op" id="5094504">(</span><span class="ident" id="5094505">hbar</span><span class="op" id="5094509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094530">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094536">case</span>&nbsp;<span class="ident" id="5094541">Escape</span><span class="op" id="5094547">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094553">//&nbsp;start&nbsp;of&nbsp;escaped&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094586">b</span><span class="op" id="5094587">.</span><span class="builtinfunc" id="5094588">append</span><span class="op" id="5094594">(</span><span class="ident" id="5094595">buf</span><span class="op" id="5094598">[</span><span class="ident" id="5094599">n</span><span class="op" id="5094600">:</span><span class="ident" id="5094601">i</span><span class="op" id="5094602">]</span><span class="op" id="5094603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094609">b</span><span class="op" id="5094610">.</span><span class="ident" id="5094611">updateWidth</span><span class="op" id="5094622">(</span><span class="op" id="5094623">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094629">n</span>&nbsp;<span class="op" id="5094631">=</span>&nbsp;<span class="ident" id="5094633">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094639">if</span>&nbsp;<span class="ident" id="5094642">b</span><span class="op" id="5094643">.</span><span class="ident" id="5094644">flags</span><span class="op" id="5094649">&amp;</span><span class="ident" id="5094650">StripEscape</span>&nbsp;<span class="op" id="5094662">!=</span>&nbsp;<span class="num" id="5094665">0</span>&nbsp;<span class="op" id="5094667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094674">n</span><span class="op" id="5094675">++</span>&nbsp;<span class="comment" id="5094678">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094704">b</span><span class="op" id="5094705">.</span><span class="ident" id="5094706">startEscape</span><span class="op" id="5094717">(</span><span class="ident" id="5094718">Escape</span><span class="op" id="5094724">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094730">case</span>&nbsp;<span class="string" id="5094735">&#39;&lt;&#39;</span><span class="op" id="5094738">,</span>&nbsp;<span class="string" id="5094740">&#39;&amp;&#39;</span><span class="op" id="5094743">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094749">//&nbsp;possibly&nbsp;an&nbsp;html&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094784">if</span>&nbsp;<span class="ident" id="5094787">b</span><span class="op" id="5094788">.</span><span class="ident" id="5094789">flags</span><span class="op" id="5094794">&amp;</span><span class="ident" id="5094795">FilterHTML</span>&nbsp;<span class="op" id="5094806">!=</span>&nbsp;<span class="num" id="5094809">0</span>&nbsp;<span class="op" id="5094811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094818">//&nbsp;begin&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094846">b</span><span class="op" id="5094847">.</span><span class="builtinfunc" id="5094848">append</span><span class="op" id="5094854">(</span><span class="ident" id="5094855">buf</span><span class="op" id="5094858">[</span><span class="ident" id="5094859">n</span><span class="op" id="5094860">:</span><span class="ident" id="5094861">i</span><span class="op" id="5094862">]</span><span class="op" id="5094863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094870">b</span><span class="op" id="5094871">.</span><span class="ident" id="5094872">updateWidth</span><span class="op" id="5094883">(</span><span class="op" id="5094884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094891">n</span>&nbsp;<span class="op" id="5094893">=</span>&nbsp;<span class="ident" id="5094895">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094902">b</span><span class="op" id="5094903">.</span><span class="ident" id="5094904">startEscape</span><span class="op" id="5094915">(</span><span class="ident" id="5094916">ch</span><span class="op" id="5094918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094924">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094934">}</span>&nbsp;<span class="keyword" id="5094936">else</span>&nbsp;<span class="op" id="5094941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094946">//&nbsp;inside&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094966">if</span>&nbsp;<span class="ident" id="5094969">ch</span>&nbsp;<span class="op" id="5094972">==</span>&nbsp;<span class="ident" id="5094975">b</span><span class="op" id="5094976">.</span><span class="ident" id="5094977">endChar</span>&nbsp;<span class="op" id="5094985">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094991">//&nbsp;end&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095016">j</span>&nbsp;<span class="op" id="5095018">:=</span>&nbsp;<span class="ident" id="5095021">i</span>&nbsp;<span class="op" id="5095023">+</span>&nbsp;<span class="num" id="5095025">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095031">if</span>&nbsp;<span class="ident" id="5095034">ch</span>&nbsp;<span class="op" id="5095037">==</span>&nbsp;<span class="ident" id="5095040">Escape</span>&nbsp;<span class="op" id="5095047">&amp;&amp;</span>&nbsp;<span class="ident" id="5095050">b</span><span class="op" id="5095051">.</span><span class="ident" id="5095052">flags</span><span class="op" id="5095057">&amp;</span><span class="ident" id="5095058">StripEscape</span>&nbsp;<span class="op" id="5095070">!=</span>&nbsp;<span class="num" id="5095073">0</span>&nbsp;<span class="op" id="5095075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095082">j</span>&nbsp;<span class="op" id="5095084">=</span>&nbsp;<span class="ident" id="5095086">i</span>&nbsp;<span class="comment" id="5095088">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095108">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095114">b</span><span class="op" id="5095115">.</span><span class="builtinfunc" id="5095116">append</span><span class="op" id="5095122">(</span><span class="ident" id="5095123">buf</span><span class="op" id="5095126">[</span><span class="ident" id="5095127">n</span><span class="op" id="5095128">:</span><span class="ident" id="5095129">j</span><span class="op" id="5095130">]</span><span class="op" id="5095131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095137">n</span>&nbsp;<span class="op" id="5095139">=</span>&nbsp;<span class="ident" id="5095141">i</span>&nbsp;<span class="op" id="5095143">+</span>&nbsp;<span class="num" id="5095145">1</span>&nbsp;<span class="comment" id="5095147">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095166">b</span><span class="op" id="5095167">.</span><span class="ident" id="5095168">endEscape</span><span class="op" id="5095177">(</span><span class="op" id="5095178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095187">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5095194">//&nbsp;append&nbsp;leftover&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095219">b</span><span class="op" id="5095220">.</span><span class="builtinfunc" id="5095221">append</span><span class="op" id="5095227">(</span><span class="ident" id="5095228">buf</span><span class="op" id="5095231">[</span><span class="ident" id="5095232">n</span><span class="op" id="5095233">:</span><span class="op" id="5095234">]</span><span class="op" id="5095235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095238">n</span>&nbsp;<span class="op" id="5095240">=</span>&nbsp;<span class="builtinfunc" id="5095242">len</span><span class="op" id="5095245">(</span><span class="ident" id="5095246">buf</span><span class="op" id="5095249">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095252">return</span><br>
<span class="lineno"></span><span class="op" id="5095259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5095262">//&nbsp;NewWriter&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;tabwriter.Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5095325">//&nbsp;The&nbsp;parameters&nbsp;are&nbsp;the&nbsp;same&nbsp;as&nbsp;for&nbsp;the&nbsp;Init&nbsp;function.</span><br>
<span class="lineno">555</span><span class="comment" id="5095382">//</span><br>
<span class="lineno"></span><span class="keyword" id="5095385">func</span>&nbsp;<span class="ident" id="5095390">NewWriter</span><span class="op" id="5095399">(</span><span class="ident" id="5095400">output</span>&nbsp;<span class="ident" id="5095407">io</span><span class="op" id="5095409">.</span><span class="ident" id="5095410">Writer</span><span class="op" id="5095416">,</span>&nbsp;<span class="ident" id="5095418">minwidth</span><span class="op" id="5095426">,</span>&nbsp;<span class="ident" id="5095428">tabwidth</span><span class="op" id="5095436">,</span>&nbsp;<span class="ident" id="5095438">padding</span>&nbsp;<span class="builtintype" id="5095446">int</span><span class="op" id="5095449">,</span>&nbsp;<span class="ident" id="5095451">padchar</span>&nbsp;<span class="builtintype" id="5095459">byte</span><span class="op" id="5095463">,</span>&nbsp;<span class="ident" id="5095465">flags</span>&nbsp;<span class="builtintype" id="5095471">uint</span><span class="op" id="5095475">)</span>&nbsp;<span class="op" id="5095477">*</span><span class="ident" id="5095478">Writer</span>&nbsp;<span class="op" id="5095485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095488">return</span>&nbsp;<span class="builtinfunc" id="5095495">new</span><span class="op" id="5095498">(</span><span class="ident" id="5095499">Writer</span><span class="op" id="5095505">)</span><span class="op" id="5095506">.</span><span class="ident" id="5095507">Init</span><span class="op" id="5095511">(</span><span class="ident" id="5095512">output</span><span class="op" id="5095518">,</span>&nbsp;<span class="ident" id="5095520">minwidth</span><span class="op" id="5095528">,</span>&nbsp;<span class="ident" id="5095530">tabwidth</span><span class="op" id="5095538">,</span>&nbsp;<span class="ident" id="5095540">padding</span><span class="op" id="5095547">,</span>&nbsp;<span class="ident" id="5095549">padchar</span><span class="op" id="5095556">,</span>&nbsp;<span class="ident" id="5095558">flags</span><span class="op" id="5095563">)</span><br>
<span class="lineno"></span><span class="op" id="5095565">}</span>
</div>
</body>
</html>
