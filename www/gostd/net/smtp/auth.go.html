<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6160941">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6160996">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6161050">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6161101">package</span>&nbsp;<span class="ident" id="6161109">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6161115">import</span>&nbsp;<span class="op" id="6161122">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6161125">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6161140">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6161154">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6161164">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="6161170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6161173">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="6161233">type</span>&nbsp;<span class="ident" id="6161238">Auth</span>&nbsp;<span class="keyword" id="6161243">interface</span>&nbsp;<span class="op" id="6161253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161256">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161306">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161361">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161424">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161486">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161533">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161591">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6161649">Start</span><span class="op" id="6161654">(</span><span class="ident" id="6161655">server</span>&nbsp;<span class="op" id="6161662">*</span><span class="ident" id="6161663">ServerInfo</span><span class="op" id="6161673">)</span>&nbsp;<span class="op" id="6161675">(</span><span class="ident" id="6161676">proto</span>&nbsp;<span class="builtintype" id="6161682">string</span><span class="op" id="6161688">,</span>&nbsp;<span class="ident" id="6161690">toServer</span>&nbsp;<span class="op" id="6161699">[</span><span class="op" id="6161700">]</span><span class="builtintype" id="6161701">byte</span><span class="op" id="6161705">,</span>&nbsp;<span class="ident" id="6161707">err</span>&nbsp;<span class="builtintype" id="6161711">error</span><span class="op" id="6161716">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161720">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161784">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161847">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161909">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161949">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6162009">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162067">Next</span><span class="op" id="6162071">(</span><span class="ident" id="6162072">fromServer</span>&nbsp;<span class="op" id="6162083">[</span><span class="op" id="6162084">]</span><span class="builtintype" id="6162085">byte</span><span class="op" id="6162089">,</span>&nbsp;<span class="ident" id="6162091">more</span>&nbsp;<span class="builtintype" id="6162096">bool</span><span class="op" id="6162100">)</span>&nbsp;<span class="op" id="6162102">(</span><span class="ident" id="6162103">toServer</span>&nbsp;<span class="op" id="6162112">[</span><span class="op" id="6162113">]</span><span class="builtintype" id="6162114">byte</span><span class="op" id="6162118">,</span>&nbsp;<span class="ident" id="6162120">err</span>&nbsp;<span class="builtintype" id="6162124">error</span><span class="op" id="6162129">)</span><br>
<span class="lineno"></span><span class="op" id="6162131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6162134">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="6162190">type</span>&nbsp;<span class="ident" id="6162195">ServerInfo</span>&nbsp;<span class="keyword" id="6162206">struct</span>&nbsp;<span class="op" id="6162213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162216">Name</span>&nbsp;<span class="builtintype" id="6162221">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6162230">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162251">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="6162256">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6162265">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162312">Auth</span>&nbsp;<span class="op" id="6162317">[</span><span class="op" id="6162318">]</span><span class="builtintype" id="6162319">string</span>&nbsp;<span class="comment" id="6162326">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="6162366">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6162369">type</span>&nbsp;<span class="ident" id="6162374">plainAuth</span>&nbsp;<span class="keyword" id="6162384">struct</span>&nbsp;<span class="op" id="6162391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162394">identity</span><span class="op" id="6162402">,</span>&nbsp;<span class="ident" id="6162404">username</span><span class="op" id="6162412">,</span>&nbsp;<span class="ident" id="6162414">password</span>&nbsp;<span class="builtintype" id="6162423">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162431">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6162460">string</span><br>
<span class="lineno"></span><span class="op" id="6162467">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6162470">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6162540">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="6162577">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="6162651">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="6162727">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="6162761">func</span>&nbsp;<span class="ident" id="6162766">PlainAuth</span><span class="op" id="6162775">(</span><span class="ident" id="6162776">identity</span><span class="op" id="6162784">,</span>&nbsp;<span class="ident" id="6162786">username</span><span class="op" id="6162794">,</span>&nbsp;<span class="ident" id="6162796">password</span><span class="op" id="6162804">,</span>&nbsp;<span class="ident" id="6162806">host</span>&nbsp;<span class="builtintype" id="6162811">string</span><span class="op" id="6162817">)</span>&nbsp;<span class="ident" id="6162819">Auth</span>&nbsp;<span class="op" id="6162824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162827">return</span>&nbsp;<span class="op" id="6162834">&amp;</span><span class="ident" id="6162835">plainAuth</span><span class="op" id="6162844">{</span><span class="ident" id="6162845">identity</span><span class="op" id="6162853">,</span>&nbsp;<span class="ident" id="6162855">username</span><span class="op" id="6162863">,</span>&nbsp;<span class="ident" id="6162865">password</span><span class="op" id="6162873">,</span>&nbsp;<span class="ident" id="6162875">host</span><span class="op" id="6162879">}</span><br>
<span class="lineno"></span><span class="op" id="6162881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6162884">func</span>&nbsp;<span class="op" id="6162889">(</span><span class="ident" id="6162890">a</span>&nbsp;<span class="op" id="6162892">*</span><span class="ident" id="6162893">plainAuth</span><span class="op" id="6162902">)</span>&nbsp;<span class="ident" id="6162904">Start</span><span class="op" id="6162909">(</span><span class="ident" id="6162910">server</span>&nbsp;<span class="op" id="6162917">*</span><span class="ident" id="6162918">ServerInfo</span><span class="op" id="6162928">)</span>&nbsp;<span class="op" id="6162930">(</span><span class="builtintype" id="6162931">string</span><span class="op" id="6162937">,</span>&nbsp;<span class="op" id="6162939">[</span><span class="op" id="6162940">]</span><span class="builtintype" id="6162941">byte</span><span class="op" id="6162945">,</span>&nbsp;<span class="builtintype" id="6162947">error</span><span class="op" id="6162952">)</span>&nbsp;<span class="op" id="6162954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162957">if</span>&nbsp;<span class="op" id="6162960">!</span><span class="ident" id="6162961">server</span><span class="op" id="6162967">.</span><span class="ident" id="6162968">TLS</span>&nbsp;<span class="op" id="6162972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162976">advertised</span>&nbsp;<span class="op" id="6162987">:=</span>&nbsp;<span class="builtintype" id="6162990">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162998">for</span>&nbsp;<span class="ident" id="6163002">_</span><span class="op" id="6163003">,</span>&nbsp;<span class="ident" id="6163005">mechanism</span>&nbsp;<span class="op" id="6163015">:=</span>&nbsp;<span class="keyword" id="6163018">range</span>&nbsp;<span class="ident" id="6163024">server</span><span class="op" id="6163030">.</span><span class="ident" id="6163031">Auth</span>&nbsp;<span class="op" id="6163036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163041">if</span>&nbsp;<span class="ident" id="6163044">mechanism</span>&nbsp;<span class="op" id="6163054">==</span>&nbsp;<span class="string" id="6163057">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="6163065">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163071">advertised</span>&nbsp;<span class="op" id="6163082">=</span>&nbsp;<span class="builtintype" id="6163084">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163093">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6163102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6163106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163110">if</span>&nbsp;<span class="op" id="6163113">!</span><span class="ident" id="6163114">advertised</span>&nbsp;<span class="op" id="6163125">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163130">return</span>&nbsp;<span class="string" id="6163137">&#34;&#34;</span><span class="op" id="6163139">,</span>&nbsp;<span class="ident" id="6163141">nil</span><span class="op" id="6163144">,</span>&nbsp;<span class="ident" id="6163146">errors</span><span class="op" id="6163152">.</span><span class="ident" id="6163153">New</span><span class="op" id="6163156">(</span><span class="string" id="6163157">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="6163181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6163185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6163188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163191">if</span>&nbsp;<span class="ident" id="6163194">server</span><span class="op" id="6163200">.</span><span class="ident" id="6163201">Name</span>&nbsp;<span class="op" id="6163206">!=</span>&nbsp;<span class="ident" id="6163209">a</span><span class="op" id="6163210">.</span><span class="ident" id="6163211">host</span>&nbsp;<span class="op" id="6163216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163220">return</span>&nbsp;<span class="string" id="6163227">&#34;&#34;</span><span class="op" id="6163229">,</span>&nbsp;<span class="ident" id="6163231">nil</span><span class="op" id="6163234">,</span>&nbsp;<span class="ident" id="6163236">errors</span><span class="op" id="6163242">.</span><span class="ident" id="6163243">New</span><span class="op" id="6163246">(</span><span class="string" id="6163247">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="6163264">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6163267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163270">resp</span>&nbsp;<span class="op" id="6163275">:=</span>&nbsp;<span class="op" id="6163278">[</span><span class="op" id="6163279">]</span><span class="builtintype" id="6163280">byte</span><span class="op" id="6163284">(</span><span class="ident" id="6163285">a</span><span class="op" id="6163286">.</span><span class="ident" id="6163287">identity</span>&nbsp;<span class="op" id="6163296">+</span>&nbsp;<span class="string" id="6163298">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6163305">+</span>&nbsp;<span class="ident" id="6163307">a</span><span class="op" id="6163308">.</span><span class="ident" id="6163309">username</span>&nbsp;<span class="op" id="6163318">+</span>&nbsp;<span class="string" id="6163320">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6163327">+</span>&nbsp;<span class="ident" id="6163329">a</span><span class="op" id="6163330">.</span><span class="ident" id="6163331">password</span><span class="op" id="6163339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163342">return</span>&nbsp;<span class="string" id="6163349">&#34;PLAIN&#34;</span><span class="op" id="6163356">,</span>&nbsp;<span class="ident" id="6163358">resp</span><span class="op" id="6163362">,</span>&nbsp;<span class="ident" id="6163364">nil</span><br>
<span class="lineno"></span><span class="op" id="6163368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6163371">func</span>&nbsp;<span class="op" id="6163376">(</span><span class="ident" id="6163377">a</span>&nbsp;<span class="op" id="6163379">*</span><span class="ident" id="6163380">plainAuth</span><span class="op" id="6163389">)</span>&nbsp;<span class="ident" id="6163391">Next</span><span class="op" id="6163395">(</span><span class="ident" id="6163396">fromServer</span>&nbsp;<span class="op" id="6163407">[</span><span class="op" id="6163408">]</span><span class="builtintype" id="6163409">byte</span><span class="op" id="6163413">,</span>&nbsp;<span class="ident" id="6163415">more</span>&nbsp;<span class="builtintype" id="6163420">bool</span><span class="op" id="6163424">)</span>&nbsp;<span class="op" id="6163426">(</span><span class="op" id="6163427">[</span><span class="op" id="6163428">]</span><span class="builtintype" id="6163429">byte</span><span class="op" id="6163433">,</span>&nbsp;<span class="builtintype" id="6163435">error</span><span class="op" id="6163440">)</span>&nbsp;<span class="op" id="6163442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163445">if</span>&nbsp;<span class="ident" id="6163448">more</span>&nbsp;<span class="op" id="6163453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6163457">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163493">return</span>&nbsp;<span class="ident" id="6163500">nil</span><span class="op" id="6163503">,</span>&nbsp;<span class="ident" id="6163505">errors</span><span class="op" id="6163511">.</span><span class="ident" id="6163512">New</span><span class="op" id="6163515">(</span><span class="string" id="6163516">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="6163545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6163548">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163551">return</span>&nbsp;<span class="ident" id="6163558">nil</span><span class="op" id="6163561">,</span>&nbsp;<span class="ident" id="6163563">nil</span><br>
<span class="lineno"></span><span class="op" id="6163567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6163570">type</span>&nbsp;<span class="ident" id="6163575">cramMD5Auth</span>&nbsp;<span class="keyword" id="6163587">struct</span>&nbsp;<span class="op" id="6163594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163597">username</span><span class="op" id="6163605">,</span>&nbsp;<span class="ident" id="6163607">secret</span>&nbsp;<span class="builtintype" id="6163614">string</span><br>
<span class="lineno">85</span><span class="op" id="6163621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6163624">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6163699">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="6163736">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="6163808">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="6163865">func</span>&nbsp;<span class="ident" id="6163870">CRAMMD5Auth</span><span class="op" id="6163881">(</span><span class="ident" id="6163882">username</span><span class="op" id="6163890">,</span>&nbsp;<span class="ident" id="6163892">secret</span>&nbsp;<span class="builtintype" id="6163899">string</span><span class="op" id="6163905">)</span>&nbsp;<span class="ident" id="6163907">Auth</span>&nbsp;<span class="op" id="6163912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163915">return</span>&nbsp;<span class="op" id="6163922">&amp;</span><span class="ident" id="6163923">cramMD5Auth</span><span class="op" id="6163934">{</span><span class="ident" id="6163935">username</span><span class="op" id="6163943">,</span>&nbsp;<span class="ident" id="6163945">secret</span><span class="op" id="6163951">}</span><br>
<span class="lineno"></span><span class="op" id="6163953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6163956">func</span>&nbsp;<span class="op" id="6163961">(</span><span class="ident" id="6163962">a</span>&nbsp;<span class="op" id="6163964">*</span><span class="ident" id="6163965">cramMD5Auth</span><span class="op" id="6163976">)</span>&nbsp;<span class="ident" id="6163978">Start</span><span class="op" id="6163983">(</span><span class="ident" id="6163984">server</span>&nbsp;<span class="op" id="6163991">*</span><span class="ident" id="6163992">ServerInfo</span><span class="op" id="6164002">)</span>&nbsp;<span class="op" id="6164004">(</span><span class="builtintype" id="6164005">string</span><span class="op" id="6164011">,</span>&nbsp;<span class="op" id="6164013">[</span><span class="op" id="6164014">]</span><span class="builtintype" id="6164015">byte</span><span class="op" id="6164019">,</span>&nbsp;<span class="builtintype" id="6164021">error</span><span class="op" id="6164026">)</span>&nbsp;<span class="op" id="6164028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164031">return</span>&nbsp;<span class="string" id="6164038">&#34;CRAM-MD5&#34;</span><span class="op" id="6164048">,</span>&nbsp;<span class="ident" id="6164050">nil</span><span class="op" id="6164053">,</span>&nbsp;<span class="ident" id="6164055">nil</span><br>
<span class="lineno"></span><span class="op" id="6164059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6164062">func</span>&nbsp;<span class="op" id="6164067">(</span><span class="ident" id="6164068">a</span>&nbsp;<span class="op" id="6164070">*</span><span class="ident" id="6164071">cramMD5Auth</span><span class="op" id="6164082">)</span>&nbsp;<span class="ident" id="6164084">Next</span><span class="op" id="6164088">(</span><span class="ident" id="6164089">fromServer</span>&nbsp;<span class="op" id="6164100">[</span><span class="op" id="6164101">]</span><span class="builtintype" id="6164102">byte</span><span class="op" id="6164106">,</span>&nbsp;<span class="ident" id="6164108">more</span>&nbsp;<span class="builtintype" id="6164113">bool</span><span class="op" id="6164117">)</span>&nbsp;<span class="op" id="6164119">(</span><span class="op" id="6164120">[</span><span class="op" id="6164121">]</span><span class="builtintype" id="6164122">byte</span><span class="op" id="6164126">,</span>&nbsp;<span class="builtintype" id="6164128">error</span><span class="op" id="6164133">)</span>&nbsp;<span class="op" id="6164135">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164138">if</span>&nbsp;<span class="ident" id="6164141">more</span>&nbsp;<span class="op" id="6164146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164150">d</span>&nbsp;<span class="op" id="6164152">:=</span>&nbsp;<span class="ident" id="6164155">hmac</span><span class="op" id="6164159">.</span><span class="ident" id="6164160">New</span><span class="op" id="6164163">(</span><span class="ident" id="6164164">md5</span><span class="op" id="6164167">.</span><span class="ident" id="6164168">New</span><span class="op" id="6164171">,</span>&nbsp;<span class="op" id="6164173">[</span><span class="op" id="6164174">]</span><span class="builtintype" id="6164175">byte</span><span class="op" id="6164179">(</span><span class="ident" id="6164180">a</span><span class="op" id="6164181">.</span><span class="ident" id="6164182">secret</span><span class="op" id="6164188">)</span><span class="op" id="6164189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164193">d</span><span class="op" id="6164194">.</span><span class="ident" id="6164195">Write</span><span class="op" id="6164200">(</span><span class="ident" id="6164201">fromServer</span><span class="op" id="6164211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164215">s</span>&nbsp;<span class="op" id="6164217">:=</span>&nbsp;<span class="builtinfunc" id="6164220">make</span><span class="op" id="6164224">(</span><span class="op" id="6164225">[</span><span class="op" id="6164226">]</span><span class="builtintype" id="6164227">byte</span><span class="op" id="6164231">,</span>&nbsp;<span class="num" id="6164233">0</span><span class="op" id="6164234">,</span>&nbsp;<span class="ident" id="6164236">d</span><span class="op" id="6164237">.</span><span class="ident" id="6164238">Size</span><span class="op" id="6164242">(</span><span class="op" id="6164243">)</span><span class="op" id="6164244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164248">return</span>&nbsp;<span class="op" id="6164255">[</span><span class="op" id="6164256">]</span><span class="builtintype" id="6164257">byte</span><span class="op" id="6164261">(</span><span class="ident" id="6164262">fmt</span><span class="op" id="6164265">.</span><span class="ident" id="6164266">Sprintf</span><span class="op" id="6164273">(</span><span class="string" id="6164274">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6164281">,</span>&nbsp;<span class="ident" id="6164283">a</span><span class="op" id="6164284">.</span><span class="ident" id="6164285">username</span><span class="op" id="6164293">,</span>&nbsp;<span class="ident" id="6164295">d</span><span class="op" id="6164296">.</span><span class="ident" id="6164297">Sum</span><span class="op" id="6164300">(</span><span class="ident" id="6164301">s</span><span class="op" id="6164302">)</span><span class="op" id="6164303">)</span><span class="op" id="6164304">)</span><span class="op" id="6164305">,</span>&nbsp;<span class="ident" id="6164307">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6164312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164315">return</span>&nbsp;<span class="ident" id="6164322">nil</span><span class="op" id="6164325">,</span>&nbsp;<span class="ident" id="6164327">nil</span><br>
<span class="lineno"></span><span class="op" id="6164331">}</span>
</div>
</body>
</html>
