<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html" class="current">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6815210">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6815266">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6815320">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6815371">//&nbsp;+build&nbsp;!nacl,!plan9,!windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6815404">package</span>&nbsp;<span class="ident" id="6815412">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6815417">import</span>&nbsp;<span class="op" id="6815424">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6815427">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6815436">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6815442">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6815453">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6815464">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6815475">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6815486">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6815493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6815496">func</span>&nbsp;<span class="ident" id="6815501">TestReadUnixgramWithUnnamedSocket</span><span class="op" id="6815534">(</span><span class="ident" id="6815535">t</span>&nbsp;<span class="op" id="6815537">*</span><span class="ident" id="6815538">testing</span><span class="op" id="6815545">.</span><span class="ident" id="6815546">T</span><span class="op" id="6815547">)</span>&nbsp;<span class="op" id="6815549">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815552">addr</span>&nbsp;<span class="op" id="6815557">:=</span>&nbsp;<span class="ident" id="6815560">testUnixAddr</span><span class="op" id="6815572">(</span><span class="op" id="6815573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815576">la</span><span class="op" id="6815578">,</span>&nbsp;<span class="ident" id="6815580">err</span>&nbsp;<span class="op" id="6815584">:=</span>&nbsp;<span class="ident" id="6815587">ResolveUnixAddr</span><span class="op" id="6815602">(</span><span class="string" id="6815603">&#34;unixgram&#34;</span><span class="op" id="6815613">,</span>&nbsp;<span class="ident" id="6815615">addr</span><span class="op" id="6815619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6815622">if</span>&nbsp;<span class="ident" id="6815625">err</span>&nbsp;<span class="op" id="6815629">!=</span>&nbsp;<span class="builtintype" id="6815632">nil</span>&nbsp;<span class="op" id="6815636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815640">t</span><span class="op" id="6815641">.</span><span class="ident" id="6815642">Fatalf</span><span class="op" id="6815648">(</span><span class="string" id="6815649">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6815677">,</span>&nbsp;<span class="ident" id="6815679">err</span><span class="op" id="6815682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815685">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815688">c</span><span class="op" id="6815689">,</span>&nbsp;<span class="ident" id="6815691">err</span>&nbsp;<span class="op" id="6815695">:=</span>&nbsp;<span class="ident" id="6815698">ListenUnixgram</span><span class="op" id="6815712">(</span><span class="string" id="6815713">&#34;unixgram&#34;</span><span class="op" id="6815723">,</span>&nbsp;<span class="ident" id="6815725">la</span><span class="op" id="6815727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6815730">if</span>&nbsp;<span class="ident" id="6815733">err</span>&nbsp;<span class="op" id="6815737">!=</span>&nbsp;<span class="builtintype" id="6815740">nil</span>&nbsp;<span class="op" id="6815744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815748">t</span><span class="op" id="6815749">.</span><span class="ident" id="6815750">Fatalf</span><span class="op" id="6815756">(</span><span class="string" id="6815757">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6815784">,</span>&nbsp;<span class="ident" id="6815786">err</span><span class="op" id="6815789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6815795">defer</span>&nbsp;<span class="keyword" id="6815801">func</span><span class="op" id="6815805">(</span><span class="op" id="6815806">)</span>&nbsp;<span class="op" id="6815808">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815812">c</span><span class="op" id="6815813">.</span><span class="ident" id="6815814">Close</span><span class="op" id="6815819">(</span><span class="op" id="6815820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815824">os</span><span class="op" id="6815826">.</span><span class="ident" id="6815827">Remove</span><span class="op" id="6815833">(</span><span class="ident" id="6815834">addr</span><span class="op" id="6815838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815841">}</span><span class="op" id="6815842">(</span><span class="op" id="6815843">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815847">off</span>&nbsp;<span class="op" id="6815851">:=</span>&nbsp;<span class="builtinfunc" id="6815854">make</span><span class="op" id="6815858">(</span><span class="keyword" id="6815859">chan</span>&nbsp;<span class="builtintype" id="6815864">bool</span><span class="op" id="6815868">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815871">data</span>&nbsp;<span class="op" id="6815876">:=</span>&nbsp;<span class="op" id="6815879">[</span><span class="num" id="6815880">5</span><span class="op" id="6815881">]</span><span class="builtintype" id="6815882">byte</span><span class="op" id="6815886">{</span><span class="num" id="6815887">1</span><span class="op" id="6815888">,</span>&nbsp;<span class="num" id="6815890">2</span><span class="op" id="6815891">,</span>&nbsp;<span class="num" id="6815893">3</span><span class="op" id="6815894">,</span>&nbsp;<span class="num" id="6815896">4</span><span class="op" id="6815897">,</span>&nbsp;<span class="num" id="6815899">5</span><span class="op" id="6815900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6815903">go</span>&nbsp;<span class="keyword" id="6815906">func</span><span class="op" id="6815910">(</span><span class="op" id="6815911">)</span>&nbsp;<span class="op" id="6815913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6815917">defer</span>&nbsp;<span class="keyword" id="6815923">func</span><span class="op" id="6815927">(</span><span class="op" id="6815928">)</span>&nbsp;<span class="op" id="6815930">{</span>&nbsp;<span class="ident" id="6815932">off</span>&nbsp;<span class="op" id="6815936">&lt;-</span>&nbsp;<span class="builtintype" id="6815939">true</span>&nbsp;<span class="op" id="6815944">}</span><span class="op" id="6815945">(</span><span class="op" id="6815946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815950">s</span><span class="op" id="6815951">,</span>&nbsp;<span class="ident" id="6815953">err</span>&nbsp;<span class="op" id="6815957">:=</span>&nbsp;<span class="ident" id="6815960">syscall</span><span class="op" id="6815967">.</span><span class="ident" id="6815968">Socket</span><span class="op" id="6815974">(</span><span class="ident" id="6815975">syscall</span><span class="op" id="6815982">.</span><span class="ident" id="6815983">AF_UNIX</span><span class="op" id="6815990">,</span>&nbsp;<span class="ident" id="6815992">syscall</span><span class="op" id="6815999">.</span><span class="ident" id="6816000">SOCK_DGRAM</span><span class="op" id="6816010">,</span>&nbsp;<span class="num" id="6816012">0</span><span class="op" id="6816013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816017">if</span>&nbsp;<span class="ident" id="6816020">err</span>&nbsp;<span class="op" id="6816024">!=</span>&nbsp;<span class="builtintype" id="6816027">nil</span>&nbsp;<span class="op" id="6816031">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816036">t</span><span class="op" id="6816037">.</span><span class="ident" id="6816038">Errorf</span><span class="op" id="6816044">(</span><span class="string" id="6816045">&#34;syscall.Socket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6816072">,</span>&nbsp;<span class="ident" id="6816074">err</span><span class="op" id="6816077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816082">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816095">defer</span>&nbsp;<span class="ident" id="6816101">syscall</span><span class="op" id="6816108">.</span><span class="ident" id="6816109">Close</span><span class="op" id="6816114">(</span><span class="ident" id="6816115">s</span><span class="op" id="6816116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816120">rsa</span>&nbsp;<span class="op" id="6816124">:=</span>&nbsp;<span class="op" id="6816127">&amp;</span><span class="ident" id="6816128">syscall</span><span class="op" id="6816135">.</span><span class="ident" id="6816136">SockaddrUnix</span><span class="op" id="6816148">{</span><span class="ident" id="6816149">Name</span><span class="op" id="6816153">:</span>&nbsp;<span class="ident" id="6816155">addr</span><span class="op" id="6816159">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816163">if</span>&nbsp;<span class="ident" id="6816166">err</span>&nbsp;<span class="op" id="6816170">:=</span>&nbsp;<span class="ident" id="6816173">syscall</span><span class="op" id="6816180">.</span><span class="ident" id="6816181">Sendto</span><span class="op" id="6816187">(</span><span class="ident" id="6816188">s</span><span class="op" id="6816189">,</span>&nbsp;<span class="ident" id="6816191">data</span><span class="op" id="6816195">[</span><span class="op" id="6816196">:</span><span class="op" id="6816197">]</span><span class="op" id="6816198">,</span>&nbsp;<span class="num" id="6816200">0</span><span class="op" id="6816201">,</span>&nbsp;<span class="ident" id="6816203">rsa</span><span class="op" id="6816206">)</span><span class="op" id="6816207">;</span>&nbsp;<span class="ident" id="6816209">err</span>&nbsp;<span class="op" id="6816213">!=</span>&nbsp;<span class="builtintype" id="6816216">nil</span>&nbsp;<span class="op" id="6816220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816225">t</span><span class="op" id="6816226">.</span><span class="ident" id="6816227">Errorf</span><span class="op" id="6816233">(</span><span class="string" id="6816234">&#34;syscall.Sendto&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6816261">,</span>&nbsp;<span class="ident" id="6816263">err</span><span class="op" id="6816266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816271">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816283">}</span><span class="op" id="6816284">(</span><span class="op" id="6816285">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816289">&lt;-</span><span class="ident" id="6816291">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816296">b</span>&nbsp;<span class="op" id="6816298">:=</span>&nbsp;<span class="builtinfunc" id="6816301">make</span><span class="op" id="6816305">(</span><span class="op" id="6816306">[</span><span class="op" id="6816307">]</span><span class="builtintype" id="6816308">byte</span><span class="op" id="6816312">,</span>&nbsp;<span class="num" id="6816314">64</span><span class="op" id="6816316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816319">c</span><span class="op" id="6816320">.</span><span class="ident" id="6816321">SetReadDeadline</span><span class="op" id="6816336">(</span><span class="ident" id="6816337">time</span><span class="op" id="6816341">.</span><span class="ident" id="6816342">Now</span><span class="op" id="6816345">(</span><span class="op" id="6816346">)</span><span class="op" id="6816347">.</span><span class="ident" id="6816348">Add</span><span class="op" id="6816351">(</span><span class="num" id="6816352">100</span>&nbsp;<span class="op" id="6816356">*</span>&nbsp;<span class="ident" id="6816358">time</span><span class="op" id="6816362">.</span><span class="ident" id="6816363">Millisecond</span><span class="op" id="6816374">)</span><span class="op" id="6816375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816378">n</span><span class="op" id="6816379">,</span>&nbsp;<span class="ident" id="6816381">from</span><span class="op" id="6816385">,</span>&nbsp;<span class="ident" id="6816387">err</span>&nbsp;<span class="op" id="6816391">:=</span>&nbsp;<span class="ident" id="6816394">c</span><span class="op" id="6816395">.</span><span class="ident" id="6816396">ReadFrom</span><span class="op" id="6816404">(</span><span class="ident" id="6816405">b</span><span class="op" id="6816406">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816409">if</span>&nbsp;<span class="ident" id="6816412">err</span>&nbsp;<span class="op" id="6816416">!=</span>&nbsp;<span class="builtintype" id="6816419">nil</span>&nbsp;<span class="op" id="6816423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816427">t</span><span class="op" id="6816428">.</span><span class="ident" id="6816429">Fatalf</span><span class="op" id="6816435">(</span><span class="string" id="6816436">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6816466">,</span>&nbsp;<span class="ident" id="6816468">err</span><span class="op" id="6816471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816477">if</span>&nbsp;<span class="ident" id="6816480">from</span>&nbsp;<span class="op" id="6816485">!=</span>&nbsp;<span class="builtintype" id="6816488">nil</span>&nbsp;<span class="op" id="6816492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816496">t</span><span class="op" id="6816497">.</span><span class="ident" id="6816498">Fatalf</span><span class="op" id="6816504">(</span><span class="string" id="6816505">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="6816529">,</span>&nbsp;<span class="ident" id="6816531">from</span><span class="op" id="6816535">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816541">if</span>&nbsp;<span class="op" id="6816544">!</span><span class="ident" id="6816545">bytes</span><span class="op" id="6816550">.</span><span class="ident" id="6816551">Equal</span><span class="op" id="6816556">(</span><span class="ident" id="6816557">b</span><span class="op" id="6816558">[</span><span class="op" id="6816559">:</span><span class="ident" id="6816560">n</span><span class="op" id="6816561">]</span><span class="op" id="6816562">,</span>&nbsp;<span class="ident" id="6816564">data</span><span class="op" id="6816568">[</span><span class="op" id="6816569">:</span><span class="op" id="6816570">]</span><span class="op" id="6816571">)</span>&nbsp;<span class="op" id="6816573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816577">t</span><span class="op" id="6816578">.</span><span class="ident" id="6816579">Fatalf</span><span class="op" id="6816585">(</span><span class="string" id="6816586">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6816603">,</span>&nbsp;<span class="ident" id="6816605">b</span><span class="op" id="6816606">[</span><span class="op" id="6816607">:</span><span class="ident" id="6816608">n</span><span class="op" id="6816609">]</span><span class="op" id="6816610">,</span>&nbsp;<span class="ident" id="6816612">data</span><span class="op" id="6816616">[</span><span class="op" id="6816617">:</span><span class="op" id="6816618">]</span><span class="op" id="6816619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816622">}</span><br>
<span class="lineno"></span><span class="op" id="6816624">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="6816627">func</span>&nbsp;<span class="ident" id="6816632">TestReadUnixgramWithZeroBytesBuffer</span><span class="op" id="6816667">(</span><span class="ident" id="6816668">t</span>&nbsp;<span class="op" id="6816670">*</span><span class="ident" id="6816671">testing</span><span class="op" id="6816678">.</span><span class="ident" id="6816679">T</span><span class="op" id="6816680">)</span>&nbsp;<span class="op" id="6816682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6816685">//&nbsp;issue&nbsp;4352:&nbsp;Recvfrom&nbsp;failed&nbsp;with&nbsp;&#34;address&nbsp;family&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6816742">//&nbsp;supported&nbsp;by&nbsp;protocol&nbsp;family&#34;&nbsp;if&nbsp;zero-length&nbsp;buffer&nbsp;provided</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816808">addr</span>&nbsp;<span class="op" id="6816813">:=</span>&nbsp;<span class="ident" id="6816816">testUnixAddr</span><span class="op" id="6816828">(</span><span class="op" id="6816829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816832">la</span><span class="op" id="6816834">,</span>&nbsp;<span class="ident" id="6816836">err</span>&nbsp;<span class="op" id="6816840">:=</span>&nbsp;<span class="ident" id="6816843">ResolveUnixAddr</span><span class="op" id="6816858">(</span><span class="string" id="6816859">&#34;unixgram&#34;</span><span class="op" id="6816869">,</span>&nbsp;<span class="ident" id="6816871">addr</span><span class="op" id="6816875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816878">if</span>&nbsp;<span class="ident" id="6816881">err</span>&nbsp;<span class="op" id="6816885">!=</span>&nbsp;<span class="builtintype" id="6816888">nil</span>&nbsp;<span class="op" id="6816892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816896">t</span><span class="op" id="6816897">.</span><span class="ident" id="6816898">Fatalf</span><span class="op" id="6816904">(</span><span class="string" id="6816905">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6816933">,</span>&nbsp;<span class="ident" id="6816935">err</span><span class="op" id="6816938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816941">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816944">c</span><span class="op" id="6816945">,</span>&nbsp;<span class="ident" id="6816947">err</span>&nbsp;<span class="op" id="6816951">:=</span>&nbsp;<span class="ident" id="6816954">ListenUnixgram</span><span class="op" id="6816968">(</span><span class="string" id="6816969">&#34;unixgram&#34;</span><span class="op" id="6816979">,</span>&nbsp;<span class="ident" id="6816981">la</span><span class="op" id="6816983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816986">if</span>&nbsp;<span class="ident" id="6816989">err</span>&nbsp;<span class="op" id="6816993">!=</span>&nbsp;<span class="builtintype" id="6816996">nil</span>&nbsp;<span class="op" id="6817000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817004">t</span><span class="op" id="6817005">.</span><span class="ident" id="6817006">Fatalf</span><span class="op" id="6817012">(</span><span class="string" id="6817013">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6817040">,</span>&nbsp;<span class="ident" id="6817042">err</span><span class="op" id="6817045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6817048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6817051">defer</span>&nbsp;<span class="keyword" id="6817057">func</span><span class="op" id="6817061">(</span><span class="op" id="6817062">)</span>&nbsp;<span class="op" id="6817064">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817068">c</span><span class="op" id="6817069">.</span><span class="ident" id="6817070">Close</span><span class="op" id="6817075">(</span><span class="op" id="6817076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817080">os</span><span class="op" id="6817082">.</span><span class="ident" id="6817083">Remove</span><span class="op" id="6817089">(</span><span class="ident" id="6817090">addr</span><span class="op" id="6817094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6817097">}</span><span class="op" id="6817098">(</span><span class="op" id="6817099">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817103">off</span>&nbsp;<span class="op" id="6817107">:=</span>&nbsp;<span class="builtinfunc" id="6817110">make</span><span class="op" id="6817114">(</span><span class="keyword" id="6817115">chan</span>&nbsp;<span class="builtintype" id="6817120">bool</span><span class="op" id="6817124">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6817127">go</span>&nbsp;<span class="keyword" id="6817130">func</span><span class="op" id="6817134">(</span><span class="op" id="6817135">)</span>&nbsp;<span class="op" id="6817137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6817141">defer</span>&nbsp;<span class="keyword" id="6817147">func</span><span class="op" id="6817151">(</span><span class="op" id="6817152">)</span>&nbsp;<span class="op" id="6817154">{</span>&nbsp;<span class="ident" id="6817156">off</span>&nbsp;<span class="op" id="6817160">&lt;-</span>&nbsp;<span class="builtintype" id="6817163">true</span>&nbsp;<span class="op" id="6817168">}</span><span class="op" id="6817169">(</span><span class="op" id="6817170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817174">c</span><span class="op" id="6817175">,</span>&nbsp;<span class="ident" id="6817177">err</span>&nbsp;<span class="op" id="6817181">:=</span>&nbsp;<span class="ident" id="6817184">DialUnix</span><span class="op" id="6817192">(</span><span class="string" id="6817193">&#34;unixgram&#34;</span><span class="op" id="6817203">,</span>&nbsp;<span class="builtintype" id="6817205">nil</span><span class="op" id="6817208">,</span>&nbsp;<span class="ident" id="6817210">la</span><span class="op" id="6817212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6817216">if</span>&nbsp;<span class="ident" id="6817219">err</span>&nbsp;<span class="op" id="6817223">!=</span>&nbsp;<span class="builtintype" id="6817226">nil</span>&nbsp;<span class="op" id="6817230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817235">t</span><span class="op" id="6817236">.</span><span class="ident" id="6817237">Errorf</span><span class="op" id="6817243">(</span><span class="string" id="6817244">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6817265">,</span>&nbsp;<span class="ident" id="6817267">err</span><span class="op" id="6817270">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6817275">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6817284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6817288">defer</span>&nbsp;<span class="ident" id="6817294">c</span><span class="op" id="6817295">.</span><span class="ident" id="6817296">Close</span><span class="op" id="6817301">(</span><span class="op" id="6817302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6817306">if</span>&nbsp;<span class="ident" id="6817309">_</span><span class="op" id="6817310">,</span>&nbsp;<span class="ident" id="6817312">err</span>&nbsp;<span class="op" id="6817316">:=</span>&nbsp;<span class="ident" id="6817319">c</span><span class="op" id="6817320">.</span><span class="ident" id="6817321">Write</span><span class="op" id="6817326">(</span><span class="op" id="6817327">[</span><span class="op" id="6817328">]</span><span class="builtintype" id="6817329">byte</span><span class="op" id="6817333">{</span><span class="num" id="6817334">1</span><span class="op" id="6817335">,</span>&nbsp;<span class="num" id="6817337">2</span><span class="op" id="6817338">,</span>&nbsp;<span class="num" id="6817340">3</span><span class="op" id="6817341">,</span>&nbsp;<span class="num" id="6817343">4</span><span class="op" id="6817344">,</span>&nbsp;<span class="num" id="6817346">5</span><span class="op" id="6817347">}</span><span class="op" id="6817348">)</span><span class="op" id="6817349">;</span>&nbsp;<span class="ident" id="6817351">err</span>&nbsp;<span class="op" id="6817355">!=</span>&nbsp;<span class="builtintype" id="6817358">nil</span>&nbsp;<span class="op" id="6817362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817367">t</span><span class="op" id="6817368">.</span><span class="ident" id="6817369">Errorf</span><span class="op" id="6817375">(</span><span class="string" id="6817376">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6817403">,</span>&nbsp;<span class="ident" id="6817405">err</span><span class="op" id="6817408">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6817413">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6817422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6817425">}</span><span class="op" id="6817426">(</span><span class="op" id="6817427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6817431">&lt;-</span><span class="ident" id="6817433">off</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817438">c</span><span class="op" id="6817439">.</span><span class="ident" id="6817440">SetReadDeadline</span><span class="op" id="6817455">(</span><span class="ident" id="6817456">time</span><span class="op" id="6817460">.</span><span class="ident" id="6817461">Now</span><span class="op" id="6817464">(</span><span class="op" id="6817465">)</span><span class="op" id="6817466">.</span><span class="ident" id="6817467">Add</span><span class="op" id="6817470">(</span><span class="num" id="6817471">100</span>&nbsp;<span class="op" id="6817475">*</span>&nbsp;<span class="ident" id="6817477">time</span><span class="op" id="6817481">.</span><span class="ident" id="6817482">Millisecond</span><span class="op" id="6817493">)</span><span class="op" id="6817494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817497">_</span><span class="op" id="6817498">,</span>&nbsp;<span class="ident" id="6817500">from</span><span class="op" id="6817504">,</span>&nbsp;<span class="ident" id="6817506">err</span>&nbsp;<span class="op" id="6817510">:=</span>&nbsp;<span class="ident" id="6817513">c</span><span class="op" id="6817514">.</span><span class="ident" id="6817515">ReadFrom</span><span class="op" id="6817523">(</span><span class="builtintype" id="6817524">nil</span><span class="op" id="6817527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6817530">if</span>&nbsp;<span class="ident" id="6817533">err</span>&nbsp;<span class="op" id="6817537">!=</span>&nbsp;<span class="builtintype" id="6817540">nil</span>&nbsp;<span class="op" id="6817544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817548">t</span><span class="op" id="6817549">.</span><span class="ident" id="6817550">Fatalf</span><span class="op" id="6817556">(</span><span class="string" id="6817557">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6817587">,</span>&nbsp;<span class="ident" id="6817589">err</span><span class="op" id="6817592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6817595">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6817598">if</span>&nbsp;<span class="ident" id="6817601">from</span>&nbsp;<span class="op" id="6817606">!=</span>&nbsp;<span class="builtintype" id="6817609">nil</span>&nbsp;<span class="op" id="6817613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817617">t</span><span class="op" id="6817618">.</span><span class="ident" id="6817619">Fatalf</span><span class="op" id="6817625">(</span><span class="string" id="6817626">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="6817650">,</span>&nbsp;<span class="ident" id="6817652">from</span><span class="op" id="6817656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6817659">}</span><br>
<span class="lineno"></span><span class="op" id="6817661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6817664">func</span>&nbsp;<span class="ident" id="6817669">TestUnixgramAutobind</span><span class="op" id="6817689">(</span><span class="ident" id="6817690">t</span>&nbsp;<span class="op" id="6817692">*</span><span class="ident" id="6817693">testing</span><span class="op" id="6817700">.</span><span class="ident" id="6817701">T</span><span class="op" id="6817702">)</span>&nbsp;<span class="op" id="6817704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6817707">if</span>&nbsp;<span class="ident" id="6817710">runtime</span><span class="op" id="6817717">.</span><span class="ident" id="6817718">GOOS</span>&nbsp;<span class="op" id="6817723">!=</span>&nbsp;<span class="string" id="6817726">&#34;linux&#34;</span>&nbsp;<span class="op" id="6817734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817738">t</span><span class="op" id="6817739">.</span><span class="ident" id="6817740">Skip</span><span class="op" id="6817744">(</span><span class="string" id="6817745">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="6817779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6817782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817786">laddr</span>&nbsp;<span class="op" id="6817792">:=</span>&nbsp;<span class="op" id="6817795">&amp;</span><span class="ident" id="6817796">UnixAddr</span><span class="op" id="6817804">{</span><span class="ident" id="6817805">Name</span><span class="op" id="6817809">:</span>&nbsp;<span class="string" id="6817811">&#34;&#34;</span><span class="op" id="6817813">,</span>&nbsp;<span class="ident" id="6817815">Net</span><span class="op" id="6817818">:</span>&nbsp;<span class="string" id="6817820">&#34;unixgram&#34;</span><span class="op" id="6817830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817833">c1</span><span class="op" id="6817835">,</span>&nbsp;<span class="ident" id="6817837">err</span>&nbsp;<span class="op" id="6817841">:=</span>&nbsp;<span class="ident" id="6817844">ListenUnixgram</span><span class="op" id="6817858">(</span><span class="string" id="6817859">&#34;unixgram&#34;</span><span class="op" id="6817869">,</span>&nbsp;<span class="ident" id="6817871">laddr</span><span class="op" id="6817876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6817879">if</span>&nbsp;<span class="ident" id="6817882">err</span>&nbsp;<span class="op" id="6817886">!=</span>&nbsp;<span class="builtintype" id="6817889">nil</span>&nbsp;<span class="op" id="6817893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817897">t</span><span class="op" id="6817898">.</span><span class="ident" id="6817899">Fatalf</span><span class="op" id="6817905">(</span><span class="string" id="6817906">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6817933">,</span>&nbsp;<span class="ident" id="6817935">err</span><span class="op" id="6817938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6817941">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6817944">defer</span>&nbsp;<span class="ident" id="6817950">c1</span><span class="op" id="6817952">.</span><span class="ident" id="6817953">Close</span><span class="op" id="6817958">(</span><span class="op" id="6817959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6817963">//&nbsp;retrieve&nbsp;the&nbsp;autobind&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817997">autoAddr</span>&nbsp;<span class="op" id="6818006">:=</span>&nbsp;<span class="ident" id="6818009">c1</span><span class="op" id="6818011">.</span><span class="ident" id="6818012">LocalAddr</span><span class="op" id="6818021">(</span><span class="op" id="6818022">)</span><span class="op" id="6818023">.</span><span class="op" id="6818024">(</span><span class="op" id="6818025">*</span><span class="ident" id="6818026">UnixAddr</span><span class="op" id="6818034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6818037">if</span>&nbsp;<span class="builtinfunc" id="6818040">len</span><span class="op" id="6818043">(</span><span class="ident" id="6818044">autoAddr</span><span class="op" id="6818052">.</span><span class="ident" id="6818053">Name</span><span class="op" id="6818057">)</span>&nbsp;<span class="op" id="6818059">&lt;=</span>&nbsp;<span class="num" id="6818062">1</span>&nbsp;<span class="op" id="6818064">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818068">t</span><span class="op" id="6818069">.</span><span class="ident" id="6818070">Fatalf</span><span class="op" id="6818076">(</span><span class="string" id="6818077">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="6818107">,</span>&nbsp;<span class="ident" id="6818109">autoAddr</span><span class="op" id="6818117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6818120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6818123">if</span>&nbsp;<span class="ident" id="6818126">autoAddr</span><span class="op" id="6818134">.</span><span class="ident" id="6818135">Name</span><span class="op" id="6818139">[</span><span class="num" id="6818140">0</span><span class="op" id="6818141">]</span>&nbsp;<span class="op" id="6818143">!=</span>&nbsp;<span class="string" id="6818146">&#39;@&#39;</span>&nbsp;<span class="op" id="6818150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818154">t</span><span class="op" id="6818155">.</span><span class="ident" id="6818156">Fatalf</span><span class="op" id="6818162">(</span><span class="string" id="6818163">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="6818193">,</span>&nbsp;<span class="ident" id="6818195">autoAddr</span><span class="op" id="6818203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6818206">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818210">c2</span><span class="op" id="6818212">,</span>&nbsp;<span class="ident" id="6818214">err</span>&nbsp;<span class="op" id="6818218">:=</span>&nbsp;<span class="ident" id="6818221">DialUnix</span><span class="op" id="6818229">(</span><span class="string" id="6818230">&#34;unixgram&#34;</span><span class="op" id="6818240">,</span>&nbsp;<span class="builtintype" id="6818242">nil</span><span class="op" id="6818245">,</span>&nbsp;<span class="ident" id="6818247">autoAddr</span><span class="op" id="6818255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6818258">if</span>&nbsp;<span class="ident" id="6818261">err</span>&nbsp;<span class="op" id="6818265">!=</span>&nbsp;<span class="builtintype" id="6818268">nil</span>&nbsp;<span class="op" id="6818272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818276">t</span><span class="op" id="6818277">.</span><span class="ident" id="6818278">Fatalf</span><span class="op" id="6818284">(</span><span class="string" id="6818285">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6818306">,</span>&nbsp;<span class="ident" id="6818308">err</span><span class="op" id="6818311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6818314">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6818317">defer</span>&nbsp;<span class="ident" id="6818323">c2</span><span class="op" id="6818325">.</span><span class="ident" id="6818326">Close</span><span class="op" id="6818331">(</span><span class="op" id="6818332">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6818336">if</span>&nbsp;<span class="op" id="6818339">!</span><span class="ident" id="6818340">reflect</span><span class="op" id="6818347">.</span><span class="ident" id="6818348">DeepEqual</span><span class="op" id="6818357">(</span><span class="ident" id="6818358">c1</span><span class="op" id="6818360">.</span><span class="ident" id="6818361">LocalAddr</span><span class="op" id="6818370">(</span><span class="op" id="6818371">)</span><span class="op" id="6818372">,</span>&nbsp;<span class="ident" id="6818374">c2</span><span class="op" id="6818376">.</span><span class="ident" id="6818377">RemoteAddr</span><span class="op" id="6818387">(</span><span class="op" id="6818388">)</span><span class="op" id="6818389">)</span>&nbsp;<span class="op" id="6818391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818395">t</span><span class="op" id="6818396">.</span><span class="ident" id="6818397">Fatalf</span><span class="op" id="6818403">(</span><span class="string" id="6818404">&#34;expected&nbsp;autobind&nbsp;address&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6818442">,</span>&nbsp;<span class="ident" id="6818444">c1</span><span class="op" id="6818446">.</span><span class="ident" id="6818447">LocalAddr</span><span class="op" id="6818456">(</span><span class="op" id="6818457">)</span><span class="op" id="6818458">,</span>&nbsp;<span class="ident" id="6818460">c2</span><span class="op" id="6818462">.</span><span class="ident" id="6818463">RemoteAddr</span><span class="op" id="6818473">(</span><span class="op" id="6818474">)</span><span class="op" id="6818475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6818478">}</span><br>
<span class="lineno">140</span><span class="op" id="6818480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6818483">func</span>&nbsp;<span class="ident" id="6818488">TestUnixAutobindClose</span><span class="op" id="6818509">(</span><span class="ident" id="6818510">t</span>&nbsp;<span class="op" id="6818512">*</span><span class="ident" id="6818513">testing</span><span class="op" id="6818520">.</span><span class="ident" id="6818521">T</span><span class="op" id="6818522">)</span>&nbsp;<span class="op" id="6818524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6818527">if</span>&nbsp;<span class="ident" id="6818530">runtime</span><span class="op" id="6818537">.</span><span class="ident" id="6818538">GOOS</span>&nbsp;<span class="op" id="6818543">!=</span>&nbsp;<span class="string" id="6818546">&#34;linux&#34;</span>&nbsp;<span class="op" id="6818554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818558">t</span><span class="op" id="6818559">.</span><span class="ident" id="6818560">Skip</span><span class="op" id="6818564">(</span><span class="string" id="6818565">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="6818599">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6818602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818605">laddr</span>&nbsp;<span class="op" id="6818611">:=</span>&nbsp;<span class="op" id="6818614">&amp;</span><span class="ident" id="6818615">UnixAddr</span><span class="op" id="6818623">{</span><span class="ident" id="6818624">Name</span><span class="op" id="6818628">:</span>&nbsp;<span class="string" id="6818630">&#34;&#34;</span><span class="op" id="6818632">,</span>&nbsp;<span class="ident" id="6818634">Net</span><span class="op" id="6818637">:</span>&nbsp;<span class="string" id="6818639">&#34;unix&#34;</span><span class="op" id="6818645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818648">ln</span><span class="op" id="6818650">,</span>&nbsp;<span class="ident" id="6818652">err</span>&nbsp;<span class="op" id="6818656">:=</span>&nbsp;<span class="ident" id="6818659">ListenUnix</span><span class="op" id="6818669">(</span><span class="string" id="6818670">&#34;unix&#34;</span><span class="op" id="6818676">,</span>&nbsp;<span class="ident" id="6818678">laddr</span><span class="op" id="6818683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6818686">if</span>&nbsp;<span class="ident" id="6818689">err</span>&nbsp;<span class="op" id="6818693">!=</span>&nbsp;<span class="builtintype" id="6818696">nil</span>&nbsp;<span class="op" id="6818700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818704">t</span><span class="op" id="6818705">.</span><span class="ident" id="6818706">Fatalf</span><span class="op" id="6818712">(</span><span class="string" id="6818713">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6818736">,</span>&nbsp;<span class="ident" id="6818738">err</span><span class="op" id="6818741">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6818744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818747">ln</span><span class="op" id="6818749">.</span><span class="ident" id="6818750">Close</span><span class="op" id="6818755">(</span><span class="op" id="6818756">)</span><br>
<span class="lineno"></span><span class="op" id="6818758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6818761">func</span>&nbsp;<span class="ident" id="6818766">TestUnixgramWrite</span><span class="op" id="6818783">(</span><span class="ident" id="6818784">t</span>&nbsp;<span class="op" id="6818786">*</span><span class="ident" id="6818787">testing</span><span class="op" id="6818794">.</span><span class="ident" id="6818795">T</span><span class="op" id="6818796">)</span>&nbsp;<span class="op" id="6818798">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818801">addr</span>&nbsp;<span class="op" id="6818806">:=</span>&nbsp;<span class="ident" id="6818809">testUnixAddr</span><span class="op" id="6818821">(</span><span class="op" id="6818822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818825">laddr</span><span class="op" id="6818830">,</span>&nbsp;<span class="ident" id="6818832">err</span>&nbsp;<span class="op" id="6818836">:=</span>&nbsp;<span class="ident" id="6818839">ResolveUnixAddr</span><span class="op" id="6818854">(</span><span class="string" id="6818855">&#34;unixgram&#34;</span><span class="op" id="6818865">,</span>&nbsp;<span class="ident" id="6818867">addr</span><span class="op" id="6818871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6818874">if</span>&nbsp;<span class="ident" id="6818877">err</span>&nbsp;<span class="op" id="6818881">!=</span>&nbsp;<span class="builtintype" id="6818884">nil</span>&nbsp;<span class="op" id="6818888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818892">t</span><span class="op" id="6818893">.</span><span class="ident" id="6818894">Fatalf</span><span class="op" id="6818900">(</span><span class="string" id="6818901">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6818929">,</span>&nbsp;<span class="ident" id="6818931">err</span><span class="op" id="6818934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6818937">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6818940">c</span><span class="op" id="6818941">,</span>&nbsp;<span class="ident" id="6818943">err</span>&nbsp;<span class="op" id="6818947">:=</span>&nbsp;<span class="ident" id="6818950">ListenPacket</span><span class="op" id="6818962">(</span><span class="string" id="6818963">&#34;unixgram&#34;</span><span class="op" id="6818973">,</span>&nbsp;<span class="ident" id="6818975">addr</span><span class="op" id="6818979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6818982">if</span>&nbsp;<span class="ident" id="6818985">err</span>&nbsp;<span class="op" id="6818989">!=</span>&nbsp;<span class="builtintype" id="6818992">nil</span>&nbsp;<span class="op" id="6818996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6819000">t</span><span class="op" id="6819001">.</span><span class="ident" id="6819002">Fatalf</span><span class="op" id="6819008">(</span><span class="string" id="6819009">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6819034">,</span>&nbsp;<span class="ident" id="6819036">err</span><span class="op" id="6819039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6819042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6819045">defer</span>&nbsp;<span class="ident" id="6819051">os</span><span class="op" id="6819053">.</span><span class="ident" id="6819054">Remove</span><span class="op" id="6819060">(</span><span class="ident" id="6819061">addr</span><span class="op" id="6819065">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6819068">defer</span>&nbsp;<span class="ident" id="6819074">c</span><span class="op" id="6819075">.</span><span class="ident" id="6819076">Close</span><span class="op" id="6819081">(</span><span class="op" id="6819082">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6819086">testUnixgramWriteConn</span><span class="op" id="6819107">(</span><span class="ident" id="6819108">t</span><span class="op" id="6819109">,</span>&nbsp;<span class="ident" id="6819111">laddr</span><span class="op" id="6819116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6819119">testUnixgramWritePacketConn</span><span class="op" id="6819146">(</span><span class="ident" id="6819147">t</span><span class="op" id="6819148">,</span>&nbsp;<span class="ident" id="6819150">laddr</span><span class="op" id="6819155">)</span><br>
<span class="lineno"></span><span class="op" id="6819157">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6819160">func</span>&nbsp;<span class="ident" id="6819165">testUnixgramWriteConn</span><span class="op" id="6819186">(</span><span class="ident" id="6819187">t</span>&nbsp;<span class="op" id="6819189">*</span><span class="ident" id="6819190">testing</span><span class="op" id="6819197">.</span><span class="ident" id="6819198">T</span><span class="op" id="6819199">,</span>&nbsp;<span class="ident" id="6819201">raddr</span>&nbsp;<span class="op" id="6819207">*</span><span class="ident" id="6819208">UnixAddr</span><span class="op" id="6819216">)</span>&nbsp;<span class="op" id="6819218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6819221">c</span><span class="op" id="6819222">,</span>&nbsp;<span class="ident" id="6819224">err</span>&nbsp;<span class="op" id="6819228">:=</span>&nbsp;<span class="ident" id="6819231">Dial</span><span class="op" id="6819235">(</span><span class="string" id="6819236">&#34;unixgram&#34;</span><span class="op" id="6819246">,</span>&nbsp;<span class="ident" id="6819248">raddr</span><span class="op" id="6819253">.</span><span class="ident" id="6819254">String</span><span class="op" id="6819260">(</span><span class="op" id="6819261">)</span><span class="op" id="6819262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6819265">if</span>&nbsp;<span class="ident" id="6819268">err</span>&nbsp;<span class="op" id="6819272">!=</span>&nbsp;<span class="builtintype" id="6819275">nil</span>&nbsp;<span class="op" id="6819279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6819283">t</span><span class="op" id="6819284">.</span><span class="ident" id="6819285">Fatalf</span><span class="op" id="6819291">(</span><span class="string" id="6819292">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6819309">,</span>&nbsp;<span class="ident" id="6819311">err</span><span class="op" id="6819314">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6819317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6819320">defer</span>&nbsp;<span class="ident" id="6819326">c</span><span class="op" id="6819327">.</span><span class="ident" id="6819328">Close</span><span class="op" id="6819333">(</span><span class="op" id="6819334">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6819338">if</span>&nbsp;<span class="ident" id="6819341">_</span><span class="op" id="6819342">,</span>&nbsp;<span class="ident" id="6819344">err</span>&nbsp;<span class="op" id="6819348">:=</span>&nbsp;<span class="ident" id="6819351">c</span><span class="op" id="6819352">.</span><span class="op" id="6819353">(</span><span class="op" id="6819354">*</span><span class="ident" id="6819355">UnixConn</span><span class="op" id="6819363">)</span><span class="op" id="6819364">.</span><span class="ident" id="6819365">WriteToUnix</span><span class="op" id="6819376">(</span><span class="op" id="6819377">[</span><span class="op" id="6819378">]</span><span class="builtintype" id="6819379">byte</span><span class="op" id="6819383">(</span><span class="string" id="6819384">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6819417">)</span><span class="op" id="6819418">,</span>&nbsp;<span class="ident" id="6819420">raddr</span><span class="op" id="6819425">)</span><span class="op" id="6819426">;</span>&nbsp;<span class="ident" id="6819428">err</span>&nbsp;<span class="op" id="6819432">==</span>&nbsp;<span class="builtintype" id="6819435">nil</span>&nbsp;<span class="op" id="6819439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6819443">t</span><span class="op" id="6819444">.</span><span class="ident" id="6819445">Fatal</span><span class="op" id="6819450">(</span><span class="string" id="6819451">&#34;WriteToUnix&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6819476">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6819479">}</span>&nbsp;<span class="keyword" id="6819481">else</span>&nbsp;<span class="keyword" id="6819486">if</span>&nbsp;<span class="ident" id="6819489">err</span><span class="op" id="6819492">.</span><span class="op" id="6819493">(</span><span class="op" id="6819494">*</span><span class="ident" id="6819495">OpError</span><span class="op" id="6819502">)</span><span class="op" id="6819503">.</span><span class="ident" id="6819504">Err</span>&nbsp;<span class="op" id="6819508">!=</span>&nbsp;<span class="ident" id="6819511">ErrWriteToConnected</span>&nbsp;<span class="op" id="6819531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6819535">t</span><span class="op" id="6819536">.</span><span class="ident" id="6819537">Fatalf</span><span class="op" id="6819543">(</span><span class="string" id="6819544">&#34;WriteToUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6819596">,</span>&nbsp;<span class="ident" id="6819598">err</span><span class="op" id="6819601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6819604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6819607">if</span>&nbsp;<span class="ident" id="6819610">_</span><span class="op" id="6819611">,</span>&nbsp;<span class="ident" id="6819613">err</span>&nbsp;<span class="op" id="6819617">=</span>&nbsp;<span class="ident" id="6819619">c</span><span class="op" id="6819620">.</span><span class="op" id="6819621">(</span><span class="op" id="6819622">*</span><span class="ident" id="6819623">UnixConn</span><span class="op" id="6819631">)</span><span class="op" id="6819632">.</span><span class="ident" id="6819633">WriteTo</span><span class="op" id="6819640">(</span><span class="op" id="6819641">[</span><span class="op" id="6819642">]</span><span class="builtintype" id="6819643">byte</span><span class="op" id="6819647">(</span><span class="string" id="6819648">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6819681">)</span><span class="op" id="6819682">,</span>&nbsp;<span class="ident" id="6819684">raddr</span><span class="op" id="6819689">)</span><span class="op" id="6819690">;</span>&nbsp;<span class="ident" id="6819692">err</span>&nbsp;<span class="op" id="6819696">==</span>&nbsp;<span class="builtintype" id="6819699">nil</span>&nbsp;<span class="op" id="6819703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6819707">t</span><span class="op" id="6819708">.</span><span class="ident" id="6819709">Fatal</span><span class="op" id="6819714">(</span><span class="string" id="6819715">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6819736">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6819739">}</span>&nbsp;<span class="keyword" id="6819741">else</span>&nbsp;<span class="keyword" id="6819746">if</span>&nbsp;<span class="ident" id="6819749">err</span><span class="op" id="6819752">.</span><span class="op" id="6819753">(</span><span class="op" id="6819754">*</span><span class="ident" id="6819755">OpError</span><span class="op" id="6819762">)</span><span class="op" id="6819763">.</span><span class="ident" id="6819764">Err</span>&nbsp;<span class="op" id="6819768">!=</span>&nbsp;<span class="ident" id="6819771">ErrWriteToConnected</span>&nbsp;<span class="op" id="6819791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6819795">t</span><span class="op" id="6819796">.</span><span class="ident" id="6819797">Fatalf</span><span class="op" id="6819803">(</span><span class="string" id="6819804">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6819852">,</span>&nbsp;<span class="ident" id="6819854">err</span><span class="op" id="6819857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6819860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6819863">if</span>&nbsp;<span class="ident" id="6819866">_</span><span class="op" id="6819867">,</span>&nbsp;<span class="ident" id="6819869">_</span><span class="op" id="6819870">,</span>&nbsp;<span class="ident" id="6819872">err</span>&nbsp;<span class="op" id="6819876">=</span>&nbsp;<span class="ident" id="6819878">c</span><span class="op" id="6819879">.</span><span class="op" id="6819880">(</span><span class="op" id="6819881">*</span><span class="ident" id="6819882">UnixConn</span><span class="op" id="6819890">)</span><span class="op" id="6819891">.</span><span class="ident" id="6819892">WriteMsgUnix</span><span class="op" id="6819904">(</span><span class="op" id="6819905">[</span><span class="op" id="6819906">]</span><span class="builtintype" id="6819907">byte</span><span class="op" id="6819911">(</span><span class="string" id="6819912">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6819945">)</span><span class="op" id="6819946">,</span>&nbsp;<span class="builtintype" id="6819948">nil</span><span class="op" id="6819951">,</span>&nbsp;<span class="ident" id="6819953">raddr</span><span class="op" id="6819958">)</span><span class="op" id="6819959">;</span>&nbsp;<span class="ident" id="6819961">err</span>&nbsp;<span class="op" id="6819965">==</span>&nbsp;<span class="builtintype" id="6819968">nil</span>&nbsp;<span class="op" id="6819972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6819976">t</span><span class="op" id="6819977">.</span><span class="ident" id="6819978">Fatal</span><span class="op" id="6819983">(</span><span class="string" id="6819984">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6820005">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820008">}</span>&nbsp;<span class="keyword" id="6820010">else</span>&nbsp;<span class="keyword" id="6820015">if</span>&nbsp;<span class="ident" id="6820018">err</span><span class="op" id="6820021">.</span><span class="op" id="6820022">(</span><span class="op" id="6820023">*</span><span class="ident" id="6820024">OpError</span><span class="op" id="6820031">)</span><span class="op" id="6820032">.</span><span class="ident" id="6820033">Err</span>&nbsp;<span class="op" id="6820037">!=</span>&nbsp;<span class="ident" id="6820040">ErrWriteToConnected</span>&nbsp;<span class="op" id="6820060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6820064">t</span><span class="op" id="6820065">.</span><span class="ident" id="6820066">Fatalf</span><span class="op" id="6820072">(</span><span class="string" id="6820073">&#34;WriteMsgUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6820126">,</span>&nbsp;<span class="ident" id="6820128">err</span><span class="op" id="6820131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6820137">if</span>&nbsp;<span class="ident" id="6820140">_</span><span class="op" id="6820141">,</span>&nbsp;<span class="ident" id="6820143">err</span>&nbsp;<span class="op" id="6820147">:=</span>&nbsp;<span class="ident" id="6820150">c</span><span class="op" id="6820151">.</span><span class="ident" id="6820152">Write</span><span class="op" id="6820157">(</span><span class="op" id="6820158">[</span><span class="op" id="6820159">]</span><span class="builtintype" id="6820160">byte</span><span class="op" id="6820164">(</span><span class="string" id="6820165">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6820198">)</span><span class="op" id="6820199">)</span><span class="op" id="6820200">;</span>&nbsp;<span class="ident" id="6820202">err</span>&nbsp;<span class="op" id="6820206">!=</span>&nbsp;<span class="builtintype" id="6820209">nil</span>&nbsp;<span class="op" id="6820213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6820217">t</span><span class="op" id="6820218">.</span><span class="ident" id="6820219">Fatalf</span><span class="op" id="6820225">(</span><span class="string" id="6820226">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6820244">,</span>&nbsp;<span class="ident" id="6820246">err</span><span class="op" id="6820249">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820252">}</span><br>
<span class="lineno"></span><span class="op" id="6820254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6820257">func</span>&nbsp;<span class="ident" id="6820262">testUnixgramWritePacketConn</span><span class="op" id="6820289">(</span><span class="ident" id="6820290">t</span>&nbsp;<span class="op" id="6820292">*</span><span class="ident" id="6820293">testing</span><span class="op" id="6820300">.</span><span class="ident" id="6820301">T</span><span class="op" id="6820302">,</span>&nbsp;<span class="ident" id="6820304">raddr</span>&nbsp;<span class="op" id="6820310">*</span><span class="ident" id="6820311">UnixAddr</span><span class="op" id="6820319">)</span>&nbsp;<span class="op" id="6820321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6820324">addr</span>&nbsp;<span class="op" id="6820329">:=</span>&nbsp;<span class="ident" id="6820332">testUnixAddr</span><span class="op" id="6820344">(</span><span class="op" id="6820345">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6820348">c</span><span class="op" id="6820349">,</span>&nbsp;<span class="ident" id="6820351">err</span>&nbsp;<span class="op" id="6820355">:=</span>&nbsp;<span class="ident" id="6820358">ListenPacket</span><span class="op" id="6820370">(</span><span class="string" id="6820371">&#34;unixgram&#34;</span><span class="op" id="6820381">,</span>&nbsp;<span class="ident" id="6820383">addr</span><span class="op" id="6820387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6820390">if</span>&nbsp;<span class="ident" id="6820393">err</span>&nbsp;<span class="op" id="6820397">!=</span>&nbsp;<span class="builtintype" id="6820400">nil</span>&nbsp;<span class="op" id="6820404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6820408">t</span><span class="op" id="6820409">.</span><span class="ident" id="6820410">Fatalf</span><span class="op" id="6820416">(</span><span class="string" id="6820417">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6820442">,</span>&nbsp;<span class="ident" id="6820444">err</span><span class="op" id="6820447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6820453">defer</span>&nbsp;<span class="ident" id="6820459">os</span><span class="op" id="6820461">.</span><span class="ident" id="6820462">Remove</span><span class="op" id="6820468">(</span><span class="ident" id="6820469">addr</span><span class="op" id="6820473">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6820476">defer</span>&nbsp;<span class="ident" id="6820482">c</span><span class="op" id="6820483">.</span><span class="ident" id="6820484">Close</span><span class="op" id="6820489">(</span><span class="op" id="6820490">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6820494">if</span>&nbsp;<span class="ident" id="6820497">_</span><span class="op" id="6820498">,</span>&nbsp;<span class="ident" id="6820500">err</span>&nbsp;<span class="op" id="6820504">:=</span>&nbsp;<span class="ident" id="6820507">c</span><span class="op" id="6820508">.</span><span class="op" id="6820509">(</span><span class="op" id="6820510">*</span><span class="ident" id="6820511">UnixConn</span><span class="op" id="6820519">)</span><span class="op" id="6820520">.</span><span class="ident" id="6820521">WriteToUnix</span><span class="op" id="6820532">(</span><span class="op" id="6820533">[</span><span class="op" id="6820534">]</span><span class="builtintype" id="6820535">byte</span><span class="op" id="6820539">(</span><span class="string" id="6820540">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6820568">)</span><span class="op" id="6820569">,</span>&nbsp;<span class="ident" id="6820571">raddr</span><span class="op" id="6820576">)</span><span class="op" id="6820577">;</span>&nbsp;<span class="ident" id="6820579">err</span>&nbsp;<span class="op" id="6820583">!=</span>&nbsp;<span class="builtintype" id="6820586">nil</span>&nbsp;<span class="op" id="6820590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6820594">t</span><span class="op" id="6820595">.</span><span class="ident" id="6820596">Fatalf</span><span class="op" id="6820602">(</span><span class="string" id="6820603">&#34;WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6820627">,</span>&nbsp;<span class="ident" id="6820629">err</span><span class="op" id="6820632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820635">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6820638">if</span>&nbsp;<span class="ident" id="6820641">_</span><span class="op" id="6820642">,</span>&nbsp;<span class="ident" id="6820644">err</span>&nbsp;<span class="op" id="6820648">:=</span>&nbsp;<span class="ident" id="6820651">c</span><span class="op" id="6820652">.</span><span class="ident" id="6820653">WriteTo</span><span class="op" id="6820660">(</span><span class="op" id="6820661">[</span><span class="op" id="6820662">]</span><span class="builtintype" id="6820663">byte</span><span class="op" id="6820667">(</span><span class="string" id="6820668">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6820696">)</span><span class="op" id="6820697">,</span>&nbsp;<span class="ident" id="6820699">raddr</span><span class="op" id="6820704">)</span><span class="op" id="6820705">;</span>&nbsp;<span class="ident" id="6820707">err</span>&nbsp;<span class="op" id="6820711">!=</span>&nbsp;<span class="builtintype" id="6820714">nil</span>&nbsp;<span class="op" id="6820718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6820722">t</span><span class="op" id="6820723">.</span><span class="ident" id="6820724">Fatalf</span><span class="op" id="6820730">(</span><span class="string" id="6820731">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6820751">,</span>&nbsp;<span class="ident" id="6820753">err</span><span class="op" id="6820756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6820762">if</span>&nbsp;<span class="ident" id="6820765">_</span><span class="op" id="6820766">,</span>&nbsp;<span class="ident" id="6820768">_</span><span class="op" id="6820769">,</span>&nbsp;<span class="ident" id="6820771">err</span>&nbsp;<span class="op" id="6820775">:=</span>&nbsp;<span class="ident" id="6820778">c</span><span class="op" id="6820779">.</span><span class="op" id="6820780">(</span><span class="op" id="6820781">*</span><span class="ident" id="6820782">UnixConn</span><span class="op" id="6820790">)</span><span class="op" id="6820791">.</span><span class="ident" id="6820792">WriteMsgUnix</span><span class="op" id="6820804">(</span><span class="op" id="6820805">[</span><span class="op" id="6820806">]</span><span class="builtintype" id="6820807">byte</span><span class="op" id="6820811">(</span><span class="string" id="6820812">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6820840">)</span><span class="op" id="6820841">,</span>&nbsp;<span class="builtintype" id="6820843">nil</span><span class="op" id="6820846">,</span>&nbsp;<span class="ident" id="6820848">raddr</span><span class="op" id="6820853">)</span><span class="op" id="6820854">;</span>&nbsp;<span class="ident" id="6820856">err</span>&nbsp;<span class="op" id="6820860">!=</span>&nbsp;<span class="builtintype" id="6820863">nil</span>&nbsp;<span class="op" id="6820867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6820871">t</span><span class="op" id="6820872">.</span><span class="ident" id="6820873">Fatalf</span><span class="op" id="6820879">(</span><span class="string" id="6820880">&#34;WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6820905">,</span>&nbsp;<span class="ident" id="6820907">err</span><span class="op" id="6820910">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6820916">if</span>&nbsp;<span class="ident" id="6820919">_</span><span class="op" id="6820920">,</span>&nbsp;<span class="ident" id="6820922">err</span>&nbsp;<span class="op" id="6820926">:=</span>&nbsp;<span class="ident" id="6820929">c</span><span class="op" id="6820930">.</span><span class="op" id="6820931">(</span><span class="op" id="6820932">*</span><span class="ident" id="6820933">UnixConn</span><span class="op" id="6820941">)</span><span class="op" id="6820942">.</span><span class="ident" id="6820943">Write</span><span class="op" id="6820948">(</span><span class="op" id="6820949">[</span><span class="op" id="6820950">]</span><span class="builtintype" id="6820951">byte</span><span class="op" id="6820955">(</span><span class="string" id="6820956">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6820984">)</span><span class="op" id="6820985">)</span><span class="op" id="6820986">;</span>&nbsp;<span class="ident" id="6820988">err</span>&nbsp;<span class="op" id="6820992">==</span>&nbsp;<span class="builtintype" id="6820995">nil</span>&nbsp;<span class="op" id="6820999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821003">t</span><span class="op" id="6821004">.</span><span class="ident" id="6821005">Fatal</span><span class="op" id="6821010">(</span><span class="string" id="6821011">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6821030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821033">}</span><br>
<span class="lineno"></span><span class="op" id="6821035">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="6821038">func</span>&nbsp;<span class="ident" id="6821043">TestUnixConnLocalAndRemoteNames</span><span class="op" id="6821074">(</span><span class="ident" id="6821075">t</span>&nbsp;<span class="op" id="6821077">*</span><span class="ident" id="6821078">testing</span><span class="op" id="6821085">.</span><span class="ident" id="6821086">T</span><span class="op" id="6821087">)</span>&nbsp;<span class="op" id="6821089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821092">for</span>&nbsp;<span class="ident" id="6821096">_</span><span class="op" id="6821097">,</span>&nbsp;<span class="ident" id="6821099">laddr</span>&nbsp;<span class="op" id="6821105">:=</span>&nbsp;<span class="keyword" id="6821108">range</span>&nbsp;<span class="op" id="6821114">[</span><span class="op" id="6821115">]</span><span class="builtintype" id="6821116">string</span><span class="op" id="6821122">{</span><span class="string" id="6821123">&#34;&#34;</span><span class="op" id="6821125">,</span>&nbsp;<span class="ident" id="6821127">testUnixAddr</span><span class="op" id="6821139">(</span><span class="op" id="6821140">)</span><span class="op" id="6821141">}</span>&nbsp;<span class="op" id="6821143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821147">laddr</span>&nbsp;<span class="op" id="6821153">:=</span>&nbsp;<span class="ident" id="6821156">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821164">taddr</span>&nbsp;<span class="op" id="6821170">:=</span>&nbsp;<span class="ident" id="6821173">testUnixAddr</span><span class="op" id="6821185">(</span><span class="op" id="6821186">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821190">ta</span><span class="op" id="6821192">,</span>&nbsp;<span class="ident" id="6821194">err</span>&nbsp;<span class="op" id="6821198">:=</span>&nbsp;<span class="ident" id="6821201">ResolveUnixAddr</span><span class="op" id="6821216">(</span><span class="string" id="6821217">&#34;unix&#34;</span><span class="op" id="6821223">,</span>&nbsp;<span class="ident" id="6821225">taddr</span><span class="op" id="6821230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821234">if</span>&nbsp;<span class="ident" id="6821237">err</span>&nbsp;<span class="op" id="6821241">!=</span>&nbsp;<span class="builtintype" id="6821244">nil</span>&nbsp;<span class="op" id="6821248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821253">t</span><span class="op" id="6821254">.</span><span class="ident" id="6821255">Fatalf</span><span class="op" id="6821261">(</span><span class="string" id="6821262">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6821290">,</span>&nbsp;<span class="ident" id="6821292">err</span><span class="op" id="6821295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821303">ln</span><span class="op" id="6821305">,</span>&nbsp;<span class="ident" id="6821307">err</span>&nbsp;<span class="op" id="6821311">:=</span>&nbsp;<span class="ident" id="6821314">ListenUnix</span><span class="op" id="6821324">(</span><span class="string" id="6821325">&#34;unix&#34;</span><span class="op" id="6821331">,</span>&nbsp;<span class="ident" id="6821333">ta</span><span class="op" id="6821335">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821339">if</span>&nbsp;<span class="ident" id="6821342">err</span>&nbsp;<span class="op" id="6821346">!=</span>&nbsp;<span class="builtintype" id="6821349">nil</span>&nbsp;<span class="op" id="6821353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821358">t</span><span class="op" id="6821359">.</span><span class="ident" id="6821360">Fatalf</span><span class="op" id="6821366">(</span><span class="string" id="6821367">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6821390">,</span>&nbsp;<span class="ident" id="6821392">err</span><span class="op" id="6821395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821403">defer</span>&nbsp;<span class="keyword" id="6821409">func</span><span class="op" id="6821413">(</span><span class="op" id="6821414">)</span>&nbsp;<span class="op" id="6821416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821421">ln</span><span class="op" id="6821423">.</span><span class="ident" id="6821424">Close</span><span class="op" id="6821429">(</span><span class="op" id="6821430">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821435">os</span><span class="op" id="6821437">.</span><span class="ident" id="6821438">Remove</span><span class="op" id="6821444">(</span><span class="ident" id="6821445">taddr</span><span class="op" id="6821450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821454">}</span><span class="op" id="6821455">(</span><span class="op" id="6821456">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821461">done</span>&nbsp;<span class="op" id="6821466">:=</span>&nbsp;<span class="builtinfunc" id="6821469">make</span><span class="op" id="6821473">(</span><span class="keyword" id="6821474">chan</span>&nbsp;<span class="builtintype" id="6821479">int</span><span class="op" id="6821482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821486">go</span>&nbsp;<span class="ident" id="6821489">transponder</span><span class="op" id="6821500">(</span><span class="ident" id="6821501">t</span><span class="op" id="6821502">,</span>&nbsp;<span class="ident" id="6821504">ln</span><span class="op" id="6821506">,</span>&nbsp;<span class="ident" id="6821508">done</span><span class="op" id="6821512">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821517">la</span><span class="op" id="6821519">,</span>&nbsp;<span class="ident" id="6821521">err</span>&nbsp;<span class="op" id="6821525">:=</span>&nbsp;<span class="ident" id="6821528">ResolveUnixAddr</span><span class="op" id="6821543">(</span><span class="string" id="6821544">&#34;unix&#34;</span><span class="op" id="6821550">,</span>&nbsp;<span class="ident" id="6821552">laddr</span><span class="op" id="6821557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821561">if</span>&nbsp;<span class="ident" id="6821564">err</span>&nbsp;<span class="op" id="6821568">!=</span>&nbsp;<span class="builtintype" id="6821571">nil</span>&nbsp;<span class="op" id="6821575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821580">t</span><span class="op" id="6821581">.</span><span class="ident" id="6821582">Fatalf</span><span class="op" id="6821588">(</span><span class="string" id="6821589">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6821617">,</span>&nbsp;<span class="ident" id="6821619">err</span><span class="op" id="6821622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821626">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821630">c</span><span class="op" id="6821631">,</span>&nbsp;<span class="ident" id="6821633">err</span>&nbsp;<span class="op" id="6821637">:=</span>&nbsp;<span class="ident" id="6821640">DialUnix</span><span class="op" id="6821648">(</span><span class="string" id="6821649">&#34;unix&#34;</span><span class="op" id="6821655">,</span>&nbsp;<span class="ident" id="6821657">la</span><span class="op" id="6821659">,</span>&nbsp;<span class="ident" id="6821661">ta</span><span class="op" id="6821663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821667">if</span>&nbsp;<span class="ident" id="6821670">err</span>&nbsp;<span class="op" id="6821674">!=</span>&nbsp;<span class="builtintype" id="6821677">nil</span>&nbsp;<span class="op" id="6821681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821686">t</span><span class="op" id="6821687">.</span><span class="ident" id="6821688">Fatalf</span><span class="op" id="6821694">(</span><span class="string" id="6821695">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6821716">,</span>&nbsp;<span class="ident" id="6821718">err</span><span class="op" id="6821721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821729">defer</span>&nbsp;<span class="keyword" id="6821735">func</span><span class="op" id="6821739">(</span><span class="op" id="6821740">)</span>&nbsp;<span class="op" id="6821742">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821747">c</span><span class="op" id="6821748">.</span><span class="ident" id="6821749">Close</span><span class="op" id="6821754">(</span><span class="op" id="6821755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821760">if</span>&nbsp;<span class="ident" id="6821763">la</span>&nbsp;<span class="op" id="6821766">!=</span>&nbsp;<span class="builtintype" id="6821769">nil</span>&nbsp;<span class="op" id="6821773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821779">defer</span>&nbsp;<span class="ident" id="6821785">os</span><span class="op" id="6821787">.</span><span class="ident" id="6821788">Remove</span><span class="op" id="6821794">(</span><span class="ident" id="6821795">laddr</span><span class="op" id="6821800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821809">}</span><span class="op" id="6821810">(</span><span class="op" id="6821811">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821815">if</span>&nbsp;<span class="ident" id="6821818">_</span><span class="op" id="6821819">,</span>&nbsp;<span class="ident" id="6821821">err</span>&nbsp;<span class="op" id="6821825">:=</span>&nbsp;<span class="ident" id="6821828">c</span><span class="op" id="6821829">.</span><span class="ident" id="6821830">Write</span><span class="op" id="6821835">(</span><span class="op" id="6821836">[</span><span class="op" id="6821837">]</span><span class="builtintype" id="6821838">byte</span><span class="op" id="6821842">(</span><span class="string" id="6821843">&#34;UNIXCONN&nbsp;LOCAL&nbsp;AND&nbsp;REMOTE&nbsp;NAME&nbsp;TEST&#34;</span><span class="op" id="6821880">)</span><span class="op" id="6821881">)</span><span class="op" id="6821882">;</span>&nbsp;<span class="ident" id="6821884">err</span>&nbsp;<span class="op" id="6821888">!=</span>&nbsp;<span class="builtintype" id="6821891">nil</span>&nbsp;<span class="op" id="6821895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821900">t</span><span class="op" id="6821901">.</span><span class="ident" id="6821902">Fatalf</span><span class="op" id="6821908">(</span><span class="string" id="6821909">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6821936">,</span>&nbsp;<span class="ident" id="6821938">err</span><span class="op" id="6821941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821950">switch</span>&nbsp;<span class="ident" id="6821957">runtime</span><span class="op" id="6821964">.</span><span class="ident" id="6821965">GOOS</span>&nbsp;<span class="op" id="6821970">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821974">case</span>&nbsp;<span class="string" id="6821979">&#34;android&#34;</span><span class="op" id="6821988">,</span>&nbsp;<span class="string" id="6821990">&#34;linux&#34;</span><span class="op" id="6821997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822002">if</span>&nbsp;<span class="ident" id="6822005">laddr</span>&nbsp;<span class="op" id="6822011">==</span>&nbsp;<span class="string" id="6822014">&#34;&#34;</span>&nbsp;<span class="op" id="6822017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822023">laddr</span>&nbsp;<span class="op" id="6822029">=</span>&nbsp;<span class="string" id="6822031">&#34;@&#34;</span>&nbsp;<span class="comment" id="6822035">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822062">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822066">var</span>&nbsp;<span class="ident" id="6822070">connAddrs</span>&nbsp;<span class="op" id="6822080">=</span>&nbsp;<span class="op" id="6822082">[</span><span class="num" id="6822083">3</span><span class="op" id="6822084">]</span><span class="keyword" id="6822085">struct</span><span class="op" id="6822091">{</span>&nbsp;<span class="ident" id="6822093">got</span><span class="op" id="6822096">,</span>&nbsp;<span class="ident" id="6822098">want</span>&nbsp;<span class="ident" id="6822103">Addr</span>&nbsp;<span class="op" id="6822108">}</span><span class="op" id="6822109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822114">{</span><span class="ident" id="6822115">ln</span><span class="op" id="6822117">.</span><span class="ident" id="6822118">Addr</span><span class="op" id="6822122">(</span><span class="op" id="6822123">)</span><span class="op" id="6822124">,</span>&nbsp;<span class="ident" id="6822126">ta</span><span class="op" id="6822128">}</span><span class="op" id="6822129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822134">{</span><span class="ident" id="6822135">c</span><span class="op" id="6822136">.</span><span class="ident" id="6822137">LocalAddr</span><span class="op" id="6822146">(</span><span class="op" id="6822147">)</span><span class="op" id="6822148">,</span>&nbsp;<span class="op" id="6822150">&amp;</span><span class="ident" id="6822151">UnixAddr</span><span class="op" id="6822159">{</span><span class="ident" id="6822160">Name</span><span class="op" id="6822164">:</span>&nbsp;<span class="ident" id="6822166">laddr</span><span class="op" id="6822171">,</span>&nbsp;<span class="ident" id="6822173">Net</span><span class="op" id="6822176">:</span>&nbsp;<span class="string" id="6822178">&#34;unix&#34;</span><span class="op" id="6822184">}</span><span class="op" id="6822185">}</span><span class="op" id="6822186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822191">{</span><span class="ident" id="6822192">c</span><span class="op" id="6822193">.</span><span class="ident" id="6822194">RemoteAddr</span><span class="op" id="6822204">(</span><span class="op" id="6822205">)</span><span class="op" id="6822206">,</span>&nbsp;<span class="ident" id="6822208">ta</span><span class="op" id="6822210">}</span><span class="op" id="6822211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822215">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822219">for</span>&nbsp;<span class="ident" id="6822223">_</span><span class="op" id="6822224">,</span>&nbsp;<span class="ident" id="6822226">ca</span>&nbsp;<span class="op" id="6822229">:=</span>&nbsp;<span class="keyword" id="6822232">range</span>&nbsp;<span class="ident" id="6822238">connAddrs</span>&nbsp;<span class="op" id="6822248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822253">if</span>&nbsp;<span class="op" id="6822256">!</span><span class="ident" id="6822257">reflect</span><span class="op" id="6822264">.</span><span class="ident" id="6822265">DeepEqual</span><span class="op" id="6822274">(</span><span class="ident" id="6822275">ca</span><span class="op" id="6822277">.</span><span class="ident" id="6822278">got</span><span class="op" id="6822281">,</span>&nbsp;<span class="ident" id="6822283">ca</span><span class="op" id="6822285">.</span><span class="ident" id="6822286">want</span><span class="op" id="6822290">)</span>&nbsp;<span class="op" id="6822292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822298">t</span><span class="op" id="6822299">.</span><span class="ident" id="6822300">Fatalf</span><span class="op" id="6822306">(</span><span class="string" id="6822307">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6822330">,</span>&nbsp;<span class="ident" id="6822332">ca</span><span class="op" id="6822334">.</span><span class="ident" id="6822335">got</span><span class="op" id="6822338">,</span>&nbsp;<span class="ident" id="6822340">ca</span><span class="op" id="6822342">.</span><span class="ident" id="6822343">want</span><span class="op" id="6822347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822356">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822361">&lt;-</span><span class="ident" id="6822363">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822369">}</span><br>
<span class="lineno"></span><span class="op" id="6822371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6822374">func</span>&nbsp;<span class="ident" id="6822379">TestUnixgramConnLocalAndRemoteNames</span><span class="op" id="6822414">(</span><span class="ident" id="6822415">t</span>&nbsp;<span class="op" id="6822417">*</span><span class="ident" id="6822418">testing</span><span class="op" id="6822425">.</span><span class="ident" id="6822426">T</span><span class="op" id="6822427">)</span>&nbsp;<span class="op" id="6822429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822432">for</span>&nbsp;<span class="ident" id="6822436">_</span><span class="op" id="6822437">,</span>&nbsp;<span class="ident" id="6822439">laddr</span>&nbsp;<span class="op" id="6822445">:=</span>&nbsp;<span class="keyword" id="6822448">range</span>&nbsp;<span class="op" id="6822454">[</span><span class="op" id="6822455">]</span><span class="builtintype" id="6822456">string</span><span class="op" id="6822462">{</span><span class="string" id="6822463">&#34;&#34;</span><span class="op" id="6822465">,</span>&nbsp;<span class="ident" id="6822467">testUnixAddr</span><span class="op" id="6822479">(</span><span class="op" id="6822480">)</span><span class="op" id="6822481">}</span>&nbsp;<span class="op" id="6822483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822487">laddr</span>&nbsp;<span class="op" id="6822493">:=</span>&nbsp;<span class="ident" id="6822496">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822504">taddr</span>&nbsp;<span class="op" id="6822510">:=</span>&nbsp;<span class="ident" id="6822513">testUnixAddr</span><span class="op" id="6822525">(</span><span class="op" id="6822526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822530">ta</span><span class="op" id="6822532">,</span>&nbsp;<span class="ident" id="6822534">err</span>&nbsp;<span class="op" id="6822538">:=</span>&nbsp;<span class="ident" id="6822541">ResolveUnixAddr</span><span class="op" id="6822556">(</span><span class="string" id="6822557">&#34;unixgram&#34;</span><span class="op" id="6822567">,</span>&nbsp;<span class="ident" id="6822569">taddr</span><span class="op" id="6822574">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822578">if</span>&nbsp;<span class="ident" id="6822581">err</span>&nbsp;<span class="op" id="6822585">!=</span>&nbsp;<span class="builtintype" id="6822588">nil</span>&nbsp;<span class="op" id="6822592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822597">t</span><span class="op" id="6822598">.</span><span class="ident" id="6822599">Fatalf</span><span class="op" id="6822605">(</span><span class="string" id="6822606">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6822634">,</span>&nbsp;<span class="ident" id="6822636">err</span><span class="op" id="6822639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822647">c1</span><span class="op" id="6822649">,</span>&nbsp;<span class="ident" id="6822651">err</span>&nbsp;<span class="op" id="6822655">:=</span>&nbsp;<span class="ident" id="6822658">ListenUnixgram</span><span class="op" id="6822672">(</span><span class="string" id="6822673">&#34;unixgram&#34;</span><span class="op" id="6822683">,</span>&nbsp;<span class="ident" id="6822685">ta</span><span class="op" id="6822687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822691">if</span>&nbsp;<span class="ident" id="6822694">err</span>&nbsp;<span class="op" id="6822698">!=</span>&nbsp;<span class="builtintype" id="6822701">nil</span>&nbsp;<span class="op" id="6822705">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822710">t</span><span class="op" id="6822711">.</span><span class="ident" id="6822712">Fatalf</span><span class="op" id="6822718">(</span><span class="string" id="6822719">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6822746">,</span>&nbsp;<span class="ident" id="6822748">err</span><span class="op" id="6822751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822759">defer</span>&nbsp;<span class="keyword" id="6822765">func</span><span class="op" id="6822769">(</span><span class="op" id="6822770">)</span>&nbsp;<span class="op" id="6822772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822777">c1</span><span class="op" id="6822779">.</span><span class="ident" id="6822780">Close</span><span class="op" id="6822785">(</span><span class="op" id="6822786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822791">os</span><span class="op" id="6822793">.</span><span class="ident" id="6822794">Remove</span><span class="op" id="6822800">(</span><span class="ident" id="6822801">taddr</span><span class="op" id="6822806">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822810">}</span><span class="op" id="6822811">(</span><span class="op" id="6822812">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822817">var</span>&nbsp;<span class="ident" id="6822821">la</span>&nbsp;<span class="op" id="6822824">*</span><span class="ident" id="6822825">UnixAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822836">if</span>&nbsp;<span class="ident" id="6822839">laddr</span>&nbsp;<span class="op" id="6822845">!=</span>&nbsp;<span class="string" id="6822848">&#34;&#34;</span>&nbsp;<span class="op" id="6822851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822856">if</span>&nbsp;<span class="ident" id="6822859">la</span><span class="op" id="6822861">,</span>&nbsp;<span class="ident" id="6822863">err</span>&nbsp;<span class="op" id="6822867">=</span>&nbsp;<span class="ident" id="6822869">ResolveUnixAddr</span><span class="op" id="6822884">(</span><span class="string" id="6822885">&#34;unixgram&#34;</span><span class="op" id="6822895">,</span>&nbsp;<span class="ident" id="6822897">laddr</span><span class="op" id="6822902">)</span><span class="op" id="6822903">;</span>&nbsp;<span class="ident" id="6822905">err</span>&nbsp;<span class="op" id="6822909">!=</span>&nbsp;<span class="builtintype" id="6822912">nil</span>&nbsp;<span class="op" id="6822916">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822922">t</span><span class="op" id="6822923">.</span><span class="ident" id="6822924">Fatalf</span><span class="op" id="6822930">(</span><span class="string" id="6822931">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6822959">,</span>&nbsp;<span class="ident" id="6822961">err</span><span class="op" id="6822964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822977">c2</span><span class="op" id="6822979">,</span>&nbsp;<span class="ident" id="6822981">err</span>&nbsp;<span class="op" id="6822985">:=</span>&nbsp;<span class="ident" id="6822988">DialUnix</span><span class="op" id="6822996">(</span><span class="string" id="6822997">&#34;unixgram&#34;</span><span class="op" id="6823007">,</span>&nbsp;<span class="ident" id="6823009">la</span><span class="op" id="6823011">,</span>&nbsp;<span class="ident" id="6823013">ta</span><span class="op" id="6823015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823019">if</span>&nbsp;<span class="ident" id="6823022">err</span>&nbsp;<span class="op" id="6823026">!=</span>&nbsp;<span class="builtintype" id="6823029">nil</span>&nbsp;<span class="op" id="6823033">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823038">t</span><span class="op" id="6823039">.</span><span class="ident" id="6823040">Fatalf</span><span class="op" id="6823046">(</span><span class="string" id="6823047">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6823068">,</span>&nbsp;<span class="ident" id="6823070">err</span><span class="op" id="6823073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823081">defer</span>&nbsp;<span class="keyword" id="6823087">func</span><span class="op" id="6823091">(</span><span class="op" id="6823092">)</span>&nbsp;<span class="op" id="6823094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823099">c2</span><span class="op" id="6823101">.</span><span class="ident" id="6823102">Close</span><span class="op" id="6823107">(</span><span class="op" id="6823108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823113">if</span>&nbsp;<span class="ident" id="6823116">la</span>&nbsp;<span class="op" id="6823119">!=</span>&nbsp;<span class="builtintype" id="6823122">nil</span>&nbsp;<span class="op" id="6823126">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823132">defer</span>&nbsp;<span class="ident" id="6823138">os</span><span class="op" id="6823140">.</span><span class="ident" id="6823141">Remove</span><span class="op" id="6823147">(</span><span class="ident" id="6823148">laddr</span><span class="op" id="6823153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823162">}</span><span class="op" id="6823163">(</span><span class="op" id="6823164">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823169">switch</span>&nbsp;<span class="ident" id="6823176">runtime</span><span class="op" id="6823183">.</span><span class="ident" id="6823184">GOOS</span>&nbsp;<span class="op" id="6823189">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823193">case</span>&nbsp;<span class="string" id="6823198">&#34;android&#34;</span><span class="op" id="6823207">,</span>&nbsp;<span class="string" id="6823209">&#34;linux&#34;</span><span class="op" id="6823216">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823221">if</span>&nbsp;<span class="ident" id="6823224">laddr</span>&nbsp;<span class="op" id="6823230">==</span>&nbsp;<span class="string" id="6823233">&#34;&#34;</span>&nbsp;<span class="op" id="6823236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823242">laddr</span>&nbsp;<span class="op" id="6823248">=</span>&nbsp;<span class="string" id="6823250">&#34;@&#34;</span>&nbsp;<span class="comment" id="6823254">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823281">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823286">var</span>&nbsp;<span class="ident" id="6823290">connAddrs</span>&nbsp;<span class="op" id="6823300">=</span>&nbsp;<span class="op" id="6823302">[</span><span class="num" id="6823303">4</span><span class="op" id="6823304">]</span><span class="keyword" id="6823305">struct</span><span class="op" id="6823311">{</span>&nbsp;<span class="ident" id="6823313">got</span><span class="op" id="6823316">,</span>&nbsp;<span class="ident" id="6823318">want</span>&nbsp;<span class="ident" id="6823323">Addr</span>&nbsp;<span class="op" id="6823328">}</span><span class="op" id="6823329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823334">{</span><span class="ident" id="6823335">c1</span><span class="op" id="6823337">.</span><span class="ident" id="6823338">LocalAddr</span><span class="op" id="6823347">(</span><span class="op" id="6823348">)</span><span class="op" id="6823349">,</span>&nbsp;<span class="ident" id="6823351">ta</span><span class="op" id="6823353">}</span><span class="op" id="6823354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823359">{</span><span class="ident" id="6823360">c1</span><span class="op" id="6823362">.</span><span class="ident" id="6823363">RemoteAddr</span><span class="op" id="6823373">(</span><span class="op" id="6823374">)</span><span class="op" id="6823375">,</span>&nbsp;<span class="builtintype" id="6823377">nil</span><span class="op" id="6823380">}</span><span class="op" id="6823381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823386">{</span><span class="ident" id="6823387">c2</span><span class="op" id="6823389">.</span><span class="ident" id="6823390">LocalAddr</span><span class="op" id="6823399">(</span><span class="op" id="6823400">)</span><span class="op" id="6823401">,</span>&nbsp;<span class="op" id="6823403">&amp;</span><span class="ident" id="6823404">UnixAddr</span><span class="op" id="6823412">{</span><span class="ident" id="6823413">Name</span><span class="op" id="6823417">:</span>&nbsp;<span class="ident" id="6823419">laddr</span><span class="op" id="6823424">,</span>&nbsp;<span class="ident" id="6823426">Net</span><span class="op" id="6823429">:</span>&nbsp;<span class="string" id="6823431">&#34;unixgram&#34;</span><span class="op" id="6823441">}</span><span class="op" id="6823442">}</span><span class="op" id="6823443">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823448">{</span><span class="ident" id="6823449">c2</span><span class="op" id="6823451">.</span><span class="ident" id="6823452">RemoteAddr</span><span class="op" id="6823462">(</span><span class="op" id="6823463">)</span><span class="op" id="6823464">,</span>&nbsp;<span class="ident" id="6823466">ta</span><span class="op" id="6823468">}</span><span class="op" id="6823469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823477">for</span>&nbsp;<span class="ident" id="6823481">_</span><span class="op" id="6823482">,</span>&nbsp;<span class="ident" id="6823484">ca</span>&nbsp;<span class="op" id="6823487">:=</span>&nbsp;<span class="keyword" id="6823490">range</span>&nbsp;<span class="ident" id="6823496">connAddrs</span>&nbsp;<span class="op" id="6823506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823511">if</span>&nbsp;<span class="op" id="6823514">!</span><span class="ident" id="6823515">reflect</span><span class="op" id="6823522">.</span><span class="ident" id="6823523">DeepEqual</span><span class="op" id="6823532">(</span><span class="ident" id="6823533">ca</span><span class="op" id="6823535">.</span><span class="ident" id="6823536">got</span><span class="op" id="6823539">,</span>&nbsp;<span class="ident" id="6823541">ca</span><span class="op" id="6823543">.</span><span class="ident" id="6823544">want</span><span class="op" id="6823548">)</span>&nbsp;<span class="op" id="6823550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823556">t</span><span class="op" id="6823557">.</span><span class="ident" id="6823558">Fatalf</span><span class="op" id="6823564">(</span><span class="string" id="6823565">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6823588">,</span>&nbsp;<span class="ident" id="6823590">ca</span><span class="op" id="6823592">.</span><span class="ident" id="6823593">got</span><span class="op" id="6823596">,</span>&nbsp;<span class="ident" id="6823598">ca</span><span class="op" id="6823600">.</span><span class="ident" id="6823601">want</span><span class="op" id="6823605">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823617">}</span><br>
<span class="lineno"></span><span class="op" id="6823619">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
