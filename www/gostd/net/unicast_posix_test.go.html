<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6736599">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6736655">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6736709">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6736760">//&nbsp;+build&nbsp;!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6736778">package</span>&nbsp;<span class="ident" id="6736786">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6736791">import</span>&nbsp;<span class="op" id="6736798">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6736801">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6736812">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6736823">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6736833">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6736836">var</span>&nbsp;<span class="ident" id="6736840">listenerTests</span>&nbsp;<span class="op" id="6736854">=</span>&nbsp;<span class="op" id="6736856">[</span><span class="op" id="6736857">]</span><span class="keyword" id="6736858">struct</span>&nbsp;<span class="op" id="6736865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736868">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6736877">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736885">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6736894">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736902">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6736911">bool</span>&nbsp;<span class="comment" id="6736916">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736957">wildcard</span>&nbsp;<span class="builtintype" id="6736966">bool</span>&nbsp;<span class="comment" id="6736971">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">20</span><span class="op" id="6737001">}</span><span class="op" id="6737002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737005">{</span><span class="ident" id="6737006">net</span><span class="op" id="6737009">:</span>&nbsp;<span class="string" id="6737011">&#34;tcp&#34;</span><span class="op" id="6737016">,</span>&nbsp;<span class="ident" id="6737018">laddr</span><span class="op" id="6737023">:</span>&nbsp;<span class="string" id="6737025">&#34;&#34;</span><span class="op" id="6737027">,</span>&nbsp;<span class="ident" id="6737029">wildcard</span><span class="op" id="6737037">:</span>&nbsp;<span class="builtintype" id="6737039">true</span><span class="op" id="6737043">}</span><span class="op" id="6737044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737047">{</span><span class="ident" id="6737048">net</span><span class="op" id="6737051">:</span>&nbsp;<span class="string" id="6737053">&#34;tcp&#34;</span><span class="op" id="6737058">,</span>&nbsp;<span class="ident" id="6737060">laddr</span><span class="op" id="6737065">:</span>&nbsp;<span class="string" id="6737067">&#34;0.0.0.0&#34;</span><span class="op" id="6737076">,</span>&nbsp;<span class="ident" id="6737078">wildcard</span><span class="op" id="6737086">:</span>&nbsp;<span class="builtintype" id="6737088">true</span><span class="op" id="6737092">}</span><span class="op" id="6737093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737096">{</span><span class="ident" id="6737097">net</span><span class="op" id="6737100">:</span>&nbsp;<span class="string" id="6737102">&#34;tcp&#34;</span><span class="op" id="6737107">,</span>&nbsp;<span class="ident" id="6737109">laddr</span><span class="op" id="6737114">:</span>&nbsp;<span class="string" id="6737116">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6737134">,</span>&nbsp;<span class="ident" id="6737136">wildcard</span><span class="op" id="6737144">:</span>&nbsp;<span class="builtintype" id="6737146">true</span><span class="op" id="6737150">}</span><span class="op" id="6737151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737154">{</span><span class="ident" id="6737155">net</span><span class="op" id="6737158">:</span>&nbsp;<span class="string" id="6737160">&#34;tcp&#34;</span><span class="op" id="6737165">,</span>&nbsp;<span class="ident" id="6737167">laddr</span><span class="op" id="6737172">:</span>&nbsp;<span class="string" id="6737174">&#34;[::]&#34;</span><span class="op" id="6737180">,</span>&nbsp;<span class="ident" id="6737182">ipv6</span><span class="op" id="6737186">:</span>&nbsp;<span class="builtintype" id="6737188">true</span><span class="op" id="6737192">,</span>&nbsp;<span class="ident" id="6737194">wildcard</span><span class="op" id="6737202">:</span>&nbsp;<span class="builtintype" id="6737204">true</span><span class="op" id="6737208">}</span><span class="op" id="6737209">,</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737213">{</span><span class="ident" id="6737214">net</span><span class="op" id="6737217">:</span>&nbsp;<span class="string" id="6737219">&#34;tcp&#34;</span><span class="op" id="6737224">,</span>&nbsp;<span class="ident" id="6737226">laddr</span><span class="op" id="6737231">:</span>&nbsp;<span class="string" id="6737233">&#34;127.0.0.1&#34;</span><span class="op" id="6737244">}</span><span class="op" id="6737245">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737248">{</span><span class="ident" id="6737249">net</span><span class="op" id="6737252">:</span>&nbsp;<span class="string" id="6737254">&#34;tcp&#34;</span><span class="op" id="6737259">,</span>&nbsp;<span class="ident" id="6737261">laddr</span><span class="op" id="6737266">:</span>&nbsp;<span class="string" id="6737268">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6737288">}</span><span class="op" id="6737289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737292">{</span><span class="ident" id="6737293">net</span><span class="op" id="6737296">:</span>&nbsp;<span class="string" id="6737298">&#34;tcp&#34;</span><span class="op" id="6737303">,</span>&nbsp;<span class="ident" id="6737305">laddr</span><span class="op" id="6737310">:</span>&nbsp;<span class="string" id="6737312">&#34;[::1]&#34;</span><span class="op" id="6737319">,</span>&nbsp;<span class="ident" id="6737321">ipv6</span><span class="op" id="6737325">:</span>&nbsp;<span class="builtintype" id="6737327">true</span><span class="op" id="6737331">}</span><span class="op" id="6737332">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737336">{</span><span class="ident" id="6737337">net</span><span class="op" id="6737340">:</span>&nbsp;<span class="string" id="6737342">&#34;tcp4&#34;</span><span class="op" id="6737348">,</span>&nbsp;<span class="ident" id="6737350">laddr</span><span class="op" id="6737355">:</span>&nbsp;<span class="string" id="6737357">&#34;&#34;</span><span class="op" id="6737359">,</span>&nbsp;<span class="ident" id="6737361">wildcard</span><span class="op" id="6737369">:</span>&nbsp;<span class="builtintype" id="6737371">true</span><span class="op" id="6737375">}</span><span class="op" id="6737376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737379">{</span><span class="ident" id="6737380">net</span><span class="op" id="6737383">:</span>&nbsp;<span class="string" id="6737385">&#34;tcp4&#34;</span><span class="op" id="6737391">,</span>&nbsp;<span class="ident" id="6737393">laddr</span><span class="op" id="6737398">:</span>&nbsp;<span class="string" id="6737400">&#34;0.0.0.0&#34;</span><span class="op" id="6737409">,</span>&nbsp;<span class="ident" id="6737411">wildcard</span><span class="op" id="6737419">:</span>&nbsp;<span class="builtintype" id="6737421">true</span><span class="op" id="6737425">}</span><span class="op" id="6737426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737429">{</span><span class="ident" id="6737430">net</span><span class="op" id="6737433">:</span>&nbsp;<span class="string" id="6737435">&#34;tcp4&#34;</span><span class="op" id="6737441">,</span>&nbsp;<span class="ident" id="6737443">laddr</span><span class="op" id="6737448">:</span>&nbsp;<span class="string" id="6737450">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6737468">,</span>&nbsp;<span class="ident" id="6737470">wildcard</span><span class="op" id="6737478">:</span>&nbsp;<span class="builtintype" id="6737480">true</span><span class="op" id="6737484">}</span><span class="op" id="6737485">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737489">{</span><span class="ident" id="6737490">net</span><span class="op" id="6737493">:</span>&nbsp;<span class="string" id="6737495">&#34;tcp4&#34;</span><span class="op" id="6737501">,</span>&nbsp;<span class="ident" id="6737503">laddr</span><span class="op" id="6737508">:</span>&nbsp;<span class="string" id="6737510">&#34;127.0.0.1&#34;</span><span class="op" id="6737521">}</span><span class="op" id="6737522">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737525">{</span><span class="ident" id="6737526">net</span><span class="op" id="6737529">:</span>&nbsp;<span class="string" id="6737531">&#34;tcp4&#34;</span><span class="op" id="6737537">,</span>&nbsp;<span class="ident" id="6737539">laddr</span><span class="op" id="6737544">:</span>&nbsp;<span class="string" id="6737546">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6737566">}</span><span class="op" id="6737567">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737571">{</span><span class="ident" id="6737572">net</span><span class="op" id="6737575">:</span>&nbsp;<span class="string" id="6737577">&#34;tcp6&#34;</span><span class="op" id="6737583">,</span>&nbsp;<span class="ident" id="6737585">laddr</span><span class="op" id="6737590">:</span>&nbsp;<span class="string" id="6737592">&#34;&#34;</span><span class="op" id="6737594">,</span>&nbsp;<span class="ident" id="6737596">ipv6</span><span class="op" id="6737600">:</span>&nbsp;<span class="builtintype" id="6737602">true</span><span class="op" id="6737606">,</span>&nbsp;<span class="ident" id="6737608">wildcard</span><span class="op" id="6737616">:</span>&nbsp;<span class="builtintype" id="6737618">true</span><span class="op" id="6737622">}</span><span class="op" id="6737623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737626">{</span><span class="ident" id="6737627">net</span><span class="op" id="6737630">:</span>&nbsp;<span class="string" id="6737632">&#34;tcp6&#34;</span><span class="op" id="6737638">,</span>&nbsp;<span class="ident" id="6737640">laddr</span><span class="op" id="6737645">:</span>&nbsp;<span class="string" id="6737647">&#34;[::]&#34;</span><span class="op" id="6737653">,</span>&nbsp;<span class="ident" id="6737655">ipv6</span><span class="op" id="6737659">:</span>&nbsp;<span class="builtintype" id="6737661">true</span><span class="op" id="6737665">,</span>&nbsp;<span class="ident" id="6737667">wildcard</span><span class="op" id="6737675">:</span>&nbsp;<span class="builtintype" id="6737677">true</span><span class="op" id="6737681">}</span><span class="op" id="6737682">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737686">{</span><span class="ident" id="6737687">net</span><span class="op" id="6737690">:</span>&nbsp;<span class="string" id="6737692">&#34;tcp6&#34;</span><span class="op" id="6737698">,</span>&nbsp;<span class="ident" id="6737700">laddr</span><span class="op" id="6737705">:</span>&nbsp;<span class="string" id="6737707">&#34;[::1]&#34;</span><span class="op" id="6737714">,</span>&nbsp;<span class="ident" id="6737716">ipv6</span><span class="op" id="6737720">:</span>&nbsp;<span class="builtintype" id="6737722">true</span><span class="op" id="6737726">}</span><span class="op" id="6737727">,</span><br>
<span class="lineno"></span><span class="op" id="6737729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6737732">//&nbsp;TestTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="6737797">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno">45</span><span class="comment" id="6737862">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6737876">func</span>&nbsp;<span class="ident" id="6737881">TestTCPListener</span><span class="op" id="6737896">(</span><span class="ident" id="6737897">t</span>&nbsp;<span class="op" id="6737899">*</span><span class="ident" id="6737900">testing</span><span class="op" id="6737907">.</span><span class="ident" id="6737908">T</span><span class="op" id="6737909">)</span>&nbsp;<span class="op" id="6737911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737914">switch</span>&nbsp;<span class="ident" id="6737921">runtime</span><span class="op" id="6737928">.</span><span class="ident" id="6737929">GOOS</span>&nbsp;<span class="op" id="6737934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737937">case</span>&nbsp;<span class="string" id="6737942">&#34;plan9&#34;</span><span class="op" id="6737949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6737953">t</span><span class="op" id="6737954">.</span><span class="ident" id="6737955">Skipf</span><span class="op" id="6737960">(</span><span class="string" id="6737961">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6737982">,</span>&nbsp;<span class="ident" id="6737984">runtime</span><span class="op" id="6737991">.</span><span class="ident" id="6737992">GOOS</span><span class="op" id="6737996">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738003">for</span>&nbsp;<span class="ident" id="6738007">_</span><span class="op" id="6738008">,</span>&nbsp;<span class="ident" id="6738010">tt</span>&nbsp;<span class="op" id="6738013">:=</span>&nbsp;<span class="keyword" id="6738016">range</span>&nbsp;<span class="ident" id="6738022">listenerTests</span>&nbsp;<span class="op" id="6738036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738040">if</span>&nbsp;<span class="ident" id="6738043">tt</span><span class="op" id="6738045">.</span><span class="ident" id="6738046">wildcard</span>&nbsp;<span class="op" id="6738055">&amp;&amp;</span>&nbsp;<span class="op" id="6738058">(</span><span class="ident" id="6738059">testing</span><span class="op" id="6738066">.</span><span class="ident" id="6738067">Short</span><span class="op" id="6738072">(</span><span class="op" id="6738073">)</span>&nbsp;<span class="op" id="6738075">||</span>&nbsp;<span class="op" id="6738078">!</span><span class="op" id="6738079">*</span><span class="ident" id="6738080">testExternal</span><span class="op" id="6738092">)</span>&nbsp;<span class="op" id="6738094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738099">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6738110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738114">if</span>&nbsp;<span class="ident" id="6738117">tt</span><span class="op" id="6738119">.</span><span class="ident" id="6738120">ipv6</span>&nbsp;<span class="op" id="6738125">&amp;&amp;</span>&nbsp;<span class="op" id="6738128">!</span><span class="ident" id="6738129">supportsIPv6</span>&nbsp;<span class="op" id="6738142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738147">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6738158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738162">l1</span><span class="op" id="6738164">,</span>&nbsp;<span class="ident" id="6738166">port</span>&nbsp;<span class="op" id="6738171">:=</span>&nbsp;<span class="ident" id="6738174">usableListenPort</span><span class="op" id="6738190">(</span><span class="ident" id="6738191">t</span><span class="op" id="6738192">,</span>&nbsp;<span class="ident" id="6738194">tt</span><span class="op" id="6738196">.</span><span class="ident" id="6738197">net</span><span class="op" id="6738200">,</span>&nbsp;<span class="ident" id="6738202">tt</span><span class="op" id="6738204">.</span><span class="ident" id="6738205">laddr</span><span class="op" id="6738210">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738214">checkFirstListener</span><span class="op" id="6738232">(</span><span class="ident" id="6738233">t</span><span class="op" id="6738234">,</span>&nbsp;<span class="ident" id="6738236">tt</span><span class="op" id="6738238">.</span><span class="ident" id="6738239">net</span><span class="op" id="6738242">,</span>&nbsp;<span class="ident" id="6738244">tt</span><span class="op" id="6738246">.</span><span class="ident" id="6738247">laddr</span><span class="op" id="6738252">+</span><span class="string" id="6738253">&#34;:&#34;</span><span class="op" id="6738256">+</span><span class="ident" id="6738257">port</span><span class="op" id="6738261">,</span>&nbsp;<span class="ident" id="6738263">l1</span><span class="op" id="6738265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738269">l2</span><span class="op" id="6738271">,</span>&nbsp;<span class="ident" id="6738273">err</span>&nbsp;<span class="op" id="6738277">:=</span>&nbsp;<span class="ident" id="6738280">Listen</span><span class="op" id="6738286">(</span><span class="ident" id="6738287">tt</span><span class="op" id="6738289">.</span><span class="ident" id="6738290">net</span><span class="op" id="6738293">,</span>&nbsp;<span class="ident" id="6738295">tt</span><span class="op" id="6738297">.</span><span class="ident" id="6738298">laddr</span><span class="op" id="6738303">+</span><span class="string" id="6738304">&#34;:&#34;</span><span class="op" id="6738307">+</span><span class="ident" id="6738308">port</span><span class="op" id="6738312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738316">checkSecondListener</span><span class="op" id="6738335">(</span><span class="ident" id="6738336">t</span><span class="op" id="6738337">,</span>&nbsp;<span class="ident" id="6738339">tt</span><span class="op" id="6738341">.</span><span class="ident" id="6738342">net</span><span class="op" id="6738345">,</span>&nbsp;<span class="ident" id="6738347">tt</span><span class="op" id="6738349">.</span><span class="ident" id="6738350">laddr</span><span class="op" id="6738355">+</span><span class="string" id="6738356">&#34;:&#34;</span><span class="op" id="6738359">+</span><span class="ident" id="6738360">port</span><span class="op" id="6738364">,</span>&nbsp;<span class="ident" id="6738366">err</span><span class="op" id="6738369">,</span>&nbsp;<span class="ident" id="6738371">l2</span><span class="op" id="6738373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738377">l1</span><span class="op" id="6738379">.</span><span class="ident" id="6738380">Close</span><span class="op" id="6738385">(</span><span class="op" id="6738386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6738389">}</span><br>
<span class="lineno">65</span><span class="op" id="6738391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6738394">//&nbsp;TestUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="6738459">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6738524">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno">70</span><span class="keyword" id="6738538">func</span>&nbsp;<span class="ident" id="6738543">TestUDPListener</span><span class="op" id="6738558">(</span><span class="ident" id="6738559">t</span>&nbsp;<span class="op" id="6738561">*</span><span class="ident" id="6738562">testing</span><span class="op" id="6738569">.</span><span class="ident" id="6738570">T</span><span class="op" id="6738571">)</span>&nbsp;<span class="op" id="6738573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738576">switch</span>&nbsp;<span class="ident" id="6738583">runtime</span><span class="op" id="6738590">.</span><span class="ident" id="6738591">GOOS</span>&nbsp;<span class="op" id="6738596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738599">case</span>&nbsp;<span class="string" id="6738604">&#34;plan9&#34;</span><span class="op" id="6738611">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738615">t</span><span class="op" id="6738616">.</span><span class="ident" id="6738617">Skipf</span><span class="op" id="6738622">(</span><span class="string" id="6738623">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6738644">,</span>&nbsp;<span class="ident" id="6738646">runtime</span><span class="op" id="6738653">.</span><span class="ident" id="6738654">GOOS</span><span class="op" id="6738658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6738661">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738665">toudpnet</span>&nbsp;<span class="op" id="6738674">:=</span>&nbsp;<span class="keyword" id="6738677">func</span><span class="op" id="6738681">(</span><span class="ident" id="6738682">net</span>&nbsp;<span class="builtintype" id="6738686">string</span><span class="op" id="6738692">)</span>&nbsp;<span class="builtintype" id="6738694">string</span>&nbsp;<span class="op" id="6738701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738705">switch</span>&nbsp;<span class="ident" id="6738712">net</span>&nbsp;<span class="op" id="6738716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738720">case</span>&nbsp;<span class="string" id="6738725">&#34;tcp&#34;</span><span class="op" id="6738730">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738735">return</span>&nbsp;<span class="string" id="6738742">&#34;udp&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738750">case</span>&nbsp;<span class="string" id="6738755">&#34;tcp4&#34;</span><span class="op" id="6738761">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738766">return</span>&nbsp;<span class="string" id="6738773">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738782">case</span>&nbsp;<span class="string" id="6738787">&#34;tcp6&#34;</span><span class="op" id="6738793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738798">return</span>&nbsp;<span class="string" id="6738805">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6738814">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738818">return</span>&nbsp;<span class="string" id="6738825">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6738834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738838">for</span>&nbsp;<span class="ident" id="6738842">_</span><span class="op" id="6738843">,</span>&nbsp;<span class="ident" id="6738845">tt</span>&nbsp;<span class="op" id="6738848">:=</span>&nbsp;<span class="keyword" id="6738851">range</span>&nbsp;<span class="ident" id="6738857">listenerTests</span>&nbsp;<span class="op" id="6738871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738875">if</span>&nbsp;<span class="ident" id="6738878">tt</span><span class="op" id="6738880">.</span><span class="ident" id="6738881">wildcard</span>&nbsp;<span class="op" id="6738890">&amp;&amp;</span>&nbsp;<span class="op" id="6738893">(</span><span class="ident" id="6738894">testing</span><span class="op" id="6738901">.</span><span class="ident" id="6738902">Short</span><span class="op" id="6738907">(</span><span class="op" id="6738908">)</span>&nbsp;<span class="op" id="6738910">||</span>&nbsp;<span class="op" id="6738913">!</span><span class="op" id="6738914">*</span><span class="ident" id="6738915">testExternal</span><span class="op" id="6738927">)</span>&nbsp;<span class="op" id="6738929">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738934">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6738945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738949">if</span>&nbsp;<span class="ident" id="6738952">tt</span><span class="op" id="6738954">.</span><span class="ident" id="6738955">ipv6</span>&nbsp;<span class="op" id="6738960">&amp;&amp;</span>&nbsp;<span class="op" id="6738963">!</span><span class="ident" id="6738964">supportsIPv6</span>&nbsp;<span class="op" id="6738977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738982">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6738993">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738997">tt</span><span class="op" id="6738999">.</span><span class="ident" id="6739000">net</span>&nbsp;<span class="op" id="6739004">=</span>&nbsp;<span class="ident" id="6739006">toudpnet</span><span class="op" id="6739014">(</span><span class="ident" id="6739015">tt</span><span class="op" id="6739017">.</span><span class="ident" id="6739018">net</span><span class="op" id="6739021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739025">l1</span><span class="op" id="6739027">,</span>&nbsp;<span class="ident" id="6739029">port</span>&nbsp;<span class="op" id="6739034">:=</span>&nbsp;<span class="ident" id="6739037">usableListenPacketPort</span><span class="op" id="6739059">(</span><span class="ident" id="6739060">t</span><span class="op" id="6739061">,</span>&nbsp;<span class="ident" id="6739063">tt</span><span class="op" id="6739065">.</span><span class="ident" id="6739066">net</span><span class="op" id="6739069">,</span>&nbsp;<span class="ident" id="6739071">tt</span><span class="op" id="6739073">.</span><span class="ident" id="6739074">laddr</span><span class="op" id="6739079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739083">checkFirstListener</span><span class="op" id="6739101">(</span><span class="ident" id="6739102">t</span><span class="op" id="6739103">,</span>&nbsp;<span class="ident" id="6739105">tt</span><span class="op" id="6739107">.</span><span class="ident" id="6739108">net</span><span class="op" id="6739111">,</span>&nbsp;<span class="ident" id="6739113">tt</span><span class="op" id="6739115">.</span><span class="ident" id="6739116">laddr</span><span class="op" id="6739121">+</span><span class="string" id="6739122">&#34;:&#34;</span><span class="op" id="6739125">+</span><span class="ident" id="6739126">port</span><span class="op" id="6739130">,</span>&nbsp;<span class="ident" id="6739132">l1</span><span class="op" id="6739134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739138">l2</span><span class="op" id="6739140">,</span>&nbsp;<span class="ident" id="6739142">err</span>&nbsp;<span class="op" id="6739146">:=</span>&nbsp;<span class="ident" id="6739149">ListenPacket</span><span class="op" id="6739161">(</span><span class="ident" id="6739162">tt</span><span class="op" id="6739164">.</span><span class="ident" id="6739165">net</span><span class="op" id="6739168">,</span>&nbsp;<span class="ident" id="6739170">tt</span><span class="op" id="6739172">.</span><span class="ident" id="6739173">laddr</span><span class="op" id="6739178">+</span><span class="string" id="6739179">&#34;:&#34;</span><span class="op" id="6739182">+</span><span class="ident" id="6739183">port</span><span class="op" id="6739187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739191">checkSecondListener</span><span class="op" id="6739210">(</span><span class="ident" id="6739211">t</span><span class="op" id="6739212">,</span>&nbsp;<span class="ident" id="6739214">tt</span><span class="op" id="6739216">.</span><span class="ident" id="6739217">net</span><span class="op" id="6739220">,</span>&nbsp;<span class="ident" id="6739222">tt</span><span class="op" id="6739224">.</span><span class="ident" id="6739225">laddr</span><span class="op" id="6739230">+</span><span class="string" id="6739231">&#34;:&#34;</span><span class="op" id="6739234">+</span><span class="ident" id="6739235">port</span><span class="op" id="6739239">,</span>&nbsp;<span class="ident" id="6739241">err</span><span class="op" id="6739244">,</span>&nbsp;<span class="ident" id="6739246">l2</span><span class="op" id="6739248">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739252">l1</span><span class="op" id="6739254">.</span><span class="ident" id="6739255">Close</span><span class="op" id="6739260">(</span><span class="op" id="6739261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6739264">}</span><br>
<span class="lineno"></span><span class="op" id="6739266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6739269">var</span>&nbsp;<span class="ident" id="6739273">dualStackListenerTests</span>&nbsp;<span class="op" id="6739296">=</span>&nbsp;<span class="op" id="6739298">[</span><span class="op" id="6739299">]</span><span class="keyword" id="6739300">struct</span>&nbsp;<span class="op" id="6739307">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739310">net1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6739319">string</span>&nbsp;<span class="comment" id="6739326">//&nbsp;first&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739345">laddr1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6739354">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739362">net2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6739371">string</span>&nbsp;<span class="comment" id="6739378">//&nbsp;second&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739398">laddr2</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6739407">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739415">wildcard</span>&nbsp;<span class="builtintype" id="6739424">bool</span>&nbsp;&nbsp;<span class="comment" id="6739430">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739461">xerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6739470">error</span>&nbsp;<span class="comment" id="6739476">//&nbsp;expected&nbsp;error&nbsp;value,&nbsp;nil&nbsp;or&nbsp;other</span><br>
<span class="lineno"></span><span class="op" id="6739514">}</span><span class="op" id="6739515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6739518">//&nbsp;Test&nbsp;cases&nbsp;and&nbsp;expected&nbsp;results&nbsp;for&nbsp;the&nbsp;attemping&nbsp;2nd&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6739600">//&nbsp;1st&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2nd&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;darwin&nbsp;&nbsp;freebsd&nbsp;&nbsp;linux&nbsp;&nbsp;openbsd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6739689">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6739778">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6739864">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6739950">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740036">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740125">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740212">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740299">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740386">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740473">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740560">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740647">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740736">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740823">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740910">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740997">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741084">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741173">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741260">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741347">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741434">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741521">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741525">//&nbsp;Platform&nbsp;default&nbsp;configurations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741562">//&nbsp;darwin,&nbsp;kernel&nbsp;version&nbsp;11.3.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741596">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741669">//&nbsp;freebsd,&nbsp;kernel&nbsp;version&nbsp;8.2</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741701">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741774">//&nbsp;linux,&nbsp;kernel&nbsp;version&nbsp;3.0.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741806">//&nbsp;&nbsp;&nbsp;&nbspnet.ipv6.bindv6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741878">//&nbsp;openbsd,&nbsp;kernel&nbsp;version&nbsp;5.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741910">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overriding&nbsp;is&nbsp;prohibited)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741965">{</span><span class="ident" id="6741966">net1</span><span class="op" id="6741970">:</span>&nbsp;<span class="string" id="6741972">&#34;tcp&#34;</span><span class="op" id="6741977">,</span>&nbsp;<span class="ident" id="6741979">laddr1</span><span class="op" id="6741985">:</span>&nbsp;<span class="string" id="6741987">&#34;&#34;</span><span class="op" id="6741989">,</span>&nbsp;<span class="ident" id="6741991">net2</span><span class="op" id="6741995">:</span>&nbsp;<span class="string" id="6741997">&#34;tcp&#34;</span><span class="op" id="6742002">,</span>&nbsp;<span class="ident" id="6742004">laddr2</span><span class="op" id="6742010">:</span>&nbsp;<span class="string" id="6742012">&#34;&#34;</span><span class="op" id="6742014">,</span>&nbsp;<span class="ident" id="6742016">wildcard</span><span class="op" id="6742024">:</span>&nbsp;<span class="builtintype" id="6742026">true</span><span class="op" id="6742030">,</span>&nbsp;<span class="ident" id="6742032">xerr</span><span class="op" id="6742036">:</span>&nbsp;<span class="ident" id="6742038">syscall</span><span class="op" id="6742045">.</span><span class="ident" id="6742046">EADDRINUSE</span><span class="op" id="6742056">}</span><span class="op" id="6742057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742060">{</span><span class="ident" id="6742061">net1</span><span class="op" id="6742065">:</span>&nbsp;<span class="string" id="6742067">&#34;tcp&#34;</span><span class="op" id="6742072">,</span>&nbsp;<span class="ident" id="6742074">laddr1</span><span class="op" id="6742080">:</span>&nbsp;<span class="string" id="6742082">&#34;&#34;</span><span class="op" id="6742084">,</span>&nbsp;<span class="ident" id="6742086">net2</span><span class="op" id="6742090">:</span>&nbsp;<span class="string" id="6742092">&#34;tcp&#34;</span><span class="op" id="6742097">,</span>&nbsp;<span class="ident" id="6742099">laddr2</span><span class="op" id="6742105">:</span>&nbsp;<span class="string" id="6742107">&#34;0.0.0.0&#34;</span><span class="op" id="6742116">,</span>&nbsp;<span class="ident" id="6742118">wildcard</span><span class="op" id="6742126">:</span>&nbsp;<span class="builtintype" id="6742128">true</span><span class="op" id="6742132">,</span>&nbsp;<span class="ident" id="6742134">xerr</span><span class="op" id="6742138">:</span>&nbsp;<span class="ident" id="6742140">syscall</span><span class="op" id="6742147">.</span><span class="ident" id="6742148">EADDRINUSE</span><span class="op" id="6742158">}</span><span class="op" id="6742159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742162">{</span><span class="ident" id="6742163">net1</span><span class="op" id="6742167">:</span>&nbsp;<span class="string" id="6742169">&#34;tcp&#34;</span><span class="op" id="6742174">,</span>&nbsp;<span class="ident" id="6742176">laddr1</span><span class="op" id="6742182">:</span>&nbsp;<span class="string" id="6742184">&#34;0.0.0.0&#34;</span><span class="op" id="6742193">,</span>&nbsp;<span class="ident" id="6742195">net2</span><span class="op" id="6742199">:</span>&nbsp;<span class="string" id="6742201">&#34;tcp&#34;</span><span class="op" id="6742206">,</span>&nbsp;<span class="ident" id="6742208">laddr2</span><span class="op" id="6742214">:</span>&nbsp;<span class="string" id="6742216">&#34;&#34;</span><span class="op" id="6742218">,</span>&nbsp;<span class="ident" id="6742220">wildcard</span><span class="op" id="6742228">:</span>&nbsp;<span class="builtintype" id="6742230">true</span><span class="op" id="6742234">,</span>&nbsp;<span class="ident" id="6742236">xerr</span><span class="op" id="6742240">:</span>&nbsp;<span class="ident" id="6742242">syscall</span><span class="op" id="6742249">.</span><span class="ident" id="6742250">EADDRINUSE</span><span class="op" id="6742260">}</span><span class="op" id="6742261">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742265">{</span><span class="ident" id="6742266">net1</span><span class="op" id="6742270">:</span>&nbsp;<span class="string" id="6742272">&#34;tcp&#34;</span><span class="op" id="6742277">,</span>&nbsp;<span class="ident" id="6742279">laddr1</span><span class="op" id="6742285">:</span>&nbsp;<span class="string" id="6742287">&#34;&#34;</span><span class="op" id="6742289">,</span>&nbsp;<span class="ident" id="6742291">net2</span><span class="op" id="6742295">:</span>&nbsp;<span class="string" id="6742297">&#34;tcp&#34;</span><span class="op" id="6742302">,</span>&nbsp;<span class="ident" id="6742304">laddr2</span><span class="op" id="6742310">:</span>&nbsp;<span class="string" id="6742312">&#34;[::]&#34;</span><span class="op" id="6742318">,</span>&nbsp;<span class="ident" id="6742320">wildcard</span><span class="op" id="6742328">:</span>&nbsp;<span class="builtintype" id="6742330">true</span><span class="op" id="6742334">,</span>&nbsp;<span class="ident" id="6742336">xerr</span><span class="op" id="6742340">:</span>&nbsp;<span class="ident" id="6742342">syscall</span><span class="op" id="6742349">.</span><span class="ident" id="6742350">EADDRINUSE</span><span class="op" id="6742360">}</span><span class="op" id="6742361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742364">{</span><span class="ident" id="6742365">net1</span><span class="op" id="6742369">:</span>&nbsp;<span class="string" id="6742371">&#34;tcp&#34;</span><span class="op" id="6742376">,</span>&nbsp;<span class="ident" id="6742378">laddr1</span><span class="op" id="6742384">:</span>&nbsp;<span class="string" id="6742386">&#34;[::]&#34;</span><span class="op" id="6742392">,</span>&nbsp;<span class="ident" id="6742394">net2</span><span class="op" id="6742398">:</span>&nbsp;<span class="string" id="6742400">&#34;tcp&#34;</span><span class="op" id="6742405">,</span>&nbsp;<span class="ident" id="6742407">laddr2</span><span class="op" id="6742413">:</span>&nbsp;<span class="string" id="6742415">&#34;&#34;</span><span class="op" id="6742417">,</span>&nbsp;<span class="ident" id="6742419">wildcard</span><span class="op" id="6742427">:</span>&nbsp;<span class="builtintype" id="6742429">true</span><span class="op" id="6742433">,</span>&nbsp;<span class="ident" id="6742435">xerr</span><span class="op" id="6742439">:</span>&nbsp;<span class="ident" id="6742441">syscall</span><span class="op" id="6742448">.</span><span class="ident" id="6742449">EADDRINUSE</span><span class="op" id="6742459">}</span><span class="op" id="6742460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742463">{</span><span class="ident" id="6742464">net1</span><span class="op" id="6742468">:</span>&nbsp;<span class="string" id="6742470">&#34;tcp&#34;</span><span class="op" id="6742475">,</span>&nbsp;<span class="ident" id="6742477">laddr1</span><span class="op" id="6742483">:</span>&nbsp;<span class="string" id="6742485">&#34;0.0.0.0&#34;</span><span class="op" id="6742494">,</span>&nbsp;<span class="ident" id="6742496">net2</span><span class="op" id="6742500">:</span>&nbsp;<span class="string" id="6742502">&#34;tcp&#34;</span><span class="op" id="6742507">,</span>&nbsp;<span class="ident" id="6742509">laddr2</span><span class="op" id="6742515">:</span>&nbsp;<span class="string" id="6742517">&#34;[::]&#34;</span><span class="op" id="6742523">,</span>&nbsp;<span class="ident" id="6742525">wildcard</span><span class="op" id="6742533">:</span>&nbsp;<span class="builtintype" id="6742535">true</span><span class="op" id="6742539">,</span>&nbsp;<span class="ident" id="6742541">xerr</span><span class="op" id="6742545">:</span>&nbsp;<span class="ident" id="6742547">syscall</span><span class="op" id="6742554">.</span><span class="ident" id="6742555">EADDRINUSE</span><span class="op" id="6742565">}</span><span class="op" id="6742566">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742569">{</span><span class="ident" id="6742570">net1</span><span class="op" id="6742574">:</span>&nbsp;<span class="string" id="6742576">&#34;tcp&#34;</span><span class="op" id="6742581">,</span>&nbsp;<span class="ident" id="6742583">laddr1</span><span class="op" id="6742589">:</span>&nbsp;<span class="string" id="6742591">&#34;[::]&#34;</span><span class="op" id="6742597">,</span>&nbsp;<span class="ident" id="6742599">net2</span><span class="op" id="6742603">:</span>&nbsp;<span class="string" id="6742605">&#34;tcp&#34;</span><span class="op" id="6742610">,</span>&nbsp;<span class="ident" id="6742612">laddr2</span><span class="op" id="6742618">:</span>&nbsp;<span class="string" id="6742620">&#34;0.0.0.0&#34;</span><span class="op" id="6742629">,</span>&nbsp;<span class="ident" id="6742631">wildcard</span><span class="op" id="6742639">:</span>&nbsp;<span class="builtintype" id="6742641">true</span><span class="op" id="6742645">,</span>&nbsp;<span class="ident" id="6742647">xerr</span><span class="op" id="6742651">:</span>&nbsp;<span class="ident" id="6742653">syscall</span><span class="op" id="6742660">.</span><span class="ident" id="6742661">EADDRINUSE</span><span class="op" id="6742671">}</span><span class="op" id="6742672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742675">{</span><span class="ident" id="6742676">net1</span><span class="op" id="6742680">:</span>&nbsp;<span class="string" id="6742682">&#34;tcp&#34;</span><span class="op" id="6742687">,</span>&nbsp;<span class="ident" id="6742689">laddr1</span><span class="op" id="6742695">:</span>&nbsp;<span class="string" id="6742697">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6742715">,</span>&nbsp;<span class="ident" id="6742717">net2</span><span class="op" id="6742721">:</span>&nbsp;<span class="string" id="6742723">&#34;tcp&#34;</span><span class="op" id="6742728">,</span>&nbsp;<span class="ident" id="6742730">laddr2</span><span class="op" id="6742736">:</span>&nbsp;<span class="string" id="6742738">&#34;[::]&#34;</span><span class="op" id="6742744">,</span>&nbsp;<span class="ident" id="6742746">wildcard</span><span class="op" id="6742754">:</span>&nbsp;<span class="builtintype" id="6742756">true</span><span class="op" id="6742760">,</span>&nbsp;<span class="ident" id="6742762">xerr</span><span class="op" id="6742766">:</span>&nbsp;<span class="ident" id="6742768">syscall</span><span class="op" id="6742775">.</span><span class="ident" id="6742776">EADDRINUSE</span><span class="op" id="6742786">}</span><span class="op" id="6742787">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742790">{</span><span class="ident" id="6742791">net1</span><span class="op" id="6742795">:</span>&nbsp;<span class="string" id="6742797">&#34;tcp&#34;</span><span class="op" id="6742802">,</span>&nbsp;<span class="ident" id="6742804">laddr1</span><span class="op" id="6742810">:</span>&nbsp;<span class="string" id="6742812">&#34;[::]&#34;</span><span class="op" id="6742818">,</span>&nbsp;<span class="ident" id="6742820">net2</span><span class="op" id="6742824">:</span>&nbsp;<span class="string" id="6742826">&#34;tcp&#34;</span><span class="op" id="6742831">,</span>&nbsp;<span class="ident" id="6742833">laddr2</span><span class="op" id="6742839">:</span>&nbsp;<span class="string" id="6742841">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6742859">,</span>&nbsp;<span class="ident" id="6742861">wildcard</span><span class="op" id="6742869">:</span>&nbsp;<span class="builtintype" id="6742871">true</span><span class="op" id="6742875">,</span>&nbsp;<span class="ident" id="6742877">xerr</span><span class="op" id="6742881">:</span>&nbsp;<span class="ident" id="6742883">syscall</span><span class="op" id="6742890">.</span><span class="ident" id="6742891">EADDRINUSE</span><span class="op" id="6742901">}</span><span class="op" id="6742902">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742906">{</span><span class="ident" id="6742907">net1</span><span class="op" id="6742911">:</span>&nbsp;<span class="string" id="6742913">&#34;tcp4&#34;</span><span class="op" id="6742919">,</span>&nbsp;<span class="ident" id="6742921">laddr1</span><span class="op" id="6742927">:</span>&nbsp;<span class="string" id="6742929">&#34;&#34;</span><span class="op" id="6742931">,</span>&nbsp;<span class="ident" id="6742933">net2</span><span class="op" id="6742937">:</span>&nbsp;<span class="string" id="6742939">&#34;tcp6&#34;</span><span class="op" id="6742945">,</span>&nbsp;<span class="ident" id="6742947">laddr2</span><span class="op" id="6742953">:</span>&nbsp;<span class="string" id="6742955">&#34;&#34;</span><span class="op" id="6742957">,</span>&nbsp;<span class="ident" id="6742959">wildcard</span><span class="op" id="6742967">:</span>&nbsp;<span class="builtintype" id="6742969">true</span><span class="op" id="6742973">}</span><span class="op" id="6742974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742977">{</span><span class="ident" id="6742978">net1</span><span class="op" id="6742982">:</span>&nbsp;<span class="string" id="6742984">&#34;tcp6&#34;</span><span class="op" id="6742990">,</span>&nbsp;<span class="ident" id="6742992">laddr1</span><span class="op" id="6742998">:</span>&nbsp;<span class="string" id="6743000">&#34;&#34;</span><span class="op" id="6743002">,</span>&nbsp;<span class="ident" id="6743004">net2</span><span class="op" id="6743008">:</span>&nbsp;<span class="string" id="6743010">&#34;tcp4&#34;</span><span class="op" id="6743016">,</span>&nbsp;<span class="ident" id="6743018">laddr2</span><span class="op" id="6743024">:</span>&nbsp;<span class="string" id="6743026">&#34;&#34;</span><span class="op" id="6743028">,</span>&nbsp;<span class="ident" id="6743030">wildcard</span><span class="op" id="6743038">:</span>&nbsp;<span class="builtintype" id="6743040">true</span><span class="op" id="6743044">}</span><span class="op" id="6743045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743048">{</span><span class="ident" id="6743049">net1</span><span class="op" id="6743053">:</span>&nbsp;<span class="string" id="6743055">&#34;tcp4&#34;</span><span class="op" id="6743061">,</span>&nbsp;<span class="ident" id="6743063">laddr1</span><span class="op" id="6743069">:</span>&nbsp;<span class="string" id="6743071">&#34;0.0.0.0&#34;</span><span class="op" id="6743080">,</span>&nbsp;<span class="ident" id="6743082">net2</span><span class="op" id="6743086">:</span>&nbsp;<span class="string" id="6743088">&#34;tcp6&#34;</span><span class="op" id="6743094">,</span>&nbsp;<span class="ident" id="6743096">laddr2</span><span class="op" id="6743102">:</span>&nbsp;<span class="string" id="6743104">&#34;[::]&#34;</span><span class="op" id="6743110">,</span>&nbsp;<span class="ident" id="6743112">wildcard</span><span class="op" id="6743120">:</span>&nbsp;<span class="builtintype" id="6743122">true</span><span class="op" id="6743126">}</span><span class="op" id="6743127">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743130">{</span><span class="ident" id="6743131">net1</span><span class="op" id="6743135">:</span>&nbsp;<span class="string" id="6743137">&#34;tcp6&#34;</span><span class="op" id="6743143">,</span>&nbsp;<span class="ident" id="6743145">laddr1</span><span class="op" id="6743151">:</span>&nbsp;<span class="string" id="6743153">&#34;[::]&#34;</span><span class="op" id="6743159">,</span>&nbsp;<span class="ident" id="6743161">net2</span><span class="op" id="6743165">:</span>&nbsp;<span class="string" id="6743167">&#34;tcp4&#34;</span><span class="op" id="6743173">,</span>&nbsp;<span class="ident" id="6743175">laddr2</span><span class="op" id="6743181">:</span>&nbsp;<span class="string" id="6743183">&#34;0.0.0.0&#34;</span><span class="op" id="6743192">,</span>&nbsp;<span class="ident" id="6743194">wildcard</span><span class="op" id="6743202">:</span>&nbsp;<span class="builtintype" id="6743204">true</span><span class="op" id="6743208">}</span><span class="op" id="6743209">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743213">{</span><span class="ident" id="6743214">net1</span><span class="op" id="6743218">:</span>&nbsp;<span class="string" id="6743220">&#34;tcp&#34;</span><span class="op" id="6743225">,</span>&nbsp;<span class="ident" id="6743227">laddr1</span><span class="op" id="6743233">:</span>&nbsp;<span class="string" id="6743235">&#34;127.0.0.1&#34;</span><span class="op" id="6743246">,</span>&nbsp;<span class="ident" id="6743248">net2</span><span class="op" id="6743252">:</span>&nbsp;<span class="string" id="6743254">&#34;tcp&#34;</span><span class="op" id="6743259">,</span>&nbsp;<span class="ident" id="6743261">laddr2</span><span class="op" id="6743267">:</span>&nbsp;<span class="string" id="6743269">&#34;[::1]&#34;</span><span class="op" id="6743276">}</span><span class="op" id="6743277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743280">{</span><span class="ident" id="6743281">net1</span><span class="op" id="6743285">:</span>&nbsp;<span class="string" id="6743287">&#34;tcp&#34;</span><span class="op" id="6743292">,</span>&nbsp;<span class="ident" id="6743294">laddr1</span><span class="op" id="6743300">:</span>&nbsp;<span class="string" id="6743302">&#34;[::1]&#34;</span><span class="op" id="6743309">,</span>&nbsp;<span class="ident" id="6743311">net2</span><span class="op" id="6743315">:</span>&nbsp;<span class="string" id="6743317">&#34;tcp&#34;</span><span class="op" id="6743322">,</span>&nbsp;<span class="ident" id="6743324">laddr2</span><span class="op" id="6743330">:</span>&nbsp;<span class="string" id="6743332">&#34;127.0.0.1&#34;</span><span class="op" id="6743343">}</span><span class="op" id="6743344">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743347">{</span><span class="ident" id="6743348">net1</span><span class="op" id="6743352">:</span>&nbsp;<span class="string" id="6743354">&#34;tcp4&#34;</span><span class="op" id="6743360">,</span>&nbsp;<span class="ident" id="6743362">laddr1</span><span class="op" id="6743368">:</span>&nbsp;<span class="string" id="6743370">&#34;127.0.0.1&#34;</span><span class="op" id="6743381">,</span>&nbsp;<span class="ident" id="6743383">net2</span><span class="op" id="6743387">:</span>&nbsp;<span class="string" id="6743389">&#34;tcp6&#34;</span><span class="op" id="6743395">,</span>&nbsp;<span class="ident" id="6743397">laddr2</span><span class="op" id="6743403">:</span>&nbsp;<span class="string" id="6743405">&#34;[::1]&#34;</span><span class="op" id="6743412">}</span><span class="op" id="6743413">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743416">{</span><span class="ident" id="6743417">net1</span><span class="op" id="6743421">:</span>&nbsp;<span class="string" id="6743423">&#34;tcp6&#34;</span><span class="op" id="6743429">,</span>&nbsp;<span class="ident" id="6743431">laddr1</span><span class="op" id="6743437">:</span>&nbsp;<span class="string" id="6743439">&#34;[::1]&#34;</span><span class="op" id="6743446">,</span>&nbsp;<span class="ident" id="6743448">net2</span><span class="op" id="6743452">:</span>&nbsp;<span class="string" id="6743454">&#34;tcp4&#34;</span><span class="op" id="6743460">,</span>&nbsp;<span class="ident" id="6743462">laddr2</span><span class="op" id="6743468">:</span>&nbsp;<span class="string" id="6743470">&#34;127.0.0.1&#34;</span><span class="op" id="6743481">}</span><span class="op" id="6743482">,</span><br>
<span class="lineno"></span><span class="op" id="6743484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6743487">//&nbsp;TestDualStackTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="6743551">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;different</span><br>
<span class="lineno">170</span><span class="comment" id="6743614">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6743650">func</span>&nbsp;<span class="ident" id="6743655">TestDualStackTCPListener</span><span class="op" id="6743679">(</span><span class="ident" id="6743680">t</span>&nbsp;<span class="op" id="6743682">*</span><span class="ident" id="6743683">testing</span><span class="op" id="6743690">.</span><span class="ident" id="6743691">T</span><span class="op" id="6743692">)</span>&nbsp;<span class="op" id="6743694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743697">if</span>&nbsp;<span class="ident" id="6743700">testing</span><span class="op" id="6743707">.</span><span class="ident" id="6743708">Short</span><span class="op" id="6743713">(</span><span class="op" id="6743714">)</span>&nbsp;<span class="op" id="6743716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743720">t</span><span class="op" id="6743721">.</span><span class="ident" id="6743722">Skip</span><span class="op" id="6743726">(</span><span class="string" id="6743727">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="6743768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743771">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743774">switch</span>&nbsp;<span class="ident" id="6743781">runtime</span><span class="op" id="6743788">.</span><span class="ident" id="6743789">GOOS</span>&nbsp;<span class="op" id="6743794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743797">case</span>&nbsp;<span class="string" id="6743802">&#34;plan9&#34;</span><span class="op" id="6743809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743813">t</span><span class="op" id="6743814">.</span><span class="ident" id="6743815">Skipf</span><span class="op" id="6743820">(</span><span class="string" id="6743821">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6743842">,</span>&nbsp;<span class="ident" id="6743844">runtime</span><span class="op" id="6743851">.</span><span class="ident" id="6743852">GOOS</span><span class="op" id="6743856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743862">if</span>&nbsp;<span class="op" id="6743865">!</span><span class="ident" id="6743866">supportsIPv6</span>&nbsp;<span class="op" id="6743879">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743883">t</span><span class="op" id="6743884">.</span><span class="ident" id="6743885">Skip</span><span class="op" id="6743889">(</span><span class="string" id="6743890">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6743913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743920">for</span>&nbsp;<span class="ident" id="6743924">_</span><span class="op" id="6743925">,</span>&nbsp;<span class="ident" id="6743927">tt</span>&nbsp;<span class="op" id="6743930">:=</span>&nbsp;<span class="keyword" id="6743933">range</span>&nbsp;<span class="ident" id="6743939">dualStackListenerTests</span>&nbsp;<span class="op" id="6743962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743966">if</span>&nbsp;<span class="ident" id="6743969">tt</span><span class="op" id="6743971">.</span><span class="ident" id="6743972">wildcard</span>&nbsp;<span class="op" id="6743981">&amp;&amp;</span>&nbsp;<span class="op" id="6743984">!</span><span class="op" id="6743985">*</span><span class="ident" id="6743986">testExternal</span>&nbsp;<span class="op" id="6743999">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744004">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744019">switch</span>&nbsp;<span class="ident" id="6744026">runtime</span><span class="op" id="6744033">.</span><span class="ident" id="6744034">GOOS</span>&nbsp;<span class="op" id="6744039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744043">case</span>&nbsp;<span class="string" id="6744048">&#34;openbsd&#34;</span><span class="op" id="6744057">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744062">if</span>&nbsp;<span class="ident" id="6744065">tt</span><span class="op" id="6744067">.</span><span class="ident" id="6744068">wildcard</span>&nbsp;<span class="op" id="6744077">&amp;&amp;</span>&nbsp;<span class="ident" id="6744080">differentWildcardAddr</span><span class="op" id="6744101">(</span><span class="ident" id="6744102">tt</span><span class="op" id="6744104">.</span><span class="ident" id="6744105">laddr1</span><span class="op" id="6744111">,</span>&nbsp;<span class="ident" id="6744113">tt</span><span class="op" id="6744115">.</span><span class="ident" id="6744116">laddr2</span><span class="op" id="6744122">)</span>&nbsp;<span class="op" id="6744124">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744130">tt</span><span class="op" id="6744132">.</span><span class="ident" id="6744133">xerr</span>&nbsp;<span class="op" id="6744138">=</span>&nbsp;<span class="ident" id="6744140">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744155">l1</span><span class="op" id="6744157">,</span>&nbsp;<span class="ident" id="6744159">port</span>&nbsp;<span class="op" id="6744164">:=</span>&nbsp;<span class="ident" id="6744167">usableListenPort</span><span class="op" id="6744183">(</span><span class="ident" id="6744184">t</span><span class="op" id="6744185">,</span>&nbsp;<span class="ident" id="6744187">tt</span><span class="op" id="6744189">.</span><span class="ident" id="6744190">net1</span><span class="op" id="6744194">,</span>&nbsp;<span class="ident" id="6744196">tt</span><span class="op" id="6744198">.</span><span class="ident" id="6744199">laddr1</span><span class="op" id="6744205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744209">laddr</span>&nbsp;<span class="op" id="6744215">:=</span>&nbsp;<span class="ident" id="6744218">tt</span><span class="op" id="6744220">.</span><span class="ident" id="6744221">laddr1</span>&nbsp;<span class="op" id="6744228">+</span>&nbsp;<span class="string" id="6744230">&#34;:&#34;</span>&nbsp;<span class="op" id="6744234">+</span>&nbsp;<span class="ident" id="6744236">port</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744243">checkFirstListener</span><span class="op" id="6744261">(</span><span class="ident" id="6744262">t</span><span class="op" id="6744263">,</span>&nbsp;<span class="ident" id="6744265">tt</span><span class="op" id="6744267">.</span><span class="ident" id="6744268">net1</span><span class="op" id="6744272">,</span>&nbsp;<span class="ident" id="6744274">laddr</span><span class="op" id="6744279">,</span>&nbsp;<span class="ident" id="6744281">l1</span><span class="op" id="6744283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744287">laddr</span>&nbsp;<span class="op" id="6744293">=</span>&nbsp;<span class="ident" id="6744295">tt</span><span class="op" id="6744297">.</span><span class="ident" id="6744298">laddr2</span>&nbsp;<span class="op" id="6744305">+</span>&nbsp;<span class="string" id="6744307">&#34;:&#34;</span>&nbsp;<span class="op" id="6744311">+</span>&nbsp;<span class="ident" id="6744313">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744320">l2</span><span class="op" id="6744322">,</span>&nbsp;<span class="ident" id="6744324">err</span>&nbsp;<span class="op" id="6744328">:=</span>&nbsp;<span class="ident" id="6744331">Listen</span><span class="op" id="6744337">(</span><span class="ident" id="6744338">tt</span><span class="op" id="6744340">.</span><span class="ident" id="6744341">net2</span><span class="op" id="6744345">,</span>&nbsp;<span class="ident" id="6744347">laddr</span><span class="op" id="6744352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744356">checkDualStackSecondListener</span><span class="op" id="6744384">(</span><span class="ident" id="6744385">t</span><span class="op" id="6744386">,</span>&nbsp;<span class="ident" id="6744388">tt</span><span class="op" id="6744390">.</span><span class="ident" id="6744391">net2</span><span class="op" id="6744395">,</span>&nbsp;<span class="ident" id="6744397">laddr</span><span class="op" id="6744402">,</span>&nbsp;<span class="ident" id="6744404">tt</span><span class="op" id="6744406">.</span><span class="ident" id="6744407">xerr</span><span class="op" id="6744411">,</span>&nbsp;<span class="ident" id="6744413">err</span><span class="op" id="6744416">,</span>&nbsp;<span class="ident" id="6744418">l2</span><span class="op" id="6744420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744424">l1</span><span class="op" id="6744426">.</span><span class="ident" id="6744427">Close</span><span class="op" id="6744432">(</span><span class="op" id="6744433">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744436">}</span><br>
<span class="lineno"></span><span class="op" id="6744438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6744441">//&nbsp;TestDualStackUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="6744505">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;differnet</span><br>
<span class="lineno">205</span><span class="comment" id="6744568">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6744604">func</span>&nbsp;<span class="ident" id="6744609">TestDualStackUDPListener</span><span class="op" id="6744633">(</span><span class="ident" id="6744634">t</span>&nbsp;<span class="op" id="6744636">*</span><span class="ident" id="6744637">testing</span><span class="op" id="6744644">.</span><span class="ident" id="6744645">T</span><span class="op" id="6744646">)</span>&nbsp;<span class="op" id="6744648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744651">if</span>&nbsp;<span class="ident" id="6744654">testing</span><span class="op" id="6744661">.</span><span class="ident" id="6744662">Short</span><span class="op" id="6744667">(</span><span class="op" id="6744668">)</span>&nbsp;<span class="op" id="6744670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744674">t</span><span class="op" id="6744675">.</span><span class="ident" id="6744676">Skip</span><span class="op" id="6744680">(</span><span class="string" id="6744681">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="6744722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744725">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744728">switch</span>&nbsp;<span class="ident" id="6744735">runtime</span><span class="op" id="6744742">.</span><span class="ident" id="6744743">GOOS</span>&nbsp;<span class="op" id="6744748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744751">case</span>&nbsp;<span class="string" id="6744756">&#34;plan9&#34;</span><span class="op" id="6744763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744767">t</span><span class="op" id="6744768">.</span><span class="ident" id="6744769">Skipf</span><span class="op" id="6744774">(</span><span class="string" id="6744775">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6744796">,</span>&nbsp;<span class="ident" id="6744798">runtime</span><span class="op" id="6744805">.</span><span class="ident" id="6744806">GOOS</span><span class="op" id="6744810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744816">if</span>&nbsp;<span class="op" id="6744819">!</span><span class="ident" id="6744820">supportsIPv6</span>&nbsp;<span class="op" id="6744833">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744837">t</span><span class="op" id="6744838">.</span><span class="ident" id="6744839">Skip</span><span class="op" id="6744843">(</span><span class="string" id="6744844">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6744867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744874">toudpnet</span>&nbsp;<span class="op" id="6744883">:=</span>&nbsp;<span class="keyword" id="6744886">func</span><span class="op" id="6744890">(</span><span class="ident" id="6744891">net</span>&nbsp;<span class="builtintype" id="6744895">string</span><span class="op" id="6744901">)</span>&nbsp;<span class="builtintype" id="6744903">string</span>&nbsp;<span class="op" id="6744910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744914">switch</span>&nbsp;<span class="ident" id="6744921">net</span>&nbsp;<span class="op" id="6744925">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744929">case</span>&nbsp;<span class="string" id="6744934">&#34;tcp&#34;</span><span class="op" id="6744939">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744944">return</span>&nbsp;<span class="string" id="6744951">&#34;udp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744959">case</span>&nbsp;<span class="string" id="6744964">&#34;tcp4&#34;</span><span class="op" id="6744970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744975">return</span>&nbsp;<span class="string" id="6744982">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744991">case</span>&nbsp;<span class="string" id="6744996">&#34;tcp6&#34;</span><span class="op" id="6745002">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745007">return</span>&nbsp;<span class="string" id="6745014">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745027">return</span>&nbsp;<span class="string" id="6745034">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745047">for</span>&nbsp;<span class="ident" id="6745051">_</span><span class="op" id="6745052">,</span>&nbsp;<span class="ident" id="6745054">tt</span>&nbsp;<span class="op" id="6745057">:=</span>&nbsp;<span class="keyword" id="6745060">range</span>&nbsp;<span class="ident" id="6745066">dualStackListenerTests</span>&nbsp;<span class="op" id="6745089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745093">if</span>&nbsp;<span class="ident" id="6745096">tt</span><span class="op" id="6745098">.</span><span class="ident" id="6745099">wildcard</span>&nbsp;<span class="op" id="6745108">&amp;&amp;</span>&nbsp;<span class="op" id="6745111">(</span><span class="ident" id="6745112">testing</span><span class="op" id="6745119">.</span><span class="ident" id="6745120">Short</span><span class="op" id="6745125">(</span><span class="op" id="6745126">)</span>&nbsp;<span class="op" id="6745128">||</span>&nbsp;<span class="op" id="6745131">!</span><span class="op" id="6745132">*</span><span class="ident" id="6745133">testExternal</span><span class="op" id="6745145">)</span>&nbsp;<span class="op" id="6745147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745152">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745167">tt</span><span class="op" id="6745169">.</span><span class="ident" id="6745170">net1</span>&nbsp;<span class="op" id="6745175">=</span>&nbsp;<span class="ident" id="6745177">toudpnet</span><span class="op" id="6745185">(</span><span class="ident" id="6745186">tt</span><span class="op" id="6745188">.</span><span class="ident" id="6745189">net1</span><span class="op" id="6745193">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745197">tt</span><span class="op" id="6745199">.</span><span class="ident" id="6745200">net2</span>&nbsp;<span class="op" id="6745205">=</span>&nbsp;<span class="ident" id="6745207">toudpnet</span><span class="op" id="6745215">(</span><span class="ident" id="6745216">tt</span><span class="op" id="6745218">.</span><span class="ident" id="6745219">net2</span><span class="op" id="6745223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745227">switch</span>&nbsp;<span class="ident" id="6745234">runtime</span><span class="op" id="6745241">.</span><span class="ident" id="6745242">GOOS</span>&nbsp;<span class="op" id="6745247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745251">case</span>&nbsp;<span class="string" id="6745256">&#34;openbsd&#34;</span><span class="op" id="6745265">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745270">if</span>&nbsp;<span class="ident" id="6745273">tt</span><span class="op" id="6745275">.</span><span class="ident" id="6745276">wildcard</span>&nbsp;<span class="op" id="6745285">&amp;&amp;</span>&nbsp;<span class="ident" id="6745288">differentWildcardAddr</span><span class="op" id="6745309">(</span><span class="ident" id="6745310">tt</span><span class="op" id="6745312">.</span><span class="ident" id="6745313">laddr1</span><span class="op" id="6745319">,</span>&nbsp;<span class="ident" id="6745321">tt</span><span class="op" id="6745323">.</span><span class="ident" id="6745324">laddr2</span><span class="op" id="6745330">)</span>&nbsp;<span class="op" id="6745332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745338">tt</span><span class="op" id="6745340">.</span><span class="ident" id="6745341">xerr</span>&nbsp;<span class="op" id="6745346">=</span>&nbsp;<span class="ident" id="6745348">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745363">l1</span><span class="op" id="6745365">,</span>&nbsp;<span class="ident" id="6745367">port</span>&nbsp;<span class="op" id="6745372">:=</span>&nbsp;<span class="ident" id="6745375">usableListenPacketPort</span><span class="op" id="6745397">(</span><span class="ident" id="6745398">t</span><span class="op" id="6745399">,</span>&nbsp;<span class="ident" id="6745401">tt</span><span class="op" id="6745403">.</span><span class="ident" id="6745404">net1</span><span class="op" id="6745408">,</span>&nbsp;<span class="ident" id="6745410">tt</span><span class="op" id="6745412">.</span><span class="ident" id="6745413">laddr1</span><span class="op" id="6745419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745423">laddr</span>&nbsp;<span class="op" id="6745429">:=</span>&nbsp;<span class="ident" id="6745432">tt</span><span class="op" id="6745434">.</span><span class="ident" id="6745435">laddr1</span>&nbsp;<span class="op" id="6745442">+</span>&nbsp;<span class="string" id="6745444">&#34;:&#34;</span>&nbsp;<span class="op" id="6745448">+</span>&nbsp;<span class="ident" id="6745450">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745457">checkFirstListener</span><span class="op" id="6745475">(</span><span class="ident" id="6745476">t</span><span class="op" id="6745477">,</span>&nbsp;<span class="ident" id="6745479">tt</span><span class="op" id="6745481">.</span><span class="ident" id="6745482">net1</span><span class="op" id="6745486">,</span>&nbsp;<span class="ident" id="6745488">laddr</span><span class="op" id="6745493">,</span>&nbsp;<span class="ident" id="6745495">l1</span><span class="op" id="6745497">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745501">laddr</span>&nbsp;<span class="op" id="6745507">=</span>&nbsp;<span class="ident" id="6745509">tt</span><span class="op" id="6745511">.</span><span class="ident" id="6745512">laddr2</span>&nbsp;<span class="op" id="6745519">+</span>&nbsp;<span class="string" id="6745521">&#34;:&#34;</span>&nbsp;<span class="op" id="6745525">+</span>&nbsp;<span class="ident" id="6745527">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745534">l2</span><span class="op" id="6745536">,</span>&nbsp;<span class="ident" id="6745538">err</span>&nbsp;<span class="op" id="6745542">:=</span>&nbsp;<span class="ident" id="6745545">ListenPacket</span><span class="op" id="6745557">(</span><span class="ident" id="6745558">tt</span><span class="op" id="6745560">.</span><span class="ident" id="6745561">net2</span><span class="op" id="6745565">,</span>&nbsp;<span class="ident" id="6745567">laddr</span><span class="op" id="6745572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745576">checkDualStackSecondListener</span><span class="op" id="6745604">(</span><span class="ident" id="6745605">t</span><span class="op" id="6745606">,</span>&nbsp;<span class="ident" id="6745608">tt</span><span class="op" id="6745610">.</span><span class="ident" id="6745611">net2</span><span class="op" id="6745615">,</span>&nbsp;<span class="ident" id="6745617">laddr</span><span class="op" id="6745622">,</span>&nbsp;<span class="ident" id="6745624">tt</span><span class="op" id="6745626">.</span><span class="ident" id="6745627">xerr</span><span class="op" id="6745631">,</span>&nbsp;<span class="ident" id="6745633">err</span><span class="op" id="6745636">,</span>&nbsp;<span class="ident" id="6745638">l2</span><span class="op" id="6745640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745644">l1</span><span class="op" id="6745646">.</span><span class="ident" id="6745647">Close</span><span class="op" id="6745652">(</span><span class="op" id="6745653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745656">}</span><br>
<span class="lineno">250</span><span class="op" id="6745658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6745661">func</span>&nbsp;<span class="ident" id="6745666">usableListenPort</span><span class="op" id="6745682">(</span><span class="ident" id="6745683">t</span>&nbsp;<span class="op" id="6745685">*</span><span class="ident" id="6745686">testing</span><span class="op" id="6745693">.</span><span class="ident" id="6745694">T</span><span class="op" id="6745695">,</span>&nbsp;<span class="ident" id="6745697">net</span><span class="op" id="6745700">,</span>&nbsp;<span class="ident" id="6745702">laddr</span>&nbsp;<span class="builtintype" id="6745708">string</span><span class="op" id="6745714">)</span>&nbsp;<span class="op" id="6745716">(</span><span class="ident" id="6745717">l</span>&nbsp;<span class="ident" id="6745719">Listener</span><span class="op" id="6745727">,</span>&nbsp;<span class="ident" id="6745729">port</span>&nbsp;<span class="builtintype" id="6745734">string</span><span class="op" id="6745740">)</span>&nbsp;<span class="op" id="6745742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745745">var</span>&nbsp;<span class="ident" id="6745749">nladdr</span>&nbsp;<span class="builtintype" id="6745756">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745764">var</span>&nbsp;<span class="ident" id="6745768">err</span>&nbsp;<span class="builtintype" id="6745772">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745779">switch</span>&nbsp;<span class="ident" id="6745786">net</span>&nbsp;<span class="op" id="6745790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745793">default</span><span class="op" id="6745800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6745804">panic</span><span class="op" id="6745809">(</span><span class="string" id="6745810">&#34;usableListenPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="6745834">+</span>&nbsp;<span class="ident" id="6745836">net</span><span class="op" id="6745839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745842">case</span>&nbsp;<span class="string" id="6745847">&#34;tcp&#34;</span><span class="op" id="6745852">,</span>&nbsp;<span class="string" id="6745854">&#34;tcp4&#34;</span><span class="op" id="6745860">,</span>&nbsp;<span class="string" id="6745862">&#34;tcp6&#34;</span><span class="op" id="6745868">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745872">l</span><span class="op" id="6745873">,</span>&nbsp;<span class="ident" id="6745875">err</span>&nbsp;<span class="op" id="6745879">=</span>&nbsp;<span class="ident" id="6745881">Listen</span><span class="op" id="6745887">(</span><span class="ident" id="6745888">net</span><span class="op" id="6745891">,</span>&nbsp;<span class="ident" id="6745893">laddr</span><span class="op" id="6745898">+</span><span class="string" id="6745899">&#34;:0&#34;</span><span class="op" id="6745903">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745907">if</span>&nbsp;<span class="ident" id="6745910">err</span>&nbsp;<span class="op" id="6745914">!=</span>&nbsp;<span class="ident" id="6745917">nil</span>&nbsp;<span class="op" id="6745921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745926">t</span><span class="op" id="6745927">.</span><span class="ident" id="6745928">Fatalf</span><span class="op" id="6745934">(</span><span class="string" id="6745935">&#34;Probe&nbsp;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6745968">,</span>&nbsp;<span class="ident" id="6745970">net</span><span class="op" id="6745973">,</span>&nbsp;<span class="ident" id="6745975">laddr</span><span class="op" id="6745980">,</span>&nbsp;<span class="ident" id="6745982">err</span><span class="op" id="6745985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745993">nladdr</span>&nbsp;<span class="op" id="6746000">=</span>&nbsp;<span class="ident" id="6746002">l</span><span class="op" id="6746003">.</span><span class="op" id="6746004">(</span><span class="op" id="6746005">*</span><span class="ident" id="6746006">TCPListener</span><span class="op" id="6746017">)</span><span class="op" id="6746018">.</span><span class="ident" id="6746019">Addr</span><span class="op" id="6746023">(</span><span class="op" id="6746024">)</span><span class="op" id="6746025">.</span><span class="ident" id="6746026">String</span><span class="op" id="6746032">(</span><span class="op" id="6746033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746036">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746039">_</span><span class="op" id="6746040">,</span>&nbsp;<span class="ident" id="6746042">port</span><span class="op" id="6746046">,</span>&nbsp;<span class="ident" id="6746048">err</span>&nbsp;<span class="op" id="6746052">=</span>&nbsp;<span class="ident" id="6746054">SplitHostPort</span><span class="op" id="6746067">(</span><span class="ident" id="6746068">nladdr</span><span class="op" id="6746074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746077">if</span>&nbsp;<span class="ident" id="6746080">err</span>&nbsp;<span class="op" id="6746084">!=</span>&nbsp;<span class="ident" id="6746087">nil</span>&nbsp;<span class="op" id="6746091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746095">t</span><span class="op" id="6746096">.</span><span class="ident" id="6746097">Fatalf</span><span class="op" id="6746103">(</span><span class="string" id="6746104">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6746130">,</span>&nbsp;<span class="ident" id="6746132">err</span><span class="op" id="6746135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746141">return</span>&nbsp;<span class="ident" id="6746148">l</span><span class="op" id="6746149">,</span>&nbsp;<span class="ident" id="6746151">port</span><br>
<span class="lineno">270</span><span class="op" id="6746156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6746159">func</span>&nbsp;<span class="ident" id="6746164">usableListenPacketPort</span><span class="op" id="6746186">(</span><span class="ident" id="6746187">t</span>&nbsp;<span class="op" id="6746189">*</span><span class="ident" id="6746190">testing</span><span class="op" id="6746197">.</span><span class="ident" id="6746198">T</span><span class="op" id="6746199">,</span>&nbsp;<span class="ident" id="6746201">net</span><span class="op" id="6746204">,</span>&nbsp;<span class="ident" id="6746206">laddr</span>&nbsp;<span class="builtintype" id="6746212">string</span><span class="op" id="6746218">)</span>&nbsp;<span class="op" id="6746220">(</span><span class="ident" id="6746221">l</span>&nbsp;<span class="ident" id="6746223">PacketConn</span><span class="op" id="6746233">,</span>&nbsp;<span class="ident" id="6746235">port</span>&nbsp;<span class="builtintype" id="6746240">string</span><span class="op" id="6746246">)</span>&nbsp;<span class="op" id="6746248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746251">var</span>&nbsp;<span class="ident" id="6746255">nladdr</span>&nbsp;<span class="builtintype" id="6746262">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746270">var</span>&nbsp;<span class="ident" id="6746274">err</span>&nbsp;<span class="builtintype" id="6746278">error</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746285">switch</span>&nbsp;<span class="ident" id="6746292">net</span>&nbsp;<span class="op" id="6746296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746299">default</span><span class="op" id="6746306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6746310">panic</span><span class="op" id="6746315">(</span><span class="string" id="6746316">&#34;usableListenPacketPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="6746346">+</span>&nbsp;<span class="ident" id="6746348">net</span><span class="op" id="6746351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746354">case</span>&nbsp;<span class="string" id="6746359">&#34;udp&#34;</span><span class="op" id="6746364">,</span>&nbsp;<span class="string" id="6746366">&#34;udp4&#34;</span><span class="op" id="6746372">,</span>&nbsp;<span class="string" id="6746374">&#34;udp6&#34;</span><span class="op" id="6746380">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746384">l</span><span class="op" id="6746385">,</span>&nbsp;<span class="ident" id="6746387">err</span>&nbsp;<span class="op" id="6746391">=</span>&nbsp;<span class="ident" id="6746393">ListenPacket</span><span class="op" id="6746405">(</span><span class="ident" id="6746406">net</span><span class="op" id="6746409">,</span>&nbsp;<span class="ident" id="6746411">laddr</span><span class="op" id="6746416">+</span><span class="string" id="6746417">&#34;:0&#34;</span><span class="op" id="6746421">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746425">if</span>&nbsp;<span class="ident" id="6746428">err</span>&nbsp;<span class="op" id="6746432">!=</span>&nbsp;<span class="ident" id="6746435">nil</span>&nbsp;<span class="op" id="6746439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746444">t</span><span class="op" id="6746445">.</span><span class="ident" id="6746446">Fatalf</span><span class="op" id="6746452">(</span><span class="string" id="6746453">&#34;Probe&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6746492">,</span>&nbsp;<span class="ident" id="6746494">net</span><span class="op" id="6746497">,</span>&nbsp;<span class="ident" id="6746499">laddr</span><span class="op" id="6746504">,</span>&nbsp;<span class="ident" id="6746506">err</span><span class="op" id="6746509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746517">nladdr</span>&nbsp;<span class="op" id="6746524">=</span>&nbsp;<span class="ident" id="6746526">l</span><span class="op" id="6746527">.</span><span class="op" id="6746528">(</span><span class="op" id="6746529">*</span><span class="ident" id="6746530">UDPConn</span><span class="op" id="6746537">)</span><span class="op" id="6746538">.</span><span class="ident" id="6746539">LocalAddr</span><span class="op" id="6746548">(</span><span class="op" id="6746549">)</span><span class="op" id="6746550">.</span><span class="ident" id="6746551">String</span><span class="op" id="6746557">(</span><span class="op" id="6746558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746561">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746564">_</span><span class="op" id="6746565">,</span>&nbsp;<span class="ident" id="6746567">port</span><span class="op" id="6746571">,</span>&nbsp;<span class="ident" id="6746573">err</span>&nbsp;<span class="op" id="6746577">=</span>&nbsp;<span class="ident" id="6746579">SplitHostPort</span><span class="op" id="6746592">(</span><span class="ident" id="6746593">nladdr</span><span class="op" id="6746599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746602">if</span>&nbsp;<span class="ident" id="6746605">err</span>&nbsp;<span class="op" id="6746609">!=</span>&nbsp;<span class="ident" id="6746612">nil</span>&nbsp;<span class="op" id="6746616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746620">t</span><span class="op" id="6746621">.</span><span class="ident" id="6746622">Fatalf</span><span class="op" id="6746628">(</span><span class="string" id="6746629">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6746655">,</span>&nbsp;<span class="ident" id="6746657">err</span><span class="op" id="6746660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746666">return</span>&nbsp;<span class="ident" id="6746673">l</span><span class="op" id="6746674">,</span>&nbsp;<span class="ident" id="6746676">port</span><br>
<span class="lineno">290</span><span class="op" id="6746681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6746684">func</span>&nbsp;<span class="ident" id="6746689">differentWildcardAddr</span><span class="op" id="6746710">(</span><span class="ident" id="6746711">i</span><span class="op" id="6746712">,</span>&nbsp;<span class="ident" id="6746714">j</span>&nbsp;<span class="builtintype" id="6746716">string</span><span class="op" id="6746722">)</span>&nbsp;<span class="builtintype" id="6746724">bool</span>&nbsp;<span class="op" id="6746729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746732">if</span>&nbsp;<span class="op" id="6746735">(</span><span class="ident" id="6746736">i</span>&nbsp;<span class="op" id="6746738">==</span>&nbsp;<span class="string" id="6746741">&#34;&#34;</span>&nbsp;<span class="op" id="6746744">||</span>&nbsp;<span class="ident" id="6746747">i</span>&nbsp;<span class="op" id="6746749">==</span>&nbsp;<span class="string" id="6746752">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="6746762">||</span>&nbsp;<span class="ident" id="6746765">i</span>&nbsp;<span class="op" id="6746767">==</span>&nbsp;<span class="string" id="6746770">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="6746786">)</span>&nbsp;<span class="op" id="6746788">&amp;&amp;</span>&nbsp;<span class="op" id="6746791">(</span><span class="ident" id="6746792">j</span>&nbsp;<span class="op" id="6746794">==</span>&nbsp;<span class="string" id="6746797">&#34;&#34;</span>&nbsp;<span class="op" id="6746800">||</span>&nbsp;<span class="ident" id="6746803">j</span>&nbsp;<span class="op" id="6746805">==</span>&nbsp;<span class="string" id="6746808">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="6746818">||</span>&nbsp;<span class="ident" id="6746821">j</span>&nbsp;<span class="op" id="6746823">==</span>&nbsp;<span class="string" id="6746826">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="6746842">)</span>&nbsp;<span class="op" id="6746844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746848">return</span>&nbsp;<span class="builtintype" id="6746855">false</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746865">if</span>&nbsp;<span class="ident" id="6746868">i</span>&nbsp;<span class="op" id="6746870">==</span>&nbsp;<span class="string" id="6746873">&#34;[::]&#34;</span>&nbsp;<span class="op" id="6746880">&amp;&amp;</span>&nbsp;<span class="ident" id="6746883">j</span>&nbsp;<span class="op" id="6746885">==</span>&nbsp;<span class="string" id="6746888">&#34;[::]&#34;</span>&nbsp;<span class="op" id="6746895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746899">return</span>&nbsp;<span class="builtintype" id="6746906">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746916">return</span>&nbsp;<span class="builtintype" id="6746923">true</span><br>
<span class="lineno">300</span><span class="op" id="6746928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6746931">func</span>&nbsp;<span class="ident" id="6746936">checkFirstListener</span><span class="op" id="6746954">(</span><span class="ident" id="6746955">t</span>&nbsp;<span class="op" id="6746957">*</span><span class="ident" id="6746958">testing</span><span class="op" id="6746965">.</span><span class="ident" id="6746966">T</span><span class="op" id="6746967">,</span>&nbsp;<span class="ident" id="6746969">net</span><span class="op" id="6746972">,</span>&nbsp;<span class="ident" id="6746974">laddr</span>&nbsp;<span class="builtintype" id="6746980">string</span><span class="op" id="6746986">,</span>&nbsp;<span class="ident" id="6746988">l</span>&nbsp;<span class="keyword" id="6746990">interface</span><span class="op" id="6746999">{</span><span class="op" id="6747000">}</span><span class="op" id="6747001">)</span>&nbsp;<span class="op" id="6747003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747006">switch</span>&nbsp;<span class="ident" id="6747013">net</span>&nbsp;<span class="op" id="6747017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747020">case</span>&nbsp;<span class="string" id="6747025">&#34;tcp&#34;</span><span class="op" id="6747030">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747034">fd</span>&nbsp;<span class="op" id="6747037">:=</span>&nbsp;<span class="ident" id="6747040">l</span><span class="op" id="6747041">.</span><span class="op" id="6747042">(</span><span class="op" id="6747043">*</span><span class="ident" id="6747044">TCPListener</span><span class="op" id="6747055">)</span><span class="op" id="6747056">.</span><span class="ident" id="6747057">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747062">checkDualStackAddrFamily</span><span class="op" id="6747086">(</span><span class="ident" id="6747087">t</span><span class="op" id="6747088">,</span>&nbsp;<span class="ident" id="6747090">net</span><span class="op" id="6747093">,</span>&nbsp;<span class="ident" id="6747095">laddr</span><span class="op" id="6747100">,</span>&nbsp;<span class="ident" id="6747102">fd</span><span class="op" id="6747104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747107">case</span>&nbsp;<span class="string" id="6747112">&#34;tcp4&#34;</span><span class="op" id="6747118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747122">fd</span>&nbsp;<span class="op" id="6747125">:=</span>&nbsp;<span class="ident" id="6747128">l</span><span class="op" id="6747129">.</span><span class="op" id="6747130">(</span><span class="op" id="6747131">*</span><span class="ident" id="6747132">TCPListener</span><span class="op" id="6747143">)</span><span class="op" id="6747144">.</span><span class="ident" id="6747145">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747150">if</span>&nbsp;<span class="ident" id="6747153">fd</span><span class="op" id="6747155">.</span><span class="ident" id="6747156">family</span>&nbsp;<span class="op" id="6747163">!=</span>&nbsp;<span class="ident" id="6747166">syscall</span><span class="op" id="6747173">.</span><span class="ident" id="6747174">AF_INET</span>&nbsp;<span class="op" id="6747182">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747187">t</span><span class="op" id="6747188">.</span><span class="ident" id="6747189">Fatalf</span><span class="op" id="6747195">(</span><span class="string" id="6747196">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6747257">,</span>&nbsp;<span class="ident" id="6747259">net</span><span class="op" id="6747262">,</span>&nbsp;<span class="ident" id="6747264">laddr</span><span class="op" id="6747269">,</span>&nbsp;<span class="ident" id="6747271">fd</span><span class="op" id="6747273">.</span><span class="ident" id="6747274">family</span><span class="op" id="6747280">,</span>&nbsp;<span class="ident" id="6747282">syscall</span><span class="op" id="6747289">.</span><span class="ident" id="6747290">AF_INET</span><span class="op" id="6747297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6747301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747304">case</span>&nbsp;<span class="string" id="6747309">&#34;tcp6&#34;</span><span class="op" id="6747315">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747319">fd</span>&nbsp;<span class="op" id="6747322">:=</span>&nbsp;<span class="ident" id="6747325">l</span><span class="op" id="6747326">.</span><span class="op" id="6747327">(</span><span class="op" id="6747328">*</span><span class="ident" id="6747329">TCPListener</span><span class="op" id="6747340">)</span><span class="op" id="6747341">.</span><span class="ident" id="6747342">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747347">if</span>&nbsp;<span class="ident" id="6747350">fd</span><span class="op" id="6747352">.</span><span class="ident" id="6747353">family</span>&nbsp;<span class="op" id="6747360">!=</span>&nbsp;<span class="ident" id="6747363">syscall</span><span class="op" id="6747370">.</span><span class="ident" id="6747371">AF_INET6</span>&nbsp;<span class="op" id="6747380">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747385">t</span><span class="op" id="6747386">.</span><span class="ident" id="6747387">Fatalf</span><span class="op" id="6747393">(</span><span class="string" id="6747394">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6747455">,</span>&nbsp;<span class="ident" id="6747457">net</span><span class="op" id="6747460">,</span>&nbsp;<span class="ident" id="6747462">laddr</span><span class="op" id="6747467">,</span>&nbsp;<span class="ident" id="6747469">fd</span><span class="op" id="6747471">.</span><span class="ident" id="6747472">family</span><span class="op" id="6747478">,</span>&nbsp;<span class="ident" id="6747480">syscall</span><span class="op" id="6747487">.</span><span class="ident" id="6747488">AF_INET6</span><span class="op" id="6747496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6747500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747503">case</span>&nbsp;<span class="string" id="6747508">&#34;udp&#34;</span><span class="op" id="6747513">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747517">fd</span>&nbsp;<span class="op" id="6747520">:=</span>&nbsp;<span class="ident" id="6747523">l</span><span class="op" id="6747524">.</span><span class="op" id="6747525">(</span><span class="op" id="6747526">*</span><span class="ident" id="6747527">UDPConn</span><span class="op" id="6747534">)</span><span class="op" id="6747535">.</span><span class="ident" id="6747536">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747541">checkDualStackAddrFamily</span><span class="op" id="6747565">(</span><span class="ident" id="6747566">t</span><span class="op" id="6747567">,</span>&nbsp;<span class="ident" id="6747569">net</span><span class="op" id="6747572">,</span>&nbsp;<span class="ident" id="6747574">laddr</span><span class="op" id="6747579">,</span>&nbsp;<span class="ident" id="6747581">fd</span><span class="op" id="6747583">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747586">case</span>&nbsp;<span class="string" id="6747591">&#34;udp4&#34;</span><span class="op" id="6747597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747601">fd</span>&nbsp;<span class="op" id="6747604">:=</span>&nbsp;<span class="ident" id="6747607">l</span><span class="op" id="6747608">.</span><span class="op" id="6747609">(</span><span class="op" id="6747610">*</span><span class="ident" id="6747611">UDPConn</span><span class="op" id="6747618">)</span><span class="op" id="6747619">.</span><span class="ident" id="6747620">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747625">if</span>&nbsp;<span class="ident" id="6747628">fd</span><span class="op" id="6747630">.</span><span class="ident" id="6747631">family</span>&nbsp;<span class="op" id="6747638">!=</span>&nbsp;<span class="ident" id="6747641">syscall</span><span class="op" id="6747648">.</span><span class="ident" id="6747649">AF_INET</span>&nbsp;<span class="op" id="6747657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747662">t</span><span class="op" id="6747663">.</span><span class="ident" id="6747664">Fatalf</span><span class="op" id="6747670">(</span><span class="string" id="6747671">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6747738">,</span>&nbsp;<span class="ident" id="6747740">net</span><span class="op" id="6747743">,</span>&nbsp;<span class="ident" id="6747745">laddr</span><span class="op" id="6747750">,</span>&nbsp;<span class="ident" id="6747752">fd</span><span class="op" id="6747754">.</span><span class="ident" id="6747755">family</span><span class="op" id="6747761">,</span>&nbsp;<span class="ident" id="6747763">syscall</span><span class="op" id="6747770">.</span><span class="ident" id="6747771">AF_INET</span><span class="op" id="6747778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6747782">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747785">case</span>&nbsp;<span class="string" id="6747790">&#34;udp6&#34;</span><span class="op" id="6747796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747800">fd</span>&nbsp;<span class="op" id="6747803">:=</span>&nbsp;<span class="ident" id="6747806">l</span><span class="op" id="6747807">.</span><span class="op" id="6747808">(</span><span class="op" id="6747809">*</span><span class="ident" id="6747810">UDPConn</span><span class="op" id="6747817">)</span><span class="op" id="6747818">.</span><span class="ident" id="6747819">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747824">if</span>&nbsp;<span class="ident" id="6747827">fd</span><span class="op" id="6747829">.</span><span class="ident" id="6747830">family</span>&nbsp;<span class="op" id="6747837">!=</span>&nbsp;<span class="ident" id="6747840">syscall</span><span class="op" id="6747847">.</span><span class="ident" id="6747848">AF_INET6</span>&nbsp;<span class="op" id="6747857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747862">t</span><span class="op" id="6747863">.</span><span class="ident" id="6747864">Fatalf</span><span class="op" id="6747870">(</span><span class="string" id="6747871">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6747938">,</span>&nbsp;<span class="ident" id="6747940">net</span><span class="op" id="6747943">,</span>&nbsp;<span class="ident" id="6747945">laddr</span><span class="op" id="6747950">,</span>&nbsp;<span class="ident" id="6747952">fd</span><span class="op" id="6747954">.</span><span class="ident" id="6747955">family</span><span class="op" id="6747961">,</span>&nbsp;<span class="ident" id="6747963">syscall</span><span class="op" id="6747970">.</span><span class="ident" id="6747971">AF_INET6</span><span class="op" id="6747979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6747983">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747986">default</span><span class="op" id="6747993">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747997">t</span><span class="op" id="6747998">.</span><span class="ident" id="6747999">Fatalf</span><span class="op" id="6748005">(</span><span class="string" id="6748006">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6748030">,</span>&nbsp;<span class="ident" id="6748032">net</span><span class="op" id="6748035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748038">}</span><br>
<span class="lineno"></span><span class="op" id="6748040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="6748043">func</span>&nbsp;<span class="ident" id="6748048">checkSecondListener</span><span class="op" id="6748067">(</span><span class="ident" id="6748068">t</span>&nbsp;<span class="op" id="6748070">*</span><span class="ident" id="6748071">testing</span><span class="op" id="6748078">.</span><span class="ident" id="6748079">T</span><span class="op" id="6748080">,</span>&nbsp;<span class="ident" id="6748082">net</span><span class="op" id="6748085">,</span>&nbsp;<span class="ident" id="6748087">laddr</span>&nbsp;<span class="builtintype" id="6748093">string</span><span class="op" id="6748099">,</span>&nbsp;<span class="ident" id="6748101">err</span>&nbsp;<span class="builtintype" id="6748105">error</span><span class="op" id="6748110">,</span>&nbsp;<span class="ident" id="6748112">l</span>&nbsp;<span class="keyword" id="6748114">interface</span><span class="op" id="6748123">{</span><span class="op" id="6748124">}</span><span class="op" id="6748125">)</span>&nbsp;<span class="op" id="6748127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748130">switch</span>&nbsp;<span class="ident" id="6748137">net</span>&nbsp;<span class="op" id="6748141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748144">case</span>&nbsp;<span class="string" id="6748149">&#34;tcp&#34;</span><span class="op" id="6748154">,</span>&nbsp;<span class="string" id="6748156">&#34;tcp4&#34;</span><span class="op" id="6748162">,</span>&nbsp;<span class="string" id="6748164">&#34;tcp6&#34;</span><span class="op" id="6748170">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748174">if</span>&nbsp;<span class="ident" id="6748177">err</span>&nbsp;<span class="op" id="6748181">==</span>&nbsp;<span class="ident" id="6748184">nil</span>&nbsp;<span class="op" id="6748188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748193">l</span><span class="op" id="6748194">.</span><span class="op" id="6748195">(</span><span class="op" id="6748196">*</span><span class="ident" id="6748197">TCPListener</span><span class="op" id="6748208">)</span><span class="op" id="6748209">.</span><span class="ident" id="6748210">Close</span><span class="op" id="6748215">(</span><span class="op" id="6748216">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748221">t</span><span class="op" id="6748222">.</span><span class="ident" id="6748223">Fatalf</span><span class="op" id="6748229">(</span><span class="string" id="6748230">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6748265">,</span>&nbsp;<span class="ident" id="6748267">net</span><span class="op" id="6748270">,</span>&nbsp;<span class="ident" id="6748272">laddr</span><span class="op" id="6748277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748284">case</span>&nbsp;<span class="string" id="6748289">&#34;udp&#34;</span><span class="op" id="6748294">,</span>&nbsp;<span class="string" id="6748296">&#34;udp4&#34;</span><span class="op" id="6748302">,</span>&nbsp;<span class="string" id="6748304">&#34;udp6&#34;</span><span class="op" id="6748310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748314">if</span>&nbsp;<span class="ident" id="6748317">err</span>&nbsp;<span class="op" id="6748321">==</span>&nbsp;<span class="ident" id="6748324">nil</span>&nbsp;<span class="op" id="6748328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748333">l</span><span class="op" id="6748334">.</span><span class="op" id="6748335">(</span><span class="op" id="6748336">*</span><span class="ident" id="6748337">UDPConn</span><span class="op" id="6748344">)</span><span class="op" id="6748345">.</span><span class="ident" id="6748346">Close</span><span class="op" id="6748351">(</span><span class="op" id="6748352">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748357">t</span><span class="op" id="6748358">.</span><span class="ident" id="6748359">Fatalf</span><span class="op" id="6748365">(</span><span class="string" id="6748366">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6748407">,</span>&nbsp;<span class="ident" id="6748409">net</span><span class="op" id="6748412">,</span>&nbsp;<span class="ident" id="6748414">laddr</span><span class="op" id="6748419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748426">default</span><span class="op" id="6748433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748437">t</span><span class="op" id="6748438">.</span><span class="ident" id="6748439">Fatalf</span><span class="op" id="6748445">(</span><span class="string" id="6748446">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6748470">,</span>&nbsp;<span class="ident" id="6748472">net</span><span class="op" id="6748475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748478">}</span><br>
<span class="lineno">350</span><span class="op" id="6748480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6748483">func</span>&nbsp;<span class="ident" id="6748488">checkDualStackSecondListener</span><span class="op" id="6748516">(</span><span class="ident" id="6748517">t</span>&nbsp;<span class="op" id="6748519">*</span><span class="ident" id="6748520">testing</span><span class="op" id="6748527">.</span><span class="ident" id="6748528">T</span><span class="op" id="6748529">,</span>&nbsp;<span class="ident" id="6748531">net</span><span class="op" id="6748534">,</span>&nbsp;<span class="ident" id="6748536">laddr</span>&nbsp;<span class="builtintype" id="6748542">string</span><span class="op" id="6748548">,</span>&nbsp;<span class="ident" id="6748550">xerr</span><span class="op" id="6748554">,</span>&nbsp;<span class="ident" id="6748556">err</span>&nbsp;<span class="builtintype" id="6748560">error</span><span class="op" id="6748565">,</span>&nbsp;<span class="ident" id="6748567">l</span>&nbsp;<span class="keyword" id="6748569">interface</span><span class="op" id="6748578">{</span><span class="op" id="6748579">}</span><span class="op" id="6748580">)</span>&nbsp;<span class="op" id="6748582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748585">switch</span>&nbsp;<span class="ident" id="6748592">net</span>&nbsp;<span class="op" id="6748596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748599">case</span>&nbsp;<span class="string" id="6748604">&#34;tcp&#34;</span><span class="op" id="6748609">,</span>&nbsp;<span class="string" id="6748611">&#34;tcp4&#34;</span><span class="op" id="6748617">,</span>&nbsp;<span class="string" id="6748619">&#34;tcp6&#34;</span><span class="op" id="6748625">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748629">if</span>&nbsp;<span class="ident" id="6748632">xerr</span>&nbsp;<span class="op" id="6748637">==</span>&nbsp;<span class="ident" id="6748640">nil</span>&nbsp;<span class="op" id="6748644">&amp;&amp;</span>&nbsp;<span class="ident" id="6748647">err</span>&nbsp;<span class="op" id="6748651">!=</span>&nbsp;<span class="ident" id="6748654">nil</span>&nbsp;<span class="op" id="6748658">||</span>&nbsp;<span class="ident" id="6748661">xerr</span>&nbsp;<span class="op" id="6748666">!=</span>&nbsp;<span class="ident" id="6748669">nil</span>&nbsp;<span class="op" id="6748673">&amp;&amp;</span>&nbsp;<span class="ident" id="6748676">err</span>&nbsp;<span class="op" id="6748680">==</span>&nbsp;<span class="ident" id="6748683">nil</span>&nbsp;<span class="op" id="6748687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748692">t</span><span class="op" id="6748693">.</span><span class="ident" id="6748694">Fatalf</span><span class="op" id="6748700">(</span><span class="string" id="6748701">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6748748">,</span>&nbsp;<span class="ident" id="6748750">net</span><span class="op" id="6748753">,</span>&nbsp;<span class="ident" id="6748755">laddr</span><span class="op" id="6748760">,</span>&nbsp;<span class="ident" id="6748762">err</span><span class="op" id="6748765">,</span>&nbsp;<span class="ident" id="6748767">xerr</span><span class="op" id="6748771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748779">if</span>&nbsp;<span class="ident" id="6748782">err</span>&nbsp;<span class="op" id="6748786">==</span>&nbsp;<span class="ident" id="6748789">nil</span>&nbsp;<span class="op" id="6748793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748798">l</span><span class="op" id="6748799">.</span><span class="op" id="6748800">(</span><span class="op" id="6748801">*</span><span class="ident" id="6748802">TCPListener</span><span class="op" id="6748813">)</span><span class="op" id="6748814">.</span><span class="ident" id="6748815">Close</span><span class="op" id="6748820">(</span><span class="op" id="6748821">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748828">case</span>&nbsp;<span class="string" id="6748833">&#34;udp&#34;</span><span class="op" id="6748838">,</span>&nbsp;<span class="string" id="6748840">&#34;udp4&#34;</span><span class="op" id="6748846">,</span>&nbsp;<span class="string" id="6748848">&#34;udp6&#34;</span><span class="op" id="6748854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748858">if</span>&nbsp;<span class="ident" id="6748861">xerr</span>&nbsp;<span class="op" id="6748866">==</span>&nbsp;<span class="ident" id="6748869">nil</span>&nbsp;<span class="op" id="6748873">&amp;&amp;</span>&nbsp;<span class="ident" id="6748876">err</span>&nbsp;<span class="op" id="6748880">!=</span>&nbsp;<span class="ident" id="6748883">nil</span>&nbsp;<span class="op" id="6748887">||</span>&nbsp;<span class="ident" id="6748890">xerr</span>&nbsp;<span class="op" id="6748895">!=</span>&nbsp;<span class="ident" id="6748898">nil</span>&nbsp;<span class="op" id="6748902">&amp;&amp;</span>&nbsp;<span class="ident" id="6748905">err</span>&nbsp;<span class="op" id="6748909">==</span>&nbsp;<span class="ident" id="6748912">nil</span>&nbsp;<span class="op" id="6748916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748921">t</span><span class="op" id="6748922">.</span><span class="ident" id="6748923">Fatalf</span><span class="op" id="6748929">(</span><span class="string" id="6748930">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6748983">,</span>&nbsp;<span class="ident" id="6748985">net</span><span class="op" id="6748988">,</span>&nbsp;<span class="ident" id="6748990">laddr</span><span class="op" id="6748995">,</span>&nbsp;<span class="ident" id="6748997">err</span><span class="op" id="6749000">,</span>&nbsp;<span class="ident" id="6749002">xerr</span><span class="op" id="6749006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6749010">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749014">if</span>&nbsp;<span class="ident" id="6749017">err</span>&nbsp;<span class="op" id="6749021">==</span>&nbsp;<span class="ident" id="6749024">nil</span>&nbsp;<span class="op" id="6749028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749033">l</span><span class="op" id="6749034">.</span><span class="op" id="6749035">(</span><span class="op" id="6749036">*</span><span class="ident" id="6749037">UDPConn</span><span class="op" id="6749044">)</span><span class="op" id="6749045">.</span><span class="ident" id="6749046">Close</span><span class="op" id="6749051">(</span><span class="op" id="6749052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6749056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749059">default</span><span class="op" id="6749066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749070">t</span><span class="op" id="6749071">.</span><span class="ident" id="6749072">Fatalf</span><span class="op" id="6749078">(</span><span class="string" id="6749079">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6749103">,</span>&nbsp;<span class="ident" id="6749105">net</span><span class="op" id="6749108">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6749111">}</span><br>
<span class="lineno"></span><span class="op" id="6749113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6749116">func</span>&nbsp;<span class="ident" id="6749121">checkDualStackAddrFamily</span><span class="op" id="6749145">(</span><span class="ident" id="6749146">t</span>&nbsp;<span class="op" id="6749148">*</span><span class="ident" id="6749149">testing</span><span class="op" id="6749156">.</span><span class="ident" id="6749157">T</span><span class="op" id="6749158">,</span>&nbsp;<span class="ident" id="6749160">net</span><span class="op" id="6749163">,</span>&nbsp;<span class="ident" id="6749165">laddr</span>&nbsp;<span class="builtintype" id="6749171">string</span><span class="op" id="6749177">,</span>&nbsp;<span class="ident" id="6749179">fd</span>&nbsp;<span class="op" id="6749182">*</span><span class="ident" id="6749183">netFD</span><span class="op" id="6749188">)</span>&nbsp;<span class="op" id="6749190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749193">switch</span>&nbsp;<span class="ident" id="6749200">a</span>&nbsp;<span class="op" id="6749202">:=</span>&nbsp;<span class="ident" id="6749205">fd</span><span class="op" id="6749207">.</span><span class="ident" id="6749208">laddr</span><span class="op" id="6749213">.</span><span class="op" id="6749214">(</span><span class="keyword" id="6749215">type</span><span class="op" id="6749219">)</span>&nbsp;<span class="op" id="6749221">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749224">case</span>&nbsp;<span class="op" id="6749229">*</span><span class="ident" id="6749230">TCPAddr</span><span class="op" id="6749237">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6749241">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6749297">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6749350">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6749407">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749429">if</span>&nbsp;<span class="ident" id="6749432">supportsIPv4map</span>&nbsp;<span class="op" id="6749448">&amp;&amp;</span>&nbsp;<span class="ident" id="6749451">fd</span><span class="op" id="6749453">.</span><span class="ident" id="6749454">laddr</span><span class="op" id="6749459">.</span><span class="op" id="6749460">(</span><span class="op" id="6749461">*</span><span class="ident" id="6749462">TCPAddr</span><span class="op" id="6749469">)</span><span class="op" id="6749470">.</span><span class="ident" id="6749471">isWildcard</span><span class="op" id="6749481">(</span><span class="op" id="6749482">)</span>&nbsp;<span class="op" id="6749484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749489">if</span>&nbsp;<span class="ident" id="6749492">fd</span><span class="op" id="6749494">.</span><span class="ident" id="6749495">family</span>&nbsp;<span class="op" id="6749502">!=</span>&nbsp;<span class="ident" id="6749505">syscall</span><span class="op" id="6749512">.</span><span class="ident" id="6749513">AF_INET6</span>&nbsp;<span class="op" id="6749522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749528">t</span><span class="op" id="6749529">.</span><span class="ident" id="6749530">Fatalf</span><span class="op" id="6749536">(</span><span class="string" id="6749537">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6749592">,</span>&nbsp;<span class="ident" id="6749594">net</span><span class="op" id="6749597">,</span>&nbsp;<span class="ident" id="6749599">laddr</span><span class="op" id="6749604">,</span>&nbsp;<span class="ident" id="6749606">fd</span><span class="op" id="6749608">.</span><span class="ident" id="6749609">family</span><span class="op" id="6749615">,</span>&nbsp;<span class="ident" id="6749617">syscall</span><span class="op" id="6749624">.</span><span class="ident" id="6749625">AF_INET6</span><span class="op" id="6749633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6749638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6749642">}</span>&nbsp;<span class="keyword" id="6749644">else</span>&nbsp;<span class="op" id="6749649">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749654">if</span>&nbsp;<span class="ident" id="6749657">fd</span><span class="op" id="6749659">.</span><span class="ident" id="6749660">family</span>&nbsp;<span class="op" id="6749667">!=</span>&nbsp;<span class="ident" id="6749670">a</span><span class="op" id="6749671">.</span><span class="ident" id="6749672">family</span><span class="op" id="6749678">(</span><span class="op" id="6749679">)</span>&nbsp;<span class="op" id="6749681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749687">t</span><span class="op" id="6749688">.</span><span class="ident" id="6749689">Fatalf</span><span class="op" id="6749695">(</span><span class="string" id="6749696">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6749751">,</span>&nbsp;<span class="ident" id="6749753">net</span><span class="op" id="6749756">,</span>&nbsp;<span class="ident" id="6749758">laddr</span><span class="op" id="6749763">,</span>&nbsp;<span class="ident" id="6749765">fd</span><span class="op" id="6749767">.</span><span class="ident" id="6749768">family</span><span class="op" id="6749774">,</span>&nbsp;<span class="ident" id="6749776">a</span><span class="op" id="6749777">.</span><span class="ident" id="6749778">family</span><span class="op" id="6749784">(</span><span class="op" id="6749785">)</span><span class="op" id="6749786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6749791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6749795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749798">case</span>&nbsp;<span class="op" id="6749803">*</span><span class="ident" id="6749804">UDPAddr</span><span class="op" id="6749811">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6749815">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6749871">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6749924">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6749981">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750003">if</span>&nbsp;<span class="ident" id="6750006">supportsIPv4map</span>&nbsp;<span class="op" id="6750022">&amp;&amp;</span>&nbsp;<span class="ident" id="6750025">fd</span><span class="op" id="6750027">.</span><span class="ident" id="6750028">laddr</span><span class="op" id="6750033">.</span><span class="op" id="6750034">(</span><span class="op" id="6750035">*</span><span class="ident" id="6750036">UDPAddr</span><span class="op" id="6750043">)</span><span class="op" id="6750044">.</span><span class="ident" id="6750045">isWildcard</span><span class="op" id="6750055">(</span><span class="op" id="6750056">)</span>&nbsp;<span class="op" id="6750058">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750063">if</span>&nbsp;<span class="ident" id="6750066">fd</span><span class="op" id="6750068">.</span><span class="ident" id="6750069">family</span>&nbsp;<span class="op" id="6750076">!=</span>&nbsp;<span class="ident" id="6750079">syscall</span><span class="op" id="6750086">.</span><span class="ident" id="6750087">AF_INET6</span>&nbsp;<span class="op" id="6750096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750102">t</span><span class="op" id="6750103">.</span><span class="ident" id="6750104">Fatalf</span><span class="op" id="6750110">(</span><span class="string" id="6750111">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6750172">,</span>&nbsp;<span class="ident" id="6750174">net</span><span class="op" id="6750177">,</span>&nbsp;<span class="ident" id="6750179">laddr</span><span class="op" id="6750184">,</span>&nbsp;<span class="ident" id="6750186">fd</span><span class="op" id="6750188">.</span><span class="ident" id="6750189">family</span><span class="op" id="6750195">,</span>&nbsp;<span class="ident" id="6750197">syscall</span><span class="op" id="6750204">.</span><span class="ident" id="6750205">AF_INET6</span><span class="op" id="6750213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750222">}</span>&nbsp;<span class="keyword" id="6750224">else</span>&nbsp;<span class="op" id="6750229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750234">if</span>&nbsp;<span class="ident" id="6750237">fd</span><span class="op" id="6750239">.</span><span class="ident" id="6750240">family</span>&nbsp;<span class="op" id="6750247">!=</span>&nbsp;<span class="ident" id="6750250">a</span><span class="op" id="6750251">.</span><span class="ident" id="6750252">family</span><span class="op" id="6750258">(</span><span class="op" id="6750259">)</span>&nbsp;<span class="op" id="6750261">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750267">t</span><span class="op" id="6750268">.</span><span class="ident" id="6750269">Fatalf</span><span class="op" id="6750275">(</span><span class="string" id="6750276">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6750337">,</span>&nbsp;<span class="ident" id="6750339">net</span><span class="op" id="6750342">,</span>&nbsp;<span class="ident" id="6750344">laddr</span><span class="op" id="6750349">,</span>&nbsp;<span class="ident" id="6750351">fd</span><span class="op" id="6750353">.</span><span class="ident" id="6750354">family</span><span class="op" id="6750360">,</span>&nbsp;<span class="ident" id="6750362">a</span><span class="op" id="6750363">.</span><span class="ident" id="6750364">family</span><span class="op" id="6750370">(</span><span class="op" id="6750371">)</span><span class="op" id="6750372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750384">default</span><span class="op" id="6750391">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750395">t</span><span class="op" id="6750396">.</span><span class="ident" id="6750397">Fatalf</span><span class="op" id="6750403">(</span><span class="string" id="6750404">&#34;Unexpected&nbsp;protocol&nbsp;address&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="6750442">,</span>&nbsp;<span class="ident" id="6750444">a</span><span class="op" id="6750445">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750448">}</span><br>
<span class="lineno"></span><span class="op" id="6750450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6750453">var</span>&nbsp;<span class="ident" id="6750457">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="6750484">=</span>&nbsp;<span class="op" id="6750486">[</span><span class="op" id="6750487">]</span><span class="keyword" id="6750488">struct</span>&nbsp;<span class="op" id="6750495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750498">net</span>&nbsp;&nbsp;<span class="builtintype" id="6750503">string</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750511">addr</span>&nbsp;<span class="builtintype" id="6750516">string</span><br>
<span class="lineno"></span><span class="op" id="6750523">}</span><span class="op" id="6750524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750527">{</span><span class="string" id="6750528">&#34;tcp6&#34;</span><span class="op" id="6750534">,</span>&nbsp;<span class="string" id="6750536">&#34;127.0.0.1&#34;</span><span class="op" id="6750547">}</span><span class="op" id="6750548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750551">{</span><span class="string" id="6750552">&#34;tcp6&#34;</span><span class="op" id="6750558">,</span>&nbsp;<span class="string" id="6750560">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6750580">}</span><span class="op" id="6750581">,</span><br>
<span class="lineno"></span><span class="op" id="6750583">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="6750586">func</span>&nbsp;<span class="ident" id="6750591">TestProhibitionaryDialArgs</span><span class="op" id="6750617">(</span><span class="ident" id="6750618">t</span>&nbsp;<span class="op" id="6750620">*</span><span class="ident" id="6750621">testing</span><span class="op" id="6750628">.</span><span class="ident" id="6750629">T</span><span class="op" id="6750630">)</span>&nbsp;<span class="op" id="6750632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750635">switch</span>&nbsp;<span class="ident" id="6750642">runtime</span><span class="op" id="6750649">.</span><span class="ident" id="6750650">GOOS</span>&nbsp;<span class="op" id="6750655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750658">case</span>&nbsp;<span class="string" id="6750663">&#34;plan9&#34;</span><span class="op" id="6750670">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750674">t</span><span class="op" id="6750675">.</span><span class="ident" id="6750676">Skipf</span><span class="op" id="6750681">(</span><span class="string" id="6750682">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6750703">,</span>&nbsp;<span class="ident" id="6750705">runtime</span><span class="op" id="6750712">.</span><span class="ident" id="6750713">GOOS</span><span class="op" id="6750717">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6750723">//&nbsp;This&nbsp;test&nbsp;requires&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750793">if</span>&nbsp;<span class="op" id="6750796">!</span><span class="ident" id="6750797">supportsIPv4map</span>&nbsp;<span class="op" id="6750813">||</span>&nbsp;<span class="ident" id="6750816">testing</span><span class="op" id="6750823">.</span><span class="ident" id="6750824">Short</span><span class="op" id="6750829">(</span><span class="op" id="6750830">)</span>&nbsp;<span class="op" id="6750832">||</span>&nbsp;<span class="op" id="6750835">!</span><span class="op" id="6750836">*</span><span class="ident" id="6750837">testExternal</span>&nbsp;<span class="op" id="6750850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750854">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750862">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750866">l</span><span class="op" id="6750867">,</span>&nbsp;<span class="ident" id="6750869">port</span>&nbsp;<span class="op" id="6750874">:=</span>&nbsp;<span class="ident" id="6750877">usableListenPort</span><span class="op" id="6750893">(</span><span class="ident" id="6750894">t</span><span class="op" id="6750895">,</span>&nbsp;<span class="string" id="6750897">&#34;tcp&#34;</span><span class="op" id="6750902">,</span>&nbsp;<span class="string" id="6750904">&#34;[::]&#34;</span><span class="op" id="6750910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750913">defer</span>&nbsp;<span class="ident" id="6750919">l</span><span class="op" id="6750920">.</span><span class="ident" id="6750921">Close</span><span class="op" id="6750926">(</span><span class="op" id="6750927">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750931">for</span>&nbsp;<span class="ident" id="6750935">_</span><span class="op" id="6750936">,</span>&nbsp;<span class="ident" id="6750938">tt</span>&nbsp;<span class="op" id="6750941">:=</span>&nbsp;<span class="keyword" id="6750944">range</span>&nbsp;<span class="ident" id="6750950">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="6750977">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750981">c</span><span class="op" id="6750982">,</span>&nbsp;<span class="ident" id="6750984">err</span>&nbsp;<span class="op" id="6750988">:=</span>&nbsp;<span class="ident" id="6750991">Dial</span><span class="op" id="6750995">(</span><span class="ident" id="6750996">tt</span><span class="op" id="6750998">.</span><span class="ident" id="6750999">net</span><span class="op" id="6751002">,</span>&nbsp;<span class="ident" id="6751004">tt</span><span class="op" id="6751006">.</span><span class="ident" id="6751007">addr</span><span class="op" id="6751011">+</span><span class="string" id="6751012">&#34;:&#34;</span><span class="op" id="6751015">+</span><span class="ident" id="6751016">port</span><span class="op" id="6751020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751024">if</span>&nbsp;<span class="ident" id="6751027">err</span>&nbsp;<span class="op" id="6751031">==</span>&nbsp;<span class="ident" id="6751034">nil</span>&nbsp;<span class="op" id="6751038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751043">c</span><span class="op" id="6751044">.</span><span class="ident" id="6751045">Close</span><span class="op" id="6751050">(</span><span class="op" id="6751051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751056">t</span><span class="op" id="6751057">.</span><span class="ident" id="6751058">Fatalf</span><span class="op" id="6751064">(</span><span class="string" id="6751065">&#34;Dial(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6751091">,</span>&nbsp;<span class="ident" id="6751093">tt</span><span class="op" id="6751095">.</span><span class="ident" id="6751096">net</span><span class="op" id="6751099">,</span>&nbsp;<span class="ident" id="6751101">tt</span><span class="op" id="6751103">.</span><span class="ident" id="6751104">addr</span><span class="op" id="6751108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751112">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751115">}</span><br>
<span class="lineno"></span><span class="op" id="6751117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6751120">func</span>&nbsp;<span class="ident" id="6751125">TestWildWildcardListener</span><span class="op" id="6751149">(</span><span class="ident" id="6751150">t</span>&nbsp;<span class="op" id="6751152">*</span><span class="ident" id="6751153">testing</span><span class="op" id="6751160">.</span><span class="ident" id="6751161">T</span><span class="op" id="6751162">)</span>&nbsp;<span class="op" id="6751164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751167">switch</span>&nbsp;<span class="ident" id="6751174">runtime</span><span class="op" id="6751181">.</span><span class="ident" id="6751182">GOOS</span>&nbsp;<span class="op" id="6751187">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751190">case</span>&nbsp;<span class="string" id="6751195">&#34;plan9&#34;</span><span class="op" id="6751202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751206">t</span><span class="op" id="6751207">.</span><span class="ident" id="6751208">Skipf</span><span class="op" id="6751213">(</span><span class="string" id="6751214">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6751235">,</span>&nbsp;<span class="ident" id="6751237">runtime</span><span class="op" id="6751244">.</span><span class="ident" id="6751245">GOOS</span><span class="op" id="6751249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751256">if</span>&nbsp;<span class="ident" id="6751259">testing</span><span class="op" id="6751266">.</span><span class="ident" id="6751267">Short</span><span class="op" id="6751272">(</span><span class="op" id="6751273">)</span>&nbsp;<span class="op" id="6751275">||</span>&nbsp;<span class="op" id="6751278">!</span><span class="op" id="6751279">*</span><span class="ident" id="6751280">testExternal</span>&nbsp;<span class="op" id="6751293">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751297">t</span><span class="op" id="6751298">.</span><span class="ident" id="6751299">Skip</span><span class="op" id="6751303">(</span><span class="string" id="6751304">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6751345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751352">defer</span>&nbsp;<span class="keyword" id="6751358">func</span><span class="op" id="6751362">(</span><span class="op" id="6751363">)</span>&nbsp;<span class="op" id="6751365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751369">if</span>&nbsp;<span class="ident" id="6751372">p</span>&nbsp;<span class="op" id="6751374">:=</span>&nbsp;<span class="builtinfunc" id="6751377">recover</span><span class="op" id="6751384">(</span><span class="op" id="6751385">)</span><span class="op" id="6751386">;</span>&nbsp;<span class="ident" id="6751388">p</span>&nbsp;<span class="op" id="6751390">!=</span>&nbsp;<span class="ident" id="6751393">nil</span>&nbsp;<span class="op" id="6751397">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751402">t</span><span class="op" id="6751403">.</span><span class="ident" id="6751404">Fatalf</span><span class="op" id="6751410">(</span><span class="string" id="6751411">&#34;Listen,&nbsp;ListenPacket&nbsp;or&nbsp;protocol-specific&nbsp;Listen&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6751474">,</span>&nbsp;<span class="ident" id="6751476">p</span><span class="op" id="6751477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751484">}</span><span class="op" id="6751485">(</span><span class="op" id="6751486">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751490">if</span>&nbsp;<span class="ident" id="6751493">ln</span><span class="op" id="6751495">,</span>&nbsp;<span class="ident" id="6751497">err</span>&nbsp;<span class="op" id="6751501">:=</span>&nbsp;<span class="ident" id="6751504">Listen</span><span class="op" id="6751510">(</span><span class="string" id="6751511">&#34;tcp&#34;</span><span class="op" id="6751516">,</span>&nbsp;<span class="string" id="6751518">&#34;&#34;</span><span class="op" id="6751520">)</span><span class="op" id="6751521">;</span>&nbsp;<span class="ident" id="6751523">err</span>&nbsp;<span class="op" id="6751527">==</span>&nbsp;<span class="ident" id="6751530">nil</span>&nbsp;<span class="op" id="6751534">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751538">ln</span><span class="op" id="6751540">.</span><span class="ident" id="6751541">Close</span><span class="op" id="6751546">(</span><span class="op" id="6751547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751553">if</span>&nbsp;<span class="ident" id="6751556">ln</span><span class="op" id="6751558">,</span>&nbsp;<span class="ident" id="6751560">err</span>&nbsp;<span class="op" id="6751564">:=</span>&nbsp;<span class="ident" id="6751567">ListenPacket</span><span class="op" id="6751579">(</span><span class="string" id="6751580">&#34;udp&#34;</span><span class="op" id="6751585">,</span>&nbsp;<span class="string" id="6751587">&#34;&#34;</span><span class="op" id="6751589">)</span><span class="op" id="6751590">;</span>&nbsp;<span class="ident" id="6751592">err</span>&nbsp;<span class="op" id="6751596">==</span>&nbsp;<span class="ident" id="6751599">nil</span>&nbsp;<span class="op" id="6751603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751607">ln</span><span class="op" id="6751609">.</span><span class="ident" id="6751610">Close</span><span class="op" id="6751615">(</span><span class="op" id="6751616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751619">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751622">if</span>&nbsp;<span class="ident" id="6751625">ln</span><span class="op" id="6751627">,</span>&nbsp;<span class="ident" id="6751629">err</span>&nbsp;<span class="op" id="6751633">:=</span>&nbsp;<span class="ident" id="6751636">ListenTCP</span><span class="op" id="6751645">(</span><span class="string" id="6751646">&#34;tcp&#34;</span><span class="op" id="6751651">,</span>&nbsp;<span class="ident" id="6751653">nil</span><span class="op" id="6751656">)</span><span class="op" id="6751657">;</span>&nbsp;<span class="ident" id="6751659">err</span>&nbsp;<span class="op" id="6751663">==</span>&nbsp;<span class="ident" id="6751666">nil</span>&nbsp;<span class="op" id="6751670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751674">ln</span><span class="op" id="6751676">.</span><span class="ident" id="6751677">Close</span><span class="op" id="6751682">(</span><span class="op" id="6751683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751689">if</span>&nbsp;<span class="ident" id="6751692">ln</span><span class="op" id="6751694">,</span>&nbsp;<span class="ident" id="6751696">err</span>&nbsp;<span class="op" id="6751700">:=</span>&nbsp;<span class="ident" id="6751703">ListenUDP</span><span class="op" id="6751712">(</span><span class="string" id="6751713">&#34;udp&#34;</span><span class="op" id="6751718">,</span>&nbsp;<span class="ident" id="6751720">nil</span><span class="op" id="6751723">)</span><span class="op" id="6751724">;</span>&nbsp;<span class="ident" id="6751726">err</span>&nbsp;<span class="op" id="6751730">==</span>&nbsp;<span class="ident" id="6751733">nil</span>&nbsp;<span class="op" id="6751737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751741">ln</span><span class="op" id="6751743">.</span><span class="ident" id="6751744">Close</span><span class="op" id="6751749">(</span><span class="op" id="6751750">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751756">if</span>&nbsp;<span class="ident" id="6751759">ln</span><span class="op" id="6751761">,</span>&nbsp;<span class="ident" id="6751763">err</span>&nbsp;<span class="op" id="6751767">:=</span>&nbsp;<span class="ident" id="6751770">ListenIP</span><span class="op" id="6751778">(</span><span class="string" id="6751779">&#34;ip:icmp&#34;</span><span class="op" id="6751788">,</span>&nbsp;<span class="ident" id="6751790">nil</span><span class="op" id="6751793">)</span><span class="op" id="6751794">;</span>&nbsp;<span class="ident" id="6751796">err</span>&nbsp;<span class="op" id="6751800">==</span>&nbsp;<span class="ident" id="6751803">nil</span>&nbsp;<span class="op" id="6751807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751811">ln</span><span class="op" id="6751813">.</span><span class="ident" id="6751814">Close</span><span class="op" id="6751819">(</span><span class="op" id="6751820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751823">}</span><br>
<span class="lineno"></span><span class="op" id="6751825">}</span>
</div>
</body>
</html>
