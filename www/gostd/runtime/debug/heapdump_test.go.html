<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html" class="current">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7345037">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7345092">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7345146">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7345197">package</span>&nbsp;<span class="ident" id="7345205">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7345212">import</span>&nbsp;<span class="op" id="7345219">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7345222">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7345235">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7345241">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7345252">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7345262">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7345265">func</span>&nbsp;<span class="ident" id="7345270">TestWriteHeapDumpNonempty</span><span class="op" id="7345295">(</span><span class="ident" id="7345296">t</span>&nbsp;<span class="op" id="7345298">*</span><span class="ident" id="7345299">testing</span><span class="op" id="7345306">.</span><span class="ident" id="7345307">T</span><span class="op" id="7345308">)</span>&nbsp;<span class="op" id="7345310">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7345313">if</span>&nbsp;<span class="ident" id="7345316">runtime</span><span class="op" id="7345323">.</span><span class="ident" id="7345324">GOOS</span>&nbsp;<span class="op" id="7345329">==</span>&nbsp;<span class="string" id="7345332">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7345339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7345343">t</span><span class="op" id="7345344">.</span><span class="ident" id="7345345">Skip</span><span class="op" id="7345349">(</span><span class="string" id="7345350">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="7345391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7345394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7345397">f</span><span class="op" id="7345398">,</span>&nbsp;<span class="ident" id="7345400">err</span>&nbsp;<span class="op" id="7345404">:=</span>&nbsp;<span class="ident" id="7345407">ioutil</span><span class="op" id="7345413">.</span><span class="ident" id="7345414">TempFile</span><span class="op" id="7345422">(</span><span class="string" id="7345423">&#34;&#34;</span><span class="op" id="7345425">,</span>&nbsp;<span class="string" id="7345427">&#34;heapdumptest&#34;</span><span class="op" id="7345441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7345444">if</span>&nbsp;<span class="ident" id="7345447">err</span>&nbsp;<span class="op" id="7345451">!=</span>&nbsp;<span class="builtintype" id="7345454">nil</span>&nbsp;<span class="op" id="7345458">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7345462">t</span><span class="op" id="7345463">.</span><span class="ident" id="7345464">Fatalf</span><span class="op" id="7345470">(</span><span class="string" id="7345471">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7345492">,</span>&nbsp;<span class="ident" id="7345494">err</span><span class="op" id="7345497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7345500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7345503">defer</span>&nbsp;<span class="ident" id="7345509">os</span><span class="op" id="7345511">.</span><span class="ident" id="7345512">Remove</span><span class="op" id="7345518">(</span><span class="ident" id="7345519">f</span><span class="op" id="7345520">.</span><span class="ident" id="7345521">Name</span><span class="op" id="7345525">(</span><span class="op" id="7345526">)</span><span class="op" id="7345527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7345530">defer</span>&nbsp;<span class="ident" id="7345536">f</span><span class="op" id="7345537">.</span><span class="ident" id="7345538">Close</span><span class="op" id="7345543">(</span><span class="op" id="7345544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7345547">WriteHeapDump</span><span class="op" id="7345560">(</span><span class="ident" id="7345561">f</span><span class="op" id="7345562">.</span><span class="ident" id="7345563">Fd</span><span class="op" id="7345565">(</span><span class="op" id="7345566">)</span><span class="op" id="7345567">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7345570">fi</span><span class="op" id="7345572">,</span>&nbsp;<span class="ident" id="7345574">err</span>&nbsp;<span class="op" id="7345578">:=</span>&nbsp;<span class="ident" id="7345581">f</span><span class="op" id="7345582">.</span><span class="ident" id="7345583">Stat</span><span class="op" id="7345587">(</span><span class="op" id="7345588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7345591">if</span>&nbsp;<span class="ident" id="7345594">err</span>&nbsp;<span class="op" id="7345598">!=</span>&nbsp;<span class="builtintype" id="7345601">nil</span>&nbsp;<span class="op" id="7345605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7345609">t</span><span class="op" id="7345610">.</span><span class="ident" id="7345611">Fatalf</span><span class="op" id="7345617">(</span><span class="string" id="7345618">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7345635">,</span>&nbsp;<span class="ident" id="7345637">err</span><span class="op" id="7345640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7345643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7345646">const</span>&nbsp;<span class="ident" id="7345652">minSize</span>&nbsp;<span class="op" id="7345660">=</span>&nbsp;<span class="num" id="7345662">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7345665">if</span>&nbsp;<span class="ident" id="7345668">size</span>&nbsp;<span class="op" id="7345673">:=</span>&nbsp;<span class="ident" id="7345676">fi</span><span class="op" id="7345678">.</span><span class="ident" id="7345679">Size</span><span class="op" id="7345683">(</span><span class="op" id="7345684">)</span><span class="op" id="7345685">;</span>&nbsp;<span class="ident" id="7345687">size</span>&nbsp;<span class="op" id="7345692">&lt;</span>&nbsp;<span class="ident" id="7345694">minSize</span>&nbsp;<span class="op" id="7345702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7345706">t</span><span class="op" id="7345707">.</span><span class="ident" id="7345708">Fatalf</span><span class="op" id="7345714">(</span><span class="string" id="7345715">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7345768">,</span>&nbsp;<span class="ident" id="7345770">size</span><span class="op" id="7345774">,</span>&nbsp;<span class="ident" id="7345776">minSize</span><span class="op" id="7345783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7345786">}</span><br>
<span class="lineno"></span><span class="op" id="7345788">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
