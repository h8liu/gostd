<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html" class="current">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4630684">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4630739">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4630793">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4630844">package</span>&nbsp;<span class="ident" id="4630852">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4630857">import</span>&nbsp;<span class="op" id="4630864">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4630867">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4630877">&#34;crypto/hmac&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4630892">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4630906">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4630921">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4630938">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4630945">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4630948">//&nbsp;Split&nbsp;a&nbsp;premaster&nbsp;secret&nbsp;in&nbsp;two&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4631020">func</span>&nbsp;<span class="ident" id="4631025">splitPreMasterSecret</span><span class="op" id="4631045">(</span><span class="ident" id="4631046">secret</span>&nbsp;<span class="op" id="4631053">[</span><span class="op" id="4631054">]</span><span class="builtintype" id="4631055">byte</span><span class="op" id="4631059">)</span>&nbsp;<span class="op" id="4631061">(</span><span class="ident" id="4631062">s1</span><span class="op" id="4631064">,</span>&nbsp;<span class="ident" id="4631066">s2</span>&nbsp;<span class="op" id="4631069">[</span><span class="op" id="4631070">]</span><span class="builtintype" id="4631071">byte</span><span class="op" id="4631075">)</span>&nbsp;<span class="op" id="4631077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631080">s1</span>&nbsp;<span class="op" id="4631083">=</span>&nbsp;<span class="ident" id="4631085">secret</span><span class="op" id="4631091">[</span><span class="num" id="4631092">0</span>&nbsp;<span class="op" id="4631094">:</span>&nbsp;<span class="op" id="4631096">(</span><span class="builtinfunc" id="4631097">len</span><span class="op" id="4631100">(</span><span class="ident" id="4631101">secret</span><span class="op" id="4631107">)</span><span class="op" id="4631108">+</span><span class="num" id="4631109">1</span><span class="op" id="4631110">)</span><span class="op" id="4631111">/</span><span class="num" id="4631112">2</span><span class="op" id="4631113">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631116">s2</span>&nbsp;<span class="op" id="4631119">=</span>&nbsp;<span class="ident" id="4631121">secret</span><span class="op" id="4631127">[</span><span class="builtinfunc" id="4631128">len</span><span class="op" id="4631131">(</span><span class="ident" id="4631132">secret</span><span class="op" id="4631138">)</span><span class="op" id="4631139">/</span><span class="num" id="4631140">2</span><span class="op" id="4631141">:</span><span class="op" id="4631142">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631145">return</span><br>
<span class="lineno"></span><span class="op" id="4631152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4631155">//&nbsp;pHash&nbsp;implements&nbsp;the&nbsp;P_hash&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4631231">func</span>&nbsp;<span class="ident" id="4631236">pHash</span><span class="op" id="4631241">(</span><span class="ident" id="4631242">result</span><span class="op" id="4631248">,</span>&nbsp;<span class="ident" id="4631250">secret</span><span class="op" id="4631256">,</span>&nbsp;<span class="ident" id="4631258">seed</span>&nbsp;<span class="op" id="4631263">[</span><span class="op" id="4631264">]</span><span class="builtintype" id="4631265">byte</span><span class="op" id="4631269">,</span>&nbsp;<span class="ident" id="4631271">hash</span>&nbsp;<span class="keyword" id="4631276">func</span><span class="op" id="4631280">(</span><span class="op" id="4631281">)</span>&nbsp;<span class="ident" id="4631283">hash</span><span class="op" id="4631287">.</span><span class="ident" id="4631288">Hash</span><span class="op" id="4631292">)</span>&nbsp;<span class="op" id="4631294">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631297">h</span>&nbsp;<span class="op" id="4631299">:=</span>&nbsp;<span class="ident" id="4631302">hmac</span><span class="op" id="4631306">.</span><span class="ident" id="4631307">New</span><span class="op" id="4631310">(</span><span class="ident" id="4631311">hash</span><span class="op" id="4631315">,</span>&nbsp;<span class="ident" id="4631317">secret</span><span class="op" id="4631323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631326">h</span><span class="op" id="4631327">.</span><span class="ident" id="4631328">Write</span><span class="op" id="4631333">(</span><span class="ident" id="4631334">seed</span><span class="op" id="4631338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631341">a</span>&nbsp;<span class="op" id="4631343">:=</span>&nbsp;<span class="ident" id="4631346">h</span><span class="op" id="4631347">.</span><span class="ident" id="4631348">Sum</span><span class="op" id="4631351">(</span><span class="ident" id="4631352">nil</span><span class="op" id="4631355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631359">j</span>&nbsp;<span class="op" id="4631361">:=</span>&nbsp;<span class="num" id="4631364">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631367">for</span>&nbsp;<span class="ident" id="4631371">j</span>&nbsp;<span class="op" id="4631373">&lt;</span>&nbsp;<span class="builtinfunc" id="4631375">len</span><span class="op" id="4631378">(</span><span class="ident" id="4631379">result</span><span class="op" id="4631385">)</span>&nbsp;<span class="op" id="4631387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631391">h</span><span class="op" id="4631392">.</span><span class="ident" id="4631393">Reset</span><span class="op" id="4631398">(</span><span class="op" id="4631399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631403">h</span><span class="op" id="4631404">.</span><span class="ident" id="4631405">Write</span><span class="op" id="4631410">(</span><span class="ident" id="4631411">a</span><span class="op" id="4631412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631416">h</span><span class="op" id="4631417">.</span><span class="ident" id="4631418">Write</span><span class="op" id="4631423">(</span><span class="ident" id="4631424">seed</span><span class="op" id="4631428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631432">b</span>&nbsp;<span class="op" id="4631434">:=</span>&nbsp;<span class="ident" id="4631437">h</span><span class="op" id="4631438">.</span><span class="ident" id="4631439">Sum</span><span class="op" id="4631442">(</span><span class="ident" id="4631443">nil</span><span class="op" id="4631446">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631450">todo</span>&nbsp;<span class="op" id="4631455">:=</span>&nbsp;<span class="builtinfunc" id="4631458">len</span><span class="op" id="4631461">(</span><span class="ident" id="4631462">b</span><span class="op" id="4631463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631467">if</span>&nbsp;<span class="ident" id="4631470">j</span><span class="op" id="4631471">+</span><span class="ident" id="4631472">todo</span>&nbsp;<span class="op" id="4631477">&gt;</span>&nbsp;<span class="builtinfunc" id="4631479">len</span><span class="op" id="4631482">(</span><span class="ident" id="4631483">result</span><span class="op" id="4631489">)</span>&nbsp;<span class="op" id="4631491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631496">todo</span>&nbsp;<span class="op" id="4631501">=</span>&nbsp;<span class="builtinfunc" id="4631503">len</span><span class="op" id="4631506">(</span><span class="ident" id="4631507">result</span><span class="op" id="4631513">)</span>&nbsp;<span class="op" id="4631515">-</span>&nbsp;<span class="ident" id="4631517">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4631525">copy</span><span class="op" id="4631529">(</span><span class="ident" id="4631530">result</span><span class="op" id="4631536">[</span><span class="ident" id="4631537">j</span><span class="op" id="4631538">:</span><span class="ident" id="4631539">j</span><span class="op" id="4631540">+</span><span class="ident" id="4631541">todo</span><span class="op" id="4631545">]</span><span class="op" id="4631546">,</span>&nbsp;<span class="ident" id="4631548">b</span><span class="op" id="4631549">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631553">j</span>&nbsp;<span class="op" id="4631555">+=</span>&nbsp;<span class="ident" id="4631558">todo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631566">h</span><span class="op" id="4631567">.</span><span class="ident" id="4631568">Reset</span><span class="op" id="4631573">(</span><span class="op" id="4631574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631578">h</span><span class="op" id="4631579">.</span><span class="ident" id="4631580">Write</span><span class="op" id="4631585">(</span><span class="ident" id="4631586">a</span><span class="op" id="4631587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631591">a</span>&nbsp;<span class="op" id="4631593">=</span>&nbsp;<span class="ident" id="4631595">h</span><span class="op" id="4631596">.</span><span class="ident" id="4631597">Sum</span><span class="op" id="4631600">(</span><span class="ident" id="4631601">nil</span><span class="op" id="4631604">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631607">}</span><br>
<span class="lineno"></span><span class="op" id="4631609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4631612">//&nbsp;prf10&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4631703">func</span>&nbsp;<span class="ident" id="4631708">prf10</span><span class="op" id="4631713">(</span><span class="ident" id="4631714">result</span><span class="op" id="4631720">,</span>&nbsp;<span class="ident" id="4631722">secret</span><span class="op" id="4631728">,</span>&nbsp;<span class="ident" id="4631730">label</span><span class="op" id="4631735">,</span>&nbsp;<span class="ident" id="4631737">seed</span>&nbsp;<span class="op" id="4631742">[</span><span class="op" id="4631743">]</span><span class="builtintype" id="4631744">byte</span><span class="op" id="4631748">)</span>&nbsp;<span class="op" id="4631750">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631753">hashSHA1</span>&nbsp;<span class="op" id="4631762">:=</span>&nbsp;<span class="ident" id="4631765">sha1</span><span class="op" id="4631769">.</span><span class="ident" id="4631770">New</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631775">hashMD5</span>&nbsp;<span class="op" id="4631783">:=</span>&nbsp;<span class="ident" id="4631786">md5</span><span class="op" id="4631789">.</span><span class="ident" id="4631790">New</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631796">labelAndSeed</span>&nbsp;<span class="op" id="4631809">:=</span>&nbsp;<span class="builtinfunc" id="4631812">make</span><span class="op" id="4631816">(</span><span class="op" id="4631817">[</span><span class="op" id="4631818">]</span><span class="builtintype" id="4631819">byte</span><span class="op" id="4631823">,</span>&nbsp;<span class="builtinfunc" id="4631825">len</span><span class="op" id="4631828">(</span><span class="ident" id="4631829">label</span><span class="op" id="4631834">)</span><span class="op" id="4631835">+</span><span class="builtinfunc" id="4631836">len</span><span class="op" id="4631839">(</span><span class="ident" id="4631840">seed</span><span class="op" id="4631844">)</span><span class="op" id="4631845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4631848">copy</span><span class="op" id="4631852">(</span><span class="ident" id="4631853">labelAndSeed</span><span class="op" id="4631865">,</span>&nbsp;<span class="ident" id="4631867">label</span><span class="op" id="4631872">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4631875">copy</span><span class="op" id="4631879">(</span><span class="ident" id="4631880">labelAndSeed</span><span class="op" id="4631892">[</span><span class="builtinfunc" id="4631893">len</span><span class="op" id="4631896">(</span><span class="ident" id="4631897">label</span><span class="op" id="4631902">)</span><span class="op" id="4631903">:</span><span class="op" id="4631904">]</span><span class="op" id="4631905">,</span>&nbsp;<span class="ident" id="4631907">seed</span><span class="op" id="4631911">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631915">s1</span><span class="op" id="4631917">,</span>&nbsp;<span class="ident" id="4631919">s2</span>&nbsp;<span class="op" id="4631922">:=</span>&nbsp;<span class="ident" id="4631925">splitPreMasterSecret</span><span class="op" id="4631945">(</span><span class="ident" id="4631946">secret</span><span class="op" id="4631952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631955">pHash</span><span class="op" id="4631960">(</span><span class="ident" id="4631961">result</span><span class="op" id="4631967">,</span>&nbsp;<span class="ident" id="4631969">s1</span><span class="op" id="4631971">,</span>&nbsp;<span class="ident" id="4631973">labelAndSeed</span><span class="op" id="4631985">,</span>&nbsp;<span class="ident" id="4631987">hashMD5</span><span class="op" id="4631994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631997">result2</span>&nbsp;<span class="op" id="4632005">:=</span>&nbsp;<span class="builtinfunc" id="4632008">make</span><span class="op" id="4632012">(</span><span class="op" id="4632013">[</span><span class="op" id="4632014">]</span><span class="builtintype" id="4632015">byte</span><span class="op" id="4632019">,</span>&nbsp;<span class="builtinfunc" id="4632021">len</span><span class="op" id="4632024">(</span><span class="ident" id="4632025">result</span><span class="op" id="4632031">)</span><span class="op" id="4632032">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632035">pHash</span><span class="op" id="4632040">(</span><span class="ident" id="4632041">result2</span><span class="op" id="4632048">,</span>&nbsp;<span class="ident" id="4632050">s2</span><span class="op" id="4632052">,</span>&nbsp;<span class="ident" id="4632054">labelAndSeed</span><span class="op" id="4632066">,</span>&nbsp;<span class="ident" id="4632068">hashSHA1</span><span class="op" id="4632076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632080">for</span>&nbsp;<span class="ident" id="4632084">i</span><span class="op" id="4632085">,</span>&nbsp;<span class="ident" id="4632087">b</span>&nbsp;<span class="op" id="4632089">:=</span>&nbsp;<span class="keyword" id="4632092">range</span>&nbsp;<span class="ident" id="4632098">result2</span>&nbsp;<span class="op" id="4632106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632110">result</span><span class="op" id="4632116">[</span><span class="ident" id="4632117">i</span><span class="op" id="4632118">]</span>&nbsp;<span class="op" id="4632120">^=</span>&nbsp;<span class="ident" id="4632123">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4632126">}</span><br>
<span class="lineno">65</span><span class="op" id="4632128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4632131">//&nbsp;prf12&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.2&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4632222">func</span>&nbsp;<span class="ident" id="4632227">prf12</span><span class="op" id="4632232">(</span><span class="ident" id="4632233">result</span><span class="op" id="4632239">,</span>&nbsp;<span class="ident" id="4632241">secret</span><span class="op" id="4632247">,</span>&nbsp;<span class="ident" id="4632249">label</span><span class="op" id="4632254">,</span>&nbsp;<span class="ident" id="4632256">seed</span>&nbsp;<span class="op" id="4632261">[</span><span class="op" id="4632262">]</span><span class="builtintype" id="4632263">byte</span><span class="op" id="4632267">)</span>&nbsp;<span class="op" id="4632269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632272">labelAndSeed</span>&nbsp;<span class="op" id="4632285">:=</span>&nbsp;<span class="builtinfunc" id="4632288">make</span><span class="op" id="4632292">(</span><span class="op" id="4632293">[</span><span class="op" id="4632294">]</span><span class="builtintype" id="4632295">byte</span><span class="op" id="4632299">,</span>&nbsp;<span class="builtinfunc" id="4632301">len</span><span class="op" id="4632304">(</span><span class="ident" id="4632305">label</span><span class="op" id="4632310">)</span><span class="op" id="4632311">+</span><span class="builtinfunc" id="4632312">len</span><span class="op" id="4632315">(</span><span class="ident" id="4632316">seed</span><span class="op" id="4632320">)</span><span class="op" id="4632321">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4632324">copy</span><span class="op" id="4632328">(</span><span class="ident" id="4632329">labelAndSeed</span><span class="op" id="4632341">,</span>&nbsp;<span class="ident" id="4632343">label</span><span class="op" id="4632348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4632351">copy</span><span class="op" id="4632355">(</span><span class="ident" id="4632356">labelAndSeed</span><span class="op" id="4632368">[</span><span class="builtinfunc" id="4632369">len</span><span class="op" id="4632372">(</span><span class="ident" id="4632373">label</span><span class="op" id="4632378">)</span><span class="op" id="4632379">:</span><span class="op" id="4632380">]</span><span class="op" id="4632381">,</span>&nbsp;<span class="ident" id="4632383">seed</span><span class="op" id="4632387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632391">pHash</span><span class="op" id="4632396">(</span><span class="ident" id="4632397">result</span><span class="op" id="4632403">,</span>&nbsp;<span class="ident" id="4632405">secret</span><span class="op" id="4632411">,</span>&nbsp;<span class="ident" id="4632413">labelAndSeed</span><span class="op" id="4632425">,</span>&nbsp;<span class="ident" id="4632427">sha256</span><span class="op" id="4632433">.</span><span class="ident" id="4632434">New</span><span class="op" id="4632437">)</span><br>
<span class="lineno"></span><span class="op" id="4632439">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4632442">//&nbsp;prf30&nbsp;implements&nbsp;the&nbsp;SSL&nbsp;3.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4632512">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;6.</span><br>
<span class="lineno"></span><span class="keyword" id="4632585">func</span>&nbsp;<span class="ident" id="4632590">prf30</span><span class="op" id="4632595">(</span><span class="ident" id="4632596">result</span><span class="op" id="4632602">,</span>&nbsp;<span class="ident" id="4632604">secret</span><span class="op" id="4632610">,</span>&nbsp;<span class="ident" id="4632612">label</span><span class="op" id="4632617">,</span>&nbsp;<span class="ident" id="4632619">seed</span>&nbsp;<span class="op" id="4632624">[</span><span class="op" id="4632625">]</span><span class="builtintype" id="4632626">byte</span><span class="op" id="4632630">)</span>&nbsp;<span class="op" id="4632632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632635">hashSHA1</span>&nbsp;<span class="op" id="4632644">:=</span>&nbsp;<span class="ident" id="4632647">sha1</span><span class="op" id="4632651">.</span><span class="ident" id="4632652">New</span><span class="op" id="4632655">(</span><span class="op" id="4632656">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632659">hashMD5</span>&nbsp;<span class="op" id="4632667">:=</span>&nbsp;<span class="ident" id="4632670">md5</span><span class="op" id="4632673">.</span><span class="ident" id="4632674">New</span><span class="op" id="4632677">(</span><span class="op" id="4632678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632682">done</span>&nbsp;<span class="op" id="4632687">:=</span>&nbsp;<span class="num" id="4632690">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632693">i</span>&nbsp;<span class="op" id="4632695">:=</span>&nbsp;<span class="num" id="4632698">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632701">//&nbsp;RFC5246&nbsp;section&nbsp;6.3&nbsp;says&nbsp;that&nbsp;the&nbsp;largest&nbsp;PRF&nbsp;output&nbsp;needed&nbsp;is&nbsp;128</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632772">//&nbsp;bytes.&nbsp;Since&nbsp;no&nbsp;more&nbsp;ciphersuites&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;SSLv3,&nbsp;this&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632844">//&nbsp;remain&nbsp;true.&nbsp;Each&nbsp;iteration&nbsp;gives&nbsp;us&nbsp;16&nbsp;bytes&nbsp;so&nbsp;10&nbsp;iterations&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632916">//&nbsp;be&nbsp;sufficient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632935">var</span>&nbsp;<span class="ident" id="4632939">b</span>&nbsp;<span class="op" id="4632941">[</span><span class="num" id="4632942">11</span><span class="op" id="4632944">]</span><span class="builtintype" id="4632945">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632951">for</span>&nbsp;<span class="ident" id="4632955">done</span>&nbsp;<span class="op" id="4632960">&lt;</span>&nbsp;<span class="builtinfunc" id="4632962">len</span><span class="op" id="4632965">(</span><span class="ident" id="4632966">result</span><span class="op" id="4632972">)</span>&nbsp;<span class="op" id="4632974">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632978">for</span>&nbsp;<span class="ident" id="4632982">j</span>&nbsp;<span class="op" id="4632984">:=</span>&nbsp;<span class="num" id="4632987">0</span><span class="op" id="4632988">;</span>&nbsp;<span class="ident" id="4632990">j</span>&nbsp;<span class="op" id="4632992">&lt;=</span>&nbsp;<span class="ident" id="4632995">i</span><span class="op" id="4632996">;</span>&nbsp;<span class="ident" id="4632998">j</span><span class="op" id="4632999">++</span>&nbsp;<span class="op" id="4633002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633007">b</span><span class="op" id="4633008">[</span><span class="ident" id="4633009">j</span><span class="op" id="4633010">]</span>&nbsp;<span class="op" id="4633012">=</span>&nbsp;<span class="string" id="4633014">&#39;A&#39;</span>&nbsp;<span class="op" id="4633018">+</span>&nbsp;<span class="builtintype" id="4633020">byte</span><span class="op" id="4633024">(</span><span class="ident" id="4633025">i</span><span class="op" id="4633026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633035">hashSHA1</span><span class="op" id="4633043">.</span><span class="ident" id="4633044">Reset</span><span class="op" id="4633049">(</span><span class="op" id="4633050">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633054">hashSHA1</span><span class="op" id="4633062">.</span><span class="ident" id="4633063">Write</span><span class="op" id="4633068">(</span><span class="ident" id="4633069">b</span><span class="op" id="4633070">[</span><span class="op" id="4633071">:</span><span class="ident" id="4633072">i</span><span class="op" id="4633073">+</span><span class="num" id="4633074">1</span><span class="op" id="4633075">]</span><span class="op" id="4633076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633080">hashSHA1</span><span class="op" id="4633088">.</span><span class="ident" id="4633089">Write</span><span class="op" id="4633094">(</span><span class="ident" id="4633095">secret</span><span class="op" id="4633101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633105">hashSHA1</span><span class="op" id="4633113">.</span><span class="ident" id="4633114">Write</span><span class="op" id="4633119">(</span><span class="ident" id="4633120">seed</span><span class="op" id="4633124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633128">digest</span>&nbsp;<span class="op" id="4633135">:=</span>&nbsp;<span class="ident" id="4633138">hashSHA1</span><span class="op" id="4633146">.</span><span class="ident" id="4633147">Sum</span><span class="op" id="4633150">(</span><span class="ident" id="4633151">nil</span><span class="op" id="4633154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633159">hashMD5</span><span class="op" id="4633166">.</span><span class="ident" id="4633167">Reset</span><span class="op" id="4633172">(</span><span class="op" id="4633173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633177">hashMD5</span><span class="op" id="4633184">.</span><span class="ident" id="4633185">Write</span><span class="op" id="4633190">(</span><span class="ident" id="4633191">secret</span><span class="op" id="4633197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633201">hashMD5</span><span class="op" id="4633208">.</span><span class="ident" id="4633209">Write</span><span class="op" id="4633214">(</span><span class="ident" id="4633215">digest</span><span class="op" id="4633221">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633226">done</span>&nbsp;<span class="op" id="4633231">+=</span>&nbsp;<span class="builtinfunc" id="4633234">copy</span><span class="op" id="4633238">(</span><span class="ident" id="4633239">result</span><span class="op" id="4633245">[</span><span class="ident" id="4633246">done</span><span class="op" id="4633250">:</span><span class="op" id="4633251">]</span><span class="op" id="4633252">,</span>&nbsp;<span class="ident" id="4633254">hashMD5</span><span class="op" id="4633261">.</span><span class="ident" id="4633262">Sum</span><span class="op" id="4633265">(</span><span class="ident" id="4633266">nil</span><span class="op" id="4633269">)</span><span class="op" id="4633270">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633274">i</span><span class="op" id="4633275">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633279">}</span><br>
<span class="lineno"></span><span class="op" id="4633281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4633284">const</span>&nbsp;<span class="op" id="4633290">(</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633293">tlsRandomLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4633314">=</span>&nbsp;<span class="num" id="4633316">32</span>&nbsp;<span class="comment" id="4633319">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;random&nbsp;nonce&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633360">masterSecretLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4633381">=</span>&nbsp;<span class="num" id="4633383">48</span>&nbsp;<span class="comment" id="4633386">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;master&nbsp;secret&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633428">finishedVerifyLength</span>&nbsp;<span class="op" id="4633449">=</span>&nbsp;<span class="num" id="4633451">12</span>&nbsp;<span class="comment" id="4633454">//&nbsp;Length&nbsp;of&nbsp;verify_data&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="op" id="4633502">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4633505">var</span>&nbsp;<span class="ident" id="4633509">masterSecretLabel</span>&nbsp;<span class="op" id="4633527">=</span>&nbsp;<span class="op" id="4633529">[</span><span class="op" id="4633530">]</span><span class="builtintype" id="4633531">byte</span><span class="op" id="4633535">(</span><span class="string" id="4633536">&#34;master&nbsp;secret&#34;</span><span class="op" id="4633551">)</span><br>
<span class="lineno"></span><span class="keyword" id="4633553">var</span>&nbsp;<span class="ident" id="4633557">keyExpansionLabel</span>&nbsp;<span class="op" id="4633575">=</span>&nbsp;<span class="op" id="4633577">[</span><span class="op" id="4633578">]</span><span class="builtintype" id="4633579">byte</span><span class="op" id="4633583">(</span><span class="string" id="4633584">&#34;key&nbsp;expansion&#34;</span><span class="op" id="4633599">)</span><br>
<span class="lineno"></span><span class="keyword" id="4633601">var</span>&nbsp;<span class="ident" id="4633605">clientFinishedLabel</span>&nbsp;<span class="op" id="4633625">=</span>&nbsp;<span class="op" id="4633627">[</span><span class="op" id="4633628">]</span><span class="builtintype" id="4633629">byte</span><span class="op" id="4633633">(</span><span class="string" id="4633634">&#34;client&nbsp;finished&#34;</span><span class="op" id="4633651">)</span><br>
<span class="lineno"></span><span class="keyword" id="4633653">var</span>&nbsp;<span class="ident" id="4633657">serverFinishedLabel</span>&nbsp;<span class="op" id="4633677">=</span>&nbsp;<span class="op" id="4633679">[</span><span class="op" id="4633680">]</span><span class="builtintype" id="4633681">byte</span><span class="op" id="4633685">(</span><span class="string" id="4633686">&#34;server&nbsp;finished&#34;</span><span class="op" id="4633703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="4633706">func</span>&nbsp;<span class="ident" id="4633711">prfForVersion</span><span class="op" id="4633724">(</span><span class="ident" id="4633725">version</span>&nbsp;<span class="builtintype" id="4633733">uint16</span><span class="op" id="4633739">)</span>&nbsp;<span class="keyword" id="4633741">func</span><span class="op" id="4633745">(</span><span class="ident" id="4633746">result</span><span class="op" id="4633752">,</span>&nbsp;<span class="ident" id="4633754">secret</span><span class="op" id="4633760">,</span>&nbsp;<span class="ident" id="4633762">label</span><span class="op" id="4633767">,</span>&nbsp;<span class="ident" id="4633769">seed</span>&nbsp;<span class="op" id="4633774">[</span><span class="op" id="4633775">]</span><span class="builtintype" id="4633776">byte</span><span class="op" id="4633780">)</span>&nbsp;<span class="op" id="4633782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633785">switch</span>&nbsp;<span class="ident" id="4633792">version</span>&nbsp;<span class="op" id="4633800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633803">case</span>&nbsp;<span class="ident" id="4633808">VersionSSL30</span><span class="op" id="4633820">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633824">return</span>&nbsp;<span class="ident" id="4633831">prf30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633838">case</span>&nbsp;<span class="ident" id="4633843">VersionTLS10</span><span class="op" id="4633855">,</span>&nbsp;<span class="ident" id="4633857">VersionTLS11</span><span class="op" id="4633869">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633873">return</span>&nbsp;<span class="ident" id="4633880">prf10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633887">case</span>&nbsp;<span class="ident" id="4633892">VersionTLS12</span><span class="op" id="4633904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633908">return</span>&nbsp;<span class="ident" id="4633915">prf12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633922">default</span><span class="op" id="4633929">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4633933">panic</span><span class="op" id="4633938">(</span><span class="string" id="4633939">&#34;unknown&nbsp;version&#34;</span><span class="op" id="4633956">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633959">}</span><br>
<span class="lineno"></span><span class="op" id="4633961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4633964">//&nbsp;masterFromPreMasterSecret&nbsp;generates&nbsp;the&nbsp;master&nbsp;secret&nbsp;from&nbsp;the&nbsp;pre-master</span><br>
<span class="lineno"></span><span class="comment" id="4634041">//&nbsp;secret.&nbsp;See&nbsp;http://tools.ietf.org/html/rfc5246#section-8.1</span><br>
<span class="lineno">135</span><span class="keyword" id="4634103">func</span>&nbsp;<span class="ident" id="4634108">masterFromPreMasterSecret</span><span class="op" id="4634133">(</span><span class="ident" id="4634134">version</span>&nbsp;<span class="builtintype" id="4634142">uint16</span><span class="op" id="4634148">,</span>&nbsp;<span class="ident" id="4634150">preMasterSecret</span><span class="op" id="4634165">,</span>&nbsp;<span class="ident" id="4634167">clientRandom</span><span class="op" id="4634179">,</span>&nbsp;<span class="ident" id="4634181">serverRandom</span>&nbsp;<span class="op" id="4634194">[</span><span class="op" id="4634195">]</span><span class="builtintype" id="4634196">byte</span><span class="op" id="4634200">)</span>&nbsp;<span class="op" id="4634202">[</span><span class="op" id="4634203">]</span><span class="builtintype" id="4634204">byte</span>&nbsp;<span class="op" id="4634209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634212">var</span>&nbsp;<span class="ident" id="4634216">seed</span>&nbsp;<span class="op" id="4634221">[</span><span class="ident" id="4634222">tlsRandomLength</span>&nbsp;<span class="op" id="4634238">*</span>&nbsp;<span class="num" id="4634240">2</span><span class="op" id="4634241">]</span><span class="builtintype" id="4634242">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4634248">copy</span><span class="op" id="4634252">(</span><span class="ident" id="4634253">seed</span><span class="op" id="4634257">[</span><span class="num" id="4634258">0</span><span class="op" id="4634259">:</span><span class="builtinfunc" id="4634260">len</span><span class="op" id="4634263">(</span><span class="ident" id="4634264">clientRandom</span><span class="op" id="4634276">)</span><span class="op" id="4634277">]</span><span class="op" id="4634278">,</span>&nbsp;<span class="ident" id="4634280">clientRandom</span><span class="op" id="4634292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4634295">copy</span><span class="op" id="4634299">(</span><span class="ident" id="4634300">seed</span><span class="op" id="4634304">[</span><span class="builtinfunc" id="4634305">len</span><span class="op" id="4634308">(</span><span class="ident" id="4634309">clientRandom</span><span class="op" id="4634321">)</span><span class="op" id="4634322">:</span><span class="op" id="4634323">]</span><span class="op" id="4634324">,</span>&nbsp;<span class="ident" id="4634326">serverRandom</span><span class="op" id="4634338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634341">masterSecret</span>&nbsp;<span class="op" id="4634354">:=</span>&nbsp;<span class="builtinfunc" id="4634357">make</span><span class="op" id="4634361">(</span><span class="op" id="4634362">[</span><span class="op" id="4634363">]</span><span class="builtintype" id="4634364">byte</span><span class="op" id="4634368">,</span>&nbsp;<span class="ident" id="4634370">masterSecretLength</span><span class="op" id="4634388">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634391">prfForVersion</span><span class="op" id="4634404">(</span><span class="ident" id="4634405">version</span><span class="op" id="4634412">)</span><span class="op" id="4634413">(</span><span class="ident" id="4634414">masterSecret</span><span class="op" id="4634426">,</span>&nbsp;<span class="ident" id="4634428">preMasterSecret</span><span class="op" id="4634443">,</span>&nbsp;<span class="ident" id="4634445">masterSecretLabel</span><span class="op" id="4634462">,</span>&nbsp;<span class="ident" id="4634464">seed</span><span class="op" id="4634468">[</span><span class="num" id="4634469">0</span><span class="op" id="4634470">:</span><span class="op" id="4634471">]</span><span class="op" id="4634472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634475">return</span>&nbsp;<span class="ident" id="4634482">masterSecret</span><br>
<span class="lineno"></span><span class="op" id="4634495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4634498">//&nbsp;keysFromMasterSecret&nbsp;generates&nbsp;the&nbsp;connection&nbsp;keys&nbsp;from&nbsp;the&nbsp;master</span><br>
<span class="lineno">145</span><span class="comment" id="4634568">//&nbsp;secret,&nbsp;given&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MAC&nbsp;key,&nbsp;cipher&nbsp;key&nbsp;and&nbsp;IV,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4634646">//&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.3.</span><br>
<span class="lineno"></span><span class="keyword" id="4634672">func</span>&nbsp;<span class="ident" id="4634677">keysFromMasterSecret</span><span class="op" id="4634697">(</span><span class="ident" id="4634698">version</span>&nbsp;<span class="builtintype" id="4634706">uint16</span><span class="op" id="4634712">,</span>&nbsp;<span class="ident" id="4634714">masterSecret</span><span class="op" id="4634726">,</span>&nbsp;<span class="ident" id="4634728">clientRandom</span><span class="op" id="4634740">,</span>&nbsp;<span class="ident" id="4634742">serverRandom</span>&nbsp;<span class="op" id="4634755">[</span><span class="op" id="4634756">]</span><span class="builtintype" id="4634757">byte</span><span class="op" id="4634761">,</span>&nbsp;<span class="ident" id="4634763">macLen</span><span class="op" id="4634769">,</span>&nbsp;<span class="ident" id="4634771">keyLen</span><span class="op" id="4634777">,</span>&nbsp;<span class="ident" id="4634779">ivLen</span>&nbsp;<span class="builtintype" id="4634785">int</span><span class="op" id="4634788">)</span>&nbsp;<span class="op" id="4634790">(</span><span class="ident" id="4634791">clientMAC</span><span class="op" id="4634800">,</span>&nbsp;<span class="ident" id="4634802">serverMAC</span><span class="op" id="4634811">,</span>&nbsp;<span class="ident" id="4634813">clientKey</span><span class="op" id="4634822">,</span>&nbsp;<span class="ident" id="4634824">serverKey</span><span class="op" id="4634833">,</span>&nbsp;<span class="ident" id="4634835">clientIV</span><span class="op" id="4634843">,</span>&nbsp;<span class="ident" id="4634845">serverIV</span>&nbsp;<span class="op" id="4634854">[</span><span class="op" id="4634855">]</span><span class="builtintype" id="4634856">byte</span><span class="op" id="4634860">)</span>&nbsp;<span class="op" id="4634862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634865">var</span>&nbsp;<span class="ident" id="4634869">seed</span>&nbsp;<span class="op" id="4634874">[</span><span class="ident" id="4634875">tlsRandomLength</span>&nbsp;<span class="op" id="4634891">*</span>&nbsp;<span class="num" id="4634893">2</span><span class="op" id="4634894">]</span><span class="builtintype" id="4634895">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4634901">copy</span><span class="op" id="4634905">(</span><span class="ident" id="4634906">seed</span><span class="op" id="4634910">[</span><span class="num" id="4634911">0</span><span class="op" id="4634912">:</span><span class="builtinfunc" id="4634913">len</span><span class="op" id="4634916">(</span><span class="ident" id="4634917">clientRandom</span><span class="op" id="4634929">)</span><span class="op" id="4634930">]</span><span class="op" id="4634931">,</span>&nbsp;<span class="ident" id="4634933">serverRandom</span><span class="op" id="4634945">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4634948">copy</span><span class="op" id="4634952">(</span><span class="ident" id="4634953">seed</span><span class="op" id="4634957">[</span><span class="builtinfunc" id="4634958">len</span><span class="op" id="4634961">(</span><span class="ident" id="4634962">serverRandom</span><span class="op" id="4634974">)</span><span class="op" id="4634975">:</span><span class="op" id="4634976">]</span><span class="op" id="4634977">,</span>&nbsp;<span class="ident" id="4634979">clientRandom</span><span class="op" id="4634991">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634995">n</span>&nbsp;<span class="op" id="4634997">:=</span>&nbsp;<span class="num" id="4635000">2</span><span class="op" id="4635001">*</span><span class="ident" id="4635002">macLen</span>&nbsp;<span class="op" id="4635009">+</span>&nbsp;<span class="num" id="4635011">2</span><span class="op" id="4635012">*</span><span class="ident" id="4635013">keyLen</span>&nbsp;<span class="op" id="4635020">+</span>&nbsp;<span class="num" id="4635022">2</span><span class="op" id="4635023">*</span><span class="ident" id="4635024">ivLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635031">keyMaterial</span>&nbsp;<span class="op" id="4635043">:=</span>&nbsp;<span class="builtinfunc" id="4635046">make</span><span class="op" id="4635050">(</span><span class="op" id="4635051">[</span><span class="op" id="4635052">]</span><span class="builtintype" id="4635053">byte</span><span class="op" id="4635057">,</span>&nbsp;<span class="ident" id="4635059">n</span><span class="op" id="4635060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635063">prfForVersion</span><span class="op" id="4635076">(</span><span class="ident" id="4635077">version</span><span class="op" id="4635084">)</span><span class="op" id="4635085">(</span><span class="ident" id="4635086">keyMaterial</span><span class="op" id="4635097">,</span>&nbsp;<span class="ident" id="4635099">masterSecret</span><span class="op" id="4635111">,</span>&nbsp;<span class="ident" id="4635113">keyExpansionLabel</span><span class="op" id="4635130">,</span>&nbsp;<span class="ident" id="4635132">seed</span><span class="op" id="4635136">[</span><span class="num" id="4635137">0</span><span class="op" id="4635138">:</span><span class="op" id="4635139">]</span><span class="op" id="4635140">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635143">clientMAC</span>&nbsp;<span class="op" id="4635153">=</span>&nbsp;<span class="ident" id="4635155">keyMaterial</span><span class="op" id="4635166">[</span><span class="op" id="4635167">:</span><span class="ident" id="4635168">macLen</span><span class="op" id="4635174">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635177">keyMaterial</span>&nbsp;<span class="op" id="4635189">=</span>&nbsp;<span class="ident" id="4635191">keyMaterial</span><span class="op" id="4635202">[</span><span class="ident" id="4635203">macLen</span><span class="op" id="4635209">:</span><span class="op" id="4635210">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635213">serverMAC</span>&nbsp;<span class="op" id="4635223">=</span>&nbsp;<span class="ident" id="4635225">keyMaterial</span><span class="op" id="4635236">[</span><span class="op" id="4635237">:</span><span class="ident" id="4635238">macLen</span><span class="op" id="4635244">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635247">keyMaterial</span>&nbsp;<span class="op" id="4635259">=</span>&nbsp;<span class="ident" id="4635261">keyMaterial</span><span class="op" id="4635272">[</span><span class="ident" id="4635273">macLen</span><span class="op" id="4635279">:</span><span class="op" id="4635280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635283">clientKey</span>&nbsp;<span class="op" id="4635293">=</span>&nbsp;<span class="ident" id="4635295">keyMaterial</span><span class="op" id="4635306">[</span><span class="op" id="4635307">:</span><span class="ident" id="4635308">keyLen</span><span class="op" id="4635314">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635317">keyMaterial</span>&nbsp;<span class="op" id="4635329">=</span>&nbsp;<span class="ident" id="4635331">keyMaterial</span><span class="op" id="4635342">[</span><span class="ident" id="4635343">keyLen</span><span class="op" id="4635349">:</span><span class="op" id="4635350">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635353">serverKey</span>&nbsp;<span class="op" id="4635363">=</span>&nbsp;<span class="ident" id="4635365">keyMaterial</span><span class="op" id="4635376">[</span><span class="op" id="4635377">:</span><span class="ident" id="4635378">keyLen</span><span class="op" id="4635384">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635387">keyMaterial</span>&nbsp;<span class="op" id="4635399">=</span>&nbsp;<span class="ident" id="4635401">keyMaterial</span><span class="op" id="4635412">[</span><span class="ident" id="4635413">keyLen</span><span class="op" id="4635419">:</span><span class="op" id="4635420">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635423">clientIV</span>&nbsp;<span class="op" id="4635432">=</span>&nbsp;<span class="ident" id="4635434">keyMaterial</span><span class="op" id="4635445">[</span><span class="op" id="4635446">:</span><span class="ident" id="4635447">ivLen</span><span class="op" id="4635452">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635455">keyMaterial</span>&nbsp;<span class="op" id="4635467">=</span>&nbsp;<span class="ident" id="4635469">keyMaterial</span><span class="op" id="4635480">[</span><span class="ident" id="4635481">ivLen</span><span class="op" id="4635486">:</span><span class="op" id="4635487">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635490">serverIV</span>&nbsp;<span class="op" id="4635499">=</span>&nbsp;<span class="ident" id="4635501">keyMaterial</span><span class="op" id="4635512">[</span><span class="op" id="4635513">:</span><span class="ident" id="4635514">ivLen</span><span class="op" id="4635519">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635522">return</span><br>
<span class="lineno"></span><span class="op" id="4635529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4635532">func</span>&nbsp;<span class="ident" id="4635537">newFinishedHash</span><span class="op" id="4635552">(</span><span class="ident" id="4635553">version</span>&nbsp;<span class="builtintype" id="4635561">uint16</span><span class="op" id="4635567">)</span>&nbsp;<span class="ident" id="4635569">finishedHash</span>&nbsp;<span class="op" id="4635582">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635585">if</span>&nbsp;<span class="ident" id="4635588">version</span>&nbsp;<span class="op" id="4635596">&gt;=</span>&nbsp;<span class="ident" id="4635599">VersionTLS12</span>&nbsp;<span class="op" id="4635612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635616">return</span>&nbsp;<span class="ident" id="4635623">finishedHash</span><span class="op" id="4635635">{</span><span class="ident" id="4635636">sha256</span><span class="op" id="4635642">.</span><span class="ident" id="4635643">New</span><span class="op" id="4635646">(</span><span class="op" id="4635647">)</span><span class="op" id="4635648">,</span>&nbsp;<span class="ident" id="4635650">sha256</span><span class="op" id="4635656">.</span><span class="ident" id="4635657">New</span><span class="op" id="4635660">(</span><span class="op" id="4635661">)</span><span class="op" id="4635662">,</span>&nbsp;<span class="ident" id="4635664">nil</span><span class="op" id="4635667">,</span>&nbsp;<span class="ident" id="4635669">nil</span><span class="op" id="4635672">,</span>&nbsp;<span class="ident" id="4635674">version</span><span class="op" id="4635681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4635684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635687">return</span>&nbsp;<span class="ident" id="4635694">finishedHash</span><span class="op" id="4635706">{</span><span class="ident" id="4635707">sha1</span><span class="op" id="4635711">.</span><span class="ident" id="4635712">New</span><span class="op" id="4635715">(</span><span class="op" id="4635716">)</span><span class="op" id="4635717">,</span>&nbsp;<span class="ident" id="4635719">sha1</span><span class="op" id="4635723">.</span><span class="ident" id="4635724">New</span><span class="op" id="4635727">(</span><span class="op" id="4635728">)</span><span class="op" id="4635729">,</span>&nbsp;<span class="ident" id="4635731">md5</span><span class="op" id="4635734">.</span><span class="ident" id="4635735">New</span><span class="op" id="4635738">(</span><span class="op" id="4635739">)</span><span class="op" id="4635740">,</span>&nbsp;<span class="ident" id="4635742">md5</span><span class="op" id="4635745">.</span><span class="ident" id="4635746">New</span><span class="op" id="4635749">(</span><span class="op" id="4635750">)</span><span class="op" id="4635751">,</span>&nbsp;<span class="ident" id="4635753">version</span><span class="op" id="4635760">}</span><br>
<span class="lineno"></span><span class="op" id="4635762">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4635765">//&nbsp;A&nbsp;finishedHash&nbsp;calculates&nbsp;the&nbsp;hash&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake&nbsp;messages&nbsp;suitable</span><br>
<span class="lineno"></span><span class="comment" id="4635843">//&nbsp;for&nbsp;including&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4635883">type</span>&nbsp;<span class="ident" id="4635888">finishedHash</span>&nbsp;<span class="keyword" id="4635901">struct</span>&nbsp;<span class="op" id="4635908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635911">client</span>&nbsp;<span class="ident" id="4635918">hash</span><span class="op" id="4635922">.</span><span class="ident" id="4635923">Hash</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635929">server</span>&nbsp;<span class="ident" id="4635936">hash</span><span class="op" id="4635940">.</span><span class="ident" id="4635941">Hash</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635948">//&nbsp;Prior&nbsp;to&nbsp;TLS&nbsp;1.2,&nbsp;an&nbsp;additional&nbsp;MD5&nbsp;hash&nbsp;is&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636006">clientMD5</span>&nbsp;<span class="ident" id="4636016">hash</span><span class="op" id="4636020">.</span><span class="ident" id="4636021">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636027">serverMD5</span>&nbsp;<span class="ident" id="4636037">hash</span><span class="op" id="4636041">.</span><span class="ident" id="4636042">Hash</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636049">version</span>&nbsp;<span class="builtintype" id="4636057">uint16</span><br>
<span class="lineno"></span><span class="op" id="4636064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4636067">func</span>&nbsp;<span class="op" id="4636072">(</span><span class="ident" id="4636073">h</span>&nbsp;<span class="ident" id="4636075">finishedHash</span><span class="op" id="4636087">)</span>&nbsp;<span class="ident" id="4636089">Write</span><span class="op" id="4636094">(</span><span class="ident" id="4636095">msg</span>&nbsp;<span class="op" id="4636099">[</span><span class="op" id="4636100">]</span><span class="builtintype" id="4636101">byte</span><span class="op" id="4636105">)</span>&nbsp;<span class="op" id="4636107">(</span><span class="ident" id="4636108">n</span>&nbsp;<span class="builtintype" id="4636110">int</span><span class="op" id="4636113">,</span>&nbsp;<span class="ident" id="4636115">err</span>&nbsp;<span class="builtintype" id="4636119">error</span><span class="op" id="4636124">)</span>&nbsp;<span class="op" id="4636126">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636129">h</span><span class="op" id="4636130">.</span><span class="ident" id="4636131">client</span><span class="op" id="4636137">.</span><span class="ident" id="4636138">Write</span><span class="op" id="4636143">(</span><span class="ident" id="4636144">msg</span><span class="op" id="4636147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636150">h</span><span class="op" id="4636151">.</span><span class="ident" id="4636152">server</span><span class="op" id="4636158">.</span><span class="ident" id="4636159">Write</span><span class="op" id="4636164">(</span><span class="ident" id="4636165">msg</span><span class="op" id="4636168">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636172">if</span>&nbsp;<span class="ident" id="4636175">h</span><span class="op" id="4636176">.</span><span class="ident" id="4636177">version</span>&nbsp;<span class="op" id="4636185">&lt;</span>&nbsp;<span class="ident" id="4636187">VersionTLS12</span>&nbsp;<span class="op" id="4636200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636204">h</span><span class="op" id="4636205">.</span><span class="ident" id="4636206">clientMD5</span><span class="op" id="4636215">.</span><span class="ident" id="4636216">Write</span><span class="op" id="4636221">(</span><span class="ident" id="4636222">msg</span><span class="op" id="4636225">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636229">h</span><span class="op" id="4636230">.</span><span class="ident" id="4636231">serverMD5</span><span class="op" id="4636240">.</span><span class="ident" id="4636241">Write</span><span class="op" id="4636246">(</span><span class="ident" id="4636247">msg</span><span class="op" id="4636250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636256">return</span>&nbsp;<span class="builtinfunc" id="4636263">len</span><span class="op" id="4636266">(</span><span class="ident" id="4636267">msg</span><span class="op" id="4636270">)</span><span class="op" id="4636271">,</span>&nbsp;<span class="ident" id="4636273">nil</span><br>
<span class="lineno"></span><span class="op" id="4636277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4636280">//&nbsp;finishedSum30&nbsp;calculates&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;SSLv3</span><br>
<span class="lineno"></span><span class="comment" id="4636358">//&nbsp;Finished&nbsp;message&nbsp;given&nbsp;the&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hashes&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake</span><br>
<span class="lineno"></span><span class="comment" id="4636430">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="4636443">func</span>&nbsp;<span class="ident" id="4636448">finishedSum30</span><span class="op" id="4636461">(</span><span class="ident" id="4636462">md5</span><span class="op" id="4636465">,</span>&nbsp;<span class="ident" id="4636467">sha1</span>&nbsp;<span class="ident" id="4636472">hash</span><span class="op" id="4636476">.</span><span class="ident" id="4636477">Hash</span><span class="op" id="4636481">,</span>&nbsp;<span class="ident" id="4636483">masterSecret</span>&nbsp;<span class="op" id="4636496">[</span><span class="op" id="4636497">]</span><span class="builtintype" id="4636498">byte</span><span class="op" id="4636502">,</span>&nbsp;<span class="ident" id="4636504">magic</span>&nbsp;<span class="op" id="4636510">[</span><span class="num" id="4636511">4</span><span class="op" id="4636512">]</span><span class="builtintype" id="4636513">byte</span><span class="op" id="4636517">)</span>&nbsp;<span class="op" id="4636519">[</span><span class="op" id="4636520">]</span><span class="builtintype" id="4636521">byte</span>&nbsp;<span class="op" id="4636526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636529">md5</span><span class="op" id="4636532">.</span><span class="ident" id="4636533">Write</span><span class="op" id="4636538">(</span><span class="ident" id="4636539">magic</span><span class="op" id="4636544">[</span><span class="op" id="4636545">:</span><span class="op" id="4636546">]</span><span class="op" id="4636547">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636550">md5</span><span class="op" id="4636553">.</span><span class="ident" id="4636554">Write</span><span class="op" id="4636559">(</span><span class="ident" id="4636560">masterSecret</span><span class="op" id="4636572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636575">md5</span><span class="op" id="4636578">.</span><span class="ident" id="4636579">Write</span><span class="op" id="4636584">(</span><span class="ident" id="4636585">ssl30Pad1</span><span class="op" id="4636594">[</span><span class="op" id="4636595">:</span><span class="op" id="4636596">]</span><span class="op" id="4636597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636600">md5Digest</span>&nbsp;<span class="op" id="4636610">:=</span>&nbsp;<span class="ident" id="4636613">md5</span><span class="op" id="4636616">.</span><span class="ident" id="4636617">Sum</span><span class="op" id="4636620">(</span><span class="ident" id="4636621">nil</span><span class="op" id="4636624">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636628">md5</span><span class="op" id="4636631">.</span><span class="ident" id="4636632">Reset</span><span class="op" id="4636637">(</span><span class="op" id="4636638">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636641">md5</span><span class="op" id="4636644">.</span><span class="ident" id="4636645">Write</span><span class="op" id="4636650">(</span><span class="ident" id="4636651">masterSecret</span><span class="op" id="4636663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636666">md5</span><span class="op" id="4636669">.</span><span class="ident" id="4636670">Write</span><span class="op" id="4636675">(</span><span class="ident" id="4636676">ssl30Pad2</span><span class="op" id="4636685">[</span><span class="op" id="4636686">:</span><span class="op" id="4636687">]</span><span class="op" id="4636688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636691">md5</span><span class="op" id="4636694">.</span><span class="ident" id="4636695">Write</span><span class="op" id="4636700">(</span><span class="ident" id="4636701">md5Digest</span><span class="op" id="4636710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636713">md5Digest</span>&nbsp;<span class="op" id="4636723">=</span>&nbsp;<span class="ident" id="4636725">md5</span><span class="op" id="4636728">.</span><span class="ident" id="4636729">Sum</span><span class="op" id="4636732">(</span><span class="ident" id="4636733">nil</span><span class="op" id="4636736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636740">sha1</span><span class="op" id="4636744">.</span><span class="ident" id="4636745">Write</span><span class="op" id="4636750">(</span><span class="ident" id="4636751">magic</span><span class="op" id="4636756">[</span><span class="op" id="4636757">:</span><span class="op" id="4636758">]</span><span class="op" id="4636759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636762">sha1</span><span class="op" id="4636766">.</span><span class="ident" id="4636767">Write</span><span class="op" id="4636772">(</span><span class="ident" id="4636773">masterSecret</span><span class="op" id="4636785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636788">sha1</span><span class="op" id="4636792">.</span><span class="ident" id="4636793">Write</span><span class="op" id="4636798">(</span><span class="ident" id="4636799">ssl30Pad1</span><span class="op" id="4636808">[</span><span class="op" id="4636809">:</span><span class="num" id="4636810">40</span><span class="op" id="4636812">]</span><span class="op" id="4636813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636816">sha1Digest</span>&nbsp;<span class="op" id="4636827">:=</span>&nbsp;<span class="ident" id="4636830">sha1</span><span class="op" id="4636834">.</span><span class="ident" id="4636835">Sum</span><span class="op" id="4636838">(</span><span class="ident" id="4636839">nil</span><span class="op" id="4636842">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636846">sha1</span><span class="op" id="4636850">.</span><span class="ident" id="4636851">Reset</span><span class="op" id="4636856">(</span><span class="op" id="4636857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636860">sha1</span><span class="op" id="4636864">.</span><span class="ident" id="4636865">Write</span><span class="op" id="4636870">(</span><span class="ident" id="4636871">masterSecret</span><span class="op" id="4636883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636886">sha1</span><span class="op" id="4636890">.</span><span class="ident" id="4636891">Write</span><span class="op" id="4636896">(</span><span class="ident" id="4636897">ssl30Pad2</span><span class="op" id="4636906">[</span><span class="op" id="4636907">:</span><span class="num" id="4636908">40</span><span class="op" id="4636910">]</span><span class="op" id="4636911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636914">sha1</span><span class="op" id="4636918">.</span><span class="ident" id="4636919">Write</span><span class="op" id="4636924">(</span><span class="ident" id="4636925">sha1Digest</span><span class="op" id="4636935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636938">sha1Digest</span>&nbsp;<span class="op" id="4636949">=</span>&nbsp;<span class="ident" id="4636951">sha1</span><span class="op" id="4636955">.</span><span class="ident" id="4636956">Sum</span><span class="op" id="4636959">(</span><span class="ident" id="4636960">nil</span><span class="op" id="4636963">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636967">ret</span>&nbsp;<span class="op" id="4636971">:=</span>&nbsp;<span class="builtinfunc" id="4636974">make</span><span class="op" id="4636978">(</span><span class="op" id="4636979">[</span><span class="op" id="4636980">]</span><span class="builtintype" id="4636981">byte</span><span class="op" id="4636985">,</span>&nbsp;<span class="builtinfunc" id="4636987">len</span><span class="op" id="4636990">(</span><span class="ident" id="4636991">md5Digest</span><span class="op" id="4637000">)</span><span class="op" id="4637001">+</span><span class="builtinfunc" id="4637002">len</span><span class="op" id="4637005">(</span><span class="ident" id="4637006">sha1Digest</span><span class="op" id="4637016">)</span><span class="op" id="4637017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4637020">copy</span><span class="op" id="4637024">(</span><span class="ident" id="4637025">ret</span><span class="op" id="4637028">,</span>&nbsp;<span class="ident" id="4637030">md5Digest</span><span class="op" id="4637039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4637042">copy</span><span class="op" id="4637046">(</span><span class="ident" id="4637047">ret</span><span class="op" id="4637050">[</span><span class="builtinfunc" id="4637051">len</span><span class="op" id="4637054">(</span><span class="ident" id="4637055">md5Digest</span><span class="op" id="4637064">)</span><span class="op" id="4637065">:</span><span class="op" id="4637066">]</span><span class="op" id="4637067">,</span>&nbsp;<span class="ident" id="4637069">sha1Digest</span><span class="op" id="4637079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637082">return</span>&nbsp;<span class="ident" id="4637089">ret</span><br>
<span class="lineno">230</span><span class="op" id="4637093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4637096">var</span>&nbsp;<span class="ident" id="4637100">ssl3ClientFinishedMagic</span>&nbsp;<span class="op" id="4637124">=</span>&nbsp;<span class="op" id="4637126">[</span><span class="num" id="4637127">4</span><span class="op" id="4637128">]</span><span class="builtintype" id="4637129">byte</span><span class="op" id="4637133">{</span><span class="num" id="4637134">0x43</span><span class="op" id="4637138">,</span>&nbsp;<span class="num" id="4637140">0x4c</span><span class="op" id="4637144">,</span>&nbsp;<span class="num" id="4637146">0x4e</span><span class="op" id="4637150">,</span>&nbsp;<span class="num" id="4637152">0x54</span><span class="op" id="4637156">}</span><br>
<span class="lineno"></span><span class="keyword" id="4637158">var</span>&nbsp;<span class="ident" id="4637162">ssl3ServerFinishedMagic</span>&nbsp;<span class="op" id="4637186">=</span>&nbsp;<span class="op" id="4637188">[</span><span class="num" id="4637189">4</span><span class="op" id="4637190">]</span><span class="builtintype" id="4637191">byte</span><span class="op" id="4637195">{</span><span class="num" id="4637196">0x53</span><span class="op" id="4637200">,</span>&nbsp;<span class="num" id="4637202">0x52</span><span class="op" id="4637206">,</span>&nbsp;<span class="num" id="4637208">0x56</span><span class="op" id="4637212">,</span>&nbsp;<span class="num" id="4637214">0x52</span><span class="op" id="4637218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4637221">//&nbsp;clientSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4637295">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4637316">func</span>&nbsp;<span class="op" id="4637321">(</span><span class="ident" id="4637322">h</span>&nbsp;<span class="ident" id="4637324">finishedHash</span><span class="op" id="4637336">)</span>&nbsp;<span class="ident" id="4637338">clientSum</span><span class="op" id="4637347">(</span><span class="ident" id="4637348">masterSecret</span>&nbsp;<span class="op" id="4637361">[</span><span class="op" id="4637362">]</span><span class="builtintype" id="4637363">byte</span><span class="op" id="4637367">)</span>&nbsp;<span class="op" id="4637369">[</span><span class="op" id="4637370">]</span><span class="builtintype" id="4637371">byte</span>&nbsp;<span class="op" id="4637376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637379">if</span>&nbsp;<span class="ident" id="4637382">h</span><span class="op" id="4637383">.</span><span class="ident" id="4637384">version</span>&nbsp;<span class="op" id="4637392">==</span>&nbsp;<span class="ident" id="4637395">VersionSSL30</span>&nbsp;<span class="op" id="4637408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637412">return</span>&nbsp;<span class="ident" id="4637419">finishedSum30</span><span class="op" id="4637432">(</span><span class="ident" id="4637433">h</span><span class="op" id="4637434">.</span><span class="ident" id="4637435">clientMD5</span><span class="op" id="4637444">,</span>&nbsp;<span class="ident" id="4637446">h</span><span class="op" id="4637447">.</span><span class="ident" id="4637448">client</span><span class="op" id="4637454">,</span>&nbsp;<span class="ident" id="4637456">masterSecret</span><span class="op" id="4637468">,</span>&nbsp;<span class="ident" id="4637470">ssl3ClientFinishedMagic</span><span class="op" id="4637493">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637500">out</span>&nbsp;<span class="op" id="4637504">:=</span>&nbsp;<span class="builtinfunc" id="4637507">make</span><span class="op" id="4637511">(</span><span class="op" id="4637512">[</span><span class="op" id="4637513">]</span><span class="builtintype" id="4637514">byte</span><span class="op" id="4637518">,</span>&nbsp;<span class="ident" id="4637520">finishedVerifyLength</span><span class="op" id="4637540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637543">if</span>&nbsp;<span class="ident" id="4637546">h</span><span class="op" id="4637547">.</span><span class="ident" id="4637548">version</span>&nbsp;<span class="op" id="4637556">&gt;=</span>&nbsp;<span class="ident" id="4637559">VersionTLS12</span>&nbsp;<span class="op" id="4637572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637576">seed</span>&nbsp;<span class="op" id="4637581">:=</span>&nbsp;<span class="ident" id="4637584">h</span><span class="op" id="4637585">.</span><span class="ident" id="4637586">client</span><span class="op" id="4637592">.</span><span class="ident" id="4637593">Sum</span><span class="op" id="4637596">(</span><span class="ident" id="4637597">nil</span><span class="op" id="4637600">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637604">prf12</span><span class="op" id="4637609">(</span><span class="ident" id="4637610">out</span><span class="op" id="4637613">,</span>&nbsp;<span class="ident" id="4637615">masterSecret</span><span class="op" id="4637627">,</span>&nbsp;<span class="ident" id="4637629">clientFinishedLabel</span><span class="op" id="4637648">,</span>&nbsp;<span class="ident" id="4637650">seed</span><span class="op" id="4637654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637657">}</span>&nbsp;<span class="keyword" id="4637659">else</span>&nbsp;<span class="op" id="4637664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637668">seed</span>&nbsp;<span class="op" id="4637673">:=</span>&nbsp;<span class="builtinfunc" id="4637676">make</span><span class="op" id="4637680">(</span><span class="op" id="4637681">[</span><span class="op" id="4637682">]</span><span class="builtintype" id="4637683">byte</span><span class="op" id="4637687">,</span>&nbsp;<span class="num" id="4637689">0</span><span class="op" id="4637690">,</span>&nbsp;<span class="ident" id="4637692">md5</span><span class="op" id="4637695">.</span><span class="ident" id="4637696">Size</span><span class="op" id="4637700">+</span><span class="ident" id="4637701">sha1</span><span class="op" id="4637705">.</span><span class="ident" id="4637706">Size</span><span class="op" id="4637710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637714">seed</span>&nbsp;<span class="op" id="4637719">=</span>&nbsp;<span class="ident" id="4637721">h</span><span class="op" id="4637722">.</span><span class="ident" id="4637723">clientMD5</span><span class="op" id="4637732">.</span><span class="ident" id="4637733">Sum</span><span class="op" id="4637736">(</span><span class="ident" id="4637737">seed</span><span class="op" id="4637741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637745">seed</span>&nbsp;<span class="op" id="4637750">=</span>&nbsp;<span class="ident" id="4637752">h</span><span class="op" id="4637753">.</span><span class="ident" id="4637754">client</span><span class="op" id="4637760">.</span><span class="ident" id="4637761">Sum</span><span class="op" id="4637764">(</span><span class="ident" id="4637765">seed</span><span class="op" id="4637769">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637773">prf10</span><span class="op" id="4637778">(</span><span class="ident" id="4637779">out</span><span class="op" id="4637782">,</span>&nbsp;<span class="ident" id="4637784">masterSecret</span><span class="op" id="4637796">,</span>&nbsp;<span class="ident" id="4637798">clientFinishedLabel</span><span class="op" id="4637817">,</span>&nbsp;<span class="ident" id="4637819">seed</span><span class="op" id="4637823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637829">return</span>&nbsp;<span class="ident" id="4637836">out</span><br>
<span class="lineno"></span><span class="op" id="4637840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="4637843">//&nbsp;serverSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4637917">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4637938">func</span>&nbsp;<span class="op" id="4637943">(</span><span class="ident" id="4637944">h</span>&nbsp;<span class="ident" id="4637946">finishedHash</span><span class="op" id="4637958">)</span>&nbsp;<span class="ident" id="4637960">serverSum</span><span class="op" id="4637969">(</span><span class="ident" id="4637970">masterSecret</span>&nbsp;<span class="op" id="4637983">[</span><span class="op" id="4637984">]</span><span class="builtintype" id="4637985">byte</span><span class="op" id="4637989">)</span>&nbsp;<span class="op" id="4637991">[</span><span class="op" id="4637992">]</span><span class="builtintype" id="4637993">byte</span>&nbsp;<span class="op" id="4637998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638001">if</span>&nbsp;<span class="ident" id="4638004">h</span><span class="op" id="4638005">.</span><span class="ident" id="4638006">version</span>&nbsp;<span class="op" id="4638014">==</span>&nbsp;<span class="ident" id="4638017">VersionSSL30</span>&nbsp;<span class="op" id="4638030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638034">return</span>&nbsp;<span class="ident" id="4638041">finishedSum30</span><span class="op" id="4638054">(</span><span class="ident" id="4638055">h</span><span class="op" id="4638056">.</span><span class="ident" id="4638057">serverMD5</span><span class="op" id="4638066">,</span>&nbsp;<span class="ident" id="4638068">h</span><span class="op" id="4638069">.</span><span class="ident" id="4638070">server</span><span class="op" id="4638076">,</span>&nbsp;<span class="ident" id="4638078">masterSecret</span><span class="op" id="4638090">,</span>&nbsp;<span class="ident" id="4638092">ssl3ServerFinishedMagic</span><span class="op" id="4638115">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638122">out</span>&nbsp;<span class="op" id="4638126">:=</span>&nbsp;<span class="builtinfunc" id="4638129">make</span><span class="op" id="4638133">(</span><span class="op" id="4638134">[</span><span class="op" id="4638135">]</span><span class="builtintype" id="4638136">byte</span><span class="op" id="4638140">,</span>&nbsp;<span class="ident" id="4638142">finishedVerifyLength</span><span class="op" id="4638162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638165">if</span>&nbsp;<span class="ident" id="4638168">h</span><span class="op" id="4638169">.</span><span class="ident" id="4638170">version</span>&nbsp;<span class="op" id="4638178">&gt;=</span>&nbsp;<span class="ident" id="4638181">VersionTLS12</span>&nbsp;<span class="op" id="4638194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638198">seed</span>&nbsp;<span class="op" id="4638203">:=</span>&nbsp;<span class="ident" id="4638206">h</span><span class="op" id="4638207">.</span><span class="ident" id="4638208">server</span><span class="op" id="4638214">.</span><span class="ident" id="4638215">Sum</span><span class="op" id="4638218">(</span><span class="ident" id="4638219">nil</span><span class="op" id="4638222">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638226">prf12</span><span class="op" id="4638231">(</span><span class="ident" id="4638232">out</span><span class="op" id="4638235">,</span>&nbsp;<span class="ident" id="4638237">masterSecret</span><span class="op" id="4638249">,</span>&nbsp;<span class="ident" id="4638251">serverFinishedLabel</span><span class="op" id="4638270">,</span>&nbsp;<span class="ident" id="4638272">seed</span><span class="op" id="4638276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638279">}</span>&nbsp;<span class="keyword" id="4638281">else</span>&nbsp;<span class="op" id="4638286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638290">seed</span>&nbsp;<span class="op" id="4638295">:=</span>&nbsp;<span class="builtinfunc" id="4638298">make</span><span class="op" id="4638302">(</span><span class="op" id="4638303">[</span><span class="op" id="4638304">]</span><span class="builtintype" id="4638305">byte</span><span class="op" id="4638309">,</span>&nbsp;<span class="num" id="4638311">0</span><span class="op" id="4638312">,</span>&nbsp;<span class="ident" id="4638314">md5</span><span class="op" id="4638317">.</span><span class="ident" id="4638318">Size</span><span class="op" id="4638322">+</span><span class="ident" id="4638323">sha1</span><span class="op" id="4638327">.</span><span class="ident" id="4638328">Size</span><span class="op" id="4638332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638336">seed</span>&nbsp;<span class="op" id="4638341">=</span>&nbsp;<span class="ident" id="4638343">h</span><span class="op" id="4638344">.</span><span class="ident" id="4638345">serverMD5</span><span class="op" id="4638354">.</span><span class="ident" id="4638355">Sum</span><span class="op" id="4638358">(</span><span class="ident" id="4638359">seed</span><span class="op" id="4638363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638367">seed</span>&nbsp;<span class="op" id="4638372">=</span>&nbsp;<span class="ident" id="4638374">h</span><span class="op" id="4638375">.</span><span class="ident" id="4638376">server</span><span class="op" id="4638382">.</span><span class="ident" id="4638383">Sum</span><span class="op" id="4638386">(</span><span class="ident" id="4638387">seed</span><span class="op" id="4638391">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638395">prf10</span><span class="op" id="4638400">(</span><span class="ident" id="4638401">out</span><span class="op" id="4638404">,</span>&nbsp;<span class="ident" id="4638406">masterSecret</span><span class="op" id="4638418">,</span>&nbsp;<span class="ident" id="4638420">serverFinishedLabel</span><span class="op" id="4638439">,</span>&nbsp;<span class="ident" id="4638441">seed</span><span class="op" id="4638445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638451">return</span>&nbsp;<span class="ident" id="4638458">out</span><br>
<span class="lineno"></span><span class="op" id="4638462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment" id="4638465">//&nbsp;hashForClientCertificate&nbsp;returns&nbsp;a&nbsp;digest,&nbsp;hash&nbsp;function,&nbsp;and&nbsp;TLS&nbsp;1.2&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4638543">//&nbsp;id&nbsp;suitable&nbsp;for&nbsp;signing&nbsp;by&nbsp;a&nbsp;TLS&nbsp;client&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4638599">func</span>&nbsp;<span class="op" id="4638604">(</span><span class="ident" id="4638605">h</span>&nbsp;<span class="ident" id="4638607">finishedHash</span><span class="op" id="4638619">)</span>&nbsp;<span class="ident" id="4638621">hashForClientCertificate</span><span class="op" id="4638645">(</span><span class="ident" id="4638646">sigType</span>&nbsp;<span class="builtintype" id="4638654">uint8</span><span class="op" id="4638659">)</span>&nbsp;<span class="op" id="4638661">(</span><span class="op" id="4638662">[</span><span class="op" id="4638663">]</span><span class="builtintype" id="4638664">byte</span><span class="op" id="4638668">,</span>&nbsp;<span class="ident" id="4638670">crypto</span><span class="op" id="4638676">.</span><span class="ident" id="4638677">Hash</span><span class="op" id="4638681">,</span>&nbsp;<span class="builtintype" id="4638683">uint8</span><span class="op" id="4638688">)</span>&nbsp;<span class="op" id="4638690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638693">if</span>&nbsp;<span class="ident" id="4638696">h</span><span class="op" id="4638697">.</span><span class="ident" id="4638698">version</span>&nbsp;<span class="op" id="4638706">&gt;=</span>&nbsp;<span class="ident" id="4638709">VersionTLS12</span>&nbsp;<span class="op" id="4638722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638726">digest</span>&nbsp;<span class="op" id="4638733">:=</span>&nbsp;<span class="ident" id="4638736">h</span><span class="op" id="4638737">.</span><span class="ident" id="4638738">server</span><span class="op" id="4638744">.</span><span class="ident" id="4638745">Sum</span><span class="op" id="4638748">(</span><span class="ident" id="4638749">nil</span><span class="op" id="4638752">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638756">return</span>&nbsp;<span class="ident" id="4638763">digest</span><span class="op" id="4638769">,</span>&nbsp;<span class="ident" id="4638771">crypto</span><span class="op" id="4638777">.</span><span class="ident" id="4638778">SHA256</span><span class="op" id="4638784">,</span>&nbsp;<span class="ident" id="4638786">hashSHA256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638801">if</span>&nbsp;<span class="ident" id="4638804">sigType</span>&nbsp;<span class="op" id="4638812">==</span>&nbsp;<span class="ident" id="4638815">signatureECDSA</span>&nbsp;<span class="op" id="4638830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638834">digest</span>&nbsp;<span class="op" id="4638841">:=</span>&nbsp;<span class="ident" id="4638844">h</span><span class="op" id="4638845">.</span><span class="ident" id="4638846">server</span><span class="op" id="4638852">.</span><span class="ident" id="4638853">Sum</span><span class="op" id="4638856">(</span><span class="ident" id="4638857">nil</span><span class="op" id="4638860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638864">return</span>&nbsp;<span class="ident" id="4638871">digest</span><span class="op" id="4638877">,</span>&nbsp;<span class="ident" id="4638879">crypto</span><span class="op" id="4638885">.</span><span class="ident" id="4638886">SHA1</span><span class="op" id="4638890">,</span>&nbsp;<span class="ident" id="4638892">hashSHA1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638906">digest</span>&nbsp;<span class="op" id="4638913">:=</span>&nbsp;<span class="builtinfunc" id="4638916">make</span><span class="op" id="4638920">(</span><span class="op" id="4638921">[</span><span class="op" id="4638922">]</span><span class="builtintype" id="4638923">byte</span><span class="op" id="4638927">,</span>&nbsp;<span class="num" id="4638929">0</span><span class="op" id="4638930">,</span>&nbsp;<span class="num" id="4638932">36</span><span class="op" id="4638934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638937">digest</span>&nbsp;<span class="op" id="4638944">=</span>&nbsp;<span class="ident" id="4638946">h</span><span class="op" id="4638947">.</span><span class="ident" id="4638948">serverMD5</span><span class="op" id="4638957">.</span><span class="ident" id="4638958">Sum</span><span class="op" id="4638961">(</span><span class="ident" id="4638962">digest</span><span class="op" id="4638968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638971">digest</span>&nbsp;<span class="op" id="4638978">=</span>&nbsp;<span class="ident" id="4638980">h</span><span class="op" id="4638981">.</span><span class="ident" id="4638982">server</span><span class="op" id="4638988">.</span><span class="ident" id="4638989">Sum</span><span class="op" id="4638992">(</span><span class="ident" id="4638993">digest</span><span class="op" id="4638999">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639002">return</span>&nbsp;<span class="ident" id="4639009">digest</span><span class="op" id="4639015">,</span>&nbsp;<span class="ident" id="4639017">crypto</span><span class="op" id="4639023">.</span><span class="ident" id="4639024">MD5SHA1</span><span class="op" id="4639031">,</span>&nbsp;<span class="num" id="4639033">0</span>&nbsp;<span class="comment" id="4639035">/*&nbsp;not&nbsp;specified&nbsp;in&nbsp;TLS&nbsp;1.2.&nbsp;*/</span><br>
<span class="lineno"></span><span class="op" id="4639067">}</span>
</div>
</body>
</html>
