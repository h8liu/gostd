<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html" class="current">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2562323">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2562379">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2562433">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2562484">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2562549">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2562577">package</span>&nbsp;<span class="ident" id="2562585">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2562594">import</span>&nbsp;<span class="string" id="2562601">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2562611">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2562674">func</span>&nbsp;<span class="ident" id="2562679">cmsgAlignOf</span><span class="op" id="2562690">(</span><span class="ident" id="2562691">salen</span>&nbsp;<span class="builtintype" id="2562697">int</span><span class="op" id="2562700">)</span>&nbsp;<span class="builtintype" id="2562702">int</span>&nbsp;<span class="op" id="2562706">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2562709">salign</span>&nbsp;<span class="op" id="2562716">:=</span>&nbsp;<span class="ident" id="2562719">sizeofPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2562730">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2562794">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2562856">if</span>&nbsp;<span class="ident" id="2562859">darwin64Bit</span>&nbsp;<span class="op" id="2562871">||</span>&nbsp;<span class="ident" id="2562874">dragonfly64Bit</span>&nbsp;<span class="op" id="2562889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2562893">salign</span>&nbsp;<span class="op" id="2562900">=</span>&nbsp;<span class="num" id="2562902">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2562905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2562908">return</span>&nbsp;<span class="op" id="2562915">(</span><span class="ident" id="2562916">salen</span>&nbsp;<span class="op" id="2562922">+</span>&nbsp;<span class="ident" id="2562924">salign</span>&nbsp;<span class="op" id="2562931">-</span>&nbsp;<span class="num" id="2562933">1</span><span class="op" id="2562934">)</span>&nbsp;<span class="op" id="2562936">&amp;</span>&nbsp;<span class="op" id="2562938">^</span><span class="op" id="2562939">(</span><span class="ident" id="2562940">salign</span>&nbsp;<span class="op" id="2562947">-</span>&nbsp;<span class="num" id="2562949">1</span><span class="op" id="2562950">)</span><br>
<span class="lineno"></span><span class="op" id="2562952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2562955">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="2563025">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="2563084">func</span>&nbsp;<span class="ident" id="2563089">CmsgLen</span><span class="op" id="2563096">(</span><span class="ident" id="2563097">datalen</span>&nbsp;<span class="builtintype" id="2563105">int</span><span class="op" id="2563108">)</span>&nbsp;<span class="builtintype" id="2563110">int</span>&nbsp;<span class="op" id="2563114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2563117">return</span>&nbsp;<span class="ident" id="2563124">cmsgAlignOf</span><span class="op" id="2563135">(</span><span class="ident" id="2563136">SizeofCmsghdr</span><span class="op" id="2563149">)</span>&nbsp;<span class="op" id="2563151">+</span>&nbsp;<span class="ident" id="2563153">datalen</span><br>
<span class="lineno"></span><span class="op" id="2563161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2563164">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2563231">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="2563278">func</span>&nbsp;<span class="ident" id="2563283">CmsgSpace</span><span class="op" id="2563292">(</span><span class="ident" id="2563293">datalen</span>&nbsp;<span class="builtintype" id="2563301">int</span><span class="op" id="2563304">)</span>&nbsp;<span class="builtintype" id="2563306">int</span>&nbsp;<span class="op" id="2563310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2563313">return</span>&nbsp;<span class="ident" id="2563320">cmsgAlignOf</span><span class="op" id="2563331">(</span><span class="ident" id="2563332">SizeofCmsghdr</span><span class="op" id="2563345">)</span>&nbsp;<span class="op" id="2563347">+</span>&nbsp;<span class="ident" id="2563349">cmsgAlignOf</span><span class="op" id="2563360">(</span><span class="ident" id="2563361">datalen</span><span class="op" id="2563368">)</span><br>
<span class="lineno"></span><span class="op" id="2563370">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2563373">func</span>&nbsp;<span class="ident" id="2563378">cmsgData</span><span class="op" id="2563386">(</span><span class="ident" id="2563387">h</span>&nbsp;<span class="op" id="2563389">*</span><span class="ident" id="2563390">Cmsghdr</span><span class="op" id="2563397">)</span>&nbsp;<span class="ident" id="2563399">unsafe</span><span class="op" id="2563405">.</span><span class="ident" id="2563406">Pointer</span>&nbsp;<span class="op" id="2563414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2563417">return</span>&nbsp;<span class="ident" id="2563424">unsafe</span><span class="op" id="2563430">.</span><span class="ident" id="2563431">Pointer</span><span class="op" id="2563438">(</span><span class="builtintype" id="2563439">uintptr</span><span class="op" id="2563446">(</span><span class="ident" id="2563447">unsafe</span><span class="op" id="2563453">.</span><span class="ident" id="2563454">Pointer</span><span class="op" id="2563461">(</span><span class="ident" id="2563462">h</span><span class="op" id="2563463">)</span><span class="op" id="2563464">)</span>&nbsp;<span class="op" id="2563466">+</span>&nbsp;<span class="builtintype" id="2563468">uintptr</span><span class="op" id="2563475">(</span><span class="ident" id="2563476">cmsgAlignOf</span><span class="op" id="2563487">(</span><span class="ident" id="2563488">SizeofCmsghdr</span><span class="op" id="2563501">)</span><span class="op" id="2563502">)</span><span class="op" id="2563503">)</span><br>
<span class="lineno"></span><span class="op" id="2563505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2563508">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2563569">type</span>&nbsp;<span class="ident" id="2563574">SocketControlMessage</span>&nbsp;<span class="keyword" id="2563595">struct</span>&nbsp;<span class="op" id="2563602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2563605">Header</span>&nbsp;<span class="ident" id="2563612">Cmsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2563621">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2563628">[</span><span class="op" id="2563629">]</span><span class="builtintype" id="2563630">byte</span><br>
<span class="lineno"></span><span class="op" id="2563635">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2563638">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2563706">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="2563719">func</span>&nbsp;<span class="ident" id="2563724">ParseSocketControlMessage</span><span class="op" id="2563749">(</span><span class="ident" id="2563750">b</span>&nbsp;<span class="op" id="2563752">[</span><span class="op" id="2563753">]</span><span class="builtintype" id="2563754">byte</span><span class="op" id="2563758">)</span>&nbsp;<span class="op" id="2563760">(</span><span class="op" id="2563761">[</span><span class="op" id="2563762">]</span><span class="ident" id="2563763">SocketControlMessage</span><span class="op" id="2563783">,</span>&nbsp;<span class="builtintype" id="2563785">error</span><span class="op" id="2563790">)</span>&nbsp;<span class="op" id="2563792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2563795">var</span>&nbsp;<span class="ident" id="2563799">msgs</span>&nbsp;<span class="op" id="2563804">[</span><span class="op" id="2563805">]</span><span class="ident" id="2563806">SocketControlMessage</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2563828">i</span>&nbsp;<span class="op" id="2563830">:=</span>&nbsp;<span class="num" id="2563833">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2563836">for</span>&nbsp;<span class="ident" id="2563840">i</span><span class="op" id="2563841">+</span><span class="ident" id="2563842">CmsgLen</span><span class="op" id="2563849">(</span><span class="num" id="2563850">0</span><span class="op" id="2563851">)</span>&nbsp;<span class="op" id="2563853">&lt;=</span>&nbsp;<span class="builtinfunc" id="2563856">len</span><span class="op" id="2563859">(</span><span class="ident" id="2563860">b</span><span class="op" id="2563861">)</span>&nbsp;<span class="op" id="2563863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2563867">h</span><span class="op" id="2563868">,</span>&nbsp;<span class="ident" id="2563870">dbuf</span><span class="op" id="2563874">,</span>&nbsp;<span class="ident" id="2563876">err</span>&nbsp;<span class="op" id="2563880">:=</span>&nbsp;<span class="ident" id="2563883">socketControlMessageHeaderAndData</span><span class="op" id="2563916">(</span><span class="ident" id="2563917">b</span><span class="op" id="2563918">[</span><span class="ident" id="2563919">i</span><span class="op" id="2563920">:</span><span class="op" id="2563921">]</span><span class="op" id="2563922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2563926">if</span>&nbsp;<span class="ident" id="2563929">err</span>&nbsp;<span class="op" id="2563933">!=</span>&nbsp;<span class="ident" id="2563936">nil</span>&nbsp;<span class="op" id="2563940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2563945">return</span>&nbsp;<span class="ident" id="2563952">nil</span><span class="op" id="2563955">,</span>&nbsp;<span class="ident" id="2563957">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2563963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2563967">m</span>&nbsp;<span class="op" id="2563969">:=</span>&nbsp;<span class="ident" id="2563972">SocketControlMessage</span><span class="op" id="2563992">{</span><span class="ident" id="2563993">Header</span><span class="op" id="2563999">:</span>&nbsp;<span class="op" id="2564001">*</span><span class="ident" id="2564002">h</span><span class="op" id="2564003">,</span>&nbsp;<span class="ident" id="2564005">Data</span><span class="op" id="2564009">:</span>&nbsp;<span class="ident" id="2564011">dbuf</span><span class="op" id="2564015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2564019">msgs</span>&nbsp;<span class="op" id="2564024">=</span>&nbsp;<span class="builtinfunc" id="2564026">append</span><span class="op" id="2564032">(</span><span class="ident" id="2564033">msgs</span><span class="op" id="2564037">,</span>&nbsp;<span class="ident" id="2564039">m</span><span class="op" id="2564040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2564044">i</span>&nbsp;<span class="op" id="2564046">+=</span>&nbsp;<span class="ident" id="2564049">cmsgAlignOf</span><span class="op" id="2564060">(</span><span class="builtintype" id="2564061">int</span><span class="op" id="2564064">(</span><span class="ident" id="2564065">h</span><span class="op" id="2564066">.</span><span class="ident" id="2564067">Len</span><span class="op" id="2564070">)</span><span class="op" id="2564071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2564074">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2564077">return</span>&nbsp;<span class="ident" id="2564084">msgs</span><span class="op" id="2564088">,</span>&nbsp;<span class="ident" id="2564090">nil</span><br>
<span class="lineno"></span><span class="op" id="2564094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2564097">func</span>&nbsp;<span class="ident" id="2564102">socketControlMessageHeaderAndData</span><span class="op" id="2564135">(</span><span class="ident" id="2564136">b</span>&nbsp;<span class="op" id="2564138">[</span><span class="op" id="2564139">]</span><span class="builtintype" id="2564140">byte</span><span class="op" id="2564144">)</span>&nbsp;<span class="op" id="2564146">(</span><span class="op" id="2564147">*</span><span class="ident" id="2564148">Cmsghdr</span><span class="op" id="2564155">,</span>&nbsp;<span class="op" id="2564157">[</span><span class="op" id="2564158">]</span><span class="builtintype" id="2564159">byte</span><span class="op" id="2564163">,</span>&nbsp;<span class="builtintype" id="2564165">error</span><span class="op" id="2564170">)</span>&nbsp;<span class="op" id="2564172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2564175">h</span>&nbsp;<span class="op" id="2564177">:=</span>&nbsp;<span class="op" id="2564180">(</span><span class="op" id="2564181">*</span><span class="ident" id="2564182">Cmsghdr</span><span class="op" id="2564189">)</span><span class="op" id="2564190">(</span><span class="ident" id="2564191">unsafe</span><span class="op" id="2564197">.</span><span class="ident" id="2564198">Pointer</span><span class="op" id="2564205">(</span><span class="op" id="2564206">&amp;</span><span class="ident" id="2564207">b</span><span class="op" id="2564208">[</span><span class="num" id="2564209">0</span><span class="op" id="2564210">]</span><span class="op" id="2564211">)</span><span class="op" id="2564212">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2564215">if</span>&nbsp;<span class="ident" id="2564218">h</span><span class="op" id="2564219">.</span><span class="ident" id="2564220">Len</span>&nbsp;<span class="op" id="2564224">&lt;</span>&nbsp;<span class="ident" id="2564226">SizeofCmsghdr</span>&nbsp;<span class="op" id="2564240">||</span>&nbsp;<span class="builtintype" id="2564243">int</span><span class="op" id="2564246">(</span><span class="ident" id="2564247">h</span><span class="op" id="2564248">.</span><span class="ident" id="2564249">Len</span><span class="op" id="2564252">)</span>&nbsp;<span class="op" id="2564254">&gt;</span>&nbsp;<span class="builtinfunc" id="2564256">len</span><span class="op" id="2564259">(</span><span class="ident" id="2564260">b</span><span class="op" id="2564261">)</span>&nbsp;<span class="op" id="2564263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2564267">return</span>&nbsp;<span class="ident" id="2564274">nil</span><span class="op" id="2564277">,</span>&nbsp;<span class="ident" id="2564279">nil</span><span class="op" id="2564282">,</span>&nbsp;<span class="ident" id="2564284">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2564292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2564295">return</span>&nbsp;<span class="ident" id="2564302">h</span><span class="op" id="2564303">,</span>&nbsp;<span class="ident" id="2564305">b</span><span class="op" id="2564306">[</span><span class="ident" id="2564307">cmsgAlignOf</span><span class="op" id="2564318">(</span><span class="ident" id="2564319">SizeofCmsghdr</span><span class="op" id="2564332">)</span><span class="op" id="2564333">:</span><span class="ident" id="2564334">h</span><span class="op" id="2564335">.</span><span class="ident" id="2564336">Len</span><span class="op" id="2564339">]</span><span class="op" id="2564340">,</span>&nbsp;<span class="ident" id="2564342">nil</span><br>
<span class="lineno"></span><span class="op" id="2564346">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2564349">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="2564416">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2564467">func</span>&nbsp;<span class="ident" id="2564472">UnixRights</span><span class="op" id="2564482">(</span><span class="ident" id="2564483">fds</span>&nbsp;<span class="op" id="2564487">...</span><span class="builtintype" id="2564490">int</span><span class="op" id="2564493">)</span>&nbsp;<span class="op" id="2564495">[</span><span class="op" id="2564496">]</span><span class="builtintype" id="2564497">byte</span>&nbsp;<span class="op" id="2564502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2564505">datalen</span>&nbsp;<span class="op" id="2564513">:=</span>&nbsp;<span class="builtinfunc" id="2564516">len</span><span class="op" id="2564519">(</span><span class="ident" id="2564520">fds</span><span class="op" id="2564523">)</span>&nbsp;<span class="op" id="2564525">*</span>&nbsp;<span class="num" id="2564527">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2564530">b</span>&nbsp;<span class="op" id="2564532">:=</span>&nbsp;<span class="builtinfunc" id="2564535">make</span><span class="op" id="2564539">(</span><span class="op" id="2564540">[</span><span class="op" id="2564541">]</span><span class="builtintype" id="2564542">byte</span><span class="op" id="2564546">,</span>&nbsp;<span class="ident" id="2564548">CmsgSpace</span><span class="op" id="2564557">(</span><span class="ident" id="2564558">datalen</span><span class="op" id="2564565">)</span><span class="op" id="2564566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2564569">h</span>&nbsp;<span class="op" id="2564571">:=</span>&nbsp;<span class="op" id="2564574">(</span><span class="op" id="2564575">*</span><span class="ident" id="2564576">Cmsghdr</span><span class="op" id="2564583">)</span><span class="op" id="2564584">(</span><span class="ident" id="2564585">unsafe</span><span class="op" id="2564591">.</span><span class="ident" id="2564592">Pointer</span><span class="op" id="2564599">(</span><span class="op" id="2564600">&amp;</span><span class="ident" id="2564601">b</span><span class="op" id="2564602">[</span><span class="num" id="2564603">0</span><span class="op" id="2564604">]</span><span class="op" id="2564605">)</span><span class="op" id="2564606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2564609">h</span><span class="op" id="2564610">.</span><span class="ident" id="2564611">Level</span>&nbsp;<span class="op" id="2564617">=</span>&nbsp;<span class="ident" id="2564619">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2564631">h</span><span class="op" id="2564632">.</span><span class="ident" id="2564633">Type</span>&nbsp;<span class="op" id="2564638">=</span>&nbsp;<span class="ident" id="2564640">SCM_RIGHTS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2564652">h</span><span class="op" id="2564653">.</span><span class="ident" id="2564654">SetLen</span><span class="op" id="2564660">(</span><span class="ident" id="2564661">CmsgLen</span><span class="op" id="2564668">(</span><span class="ident" id="2564669">datalen</span><span class="op" id="2564676">)</span><span class="op" id="2564677">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2564680">data</span>&nbsp;<span class="op" id="2564685">:=</span>&nbsp;<span class="builtintype" id="2564688">uintptr</span><span class="op" id="2564695">(</span><span class="ident" id="2564696">cmsgData</span><span class="op" id="2564704">(</span><span class="ident" id="2564705">h</span><span class="op" id="2564706">)</span><span class="op" id="2564707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2564710">for</span>&nbsp;<span class="ident" id="2564714">_</span><span class="op" id="2564715">,</span>&nbsp;<span class="ident" id="2564717">fd</span>&nbsp;<span class="op" id="2564720">:=</span>&nbsp;<span class="keyword" id="2564723">range</span>&nbsp;<span class="ident" id="2564729">fds</span>&nbsp;<span class="op" id="2564733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2564737">*</span><span class="op" id="2564738">(</span><span class="op" id="2564739">*</span><span class="builtintype" id="2564740">int32</span><span class="op" id="2564745">)</span><span class="op" id="2564746">(</span><span class="ident" id="2564747">unsafe</span><span class="op" id="2564753">.</span><span class="ident" id="2564754">Pointer</span><span class="op" id="2564761">(</span><span class="ident" id="2564762">data</span><span class="op" id="2564766">)</span><span class="op" id="2564767">)</span>&nbsp;<span class="op" id="2564769">=</span>&nbsp;<span class="builtintype" id="2564771">int32</span><span class="op" id="2564776">(</span><span class="ident" id="2564777">fd</span><span class="op" id="2564779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2564783">data</span>&nbsp;<span class="op" id="2564788">+=</span>&nbsp;<span class="num" id="2564791">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2564794">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2564797">return</span>&nbsp;<span class="ident" id="2564804">b</span><br>
<span class="lineno"></span><span class="op" id="2564806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2564809">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2564878">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="2564942">func</span>&nbsp;<span class="ident" id="2564947">ParseUnixRights</span><span class="op" id="2564962">(</span><span class="ident" id="2564963">m</span>&nbsp;<span class="op" id="2564965">*</span><span class="ident" id="2564966">SocketControlMessage</span><span class="op" id="2564986">)</span>&nbsp;<span class="op" id="2564988">(</span><span class="op" id="2564989">[</span><span class="op" id="2564990">]</span><span class="builtintype" id="2564991">int</span><span class="op" id="2564994">,</span>&nbsp;<span class="builtintype" id="2564996">error</span><span class="op" id="2565001">)</span>&nbsp;<span class="op" id="2565003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2565006">if</span>&nbsp;<span class="ident" id="2565009">m</span><span class="op" id="2565010">.</span><span class="ident" id="2565011">Header</span><span class="op" id="2565017">.</span><span class="ident" id="2565018">Level</span>&nbsp;<span class="op" id="2565024">!=</span>&nbsp;<span class="ident" id="2565027">SOL_SOCKET</span>&nbsp;<span class="op" id="2565038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2565042">return</span>&nbsp;<span class="ident" id="2565049">nil</span><span class="op" id="2565052">,</span>&nbsp;<span class="ident" id="2565054">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2565062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2565065">if</span>&nbsp;<span class="ident" id="2565068">m</span><span class="op" id="2565069">.</span><span class="ident" id="2565070">Header</span><span class="op" id="2565076">.</span><span class="ident" id="2565077">Type</span>&nbsp;<span class="op" id="2565082">!=</span>&nbsp;<span class="ident" id="2565085">SCM_RIGHTS</span>&nbsp;<span class="op" id="2565096">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2565100">return</span>&nbsp;<span class="ident" id="2565107">nil</span><span class="op" id="2565110">,</span>&nbsp;<span class="ident" id="2565112">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2565120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2565123">fds</span>&nbsp;<span class="op" id="2565127">:=</span>&nbsp;<span class="builtinfunc" id="2565130">make</span><span class="op" id="2565134">(</span><span class="op" id="2565135">[</span><span class="op" id="2565136">]</span><span class="builtintype" id="2565137">int</span><span class="op" id="2565140">,</span>&nbsp;<span class="builtinfunc" id="2565142">len</span><span class="op" id="2565145">(</span><span class="ident" id="2565146">m</span><span class="op" id="2565147">.</span><span class="ident" id="2565148">Data</span><span class="op" id="2565152">)</span><span class="op" id="2565153">&gt;&gt;</span><span class="num" id="2565155">2</span><span class="op" id="2565156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2565159">for</span>&nbsp;<span class="ident" id="2565163">i</span><span class="op" id="2565164">,</span>&nbsp;<span class="ident" id="2565166">j</span>&nbsp;<span class="op" id="2565168">:=</span>&nbsp;<span class="num" id="2565171">0</span><span class="op" id="2565172">,</span>&nbsp;<span class="num" id="2565174">0</span><span class="op" id="2565175">;</span>&nbsp;<span class="ident" id="2565177">i</span>&nbsp;<span class="op" id="2565179">&lt;</span>&nbsp;<span class="builtinfunc" id="2565181">len</span><span class="op" id="2565184">(</span><span class="ident" id="2565185">m</span><span class="op" id="2565186">.</span><span class="ident" id="2565187">Data</span><span class="op" id="2565191">)</span><span class="op" id="2565192">;</span>&nbsp;<span class="ident" id="2565194">i</span>&nbsp;<span class="op" id="2565196">+=</span>&nbsp;<span class="num" id="2565199">4</span>&nbsp;<span class="op" id="2565201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2565205">fds</span><span class="op" id="2565208">[</span><span class="ident" id="2565209">j</span><span class="op" id="2565210">]</span>&nbsp;<span class="op" id="2565212">=</span>&nbsp;<span class="builtintype" id="2565214">int</span><span class="op" id="2565217">(</span><span class="op" id="2565218">*</span><span class="op" id="2565219">(</span><span class="op" id="2565220">*</span><span class="builtintype" id="2565221">int32</span><span class="op" id="2565226">)</span><span class="op" id="2565227">(</span><span class="ident" id="2565228">unsafe</span><span class="op" id="2565234">.</span><span class="ident" id="2565235">Pointer</span><span class="op" id="2565242">(</span><span class="op" id="2565243">&amp;</span><span class="ident" id="2565244">m</span><span class="op" id="2565245">.</span><span class="ident" id="2565246">Data</span><span class="op" id="2565250">[</span><span class="ident" id="2565251">i</span><span class="op" id="2565252">]</span><span class="op" id="2565253">)</span><span class="op" id="2565254">)</span><span class="op" id="2565255">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2565259">j</span><span class="op" id="2565260">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2565264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2565267">return</span>&nbsp;<span class="ident" id="2565274">fds</span><span class="op" id="2565277">,</span>&nbsp;<span class="ident" id="2565279">nil</span><br>
<span class="lineno"></span><span class="op" id="2565283">}</span>
</div>
</body>
</html>
