<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/lex8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/lex8/error.go.html">error.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/lex8/error_list.go.html">error_list.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/lex8/lex_scanner.go.html">lex_scanner.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/lex8/lexer.go.html">lexer.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/lex8/pos.go.html">pos.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/lex8/rune_scanner.go.html">rune_scanner.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/lex8/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4896131">package</span>&nbsp;<span class="ident" id="4896139">lex8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4896145">import</span>&nbsp;<span class="op" id="4896152">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896155">&#34;bytes&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896164">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4896169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4896172">//&nbsp;LexScanner&nbsp;parses&nbsp;a&nbsp;file&nbsp;input&nbsp;stream&nbsp;into&nbsp;tokens.</span><br>
<span class="lineno"></span><span class="keyword" id="4896226">type</span>&nbsp;<span class="ident" id="4896231">LexScanner</span>&nbsp;<span class="keyword" id="4896242">struct</span>&nbsp;<span class="op" id="4896249">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896252">s</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4896258">*</span><span class="ident" id="4896259">RuneScanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896272">errs</span>&nbsp;&nbsp;<span class="op" id="4896278">*</span><span class="ident" id="4896279">ErrorList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896290">valid</span>&nbsp;<span class="builtintype" id="4896296">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896303">pos</span>&nbsp;<span class="op" id="4896307">*</span><span class="ident" id="4896308">Pos</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896313">buf</span>&nbsp;<span class="op" id="4896317">*</span><span class="ident" id="4896318">bytes</span><span class="op" id="4896323">.</span><span class="ident" id="4896324">Buffer</span><br>
<span class="lineno"></span><span class="op" id="4896331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4896334">//&nbsp;NewLexScanner&nbsp;creates&nbsp;a&nbsp;new&nbsp;lexer.</span><br>
<span class="lineno"></span><span class="keyword" id="4896372">func</span>&nbsp;<span class="ident" id="4896377">NewLexScanner</span><span class="op" id="4896390">(</span><span class="ident" id="4896391">file</span>&nbsp;<span class="builtintype" id="4896396">string</span><span class="op" id="4896402">,</span>&nbsp;<span class="ident" id="4896404">rc</span>&nbsp;<span class="ident" id="4896407">io</span><span class="op" id="4896409">.</span><span class="ident" id="4896410">ReadCloser</span><span class="op" id="4896420">)</span>&nbsp;<span class="op" id="4896422">*</span><span class="ident" id="4896423">LexScanner</span>&nbsp;<span class="op" id="4896434">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896437">ret</span>&nbsp;<span class="op" id="4896441">:=</span>&nbsp;<span class="builtinfunc" id="4896444">new</span><span class="op" id="4896447">(</span><span class="ident" id="4896448">LexScanner</span><span class="op" id="4896458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896461">ret</span><span class="op" id="4896464">.</span><span class="ident" id="4896465">s</span>&nbsp;<span class="op" id="4896467">=</span>&nbsp;<span class="ident" id="4896469">NewRuneScanner</span><span class="op" id="4896483">(</span><span class="ident" id="4896484">file</span><span class="op" id="4896488">,</span>&nbsp;<span class="ident" id="4896490">rc</span><span class="op" id="4896492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896495">ret</span><span class="op" id="4896498">.</span><span class="ident" id="4896499">errs</span>&nbsp;<span class="op" id="4896504">=</span>&nbsp;<span class="ident" id="4896506">NewErrList</span><span class="op" id="4896516">(</span><span class="op" id="4896517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896521">ret</span><span class="op" id="4896524">.</span><span class="ident" id="4896525">buf</span>&nbsp;<span class="op" id="4896529">=</span>&nbsp;<span class="builtinfunc" id="4896531">new</span><span class="op" id="4896534">(</span><span class="ident" id="4896535">bytes</span><span class="op" id="4896540">.</span><span class="ident" id="4896541">Buffer</span><span class="op" id="4896547">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896550">ret</span><span class="op" id="4896553">.</span><span class="ident" id="4896554">pos</span>&nbsp;<span class="op" id="4896558">=</span>&nbsp;<span class="ident" id="4896560">ret</span><span class="op" id="4896563">.</span><span class="ident" id="4896564">s</span><span class="op" id="4896565">.</span><span class="ident" id="4896566">Pos</span><span class="op" id="4896569">(</span><span class="op" id="4896570">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896574">return</span>&nbsp;<span class="ident" id="4896581">ret</span><br>
<span class="lineno"></span><span class="op" id="4896585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4896588">//&nbsp;Next&nbsp;pushes&nbsp;the&nbsp;current&nbsp;rune&nbsp;(if&nbsp;valid)&nbsp;into&nbsp;the&nbsp;buffer,</span><br>
<span class="lineno"></span><span class="comment" id="4896648">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;rune&nbsp;or&nbsp;error&nbsp;from&nbsp;scanning&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="4896710">//&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="4896721">func</span>&nbsp;<span class="op" id="4896726">(</span><span class="ident" id="4896727">s</span>&nbsp;<span class="op" id="4896729">*</span><span class="ident" id="4896730">LexScanner</span><span class="op" id="4896740">)</span>&nbsp;<span class="ident" id="4896742">Next</span><span class="op" id="4896746">(</span><span class="op" id="4896747">)</span>&nbsp;<span class="op" id="4896749">(</span><span class="builtintype" id="4896750">rune</span><span class="op" id="4896754">,</span>&nbsp;<span class="builtintype" id="4896756">error</span><span class="op" id="4896761">)</span>&nbsp;<span class="op" id="4896763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896766">if</span>&nbsp;<span class="ident" id="4896769">s</span><span class="op" id="4896770">.</span><span class="ident" id="4896771">valid</span>&nbsp;<span class="op" id="4896777">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896781">s</span><span class="op" id="4896782">.</span><span class="ident" id="4896783">buf</span><span class="op" id="4896786">.</span><span class="ident" id="4896787">WriteRune</span><span class="op" id="4896796">(</span><span class="ident" id="4896797">s</span><span class="op" id="4896798">.</span><span class="ident" id="4896799">s</span><span class="op" id="4896800">.</span><span class="ident" id="4896801">Rune</span><span class="op" id="4896805">)</span>&nbsp;<span class="comment" id="4896807">//&nbsp;push&nbsp;into&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896833">s</span><span class="op" id="4896834">.</span><span class="ident" id="4896835">valid</span>&nbsp;<span class="op" id="4896841">=</span>&nbsp;<span class="builtintype" id="4896843">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4896850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896854">if</span>&nbsp;<span class="op" id="4896857">!</span><span class="ident" id="4896858">s</span><span class="op" id="4896859">.</span><span class="ident" id="4896860">s</span><span class="op" id="4896861">.</span><span class="ident" id="4896862">Scan</span><span class="op" id="4896866">(</span><span class="op" id="4896867">)</span>&nbsp;<span class="op" id="4896869">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896873">if</span>&nbsp;<span class="ident" id="4896876">s</span><span class="op" id="4896877">.</span><span class="ident" id="4896878">s</span><span class="op" id="4896879">.</span><span class="ident" id="4896880">Err</span>&nbsp;<span class="op" id="4896884">!=</span>&nbsp;<span class="ident" id="4896887">nil</span>&nbsp;<span class="op" id="4896891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896896">return</span>&nbsp;<span class="num" id="4896903">0</span><span class="op" id="4896904">,</span>&nbsp;<span class="ident" id="4896906">s</span><span class="op" id="4896907">.</span><span class="ident" id="4896908">s</span><span class="op" id="4896909">.</span><span class="ident" id="4896910">Err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4896916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896921">return</span>&nbsp;<span class="num" id="4896928">0</span><span class="op" id="4896929">,</span>&nbsp;<span class="ident" id="4896931">io</span><span class="op" id="4896933">.</span><span class="ident" id="4896934">EOF</span>&nbsp;<span class="comment" id="4896938">//&nbsp;signal&nbsp;end&nbsp;of&nbsp;file</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4896961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896965">s</span><span class="op" id="4896966">.</span><span class="ident" id="4896967">valid</span>&nbsp;<span class="op" id="4896973">=</span>&nbsp;<span class="builtintype" id="4896975">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896981">return</span>&nbsp;<span class="ident" id="4896988">s</span><span class="op" id="4896989">.</span><span class="ident" id="4896990">s</span><span class="op" id="4896991">.</span><span class="ident" id="4896992">Rune</span><span class="op" id="4896996">,</span>&nbsp;<span class="ident" id="4896998">nil</span><br>
<span class="lineno"></span><span class="op" id="4897002">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4897005">//&nbsp;Accept&nbsp;returns&nbsp;the&nbsp;string&nbsp;buffered,&nbsp;and&nbsp;the&nbsp;starting&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4897070">//&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4897088">func</span>&nbsp;<span class="op" id="4897093">(</span><span class="ident" id="4897094">s</span>&nbsp;<span class="op" id="4897096">*</span><span class="ident" id="4897097">LexScanner</span><span class="op" id="4897107">)</span>&nbsp;<span class="ident" id="4897109">Accept</span><span class="op" id="4897115">(</span><span class="op" id="4897116">)</span>&nbsp;<span class="op" id="4897118">(</span><span class="builtintype" id="4897119">string</span><span class="op" id="4897125">,</span>&nbsp;<span class="op" id="4897127">*</span><span class="ident" id="4897128">Pos</span><span class="op" id="4897131">)</span>&nbsp;<span class="op" id="4897133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897136">ret</span>&nbsp;<span class="op" id="4897140">:=</span>&nbsp;<span class="ident" id="4897143">s</span><span class="op" id="4897144">.</span><span class="ident" id="4897145">buf</span><span class="op" id="4897148">.</span><span class="ident" id="4897149">String</span><span class="op" id="4897155">(</span><span class="op" id="4897156">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897159">s</span><span class="op" id="4897160">.</span><span class="ident" id="4897161">buf</span><span class="op" id="4897164">.</span><span class="ident" id="4897165">Reset</span><span class="op" id="4897170">(</span><span class="op" id="4897171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897174">pos</span>&nbsp;<span class="op" id="4897178">:=</span>&nbsp;<span class="ident" id="4897181">s</span><span class="op" id="4897182">.</span><span class="ident" id="4897183">pos</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897189">s</span><span class="op" id="4897190">.</span><span class="ident" id="4897191">pos</span>&nbsp;<span class="op" id="4897195">=</span>&nbsp;<span class="ident" id="4897197">s</span><span class="op" id="4897198">.</span><span class="ident" id="4897199">s</span><span class="op" id="4897200">.</span><span class="ident" id="4897201">Pos</span><span class="op" id="4897204">(</span><span class="op" id="4897205">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897209">return</span>&nbsp;<span class="ident" id="4897216">ret</span><span class="op" id="4897219">,</span>&nbsp;<span class="ident" id="4897221">pos</span><br>
<span class="lineno"></span><span class="op" id="4897225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4897228">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;buffer&nbsp;start.</span><br>
<span class="lineno"></span><span class="keyword" id="4897277">func</span>&nbsp;<span class="op" id="4897282">(</span><span class="ident" id="4897283">s</span>&nbsp;<span class="op" id="4897285">*</span><span class="ident" id="4897286">LexScanner</span><span class="op" id="4897296">)</span>&nbsp;<span class="ident" id="4897298">Pos</span><span class="op" id="4897301">(</span><span class="op" id="4897302">)</span>&nbsp;<span class="op" id="4897304">*</span><span class="ident" id="4897305">Pos</span>&nbsp;<span class="op" id="4897309">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897312">return</span>&nbsp;<span class="ident" id="4897319">s</span><span class="op" id="4897320">.</span><span class="ident" id="4897321">pos</span><br>
<span class="lineno"></span><span class="op" id="4897325">}</span>
</div>
</body>
</html>
