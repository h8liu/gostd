<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io</h2>
<ul>
<li><a href="/gostd/io/io.go.html">io.go</a></li>
<li><a href="/gostd/io/io_test.go.html">io_test.go</a></li>
<li><a href="/gostd/io/multi.go.html">multi.go</a></li>
<li><a href="/gostd/io/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/io/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/io/pipe_test.go.html">pipe_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1605853">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1605908">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1605962">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1606013">//&nbsp;Pipe&nbsp;adapter&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1606068">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1606106">package</span>&nbsp;<span class="ident" id="1606114">io</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1606118">import</span>&nbsp;<span class="op" id="1606125">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1606128">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1606138">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="1606145">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1606148">//&nbsp;ErrClosedPipe&nbsp;is&nbsp;the&nbsp;error&nbsp;used&nbsp;for&nbsp;read&nbsp;or&nbsp;write&nbsp;operations&nbsp;on&nbsp;a&nbsp;closed&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1606230">var</span>&nbsp;<span class="ident" id="1606234">ErrClosedPipe</span>&nbsp;<span class="op" id="1606248">=</span>&nbsp;<span class="ident" id="1606250">errors</span><span class="op" id="1606256">.</span><span class="ident" id="1606257">New</span><span class="op" id="1606260">(</span><span class="string" id="1606261">&#34;io:&nbsp;read/write&nbsp;on&nbsp;closed&nbsp;pipe&#34;</span><span class="op" id="1606292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1606295">type</span>&nbsp;<span class="ident" id="1606300">pipeResult</span>&nbsp;<span class="keyword" id="1606311">struct</span>&nbsp;<span class="op" id="1606318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606321">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1606325">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606330">err</span>&nbsp;<span class="builtintype" id="1606334">error</span><br>
<span class="lineno"></span><span class="op" id="1606340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1606343">//&nbsp;A&nbsp;pipe&nbsp;is&nbsp;the&nbsp;shared&nbsp;pipe&nbsp;structure&nbsp;underlying&nbsp;PipeReader&nbsp;and&nbsp;PipeWriter.</span><br>
<span class="lineno"></span><span class="keyword" id="1606420">type</span>&nbsp;<span class="ident" id="1606425">pipe</span>&nbsp;<span class="keyword" id="1606430">struct</span>&nbsp;<span class="op" id="1606437">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606440">rl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606446">sync</span><span class="op" id="1606450">.</span><span class="ident" id="1606451">Mutex</span>&nbsp;<span class="comment" id="1606457">//&nbsp;gates&nbsp;readers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606489">wl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606495">sync</span><span class="op" id="1606499">.</span><span class="ident" id="1606500">Mutex</span>&nbsp;<span class="comment" id="1606506">//&nbsp;gates&nbsp;writers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606538">l</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606544">sync</span><span class="op" id="1606548">.</span><span class="ident" id="1606549">Mutex</span>&nbsp;<span class="comment" id="1606555">//&nbsp;protects&nbsp;remaining&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606585">data</span>&nbsp;&nbsp;<span class="op" id="1606591">[</span><span class="op" id="1606592">]</span><span class="builtintype" id="1606593">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1606602">//&nbsp;data&nbsp;remaining&nbsp;in&nbsp;pending&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606638">rwait</span>&nbsp;<span class="ident" id="1606644">sync</span><span class="op" id="1606648">.</span><span class="ident" id="1606649">Cond</span>&nbsp;&nbsp;<span class="comment" id="1606655">//&nbsp;waiting&nbsp;reader</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606674">wwait</span>&nbsp;<span class="ident" id="1606680">sync</span><span class="op" id="1606684">.</span><span class="ident" id="1606685">Cond</span>&nbsp;&nbsp;<span class="comment" id="1606691">//&nbsp;waiting&nbsp;writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606710">rerr</span>&nbsp;&nbsp;<span class="builtintype" id="1606716">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1606727">//&nbsp;if&nbsp;reader&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606770">werr</span>&nbsp;&nbsp;<span class="builtintype" id="1606776">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1606787">//&nbsp;if&nbsp;writer&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;reads</span><br>
<span class="lineno"></span><span class="op" id="1606828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1606831">func</span>&nbsp;<span class="op" id="1606836">(</span><span class="ident" id="1606837">p</span>&nbsp;<span class="op" id="1606839">*</span><span class="ident" id="1606840">pipe</span><span class="op" id="1606844">)</span>&nbsp;<span class="ident" id="1606846">read</span><span class="op" id="1606850">(</span><span class="ident" id="1606851">b</span>&nbsp;<span class="op" id="1606853">[</span><span class="op" id="1606854">]</span><span class="builtintype" id="1606855">byte</span><span class="op" id="1606859">)</span>&nbsp;<span class="op" id="1606861">(</span><span class="ident" id="1606862">n</span>&nbsp;<span class="builtintype" id="1606864">int</span><span class="op" id="1606867">,</span>&nbsp;<span class="ident" id="1606869">err</span>&nbsp;<span class="builtintype" id="1606873">error</span><span class="op" id="1606878">)</span>&nbsp;<span class="op" id="1606880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1606883">//&nbsp;One&nbsp;reader&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606909">p</span><span class="op" id="1606910">.</span><span class="ident" id="1606911">rl</span><span class="op" id="1606913">.</span><span class="ident" id="1606914">Lock</span><span class="op" id="1606918">(</span><span class="op" id="1606919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606922">defer</span>&nbsp;<span class="ident" id="1606928">p</span><span class="op" id="1606929">.</span><span class="ident" id="1606930">rl</span><span class="op" id="1606932">.</span><span class="ident" id="1606933">Unlock</span><span class="op" id="1606939">(</span><span class="op" id="1606940">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606944">p</span><span class="op" id="1606945">.</span><span class="ident" id="1606946">l</span><span class="op" id="1606947">.</span><span class="ident" id="1606948">Lock</span><span class="op" id="1606952">(</span><span class="op" id="1606953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606956">defer</span>&nbsp;<span class="ident" id="1606962">p</span><span class="op" id="1606963">.</span><span class="ident" id="1606964">l</span><span class="op" id="1606965">.</span><span class="ident" id="1606966">Unlock</span><span class="op" id="1606972">(</span><span class="op" id="1606973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606976">for</span>&nbsp;<span class="op" id="1606980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606984">if</span>&nbsp;<span class="ident" id="1606987">p</span><span class="op" id="1606988">.</span><span class="ident" id="1606989">rerr</span>&nbsp;<span class="op" id="1606994">!=</span>&nbsp;<span class="ident" id="1606997">nil</span>&nbsp;<span class="op" id="1607001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607006">return</span>&nbsp;<span class="num" id="1607013">0</span><span class="op" id="1607014">,</span>&nbsp;<span class="ident" id="1607016">ErrClosedPipe</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1607032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607036">if</span>&nbsp;<span class="ident" id="1607039">p</span><span class="op" id="1607040">.</span><span class="ident" id="1607041">data</span>&nbsp;<span class="op" id="1607046">!=</span>&nbsp;<span class="ident" id="1607049">nil</span>&nbsp;<span class="op" id="1607053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607058">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1607066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607070">if</span>&nbsp;<span class="ident" id="1607073">p</span><span class="op" id="1607074">.</span><span class="ident" id="1607075">werr</span>&nbsp;<span class="op" id="1607080">!=</span>&nbsp;<span class="ident" id="1607083">nil</span>&nbsp;<span class="op" id="1607087">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607092">return</span>&nbsp;<span class="num" id="1607099">0</span><span class="op" id="1607100">,</span>&nbsp;<span class="ident" id="1607102">p</span><span class="op" id="1607103">.</span><span class="ident" id="1607104">werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1607111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607115">p</span><span class="op" id="1607116">.</span><span class="ident" id="1607117">rwait</span><span class="op" id="1607122">.</span><span class="ident" id="1607123">Wait</span><span class="op" id="1607127">(</span><span class="op" id="1607128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1607131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607134">n</span>&nbsp;<span class="op" id="1607136">=</span>&nbsp;<span class="builtinfunc" id="1607138">copy</span><span class="op" id="1607142">(</span><span class="ident" id="1607143">b</span><span class="op" id="1607144">,</span>&nbsp;<span class="ident" id="1607146">p</span><span class="op" id="1607147">.</span><span class="ident" id="1607148">data</span><span class="op" id="1607152">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607155">p</span><span class="op" id="1607156">.</span><span class="ident" id="1607157">data</span>&nbsp;<span class="op" id="1607162">=</span>&nbsp;<span class="ident" id="1607164">p</span><span class="op" id="1607165">.</span><span class="ident" id="1607166">data</span><span class="op" id="1607170">[</span><span class="ident" id="1607171">n</span><span class="op" id="1607172">:</span><span class="op" id="1607173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607176">if</span>&nbsp;<span class="builtinfunc" id="1607179">len</span><span class="op" id="1607182">(</span><span class="ident" id="1607183">p</span><span class="op" id="1607184">.</span><span class="ident" id="1607185">data</span><span class="op" id="1607189">)</span>&nbsp;<span class="op" id="1607191">==</span>&nbsp;<span class="num" id="1607194">0</span>&nbsp;<span class="op" id="1607196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607200">p</span><span class="op" id="1607201">.</span><span class="ident" id="1607202">data</span>&nbsp;<span class="op" id="1607207">=</span>&nbsp;<span class="ident" id="1607209">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607215">p</span><span class="op" id="1607216">.</span><span class="ident" id="1607217">wwait</span><span class="op" id="1607222">.</span><span class="ident" id="1607223">Signal</span><span class="op" id="1607229">(</span><span class="op" id="1607230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1607233">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607236">return</span><br>
<span class="lineno"></span><span class="op" id="1607243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1607246">var</span>&nbsp;<span class="ident" id="1607250">zero</span>&nbsp;<span class="op" id="1607255">[</span><span class="num" id="1607256">0</span><span class="op" id="1607257">]</span><span class="builtintype" id="1607258">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="1607264">func</span>&nbsp;<span class="op" id="1607269">(</span><span class="ident" id="1607270">p</span>&nbsp;<span class="op" id="1607272">*</span><span class="ident" id="1607273">pipe</span><span class="op" id="1607277">)</span>&nbsp;<span class="ident" id="1607279">write</span><span class="op" id="1607284">(</span><span class="ident" id="1607285">b</span>&nbsp;<span class="op" id="1607287">[</span><span class="op" id="1607288">]</span><span class="builtintype" id="1607289">byte</span><span class="op" id="1607293">)</span>&nbsp;<span class="op" id="1607295">(</span><span class="ident" id="1607296">n</span>&nbsp;<span class="builtintype" id="1607298">int</span><span class="op" id="1607301">,</span>&nbsp;<span class="ident" id="1607303">err</span>&nbsp;<span class="builtintype" id="1607307">error</span><span class="op" id="1607312">)</span>&nbsp;<span class="op" id="1607314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1607317">//&nbsp;pipe&nbsp;uses&nbsp;nil&nbsp;to&nbsp;mean&nbsp;not&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607357">if</span>&nbsp;<span class="ident" id="1607360">b</span>&nbsp;<span class="op" id="1607362">==</span>&nbsp;<span class="ident" id="1607365">nil</span>&nbsp;<span class="op" id="1607369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607373">b</span>&nbsp;<span class="op" id="1607375">=</span>&nbsp;<span class="ident" id="1607377">zero</span><span class="op" id="1607381">[</span><span class="op" id="1607382">:</span><span class="op" id="1607383">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1607386">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1607390">//&nbsp;One&nbsp;writer&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607416">p</span><span class="op" id="1607417">.</span><span class="ident" id="1607418">wl</span><span class="op" id="1607420">.</span><span class="ident" id="1607421">Lock</span><span class="op" id="1607425">(</span><span class="op" id="1607426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607429">defer</span>&nbsp;<span class="ident" id="1607435">p</span><span class="op" id="1607436">.</span><span class="ident" id="1607437">wl</span><span class="op" id="1607439">.</span><span class="ident" id="1607440">Unlock</span><span class="op" id="1607446">(</span><span class="op" id="1607447">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607451">p</span><span class="op" id="1607452">.</span><span class="ident" id="1607453">l</span><span class="op" id="1607454">.</span><span class="ident" id="1607455">Lock</span><span class="op" id="1607459">(</span><span class="op" id="1607460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607463">defer</span>&nbsp;<span class="ident" id="1607469">p</span><span class="op" id="1607470">.</span><span class="ident" id="1607471">l</span><span class="op" id="1607472">.</span><span class="ident" id="1607473">Unlock</span><span class="op" id="1607479">(</span><span class="op" id="1607480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607483">if</span>&nbsp;<span class="ident" id="1607486">p</span><span class="op" id="1607487">.</span><span class="ident" id="1607488">werr</span>&nbsp;<span class="op" id="1607493">!=</span>&nbsp;<span class="ident" id="1607496">nil</span>&nbsp;<span class="op" id="1607500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607504">err</span>&nbsp;<span class="op" id="1607508">=</span>&nbsp;<span class="ident" id="1607510">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607526">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1607534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607537">p</span><span class="op" id="1607538">.</span><span class="ident" id="1607539">data</span>&nbsp;<span class="op" id="1607544">=</span>&nbsp;<span class="ident" id="1607546">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607549">p</span><span class="op" id="1607550">.</span><span class="ident" id="1607551">rwait</span><span class="op" id="1607556">.</span><span class="ident" id="1607557">Signal</span><span class="op" id="1607563">(</span><span class="op" id="1607564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607567">for</span>&nbsp;<span class="op" id="1607571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607575">if</span>&nbsp;<span class="ident" id="1607578">p</span><span class="op" id="1607579">.</span><span class="ident" id="1607580">data</span>&nbsp;<span class="op" id="1607585">==</span>&nbsp;<span class="ident" id="1607588">nil</span>&nbsp;<span class="op" id="1607592">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607597">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1607605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607609">if</span>&nbsp;<span class="ident" id="1607612">p</span><span class="op" id="1607613">.</span><span class="ident" id="1607614">rerr</span>&nbsp;<span class="op" id="1607619">!=</span>&nbsp;<span class="ident" id="1607622">nil</span>&nbsp;<span class="op" id="1607626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607631">err</span>&nbsp;<span class="op" id="1607635">=</span>&nbsp;<span class="ident" id="1607637">p</span><span class="op" id="1607638">.</span><span class="ident" id="1607639">rerr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607647">break</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1607655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607659">if</span>&nbsp;<span class="ident" id="1607662">p</span><span class="op" id="1607663">.</span><span class="ident" id="1607664">werr</span>&nbsp;<span class="op" id="1607669">!=</span>&nbsp;<span class="ident" id="1607672">nil</span>&nbsp;<span class="op" id="1607676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607681">err</span>&nbsp;<span class="op" id="1607685">=</span>&nbsp;<span class="ident" id="1607687">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1607703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607707">p</span><span class="op" id="1607708">.</span><span class="ident" id="1607709">wwait</span><span class="op" id="1607714">.</span><span class="ident" id="1607715">Wait</span><span class="op" id="1607719">(</span><span class="op" id="1607720">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1607723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607726">n</span>&nbsp;<span class="op" id="1607728">=</span>&nbsp;<span class="builtinfunc" id="1607730">len</span><span class="op" id="1607733">(</span><span class="ident" id="1607734">b</span><span class="op" id="1607735">)</span>&nbsp;<span class="op" id="1607737">-</span>&nbsp;<span class="builtinfunc" id="1607739">len</span><span class="op" id="1607742">(</span><span class="ident" id="1607743">p</span><span class="op" id="1607744">.</span><span class="ident" id="1607745">data</span><span class="op" id="1607749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607752">p</span><span class="op" id="1607753">.</span><span class="ident" id="1607754">data</span>&nbsp;<span class="op" id="1607759">=</span>&nbsp;<span class="ident" id="1607761">nil</span>&nbsp;<span class="comment" id="1607765">//&nbsp;in&nbsp;case&nbsp;of&nbsp;rerr&nbsp;or&nbsp;werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607793">return</span><br>
<span class="lineno"></span><span class="op" id="1607800">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="1607803">func</span>&nbsp;<span class="op" id="1607808">(</span><span class="ident" id="1607809">p</span>&nbsp;<span class="op" id="1607811">*</span><span class="ident" id="1607812">pipe</span><span class="op" id="1607816">)</span>&nbsp;<span class="ident" id="1607818">rclose</span><span class="op" id="1607824">(</span><span class="ident" id="1607825">err</span>&nbsp;<span class="builtintype" id="1607829">error</span><span class="op" id="1607834">)</span>&nbsp;<span class="op" id="1607836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607839">if</span>&nbsp;<span class="ident" id="1607842">err</span>&nbsp;<span class="op" id="1607846">==</span>&nbsp;<span class="ident" id="1607849">nil</span>&nbsp;<span class="op" id="1607853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607857">err</span>&nbsp;<span class="op" id="1607861">=</span>&nbsp;<span class="ident" id="1607863">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1607878">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607881">p</span><span class="op" id="1607882">.</span><span class="ident" id="1607883">l</span><span class="op" id="1607884">.</span><span class="ident" id="1607885">Lock</span><span class="op" id="1607889">(</span><span class="op" id="1607890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1607893">defer</span>&nbsp;<span class="ident" id="1607899">p</span><span class="op" id="1607900">.</span><span class="ident" id="1607901">l</span><span class="op" id="1607902">.</span><span class="ident" id="1607903">Unlock</span><span class="op" id="1607909">(</span><span class="op" id="1607910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607913">p</span><span class="op" id="1607914">.</span><span class="ident" id="1607915">rerr</span>&nbsp;<span class="op" id="1607920">=</span>&nbsp;<span class="ident" id="1607922">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607927">p</span><span class="op" id="1607928">.</span><span class="ident" id="1607929">rwait</span><span class="op" id="1607934">.</span><span class="ident" id="1607935">Signal</span><span class="op" id="1607941">(</span><span class="op" id="1607942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1607945">p</span><span class="op" id="1607946">.</span><span class="ident" id="1607947">wwait</span><span class="op" id="1607952">.</span><span class="ident" id="1607953">Signal</span><span class="op" id="1607959">(</span><span class="op" id="1607960">)</span><br>
<span class="lineno">110</span><span class="op" id="1607962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1607965">func</span>&nbsp;<span class="op" id="1607970">(</span><span class="ident" id="1607971">p</span>&nbsp;<span class="op" id="1607973">*</span><span class="ident" id="1607974">pipe</span><span class="op" id="1607978">)</span>&nbsp;<span class="ident" id="1607980">wclose</span><span class="op" id="1607986">(</span><span class="ident" id="1607987">err</span>&nbsp;<span class="builtintype" id="1607991">error</span><span class="op" id="1607996">)</span>&nbsp;<span class="op" id="1607998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1608001">if</span>&nbsp;<span class="ident" id="1608004">err</span>&nbsp;<span class="op" id="1608008">==</span>&nbsp;<span class="ident" id="1608011">nil</span>&nbsp;<span class="op" id="1608015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1608019">err</span>&nbsp;<span class="op" id="1608023">=</span>&nbsp;<span class="ident" id="1608025">EOF</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1608030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1608033">p</span><span class="op" id="1608034">.</span><span class="ident" id="1608035">l</span><span class="op" id="1608036">.</span><span class="ident" id="1608037">Lock</span><span class="op" id="1608041">(</span><span class="op" id="1608042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1608045">defer</span>&nbsp;<span class="ident" id="1608051">p</span><span class="op" id="1608052">.</span><span class="ident" id="1608053">l</span><span class="op" id="1608054">.</span><span class="ident" id="1608055">Unlock</span><span class="op" id="1608061">(</span><span class="op" id="1608062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1608065">p</span><span class="op" id="1608066">.</span><span class="ident" id="1608067">werr</span>&nbsp;<span class="op" id="1608072">=</span>&nbsp;<span class="ident" id="1608074">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1608079">p</span><span class="op" id="1608080">.</span><span class="ident" id="1608081">rwait</span><span class="op" id="1608086">.</span><span class="ident" id="1608087">Signal</span><span class="op" id="1608093">(</span><span class="op" id="1608094">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1608097">p</span><span class="op" id="1608098">.</span><span class="ident" id="1608099">wwait</span><span class="op" id="1608104">.</span><span class="ident" id="1608105">Signal</span><span class="op" id="1608111">(</span><span class="op" id="1608112">)</span><br>
<span class="lineno"></span><span class="op" id="1608114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1608117">//&nbsp;A&nbsp;PipeReader&nbsp;is&nbsp;the&nbsp;read&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1608161">type</span>&nbsp;<span class="ident" id="1608166">PipeReader</span>&nbsp;<span class="keyword" id="1608177">struct</span>&nbsp;<span class="op" id="1608184">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1608187">p</span>&nbsp;<span class="op" id="1608189">*</span><span class="ident" id="1608190">pipe</span><br>
<span class="lineno"></span><span class="op" id="1608195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1608198">//&nbsp;Read&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Read&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1608246">//&nbsp;it&nbsp;reads&nbsp;data&nbsp;from&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;a&nbsp;writer</span><br>
<span class="lineno">130</span><span class="comment" id="1608302">//&nbsp;arrives&nbsp;or&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1608341">//&nbsp;If&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1608400">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1608442">func</span>&nbsp;<span class="op" id="1608447">(</span><span class="ident" id="1608448">r</span>&nbsp;<span class="op" id="1608450">*</span><span class="ident" id="1608451">PipeReader</span><span class="op" id="1608461">)</span>&nbsp;<span class="ident" id="1608463">Read</span><span class="op" id="1608467">(</span><span class="ident" id="1608468">data</span>&nbsp;<span class="op" id="1608473">[</span><span class="op" id="1608474">]</span><span class="builtintype" id="1608475">byte</span><span class="op" id="1608479">)</span>&nbsp;<span class="op" id="1608481">(</span><span class="ident" id="1608482">n</span>&nbsp;<span class="builtintype" id="1608484">int</span><span class="op" id="1608487">,</span>&nbsp;<span class="ident" id="1608489">err</span>&nbsp;<span class="builtintype" id="1608493">error</span><span class="op" id="1608498">)</span>&nbsp;<span class="op" id="1608500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1608503">return</span>&nbsp;<span class="ident" id="1608510">r</span><span class="op" id="1608511">.</span><span class="ident" id="1608512">p</span><span class="op" id="1608513">.</span><span class="ident" id="1608514">read</span><span class="op" id="1608518">(</span><span class="ident" id="1608519">data</span><span class="op" id="1608523">)</span><br>
<span class="lineno">135</span><span class="op" id="1608525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1608528">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1608581">//&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;ErrClosedPipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1608644">func</span>&nbsp;<span class="op" id="1608649">(</span><span class="ident" id="1608650">r</span>&nbsp;<span class="op" id="1608652">*</span><span class="ident" id="1608653">PipeReader</span><span class="op" id="1608663">)</span>&nbsp;<span class="ident" id="1608665">Close</span><span class="op" id="1608670">(</span><span class="op" id="1608671">)</span>&nbsp;<span class="builtintype" id="1608673">error</span>&nbsp;<span class="op" id="1608679">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1608682">return</span>&nbsp;<span class="ident" id="1608689">r</span><span class="op" id="1608690">.</span><span class="ident" id="1608691">CloseWithError</span><span class="op" id="1608705">(</span><span class="ident" id="1608706">nil</span><span class="op" id="1608709">)</span><br>
<span class="lineno"></span><span class="op" id="1608711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1608714">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes</span><br>
<span class="lineno"></span><span class="comment" id="1608769">//&nbsp;to&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno">145</span><span class="keyword" id="1608829">func</span>&nbsp;<span class="op" id="1608834">(</span><span class="ident" id="1608835">r</span>&nbsp;<span class="op" id="1608837">*</span><span class="ident" id="1608838">PipeReader</span><span class="op" id="1608848">)</span>&nbsp;<span class="ident" id="1608850">CloseWithError</span><span class="op" id="1608864">(</span><span class="ident" id="1608865">err</span>&nbsp;<span class="builtintype" id="1608869">error</span><span class="op" id="1608874">)</span>&nbsp;<span class="builtintype" id="1608876">error</span>&nbsp;<span class="op" id="1608882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1608885">r</span><span class="op" id="1608886">.</span><span class="ident" id="1608887">p</span><span class="op" id="1608888">.</span><span class="ident" id="1608889">rclose</span><span class="op" id="1608895">(</span><span class="ident" id="1608896">err</span><span class="op" id="1608899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1608902">return</span>&nbsp;<span class="ident" id="1608909">nil</span><br>
<span class="lineno"></span><span class="op" id="1608913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="1608916">//&nbsp;A&nbsp;PipeWriter&nbsp;is&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1608961">type</span>&nbsp;<span class="ident" id="1608966">PipeWriter</span>&nbsp;<span class="keyword" id="1608977">struct</span>&nbsp;<span class="op" id="1608984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1608987">p</span>&nbsp;<span class="op" id="1608989">*</span><span class="ident" id="1608990">pipe</span><br>
<span class="lineno"></span><span class="op" id="1608995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="1608998">//&nbsp;Write&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Write&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1609048">//&nbsp;it&nbsp;writes&nbsp;data&nbsp;to&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;readers</span><br>
<span class="lineno"></span><span class="comment" id="1609102">//&nbsp;have&nbsp;consumed&nbsp;all&nbsp;the&nbsp;data&nbsp;or&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1609159">//&nbsp;If&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;err&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1609215">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;ErrClosedPipe.</span><br>
<span class="lineno">160</span><span class="keyword" id="1609267">func</span>&nbsp;<span class="op" id="1609272">(</span><span class="ident" id="1609273">w</span>&nbsp;<span class="op" id="1609275">*</span><span class="ident" id="1609276">PipeWriter</span><span class="op" id="1609286">)</span>&nbsp;<span class="ident" id="1609288">Write</span><span class="op" id="1609293">(</span><span class="ident" id="1609294">data</span>&nbsp;<span class="op" id="1609299">[</span><span class="op" id="1609300">]</span><span class="builtintype" id="1609301">byte</span><span class="op" id="1609305">)</span>&nbsp;<span class="op" id="1609307">(</span><span class="ident" id="1609308">n</span>&nbsp;<span class="builtintype" id="1609310">int</span><span class="op" id="1609313">,</span>&nbsp;<span class="ident" id="1609315">err</span>&nbsp;<span class="builtintype" id="1609319">error</span><span class="op" id="1609324">)</span>&nbsp;<span class="op" id="1609326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1609329">return</span>&nbsp;<span class="ident" id="1609336">w</span><span class="op" id="1609337">.</span><span class="ident" id="1609338">p</span><span class="op" id="1609339">.</span><span class="ident" id="1609340">write</span><span class="op" id="1609345">(</span><span class="ident" id="1609346">data</span><span class="op" id="1609350">)</span><br>
<span class="lineno"></span><span class="op" id="1609352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1609355">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno">165</span><span class="comment" id="1609409">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1609464">func</span>&nbsp;<span class="op" id="1609469">(</span><span class="ident" id="1609470">w</span>&nbsp;<span class="op" id="1609472">*</span><span class="ident" id="1609473">PipeWriter</span><span class="op" id="1609483">)</span>&nbsp;<span class="ident" id="1609485">Close</span><span class="op" id="1609490">(</span><span class="op" id="1609491">)</span>&nbsp;<span class="builtintype" id="1609493">error</span>&nbsp;<span class="op" id="1609499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1609502">return</span>&nbsp;<span class="ident" id="1609509">w</span><span class="op" id="1609510">.</span><span class="ident" id="1609511">CloseWithError</span><span class="op" id="1609525">(</span><span class="ident" id="1609526">nil</span><span class="op" id="1609529">)</span><br>
<span class="lineno"></span><span class="op" id="1609531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="1609534">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1609597">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno"></span><span class="keyword" id="1609662">func</span>&nbsp;<span class="op" id="1609667">(</span><span class="ident" id="1609668">w</span>&nbsp;<span class="op" id="1609670">*</span><span class="ident" id="1609671">PipeWriter</span><span class="op" id="1609681">)</span>&nbsp;<span class="ident" id="1609683">CloseWithError</span><span class="op" id="1609697">(</span><span class="ident" id="1609698">err</span>&nbsp;<span class="builtintype" id="1609702">error</span><span class="op" id="1609707">)</span>&nbsp;<span class="builtintype" id="1609709">error</span>&nbsp;<span class="op" id="1609715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1609718">w</span><span class="op" id="1609719">.</span><span class="ident" id="1609720">p</span><span class="op" id="1609721">.</span><span class="ident" id="1609722">wclose</span><span class="op" id="1609728">(</span><span class="ident" id="1609729">err</span><span class="op" id="1609732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1609735">return</span>&nbsp;<span class="ident" id="1609742">nil</span><br>
<span class="lineno">175</span><span class="op" id="1609746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1609749">//&nbsp;Pipe&nbsp;creates&nbsp;a&nbsp;synchronous&nbsp;in-memory&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="comment" id="1609795">//&nbsp;It&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1609852">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno">180</span><span class="comment" id="1609889">//&nbsp;Reads&nbsp;on&nbsp;one&nbsp;end&nbsp;are&nbsp;matched&nbsp;with&nbsp;writes&nbsp;on&nbsp;the&nbsp;other,</span><br>
<span class="lineno"></span><span class="comment" id="1609947">//&nbsp;copying&nbsp;data&nbsp;directly&nbsp;between&nbsp;the&nbsp;two;&nbsp;there&nbsp;is&nbsp;no&nbsp;internal&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="comment" id="1610021">//&nbsp;It&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;Read&nbsp;and&nbsp;Write&nbsp;in&nbsp;parallel&nbsp;with&nbsp;each&nbsp;other&nbsp;or&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="1610094">//&nbsp;Close.&nbsp;Close&nbsp;will&nbsp;complete&nbsp;once&nbsp;pending&nbsp;I/O&nbsp;is&nbsp;done.&nbsp;Parallel&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1610168">//&nbsp;Read,&nbsp;and&nbsp;parallel&nbsp;calls&nbsp;to&nbsp;Write,&nbsp;are&nbsp;also&nbsp;safe:</span><br>
<span class="lineno">185</span><span class="comment" id="1610221">//&nbsp;the&nbsp;individual&nbsp;calls&nbsp;will&nbsp;be&nbsp;gated&nbsp;sequentially.</span><br>
<span class="lineno"></span><span class="keyword" id="1610273">func</span>&nbsp;<span class="ident" id="1610278">Pipe</span><span class="op" id="1610282">(</span><span class="op" id="1610283">)</span>&nbsp;<span class="op" id="1610285">(</span><span class="op" id="1610286">*</span><span class="ident" id="1610287">PipeReader</span><span class="op" id="1610297">,</span>&nbsp;<span class="op" id="1610299">*</span><span class="ident" id="1610300">PipeWriter</span><span class="op" id="1610310">)</span>&nbsp;<span class="op" id="1610312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1610315">p</span>&nbsp;<span class="op" id="1610317">:=</span>&nbsp;<span class="builtinfunc" id="1610320">new</span><span class="op" id="1610323">(</span><span class="ident" id="1610324">pipe</span><span class="op" id="1610328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1610331">p</span><span class="op" id="1610332">.</span><span class="ident" id="1610333">rwait</span><span class="op" id="1610338">.</span><span class="ident" id="1610339">L</span>&nbsp;<span class="op" id="1610341">=</span>&nbsp;<span class="op" id="1610343">&amp;</span><span class="ident" id="1610344">p</span><span class="op" id="1610345">.</span><span class="ident" id="1610346">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1610349">p</span><span class="op" id="1610350">.</span><span class="ident" id="1610351">wwait</span><span class="op" id="1610356">.</span><span class="ident" id="1610357">L</span>&nbsp;<span class="op" id="1610359">=</span>&nbsp;<span class="op" id="1610361">&amp;</span><span class="ident" id="1610362">p</span><span class="op" id="1610363">.</span><span class="ident" id="1610364">l</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1610367">r</span>&nbsp;<span class="op" id="1610369">:=</span>&nbsp;<span class="op" id="1610372">&amp;</span><span class="ident" id="1610373">PipeReader</span><span class="op" id="1610383">{</span><span class="ident" id="1610384">p</span><span class="op" id="1610385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1610388">w</span>&nbsp;<span class="op" id="1610390">:=</span>&nbsp;<span class="op" id="1610393">&amp;</span><span class="ident" id="1610394">PipeWriter</span><span class="op" id="1610404">{</span><span class="ident" id="1610405">p</span><span class="op" id="1610406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1610409">return</span>&nbsp;<span class="ident" id="1610416">r</span><span class="op" id="1610417">,</span>&nbsp;<span class="ident" id="1610419">w</span><br>
<span class="lineno"></span><span class="op" id="1610421">}</span>
</div>
</body>
</html>
