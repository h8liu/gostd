<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7950352">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7950407">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7950461">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7950512">package</span>&nbsp;<span class="ident" id="7950520">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950525">import</span>&nbsp;<span class="op" id="7950532">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7950535">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7950544">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7950553">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7950568">_</span>&nbsp;<span class="string" id="7950570">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7950583">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7950596">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7950609">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7950615">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7950625">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950628">func</span>&nbsp;<span class="ident" id="7950633">readImg</span><span class="op" id="7950640">(</span><span class="ident" id="7950641">filename</span>&nbsp;<span class="builtintype" id="7950650">string</span><span class="op" id="7950656">)</span>&nbsp;<span class="op" id="7950658">(</span><span class="ident" id="7950659">image</span><span class="op" id="7950664">.</span><span class="ident" id="7950665">Image</span><span class="op" id="7950670">,</span>&nbsp;<span class="builtintype" id="7950672">error</span><span class="op" id="7950677">)</span>&nbsp;<span class="op" id="7950679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7950682">f</span><span class="op" id="7950683">,</span>&nbsp;<span class="ident" id="7950685">err</span>&nbsp;<span class="op" id="7950689">:=</span>&nbsp;<span class="ident" id="7950692">os</span><span class="op" id="7950694">.</span><span class="ident" id="7950695">Open</span><span class="op" id="7950699">(</span><span class="ident" id="7950700">filename</span><span class="op" id="7950708">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7950711">if</span>&nbsp;<span class="ident" id="7950714">err</span>&nbsp;<span class="op" id="7950718">!=</span>&nbsp;<span class="builtintype" id="7950721">nil</span>&nbsp;<span class="op" id="7950725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7950729">return</span>&nbsp;<span class="builtintype" id="7950736">nil</span><span class="op" id="7950739">,</span>&nbsp;<span class="ident" id="7950741">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7950746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7950749">defer</span>&nbsp;<span class="ident" id="7950755">f</span><span class="op" id="7950756">.</span><span class="ident" id="7950757">Close</span><span class="op" id="7950762">(</span><span class="op" id="7950763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7950766">m</span><span class="op" id="7950767">,</span>&nbsp;<span class="ident" id="7950769">_</span><span class="op" id="7950770">,</span>&nbsp;<span class="ident" id="7950772">err</span>&nbsp;<span class="op" id="7950776">:=</span>&nbsp;<span class="ident" id="7950779">image</span><span class="op" id="7950784">.</span><span class="ident" id="7950785">Decode</span><span class="op" id="7950791">(</span><span class="ident" id="7950792">f</span><span class="op" id="7950793">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7950796">return</span>&nbsp;<span class="ident" id="7950803">m</span><span class="op" id="7950804">,</span>&nbsp;<span class="ident" id="7950806">err</span><br>
<span class="lineno"></span><span class="op" id="7950810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950813">func</span>&nbsp;<span class="ident" id="7950818">readGIF</span><span class="op" id="7950825">(</span><span class="ident" id="7950826">filename</span>&nbsp;<span class="builtintype" id="7950835">string</span><span class="op" id="7950841">)</span>&nbsp;<span class="op" id="7950843">(</span><span class="op" id="7950844">*</span><span class="ident" id="7950845">GIF</span><span class="op" id="7950848">,</span>&nbsp;<span class="builtintype" id="7950850">error</span><span class="op" id="7950855">)</span>&nbsp;<span class="op" id="7950857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7950860">f</span><span class="op" id="7950861">,</span>&nbsp;<span class="ident" id="7950863">err</span>&nbsp;<span class="op" id="7950867">:=</span>&nbsp;<span class="ident" id="7950870">os</span><span class="op" id="7950872">.</span><span class="ident" id="7950873">Open</span><span class="op" id="7950877">(</span><span class="ident" id="7950878">filename</span><span class="op" id="7950886">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7950889">if</span>&nbsp;<span class="ident" id="7950892">err</span>&nbsp;<span class="op" id="7950896">!=</span>&nbsp;<span class="builtintype" id="7950899">nil</span>&nbsp;<span class="op" id="7950903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7950907">return</span>&nbsp;<span class="builtintype" id="7950914">nil</span><span class="op" id="7950917">,</span>&nbsp;<span class="ident" id="7950919">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7950924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7950927">defer</span>&nbsp;<span class="ident" id="7950933">f</span><span class="op" id="7950934">.</span><span class="ident" id="7950935">Close</span><span class="op" id="7950940">(</span><span class="op" id="7950941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7950944">return</span>&nbsp;<span class="ident" id="7950951">DecodeAll</span><span class="op" id="7950960">(</span><span class="ident" id="7950961">f</span><span class="op" id="7950962">)</span><br>
<span class="lineno">35</span><span class="op" id="7950964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950967">func</span>&nbsp;<span class="ident" id="7950972">delta</span><span class="op" id="7950977">(</span><span class="ident" id="7950978">u0</span><span class="op" id="7950980">,</span>&nbsp;<span class="ident" id="7950982">u1</span>&nbsp;<span class="builtintype" id="7950985">uint32</span><span class="op" id="7950991">)</span>&nbsp;<span class="builtintype" id="7950993">int64</span>&nbsp;<span class="op" id="7950999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951002">d</span>&nbsp;<span class="op" id="7951004">:=</span>&nbsp;<span class="builtintype" id="7951007">int64</span><span class="op" id="7951012">(</span><span class="ident" id="7951013">u0</span><span class="op" id="7951015">)</span>&nbsp;<span class="op" id="7951017">-</span>&nbsp;<span class="builtintype" id="7951019">int64</span><span class="op" id="7951024">(</span><span class="ident" id="7951025">u1</span><span class="op" id="7951027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7951030">if</span>&nbsp;<span class="ident" id="7951033">d</span>&nbsp;<span class="op" id="7951035">&lt;</span>&nbsp;<span class="num" id="7951037">0</span>&nbsp;<span class="op" id="7951039">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7951043">return</span>&nbsp;<span class="op" id="7951050">-</span><span class="ident" id="7951051">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7951054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7951057">return</span>&nbsp;<span class="ident" id="7951064">d</span><br>
<span class="lineno"></span><span class="op" id="7951066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="7951069">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="7951145">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="7951170">func</span>&nbsp;<span class="ident" id="7951175">averageDelta</span><span class="op" id="7951187">(</span><span class="ident" id="7951188">m0</span><span class="op" id="7951190">,</span>&nbsp;<span class="ident" id="7951192">m1</span>&nbsp;<span class="ident" id="7951195">image</span><span class="op" id="7951200">.</span><span class="ident" id="7951201">Image</span><span class="op" id="7951206">)</span>&nbsp;<span class="builtintype" id="7951208">int64</span>&nbsp;<span class="op" id="7951214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951217">b</span>&nbsp;<span class="op" id="7951219">:=</span>&nbsp;<span class="ident" id="7951222">m0</span><span class="op" id="7951224">.</span><span class="ident" id="7951225">Bounds</span><span class="op" id="7951231">(</span><span class="op" id="7951232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7951235">var</span>&nbsp;<span class="ident" id="7951239">sum</span><span class="op" id="7951242">,</span>&nbsp;<span class="ident" id="7951244">n</span>&nbsp;<span class="builtintype" id="7951246">int64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7951253">for</span>&nbsp;<span class="ident" id="7951257">y</span>&nbsp;<span class="op" id="7951259">:=</span>&nbsp;<span class="ident" id="7951262">b</span><span class="op" id="7951263">.</span><span class="ident" id="7951264">Min</span><span class="op" id="7951267">.</span><span class="ident" id="7951268">Y</span><span class="op" id="7951269">;</span>&nbsp;<span class="ident" id="7951271">y</span>&nbsp;<span class="op" id="7951273">&lt;</span>&nbsp;<span class="ident" id="7951275">b</span><span class="op" id="7951276">.</span><span class="ident" id="7951277">Max</span><span class="op" id="7951280">.</span><span class="ident" id="7951281">Y</span><span class="op" id="7951282">;</span>&nbsp;<span class="ident" id="7951284">y</span><span class="op" id="7951285">++</span>&nbsp;<span class="op" id="7951288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7951292">for</span>&nbsp;<span class="ident" id="7951296">x</span>&nbsp;<span class="op" id="7951298">:=</span>&nbsp;<span class="ident" id="7951301">b</span><span class="op" id="7951302">.</span><span class="ident" id="7951303">Min</span><span class="op" id="7951306">.</span><span class="ident" id="7951307">X</span><span class="op" id="7951308">;</span>&nbsp;<span class="ident" id="7951310">x</span>&nbsp;<span class="op" id="7951312">&lt;</span>&nbsp;<span class="ident" id="7951314">b</span><span class="op" id="7951315">.</span><span class="ident" id="7951316">Max</span><span class="op" id="7951319">.</span><span class="ident" id="7951320">X</span><span class="op" id="7951321">;</span>&nbsp;<span class="ident" id="7951323">x</span><span class="op" id="7951324">++</span>&nbsp;<span class="op" id="7951327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951332">c0</span>&nbsp;<span class="op" id="7951335">:=</span>&nbsp;<span class="ident" id="7951338">m0</span><span class="op" id="7951340">.</span><span class="ident" id="7951341">At</span><span class="op" id="7951343">(</span><span class="ident" id="7951344">x</span><span class="op" id="7951345">,</span>&nbsp;<span class="ident" id="7951347">y</span><span class="op" id="7951348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951353">c1</span>&nbsp;<span class="op" id="7951356">:=</span>&nbsp;<span class="ident" id="7951359">m1</span><span class="op" id="7951361">.</span><span class="ident" id="7951362">At</span><span class="op" id="7951364">(</span><span class="ident" id="7951365">x</span><span class="op" id="7951366">,</span>&nbsp;<span class="ident" id="7951368">y</span><span class="op" id="7951369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951374">r0</span><span class="op" id="7951376">,</span>&nbsp;<span class="ident" id="7951378">g0</span><span class="op" id="7951380">,</span>&nbsp;<span class="ident" id="7951382">b0</span><span class="op" id="7951384">,</span>&nbsp;<span class="ident" id="7951386">_</span>&nbsp;<span class="op" id="7951388">:=</span>&nbsp;<span class="ident" id="7951391">c0</span><span class="op" id="7951393">.</span><span class="ident" id="7951394">RGBA</span><span class="op" id="7951398">(</span><span class="op" id="7951399">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951404">r1</span><span class="op" id="7951406">,</span>&nbsp;<span class="ident" id="7951408">g1</span><span class="op" id="7951410">,</span>&nbsp;<span class="ident" id="7951412">b1</span><span class="op" id="7951414">,</span>&nbsp;<span class="ident" id="7951416">_</span>&nbsp;<span class="op" id="7951418">:=</span>&nbsp;<span class="ident" id="7951421">c1</span><span class="op" id="7951423">.</span><span class="ident" id="7951424">RGBA</span><span class="op" id="7951428">(</span><span class="op" id="7951429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951434">sum</span>&nbsp;<span class="op" id="7951438">+=</span>&nbsp;<span class="ident" id="7951441">delta</span><span class="op" id="7951446">(</span><span class="ident" id="7951447">r0</span><span class="op" id="7951449">,</span>&nbsp;<span class="ident" id="7951451">r1</span><span class="op" id="7951453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951458">sum</span>&nbsp;<span class="op" id="7951462">+=</span>&nbsp;<span class="ident" id="7951465">delta</span><span class="op" id="7951470">(</span><span class="ident" id="7951471">g0</span><span class="op" id="7951473">,</span>&nbsp;<span class="ident" id="7951475">g1</span><span class="op" id="7951477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951482">sum</span>&nbsp;<span class="op" id="7951486">+=</span>&nbsp;<span class="ident" id="7951489">delta</span><span class="op" id="7951494">(</span><span class="ident" id="7951495">b0</span><span class="op" id="7951497">,</span>&nbsp;<span class="ident" id="7951499">b1</span><span class="op" id="7951501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951506">n</span>&nbsp;<span class="op" id="7951508">+=</span>&nbsp;<span class="num" id="7951511">3</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7951515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7951518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7951521">return</span>&nbsp;<span class="ident" id="7951528">sum</span>&nbsp;<span class="op" id="7951532">/</span>&nbsp;<span class="ident" id="7951534">n</span><br>
<span class="lineno"></span><span class="op" id="7951536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7951539">var</span>&nbsp;<span class="ident" id="7951543">testCase</span>&nbsp;<span class="op" id="7951552">=</span>&nbsp;<span class="op" id="7951554">[</span><span class="op" id="7951555">]</span><span class="keyword" id="7951556">struct</span>&nbsp;<span class="op" id="7951563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951566">filename</span>&nbsp;&nbsp;<span class="builtintype" id="7951576">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951584">tolerance</span>&nbsp;<span class="builtintype" id="7951594">int64</span><br>
<span class="lineno"></span><span class="op" id="7951600">}</span><span class="op" id="7951601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7951604">{</span><span class="string" id="7951605">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7951632">,</span>&nbsp;<span class="num" id="7951634">1</span>&nbsp;<span class="op" id="7951636">&lt;&lt;</span>&nbsp;<span class="num" id="7951639">12</span><span class="op" id="7951641">}</span><span class="op" id="7951642">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7951645">{</span><span class="string" id="7951646">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7951673">,</span>&nbsp;<span class="num" id="7951675">0</span><span class="op" id="7951676">}</span><span class="op" id="7951677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7951680">{</span><span class="string" id="7951681">&#34;../testdata/video-001.interlaced.gif&#34;</span><span class="op" id="7951719">,</span>&nbsp;<span class="num" id="7951721">0</span><span class="op" id="7951722">}</span><span class="op" id="7951723">,</span><br>
<span class="lineno"></span><span class="op" id="7951725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7951728">func</span>&nbsp;<span class="ident" id="7951733">TestWriter</span><span class="op" id="7951743">(</span><span class="ident" id="7951744">t</span>&nbsp;<span class="op" id="7951746">*</span><span class="ident" id="7951747">testing</span><span class="op" id="7951754">.</span><span class="ident" id="7951755">T</span><span class="op" id="7951756">)</span>&nbsp;<span class="op" id="7951758">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7951761">for</span>&nbsp;<span class="ident" id="7951765">_</span><span class="op" id="7951766">,</span>&nbsp;<span class="ident" id="7951768">tc</span>&nbsp;<span class="op" id="7951771">:=</span>&nbsp;<span class="keyword" id="7951774">range</span>&nbsp;<span class="ident" id="7951780">testCase</span>&nbsp;<span class="op" id="7951789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951793">m0</span><span class="op" id="7951795">,</span>&nbsp;<span class="ident" id="7951797">err</span>&nbsp;<span class="op" id="7951801">:=</span>&nbsp;<span class="ident" id="7951804">readImg</span><span class="op" id="7951811">(</span><span class="ident" id="7951812">tc</span><span class="op" id="7951814">.</span><span class="ident" id="7951815">filename</span><span class="op" id="7951823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7951827">if</span>&nbsp;<span class="ident" id="7951830">err</span>&nbsp;<span class="op" id="7951834">!=</span>&nbsp;<span class="builtintype" id="7951837">nil</span>&nbsp;<span class="op" id="7951841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951846">t</span><span class="op" id="7951847">.</span><span class="ident" id="7951848">Error</span><span class="op" id="7951853">(</span><span class="ident" id="7951854">tc</span><span class="op" id="7951856">.</span><span class="ident" id="7951857">filename</span><span class="op" id="7951865">,</span>&nbsp;<span class="ident" id="7951867">err</span><span class="op" id="7951870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7951875">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7951886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7951890">var</span>&nbsp;<span class="ident" id="7951894">buf</span>&nbsp;<span class="ident" id="7951898">bytes</span><span class="op" id="7951903">.</span><span class="ident" id="7951904">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951913">err</span>&nbsp;<span class="op" id="7951917">=</span>&nbsp;<span class="ident" id="7951919">Encode</span><span class="op" id="7951925">(</span><span class="op" id="7951926">&amp;</span><span class="ident" id="7951927">buf</span><span class="op" id="7951930">,</span>&nbsp;<span class="ident" id="7951932">m0</span><span class="op" id="7951934">,</span>&nbsp;<span class="builtintype" id="7951936">nil</span><span class="op" id="7951939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7951943">if</span>&nbsp;<span class="ident" id="7951946">err</span>&nbsp;<span class="op" id="7951950">!=</span>&nbsp;<span class="builtintype" id="7951953">nil</span>&nbsp;<span class="op" id="7951957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7951962">t</span><span class="op" id="7951963">.</span><span class="ident" id="7951964">Error</span><span class="op" id="7951969">(</span><span class="ident" id="7951970">tc</span><span class="op" id="7951972">.</span><span class="ident" id="7951973">filename</span><span class="op" id="7951981">,</span>&nbsp;<span class="ident" id="7951983">err</span><span class="op" id="7951986">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7951991">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7952002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952006">m1</span><span class="op" id="7952008">,</span>&nbsp;<span class="ident" id="7952010">err</span>&nbsp;<span class="op" id="7952014">:=</span>&nbsp;<span class="ident" id="7952017">Decode</span><span class="op" id="7952023">(</span><span class="op" id="7952024">&amp;</span><span class="ident" id="7952025">buf</span><span class="op" id="7952028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7952032">if</span>&nbsp;<span class="ident" id="7952035">err</span>&nbsp;<span class="op" id="7952039">!=</span>&nbsp;<span class="builtintype" id="7952042">nil</span>&nbsp;<span class="op" id="7952046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952051">t</span><span class="op" id="7952052">.</span><span class="ident" id="7952053">Error</span><span class="op" id="7952058">(</span><span class="ident" id="7952059">tc</span><span class="op" id="7952061">.</span><span class="ident" id="7952062">filename</span><span class="op" id="7952070">,</span>&nbsp;<span class="ident" id="7952072">err</span><span class="op" id="7952075">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7952080">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7952091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7952095">if</span>&nbsp;<span class="ident" id="7952098">m0</span><span class="op" id="7952100">.</span><span class="ident" id="7952101">Bounds</span><span class="op" id="7952107">(</span><span class="op" id="7952108">)</span>&nbsp;<span class="op" id="7952110">!=</span>&nbsp;<span class="ident" id="7952113">m1</span><span class="op" id="7952115">.</span><span class="ident" id="7952116">Bounds</span><span class="op" id="7952122">(</span><span class="op" id="7952123">)</span>&nbsp;<span class="op" id="7952125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952130">t</span><span class="op" id="7952131">.</span><span class="ident" id="7952132">Errorf</span><span class="op" id="7952138">(</span><span class="string" id="7952139">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7952169">,</span>&nbsp;<span class="ident" id="7952171">tc</span><span class="op" id="7952173">.</span><span class="ident" id="7952174">filename</span><span class="op" id="7952182">,</span>&nbsp;<span class="ident" id="7952184">m0</span><span class="op" id="7952186">.</span><span class="ident" id="7952187">Bounds</span><span class="op" id="7952193">(</span><span class="op" id="7952194">)</span><span class="op" id="7952195">,</span>&nbsp;<span class="ident" id="7952197">m1</span><span class="op" id="7952199">.</span><span class="ident" id="7952200">Bounds</span><span class="op" id="7952206">(</span><span class="op" id="7952207">)</span><span class="op" id="7952208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7952213">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7952224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7952228">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952283">avgDelta</span>&nbsp;<span class="op" id="7952292">:=</span>&nbsp;<span class="ident" id="7952295">averageDelta</span><span class="op" id="7952307">(</span><span class="ident" id="7952308">m0</span><span class="op" id="7952310">,</span>&nbsp;<span class="ident" id="7952312">m1</span><span class="op" id="7952314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7952318">if</span>&nbsp;<span class="ident" id="7952321">avgDelta</span>&nbsp;<span class="op" id="7952330">&gt;</span>&nbsp;<span class="ident" id="7952332">tc</span><span class="op" id="7952334">.</span><span class="ident" id="7952335">tolerance</span>&nbsp;<span class="op" id="7952345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952350">t</span><span class="op" id="7952351">.</span><span class="ident" id="7952352">Errorf</span><span class="op" id="7952358">(</span><span class="string" id="7952359">&#34;%s:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high.&nbsp;expected:&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7952412">,</span>&nbsp;<span class="ident" id="7952414">tc</span><span class="op" id="7952416">.</span><span class="ident" id="7952417">filename</span><span class="op" id="7952425">,</span>&nbsp;<span class="ident" id="7952427">tc</span><span class="op" id="7952429">.</span><span class="ident" id="7952430">tolerance</span><span class="op" id="7952439">,</span>&nbsp;<span class="ident" id="7952441">avgDelta</span><span class="op" id="7952449">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7952454">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7952465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7952468">}</span><br>
<span class="lineno"></span><span class="op" id="7952470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7952473">func</span>&nbsp;<span class="ident" id="7952478">TestSubImage</span><span class="op" id="7952490">(</span><span class="ident" id="7952491">t</span>&nbsp;<span class="op" id="7952493">*</span><span class="ident" id="7952494">testing</span><span class="op" id="7952501">.</span><span class="ident" id="7952502">T</span><span class="op" id="7952503">)</span>&nbsp;<span class="op" id="7952505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952508">m0</span><span class="op" id="7952510">,</span>&nbsp;<span class="ident" id="7952512">err</span>&nbsp;<span class="op" id="7952516">:=</span>&nbsp;<span class="ident" id="7952519">readImg</span><span class="op" id="7952526">(</span><span class="string" id="7952527">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7952554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7952557">if</span>&nbsp;<span class="ident" id="7952560">err</span>&nbsp;<span class="op" id="7952564">!=</span>&nbsp;<span class="builtintype" id="7952567">nil</span>&nbsp;<span class="op" id="7952571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952575">t</span><span class="op" id="7952576">.</span><span class="ident" id="7952577">Fatalf</span><span class="op" id="7952583">(</span><span class="string" id="7952584">&#34;readImg:&nbsp;%v&#34;</span><span class="op" id="7952597">,</span>&nbsp;<span class="ident" id="7952599">err</span><span class="op" id="7952602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7952605">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952608">m0</span>&nbsp;<span class="op" id="7952611">=</span>&nbsp;<span class="ident" id="7952613">m0</span><span class="op" id="7952615">.</span><span class="op" id="7952616">(</span><span class="op" id="7952617">*</span><span class="ident" id="7952618">image</span><span class="op" id="7952623">.</span><span class="ident" id="7952624">Paletted</span><span class="op" id="7952632">)</span><span class="op" id="7952633">.</span><span class="ident" id="7952634">SubImage</span><span class="op" id="7952642">(</span><span class="ident" id="7952643">image</span><span class="op" id="7952648">.</span><span class="ident" id="7952649">Rect</span><span class="op" id="7952653">(</span><span class="num" id="7952654">0</span><span class="op" id="7952655">,</span>&nbsp;<span class="num" id="7952657">0</span><span class="op" id="7952658">,</span>&nbsp;<span class="num" id="7952660">50</span><span class="op" id="7952662">,</span>&nbsp;<span class="num" id="7952664">30</span><span class="op" id="7952666">)</span><span class="op" id="7952667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7952670">var</span>&nbsp;<span class="ident" id="7952674">buf</span>&nbsp;<span class="ident" id="7952678">bytes</span><span class="op" id="7952683">.</span><span class="ident" id="7952684">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952692">err</span>&nbsp;<span class="op" id="7952696">=</span>&nbsp;<span class="ident" id="7952698">Encode</span><span class="op" id="7952704">(</span><span class="op" id="7952705">&amp;</span><span class="ident" id="7952706">buf</span><span class="op" id="7952709">,</span>&nbsp;<span class="ident" id="7952711">m0</span><span class="op" id="7952713">,</span>&nbsp;<span class="builtintype" id="7952715">nil</span><span class="op" id="7952718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7952721">if</span>&nbsp;<span class="ident" id="7952724">err</span>&nbsp;<span class="op" id="7952728">!=</span>&nbsp;<span class="builtintype" id="7952731">nil</span>&nbsp;<span class="op" id="7952735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952739">t</span><span class="op" id="7952740">.</span><span class="ident" id="7952741">Fatalf</span><span class="op" id="7952747">(</span><span class="string" id="7952748">&#34;Encode:&nbsp;%v&#34;</span><span class="op" id="7952760">,</span>&nbsp;<span class="ident" id="7952762">err</span><span class="op" id="7952765">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7952768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952771">m1</span><span class="op" id="7952773">,</span>&nbsp;<span class="ident" id="7952775">err</span>&nbsp;<span class="op" id="7952779">:=</span>&nbsp;<span class="ident" id="7952782">Decode</span><span class="op" id="7952788">(</span><span class="op" id="7952789">&amp;</span><span class="ident" id="7952790">buf</span><span class="op" id="7952793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7952796">if</span>&nbsp;<span class="ident" id="7952799">err</span>&nbsp;<span class="op" id="7952803">!=</span>&nbsp;<span class="builtintype" id="7952806">nil</span>&nbsp;<span class="op" id="7952810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952814">t</span><span class="op" id="7952815">.</span><span class="ident" id="7952816">Fatalf</span><span class="op" id="7952822">(</span><span class="string" id="7952823">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="7952835">,</span>&nbsp;<span class="ident" id="7952837">err</span><span class="op" id="7952840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7952843">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7952846">if</span>&nbsp;<span class="ident" id="7952849">m0</span><span class="op" id="7952851">.</span><span class="ident" id="7952852">Bounds</span><span class="op" id="7952858">(</span><span class="op" id="7952859">)</span>&nbsp;<span class="op" id="7952861">!=</span>&nbsp;<span class="ident" id="7952864">m1</span><span class="op" id="7952866">.</span><span class="ident" id="7952867">Bounds</span><span class="op" id="7952873">(</span><span class="op" id="7952874">)</span>&nbsp;<span class="op" id="7952876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952880">t</span><span class="op" id="7952881">.</span><span class="ident" id="7952882">Fatalf</span><span class="op" id="7952888">(</span><span class="string" id="7952889">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7952915">,</span>&nbsp;<span class="ident" id="7952917">m0</span><span class="op" id="7952919">.</span><span class="ident" id="7952920">Bounds</span><span class="op" id="7952926">(</span><span class="op" id="7952927">)</span><span class="op" id="7952928">,</span>&nbsp;<span class="ident" id="7952930">m1</span><span class="op" id="7952932">.</span><span class="ident" id="7952933">Bounds</span><span class="op" id="7952939">(</span><span class="op" id="7952940">)</span><span class="op" id="7952941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7952944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7952947">if</span>&nbsp;<span class="ident" id="7952950">averageDelta</span><span class="op" id="7952962">(</span><span class="ident" id="7952963">m0</span><span class="op" id="7952965">,</span>&nbsp;<span class="ident" id="7952967">m1</span><span class="op" id="7952969">)</span>&nbsp;<span class="op" id="7952971">!=</span>&nbsp;<span class="num" id="7952974">0</span>&nbsp;<span class="op" id="7952976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7952980">t</span><span class="op" id="7952981">.</span><span class="ident" id="7952982">Fatalf</span><span class="op" id="7952988">(</span><span class="string" id="7952989">&#34;images&nbsp;differ&#34;</span><span class="op" id="7953004">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7953007">}</span><br>
<span class="lineno"></span><span class="op" id="7953009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7953012">var</span>&nbsp;<span class="ident" id="7953016">frames</span>&nbsp;<span class="op" id="7953023">=</span>&nbsp;<span class="op" id="7953025">[</span><span class="op" id="7953026">]</span><span class="builtintype" id="7953027">string</span><span class="op" id="7953033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953036">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7953063">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953066">&#34;../testdata/video-005.gray.gif&#34;</span><span class="op" id="7953098">,</span><br>
<span class="lineno"></span><span class="op" id="7953100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7953103">func</span>&nbsp;<span class="ident" id="7953108">TestEncodeAll</span><span class="op" id="7953121">(</span><span class="ident" id="7953122">t</span>&nbsp;<span class="op" id="7953124">*</span><span class="ident" id="7953125">testing</span><span class="op" id="7953132">.</span><span class="ident" id="7953133">T</span><span class="op" id="7953134">)</span>&nbsp;<span class="op" id="7953136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953139">g0</span>&nbsp;<span class="op" id="7953142">:=</span>&nbsp;<span class="op" id="7953145">&amp;</span><span class="ident" id="7953146">GIF</span><span class="op" id="7953149">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953153">Image</span><span class="op" id="7953158">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7953164">make</span><span class="op" id="7953168">(</span><span class="op" id="7953169">[</span><span class="op" id="7953170">]</span><span class="op" id="7953171">*</span><span class="ident" id="7953172">image</span><span class="op" id="7953177">.</span><span class="ident" id="7953178">Paletted</span><span class="op" id="7953186">,</span>&nbsp;<span class="builtinfunc" id="7953188">len</span><span class="op" id="7953191">(</span><span class="ident" id="7953192">frames</span><span class="op" id="7953198">)</span><span class="op" id="7953199">)</span><span class="op" id="7953200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953204">Delay</span><span class="op" id="7953209">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7953215">make</span><span class="op" id="7953219">(</span><span class="op" id="7953220">[</span><span class="op" id="7953221">]</span><span class="builtintype" id="7953222">int</span><span class="op" id="7953225">,</span>&nbsp;<span class="builtinfunc" id="7953227">len</span><span class="op" id="7953230">(</span><span class="ident" id="7953231">frames</span><span class="op" id="7953237">)</span><span class="op" id="7953238">)</span><span class="op" id="7953239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953243">LoopCount</span><span class="op" id="7953252">:</span>&nbsp;<span class="num" id="7953254">5</span><span class="op" id="7953255">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7953258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7953261">for</span>&nbsp;<span class="ident" id="7953265">i</span><span class="op" id="7953266">,</span>&nbsp;<span class="ident" id="7953268">f</span>&nbsp;<span class="op" id="7953270">:=</span>&nbsp;<span class="keyword" id="7953273">range</span>&nbsp;<span class="ident" id="7953279">frames</span>&nbsp;<span class="op" id="7953286">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953290">m</span><span class="op" id="7953291">,</span>&nbsp;<span class="ident" id="7953293">err</span>&nbsp;<span class="op" id="7953297">:=</span>&nbsp;<span class="ident" id="7953300">readGIF</span><span class="op" id="7953307">(</span><span class="ident" id="7953308">f</span><span class="op" id="7953309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7953313">if</span>&nbsp;<span class="ident" id="7953316">err</span>&nbsp;<span class="op" id="7953320">!=</span>&nbsp;<span class="builtintype" id="7953323">nil</span>&nbsp;<span class="op" id="7953327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953332">t</span><span class="op" id="7953333">.</span><span class="ident" id="7953334">Fatal</span><span class="op" id="7953339">(</span><span class="ident" id="7953340">f</span><span class="op" id="7953341">,</span>&nbsp;<span class="ident" id="7953343">err</span><span class="op" id="7953346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7953350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953354">g0</span><span class="op" id="7953356">.</span><span class="ident" id="7953357">Image</span><span class="op" id="7953362">[</span><span class="ident" id="7953363">i</span><span class="op" id="7953364">]</span>&nbsp;<span class="op" id="7953366">=</span>&nbsp;<span class="ident" id="7953368">m</span><span class="op" id="7953369">.</span><span class="ident" id="7953370">Image</span><span class="op" id="7953375">[</span><span class="num" id="7953376">0</span><span class="op" id="7953377">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7953380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7953383">var</span>&nbsp;<span class="ident" id="7953387">buf</span>&nbsp;<span class="ident" id="7953391">bytes</span><span class="op" id="7953396">.</span><span class="ident" id="7953397">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7953405">if</span>&nbsp;<span class="ident" id="7953408">err</span>&nbsp;<span class="op" id="7953412">:=</span>&nbsp;<span class="ident" id="7953415">EncodeAll</span><span class="op" id="7953424">(</span><span class="op" id="7953425">&amp;</span><span class="ident" id="7953426">buf</span><span class="op" id="7953429">,</span>&nbsp;<span class="ident" id="7953431">g0</span><span class="op" id="7953433">)</span><span class="op" id="7953434">;</span>&nbsp;<span class="ident" id="7953436">err</span>&nbsp;<span class="op" id="7953440">!=</span>&nbsp;<span class="builtintype" id="7953443">nil</span>&nbsp;<span class="op" id="7953447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953451">t</span><span class="op" id="7953452">.</span><span class="ident" id="7953453">Fatal</span><span class="op" id="7953458">(</span><span class="string" id="7953459">&#34;EncodeAll:&#34;</span><span class="op" id="7953471">,</span>&nbsp;<span class="ident" id="7953473">err</span><span class="op" id="7953476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7953479">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953482">g1</span><span class="op" id="7953484">,</span>&nbsp;<span class="ident" id="7953486">err</span>&nbsp;<span class="op" id="7953490">:=</span>&nbsp;<span class="ident" id="7953493">DecodeAll</span><span class="op" id="7953502">(</span><span class="op" id="7953503">&amp;</span><span class="ident" id="7953504">buf</span><span class="op" id="7953507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7953510">if</span>&nbsp;<span class="ident" id="7953513">err</span>&nbsp;<span class="op" id="7953517">!=</span>&nbsp;<span class="builtintype" id="7953520">nil</span>&nbsp;<span class="op" id="7953524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953528">t</span><span class="op" id="7953529">.</span><span class="ident" id="7953530">Fatal</span><span class="op" id="7953535">(</span><span class="string" id="7953536">&#34;DecodeAll:&#34;</span><span class="op" id="7953548">,</span>&nbsp;<span class="ident" id="7953550">err</span><span class="op" id="7953553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7953556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7953559">if</span>&nbsp;<span class="ident" id="7953562">g0</span><span class="op" id="7953564">.</span><span class="ident" id="7953565">LoopCount</span>&nbsp;<span class="op" id="7953575">!=</span>&nbsp;<span class="ident" id="7953578">g1</span><span class="op" id="7953580">.</span><span class="ident" id="7953581">LoopCount</span>&nbsp;<span class="op" id="7953591">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953595">t</span><span class="op" id="7953596">.</span><span class="ident" id="7953597">Errorf</span><span class="op" id="7953603">(</span><span class="string" id="7953604">&#34;loop&nbsp;counts&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7953635">,</span>&nbsp;<span class="ident" id="7953637">g0</span><span class="op" id="7953639">.</span><span class="ident" id="7953640">LoopCount</span><span class="op" id="7953649">,</span>&nbsp;<span class="ident" id="7953651">g1</span><span class="op" id="7953653">.</span><span class="ident" id="7953654">LoopCount</span><span class="op" id="7953663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7953666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7953669">for</span>&nbsp;<span class="ident" id="7953673">i</span>&nbsp;<span class="op" id="7953675">:=</span>&nbsp;<span class="keyword" id="7953678">range</span>&nbsp;<span class="ident" id="7953684">g0</span><span class="op" id="7953686">.</span><span class="ident" id="7953687">Image</span>&nbsp;<span class="op" id="7953693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953697">m0</span><span class="op" id="7953699">,</span>&nbsp;<span class="ident" id="7953701">m1</span>&nbsp;<span class="op" id="7953704">:=</span>&nbsp;<span class="ident" id="7953707">g0</span><span class="op" id="7953709">.</span><span class="ident" id="7953710">Image</span><span class="op" id="7953715">[</span><span class="ident" id="7953716">i</span><span class="op" id="7953717">]</span><span class="op" id="7953718">,</span>&nbsp;<span class="ident" id="7953720">g1</span><span class="op" id="7953722">.</span><span class="ident" id="7953723">Image</span><span class="op" id="7953728">[</span><span class="ident" id="7953729">i</span><span class="op" id="7953730">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7953734">if</span>&nbsp;<span class="ident" id="7953737">m0</span><span class="op" id="7953739">.</span><span class="ident" id="7953740">Bounds</span><span class="op" id="7953746">(</span><span class="op" id="7953747">)</span>&nbsp;<span class="op" id="7953749">!=</span>&nbsp;<span class="ident" id="7953752">m1</span><span class="op" id="7953754">.</span><span class="ident" id="7953755">Bounds</span><span class="op" id="7953761">(</span><span class="op" id="7953762">)</span>&nbsp;<span class="op" id="7953764">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953769">t</span><span class="op" id="7953770">.</span><span class="ident" id="7953771">Errorf</span><span class="op" id="7953777">(</span><span class="string" id="7953778">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7953808">,</span>&nbsp;<span class="ident" id="7953810">frames</span><span class="op" id="7953816">[</span><span class="ident" id="7953817">i</span><span class="op" id="7953818">]</span><span class="op" id="7953819">,</span>&nbsp;<span class="ident" id="7953821">m0</span><span class="op" id="7953823">.</span><span class="ident" id="7953824">Bounds</span><span class="op" id="7953830">(</span><span class="op" id="7953831">)</span><span class="op" id="7953832">,</span>&nbsp;<span class="ident" id="7953834">m1</span><span class="op" id="7953836">.</span><span class="ident" id="7953837">Bounds</span><span class="op" id="7953843">(</span><span class="op" id="7953844">)</span><span class="op" id="7953845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7953849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953853">d0</span><span class="op" id="7953855">,</span>&nbsp;<span class="ident" id="7953857">d1</span>&nbsp;<span class="op" id="7953860">:=</span>&nbsp;<span class="ident" id="7953863">g0</span><span class="op" id="7953865">.</span><span class="ident" id="7953866">Delay</span><span class="op" id="7953871">[</span><span class="ident" id="7953872">i</span><span class="op" id="7953873">]</span><span class="op" id="7953874">,</span>&nbsp;<span class="ident" id="7953876">g1</span><span class="op" id="7953878">.</span><span class="ident" id="7953879">Delay</span><span class="op" id="7953884">[</span><span class="ident" id="7953885">i</span><span class="op" id="7953886">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7953890">if</span>&nbsp;<span class="ident" id="7953893">d0</span>&nbsp;<span class="op" id="7953896">!=</span>&nbsp;<span class="ident" id="7953899">d1</span>&nbsp;<span class="op" id="7953902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953907">t</span><span class="op" id="7953908">.</span><span class="ident" id="7953909">Errorf</span><span class="op" id="7953915">(</span><span class="string" id="7953916">&#34;%s:&nbsp;delay&nbsp;values&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7953952">,</span>&nbsp;<span class="ident" id="7953954">frames</span><span class="op" id="7953960">[</span><span class="ident" id="7953961">i</span><span class="op" id="7953962">]</span><span class="op" id="7953963">,</span>&nbsp;<span class="ident" id="7953965">d0</span><span class="op" id="7953967">,</span>&nbsp;<span class="ident" id="7953969">d1</span><span class="op" id="7953971">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7953975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7953978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953982">g1</span><span class="op" id="7953984">.</span><span class="ident" id="7953985">Delay</span>&nbsp;<span class="op" id="7953991">=</span>&nbsp;<span class="builtinfunc" id="7953993">make</span><span class="op" id="7953997">(</span><span class="op" id="7953998">[</span><span class="op" id="7953999">]</span><span class="builtintype" id="7954000">int</span><span class="op" id="7954003">,</span>&nbsp;<span class="num" id="7954005">1</span><span class="op" id="7954006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954009">if</span>&nbsp;<span class="ident" id="7954012">err</span>&nbsp;<span class="op" id="7954016">:=</span>&nbsp;<span class="ident" id="7954019">EncodeAll</span><span class="op" id="7954028">(</span><span class="ident" id="7954029">ioutil</span><span class="op" id="7954035">.</span><span class="ident" id="7954036">Discard</span><span class="op" id="7954043">,</span>&nbsp;<span class="ident" id="7954045">g1</span><span class="op" id="7954047">)</span><span class="op" id="7954048">;</span>&nbsp;<span class="ident" id="7954050">err</span>&nbsp;<span class="op" id="7954054">==</span>&nbsp;<span class="builtintype" id="7954057">nil</span>&nbsp;<span class="op" id="7954061">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954065">t</span><span class="op" id="7954066">.</span><span class="ident" id="7954067">Error</span><span class="op" id="7954072">(</span><span class="string" id="7954073">&#34;expected&nbsp;error&nbsp;from&nbsp;mismatched&nbsp;delay&nbsp;and&nbsp;image&nbsp;slice&nbsp;lengths&#34;</span><span class="op" id="7954135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954141">if</span>&nbsp;<span class="ident" id="7954144">err</span>&nbsp;<span class="op" id="7954148">:=</span>&nbsp;<span class="ident" id="7954151">EncodeAll</span><span class="op" id="7954160">(</span><span class="ident" id="7954161">ioutil</span><span class="op" id="7954167">.</span><span class="ident" id="7954168">Discard</span><span class="op" id="7954175">,</span>&nbsp;<span class="op" id="7954177">&amp;</span><span class="ident" id="7954178">GIF</span><span class="op" id="7954181">{</span><span class="op" id="7954182">}</span><span class="op" id="7954183">)</span><span class="op" id="7954184">;</span>&nbsp;<span class="ident" id="7954186">err</span>&nbsp;<span class="op" id="7954190">==</span>&nbsp;<span class="builtintype" id="7954193">nil</span>&nbsp;<span class="op" id="7954197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954201">t</span><span class="op" id="7954202">.</span><span class="ident" id="7954203">Error</span><span class="op" id="7954208">(</span><span class="string" id="7954209">&#34;expected&nbsp;error&nbsp;from&nbsp;providing&nbsp;empty&nbsp;gif&#34;</span><span class="op" id="7954250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954253">}</span><br>
<span class="lineno">175</span><span class="op" id="7954255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7954258">func</span>&nbsp;<span class="ident" id="7954263">BenchmarkEncode</span><span class="op" id="7954278">(</span><span class="ident" id="7954279">b</span>&nbsp;<span class="op" id="7954281">*</span><span class="ident" id="7954282">testing</span><span class="op" id="7954289">.</span><span class="ident" id="7954290">B</span><span class="op" id="7954291">)</span>&nbsp;<span class="op" id="7954293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954296">b</span><span class="op" id="7954297">.</span><span class="ident" id="7954298">StopTimer</span><span class="op" id="7954307">(</span><span class="op" id="7954308">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954312">bo</span>&nbsp;<span class="op" id="7954315">:=</span>&nbsp;<span class="ident" id="7954318">image</span><span class="op" id="7954323">.</span><span class="ident" id="7954324">Rect</span><span class="op" id="7954328">(</span><span class="num" id="7954329">0</span><span class="op" id="7954330">,</span>&nbsp;<span class="num" id="7954332">0</span><span class="op" id="7954333">,</span>&nbsp;<span class="num" id="7954335">640</span><span class="op" id="7954338">,</span>&nbsp;<span class="num" id="7954340">480</span><span class="op" id="7954343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954346">rnd</span>&nbsp;<span class="op" id="7954350">:=</span>&nbsp;<span class="ident" id="7954353">rand</span><span class="op" id="7954357">.</span><span class="ident" id="7954358">New</span><span class="op" id="7954361">(</span><span class="ident" id="7954362">rand</span><span class="op" id="7954366">.</span><span class="ident" id="7954367">NewSource</span><span class="op" id="7954376">(</span><span class="num" id="7954377">123</span><span class="op" id="7954380">)</span><span class="op" id="7954381">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7954385">//&nbsp;Restrict&nbsp;to&nbsp;a&nbsp;256-color&nbsp;paletted&nbsp;image&nbsp;to&nbsp;avoid&nbsp;quantization&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954456">palette</span>&nbsp;<span class="op" id="7954464">:=</span>&nbsp;<span class="builtinfunc" id="7954467">make</span><span class="op" id="7954471">(</span><span class="ident" id="7954472">color</span><span class="op" id="7954477">.</span><span class="ident" id="7954478">Palette</span><span class="op" id="7954485">,</span>&nbsp;<span class="num" id="7954487">256</span><span class="op" id="7954490">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954493">for</span>&nbsp;<span class="ident" id="7954497">i</span>&nbsp;<span class="op" id="7954499">:=</span>&nbsp;<span class="keyword" id="7954502">range</span>&nbsp;<span class="ident" id="7954508">palette</span>&nbsp;<span class="op" id="7954516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954520">palette</span><span class="op" id="7954527">[</span><span class="ident" id="7954528">i</span><span class="op" id="7954529">]</span>&nbsp;<span class="op" id="7954531">=</span>&nbsp;<span class="ident" id="7954533">color</span><span class="op" id="7954538">.</span><span class="ident" id="7954539">RGBA</span><span class="op" id="7954543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7954548">uint8</span><span class="op" id="7954553">(</span><span class="ident" id="7954554">rnd</span><span class="op" id="7954557">.</span><span class="ident" id="7954558">Intn</span><span class="op" id="7954562">(</span><span class="num" id="7954563">256</span><span class="op" id="7954566">)</span><span class="op" id="7954567">)</span><span class="op" id="7954568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7954573">uint8</span><span class="op" id="7954578">(</span><span class="ident" id="7954579">rnd</span><span class="op" id="7954582">.</span><span class="ident" id="7954583">Intn</span><span class="op" id="7954587">(</span><span class="num" id="7954588">256</span><span class="op" id="7954591">)</span><span class="op" id="7954592">)</span><span class="op" id="7954593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7954598">uint8</span><span class="op" id="7954603">(</span><span class="ident" id="7954604">rnd</span><span class="op" id="7954607">.</span><span class="ident" id="7954608">Intn</span><span class="op" id="7954612">(</span><span class="num" id="7954613">256</span><span class="op" id="7954616">)</span><span class="op" id="7954617">)</span><span class="op" id="7954618">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7954623">255</span><span class="op" id="7954626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954636">img</span>&nbsp;<span class="op" id="7954640">:=</span>&nbsp;<span class="ident" id="7954643">image</span><span class="op" id="7954648">.</span><span class="ident" id="7954649">NewPaletted</span><span class="op" id="7954660">(</span><span class="ident" id="7954661">image</span><span class="op" id="7954666">.</span><span class="ident" id="7954667">Rect</span><span class="op" id="7954671">(</span><span class="num" id="7954672">0</span><span class="op" id="7954673">,</span>&nbsp;<span class="num" id="7954675">0</span><span class="op" id="7954676">,</span>&nbsp;<span class="num" id="7954678">640</span><span class="op" id="7954681">,</span>&nbsp;<span class="num" id="7954683">480</span><span class="op" id="7954686">)</span><span class="op" id="7954687">,</span>&nbsp;<span class="ident" id="7954689">palette</span><span class="op" id="7954696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954699">for</span>&nbsp;<span class="ident" id="7954703">y</span>&nbsp;<span class="op" id="7954705">:=</span>&nbsp;<span class="ident" id="7954708">bo</span><span class="op" id="7954710">.</span><span class="ident" id="7954711">Min</span><span class="op" id="7954714">.</span><span class="ident" id="7954715">Y</span><span class="op" id="7954716">;</span>&nbsp;<span class="ident" id="7954718">y</span>&nbsp;<span class="op" id="7954720">&lt;</span>&nbsp;<span class="ident" id="7954722">bo</span><span class="op" id="7954724">.</span><span class="ident" id="7954725">Max</span><span class="op" id="7954728">.</span><span class="ident" id="7954729">Y</span><span class="op" id="7954730">;</span>&nbsp;<span class="ident" id="7954732">y</span><span class="op" id="7954733">++</span>&nbsp;<span class="op" id="7954736">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954740">for</span>&nbsp;<span class="ident" id="7954744">x</span>&nbsp;<span class="op" id="7954746">:=</span>&nbsp;<span class="ident" id="7954749">bo</span><span class="op" id="7954751">.</span><span class="ident" id="7954752">Min</span><span class="op" id="7954755">.</span><span class="ident" id="7954756">X</span><span class="op" id="7954757">;</span>&nbsp;<span class="ident" id="7954759">x</span>&nbsp;<span class="op" id="7954761">&lt;</span>&nbsp;<span class="ident" id="7954763">bo</span><span class="op" id="7954765">.</span><span class="ident" id="7954766">Max</span><span class="op" id="7954769">.</span><span class="ident" id="7954770">X</span><span class="op" id="7954771">;</span>&nbsp;<span class="ident" id="7954773">x</span><span class="op" id="7954774">++</span>&nbsp;<span class="op" id="7954777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954782">img</span><span class="op" id="7954785">.</span><span class="ident" id="7954786">Set</span><span class="op" id="7954789">(</span><span class="ident" id="7954790">x</span><span class="op" id="7954791">,</span>&nbsp;<span class="ident" id="7954793">y</span><span class="op" id="7954794">,</span>&nbsp;<span class="ident" id="7954796">palette</span><span class="op" id="7954803">[</span><span class="ident" id="7954804">rnd</span><span class="op" id="7954807">.</span><span class="ident" id="7954808">Intn</span><span class="op" id="7954812">(</span><span class="num" id="7954813">256</span><span class="op" id="7954816">)</span><span class="op" id="7954817">]</span><span class="op" id="7954818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954829">b</span><span class="op" id="7954830">.</span><span class="ident" id="7954831">SetBytes</span><span class="op" id="7954839">(</span><span class="num" id="7954840">640</span>&nbsp;<span class="op" id="7954844">*</span>&nbsp;<span class="num" id="7954846">480</span>&nbsp;<span class="op" id="7954850">*</span>&nbsp;<span class="num" id="7954852">4</span><span class="op" id="7954853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954856">b</span><span class="op" id="7954857">.</span><span class="ident" id="7954858">StartTimer</span><span class="op" id="7954868">(</span><span class="op" id="7954869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954872">for</span>&nbsp;<span class="ident" id="7954876">i</span>&nbsp;<span class="op" id="7954878">:=</span>&nbsp;<span class="num" id="7954881">0</span><span class="op" id="7954882">;</span>&nbsp;<span class="ident" id="7954884">i</span>&nbsp;<span class="op" id="7954886">&lt;</span>&nbsp;<span class="ident" id="7954888">b</span><span class="op" id="7954889">.</span><span class="ident" id="7954890">N</span><span class="op" id="7954891">;</span>&nbsp;<span class="ident" id="7954893">i</span><span class="op" id="7954894">++</span>&nbsp;<span class="op" id="7954897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954901">Encode</span><span class="op" id="7954907">(</span><span class="ident" id="7954908">ioutil</span><span class="op" id="7954914">.</span><span class="ident" id="7954915">Discard</span><span class="op" id="7954922">,</span>&nbsp;<span class="ident" id="7954924">img</span><span class="op" id="7954927">,</span>&nbsp;<span class="builtintype" id="7954929">nil</span><span class="op" id="7954932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954935">}</span><br>
<span class="lineno">205</span><span class="op" id="7954937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7954940">func</span>&nbsp;<span class="ident" id="7954945">BenchmarkQuantizedEncode</span><span class="op" id="7954969">(</span><span class="ident" id="7954970">b</span>&nbsp;<span class="op" id="7954972">*</span><span class="ident" id="7954973">testing</span><span class="op" id="7954980">.</span><span class="ident" id="7954981">B</span><span class="op" id="7954982">)</span>&nbsp;<span class="op" id="7954984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954987">b</span><span class="op" id="7954988">.</span><span class="ident" id="7954989">StopTimer</span><span class="op" id="7954998">(</span><span class="op" id="7954999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955002">img</span>&nbsp;<span class="op" id="7955006">:=</span>&nbsp;<span class="ident" id="7955009">image</span><span class="op" id="7955014">.</span><span class="ident" id="7955015">NewRGBA</span><span class="op" id="7955022">(</span><span class="ident" id="7955023">image</span><span class="op" id="7955028">.</span><span class="ident" id="7955029">Rect</span><span class="op" id="7955033">(</span><span class="num" id="7955034">0</span><span class="op" id="7955035">,</span>&nbsp;<span class="num" id="7955037">0</span><span class="op" id="7955038">,</span>&nbsp;<span class="num" id="7955040">640</span><span class="op" id="7955043">,</span>&nbsp;<span class="num" id="7955045">480</span><span class="op" id="7955048">)</span><span class="op" id="7955049">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955052">bo</span>&nbsp;<span class="op" id="7955055">:=</span>&nbsp;<span class="ident" id="7955058">img</span><span class="op" id="7955061">.</span><span class="ident" id="7955062">Bounds</span><span class="op" id="7955068">(</span><span class="op" id="7955069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955072">rnd</span>&nbsp;<span class="op" id="7955076">:=</span>&nbsp;<span class="ident" id="7955079">rand</span><span class="op" id="7955083">.</span><span class="ident" id="7955084">New</span><span class="op" id="7955087">(</span><span class="ident" id="7955088">rand</span><span class="op" id="7955092">.</span><span class="ident" id="7955093">NewSource</span><span class="op" id="7955102">(</span><span class="num" id="7955103">123</span><span class="op" id="7955106">)</span><span class="op" id="7955107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7955110">for</span>&nbsp;<span class="ident" id="7955114">y</span>&nbsp;<span class="op" id="7955116">:=</span>&nbsp;<span class="ident" id="7955119">bo</span><span class="op" id="7955121">.</span><span class="ident" id="7955122">Min</span><span class="op" id="7955125">.</span><span class="ident" id="7955126">Y</span><span class="op" id="7955127">;</span>&nbsp;<span class="ident" id="7955129">y</span>&nbsp;<span class="op" id="7955131">&lt;</span>&nbsp;<span class="ident" id="7955133">bo</span><span class="op" id="7955135">.</span><span class="ident" id="7955136">Max</span><span class="op" id="7955139">.</span><span class="ident" id="7955140">Y</span><span class="op" id="7955141">;</span>&nbsp;<span class="ident" id="7955143">y</span><span class="op" id="7955144">++</span>&nbsp;<span class="op" id="7955147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7955151">for</span>&nbsp;<span class="ident" id="7955155">x</span>&nbsp;<span class="op" id="7955157">:=</span>&nbsp;<span class="ident" id="7955160">bo</span><span class="op" id="7955162">.</span><span class="ident" id="7955163">Min</span><span class="op" id="7955166">.</span><span class="ident" id="7955167">X</span><span class="op" id="7955168">;</span>&nbsp;<span class="ident" id="7955170">x</span>&nbsp;<span class="op" id="7955172">&lt;</span>&nbsp;<span class="ident" id="7955174">bo</span><span class="op" id="7955176">.</span><span class="ident" id="7955177">Max</span><span class="op" id="7955180">.</span><span class="ident" id="7955181">X</span><span class="op" id="7955182">;</span>&nbsp;<span class="ident" id="7955184">x</span><span class="op" id="7955185">++</span>&nbsp;<span class="op" id="7955188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955193">img</span><span class="op" id="7955196">.</span><span class="ident" id="7955197">SetRGBA</span><span class="op" id="7955204">(</span><span class="ident" id="7955205">x</span><span class="op" id="7955206">,</span>&nbsp;<span class="ident" id="7955208">y</span><span class="op" id="7955209">,</span>&nbsp;<span class="ident" id="7955211">color</span><span class="op" id="7955216">.</span><span class="ident" id="7955217">RGBA</span><span class="op" id="7955221">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7955227">uint8</span><span class="op" id="7955232">(</span><span class="ident" id="7955233">rnd</span><span class="op" id="7955236">.</span><span class="ident" id="7955237">Intn</span><span class="op" id="7955241">(</span><span class="num" id="7955242">256</span><span class="op" id="7955245">)</span><span class="op" id="7955246">)</span><span class="op" id="7955247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7955253">uint8</span><span class="op" id="7955258">(</span><span class="ident" id="7955259">rnd</span><span class="op" id="7955262">.</span><span class="ident" id="7955263">Intn</span><span class="op" id="7955267">(</span><span class="num" id="7955268">256</span><span class="op" id="7955271">)</span><span class="op" id="7955272">)</span><span class="op" id="7955273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7955279">uint8</span><span class="op" id="7955284">(</span><span class="ident" id="7955285">rnd</span><span class="op" id="7955288">.</span><span class="ident" id="7955289">Intn</span><span class="op" id="7955293">(</span><span class="num" id="7955294">256</span><span class="op" id="7955297">)</span><span class="op" id="7955298">)</span><span class="op" id="7955299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7955305">255</span><span class="op" id="7955308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7955313">}</span><span class="op" id="7955314">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7955318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7955321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955324">b</span><span class="op" id="7955325">.</span><span class="ident" id="7955326">SetBytes</span><span class="op" id="7955334">(</span><span class="num" id="7955335">640</span>&nbsp;<span class="op" id="7955339">*</span>&nbsp;<span class="num" id="7955341">480</span>&nbsp;<span class="op" id="7955345">*</span>&nbsp;<span class="num" id="7955347">4</span><span class="op" id="7955348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955351">b</span><span class="op" id="7955352">.</span><span class="ident" id="7955353">StartTimer</span><span class="op" id="7955363">(</span><span class="op" id="7955364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7955367">for</span>&nbsp;<span class="ident" id="7955371">i</span>&nbsp;<span class="op" id="7955373">:=</span>&nbsp;<span class="num" id="7955376">0</span><span class="op" id="7955377">;</span>&nbsp;<span class="ident" id="7955379">i</span>&nbsp;<span class="op" id="7955381">&lt;</span>&nbsp;<span class="ident" id="7955383">b</span><span class="op" id="7955384">.</span><span class="ident" id="7955385">N</span><span class="op" id="7955386">;</span>&nbsp;<span class="ident" id="7955388">i</span><span class="op" id="7955389">++</span>&nbsp;<span class="op" id="7955392">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955396">Encode</span><span class="op" id="7955402">(</span><span class="ident" id="7955403">ioutil</span><span class="op" id="7955409">.</span><span class="ident" id="7955410">Discard</span><span class="op" id="7955417">,</span>&nbsp;<span class="ident" id="7955419">img</span><span class="op" id="7955422">,</span>&nbsp;<span class="builtintype" id="7955424">nil</span><span class="op" id="7955427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7955430">}</span><br>
<span class="lineno"></span><span class="op" id="7955432">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
