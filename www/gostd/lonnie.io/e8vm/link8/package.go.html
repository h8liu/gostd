<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4816131">package</span>&nbsp;<span class="ident" id="4816139">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4816146">import</span>&nbsp;<span class="op" id="4816153">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816156">&#34;path&#34;</span><br>
<span class="lineno">5</span><span class="op" id="4816163">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4816166">//&nbsp;Package&nbsp;is&nbsp;the&nbsp;compiling&nbsp;object&nbsp;of&nbsp;a&nbsp;package.&nbsp;It&nbsp;is&nbsp;the&nbsp;linking</span><br>
<span class="lineno"></span><span class="comment" id="4816233">//&nbsp;unit&nbsp;for&nbsp;programs.</span><br>
<span class="lineno"></span><span class="keyword" id="4816255">type</span>&nbsp;<span class="ident" id="4816260">Package</span>&nbsp;<span class="keyword" id="4816268">struct</span>&nbsp;<span class="op" id="4816275">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816278">path</span>&nbsp;<span class="builtintype" id="4816283">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816292">requires</span>&nbsp;<span class="op" id="4816301">[</span><span class="op" id="4816302">]</span><span class="op" id="4816303">*</span><span class="ident" id="4816304">Package</span>&nbsp;<span class="comment" id="4816312">//&nbsp;all&nbsp;the&nbsp;packages&nbsp;that&nbsp;requires&nbsp;for&nbsp;building</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816360">symbols</span>&nbsp;&nbsp;<span class="op" id="4816369">[</span><span class="op" id="4816370">]</span><span class="op" id="4816371">*</span><span class="ident" id="4816372">Symbol</span>&nbsp;&nbsp;<span class="comment" id="4816380">//&nbsp;all&nbsp;the&nbsp;symbol&nbsp;objects</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816408">symIndex</span>&nbsp;<span class="keyword" id="4816417">map</span><span class="op" id="4816420">[</span><span class="builtintype" id="4816421">string</span><span class="op" id="4816427">]</span><span class="builtintype" id="4816428">uint32</span>&nbsp;<span class="comment" id="4816435">//&nbsp;map&nbsp;from&nbsp;symbol&nbsp;names&nbsp;to&nbsp;index&nbsp;in&nbsp;symNames</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816482">pkgIndex</span>&nbsp;<span class="keyword" id="4816491">map</span><span class="op" id="4816494">[</span><span class="builtintype" id="4816495">string</span><span class="op" id="4816501">]</span><span class="builtintype" id="4816502">uint32</span>&nbsp;<span class="comment" id="4816509">//&nbsp;map&nbsp;from&nbsp;package&nbsp;path&nbsp;to&nbsp;index&nbsp;in&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816556">funcs</span>&nbsp;<span class="keyword" id="4816562">map</span><span class="op" id="4816565">[</span><span class="builtintype" id="4816566">uint32</span><span class="op" id="4816572">]</span><span class="op" id="4816573">*</span><span class="ident" id="4816574">Func</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816580">vars</span>&nbsp;&nbsp;<span class="keyword" id="4816586">map</span><span class="op" id="4816589">[</span><span class="builtintype" id="4816590">uint32</span><span class="op" id="4816596">]</span><span class="op" id="4816597">*</span><span class="ident" id="4816598">Var</span><br>
<span class="lineno">20</span><span class="op" id="4816602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4816605">//&nbsp;NewPackage&nbsp;creates&nbsp;a&nbsp;new&nbsp;package&nbsp;of&nbsp;path&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="4816652">func</span>&nbsp;<span class="ident" id="4816657">NewPackage</span><span class="op" id="4816667">(</span><span class="ident" id="4816668">p</span>&nbsp;<span class="builtintype" id="4816670">string</span><span class="op" id="4816676">)</span>&nbsp;<span class="op" id="4816678">*</span><span class="ident" id="4816679">Package</span>&nbsp;<span class="op" id="4816687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816690">ret</span>&nbsp;<span class="op" id="4816694">:=</span>&nbsp;<span class="builtinfunc" id="4816697">new</span><span class="op" id="4816700">(</span><span class="ident" id="4816701">Package</span><span class="op" id="4816708">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816711">ret</span><span class="op" id="4816714">.</span><span class="ident" id="4816715">path</span>&nbsp;<span class="op" id="4816720">=</span>&nbsp;<span class="ident" id="4816722">p</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816726">ret</span><span class="op" id="4816729">.</span><span class="ident" id="4816730">symIndex</span>&nbsp;<span class="op" id="4816739">=</span>&nbsp;<span class="builtinfunc" id="4816741">make</span><span class="op" id="4816745">(</span><span class="keyword" id="4816746">map</span><span class="op" id="4816749">[</span><span class="builtintype" id="4816750">string</span><span class="op" id="4816756">]</span><span class="builtintype" id="4816757">uint32</span><span class="op" id="4816763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816766">ret</span><span class="op" id="4816769">.</span><span class="ident" id="4816770">pkgIndex</span>&nbsp;<span class="op" id="4816779">=</span>&nbsp;<span class="builtinfunc" id="4816781">make</span><span class="op" id="4816785">(</span><span class="keyword" id="4816786">map</span><span class="op" id="4816789">[</span><span class="builtintype" id="4816790">string</span><span class="op" id="4816796">]</span><span class="builtintype" id="4816797">uint32</span><span class="op" id="4816803">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816807">ret</span><span class="op" id="4816810">.</span><span class="ident" id="4816811">funcs</span>&nbsp;<span class="op" id="4816817">=</span>&nbsp;<span class="builtinfunc" id="4816819">make</span><span class="op" id="4816823">(</span><span class="keyword" id="4816824">map</span><span class="op" id="4816827">[</span><span class="builtintype" id="4816828">uint32</span><span class="op" id="4816834">]</span><span class="op" id="4816835">*</span><span class="ident" id="4816836">Func</span><span class="op" id="4816840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816843">ret</span><span class="op" id="4816846">.</span><span class="ident" id="4816847">vars</span>&nbsp;<span class="op" id="4816852">=</span>&nbsp;<span class="builtinfunc" id="4816854">make</span><span class="op" id="4816858">(</span><span class="keyword" id="4816859">map</span><span class="op" id="4816862">[</span><span class="builtintype" id="4816863">uint32</span><span class="op" id="4816869">]</span><span class="op" id="4816870">*</span><span class="ident" id="4816871">Var</span><span class="op" id="4816874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816878">index</span>&nbsp;<span class="op" id="4816884">:=</span>&nbsp;<span class="ident" id="4816887">ret</span><span class="op" id="4816890">.</span><span class="ident" id="4816891">Require</span><span class="op" id="4816898">(</span><span class="ident" id="4816899">ret</span><span class="op" id="4816902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816905">if</span>&nbsp;<span class="ident" id="4816908">index</span>&nbsp;<span class="op" id="4816914">!=</span>&nbsp;<span class="num" id="4816917">0</span>&nbsp;<span class="op" id="4816919">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4816923">panic</span><span class="op" id="4816928">(</span><span class="string" id="4816929">&#34;bug&#34;</span><span class="op" id="4816934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4816937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816941">return</span>&nbsp;<span class="ident" id="4816948">ret</span><br>
<span class="lineno"></span><span class="op" id="4816952">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4816955">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;package&#39;s&nbsp;default&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4816999">func</span>&nbsp;<span class="op" id="4817004">(</span><span class="ident" id="4817005">p</span>&nbsp;<span class="op" id="4817007">*</span><span class="ident" id="4817008">Package</span><span class="op" id="4817015">)</span>&nbsp;<span class="ident" id="4817017">Name</span><span class="op" id="4817021">(</span><span class="op" id="4817022">)</span>&nbsp;<span class="builtintype" id="4817024">string</span>&nbsp;<span class="op" id="4817031">{</span>&nbsp;<span class="keyword" id="4817033">return</span>&nbsp;<span class="ident" id="4817040">path</span><span class="op" id="4817044">.</span><span class="ident" id="4817045">Base</span><span class="op" id="4817049">(</span><span class="ident" id="4817050">p</span><span class="op" id="4817051">.</span><span class="ident" id="4817052">path</span><span class="op" id="4817056">)</span>&nbsp;<span class="op" id="4817058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4817061">//&nbsp;Path&nbsp;returns&nbsp;the&nbsp;package&#39;s&nbsp;path&nbsp;string.</span><br>
<span class="lineno">45</span><span class="keyword" id="4817104">func</span>&nbsp;<span class="op" id="4817109">(</span><span class="ident" id="4817110">p</span>&nbsp;<span class="op" id="4817112">*</span><span class="ident" id="4817113">Package</span><span class="op" id="4817120">)</span>&nbsp;<span class="ident" id="4817122">Path</span><span class="op" id="4817126">(</span><span class="op" id="4817127">)</span>&nbsp;<span class="builtintype" id="4817129">string</span>&nbsp;<span class="op" id="4817136">{</span>&nbsp;<span class="keyword" id="4817138">return</span>&nbsp;<span class="ident" id="4817145">p</span><span class="op" id="4817146">.</span><span class="ident" id="4817147">path</span>&nbsp;<span class="op" id="4817152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4817155">//&nbsp;Require&nbsp;assigns&nbsp;a&nbsp;relative&nbsp;index&nbsp;for&nbsp;the&nbsp;required&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4817217">func</span>&nbsp;<span class="op" id="4817222">(</span><span class="ident" id="4817223">p</span>&nbsp;<span class="op" id="4817225">*</span><span class="ident" id="4817226">Package</span><span class="op" id="4817233">)</span>&nbsp;<span class="ident" id="4817235">Require</span><span class="op" id="4817242">(</span><span class="ident" id="4817243">req</span>&nbsp;<span class="op" id="4817247">*</span><span class="ident" id="4817248">Package</span><span class="op" id="4817255">)</span>&nbsp;<span class="builtintype" id="4817257">uint32</span>&nbsp;<span class="op" id="4817264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817267">if</span>&nbsp;<span class="ident" id="4817270">index</span><span class="op" id="4817275">,</span>&nbsp;<span class="ident" id="4817277">found</span>&nbsp;<span class="op" id="4817283">:=</span>&nbsp;<span class="ident" id="4817286">p</span><span class="op" id="4817287">.</span><span class="ident" id="4817288">pkgIndex</span><span class="op" id="4817296">[</span><span class="ident" id="4817297">req</span><span class="op" id="4817300">.</span><span class="ident" id="4817301">path</span><span class="op" id="4817305">]</span><span class="op" id="4817306">;</span>&nbsp;<span class="ident" id="4817308">found</span>&nbsp;<span class="op" id="4817314">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817318">return</span>&nbsp;<span class="ident" id="4817325">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817336">index</span>&nbsp;<span class="op" id="4817342">:=</span>&nbsp;<span class="builtintype" id="4817345">uint32</span><span class="op" id="4817351">(</span><span class="builtinfunc" id="4817352">len</span><span class="op" id="4817355">(</span><span class="ident" id="4817356">p</span><span class="op" id="4817357">.</span><span class="ident" id="4817358">requires</span><span class="op" id="4817366">)</span><span class="op" id="4817367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817370">p</span><span class="op" id="4817371">.</span><span class="ident" id="4817372">pkgIndex</span><span class="op" id="4817380">[</span><span class="ident" id="4817381">req</span><span class="op" id="4817384">.</span><span class="ident" id="4817385">path</span><span class="op" id="4817389">]</span>&nbsp;<span class="op" id="4817391">=</span>&nbsp;<span class="ident" id="4817393">index</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817400">p</span><span class="op" id="4817401">.</span><span class="ident" id="4817402">requires</span>&nbsp;<span class="op" id="4817411">=</span>&nbsp;<span class="builtinfunc" id="4817413">append</span><span class="op" id="4817419">(</span><span class="ident" id="4817420">p</span><span class="op" id="4817421">.</span><span class="ident" id="4817422">requires</span><span class="op" id="4817430">,</span>&nbsp;<span class="ident" id="4817432">req</span><span class="op" id="4817435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817438">return</span>&nbsp;<span class="ident" id="4817445">index</span><br>
<span class="lineno"></span><span class="op" id="4817451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4817454">//&nbsp;PkgIndex&nbsp;returns&nbsp;the&nbsp;package&nbsp;imported&nbsp;and&nbsp;also&nbsp;its&nbsp;import</span><br>
<span class="lineno">60</span><span class="comment" id="4817515">//&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="4817525">func</span>&nbsp;<span class="op" id="4817530">(</span><span class="ident" id="4817531">p</span>&nbsp;<span class="op" id="4817533">*</span><span class="ident" id="4817534">Package</span><span class="op" id="4817541">)</span>&nbsp;<span class="ident" id="4817543">PkgIndex</span><span class="op" id="4817551">(</span><span class="ident" id="4817552">name</span>&nbsp;<span class="builtintype" id="4817557">string</span><span class="op" id="4817563">)</span>&nbsp;<span class="op" id="4817565">(</span><span class="op" id="4817566">*</span><span class="ident" id="4817567">Package</span><span class="op" id="4817574">,</span>&nbsp;<span class="builtintype" id="4817576">uint32</span><span class="op" id="4817582">)</span>&nbsp;<span class="op" id="4817584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817587">index</span><span class="op" id="4817592">,</span>&nbsp;<span class="ident" id="4817594">found</span>&nbsp;<span class="op" id="4817600">:=</span>&nbsp;<span class="ident" id="4817603">p</span><span class="op" id="4817604">.</span><span class="ident" id="4817605">pkgIndex</span><span class="op" id="4817613">[</span><span class="ident" id="4817614">name</span><span class="op" id="4817618">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817621">if</span>&nbsp;<span class="op" id="4817624">!</span><span class="ident" id="4817625">found</span>&nbsp;<span class="op" id="4817631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817635">return</span>&nbsp;<span class="ident" id="4817642">nil</span><span class="op" id="4817645">,</span>&nbsp;<span class="num" id="4817647">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817654">return</span>&nbsp;<span class="ident" id="4817661">p</span><span class="op" id="4817662">.</span><span class="ident" id="4817663">requires</span><span class="op" id="4817671">[</span><span class="ident" id="4817672">index</span><span class="op" id="4817677">]</span><span class="op" id="4817678">,</span>&nbsp;<span class="ident" id="4817680">index</span><br>
<span class="lineno"></span><span class="op" id="4817686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="4817689">//&nbsp;SymIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;a&nbsp;symbol&nbsp;in&nbsp;the&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="4817747">//&nbsp;It&nbsp;panics&nbsp;when&nbsp;the&nbsp;symbol&nbsp;is&nbsp;not&nbsp;Declare()&#39;d&nbsp;yet.</span><br>
<span class="lineno"></span><span class="keyword" id="4817800">func</span>&nbsp;<span class="op" id="4817805">(</span><span class="ident" id="4817806">p</span>&nbsp;<span class="op" id="4817808">*</span><span class="ident" id="4817809">Package</span><span class="op" id="4817816">)</span>&nbsp;<span class="ident" id="4817818">SymIndex</span><span class="op" id="4817826">(</span><span class="ident" id="4817827">name</span>&nbsp;<span class="builtintype" id="4817832">string</span><span class="op" id="4817838">)</span>&nbsp;<span class="builtintype" id="4817840">uint32</span>&nbsp;<span class="op" id="4817847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817850">ret</span><span class="op" id="4817853">,</span>&nbsp;<span class="ident" id="4817855">found</span>&nbsp;<span class="op" id="4817861">:=</span>&nbsp;<span class="ident" id="4817864">p</span><span class="op" id="4817865">.</span><span class="ident" id="4817866">symIndex</span><span class="op" id="4817874">[</span><span class="ident" id="4817875">name</span><span class="op" id="4817879">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817882">if</span>&nbsp;<span class="op" id="4817885">!</span><span class="ident" id="4817886">found</span>&nbsp;<span class="op" id="4817892">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4817896">panic</span><span class="op" id="4817901">(</span><span class="string" id="4817902">&#34;not&nbsp;found&#34;</span><span class="op" id="4817913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817919">return</span>&nbsp;<span class="ident" id="4817926">ret</span><br>
<span class="lineno"></span><span class="op" id="4817930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4817933">//&nbsp;Declare&nbsp;declares&nbsp;a&nbsp;symbol&nbsp;and&nbsp;assigns&nbsp;a&nbsp;symbol&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="4817990">func</span>&nbsp;<span class="op" id="4817995">(</span><span class="ident" id="4817996">p</span>&nbsp;<span class="op" id="4817998">*</span><span class="ident" id="4817999">Package</span><span class="op" id="4818006">)</span>&nbsp;<span class="ident" id="4818008">Declare</span><span class="op" id="4818015">(</span><span class="ident" id="4818016">s</span>&nbsp;<span class="op" id="4818018">*</span><span class="ident" id="4818019">Symbol</span><span class="op" id="4818025">)</span>&nbsp;<span class="builtintype" id="4818027">uint32</span>&nbsp;<span class="op" id="4818034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818037">_</span><span class="op" id="4818038">,</span>&nbsp;<span class="ident" id="4818040">found</span>&nbsp;<span class="op" id="4818046">:=</span>&nbsp;<span class="ident" id="4818049">p</span><span class="op" id="4818050">.</span><span class="ident" id="4818051">symIndex</span><span class="op" id="4818059">[</span><span class="ident" id="4818060">s</span><span class="op" id="4818061">.</span><span class="ident" id="4818062">Name</span><span class="op" id="4818066">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818069">if</span>&nbsp;<span class="ident" id="4818072">found</span>&nbsp;<span class="op" id="4818078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4818082">panic</span><span class="op" id="4818087">(</span><span class="string" id="4818088">&#34;redeclaring&#34;</span><span class="op" id="4818101">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818108">index</span>&nbsp;<span class="op" id="4818114">:=</span>&nbsp;<span class="builtintype" id="4818117">uint32</span><span class="op" id="4818123">(</span><span class="builtinfunc" id="4818124">len</span><span class="op" id="4818127">(</span><span class="ident" id="4818128">p</span><span class="op" id="4818129">.</span><span class="ident" id="4818130">symbols</span><span class="op" id="4818137">)</span><span class="op" id="4818138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818141">p</span><span class="op" id="4818142">.</span><span class="ident" id="4818143">symIndex</span><span class="op" id="4818151">[</span><span class="ident" id="4818152">s</span><span class="op" id="4818153">.</span><span class="ident" id="4818154">Name</span><span class="op" id="4818158">]</span>&nbsp;<span class="op" id="4818160">=</span>&nbsp;<span class="ident" id="4818162">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818169">p</span><span class="op" id="4818170">.</span><span class="ident" id="4818171">symbols</span>&nbsp;<span class="op" id="4818179">=</span>&nbsp;<span class="builtinfunc" id="4818181">append</span><span class="op" id="4818187">(</span><span class="ident" id="4818188">p</span><span class="op" id="4818189">.</span><span class="ident" id="4818190">symbols</span><span class="op" id="4818197">,</span>&nbsp;<span class="ident" id="4818199">s</span><span class="op" id="4818200">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818203">return</span>&nbsp;<span class="ident" id="4818210">index</span><br>
<span class="lineno"></span><span class="op" id="4818216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4818219">//&nbsp;Query&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;with&nbsp;the&nbsp;particular&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4818273">func</span>&nbsp;<span class="op" id="4818278">(</span><span class="ident" id="4818279">p</span>&nbsp;<span class="op" id="4818281">*</span><span class="ident" id="4818282">Package</span><span class="op" id="4818289">)</span>&nbsp;<span class="ident" id="4818291">Query</span><span class="op" id="4818296">(</span><span class="ident" id="4818297">name</span>&nbsp;<span class="builtintype" id="4818302">string</span><span class="op" id="4818308">)</span>&nbsp;<span class="op" id="4818310">(</span><span class="op" id="4818311">*</span><span class="ident" id="4818312">Symbol</span><span class="op" id="4818318">,</span>&nbsp;<span class="builtintype" id="4818320">uint32</span><span class="op" id="4818326">)</span>&nbsp;<span class="op" id="4818328">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818331">index</span><span class="op" id="4818336">,</span>&nbsp;<span class="ident" id="4818338">found</span>&nbsp;<span class="op" id="4818344">:=</span>&nbsp;<span class="ident" id="4818347">p</span><span class="op" id="4818348">.</span><span class="ident" id="4818349">symIndex</span><span class="op" id="4818357">[</span><span class="ident" id="4818358">name</span><span class="op" id="4818362">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818365">if</span>&nbsp;<span class="op" id="4818368">!</span><span class="ident" id="4818369">found</span>&nbsp;<span class="op" id="4818375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818379">return</span>&nbsp;<span class="ident" id="4818386">nil</span><span class="op" id="4818389">,</span>&nbsp;<span class="num" id="4818391">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818398">return</span>&nbsp;<span class="ident" id="4818405">p</span><span class="op" id="4818406">.</span><span class="ident" id="4818407">symbols</span><span class="op" id="4818414">[</span><span class="ident" id="4818415">index</span><span class="op" id="4818420">]</span><span class="op" id="4818421">,</span>&nbsp;<span class="ident" id="4818423">index</span><br>
<span class="lineno"></span><span class="op" id="4818429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4818432">//&nbsp;DefineFunc&nbsp;instantiates&nbsp;a&nbsp;function&nbsp;object&nbsp;for&nbsp;a&nbsp;particular&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="4818501">func</span>&nbsp;<span class="op" id="4818506">(</span><span class="ident" id="4818507">p</span>&nbsp;<span class="op" id="4818509">*</span><span class="ident" id="4818510">Package</span><span class="op" id="4818517">)</span>&nbsp;<span class="ident" id="4818519">DefineFunc</span><span class="op" id="4818529">(</span><span class="ident" id="4818530">index</span>&nbsp;<span class="builtintype" id="4818536">uint32</span><span class="op" id="4818542">,</span>&nbsp;<span class="ident" id="4818544">f</span>&nbsp;<span class="op" id="4818546">*</span><span class="ident" id="4818547">Func</span><span class="op" id="4818551">)</span>&nbsp;<span class="op" id="4818553">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818556">sym</span>&nbsp;<span class="op" id="4818560">:=</span>&nbsp;<span class="ident" id="4818563">p</span><span class="op" id="4818564">.</span><span class="ident" id="4818565">symbols</span><span class="op" id="4818572">[</span><span class="ident" id="4818573">index</span><span class="op" id="4818578">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818581">if</span>&nbsp;<span class="ident" id="4818584">sym</span><span class="op" id="4818587">.</span><span class="ident" id="4818588">Type</span>&nbsp;<span class="op" id="4818593">!=</span>&nbsp;<span class="ident" id="4818596">SymFunc</span>&nbsp;<span class="op" id="4818604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4818608">panic</span><span class="op" id="4818613">(</span><span class="string" id="4818614">&#34;not&nbsp;a&nbsp;function&#34;</span><span class="op" id="4818630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818637">p</span><span class="op" id="4818638">.</span><span class="ident" id="4818639">funcs</span><span class="op" id="4818644">[</span><span class="ident" id="4818645">index</span><span class="op" id="4818650">]</span>&nbsp;<span class="op" id="4818652">=</span>&nbsp;<span class="ident" id="4818654">f</span><br>
<span class="lineno"></span><span class="op" id="4818656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4818659">//&nbsp;DefineVar&nbsp;instantiates&nbsp;a&nbsp;variable&nbsp;object&nbsp;for&nbsp;a&nbsp;particular&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="4818727">func</span>&nbsp;<span class="op" id="4818732">(</span><span class="ident" id="4818733">p</span>&nbsp;<span class="op" id="4818735">*</span><span class="ident" id="4818736">Package</span><span class="op" id="4818743">)</span>&nbsp;<span class="ident" id="4818745">DefineVar</span><span class="op" id="4818754">(</span><span class="ident" id="4818755">index</span>&nbsp;<span class="builtintype" id="4818761">uint32</span><span class="op" id="4818767">,</span>&nbsp;<span class="ident" id="4818769">v</span>&nbsp;<span class="op" id="4818771">*</span><span class="ident" id="4818772">Var</span><span class="op" id="4818775">)</span>&nbsp;<span class="op" id="4818777">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818780">sym</span>&nbsp;<span class="op" id="4818784">:=</span>&nbsp;<span class="ident" id="4818787">p</span><span class="op" id="4818788">.</span><span class="ident" id="4818789">symbols</span><span class="op" id="4818796">[</span><span class="ident" id="4818797">index</span><span class="op" id="4818802">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818805">if</span>&nbsp;<span class="ident" id="4818808">sym</span><span class="op" id="4818811">.</span><span class="ident" id="4818812">Type</span>&nbsp;<span class="op" id="4818817">!=</span>&nbsp;<span class="ident" id="4818820">SymVar</span>&nbsp;<span class="op" id="4818827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4818831">panic</span><span class="op" id="4818836">(</span><span class="string" id="4818837">&#34;not&nbsp;a&nbsp;var&#34;</span><span class="op" id="4818848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818855">p</span><span class="op" id="4818856">.</span><span class="ident" id="4818857">vars</span><span class="op" id="4818861">[</span><span class="ident" id="4818862">index</span><span class="op" id="4818867">]</span>&nbsp;<span class="op" id="4818869">=</span>&nbsp;<span class="ident" id="4818871">v</span><br>
<span class="lineno"></span><span class="op" id="4818873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4818876">//&nbsp;Func&nbsp;returns&nbsp;the&nbsp;function&nbsp;of&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="4818915">func</span>&nbsp;<span class="op" id="4818920">(</span><span class="ident" id="4818921">p</span>&nbsp;<span class="op" id="4818923">*</span><span class="ident" id="4818924">Package</span><span class="op" id="4818931">)</span>&nbsp;<span class="ident" id="4818933">Func</span><span class="op" id="4818937">(</span><span class="ident" id="4818938">index</span>&nbsp;<span class="builtintype" id="4818944">uint32</span><span class="op" id="4818950">)</span>&nbsp;<span class="op" id="4818952">*</span><span class="ident" id="4818953">Func</span>&nbsp;<span class="op" id="4818958">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818961">ret</span><span class="op" id="4818964">,</span>&nbsp;<span class="ident" id="4818966">found</span>&nbsp;<span class="op" id="4818972">:=</span>&nbsp;<span class="ident" id="4818975">p</span><span class="op" id="4818976">.</span><span class="ident" id="4818977">funcs</span><span class="op" id="4818982">[</span><span class="ident" id="4818983">index</span><span class="op" id="4818988">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818991">if</span>&nbsp;<span class="op" id="4818994">!</span><span class="ident" id="4818995">found</span>&nbsp;<span class="op" id="4819001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4819005">panic</span><span class="op" id="4819010">(</span><span class="string" id="4819011">&#34;not&nbsp;found&#34;</span><span class="op" id="4819022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819028">return</span>&nbsp;<span class="ident" id="4819035">ret</span><br>
<span class="lineno">130</span><span class="op" id="4819039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4819042">//&nbsp;Var&nbsp;returns&nbsp;the&nbsp;variable&nbsp;of&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="4819080">func</span>&nbsp;<span class="op" id="4819085">(</span><span class="ident" id="4819086">p</span>&nbsp;<span class="op" id="4819088">*</span><span class="ident" id="4819089">Package</span><span class="op" id="4819096">)</span>&nbsp;<span class="ident" id="4819098">Var</span><span class="op" id="4819101">(</span><span class="ident" id="4819102">index</span>&nbsp;<span class="builtintype" id="4819108">uint32</span><span class="op" id="4819114">)</span>&nbsp;<span class="op" id="4819116">*</span><span class="ident" id="4819117">Var</span>&nbsp;<span class="op" id="4819121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819124">ret</span><span class="op" id="4819127">,</span>&nbsp;<span class="ident" id="4819129">found</span>&nbsp;<span class="op" id="4819135">:=</span>&nbsp;<span class="ident" id="4819138">p</span><span class="op" id="4819139">.</span><span class="ident" id="4819140">vars</span><span class="op" id="4819144">[</span><span class="ident" id="4819145">index</span><span class="op" id="4819150">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819153">if</span>&nbsp;<span class="op" id="4819156">!</span><span class="ident" id="4819157">found</span>&nbsp;<span class="op" id="4819163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4819167">panic</span><span class="op" id="4819172">(</span><span class="string" id="4819173">&#34;not&nbsp;found&#34;</span><span class="op" id="4819184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819190">return</span>&nbsp;<span class="ident" id="4819197">ret</span><br>
<span class="lineno"></span><span class="op" id="4819201">}</span>
</div>
</body>
</html>
