<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html" class="current">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6152976">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6153031">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6153085">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6153136">//&nbsp;Package&nbsp;testing&nbsp;provides&nbsp;support&nbsp;for&nbsp;automated&nbsp;testing&nbsp;of&nbsp;Go&nbsp;packages.</span><br>
<span class="lineno"></span><span class="comment" id="6153210">//&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;in&nbsp;concert&nbsp;with&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command,&nbsp;which&nbsp;automates</span><br>
<span class="lineno"></span><span class="comment" id="6153296">//&nbsp;execution&nbsp;of&nbsp;any&nbsp;function&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6153337">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestXxx(*testing.T)</span><br>
<span class="lineno"></span><span class="comment" id="6153369">//&nbsp;where&nbsp;Xxx&nbsp;can&nbsp;be&nbsp;any&nbsp;alphanumeric&nbsp;string&nbsp;(but&nbsp;the&nbsp;first&nbsp;letter&nbsp;must&nbsp;not&nbsp;be&nbsp;in</span><br>
<span class="lineno">10</span><span class="comment" id="6153450">//&nbsp;[a-z])&nbsp;and&nbsp;serves&nbsp;to&nbsp;identify&nbsp;the&nbsp;test&nbsp;routine.</span><br>
<span class="lineno"></span><span class="comment" id="6153501">//</span><br>
<span class="lineno"></span><span class="comment" id="6153504">//&nbsp;Within&nbsp;these&nbsp;functions,&nbsp;use&nbsp;the&nbsp;Error,&nbsp;Fail&nbsp;or&nbsp;related&nbsp;methods&nbsp;to&nbsp;signal&nbsp;failure.</span><br>
<span class="lineno"></span><span class="comment" id="6153589">//</span><br>
<span class="lineno"></span><span class="comment" id="6153592">//&nbsp;To&nbsp;write&nbsp;a&nbsp;new&nbsp;test&nbsp;suite,&nbsp;create&nbsp;a&nbsp;file&nbsp;whose&nbsp;name&nbsp;ends&nbsp;_test.go&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="6153666">//&nbsp;contains&nbsp;the&nbsp;TestXxx&nbsp;functions&nbsp;as&nbsp;described&nbsp;here.&nbsp;Put&nbsp;the&nbsp;file&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="6153744">//&nbsp;package&nbsp;as&nbsp;the&nbsp;one&nbsp;being&nbsp;tested.&nbsp;The&nbsp;file&nbsp;will&nbsp;be&nbsp;excluded&nbsp;from&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="6153819">//&nbsp;package&nbsp;builds&nbsp;but&nbsp;will&nbsp;be&nbsp;included&nbsp;when&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span><span class="comment" id="6153895">//&nbsp;For&nbsp;more&nbsp;detail,&nbsp;run&nbsp;``go&nbsp;help&nbsp;test&#39;&#39;&nbsp;and&nbsp;``go&nbsp;help&nbsp;testflag&#39;&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6153962">//</span><br>
<span class="lineno">20</span><span class="comment" id="6153965">//&nbsp;Tests&nbsp;and&nbsp;benchmarks&nbsp;may&nbsp;be&nbsp;skipped&nbsp;if&nbsp;not&nbsp;applicable&nbsp;with&nbsp;a&nbsp;call&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6154037">//&nbsp;the&nbsp;Skip&nbsp;method&nbsp;of&nbsp;*T&nbsp;and&nbsp;*B:</span><br>
<span class="lineno"></span><span class="comment" id="6154070">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestTimeConsuming(t&nbsp;*testing.T)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6154116">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;testing.Short()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6154148">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Skip(&#34;skipping&nbsp;test&nbsp;in&nbsp;short&nbsp;mode.&#34;)</span><br>
<span class="lineno">25</span><span class="comment" id="6154202">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6154215">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6154230">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6154239">//</span><br>
<span class="lineno"></span><span class="comment" id="6154242">//&nbsp;Benchmarks</span><br>
<span class="lineno">30</span><span class="comment" id="6154256">//</span><br>
<span class="lineno"></span><span class="comment" id="6154259">//&nbsp;Functions&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6154284">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkXxx(*testing.B)</span><br>
<span class="lineno"></span><span class="comment" id="6154321">//&nbsp;are&nbsp;considered&nbsp;benchmarks,&nbsp;and&nbsp;are&nbsp;executed&nbsp;by&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="6154398">//&nbsp;its&nbsp;-bench&nbsp;flag&nbsp;is&nbsp;provided.&nbsp;Benchmarks&nbsp;are&nbsp;run&nbsp;sequentially.</span><br>
<span class="lineno">35</span><span class="comment" id="6154463">//</span><br>
<span class="lineno"></span><span class="comment" id="6154466">//&nbsp;For&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;testing&nbsp;flags,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="6154513">//&nbsp;http://golang.org/cmd/go/#hdr-Description_of_testing_flags.</span><br>
<span class="lineno"></span><span class="comment" id="6154576">//</span><br>
<span class="lineno"></span><span class="comment" id="6154579">//&nbsp;A&nbsp;sample&nbsp;benchmark&nbsp;function&nbsp;looks&nbsp;like&nbsp;this:</span><br>
<span class="lineno">40</span><span class="comment" id="6154627">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkHello(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6154670">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6154708">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Sprintf(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6154744">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6154757">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">45</span><span class="comment" id="6154766">//</span><br>
<span class="lineno"></span><span class="comment" id="6154769">//&nbsp;The&nbsp;benchmark&nbsp;function&nbsp;must&nbsp;run&nbsp;the&nbsp;target&nbsp;code&nbsp;b.N&nbsp;times.</span><br>
<span class="lineno"></span><span class="comment" id="6154831">//&nbsp;During&nbsp;benchark&nbsp;execution,&nbsp;b.N&nbsp;is&nbsp;adjusted&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;lasts</span><br>
<span class="lineno"></span><span class="comment" id="6154912">//&nbsp;long&nbsp;enough&nbsp;to&nbsp;be&nbsp;timed&nbsp;reliably.&nbsp;&nbsp;The&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="6154961">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;10000000&nbsp;&nbsp;&nbsp;&nbsp;282&nbsp;ns/op</span><br>
<span class="lineno">50</span><span class="comment" id="6155008">//&nbsp;means&nbsp;that&nbsp;the&nbsp;loop&nbsp;ran&nbsp;10000000&nbsp;times&nbsp;at&nbsp;a&nbsp;speed&nbsp;of&nbsp;282&nbsp;ns&nbsp;per&nbsp;loop.</span><br>
<span class="lineno"></span><span class="comment" id="6155081">//</span><br>
<span class="lineno"></span><span class="comment" id="6155084">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;some&nbsp;expensive&nbsp;setup&nbsp;before&nbsp;running,&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6155155">//&nbsp;may&nbsp;be&nbsp;reset:</span><br>
<span class="lineno"></span><span class="comment" id="6155172">//</span><br>
<span class="lineno">55</span><span class="comment" id="6155175">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkBigLen(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6155219">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big&nbsp;:=&nbsp;NewBig()</span><br>
<span class="lineno"></span><span class="comment" id="6155246">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.ResetTimer()</span><br>
<span class="lineno"></span><span class="comment" id="6155272">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6155310">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big.Len()</span><br>
<span class="lineno">60</span><span class="comment" id="6155335">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6155348">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6155357">//</span><br>
<span class="lineno"></span><span class="comment" id="6155360">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;to&nbsp;test&nbsp;performance&nbsp;in&nbsp;a&nbsp;parallel&nbsp;setting,&nbsp;it&nbsp;may&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="6155438">//&nbsp;the&nbsp;RunParallel&nbsp;helper&nbsp;function;&nbsp;such&nbsp;benchmarks&nbsp;are&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;with</span><br>
<span class="lineno">65</span><span class="comment" id="6155519">//&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag:</span><br>
<span class="lineno"></span><span class="comment" id="6155545">//</span><br>
<span class="lineno"></span><span class="comment" id="6155548">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkTemplateParallel(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6155602">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ&nbsp;:=&nbsp;template.Must(template.New(&#34;test&#34;).Parse(&#34;Hello,&nbsp;{{.}}!&#34;))</span><br>
<span class="lineno"></span><span class="comment" id="6155681">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.RunParallel(func(pb&nbsp;*testing.PB)&nbsp;{</span><br>
<span class="lineno">70</span><span class="comment" id="6155729">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span><span class="comment" id="6155765">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;pb.Next()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6155796">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.Reset()</span><br>
<span class="lineno"></span><span class="comment" id="6155827">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ.Execute(&amp;buf,&nbsp;&#34;World&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6155875">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">75</span><span class="comment" id="6155892">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br>
<span class="lineno"></span><span class="comment" id="6155906">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6155915">//</span><br>
<span class="lineno"></span><span class="comment" id="6155918">//&nbsp;Examples</span><br>
<span class="lineno"></span><span class="comment" id="6155930">//</span><br>
<span class="lineno">80</span><span class="comment" id="6155933">//&nbsp;The&nbsp;package&nbsp;also&nbsp;runs&nbsp;and&nbsp;verifies&nbsp;example&nbsp;code.&nbsp;Example&nbsp;functions&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="6156007">//&nbsp;include&nbsp;a&nbsp;concluding&nbsp;line&nbsp;comment&nbsp;that&nbsp;begins&nbsp;with&nbsp;&#34;Output:&#34;&nbsp;and&nbsp;is&nbsp;compared&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6156092">//&nbsp;the&nbsp;standard&nbsp;output&nbsp;of&nbsp;the&nbsp;function&nbsp;when&nbsp;the&nbsp;tests&nbsp;are&nbsp;run.&nbsp;(The&nbsp;comparison</span><br>
<span class="lineno"></span><span class="comment" id="6156171">//&nbsp;ignores&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.)&nbsp;These&nbsp;are&nbsp;examples&nbsp;of&nbsp;an&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="6156245">//</span><br>
<span class="lineno">85</span><span class="comment" id="6156248">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleHello()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6156277">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6156313">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:&nbsp;hello</span><br>
<span class="lineno"></span><span class="comment" id="6156345">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6156354">//</span><br>
<span class="lineno">90</span><span class="comment" id="6156357">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleSalutations()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6156392">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello,&nbsp;and&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6156433">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;goodbye&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6156471">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:</span><br>
<span class="lineno"></span><span class="comment" id="6156497">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hello,&nbsp;and</span><br>
<span class="lineno">95</span><span class="comment" id="6156526">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;goodbye</span><br>
<span class="lineno"></span><span class="comment" id="6156552">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6156561">//</span><br>
<span class="lineno"></span><span class="comment" id="6156564">//&nbsp;Example&nbsp;functions&nbsp;without&nbsp;output&nbsp;comments&nbsp;are&nbsp;compiled&nbsp;but&nbsp;not&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="6156640">//</span><br>
<span class="lineno">100</span><span class="comment" id="6156643">//&nbsp;The&nbsp;naming&nbsp;convention&nbsp;to&nbsp;declare&nbsp;examples&nbsp;for&nbsp;the&nbsp;package,&nbsp;a&nbsp;function&nbsp;F,&nbsp;a&nbsp;type&nbsp;T&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6156732">//&nbsp;method&nbsp;M&nbsp;on&nbsp;type&nbsp;T&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="6156759">//</span><br>
<span class="lineno"></span><span class="comment" id="6156762">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6156792">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">105</span><span class="comment" id="6156823">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6156854">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6156887">//</span><br>
<span class="lineno"></span><span class="comment" id="6156890">//&nbsp;Multiple&nbsp;example&nbsp;functions&nbsp;for&nbsp;a&nbsp;package/type/function/method&nbsp;may&nbsp;be&nbsp;provided&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6156974">//&nbsp;appending&nbsp;a&nbsp;distinct&nbsp;suffix&nbsp;to&nbsp;the&nbsp;name.&nbsp;The&nbsp;suffix&nbsp;must&nbsp;start&nbsp;with&nbsp;a</span><br>
<span class="lineno">110</span><span class="comment" id="6157047">//&nbsp;lower-case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="comment" id="6157069">//</span><br>
<span class="lineno"></span><span class="comment" id="6157072">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6157109">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6157147">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">115</span><span class="comment" id="6157185">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6157225">//</span><br>
<span class="lineno"></span><span class="comment" id="6157228">//&nbsp;The&nbsp;entire&nbsp;test&nbsp;file&nbsp;is&nbsp;presented&nbsp;as&nbsp;the&nbsp;example&nbsp;when&nbsp;it&nbsp;contains&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="6157306">//&nbsp;example&nbsp;function,&nbsp;at&nbsp;least&nbsp;one&nbsp;other&nbsp;function,&nbsp;type,&nbsp;variable,&nbsp;or&nbsp;constant</span><br>
<span class="lineno"></span><span class="comment" id="6157384">//&nbsp;declaration,&nbsp;and&nbsp;no&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;functions.</span><br>
<span class="lineno">120</span><span class="comment" id="6157436">//</span><br>
<span class="lineno"></span><span class="comment" id="6157439">//&nbsp;Main</span><br>
<span class="lineno"></span><span class="comment" id="6157447">//</span><br>
<span class="lineno"></span><span class="comment" id="6157450">//&nbsp;It&nbsp;is&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;program&nbsp;to&nbsp;do&nbsp;extra&nbsp;setup&nbsp;or&nbsp;teardown</span><br>
<span class="lineno"></span><span class="comment" id="6157528">//&nbsp;before&nbsp;or&nbsp;after&nbsp;testing.&nbsp;It&nbsp;is&nbsp;also&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;to&nbsp;control</span><br>
<span class="lineno">125</span><span class="comment" id="6157609">//&nbsp;which&nbsp;code&nbsp;runs&nbsp;on&nbsp;the&nbsp;main&nbsp;thread.&nbsp;To&nbsp;support&nbsp;these&nbsp;and&nbsp;other&nbsp;cases,</span><br>
<span class="lineno"></span><span class="comment" id="6157682">//&nbsp;if&nbsp;a&nbsp;test&nbsp;file&nbsp;contains&nbsp;a&nbsp;function:</span><br>
<span class="lineno"></span><span class="comment" id="6157721">//</span><br>
<span class="lineno"></span><span class="comment" id="6157724">//&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestMain(m&nbsp;*testing.M)</span><br>
<span class="lineno"></span><span class="comment" id="6157755">//</span><br>
<span class="lineno">130</span><span class="comment" id="6157758">//&nbsp;then&nbsp;the&nbsp;generated&nbsp;test&nbsp;will&nbsp;call&nbsp;TestMain(m)&nbsp;instead&nbsp;of&nbsp;running&nbsp;the&nbsp;tests</span><br>
<span class="lineno"></span><span class="comment" id="6157836">//&nbsp;directly.&nbsp;TestMain&nbsp;runs&nbsp;in&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;and&nbsp;can&nbsp;do&nbsp;whatever&nbsp;setup</span><br>
<span class="lineno"></span><span class="comment" id="6157911">//&nbsp;and&nbsp;teardown&nbsp;is&nbsp;necessary&nbsp;around&nbsp;a&nbsp;call&nbsp;to&nbsp;m.Run.&nbsp;It&nbsp;should&nbsp;then&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="6157984">//&nbsp;os.Exit&nbsp;with&nbsp;the&nbsp;result&nbsp;of&nbsp;m.Run.</span><br>
<span class="lineno"></span><span class="comment" id="6158021">//</span><br>
<span class="lineno">135</span><span class="comment" id="6158024">//&nbsp;The&nbsp;minimal&nbsp;implementation&nbsp;of&nbsp;TestMain&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="6158070">//</span><br>
<span class="lineno"></span><span class="comment" id="6158073">//&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestMain(m&nbsp;*testing.M)&nbsp;{&nbsp;os.Exit(m.Run())&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6158125">//</span><br>
<span class="lineno"></span><span class="comment" id="6158128">//&nbsp;In&nbsp;effect,&nbsp;that&nbsp;is&nbsp;the&nbsp;implementation&nbsp;used&nbsp;when&nbsp;no&nbsp;TestMain&nbsp;is&nbsp;explicitly&nbsp;defined.</span><br>
<span class="lineno">140</span><span class="keyword" id="6158214">package</span>&nbsp;<span class="ident" id="6158222">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6158231">import</span>&nbsp;<span class="op" id="6158238">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158241">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158250">&#34;flag&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158258">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158265">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158271">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158282">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158299">&#34;strconv&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158310">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158321">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158329">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6158336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="6158339">var</span>&nbsp;<span class="op" id="6158343">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6158346">//&nbsp;The&nbsp;short&nbsp;flag&nbsp;requests&nbsp;that&nbsp;tests&nbsp;run&nbsp;more&nbsp;quickly,&nbsp;but&nbsp;its&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6158425">//&nbsp;is&nbsp;provided&nbsp;by&nbsp;test&nbsp;writers&nbsp;themselves.&nbsp;&nbsp;The&nbsp;testing&nbsp;package&nbsp;is&nbsp;just&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6158502">//&nbsp;home.&nbsp;&nbsp;The&nbsp;all.bash&nbsp;installation&nbsp;script&nbsp;sets&nbsp;it&nbsp;to&nbsp;make&nbsp;installation&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6158580">//&nbsp;efficient,&nbsp;but&nbsp;by&nbsp;default&nbsp;the&nbsp;flag&nbsp;is&nbsp;off&nbsp;so&nbsp;a&nbsp;plain&nbsp;&#34;go&nbsp;test&#34;&nbsp;will&nbsp;do&nbsp;a</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6158657">//&nbsp;full&nbsp;test&nbsp;of&nbsp;the&nbsp;package.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158687">short</span>&nbsp;<span class="op" id="6158693">=</span>&nbsp;<span class="ident" id="6158695">flag</span><span class="op" id="6158699">.</span><span class="ident" id="6158700">Bool</span><span class="op" id="6158704">(</span><span class="string" id="6158705">&#34;test.short&#34;</span><span class="op" id="6158717">,</span>&nbsp;<span class="builtintype" id="6158719">false</span><span class="op" id="6158724">,</span>&nbsp;<span class="string" id="6158726">&#34;run&nbsp;smaller&nbsp;test&nbsp;suite&nbsp;to&nbsp;save&nbsp;time&#34;</span><span class="op" id="6158763">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6158767">//&nbsp;The&nbsp;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;create&nbsp;profile&nbsp;files&nbsp;and&nbsp;the&nbsp;like.&nbsp;When&nbsp;run&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6158846">//&nbsp;&#34;go&nbsp;test&#34;,&nbsp;the&nbsp;binary&nbsp;always&nbsp;runs&nbsp;in&nbsp;the&nbsp;source&nbsp;directory&nbsp;for&nbsp;the&nbsp;package;</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6158925">//&nbsp;this&nbsp;flag&nbsp;lets&nbsp;&#34;go&nbsp;test&#34;&nbsp;tell&nbsp;the&nbsp;binary&nbsp;to&nbsp;write&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;directory&nbsp;where</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6159012">//&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159046">outputDir</span>&nbsp;<span class="op" id="6159056">=</span>&nbsp;<span class="ident" id="6159058">flag</span><span class="op" id="6159062">.</span><span class="ident" id="6159063">String</span><span class="op" id="6159069">(</span><span class="string" id="6159070">&#34;test.outputdir&#34;</span><span class="op" id="6159086">,</span>&nbsp;<span class="string" id="6159088">&#34;&#34;</span><span class="op" id="6159090">,</span>&nbsp;<span class="string" id="6159092">&#34;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;write&nbsp;profiles&#34;</span><span class="op" id="6159130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6159134">//&nbsp;Report&nbsp;as&nbsp;tests&nbsp;are&nbsp;run;&nbsp;default&nbsp;is&nbsp;silent&nbsp;for&nbsp;success.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159194">chatty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159211">=</span>&nbsp;<span class="ident" id="6159213">flag</span><span class="op" id="6159217">.</span><span class="ident" id="6159218">Bool</span><span class="op" id="6159222">(</span><span class="string" id="6159223">&#34;test.v&#34;</span><span class="op" id="6159231">,</span>&nbsp;<span class="builtintype" id="6159233">false</span><span class="op" id="6159238">,</span>&nbsp;<span class="string" id="6159240">&#34;verbose:&nbsp;print&nbsp;additional&nbsp;output&#34;</span><span class="op" id="6159274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159277">coverProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159294">=</span>&nbsp;<span class="ident" id="6159296">flag</span><span class="op" id="6159300">.</span><span class="ident" id="6159301">String</span><span class="op" id="6159307">(</span><span class="string" id="6159308">&#34;test.coverprofile&#34;</span><span class="op" id="6159327">,</span>&nbsp;<span class="string" id="6159329">&#34;&#34;</span><span class="op" id="6159331">,</span>&nbsp;<span class="string" id="6159333">&#34;write&nbsp;a&nbsp;coverage&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6159393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159396">match</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159413">=</span>&nbsp;<span class="ident" id="6159415">flag</span><span class="op" id="6159419">.</span><span class="ident" id="6159420">String</span><span class="op" id="6159426">(</span><span class="string" id="6159427">&#34;test.run&#34;</span><span class="op" id="6159437">,</span>&nbsp;<span class="string" id="6159439">&#34;&#34;</span><span class="op" id="6159441">,</span>&nbsp;<span class="string" id="6159443">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;tests&nbsp;and&nbsp;examples&nbsp;to&nbsp;run&#34;</span><span class="op" id="6159499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159502">memProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159519">=</span>&nbsp;<span class="ident" id="6159521">flag</span><span class="op" id="6159525">.</span><span class="ident" id="6159526">String</span><span class="op" id="6159532">(</span><span class="string" id="6159533">&#34;test.memprofile&#34;</span><span class="op" id="6159550">,</span>&nbsp;<span class="string" id="6159552">&#34;&#34;</span><span class="op" id="6159554">,</span>&nbsp;<span class="string" id="6159556">&#34;write&nbsp;a&nbsp;memory&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6159614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159617">memProfileRate</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6159634">=</span>&nbsp;<span class="ident" id="6159636">flag</span><span class="op" id="6159640">.</span><span class="ident" id="6159641">Int</span><span class="op" id="6159644">(</span><span class="string" id="6159645">&#34;test.memprofilerate&#34;</span><span class="op" id="6159666">,</span>&nbsp;<span class="num" id="6159668">0</span><span class="op" id="6159669">,</span>&nbsp;<span class="string" id="6159671">&#34;if&nbsp;&gt;=0,&nbsp;sets&nbsp;runtime.MemProfileRate&#34;</span><span class="op" id="6159708">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159711">cpuProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159728">=</span>&nbsp;<span class="ident" id="6159730">flag</span><span class="op" id="6159734">.</span><span class="ident" id="6159735">String</span><span class="op" id="6159741">(</span><span class="string" id="6159742">&#34;test.cpuprofile&#34;</span><span class="op" id="6159759">,</span>&nbsp;<span class="string" id="6159761">&#34;&#34;</span><span class="op" id="6159763">,</span>&nbsp;<span class="string" id="6159765">&#34;write&nbsp;a&nbsp;cpu&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;during&nbsp;execution&#34;</span><span class="op" id="6159821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159824">blockProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159841">=</span>&nbsp;<span class="ident" id="6159843">flag</span><span class="op" id="6159847">.</span><span class="ident" id="6159848">String</span><span class="op" id="6159854">(</span><span class="string" id="6159855">&#34;test.blockprofile&#34;</span><span class="op" id="6159874">,</span>&nbsp;<span class="string" id="6159876">&#34;&#34;</span><span class="op" id="6159878">,</span>&nbsp;<span class="string" id="6159880">&#34;write&nbsp;a&nbsp;goroutine&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6159950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159953">blockProfileRate</span>&nbsp;<span class="op" id="6159970">=</span>&nbsp;<span class="ident" id="6159972">flag</span><span class="op" id="6159976">.</span><span class="ident" id="6159977">Int</span><span class="op" id="6159980">(</span><span class="string" id="6159981">&#34;test.blockprofilerate&#34;</span><span class="op" id="6160004">,</span>&nbsp;<span class="num" id="6160006">1</span><span class="op" id="6160007">,</span>&nbsp;<span class="string" id="6160009">&#34;if&nbsp;&gt;=&nbsp;0,&nbsp;calls&nbsp;runtime.SetBlockProfileRate()&#34;</span><span class="op" id="6160055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160058">timeout</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6160075">=</span>&nbsp;<span class="ident" id="6160077">flag</span><span class="op" id="6160081">.</span><span class="ident" id="6160082">Duration</span><span class="op" id="6160090">(</span><span class="string" id="6160091">&#34;test.timeout&#34;</span><span class="op" id="6160105">,</span>&nbsp;<span class="num" id="6160107">0</span><span class="op" id="6160108">,</span>&nbsp;<span class="string" id="6160110">&#34;if&nbsp;positive,&nbsp;sets&nbsp;an&nbsp;aggregate&nbsp;time&nbsp;limit&nbsp;for&nbsp;all&nbsp;tests&#34;</span><span class="op" id="6160167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160170">cpuListStr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6160187">=</span>&nbsp;<span class="ident" id="6160189">flag</span><span class="op" id="6160193">.</span><span class="ident" id="6160194">String</span><span class="op" id="6160200">(</span><span class="string" id="6160201">&#34;test.cpu&#34;</span><span class="op" id="6160211">,</span>&nbsp;<span class="string" id="6160213">&#34;&#34;</span><span class="op" id="6160215">,</span>&nbsp;<span class="string" id="6160217">&#34;comma-separated&nbsp;list&nbsp;of&nbsp;number&nbsp;of&nbsp;CPUs&nbsp;to&nbsp;use&nbsp;for&nbsp;each&nbsp;test&#34;</span><span class="op" id="6160278">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160281">parallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6160298">=</span>&nbsp;<span class="ident" id="6160300">flag</span><span class="op" id="6160304">.</span><span class="ident" id="6160305">Int</span><span class="op" id="6160308">(</span><span class="string" id="6160309">&#34;test.parallel&#34;</span><span class="op" id="6160324">,</span>&nbsp;<span class="ident" id="6160326">runtime</span><span class="op" id="6160333">.</span><span class="ident" id="6160334">GOMAXPROCS</span><span class="op" id="6160344">(</span><span class="num" id="6160345">0</span><span class="op" id="6160346">)</span><span class="op" id="6160347">,</span>&nbsp;<span class="string" id="6160349">&#34;maximum&nbsp;test&nbsp;parallelism&#34;</span><span class="op" id="6160375">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160379">haveExamples</span>&nbsp;<span class="builtintype" id="6160392">bool</span>&nbsp;<span class="comment" id="6160397">//&nbsp;are&nbsp;there&nbsp;examples?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160422">cpuList</span>&nbsp;<span class="op" id="6160430">[</span><span class="op" id="6160431">]</span><span class="builtintype" id="6160432">int</span><br>
<span class="lineno">185</span><span class="op" id="6160436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6160439">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;elements&nbsp;common&nbsp;between&nbsp;T&nbsp;and&nbsp;B&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6160495">//&nbsp;captures&nbsp;common&nbsp;methods&nbsp;such&nbsp;as&nbsp;Errorf.</span><br>
<span class="lineno"></span><span class="keyword" id="6160538">type</span>&nbsp;<span class="ident" id="6160543">common</span>&nbsp;<span class="keyword" id="6160550">struct</span>&nbsp;<span class="op" id="6160557">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160560">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160569">sync</span><span class="op" id="6160573">.</span><span class="ident" id="6160574">RWMutex</span>&nbsp;<span class="comment" id="6160582">//&nbsp;guards&nbsp;output&nbsp;and&nbsp;failed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160611">output</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6160620">[</span><span class="op" id="6160621">]</span><span class="builtintype" id="6160622">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6160633">//&nbsp;Output&nbsp;generated&nbsp;by&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160676">failed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6160685">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6160698">//&nbsp;Test&nbsp;or&nbsp;benchmark&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160732">skipped</span>&nbsp;&nbsp;<span class="builtintype" id="6160741">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6160754">//&nbsp;Test&nbsp;of&nbsp;benchmark&nbsp;has&nbsp;been&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160794">finished</span>&nbsp;<span class="builtintype" id="6160803">bool</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160810">start</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160819">time</span><span class="op" id="6160823">.</span><span class="ident" id="6160824">Time</span>&nbsp;<span class="comment" id="6160829">//&nbsp;Time&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;started</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160864">duration</span>&nbsp;<span class="ident" id="6160873">time</span><span class="op" id="6160877">.</span><span class="ident" id="6160878">Duration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160888">self</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160897">interface</span><span class="op" id="6160906">{</span><span class="op" id="6160907">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6160914">//&nbsp;To&nbsp;be&nbsp;sent&nbsp;on&nbsp;signal&nbsp;channel&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160958">signal</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160967">chan</span>&nbsp;<span class="keyword" id="6160972">interface</span><span class="op" id="6160981">{</span><span class="op" id="6160982">}</span>&nbsp;<span class="comment" id="6160984">//&nbsp;Output&nbsp;for&nbsp;serial&nbsp;tests.</span><br>
<span class="lineno">200</span><span class="op" id="6161012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6161015">//&nbsp;Short&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.short&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6161069">func</span>&nbsp;<span class="ident" id="6161074">Short</span><span class="op" id="6161079">(</span><span class="op" id="6161080">)</span>&nbsp;<span class="builtintype" id="6161082">bool</span>&nbsp;<span class="op" id="6161087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161090">return</span>&nbsp;<span class="op" id="6161097">*</span><span class="ident" id="6161098">short</span><br>
<span class="lineno">205</span><span class="op" id="6161104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6161107">//&nbsp;Verbose&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6161159">func</span>&nbsp;<span class="ident" id="6161164">Verbose</span><span class="op" id="6161171">(</span><span class="op" id="6161172">)</span>&nbsp;<span class="builtintype" id="6161174">bool</span>&nbsp;<span class="op" id="6161179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161182">return</span>&nbsp;<span class="op" id="6161189">*</span><span class="ident" id="6161190">chatty</span><br>
<span class="lineno">210</span><span class="op" id="6161197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6161200">//&nbsp;decorate&nbsp;prefixes&nbsp;the&nbsp;string&nbsp;with&nbsp;the&nbsp;file&nbsp;and&nbsp;line&nbsp;of&nbsp;the&nbsp;call&nbsp;site</span><br>
<span class="lineno"></span><span class="comment" id="6161272">//&nbsp;and&nbsp;inserts&nbsp;the&nbsp;final&nbsp;newline&nbsp;if&nbsp;needed&nbsp;and&nbsp;indentation&nbsp;tabs&nbsp;for&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="keyword" id="6161352">func</span>&nbsp;<span class="ident" id="6161357">decorate</span><span class="op" id="6161365">(</span><span class="ident" id="6161366">s</span>&nbsp;<span class="builtintype" id="6161368">string</span><span class="op" id="6161374">)</span>&nbsp;<span class="builtintype" id="6161376">string</span>&nbsp;<span class="op" id="6161383">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161386">_</span><span class="op" id="6161387">,</span>&nbsp;<span class="ident" id="6161389">file</span><span class="op" id="6161393">,</span>&nbsp;<span class="ident" id="6161395">line</span><span class="op" id="6161399">,</span>&nbsp;<span class="ident" id="6161401">ok</span>&nbsp;<span class="op" id="6161404">:=</span>&nbsp;<span class="ident" id="6161407">runtime</span><span class="op" id="6161414">.</span><span class="ident" id="6161415">Caller</span><span class="op" id="6161421">(</span><span class="num" id="6161422">3</span><span class="op" id="6161423">)</span>&nbsp;<span class="comment" id="6161425">//&nbsp;decorate&nbsp;+&nbsp;log&nbsp;+&nbsp;public&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161463">if</span>&nbsp;<span class="ident" id="6161466">ok</span>&nbsp;<span class="op" id="6161469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6161473">//&nbsp;Truncate&nbsp;file&nbsp;name&nbsp;at&nbsp;last&nbsp;file&nbsp;name&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161526">if</span>&nbsp;<span class="ident" id="6161529">index</span>&nbsp;<span class="op" id="6161535">:=</span>&nbsp;<span class="ident" id="6161538">strings</span><span class="op" id="6161545">.</span><span class="ident" id="6161546">LastIndex</span><span class="op" id="6161555">(</span><span class="ident" id="6161556">file</span><span class="op" id="6161560">,</span>&nbsp;<span class="string" id="6161562">&#34;/&#34;</span><span class="op" id="6161565">)</span><span class="op" id="6161566">;</span>&nbsp;<span class="ident" id="6161568">index</span>&nbsp;<span class="op" id="6161574">&gt;=</span>&nbsp;<span class="num" id="6161577">0</span>&nbsp;<span class="op" id="6161579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161584">file</span>&nbsp;<span class="op" id="6161589">=</span>&nbsp;<span class="ident" id="6161591">file</span><span class="op" id="6161595">[</span><span class="ident" id="6161596">index</span><span class="op" id="6161601">+</span><span class="num" id="6161602">1</span><span class="op" id="6161603">:</span><span class="op" id="6161604">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161608">}</span>&nbsp;<span class="keyword" id="6161610">else</span>&nbsp;<span class="keyword" id="6161615">if</span>&nbsp;<span class="ident" id="6161618">index</span>&nbsp;<span class="op" id="6161624">=</span>&nbsp;<span class="ident" id="6161626">strings</span><span class="op" id="6161633">.</span><span class="ident" id="6161634">LastIndex</span><span class="op" id="6161643">(</span><span class="ident" id="6161644">file</span><span class="op" id="6161648">,</span>&nbsp;<span class="string" id="6161650">&#34;\\&#34;</span><span class="op" id="6161654">)</span><span class="op" id="6161655">;</span>&nbsp;<span class="ident" id="6161657">index</span>&nbsp;<span class="op" id="6161663">&gt;=</span>&nbsp;<span class="num" id="6161666">0</span>&nbsp;<span class="op" id="6161668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161673">file</span>&nbsp;<span class="op" id="6161678">=</span>&nbsp;<span class="ident" id="6161680">file</span><span class="op" id="6161684">[</span><span class="ident" id="6161685">index</span><span class="op" id="6161690">+</span><span class="num" id="6161691">1</span><span class="op" id="6161692">:</span><span class="op" id="6161693">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161700">}</span>&nbsp;<span class="keyword" id="6161702">else</span>&nbsp;<span class="op" id="6161707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161711">file</span>&nbsp;<span class="op" id="6161716">=</span>&nbsp;<span class="string" id="6161718">&#34;???&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161726">line</span>&nbsp;<span class="op" id="6161731">=</span>&nbsp;<span class="num" id="6161733">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161739">buf</span>&nbsp;<span class="op" id="6161743">:=</span>&nbsp;<span class="builtinfunc" id="6161746">new</span><span class="op" id="6161749">(</span><span class="ident" id="6161750">bytes</span><span class="op" id="6161755">.</span><span class="ident" id="6161756">Buffer</span><span class="op" id="6161762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6161765">//&nbsp;Every&nbsp;line&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161810">buf</span><span class="op" id="6161813">.</span><span class="ident" id="6161814">WriteByte</span><span class="op" id="6161823">(</span><span class="string" id="6161824">&#39;\t&#39;</span><span class="op" id="6161828">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161831">fmt</span><span class="op" id="6161834">.</span><span class="ident" id="6161835">Fprintf</span><span class="op" id="6161842">(</span><span class="ident" id="6161843">buf</span><span class="op" id="6161846">,</span>&nbsp;<span class="string" id="6161848">&#34;%s:%d:&nbsp;&#34;</span><span class="op" id="6161857">,</span>&nbsp;<span class="ident" id="6161859">file</span><span class="op" id="6161863">,</span>&nbsp;<span class="ident" id="6161865">line</span><span class="op" id="6161869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161872">lines</span>&nbsp;<span class="op" id="6161878">:=</span>&nbsp;<span class="ident" id="6161881">strings</span><span class="op" id="6161888">.</span><span class="ident" id="6161889">Split</span><span class="op" id="6161894">(</span><span class="ident" id="6161895">s</span><span class="op" id="6161896">,</span>&nbsp;<span class="string" id="6161898">&#34;\n&#34;</span><span class="op" id="6161902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161905">if</span>&nbsp;<span class="ident" id="6161908">l</span>&nbsp;<span class="op" id="6161910">:=</span>&nbsp;<span class="builtinfunc" id="6161913">len</span><span class="op" id="6161916">(</span><span class="ident" id="6161917">lines</span><span class="op" id="6161922">)</span><span class="op" id="6161923">;</span>&nbsp;<span class="ident" id="6161925">l</span>&nbsp;<span class="op" id="6161927">&gt;</span>&nbsp;<span class="num" id="6161929">1</span>&nbsp;<span class="op" id="6161931">&amp;&amp;</span>&nbsp;<span class="ident" id="6161934">lines</span><span class="op" id="6161939">[</span><span class="ident" id="6161940">l</span><span class="op" id="6161941">-</span><span class="num" id="6161942">1</span><span class="op" id="6161943">]</span>&nbsp;<span class="op" id="6161945">==</span>&nbsp;<span class="string" id="6161948">&#34;&#34;</span>&nbsp;<span class="op" id="6161951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161955">lines</span>&nbsp;<span class="op" id="6161961">=</span>&nbsp;<span class="ident" id="6161963">lines</span><span class="op" id="6161968">[</span><span class="op" id="6161969">:</span><span class="ident" id="6161970">l</span><span class="op" id="6161971">-</span><span class="num" id="6161972">1</span><span class="op" id="6161973">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161976">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161979">for</span>&nbsp;<span class="ident" id="6161983">i</span><span class="op" id="6161984">,</span>&nbsp;<span class="ident" id="6161986">line</span>&nbsp;<span class="op" id="6161991">:=</span>&nbsp;<span class="keyword" id="6161994">range</span>&nbsp;<span class="ident" id="6162000">lines</span>&nbsp;<span class="op" id="6162006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162010">if</span>&nbsp;<span class="ident" id="6162013">i</span>&nbsp;<span class="op" id="6162015">&gt;</span>&nbsp;<span class="num" id="6162017">0</span>&nbsp;<span class="op" id="6162019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6162024">//&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;lines&nbsp;are&nbsp;indented&nbsp;an&nbsp;extra&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162085">buf</span><span class="op" id="6162088">.</span><span class="ident" id="6162089">WriteString</span><span class="op" id="6162100">(</span><span class="string" id="6162101">&#34;\n\t\t&#34;</span><span class="op" id="6162109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6162113">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162117">buf</span><span class="op" id="6162120">.</span><span class="ident" id="6162121">WriteString</span><span class="op" id="6162132">(</span><span class="ident" id="6162133">line</span><span class="op" id="6162137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6162140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162143">buf</span><span class="op" id="6162146">.</span><span class="ident" id="6162147">WriteByte</span><span class="op" id="6162156">(</span><span class="string" id="6162157">&#39;\n&#39;</span><span class="op" id="6162161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162164">return</span>&nbsp;<span class="ident" id="6162171">buf</span><span class="op" id="6162174">.</span><span class="ident" id="6162175">String</span><span class="op" id="6162181">(</span><span class="op" id="6162182">)</span><br>
<span class="lineno"></span><span class="op" id="6162184">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6162187">//&nbsp;fmtDuration&nbsp;returns&nbsp;a&nbsp;string&nbsp;representing&nbsp;d&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;87.00s&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="6162256">func</span>&nbsp;<span class="ident" id="6162261">fmtDuration</span><span class="op" id="6162272">(</span><span class="ident" id="6162273">d</span>&nbsp;<span class="ident" id="6162275">time</span><span class="op" id="6162279">.</span><span class="ident" id="6162280">Duration</span><span class="op" id="6162288">)</span>&nbsp;<span class="builtintype" id="6162290">string</span>&nbsp;<span class="op" id="6162297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162300">return</span>&nbsp;<span class="ident" id="6162307">fmt</span><span class="op" id="6162310">.</span><span class="ident" id="6162311">Sprintf</span><span class="op" id="6162318">(</span><span class="string" id="6162319">&#34;%.2fs&#34;</span><span class="op" id="6162326">,</span>&nbsp;<span class="ident" id="6162328">d</span><span class="op" id="6162329">.</span><span class="ident" id="6162330">Seconds</span><span class="op" id="6162337">(</span><span class="op" id="6162338">)</span><span class="op" id="6162339">)</span><br>
<span class="lineno"></span><span class="op" id="6162341">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="6162344">//&nbsp;TB&nbsp;is&nbsp;the&nbsp;interface&nbsp;common&nbsp;to&nbsp;T&nbsp;and&nbsp;B.</span><br>
<span class="lineno"></span><span class="keyword" id="6162386">type</span>&nbsp;<span class="ident" id="6162391">TB</span>&nbsp;<span class="keyword" id="6162394">interface</span>&nbsp;<span class="op" id="6162404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162407">Error</span><span class="op" id="6162412">(</span><span class="ident" id="6162413">args</span>&nbsp;<span class="op" id="6162418">...</span><span class="keyword" id="6162421">interface</span><span class="op" id="6162430">{</span><span class="op" id="6162431">}</span><span class="op" id="6162432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162435">Errorf</span><span class="op" id="6162441">(</span><span class="ident" id="6162442">format</span>&nbsp;<span class="builtintype" id="6162449">string</span><span class="op" id="6162455">,</span>&nbsp;<span class="ident" id="6162457">args</span>&nbsp;<span class="op" id="6162462">...</span><span class="keyword" id="6162465">interface</span><span class="op" id="6162474">{</span><span class="op" id="6162475">}</span><span class="op" id="6162476">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162479">Fail</span><span class="op" id="6162483">(</span><span class="op" id="6162484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162487">FailNow</span><span class="op" id="6162494">(</span><span class="op" id="6162495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162498">Failed</span><span class="op" id="6162504">(</span><span class="op" id="6162505">)</span>&nbsp;<span class="builtintype" id="6162507">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162513">Fatal</span><span class="op" id="6162518">(</span><span class="ident" id="6162519">args</span>&nbsp;<span class="op" id="6162524">...</span><span class="keyword" id="6162527">interface</span><span class="op" id="6162536">{</span><span class="op" id="6162537">}</span><span class="op" id="6162538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162541">Fatalf</span><span class="op" id="6162547">(</span><span class="ident" id="6162548">format</span>&nbsp;<span class="builtintype" id="6162555">string</span><span class="op" id="6162561">,</span>&nbsp;<span class="ident" id="6162563">args</span>&nbsp;<span class="op" id="6162568">...</span><span class="keyword" id="6162571">interface</span><span class="op" id="6162580">{</span><span class="op" id="6162581">}</span><span class="op" id="6162582">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162585">Log</span><span class="op" id="6162588">(</span><span class="ident" id="6162589">args</span>&nbsp;<span class="op" id="6162594">...</span><span class="keyword" id="6162597">interface</span><span class="op" id="6162606">{</span><span class="op" id="6162607">}</span><span class="op" id="6162608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162611">Logf</span><span class="op" id="6162615">(</span><span class="ident" id="6162616">format</span>&nbsp;<span class="builtintype" id="6162623">string</span><span class="op" id="6162629">,</span>&nbsp;<span class="ident" id="6162631">args</span>&nbsp;<span class="op" id="6162636">...</span><span class="keyword" id="6162639">interface</span><span class="op" id="6162648">{</span><span class="op" id="6162649">}</span><span class="op" id="6162650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162653">Skip</span><span class="op" id="6162657">(</span><span class="ident" id="6162658">args</span>&nbsp;<span class="op" id="6162663">...</span><span class="keyword" id="6162666">interface</span><span class="op" id="6162675">{</span><span class="op" id="6162676">}</span><span class="op" id="6162677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162680">SkipNow</span><span class="op" id="6162687">(</span><span class="op" id="6162688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162691">Skipf</span><span class="op" id="6162696">(</span><span class="ident" id="6162697">format</span>&nbsp;<span class="builtintype" id="6162704">string</span><span class="op" id="6162710">,</span>&nbsp;<span class="ident" id="6162712">args</span>&nbsp;<span class="op" id="6162717">...</span><span class="keyword" id="6162720">interface</span><span class="op" id="6162729">{</span><span class="op" id="6162730">}</span><span class="op" id="6162731">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162734">Skipped</span><span class="op" id="6162741">(</span><span class="op" id="6162742">)</span>&nbsp;<span class="builtintype" id="6162744">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6162751">//&nbsp;A&nbsp;private&nbsp;method&nbsp;to&nbsp;prevent&nbsp;users&nbsp;implementing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6162806">//&nbsp;interface&nbsp;and&nbsp;so&nbsp;future&nbsp;additions&nbsp;to&nbsp;it&nbsp;will&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6162859">//&nbsp;violate&nbsp;Go&nbsp;1&nbsp;compatibility.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162891">private</span><span class="op" id="6162898">(</span><span class="op" id="6162899">)</span><br>
<span class="lineno"></span><span class="op" id="6162901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6162904">var</span>&nbsp;<span class="ident" id="6162908">_</span>&nbsp;<span class="ident" id="6162910">TB</span>&nbsp;<span class="op" id="6162913">=</span>&nbsp;<span class="op" id="6162915">(</span><span class="op" id="6162916">*</span><span class="ident" id="6162917">T</span><span class="op" id="6162918">)</span><span class="op" id="6162919">(</span><span class="builtintype" id="6162920">nil</span><span class="op" id="6162923">)</span><br>
<span class="lineno"></span><span class="keyword" id="6162925">var</span>&nbsp;<span class="ident" id="6162929">_</span>&nbsp;<span class="ident" id="6162931">TB</span>&nbsp;<span class="op" id="6162934">=</span>&nbsp;<span class="op" id="6162936">(</span><span class="op" id="6162937">*</span><span class="ident" id="6162938">B</span><span class="op" id="6162939">)</span><span class="op" id="6162940">(</span><span class="builtintype" id="6162941">nil</span><span class="op" id="6162944">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="6162947">//&nbsp;T&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Test&nbsp;functions&nbsp;to&nbsp;manage&nbsp;test&nbsp;state&nbsp;and&nbsp;support&nbsp;formatted&nbsp;test&nbsp;logs.</span><br>
<span class="lineno"></span><span class="comment" id="6163041">//&nbsp;Logs&nbsp;are&nbsp;accumulated&nbsp;during&nbsp;execution&nbsp;and&nbsp;dumped&nbsp;to&nbsp;standard&nbsp;error&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="6163122">type</span>&nbsp;<span class="ident" id="6163127">T</span>&nbsp;<span class="keyword" id="6163129">struct</span>&nbsp;<span class="op" id="6163136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6163139">common</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6163147">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6163161">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163171">//&nbsp;Name&nbsp;of&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6163189">startParallel</span>&nbsp;<span class="keyword" id="6163203">chan</span>&nbsp;<span class="builtintype" id="6163208">bool</span>&nbsp;<span class="comment" id="6163213">//&nbsp;Parallel&nbsp;tests&nbsp;will&nbsp;wait&nbsp;on&nbsp;this.</span><br>
<span class="lineno"></span><span class="op" id="6163250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6163253">func</span>&nbsp;<span class="op" id="6163258">(</span><span class="ident" id="6163259">c</span>&nbsp;<span class="op" id="6163261">*</span><span class="ident" id="6163262">common</span><span class="op" id="6163268">)</span>&nbsp;<span class="ident" id="6163270">private</span><span class="op" id="6163277">(</span><span class="op" id="6163278">)</span>&nbsp;<span class="op" id="6163280">{</span><span class="op" id="6163281">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="6163284">//&nbsp;Fail&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;but&nbsp;continues&nbsp;execution.</span><br>
<span class="lineno"></span><span class="keyword" id="6163353">func</span>&nbsp;<span class="op" id="6163358">(</span><span class="ident" id="6163359">c</span>&nbsp;<span class="op" id="6163361">*</span><span class="ident" id="6163362">common</span><span class="op" id="6163368">)</span>&nbsp;<span class="ident" id="6163370">Fail</span><span class="op" id="6163374">(</span><span class="op" id="6163375">)</span>&nbsp;<span class="op" id="6163377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6163380">c</span><span class="op" id="6163381">.</span><span class="ident" id="6163382">mu</span><span class="op" id="6163384">.</span><span class="ident" id="6163385">Lock</span><span class="op" id="6163389">(</span><span class="op" id="6163390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6163393">defer</span>&nbsp;<span class="ident" id="6163399">c</span><span class="op" id="6163400">.</span><span class="ident" id="6163401">mu</span><span class="op" id="6163403">.</span><span class="ident" id="6163404">Unlock</span><span class="op" id="6163410">(</span><span class="op" id="6163411">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6163414">c</span><span class="op" id="6163415">.</span><span class="ident" id="6163416">failed</span>&nbsp;<span class="op" id="6163423">=</span>&nbsp;<span class="builtintype" id="6163425">true</span><br>
<span class="lineno"></span><span class="op" id="6163430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6163433">//&nbsp;Failed&nbsp;reports&nbsp;whether&nbsp;the&nbsp;function&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="6163484">func</span>&nbsp;<span class="op" id="6163489">(</span><span class="ident" id="6163490">c</span>&nbsp;<span class="op" id="6163492">*</span><span class="ident" id="6163493">common</span><span class="op" id="6163499">)</span>&nbsp;<span class="ident" id="6163501">Failed</span><span class="op" id="6163507">(</span><span class="op" id="6163508">)</span>&nbsp;<span class="builtintype" id="6163510">bool</span>&nbsp;<span class="op" id="6163515">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6163518">c</span><span class="op" id="6163519">.</span><span class="ident" id="6163520">mu</span><span class="op" id="6163522">.</span><span class="ident" id="6163523">RLock</span><span class="op" id="6163528">(</span><span class="op" id="6163529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6163532">defer</span>&nbsp;<span class="ident" id="6163538">c</span><span class="op" id="6163539">.</span><span class="ident" id="6163540">mu</span><span class="op" id="6163542">.</span><span class="ident" id="6163543">RUnlock</span><span class="op" id="6163550">(</span><span class="op" id="6163551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6163554">return</span>&nbsp;<span class="ident" id="6163561">c</span><span class="op" id="6163562">.</span><span class="ident" id="6163563">failed</span><br>
<span class="lineno"></span><span class="op" id="6163570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="6163573">//&nbsp;FailNow&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6163645">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span><span class="comment" id="6163703">//&nbsp;FailNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6163760">//&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;function,&nbsp;not&nbsp;from&nbsp;other&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="6163817">//&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;FailNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno">305</span><span class="comment" id="6163875">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="6163902">func</span>&nbsp;<span class="op" id="6163907">(</span><span class="ident" id="6163908">c</span>&nbsp;<span class="op" id="6163910">*</span><span class="ident" id="6163911">common</span><span class="op" id="6163917">)</span>&nbsp;<span class="ident" id="6163919">FailNow</span><span class="op" id="6163926">(</span><span class="op" id="6163927">)</span>&nbsp;<span class="op" id="6163929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6163932">c</span><span class="op" id="6163933">.</span><span class="ident" id="6163934">Fail</span><span class="op" id="6163938">(</span><span class="op" id="6163939">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163943">//&nbsp;Calling&nbsp;runtime.Goexit&nbsp;will&nbsp;exit&nbsp;the&nbsp;goroutine,&nbsp;which</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164001">//&nbsp;will&nbsp;run&nbsp;the&nbsp;deferred&nbsp;functions&nbsp;in&nbsp;this&nbsp;goroutine,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164056">//&nbsp;which&nbsp;will&nbsp;eventually&nbsp;run&nbsp;the&nbsp;deferred&nbsp;lines&nbsp;in&nbsp;tRunner,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164117">//&nbsp;which&nbsp;will&nbsp;signal&nbsp;to&nbsp;the&nbsp;test&nbsp;loop&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164180">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164184">//&nbsp;A&nbsp;previous&nbsp;version&nbsp;of&nbsp;this&nbsp;code&nbsp;said:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164226">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164230">//&nbsp;&nbsp;&nbsp;&nbsp;c.duration&nbsp;=&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164251">//&nbsp;&nbsp;&nbsp;&nbsp;c.signal&nbsp;&lt;-&nbsp;c.self</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164274">//&nbsp;&nbsp;&nbsp;&nbsp;runtime.Goexit()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164295">//</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164299">//&nbsp;This&nbsp;previous&nbsp;version&nbsp;duplicated&nbsp;code&nbsp;(those&nbsp;lines&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164361">//&nbsp;tRunner&nbsp;no&nbsp;matter&nbsp;what),&nbsp;but&nbsp;worse&nbsp;the&nbsp;goroutine&nbsp;teardown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164423">//&nbsp;implicit&nbsp;in&nbsp;runtime.Goexit&nbsp;was&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164485">//&nbsp;before&nbsp;the&nbsp;test&nbsp;exited.&nbsp;&nbsp;If&nbsp;a&nbsp;test&nbsp;deferred&nbsp;an&nbsp;important&nbsp;cleanup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164554">//&nbsp;function&nbsp;(like&nbsp;removing&nbsp;temporary&nbsp;files),&nbsp;there&nbsp;was&nbsp;no&nbsp;guarantee</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164623">//&nbsp;it&nbsp;would&nbsp;run&nbsp;on&nbsp;a&nbsp;test&nbsp;failure.&nbsp;&nbsp;Because&nbsp;we&nbsp;send&nbsp;on&nbsp;c.signal&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164695">//&nbsp;a&nbsp;top-of-stack&nbsp;deferred&nbsp;function&nbsp;now,&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6164759">//&nbsp;only&nbsp;happens&nbsp;after&nbsp;any&nbsp;other&nbsp;stacked&nbsp;defers&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6164823">c</span><span class="op" id="6164824">.</span><span class="ident" id="6164825">finished</span>&nbsp;<span class="op" id="6164834">=</span>&nbsp;<span class="builtintype" id="6164836">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6164842">runtime</span><span class="op" id="6164849">.</span><span class="ident" id="6164850">Goexit</span><span class="op" id="6164856">(</span><span class="op" id="6164857">)</span><br>
<span class="lineno">330</span><span class="op" id="6164859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6164862">//&nbsp;log&nbsp;generates&nbsp;the&nbsp;output.&nbsp;It&#39;s&nbsp;always&nbsp;at&nbsp;the&nbsp;same&nbsp;stack&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6164928">func</span>&nbsp;<span class="op" id="6164933">(</span><span class="ident" id="6164934">c</span>&nbsp;<span class="op" id="6164936">*</span><span class="ident" id="6164937">common</span><span class="op" id="6164943">)</span>&nbsp;<span class="ident" id="6164945">log</span><span class="op" id="6164948">(</span><span class="ident" id="6164949">s</span>&nbsp;<span class="builtintype" id="6164951">string</span><span class="op" id="6164957">)</span>&nbsp;<span class="op" id="6164959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6164962">c</span><span class="op" id="6164963">.</span><span class="ident" id="6164964">mu</span><span class="op" id="6164966">.</span><span class="ident" id="6164967">Lock</span><span class="op" id="6164971">(</span><span class="op" id="6164972">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164975">defer</span>&nbsp;<span class="ident" id="6164981">c</span><span class="op" id="6164982">.</span><span class="ident" id="6164983">mu</span><span class="op" id="6164985">.</span><span class="ident" id="6164986">Unlock</span><span class="op" id="6164992">(</span><span class="op" id="6164993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6164996">c</span><span class="op" id="6164997">.</span><span class="ident" id="6164998">output</span>&nbsp;<span class="op" id="6165005">=</span>&nbsp;<span class="builtinfunc" id="6165007">append</span><span class="op" id="6165013">(</span><span class="ident" id="6165014">c</span><span class="op" id="6165015">.</span><span class="ident" id="6165016">output</span><span class="op" id="6165022">,</span>&nbsp;<span class="ident" id="6165024">decorate</span><span class="op" id="6165032">(</span><span class="ident" id="6165033">s</span><span class="op" id="6165034">)</span><span class="op" id="6165035">...</span><span class="op" id="6165038">)</span><br>
<span class="lineno"></span><span class="op" id="6165040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6165043">//&nbsp;Log&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;using&nbsp;default&nbsp;formatting,&nbsp;analogous&nbsp;to&nbsp;Println,</span><br>
<span class="lineno">340</span><span class="comment" id="6165120">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6165195">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6165241">func</span>&nbsp;<span class="op" id="6165246">(</span><span class="ident" id="6165247">c</span>&nbsp;<span class="op" id="6165249">*</span><span class="ident" id="6165250">common</span><span class="op" id="6165256">)</span>&nbsp;<span class="ident" id="6165258">Log</span><span class="op" id="6165261">(</span><span class="ident" id="6165262">args</span>&nbsp;<span class="op" id="6165267">...</span><span class="keyword" id="6165270">interface</span><span class="op" id="6165279">{</span><span class="op" id="6165280">}</span><span class="op" id="6165281">)</span>&nbsp;<span class="op" id="6165283">{</span>&nbsp;<span class="ident" id="6165285">c</span><span class="op" id="6165286">.</span><span class="ident" id="6165287">log</span><span class="op" id="6165290">(</span><span class="ident" id="6165291">fmt</span><span class="op" id="6165294">.</span><span class="ident" id="6165295">Sprintln</span><span class="op" id="6165303">(</span><span class="ident" id="6165304">args</span><span class="op" id="6165308">...</span><span class="op" id="6165311">)</span><span class="op" id="6165312">)</span>&nbsp;<span class="op" id="6165314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6165317">//&nbsp;Logf&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;according&nbsp;to&nbsp;the&nbsp;format,&nbsp;analogous&nbsp;to&nbsp;Printf,</span><br>
<span class="lineno">345</span><span class="comment" id="6165393">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6165468">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6165514">func</span>&nbsp;<span class="op" id="6165519">(</span><span class="ident" id="6165520">c</span>&nbsp;<span class="op" id="6165522">*</span><span class="ident" id="6165523">common</span><span class="op" id="6165529">)</span>&nbsp;<span class="ident" id="6165531">Logf</span><span class="op" id="6165535">(</span><span class="ident" id="6165536">format</span>&nbsp;<span class="builtintype" id="6165543">string</span><span class="op" id="6165549">,</span>&nbsp;<span class="ident" id="6165551">args</span>&nbsp;<span class="op" id="6165556">...</span><span class="keyword" id="6165559">interface</span><span class="op" id="6165568">{</span><span class="op" id="6165569">}</span><span class="op" id="6165570">)</span>&nbsp;<span class="op" id="6165572">{</span>&nbsp;<span class="ident" id="6165574">c</span><span class="op" id="6165575">.</span><span class="ident" id="6165576">log</span><span class="op" id="6165579">(</span><span class="ident" id="6165580">fmt</span><span class="op" id="6165583">.</span><span class="ident" id="6165584">Sprintf</span><span class="op" id="6165591">(</span><span class="ident" id="6165592">format</span><span class="op" id="6165598">,</span>&nbsp;<span class="ident" id="6165600">args</span><span class="op" id="6165604">...</span><span class="op" id="6165607">)</span><span class="op" id="6165608">)</span>&nbsp;<span class="op" id="6165610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6165613">//&nbsp;Error&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno">350</span><span class="keyword" id="6165661">func</span>&nbsp;<span class="op" id="6165666">(</span><span class="ident" id="6165667">c</span>&nbsp;<span class="op" id="6165669">*</span><span class="ident" id="6165670">common</span><span class="op" id="6165676">)</span>&nbsp;<span class="ident" id="6165678">Error</span><span class="op" id="6165683">(</span><span class="ident" id="6165684">args</span>&nbsp;<span class="op" id="6165689">...</span><span class="keyword" id="6165692">interface</span><span class="op" id="6165701">{</span><span class="op" id="6165702">}</span><span class="op" id="6165703">)</span>&nbsp;<span class="op" id="6165705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6165708">c</span><span class="op" id="6165709">.</span><span class="ident" id="6165710">log</span><span class="op" id="6165713">(</span><span class="ident" id="6165714">fmt</span><span class="op" id="6165717">.</span><span class="ident" id="6165718">Sprintln</span><span class="op" id="6165726">(</span><span class="ident" id="6165727">args</span><span class="op" id="6165731">...</span><span class="op" id="6165734">)</span><span class="op" id="6165735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6165738">c</span><span class="op" id="6165739">.</span><span class="ident" id="6165740">Fail</span><span class="op" id="6165744">(</span><span class="op" id="6165745">)</span><br>
<span class="lineno"></span><span class="op" id="6165747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6165750">//&nbsp;Errorf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno"></span><span class="keyword" id="6165800">func</span>&nbsp;<span class="op" id="6165805">(</span><span class="ident" id="6165806">c</span>&nbsp;<span class="op" id="6165808">*</span><span class="ident" id="6165809">common</span><span class="op" id="6165815">)</span>&nbsp;<span class="ident" id="6165817">Errorf</span><span class="op" id="6165823">(</span><span class="ident" id="6165824">format</span>&nbsp;<span class="builtintype" id="6165831">string</span><span class="op" id="6165837">,</span>&nbsp;<span class="ident" id="6165839">args</span>&nbsp;<span class="op" id="6165844">...</span><span class="keyword" id="6165847">interface</span><span class="op" id="6165856">{</span><span class="op" id="6165857">}</span><span class="op" id="6165858">)</span>&nbsp;<span class="op" id="6165860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6165863">c</span><span class="op" id="6165864">.</span><span class="ident" id="6165865">log</span><span class="op" id="6165868">(</span><span class="ident" id="6165869">fmt</span><span class="op" id="6165872">.</span><span class="ident" id="6165873">Sprintf</span><span class="op" id="6165880">(</span><span class="ident" id="6165881">format</span><span class="op" id="6165887">,</span>&nbsp;<span class="ident" id="6165889">args</span><span class="op" id="6165893">...</span><span class="op" id="6165896">)</span><span class="op" id="6165897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6165900">c</span><span class="op" id="6165901">.</span><span class="ident" id="6165902">Fail</span><span class="op" id="6165906">(</span><span class="op" id="6165907">)</span><br>
<span class="lineno"></span><span class="op" id="6165909">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="6165912">//&nbsp;Fatal&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6165963">func</span>&nbsp;<span class="op" id="6165968">(</span><span class="ident" id="6165969">c</span>&nbsp;<span class="op" id="6165971">*</span><span class="ident" id="6165972">common</span><span class="op" id="6165978">)</span>&nbsp;<span class="ident" id="6165980">Fatal</span><span class="op" id="6165985">(</span><span class="ident" id="6165986">args</span>&nbsp;<span class="op" id="6165991">...</span><span class="keyword" id="6165994">interface</span><span class="op" id="6166003">{</span><span class="op" id="6166004">}</span><span class="op" id="6166005">)</span>&nbsp;<span class="op" id="6166007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166010">c</span><span class="op" id="6166011">.</span><span class="ident" id="6166012">log</span><span class="op" id="6166015">(</span><span class="ident" id="6166016">fmt</span><span class="op" id="6166019">.</span><span class="ident" id="6166020">Sprintln</span><span class="op" id="6166028">(</span><span class="ident" id="6166029">args</span><span class="op" id="6166033">...</span><span class="op" id="6166036">)</span><span class="op" id="6166037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166040">c</span><span class="op" id="6166041">.</span><span class="ident" id="6166042">FailNow</span><span class="op" id="6166049">(</span><span class="op" id="6166050">)</span><br>
<span class="lineno">365</span><span class="op" id="6166052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6166055">//&nbsp;Fatalf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6166108">func</span>&nbsp;<span class="op" id="6166113">(</span><span class="ident" id="6166114">c</span>&nbsp;<span class="op" id="6166116">*</span><span class="ident" id="6166117">common</span><span class="op" id="6166123">)</span>&nbsp;<span class="ident" id="6166125">Fatalf</span><span class="op" id="6166131">(</span><span class="ident" id="6166132">format</span>&nbsp;<span class="builtintype" id="6166139">string</span><span class="op" id="6166145">,</span>&nbsp;<span class="ident" id="6166147">args</span>&nbsp;<span class="op" id="6166152">...</span><span class="keyword" id="6166155">interface</span><span class="op" id="6166164">{</span><span class="op" id="6166165">}</span><span class="op" id="6166166">)</span>&nbsp;<span class="op" id="6166168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166171">c</span><span class="op" id="6166172">.</span><span class="ident" id="6166173">log</span><span class="op" id="6166176">(</span><span class="ident" id="6166177">fmt</span><span class="op" id="6166180">.</span><span class="ident" id="6166181">Sprintf</span><span class="op" id="6166188">(</span><span class="ident" id="6166189">format</span><span class="op" id="6166195">,</span>&nbsp;<span class="ident" id="6166197">args</span><span class="op" id="6166201">...</span><span class="op" id="6166204">)</span><span class="op" id="6166205">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166208">c</span><span class="op" id="6166209">.</span><span class="ident" id="6166210">FailNow</span><span class="op" id="6166217">(</span><span class="op" id="6166218">)</span><br>
<span class="lineno"></span><span class="op" id="6166220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6166223">//&nbsp;Skip&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6166273">func</span>&nbsp;<span class="op" id="6166278">(</span><span class="ident" id="6166279">c</span>&nbsp;<span class="op" id="6166281">*</span><span class="ident" id="6166282">common</span><span class="op" id="6166288">)</span>&nbsp;<span class="ident" id="6166290">Skip</span><span class="op" id="6166294">(</span><span class="ident" id="6166295">args</span>&nbsp;<span class="op" id="6166300">...</span><span class="keyword" id="6166303">interface</span><span class="op" id="6166312">{</span><span class="op" id="6166313">}</span><span class="op" id="6166314">)</span>&nbsp;<span class="op" id="6166316">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166319">c</span><span class="op" id="6166320">.</span><span class="ident" id="6166321">log</span><span class="op" id="6166324">(</span><span class="ident" id="6166325">fmt</span><span class="op" id="6166328">.</span><span class="ident" id="6166329">Sprintln</span><span class="op" id="6166337">(</span><span class="ident" id="6166338">args</span><span class="op" id="6166342">...</span><span class="op" id="6166345">)</span><span class="op" id="6166346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166349">c</span><span class="op" id="6166350">.</span><span class="ident" id="6166351">SkipNow</span><span class="op" id="6166358">(</span><span class="op" id="6166359">)</span><br>
<span class="lineno"></span><span class="op" id="6166361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6166364">//&nbsp;Skipf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno">380</span><span class="keyword" id="6166416">func</span>&nbsp;<span class="op" id="6166421">(</span><span class="ident" id="6166422">c</span>&nbsp;<span class="op" id="6166424">*</span><span class="ident" id="6166425">common</span><span class="op" id="6166431">)</span>&nbsp;<span class="ident" id="6166433">Skipf</span><span class="op" id="6166438">(</span><span class="ident" id="6166439">format</span>&nbsp;<span class="builtintype" id="6166446">string</span><span class="op" id="6166452">,</span>&nbsp;<span class="ident" id="6166454">args</span>&nbsp;<span class="op" id="6166459">...</span><span class="keyword" id="6166462">interface</span><span class="op" id="6166471">{</span><span class="op" id="6166472">}</span><span class="op" id="6166473">)</span>&nbsp;<span class="op" id="6166475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166478">c</span><span class="op" id="6166479">.</span><span class="ident" id="6166480">log</span><span class="op" id="6166483">(</span><span class="ident" id="6166484">fmt</span><span class="op" id="6166487">.</span><span class="ident" id="6166488">Sprintf</span><span class="op" id="6166495">(</span><span class="ident" id="6166496">format</span><span class="op" id="6166502">,</span>&nbsp;<span class="ident" id="6166504">args</span><span class="op" id="6166508">...</span><span class="op" id="6166511">)</span><span class="op" id="6166512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166515">c</span><span class="op" id="6166516">.</span><span class="ident" id="6166517">SkipNow</span><span class="op" id="6166524">(</span><span class="op" id="6166525">)</span><br>
<span class="lineno"></span><span class="op" id="6166527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="6166530">//&nbsp;SkipNow&nbsp;marks&nbsp;the&nbsp;test&nbsp;as&nbsp;having&nbsp;been&nbsp;skipped&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6166604">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.&nbsp;See&nbsp;also&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="comment" id="6166680">//&nbsp;SkipNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the&nbsp;test,&nbsp;not&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6166752">//&nbsp;other&nbsp;goroutines&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;SkipNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno"></span><span class="comment" id="6166827">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno">390</span><span class="keyword" id="6166854">func</span>&nbsp;<span class="op" id="6166859">(</span><span class="ident" id="6166860">c</span>&nbsp;<span class="op" id="6166862">*</span><span class="ident" id="6166863">common</span><span class="op" id="6166869">)</span>&nbsp;<span class="ident" id="6166871">SkipNow</span><span class="op" id="6166878">(</span><span class="op" id="6166879">)</span>&nbsp;<span class="op" id="6166881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166884">c</span><span class="op" id="6166885">.</span><span class="ident" id="6166886">skip</span><span class="op" id="6166890">(</span><span class="op" id="6166891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166894">c</span><span class="op" id="6166895">.</span><span class="ident" id="6166896">finished</span>&nbsp;<span class="op" id="6166905">=</span>&nbsp;<span class="builtintype" id="6166907">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166913">runtime</span><span class="op" id="6166920">.</span><span class="ident" id="6166921">Goexit</span><span class="op" id="6166927">(</span><span class="op" id="6166928">)</span><br>
<span class="lineno"></span><span class="op" id="6166930">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="6166933">func</span>&nbsp;<span class="op" id="6166938">(</span><span class="ident" id="6166939">c</span>&nbsp;<span class="op" id="6166941">*</span><span class="ident" id="6166942">common</span><span class="op" id="6166948">)</span>&nbsp;<span class="ident" id="6166950">skip</span><span class="op" id="6166954">(</span><span class="op" id="6166955">)</span>&nbsp;<span class="op" id="6166957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166960">c</span><span class="op" id="6166961">.</span><span class="ident" id="6166962">mu</span><span class="op" id="6166964">.</span><span class="ident" id="6166965">Lock</span><span class="op" id="6166969">(</span><span class="op" id="6166970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6166973">defer</span>&nbsp;<span class="ident" id="6166979">c</span><span class="op" id="6166980">.</span><span class="ident" id="6166981">mu</span><span class="op" id="6166983">.</span><span class="ident" id="6166984">Unlock</span><span class="op" id="6166990">(</span><span class="op" id="6166991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166994">c</span><span class="op" id="6166995">.</span><span class="ident" id="6166996">skipped</span>&nbsp;<span class="op" id="6167004">=</span>&nbsp;<span class="builtintype" id="6167006">true</span><br>
<span class="lineno">400</span><span class="op" id="6167011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6167014">//&nbsp;Skipped&nbsp;reports&nbsp;whether&nbsp;the&nbsp;test&nbsp;was&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="6167063">func</span>&nbsp;<span class="op" id="6167068">(</span><span class="ident" id="6167069">c</span>&nbsp;<span class="op" id="6167071">*</span><span class="ident" id="6167072">common</span><span class="op" id="6167078">)</span>&nbsp;<span class="ident" id="6167080">Skipped</span><span class="op" id="6167087">(</span><span class="op" id="6167088">)</span>&nbsp;<span class="builtintype" id="6167090">bool</span>&nbsp;<span class="op" id="6167095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6167098">c</span><span class="op" id="6167099">.</span><span class="ident" id="6167100">mu</span><span class="op" id="6167102">.</span><span class="ident" id="6167103">RLock</span><span class="op" id="6167108">(</span><span class="op" id="6167109">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6167112">defer</span>&nbsp;<span class="ident" id="6167118">c</span><span class="op" id="6167119">.</span><span class="ident" id="6167120">mu</span><span class="op" id="6167122">.</span><span class="ident" id="6167123">RUnlock</span><span class="op" id="6167130">(</span><span class="op" id="6167131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6167134">return</span>&nbsp;<span class="ident" id="6167141">c</span><span class="op" id="6167142">.</span><span class="ident" id="6167143">skipped</span><br>
<span class="lineno"></span><span class="op" id="6167151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6167154">//&nbsp;Parallel&nbsp;signals&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;to&nbsp;be&nbsp;run&nbsp;in&nbsp;parallel&nbsp;with&nbsp;(and&nbsp;only&nbsp;with)</span><br>
<span class="lineno">410</span><span class="comment" id="6167235">//&nbsp;other&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6167260">func</span>&nbsp;<span class="op" id="6167265">(</span><span class="ident" id="6167266">t</span>&nbsp;<span class="op" id="6167268">*</span><span class="ident" id="6167269">T</span><span class="op" id="6167270">)</span>&nbsp;<span class="ident" id="6167272">Parallel</span><span class="op" id="6167280">(</span><span class="op" id="6167281">)</span>&nbsp;<span class="op" id="6167283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6167286">t</span><span class="op" id="6167287">.</span><span class="ident" id="6167288">signal</span>&nbsp;<span class="op" id="6167295">&lt;-</span>&nbsp;<span class="op" id="6167298">(</span><span class="op" id="6167299">*</span><span class="ident" id="6167300">T</span><span class="op" id="6167301">)</span><span class="op" id="6167302">(</span><span class="builtintype" id="6167303">nil</span><span class="op" id="6167306">)</span>&nbsp;<span class="comment" id="6167308">//&nbsp;Release&nbsp;main&nbsp;testing&nbsp;loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6167338">&lt;-</span><span class="ident" id="6167340">t</span><span class="op" id="6167341">.</span><span class="ident" id="6167342">startParallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167360">//&nbsp;Wait&nbsp;for&nbsp;serial&nbsp;tests&nbsp;to&nbsp;finish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167396">//&nbsp;Assuming&nbsp;Parallel&nbsp;is&nbsp;the&nbsp;first&nbsp;thing&nbsp;a&nbsp;test&nbsp;does,&nbsp;which&nbsp;is&nbsp;reasonable,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167471">//&nbsp;reinitialize&nbsp;the&nbsp;test&#39;s&nbsp;start&nbsp;time&nbsp;because&nbsp;it&#39;s&nbsp;actually&nbsp;starting&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6167546">t</span><span class="op" id="6167547">.</span><span class="ident" id="6167548">start</span>&nbsp;<span class="op" id="6167554">=</span>&nbsp;<span class="ident" id="6167556">time</span><span class="op" id="6167560">.</span><span class="ident" id="6167561">Now</span><span class="op" id="6167564">(</span><span class="op" id="6167565">)</span><br>
<span class="lineno"></span><span class="op" id="6167567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6167570">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno">420</span><span class="comment" id="6167659">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6167688">type</span>&nbsp;<span class="ident" id="6167693">InternalTest</span>&nbsp;<span class="keyword" id="6167706">struct</span>&nbsp;<span class="op" id="6167713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6167716">Name</span>&nbsp;<span class="builtintype" id="6167721">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6167729">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6167734">func</span><span class="op" id="6167738">(</span><span class="op" id="6167739">*</span><span class="ident" id="6167740">T</span><span class="op" id="6167741">)</span><br>
<span class="lineno"></span><span class="op" id="6167743">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="6167746">func</span>&nbsp;<span class="ident" id="6167751">tRunner</span><span class="op" id="6167758">(</span><span class="ident" id="6167759">t</span>&nbsp;<span class="op" id="6167761">*</span><span class="ident" id="6167762">T</span><span class="op" id="6167763">,</span>&nbsp;<span class="ident" id="6167765">test</span>&nbsp;<span class="op" id="6167770">*</span><span class="ident" id="6167771">InternalTest</span><span class="op" id="6167783">)</span>&nbsp;<span class="op" id="6167785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167788">//&nbsp;When&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;done,&nbsp;either&nbsp;because&nbsp;test.F(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167846">//&nbsp;returned&nbsp;normally&nbsp;or&nbsp;because&nbsp;a&nbsp;test&nbsp;failure&nbsp;triggered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167904">//&nbsp;a&nbsp;call&nbsp;to&nbsp;runtime.Goexit,&nbsp;record&nbsp;the&nbsp;duration&nbsp;and&nbsp;send</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167963">//&nbsp;a&nbsp;signal&nbsp;saying&nbsp;that&nbsp;the&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168006">defer</span>&nbsp;<span class="keyword" id="6168012">func</span><span class="op" id="6168016">(</span><span class="op" id="6168017">)</span>&nbsp;<span class="op" id="6168019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168023">t</span><span class="op" id="6168024">.</span><span class="ident" id="6168025">duration</span>&nbsp;<span class="op" id="6168034">=</span>&nbsp;<span class="ident" id="6168036">time</span><span class="op" id="6168040">.</span><span class="ident" id="6168041">Now</span><span class="op" id="6168044">(</span><span class="op" id="6168045">)</span><span class="op" id="6168046">.</span><span class="ident" id="6168047">Sub</span><span class="op" id="6168050">(</span><span class="ident" id="6168051">t</span><span class="op" id="6168052">.</span><span class="ident" id="6168053">start</span><span class="op" id="6168058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6168062">//&nbsp;If&nbsp;the&nbsp;test&nbsp;panicked,&nbsp;print&nbsp;any&nbsp;test&nbsp;output&nbsp;before&nbsp;dying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168125">err</span>&nbsp;<span class="op" id="6168129">:=</span>&nbsp;<span class="builtinfunc" id="6168132">recover</span><span class="op" id="6168139">(</span><span class="op" id="6168140">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168144">if</span>&nbsp;<span class="op" id="6168147">!</span><span class="ident" id="6168148">t</span><span class="op" id="6168149">.</span><span class="ident" id="6168150">finished</span>&nbsp;<span class="op" id="6168159">&amp;&amp;</span>&nbsp;<span class="ident" id="6168162">err</span>&nbsp;<span class="op" id="6168166">==</span>&nbsp;<span class="builtintype" id="6168169">nil</span>&nbsp;<span class="op" id="6168173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168178">err</span>&nbsp;<span class="op" id="6168182">=</span>&nbsp;<span class="ident" id="6168184">fmt</span><span class="op" id="6168187">.</span><span class="ident" id="6168188">Errorf</span><span class="op" id="6168194">(</span><span class="string" id="6168195">&#34;test&nbsp;executed&nbsp;panic(nil)&nbsp;or&nbsp;runtime.Goexit&#34;</span><span class="op" id="6168239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6168243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168247">if</span>&nbsp;<span class="ident" id="6168250">err</span>&nbsp;<span class="op" id="6168254">!=</span>&nbsp;<span class="builtintype" id="6168257">nil</span>&nbsp;<span class="op" id="6168261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168266">t</span><span class="op" id="6168267">.</span><span class="ident" id="6168268">Fail</span><span class="op" id="6168272">(</span><span class="op" id="6168273">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168278">t</span><span class="op" id="6168279">.</span><span class="ident" id="6168280">report</span><span class="op" id="6168286">(</span><span class="op" id="6168287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6168292">panic</span><span class="op" id="6168297">(</span><span class="ident" id="6168298">err</span><span class="op" id="6168301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6168305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168309">t</span><span class="op" id="6168310">.</span><span class="ident" id="6168311">signal</span>&nbsp;<span class="op" id="6168318">&lt;-</span>&nbsp;<span class="ident" id="6168321">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6168324">}</span><span class="op" id="6168325">(</span><span class="op" id="6168326">)</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168330">t</span><span class="op" id="6168331">.</span><span class="ident" id="6168332">start</span>&nbsp;<span class="op" id="6168338">=</span>&nbsp;<span class="ident" id="6168340">time</span><span class="op" id="6168344">.</span><span class="ident" id="6168345">Now</span><span class="op" id="6168348">(</span><span class="op" id="6168349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168352">test</span><span class="op" id="6168356">.</span><span class="ident" id="6168357">F</span><span class="op" id="6168358">(</span><span class="ident" id="6168359">t</span><span class="op" id="6168360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168363">t</span><span class="op" id="6168364">.</span><span class="ident" id="6168365">finished</span>&nbsp;<span class="op" id="6168374">=</span>&nbsp;<span class="builtintype" id="6168376">true</span><br>
<span class="lineno"></span><span class="op" id="6168381">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="comment" id="6168384">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6168477">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6168506">func</span>&nbsp;<span class="ident" id="6168511">Main</span><span class="op" id="6168515">(</span><span class="ident" id="6168516">matchString</span>&nbsp;<span class="keyword" id="6168528">func</span><span class="op" id="6168532">(</span><span class="ident" id="6168533">pat</span><span class="op" id="6168536">,</span>&nbsp;<span class="ident" id="6168538">str</span>&nbsp;<span class="builtintype" id="6168542">string</span><span class="op" id="6168548">)</span>&nbsp;<span class="op" id="6168550">(</span><span class="builtintype" id="6168551">bool</span><span class="op" id="6168555">,</span>&nbsp;<span class="builtintype" id="6168557">error</span><span class="op" id="6168562">)</span><span class="op" id="6168563">,</span>&nbsp;<span class="ident" id="6168565">tests</span>&nbsp;<span class="op" id="6168571">[</span><span class="op" id="6168572">]</span><span class="ident" id="6168573">InternalTest</span><span class="op" id="6168585">,</span>&nbsp;<span class="ident" id="6168587">benchmarks</span>&nbsp;<span class="op" id="6168598">[</span><span class="op" id="6168599">]</span><span class="ident" id="6168600">InternalBenchmark</span><span class="op" id="6168617">,</span>&nbsp;<span class="ident" id="6168619">examples</span>&nbsp;<span class="op" id="6168628">[</span><span class="op" id="6168629">]</span><span class="ident" id="6168630">InternalExample</span><span class="op" id="6168645">)</span>&nbsp;<span class="op" id="6168647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168650">os</span><span class="op" id="6168652">.</span><span class="ident" id="6168653">Exit</span><span class="op" id="6168657">(</span><span class="ident" id="6168658">MainStart</span><span class="op" id="6168667">(</span><span class="ident" id="6168668">matchString</span><span class="op" id="6168679">,</span>&nbsp;<span class="ident" id="6168681">tests</span><span class="op" id="6168686">,</span>&nbsp;<span class="ident" id="6168688">benchmarks</span><span class="op" id="6168698">,</span>&nbsp;<span class="ident" id="6168700">examples</span><span class="op" id="6168708">)</span><span class="op" id="6168709">.</span><span class="ident" id="6168710">Run</span><span class="op" id="6168713">(</span><span class="op" id="6168714">)</span><span class="op" id="6168715">)</span><br>
<span class="lineno">455</span><span class="op" id="6168717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6168720">//&nbsp;M&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;a&nbsp;TestMain&nbsp;function&nbsp;to&nbsp;run&nbsp;the&nbsp;actual&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6168790">type</span>&nbsp;<span class="ident" id="6168795">M</span>&nbsp;<span class="keyword" id="6168797">struct</span>&nbsp;<span class="op" id="6168804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168807">matchString</span>&nbsp;<span class="keyword" id="6168819">func</span><span class="op" id="6168823">(</span><span class="ident" id="6168824">pat</span><span class="op" id="6168827">,</span>&nbsp;<span class="ident" id="6168829">str</span>&nbsp;<span class="builtintype" id="6168833">string</span><span class="op" id="6168839">)</span>&nbsp;<span class="op" id="6168841">(</span><span class="builtintype" id="6168842">bool</span><span class="op" id="6168846">,</span>&nbsp;<span class="builtintype" id="6168848">error</span><span class="op" id="6168853">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168856">tests</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6168868">[</span><span class="op" id="6168869">]</span><span class="ident" id="6168870">InternalTest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168884">benchmarks</span>&nbsp;&nbsp;<span class="op" id="6168896">[</span><span class="op" id="6168897">]</span><span class="ident" id="6168898">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168917">examples</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6168929">[</span><span class="op" id="6168930">]</span><span class="ident" id="6168931">InternalExample</span><br>
<span class="lineno"></span><span class="op" id="6168947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="comment" id="6168950">//&nbsp;MainStart&nbsp;is&nbsp;meant&nbsp;for&nbsp;use&nbsp;by&nbsp;tests&nbsp;generated&nbsp;by&nbsp;&#39;go&nbsp;test&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6169013">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;called&nbsp;directly&nbsp;and&nbsp;is&nbsp;not&nbsp;subject&nbsp;to&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;document.</span><br>
<span class="lineno"></span><span class="comment" id="6169109">//&nbsp;It&nbsp;may&nbsp;change&nbsp;signature&nbsp;from&nbsp;release&nbsp;to&nbsp;release.</span><br>
<span class="lineno"></span><span class="keyword" id="6169161">func</span>&nbsp;<span class="ident" id="6169166">MainStart</span><span class="op" id="6169175">(</span><span class="ident" id="6169176">matchString</span>&nbsp;<span class="keyword" id="6169188">func</span><span class="op" id="6169192">(</span><span class="ident" id="6169193">pat</span><span class="op" id="6169196">,</span>&nbsp;<span class="ident" id="6169198">str</span>&nbsp;<span class="builtintype" id="6169202">string</span><span class="op" id="6169208">)</span>&nbsp;<span class="op" id="6169210">(</span><span class="builtintype" id="6169211">bool</span><span class="op" id="6169215">,</span>&nbsp;<span class="builtintype" id="6169217">error</span><span class="op" id="6169222">)</span><span class="op" id="6169223">,</span>&nbsp;<span class="ident" id="6169225">tests</span>&nbsp;<span class="op" id="6169231">[</span><span class="op" id="6169232">]</span><span class="ident" id="6169233">InternalTest</span><span class="op" id="6169245">,</span>&nbsp;<span class="ident" id="6169247">benchmarks</span>&nbsp;<span class="op" id="6169258">[</span><span class="op" id="6169259">]</span><span class="ident" id="6169260">InternalBenchmark</span><span class="op" id="6169277">,</span>&nbsp;<span class="ident" id="6169279">examples</span>&nbsp;<span class="op" id="6169288">[</span><span class="op" id="6169289">]</span><span class="ident" id="6169290">InternalExample</span><span class="op" id="6169305">)</span>&nbsp;<span class="op" id="6169307">*</span><span class="ident" id="6169308">M</span>&nbsp;<span class="op" id="6169310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169313">return</span>&nbsp;<span class="op" id="6169320">&amp;</span><span class="ident" id="6169321">M</span><span class="op" id="6169322">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169326">matchString</span><span class="op" id="6169337">:</span>&nbsp;<span class="ident" id="6169339">matchString</span><span class="op" id="6169350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169354">tests</span><span class="op" id="6169359">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169367">tests</span><span class="op" id="6169372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169376">benchmarks</span><span class="op" id="6169386">:</span>&nbsp;&nbsp;<span class="ident" id="6169389">benchmarks</span><span class="op" id="6169399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169403">examples</span><span class="op" id="6169411">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169416">examples</span><span class="op" id="6169424">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6169427">}</span><br>
<span class="lineno">475</span><span class="op" id="6169429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6169432">//&nbsp;Run&nbsp;runs&nbsp;the&nbsp;tests.&nbsp;It&nbsp;returns&nbsp;an&nbsp;exit&nbsp;code&nbsp;to&nbsp;pass&nbsp;to&nbsp;os.Exit.</span><br>
<span class="lineno"></span><span class="keyword" id="6169499">func</span>&nbsp;<span class="op" id="6169504">(</span><span class="ident" id="6169505">m</span>&nbsp;<span class="op" id="6169507">*</span><span class="ident" id="6169508">M</span><span class="op" id="6169509">)</span>&nbsp;<span class="ident" id="6169511">Run</span><span class="op" id="6169514">(</span><span class="op" id="6169515">)</span>&nbsp;<span class="builtintype" id="6169517">int</span>&nbsp;<span class="op" id="6169521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169524">flag</span><span class="op" id="6169528">.</span><span class="ident" id="6169529">Parse</span><span class="op" id="6169534">(</span><span class="op" id="6169535">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169538">parseCpuList</span><span class="op" id="6169550">(</span><span class="op" id="6169551">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169555">before</span><span class="op" id="6169561">(</span><span class="op" id="6169562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169565">startAlarm</span><span class="op" id="6169575">(</span><span class="op" id="6169576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169579">haveExamples</span>&nbsp;<span class="op" id="6169592">=</span>&nbsp;<span class="builtinfunc" id="6169594">len</span><span class="op" id="6169597">(</span><span class="ident" id="6169598">m</span><span class="op" id="6169599">.</span><span class="ident" id="6169600">examples</span><span class="op" id="6169608">)</span>&nbsp;<span class="op" id="6169610">&gt;</span>&nbsp;<span class="num" id="6169612">0</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169615">testOk</span>&nbsp;<span class="op" id="6169622">:=</span>&nbsp;<span class="ident" id="6169625">RunTests</span><span class="op" id="6169633">(</span><span class="ident" id="6169634">m</span><span class="op" id="6169635">.</span><span class="ident" id="6169636">matchString</span><span class="op" id="6169647">,</span>&nbsp;<span class="ident" id="6169649">m</span><span class="op" id="6169650">.</span><span class="ident" id="6169651">tests</span><span class="op" id="6169656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169659">exampleOk</span>&nbsp;<span class="op" id="6169669">:=</span>&nbsp;<span class="ident" id="6169672">RunExamples</span><span class="op" id="6169683">(</span><span class="ident" id="6169684">m</span><span class="op" id="6169685">.</span><span class="ident" id="6169686">matchString</span><span class="op" id="6169697">,</span>&nbsp;<span class="ident" id="6169699">m</span><span class="op" id="6169700">.</span><span class="ident" id="6169701">examples</span><span class="op" id="6169709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169712">stopAlarm</span><span class="op" id="6169721">(</span><span class="op" id="6169722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169725">if</span>&nbsp;<span class="op" id="6169728">!</span><span class="ident" id="6169729">testOk</span>&nbsp;<span class="op" id="6169736">||</span>&nbsp;<span class="op" id="6169739">!</span><span class="ident" id="6169740">exampleOk</span>&nbsp;<span class="op" id="6169750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169754">fmt</span><span class="op" id="6169757">.</span><span class="ident" id="6169758">Println</span><span class="op" id="6169765">(</span><span class="string" id="6169766">&#34;FAIL&#34;</span><span class="op" id="6169772">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169776">after</span><span class="op" id="6169781">(</span><span class="op" id="6169782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169786">return</span>&nbsp;<span class="num" id="6169793">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6169796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169799">fmt</span><span class="op" id="6169802">.</span><span class="ident" id="6169803">Println</span><span class="op" id="6169810">(</span><span class="string" id="6169811">&#34;PASS&#34;</span><span class="op" id="6169817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169820">RunBenchmarks</span><span class="op" id="6169833">(</span><span class="ident" id="6169834">m</span><span class="op" id="6169835">.</span><span class="ident" id="6169836">matchString</span><span class="op" id="6169847">,</span>&nbsp;<span class="ident" id="6169849">m</span><span class="op" id="6169850">.</span><span class="ident" id="6169851">benchmarks</span><span class="op" id="6169861">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169864">after</span><span class="op" id="6169869">(</span><span class="op" id="6169870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169873">return</span>&nbsp;<span class="num" id="6169880">0</span><br>
<span class="lineno"></span><span class="op" id="6169882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6169885">func</span>&nbsp;<span class="op" id="6169890">(</span><span class="ident" id="6169891">t</span>&nbsp;<span class="op" id="6169893">*</span><span class="ident" id="6169894">T</span><span class="op" id="6169895">)</span>&nbsp;<span class="ident" id="6169897">report</span><span class="op" id="6169903">(</span><span class="op" id="6169904">)</span>&nbsp;<span class="op" id="6169906">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169909">dstr</span>&nbsp;<span class="op" id="6169914">:=</span>&nbsp;<span class="ident" id="6169917">fmtDuration</span><span class="op" id="6169928">(</span><span class="ident" id="6169929">t</span><span class="op" id="6169930">.</span><span class="ident" id="6169931">duration</span><span class="op" id="6169939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169942">format</span>&nbsp;<span class="op" id="6169949">:=</span>&nbsp;<span class="string" id="6169952">&#34;---&nbsp;%s:&nbsp;%s&nbsp;(%s)\n%s&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169975">if</span>&nbsp;<span class="ident" id="6169978">t</span><span class="op" id="6169979">.</span><span class="ident" id="6169980">Failed</span><span class="op" id="6169986">(</span><span class="op" id="6169987">)</span>&nbsp;<span class="op" id="6169989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169993">fmt</span><span class="op" id="6169996">.</span><span class="ident" id="6169997">Printf</span><span class="op" id="6170003">(</span><span class="ident" id="6170004">format</span><span class="op" id="6170010">,</span>&nbsp;<span class="string" id="6170012">&#34;FAIL&#34;</span><span class="op" id="6170018">,</span>&nbsp;<span class="ident" id="6170020">t</span><span class="op" id="6170021">.</span><span class="ident" id="6170022">name</span><span class="op" id="6170026">,</span>&nbsp;<span class="ident" id="6170028">dstr</span><span class="op" id="6170032">,</span>&nbsp;<span class="ident" id="6170034">t</span><span class="op" id="6170035">.</span><span class="ident" id="6170036">output</span><span class="op" id="6170042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170045">}</span>&nbsp;<span class="keyword" id="6170047">else</span>&nbsp;<span class="keyword" id="6170052">if</span>&nbsp;<span class="op" id="6170055">*</span><span class="ident" id="6170056">chatty</span>&nbsp;<span class="op" id="6170063">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170067">if</span>&nbsp;<span class="ident" id="6170070">t</span><span class="op" id="6170071">.</span><span class="ident" id="6170072">Skipped</span><span class="op" id="6170079">(</span><span class="op" id="6170080">)</span>&nbsp;<span class="op" id="6170082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170087">fmt</span><span class="op" id="6170090">.</span><span class="ident" id="6170091">Printf</span><span class="op" id="6170097">(</span><span class="ident" id="6170098">format</span><span class="op" id="6170104">,</span>&nbsp;<span class="string" id="6170106">&#34;SKIP&#34;</span><span class="op" id="6170112">,</span>&nbsp;<span class="ident" id="6170114">t</span><span class="op" id="6170115">.</span><span class="ident" id="6170116">name</span><span class="op" id="6170120">,</span>&nbsp;<span class="ident" id="6170122">dstr</span><span class="op" id="6170126">,</span>&nbsp;<span class="ident" id="6170128">t</span><span class="op" id="6170129">.</span><span class="ident" id="6170130">output</span><span class="op" id="6170136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170140">}</span>&nbsp;<span class="keyword" id="6170142">else</span>&nbsp;<span class="op" id="6170147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170152">fmt</span><span class="op" id="6170155">.</span><span class="ident" id="6170156">Printf</span><span class="op" id="6170162">(</span><span class="ident" id="6170163">format</span><span class="op" id="6170169">,</span>&nbsp;<span class="string" id="6170171">&#34;PASS&#34;</span><span class="op" id="6170177">,</span>&nbsp;<span class="ident" id="6170179">t</span><span class="op" id="6170180">.</span><span class="ident" id="6170181">name</span><span class="op" id="6170185">,</span>&nbsp;<span class="ident" id="6170187">dstr</span><span class="op" id="6170191">,</span>&nbsp;<span class="ident" id="6170193">t</span><span class="op" id="6170194">.</span><span class="ident" id="6170195">output</span><span class="op" id="6170201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170205">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170208">}</span><br>
<span class="lineno"></span><span class="op" id="6170210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6170213">func</span>&nbsp;<span class="ident" id="6170218">RunTests</span><span class="op" id="6170226">(</span><span class="ident" id="6170227">matchString</span>&nbsp;<span class="keyword" id="6170239">func</span><span class="op" id="6170243">(</span><span class="ident" id="6170244">pat</span><span class="op" id="6170247">,</span>&nbsp;<span class="ident" id="6170249">str</span>&nbsp;<span class="builtintype" id="6170253">string</span><span class="op" id="6170259">)</span>&nbsp;<span class="op" id="6170261">(</span><span class="builtintype" id="6170262">bool</span><span class="op" id="6170266">,</span>&nbsp;<span class="builtintype" id="6170268">error</span><span class="op" id="6170273">)</span><span class="op" id="6170274">,</span>&nbsp;<span class="ident" id="6170276">tests</span>&nbsp;<span class="op" id="6170282">[</span><span class="op" id="6170283">]</span><span class="ident" id="6170284">InternalTest</span><span class="op" id="6170296">)</span>&nbsp;<span class="op" id="6170298">(</span><span class="ident" id="6170299">ok</span>&nbsp;<span class="builtintype" id="6170302">bool</span><span class="op" id="6170306">)</span>&nbsp;<span class="op" id="6170308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170311">ok</span>&nbsp;<span class="op" id="6170314">=</span>&nbsp;<span class="builtintype" id="6170316">true</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170322">if</span>&nbsp;<span class="builtinfunc" id="6170325">len</span><span class="op" id="6170328">(</span><span class="ident" id="6170329">tests</span><span class="op" id="6170334">)</span>&nbsp;<span class="op" id="6170336">==</span>&nbsp;<span class="num" id="6170339">0</span>&nbsp;<span class="op" id="6170341">&amp;&amp;</span>&nbsp;<span class="op" id="6170344">!</span><span class="ident" id="6170345">haveExamples</span>&nbsp;<span class="op" id="6170358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170362">fmt</span><span class="op" id="6170365">.</span><span class="ident" id="6170366">Fprintln</span><span class="op" id="6170374">(</span><span class="ident" id="6170375">os</span><span class="op" id="6170377">.</span><span class="ident" id="6170378">Stderr</span><span class="op" id="6170384">,</span>&nbsp;<span class="string" id="6170386">&#34;testing:&nbsp;warning:&nbsp;no&nbsp;tests&nbsp;to&nbsp;run&#34;</span><span class="op" id="6170421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170425">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170436">for</span>&nbsp;<span class="ident" id="6170440">_</span><span class="op" id="6170441">,</span>&nbsp;<span class="ident" id="6170443">procs</span>&nbsp;<span class="op" id="6170449">:=</span>&nbsp;<span class="keyword" id="6170452">range</span>&nbsp;<span class="ident" id="6170458">cpuList</span>&nbsp;<span class="op" id="6170466">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170470">runtime</span><span class="op" id="6170477">.</span><span class="ident" id="6170478">GOMAXPROCS</span><span class="op" id="6170488">(</span><span class="ident" id="6170489">procs</span><span class="op" id="6170494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6170498">//&nbsp;We&nbsp;build&nbsp;a&nbsp;new&nbsp;channel&nbsp;tree&nbsp;for&nbsp;each&nbsp;run&nbsp;of&nbsp;the&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6170557">//&nbsp;collector&nbsp;merges&nbsp;in&nbsp;one&nbsp;channel&nbsp;all&nbsp;the&nbsp;upstream&nbsp;signals&nbsp;from&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6170640">//&nbsp;If&nbsp;all&nbsp;tests&nbsp;pump&nbsp;to&nbsp;the&nbsp;same&nbsp;channel,&nbsp;a&nbsp;bug&nbsp;can&nbsp;occur&nbsp;where&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6170713">//&nbsp;kicks&nbsp;off&nbsp;a&nbsp;goroutine&nbsp;that&nbsp;Fails,&nbsp;yet&nbsp;the&nbsp;test&nbsp;still&nbsp;delivers&nbsp;a&nbsp;completion&nbsp;signal,</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6170801">//&nbsp;which&nbsp;skews&nbsp;the&nbsp;counting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170832">var</span>&nbsp;<span class="ident" id="6170836">collector</span>&nbsp;<span class="op" id="6170846">=</span>&nbsp;<span class="builtinfunc" id="6170848">make</span><span class="op" id="6170852">(</span><span class="keyword" id="6170853">chan</span>&nbsp;<span class="keyword" id="6170858">interface</span><span class="op" id="6170867">{</span><span class="op" id="6170868">}</span><span class="op" id="6170869">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170874">numParallel</span>&nbsp;<span class="op" id="6170886">:=</span>&nbsp;<span class="num" id="6170889">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170893">startParallel</span>&nbsp;<span class="op" id="6170907">:=</span>&nbsp;<span class="builtinfunc" id="6170910">make</span><span class="op" id="6170914">(</span><span class="keyword" id="6170915">chan</span>&nbsp;<span class="builtintype" id="6170920">bool</span><span class="op" id="6170924">)</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170929">for</span>&nbsp;<span class="ident" id="6170933">i</span>&nbsp;<span class="op" id="6170935">:=</span>&nbsp;<span class="num" id="6170938">0</span><span class="op" id="6170939">;</span>&nbsp;<span class="ident" id="6170941">i</span>&nbsp;<span class="op" id="6170943">&lt;</span>&nbsp;<span class="builtinfunc" id="6170945">len</span><span class="op" id="6170948">(</span><span class="ident" id="6170949">tests</span><span class="op" id="6170954">)</span><span class="op" id="6170955">;</span>&nbsp;<span class="ident" id="6170957">i</span><span class="op" id="6170958">++</span>&nbsp;<span class="op" id="6170961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170966">matched</span><span class="op" id="6170973">,</span>&nbsp;<span class="ident" id="6170975">err</span>&nbsp;<span class="op" id="6170979">:=</span>&nbsp;<span class="ident" id="6170982">matchString</span><span class="op" id="6170993">(</span><span class="op" id="6170994">*</span><span class="ident" id="6170995">match</span><span class="op" id="6171000">,</span>&nbsp;<span class="ident" id="6171002">tests</span><span class="op" id="6171007">[</span><span class="ident" id="6171008">i</span><span class="op" id="6171009">]</span><span class="op" id="6171010">.</span><span class="ident" id="6171011">Name</span><span class="op" id="6171015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171020">if</span>&nbsp;<span class="ident" id="6171023">err</span>&nbsp;<span class="op" id="6171027">!=</span>&nbsp;<span class="builtintype" id="6171030">nil</span>&nbsp;<span class="op" id="6171034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171040">fmt</span><span class="op" id="6171043">.</span><span class="ident" id="6171044">Fprintf</span><span class="op" id="6171051">(</span><span class="ident" id="6171052">os</span><span class="op" id="6171054">.</span><span class="ident" id="6171055">Stderr</span><span class="op" id="6171061">,</span>&nbsp;<span class="string" id="6171063">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.run:&nbsp;%s\n&#34;</span><span class="op" id="6171108">,</span>&nbsp;<span class="ident" id="6171110">err</span><span class="op" id="6171113">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171119">os</span><span class="op" id="6171121">.</span><span class="ident" id="6171122">Exit</span><span class="op" id="6171126">(</span><span class="num" id="6171127">1</span><span class="op" id="6171128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171138">if</span>&nbsp;<span class="op" id="6171141">!</span><span class="ident" id="6171142">matched</span>&nbsp;<span class="op" id="6171150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171156">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171168">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171173">testName</span>&nbsp;<span class="op" id="6171182">:=</span>&nbsp;<span class="ident" id="6171185">tests</span><span class="op" id="6171190">[</span><span class="ident" id="6171191">i</span><span class="op" id="6171192">]</span><span class="op" id="6171193">.</span><span class="ident" id="6171194">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171202">if</span>&nbsp;<span class="ident" id="6171205">procs</span>&nbsp;<span class="op" id="6171211">!=</span>&nbsp;<span class="num" id="6171214">1</span>&nbsp;<span class="op" id="6171216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171222">testName</span>&nbsp;<span class="op" id="6171231">=</span>&nbsp;<span class="ident" id="6171233">fmt</span><span class="op" id="6171236">.</span><span class="ident" id="6171237">Sprintf</span><span class="op" id="6171244">(</span><span class="string" id="6171245">&#34;%s-%d&#34;</span><span class="op" id="6171252">,</span>&nbsp;<span class="ident" id="6171254">tests</span><span class="op" id="6171259">[</span><span class="ident" id="6171260">i</span><span class="op" id="6171261">]</span><span class="op" id="6171262">.</span><span class="ident" id="6171263">Name</span><span class="op" id="6171267">,</span>&nbsp;<span class="ident" id="6171269">procs</span><span class="op" id="6171274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171284">t</span>&nbsp;<span class="op" id="6171286">:=</span>&nbsp;<span class="op" id="6171289">&amp;</span><span class="ident" id="6171290">T</span><span class="op" id="6171291">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171297">common</span><span class="op" id="6171303">:</span>&nbsp;<span class="ident" id="6171305">common</span><span class="op" id="6171311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171318">signal</span><span class="op" id="6171324">:</span>&nbsp;<span class="builtinfunc" id="6171326">make</span><span class="op" id="6171330">(</span><span class="keyword" id="6171331">chan</span>&nbsp;<span class="keyword" id="6171336">interface</span><span class="op" id="6171345">{</span><span class="op" id="6171346">}</span><span class="op" id="6171347">)</span><span class="op" id="6171348">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171354">}</span><span class="op" id="6171355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171361">name</span><span class="op" id="6171365">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171376">testName</span><span class="op" id="6171384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171390">startParallel</span><span class="op" id="6171403">:</span>&nbsp;<span class="ident" id="6171405">startParallel</span><span class="op" id="6171418">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171428">t</span><span class="op" id="6171429">.</span><span class="ident" id="6171430">self</span>&nbsp;<span class="op" id="6171435">=</span>&nbsp;<span class="ident" id="6171437">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171442">if</span>&nbsp;<span class="op" id="6171445">*</span><span class="ident" id="6171446">chatty</span>&nbsp;<span class="op" id="6171453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171459">fmt</span><span class="op" id="6171462">.</span><span class="ident" id="6171463">Printf</span><span class="op" id="6171469">(</span><span class="string" id="6171470">&#34;===&nbsp;RUN&nbsp;%s\n&#34;</span><span class="op" id="6171484">,</span>&nbsp;<span class="ident" id="6171486">t</span><span class="op" id="6171487">.</span><span class="ident" id="6171488">name</span><span class="op" id="6171492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171497">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171502">go</span>&nbsp;<span class="ident" id="6171505">tRunner</span><span class="op" id="6171512">(</span><span class="ident" id="6171513">t</span><span class="op" id="6171514">,</span>&nbsp;<span class="op" id="6171516">&amp;</span><span class="ident" id="6171517">tests</span><span class="op" id="6171522">[</span><span class="ident" id="6171523">i</span><span class="op" id="6171524">]</span><span class="op" id="6171525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171530">out</span>&nbsp;<span class="op" id="6171534">:=</span>&nbsp;<span class="op" id="6171537">(</span><span class="op" id="6171538">&lt;-</span><span class="ident" id="6171540">t</span><span class="op" id="6171541">.</span><span class="ident" id="6171542">signal</span><span class="op" id="6171548">)</span><span class="op" id="6171549">.</span><span class="op" id="6171550">(</span><span class="op" id="6171551">*</span><span class="ident" id="6171552">T</span><span class="op" id="6171553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171558">if</span>&nbsp;<span class="ident" id="6171561">out</span>&nbsp;<span class="op" id="6171565">==</span>&nbsp;<span class="builtintype" id="6171568">nil</span>&nbsp;<span class="op" id="6171572">{</span>&nbsp;<span class="comment" id="6171574">//&nbsp;Parallel&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171595">go</span>&nbsp;<span class="keyword" id="6171598">func</span><span class="op" id="6171602">(</span><span class="op" id="6171603">)</span>&nbsp;<span class="op" id="6171605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171612">collector</span>&nbsp;<span class="op" id="6171622">&lt;-</span>&nbsp;<span class="op" id="6171625">&lt;-</span><span class="ident" id="6171627">t</span><span class="op" id="6171628">.</span><span class="ident" id="6171629">signal</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171640">}</span><span class="op" id="6171641">(</span><span class="op" id="6171642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171648">numParallel</span><span class="op" id="6171659">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171666">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171683">t</span><span class="op" id="6171684">.</span><span class="ident" id="6171685">report</span><span class="op" id="6171691">(</span><span class="op" id="6171692">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171697">ok</span>&nbsp;<span class="op" id="6171700">=</span>&nbsp;<span class="ident" id="6171702">ok</span>&nbsp;<span class="op" id="6171705">&amp;&amp;</span>&nbsp;<span class="op" id="6171708">!</span><span class="ident" id="6171709">out</span><span class="op" id="6171712">.</span><span class="ident" id="6171713">Failed</span><span class="op" id="6171719">(</span><span class="op" id="6171720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171729">running</span>&nbsp;<span class="op" id="6171737">:=</span>&nbsp;<span class="num" id="6171740">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171744">for</span>&nbsp;<span class="ident" id="6171748">numParallel</span><span class="op" id="6171759">+</span><span class="ident" id="6171760">running</span>&nbsp;<span class="op" id="6171768">&gt;</span>&nbsp;<span class="num" id="6171770">0</span>&nbsp;<span class="op" id="6171772">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171777">if</span>&nbsp;<span class="ident" id="6171780">running</span>&nbsp;<span class="op" id="6171788">&lt;</span>&nbsp;<span class="op" id="6171790">*</span><span class="ident" id="6171791">parallel</span>&nbsp;<span class="op" id="6171800">&amp;&amp;</span>&nbsp;<span class="ident" id="6171803">numParallel</span>&nbsp;<span class="op" id="6171815">&gt;</span>&nbsp;<span class="num" id="6171817">0</span>&nbsp;<span class="op" id="6171819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171825">startParallel</span>&nbsp;<span class="op" id="6171839">&lt;-</span>&nbsp;<span class="builtintype" id="6171842">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171851">running</span><span class="op" id="6171858">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171865">numParallel</span><span class="op" id="6171876">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171883">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171900">t</span>&nbsp;<span class="op" id="6171902">:=</span>&nbsp;<span class="op" id="6171905">(</span><span class="op" id="6171906">&lt;-</span><span class="ident" id="6171908">collector</span><span class="op" id="6171917">)</span><span class="op" id="6171918">.</span><span class="op" id="6171919">(</span><span class="op" id="6171920">*</span><span class="ident" id="6171921">T</span><span class="op" id="6171922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171927">t</span><span class="op" id="6171928">.</span><span class="ident" id="6171929">report</span><span class="op" id="6171935">(</span><span class="op" id="6171936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171941">ok</span>&nbsp;<span class="op" id="6171944">=</span>&nbsp;<span class="ident" id="6171946">ok</span>&nbsp;<span class="op" id="6171949">&amp;&amp;</span>&nbsp;<span class="op" id="6171952">!</span><span class="ident" id="6171953">t</span><span class="op" id="6171954">.</span><span class="ident" id="6171955">Failed</span><span class="op" id="6171961">(</span><span class="op" id="6171962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171967">running</span><span class="op" id="6171974">--</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171985">return</span><br>
<span class="lineno"></span><span class="op" id="6171992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="comment" id="6171995">//&nbsp;before&nbsp;runs&nbsp;before&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6172030">func</span>&nbsp;<span class="ident" id="6172035">before</span><span class="op" id="6172041">(</span><span class="op" id="6172042">)</span>&nbsp;<span class="op" id="6172044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172047">if</span>&nbsp;<span class="op" id="6172050">*</span><span class="ident" id="6172051">memProfileRate</span>&nbsp;<span class="op" id="6172066">&gt;</span>&nbsp;<span class="num" id="6172068">0</span>&nbsp;<span class="op" id="6172070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172074">runtime</span><span class="op" id="6172081">.</span><span class="ident" id="6172082">MemProfileRate</span>&nbsp;<span class="op" id="6172097">=</span>&nbsp;<span class="op" id="6172099">*</span><span class="ident" id="6172100">memProfileRate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6172116">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172119">if</span>&nbsp;<span class="op" id="6172122">*</span><span class="ident" id="6172123">cpuProfile</span>&nbsp;<span class="op" id="6172134">!=</span>&nbsp;<span class="string" id="6172137">&#34;&#34;</span>&nbsp;<span class="op" id="6172140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172144">f</span><span class="op" id="6172145">,</span>&nbsp;<span class="ident" id="6172147">err</span>&nbsp;<span class="op" id="6172151">:=</span>&nbsp;<span class="ident" id="6172154">os</span><span class="op" id="6172156">.</span><span class="ident" id="6172157">Create</span><span class="op" id="6172163">(</span><span class="ident" id="6172164">toOutputDir</span><span class="op" id="6172175">(</span><span class="op" id="6172176">*</span><span class="ident" id="6172177">cpuProfile</span><span class="op" id="6172187">)</span><span class="op" id="6172188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172192">if</span>&nbsp;<span class="ident" id="6172195">err</span>&nbsp;<span class="op" id="6172199">!=</span>&nbsp;<span class="builtintype" id="6172202">nil</span>&nbsp;<span class="op" id="6172206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172211">fmt</span><span class="op" id="6172214">.</span><span class="ident" id="6172215">Fprintf</span><span class="op" id="6172222">(</span><span class="ident" id="6172223">os</span><span class="op" id="6172225">.</span><span class="ident" id="6172226">Stderr</span><span class="op" id="6172232">,</span>&nbsp;<span class="string" id="6172234">&#34;testing:&nbsp;%s&#34;</span><span class="op" id="6172247">,</span>&nbsp;<span class="ident" id="6172249">err</span><span class="op" id="6172252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172257">return</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6172266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172270">if</span>&nbsp;<span class="ident" id="6172273">err</span>&nbsp;<span class="op" id="6172277">:=</span>&nbsp;<span class="ident" id="6172280">pprof</span><span class="op" id="6172285">.</span><span class="ident" id="6172286">StartCPUProfile</span><span class="op" id="6172301">(</span><span class="ident" id="6172302">f</span><span class="op" id="6172303">)</span><span class="op" id="6172304">;</span>&nbsp;<span class="ident" id="6172306">err</span>&nbsp;<span class="op" id="6172310">!=</span>&nbsp;<span class="builtintype" id="6172313">nil</span>&nbsp;<span class="op" id="6172317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172322">fmt</span><span class="op" id="6172325">.</span><span class="ident" id="6172326">Fprintf</span><span class="op" id="6172333">(</span><span class="ident" id="6172334">os</span><span class="op" id="6172336">.</span><span class="ident" id="6172337">Stderr</span><span class="op" id="6172343">,</span>&nbsp;<span class="string" id="6172345">&#34;testing:&nbsp;can&#39;t&nbsp;start&nbsp;cpu&nbsp;profile:&nbsp;%s&#34;</span><span class="op" id="6172383">,</span>&nbsp;<span class="ident" id="6172385">err</span><span class="op" id="6172388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172393">f</span><span class="op" id="6172394">.</span><span class="ident" id="6172395">Close</span><span class="op" id="6172400">(</span><span class="op" id="6172401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172406">return</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6172415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6172419">//&nbsp;Could&nbsp;save&nbsp;f&nbsp;so&nbsp;after&nbsp;can&nbsp;call&nbsp;f.Close;&nbsp;not&nbsp;worth&nbsp;the&nbsp;effort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6172485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172488">if</span>&nbsp;<span class="op" id="6172491">*</span><span class="ident" id="6172492">blockProfile</span>&nbsp;<span class="op" id="6172505">!=</span>&nbsp;<span class="string" id="6172508">&#34;&#34;</span>&nbsp;<span class="op" id="6172511">&amp;&amp;</span>&nbsp;<span class="op" id="6172514">*</span><span class="ident" id="6172515">blockProfileRate</span>&nbsp;<span class="op" id="6172532">&gt;=</span>&nbsp;<span class="num" id="6172535">0</span>&nbsp;<span class="op" id="6172537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172541">runtime</span><span class="op" id="6172548">.</span><span class="ident" id="6172549">SetBlockProfileRate</span><span class="op" id="6172568">(</span><span class="op" id="6172569">*</span><span class="ident" id="6172570">blockProfileRate</span><span class="op" id="6172586">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6172589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172592">if</span>&nbsp;<span class="op" id="6172595">*</span><span class="ident" id="6172596">coverProfile</span>&nbsp;<span class="op" id="6172609">!=</span>&nbsp;<span class="string" id="6172612">&#34;&#34;</span>&nbsp;<span class="op" id="6172615">&amp;&amp;</span>&nbsp;<span class="ident" id="6172618">cover</span><span class="op" id="6172623">.</span><span class="ident" id="6172624">Mode</span>&nbsp;<span class="op" id="6172629">==</span>&nbsp;<span class="string" id="6172632">&#34;&#34;</span>&nbsp;<span class="op" id="6172635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172639">fmt</span><span class="op" id="6172642">.</span><span class="ident" id="6172643">Fprintf</span><span class="op" id="6172650">(</span><span class="ident" id="6172651">os</span><span class="op" id="6172653">.</span><span class="ident" id="6172654">Stderr</span><span class="op" id="6172660">,</span>&nbsp;<span class="string" id="6172662">&#34;testing:&nbsp;cannot&nbsp;use&nbsp;-test.coverprofile&nbsp;because&nbsp;test&nbsp;binary&nbsp;was&nbsp;not&nbsp;built&nbsp;with&nbsp;coverage&nbsp;enabled\n&#34;</span><span class="op" id="6172760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172764">os</span><span class="op" id="6172766">.</span><span class="ident" id="6172767">Exit</span><span class="op" id="6172771">(</span><span class="num" id="6172772">2</span><span class="op" id="6172773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6172776">}</span><br>
<span class="lineno">610</span><span class="op" id="6172778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6172781">//&nbsp;after&nbsp;runs&nbsp;after&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6172814">func</span>&nbsp;<span class="ident" id="6172819">after</span><span class="op" id="6172824">(</span><span class="op" id="6172825">)</span>&nbsp;<span class="op" id="6172827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172830">if</span>&nbsp;<span class="op" id="6172833">*</span><span class="ident" id="6172834">cpuProfile</span>&nbsp;<span class="op" id="6172845">!=</span>&nbsp;<span class="string" id="6172848">&#34;&#34;</span>&nbsp;<span class="op" id="6172851">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172855">pprof</span><span class="op" id="6172860">.</span><span class="ident" id="6172861">StopCPUProfile</span><span class="op" id="6172875">(</span><span class="op" id="6172876">)</span>&nbsp;<span class="comment" id="6172878">//&nbsp;flushes&nbsp;profile&nbsp;to&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6172906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172909">if</span>&nbsp;<span class="op" id="6172912">*</span><span class="ident" id="6172913">memProfile</span>&nbsp;<span class="op" id="6172924">!=</span>&nbsp;<span class="string" id="6172927">&#34;&#34;</span>&nbsp;<span class="op" id="6172930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172934">f</span><span class="op" id="6172935">,</span>&nbsp;<span class="ident" id="6172937">err</span>&nbsp;<span class="op" id="6172941">:=</span>&nbsp;<span class="ident" id="6172944">os</span><span class="op" id="6172946">.</span><span class="ident" id="6172947">Create</span><span class="op" id="6172953">(</span><span class="ident" id="6172954">toOutputDir</span><span class="op" id="6172965">(</span><span class="op" id="6172966">*</span><span class="ident" id="6172967">memProfile</span><span class="op" id="6172977">)</span><span class="op" id="6172978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172982">if</span>&nbsp;<span class="ident" id="6172985">err</span>&nbsp;<span class="op" id="6172989">!=</span>&nbsp;<span class="builtintype" id="6172992">nil</span>&nbsp;<span class="op" id="6172996">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173001">fmt</span><span class="op" id="6173004">.</span><span class="ident" id="6173005">Fprintf</span><span class="op" id="6173012">(</span><span class="ident" id="6173013">os</span><span class="op" id="6173015">.</span><span class="ident" id="6173016">Stderr</span><span class="op" id="6173022">,</span>&nbsp;<span class="string" id="6173024">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6173039">,</span>&nbsp;<span class="ident" id="6173041">err</span><span class="op" id="6173044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173049">os</span><span class="op" id="6173051">.</span><span class="ident" id="6173052">Exit</span><span class="op" id="6173056">(</span><span class="num" id="6173057">2</span><span class="op" id="6173058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173066">runtime</span><span class="op" id="6173073">.</span><span class="ident" id="6173074">GC</span><span class="op" id="6173076">(</span><span class="op" id="6173077">)</span>&nbsp;<span class="comment" id="6173079">//&nbsp;materialize&nbsp;all&nbsp;statistics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173111">if</span>&nbsp;<span class="ident" id="6173114">err</span>&nbsp;<span class="op" id="6173118">=</span>&nbsp;<span class="ident" id="6173120">pprof</span><span class="op" id="6173125">.</span><span class="ident" id="6173126">WriteHeapProfile</span><span class="op" id="6173142">(</span><span class="ident" id="6173143">f</span><span class="op" id="6173144">)</span><span class="op" id="6173145">;</span>&nbsp;<span class="ident" id="6173147">err</span>&nbsp;<span class="op" id="6173151">!=</span>&nbsp;<span class="builtintype" id="6173154">nil</span>&nbsp;<span class="op" id="6173158">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173163">fmt</span><span class="op" id="6173166">.</span><span class="ident" id="6173167">Fprintf</span><span class="op" id="6173174">(</span><span class="ident" id="6173175">os</span><span class="op" id="6173177">.</span><span class="ident" id="6173178">Stderr</span><span class="op" id="6173184">,</span>&nbsp;<span class="string" id="6173186">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6173217">,</span>&nbsp;<span class="op" id="6173219">*</span><span class="ident" id="6173220">memProfile</span><span class="op" id="6173230">,</span>&nbsp;<span class="ident" id="6173232">err</span><span class="op" id="6173235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173240">os</span><span class="op" id="6173242">.</span><span class="ident" id="6173243">Exit</span><span class="op" id="6173247">(</span><span class="num" id="6173248">2</span><span class="op" id="6173249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173257">f</span><span class="op" id="6173258">.</span><span class="ident" id="6173259">Close</span><span class="op" id="6173264">(</span><span class="op" id="6173265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173268">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173271">if</span>&nbsp;<span class="op" id="6173274">*</span><span class="ident" id="6173275">blockProfile</span>&nbsp;<span class="op" id="6173288">!=</span>&nbsp;<span class="string" id="6173291">&#34;&#34;</span>&nbsp;<span class="op" id="6173294">&amp;&amp;</span>&nbsp;<span class="op" id="6173297">*</span><span class="ident" id="6173298">blockProfileRate</span>&nbsp;<span class="op" id="6173315">&gt;=</span>&nbsp;<span class="num" id="6173318">0</span>&nbsp;<span class="op" id="6173320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173324">f</span><span class="op" id="6173325">,</span>&nbsp;<span class="ident" id="6173327">err</span>&nbsp;<span class="op" id="6173331">:=</span>&nbsp;<span class="ident" id="6173334">os</span><span class="op" id="6173336">.</span><span class="ident" id="6173337">Create</span><span class="op" id="6173343">(</span><span class="ident" id="6173344">toOutputDir</span><span class="op" id="6173355">(</span><span class="op" id="6173356">*</span><span class="ident" id="6173357">blockProfile</span><span class="op" id="6173369">)</span><span class="op" id="6173370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173374">if</span>&nbsp;<span class="ident" id="6173377">err</span>&nbsp;<span class="op" id="6173381">!=</span>&nbsp;<span class="builtintype" id="6173384">nil</span>&nbsp;<span class="op" id="6173388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173393">fmt</span><span class="op" id="6173396">.</span><span class="ident" id="6173397">Fprintf</span><span class="op" id="6173404">(</span><span class="ident" id="6173405">os</span><span class="op" id="6173407">.</span><span class="ident" id="6173408">Stderr</span><span class="op" id="6173414">,</span>&nbsp;<span class="string" id="6173416">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6173431">,</span>&nbsp;<span class="ident" id="6173433">err</span><span class="op" id="6173436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173441">os</span><span class="op" id="6173443">.</span><span class="ident" id="6173444">Exit</span><span class="op" id="6173448">(</span><span class="num" id="6173449">2</span><span class="op" id="6173450">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173458">if</span>&nbsp;<span class="ident" id="6173461">err</span>&nbsp;<span class="op" id="6173465">=</span>&nbsp;<span class="ident" id="6173467">pprof</span><span class="op" id="6173472">.</span><span class="ident" id="6173473">Lookup</span><span class="op" id="6173479">(</span><span class="string" id="6173480">&#34;block&#34;</span><span class="op" id="6173487">)</span><span class="op" id="6173488">.</span><span class="ident" id="6173489">WriteTo</span><span class="op" id="6173496">(</span><span class="ident" id="6173497">f</span><span class="op" id="6173498">,</span>&nbsp;<span class="num" id="6173500">0</span><span class="op" id="6173501">)</span><span class="op" id="6173502">;</span>&nbsp;<span class="ident" id="6173504">err</span>&nbsp;<span class="op" id="6173508">!=</span>&nbsp;<span class="builtintype" id="6173511">nil</span>&nbsp;<span class="op" id="6173515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173520">fmt</span><span class="op" id="6173523">.</span><span class="ident" id="6173524">Fprintf</span><span class="op" id="6173531">(</span><span class="ident" id="6173532">os</span><span class="op" id="6173534">.</span><span class="ident" id="6173535">Stderr</span><span class="op" id="6173541">,</span>&nbsp;<span class="string" id="6173543">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6173574">,</span>&nbsp;<span class="op" id="6173576">*</span><span class="ident" id="6173577">blockProfile</span><span class="op" id="6173589">,</span>&nbsp;<span class="ident" id="6173591">err</span><span class="op" id="6173594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173599">os</span><span class="op" id="6173601">.</span><span class="ident" id="6173602">Exit</span><span class="op" id="6173606">(</span><span class="num" id="6173607">2</span><span class="op" id="6173608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173612">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173616">f</span><span class="op" id="6173617">.</span><span class="ident" id="6173618">Close</span><span class="op" id="6173623">(</span><span class="op" id="6173624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173630">if</span>&nbsp;<span class="ident" id="6173633">cover</span><span class="op" id="6173638">.</span><span class="ident" id="6173639">Mode</span>&nbsp;<span class="op" id="6173644">!=</span>&nbsp;<span class="string" id="6173647">&#34;&#34;</span>&nbsp;<span class="op" id="6173650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173654">coverReport</span><span class="op" id="6173665">(</span><span class="op" id="6173666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173669">}</span><br>
<span class="lineno">645</span><span class="op" id="6173671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6173674">//&nbsp;toOutputDir&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;relocated,&nbsp;if&nbsp;required,&nbsp;to&nbsp;outputDir.</span><br>
<span class="lineno"></span><span class="comment" id="6173749">//&nbsp;Simple&nbsp;implementation&nbsp;to&nbsp;avoid&nbsp;pulling&nbsp;in&nbsp;path/filepath.</span><br>
<span class="lineno"></span><span class="keyword" id="6173809">func</span>&nbsp;<span class="ident" id="6173814">toOutputDir</span><span class="op" id="6173825">(</span><span class="ident" id="6173826">path</span>&nbsp;<span class="builtintype" id="6173831">string</span><span class="op" id="6173837">)</span>&nbsp;<span class="builtintype" id="6173839">string</span>&nbsp;<span class="op" id="6173846">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173849">if</span>&nbsp;<span class="op" id="6173852">*</span><span class="ident" id="6173853">outputDir</span>&nbsp;<span class="op" id="6173863">==</span>&nbsp;<span class="string" id="6173866">&#34;&#34;</span>&nbsp;<span class="op" id="6173869">||</span>&nbsp;<span class="ident" id="6173872">path</span>&nbsp;<span class="op" id="6173877">==</span>&nbsp;<span class="string" id="6173880">&#34;&#34;</span>&nbsp;<span class="op" id="6173883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173887">return</span>&nbsp;<span class="ident" id="6173894">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173903">if</span>&nbsp;<span class="ident" id="6173906">runtime</span><span class="op" id="6173913">.</span><span class="ident" id="6173914">GOOS</span>&nbsp;<span class="op" id="6173919">==</span>&nbsp;<span class="string" id="6173922">&#34;windows&#34;</span>&nbsp;<span class="op" id="6173932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6173936">//&nbsp;On&nbsp;Windows,&nbsp;it&#39;s&nbsp;clumsy,&nbsp;but&nbsp;we&nbsp;can&nbsp;be&nbsp;almost&nbsp;always&nbsp;correct</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174002">//&nbsp;by&nbsp;just&nbsp;looking&nbsp;for&nbsp;a&nbsp;drive&nbsp;letter&nbsp;and&nbsp;a&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174055">//&nbsp;Absolute&nbsp;paths&nbsp;always&nbsp;have&nbsp;a&nbsp;drive&nbsp;letter&nbsp;(ignoring&nbsp;UNC).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174118">//&nbsp;Problem:&nbsp;if&nbsp;path&nbsp;==&nbsp;&#34;C:A&#34;&nbsp;and&nbsp;outputdir&nbsp;==&nbsp;&#34;C:\Go&#34;&nbsp;it&#39;s&nbsp;unclear</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174187">//&nbsp;what&nbsp;to&nbsp;do,&nbsp;but&nbsp;even&nbsp;then&nbsp;path/filepath&nbsp;doesn&#39;t&nbsp;help.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174246">//&nbsp;TODO:&nbsp;Worth&nbsp;doing&nbsp;better?&nbsp;Probably&nbsp;not,&nbsp;because&nbsp;we&#39;re&nbsp;here&nbsp;only</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174315">//&nbsp;under&nbsp;the&nbsp;management&nbsp;of&nbsp;go&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174353">if</span>&nbsp;<span class="builtinfunc" id="6174356">len</span><span class="op" id="6174359">(</span><span class="ident" id="6174360">path</span><span class="op" id="6174364">)</span>&nbsp;<span class="op" id="6174366">&gt;=</span>&nbsp;<span class="num" id="6174369">2</span>&nbsp;<span class="op" id="6174371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174376">letter</span><span class="op" id="6174382">,</span>&nbsp;<span class="ident" id="6174384">colon</span>&nbsp;<span class="op" id="6174390">:=</span>&nbsp;<span class="ident" id="6174393">path</span><span class="op" id="6174397">[</span><span class="num" id="6174398">0</span><span class="op" id="6174399">]</span><span class="op" id="6174400">,</span>&nbsp;<span class="ident" id="6174402">path</span><span class="op" id="6174406">[</span><span class="num" id="6174407">1</span><span class="op" id="6174408">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174413">if</span>&nbsp;<span class="op" id="6174416">(</span><span class="string" id="6174417">&#39;a&#39;</span>&nbsp;<span class="op" id="6174421">&lt;=</span>&nbsp;<span class="ident" id="6174424">letter</span>&nbsp;<span class="op" id="6174431">&amp;&amp;</span>&nbsp;<span class="ident" id="6174434">letter</span>&nbsp;<span class="op" id="6174441">&lt;=</span>&nbsp;<span class="string" id="6174444">&#39;z&#39;</span>&nbsp;<span class="op" id="6174448">||</span>&nbsp;<span class="string" id="6174451">&#39;A&#39;</span>&nbsp;<span class="op" id="6174455">&lt;=</span>&nbsp;<span class="ident" id="6174458">letter</span>&nbsp;<span class="op" id="6174465">&amp;&amp;</span>&nbsp;<span class="ident" id="6174468">letter</span>&nbsp;<span class="op" id="6174475">&lt;=</span>&nbsp;<span class="string" id="6174478">&#39;Z&#39;</span><span class="op" id="6174481">)</span>&nbsp;<span class="op" id="6174483">&amp;&amp;</span>&nbsp;<span class="ident" id="6174486">colon</span>&nbsp;<span class="op" id="6174492">==</span>&nbsp;<span class="string" id="6174495">&#39;:&#39;</span>&nbsp;<span class="op" id="6174499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174505">//&nbsp;If&nbsp;path&nbsp;starts&nbsp;with&nbsp;a&nbsp;drive&nbsp;letter&nbsp;we&#39;re&nbsp;stuck&nbsp;with&nbsp;it&nbsp;regardless.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174579">return</span>&nbsp;<span class="ident" id="6174586">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174604">if</span>&nbsp;<span class="ident" id="6174607">os</span><span class="op" id="6174609">.</span><span class="ident" id="6174610">IsPathSeparator</span><span class="op" id="6174625">(</span><span class="ident" id="6174626">path</span><span class="op" id="6174630">[</span><span class="num" id="6174631">0</span><span class="op" id="6174632">]</span><span class="op" id="6174633">)</span>&nbsp;<span class="op" id="6174635">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174639">return</span>&nbsp;<span class="ident" id="6174646">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174655">return</span>&nbsp;<span class="ident" id="6174662">fmt</span><span class="op" id="6174665">.</span><span class="ident" id="6174666">Sprintf</span><span class="op" id="6174673">(</span><span class="string" id="6174674">&#34;%s%c%s&#34;</span><span class="op" id="6174682">,</span>&nbsp;<span class="op" id="6174684">*</span><span class="ident" id="6174685">outputDir</span><span class="op" id="6174694">,</span>&nbsp;<span class="ident" id="6174696">os</span><span class="op" id="6174698">.</span><span class="ident" id="6174699">PathSeparator</span><span class="op" id="6174712">,</span>&nbsp;<span class="ident" id="6174714">path</span><span class="op" id="6174718">)</span><br>
<span class="lineno"></span><span class="op" id="6174720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="6174723">var</span>&nbsp;<span class="ident" id="6174727">timer</span>&nbsp;<span class="op" id="6174733">*</span><span class="ident" id="6174734">time</span><span class="op" id="6174738">.</span><span class="ident" id="6174739">Timer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6174746">//&nbsp;startAlarm&nbsp;starts&nbsp;an&nbsp;alarm&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="6174790">func</span>&nbsp;<span class="ident" id="6174795">startAlarm</span><span class="op" id="6174805">(</span><span class="op" id="6174806">)</span>&nbsp;<span class="op" id="6174808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174811">if</span>&nbsp;<span class="op" id="6174814">*</span><span class="ident" id="6174815">timeout</span>&nbsp;<span class="op" id="6174823">&gt;</span>&nbsp;<span class="num" id="6174825">0</span>&nbsp;<span class="op" id="6174827">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174831">timer</span>&nbsp;<span class="op" id="6174837">=</span>&nbsp;<span class="ident" id="6174839">time</span><span class="op" id="6174843">.</span><span class="ident" id="6174844">AfterFunc</span><span class="op" id="6174853">(</span><span class="op" id="6174854">*</span><span class="ident" id="6174855">timeout</span><span class="op" id="6174862">,</span>&nbsp;<span class="keyword" id="6174864">func</span><span class="op" id="6174868">(</span><span class="op" id="6174869">)</span>&nbsp;<span class="op" id="6174871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6174876">panic</span><span class="op" id="6174881">(</span><span class="ident" id="6174882">fmt</span><span class="op" id="6174885">.</span><span class="ident" id="6174886">Sprintf</span><span class="op" id="6174893">(</span><span class="string" id="6174894">&#34;test&nbsp;timed&nbsp;out&nbsp;after&nbsp;%v&#34;</span><span class="op" id="6174919">,</span>&nbsp;<span class="op" id="6174921">*</span><span class="ident" id="6174922">timeout</span><span class="op" id="6174929">)</span><span class="op" id="6174930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174934">}</span><span class="op" id="6174935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174938">}</span><br>
<span class="lineno"></span><span class="op" id="6174940">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="6174943">//&nbsp;stopAlarm&nbsp;turns&nbsp;off&nbsp;the&nbsp;alarm.</span><br>
<span class="lineno"></span><span class="keyword" id="6174977">func</span>&nbsp;<span class="ident" id="6174982">stopAlarm</span><span class="op" id="6174991">(</span><span class="op" id="6174992">)</span>&nbsp;<span class="op" id="6174994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174997">if</span>&nbsp;<span class="op" id="6175000">*</span><span class="ident" id="6175001">timeout</span>&nbsp;<span class="op" id="6175009">&gt;</span>&nbsp;<span class="num" id="6175011">0</span>&nbsp;<span class="op" id="6175013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175017">timer</span><span class="op" id="6175022">.</span><span class="ident" id="6175023">Stop</span><span class="op" id="6175027">(</span><span class="op" id="6175028">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6175031">}</span><br>
<span class="lineno"></span><span class="op" id="6175033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6175036">func</span>&nbsp;<span class="ident" id="6175041">parseCpuList</span><span class="op" id="6175053">(</span><span class="op" id="6175054">)</span>&nbsp;<span class="op" id="6175056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175059">for</span>&nbsp;<span class="ident" id="6175063">_</span><span class="op" id="6175064">,</span>&nbsp;<span class="ident" id="6175066">val</span>&nbsp;<span class="op" id="6175070">:=</span>&nbsp;<span class="keyword" id="6175073">range</span>&nbsp;<span class="ident" id="6175079">strings</span><span class="op" id="6175086">.</span><span class="ident" id="6175087">Split</span><span class="op" id="6175092">(</span><span class="op" id="6175093">*</span><span class="ident" id="6175094">cpuListStr</span><span class="op" id="6175104">,</span>&nbsp;<span class="string" id="6175106">&#34;,&#34;</span><span class="op" id="6175109">)</span>&nbsp;<span class="op" id="6175111">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175115">val</span>&nbsp;<span class="op" id="6175119">=</span>&nbsp;<span class="ident" id="6175121">strings</span><span class="op" id="6175128">.</span><span class="ident" id="6175129">TrimSpace</span><span class="op" id="6175138">(</span><span class="ident" id="6175139">val</span><span class="op" id="6175142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175146">if</span>&nbsp;<span class="ident" id="6175149">val</span>&nbsp;<span class="op" id="6175153">==</span>&nbsp;<span class="string" id="6175156">&#34;&#34;</span>&nbsp;<span class="op" id="6175159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175164">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6175175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175179">cpu</span><span class="op" id="6175182">,</span>&nbsp;<span class="ident" id="6175184">err</span>&nbsp;<span class="op" id="6175188">:=</span>&nbsp;<span class="ident" id="6175191">strconv</span><span class="op" id="6175198">.</span><span class="ident" id="6175199">Atoi</span><span class="op" id="6175203">(</span><span class="ident" id="6175204">val</span><span class="op" id="6175207">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175211">if</span>&nbsp;<span class="ident" id="6175214">err</span>&nbsp;<span class="op" id="6175218">!=</span>&nbsp;<span class="builtintype" id="6175221">nil</span>&nbsp;<span class="op" id="6175225">||</span>&nbsp;<span class="ident" id="6175228">cpu</span>&nbsp;<span class="op" id="6175232">&lt;=</span>&nbsp;<span class="num" id="6175235">0</span>&nbsp;<span class="op" id="6175237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175242">fmt</span><span class="op" id="6175245">.</span><span class="ident" id="6175246">Fprintf</span><span class="op" id="6175253">(</span><span class="ident" id="6175254">os</span><span class="op" id="6175256">.</span><span class="ident" id="6175257">Stderr</span><span class="op" id="6175263">,</span>&nbsp;<span class="string" id="6175265">&#34;testing:&nbsp;invalid&nbsp;value&nbsp;%q&nbsp;for&nbsp;-test.cpu\n&#34;</span><span class="op" id="6175308">,</span>&nbsp;<span class="ident" id="6175310">val</span><span class="op" id="6175313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175318">os</span><span class="op" id="6175320">.</span><span class="ident" id="6175321">Exit</span><span class="op" id="6175325">(</span><span class="num" id="6175326">1</span><span class="op" id="6175327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6175331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175335">cpuList</span>&nbsp;<span class="op" id="6175343">=</span>&nbsp;<span class="builtinfunc" id="6175345">append</span><span class="op" id="6175351">(</span><span class="ident" id="6175352">cpuList</span><span class="op" id="6175359">,</span>&nbsp;<span class="ident" id="6175361">cpu</span><span class="op" id="6175364">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6175367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175370">if</span>&nbsp;<span class="ident" id="6175373">cpuList</span>&nbsp;<span class="op" id="6175381">==</span>&nbsp;<span class="builtintype" id="6175384">nil</span>&nbsp;<span class="op" id="6175388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175392">cpuList</span>&nbsp;<span class="op" id="6175400">=</span>&nbsp;<span class="builtinfunc" id="6175402">append</span><span class="op" id="6175408">(</span><span class="ident" id="6175409">cpuList</span><span class="op" id="6175416">,</span>&nbsp;<span class="ident" id="6175418">runtime</span><span class="op" id="6175425">.</span><span class="ident" id="6175426">GOMAXPROCS</span><span class="op" id="6175436">(</span><span class="op" id="6175437">-</span><span class="num" id="6175438">1</span><span class="op" id="6175439">)</span><span class="op" id="6175440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6175443">}</span><br>
<span class="lineno"></span><span class="op" id="6175445">}</span>
</div>
</body>
</html>
