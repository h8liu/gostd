<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html" class="current">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7382326">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7382381">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7382435">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7382486">package</span>&nbsp;<span class="ident" id="7382494">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7382504">import</span>&nbsp;<span class="op" id="7382511">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7382514">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7382523">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7382533">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7382546">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7382557">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="7382579">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7382582">func</span>&nbsp;<span class="ident" id="7382587">TestAddParseTree</span><span class="op" id="7382603">(</span><span class="ident" id="7382604">t</span>&nbsp;<span class="op" id="7382606">*</span><span class="ident" id="7382607">testing</span><span class="op" id="7382614">.</span><span class="ident" id="7382615">T</span><span class="op" id="7382616">)</span>&nbsp;<span class="op" id="7382618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382621">root</span>&nbsp;<span class="op" id="7382626">:=</span>&nbsp;<span class="ident" id="7382629">Must</span><span class="op" id="7382633">(</span><span class="ident" id="7382634">New</span><span class="op" id="7382637">(</span><span class="string" id="7382638">&#34;root&#34;</span><span class="op" id="7382644">)</span><span class="op" id="7382645">.</span><span class="ident" id="7382646">Parse</span><span class="op" id="7382651">(</span><span class="string" id="7382652">`{{define&nbsp;&#34;a&#34;}}&nbsp;{{.}}&nbsp;{{template&nbsp;&#34;b&#34;}}&nbsp;{{.}}&nbsp;&#34;&gt;&lt;/a&gt;{{end}}`</span><span class="op" id="7382711">)</span><span class="op" id="7382712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382715">tree</span><span class="op" id="7382719">,</span>&nbsp;<span class="ident" id="7382721">err</span>&nbsp;<span class="op" id="7382725">:=</span>&nbsp;<span class="ident" id="7382728">parse</span><span class="op" id="7382733">.</span><span class="ident" id="7382734">Parse</span><span class="op" id="7382739">(</span><span class="string" id="7382740">&#34;t&#34;</span><span class="op" id="7382743">,</span>&nbsp;<span class="string" id="7382745">`{{define&nbsp;&#34;b&#34;}}&lt;a&nbsp;href=&#34;{{end}}`</span><span class="op" id="7382777">,</span>&nbsp;<span class="string" id="7382779">&#34;&#34;</span><span class="op" id="7382781">,</span>&nbsp;<span class="string" id="7382783">&#34;&#34;</span><span class="op" id="7382785">,</span>&nbsp;<span class="ident" id="7382787">nil</span><span class="op" id="7382790">,</span>&nbsp;<span class="ident" id="7382792">nil</span><span class="op" id="7382795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382798">if</span>&nbsp;<span class="ident" id="7382801">err</span>&nbsp;<span class="op" id="7382805">!=</span>&nbsp;<span class="ident" id="7382808">nil</span>&nbsp;<span class="op" id="7382812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382816">t</span><span class="op" id="7382817">.</span><span class="ident" id="7382818">Fatal</span><span class="op" id="7382823">(</span><span class="ident" id="7382824">err</span><span class="op" id="7382827">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382833">added</span>&nbsp;<span class="op" id="7382839">:=</span>&nbsp;<span class="ident" id="7382842">Must</span><span class="op" id="7382846">(</span><span class="ident" id="7382847">root</span><span class="op" id="7382851">.</span><span class="ident" id="7382852">AddParseTree</span><span class="op" id="7382864">(</span><span class="string" id="7382865">&#34;b&#34;</span><span class="op" id="7382868">,</span>&nbsp;<span class="ident" id="7382870">tree</span><span class="op" id="7382874">[</span><span class="string" id="7382875">&#34;b&#34;</span><span class="op" id="7382878">]</span><span class="op" id="7382879">)</span><span class="op" id="7382880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382883">b</span>&nbsp;<span class="op" id="7382885">:=</span>&nbsp;<span class="builtinfunc" id="7382888">new</span><span class="op" id="7382891">(</span><span class="ident" id="7382892">bytes</span><span class="op" id="7382897">.</span><span class="ident" id="7382898">Buffer</span><span class="op" id="7382904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382907">err</span>&nbsp;<span class="op" id="7382911">=</span>&nbsp;<span class="ident" id="7382913">added</span><span class="op" id="7382918">.</span><span class="ident" id="7382919">ExecuteTemplate</span><span class="op" id="7382934">(</span><span class="ident" id="7382935">b</span><span class="op" id="7382936">,</span>&nbsp;<span class="string" id="7382938">&#34;a&#34;</span><span class="op" id="7382941">,</span>&nbsp;<span class="string" id="7382943">&#34;1&gt;0&#34;</span><span class="op" id="7382948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382951">if</span>&nbsp;<span class="ident" id="7382954">err</span>&nbsp;<span class="op" id="7382958">!=</span>&nbsp;<span class="ident" id="7382961">nil</span>&nbsp;<span class="op" id="7382965">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382969">t</span><span class="op" id="7382970">.</span><span class="ident" id="7382971">Fatal</span><span class="op" id="7382976">(</span><span class="ident" id="7382977">err</span><span class="op" id="7382980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382986">if</span>&nbsp;<span class="ident" id="7382989">got</span><span class="op" id="7382992">,</span>&nbsp;<span class="ident" id="7382994">want</span>&nbsp;<span class="op" id="7382999">:=</span>&nbsp;<span class="ident" id="7383002">b</span><span class="op" id="7383003">.</span><span class="ident" id="7383004">String</span><span class="op" id="7383010">(</span><span class="op" id="7383011">)</span><span class="op" id="7383012">,</span>&nbsp;<span class="string" id="7383014">`&nbsp;1&amp;gt;0&nbsp;&lt;a&nbsp;href=&#34;&nbsp;1%3e0&nbsp;&#34;&gt;&lt;/a&gt;`</span><span class="op" id="7383046">;</span>&nbsp;<span class="ident" id="7383048">got</span>&nbsp;<span class="op" id="7383052">!=</span>&nbsp;<span class="ident" id="7383055">want</span>&nbsp;<span class="op" id="7383060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383064">t</span><span class="op" id="7383065">.</span><span class="ident" id="7383066">Errorf</span><span class="op" id="7383072">(</span><span class="string" id="7383073">&#34;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7383089">,</span>&nbsp;<span class="ident" id="7383091">got</span><span class="op" id="7383094">,</span>&nbsp;<span class="ident" id="7383096">want</span><span class="op" id="7383100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383103">}</span><br>
<span class="lineno">30</span><span class="op" id="7383105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7383108">func</span>&nbsp;<span class="ident" id="7383113">TestClone</span><span class="op" id="7383122">(</span><span class="ident" id="7383123">t</span>&nbsp;<span class="op" id="7383125">*</span><span class="ident" id="7383126">testing</span><span class="op" id="7383133">.</span><span class="ident" id="7383134">T</span><span class="op" id="7383135">)</span>&nbsp;<span class="op" id="7383137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7383140">//&nbsp;The&nbsp;{{.}}&nbsp;will&nbsp;be&nbsp;executed&nbsp;with&nbsp;data&nbsp;&#34;&lt;i&gt;*/&#34;&nbsp;in&nbsp;different&nbsp;contexts.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7383212">//&nbsp;In&nbsp;the&nbsp;t0&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;text&nbsp;context.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7383266">//&nbsp;In&nbsp;the&nbsp;t1&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;URL&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7383319">//&nbsp;In&nbsp;the&nbsp;t2&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;JavaScript&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7383379">//&nbsp;In&nbsp;the&nbsp;t3&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;CSS&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383432">const</span>&nbsp;<span class="ident" id="7383438">tmpl</span>&nbsp;<span class="op" id="7383443">=</span>&nbsp;<span class="string" id="7383445">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383511">b</span>&nbsp;<span class="op" id="7383513">:=</span>&nbsp;<span class="builtinfunc" id="7383516">new</span><span class="op" id="7383519">(</span><span class="ident" id="7383520">bytes</span><span class="op" id="7383525">.</span><span class="ident" id="7383526">Buffer</span><span class="op" id="7383532">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7383536">//&nbsp;Create&nbsp;an&nbsp;incomplete&nbsp;template&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383574">t0</span>&nbsp;<span class="op" id="7383577">:=</span>&nbsp;<span class="ident" id="7383580">Must</span><span class="op" id="7383584">(</span><span class="ident" id="7383585">New</span><span class="op" id="7383588">(</span><span class="string" id="7383589">&#34;t0&#34;</span><span class="op" id="7383593">)</span><span class="op" id="7383594">.</span><span class="ident" id="7383595">Parse</span><span class="op" id="7383600">(</span><span class="ident" id="7383601">tmpl</span><span class="op" id="7383605">)</span><span class="op" id="7383606">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7383610">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t1.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383630">t1</span>&nbsp;<span class="op" id="7383633">:=</span>&nbsp;<span class="ident" id="7383636">Must</span><span class="op" id="7383640">(</span><span class="ident" id="7383641">t0</span><span class="op" id="7383643">.</span><span class="ident" id="7383644">Clone</span><span class="op" id="7383649">(</span><span class="op" id="7383650">)</span><span class="op" id="7383651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383654">Must</span><span class="op" id="7383658">(</span><span class="ident" id="7383659">t1</span><span class="op" id="7383661">.</span><span class="ident" id="7383662">Parse</span><span class="op" id="7383667">(</span><span class="string" id="7383668">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}`</span><span class="op" id="7383704">)</span><span class="op" id="7383705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383708">Must</span><span class="op" id="7383712">(</span><span class="ident" id="7383713">t1</span><span class="op" id="7383715">.</span><span class="ident" id="7383716">Parse</span><span class="op" id="7383721">(</span><span class="string" id="7383722">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><span class="op" id="7383755">)</span><span class="op" id="7383756">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7383760">//&nbsp;Execute&nbsp;t1.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383776">b</span><span class="op" id="7383777">.</span><span class="ident" id="7383778">Reset</span><span class="op" id="7383783">(</span><span class="op" id="7383784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383787">if</span>&nbsp;<span class="ident" id="7383790">err</span>&nbsp;<span class="op" id="7383794">:=</span>&nbsp;<span class="ident" id="7383797">t1</span><span class="op" id="7383799">.</span><span class="ident" id="7383800">ExecuteTemplate</span><span class="op" id="7383815">(</span><span class="ident" id="7383816">b</span><span class="op" id="7383817">,</span>&nbsp;<span class="string" id="7383819">&#34;a&#34;</span><span class="op" id="7383822">,</span>&nbsp;<span class="string" id="7383824">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7383831">)</span><span class="op" id="7383832">;</span>&nbsp;<span class="ident" id="7383834">err</span>&nbsp;<span class="op" id="7383838">!=</span>&nbsp;<span class="ident" id="7383841">nil</span>&nbsp;<span class="op" id="7383845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383849">t</span><span class="op" id="7383850">.</span><span class="ident" id="7383851">Fatal</span><span class="op" id="7383856">(</span><span class="ident" id="7383857">err</span><span class="op" id="7383860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383866">if</span>&nbsp;<span class="ident" id="7383869">got</span><span class="op" id="7383872">,</span>&nbsp;<span class="ident" id="7383874">want</span>&nbsp;<span class="op" id="7383879">:=</span>&nbsp;<span class="ident" id="7383882">b</span><span class="op" id="7383883">.</span><span class="ident" id="7383884">String</span><span class="op" id="7383890">(</span><span class="op" id="7383891">)</span><span class="op" id="7383892">,</span>&nbsp;<span class="string" id="7383894">`&nbsp;&lt;a&nbsp;href=&#34;&nbsp;%3ci%3e*/&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;`</span><span class="op" id="7383924">;</span>&nbsp;<span class="ident" id="7383926">got</span>&nbsp;<span class="op" id="7383930">!=</span>&nbsp;<span class="ident" id="7383933">want</span>&nbsp;<span class="op" id="7383938">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383942">t</span><span class="op" id="7383943">.</span><span class="ident" id="7383944">Errorf</span><span class="op" id="7383950">(</span><span class="string" id="7383951">&#34;t1:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7383971">,</span>&nbsp;<span class="ident" id="7383973">got</span><span class="op" id="7383976">,</span>&nbsp;<span class="ident" id="7383978">want</span><span class="op" id="7383982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7383989">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384009">t2</span>&nbsp;<span class="op" id="7384012">:=</span>&nbsp;<span class="ident" id="7384015">Must</span><span class="op" id="7384019">(</span><span class="ident" id="7384020">t0</span><span class="op" id="7384022">.</span><span class="ident" id="7384023">Clone</span><span class="op" id="7384028">(</span><span class="op" id="7384029">)</span><span class="op" id="7384030">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384033">Must</span><span class="op" id="7384037">(</span><span class="ident" id="7384038">t2</span><span class="op" id="7384040">.</span><span class="ident" id="7384041">Parse</span><span class="op" id="7384046">(</span><span class="string" id="7384047">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;{{end}}`</span><span class="op" id="7384097">)</span><span class="op" id="7384098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384101">Must</span><span class="op" id="7384105">(</span><span class="ident" id="7384106">t2</span><span class="op" id="7384108">.</span><span class="ident" id="7384109">Parse</span><span class="op" id="7384114">(</span><span class="string" id="7384115">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;{{end}}`</span><span class="op" id="7384148">)</span><span class="op" id="7384149">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7384153">//&nbsp;Execute&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384169">b</span><span class="op" id="7384170">.</span><span class="ident" id="7384171">Reset</span><span class="op" id="7384176">(</span><span class="op" id="7384177">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384180">if</span>&nbsp;<span class="ident" id="7384183">err</span>&nbsp;<span class="op" id="7384187">:=</span>&nbsp;<span class="ident" id="7384190">t2</span><span class="op" id="7384192">.</span><span class="ident" id="7384193">ExecuteTemplate</span><span class="op" id="7384208">(</span><span class="ident" id="7384209">b</span><span class="op" id="7384210">,</span>&nbsp;<span class="string" id="7384212">&#34;a&#34;</span><span class="op" id="7384215">,</span>&nbsp;<span class="string" id="7384217">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7384224">)</span><span class="op" id="7384225">;</span>&nbsp;<span class="ident" id="7384227">err</span>&nbsp;<span class="op" id="7384231">!=</span>&nbsp;<span class="ident" id="7384234">nil</span>&nbsp;<span class="op" id="7384238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384242">t</span><span class="op" id="7384243">.</span><span class="ident" id="7384244">Fatal</span><span class="op" id="7384249">(</span><span class="ident" id="7384250">err</span><span class="op" id="7384253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384259">if</span>&nbsp;<span class="ident" id="7384262">got</span><span class="op" id="7384265">,</span>&nbsp;<span class="ident" id="7384267">want</span>&nbsp;<span class="op" id="7384272">:=</span>&nbsp;<span class="ident" id="7384275">b</span><span class="op" id="7384276">.</span><span class="ident" id="7384277">String</span><span class="op" id="7384283">(</span><span class="op" id="7384284">)</span><span class="op" id="7384285">,</span>&nbsp;<span class="string" id="7384287">`&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;&amp;#34;\u003ci\u003e*/&amp;#34;&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;`</span><span class="op" id="7384347">;</span>&nbsp;<span class="ident" id="7384349">got</span>&nbsp;<span class="op" id="7384353">!=</span>&nbsp;<span class="ident" id="7384356">want</span>&nbsp;<span class="op" id="7384361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384365">t</span><span class="op" id="7384366">.</span><span class="ident" id="7384367">Errorf</span><span class="op" id="7384373">(</span><span class="string" id="7384374">&#34;t2:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7384394">,</span>&nbsp;<span class="ident" id="7384396">got</span><span class="op" id="7384399">,</span>&nbsp;<span class="ident" id="7384401">want</span><span class="op" id="7384405">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7384412">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t3,&nbsp;but&nbsp;do&nbsp;not&nbsp;execute&nbsp;t3&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384459">t3</span>&nbsp;<span class="op" id="7384462">:=</span>&nbsp;<span class="ident" id="7384465">Must</span><span class="op" id="7384469">(</span><span class="ident" id="7384470">t0</span><span class="op" id="7384472">.</span><span class="ident" id="7384473">Clone</span><span class="op" id="7384478">(</span><span class="op" id="7384479">)</span><span class="op" id="7384480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384483">Must</span><span class="op" id="7384487">(</span><span class="ident" id="7384488">t3</span><span class="op" id="7384490">.</span><span class="ident" id="7384491">Parse</span><span class="op" id="7384496">(</span><span class="string" id="7384497">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;style&gt;&nbsp;{{end}}`</span><span class="op" id="7384531">)</span><span class="op" id="7384532">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384535">Must</span><span class="op" id="7384539">(</span><span class="ident" id="7384540">t3</span><span class="op" id="7384542">.</span><span class="ident" id="7384543">Parse</span><span class="op" id="7384548">(</span><span class="string" id="7384549">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&lt;/style&gt;&nbsp;{{end}}`</span><span class="op" id="7384584">)</span><span class="op" id="7384585">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7384589">//&nbsp;Complete&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384606">Must</span><span class="op" id="7384610">(</span><span class="ident" id="7384611">t0</span><span class="op" id="7384613">.</span><span class="ident" id="7384614">Parse</span><span class="op" id="7384619">(</span><span class="string" id="7384620">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;(&nbsp;{{end}}`</span><span class="op" id="7384648">)</span><span class="op" id="7384649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384652">Must</span><span class="op" id="7384656">(</span><span class="ident" id="7384657">t0</span><span class="op" id="7384659">.</span><span class="ident" id="7384660">Parse</span><span class="op" id="7384665">(</span><span class="string" id="7384666">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;)&nbsp;{{end}}`</span><span class="op" id="7384694">)</span><span class="op" id="7384695">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7384699">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t4.&nbsp;Redefining&nbsp;the&nbsp;&#34;lhs&#34;&nbsp;template&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384762">t4</span>&nbsp;<span class="op" id="7384765">:=</span>&nbsp;<span class="ident" id="7384768">Must</span><span class="op" id="7384772">(</span><span class="ident" id="7384773">t0</span><span class="op" id="7384775">.</span><span class="ident" id="7384776">Clone</span><span class="op" id="7384781">(</span><span class="op" id="7384782">)</span><span class="op" id="7384783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384786">if</span>&nbsp;<span class="ident" id="7384789">_</span><span class="op" id="7384790">,</span>&nbsp;<span class="ident" id="7384792">err</span>&nbsp;<span class="op" id="7384796">:=</span>&nbsp;<span class="ident" id="7384799">t4</span><span class="op" id="7384801">.</span><span class="ident" id="7384802">Parse</span><span class="op" id="7384807">(</span><span class="string" id="7384808">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;FAIL&nbsp;{{end}}`</span><span class="op" id="7384839">)</span><span class="op" id="7384840">;</span>&nbsp;<span class="ident" id="7384842">err</span>&nbsp;<span class="op" id="7384846">==</span>&nbsp;<span class="ident" id="7384849">nil</span>&nbsp;<span class="op" id="7384853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384857">t</span><span class="op" id="7384858">.</span><span class="ident" id="7384859">Error</span><span class="op" id="7384864">(</span><span class="string" id="7384865">`redefine&nbsp;&#34;lhs&#34;:&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7384907">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7384914">//&nbsp;Execute&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384930">b</span><span class="op" id="7384931">.</span><span class="ident" id="7384932">Reset</span><span class="op" id="7384937">(</span><span class="op" id="7384938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384941">if</span>&nbsp;<span class="ident" id="7384944">err</span>&nbsp;<span class="op" id="7384948">:=</span>&nbsp;<span class="ident" id="7384951">t0</span><span class="op" id="7384953">.</span><span class="ident" id="7384954">ExecuteTemplate</span><span class="op" id="7384969">(</span><span class="ident" id="7384970">b</span><span class="op" id="7384971">,</span>&nbsp;<span class="string" id="7384973">&#34;a&#34;</span><span class="op" id="7384976">,</span>&nbsp;<span class="string" id="7384978">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7384985">)</span><span class="op" id="7384986">;</span>&nbsp;<span class="ident" id="7384988">err</span>&nbsp;<span class="op" id="7384992">!=</span>&nbsp;<span class="ident" id="7384995">nil</span>&nbsp;<span class="op" id="7384999">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385003">t</span><span class="op" id="7385004">.</span><span class="ident" id="7385005">Fatal</span><span class="op" id="7385010">(</span><span class="ident" id="7385011">err</span><span class="op" id="7385014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385020">if</span>&nbsp;<span class="ident" id="7385023">got</span><span class="op" id="7385026">,</span>&nbsp;<span class="ident" id="7385028">want</span>&nbsp;<span class="op" id="7385033">:=</span>&nbsp;<span class="ident" id="7385036">b</span><span class="op" id="7385037">.</span><span class="ident" id="7385038">String</span><span class="op" id="7385044">(</span><span class="op" id="7385045">)</span><span class="op" id="7385046">,</span>&nbsp;<span class="string" id="7385048">`&nbsp;(&nbsp;&amp;lt;i&amp;gt;*/&nbsp;)&nbsp;`</span><span class="op" id="7385067">;</span>&nbsp;<span class="ident" id="7385069">got</span>&nbsp;<span class="op" id="7385073">!=</span>&nbsp;<span class="ident" id="7385076">want</span>&nbsp;<span class="op" id="7385081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385085">t</span><span class="op" id="7385086">.</span><span class="ident" id="7385087">Errorf</span><span class="op" id="7385093">(</span><span class="string" id="7385094">&#34;t0:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7385114">,</span>&nbsp;<span class="ident" id="7385116">got</span><span class="op" id="7385119">,</span>&nbsp;<span class="ident" id="7385121">want</span><span class="op" id="7385125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385128">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7385132">//&nbsp;Clone&nbsp;t0.&nbsp;This&nbsp;should&nbsp;fail,&nbsp;as&nbsp;t0&nbsp;has&nbsp;already&nbsp;executed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385192">if</span>&nbsp;<span class="ident" id="7385195">_</span><span class="op" id="7385196">,</span>&nbsp;<span class="ident" id="7385198">err</span>&nbsp;<span class="op" id="7385202">:=</span>&nbsp;<span class="ident" id="7385205">t0</span><span class="op" id="7385207">.</span><span class="ident" id="7385208">Clone</span><span class="op" id="7385213">(</span><span class="op" id="7385214">)</span><span class="op" id="7385215">;</span>&nbsp;<span class="ident" id="7385217">err</span>&nbsp;<span class="op" id="7385221">==</span>&nbsp;<span class="ident" id="7385224">nil</span>&nbsp;<span class="op" id="7385228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385232">t</span><span class="op" id="7385233">.</span><span class="ident" id="7385234">Error</span><span class="op" id="7385239">(</span><span class="string" id="7385240">`t0.Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7385278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385281">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7385285">//&nbsp;Similarly,&nbsp;cloning&nbsp;sub-templates&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385335">if</span>&nbsp;<span class="ident" id="7385338">_</span><span class="op" id="7385339">,</span>&nbsp;<span class="ident" id="7385341">err</span>&nbsp;<span class="op" id="7385345">:=</span>&nbsp;<span class="ident" id="7385348">t0</span><span class="op" id="7385350">.</span><span class="ident" id="7385351">Lookup</span><span class="op" id="7385357">(</span><span class="string" id="7385358">&#34;a&#34;</span><span class="op" id="7385361">)</span><span class="op" id="7385362">.</span><span class="ident" id="7385363">Clone</span><span class="op" id="7385368">(</span><span class="op" id="7385369">)</span><span class="op" id="7385370">;</span>&nbsp;<span class="ident" id="7385372">err</span>&nbsp;<span class="op" id="7385376">==</span>&nbsp;<span class="ident" id="7385379">nil</span>&nbsp;<span class="op" id="7385383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385387">t</span><span class="op" id="7385388">.</span><span class="ident" id="7385389">Error</span><span class="op" id="7385394">(</span><span class="string" id="7385395">`t0.Lookup(&#34;a&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7385445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385448">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385451">if</span>&nbsp;<span class="ident" id="7385454">_</span><span class="op" id="7385455">,</span>&nbsp;<span class="ident" id="7385457">err</span>&nbsp;<span class="op" id="7385461">:=</span>&nbsp;<span class="ident" id="7385464">t0</span><span class="op" id="7385466">.</span><span class="ident" id="7385467">Lookup</span><span class="op" id="7385473">(</span><span class="string" id="7385474">&#34;lhs&#34;</span><span class="op" id="7385479">)</span><span class="op" id="7385480">.</span><span class="ident" id="7385481">Clone</span><span class="op" id="7385486">(</span><span class="op" id="7385487">)</span><span class="op" id="7385488">;</span>&nbsp;<span class="ident" id="7385490">err</span>&nbsp;<span class="op" id="7385494">==</span>&nbsp;<span class="ident" id="7385497">nil</span>&nbsp;<span class="op" id="7385501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385505">t</span><span class="op" id="7385506">.</span><span class="ident" id="7385507">Error</span><span class="op" id="7385512">(</span><span class="string" id="7385513">`t0.Lookup(&#34;lhs&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7385565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7385572">//&nbsp;Execute&nbsp;t3.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385588">b</span><span class="op" id="7385589">.</span><span class="ident" id="7385590">Reset</span><span class="op" id="7385595">(</span><span class="op" id="7385596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385599">if</span>&nbsp;<span class="ident" id="7385602">err</span>&nbsp;<span class="op" id="7385606">:=</span>&nbsp;<span class="ident" id="7385609">t3</span><span class="op" id="7385611">.</span><span class="ident" id="7385612">ExecuteTemplate</span><span class="op" id="7385627">(</span><span class="ident" id="7385628">b</span><span class="op" id="7385629">,</span>&nbsp;<span class="string" id="7385631">&#34;a&#34;</span><span class="op" id="7385634">,</span>&nbsp;<span class="string" id="7385636">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7385643">)</span><span class="op" id="7385644">;</span>&nbsp;<span class="ident" id="7385646">err</span>&nbsp;<span class="op" id="7385650">!=</span>&nbsp;<span class="ident" id="7385653">nil</span>&nbsp;<span class="op" id="7385657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385661">t</span><span class="op" id="7385662">.</span><span class="ident" id="7385663">Fatal</span><span class="op" id="7385668">(</span><span class="ident" id="7385669">err</span><span class="op" id="7385672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385678">if</span>&nbsp;<span class="ident" id="7385681">got</span><span class="op" id="7385684">,</span>&nbsp;<span class="ident" id="7385686">want</span>&nbsp;<span class="op" id="7385691">:=</span>&nbsp;<span class="ident" id="7385694">b</span><span class="op" id="7385695">.</span><span class="ident" id="7385696">String</span><span class="op" id="7385702">(</span><span class="op" id="7385703">)</span><span class="op" id="7385704">,</span>&nbsp;<span class="string" id="7385706">`&nbsp;&lt;style&gt;&nbsp;ZgotmplZ&nbsp;&lt;/style&gt;&nbsp;`</span><span class="op" id="7385735">;</span>&nbsp;<span class="ident" id="7385737">got</span>&nbsp;<span class="op" id="7385741">!=</span>&nbsp;<span class="ident" id="7385744">want</span>&nbsp;<span class="op" id="7385749">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385753">t</span><span class="op" id="7385754">.</span><span class="ident" id="7385755">Errorf</span><span class="op" id="7385761">(</span><span class="string" id="7385762">&#34;t3:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7385782">,</span>&nbsp;<span class="ident" id="7385784">got</span><span class="op" id="7385787">,</span>&nbsp;<span class="ident" id="7385789">want</span><span class="op" id="7385793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385796">}</span><br>
<span class="lineno"></span><span class="op" id="7385798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7385801">func</span>&nbsp;<span class="ident" id="7385806">TestTemplates</span><span class="op" id="7385819">(</span><span class="ident" id="7385820">t</span>&nbsp;<span class="op" id="7385822">*</span><span class="ident" id="7385823">testing</span><span class="op" id="7385830">.</span><span class="ident" id="7385831">T</span><span class="op" id="7385832">)</span>&nbsp;<span class="op" id="7385834">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385837">names</span>&nbsp;<span class="op" id="7385843">:=</span>&nbsp;<span class="op" id="7385846">[</span><span class="op" id="7385847">]</span><span class="builtintype" id="7385848">string</span><span class="op" id="7385854">{</span><span class="string" id="7385855">&#34;t0&#34;</span><span class="op" id="7385859">,</span>&nbsp;<span class="string" id="7385861">&#34;a&#34;</span><span class="op" id="7385864">,</span>&nbsp;<span class="string" id="7385866">&#34;lhs&#34;</span><span class="op" id="7385871">,</span>&nbsp;<span class="string" id="7385873">&#34;rhs&#34;</span><span class="op" id="7385878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7385881">//&nbsp;Some&nbsp;template&nbsp;definitions&nbsp;borrowed&nbsp;from&nbsp;TestClone.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385936">const</span>&nbsp;<span class="ident" id="7385942">tmpl</span>&nbsp;<span class="op" id="7385947">=</span>&nbsp;<span class="string" id="7385949">`<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386089">t0</span>&nbsp;<span class="op" id="7386092">:=</span>&nbsp;<span class="ident" id="7386095">Must</span><span class="op" id="7386099">(</span><span class="ident" id="7386100">New</span><span class="op" id="7386103">(</span><span class="string" id="7386104">&#34;t0&#34;</span><span class="op" id="7386108">)</span><span class="op" id="7386109">.</span><span class="ident" id="7386110">Parse</span><span class="op" id="7386115">(</span><span class="ident" id="7386116">tmpl</span><span class="op" id="7386120">)</span><span class="op" id="7386121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386124">templates</span>&nbsp;<span class="op" id="7386134">:=</span>&nbsp;<span class="ident" id="7386137">t0</span><span class="op" id="7386139">.</span><span class="ident" id="7386140">Templates</span><span class="op" id="7386149">(</span><span class="op" id="7386150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7386153">if</span>&nbsp;<span class="builtinfunc" id="7386156">len</span><span class="op" id="7386159">(</span><span class="ident" id="7386160">templates</span><span class="op" id="7386169">)</span>&nbsp;<span class="op" id="7386171">!=</span>&nbsp;<span class="builtinfunc" id="7386174">len</span><span class="op" id="7386177">(</span><span class="ident" id="7386178">names</span><span class="op" id="7386183">)</span>&nbsp;<span class="op" id="7386185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386189">t</span><span class="op" id="7386190">.</span><span class="ident" id="7386191">Errorf</span><span class="op" id="7386197">(</span><span class="string" id="7386198">&#34;expected&nbsp;%d&nbsp;templates;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7386229">,</span>&nbsp;<span class="builtinfunc" id="7386231">len</span><span class="op" id="7386234">(</span><span class="ident" id="7386235">names</span><span class="op" id="7386240">)</span><span class="op" id="7386241">,</span>&nbsp;<span class="builtinfunc" id="7386243">len</span><span class="op" id="7386246">(</span><span class="ident" id="7386247">templates</span><span class="op" id="7386256">)</span><span class="op" id="7386257">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7386263">for</span>&nbsp;<span class="ident" id="7386267">_</span><span class="op" id="7386268">,</span>&nbsp;<span class="ident" id="7386270">name</span>&nbsp;<span class="op" id="7386275">:=</span>&nbsp;<span class="keyword" id="7386278">range</span>&nbsp;<span class="ident" id="7386284">names</span>&nbsp;<span class="op" id="7386290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386294">found</span>&nbsp;<span class="op" id="7386300">:=</span>&nbsp;<span class="builtintype" id="7386303">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7386311">for</span>&nbsp;<span class="ident" id="7386315">_</span><span class="op" id="7386316">,</span>&nbsp;<span class="ident" id="7386318">tmpl</span>&nbsp;<span class="op" id="7386323">:=</span>&nbsp;<span class="keyword" id="7386326">range</span>&nbsp;<span class="ident" id="7386332">templates</span>&nbsp;<span class="op" id="7386342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7386347">if</span>&nbsp;<span class="ident" id="7386350">name</span>&nbsp;<span class="op" id="7386355">==</span>&nbsp;<span class="ident" id="7386358">tmpl</span><span class="op" id="7386362">.</span><span class="ident" id="7386363">text</span><span class="op" id="7386367">.</span><span class="ident" id="7386368">Name</span><span class="op" id="7386372">(</span><span class="op" id="7386373">)</span>&nbsp;<span class="op" id="7386375">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386381">found</span>&nbsp;<span class="op" id="7386387">=</span>&nbsp;<span class="builtintype" id="7386389">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7386398">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7386415">if</span>&nbsp;<span class="op" id="7386418">!</span><span class="ident" id="7386419">found</span>&nbsp;<span class="op" id="7386425">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386430">t</span><span class="op" id="7386431">.</span><span class="ident" id="7386432">Error</span><span class="op" id="7386437">(</span><span class="string" id="7386438">&#34;could&nbsp;not&nbsp;find&nbsp;template&#34;</span><span class="op" id="7386463">,</span>&nbsp;<span class="ident" id="7386465">name</span><span class="op" id="7386469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386476">}</span><br>
<span class="lineno"></span><span class="op" id="7386478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="7386481">//&nbsp;This&nbsp;used&nbsp;to&nbsp;crash;&nbsp;http://golang.org/issue/3281</span><br>
<span class="lineno"></span><span class="keyword" id="7386533">func</span>&nbsp;<span class="ident" id="7386538">TestCloneCrash</span><span class="op" id="7386552">(</span><span class="ident" id="7386553">t</span>&nbsp;<span class="op" id="7386555">*</span><span class="ident" id="7386556">testing</span><span class="op" id="7386563">.</span><span class="ident" id="7386564">T</span><span class="op" id="7386565">)</span>&nbsp;<span class="op" id="7386567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386570">t1</span>&nbsp;<span class="op" id="7386573">:=</span>&nbsp;<span class="ident" id="7386576">New</span><span class="op" id="7386579">(</span><span class="string" id="7386580">&#34;all&#34;</span><span class="op" id="7386585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386588">Must</span><span class="op" id="7386592">(</span><span class="ident" id="7386593">t1</span><span class="op" id="7386595">.</span><span class="ident" id="7386596">New</span><span class="op" id="7386599">(</span><span class="string" id="7386600">&#34;t1&#34;</span><span class="op" id="7386604">)</span><span class="op" id="7386605">.</span><span class="ident" id="7386606">Parse</span><span class="op" id="7386611">(</span><span class="string" id="7386612">`{{define&nbsp;&#34;foo&#34;}}foo{{end}}`</span><span class="op" id="7386640">)</span><span class="op" id="7386641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386644">t1</span><span class="op" id="7386646">.</span><span class="ident" id="7386647">Clone</span><span class="op" id="7386652">(</span><span class="op" id="7386653">)</span><br>
<span class="lineno">150</span><span class="op" id="7386655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7386658">//&nbsp;Ensure&nbsp;that&nbsp;this&nbsp;guarantee&nbsp;from&nbsp;the&nbsp;docs&nbsp;is&nbsp;upheld:</span><br>
<span class="lineno"></span><span class="comment" id="7386713">//&nbsp;&#34;Further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="7386771">//&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&#34;</span><br>
<span class="lineno">155</span><span class="keyword" id="7386812">func</span>&nbsp;<span class="ident" id="7386817">TestCloneThenParse</span><span class="op" id="7386835">(</span><span class="ident" id="7386836">t</span>&nbsp;<span class="op" id="7386838">*</span><span class="ident" id="7386839">testing</span><span class="op" id="7386846">.</span><span class="ident" id="7386847">T</span><span class="op" id="7386848">)</span>&nbsp;<span class="op" id="7386850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386853">t0</span>&nbsp;<span class="op" id="7386856">:=</span>&nbsp;<span class="ident" id="7386859">Must</span><span class="op" id="7386863">(</span><span class="ident" id="7386864">New</span><span class="op" id="7386867">(</span><span class="string" id="7386868">&#34;t0&#34;</span><span class="op" id="7386872">)</span><span class="op" id="7386873">.</span><span class="ident" id="7386874">Parse</span><span class="op" id="7386879">(</span><span class="string" id="7386880">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;embedded&#34;}}{{end}}`</span><span class="op" id="7386926">)</span><span class="op" id="7386927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386930">t1</span>&nbsp;<span class="op" id="7386933">:=</span>&nbsp;<span class="ident" id="7386936">Must</span><span class="op" id="7386940">(</span><span class="ident" id="7386941">t0</span><span class="op" id="7386943">.</span><span class="ident" id="7386944">Clone</span><span class="op" id="7386949">(</span><span class="op" id="7386950">)</span><span class="op" id="7386951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386954">Must</span><span class="op" id="7386958">(</span><span class="ident" id="7386959">t1</span><span class="op" id="7386961">.</span><span class="ident" id="7386962">Parse</span><span class="op" id="7386967">(</span><span class="string" id="7386968">`{{define&nbsp;&#34;embedded&#34;}}t1{{end}}`</span><span class="op" id="7387000">)</span><span class="op" id="7387001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7387004">if</span>&nbsp;<span class="builtinfunc" id="7387007">len</span><span class="op" id="7387010">(</span><span class="ident" id="7387011">t0</span><span class="op" id="7387013">.</span><span class="ident" id="7387014">Templates</span><span class="op" id="7387023">(</span><span class="op" id="7387024">)</span><span class="op" id="7387025">)</span><span class="op" id="7387026">+</span><span class="num" id="7387027">1</span>&nbsp;<span class="op" id="7387029">!=</span>&nbsp;<span class="builtinfunc" id="7387032">len</span><span class="op" id="7387035">(</span><span class="ident" id="7387036">t1</span><span class="op" id="7387038">.</span><span class="ident" id="7387039">Templates</span><span class="op" id="7387048">(</span><span class="op" id="7387049">)</span><span class="op" id="7387050">)</span>&nbsp;<span class="op" id="7387052">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387056">t</span><span class="op" id="7387057">.</span><span class="ident" id="7387058">Error</span><span class="op" id="7387063">(</span><span class="string" id="7387064">&#34;adding&nbsp;a&nbsp;template&nbsp;to&nbsp;a&nbsp;clone&nbsp;added&nbsp;it&nbsp;to&nbsp;the&nbsp;original&#34;</span><span class="op" id="7387119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7387125">//&nbsp;double&nbsp;check&nbsp;that&nbsp;the&nbsp;embedded&nbsp;template&nbsp;isn&#39;t&nbsp;available&nbsp;in&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387201">err</span>&nbsp;<span class="op" id="7387205">:=</span>&nbsp;<span class="ident" id="7387208">t0</span><span class="op" id="7387210">.</span><span class="ident" id="7387211">ExecuteTemplate</span><span class="op" id="7387226">(</span><span class="ident" id="7387227">ioutil</span><span class="op" id="7387233">.</span><span class="ident" id="7387234">Discard</span><span class="op" id="7387241">,</span>&nbsp;<span class="string" id="7387243">&#34;a&#34;</span><span class="op" id="7387246">,</span>&nbsp;<span class="ident" id="7387248">nil</span><span class="op" id="7387251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7387254">if</span>&nbsp;<span class="ident" id="7387257">err</span>&nbsp;<span class="op" id="7387261">==</span>&nbsp;<span class="ident" id="7387264">nil</span>&nbsp;<span class="op" id="7387268">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387272">t</span><span class="op" id="7387273">.</span><span class="ident" id="7387274">Error</span><span class="op" id="7387279">(</span><span class="string" id="7387280">&#34;expected&nbsp;&#39;no&nbsp;such&nbsp;template&#39;&nbsp;error&#34;</span><span class="op" id="7387315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387318">}</span><br>
<span class="lineno"></span><span class="op" id="7387320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7387323">//&nbsp;https://code.google.com/p/go/issues/detail?id=5980</span><br>
<span class="lineno">170</span><span class="keyword" id="7387377">func</span>&nbsp;<span class="ident" id="7387382">TestFuncMapWorksAfterClone</span><span class="op" id="7387408">(</span><span class="ident" id="7387409">t</span>&nbsp;<span class="op" id="7387411">*</span><span class="ident" id="7387412">testing</span><span class="op" id="7387419">.</span><span class="ident" id="7387420">T</span><span class="op" id="7387421">)</span>&nbsp;<span class="op" id="7387423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387426">funcs</span>&nbsp;<span class="op" id="7387432">:=</span>&nbsp;<span class="ident" id="7387435">FuncMap</span><span class="op" id="7387442">{</span><span class="string" id="7387443">&#34;customFunc&#34;</span><span class="op" id="7387455">:</span>&nbsp;<span class="keyword" id="7387457">func</span><span class="op" id="7387461">(</span><span class="op" id="7387462">)</span>&nbsp;<span class="op" id="7387464">(</span><span class="builtintype" id="7387465">string</span><span class="op" id="7387471">,</span>&nbsp;<span class="builtintype" id="7387473">error</span><span class="op" id="7387478">)</span>&nbsp;<span class="op" id="7387480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7387484">return</span>&nbsp;<span class="string" id="7387491">&#34;&#34;</span><span class="op" id="7387493">,</span>&nbsp;<span class="ident" id="7387495">errors</span><span class="op" id="7387501">.</span><span class="ident" id="7387502">New</span><span class="op" id="7387505">(</span><span class="string" id="7387506">&#34;issue5980&#34;</span><span class="op" id="7387517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387520">}</span><span class="op" id="7387521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7387525">//&nbsp;get&nbsp;the&nbsp;expected&nbsp;error&nbsp;output&nbsp;(no&nbsp;clone)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387570">uncloned</span>&nbsp;<span class="op" id="7387579">:=</span>&nbsp;<span class="ident" id="7387582">Must</span><span class="op" id="7387586">(</span><span class="ident" id="7387587">New</span><span class="op" id="7387590">(</span><span class="string" id="7387591">&#34;&#34;</span><span class="op" id="7387593">)</span><span class="op" id="7387594">.</span><span class="ident" id="7387595">Funcs</span><span class="op" id="7387600">(</span><span class="ident" id="7387601">funcs</span><span class="op" id="7387606">)</span><span class="op" id="7387607">.</span><span class="ident" id="7387608">Parse</span><span class="op" id="7387613">(</span><span class="string" id="7387614">&#34;{{customFunc}}&#34;</span><span class="op" id="7387630">)</span><span class="op" id="7387631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387634">wantErr</span>&nbsp;<span class="op" id="7387642">:=</span>&nbsp;<span class="ident" id="7387645">uncloned</span><span class="op" id="7387653">.</span><span class="ident" id="7387654">Execute</span><span class="op" id="7387661">(</span><span class="ident" id="7387662">ioutil</span><span class="op" id="7387668">.</span><span class="ident" id="7387669">Discard</span><span class="op" id="7387676">,</span>&nbsp;<span class="ident" id="7387678">nil</span><span class="op" id="7387681">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7387685">//&nbsp;toClone&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;uncloned.&nbsp;It&nbsp;has&nbsp;to&nbsp;be&nbsp;recreated&nbsp;from&nbsp;scratch,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7387764">//&nbsp;since&nbsp;cloning&nbsp;cannot&nbsp;occur&nbsp;after&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387812">toClone</span>&nbsp;<span class="op" id="7387820">:=</span>&nbsp;<span class="ident" id="7387823">Must</span><span class="op" id="7387827">(</span><span class="ident" id="7387828">New</span><span class="op" id="7387831">(</span><span class="string" id="7387832">&#34;&#34;</span><span class="op" id="7387834">)</span><span class="op" id="7387835">.</span><span class="ident" id="7387836">Funcs</span><span class="op" id="7387841">(</span><span class="ident" id="7387842">funcs</span><span class="op" id="7387847">)</span><span class="op" id="7387848">.</span><span class="ident" id="7387849">Parse</span><span class="op" id="7387854">(</span><span class="string" id="7387855">&#34;{{customFunc}}&#34;</span><span class="op" id="7387871">)</span><span class="op" id="7387872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387875">cloned</span>&nbsp;<span class="op" id="7387882">:=</span>&nbsp;<span class="ident" id="7387885">Must</span><span class="op" id="7387889">(</span><span class="ident" id="7387890">toClone</span><span class="op" id="7387897">.</span><span class="ident" id="7387898">Clone</span><span class="op" id="7387903">(</span><span class="op" id="7387904">)</span><span class="op" id="7387905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387908">gotErr</span>&nbsp;<span class="op" id="7387915">:=</span>&nbsp;<span class="ident" id="7387918">cloned</span><span class="op" id="7387924">.</span><span class="ident" id="7387925">Execute</span><span class="op" id="7387932">(</span><span class="ident" id="7387933">ioutil</span><span class="op" id="7387939">.</span><span class="ident" id="7387940">Discard</span><span class="op" id="7387947">,</span>&nbsp;<span class="ident" id="7387949">nil</span><span class="op" id="7387952">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7387956">if</span>&nbsp;<span class="ident" id="7387959">wantErr</span><span class="op" id="7387966">.</span><span class="ident" id="7387967">Error</span><span class="op" id="7387972">(</span><span class="op" id="7387973">)</span>&nbsp;<span class="op" id="7387975">!=</span>&nbsp;<span class="ident" id="7387978">gotErr</span><span class="op" id="7387984">.</span><span class="ident" id="7387985">Error</span><span class="op" id="7387990">(</span><span class="op" id="7387991">)</span>&nbsp;<span class="op" id="7387993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387997">t</span><span class="op" id="7387998">.</span><span class="ident" id="7387999">Errorf</span><span class="op" id="7388005">(</span><span class="string" id="7388006">&#34;clone&nbsp;error&nbsp;message&nbsp;mismatch&nbsp;want&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7388051">,</span>&nbsp;<span class="ident" id="7388053">wantErr</span><span class="op" id="7388060">,</span>&nbsp;<span class="ident" id="7388062">gotErr</span><span class="op" id="7388068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7388071">}</span><br>
<span class="lineno"></span><span class="op" id="7388073">}</span>
</div>
</body>
</html>
