<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math</h2>
<ul>
<li><a href="/gostd/math/abs.go.html">abs.go</a></li>
<li><a href="/gostd/math/acosh.go.html">acosh.go</a></li>
<li><a href="/gostd/math/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/math/asin.go.html">asin.go</a></li>
<li><a href="/gostd/math/asinh.go.html">asinh.go</a></li>
<li><a href="/gostd/math/atan.go.html">atan.go</a></li>
<li><a href="/gostd/math/atan2.go.html">atan2.go</a></li>
<li><a href="/gostd/math/atanh.go.html">atanh.go</a></li>
<li><a href="/gostd/math/bits.go.html">bits.go</a></li>
<li><a href="/gostd/math/cbrt.go.html">cbrt.go</a></li>
<li><a href="/gostd/math/const.go.html">const.go</a></li>
<li><a href="/gostd/math/copysign.go.html">copysign.go</a></li>
<li><a href="/gostd/math/dim.go.html">dim.go</a></li>
<li><a href="/gostd/math/erf.go.html">erf.go</a></li>
<li><a href="/gostd/math/exp.go.html">exp.go</a></li>
<li><a href="/gostd/math/expm1.go.html" class="current">expm1.go</a></li>
<li><a href="/gostd/math/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/math/floor.go.html">floor.go</a></li>
<li><a href="/gostd/math/frexp.go.html">frexp.go</a></li>
<li><a href="/gostd/math/gamma.go.html">gamma.go</a></li>
<li><a href="/gostd/math/hypot.go.html">hypot.go</a></li>
<li><a href="/gostd/math/j0.go.html">j0.go</a></li>
<li><a href="/gostd/math/j1.go.html">j1.go</a></li>
<li><a href="/gostd/math/jn.go.html">jn.go</a></li>
<li><a href="/gostd/math/ldexp.go.html">ldexp.go</a></li>
<li><a href="/gostd/math/lgamma.go.html">lgamma.go</a></li>
<li><a href="/gostd/math/log.go.html">log.go</a></li>
<li><a href="/gostd/math/log10.go.html">log10.go</a></li>
<li><a href="/gostd/math/log1p.go.html">log1p.go</a></li>
<li><a href="/gostd/math/logb.go.html">logb.go</a></li>
<li><a href="/gostd/math/mod.go.html">mod.go</a></li>
<li><a href="/gostd/math/modf.go.html">modf.go</a></li>
<li><a href="/gostd/math/nextafter.go.html">nextafter.go</a></li>
<li><a href="/gostd/math/pow.go.html">pow.go</a></li>
<li><a href="/gostd/math/pow10.go.html">pow10.go</a></li>
<li><a href="/gostd/math/remainder.go.html">remainder.go</a></li>
<li><a href="/gostd/math/signbit.go.html">signbit.go</a></li>
<li><a href="/gostd/math/sin.go.html">sin.go</a></li>
<li><a href="/gostd/math/sincos.go.html">sincos.go</a></li>
<li><a href="/gostd/math/sinh.go.html">sinh.go</a></li>
<li><a href="/gostd/math/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/math/tan.go.html">tan.go</a></li>
<li><a href="/gostd/math/tanh.go.html">tanh.go</a></li>
<li><a href="/gostd/math/unsafe.go.html">unsafe.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2202460">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2202515">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2202569">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2202620">package</span>&nbsp;<span class="ident" id="2202628">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2202634">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="2202694">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_expm1.c</span><br>
<span class="lineno"></span><span class="comment" id="2202754">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="2202813">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="2202843">//</span><br>
<span class="lineno"></span><span class="comment" id="2202846">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="2202902">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2202971">//</span><br>
<span class="lineno">15</span><span class="comment" id="2202974">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="2203033">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="2203089">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="2203146">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="2203163">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="2203219">//</span><br>
<span class="lineno"></span><span class="comment" id="2203222">//&nbsp;expm1(x)</span><br>
<span class="lineno"></span><span class="comment" id="2203234">//&nbsp;Returns&nbsp;exp(x)-1,&nbsp;the&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2203285">//</span><br>
<span class="lineno"></span><span class="comment" id="2203288">//&nbsp;Method</span><br>
<span class="lineno">25</span><span class="comment" id="2203298">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;reduction:</span><br>
<span class="lineno"></span><span class="comment" id="2203326">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;x,&nbsp;find&nbsp;r&nbsp;and&nbsp;integer&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2203374">//</span><br>
<span class="lineno"></span><span class="comment" id="2203377">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;r,&nbsp;&nbsp;|r|&nbsp;&lt;=&nbsp;0.5*ln2&nbsp;~&nbsp;0.34658</span><br>
<span class="lineno"></span><span class="comment" id="2203435">//</span><br>
<span class="lineno">30</span><span class="comment" id="2203438">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;a&nbsp;correction&nbsp;term&nbsp;c&nbsp;will&nbsp;be&nbsp;computed&nbsp;to&nbsp;compensate</span><br>
<span class="lineno"></span><span class="comment" id="2203502">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;error&nbsp;in&nbsp;r&nbsp;when&nbsp;rounded&nbsp;to&nbsp;a&nbsp;floating-point&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="2203566">//</span><br>
<span class="lineno"></span><span class="comment" id="2203569">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximating&nbsp;expm1(r)&nbsp;by&nbsp;a&nbsp;special&nbsp;rational&nbsp;function&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2203634">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;interval&nbsp;[0,0.34658]:</span><br>
<span class="lineno">35</span><span class="comment" id="2203668">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Since</span><br>
<span class="lineno"></span><span class="comment" id="2203682">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;-&nbsp;r**4/360&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2203747">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;define&nbsp;R1(r*r)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2203776">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;*&nbsp;R1(r*r)</span><br>
<span class="lineno"></span><span class="comment" id="2203834">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,</span><br>
<span class="lineno">40</span><span class="comment" id="2203851">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(r**2)&nbsp;=&nbsp;6/r&nbsp;*((exp(r)+1)/(exp(r)-1)&nbsp;-&nbsp;2/r)</span><br>
<span class="lineno"></span><span class="comment" id="2203909">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6/r&nbsp;*&nbsp;(&nbsp;1&nbsp;+&nbsp;2.0*(1/(exp(r)-1)&nbsp;-&nbsp;1/r))</span><br>
<span class="lineno"></span><span class="comment" id="2203970">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;-&nbsp;r**2/60&nbsp;+&nbsp;r**4/2520&nbsp;-&nbsp;r**6/100800&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2204037">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.347]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="2204102">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;5&nbsp;in&nbsp;r*r&nbsp;to&nbsp;approximate&nbsp;R1.&nbsp;The</span><br>
<span class="lineno">45</span><span class="comment" id="2204165">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum&nbsp;error&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded</span><br>
<span class="lineno"></span><span class="comment" id="2204231">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;2**-61.&nbsp;In&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="2204266">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(z)&nbsp;~&nbsp;1.0&nbsp;+&nbsp;Q1*z&nbsp;+&nbsp;Q2*z**2&nbsp;+&nbsp;Q3*z**3&nbsp;+&nbsp;Q4*z**4&nbsp;+&nbsp;Q5*z**5</span><br>
<span class="lineno"></span><span class="comment" id="2204337">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;Q1&nbsp;&nbsp;=&nbsp;&nbsp;-1.6666666666666567384E-2,</span><br>
<span class="lineno"></span><span class="comment" id="2204387">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;3.9682539681370365873E-4,</span><br>
<span class="lineno">50</span><span class="comment" id="2204437">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3&nbsp;&nbsp;=&nbsp;&nbsp;-9.9206344733435987357E-6,</span><br>
<span class="lineno"></span><span class="comment" id="2204487">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q4&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2.5051361420808517002E-7,</span><br>
<span class="lineno"></span><span class="comment" id="2204537">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q5&nbsp;&nbsp;=&nbsp;&nbsp;-6.2843505682382617102E-9;</span><br>
<span class="lineno"></span><span class="comment" id="2204587">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(where&nbsp;z=r*r,&nbsp;and&nbsp;the&nbsp;values&nbsp;of&nbsp;Q1&nbsp;to&nbsp;Q5&nbsp;are&nbsp;listed&nbsp;below)</span><br>
<span class="lineno"></span><span class="comment" id="2204654">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;error&nbsp;bounded&nbsp;by</span><br>
<span class="lineno">55</span><span class="comment" id="2204684">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-61</span><br>
<span class="lineno"></span><span class="comment" id="2204737">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1.0+Q1*z+...+Q5*z&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R1(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="2204787">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="2204832">//</span><br>
<span class="lineno"></span><span class="comment" id="2204835">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;exp(r)-1&nbsp;is&nbsp;then&nbsp;computed&nbsp;by&nbsp;the&nbsp;following</span><br>
<span class="lineno">60</span><span class="comment" id="2204897">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;way&nbsp;which&nbsp;minimize&nbsp;the&nbsp;accumulation&nbsp;rounding&nbsp;error:</span><br>
<span class="lineno"></span><span class="comment" id="2204966">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="2205005">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;3&nbsp;-&nbsp;(R1&nbsp;+&nbsp;R1*r/2)&nbsp;&nbsp;]</span><br>
<span class="lineno"></span><span class="comment" id="2205069">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;r&nbsp;+&nbsp;---&nbsp;+&nbsp;---&nbsp;*&nbsp;[--------------------]</span><br>
<span class="lineno"></span><span class="comment" id="2205133">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]</span><br>
<span class="lineno">65</span><span class="comment" id="2205197">//</span><br>
<span class="lineno"></span><span class="comment" id="2205200">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compensate&nbsp;the&nbsp;error&nbsp;in&nbsp;the&nbsp;argument&nbsp;reduction,&nbsp;we&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="2205266">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)&nbsp;=&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;expm1(r)*c</span><br>
<span class="lineno"></span><span class="comment" id="2205321">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;r*c</span><br>
<span class="lineno"></span><span class="comment" id="2205369">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thus&nbsp;c+r*c&nbsp;will&nbsp;be&nbsp;added&nbsp;in&nbsp;as&nbsp;the&nbsp;correction&nbsp;terms&nbsp;for</span><br>
<span class="lineno">70</span><span class="comment" id="2205433">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c).&nbsp;Now&nbsp;rearrange&nbsp;the&nbsp;term&nbsp;to&nbsp;avoid&nbsp;optimization</span><br>
<span class="lineno"></span><span class="comment" id="2205498">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;up:</span><br>
<span class="lineno"></span><span class="comment" id="2205516">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2205588">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;R1&nbsp;-&nbsp;&nbsp;(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2205660">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)~r&nbsp;-&nbsp;({r*(---&nbsp;*&nbsp;[--------------------]-c)-c}&nbsp;-&nbsp;---&nbsp;)</span><br>
<span class="lineno">75</span><span class="comment" id="2205732">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2205804">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2205876">//</span><br>
<span class="lineno"></span><span class="comment" id="2205879">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&nbsp;-&nbsp;E</span><br>
<span class="lineno"></span><span class="comment" id="2205906">//&nbsp;&nbsp;&nbsp;3.&nbsp;Scale&nbsp;back&nbsp;to&nbsp;obtain&nbsp;expm1(x):</span><br>
<span class="lineno">80</span><span class="comment" id="2205945">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;step&nbsp;1,&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="2205974">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(x)&nbsp;=&nbsp;either&nbsp;2**k*[expm1(r)+1]&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="2206025">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**k*[expm1(r)&nbsp;+&nbsp;(1-2**-k)]</span><br>
<span class="lineno"></span><span class="comment" id="2206082">//&nbsp;&nbsp;&nbsp;4.&nbsp;Implementation&nbsp;notes:</span><br>
<span class="lineno"></span><span class="comment" id="2206112">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A).&nbsp;To&nbsp;save&nbsp;one&nbsp;multiplication,&nbsp;we&nbsp;scale&nbsp;the&nbsp;coefficient&nbsp;Qi</span><br>
<span class="lineno">85</span><span class="comment" id="2206181">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;Qi*2**i,&nbsp;and&nbsp;replace&nbsp;z&nbsp;by&nbsp;(x**2)/2.</span><br>
<span class="lineno"></span><span class="comment" id="2206233">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B).&nbsp;To&nbsp;achieve&nbsp;maximum&nbsp;accuracy,&nbsp;we&nbsp;compute&nbsp;expm1(x)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2206298">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i)&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0,&nbsp;(raise&nbsp;inexact&nbsp;if&nbsp;x!=inf)</span><br>
<span class="lineno"></span><span class="comment" id="2206369">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ii)&nbsp;&nbsp;if&nbsp;k=0,&nbsp;return&nbsp;r-E</span><br>
<span class="lineno"></span><span class="comment" id="2206404">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iii)&nbsp;if&nbsp;k=-1,&nbsp;return&nbsp;0.5*(r-E)-0.5</span><br>
<span class="lineno">90</span><span class="comment" id="2206450">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iv)&nbsp;&nbsp;if&nbsp;k=1&nbsp;if&nbsp;r&nbsp;&lt;&nbsp;-0.25,&nbsp;return&nbsp;2*((r+0.5)-&nbsp;E)</span><br>
<span class="lineno"></span><span class="comment" id="2206509">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;1.0+2.0*(r-E);</span><br>
<span class="lineno"></span><span class="comment" id="2206569">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v)&nbsp;&nbsp;&nbsp;if&nbsp;(k&lt;-2||k&gt;56)&nbsp;return&nbsp;2**k(1-(E-r))&nbsp;-&nbsp;1&nbsp;(or&nbsp;exp(x)-1)</span><br>
<span class="lineno"></span><span class="comment" id="2206640">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vi)&nbsp;&nbsp;if&nbsp;k&nbsp;&lt;=&nbsp;20,&nbsp;return&nbsp;2**k((1-2**-k)-(E-r)),&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="2206703">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vii)&nbsp;return&nbsp;2**k(1-((E+2**-k)-r))</span><br>
<span class="lineno">95</span><span class="comment" id="2206748">//</span><br>
<span class="lineno"></span><span class="comment" id="2206751">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="2206769">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(INF)&nbsp;is&nbsp;INF,&nbsp;expm1(NaN)&nbsp;is&nbsp;NaN;</span><br>
<span class="lineno"></span><span class="comment" id="2206815">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(-INF)&nbsp;is&nbsp;-1,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2206846">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;finite&nbsp;argument,&nbsp;only&nbsp;expm1(0)=0&nbsp;is&nbsp;exact.</span><br>
<span class="lineno">100</span><span class="comment" id="2206901">//</span><br>
<span class="lineno"></span><span class="comment" id="2206904">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="2206917">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2206987">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno"></span><span class="comment" id="2207027">//</span><br>
<span class="lineno">105</span><span class="comment" id="2207030">//&nbsp;Misc.&nbsp;info.</span><br>
<span class="lineno"></span><span class="comment" id="2207045">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;IEEE&nbsp;double</span><br>
<span class="lineno"></span><span class="comment" id="2207069">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;7.09782712893383973096e+02&nbsp;then&nbsp;expm1(x)&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="2207139">//</span><br>
<span class="lineno"></span><span class="comment" id="2207142">//&nbsp;Constants:</span><br>
<span class="lineno">110</span><span class="comment" id="2207156">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="2207222">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2207286">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="2207352">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="2207396">//</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2207400">//&nbsp;Expm1&nbsp;returns&nbsp;e**x&nbsp;-&nbsp;1,&nbsp;the&nbsp;base-e&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2207464">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Exp(x)&nbsp;-&nbsp;1&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2207524">//</span><br>
<span class="lineno"></span><span class="comment" id="2207527">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">120</span><span class="comment" id="2207549">//&nbsp;&nbsp;&nbsp;&nbsp;Expm1(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="2207571">//&nbsp;&nbsp;&nbsp;&nbsp;Expm1(-Inf)&nbsp;=&nbsp;-1</span><br>
<span class="lineno"></span><span class="comment" id="2207591">//&nbsp;&nbsp;&nbsp;&nbsp;Expm1(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="2207611">//&nbsp;Very&nbsp;large&nbsp;values&nbsp;overflow&nbsp;to&nbsp;-1&nbsp;or&nbsp;+Inf.</span><br>
<span class="lineno"></span><span class="keyword" id="2207656">func</span>&nbsp;<span class="ident" id="2207661">Expm1</span><span class="op" id="2207666">(</span><span class="ident" id="2207667">x</span>&nbsp;<span class="builtintype" id="2207669">float64</span><span class="op" id="2207676">)</span>&nbsp;<span class="builtintype" id="2207678">float64</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="2207687">func</span>&nbsp;<span class="ident" id="2207692">expm1</span><span class="op" id="2207697">(</span><span class="ident" id="2207698">x</span>&nbsp;<span class="builtintype" id="2207700">float64</span><span class="op" id="2207707">)</span>&nbsp;<span class="builtintype" id="2207709">float64</span>&nbsp;<span class="op" id="2207717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2207720">const</span>&nbsp;<span class="op" id="2207726">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2207730">Othreshold</span>&nbsp;<span class="op" id="2207741">=</span>&nbsp;<span class="num" id="2207743">7.09782712893383973096e+02</span>&nbsp;<span class="comment" id="2207770">//&nbsp;0x40862E42FEFA39EF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2207794">Ln2X56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2207805">=</span>&nbsp;<span class="num" id="2207807">3.88162421113569373274e+01</span>&nbsp;<span class="comment" id="2207834">//&nbsp;0x4043687a9f1af2b1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2207858">Ln2HalfX3</span>&nbsp;&nbsp;<span class="op" id="2207869">=</span>&nbsp;<span class="num" id="2207871">1.03972077083991796413e+00</span>&nbsp;<span class="comment" id="2207898">//&nbsp;0x3ff0a2b23f3bab73</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2207922">Ln2Half</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2207933">=</span>&nbsp;<span class="num" id="2207935">3.46573590279972654709e-01</span>&nbsp;<span class="comment" id="2207962">//&nbsp;0x3fd62e42fefa39ef</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2207986">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2207997">=</span>&nbsp;<span class="num" id="2207999">6.93147180369123816490e-01</span>&nbsp;<span class="comment" id="2208026">//&nbsp;0x3fe62e42fee00000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2208050">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2208061">=</span>&nbsp;<span class="num" id="2208063">1.90821492927058770002e-10</span>&nbsp;<span class="comment" id="2208090">//&nbsp;0x3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2208114">InvLn2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2208125">=</span>&nbsp;<span class="num" id="2208127">1.44269504088896338700e+00</span>&nbsp;<span class="comment" id="2208154">//&nbsp;0x3ff71547652b82fe</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2208178">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2208189">=</span>&nbsp;<span class="num" id="2208191">1.0</span>&nbsp;<span class="op" id="2208195">/</span>&nbsp;<span class="op" id="2208197">(</span><span class="num" id="2208198">1</span>&nbsp;<span class="op" id="2208200">&lt;&lt;</span>&nbsp;<span class="num" id="2208203">54</span><span class="op" id="2208205">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2208218">//&nbsp;2**-54&nbsp;=&nbsp;0x3c90000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2208251">//&nbsp;scaled&nbsp;coefficients&nbsp;related&nbsp;to&nbsp;expm1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2208293">Q1</span>&nbsp;<span class="op" id="2208296">=</span>&nbsp;<span class="op" id="2208298">-</span><span class="num" id="2208299">3.33333333333331316428e-02</span>&nbsp;<span class="comment" id="2208326">//&nbsp;0xBFA11111111110F4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2208350">Q2</span>&nbsp;<span class="op" id="2208353">=</span>&nbsp;<span class="num" id="2208355">1.58730158725481460165e-03</span>&nbsp;&nbsp;<span class="comment" id="2208383">//&nbsp;0x3F5A01A019FE5585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2208407">Q3</span>&nbsp;<span class="op" id="2208410">=</span>&nbsp;<span class="op" id="2208412">-</span><span class="num" id="2208413">7.93650757867487942473e-05</span>&nbsp;<span class="comment" id="2208440">//&nbsp;0xBF14CE199EAADBB7</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2208464">Q4</span>&nbsp;<span class="op" id="2208467">=</span>&nbsp;<span class="num" id="2208469">4.00821782732936239552e-06</span>&nbsp;&nbsp;<span class="comment" id="2208497">//&nbsp;0x3ED0CFCA86E65239</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2208521">Q5</span>&nbsp;<span class="op" id="2208524">=</span>&nbsp;<span class="op" id="2208526">-</span><span class="num" id="2208527">2.01099218183624371326e-07</span>&nbsp;<span class="comment" id="2208554">//&nbsp;0xBE8AFDB76E09C32D</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2208577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2208581">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2208599">switch</span>&nbsp;<span class="op" id="2208606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2208609">case</span>&nbsp;<span class="ident" id="2208614">IsInf</span><span class="op" id="2208619">(</span><span class="ident" id="2208620">x</span><span class="op" id="2208621">,</span>&nbsp;<span class="num" id="2208623">1</span><span class="op" id="2208624">)</span>&nbsp;<span class="op" id="2208626">||</span>&nbsp;<span class="ident" id="2208629">IsNaN</span><span class="op" id="2208634">(</span><span class="ident" id="2208635">x</span><span class="op" id="2208636">)</span><span class="op" id="2208637">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2208641">return</span>&nbsp;<span class="ident" id="2208648">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2208651">case</span>&nbsp;<span class="ident" id="2208656">IsInf</span><span class="op" id="2208661">(</span><span class="ident" id="2208662">x</span><span class="op" id="2208663">,</span>&nbsp;<span class="op" id="2208665">-</span><span class="num" id="2208666">1</span><span class="op" id="2208667">)</span><span class="op" id="2208668">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2208672">return</span>&nbsp;<span class="op" id="2208679">-</span><span class="num" id="2208680">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2208683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2208687">absx</span>&nbsp;<span class="op" id="2208692">:=</span>&nbsp;<span class="ident" id="2208695">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2208698">sign</span>&nbsp;<span class="op" id="2208703">:=</span>&nbsp;<span class="builtintype" id="2208706">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2208713">if</span>&nbsp;<span class="ident" id="2208716">x</span>&nbsp;<span class="op" id="2208718">&lt;</span>&nbsp;<span class="num" id="2208720">0</span>&nbsp;<span class="op" id="2208722">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2208726">absx</span>&nbsp;<span class="op" id="2208731">=</span>&nbsp;<span class="op" id="2208733">-</span><span class="ident" id="2208734">absx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2208741">sign</span>&nbsp;<span class="op" id="2208746">=</span>&nbsp;<span class="builtintype" id="2208748">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2208754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2208758">//&nbsp;filter&nbsp;out&nbsp;huge&nbsp;argument</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2208787">if</span>&nbsp;<span class="ident" id="2208790">absx</span>&nbsp;<span class="op" id="2208795">&gt;=</span>&nbsp;<span class="ident" id="2208798">Ln2X56</span>&nbsp;<span class="op" id="2208805">{</span>&nbsp;<span class="comment" id="2208807">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;56&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2208831">if</span>&nbsp;<span class="ident" id="2208834">absx</span>&nbsp;<span class="op" id="2208839">&gt;=</span>&nbsp;<span class="ident" id="2208842">Othreshold</span>&nbsp;<span class="op" id="2208853">{</span>&nbsp;<span class="comment" id="2208855">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;709.78...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2208881">return</span>&nbsp;<span class="ident" id="2208888">Inf</span><span class="op" id="2208891">(</span><span class="num" id="2208892">1</span><span class="op" id="2208893">)</span>&nbsp;<span class="comment" id="2208895">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2208909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2208913">if</span>&nbsp;<span class="ident" id="2208916">sign</span>&nbsp;<span class="op" id="2208921">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2208926">return</span>&nbsp;<span class="op" id="2208933">-</span><span class="num" id="2208934">1</span>&nbsp;<span class="comment" id="2208936">//&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2208966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2208969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2208973">//&nbsp;argument&nbsp;reduction</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2208996">var</span>&nbsp;<span class="ident" id="2209000">c</span>&nbsp;<span class="builtintype" id="2209002">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209011">var</span>&nbsp;<span class="ident" id="2209015">k</span>&nbsp;<span class="builtintype" id="2209017">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209022">if</span>&nbsp;<span class="ident" id="2209025">absx</span>&nbsp;<span class="op" id="2209030">&gt;</span>&nbsp;<span class="ident" id="2209032">Ln2Half</span>&nbsp;<span class="op" id="2209040">{</span>&nbsp;<span class="comment" id="2209042">//&nbsp;if&nbsp;&nbsp;|x|&nbsp;&gt;&nbsp;0.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209067">var</span>&nbsp;<span class="ident" id="2209071">hi</span><span class="op" id="2209073">,</span>&nbsp;<span class="ident" id="2209075">lo</span>&nbsp;<span class="builtintype" id="2209078">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209088">if</span>&nbsp;<span class="ident" id="2209091">absx</span>&nbsp;<span class="op" id="2209096">&lt;</span>&nbsp;<span class="ident" id="2209098">Ln2HalfX3</span>&nbsp;<span class="op" id="2209108">{</span>&nbsp;<span class="comment" id="2209110">//&nbsp;and&nbsp;|x|&nbsp;&lt;&nbsp;1.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209136">if</span>&nbsp;<span class="op" id="2209139">!</span><span class="ident" id="2209140">sign</span>&nbsp;<span class="op" id="2209145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209151">hi</span>&nbsp;<span class="op" id="2209154">=</span>&nbsp;<span class="ident" id="2209156">x</span>&nbsp;<span class="op" id="2209158">-</span>&nbsp;<span class="ident" id="2209160">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209170">lo</span>&nbsp;<span class="op" id="2209173">=</span>&nbsp;<span class="ident" id="2209175">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209185">k</span>&nbsp;<span class="op" id="2209187">=</span>&nbsp;<span class="num" id="2209189">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2209194">}</span>&nbsp;<span class="keyword" id="2209196">else</span>&nbsp;<span class="op" id="2209201">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209207">hi</span>&nbsp;<span class="op" id="2209210">=</span>&nbsp;<span class="ident" id="2209212">x</span>&nbsp;<span class="op" id="2209214">+</span>&nbsp;<span class="ident" id="2209216">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209226">lo</span>&nbsp;<span class="op" id="2209229">=</span>&nbsp;<span class="op" id="2209231">-</span><span class="ident" id="2209232">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209242">k</span>&nbsp;<span class="op" id="2209244">=</span>&nbsp;<span class="op" id="2209246">-</span><span class="num" id="2209247">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2209252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2209256">}</span>&nbsp;<span class="keyword" id="2209258">else</span>&nbsp;<span class="op" id="2209263">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209268">if</span>&nbsp;<span class="op" id="2209271">!</span><span class="ident" id="2209272">sign</span>&nbsp;<span class="op" id="2209277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209283">k</span>&nbsp;<span class="op" id="2209285">=</span>&nbsp;<span class="builtintype" id="2209287">int</span><span class="op" id="2209290">(</span><span class="ident" id="2209291">InvLn2</span><span class="op" id="2209297">*</span><span class="ident" id="2209298">x</span>&nbsp;<span class="op" id="2209300">+</span>&nbsp;<span class="num" id="2209302">0.5</span><span class="op" id="2209305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2209310">}</span>&nbsp;<span class="keyword" id="2209312">else</span>&nbsp;<span class="op" id="2209317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209323">k</span>&nbsp;<span class="op" id="2209325">=</span>&nbsp;<span class="builtintype" id="2209327">int</span><span class="op" id="2209330">(</span><span class="ident" id="2209331">InvLn2</span><span class="op" id="2209337">*</span><span class="ident" id="2209338">x</span>&nbsp;<span class="op" id="2209340">-</span>&nbsp;<span class="num" id="2209342">0.5</span><span class="op" id="2209345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2209350">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209355">t</span>&nbsp;<span class="op" id="2209357">:=</span>&nbsp;<span class="builtintype" id="2209360">float64</span><span class="op" id="2209367">(</span><span class="ident" id="2209368">k</span><span class="op" id="2209369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209374">hi</span>&nbsp;<span class="op" id="2209377">=</span>&nbsp;<span class="ident" id="2209379">x</span>&nbsp;<span class="op" id="2209381">-</span>&nbsp;<span class="ident" id="2209383">t</span><span class="op" id="2209384">*</span><span class="ident" id="2209385">Ln2Hi</span>&nbsp;<span class="comment" id="2209391">//&nbsp;t&nbsp;*&nbsp;Ln2Hi&nbsp;is&nbsp;exact&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209421">lo</span>&nbsp;<span class="op" id="2209424">=</span>&nbsp;<span class="ident" id="2209426">t</span>&nbsp;<span class="op" id="2209428">*</span>&nbsp;<span class="ident" id="2209430">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2209438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209442">x</span>&nbsp;<span class="op" id="2209444">=</span>&nbsp;<span class="ident" id="2209446">hi</span>&nbsp;<span class="op" id="2209449">-</span>&nbsp;<span class="ident" id="2209451">lo</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209456">c</span>&nbsp;<span class="op" id="2209458">=</span>&nbsp;<span class="op" id="2209460">(</span><span class="ident" id="2209461">hi</span>&nbsp;<span class="op" id="2209464">-</span>&nbsp;<span class="ident" id="2209466">x</span><span class="op" id="2209467">)</span>&nbsp;<span class="op" id="2209469">-</span>&nbsp;<span class="ident" id="2209471">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2209475">}</span>&nbsp;<span class="keyword" id="2209477">else</span>&nbsp;<span class="keyword" id="2209482">if</span>&nbsp;<span class="ident" id="2209485">absx</span>&nbsp;<span class="op" id="2209490">&lt;</span>&nbsp;<span class="ident" id="2209492">Tiny</span>&nbsp;<span class="op" id="2209497">{</span>&nbsp;<span class="comment" id="2209499">//&nbsp;when&nbsp;|x|&nbsp;&lt;&nbsp;2**-54,&nbsp;return&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209532">return</span>&nbsp;<span class="ident" id="2209539">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2209542">}</span>&nbsp;<span class="keyword" id="2209544">else</span>&nbsp;<span class="op" id="2209549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209553">k</span>&nbsp;<span class="op" id="2209555">=</span>&nbsp;<span class="num" id="2209557">0</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2209560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2209564">//&nbsp;x&nbsp;is&nbsp;now&nbsp;in&nbsp;primary&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209594">hfx</span>&nbsp;<span class="op" id="2209598">:=</span>&nbsp;<span class="num" id="2209601">0.5</span>&nbsp;<span class="op" id="2209605">*</span>&nbsp;<span class="ident" id="2209607">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209610">hxs</span>&nbsp;<span class="op" id="2209614">:=</span>&nbsp;<span class="ident" id="2209617">x</span>&nbsp;<span class="op" id="2209619">*</span>&nbsp;<span class="ident" id="2209621">hfx</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209626">r1</span>&nbsp;<span class="op" id="2209629">:=</span>&nbsp;<span class="num" id="2209632">1</span>&nbsp;<span class="op" id="2209634">+</span>&nbsp;<span class="ident" id="2209636">hxs</span><span class="op" id="2209639">*</span><span class="op" id="2209640">(</span><span class="ident" id="2209641">Q1</span><span class="op" id="2209643">+</span><span class="ident" id="2209644">hxs</span><span class="op" id="2209647">*</span><span class="op" id="2209648">(</span><span class="ident" id="2209649">Q2</span><span class="op" id="2209651">+</span><span class="ident" id="2209652">hxs</span><span class="op" id="2209655">*</span><span class="op" id="2209656">(</span><span class="ident" id="2209657">Q3</span><span class="op" id="2209659">+</span><span class="ident" id="2209660">hxs</span><span class="op" id="2209663">*</span><span class="op" id="2209664">(</span><span class="ident" id="2209665">Q4</span><span class="op" id="2209667">+</span><span class="ident" id="2209668">hxs</span><span class="op" id="2209671">*</span><span class="ident" id="2209672">Q5</span><span class="op" id="2209674">)</span><span class="op" id="2209675">)</span><span class="op" id="2209676">)</span><span class="op" id="2209677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209680">t</span>&nbsp;<span class="op" id="2209682">:=</span>&nbsp;<span class="num" id="2209685">3</span>&nbsp;<span class="op" id="2209687">-</span>&nbsp;<span class="ident" id="2209689">r1</span><span class="op" id="2209691">*</span><span class="ident" id="2209692">hfx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209697">e</span>&nbsp;<span class="op" id="2209699">:=</span>&nbsp;<span class="ident" id="2209702">hxs</span>&nbsp;<span class="op" id="2209706">*</span>&nbsp;<span class="op" id="2209708">(</span><span class="op" id="2209709">(</span><span class="ident" id="2209710">r1</span>&nbsp;<span class="op" id="2209713">-</span>&nbsp;<span class="ident" id="2209715">t</span><span class="op" id="2209716">)</span>&nbsp;<span class="op" id="2209718">/</span>&nbsp;<span class="op" id="2209720">(</span><span class="num" id="2209721">6.0</span>&nbsp;<span class="op" id="2209725">-</span>&nbsp;<span class="ident" id="2209727">x</span><span class="op" id="2209728">*</span><span class="ident" id="2209729">t</span><span class="op" id="2209730">)</span><span class="op" id="2209731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209734">if</span>&nbsp;<span class="ident" id="2209737">k</span>&nbsp;<span class="op" id="2209739">!=</span>&nbsp;<span class="num" id="2209742">0</span>&nbsp;<span class="op" id="2209744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209748">e</span>&nbsp;<span class="op" id="2209750">=</span>&nbsp;<span class="op" id="2209752">(</span><span class="ident" id="2209753">x</span><span class="op" id="2209754">*</span><span class="op" id="2209755">(</span><span class="ident" id="2209756">e</span><span class="op" id="2209757">-</span><span class="ident" id="2209758">c</span><span class="op" id="2209759">)</span>&nbsp;<span class="op" id="2209761">-</span>&nbsp;<span class="ident" id="2209763">c</span><span class="op" id="2209764">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209768">e</span>&nbsp;<span class="op" id="2209770">-=</span>&nbsp;<span class="ident" id="2209773">hxs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209779">switch</span>&nbsp;<span class="op" id="2209786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209790">case</span>&nbsp;<span class="ident" id="2209795">k</span>&nbsp;<span class="op" id="2209797">==</span>&nbsp;<span class="op" id="2209800">-</span><span class="num" id="2209801">1</span><span class="op" id="2209802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209807">return</span>&nbsp;<span class="num" id="2209814">0.5</span><span class="op" id="2209817">*</span><span class="op" id="2209818">(</span><span class="ident" id="2209819">x</span><span class="op" id="2209820">-</span><span class="ident" id="2209821">e</span><span class="op" id="2209822">)</span>&nbsp;<span class="op" id="2209824">-</span>&nbsp;<span class="num" id="2209826">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209832">case</span>&nbsp;<span class="ident" id="2209837">k</span>&nbsp;<span class="op" id="2209839">==</span>&nbsp;<span class="num" id="2209842">1</span><span class="op" id="2209843">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209848">if</span>&nbsp;<span class="ident" id="2209851">x</span>&nbsp;<span class="op" id="2209853">&lt;</span>&nbsp;<span class="op" id="2209855">-</span><span class="num" id="2209856">0.25</span>&nbsp;<span class="op" id="2209861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209867">return</span>&nbsp;<span class="op" id="2209874">-</span><span class="num" id="2209875">2</span>&nbsp;<span class="op" id="2209877">*</span>&nbsp;<span class="op" id="2209879">(</span><span class="ident" id="2209880">e</span>&nbsp;<span class="op" id="2209882">-</span>&nbsp;<span class="op" id="2209884">(</span><span class="ident" id="2209885">x</span>&nbsp;<span class="op" id="2209887">+</span>&nbsp;<span class="num" id="2209889">0.5</span><span class="op" id="2209892">)</span><span class="op" id="2209893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2209898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209903">return</span>&nbsp;<span class="num" id="2209910">1</span>&nbsp;<span class="op" id="2209912">+</span>&nbsp;<span class="num" id="2209914">2</span><span class="op" id="2209915">*</span><span class="op" id="2209916">(</span><span class="ident" id="2209917">x</span><span class="op" id="2209918">-</span><span class="ident" id="2209919">e</span><span class="op" id="2209920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2209924">case</span>&nbsp;<span class="ident" id="2209929">k</span>&nbsp;<span class="op" id="2209931">&lt;=</span>&nbsp;<span class="op" id="2209934">-</span><span class="num" id="2209935">2</span>&nbsp;<span class="op" id="2209937">||</span>&nbsp;<span class="ident" id="2209940">k</span>&nbsp;<span class="op" id="2209942">&gt;</span>&nbsp;<span class="num" id="2209944">56</span><span class="op" id="2209946">:</span>&nbsp;<span class="comment" id="2209948">//&nbsp;suffice&nbsp;to&nbsp;return&nbsp;exp(x)-1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2209981">y</span>&nbsp;<span class="op" id="2209983">:=</span>&nbsp;<span class="num" id="2209986">1</span>&nbsp;<span class="op" id="2209988">-</span>&nbsp;<span class="op" id="2209990">(</span><span class="ident" id="2209991">e</span>&nbsp;<span class="op" id="2209993">-</span>&nbsp;<span class="ident" id="2209995">x</span><span class="op" id="2209996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2210001">y</span>&nbsp;<span class="op" id="2210003">=</span>&nbsp;<span class="ident" id="2210005">Float64frombits</span><span class="op" id="2210020">(</span><span class="ident" id="2210021">Float64bits</span><span class="op" id="2210032">(</span><span class="ident" id="2210033">y</span><span class="op" id="2210034">)</span>&nbsp;<span class="op" id="2210036">+</span>&nbsp;<span class="builtintype" id="2210038">uint64</span><span class="op" id="2210044">(</span><span class="ident" id="2210045">k</span><span class="op" id="2210046">)</span><span class="op" id="2210047">&lt;&lt;</span><span class="num" id="2210049">52</span><span class="op" id="2210051">)</span>&nbsp;<span class="comment" id="2210053">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2210081">return</span>&nbsp;<span class="ident" id="2210088">y</span>&nbsp;<span class="op" id="2210090">-</span>&nbsp;<span class="num" id="2210092">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2210096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2210100">if</span>&nbsp;<span class="ident" id="2210103">k</span>&nbsp;<span class="op" id="2210105">&lt;</span>&nbsp;<span class="num" id="2210107">20</span>&nbsp;<span class="op" id="2210110">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2210115">t</span>&nbsp;<span class="op" id="2210117">:=</span>&nbsp;<span class="ident" id="2210120">Float64frombits</span><span class="op" id="2210135">(</span><span class="num" id="2210136">0x3ff0000000000000</span>&nbsp;<span class="op" id="2210155">-</span>&nbsp;<span class="op" id="2210157">(</span><span class="num" id="2210158">0x20000000000000</span>&nbsp;<span class="op" id="2210175">&gt;&gt;</span>&nbsp;<span class="builtintype" id="2210178">uint</span><span class="op" id="2210182">(</span><span class="ident" id="2210183">k</span><span class="op" id="2210184">)</span><span class="op" id="2210185">)</span><span class="op" id="2210186">)</span>&nbsp;<span class="comment" id="2210188">//&nbsp;t=1-2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2210204">y</span>&nbsp;<span class="op" id="2210206">:=</span>&nbsp;<span class="ident" id="2210209">t</span>&nbsp;<span class="op" id="2210211">-</span>&nbsp;<span class="op" id="2210213">(</span><span class="ident" id="2210214">e</span>&nbsp;<span class="op" id="2210216">-</span>&nbsp;<span class="ident" id="2210218">x</span><span class="op" id="2210219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2210224">y</span>&nbsp;<span class="op" id="2210226">=</span>&nbsp;<span class="ident" id="2210228">Float64frombits</span><span class="op" id="2210243">(</span><span class="ident" id="2210244">Float64bits</span><span class="op" id="2210255">(</span><span class="ident" id="2210256">y</span><span class="op" id="2210257">)</span>&nbsp;<span class="op" id="2210259">+</span>&nbsp;<span class="builtintype" id="2210261">uint64</span><span class="op" id="2210267">(</span><span class="ident" id="2210268">k</span><span class="op" id="2210269">)</span><span class="op" id="2210270">&lt;&lt;</span><span class="num" id="2210272">52</span><span class="op" id="2210274">)</span>&nbsp;<span class="comment" id="2210276">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2210304">return</span>&nbsp;<span class="ident" id="2210311">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2210315">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2210319">t</span>&nbsp;<span class="op" id="2210321">:=</span>&nbsp;<span class="ident" id="2210324">Float64frombits</span><span class="op" id="2210339">(</span><span class="builtintype" id="2210340">uint64</span><span class="op" id="2210346">(</span><span class="op" id="2210347">(</span><span class="num" id="2210348">0x3ff</span>&nbsp;<span class="op" id="2210354">-</span>&nbsp;<span class="ident" id="2210356">k</span><span class="op" id="2210357">)</span>&nbsp;<span class="op" id="2210359">&lt;&lt;</span>&nbsp;<span class="num" id="2210362">52</span><span class="op" id="2210364">)</span><span class="op" id="2210365">)</span>&nbsp;<span class="comment" id="2210367">//&nbsp;2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2210378">y</span>&nbsp;<span class="op" id="2210380">:=</span>&nbsp;<span class="ident" id="2210383">x</span>&nbsp;<span class="op" id="2210385">-</span>&nbsp;<span class="op" id="2210387">(</span><span class="ident" id="2210388">e</span>&nbsp;<span class="op" id="2210390">+</span>&nbsp;<span class="ident" id="2210392">t</span><span class="op" id="2210393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2210397">y</span>&nbsp;<span class="op" id="2210399">+=</span>&nbsp;<span class="num" id="2210402">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2210406">y</span>&nbsp;<span class="op" id="2210408">=</span>&nbsp;<span class="ident" id="2210410">Float64frombits</span><span class="op" id="2210425">(</span><span class="ident" id="2210426">Float64bits</span><span class="op" id="2210437">(</span><span class="ident" id="2210438">y</span><span class="op" id="2210439">)</span>&nbsp;<span class="op" id="2210441">+</span>&nbsp;<span class="builtintype" id="2210443">uint64</span><span class="op" id="2210449">(</span><span class="ident" id="2210450">k</span><span class="op" id="2210451">)</span><span class="op" id="2210452">&lt;&lt;</span><span class="num" id="2210454">52</span><span class="op" id="2210456">)</span>&nbsp;<span class="comment" id="2210458">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2210485">return</span>&nbsp;<span class="ident" id="2210492">y</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2210495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2210498">return</span>&nbsp;<span class="ident" id="2210505">x</span>&nbsp;<span class="op" id="2210507">-</span>&nbsp;<span class="op" id="2210509">(</span><span class="ident" id="2210510">x</span><span class="op" id="2210511">*</span><span class="ident" id="2210512">e</span>&nbsp;<span class="op" id="2210514">-</span>&nbsp;<span class="ident" id="2210516">hxs</span><span class="op" id="2210519">)</span>&nbsp;<span class="comment" id="2210521">//&nbsp;c&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="op" id="2210531">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
