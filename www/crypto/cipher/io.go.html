<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4078672">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4078727">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4078781">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4078832">package</span>&nbsp;<span class="ident" id="4078840">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4078848">import</span>&nbsp;<span class="string" id="4078855">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4078861">//&nbsp;The&nbsp;Stream*&nbsp;objects&nbsp;are&nbsp;so&nbsp;simple&nbsp;that&nbsp;all&nbsp;their&nbsp;members&nbsp;are&nbsp;public.&nbsp;Users</span><br>
<span class="lineno">10</span><span class="comment" id="4078939">//&nbsp;can&nbsp;create&nbsp;them&nbsp;themselves.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4078971">//&nbsp;StreamReader&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Reader.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="4079043">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.</span><br>
<span class="lineno"></span><span class="keyword" id="4079098">type</span>&nbsp;<span class="ident" id="4079103">StreamReader</span>&nbsp;<span class="keyword" id="4079116">struct</span>&nbsp;<span class="op" id="4079123">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079126">S</span>&nbsp;<span class="ident" id="4079128"><a href="/crypto/cipher/cipher.go.html#4066546">Stream</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079136">R</span>&nbsp;<span class="ident" id="4079138"><a href="/crypto/cipher/io.go.html#4078855">io</a></span><span class="op" id="4079140">.</span><span class="ident" id="4079141">Reader</span><br>
<span class="lineno"></span><span class="op" id="4079148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4079151">func</span>&nbsp;<span class="op" id="4079156">(</span><span class="ident" id="4079157">r</span>&nbsp;<span class="ident" id="4079159"><a href="/crypto/cipher/io.go.html#4079103">StreamReader</a></span><span class="op" id="4079171">)</span>&nbsp;<span class="ident" id="4079173">Read</span><span class="op" id="4079177">(</span><span class="ident" id="4079178">dst</span>&nbsp;<span class="op" id="4079182">[</span><span class="op" id="4079183">]</span><span class="builtintype" id="4079184">byte</span><span class="op" id="4079188">)</span>&nbsp;<span class="op" id="4079190">(</span><span class="ident" id="4079191">n</span>&nbsp;<span class="builtintype" id="4079193">int</span><span class="op" id="4079196">,</span>&nbsp;<span class="ident" id="4079198">err</span>&nbsp;<span class="builtintype" id="4079202">error</span><span class="op" id="4079207">)</span>&nbsp;<span class="op" id="4079209">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079212"><a href="/crypto/cipher/io.go.html#4079191">n</a></span><span class="op" id="4079213">,</span>&nbsp;<span class="ident" id="4079215"><a href="/crypto/cipher/io.go.html#4079198">err</a></span>&nbsp;<span class="op" id="4079219">=</span>&nbsp;<span class="ident" id="4079221"><a href="/crypto/cipher/io.go.html#4079157">r</a></span><span class="op" id="4079222">.</span><span class="ident" id="4079223">R</span><span class="op" id="4079224">.</span><span class="ident" id="4079225">Read</span><span class="op" id="4079229">(</span><span class="ident" id="4079230"><a href="/crypto/cipher/io.go.html#4079178">dst</a></span><span class="op" id="4079233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079236"><a href="/crypto/cipher/io.go.html#4079157">r</a></span><span class="op" id="4079237">.</span><span class="ident" id="4079238">S</span><span class="op" id="4079239">.</span><span class="ident" id="4079240">XORKeyStream</span><span class="op" id="4079252">(</span><span class="ident" id="4079253"><a href="/crypto/cipher/io.go.html#4079178">dst</a></span><span class="op" id="4079256">[</span><span class="op" id="4079257">:</span><span class="ident" id="4079258"><a href="/crypto/cipher/io.go.html#4079191">n</a></span><span class="op" id="4079259">]</span><span class="op" id="4079260">,</span>&nbsp;<span class="ident" id="4079262"><a href="/crypto/cipher/io.go.html#4079178">dst</a></span><span class="op" id="4079265">[</span><span class="op" id="4079266">:</span><span class="ident" id="4079267"><a href="/crypto/cipher/io.go.html#4079191">n</a></span><span class="op" id="4079268">]</span><span class="op" id="4079269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4079272">return</span><br>
<span class="lineno"></span><span class="op" id="4079279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4079282">//&nbsp;StreamWriter&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Writer.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="4079354">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.&nbsp;If&nbsp;any&nbsp;Write&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="4079427">//&nbsp;returns&nbsp;short&nbsp;then&nbsp;the&nbsp;StreamWriter&nbsp;is&nbsp;out&nbsp;of&nbsp;sync&nbsp;and&nbsp;must&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="comment" id="4079504">//&nbsp;A&nbsp;StreamWriter&nbsp;has&nbsp;no&nbsp;internal&nbsp;buffering;&nbsp;Close&nbsp;does&nbsp;not&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="4079569">//&nbsp;to&nbsp;be&nbsp;called&nbsp;to&nbsp;flush&nbsp;write&nbsp;data.</span><br>
<span class="lineno">30</span><span class="keyword" id="4079606">type</span>&nbsp;<span class="ident" id="4079611">StreamWriter</span>&nbsp;<span class="keyword" id="4079624">struct</span>&nbsp;<span class="op" id="4079631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079634">S</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4079638"><a href="/crypto/cipher/cipher.go.html#4066546">Stream</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079646">W</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4079650"><a href="/crypto/cipher/io.go.html#4078855">io</a></span><span class="op" id="4079652">.</span><span class="ident" id="4079653">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079661">Err</span>&nbsp;<span class="builtintype" id="4079665">error</span>&nbsp;<span class="comment" id="4079671">//&nbsp;unused</span><br>
<span class="lineno"></span><span class="op" id="4079681">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="4079684">func</span>&nbsp;<span class="op" id="4079689">(</span><span class="ident" id="4079690">w</span>&nbsp;<span class="ident" id="4079692"><a href="/crypto/cipher/io.go.html#4079611">StreamWriter</a></span><span class="op" id="4079704">)</span>&nbsp;<span class="ident" id="4079706">Write</span><span class="op" id="4079711">(</span><span class="ident" id="4079712">src</span>&nbsp;<span class="op" id="4079716">[</span><span class="op" id="4079717">]</span><span class="builtintype" id="4079718">byte</span><span class="op" id="4079722">)</span>&nbsp;<span class="op" id="4079724">(</span><span class="ident" id="4079725">n</span>&nbsp;<span class="builtintype" id="4079727">int</span><span class="op" id="4079730">,</span>&nbsp;<span class="ident" id="4079732">err</span>&nbsp;<span class="builtintype" id="4079736">error</span><span class="op" id="4079741">)</span>&nbsp;<span class="op" id="4079743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079746">c</span>&nbsp;<span class="op" id="4079748">:=</span>&nbsp;<span class="builtinfunc" id="4079751">make</span><span class="op" id="4079755">(</span><span class="op" id="4079756">[</span><span class="op" id="4079757">]</span><span class="builtintype" id="4079758">byte</span><span class="op" id="4079762">,</span>&nbsp;<span class="builtinfunc" id="4079764">len</span><span class="op" id="4079767">(</span><span class="ident" id="4079768"><a href="/crypto/cipher/io.go.html#4079712">src</a></span><span class="op" id="4079771">)</span><span class="op" id="4079772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079775"><a href="/crypto/cipher/io.go.html#4079690">w</a></span><span class="op" id="4079776">.</span><span class="ident" id="4079777">S</span><span class="op" id="4079778">.</span><span class="ident" id="4079779">XORKeyStream</span><span class="op" id="4079791">(</span><span class="ident" id="4079792"><a href="/crypto/cipher/io.go.html#4079746">c</a></span><span class="op" id="4079793">,</span>&nbsp;<span class="ident" id="4079795"><a href="/crypto/cipher/io.go.html#4079712">src</a></span><span class="op" id="4079798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079801"><a href="/crypto/cipher/io.go.html#4079725">n</a></span><span class="op" id="4079802">,</span>&nbsp;<span class="ident" id="4079804"><a href="/crypto/cipher/io.go.html#4079732">err</a></span>&nbsp;<span class="op" id="4079808">=</span>&nbsp;<span class="ident" id="4079810"><a href="/crypto/cipher/io.go.html#4079690">w</a></span><span class="op" id="4079811">.</span><span class="ident" id="4079812">W</span><span class="op" id="4079813">.</span><span class="ident" id="4079814">Write</span><span class="op" id="4079819">(</span><span class="ident" id="4079820"><a href="/crypto/cipher/io.go.html#4079746">c</a></span><span class="op" id="4079821">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4079824">if</span>&nbsp;<span class="ident" id="4079827"><a href="/crypto/cipher/io.go.html#4079725">n</a></span>&nbsp;<span class="op" id="4079829">!=</span>&nbsp;<span class="builtinfunc" id="4079832">len</span><span class="op" id="4079835">(</span><span class="ident" id="4079836"><a href="/crypto/cipher/io.go.html#4079712">src</a></span><span class="op" id="4079839">)</span>&nbsp;<span class="op" id="4079841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4079845">if</span>&nbsp;<span class="ident" id="4079848"><a href="/crypto/cipher/io.go.html#4079732">err</a></span>&nbsp;<span class="op" id="4079852">==</span>&nbsp;<span class="ident" id="4079855">nil</span>&nbsp;<span class="op" id="4079859">{</span>&nbsp;<span class="comment" id="4079861">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079887"><a href="/crypto/cipher/io.go.html#4079732">err</a></span>&nbsp;<span class="op" id="4079891">=</span>&nbsp;<span class="ident" id="4079893"><a href="/crypto/cipher/io.go.html#4078855">io</a></span><span class="op" id="4079895">.</span><span class="ident" id="4079896">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4079912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4079915">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4079918">return</span><br>
<span class="lineno"></span><span class="op" id="4079925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4079928">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;Writer&nbsp;and&nbsp;returns&nbsp;its&nbsp;Close&nbsp;return&nbsp;value,&nbsp;if&nbsp;the&nbsp;Writer</span><br>
<span class="lineno"></span><span class="comment" id="4080016">//&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer.&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">50</span><span class="keyword" id="4080067">func</span>&nbsp;<span class="op" id="4080072">(</span><span class="ident" id="4080073">w</span>&nbsp;<span class="ident" id="4080075"><a href="/crypto/cipher/io.go.html#4079611">StreamWriter</a></span><span class="op" id="4080087">)</span>&nbsp;<span class="ident" id="4080089">Close</span><span class="op" id="4080094">(</span><span class="op" id="4080095">)</span>&nbsp;<span class="builtintype" id="4080097">error</span>&nbsp;<span class="op" id="4080103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080106">if</span>&nbsp;<span class="ident" id="4080109">c</span><span class="op" id="4080110">,</span>&nbsp;<span class="ident" id="4080112">ok</span>&nbsp;<span class="op" id="4080115">:=</span>&nbsp;<span class="ident" id="4080118"><a href="/crypto/cipher/io.go.html#4080073">w</a></span><span class="op" id="4080119">.</span><span class="ident" id="4080120">W</span><span class="op" id="4080121">.</span><span class="op" id="4080122">(</span><span class="ident" id="4080123"><a href="/crypto/cipher/io.go.html#4078855">io</a></span><span class="op" id="4080125">.</span><span class="ident" id="4080126">Closer</span><span class="op" id="4080132">)</span><span class="op" id="4080133">;</span>&nbsp;<span class="ident" id="4080135"><a href="/crypto/cipher/io.go.html#4080112">ok</a></span>&nbsp;<span class="op" id="4080138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080142">return</span>&nbsp;<span class="ident" id="4080149"><a href="/crypto/cipher/io.go.html#4080109">c</a></span><span class="op" id="4080150">.</span><span class="ident" id="4080151">Close</span><span class="op" id="4080156">(</span><span class="op" id="4080157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4080160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080163">return</span>&nbsp;<span class="ident" id="4080170">nil</span><br>
<span class="lineno">55</span><span class="op" id="4080174">}</span>
</div>
</body>
</html>
