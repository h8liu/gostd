<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html" class="current">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6639690">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6639745">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6639799">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6639850">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6639915">package</span>&nbsp;<span class="ident" id="6639923">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6639928">import</span>&nbsp;<span class="op" id="6639935">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6639938">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6639944">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6639957">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6639963">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6639971">&#34;reflect&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6639982">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6639993">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6640000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6640003">var</span>&nbsp;<span class="ident" id="6640007">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="6640033">=</span>&nbsp;<span class="op" id="6640035">[</span><span class="op" id="6640036">]</span><span class="keyword" id="6640037">struct</span>&nbsp;<span class="op" id="6640044">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6640047">server</span>&nbsp;&nbsp;<span class="builtintype" id="6640055">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6640063">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6640071">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6640079">qtype</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6640087">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6640095">timeout</span>&nbsp;<span class="builtintype" id="6640103">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6640108">rcode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6640116">int</span><br>
<span class="lineno">25</span><span class="op" id="6640120">}</span><span class="op" id="6640121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6640124">//&nbsp;Querying&nbsp;&#34;com.&#34;&nbsp;with&nbsp;qtype=255&nbsp;usually&nbsp;makes&nbsp;an&nbsp;answer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6640183">//&nbsp;which&nbsp;requires&nbsp;more&nbsp;than&nbsp;512&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6640223">{</span><span class="string" id="6640224">&#34;8.8.8.8:53&#34;</span><span class="op" id="6640236">,</span>&nbsp;<span class="string" id="6640238">&#34;com.&#34;</span><span class="op" id="6640244">,</span>&nbsp;<span class="ident" id="6640246">dnsTypeALL</span><span class="op" id="6640256">,</span>&nbsp;<span class="num" id="6640258">2</span><span class="op" id="6640259">,</span>&nbsp;<span class="ident" id="6640261">dnsRcodeSuccess</span><span class="op" id="6640276">}</span><span class="op" id="6640277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6640280">{</span><span class="string" id="6640281">&#34;8.8.4.4:53&#34;</span><span class="op" id="6640293">,</span>&nbsp;<span class="string" id="6640295">&#34;com.&#34;</span><span class="op" id="6640301">,</span>&nbsp;<span class="ident" id="6640303">dnsTypeALL</span><span class="op" id="6640313">,</span>&nbsp;<span class="num" id="6640315">4</span><span class="op" id="6640316">,</span>&nbsp;<span class="ident" id="6640318">dnsRcodeSuccess</span><span class="op" id="6640333">}</span><span class="op" id="6640334">,</span><br>
<span class="lineno">30</span><span class="op" id="6640336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6640339">func</span>&nbsp;<span class="ident" id="6640344">TestDNSTransportFallback</span><span class="op" id="6640368">(</span><span class="ident" id="6640369">t</span>&nbsp;<span class="op" id="6640371">*</span><span class="ident" id="6640372">testing</span><span class="op" id="6640379">.</span><span class="ident" id="6640380">T</span><span class="op" id="6640381">)</span>&nbsp;<span class="op" id="6640383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6640386">if</span>&nbsp;<span class="ident" id="6640389">testing</span><span class="op" id="6640396">.</span><span class="ident" id="6640397">Short</span><span class="op" id="6640402">(</span><span class="op" id="6640403">)</span>&nbsp;<span class="op" id="6640405">||</span>&nbsp;<span class="op" id="6640408">!</span><span class="op" id="6640409">*</span><span class="ident" id="6640410">testExternal</span>&nbsp;<span class="op" id="6640423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6640427">t</span><span class="op" id="6640428">.</span><span class="ident" id="6640429">Skip</span><span class="op" id="6640433">(</span><span class="string" id="6640434">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6640475">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6640478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6640482">for</span>&nbsp;<span class="ident" id="6640486">_</span><span class="op" id="6640487">,</span>&nbsp;<span class="ident" id="6640489">tt</span>&nbsp;<span class="op" id="6640492">:=</span>&nbsp;<span class="keyword" id="6640495">range</span>&nbsp;<span class="ident" id="6640501">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="6640527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6640531">timeout</span>&nbsp;<span class="op" id="6640539">:=</span>&nbsp;<span class="ident" id="6640542">time</span><span class="op" id="6640546">.</span><span class="ident" id="6640547">Duration</span><span class="op" id="6640555">(</span><span class="ident" id="6640556">tt</span><span class="op" id="6640558">.</span><span class="ident" id="6640559">timeout</span><span class="op" id="6640566">)</span>&nbsp;<span class="op" id="6640568">*</span>&nbsp;<span class="ident" id="6640570">time</span><span class="op" id="6640574">.</span><span class="ident" id="6640575">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6640584">msg</span><span class="op" id="6640587">,</span>&nbsp;<span class="ident" id="6640589">err</span>&nbsp;<span class="op" id="6640593">:=</span>&nbsp;<span class="ident" id="6640596">exchange</span><span class="op" id="6640604">(</span><span class="ident" id="6640605">tt</span><span class="op" id="6640607">.</span><span class="ident" id="6640608">server</span><span class="op" id="6640614">,</span>&nbsp;<span class="ident" id="6640616">tt</span><span class="op" id="6640618">.</span><span class="ident" id="6640619">name</span><span class="op" id="6640623">,</span>&nbsp;<span class="ident" id="6640625">tt</span><span class="op" id="6640627">.</span><span class="ident" id="6640628">qtype</span><span class="op" id="6640633">,</span>&nbsp;<span class="ident" id="6640635">timeout</span><span class="op" id="6640642">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6640646">if</span>&nbsp;<span class="ident" id="6640649">err</span>&nbsp;<span class="op" id="6640653">!=</span>&nbsp;<span class="builtintype" id="6640656">nil</span>&nbsp;<span class="op" id="6640660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6640665">t</span><span class="op" id="6640666">.</span><span class="ident" id="6640667">Error</span><span class="op" id="6640672">(</span><span class="ident" id="6640673">err</span><span class="op" id="6640676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6640681">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6640692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6640696">switch</span>&nbsp;<span class="ident" id="6640703">msg</span><span class="op" id="6640706">.</span><span class="ident" id="6640707">rcode</span>&nbsp;<span class="op" id="6640713">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6640717">case</span>&nbsp;<span class="ident" id="6640722">tt</span><span class="op" id="6640724">.</span><span class="ident" id="6640725">rcode</span><span class="op" id="6640730">,</span>&nbsp;<span class="ident" id="6640732">dnsRcodeServerFailure</span><span class="op" id="6640753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6640757">default</span><span class="op" id="6640764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6640769">t</span><span class="op" id="6640770">.</span><span class="ident" id="6640771">Errorf</span><span class="op" id="6640777">(</span><span class="string" id="6640778">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6640803">,</span>&nbsp;<span class="ident" id="6640805">msg</span><span class="op" id="6640808">.</span><span class="ident" id="6640809">rcode</span><span class="op" id="6640814">,</span>&nbsp;<span class="ident" id="6640816">tt</span><span class="op" id="6640818">.</span><span class="ident" id="6640819">server</span><span class="op" id="6640825">,</span>&nbsp;<span class="ident" id="6640827">tt</span><span class="op" id="6640829">.</span><span class="ident" id="6640830">rcode</span><span class="op" id="6640835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6640840">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6640851">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6640854">}</span><br>
<span class="lineno"></span><span class="op" id="6640856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6640859">//&nbsp;See&nbsp;RFC&nbsp;6761&nbsp;for&nbsp;further&nbsp;information&nbsp;about&nbsp;the&nbsp;reserved,&nbsp;pseudo</span><br>
<span class="lineno"></span><span class="comment" id="6640926">//&nbsp;domain&nbsp;names.</span><br>
<span class="lineno">55</span><span class="keyword" id="6640943">var</span>&nbsp;<span class="ident" id="6640947">specialDomainNameTests</span>&nbsp;<span class="op" id="6640970">=</span>&nbsp;<span class="op" id="6640972">[</span><span class="op" id="6640973">]</span><span class="keyword" id="6640974">struct</span>&nbsp;<span class="op" id="6640981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6640984">name</span>&nbsp;&nbsp;<span class="builtintype" id="6640990">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6640998">qtype</span>&nbsp;<span class="builtintype" id="6641004">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6641012">rcode</span>&nbsp;<span class="builtintype" id="6641018">int</span><br>
<span class="lineno"></span><span class="op" id="6641022">}</span><span class="op" id="6641023">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6641026">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;not&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6641090">//&nbsp;followings&nbsp;as&nbsp;special.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6641117">{</span><span class="string" id="6641118">&#34;1.0.168.192.in-addr.arpa.&#34;</span><span class="op" id="6641145">,</span>&nbsp;<span class="ident" id="6641147">dnsTypePTR</span><span class="op" id="6641157">,</span>&nbsp;<span class="ident" id="6641159">dnsRcodeNameError</span><span class="op" id="6641176">}</span><span class="op" id="6641177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6641180">{</span><span class="string" id="6641181">&#34;test.&#34;</span><span class="op" id="6641188">,</span>&nbsp;<span class="ident" id="6641190">dnsTypeALL</span><span class="op" id="6641200">,</span>&nbsp;<span class="ident" id="6641202">dnsRcodeNameError</span><span class="op" id="6641219">}</span><span class="op" id="6641220">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6641223">{</span><span class="string" id="6641224">&#34;example.com.&#34;</span><span class="op" id="6641238">,</span>&nbsp;<span class="ident" id="6641240">dnsTypeALL</span><span class="op" id="6641250">,</span>&nbsp;<span class="ident" id="6641252">dnsRcodeSuccess</span><span class="op" id="6641267">}</span><span class="op" id="6641268">,</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6641272">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6641332">//&nbsp;followings&nbsp;as&nbsp;special&nbsp;and&nbsp;should&nbsp;not&nbsp;send&nbsp;any&nbsp;queries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6641391">//&nbsp;Though,&nbsp;we&nbsp;test&nbsp;those&nbsp;names&nbsp;here&nbsp;for&nbsp;verifying&nbsp;nagative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6641451">//&nbsp;answers&nbsp;at&nbsp;DNS&nbsp;query-response&nbsp;interaction&nbsp;level.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6641504">{</span><span class="string" id="6641505">&#34;localhost.&#34;</span><span class="op" id="6641517">,</span>&nbsp;<span class="ident" id="6641519">dnsTypeALL</span><span class="op" id="6641529">,</span>&nbsp;<span class="ident" id="6641531">dnsRcodeNameError</span><span class="op" id="6641548">}</span><span class="op" id="6641549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6641552">{</span><span class="string" id="6641553">&#34;invalid.&#34;</span><span class="op" id="6641563">,</span>&nbsp;<span class="ident" id="6641565">dnsTypeALL</span><span class="op" id="6641575">,</span>&nbsp;<span class="ident" id="6641577">dnsRcodeNameError</span><span class="op" id="6641594">}</span><span class="op" id="6641595">,</span><br>
<span class="lineno"></span><span class="op" id="6641597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6641600">func</span>&nbsp;<span class="ident" id="6641605">TestSpecialDomainName</span><span class="op" id="6641626">(</span><span class="ident" id="6641627">t</span>&nbsp;<span class="op" id="6641629">*</span><span class="ident" id="6641630">testing</span><span class="op" id="6641637">.</span><span class="ident" id="6641638">T</span><span class="op" id="6641639">)</span>&nbsp;<span class="op" id="6641641">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6641644">if</span>&nbsp;<span class="ident" id="6641647">testing</span><span class="op" id="6641654">.</span><span class="ident" id="6641655">Short</span><span class="op" id="6641660">(</span><span class="op" id="6641661">)</span>&nbsp;<span class="op" id="6641663">||</span>&nbsp;<span class="op" id="6641666">!</span><span class="op" id="6641667">*</span><span class="ident" id="6641668">testExternal</span>&nbsp;<span class="op" id="6641681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6641685">t</span><span class="op" id="6641686">.</span><span class="ident" id="6641687">Skip</span><span class="op" id="6641691">(</span><span class="string" id="6641692">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6641733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6641736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6641740">server</span>&nbsp;<span class="op" id="6641747">:=</span>&nbsp;<span class="string" id="6641750">&#34;8.8.8.8:53&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6641764">for</span>&nbsp;<span class="ident" id="6641768">_</span><span class="op" id="6641769">,</span>&nbsp;<span class="ident" id="6641771">tt</span>&nbsp;<span class="op" id="6641774">:=</span>&nbsp;<span class="keyword" id="6641777">range</span>&nbsp;<span class="ident" id="6641783">specialDomainNameTests</span>&nbsp;<span class="op" id="6641806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6641810">msg</span><span class="op" id="6641813">,</span>&nbsp;<span class="ident" id="6641815">err</span>&nbsp;<span class="op" id="6641819">:=</span>&nbsp;<span class="ident" id="6641822">exchange</span><span class="op" id="6641830">(</span><span class="ident" id="6641831">server</span><span class="op" id="6641837">,</span>&nbsp;<span class="ident" id="6641839">tt</span><span class="op" id="6641841">.</span><span class="ident" id="6641842">name</span><span class="op" id="6641846">,</span>&nbsp;<span class="ident" id="6641848">tt</span><span class="op" id="6641850">.</span><span class="ident" id="6641851">qtype</span><span class="op" id="6641856">,</span>&nbsp;<span class="num" id="6641858">0</span><span class="op" id="6641859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6641863">if</span>&nbsp;<span class="ident" id="6641866">err</span>&nbsp;<span class="op" id="6641870">!=</span>&nbsp;<span class="builtintype" id="6641873">nil</span>&nbsp;<span class="op" id="6641877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6641882">t</span><span class="op" id="6641883">.</span><span class="ident" id="6641884">Error</span><span class="op" id="6641889">(</span><span class="ident" id="6641890">err</span><span class="op" id="6641893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6641898">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6641909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6641913">switch</span>&nbsp;<span class="ident" id="6641920">msg</span><span class="op" id="6641923">.</span><span class="ident" id="6641924">rcode</span>&nbsp;<span class="op" id="6641930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6641934">case</span>&nbsp;<span class="ident" id="6641939">tt</span><span class="op" id="6641941">.</span><span class="ident" id="6641942">rcode</span><span class="op" id="6641947">,</span>&nbsp;<span class="ident" id="6641949">dnsRcodeServerFailure</span><span class="op" id="6641970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6641974">default</span><span class="op" id="6641981">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6641986">t</span><span class="op" id="6641987">.</span><span class="ident" id="6641988">Errorf</span><span class="op" id="6641994">(</span><span class="string" id="6641995">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6642020">,</span>&nbsp;<span class="ident" id="6642022">msg</span><span class="op" id="6642025">.</span><span class="ident" id="6642026">rcode</span><span class="op" id="6642031">,</span>&nbsp;<span class="ident" id="6642033">server</span><span class="op" id="6642039">,</span>&nbsp;<span class="ident" id="6642041">tt</span><span class="op" id="6642043">.</span><span class="ident" id="6642044">rcode</span><span class="op" id="6642049">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6642054">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6642065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6642068">}</span><br>
<span class="lineno"></span><span class="op" id="6642070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6642073">type</span>&nbsp;<span class="ident" id="6642078">resolvConfTest</span>&nbsp;<span class="keyword" id="6642093">struct</span>&nbsp;<span class="op" id="6642100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6642103">*</span><span class="ident" id="6642104">testing</span><span class="op" id="6642111">.</span><span class="ident" id="6642112">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642115">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6642123">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642131">path</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6642139">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642147">started</span>&nbsp;<span class="builtintype" id="6642155">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642161">quitc</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6642169">chan</span>&nbsp;<span class="keyword" id="6642174">chan</span>&nbsp;<span class="keyword" id="6642179">struct</span><span class="op" id="6642185">{</span><span class="op" id="6642186">}</span><br>
<span class="lineno"></span><span class="op" id="6642188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6642191">func</span>&nbsp;<span class="ident" id="6642196">newResolvConfTest</span><span class="op" id="6642213">(</span><span class="ident" id="6642214">t</span>&nbsp;<span class="op" id="6642216">*</span><span class="ident" id="6642217">testing</span><span class="op" id="6642224">.</span><span class="ident" id="6642225">T</span><span class="op" id="6642226">)</span>&nbsp;<span class="op" id="6642228">*</span><span class="ident" id="6642229">resolvConfTest</span>&nbsp;<span class="op" id="6642244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642247">dir</span><span class="op" id="6642250">,</span>&nbsp;<span class="ident" id="6642252">err</span>&nbsp;<span class="op" id="6642256">:=</span>&nbsp;<span class="ident" id="6642259">ioutil</span><span class="op" id="6642265">.</span><span class="ident" id="6642266">TempDir</span><span class="op" id="6642273">(</span><span class="string" id="6642274">&#34;&#34;</span><span class="op" id="6642276">,</span>&nbsp;<span class="string" id="6642278">&#34;resolvConfTest&#34;</span><span class="op" id="6642294">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6642297">if</span>&nbsp;<span class="ident" id="6642300">err</span>&nbsp;<span class="op" id="6642304">!=</span>&nbsp;<span class="builtintype" id="6642307">nil</span>&nbsp;<span class="op" id="6642311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642315">t</span><span class="op" id="6642316">.</span><span class="ident" id="6642317">Fatalf</span><span class="op" id="6642323">(</span><span class="string" id="6642324">&#34;could&nbsp;not&nbsp;create&nbsp;temp&nbsp;dir:&nbsp;%v&#34;</span><span class="op" id="6642355">,</span>&nbsp;<span class="ident" id="6642357">err</span><span class="op" id="6642360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6642363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6642367">//&nbsp;Disable&nbsp;the&nbsp;default&nbsp;loadConfig</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642402">onceLoadConfig</span><span class="op" id="6642416">.</span><span class="ident" id="6642417">Do</span><span class="op" id="6642419">(</span><span class="keyword" id="6642420">func</span><span class="op" id="6642424">(</span><span class="op" id="6642425">)</span>&nbsp;<span class="op" id="6642427">{</span><span class="op" id="6642428">}</span><span class="op" id="6642429">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642433">r</span>&nbsp;<span class="op" id="6642435">:=</span>&nbsp;<span class="op" id="6642438">&amp;</span><span class="ident" id="6642439">resolvConfTest</span><span class="op" id="6642453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642457">T</span><span class="op" id="6642458">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642464">t</span><span class="op" id="6642465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642469">dir</span><span class="op" id="6642472">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6642476">dir</span><span class="op" id="6642479">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642483">path</span><span class="op" id="6642487">:</span>&nbsp;&nbsp;<span class="ident" id="6642490">path</span><span class="op" id="6642494">.</span><span class="ident" id="6642495">Join</span><span class="op" id="6642499">(</span><span class="ident" id="6642500">dir</span><span class="op" id="6642503">,</span>&nbsp;<span class="string" id="6642505">&#34;resolv.conf&#34;</span><span class="op" id="6642518">)</span><span class="op" id="6642519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642523">quitc</span><span class="op" id="6642528">:</span>&nbsp;<span class="builtinfunc" id="6642530">make</span><span class="op" id="6642534">(</span><span class="keyword" id="6642535">chan</span>&nbsp;<span class="keyword" id="6642540">chan</span>&nbsp;<span class="keyword" id="6642545">struct</span><span class="op" id="6642551">{</span><span class="op" id="6642552">}</span><span class="op" id="6642553">)</span><span class="op" id="6642554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6642557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6642561">return</span>&nbsp;<span class="ident" id="6642568">r</span><br>
<span class="lineno">120</span><span class="op" id="6642570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6642573">func</span>&nbsp;<span class="op" id="6642578">(</span><span class="ident" id="6642579">r</span>&nbsp;<span class="op" id="6642581">*</span><span class="ident" id="6642582">resolvConfTest</span><span class="op" id="6642596">)</span>&nbsp;<span class="ident" id="6642598">Start</span><span class="op" id="6642603">(</span><span class="op" id="6642604">)</span>&nbsp;<span class="op" id="6642606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642609">loadConfig</span><span class="op" id="6642619">(</span><span class="ident" id="6642620">r</span><span class="op" id="6642621">.</span><span class="ident" id="6642622">path</span><span class="op" id="6642626">,</span>&nbsp;<span class="num" id="6642628">100</span><span class="op" id="6642631">*</span><span class="ident" id="6642632">time</span><span class="op" id="6642636">.</span><span class="ident" id="6642637">Millisecond</span><span class="op" id="6642648">,</span>&nbsp;<span class="ident" id="6642650">r</span><span class="op" id="6642651">.</span><span class="ident" id="6642652">quitc</span><span class="op" id="6642657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642660">r</span><span class="op" id="6642661">.</span><span class="ident" id="6642662">started</span>&nbsp;<span class="op" id="6642670">=</span>&nbsp;<span class="builtintype" id="6642672">true</span><br>
<span class="lineno">125</span><span class="op" id="6642677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6642680">func</span>&nbsp;<span class="op" id="6642685">(</span><span class="ident" id="6642686">r</span>&nbsp;<span class="op" id="6642688">*</span><span class="ident" id="6642689">resolvConfTest</span><span class="op" id="6642703">)</span>&nbsp;<span class="ident" id="6642705">SetConf</span><span class="op" id="6642712">(</span><span class="ident" id="6642713">s</span>&nbsp;<span class="builtintype" id="6642715">string</span><span class="op" id="6642721">)</span>&nbsp;<span class="op" id="6642723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6642726">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;file&nbsp;mtime&nbsp;will&nbsp;be&nbsp;different&nbsp;once&nbsp;we&#39;re&nbsp;done&nbsp;here,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6642795">//&nbsp;even&nbsp;on&nbsp;systems&nbsp;with&nbsp;coarse&nbsp;(1s)&nbsp;mtime&nbsp;resolution.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642850">time</span><span class="op" id="6642854">.</span><span class="ident" id="6642855">Sleep</span><span class="op" id="6642860">(</span><span class="ident" id="6642861">time</span><span class="op" id="6642865">.</span><span class="ident" id="6642866">Second</span><span class="op" id="6642872">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642876">f</span><span class="op" id="6642877">,</span>&nbsp;<span class="ident" id="6642879">err</span>&nbsp;<span class="op" id="6642883">:=</span>&nbsp;<span class="ident" id="6642886">os</span><span class="op" id="6642888">.</span><span class="ident" id="6642889">OpenFile</span><span class="op" id="6642897">(</span><span class="ident" id="6642898">r</span><span class="op" id="6642899">.</span><span class="ident" id="6642900">path</span><span class="op" id="6642904">,</span>&nbsp;<span class="ident" id="6642906">os</span><span class="op" id="6642908">.</span><span class="ident" id="6642909">O_CREATE</span><span class="op" id="6642917">|</span><span class="ident" id="6642918">os</span><span class="op" id="6642920">.</span><span class="ident" id="6642921">O_TRUNC</span><span class="op" id="6642928">|</span><span class="ident" id="6642929">os</span><span class="op" id="6642931">.</span><span class="ident" id="6642932">O_WRONLY</span><span class="op" id="6642940">,</span>&nbsp;<span class="num" id="6642942">0600</span><span class="op" id="6642946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6642949">if</span>&nbsp;<span class="ident" id="6642952">err</span>&nbsp;<span class="op" id="6642956">!=</span>&nbsp;<span class="builtintype" id="6642959">nil</span>&nbsp;<span class="op" id="6642963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642967">r</span><span class="op" id="6642968">.</span><span class="ident" id="6642969">Fatalf</span><span class="op" id="6642975">(</span><span class="string" id="6642976">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6643011">,</span>&nbsp;<span class="ident" id="6643013">r</span><span class="op" id="6643014">.</span><span class="ident" id="6643015">path</span><span class="op" id="6643019">,</span>&nbsp;<span class="ident" id="6643021">err</span><span class="op" id="6643024">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6643027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6643030">if</span>&nbsp;<span class="ident" id="6643033">_</span><span class="op" id="6643034">,</span>&nbsp;<span class="ident" id="6643036">err</span>&nbsp;<span class="op" id="6643040">:=</span>&nbsp;<span class="ident" id="6643043">io</span><span class="op" id="6643045">.</span><span class="ident" id="6643046">WriteString</span><span class="op" id="6643057">(</span><span class="ident" id="6643058">f</span><span class="op" id="6643059">,</span>&nbsp;<span class="ident" id="6643061">s</span><span class="op" id="6643062">)</span><span class="op" id="6643063">;</span>&nbsp;<span class="ident" id="6643065">err</span>&nbsp;<span class="op" id="6643069">!=</span>&nbsp;<span class="builtintype" id="6643072">nil</span>&nbsp;<span class="op" id="6643076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643080">f</span><span class="op" id="6643081">.</span><span class="ident" id="6643082">Close</span><span class="op" id="6643087">(</span><span class="op" id="6643088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643092">r</span><span class="op" id="6643093">.</span><span class="ident" id="6643094">Fatalf</span><span class="op" id="6643100">(</span><span class="string" id="6643101">&#34;failed&nbsp;to&nbsp;write&nbsp;temp&nbsp;file:&nbsp;%v&#34;</span><span class="op" id="6643132">,</span>&nbsp;<span class="ident" id="6643134">err</span><span class="op" id="6643137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6643140">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643143">f</span><span class="op" id="6643144">.</span><span class="ident" id="6643145">Close</span><span class="op" id="6643150">(</span><span class="op" id="6643151">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6643155">if</span>&nbsp;<span class="ident" id="6643158">r</span><span class="op" id="6643159">.</span><span class="ident" id="6643160">started</span>&nbsp;<span class="op" id="6643168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643172">cfg</span><span class="op" id="6643175">.</span><span class="ident" id="6643176">ch</span>&nbsp;<span class="op" id="6643179">&lt;-</span>&nbsp;<span class="keyword" id="6643182">struct</span><span class="op" id="6643188">{</span><span class="op" id="6643189">}</span><span class="op" id="6643190">{</span><span class="op" id="6643191">}</span>&nbsp;<span class="comment" id="6643193">//&nbsp;fill&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643210">cfg</span><span class="op" id="6643213">.</span><span class="ident" id="6643214">ch</span>&nbsp;<span class="op" id="6643217">&lt;-</span>&nbsp;<span class="keyword" id="6643220">struct</span><span class="op" id="6643226">{</span><span class="op" id="6643227">}</span><span class="op" id="6643228">{</span><span class="op" id="6643229">}</span>&nbsp;<span class="comment" id="6643231">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;begin</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643261">cfg</span><span class="op" id="6643264">.</span><span class="ident" id="6643265">ch</span>&nbsp;<span class="op" id="6643268">&lt;-</span>&nbsp;<span class="keyword" id="6643271">struct</span><span class="op" id="6643277">{</span><span class="op" id="6643278">}</span><span class="op" id="6643279">{</span><span class="op" id="6643280">}</span>&nbsp;<span class="comment" id="6643282">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6643314">}</span><br>
<span class="lineno"></span><span class="op" id="6643316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6643319">func</span>&nbsp;<span class="op" id="6643324">(</span><span class="ident" id="6643325">r</span>&nbsp;<span class="op" id="6643327">*</span><span class="ident" id="6643328">resolvConfTest</span><span class="op" id="6643342">)</span>&nbsp;<span class="ident" id="6643344">WantServers</span><span class="op" id="6643355">(</span><span class="ident" id="6643356">want</span>&nbsp;<span class="op" id="6643361">[</span><span class="op" id="6643362">]</span><span class="builtintype" id="6643363">string</span><span class="op" id="6643369">)</span>&nbsp;<span class="op" id="6643371">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643374">cfg</span><span class="op" id="6643377">.</span><span class="ident" id="6643378">mu</span><span class="op" id="6643380">.</span><span class="ident" id="6643381">RLock</span><span class="op" id="6643386">(</span><span class="op" id="6643387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6643390">defer</span>&nbsp;<span class="ident" id="6643396">cfg</span><span class="op" id="6643399">.</span><span class="ident" id="6643400">mu</span><span class="op" id="6643402">.</span><span class="ident" id="6643403">RUnlock</span><span class="op" id="6643410">(</span><span class="op" id="6643411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6643414">if</span>&nbsp;<span class="ident" id="6643417">got</span>&nbsp;<span class="op" id="6643421">:=</span>&nbsp;<span class="ident" id="6643424">cfg</span><span class="op" id="6643427">.</span><span class="ident" id="6643428">dnsConfig</span><span class="op" id="6643437">.</span><span class="ident" id="6643438">servers</span><span class="op" id="6643445">;</span>&nbsp;<span class="op" id="6643447">!</span><span class="ident" id="6643448">reflect</span><span class="op" id="6643455">.</span><span class="ident" id="6643456">DeepEqual</span><span class="op" id="6643465">(</span><span class="ident" id="6643466">got</span><span class="op" id="6643469">,</span>&nbsp;<span class="ident" id="6643471">want</span><span class="op" id="6643475">)</span>&nbsp;<span class="op" id="6643477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643481">r</span><span class="op" id="6643482">.</span><span class="ident" id="6643483">Fatalf</span><span class="op" id="6643489">(</span><span class="string" id="6643490">&#34;Unexpected&nbsp;dns&nbsp;server&nbsp;loaded,&nbsp;got&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6643536">,</span>&nbsp;<span class="ident" id="6643538">got</span><span class="op" id="6643541">,</span>&nbsp;<span class="ident" id="6643543">want</span><span class="op" id="6643547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6643550">}</span><br>
<span class="lineno">155</span><span class="op" id="6643552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6643555">func</span>&nbsp;<span class="op" id="6643560">(</span><span class="ident" id="6643561">r</span>&nbsp;<span class="op" id="6643563">*</span><span class="ident" id="6643564">resolvConfTest</span><span class="op" id="6643578">)</span>&nbsp;<span class="ident" id="6643580">Close</span><span class="op" id="6643585">(</span><span class="op" id="6643586">)</span>&nbsp;<span class="op" id="6643588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643591">resp</span>&nbsp;<span class="op" id="6643596">:=</span>&nbsp;<span class="builtinfunc" id="6643599">make</span><span class="op" id="6643603">(</span><span class="keyword" id="6643604">chan</span>&nbsp;<span class="keyword" id="6643609">struct</span><span class="op" id="6643615">{</span><span class="op" id="6643616">}</span><span class="op" id="6643617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643620">r</span><span class="op" id="6643621">.</span><span class="ident" id="6643622">quitc</span>&nbsp;<span class="op" id="6643628">&lt;-</span>&nbsp;<span class="ident" id="6643631">resp</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6643637">&lt;-</span><span class="ident" id="6643639">resp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6643645">if</span>&nbsp;<span class="ident" id="6643648">err</span>&nbsp;<span class="op" id="6643652">:=</span>&nbsp;<span class="ident" id="6643655">os</span><span class="op" id="6643657">.</span><span class="ident" id="6643658">RemoveAll</span><span class="op" id="6643667">(</span><span class="ident" id="6643668">r</span><span class="op" id="6643669">.</span><span class="ident" id="6643670">dir</span><span class="op" id="6643673">)</span><span class="op" id="6643674">;</span>&nbsp;<span class="ident" id="6643676">err</span>&nbsp;<span class="op" id="6643680">!=</span>&nbsp;<span class="builtintype" id="6643683">nil</span>&nbsp;<span class="op" id="6643687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643691">r</span><span class="op" id="6643692">.</span><span class="ident" id="6643693">Logf</span><span class="op" id="6643697">(</span><span class="string" id="6643698">&#34;failed&nbsp;to&nbsp;remove&nbsp;temp&nbsp;dir&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6643732">,</span>&nbsp;<span class="ident" id="6643734">r</span><span class="op" id="6643735">.</span><span class="ident" id="6643736">dir</span><span class="op" id="6643739">,</span>&nbsp;<span class="ident" id="6643741">err</span><span class="op" id="6643744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6643747">}</span><br>
<span class="lineno"></span><span class="op" id="6643749">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6643752">func</span>&nbsp;<span class="ident" id="6643757">TestReloadResolvConfFail</span><span class="op" id="6643781">(</span><span class="ident" id="6643782">t</span>&nbsp;<span class="op" id="6643784">*</span><span class="ident" id="6643785">testing</span><span class="op" id="6643792">.</span><span class="ident" id="6643793">T</span><span class="op" id="6643794">)</span>&nbsp;<span class="op" id="6643796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6643799">if</span>&nbsp;<span class="ident" id="6643802">testing</span><span class="op" id="6643809">.</span><span class="ident" id="6643810">Short</span><span class="op" id="6643815">(</span><span class="op" id="6643816">)</span>&nbsp;<span class="op" id="6643818">||</span>&nbsp;<span class="op" id="6643821">!</span><span class="op" id="6643822">*</span><span class="ident" id="6643823">testExternal</span>&nbsp;<span class="op" id="6643836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643840">t</span><span class="op" id="6643841">.</span><span class="ident" id="6643842">Skip</span><span class="op" id="6643846">(</span><span class="string" id="6643847">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6643888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6643891">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643895">r</span>&nbsp;<span class="op" id="6643897">:=</span>&nbsp;<span class="ident" id="6643900">newResolvConfTest</span><span class="op" id="6643917">(</span><span class="ident" id="6643918">t</span><span class="op" id="6643919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6643922">defer</span>&nbsp;<span class="ident" id="6643928">r</span><span class="op" id="6643929">.</span><span class="ident" id="6643930">Close</span><span class="op" id="6643935">(</span><span class="op" id="6643936">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6643940">//&nbsp;resolv.conf.tmp&nbsp;does&nbsp;not&nbsp;exist&nbsp;yet</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6643979">r</span><span class="op" id="6643980">.</span><span class="ident" id="6643981">Start</span><span class="op" id="6643986">(</span><span class="op" id="6643987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6643990">if</span>&nbsp;<span class="ident" id="6643993">_</span><span class="op" id="6643994">,</span>&nbsp;<span class="ident" id="6643996">err</span>&nbsp;<span class="op" id="6644000">:=</span>&nbsp;<span class="ident" id="6644003">goLookupIP</span><span class="op" id="6644013">(</span><span class="string" id="6644014">&#34;golang.org&#34;</span><span class="op" id="6644026">)</span><span class="op" id="6644027">;</span>&nbsp;<span class="ident" id="6644029">err</span>&nbsp;<span class="op" id="6644033">==</span>&nbsp;<span class="builtintype" id="6644036">nil</span>&nbsp;<span class="op" id="6644040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6644044">t</span><span class="op" id="6644045">.</span><span class="ident" id="6644046">Fatal</span><span class="op" id="6644051">(</span><span class="string" id="6644052">&#34;goLookupIP(missing)&nbsp;succeeded&#34;</span><span class="op" id="6644083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6644086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6644090">r</span><span class="op" id="6644091">.</span><span class="ident" id="6644092">SetConf</span><span class="op" id="6644099">(</span><span class="string" id="6644100">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="6644120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6644123">if</span>&nbsp;<span class="ident" id="6644126">_</span><span class="op" id="6644127">,</span>&nbsp;<span class="ident" id="6644129">err</span>&nbsp;<span class="op" id="6644133">:=</span>&nbsp;<span class="ident" id="6644136">goLookupIP</span><span class="op" id="6644146">(</span><span class="string" id="6644147">&#34;golang.org&#34;</span><span class="op" id="6644159">)</span><span class="op" id="6644160">;</span>&nbsp;<span class="ident" id="6644162">err</span>&nbsp;<span class="op" id="6644166">!=</span>&nbsp;<span class="builtintype" id="6644169">nil</span>&nbsp;<span class="op" id="6644173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6644177">t</span><span class="op" id="6644178">.</span><span class="ident" id="6644179">Fatalf</span><span class="op" id="6644185">(</span><span class="string" id="6644186">&#34;goLookupIP(missing;&nbsp;good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6644224">,</span>&nbsp;<span class="ident" id="6644226">err</span><span class="op" id="6644229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6644232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6644236">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;while&nbsp;we&nbsp;had&nbsp;a&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6644284">//&nbsp;one&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6644328">r</span><span class="op" id="6644329">.</span><span class="ident" id="6644330">SetConf</span><span class="op" id="6644337">(</span><span class="string" id="6644338">&#34;&#34;</span><span class="op" id="6644340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6644343">if</span>&nbsp;<span class="ident" id="6644346">_</span><span class="op" id="6644347">,</span>&nbsp;<span class="ident" id="6644349">err</span>&nbsp;<span class="op" id="6644353">:=</span>&nbsp;<span class="ident" id="6644356">goLookupIP</span><span class="op" id="6644366">(</span><span class="string" id="6644367">&#34;golang.org&#34;</span><span class="op" id="6644379">)</span><span class="op" id="6644380">;</span>&nbsp;<span class="ident" id="6644382">err</span>&nbsp;<span class="op" id="6644386">!=</span>&nbsp;<span class="builtintype" id="6644389">nil</span>&nbsp;<span class="op" id="6644393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6644397">t</span><span class="op" id="6644398">.</span><span class="ident" id="6644399">Fatalf</span><span class="op" id="6644405">(</span><span class="string" id="6644406">&#34;goLookupIP(missing;&nbsp;good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6644449">,</span>&nbsp;<span class="ident" id="6644451">err</span><span class="op" id="6644454">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6644457">}</span><br>
<span class="lineno"></span><span class="op" id="6644459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6644462">func</span>&nbsp;<span class="ident" id="6644467">TestReloadResolvConfChange</span><span class="op" id="6644493">(</span><span class="ident" id="6644494">t</span>&nbsp;<span class="op" id="6644496">*</span><span class="ident" id="6644497">testing</span><span class="op" id="6644504">.</span><span class="ident" id="6644505">T</span><span class="op" id="6644506">)</span>&nbsp;<span class="op" id="6644508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6644511">if</span>&nbsp;<span class="ident" id="6644514">testing</span><span class="op" id="6644521">.</span><span class="ident" id="6644522">Short</span><span class="op" id="6644527">(</span><span class="op" id="6644528">)</span>&nbsp;<span class="op" id="6644530">||</span>&nbsp;<span class="op" id="6644533">!</span><span class="op" id="6644534">*</span><span class="ident" id="6644535">testExternal</span>&nbsp;<span class="op" id="6644548">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6644552">t</span><span class="op" id="6644553">.</span><span class="ident" id="6644554">Skip</span><span class="op" id="6644558">(</span><span class="string" id="6644559">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6644600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6644603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6644607">r</span>&nbsp;<span class="op" id="6644609">:=</span>&nbsp;<span class="ident" id="6644612">newResolvConfTest</span><span class="op" id="6644629">(</span><span class="ident" id="6644630">t</span><span class="op" id="6644631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6644634">defer</span>&nbsp;<span class="ident" id="6644640">r</span><span class="op" id="6644641">.</span><span class="ident" id="6644642">Close</span><span class="op" id="6644647">(</span><span class="op" id="6644648">)</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6644652">r</span><span class="op" id="6644653">.</span><span class="ident" id="6644654">SetConf</span><span class="op" id="6644661">(</span><span class="string" id="6644662">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="6644682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6644685">r</span><span class="op" id="6644686">.</span><span class="ident" id="6644687">Start</span><span class="op" id="6644692">(</span><span class="op" id="6644693">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6644697">if</span>&nbsp;<span class="ident" id="6644700">_</span><span class="op" id="6644701">,</span>&nbsp;<span class="ident" id="6644703">err</span>&nbsp;<span class="op" id="6644707">:=</span>&nbsp;<span class="ident" id="6644710">goLookupIP</span><span class="op" id="6644720">(</span><span class="string" id="6644721">&#34;golang.org&#34;</span><span class="op" id="6644733">)</span><span class="op" id="6644734">;</span>&nbsp;<span class="ident" id="6644736">err</span>&nbsp;<span class="op" id="6644740">!=</span>&nbsp;<span class="builtintype" id="6644743">nil</span>&nbsp;<span class="op" id="6644747">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6644751">t</span><span class="op" id="6644752">.</span><span class="ident" id="6644753">Fatalf</span><span class="op" id="6644759">(</span><span class="string" id="6644760">&#34;goLookupIP(good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6644789">,</span>&nbsp;<span class="ident" id="6644791">err</span><span class="op" id="6644794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6644797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6644800">r</span><span class="op" id="6644801">.</span><span class="ident" id="6644802">WantServers</span><span class="op" id="6644813">(</span><span class="op" id="6644814">[</span><span class="op" id="6644815">]</span><span class="builtintype" id="6644816">string</span><span class="op" id="6644822">{</span><span class="string" id="6644823">&#34;8.8.8.8&#34;</span><span class="op" id="6644832">}</span><span class="op" id="6644833">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6644837">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;when&nbsp;we&nbsp;had&nbsp;a&nbsp;good&nbsp;one</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6644888">//&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6644928">r</span><span class="op" id="6644929">.</span><span class="ident" id="6644930">SetConf</span><span class="op" id="6644937">(</span><span class="string" id="6644938">&#34;&#34;</span><span class="op" id="6644940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6644943">if</span>&nbsp;<span class="ident" id="6644946">_</span><span class="op" id="6644947">,</span>&nbsp;<span class="ident" id="6644949">err</span>&nbsp;<span class="op" id="6644953">:=</span>&nbsp;<span class="ident" id="6644956">goLookupIP</span><span class="op" id="6644966">(</span><span class="string" id="6644967">&#34;golang.org&#34;</span><span class="op" id="6644979">)</span><span class="op" id="6644980">;</span>&nbsp;<span class="ident" id="6644982">err</span>&nbsp;<span class="op" id="6644986">!=</span>&nbsp;<span class="builtintype" id="6644989">nil</span>&nbsp;<span class="op" id="6644993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6644997">t</span><span class="op" id="6644998">.</span><span class="ident" id="6644999">Fatalf</span><span class="op" id="6645005">(</span><span class="string" id="6645006">&#34;goLookupIP(good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6645040">,</span>&nbsp;<span class="ident" id="6645042">err</span><span class="op" id="6645045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6645048">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6645052">//&nbsp;A&nbsp;new&nbsp;good&nbsp;config&nbsp;should&nbsp;get&nbsp;picked&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6645095">r</span><span class="op" id="6645096">.</span><span class="ident" id="6645097">SetConf</span><span class="op" id="6645104">(</span><span class="string" id="6645105">&#34;nameserver&nbsp;8.8.4.4&#34;</span><span class="op" id="6645125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6645128">r</span><span class="op" id="6645129">.</span><span class="ident" id="6645130">WantServers</span><span class="op" id="6645141">(</span><span class="op" id="6645142">[</span><span class="op" id="6645143">]</span><span class="builtintype" id="6645144">string</span><span class="op" id="6645150">{</span><span class="string" id="6645151">&#34;8.8.4.4&#34;</span><span class="op" id="6645160">}</span><span class="op" id="6645161">)</span><br>
<span class="lineno"></span><span class="op" id="6645163">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="6645166">func</span>&nbsp;<span class="ident" id="6645171">BenchmarkGoLookupIP</span><span class="op" id="6645190">(</span><span class="ident" id="6645191">b</span>&nbsp;<span class="op" id="6645193">*</span><span class="ident" id="6645194">testing</span><span class="op" id="6645201">.</span><span class="ident" id="6645202">B</span><span class="op" id="6645203">)</span>&nbsp;<span class="op" id="6645205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6645208">for</span>&nbsp;<span class="ident" id="6645212">i</span>&nbsp;<span class="op" id="6645214">:=</span>&nbsp;<span class="num" id="6645217">0</span><span class="op" id="6645218">;</span>&nbsp;<span class="ident" id="6645220">i</span>&nbsp;<span class="op" id="6645222">&lt;</span>&nbsp;<span class="ident" id="6645224">b</span><span class="op" id="6645225">.</span><span class="ident" id="6645226">N</span><span class="op" id="6645227">;</span>&nbsp;<span class="ident" id="6645229">i</span><span class="op" id="6645230">++</span>&nbsp;<span class="op" id="6645233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6645237">goLookupIP</span><span class="op" id="6645247">(</span><span class="string" id="6645248">&#34;www.example.com&#34;</span><span class="op" id="6645265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6645268">}</span><br>
<span class="lineno">225</span><span class="op" id="6645270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6645273">func</span>&nbsp;<span class="ident" id="6645278">BenchmarkGoLookupIPNoSuchHost</span><span class="op" id="6645307">(</span><span class="ident" id="6645308">b</span>&nbsp;<span class="op" id="6645310">*</span><span class="ident" id="6645311">testing</span><span class="op" id="6645318">.</span><span class="ident" id="6645319">B</span><span class="op" id="6645320">)</span>&nbsp;<span class="op" id="6645322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6645325">for</span>&nbsp;<span class="ident" id="6645329">i</span>&nbsp;<span class="op" id="6645331">:=</span>&nbsp;<span class="num" id="6645334">0</span><span class="op" id="6645335">;</span>&nbsp;<span class="ident" id="6645337">i</span>&nbsp;<span class="op" id="6645339">&lt;</span>&nbsp;<span class="ident" id="6645341">b</span><span class="op" id="6645342">.</span><span class="ident" id="6645343">N</span><span class="op" id="6645344">;</span>&nbsp;<span class="ident" id="6645346">i</span><span class="op" id="6645347">++</span>&nbsp;<span class="op" id="6645350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6645354">goLookupIP</span><span class="op" id="6645364">(</span><span class="string" id="6645365">&#34;some.nonexistent&#34;</span><span class="op" id="6645383">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6645386">}</span><br>
<span class="lineno"></span><span class="op" id="6645388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6645391">func</span>&nbsp;<span class="ident" id="6645396">BenchmarkGoLookupIPWithBrokenNameServer</span><span class="op" id="6645435">(</span><span class="ident" id="6645436">b</span>&nbsp;<span class="op" id="6645438">*</span><span class="ident" id="6645439">testing</span><span class="op" id="6645446">.</span><span class="ident" id="6645447">B</span><span class="op" id="6645448">)</span>&nbsp;<span class="op" id="6645450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6645453">onceLoadConfig</span><span class="op" id="6645467">.</span><span class="ident" id="6645468">Do</span><span class="op" id="6645470">(</span><span class="ident" id="6645471">loadDefaultConfig</span><span class="op" id="6645488">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6645491">if</span>&nbsp;<span class="ident" id="6645494">cfg</span><span class="op" id="6645497">.</span><span class="ident" id="6645498">dnserr</span>&nbsp;<span class="op" id="6645505">!=</span>&nbsp;<span class="builtintype" id="6645508">nil</span>&nbsp;<span class="op" id="6645512">||</span>&nbsp;<span class="ident" id="6645515">cfg</span><span class="op" id="6645518">.</span><span class="ident" id="6645519">dnsConfig</span>&nbsp;<span class="op" id="6645529">==</span>&nbsp;<span class="builtintype" id="6645532">nil</span>&nbsp;<span class="op" id="6645536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6645540">b</span><span class="op" id="6645541">.</span><span class="ident" id="6645542">Fatalf</span><span class="op" id="6645548">(</span><span class="string" id="6645549">&#34;loadConfig&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6645572">,</span>&nbsp;<span class="ident" id="6645574">cfg</span><span class="op" id="6645577">.</span><span class="ident" id="6645578">dnserr</span><span class="op" id="6645584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6645587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6645590">//&nbsp;This&nbsp;looks&nbsp;ugly&nbsp;but&nbsp;it&#39;s&nbsp;safe&nbsp;as&nbsp;long&nbsp;as&nbsp;benchmarks&nbsp;are&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6645654">//&nbsp;sequentially&nbsp;in&nbsp;package&nbsp;testing.</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6645691">orig</span>&nbsp;<span class="op" id="6645696">:=</span>&nbsp;<span class="ident" id="6645699">cfg</span><span class="op" id="6645702">.</span><span class="ident" id="6645703">dnsConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6645714">cfg</span><span class="op" id="6645717">.</span><span class="ident" id="6645718">dnsConfig</span><span class="op" id="6645727">.</span><span class="ident" id="6645728">servers</span>&nbsp;<span class="op" id="6645736">=</span>&nbsp;<span class="builtinfunc" id="6645738">append</span><span class="op" id="6645744">(</span><span class="op" id="6645745">[</span><span class="op" id="6645746">]</span><span class="builtintype" id="6645747">string</span><span class="op" id="6645753">{</span><span class="string" id="6645754">&#34;203.0.113.254&#34;</span><span class="op" id="6645769">}</span><span class="op" id="6645770">,</span>&nbsp;<span class="ident" id="6645772">cfg</span><span class="op" id="6645775">.</span><span class="ident" id="6645776">dnsConfig</span><span class="op" id="6645785">.</span><span class="ident" id="6645786">servers</span><span class="op" id="6645793">...</span><span class="op" id="6645796">)</span>&nbsp;<span class="comment" id="6645798">//&nbsp;use&nbsp;TEST-NET-3&nbsp;block,&nbsp;see&nbsp;RFC&nbsp;5737</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6645837">for</span>&nbsp;<span class="ident" id="6645841">i</span>&nbsp;<span class="op" id="6645843">:=</span>&nbsp;<span class="num" id="6645846">0</span><span class="op" id="6645847">;</span>&nbsp;<span class="ident" id="6645849">i</span>&nbsp;<span class="op" id="6645851">&lt;</span>&nbsp;<span class="ident" id="6645853">b</span><span class="op" id="6645854">.</span><span class="ident" id="6645855">N</span><span class="op" id="6645856">;</span>&nbsp;<span class="ident" id="6645858">i</span><span class="op" id="6645859">++</span>&nbsp;<span class="op" id="6645862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6645866">goLookupIP</span><span class="op" id="6645876">(</span><span class="string" id="6645877">&#34;www.example.com&#34;</span><span class="op" id="6645894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6645897">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6645900">cfg</span><span class="op" id="6645903">.</span><span class="ident" id="6645904">dnsConfig</span>&nbsp;<span class="op" id="6645914">=</span>&nbsp;<span class="ident" id="6645916">orig</span><br>
<span class="lineno"></span><span class="op" id="6645921">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
