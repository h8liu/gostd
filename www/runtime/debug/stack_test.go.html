<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8351039">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8351094">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8351148">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8351199">package</span>&nbsp;<span class="ident" id="8351207">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8351214">import</span>&nbsp;<span class="op" id="8351221">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8351224">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8351235">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8351245">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8351248">type</span>&nbsp;<span class="ident" id="8351253">T</span>&nbsp;<span class="builtintype" id="8351255">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8351260">func</span>&nbsp;<span class="op" id="8351265">(</span><span class="ident" id="8351266">t</span>&nbsp;<span class="op" id="8351268">*</span><span class="ident" id="8351269">T</span><span class="op" id="8351270">)</span>&nbsp;<span class="ident" id="8351272">ptrmethod</span><span class="op" id="8351281">(</span><span class="op" id="8351282">)</span>&nbsp;<span class="op" id="8351284">[</span><span class="op" id="8351285">]</span><span class="builtintype" id="8351286">byte</span>&nbsp;<span class="op" id="8351291">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351294">return</span>&nbsp;<span class="ident" id="8351301">Stack</span><span class="op" id="8351306">(</span><span class="op" id="8351307">)</span><br>
<span class="lineno"></span><span class="op" id="8351309">}</span><br>
<span class="lineno"></span><span class="keyword" id="8351311">func</span>&nbsp;<span class="op" id="8351316">(</span><span class="ident" id="8351317">t</span>&nbsp;<span class="ident" id="8351319">T</span><span class="op" id="8351320">)</span>&nbsp;<span class="ident" id="8351322">method</span><span class="op" id="8351328">(</span><span class="op" id="8351329">)</span>&nbsp;<span class="op" id="8351331">[</span><span class="op" id="8351332">]</span><span class="builtintype" id="8351333">byte</span>&nbsp;<span class="op" id="8351338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351341">return</span>&nbsp;<span class="ident" id="8351348">t</span><span class="op" id="8351349">.</span><span class="ident" id="8351350">ptrmethod</span><span class="op" id="8351359">(</span><span class="op" id="8351360">)</span><br>
<span class="lineno"></span><span class="op" id="8351362">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="8351365">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;traceback&nbsp;should&nbsp;look&nbsp;something&nbsp;like&nbsp;this,&nbsp;modulo&nbsp;line&nbsp;numbers&nbsp;and&nbsp;hex&nbsp;constants.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspDon&#39;t&nbsp;worry&nbsp;much&nbsp;about&nbsp;the&nbsp;base&nbsp;levels,&nbsp;but&nbsp;check&nbsp;the&nbsp;ones&nbsp;in&nbsp;our&nbsp;own&nbsp;package.<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:15&nbsp;(0x13878)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(*T).ptrmethod:&nbsp;return&nbsp;Stack()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:18&nbsp;(0x138dd)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspT.method:&nbsp;return&nbsp;t.ptrmethod()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:23&nbsp;(0x13920)<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/testing/testing.go:132&nbsp;(0x14a7a)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptRunner:&nbsp;test.F(t)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/proc.c:145&nbsp;(0xc970)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp???:&nbsp;runtime·unlock(&amp;runtime·sched);<br>
<span class="lineno">35</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="8351978">func</span>&nbsp;<span class="ident" id="8351983">TestStack</span><span class="op" id="8351992">(</span><span class="ident" id="8351993">t</span>&nbsp;<span class="op" id="8351995">*</span><span class="ident" id="8351996">testing</span><span class="op" id="8352003">.</span><span class="ident" id="8352004">T</span><span class="op" id="8352005">)</span>&nbsp;<span class="op" id="8352007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352010">b</span>&nbsp;<span class="op" id="8352012">:=</span>&nbsp;<span class="ident" id="8352015">T</span><span class="op" id="8352016">(</span><span class="num" id="8352017">0</span><span class="op" id="8352018">)</span><span class="op" id="8352019">.</span><span class="ident" id="8352020">method</span><span class="op" id="8352026">(</span><span class="op" id="8352027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352030">lines</span>&nbsp;<span class="op" id="8352036">:=</span>&nbsp;<span class="ident" id="8352039">strings</span><span class="op" id="8352046">.</span><span class="ident" id="8352047">Split</span><span class="op" id="8352052">(</span><span class="builtintype" id="8352053">string</span><span class="op" id="8352059">(</span><span class="ident" id="8352060">b</span><span class="op" id="8352061">)</span><span class="op" id="8352062">,</span>&nbsp;<span class="string" id="8352064">&#34;\n&#34;</span><span class="op" id="8352068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352071">if</span>&nbsp;<span class="builtinfunc" id="8352074">len</span><span class="op" id="8352077">(</span><span class="ident" id="8352078">lines</span><span class="op" id="8352083">)</span>&nbsp;<span class="op" id="8352085">&lt;</span>&nbsp;<span class="num" id="8352087">6</span>&nbsp;<span class="op" id="8352089">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352093">t</span><span class="op" id="8352094">.</span><span class="ident" id="8352095">Fatal</span><span class="op" id="8352100">(</span><span class="string" id="8352101">&#34;too&nbsp;few&nbsp;lines&#34;</span><span class="op" id="8352116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352122">n</span>&nbsp;<span class="op" id="8352124">:=</span>&nbsp;<span class="num" id="8352127">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352130">frame</span>&nbsp;<span class="op" id="8352136">:=</span>&nbsp;<span class="keyword" id="8352139">func</span><span class="op" id="8352143">(</span><span class="ident" id="8352144">line</span><span class="op" id="8352148">,</span>&nbsp;<span class="ident" id="8352150">code</span>&nbsp;<span class="builtintype" id="8352155">string</span><span class="op" id="8352161">)</span>&nbsp;<span class="op" id="8352163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352167">check</span><span class="op" id="8352172">(</span><span class="ident" id="8352173">t</span><span class="op" id="8352174">,</span>&nbsp;<span class="ident" id="8352176">lines</span><span class="op" id="8352181">[</span><span class="ident" id="8352182">n</span><span class="op" id="8352183">]</span><span class="op" id="8352184">,</span>&nbsp;<span class="ident" id="8352186">line</span><span class="op" id="8352190">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352194">n</span><span class="op" id="8352195">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8352200">//&nbsp;The&nbsp;source&nbsp;might&nbsp;not&nbsp;be&nbsp;available&nbsp;while&nbsp;running&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352263">if</span>&nbsp;<span class="ident" id="8352266">strings</span><span class="op" id="8352273">.</span><span class="ident" id="8352274">HasPrefix</span><span class="op" id="8352283">(</span><span class="ident" id="8352284">lines</span><span class="op" id="8352289">[</span><span class="ident" id="8352290">n</span><span class="op" id="8352291">]</span><span class="op" id="8352292">,</span>&nbsp;<span class="string" id="8352294">&#34;\t&#34;</span><span class="op" id="8352298">)</span>&nbsp;<span class="op" id="8352300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352305">check</span><span class="op" id="8352310">(</span><span class="ident" id="8352311">t</span><span class="op" id="8352312">,</span>&nbsp;<span class="ident" id="8352314">lines</span><span class="op" id="8352319">[</span><span class="ident" id="8352320">n</span><span class="op" id="8352321">]</span><span class="op" id="8352322">,</span>&nbsp;<span class="ident" id="8352324">code</span><span class="op" id="8352328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352333">n</span><span class="op" id="8352334">++</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352345">frame</span><span class="op" id="8352350">(</span><span class="string" id="8352351">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8352384">,</span>&nbsp;<span class="string" id="8352386">&#34;\t(*T).ptrmethod:&nbsp;return&nbsp;Stack()&#34;</span><span class="op" id="8352420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352423">frame</span><span class="op" id="8352428">(</span><span class="string" id="8352429">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8352462">,</span>&nbsp;<span class="string" id="8352464">&#34;\tT.method:&nbsp;return&nbsp;t.ptrmethod()&#34;</span><span class="op" id="8352498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352501">frame</span><span class="op" id="8352506">(</span><span class="string" id="8352507">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8352540">,</span>&nbsp;<span class="string" id="8352542">&#34;\tTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()&#34;</span><span class="op" id="8352575">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352578">frame</span><span class="op" id="8352583">(</span><span class="string" id="8352584">&#34;src/testing/testing.go&#34;</span><span class="op" id="8352608">,</span>&nbsp;<span class="string" id="8352610">&#34;&#34;</span><span class="op" id="8352612">)</span><br>
<span class="lineno"></span><span class="op" id="8352614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8352617">func</span>&nbsp;<span class="ident" id="8352622">check</span><span class="op" id="8352627">(</span><span class="ident" id="8352628">t</span>&nbsp;<span class="op" id="8352630">*</span><span class="ident" id="8352631">testing</span><span class="op" id="8352638">.</span><span class="ident" id="8352639">T</span><span class="op" id="8352640">,</span>&nbsp;<span class="ident" id="8352642">line</span><span class="op" id="8352646">,</span>&nbsp;<span class="ident" id="8352648">has</span>&nbsp;<span class="builtintype" id="8352652">string</span><span class="op" id="8352658">)</span>&nbsp;<span class="op" id="8352660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352663">if</span>&nbsp;<span class="ident" id="8352666">strings</span><span class="op" id="8352673">.</span><span class="ident" id="8352674">Index</span><span class="op" id="8352679">(</span><span class="ident" id="8352680">line</span><span class="op" id="8352684">,</span>&nbsp;<span class="ident" id="8352686">has</span><span class="op" id="8352689">)</span>&nbsp;<span class="op" id="8352691">&lt;</span>&nbsp;<span class="num" id="8352693">0</span>&nbsp;<span class="op" id="8352695">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352699">t</span><span class="op" id="8352700">.</span><span class="ident" id="8352701">Errorf</span><span class="op" id="8352707">(</span><span class="string" id="8352708">&#34;expected&nbsp;%q&nbsp;in&nbsp;%q&#34;</span><span class="op" id="8352727">,</span>&nbsp;<span class="ident" id="8352729">has</span><span class="op" id="8352732">,</span>&nbsp;<span class="ident" id="8352734">line</span><span class="op" id="8352738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352741">}</span><br>
<span class="lineno"></span><span class="op" id="8352743">}</span>
</div>
</body>
</html>
