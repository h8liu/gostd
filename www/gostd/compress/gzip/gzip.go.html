<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4244058">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4244113">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4244167">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4244218">package</span>&nbsp;<span class="ident" id="4244226">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4244232">import</span>&nbsp;<span class="op" id="4244239">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4244242">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4244260">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4244270">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4244277">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4244285">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4244299">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4244304">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4244307">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="4244387">//&nbsp;&#34;compress/gzip&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4244453">const</span>&nbsp;<span class="op" id="4244459">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244462">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244481">=</span>&nbsp;<span class="ident" id="4244483">flate</span><span class="op" id="4244488">.</span><span class="ident" id="4244489">NoCompression</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244504">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244523">=</span>&nbsp;<span class="ident" id="4244525">flate</span><span class="op" id="4244530">.</span><span class="ident" id="4244531">BestSpeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244542">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244561">=</span>&nbsp;<span class="ident" id="4244563">flate</span><span class="op" id="4244568">.</span><span class="ident" id="4244569">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244586">DefaultCompression</span>&nbsp;<span class="op" id="4244605">=</span>&nbsp;<span class="ident" id="4244607">flate</span><span class="op" id="4244612">.</span><span class="ident" id="4244613">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="4244632">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4244635">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;an&nbsp;io.WriteCloser.</span><br>
<span class="lineno"></span><span class="comment" id="4244669">//&nbsp;Writes&nbsp;to&nbsp;a&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4244724">type</span>&nbsp;<span class="ident" id="4244729">Writer</span>&nbsp;<span class="keyword" id="4244736">struct</span>&nbsp;<span class="op" id="4244743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244746">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244754">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4244766">io</span><span class="op" id="4244768">.</span><span class="ident" id="4244769">Writer</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244777">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4244789">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244794">wroteHeader</span>&nbsp;<span class="builtintype" id="4244806">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244812">compressor</span>&nbsp;&nbsp;<span class="op" id="4244824">*</span><span class="ident" id="4244825">flate</span><span class="op" id="4244830">.</span><span class="ident" id="4244831">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244839">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4244851">hash</span><span class="op" id="4244855">.</span><span class="ident" id="4244856">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244864">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4244876">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244884">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4244896">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244902">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244914">[</span><span class="num" id="4244915">10</span><span class="op" id="4244917">]</span><span class="builtintype" id="4244918">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244924">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4244936">error</span><br>
<span class="lineno"></span><span class="op" id="4244942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4244945">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4244980">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4245046">//</span><br>
<span class="lineno"></span><span class="comment" id="4245049">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="4245130">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno">45</span><span class="comment" id="4245185">//</span><br>
<span class="lineno"></span><span class="comment" id="4245188">//&nbsp;Callers&nbsp;that&nbsp;wish&nbsp;to&nbsp;set&nbsp;the&nbsp;fields&nbsp;in&nbsp;Writer.Header&nbsp;must&nbsp;do&nbsp;so&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4245262">//&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;Close.&nbsp;The&nbsp;Comment&nbsp;and&nbsp;Name&nbsp;header&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4245338">//&nbsp;UTF-8&nbsp;strings&nbsp;in&nbsp;Go,&nbsp;but&nbsp;the&nbsp;underlying&nbsp;format&nbsp;requires&nbsp;NUL-terminated&nbsp;ISO</span><br>
<span class="lineno"></span><span class="comment" id="4245416">//&nbsp;8859-1&nbsp;(Latin-1).&nbsp;NUL&nbsp;or&nbsp;non-Latin-1&nbsp;runes&nbsp;in&nbsp;those&nbsp;strings&nbsp;will&nbsp;lead&nbsp;to&nbsp;an</span><br>
<span class="lineno">50</span><span class="comment" id="4245495">//&nbsp;error&nbsp;on&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="4245514">func</span>&nbsp;<span class="ident" id="4245519">NewWriter</span><span class="op" id="4245528">(</span><span class="ident" id="4245529">w</span>&nbsp;<span class="ident" id="4245531">io</span><span class="op" id="4245533">.</span><span class="ident" id="4245534">Writer</span><span class="op" id="4245540">)</span>&nbsp;<span class="op" id="4245542">*</span><span class="ident" id="4245543">Writer</span>&nbsp;<span class="op" id="4245550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4245553">z</span><span class="op" id="4245554">,</span>&nbsp;<span class="ident" id="4245556">_</span>&nbsp;<span class="op" id="4245558">:=</span>&nbsp;<span class="ident" id="4245561">NewWriterLevel</span><span class="op" id="4245575">(</span><span class="ident" id="4245576">w</span><span class="op" id="4245577">,</span>&nbsp;<span class="ident" id="4245579">DefaultCompression</span><span class="op" id="4245597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4245600">return</span>&nbsp;<span class="ident" id="4245607">z</span><br>
<span class="lineno"></span><span class="op" id="4245609">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4245612">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4245692">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="4245727">//</span><br>
<span class="lineno"></span><span class="comment" id="4245730">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno">60</span><span class="comment" id="4245804">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4245880">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4245927">func</span>&nbsp;<span class="ident" id="4245932">NewWriterLevel</span><span class="op" id="4245946">(</span><span class="ident" id="4245947">w</span>&nbsp;<span class="ident" id="4245949">io</span><span class="op" id="4245951">.</span><span class="ident" id="4245952">Writer</span><span class="op" id="4245958">,</span>&nbsp;<span class="ident" id="4245960">level</span>&nbsp;<span class="builtintype" id="4245966">int</span><span class="op" id="4245969">)</span>&nbsp;<span class="op" id="4245971">(</span><span class="op" id="4245972">*</span><span class="ident" id="4245973">Writer</span><span class="op" id="4245979">,</span>&nbsp;<span class="builtintype" id="4245981">error</span><span class="op" id="4245986">)</span>&nbsp;<span class="op" id="4245988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4245991">if</span>&nbsp;<span class="ident" id="4245994">level</span>&nbsp;<span class="op" id="4246000">&lt;</span>&nbsp;<span class="ident" id="4246002">DefaultCompression</span>&nbsp;<span class="op" id="4246021">||</span>&nbsp;<span class="ident" id="4246024">level</span>&nbsp;<span class="op" id="4246030">&gt;</span>&nbsp;<span class="ident" id="4246032">BestCompression</span>&nbsp;<span class="op" id="4246048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4246052">return</span>&nbsp;<span class="ident" id="4246059">nil</span><span class="op" id="4246062">,</span>&nbsp;<span class="ident" id="4246064">fmt</span><span class="op" id="4246067">.</span><span class="ident" id="4246068">Errorf</span><span class="op" id="4246074">(</span><span class="string" id="4246075">&#34;gzip:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="4246112">,</span>&nbsp;<span class="ident" id="4246114">level</span><span class="op" id="4246119">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4246122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246125">z</span>&nbsp;<span class="op" id="4246127">:=</span>&nbsp;<span class="builtinfunc" id="4246130">new</span><span class="op" id="4246133">(</span><span class="ident" id="4246134">Writer</span><span class="op" id="4246140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246143">z</span><span class="op" id="4246144">.</span><span class="ident" id="4246145">init</span><span class="op" id="4246149">(</span><span class="ident" id="4246150">w</span><span class="op" id="4246151">,</span>&nbsp;<span class="ident" id="4246153">level</span><span class="op" id="4246158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4246161">return</span>&nbsp;<span class="ident" id="4246168">z</span><span class="op" id="4246169">,</span>&nbsp;<span class="ident" id="4246171">nil</span><br>
<span class="lineno"></span><span class="op" id="4246175">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4246178">func</span>&nbsp;<span class="op" id="4246183">(</span><span class="ident" id="4246184">z</span>&nbsp;<span class="op" id="4246186">*</span><span class="ident" id="4246187">Writer</span><span class="op" id="4246193">)</span>&nbsp;<span class="ident" id="4246195">init</span><span class="op" id="4246199">(</span><span class="ident" id="4246200">w</span>&nbsp;<span class="ident" id="4246202">io</span><span class="op" id="4246204">.</span><span class="ident" id="4246205">Writer</span><span class="op" id="4246211">,</span>&nbsp;<span class="ident" id="4246213">level</span>&nbsp;<span class="builtintype" id="4246219">int</span><span class="op" id="4246222">)</span>&nbsp;<span class="op" id="4246224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246227">digest</span>&nbsp;<span class="op" id="4246234">:=</span>&nbsp;<span class="ident" id="4246237">z</span><span class="op" id="4246238">.</span><span class="ident" id="4246239">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4246247">if</span>&nbsp;<span class="ident" id="4246250">digest</span>&nbsp;<span class="op" id="4246257">!=</span>&nbsp;<span class="ident" id="4246260">nil</span>&nbsp;<span class="op" id="4246264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246268">digest</span><span class="op" id="4246274">.</span><span class="ident" id="4246275">Reset</span><span class="op" id="4246280">(</span><span class="op" id="4246281">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4246284">}</span>&nbsp;<span class="keyword" id="4246286">else</span>&nbsp;<span class="op" id="4246291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246295">digest</span>&nbsp;<span class="op" id="4246302">=</span>&nbsp;<span class="ident" id="4246304">crc32</span><span class="op" id="4246309">.</span><span class="ident" id="4246310">NewIEEE</span><span class="op" id="4246317">(</span><span class="op" id="4246318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4246321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246324">compressor</span>&nbsp;<span class="op" id="4246335">:=</span>&nbsp;<span class="ident" id="4246338">z</span><span class="op" id="4246339">.</span><span class="ident" id="4246340">compressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4246352">if</span>&nbsp;<span class="ident" id="4246355">compressor</span>&nbsp;<span class="op" id="4246366">!=</span>&nbsp;<span class="ident" id="4246369">nil</span>&nbsp;<span class="op" id="4246373">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246377">compressor</span><span class="op" id="4246387">.</span><span class="ident" id="4246388">Reset</span><span class="op" id="4246393">(</span><span class="ident" id="4246394">w</span><span class="op" id="4246395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4246398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4246401">*</span><span class="ident" id="4246402">z</span>&nbsp;<span class="op" id="4246404">=</span>&nbsp;<span class="ident" id="4246406">Writer</span><span class="op" id="4246412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246416">Header</span><span class="op" id="4246422">:</span>&nbsp;<span class="ident" id="4246424">Header</span><span class="op" id="4246430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246435">OS</span><span class="op" id="4246437">:</span>&nbsp;<span class="num" id="4246439">255</span><span class="op" id="4246442">,</span>&nbsp;<span class="comment" id="4246444">//&nbsp;unknown</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4246457">}</span><span class="op" id="4246458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246462">w</span><span class="op" id="4246463">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246474">w</span><span class="op" id="4246475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246479">level</span><span class="op" id="4246484">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246491">level</span><span class="op" id="4246496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246500">digest</span><span class="op" id="4246506">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246512">digest</span><span class="op" id="4246518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246522">compressor</span><span class="op" id="4246532">:</span>&nbsp;<span class="ident" id="4246534">compressor</span><span class="op" id="4246544">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4246547">}</span><br>
<span class="lineno"></span><span class="op" id="4246549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4246552">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Writer&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4246622">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewWriter&nbsp;or&nbsp;NewWriterLevel,&nbsp;but</span><br>
<span class="lineno">95</span><span class="comment" id="4246692">//&nbsp;writing&nbsp;to&nbsp;w&nbsp;instead.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Writer&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="4246759">//&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4246784">func</span>&nbsp;<span class="op" id="4246789">(</span><span class="ident" id="4246790">z</span>&nbsp;<span class="op" id="4246792">*</span><span class="ident" id="4246793">Writer</span><span class="op" id="4246799">)</span>&nbsp;<span class="ident" id="4246801">Reset</span><span class="op" id="4246806">(</span><span class="ident" id="4246807">w</span>&nbsp;<span class="ident" id="4246809">io</span><span class="op" id="4246811">.</span><span class="ident" id="4246812">Writer</span><span class="op" id="4246818">)</span>&nbsp;<span class="op" id="4246820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246823">z</span><span class="op" id="4246824">.</span><span class="ident" id="4246825">init</span><span class="op" id="4246829">(</span><span class="ident" id="4246830">w</span><span class="op" id="4246831">,</span>&nbsp;<span class="ident" id="4246833">z</span><span class="op" id="4246834">.</span><span class="ident" id="4246835">level</span><span class="op" id="4246840">)</span><br>
<span class="lineno"></span><span class="op" id="4246842">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4246845">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4246906">func</span>&nbsp;<span class="ident" id="4246911">put2</span><span class="op" id="4246915">(</span><span class="ident" id="4246916">p</span>&nbsp;<span class="op" id="4246918">[</span><span class="op" id="4246919">]</span><span class="builtintype" id="4246920">byte</span><span class="op" id="4246924">,</span>&nbsp;<span class="ident" id="4246926">v</span>&nbsp;<span class="builtintype" id="4246928">uint16</span><span class="op" id="4246934">)</span>&nbsp;<span class="op" id="4246936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246939">p</span><span class="op" id="4246940">[</span><span class="num" id="4246941">0</span><span class="op" id="4246942">]</span>&nbsp;<span class="op" id="4246944">=</span>&nbsp;<span class="builtintype" id="4246946">uint8</span><span class="op" id="4246951">(</span><span class="ident" id="4246952">v</span>&nbsp;<span class="op" id="4246954">&gt;&gt;</span>&nbsp;<span class="num" id="4246957">0</span><span class="op" id="4246958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4246961">p</span><span class="op" id="4246962">[</span><span class="num" id="4246963">1</span><span class="op" id="4246964">]</span>&nbsp;<span class="op" id="4246966">=</span>&nbsp;<span class="builtintype" id="4246968">uint8</span><span class="op" id="4246973">(</span><span class="ident" id="4246974">v</span>&nbsp;<span class="op" id="4246976">&gt;&gt;</span>&nbsp;<span class="num" id="4246979">8</span><span class="op" id="4246980">)</span><br>
<span class="lineno">105</span><span class="op" id="4246982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4246985">func</span>&nbsp;<span class="ident" id="4246990">put4</span><span class="op" id="4246994">(</span><span class="ident" id="4246995">p</span>&nbsp;<span class="op" id="4246997">[</span><span class="op" id="4246998">]</span><span class="builtintype" id="4246999">byte</span><span class="op" id="4247003">,</span>&nbsp;<span class="ident" id="4247005">v</span>&nbsp;<span class="builtintype" id="4247007">uint32</span><span class="op" id="4247013">)</span>&nbsp;<span class="op" id="4247015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4247018">p</span><span class="op" id="4247019">[</span><span class="num" id="4247020">0</span><span class="op" id="4247021">]</span>&nbsp;<span class="op" id="4247023">=</span>&nbsp;<span class="builtintype" id="4247025">uint8</span><span class="op" id="4247030">(</span><span class="ident" id="4247031">v</span>&nbsp;<span class="op" id="4247033">&gt;&gt;</span>&nbsp;<span class="num" id="4247036">0</span><span class="op" id="4247037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4247040">p</span><span class="op" id="4247041">[</span><span class="num" id="4247042">1</span><span class="op" id="4247043">]</span>&nbsp;<span class="op" id="4247045">=</span>&nbsp;<span class="builtintype" id="4247047">uint8</span><span class="op" id="4247052">(</span><span class="ident" id="4247053">v</span>&nbsp;<span class="op" id="4247055">&gt;&gt;</span>&nbsp;<span class="num" id="4247058">8</span><span class="op" id="4247059">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4247062">p</span><span class="op" id="4247063">[</span><span class="num" id="4247064">2</span><span class="op" id="4247065">]</span>&nbsp;<span class="op" id="4247067">=</span>&nbsp;<span class="builtintype" id="4247069">uint8</span><span class="op" id="4247074">(</span><span class="ident" id="4247075">v</span>&nbsp;<span class="op" id="4247077">&gt;&gt;</span>&nbsp;<span class="num" id="4247080">16</span><span class="op" id="4247082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4247085">p</span><span class="op" id="4247086">[</span><span class="num" id="4247087">3</span><span class="op" id="4247088">]</span>&nbsp;<span class="op" id="4247090">=</span>&nbsp;<span class="builtintype" id="4247092">uint8</span><span class="op" id="4247097">(</span><span class="ident" id="4247098">v</span>&nbsp;<span class="op" id="4247100">&gt;&gt;</span>&nbsp;<span class="num" id="4247103">24</span><span class="op" id="4247105">)</span><br>
<span class="lineno"></span><span class="op" id="4247107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4247110">//&nbsp;writeBytes&nbsp;writes&nbsp;a&nbsp;length-prefixed&nbsp;byte&nbsp;slice&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno">115</span><span class="keyword" id="4247168">func</span>&nbsp;<span class="op" id="4247173">(</span><span class="ident" id="4247174">z</span>&nbsp;<span class="op" id="4247176">*</span><span class="ident" id="4247177">Writer</span><span class="op" id="4247183">)</span>&nbsp;<span class="ident" id="4247185">writeBytes</span><span class="op" id="4247195">(</span><span class="ident" id="4247196">b</span>&nbsp;<span class="op" id="4247198">[</span><span class="op" id="4247199">]</span><span class="builtintype" id="4247200">byte</span><span class="op" id="4247204">)</span>&nbsp;<span class="builtintype" id="4247206">error</span>&nbsp;<span class="op" id="4247212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4247215">if</span>&nbsp;<span class="builtinfunc" id="4247218">len</span><span class="op" id="4247221">(</span><span class="ident" id="4247222">b</span><span class="op" id="4247223">)</span>&nbsp;<span class="op" id="4247225">&gt;</span>&nbsp;<span class="num" id="4247227">0xffff</span>&nbsp;<span class="op" id="4247234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4247238">return</span>&nbsp;<span class="ident" id="4247245">errors</span><span class="op" id="4247251">.</span><span class="ident" id="4247252">New</span><span class="op" id="4247255">(</span><span class="string" id="4247256">&#34;gzip.Write:&nbsp;Extra&nbsp;data&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="4247293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4247296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4247299">put2</span><span class="op" id="4247303">(</span><span class="ident" id="4247304">z</span><span class="op" id="4247305">.</span><span class="ident" id="4247306">buf</span><span class="op" id="4247309">[</span><span class="num" id="4247310">0</span><span class="op" id="4247311">:</span><span class="num" id="4247312">2</span><span class="op" id="4247313">]</span><span class="op" id="4247314">,</span>&nbsp;<span class="builtintype" id="4247316">uint16</span><span class="op" id="4247322">(</span><span class="builtinfunc" id="4247323">len</span><span class="op" id="4247326">(</span><span class="ident" id="4247327">b</span><span class="op" id="4247328">)</span><span class="op" id="4247329">)</span><span class="op" id="4247330">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4247333">_</span><span class="op" id="4247334">,</span>&nbsp;<span class="ident" id="4247336">err</span>&nbsp;<span class="op" id="4247340">:=</span>&nbsp;<span class="ident" id="4247343">z</span><span class="op" id="4247344">.</span><span class="ident" id="4247345">w</span><span class="op" id="4247346">.</span><span class="ident" id="4247347">Write</span><span class="op" id="4247352">(</span><span class="ident" id="4247353">z</span><span class="op" id="4247354">.</span><span class="ident" id="4247355">buf</span><span class="op" id="4247358">[</span><span class="num" id="4247359">0</span><span class="op" id="4247360">:</span><span class="num" id="4247361">2</span><span class="op" id="4247362">]</span><span class="op" id="4247363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4247366">if</span>&nbsp;<span class="ident" id="4247369">err</span>&nbsp;<span class="op" id="4247373">!=</span>&nbsp;<span class="ident" id="4247376">nil</span>&nbsp;<span class="op" id="4247380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4247384">return</span>&nbsp;<span class="ident" id="4247391">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4247396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4247399">_</span><span class="op" id="4247400">,</span>&nbsp;<span class="ident" id="4247402">err</span>&nbsp;<span class="op" id="4247406">=</span>&nbsp;<span class="ident" id="4247408">z</span><span class="op" id="4247409">.</span><span class="ident" id="4247410">w</span><span class="op" id="4247411">.</span><span class="ident" id="4247412">Write</span><span class="op" id="4247417">(</span><span class="ident" id="4247418">b</span><span class="op" id="4247419">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4247422">return</span>&nbsp;<span class="ident" id="4247429">err</span><br>
<span class="lineno"></span><span class="op" id="4247433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4247436">//&nbsp;writeString&nbsp;writes&nbsp;a&nbsp;UTF-8&nbsp;string&nbsp;s&nbsp;in&nbsp;GZIP&#39;s&nbsp;format&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno"></span><span class="comment" id="4247500">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno">130</span><span class="keyword" id="4247583">func</span>&nbsp;<span class="op" id="4247588">(</span><span class="ident" id="4247589">z</span>&nbsp;<span class="op" id="4247591">*</span><span class="ident" id="4247592">Writer</span><span class="op" id="4247598">)</span>&nbsp;<span class="ident" id="4247600">writeString</span><span class="op" id="4247611">(</span><span class="ident" id="4247612">s</span>&nbsp;<span class="builtintype" id="4247614">string</span><span class="op" id="4247620">)</span>&nbsp;<span class="op" id="4247622">(</span><span class="ident" id="4247623">err</span>&nbsp;<span class="builtintype" id="4247627">error</span><span class="op" id="4247632">)</span>&nbsp;<span class="op" id="4247634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4247637">//&nbsp;GZIP&nbsp;stores&nbsp;Latin-1&nbsp;strings;&nbsp;error&nbsp;if&nbsp;non-Latin-1;&nbsp;convert&nbsp;if&nbsp;non-ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4247714">needconv</span>&nbsp;<span class="op" id="4247723">:=</span>&nbsp;<span class="builtintype" id="4247726">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4247733">for</span>&nbsp;<span class="ident" id="4247737">_</span><span class="op" id="4247738">,</span>&nbsp;<span class="ident" id="4247740">v</span>&nbsp;<span class="op" id="4247742">:=</span>&nbsp;<span class="keyword" id="4247745">range</span>&nbsp;<span class="ident" id="4247751">s</span>&nbsp;<span class="op" id="4247753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4247757">if</span>&nbsp;<span class="ident" id="4247760">v</span>&nbsp;<span class="op" id="4247762">==</span>&nbsp;<span class="num" id="4247765">0</span>&nbsp;<span class="op" id="4247767">||</span>&nbsp;<span class="ident" id="4247770">v</span>&nbsp;<span class="op" id="4247772">&gt;</span>&nbsp;<span class="num" id="4247774">0xff</span>&nbsp;<span class="op" id="4247779">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4247784">return</span>&nbsp;<span class="ident" id="4247791">errors</span><span class="op" id="4247797">.</span><span class="ident" id="4247798">New</span><span class="op" id="4247801">(</span><span class="string" id="4247802">&#34;gzip.Write:&nbsp;non-Latin-1&nbsp;header&nbsp;string&#34;</span><span class="op" id="4247841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4247845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4247849">if</span>&nbsp;<span class="ident" id="4247852">v</span>&nbsp;<span class="op" id="4247854">&gt;</span>&nbsp;<span class="num" id="4247856">0x7f</span>&nbsp;<span class="op" id="4247861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4247866">needconv</span>&nbsp;<span class="op" id="4247875">=</span>&nbsp;<span class="builtintype" id="4247877">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4247884">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4247887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4247890">if</span>&nbsp;<span class="ident" id="4247893">needconv</span>&nbsp;<span class="op" id="4247902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4247906">b</span>&nbsp;<span class="op" id="4247908">:=</span>&nbsp;<span class="builtinfunc" id="4247911">make</span><span class="op" id="4247915">(</span><span class="op" id="4247916">[</span><span class="op" id="4247917">]</span><span class="builtintype" id="4247918">byte</span><span class="op" id="4247922">,</span>&nbsp;<span class="num" id="4247924">0</span><span class="op" id="4247925">,</span>&nbsp;<span class="builtinfunc" id="4247927">len</span><span class="op" id="4247930">(</span><span class="ident" id="4247931">s</span><span class="op" id="4247932">)</span><span class="op" id="4247933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4247937">for</span>&nbsp;<span class="ident" id="4247941">_</span><span class="op" id="4247942">,</span>&nbsp;<span class="ident" id="4247944">v</span>&nbsp;<span class="op" id="4247946">:=</span>&nbsp;<span class="keyword" id="4247949">range</span>&nbsp;<span class="ident" id="4247955">s</span>&nbsp;<span class="op" id="4247957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4247962">b</span>&nbsp;<span class="op" id="4247964">=</span>&nbsp;<span class="builtinfunc" id="4247966">append</span><span class="op" id="4247972">(</span><span class="ident" id="4247973">b</span><span class="op" id="4247974">,</span>&nbsp;<span class="builtintype" id="4247976">byte</span><span class="op" id="4247980">(</span><span class="ident" id="4247981">v</span><span class="op" id="4247982">)</span><span class="op" id="4247983">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4247987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4247991">_</span><span class="op" id="4247992">,</span>&nbsp;<span class="ident" id="4247994">err</span>&nbsp;<span class="op" id="4247998">=</span>&nbsp;<span class="ident" id="4248000">z</span><span class="op" id="4248001">.</span><span class="ident" id="4248002">w</span><span class="op" id="4248003">.</span><span class="ident" id="4248004">Write</span><span class="op" id="4248009">(</span><span class="ident" id="4248010">b</span><span class="op" id="4248011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4248014">}</span>&nbsp;<span class="keyword" id="4248016">else</span>&nbsp;<span class="op" id="4248021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248025">_</span><span class="op" id="4248026">,</span>&nbsp;<span class="ident" id="4248028">err</span>&nbsp;<span class="op" id="4248032">=</span>&nbsp;<span class="ident" id="4248034">io</span><span class="op" id="4248036">.</span><span class="ident" id="4248037">WriteString</span><span class="op" id="4248048">(</span><span class="ident" id="4248049">z</span><span class="op" id="4248050">.</span><span class="ident" id="4248051">w</span><span class="op" id="4248052">,</span>&nbsp;<span class="ident" id="4248054">s</span><span class="op" id="4248055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4248058">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4248061">if</span>&nbsp;<span class="ident" id="4248064">err</span>&nbsp;<span class="op" id="4248068">!=</span>&nbsp;<span class="ident" id="4248071">nil</span>&nbsp;<span class="op" id="4248075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4248079">return</span>&nbsp;<span class="ident" id="4248086">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4248091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4248094">//&nbsp;GZIP&nbsp;strings&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248131">z</span><span class="op" id="4248132">.</span><span class="ident" id="4248133">buf</span><span class="op" id="4248136">[</span><span class="num" id="4248137">0</span><span class="op" id="4248138">]</span>&nbsp;<span class="op" id="4248140">=</span>&nbsp;<span class="num" id="4248142">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248145">_</span><span class="op" id="4248146">,</span>&nbsp;<span class="ident" id="4248148">err</span>&nbsp;<span class="op" id="4248152">=</span>&nbsp;<span class="ident" id="4248154">z</span><span class="op" id="4248155">.</span><span class="ident" id="4248156">w</span><span class="op" id="4248157">.</span><span class="ident" id="4248158">Write</span><span class="op" id="4248163">(</span><span class="ident" id="4248164">z</span><span class="op" id="4248165">.</span><span class="ident" id="4248166">buf</span><span class="op" id="4248169">[</span><span class="num" id="4248170">0</span><span class="op" id="4248171">:</span><span class="num" id="4248172">1</span><span class="op" id="4248173">]</span><span class="op" id="4248174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4248177">return</span>&nbsp;<span class="ident" id="4248184">err</span><br>
<span class="lineno"></span><span class="op" id="4248188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4248191">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno">160</span><span class="comment" id="4248263">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4248339">func</span>&nbsp;<span class="op" id="4248344">(</span><span class="ident" id="4248345">z</span>&nbsp;<span class="op" id="4248347">*</span><span class="ident" id="4248348">Writer</span><span class="op" id="4248354">)</span>&nbsp;<span class="ident" id="4248356">Write</span><span class="op" id="4248361">(</span><span class="ident" id="4248362">p</span>&nbsp;<span class="op" id="4248364">[</span><span class="op" id="4248365">]</span><span class="builtintype" id="4248366">byte</span><span class="op" id="4248370">)</span>&nbsp;<span class="op" id="4248372">(</span><span class="builtintype" id="4248373">int</span><span class="op" id="4248376">,</span>&nbsp;<span class="builtintype" id="4248378">error</span><span class="op" id="4248383">)</span>&nbsp;<span class="op" id="4248385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4248388">if</span>&nbsp;<span class="ident" id="4248391">z</span><span class="op" id="4248392">.</span><span class="ident" id="4248393">err</span>&nbsp;<span class="op" id="4248397">!=</span>&nbsp;<span class="ident" id="4248400">nil</span>&nbsp;<span class="op" id="4248404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4248408">return</span>&nbsp;<span class="num" id="4248415">0</span><span class="op" id="4248416">,</span>&nbsp;<span class="ident" id="4248418">z</span><span class="op" id="4248419">.</span><span class="ident" id="4248420">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4248425">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4248428">var</span>&nbsp;<span class="ident" id="4248432">n</span>&nbsp;<span class="builtintype" id="4248434">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4248439">//&nbsp;Write&nbsp;the&nbsp;GZIP&nbsp;header&nbsp;lazily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4248473">if</span>&nbsp;<span class="op" id="4248476">!</span><span class="ident" id="4248477">z</span><span class="op" id="4248478">.</span><span class="ident" id="4248479">wroteHeader</span>&nbsp;<span class="op" id="4248491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248495">z</span><span class="op" id="4248496">.</span><span class="ident" id="4248497">wroteHeader</span>&nbsp;<span class="op" id="4248509">=</span>&nbsp;<span class="builtintype" id="4248511">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248518">z</span><span class="op" id="4248519">.</span><span class="ident" id="4248520">buf</span><span class="op" id="4248523">[</span><span class="num" id="4248524">0</span><span class="op" id="4248525">]</span>&nbsp;<span class="op" id="4248527">=</span>&nbsp;<span class="ident" id="4248529">gzipID1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248539">z</span><span class="op" id="4248540">.</span><span class="ident" id="4248541">buf</span><span class="op" id="4248544">[</span><span class="num" id="4248545">1</span><span class="op" id="4248546">]</span>&nbsp;<span class="op" id="4248548">=</span>&nbsp;<span class="ident" id="4248550">gzipID2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248560">z</span><span class="op" id="4248561">.</span><span class="ident" id="4248562">buf</span><span class="op" id="4248565">[</span><span class="num" id="4248566">2</span><span class="op" id="4248567">]</span>&nbsp;<span class="op" id="4248569">=</span>&nbsp;<span class="ident" id="4248571">gzipDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248585">z</span><span class="op" id="4248586">.</span><span class="ident" id="4248587">buf</span><span class="op" id="4248590">[</span><span class="num" id="4248591">3</span><span class="op" id="4248592">]</span>&nbsp;<span class="op" id="4248594">=</span>&nbsp;<span class="num" id="4248596">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4248600">if</span>&nbsp;<span class="ident" id="4248603">z</span><span class="op" id="4248604">.</span><span class="ident" id="4248605">Extra</span>&nbsp;<span class="op" id="4248611">!=</span>&nbsp;<span class="ident" id="4248614">nil</span>&nbsp;<span class="op" id="4248618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248623">z</span><span class="op" id="4248624">.</span><span class="ident" id="4248625">buf</span><span class="op" id="4248628">[</span><span class="num" id="4248629">3</span><span class="op" id="4248630">]</span>&nbsp;<span class="op" id="4248632">|=</span>&nbsp;<span class="num" id="4248635">0x04</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4248642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4248646">if</span>&nbsp;<span class="ident" id="4248649">z</span><span class="op" id="4248650">.</span><span class="ident" id="4248651">Name</span>&nbsp;<span class="op" id="4248656">!=</span>&nbsp;<span class="string" id="4248659">&#34;&#34;</span>&nbsp;<span class="op" id="4248662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248667">z</span><span class="op" id="4248668">.</span><span class="ident" id="4248669">buf</span><span class="op" id="4248672">[</span><span class="num" id="4248673">3</span><span class="op" id="4248674">]</span>&nbsp;<span class="op" id="4248676">|=</span>&nbsp;<span class="num" id="4248679">0x08</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4248686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4248690">if</span>&nbsp;<span class="ident" id="4248693">z</span><span class="op" id="4248694">.</span><span class="ident" id="4248695">Comment</span>&nbsp;<span class="op" id="4248703">!=</span>&nbsp;<span class="string" id="4248706">&#34;&#34;</span>&nbsp;<span class="op" id="4248709">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248714">z</span><span class="op" id="4248715">.</span><span class="ident" id="4248716">buf</span><span class="op" id="4248719">[</span><span class="num" id="4248720">3</span><span class="op" id="4248721">]</span>&nbsp;<span class="op" id="4248723">|=</span>&nbsp;<span class="num" id="4248726">0x10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4248733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248737">put4</span><span class="op" id="4248741">(</span><span class="ident" id="4248742">z</span><span class="op" id="4248743">.</span><span class="ident" id="4248744">buf</span><span class="op" id="4248747">[</span><span class="num" id="4248748">4</span><span class="op" id="4248749">:</span><span class="num" id="4248750">8</span><span class="op" id="4248751">]</span><span class="op" id="4248752">,</span>&nbsp;<span class="builtintype" id="4248754">uint32</span><span class="op" id="4248760">(</span><span class="ident" id="4248761">z</span><span class="op" id="4248762">.</span><span class="ident" id="4248763">ModTime</span><span class="op" id="4248770">.</span><span class="ident" id="4248771">Unix</span><span class="op" id="4248775">(</span><span class="op" id="4248776">)</span><span class="op" id="4248777">)</span><span class="op" id="4248778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4248782">if</span>&nbsp;<span class="ident" id="4248785">z</span><span class="op" id="4248786">.</span><span class="ident" id="4248787">level</span>&nbsp;<span class="op" id="4248793">==</span>&nbsp;<span class="ident" id="4248796">BestCompression</span>&nbsp;<span class="op" id="4248812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248817">z</span><span class="op" id="4248818">.</span><span class="ident" id="4248819">buf</span><span class="op" id="4248822">[</span><span class="num" id="4248823">8</span><span class="op" id="4248824">]</span>&nbsp;<span class="op" id="4248826">=</span>&nbsp;<span class="num" id="4248828">2</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4248832">}</span>&nbsp;<span class="keyword" id="4248834">else</span>&nbsp;<span class="keyword" id="4248839">if</span>&nbsp;<span class="ident" id="4248842">z</span><span class="op" id="4248843">.</span><span class="ident" id="4248844">level</span>&nbsp;<span class="op" id="4248850">==</span>&nbsp;<span class="ident" id="4248853">BestSpeed</span>&nbsp;<span class="op" id="4248863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248868">z</span><span class="op" id="4248869">.</span><span class="ident" id="4248870">buf</span><span class="op" id="4248873">[</span><span class="num" id="4248874">8</span><span class="op" id="4248875">]</span>&nbsp;<span class="op" id="4248877">=</span>&nbsp;<span class="num" id="4248879">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4248883">}</span>&nbsp;<span class="keyword" id="4248885">else</span>&nbsp;<span class="op" id="4248890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248895">z</span><span class="op" id="4248896">.</span><span class="ident" id="4248897">buf</span><span class="op" id="4248900">[</span><span class="num" id="4248901">8</span><span class="op" id="4248902">]</span>&nbsp;<span class="op" id="4248904">=</span>&nbsp;<span class="num" id="4248906">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4248910">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248914">z</span><span class="op" id="4248915">.</span><span class="ident" id="4248916">buf</span><span class="op" id="4248919">[</span><span class="num" id="4248920">9</span><span class="op" id="4248921">]</span>&nbsp;<span class="op" id="4248923">=</span>&nbsp;<span class="ident" id="4248925">z</span><span class="op" id="4248926">.</span><span class="ident" id="4248927">OS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4248932">n</span><span class="op" id="4248933">,</span>&nbsp;<span class="ident" id="4248935">z</span><span class="op" id="4248936">.</span><span class="ident" id="4248937">err</span>&nbsp;<span class="op" id="4248941">=</span>&nbsp;<span class="ident" id="4248943">z</span><span class="op" id="4248944">.</span><span class="ident" id="4248945">w</span><span class="op" id="4248946">.</span><span class="ident" id="4248947">Write</span><span class="op" id="4248952">(</span><span class="ident" id="4248953">z</span><span class="op" id="4248954">.</span><span class="ident" id="4248955">buf</span><span class="op" id="4248958">[</span><span class="num" id="4248959">0</span><span class="op" id="4248960">:</span><span class="num" id="4248961">10</span><span class="op" id="4248963">]</span><span class="op" id="4248964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4248968">if</span>&nbsp;<span class="ident" id="4248971">z</span><span class="op" id="4248972">.</span><span class="ident" id="4248973">err</span>&nbsp;<span class="op" id="4248977">!=</span>&nbsp;<span class="ident" id="4248980">nil</span>&nbsp;<span class="op" id="4248984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4248989">return</span>&nbsp;<span class="ident" id="4248996">n</span><span class="op" id="4248997">,</span>&nbsp;<span class="ident" id="4248999">z</span><span class="op" id="4249000">.</span><span class="ident" id="4249001">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4249007">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249011">if</span>&nbsp;<span class="ident" id="4249014">z</span><span class="op" id="4249015">.</span><span class="ident" id="4249016">Extra</span>&nbsp;<span class="op" id="4249022">!=</span>&nbsp;<span class="ident" id="4249025">nil</span>&nbsp;<span class="op" id="4249029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4249034">z</span><span class="op" id="4249035">.</span><span class="ident" id="4249036">err</span>&nbsp;<span class="op" id="4249040">=</span>&nbsp;<span class="ident" id="4249042">z</span><span class="op" id="4249043">.</span><span class="ident" id="4249044">writeBytes</span><span class="op" id="4249054">(</span><span class="ident" id="4249055">z</span><span class="op" id="4249056">.</span><span class="ident" id="4249057">Extra</span><span class="op" id="4249062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249067">if</span>&nbsp;<span class="ident" id="4249070">z</span><span class="op" id="4249071">.</span><span class="ident" id="4249072">err</span>&nbsp;<span class="op" id="4249076">!=</span>&nbsp;<span class="ident" id="4249079">nil</span>&nbsp;<span class="op" id="4249083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249089">return</span>&nbsp;<span class="ident" id="4249096">n</span><span class="op" id="4249097">,</span>&nbsp;<span class="ident" id="4249099">z</span><span class="op" id="4249100">.</span><span class="ident" id="4249101">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4249108">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4249112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249116">if</span>&nbsp;<span class="ident" id="4249119">z</span><span class="op" id="4249120">.</span><span class="ident" id="4249121">Name</span>&nbsp;<span class="op" id="4249126">!=</span>&nbsp;<span class="string" id="4249129">&#34;&#34;</span>&nbsp;<span class="op" id="4249132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4249137">z</span><span class="op" id="4249138">.</span><span class="ident" id="4249139">err</span>&nbsp;<span class="op" id="4249143">=</span>&nbsp;<span class="ident" id="4249145">z</span><span class="op" id="4249146">.</span><span class="ident" id="4249147">writeString</span><span class="op" id="4249158">(</span><span class="ident" id="4249159">z</span><span class="op" id="4249160">.</span><span class="ident" id="4249161">Name</span><span class="op" id="4249165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249170">if</span>&nbsp;<span class="ident" id="4249173">z</span><span class="op" id="4249174">.</span><span class="ident" id="4249175">err</span>&nbsp;<span class="op" id="4249179">!=</span>&nbsp;<span class="ident" id="4249182">nil</span>&nbsp;<span class="op" id="4249186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249192">return</span>&nbsp;<span class="ident" id="4249199">n</span><span class="op" id="4249200">,</span>&nbsp;<span class="ident" id="4249202">z</span><span class="op" id="4249203">.</span><span class="ident" id="4249204">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4249211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4249215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249219">if</span>&nbsp;<span class="ident" id="4249222">z</span><span class="op" id="4249223">.</span><span class="ident" id="4249224">Comment</span>&nbsp;<span class="op" id="4249232">!=</span>&nbsp;<span class="string" id="4249235">&#34;&#34;</span>&nbsp;<span class="op" id="4249238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4249243">z</span><span class="op" id="4249244">.</span><span class="ident" id="4249245">err</span>&nbsp;<span class="op" id="4249249">=</span>&nbsp;<span class="ident" id="4249251">z</span><span class="op" id="4249252">.</span><span class="ident" id="4249253">writeString</span><span class="op" id="4249264">(</span><span class="ident" id="4249265">z</span><span class="op" id="4249266">.</span><span class="ident" id="4249267">Comment</span><span class="op" id="4249274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249279">if</span>&nbsp;<span class="ident" id="4249282">z</span><span class="op" id="4249283">.</span><span class="ident" id="4249284">err</span>&nbsp;<span class="op" id="4249288">!=</span>&nbsp;<span class="ident" id="4249291">nil</span>&nbsp;<span class="op" id="4249295">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249301">return</span>&nbsp;<span class="ident" id="4249308">n</span><span class="op" id="4249309">,</span>&nbsp;<span class="ident" id="4249311">z</span><span class="op" id="4249312">.</span><span class="ident" id="4249313">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4249320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4249324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249328">if</span>&nbsp;<span class="ident" id="4249331">z</span><span class="op" id="4249332">.</span><span class="ident" id="4249333">compressor</span>&nbsp;<span class="op" id="4249344">==</span>&nbsp;<span class="ident" id="4249347">nil</span>&nbsp;<span class="op" id="4249351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4249356">z</span><span class="op" id="4249357">.</span><span class="ident" id="4249358">compressor</span><span class="op" id="4249368">,</span>&nbsp;<span class="ident" id="4249370">_</span>&nbsp;<span class="op" id="4249372">=</span>&nbsp;<span class="ident" id="4249374">flate</span><span class="op" id="4249379">.</span><span class="ident" id="4249380">NewWriter</span><span class="op" id="4249389">(</span><span class="ident" id="4249390">z</span><span class="op" id="4249391">.</span><span class="ident" id="4249392">w</span><span class="op" id="4249393">,</span>&nbsp;<span class="ident" id="4249395">z</span><span class="op" id="4249396">.</span><span class="ident" id="4249397">level</span><span class="op" id="4249402">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4249406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4249409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4249412">z</span><span class="op" id="4249413">.</span><span class="ident" id="4249414">size</span>&nbsp;<span class="op" id="4249419">+=</span>&nbsp;<span class="builtintype" id="4249422">uint32</span><span class="op" id="4249428">(</span><span class="builtinfunc" id="4249429">len</span><span class="op" id="4249432">(</span><span class="ident" id="4249433">p</span><span class="op" id="4249434">)</span><span class="op" id="4249435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4249438">z</span><span class="op" id="4249439">.</span><span class="ident" id="4249440">digest</span><span class="op" id="4249446">.</span><span class="ident" id="4249447">Write</span><span class="op" id="4249452">(</span><span class="ident" id="4249453">p</span><span class="op" id="4249454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4249457">n</span><span class="op" id="4249458">,</span>&nbsp;<span class="ident" id="4249460">z</span><span class="op" id="4249461">.</span><span class="ident" id="4249462">err</span>&nbsp;<span class="op" id="4249466">=</span>&nbsp;<span class="ident" id="4249468">z</span><span class="op" id="4249469">.</span><span class="ident" id="4249470">compressor</span><span class="op" id="4249480">.</span><span class="ident" id="4249481">Write</span><span class="op" id="4249486">(</span><span class="ident" id="4249487">p</span><span class="op" id="4249488">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249491">return</span>&nbsp;<span class="ident" id="4249498">n</span><span class="op" id="4249499">,</span>&nbsp;<span class="ident" id="4249501">z</span><span class="op" id="4249502">.</span><span class="ident" id="4249503">err</span><br>
<span class="lineno"></span><span class="op" id="4249507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4249510">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="4249581">//</span><br>
<span class="lineno">225</span><span class="comment" id="4249584">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4249655">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.&nbsp;Flush&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="4249726">//&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.&nbsp;If&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4249791">//&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4249845">//</span><br>
<span class="lineno">230</span><span class="comment" id="4249848">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="4249928">func</span>&nbsp;<span class="op" id="4249933">(</span><span class="ident" id="4249934">z</span>&nbsp;<span class="op" id="4249936">*</span><span class="ident" id="4249937">Writer</span><span class="op" id="4249943">)</span>&nbsp;<span class="ident" id="4249945">Flush</span><span class="op" id="4249950">(</span><span class="op" id="4249951">)</span>&nbsp;<span class="builtintype" id="4249953">error</span>&nbsp;<span class="op" id="4249959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249962">if</span>&nbsp;<span class="ident" id="4249965">z</span><span class="op" id="4249966">.</span><span class="ident" id="4249967">err</span>&nbsp;<span class="op" id="4249971">!=</span>&nbsp;<span class="ident" id="4249974">nil</span>&nbsp;<span class="op" id="4249978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249982">return</span>&nbsp;<span class="ident" id="4249989">z</span><span class="op" id="4249990">.</span><span class="ident" id="4249991">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4249996">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249999">if</span>&nbsp;<span class="ident" id="4250002">z</span><span class="op" id="4250003">.</span><span class="ident" id="4250004">closed</span>&nbsp;<span class="op" id="4250011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250015">return</span>&nbsp;<span class="ident" id="4250022">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4250027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250030">if</span>&nbsp;<span class="op" id="4250033">!</span><span class="ident" id="4250034">z</span><span class="op" id="4250035">.</span><span class="ident" id="4250036">wroteHeader</span>&nbsp;<span class="op" id="4250048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250052">z</span><span class="op" id="4250053">.</span><span class="ident" id="4250054">Write</span><span class="op" id="4250059">(</span><span class="ident" id="4250060">nil</span><span class="op" id="4250063">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250067">if</span>&nbsp;<span class="ident" id="4250070">z</span><span class="op" id="4250071">.</span><span class="ident" id="4250072">err</span>&nbsp;<span class="op" id="4250076">!=</span>&nbsp;<span class="ident" id="4250079">nil</span>&nbsp;<span class="op" id="4250083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250088">return</span>&nbsp;<span class="ident" id="4250095">z</span><span class="op" id="4250096">.</span><span class="ident" id="4250097">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4250103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4250106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250109">z</span><span class="op" id="4250110">.</span><span class="ident" id="4250111">err</span>&nbsp;<span class="op" id="4250115">=</span>&nbsp;<span class="ident" id="4250117">z</span><span class="op" id="4250118">.</span><span class="ident" id="4250119">compressor</span><span class="op" id="4250129">.</span><span class="ident" id="4250130">Flush</span><span class="op" id="4250135">(</span><span class="op" id="4250136">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250139">return</span>&nbsp;<span class="ident" id="4250146">z</span><span class="op" id="4250147">.</span><span class="ident" id="4250148">err</span><br>
<span class="lineno"></span><span class="op" id="4250152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4250155">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4250229">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">250</span><span class="keyword" id="4250288">func</span>&nbsp;<span class="op" id="4250293">(</span><span class="ident" id="4250294">z</span>&nbsp;<span class="op" id="4250296">*</span><span class="ident" id="4250297">Writer</span><span class="op" id="4250303">)</span>&nbsp;<span class="ident" id="4250305">Close</span><span class="op" id="4250310">(</span><span class="op" id="4250311">)</span>&nbsp;<span class="builtintype" id="4250313">error</span>&nbsp;<span class="op" id="4250319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250322">if</span>&nbsp;<span class="ident" id="4250325">z</span><span class="op" id="4250326">.</span><span class="ident" id="4250327">err</span>&nbsp;<span class="op" id="4250331">!=</span>&nbsp;<span class="ident" id="4250334">nil</span>&nbsp;<span class="op" id="4250338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250342">return</span>&nbsp;<span class="ident" id="4250349">z</span><span class="op" id="4250350">.</span><span class="ident" id="4250351">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4250356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250359">if</span>&nbsp;<span class="ident" id="4250362">z</span><span class="op" id="4250363">.</span><span class="ident" id="4250364">closed</span>&nbsp;<span class="op" id="4250371">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250375">return</span>&nbsp;<span class="ident" id="4250382">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4250387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250390">z</span><span class="op" id="4250391">.</span><span class="ident" id="4250392">closed</span>&nbsp;<span class="op" id="4250399">=</span>&nbsp;<span class="builtintype" id="4250401">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250407">if</span>&nbsp;<span class="op" id="4250410">!</span><span class="ident" id="4250411">z</span><span class="op" id="4250412">.</span><span class="ident" id="4250413">wroteHeader</span>&nbsp;<span class="op" id="4250425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250429">z</span><span class="op" id="4250430">.</span><span class="ident" id="4250431">Write</span><span class="op" id="4250436">(</span><span class="ident" id="4250437">nil</span><span class="op" id="4250440">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250444">if</span>&nbsp;<span class="ident" id="4250447">z</span><span class="op" id="4250448">.</span><span class="ident" id="4250449">err</span>&nbsp;<span class="op" id="4250453">!=</span>&nbsp;<span class="ident" id="4250456">nil</span>&nbsp;<span class="op" id="4250460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250465">return</span>&nbsp;<span class="ident" id="4250472">z</span><span class="op" id="4250473">.</span><span class="ident" id="4250474">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4250480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4250483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250486">z</span><span class="op" id="4250487">.</span><span class="ident" id="4250488">err</span>&nbsp;<span class="op" id="4250492">=</span>&nbsp;<span class="ident" id="4250494">z</span><span class="op" id="4250495">.</span><span class="ident" id="4250496">compressor</span><span class="op" id="4250506">.</span><span class="ident" id="4250507">Close</span><span class="op" id="4250512">(</span><span class="op" id="4250513">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250516">if</span>&nbsp;<span class="ident" id="4250519">z</span><span class="op" id="4250520">.</span><span class="ident" id="4250521">err</span>&nbsp;<span class="op" id="4250525">!=</span>&nbsp;<span class="ident" id="4250528">nil</span>&nbsp;<span class="op" id="4250532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250536">return</span>&nbsp;<span class="ident" id="4250543">z</span><span class="op" id="4250544">.</span><span class="ident" id="4250545">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4250550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250553">put4</span><span class="op" id="4250557">(</span><span class="ident" id="4250558">z</span><span class="op" id="4250559">.</span><span class="ident" id="4250560">buf</span><span class="op" id="4250563">[</span><span class="num" id="4250564">0</span><span class="op" id="4250565">:</span><span class="num" id="4250566">4</span><span class="op" id="4250567">]</span><span class="op" id="4250568">,</span>&nbsp;<span class="ident" id="4250570">z</span><span class="op" id="4250571">.</span><span class="ident" id="4250572">digest</span><span class="op" id="4250578">.</span><span class="ident" id="4250579">Sum32</span><span class="op" id="4250584">(</span><span class="op" id="4250585">)</span><span class="op" id="4250586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250589">put4</span><span class="op" id="4250593">(</span><span class="ident" id="4250594">z</span><span class="op" id="4250595">.</span><span class="ident" id="4250596">buf</span><span class="op" id="4250599">[</span><span class="num" id="4250600">4</span><span class="op" id="4250601">:</span><span class="num" id="4250602">8</span><span class="op" id="4250603">]</span><span class="op" id="4250604">,</span>&nbsp;<span class="ident" id="4250606">z</span><span class="op" id="4250607">.</span><span class="ident" id="4250608">size</span><span class="op" id="4250612">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250615">_</span><span class="op" id="4250616">,</span>&nbsp;<span class="ident" id="4250618">z</span><span class="op" id="4250619">.</span><span class="ident" id="4250620">err</span>&nbsp;<span class="op" id="4250624">=</span>&nbsp;<span class="ident" id="4250626">z</span><span class="op" id="4250627">.</span><span class="ident" id="4250628">w</span><span class="op" id="4250629">.</span><span class="ident" id="4250630">Write</span><span class="op" id="4250635">(</span><span class="ident" id="4250636">z</span><span class="op" id="4250637">.</span><span class="ident" id="4250638">buf</span><span class="op" id="4250641">[</span><span class="num" id="4250642">0</span><span class="op" id="4250643">:</span><span class="num" id="4250644">8</span><span class="op" id="4250645">]</span><span class="op" id="4250646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250649">return</span>&nbsp;<span class="ident" id="4250656">z</span><span class="op" id="4250657">.</span><span class="ident" id="4250658">err</span><br>
<span class="lineno"></span><span class="op" id="4250662">}</span>
</div>
</body>
</html>
