<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html" class="current">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6706351">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6706406">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6706460">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6706511">package</span>&nbsp;<span class="ident" id="6706519">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6706527">import</span>&nbsp;<span class="op" id="6706534">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706537">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706546">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706556">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706562">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706575">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706586">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706597">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706608">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6706615">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6706618">type</span>&nbsp;<span class="ident" id="6706623">testpair</span>&nbsp;<span class="keyword" id="6706632">struct</span>&nbsp;<span class="op" id="6706639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706642">decoded</span><span class="op" id="6706649">,</span>&nbsp;<span class="ident" id="6706651">encoded</span>&nbsp;<span class="builtintype" id="6706659">string</span><br>
<span class="lineno">20</span><span class="op" id="6706666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6706669">var</span>&nbsp;<span class="ident" id="6706673">pairs</span>&nbsp;<span class="op" id="6706679">=</span>&nbsp;<span class="op" id="6706681">[</span><span class="op" id="6706682">]</span><span class="ident" id="6706683">testpair</span><span class="op" id="6706691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6706694">//&nbsp;RFC&nbsp;3548&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706716">{</span><span class="string" id="6706717">&#34;\x14\xfb\x9c\x03\xd9\x7e&#34;</span><span class="op" id="6706743">,</span>&nbsp;<span class="string" id="6706745">&#34;FPucA9l+&#34;</span><span class="op" id="6706755">}</span><span class="op" id="6706756">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706759">{</span><span class="string" id="6706760">&#34;\x14\xfb\x9c\x03\xd9&#34;</span><span class="op" id="6706782">,</span>&nbsp;<span class="string" id="6706784">&#34;FPucA9k=&#34;</span><span class="op" id="6706794">}</span><span class="op" id="6706795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706798">{</span><span class="string" id="6706799">&#34;\x14\xfb\x9c\x03&#34;</span><span class="op" id="6706817">,</span>&nbsp;<span class="string" id="6706819">&#34;FPucAw==&#34;</span><span class="op" id="6706829">}</span><span class="op" id="6706830">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6706834">//&nbsp;RFC&nbsp;4648&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706856">{</span><span class="string" id="6706857">&#34;&#34;</span><span class="op" id="6706859">,</span>&nbsp;<span class="string" id="6706861">&#34;&#34;</span><span class="op" id="6706863">}</span><span class="op" id="6706864">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706867">{</span><span class="string" id="6706868">&#34;f&#34;</span><span class="op" id="6706871">,</span>&nbsp;<span class="string" id="6706873">&#34;Zg==&#34;</span><span class="op" id="6706879">}</span><span class="op" id="6706880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706883">{</span><span class="string" id="6706884">&#34;fo&#34;</span><span class="op" id="6706888">,</span>&nbsp;<span class="string" id="6706890">&#34;Zm8=&#34;</span><span class="op" id="6706896">}</span><span class="op" id="6706897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706900">{</span><span class="string" id="6706901">&#34;foo&#34;</span><span class="op" id="6706906">,</span>&nbsp;<span class="string" id="6706908">&#34;Zm9v&#34;</span><span class="op" id="6706914">}</span><span class="op" id="6706915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706918">{</span><span class="string" id="6706919">&#34;foob&#34;</span><span class="op" id="6706925">,</span>&nbsp;<span class="string" id="6706927">&#34;Zm9vYg==&#34;</span><span class="op" id="6706937">}</span><span class="op" id="6706938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706941">{</span><span class="string" id="6706942">&#34;fooba&#34;</span><span class="op" id="6706949">,</span>&nbsp;<span class="string" id="6706951">&#34;Zm9vYmE=&#34;</span><span class="op" id="6706961">}</span><span class="op" id="6706962">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706965">{</span><span class="string" id="6706966">&#34;foobar&#34;</span><span class="op" id="6706974">,</span>&nbsp;<span class="string" id="6706976">&#34;Zm9vYmFy&#34;</span><span class="op" id="6706986">}</span><span class="op" id="6706987">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6706991">//&nbsp;Wikipedia&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707014">{</span><span class="string" id="6707015">&#34;sure.&#34;</span><span class="op" id="6707022">,</span>&nbsp;<span class="string" id="6707024">&#34;c3VyZS4=&#34;</span><span class="op" id="6707034">}</span><span class="op" id="6707035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707038">{</span><span class="string" id="6707039">&#34;sure&#34;</span><span class="op" id="6707045">,</span>&nbsp;<span class="string" id="6707047">&#34;c3VyZQ==&#34;</span><span class="op" id="6707057">}</span><span class="op" id="6707058">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707061">{</span><span class="string" id="6707062">&#34;sur&#34;</span><span class="op" id="6707067">,</span>&nbsp;<span class="string" id="6707069">&#34;c3Vy&#34;</span><span class="op" id="6707075">}</span><span class="op" id="6707076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707079">{</span><span class="string" id="6707080">&#34;su&#34;</span><span class="op" id="6707084">,</span>&nbsp;<span class="string" id="6707086">&#34;c3U=&#34;</span><span class="op" id="6707092">}</span><span class="op" id="6707093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707096">{</span><span class="string" id="6707097">&#34;leasure.&#34;</span><span class="op" id="6707107">,</span>&nbsp;<span class="string" id="6707109">&#34;bGVhc3VyZS4=&#34;</span><span class="op" id="6707123">}</span><span class="op" id="6707124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707127">{</span><span class="string" id="6707128">&#34;easure.&#34;</span><span class="op" id="6707137">,</span>&nbsp;<span class="string" id="6707139">&#34;ZWFzdXJlLg==&#34;</span><span class="op" id="6707153">}</span><span class="op" id="6707154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707157">{</span><span class="string" id="6707158">&#34;asure.&#34;</span><span class="op" id="6707166">,</span>&nbsp;<span class="string" id="6707168">&#34;YXN1cmUu&#34;</span><span class="op" id="6707178">}</span><span class="op" id="6707179">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707182">{</span><span class="string" id="6707183">&#34;sure.&#34;</span><span class="op" id="6707190">,</span>&nbsp;<span class="string" id="6707192">&#34;c3VyZS4=&#34;</span><span class="op" id="6707202">}</span><span class="op" id="6707203">,</span><br>
<span class="lineno"></span><span class="op" id="6707205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6707208">var</span>&nbsp;<span class="ident" id="6707212">bigtest</span>&nbsp;<span class="op" id="6707220">=</span>&nbsp;<span class="ident" id="6707222">testpair</span><span class="op" id="6707230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6707233">&#34;Twas&nbsp;brillig,&nbsp;and&nbsp;the&nbsp;slithy&nbsp;toves&#34;</span><span class="op" id="6707269">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6707272">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="6707322">,</span><br>
<span class="lineno"></span><span class="op" id="6707324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6707327">func</span>&nbsp;<span class="ident" id="6707332">testEqual</span><span class="op" id="6707341">(</span><span class="ident" id="6707342">t</span>&nbsp;<span class="op" id="6707344">*</span><span class="ident" id="6707345">testing</span><span class="op" id="6707352">.</span><span class="ident" id="6707353">T</span><span class="op" id="6707354">,</span>&nbsp;<span class="ident" id="6707356">msg</span>&nbsp;<span class="builtintype" id="6707360">string</span><span class="op" id="6707366">,</span>&nbsp;<span class="ident" id="6707368">args</span>&nbsp;<span class="op" id="6707373">...</span><span class="keyword" id="6707376">interface</span><span class="op" id="6707385">{</span><span class="op" id="6707386">}</span><span class="op" id="6707387">)</span>&nbsp;<span class="builtintype" id="6707389">bool</span>&nbsp;<span class="op" id="6707394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6707397">if</span>&nbsp;<span class="ident" id="6707400">args</span><span class="op" id="6707404">[</span><span class="builtinfunc" id="6707405">len</span><span class="op" id="6707408">(</span><span class="ident" id="6707409">args</span><span class="op" id="6707413">)</span><span class="op" id="6707414">-</span><span class="num" id="6707415">2</span><span class="op" id="6707416">]</span>&nbsp;<span class="op" id="6707418">!=</span>&nbsp;<span class="ident" id="6707421">args</span><span class="op" id="6707425">[</span><span class="builtinfunc" id="6707426">len</span><span class="op" id="6707429">(</span><span class="ident" id="6707430">args</span><span class="op" id="6707434">)</span><span class="op" id="6707435">-</span><span class="num" id="6707436">1</span><span class="op" id="6707437">]</span>&nbsp;<span class="op" id="6707439">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707443">t</span><span class="op" id="6707444">.</span><span class="ident" id="6707445">Errorf</span><span class="op" id="6707451">(</span><span class="ident" id="6707452">msg</span><span class="op" id="6707455">,</span>&nbsp;<span class="ident" id="6707457">args</span><span class="op" id="6707461">...</span><span class="op" id="6707464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6707468">return</span>&nbsp;<span class="builtintype" id="6707475">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6707485">return</span>&nbsp;<span class="builtintype" id="6707492">true</span><br>
<span class="lineno"></span><span class="op" id="6707497">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6707500">func</span>&nbsp;<span class="ident" id="6707505">TestEncode</span><span class="op" id="6707515">(</span><span class="ident" id="6707516">t</span>&nbsp;<span class="op" id="6707518">*</span><span class="ident" id="6707519">testing</span><span class="op" id="6707526">.</span><span class="ident" id="6707527">T</span><span class="op" id="6707528">)</span>&nbsp;<span class="op" id="6707530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6707533">for</span>&nbsp;<span class="ident" id="6707537">_</span><span class="op" id="6707538">,</span>&nbsp;<span class="ident" id="6707540">p</span>&nbsp;<span class="op" id="6707542">:=</span>&nbsp;<span class="keyword" id="6707545">range</span>&nbsp;<span class="ident" id="6707551">pairs</span>&nbsp;<span class="op" id="6707557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707561">got</span>&nbsp;<span class="op" id="6707565">:=</span>&nbsp;<span class="ident" id="6707568">StdEncoding</span><span class="op" id="6707579">.</span><span class="ident" id="6707580">EncodeToString</span><span class="op" id="6707594">(</span><span class="op" id="6707595">[</span><span class="op" id="6707596">]</span><span class="builtintype" id="6707597">byte</span><span class="op" id="6707601">(</span><span class="ident" id="6707602">p</span><span class="op" id="6707603">.</span><span class="ident" id="6707604">decoded</span><span class="op" id="6707611">)</span><span class="op" id="6707612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707616">testEqual</span><span class="op" id="6707625">(</span><span class="ident" id="6707626">t</span><span class="op" id="6707627">,</span>&nbsp;<span class="string" id="6707629">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6707655">,</span>&nbsp;<span class="ident" id="6707657">p</span><span class="op" id="6707658">.</span><span class="ident" id="6707659">decoded</span><span class="op" id="6707666">,</span>&nbsp;<span class="ident" id="6707668">got</span><span class="op" id="6707671">,</span>&nbsp;<span class="ident" id="6707673">p</span><span class="op" id="6707674">.</span><span class="ident" id="6707675">encoded</span><span class="op" id="6707682">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707685">}</span><br>
<span class="lineno"></span><span class="op" id="6707687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6707690">func</span>&nbsp;<span class="ident" id="6707695">TestEncoder</span><span class="op" id="6707706">(</span><span class="ident" id="6707707">t</span>&nbsp;<span class="op" id="6707709">*</span><span class="ident" id="6707710">testing</span><span class="op" id="6707717">.</span><span class="ident" id="6707718">T</span><span class="op" id="6707719">)</span>&nbsp;<span class="op" id="6707721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6707724">for</span>&nbsp;<span class="ident" id="6707728">_</span><span class="op" id="6707729">,</span>&nbsp;<span class="ident" id="6707731">p</span>&nbsp;<span class="op" id="6707733">:=</span>&nbsp;<span class="keyword" id="6707736">range</span>&nbsp;<span class="ident" id="6707742">pairs</span>&nbsp;<span class="op" id="6707748">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707752">bb</span>&nbsp;<span class="op" id="6707755">:=</span>&nbsp;<span class="op" id="6707758">&amp;</span><span class="ident" id="6707759">bytes</span><span class="op" id="6707764">.</span><span class="ident" id="6707765">Buffer</span><span class="op" id="6707771">{</span><span class="op" id="6707772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707776">encoder</span>&nbsp;<span class="op" id="6707784">:=</span>&nbsp;<span class="ident" id="6707787">NewEncoder</span><span class="op" id="6707797">(</span><span class="ident" id="6707798">StdEncoding</span><span class="op" id="6707809">,</span>&nbsp;<span class="ident" id="6707811">bb</span><span class="op" id="6707813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707817">encoder</span><span class="op" id="6707824">.</span><span class="ident" id="6707825">Write</span><span class="op" id="6707830">(</span><span class="op" id="6707831">[</span><span class="op" id="6707832">]</span><span class="builtintype" id="6707833">byte</span><span class="op" id="6707837">(</span><span class="ident" id="6707838">p</span><span class="op" id="6707839">.</span><span class="ident" id="6707840">decoded</span><span class="op" id="6707847">)</span><span class="op" id="6707848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707852">encoder</span><span class="op" id="6707859">.</span><span class="ident" id="6707860">Close</span><span class="op" id="6707865">(</span><span class="op" id="6707866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707870">testEqual</span><span class="op" id="6707879">(</span><span class="ident" id="6707880">t</span><span class="op" id="6707881">,</span>&nbsp;<span class="string" id="6707883">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6707909">,</span>&nbsp;<span class="ident" id="6707911">p</span><span class="op" id="6707912">.</span><span class="ident" id="6707913">decoded</span><span class="op" id="6707920">,</span>&nbsp;<span class="ident" id="6707922">bb</span><span class="op" id="6707924">.</span><span class="ident" id="6707925">String</span><span class="op" id="6707931">(</span><span class="op" id="6707932">)</span><span class="op" id="6707933">,</span>&nbsp;<span class="ident" id="6707935">p</span><span class="op" id="6707936">.</span><span class="ident" id="6707937">encoded</span><span class="op" id="6707944">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707947">}</span><br>
<span class="lineno"></span><span class="op" id="6707949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6707952">func</span>&nbsp;<span class="ident" id="6707957">TestEncoderBuffering</span><span class="op" id="6707977">(</span><span class="ident" id="6707978">t</span>&nbsp;<span class="op" id="6707980">*</span><span class="ident" id="6707981">testing</span><span class="op" id="6707988">.</span><span class="ident" id="6707989">T</span><span class="op" id="6707990">)</span>&nbsp;<span class="op" id="6707992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707995">input</span>&nbsp;<span class="op" id="6708001">:=</span>&nbsp;<span class="op" id="6708004">[</span><span class="op" id="6708005">]</span><span class="builtintype" id="6708006">byte</span><span class="op" id="6708010">(</span><span class="ident" id="6708011">bigtest</span><span class="op" id="6708018">.</span><span class="ident" id="6708019">decoded</span><span class="op" id="6708026">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708029">for</span>&nbsp;<span class="ident" id="6708033">bs</span>&nbsp;<span class="op" id="6708036">:=</span>&nbsp;<span class="num" id="6708039">1</span><span class="op" id="6708040">;</span>&nbsp;<span class="ident" id="6708042">bs</span>&nbsp;<span class="op" id="6708045">&lt;=</span>&nbsp;<span class="num" id="6708048">12</span><span class="op" id="6708050">;</span>&nbsp;<span class="ident" id="6708052">bs</span><span class="op" id="6708054">++</span>&nbsp;<span class="op" id="6708057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708061">bb</span>&nbsp;<span class="op" id="6708064">:=</span>&nbsp;<span class="op" id="6708067">&amp;</span><span class="ident" id="6708068">bytes</span><span class="op" id="6708073">.</span><span class="ident" id="6708074">Buffer</span><span class="op" id="6708080">{</span><span class="op" id="6708081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708085">encoder</span>&nbsp;<span class="op" id="6708093">:=</span>&nbsp;<span class="ident" id="6708096">NewEncoder</span><span class="op" id="6708106">(</span><span class="ident" id="6708107">StdEncoding</span><span class="op" id="6708118">,</span>&nbsp;<span class="ident" id="6708120">bb</span><span class="op" id="6708122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708126">for</span>&nbsp;<span class="ident" id="6708130">pos</span>&nbsp;<span class="op" id="6708134">:=</span>&nbsp;<span class="num" id="6708137">0</span><span class="op" id="6708138">;</span>&nbsp;<span class="ident" id="6708140">pos</span>&nbsp;<span class="op" id="6708144">&lt;</span>&nbsp;<span class="builtinfunc" id="6708146">len</span><span class="op" id="6708149">(</span><span class="ident" id="6708150">input</span><span class="op" id="6708155">)</span><span class="op" id="6708156">;</span>&nbsp;<span class="ident" id="6708158">pos</span>&nbsp;<span class="op" id="6708162">+=</span>&nbsp;<span class="ident" id="6708165">bs</span>&nbsp;<span class="op" id="6708168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708173">end</span>&nbsp;<span class="op" id="6708177">:=</span>&nbsp;<span class="ident" id="6708180">pos</span>&nbsp;<span class="op" id="6708184">+</span>&nbsp;<span class="ident" id="6708186">bs</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708192">if</span>&nbsp;<span class="ident" id="6708195">end</span>&nbsp;<span class="op" id="6708199">&gt;</span>&nbsp;<span class="builtinfunc" id="6708201">len</span><span class="op" id="6708204">(</span><span class="ident" id="6708205">input</span><span class="op" id="6708210">)</span>&nbsp;<span class="op" id="6708212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708218">end</span>&nbsp;<span class="op" id="6708222">=</span>&nbsp;<span class="builtinfunc" id="6708224">len</span><span class="op" id="6708227">(</span><span class="ident" id="6708228">input</span><span class="op" id="6708233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708243">n</span><span class="op" id="6708244">,</span>&nbsp;<span class="ident" id="6708246">err</span>&nbsp;<span class="op" id="6708250">:=</span>&nbsp;<span class="ident" id="6708253">encoder</span><span class="op" id="6708260">.</span><span class="ident" id="6708261">Write</span><span class="op" id="6708266">(</span><span class="ident" id="6708267">input</span><span class="op" id="6708272">[</span><span class="ident" id="6708273">pos</span><span class="op" id="6708276">:</span><span class="ident" id="6708277">end</span><span class="op" id="6708280">]</span><span class="op" id="6708281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708286">testEqual</span><span class="op" id="6708295">(</span><span class="ident" id="6708296">t</span><span class="op" id="6708297">,</span>&nbsp;<span class="string" id="6708299">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6708333">,</span>&nbsp;<span class="ident" id="6708335">input</span><span class="op" id="6708340">[</span><span class="ident" id="6708341">pos</span><span class="op" id="6708344">:</span><span class="ident" id="6708345">end</span><span class="op" id="6708348">]</span><span class="op" id="6708349">,</span>&nbsp;<span class="ident" id="6708351">err</span><span class="op" id="6708354">,</span>&nbsp;<span class="builtintype" id="6708356">error</span><span class="op" id="6708361">(</span><span class="ident" id="6708362">nil</span><span class="op" id="6708365">)</span><span class="op" id="6708366">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708371">testEqual</span><span class="op" id="6708380">(</span><span class="ident" id="6708381">t</span><span class="op" id="6708382">,</span>&nbsp;<span class="string" id="6708384">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6708419">,</span>&nbsp;<span class="ident" id="6708421">input</span><span class="op" id="6708426">[</span><span class="ident" id="6708427">pos</span><span class="op" id="6708430">:</span><span class="ident" id="6708431">end</span><span class="op" id="6708434">]</span><span class="op" id="6708435">,</span>&nbsp;<span class="ident" id="6708437">n</span><span class="op" id="6708438">,</span>&nbsp;<span class="ident" id="6708440">end</span><span class="op" id="6708443">-</span><span class="ident" id="6708444">pos</span><span class="op" id="6708447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708455">err</span>&nbsp;<span class="op" id="6708459">:=</span>&nbsp;<span class="ident" id="6708462">encoder</span><span class="op" id="6708469">.</span><span class="ident" id="6708470">Close</span><span class="op" id="6708475">(</span><span class="op" id="6708476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708480">testEqual</span><span class="op" id="6708489">(</span><span class="ident" id="6708490">t</span><span class="op" id="6708491">,</span>&nbsp;<span class="string" id="6708493">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6708523">,</span>&nbsp;<span class="ident" id="6708525">err</span><span class="op" id="6708528">,</span>&nbsp;<span class="builtintype" id="6708530">error</span><span class="op" id="6708535">(</span><span class="ident" id="6708536">nil</span><span class="op" id="6708539">)</span><span class="op" id="6708540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708544">testEqual</span><span class="op" id="6708553">(</span><span class="ident" id="6708554">t</span><span class="op" id="6708555">,</span>&nbsp;<span class="string" id="6708557">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6708590">,</span>&nbsp;<span class="ident" id="6708592">bs</span><span class="op" id="6708594">,</span>&nbsp;<span class="ident" id="6708596">bigtest</span><span class="op" id="6708603">.</span><span class="ident" id="6708604">decoded</span><span class="op" id="6708611">,</span>&nbsp;<span class="ident" id="6708613">bb</span><span class="op" id="6708615">.</span><span class="ident" id="6708616">String</span><span class="op" id="6708622">(</span><span class="op" id="6708623">)</span><span class="op" id="6708624">,</span>&nbsp;<span class="ident" id="6708626">bigtest</span><span class="op" id="6708633">.</span><span class="ident" id="6708634">encoded</span><span class="op" id="6708641">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708644">}</span><br>
<span class="lineno"></span><span class="op" id="6708646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6708649">func</span>&nbsp;<span class="ident" id="6708654">TestDecode</span><span class="op" id="6708664">(</span><span class="ident" id="6708665">t</span>&nbsp;<span class="op" id="6708667">*</span><span class="ident" id="6708668">testing</span><span class="op" id="6708675">.</span><span class="ident" id="6708676">T</span><span class="op" id="6708677">)</span>&nbsp;<span class="op" id="6708679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708682">for</span>&nbsp;<span class="ident" id="6708686">_</span><span class="op" id="6708687">,</span>&nbsp;<span class="ident" id="6708689">p</span>&nbsp;<span class="op" id="6708691">:=</span>&nbsp;<span class="keyword" id="6708694">range</span>&nbsp;<span class="ident" id="6708700">pairs</span>&nbsp;<span class="op" id="6708706">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708710">dbuf</span>&nbsp;<span class="op" id="6708715">:=</span>&nbsp;<span class="builtinfunc" id="6708718">make</span><span class="op" id="6708722">(</span><span class="op" id="6708723">[</span><span class="op" id="6708724">]</span><span class="builtintype" id="6708725">byte</span><span class="op" id="6708729">,</span>&nbsp;<span class="ident" id="6708731">StdEncoding</span><span class="op" id="6708742">.</span><span class="ident" id="6708743">DecodedLen</span><span class="op" id="6708753">(</span><span class="builtinfunc" id="6708754">len</span><span class="op" id="6708757">(</span><span class="ident" id="6708758">p</span><span class="op" id="6708759">.</span><span class="ident" id="6708760">encoded</span><span class="op" id="6708767">)</span><span class="op" id="6708768">)</span><span class="op" id="6708769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708773">count</span><span class="op" id="6708778">,</span>&nbsp;<span class="ident" id="6708780">end</span><span class="op" id="6708783">,</span>&nbsp;<span class="ident" id="6708785">err</span>&nbsp;<span class="op" id="6708789">:=</span>&nbsp;<span class="ident" id="6708792">StdEncoding</span><span class="op" id="6708803">.</span><span class="ident" id="6708804">decode</span><span class="op" id="6708810">(</span><span class="ident" id="6708811">dbuf</span><span class="op" id="6708815">,</span>&nbsp;<span class="op" id="6708817">[</span><span class="op" id="6708818">]</span><span class="builtintype" id="6708819">byte</span><span class="op" id="6708823">(</span><span class="ident" id="6708824">p</span><span class="op" id="6708825">.</span><span class="ident" id="6708826">encoded</span><span class="op" id="6708833">)</span><span class="op" id="6708834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708838">testEqual</span><span class="op" id="6708847">(</span><span class="ident" id="6708848">t</span><span class="op" id="6708849">,</span>&nbsp;<span class="string" id="6708851">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6708883">,</span>&nbsp;<span class="ident" id="6708885">p</span><span class="op" id="6708886">.</span><span class="ident" id="6708887">encoded</span><span class="op" id="6708894">,</span>&nbsp;<span class="ident" id="6708896">err</span><span class="op" id="6708899">,</span>&nbsp;<span class="builtintype" id="6708901">error</span><span class="op" id="6708906">(</span><span class="ident" id="6708907">nil</span><span class="op" id="6708910">)</span><span class="op" id="6708911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708915">testEqual</span><span class="op" id="6708924">(</span><span class="ident" id="6708925">t</span><span class="op" id="6708926">,</span>&nbsp;<span class="string" id="6708928">&#34;Decode(%q)&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6708961">,</span>&nbsp;<span class="ident" id="6708963">p</span><span class="op" id="6708964">.</span><span class="ident" id="6708965">encoded</span><span class="op" id="6708972">,</span>&nbsp;<span class="ident" id="6708974">count</span><span class="op" id="6708979">,</span>&nbsp;<span class="builtinfunc" id="6708981">len</span><span class="op" id="6708984">(</span><span class="ident" id="6708985">p</span><span class="op" id="6708986">.</span><span class="ident" id="6708987">decoded</span><span class="op" id="6708994">)</span><span class="op" id="6708995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708999">if</span>&nbsp;<span class="builtinfunc" id="6709002">len</span><span class="op" id="6709005">(</span><span class="ident" id="6709006">p</span><span class="op" id="6709007">.</span><span class="ident" id="6709008">encoded</span><span class="op" id="6709015">)</span>&nbsp;<span class="op" id="6709017">&gt;</span>&nbsp;<span class="num" id="6709019">0</span>&nbsp;<span class="op" id="6709021">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709026">testEqual</span><span class="op" id="6709035">(</span><span class="ident" id="6709036">t</span><span class="op" id="6709037">,</span>&nbsp;<span class="string" id="6709039">&#34;Decode(%q)&nbsp;=&nbsp;end&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6709069">,</span>&nbsp;<span class="ident" id="6709071">p</span><span class="op" id="6709072">.</span><span class="ident" id="6709073">encoded</span><span class="op" id="6709080">,</span>&nbsp;<span class="ident" id="6709082">end</span><span class="op" id="6709085">,</span>&nbsp;<span class="op" id="6709087">(</span><span class="ident" id="6709088">p</span><span class="op" id="6709089">.</span><span class="ident" id="6709090">encoded</span><span class="op" id="6709097">[</span><span class="builtinfunc" id="6709098">len</span><span class="op" id="6709101">(</span><span class="ident" id="6709102">p</span><span class="op" id="6709103">.</span><span class="ident" id="6709104">encoded</span><span class="op" id="6709111">)</span><span class="op" id="6709112">-</span><span class="num" id="6709113">1</span><span class="op" id="6709114">]</span>&nbsp;<span class="op" id="6709116">==</span>&nbsp;<span class="string" id="6709119">&#39;=&#39;</span><span class="op" id="6709122">)</span><span class="op" id="6709123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6709127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709131">testEqual</span><span class="op" id="6709140">(</span><span class="ident" id="6709141">t</span><span class="op" id="6709142">,</span>&nbsp;<span class="string" id="6709144">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6709170">,</span>&nbsp;<span class="ident" id="6709172">p</span><span class="op" id="6709173">.</span><span class="ident" id="6709174">encoded</span><span class="op" id="6709181">,</span>&nbsp;<span class="builtintype" id="6709183">string</span><span class="op" id="6709189">(</span><span class="ident" id="6709190">dbuf</span><span class="op" id="6709194">[</span><span class="num" id="6709195">0</span><span class="op" id="6709196">:</span><span class="ident" id="6709197">count</span><span class="op" id="6709202">]</span><span class="op" id="6709203">)</span><span class="op" id="6709204">,</span>&nbsp;<span class="ident" id="6709206">p</span><span class="op" id="6709207">.</span><span class="ident" id="6709208">decoded</span><span class="op" id="6709215">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709220">dbuf</span><span class="op" id="6709224">,</span>&nbsp;<span class="ident" id="6709226">err</span>&nbsp;<span class="op" id="6709230">=</span>&nbsp;<span class="ident" id="6709232">StdEncoding</span><span class="op" id="6709243">.</span><span class="ident" id="6709244">DecodeString</span><span class="op" id="6709256">(</span><span class="ident" id="6709257">p</span><span class="op" id="6709258">.</span><span class="ident" id="6709259">encoded</span><span class="op" id="6709266">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709270">testEqual</span><span class="op" id="6709279">(</span><span class="ident" id="6709280">t</span><span class="op" id="6709281">,</span>&nbsp;<span class="string" id="6709283">&#34;DecodeString(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6709321">,</span>&nbsp;<span class="ident" id="6709323">p</span><span class="op" id="6709324">.</span><span class="ident" id="6709325">encoded</span><span class="op" id="6709332">,</span>&nbsp;<span class="ident" id="6709334">err</span><span class="op" id="6709337">,</span>&nbsp;<span class="builtintype" id="6709339">error</span><span class="op" id="6709344">(</span><span class="ident" id="6709345">nil</span><span class="op" id="6709348">)</span><span class="op" id="6709349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709353">testEqual</span><span class="op" id="6709362">(</span><span class="ident" id="6709363">t</span><span class="op" id="6709364">,</span>&nbsp;<span class="string" id="6709366">&#34;DecodeString(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6709398">,</span>&nbsp;<span class="builtintype" id="6709400">string</span><span class="op" id="6709406">(</span><span class="ident" id="6709407">dbuf</span><span class="op" id="6709411">)</span><span class="op" id="6709412">,</span>&nbsp;<span class="ident" id="6709414">p</span><span class="op" id="6709415">.</span><span class="ident" id="6709416">decoded</span><span class="op" id="6709423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6709426">}</span><br>
<span class="lineno"></span><span class="op" id="6709428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="6709431">func</span>&nbsp;<span class="ident" id="6709436">TestDecoder</span><span class="op" id="6709447">(</span><span class="ident" id="6709448">t</span>&nbsp;<span class="op" id="6709450">*</span><span class="ident" id="6709451">testing</span><span class="op" id="6709458">.</span><span class="ident" id="6709459">T</span><span class="op" id="6709460">)</span>&nbsp;<span class="op" id="6709462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6709465">for</span>&nbsp;<span class="ident" id="6709469">_</span><span class="op" id="6709470">,</span>&nbsp;<span class="ident" id="6709472">p</span>&nbsp;<span class="op" id="6709474">:=</span>&nbsp;<span class="keyword" id="6709477">range</span>&nbsp;<span class="ident" id="6709483">pairs</span>&nbsp;<span class="op" id="6709489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709493">decoder</span>&nbsp;<span class="op" id="6709501">:=</span>&nbsp;<span class="ident" id="6709504">NewDecoder</span><span class="op" id="6709514">(</span><span class="ident" id="6709515">StdEncoding</span><span class="op" id="6709526">,</span>&nbsp;<span class="ident" id="6709528">strings</span><span class="op" id="6709535">.</span><span class="ident" id="6709536">NewReader</span><span class="op" id="6709545">(</span><span class="ident" id="6709546">p</span><span class="op" id="6709547">.</span><span class="ident" id="6709548">encoded</span><span class="op" id="6709555">)</span><span class="op" id="6709556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709560">dbuf</span>&nbsp;<span class="op" id="6709565">:=</span>&nbsp;<span class="builtinfunc" id="6709568">make</span><span class="op" id="6709572">(</span><span class="op" id="6709573">[</span><span class="op" id="6709574">]</span><span class="builtintype" id="6709575">byte</span><span class="op" id="6709579">,</span>&nbsp;<span class="ident" id="6709581">StdEncoding</span><span class="op" id="6709592">.</span><span class="ident" id="6709593">DecodedLen</span><span class="op" id="6709603">(</span><span class="builtinfunc" id="6709604">len</span><span class="op" id="6709607">(</span><span class="ident" id="6709608">p</span><span class="op" id="6709609">.</span><span class="ident" id="6709610">encoded</span><span class="op" id="6709617">)</span><span class="op" id="6709618">)</span><span class="op" id="6709619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709623">count</span><span class="op" id="6709628">,</span>&nbsp;<span class="ident" id="6709630">err</span>&nbsp;<span class="op" id="6709634">:=</span>&nbsp;<span class="ident" id="6709637">decoder</span><span class="op" id="6709644">.</span><span class="ident" id="6709645">Read</span><span class="op" id="6709649">(</span><span class="ident" id="6709650">dbuf</span><span class="op" id="6709654">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6709658">if</span>&nbsp;<span class="ident" id="6709661">err</span>&nbsp;<span class="op" id="6709665">!=</span>&nbsp;<span class="ident" id="6709668">nil</span>&nbsp;<span class="op" id="6709672">&amp;&amp;</span>&nbsp;<span class="ident" id="6709675">err</span>&nbsp;<span class="op" id="6709679">!=</span>&nbsp;<span class="ident" id="6709682">io</span><span class="op" id="6709684">.</span><span class="ident" id="6709685">EOF</span>&nbsp;<span class="op" id="6709689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709694">t</span><span class="op" id="6709695">.</span><span class="ident" id="6709696">Fatal</span><span class="op" id="6709701">(</span><span class="string" id="6709702">&#34;Read&nbsp;failed&#34;</span><span class="op" id="6709715">,</span>&nbsp;<span class="ident" id="6709717">err</span><span class="op" id="6709720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6709724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709728">testEqual</span><span class="op" id="6709737">(</span><span class="ident" id="6709738">t</span><span class="op" id="6709739">,</span>&nbsp;<span class="string" id="6709741">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6709776">,</span>&nbsp;<span class="ident" id="6709778">p</span><span class="op" id="6709779">.</span><span class="ident" id="6709780">encoded</span><span class="op" id="6709787">,</span>&nbsp;<span class="ident" id="6709789">count</span><span class="op" id="6709794">,</span>&nbsp;<span class="builtinfunc" id="6709796">len</span><span class="op" id="6709799">(</span><span class="ident" id="6709800">p</span><span class="op" id="6709801">.</span><span class="ident" id="6709802">decoded</span><span class="op" id="6709809">)</span><span class="op" id="6709810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709814">testEqual</span><span class="op" id="6709823">(</span><span class="ident" id="6709824">t</span><span class="op" id="6709825">,</span>&nbsp;<span class="string" id="6709827">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6709857">,</span>&nbsp;<span class="ident" id="6709859">p</span><span class="op" id="6709860">.</span><span class="ident" id="6709861">encoded</span><span class="op" id="6709868">,</span>&nbsp;<span class="builtintype" id="6709870">string</span><span class="op" id="6709876">(</span><span class="ident" id="6709877">dbuf</span><span class="op" id="6709881">[</span><span class="num" id="6709882">0</span><span class="op" id="6709883">:</span><span class="ident" id="6709884">count</span><span class="op" id="6709889">]</span><span class="op" id="6709890">)</span><span class="op" id="6709891">,</span>&nbsp;<span class="ident" id="6709893">p</span><span class="op" id="6709894">.</span><span class="ident" id="6709895">decoded</span><span class="op" id="6709902">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6709906">if</span>&nbsp;<span class="ident" id="6709909">err</span>&nbsp;<span class="op" id="6709913">!=</span>&nbsp;<span class="ident" id="6709916">io</span><span class="op" id="6709918">.</span><span class="ident" id="6709919">EOF</span>&nbsp;<span class="op" id="6709923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709928">count</span><span class="op" id="6709933">,</span>&nbsp;<span class="ident" id="6709935">err</span>&nbsp;<span class="op" id="6709939">=</span>&nbsp;<span class="ident" id="6709941">decoder</span><span class="op" id="6709948">.</span><span class="ident" id="6709949">Read</span><span class="op" id="6709953">(</span><span class="ident" id="6709954">dbuf</span><span class="op" id="6709958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6709962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709966">testEqual</span><span class="op" id="6709975">(</span><span class="ident" id="6709976">t</span><span class="op" id="6709977">,</span>&nbsp;<span class="string" id="6709979">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6710007">,</span>&nbsp;<span class="ident" id="6710009">p</span><span class="op" id="6710010">.</span><span class="ident" id="6710011">encoded</span><span class="op" id="6710018">,</span>&nbsp;<span class="ident" id="6710020">err</span><span class="op" id="6710023">,</span>&nbsp;<span class="ident" id="6710025">io</span><span class="op" id="6710027">.</span><span class="ident" id="6710028">EOF</span><span class="op" id="6710031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710034">}</span><br>
<span class="lineno">130</span><span class="op" id="6710036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6710039">func</span>&nbsp;<span class="ident" id="6710044">TestDecoderBuffering</span><span class="op" id="6710064">(</span><span class="ident" id="6710065">t</span>&nbsp;<span class="op" id="6710067">*</span><span class="ident" id="6710068">testing</span><span class="op" id="6710075">.</span><span class="ident" id="6710076">T</span><span class="op" id="6710077">)</span>&nbsp;<span class="op" id="6710079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6710082">for</span>&nbsp;<span class="ident" id="6710086">bs</span>&nbsp;<span class="op" id="6710089">:=</span>&nbsp;<span class="num" id="6710092">1</span><span class="op" id="6710093">;</span>&nbsp;<span class="ident" id="6710095">bs</span>&nbsp;<span class="op" id="6710098">&lt;=</span>&nbsp;<span class="num" id="6710101">12</span><span class="op" id="6710103">;</span>&nbsp;<span class="ident" id="6710105">bs</span><span class="op" id="6710107">++</span>&nbsp;<span class="op" id="6710110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710114">decoder</span>&nbsp;<span class="op" id="6710122">:=</span>&nbsp;<span class="ident" id="6710125">NewDecoder</span><span class="op" id="6710135">(</span><span class="ident" id="6710136">StdEncoding</span><span class="op" id="6710147">,</span>&nbsp;<span class="ident" id="6710149">strings</span><span class="op" id="6710156">.</span><span class="ident" id="6710157">NewReader</span><span class="op" id="6710166">(</span><span class="ident" id="6710167">bigtest</span><span class="op" id="6710174">.</span><span class="ident" id="6710175">encoded</span><span class="op" id="6710182">)</span><span class="op" id="6710183">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710187">buf</span>&nbsp;<span class="op" id="6710191">:=</span>&nbsp;<span class="builtinfunc" id="6710194">make</span><span class="op" id="6710198">(</span><span class="op" id="6710199">[</span><span class="op" id="6710200">]</span><span class="builtintype" id="6710201">byte</span><span class="op" id="6710205">,</span>&nbsp;<span class="builtinfunc" id="6710207">len</span><span class="op" id="6710210">(</span><span class="ident" id="6710211">bigtest</span><span class="op" id="6710218">.</span><span class="ident" id="6710219">decoded</span><span class="op" id="6710226">)</span><span class="op" id="6710227">+</span><span class="num" id="6710228">12</span><span class="op" id="6710230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6710234">var</span>&nbsp;<span class="ident" id="6710238">total</span>&nbsp;<span class="builtintype" id="6710244">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6710250">for</span>&nbsp;<span class="ident" id="6710254">total</span>&nbsp;<span class="op" id="6710260">=</span>&nbsp;<span class="num" id="6710262">0</span><span class="op" id="6710263">;</span>&nbsp;<span class="ident" id="6710265">total</span>&nbsp;<span class="op" id="6710271">&lt;</span>&nbsp;<span class="builtinfunc" id="6710273">len</span><span class="op" id="6710276">(</span><span class="ident" id="6710277">bigtest</span><span class="op" id="6710284">.</span><span class="ident" id="6710285">decoded</span><span class="op" id="6710292">)</span><span class="op" id="6710293">;</span>&nbsp;<span class="op" id="6710295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710300">n</span><span class="op" id="6710301">,</span>&nbsp;<span class="ident" id="6710303">err</span>&nbsp;<span class="op" id="6710307">:=</span>&nbsp;<span class="ident" id="6710310">decoder</span><span class="op" id="6710317">.</span><span class="ident" id="6710318">Read</span><span class="op" id="6710322">(</span><span class="ident" id="6710323">buf</span><span class="op" id="6710326">[</span><span class="ident" id="6710327">total</span>&nbsp;<span class="op" id="6710333">:</span>&nbsp;<span class="ident" id="6710335">total</span><span class="op" id="6710340">+</span><span class="ident" id="6710341">bs</span><span class="op" id="6710343">]</span><span class="op" id="6710344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710349">testEqual</span><span class="op" id="6710358">(</span><span class="ident" id="6710359">t</span><span class="op" id="6710360">,</span>&nbsp;<span class="string" id="6710362">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="6710407">,</span>&nbsp;<span class="ident" id="6710409">bigtest</span><span class="op" id="6710416">.</span><span class="ident" id="6710417">encoded</span><span class="op" id="6710424">,</span>&nbsp;<span class="ident" id="6710426">total</span><span class="op" id="6710431">,</span>&nbsp;<span class="ident" id="6710433">n</span><span class="op" id="6710434">,</span>&nbsp;<span class="ident" id="6710436">err</span><span class="op" id="6710439">,</span>&nbsp;<span class="builtintype" id="6710441">error</span><span class="op" id="6710446">(</span><span class="ident" id="6710447">nil</span><span class="op" id="6710450">)</span><span class="op" id="6710451">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710456">total</span>&nbsp;<span class="op" id="6710462">+=</span>&nbsp;<span class="ident" id="6710465">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710473">testEqual</span><span class="op" id="6710482">(</span><span class="ident" id="6710483">t</span><span class="op" id="6710484">,</span>&nbsp;<span class="string" id="6710486">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6710519">,</span>&nbsp;<span class="ident" id="6710521">bs</span><span class="op" id="6710523">,</span>&nbsp;<span class="ident" id="6710525">bigtest</span><span class="op" id="6710532">.</span><span class="ident" id="6710533">encoded</span><span class="op" id="6710540">,</span>&nbsp;<span class="builtintype" id="6710542">string</span><span class="op" id="6710548">(</span><span class="ident" id="6710549">buf</span><span class="op" id="6710552">[</span><span class="num" id="6710553">0</span><span class="op" id="6710554">:</span><span class="ident" id="6710555">total</span><span class="op" id="6710560">]</span><span class="op" id="6710561">)</span><span class="op" id="6710562">,</span>&nbsp;<span class="ident" id="6710564">bigtest</span><span class="op" id="6710571">.</span><span class="ident" id="6710572">decoded</span><span class="op" id="6710579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710582">}</span><br>
<span class="lineno"></span><span class="op" id="6710584">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="6710587">func</span>&nbsp;<span class="ident" id="6710592">TestDecodeCorrupt</span><span class="op" id="6710609">(</span><span class="ident" id="6710610">t</span>&nbsp;<span class="op" id="6710612">*</span><span class="ident" id="6710613">testing</span><span class="op" id="6710620">.</span><span class="ident" id="6710621">T</span><span class="op" id="6710622">)</span>&nbsp;<span class="op" id="6710624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710627">testCases</span>&nbsp;<span class="op" id="6710637">:=</span>&nbsp;<span class="op" id="6710640">[</span><span class="op" id="6710641">]</span><span class="keyword" id="6710642">struct</span>&nbsp;<span class="op" id="6710649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710653">input</span>&nbsp;&nbsp;<span class="builtintype" id="6710660">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710669">offset</span>&nbsp;<span class="builtintype" id="6710676">int</span>&nbsp;<span class="comment" id="6710680">//&nbsp;-1&nbsp;means&nbsp;no&nbsp;corruption.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710708">}</span><span class="op" id="6710709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710713">{</span><span class="string" id="6710714">&#34;&#34;</span><span class="op" id="6710716">,</span>&nbsp;<span class="op" id="6710718">-</span><span class="num" id="6710719">1</span><span class="op" id="6710720">}</span><span class="op" id="6710721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710725">{</span><span class="string" id="6710726">&#34;!!!!&#34;</span><span class="op" id="6710732">,</span>&nbsp;<span class="num" id="6710734">0</span><span class="op" id="6710735">}</span><span class="op" id="6710736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710740">{</span><span class="string" id="6710741">&#34;====&#34;</span><span class="op" id="6710747">,</span>&nbsp;<span class="num" id="6710749">0</span><span class="op" id="6710750">}</span><span class="op" id="6710751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710755">{</span><span class="string" id="6710756">&#34;x===&#34;</span><span class="op" id="6710762">,</span>&nbsp;<span class="num" id="6710764">1</span><span class="op" id="6710765">}</span><span class="op" id="6710766">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710770">{</span><span class="string" id="6710771">&#34;=AAA&#34;</span><span class="op" id="6710777">,</span>&nbsp;<span class="num" id="6710779">0</span><span class="op" id="6710780">}</span><span class="op" id="6710781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710785">{</span><span class="string" id="6710786">&#34;A=AA&#34;</span><span class="op" id="6710792">,</span>&nbsp;<span class="num" id="6710794">1</span><span class="op" id="6710795">}</span><span class="op" id="6710796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710800">{</span><span class="string" id="6710801">&#34;AA=A&#34;</span><span class="op" id="6710807">,</span>&nbsp;<span class="num" id="6710809">2</span><span class="op" id="6710810">}</span><span class="op" id="6710811">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710815">{</span><span class="string" id="6710816">&#34;AA==A&#34;</span><span class="op" id="6710823">,</span>&nbsp;<span class="num" id="6710825">4</span><span class="op" id="6710826">}</span><span class="op" id="6710827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710831">{</span><span class="string" id="6710832">&#34;AAA=AAAA&#34;</span><span class="op" id="6710842">,</span>&nbsp;<span class="num" id="6710844">4</span><span class="op" id="6710845">}</span><span class="op" id="6710846">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710850">{</span><span class="string" id="6710851">&#34;AAAAA&#34;</span><span class="op" id="6710858">,</span>&nbsp;<span class="num" id="6710860">4</span><span class="op" id="6710861">}</span><span class="op" id="6710862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710866">{</span><span class="string" id="6710867">&#34;AAAAAA&#34;</span><span class="op" id="6710875">,</span>&nbsp;<span class="num" id="6710877">4</span><span class="op" id="6710878">}</span><span class="op" id="6710879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710883">{</span><span class="string" id="6710884">&#34;A=&#34;</span><span class="op" id="6710888">,</span>&nbsp;<span class="num" id="6710890">1</span><span class="op" id="6710891">}</span><span class="op" id="6710892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710896">{</span><span class="string" id="6710897">&#34;A==&#34;</span><span class="op" id="6710902">,</span>&nbsp;<span class="num" id="6710904">1</span><span class="op" id="6710905">}</span><span class="op" id="6710906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710910">{</span><span class="string" id="6710911">&#34;AA=&#34;</span><span class="op" id="6710916">,</span>&nbsp;<span class="num" id="6710918">3</span><span class="op" id="6710919">}</span><span class="op" id="6710920">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710924">{</span><span class="string" id="6710925">&#34;AA==&#34;</span><span class="op" id="6710931">,</span>&nbsp;<span class="op" id="6710933">-</span><span class="num" id="6710934">1</span><span class="op" id="6710935">}</span><span class="op" id="6710936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710940">{</span><span class="string" id="6710941">&#34;AAA=&#34;</span><span class="op" id="6710947">,</span>&nbsp;<span class="op" id="6710949">-</span><span class="num" id="6710950">1</span><span class="op" id="6710951">}</span><span class="op" id="6710952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710956">{</span><span class="string" id="6710957">&#34;AAAA&#34;</span><span class="op" id="6710963">,</span>&nbsp;<span class="op" id="6710965">-</span><span class="num" id="6710966">1</span><span class="op" id="6710967">}</span><span class="op" id="6710968">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710972">{</span><span class="string" id="6710973">&#34;AAAAAA=&#34;</span><span class="op" id="6710982">,</span>&nbsp;<span class="num" id="6710984">7</span><span class="op" id="6710985">}</span><span class="op" id="6710986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710990">{</span><span class="string" id="6710991">&#34;YWJjZA=====&#34;</span><span class="op" id="6711004">,</span>&nbsp;<span class="num" id="6711006">8</span><span class="op" id="6711007">}</span><span class="op" id="6711008">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711014">for</span>&nbsp;<span class="ident" id="6711018">_</span><span class="op" id="6711019">,</span>&nbsp;<span class="ident" id="6711021">tc</span>&nbsp;<span class="op" id="6711024">:=</span>&nbsp;<span class="keyword" id="6711027">range</span>&nbsp;<span class="ident" id="6711033">testCases</span>&nbsp;<span class="op" id="6711043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711047">dbuf</span>&nbsp;<span class="op" id="6711052">:=</span>&nbsp;<span class="builtinfunc" id="6711055">make</span><span class="op" id="6711059">(</span><span class="op" id="6711060">[</span><span class="op" id="6711061">]</span><span class="builtintype" id="6711062">byte</span><span class="op" id="6711066">,</span>&nbsp;<span class="ident" id="6711068">StdEncoding</span><span class="op" id="6711079">.</span><span class="ident" id="6711080">DecodedLen</span><span class="op" id="6711090">(</span><span class="builtinfunc" id="6711091">len</span><span class="op" id="6711094">(</span><span class="ident" id="6711095">tc</span><span class="op" id="6711097">.</span><span class="ident" id="6711098">input</span><span class="op" id="6711103">)</span><span class="op" id="6711104">)</span><span class="op" id="6711105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711109">_</span><span class="op" id="6711110">,</span>&nbsp;<span class="ident" id="6711112">err</span>&nbsp;<span class="op" id="6711116">:=</span>&nbsp;<span class="ident" id="6711119">StdEncoding</span><span class="op" id="6711130">.</span><span class="ident" id="6711131">Decode</span><span class="op" id="6711137">(</span><span class="ident" id="6711138">dbuf</span><span class="op" id="6711142">,</span>&nbsp;<span class="op" id="6711144">[</span><span class="op" id="6711145">]</span><span class="builtintype" id="6711146">byte</span><span class="op" id="6711150">(</span><span class="ident" id="6711151">tc</span><span class="op" id="6711153">.</span><span class="ident" id="6711154">input</span><span class="op" id="6711159">)</span><span class="op" id="6711160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711164">if</span>&nbsp;<span class="ident" id="6711167">tc</span><span class="op" id="6711169">.</span><span class="ident" id="6711170">offset</span>&nbsp;<span class="op" id="6711177">==</span>&nbsp;<span class="op" id="6711180">-</span><span class="num" id="6711181">1</span>&nbsp;<span class="op" id="6711183">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711188">if</span>&nbsp;<span class="ident" id="6711191">err</span>&nbsp;<span class="op" id="6711195">!=</span>&nbsp;<span class="ident" id="6711198">nil</span>&nbsp;<span class="op" id="6711202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711208">t</span><span class="op" id="6711209">.</span><span class="ident" id="6711210">Error</span><span class="op" id="6711215">(</span><span class="string" id="6711216">&#34;Decoder&nbsp;wrongly&nbsp;detected&nbsp;coruption&nbsp;in&#34;</span><span class="op" id="6711255">,</span>&nbsp;<span class="ident" id="6711257">tc</span><span class="op" id="6711259">.</span><span class="ident" id="6711260">input</span><span class="op" id="6711265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711275">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711286">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711290">switch</span>&nbsp;<span class="ident" id="6711297">err</span>&nbsp;<span class="op" id="6711301">:=</span>&nbsp;<span class="ident" id="6711304">err</span><span class="op" id="6711307">.</span><span class="op" id="6711308">(</span><span class="keyword" id="6711309">type</span><span class="op" id="6711313">)</span>&nbsp;<span class="op" id="6711315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711319">case</span>&nbsp;<span class="ident" id="6711324">CorruptInputError</span><span class="op" id="6711341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711346">testEqual</span><span class="op" id="6711355">(</span><span class="ident" id="6711356">t</span><span class="op" id="6711357">,</span>&nbsp;<span class="string" id="6711359">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6711399">,</span>&nbsp;<span class="ident" id="6711401">tc</span><span class="op" id="6711403">.</span><span class="ident" id="6711404">input</span><span class="op" id="6711409">,</span>&nbsp;<span class="builtintype" id="6711411">int</span><span class="op" id="6711414">(</span><span class="ident" id="6711415">err</span><span class="op" id="6711418">)</span><span class="op" id="6711419">,</span>&nbsp;<span class="ident" id="6711421">tc</span><span class="op" id="6711423">.</span><span class="ident" id="6711424">offset</span><span class="op" id="6711430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711434">default</span><span class="op" id="6711441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711446">t</span><span class="op" id="6711447">.</span><span class="ident" id="6711448">Error</span><span class="op" id="6711453">(</span><span class="string" id="6711454">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="6711494">,</span>&nbsp;<span class="ident" id="6711496">tc</span><span class="op" id="6711498">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711505">}</span><br>
<span class="lineno"></span><span class="op" id="6711507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6711510">func</span>&nbsp;<span class="ident" id="6711515">TestBig</span><span class="op" id="6711522">(</span><span class="ident" id="6711523">t</span>&nbsp;<span class="op" id="6711525">*</span><span class="ident" id="6711526">testing</span><span class="op" id="6711533">.</span><span class="ident" id="6711534">T</span><span class="op" id="6711535">)</span>&nbsp;<span class="op" id="6711537">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711540">n</span>&nbsp;<span class="op" id="6711542">:=</span>&nbsp;<span class="num" id="6711545">3</span><span class="op" id="6711546">*</span><span class="num" id="6711547">1000</span>&nbsp;<span class="op" id="6711552">+</span>&nbsp;<span class="num" id="6711554">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711557">raw</span>&nbsp;<span class="op" id="6711561">:=</span>&nbsp;<span class="builtinfunc" id="6711564">make</span><span class="op" id="6711568">(</span><span class="op" id="6711569">[</span><span class="op" id="6711570">]</span><span class="builtintype" id="6711571">byte</span><span class="op" id="6711575">,</span>&nbsp;<span class="ident" id="6711577">n</span><span class="op" id="6711578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711581">const</span>&nbsp;<span class="ident" id="6711587">alpha</span>&nbsp;<span class="op" id="6711593">=</span>&nbsp;<span class="string" id="6711595">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711661">for</span>&nbsp;<span class="ident" id="6711665">i</span>&nbsp;<span class="op" id="6711667">:=</span>&nbsp;<span class="num" id="6711670">0</span><span class="op" id="6711671">;</span>&nbsp;<span class="ident" id="6711673">i</span>&nbsp;<span class="op" id="6711675">&lt;</span>&nbsp;<span class="ident" id="6711677">n</span><span class="op" id="6711678">;</span>&nbsp;<span class="ident" id="6711680">i</span><span class="op" id="6711681">++</span>&nbsp;<span class="op" id="6711684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711688">raw</span><span class="op" id="6711691">[</span><span class="ident" id="6711692">i</span><span class="op" id="6711693">]</span>&nbsp;<span class="op" id="6711695">=</span>&nbsp;<span class="ident" id="6711697">alpha</span><span class="op" id="6711702">[</span><span class="ident" id="6711703">i</span><span class="op" id="6711704">%</span><span class="builtinfunc" id="6711705">len</span><span class="op" id="6711708">(</span><span class="ident" id="6711709">alpha</span><span class="op" id="6711714">)</span><span class="op" id="6711715">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711721">encoded</span>&nbsp;<span class="op" id="6711729">:=</span>&nbsp;<span class="builtinfunc" id="6711732">new</span><span class="op" id="6711735">(</span><span class="ident" id="6711736">bytes</span><span class="op" id="6711741">.</span><span class="ident" id="6711742">Buffer</span><span class="op" id="6711748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711751">w</span>&nbsp;<span class="op" id="6711753">:=</span>&nbsp;<span class="ident" id="6711756">NewEncoder</span><span class="op" id="6711766">(</span><span class="ident" id="6711767">StdEncoding</span><span class="op" id="6711778">,</span>&nbsp;<span class="ident" id="6711780">encoded</span><span class="op" id="6711787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711790">nn</span><span class="op" id="6711792">,</span>&nbsp;<span class="ident" id="6711794">err</span>&nbsp;<span class="op" id="6711798">:=</span>&nbsp;<span class="ident" id="6711801">w</span><span class="op" id="6711802">.</span><span class="ident" id="6711803">Write</span><span class="op" id="6711808">(</span><span class="ident" id="6711809">raw</span><span class="op" id="6711812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711815">if</span>&nbsp;<span class="ident" id="6711818">nn</span>&nbsp;<span class="op" id="6711821">!=</span>&nbsp;<span class="ident" id="6711824">n</span>&nbsp;<span class="op" id="6711826">||</span>&nbsp;<span class="ident" id="6711829">err</span>&nbsp;<span class="op" id="6711833">!=</span>&nbsp;<span class="ident" id="6711836">nil</span>&nbsp;<span class="op" id="6711840">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711844">t</span><span class="op" id="6711845">.</span><span class="ident" id="6711846">Fatalf</span><span class="op" id="6711852">(</span><span class="string" id="6711853">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="6711895">,</span>&nbsp;<span class="ident" id="6711897">nn</span><span class="op" id="6711899">,</span>&nbsp;<span class="ident" id="6711901">err</span><span class="op" id="6711904">,</span>&nbsp;<span class="ident" id="6711906">n</span><span class="op" id="6711907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711913">err</span>&nbsp;<span class="op" id="6711917">=</span>&nbsp;<span class="ident" id="6711919">w</span><span class="op" id="6711920">.</span><span class="ident" id="6711921">Close</span><span class="op" id="6711926">(</span><span class="op" id="6711927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711930">if</span>&nbsp;<span class="ident" id="6711933">err</span>&nbsp;<span class="op" id="6711937">!=</span>&nbsp;<span class="ident" id="6711940">nil</span>&nbsp;<span class="op" id="6711944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711948">t</span><span class="op" id="6711949">.</span><span class="ident" id="6711950">Fatalf</span><span class="op" id="6711956">(</span><span class="string" id="6711957">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="6711988">,</span>&nbsp;<span class="ident" id="6711990">err</span><span class="op" id="6711993">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711999">decoded</span><span class="op" id="6712006">,</span>&nbsp;<span class="ident" id="6712008">err</span>&nbsp;<span class="op" id="6712012">:=</span>&nbsp;<span class="ident" id="6712015">ioutil</span><span class="op" id="6712021">.</span><span class="ident" id="6712022">ReadAll</span><span class="op" id="6712029">(</span><span class="ident" id="6712030">NewDecoder</span><span class="op" id="6712040">(</span><span class="ident" id="6712041">StdEncoding</span><span class="op" id="6712052">,</span>&nbsp;<span class="ident" id="6712054">encoded</span><span class="op" id="6712061">)</span><span class="op" id="6712062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712065">if</span>&nbsp;<span class="ident" id="6712068">err</span>&nbsp;<span class="op" id="6712072">!=</span>&nbsp;<span class="ident" id="6712075">nil</span>&nbsp;<span class="op" id="6712079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712083">t</span><span class="op" id="6712084">.</span><span class="ident" id="6712085">Fatalf</span><span class="op" id="6712091">(</span><span class="string" id="6712092">&#34;ioutil.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="6712129">,</span>&nbsp;<span class="ident" id="6712131">err</span><span class="op" id="6712134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712137">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712141">if</span>&nbsp;<span class="op" id="6712144">!</span><span class="ident" id="6712145">bytes</span><span class="op" id="6712150">.</span><span class="ident" id="6712151">Equal</span><span class="op" id="6712156">(</span><span class="ident" id="6712157">raw</span><span class="op" id="6712160">,</span>&nbsp;<span class="ident" id="6712162">decoded</span><span class="op" id="6712169">)</span>&nbsp;<span class="op" id="6712171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712175">var</span>&nbsp;<span class="ident" id="6712179">i</span>&nbsp;<span class="builtintype" id="6712181">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712187">for</span>&nbsp;<span class="ident" id="6712191">i</span>&nbsp;<span class="op" id="6712193">=</span>&nbsp;<span class="num" id="6712195">0</span><span class="op" id="6712196">;</span>&nbsp;<span class="ident" id="6712198">i</span>&nbsp;<span class="op" id="6712200">&lt;</span>&nbsp;<span class="builtinfunc" id="6712202">len</span><span class="op" id="6712205">(</span><span class="ident" id="6712206">decoded</span><span class="op" id="6712213">)</span>&nbsp;<span class="op" id="6712215">&amp;&amp;</span>&nbsp;<span class="ident" id="6712218">i</span>&nbsp;<span class="op" id="6712220">&lt;</span>&nbsp;<span class="builtinfunc" id="6712222">len</span><span class="op" id="6712225">(</span><span class="ident" id="6712226">raw</span><span class="op" id="6712229">)</span><span class="op" id="6712230">;</span>&nbsp;<span class="ident" id="6712232">i</span><span class="op" id="6712233">++</span>&nbsp;<span class="op" id="6712236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712241">if</span>&nbsp;<span class="ident" id="6712244">decoded</span><span class="op" id="6712251">[</span><span class="ident" id="6712252">i</span><span class="op" id="6712253">]</span>&nbsp;<span class="op" id="6712255">!=</span>&nbsp;<span class="ident" id="6712258">raw</span><span class="op" id="6712261">[</span><span class="ident" id="6712262">i</span><span class="op" id="6712263">]</span>&nbsp;<span class="op" id="6712265">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712271">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712288">t</span><span class="op" id="6712289">.</span><span class="ident" id="6712290">Errorf</span><span class="op" id="6712296">(</span><span class="string" id="6712297">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="6712349">,</span>&nbsp;<span class="ident" id="6712351">n</span><span class="op" id="6712352">,</span>&nbsp;<span class="ident" id="6712354">i</span><span class="op" id="6712355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712358">}</span><br>
<span class="lineno">220</span><span class="op" id="6712360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6712363">func</span>&nbsp;<span class="ident" id="6712368">TestNewLineCharacters</span><span class="op" id="6712389">(</span><span class="ident" id="6712390">t</span>&nbsp;<span class="op" id="6712392">*</span><span class="ident" id="6712393">testing</span><span class="op" id="6712400">.</span><span class="ident" id="6712401">T</span><span class="op" id="6712402">)</span>&nbsp;<span class="op" id="6712404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6712407">//&nbsp;Each&nbsp;of&nbsp;these&nbsp;should&nbsp;decode&nbsp;to&nbsp;the&nbsp;string&nbsp;&#34;sure&#34;,&nbsp;without&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712477">const</span>&nbsp;<span class="ident" id="6712483">expected</span>&nbsp;<span class="op" id="6712492">=</span>&nbsp;<span class="string" id="6712494">&#34;sure&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712502">examples</span>&nbsp;<span class="op" id="6712511">:=</span>&nbsp;<span class="op" id="6712514">[</span><span class="op" id="6712515">]</span><span class="builtintype" id="6712516">string</span><span class="op" id="6712522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6712526">&#34;c3VyZQ==&#34;</span><span class="op" id="6712536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6712540">&#34;c3VyZQ==\r&#34;</span><span class="op" id="6712552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6712556">&#34;c3VyZQ==\n&#34;</span><span class="op" id="6712568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6712572">&#34;c3VyZQ==\r\n&#34;</span><span class="op" id="6712586">,</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6712590">&#34;c3VyZ\r\nQ==&#34;</span><span class="op" id="6712604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6712608">&#34;c3V\ryZ\nQ==&#34;</span><span class="op" id="6712622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6712626">&#34;c3V\nyZ\rQ==&#34;</span><span class="op" id="6712640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6712644">&#34;c3VyZ\nQ==&#34;</span><span class="op" id="6712656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6712660">&#34;c3VyZQ\n==&#34;</span><span class="op" id="6712672">,</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6712676">&#34;c3VyZQ=\n=&#34;</span><span class="op" id="6712688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6712692">&#34;c3VyZQ=\r\n\r\n=&#34;</span><span class="op" id="6712710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712716">for</span>&nbsp;<span class="ident" id="6712720">_</span><span class="op" id="6712721">,</span>&nbsp;<span class="ident" id="6712723">e</span>&nbsp;<span class="op" id="6712725">:=</span>&nbsp;<span class="keyword" id="6712728">range</span>&nbsp;<span class="ident" id="6712734">examples</span>&nbsp;<span class="op" id="6712743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712747">buf</span><span class="op" id="6712750">,</span>&nbsp;<span class="ident" id="6712752">err</span>&nbsp;<span class="op" id="6712756">:=</span>&nbsp;<span class="ident" id="6712759">StdEncoding</span><span class="op" id="6712770">.</span><span class="ident" id="6712771">DecodeString</span><span class="op" id="6712783">(</span><span class="ident" id="6712784">e</span><span class="op" id="6712785">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712789">if</span>&nbsp;<span class="ident" id="6712792">err</span>&nbsp;<span class="op" id="6712796">!=</span>&nbsp;<span class="ident" id="6712799">nil</span>&nbsp;<span class="op" id="6712803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712808">t</span><span class="op" id="6712809">.</span><span class="ident" id="6712810">Errorf</span><span class="op" id="6712816">(</span><span class="string" id="6712817">&#34;Decode(%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6712840">,</span>&nbsp;<span class="ident" id="6712842">e</span><span class="op" id="6712843">,</span>&nbsp;<span class="ident" id="6712845">err</span><span class="op" id="6712848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712853">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712868">if</span>&nbsp;<span class="ident" id="6712871">s</span>&nbsp;<span class="op" id="6712873">:=</span>&nbsp;<span class="builtintype" id="6712876">string</span><span class="op" id="6712882">(</span><span class="ident" id="6712883">buf</span><span class="op" id="6712886">)</span><span class="op" id="6712887">;</span>&nbsp;<span class="ident" id="6712889">s</span>&nbsp;<span class="op" id="6712891">!=</span>&nbsp;<span class="ident" id="6712894">expected</span>&nbsp;<span class="op" id="6712903">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712908">t</span><span class="op" id="6712909">.</span><span class="ident" id="6712910">Errorf</span><span class="op" id="6712916">(</span><span class="string" id="6712917">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6712943">,</span>&nbsp;<span class="ident" id="6712945">e</span><span class="op" id="6712946">,</span>&nbsp;<span class="ident" id="6712948">s</span><span class="op" id="6712949">,</span>&nbsp;<span class="ident" id="6712951">expected</span><span class="op" id="6712959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712966">}</span><br>
<span class="lineno"></span><span class="op" id="6712968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="6712971">type</span>&nbsp;<span class="ident" id="6712976">nextRead</span>&nbsp;<span class="keyword" id="6712985">struct</span>&nbsp;<span class="op" id="6712992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712995">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6712999">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6713005">//&nbsp;bytes&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713025">err</span>&nbsp;<span class="builtintype" id="6713029">error</span>&nbsp;<span class="comment" id="6713035">//&nbsp;error&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="op" id="6713054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6713057">//&nbsp;faultInjectReader&nbsp;returns&nbsp;data&nbsp;from&nbsp;source,&nbsp;rate-limited</span><br>
<span class="lineno"></span><span class="comment" id="6713117">//&nbsp;and&nbsp;with&nbsp;the&nbsp;errors&nbsp;as&nbsp;written&nbsp;to&nbsp;nextc.</span><br>
<span class="lineno"></span><span class="keyword" id="6713161">type</span>&nbsp;<span class="ident" id="6713166">faultInjectReader</span>&nbsp;<span class="keyword" id="6713184">struct</span>&nbsp;<span class="op" id="6713191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713194">source</span>&nbsp;<span class="builtintype" id="6713201">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713209">nextc</span>&nbsp;&nbsp;<span class="op" id="6713216">&lt;-</span><span class="keyword" id="6713218">chan</span>&nbsp;<span class="ident" id="6713223">nextRead</span><br>
<span class="lineno">260</span><span class="op" id="6713232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6713235">func</span>&nbsp;<span class="op" id="6713240">(</span><span class="ident" id="6713241">r</span>&nbsp;<span class="op" id="6713243">*</span><span class="ident" id="6713244">faultInjectReader</span><span class="op" id="6713261">)</span>&nbsp;<span class="ident" id="6713263">Read</span><span class="op" id="6713267">(</span><span class="ident" id="6713268">p</span>&nbsp;<span class="op" id="6713270">[</span><span class="op" id="6713271">]</span><span class="builtintype" id="6713272">byte</span><span class="op" id="6713276">)</span>&nbsp;<span class="op" id="6713278">(</span><span class="builtintype" id="6713279">int</span><span class="op" id="6713282">,</span>&nbsp;<span class="builtintype" id="6713284">error</span><span class="op" id="6713289">)</span>&nbsp;<span class="op" id="6713291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713294">nr</span>&nbsp;<span class="op" id="6713297">:=</span>&nbsp;<span class="op" id="6713300">&lt;-</span><span class="ident" id="6713302">r</span><span class="op" id="6713303">.</span><span class="ident" id="6713304">nextc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713311">if</span>&nbsp;<span class="builtinfunc" id="6713314">len</span><span class="op" id="6713317">(</span><span class="ident" id="6713318">p</span><span class="op" id="6713319">)</span>&nbsp;<span class="op" id="6713321">&gt;</span>&nbsp;<span class="ident" id="6713323">nr</span><span class="op" id="6713325">.</span><span class="ident" id="6713326">n</span>&nbsp;<span class="op" id="6713328">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713332">p</span>&nbsp;<span class="op" id="6713334">=</span>&nbsp;<span class="ident" id="6713336">p</span><span class="op" id="6713337">[</span><span class="op" id="6713338">:</span><span class="ident" id="6713339">nr</span><span class="op" id="6713341">.</span><span class="ident" id="6713342">n</span><span class="op" id="6713343">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713349">n</span>&nbsp;<span class="op" id="6713351">:=</span>&nbsp;<span class="builtinfunc" id="6713354">copy</span><span class="op" id="6713358">(</span><span class="ident" id="6713359">p</span><span class="op" id="6713360">,</span>&nbsp;<span class="ident" id="6713362">r</span><span class="op" id="6713363">.</span><span class="ident" id="6713364">source</span><span class="op" id="6713370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713373">r</span><span class="op" id="6713374">.</span><span class="ident" id="6713375">source</span>&nbsp;<span class="op" id="6713382">=</span>&nbsp;<span class="ident" id="6713384">r</span><span class="op" id="6713385">.</span><span class="ident" id="6713386">source</span><span class="op" id="6713392">[</span><span class="ident" id="6713393">n</span><span class="op" id="6713394">:</span><span class="op" id="6713395">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713398">return</span>&nbsp;<span class="ident" id="6713405">n</span><span class="op" id="6713406">,</span>&nbsp;<span class="ident" id="6713408">nr</span><span class="op" id="6713410">.</span><span class="ident" id="6713411">err</span><br>
<span class="lineno">270</span><span class="op" id="6713415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6713418">//&nbsp;tests&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;ignore&nbsp;errors&nbsp;from&nbsp;our&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span><span class="keyword" id="6713482">func</span>&nbsp;<span class="ident" id="6713487">TestDecoderIssue3577</span><span class="op" id="6713507">(</span><span class="ident" id="6713508">t</span>&nbsp;<span class="op" id="6713510">*</span><span class="ident" id="6713511">testing</span><span class="op" id="6713518">.</span><span class="ident" id="6713519">T</span><span class="op" id="6713520">)</span>&nbsp;<span class="op" id="6713522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713525">next</span>&nbsp;<span class="op" id="6713530">:=</span>&nbsp;<span class="builtinfunc" id="6713533">make</span><span class="op" id="6713537">(</span><span class="keyword" id="6713538">chan</span>&nbsp;<span class="ident" id="6713543">nextRead</span><span class="op" id="6713551">,</span>&nbsp;<span class="num" id="6713553">10</span><span class="op" id="6713555">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713558">wantErr</span>&nbsp;<span class="op" id="6713566">:=</span>&nbsp;<span class="ident" id="6713569">errors</span><span class="op" id="6713575">.</span><span class="ident" id="6713576">New</span><span class="op" id="6713579">(</span><span class="string" id="6713580">&#34;my&nbsp;error&#34;</span><span class="op" id="6713590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713593">next</span>&nbsp;<span class="op" id="6713598">&lt;-</span>&nbsp;<span class="ident" id="6713601">nextRead</span><span class="op" id="6713609">{</span><span class="num" id="6713610">5</span><span class="op" id="6713611">,</span>&nbsp;<span class="ident" id="6713613">nil</span><span class="op" id="6713616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713619">next</span>&nbsp;<span class="op" id="6713624">&lt;-</span>&nbsp;<span class="ident" id="6713627">nextRead</span><span class="op" id="6713635">{</span><span class="num" id="6713636">10</span><span class="op" id="6713638">,</span>&nbsp;<span class="ident" id="6713640">wantErr</span><span class="op" id="6713647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713650">next</span>&nbsp;<span class="op" id="6713655">&lt;-</span>&nbsp;<span class="ident" id="6713658">nextRead</span><span class="op" id="6713666">{</span><span class="num" id="6713667">0</span><span class="op" id="6713668">,</span>&nbsp;<span class="ident" id="6713670">wantErr</span><span class="op" id="6713677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713680">d</span>&nbsp;<span class="op" id="6713682">:=</span>&nbsp;<span class="ident" id="6713685">NewDecoder</span><span class="op" id="6713695">(</span><span class="ident" id="6713696">StdEncoding</span><span class="op" id="6713707">,</span>&nbsp;<span class="op" id="6713709">&amp;</span><span class="ident" id="6713710">faultInjectReader</span><span class="op" id="6713727">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713731">source</span><span class="op" id="6713737">:</span>&nbsp;<span class="string" id="6713739">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="6713789">,</span>&nbsp;<span class="comment" id="6713791">//&nbsp;twas&nbsp;brillig...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713812">nextc</span><span class="op" id="6713817">:</span>&nbsp;&nbsp;<span class="ident" id="6713820">next</span><span class="op" id="6713824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713827">}</span><span class="op" id="6713828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713831">errc</span>&nbsp;<span class="op" id="6713836">:=</span>&nbsp;<span class="builtinfunc" id="6713839">make</span><span class="op" id="6713843">(</span><span class="keyword" id="6713844">chan</span>&nbsp;<span class="builtintype" id="6713849">error</span><span class="op" id="6713854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713857">go</span>&nbsp;<span class="keyword" id="6713860">func</span><span class="op" id="6713864">(</span><span class="op" id="6713865">)</span>&nbsp;<span class="op" id="6713867">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713871">_</span><span class="op" id="6713872">,</span>&nbsp;<span class="ident" id="6713874">err</span>&nbsp;<span class="op" id="6713878">:=</span>&nbsp;<span class="ident" id="6713881">ioutil</span><span class="op" id="6713887">.</span><span class="ident" id="6713888">ReadAll</span><span class="op" id="6713895">(</span><span class="ident" id="6713896">d</span><span class="op" id="6713897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713901">errc</span>&nbsp;<span class="op" id="6713906">&lt;-</span>&nbsp;<span class="ident" id="6713909">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713914">}</span><span class="op" id="6713915">(</span><span class="op" id="6713916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713919">select</span>&nbsp;<span class="op" id="6713926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713929">case</span>&nbsp;<span class="ident" id="6713934">err</span>&nbsp;<span class="op" id="6713938">:=</span>&nbsp;<span class="op" id="6713941">&lt;-</span><span class="ident" id="6713943">errc</span><span class="op" id="6713947">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713951">if</span>&nbsp;<span class="ident" id="6713954">err</span>&nbsp;<span class="op" id="6713958">!=</span>&nbsp;<span class="ident" id="6713961">wantErr</span>&nbsp;<span class="op" id="6713969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713974">t</span><span class="op" id="6713975">.</span><span class="ident" id="6713976">Errorf</span><span class="op" id="6713982">(</span><span class="string" id="6713983">&#34;got&nbsp;error&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6714006">,</span>&nbsp;<span class="ident" id="6714008">err</span><span class="op" id="6714011">,</span>&nbsp;<span class="ident" id="6714013">wantErr</span><span class="op" id="6714020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714027">case</span>&nbsp;<span class="op" id="6714032">&lt;-</span><span class="ident" id="6714034">time</span><span class="op" id="6714038">.</span><span class="ident" id="6714039">After</span><span class="op" id="6714044">(</span><span class="num" id="6714045">5</span>&nbsp;<span class="op" id="6714047">*</span>&nbsp;<span class="ident" id="6714049">time</span><span class="op" id="6714053">.</span><span class="ident" id="6714054">Second</span><span class="op" id="6714060">)</span><span class="op" id="6714061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714065">t</span><span class="op" id="6714066">.</span><span class="ident" id="6714067">Errorf</span><span class="op" id="6714073">(</span><span class="string" id="6714074">&#34;timeout;&nbsp;Decoder&nbsp;blocked&nbsp;without&nbsp;returning&nbsp;an&nbsp;error&#34;</span><span class="op" id="6714127">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714130">}</span><br>
<span class="lineno"></span><span class="op" id="6714132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6714135">func</span>&nbsp;<span class="ident" id="6714140">TestDecoderIssue4779</span><span class="op" id="6714160">(</span><span class="ident" id="6714161">t</span>&nbsp;<span class="op" id="6714163">*</span><span class="ident" id="6714164">testing</span><span class="op" id="6714171">.</span><span class="ident" id="6714172">T</span><span class="op" id="6714173">)</span>&nbsp;<span class="op" id="6714175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714178">encoded</span>&nbsp;<span class="op" id="6714186">:=</span>&nbsp;<span class="string" id="6714189">`CP/EAT8AAAEF<br>
<span class="lineno">300</span>AQEBAQEBAAAAAAAAAAMAAQIEBQYHCAkKCwEAAQUBAQEBAQEAAAAAAAAAAQACAwQFBgcICQoLEAAB<br>
<span class="lineno"></span>BAEDAgQCBQcGCAUDDDMBAAIRAwQhEjEFQVFhEyJxgTIGFJGhsUIjJBVSwWIzNHKC0UMHJZJT8OHx<br>
<span class="lineno"></span>Y3M1FqKygyZEk1RkRcKjdDYX0lXiZfKzhMPTdePzRieUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm<br>
<span class="lineno"></span>9jdHV2d3h5ent8fX5/cRAAICAQIEBAMEBQYHBwYFNQEAAhEDITESBEFRYXEiEwUygZEUobFCI8FS<br>
<span class="lineno"></span>0fAzJGLhcoKSQ1MVY3M08SUGFqKygwcmNcLSRJNUoxdkRVU2dGXi8rOEw9N14/NGlKSFtJXE1OT0<br>
<span class="lineno">305</span>pbXF1eX1VmZ2hpamtsbW5vYnN0dXZ3eHl6e3x//aAAwDAQACEQMRAD8A9VSSSSUpJJJJSkkkJ+Tj<br>
<span class="lineno"></span>1kiy1jCJJDnAcCTykpKkuQ6p/jN6FgmxlNduXawwAzaGH+V6jn/R/wCt71zdn+N/qL3kVYFNYB4N<br>
<span class="lineno"></span>ji6PDVjWpKp9TSXnvTf8bFNjg3qOEa2n6VlLpj/rT/pf567DpX1i6L1hs9Py67X8mqdtg/rUWbbf<br>
<span class="lineno"></span>+gkp0kkkklKSSSSUpJJJJT//0PVUkkklKVLq3WMDpGI7KzrNjADtYNXvI/Mqr/Pd/q9W3vaxjnvM<br>
<span class="lineno"></span>NaCXE9gNSvGPrf8AWS3qmba5jjsJhoB0DAf0NDf6sevf+/lf8Hj0JJATfWT6/dV6oXU1uOLQeKKn<br>
<span class="lineno">310</span>EQP+Hubtfe/+R7Mf/g7f5xcocp++Z11JMCJPgFBxOg7/AOuqDx8I/ikpkXkmSdU8mJIJA/O8EMAy<br>
<span class="lineno"></span>j+mSARB/17pKVXYWHXjsj7yIex0PadzXMO1zT5KHoNA3HT8ietoGhgjsfA+CSnvvqh/jJtqsrwOv<br>
<span class="lineno"></span>2b6NGNzXfTYexzJ+nU7/ALkf4P8Awv6P9KvTQQ4AgyDqCF85Pho3CTB7eHwXoH+LT65uZbX9X+o2<br>
<span class="lineno"></span>bqbPb06551Y4<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715220">encodedShort</span>&nbsp;<span class="op" id="6715233">:=</span>&nbsp;<span class="ident" id="6715236">strings</span><span class="op" id="6715243">.</span><span class="ident" id="6715244">Replace</span><span class="op" id="6715251">(</span><span class="ident" id="6715252">encoded</span><span class="op" id="6715259">,</span>&nbsp;<span class="string" id="6715261">&#34;\n&#34;</span><span class="op" id="6715265">,</span>&nbsp;<span class="string" id="6715267">&#34;&#34;</span><span class="op" id="6715269">,</span>&nbsp;<span class="op" id="6715271">-</span><span class="num" id="6715272">1</span><span class="op" id="6715273">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715277">dec</span>&nbsp;<span class="op" id="6715281">:=</span>&nbsp;<span class="ident" id="6715284">NewDecoder</span><span class="op" id="6715294">(</span><span class="ident" id="6715295">StdEncoding</span><span class="op" id="6715306">,</span>&nbsp;<span class="ident" id="6715308">strings</span><span class="op" id="6715315">.</span><span class="ident" id="6715316">NewReader</span><span class="op" id="6715325">(</span><span class="ident" id="6715326">encoded</span><span class="op" id="6715333">)</span><span class="op" id="6715334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715337">res1</span><span class="op" id="6715341">,</span>&nbsp;<span class="ident" id="6715343">err</span>&nbsp;<span class="op" id="6715347">:=</span>&nbsp;<span class="ident" id="6715350">ioutil</span><span class="op" id="6715356">.</span><span class="ident" id="6715357">ReadAll</span><span class="op" id="6715364">(</span><span class="ident" id="6715365">dec</span><span class="op" id="6715368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715371">if</span>&nbsp;<span class="ident" id="6715374">err</span>&nbsp;<span class="op" id="6715378">!=</span>&nbsp;<span class="ident" id="6715381">nil</span>&nbsp;<span class="op" id="6715385">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715389">t</span><span class="op" id="6715390">.</span><span class="ident" id="6715391">Errorf</span><span class="op" id="6715397">(</span><span class="string" id="6715398">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6715418">,</span>&nbsp;<span class="ident" id="6715420">err</span><span class="op" id="6715423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715430">dec</span>&nbsp;<span class="op" id="6715434">=</span>&nbsp;<span class="ident" id="6715436">NewDecoder</span><span class="op" id="6715446">(</span><span class="ident" id="6715447">StdEncoding</span><span class="op" id="6715458">,</span>&nbsp;<span class="ident" id="6715460">strings</span><span class="op" id="6715467">.</span><span class="ident" id="6715468">NewReader</span><span class="op" id="6715477">(</span><span class="ident" id="6715478">encodedShort</span><span class="op" id="6715490">)</span><span class="op" id="6715491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715494">var</span>&nbsp;<span class="ident" id="6715498">res2</span>&nbsp;<span class="op" id="6715503">[</span><span class="op" id="6715504">]</span><span class="builtintype" id="6715505">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715511">res2</span><span class="op" id="6715515">,</span>&nbsp;<span class="ident" id="6715517">err</span>&nbsp;<span class="op" id="6715521">=</span>&nbsp;<span class="ident" id="6715523">ioutil</span><span class="op" id="6715529">.</span><span class="ident" id="6715530">ReadAll</span><span class="op" id="6715537">(</span><span class="ident" id="6715538">dec</span><span class="op" id="6715541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715544">if</span>&nbsp;<span class="ident" id="6715547">err</span>&nbsp;<span class="op" id="6715551">!=</span>&nbsp;<span class="ident" id="6715554">nil</span>&nbsp;<span class="op" id="6715558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715562">t</span><span class="op" id="6715563">.</span><span class="ident" id="6715564">Errorf</span><span class="op" id="6715570">(</span><span class="string" id="6715571">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6715591">,</span>&nbsp;<span class="ident" id="6715593">err</span><span class="op" id="6715596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715603">if</span>&nbsp;<span class="op" id="6715606">!</span><span class="ident" id="6715607">bytes</span><span class="op" id="6715612">.</span><span class="ident" id="6715613">Equal</span><span class="op" id="6715618">(</span><span class="ident" id="6715619">res1</span><span class="op" id="6715623">,</span>&nbsp;<span class="ident" id="6715625">res2</span><span class="op" id="6715629">)</span>&nbsp;<span class="op" id="6715631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715635">t</span><span class="op" id="6715636">.</span><span class="ident" id="6715637">Error</span><span class="op" id="6715642">(</span><span class="string" id="6715643">&#34;Decoded&nbsp;results&nbsp;not&nbsp;equal&#34;</span><span class="op" id="6715670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715673">}</span><br>
<span class="lineno"></span><span class="op" id="6715675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="6715678">func</span>&nbsp;<span class="ident" id="6715683">TestDecoderIssue7733</span><span class="op" id="6715703">(</span><span class="ident" id="6715704">t</span>&nbsp;<span class="op" id="6715706">*</span><span class="ident" id="6715707">testing</span><span class="op" id="6715714">.</span><span class="ident" id="6715715">T</span><span class="op" id="6715716">)</span>&nbsp;<span class="op" id="6715718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715721">s</span><span class="op" id="6715722">,</span>&nbsp;<span class="ident" id="6715724">err</span>&nbsp;<span class="op" id="6715728">:=</span>&nbsp;<span class="ident" id="6715731">StdEncoding</span><span class="op" id="6715742">.</span><span class="ident" id="6715743">DecodeString</span><span class="op" id="6715755">(</span><span class="string" id="6715756">&#34;YWJjZA=====&#34;</span><span class="op" id="6715769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715772">want</span>&nbsp;<span class="op" id="6715777">:=</span>&nbsp;<span class="ident" id="6715780">CorruptInputError</span><span class="op" id="6715797">(</span><span class="num" id="6715798">8</span><span class="op" id="6715799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715802">if</span>&nbsp;<span class="op" id="6715805">!</span><span class="ident" id="6715806">reflect</span><span class="op" id="6715813">.</span><span class="ident" id="6715814">DeepEqual</span><span class="op" id="6715823">(</span><span class="ident" id="6715824">want</span><span class="op" id="6715828">,</span>&nbsp;<span class="ident" id="6715830">err</span><span class="op" id="6715833">)</span>&nbsp;<span class="op" id="6715835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715839">t</span><span class="op" id="6715840">.</span><span class="ident" id="6715841">Errorf</span><span class="op" id="6715847">(</span><span class="string" id="6715848">&#34;Error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;CorruptInputError(8)&#34;</span><span class="op" id="6715887">,</span>&nbsp;<span class="ident" id="6715889">err</span><span class="op" id="6715892">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715898">if</span>&nbsp;<span class="builtintype" id="6715901">string</span><span class="op" id="6715907">(</span><span class="ident" id="6715908">s</span><span class="op" id="6715909">)</span>&nbsp;<span class="op" id="6715911">!=</span>&nbsp;<span class="string" id="6715914">&#34;abcd&#34;</span>&nbsp;<span class="op" id="6715921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715925">t</span><span class="op" id="6715926">.</span><span class="ident" id="6715927">Errorf</span><span class="op" id="6715933">(</span><span class="string" id="6715934">&#34;DecodeString&nbsp;=&nbsp;%q;&nbsp;want&nbsp;abcd&#34;</span><span class="op" id="6715964">,</span>&nbsp;<span class="ident" id="6715966">s</span><span class="op" id="6715967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715970">}</span><br>
<span class="lineno"></span><span class="op" id="6715972">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="6715975">func</span>&nbsp;<span class="ident" id="6715980">BenchmarkEncodeToString</span><span class="op" id="6716003">(</span><span class="ident" id="6716004">b</span>&nbsp;<span class="op" id="6716006">*</span><span class="ident" id="6716007">testing</span><span class="op" id="6716014">.</span><span class="ident" id="6716015">B</span><span class="op" id="6716016">)</span>&nbsp;<span class="op" id="6716018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716021">data</span>&nbsp;<span class="op" id="6716026">:=</span>&nbsp;<span class="builtinfunc" id="6716029">make</span><span class="op" id="6716033">(</span><span class="op" id="6716034">[</span><span class="op" id="6716035">]</span><span class="builtintype" id="6716036">byte</span><span class="op" id="6716040">,</span>&nbsp;<span class="num" id="6716042">8192</span><span class="op" id="6716046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716049">b</span><span class="op" id="6716050">.</span><span class="ident" id="6716051">SetBytes</span><span class="op" id="6716059">(</span><span class="ident" id="6716060">int64</span><span class="op" id="6716065">(</span><span class="builtinfunc" id="6716066">len</span><span class="op" id="6716069">(</span><span class="ident" id="6716070">data</span><span class="op" id="6716074">)</span><span class="op" id="6716075">)</span><span class="op" id="6716076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716079">for</span>&nbsp;<span class="ident" id="6716083">i</span>&nbsp;<span class="op" id="6716085">:=</span>&nbsp;<span class="num" id="6716088">0</span><span class="op" id="6716089">;</span>&nbsp;<span class="ident" id="6716091">i</span>&nbsp;<span class="op" id="6716093">&lt;</span>&nbsp;<span class="ident" id="6716095">b</span><span class="op" id="6716096">.</span><span class="ident" id="6716097">N</span><span class="op" id="6716098">;</span>&nbsp;<span class="ident" id="6716100">i</span><span class="op" id="6716101">++</span>&nbsp;<span class="op" id="6716104">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716108">StdEncoding</span><span class="op" id="6716119">.</span><span class="ident" id="6716120">EncodeToString</span><span class="op" id="6716134">(</span><span class="ident" id="6716135">data</span><span class="op" id="6716139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716142">}</span><br>
<span class="lineno"></span><span class="op" id="6716144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6716147">func</span>&nbsp;<span class="ident" id="6716152">BenchmarkDecodeString</span><span class="op" id="6716173">(</span><span class="ident" id="6716174">b</span>&nbsp;<span class="op" id="6716176">*</span><span class="ident" id="6716177">testing</span><span class="op" id="6716184">.</span><span class="ident" id="6716185">B</span><span class="op" id="6716186">)</span>&nbsp;<span class="op" id="6716188">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716191">data</span>&nbsp;<span class="op" id="6716196">:=</span>&nbsp;<span class="ident" id="6716199">StdEncoding</span><span class="op" id="6716210">.</span><span class="ident" id="6716211">EncodeToString</span><span class="op" id="6716225">(</span><span class="builtinfunc" id="6716226">make</span><span class="op" id="6716230">(</span><span class="op" id="6716231">[</span><span class="op" id="6716232">]</span><span class="builtintype" id="6716233">byte</span><span class="op" id="6716237">,</span>&nbsp;<span class="num" id="6716239">8192</span><span class="op" id="6716243">)</span><span class="op" id="6716244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716247">b</span><span class="op" id="6716248">.</span><span class="ident" id="6716249">SetBytes</span><span class="op" id="6716257">(</span><span class="ident" id="6716258">int64</span><span class="op" id="6716263">(</span><span class="builtinfunc" id="6716264">len</span><span class="op" id="6716267">(</span><span class="ident" id="6716268">data</span><span class="op" id="6716272">)</span><span class="op" id="6716273">)</span><span class="op" id="6716274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716277">for</span>&nbsp;<span class="ident" id="6716281">i</span>&nbsp;<span class="op" id="6716283">:=</span>&nbsp;<span class="num" id="6716286">0</span><span class="op" id="6716287">;</span>&nbsp;<span class="ident" id="6716289">i</span>&nbsp;<span class="op" id="6716291">&lt;</span>&nbsp;<span class="ident" id="6716293">b</span><span class="op" id="6716294">.</span><span class="ident" id="6716295">N</span><span class="op" id="6716296">;</span>&nbsp;<span class="ident" id="6716298">i</span><span class="op" id="6716299">++</span>&nbsp;<span class="op" id="6716302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716306">StdEncoding</span><span class="op" id="6716317">.</span><span class="ident" id="6716318">DecodeString</span><span class="op" id="6716330">(</span><span class="ident" id="6716331">data</span><span class="op" id="6716335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716338">}</span><br>
<span class="lineno">360</span><span class="op" id="6716340">}</span>
</div>
</body>
</html>
