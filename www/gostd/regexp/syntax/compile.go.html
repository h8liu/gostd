<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html" class="current">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4454819">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4454874">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4454928">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4454979">package</span>&nbsp;<span class="ident" id="4454987">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4454995">import</span>&nbsp;<span class="string" id="4455002">&#34;unicode&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4455013">//&nbsp;A&nbsp;patchList&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;instruction&nbsp;pointers&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;filled&nbsp;in&nbsp;(patched).</span><br>
<span class="lineno">10</span><span class="comment" id="4455099">//&nbsp;Because&nbsp;the&nbsp;pointers&nbsp;haven&#39;t&nbsp;been&nbsp;filled&nbsp;in&nbsp;yet,&nbsp;we&nbsp;can&nbsp;reuse&nbsp;their&nbsp;storage</span><br>
<span class="lineno"></span><span class="comment" id="4455178">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;list.&nbsp;&nbsp;It&#39;s&nbsp;kind&nbsp;of&nbsp;sleazy,&nbsp;but&nbsp;works&nbsp;well&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span><span class="comment" id="4455249">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp1.html&nbsp;for&nbsp;inspiration.</span><br>
<span class="lineno"></span><span class="comment" id="4455315">//</span><br>
<span class="lineno"></span><span class="comment" id="4455318">//&nbsp;These&nbsp;aren&#39;t&nbsp;really&nbsp;pointers:&nbsp;they&#39;re&nbsp;integers,&nbsp;so&nbsp;we&nbsp;can&nbsp;reinterpret&nbsp;them</span><br>
<span class="lineno">15</span><span class="comment" id="4455396">//&nbsp;this&nbsp;way&nbsp;without&nbsp;using&nbsp;package&nbsp;unsafe.&nbsp;&nbsp;A&nbsp;value&nbsp;l&nbsp;denotes</span><br>
<span class="lineno"></span><span class="comment" id="4455457">//&nbsp;p.inst[l&gt;&gt;1].Out&nbsp;(l&amp;1==0)&nbsp;or&nbsp;.Arg&nbsp;(l&amp;1==1).</span><br>
<span class="lineno"></span><span class="comment" id="4455504">//&nbsp;l&nbsp;==&nbsp;0&nbsp;denotes&nbsp;the&nbsp;empty&nbsp;list,&nbsp;okay&nbsp;because&nbsp;we&nbsp;start&nbsp;every&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="4455574">//&nbsp;with&nbsp;a&nbsp;fail&nbsp;instruction,&nbsp;so&nbsp;we&#39;ll&nbsp;never&nbsp;want&nbsp;to&nbsp;point&nbsp;at&nbsp;its&nbsp;output&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="4455651">type</span>&nbsp;<span class="ident" id="4455656">patchList</span>&nbsp;<span class="builtintype" id="4455666">uint32</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4455674">func</span>&nbsp;<span class="op" id="4455679">(</span><span class="ident" id="4455680">l</span>&nbsp;<span class="ident" id="4455682">patchList</span><span class="op" id="4455691">)</span>&nbsp;<span class="ident" id="4455693">next</span><span class="op" id="4455697">(</span><span class="ident" id="4455698">p</span>&nbsp;<span class="op" id="4455700">*</span><span class="ident" id="4455701">Prog</span><span class="op" id="4455705">)</span>&nbsp;<span class="ident" id="4455707">patchList</span>&nbsp;<span class="op" id="4455717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455720">i</span>&nbsp;<span class="op" id="4455722">:=</span>&nbsp;<span class="op" id="4455725">&amp;</span><span class="ident" id="4455726">p</span><span class="op" id="4455727">.</span><span class="ident" id="4455728">Inst</span><span class="op" id="4455732">[</span><span class="ident" id="4455733">l</span><span class="op" id="4455734">&gt;&gt;</span><span class="num" id="4455736">1</span><span class="op" id="4455737">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455740">if</span>&nbsp;<span class="ident" id="4455743">l</span><span class="op" id="4455744">&amp;</span><span class="num" id="4455745">1</span>&nbsp;<span class="op" id="4455747">==</span>&nbsp;<span class="num" id="4455750">0</span>&nbsp;<span class="op" id="4455752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455756">return</span>&nbsp;<span class="ident" id="4455763">patchList</span><span class="op" id="4455772">(</span><span class="ident" id="4455773">i</span><span class="op" id="4455774">.</span><span class="ident" id="4455775">Out</span><span class="op" id="4455778">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4455781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455784">return</span>&nbsp;<span class="ident" id="4455791">patchList</span><span class="op" id="4455800">(</span><span class="ident" id="4455801">i</span><span class="op" id="4455802">.</span><span class="ident" id="4455803">Arg</span><span class="op" id="4455806">)</span><br>
<span class="lineno"></span><span class="op" id="4455808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4455811">func</span>&nbsp;<span class="op" id="4455816">(</span><span class="ident" id="4455817">l</span>&nbsp;<span class="ident" id="4455819">patchList</span><span class="op" id="4455828">)</span>&nbsp;<span class="ident" id="4455830">patch</span><span class="op" id="4455835">(</span><span class="ident" id="4455836">p</span>&nbsp;<span class="op" id="4455838">*</span><span class="ident" id="4455839">Prog</span><span class="op" id="4455843">,</span>&nbsp;<span class="ident" id="4455845">val</span>&nbsp;<span class="builtintype" id="4455849">uint32</span><span class="op" id="4455855">)</span>&nbsp;<span class="op" id="4455857">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455860">for</span>&nbsp;<span class="ident" id="4455864">l</span>&nbsp;<span class="op" id="4455866">!=</span>&nbsp;<span class="num" id="4455869">0</span>&nbsp;<span class="op" id="4455871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455875">i</span>&nbsp;<span class="op" id="4455877">:=</span>&nbsp;<span class="op" id="4455880">&amp;</span><span class="ident" id="4455881">p</span><span class="op" id="4455882">.</span><span class="ident" id="4455883">Inst</span><span class="op" id="4455887">[</span><span class="ident" id="4455888">l</span><span class="op" id="4455889">&gt;&gt;</span><span class="num" id="4455891">1</span><span class="op" id="4455892">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455896">if</span>&nbsp;<span class="ident" id="4455899">l</span><span class="op" id="4455900">&amp;</span><span class="num" id="4455901">1</span>&nbsp;<span class="op" id="4455903">==</span>&nbsp;<span class="num" id="4455906">0</span>&nbsp;<span class="op" id="4455908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455913">l</span>&nbsp;<span class="op" id="4455915">=</span>&nbsp;<span class="ident" id="4455917">patchList</span><span class="op" id="4455926">(</span><span class="ident" id="4455927">i</span><span class="op" id="4455928">.</span><span class="ident" id="4455929">Out</span><span class="op" id="4455932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455937">i</span><span class="op" id="4455938">.</span><span class="ident" id="4455939">Out</span>&nbsp;<span class="op" id="4455943">=</span>&nbsp;<span class="ident" id="4455945">val</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4455951">}</span>&nbsp;<span class="keyword" id="4455953">else</span>&nbsp;<span class="op" id="4455958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455963">l</span>&nbsp;<span class="op" id="4455965">=</span>&nbsp;<span class="ident" id="4455967">patchList</span><span class="op" id="4455976">(</span><span class="ident" id="4455977">i</span><span class="op" id="4455978">.</span><span class="ident" id="4455979">Arg</span><span class="op" id="4455982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455987">i</span><span class="op" id="4455988">.</span><span class="ident" id="4455989">Arg</span>&nbsp;<span class="op" id="4455993">=</span>&nbsp;<span class="ident" id="4455995">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456004">}</span><br>
<span class="lineno">40</span><span class="op" id="4456006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4456009">func</span>&nbsp;<span class="op" id="4456014">(</span><span class="ident" id="4456015">l1</span>&nbsp;<span class="ident" id="4456018">patchList</span><span class="op" id="4456027">)</span>&nbsp;<span class="builtinfunc" id="4456029">append</span><span class="op" id="4456035">(</span><span class="ident" id="4456036">p</span>&nbsp;<span class="op" id="4456038">*</span><span class="ident" id="4456039">Prog</span><span class="op" id="4456043">,</span>&nbsp;<span class="ident" id="4456045">l2</span>&nbsp;<span class="ident" id="4456048">patchList</span><span class="op" id="4456057">)</span>&nbsp;<span class="ident" id="4456059">patchList</span>&nbsp;<span class="op" id="4456069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456072">if</span>&nbsp;<span class="ident" id="4456075">l1</span>&nbsp;<span class="op" id="4456078">==</span>&nbsp;<span class="num" id="4456081">0</span>&nbsp;<span class="op" id="4456083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456087">return</span>&nbsp;<span class="ident" id="4456094">l2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456101">if</span>&nbsp;<span class="ident" id="4456104">l2</span>&nbsp;<span class="op" id="4456107">==</span>&nbsp;<span class="num" id="4456110">0</span>&nbsp;<span class="op" id="4456112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456116">return</span>&nbsp;<span class="ident" id="4456123">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456131">last</span>&nbsp;<span class="op" id="4456136">:=</span>&nbsp;<span class="ident" id="4456139">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456143">for</span>&nbsp;<span class="op" id="4456147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456151">next</span>&nbsp;<span class="op" id="4456156">:=</span>&nbsp;<span class="ident" id="4456159">last</span><span class="op" id="4456163">.</span><span class="ident" id="4456164">next</span><span class="op" id="4456168">(</span><span class="ident" id="4456169">p</span><span class="op" id="4456170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456174">if</span>&nbsp;<span class="ident" id="4456177">next</span>&nbsp;<span class="op" id="4456182">==</span>&nbsp;<span class="num" id="4456185">0</span>&nbsp;<span class="op" id="4456187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456192">break</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456204">last</span>&nbsp;<span class="op" id="4456209">=</span>&nbsp;<span class="ident" id="4456211">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456221">i</span>&nbsp;<span class="op" id="4456223">:=</span>&nbsp;<span class="op" id="4456226">&amp;</span><span class="ident" id="4456227">p</span><span class="op" id="4456228">.</span><span class="ident" id="4456229">Inst</span><span class="op" id="4456233">[</span><span class="ident" id="4456234">last</span><span class="op" id="4456238">&gt;&gt;</span><span class="num" id="4456240">1</span><span class="op" id="4456241">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456244">if</span>&nbsp;<span class="ident" id="4456247">last</span><span class="op" id="4456251">&amp;</span><span class="num" id="4456252">1</span>&nbsp;<span class="op" id="4456254">==</span>&nbsp;<span class="num" id="4456257">0</span>&nbsp;<span class="op" id="4456259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456263">i</span><span class="op" id="4456264">.</span><span class="ident" id="4456265">Out</span>&nbsp;<span class="op" id="4456269">=</span>&nbsp;<span class="builtintype" id="4456271">uint32</span><span class="op" id="4456277">(</span><span class="ident" id="4456278">l2</span><span class="op" id="4456280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456283">}</span>&nbsp;<span class="keyword" id="4456285">else</span>&nbsp;<span class="op" id="4456290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456294">i</span><span class="op" id="4456295">.</span><span class="ident" id="4456296">Arg</span>&nbsp;<span class="op" id="4456300">=</span>&nbsp;<span class="builtintype" id="4456302">uint32</span><span class="op" id="4456308">(</span><span class="ident" id="4456309">l2</span><span class="op" id="4456311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456314">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456317">return</span>&nbsp;<span class="ident" id="4456324">l1</span><br>
<span class="lineno"></span><span class="op" id="4456327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4456330">//&nbsp;A&nbsp;frag&nbsp;represents&nbsp;a&nbsp;compiled&nbsp;program&nbsp;fragment.</span><br>
<span class="lineno"></span><span class="keyword" id="4456380">type</span>&nbsp;<span class="ident" id="4456385">frag</span>&nbsp;<span class="keyword" id="4456390">struct</span>&nbsp;<span class="op" id="4456397">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456400">i</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4456404">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4456414">//&nbsp;index&nbsp;of&nbsp;first&nbsp;instruction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456445">out</span>&nbsp;<span class="ident" id="4456449">patchList</span>&nbsp;<span class="comment" id="4456459">//&nbsp;where&nbsp;to&nbsp;record&nbsp;end&nbsp;instruction</span><br>
<span class="lineno"></span><span class="op" id="4456494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4456497">type</span>&nbsp;<span class="ident" id="4456502">compiler</span>&nbsp;<span class="keyword" id="4456511">struct</span>&nbsp;<span class="op" id="4456518">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456521">p</span>&nbsp;<span class="op" id="4456523">*</span><span class="ident" id="4456524">Prog</span><br>
<span class="lineno"></span><span class="op" id="4456529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4456532">//&nbsp;Compile&nbsp;compiles&nbsp;the&nbsp;regexp&nbsp;into&nbsp;a&nbsp;program&nbsp;to&nbsp;be&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="4456594">//&nbsp;The&nbsp;regexp&nbsp;should&nbsp;have&nbsp;been&nbsp;simplified&nbsp;already&nbsp;(returned&nbsp;from&nbsp;re.Simplify).</span><br>
<span class="lineno">80</span><span class="keyword" id="4456673">func</span>&nbsp;<span class="ident" id="4456678">Compile</span><span class="op" id="4456685">(</span><span class="ident" id="4456686">re</span>&nbsp;<span class="op" id="4456689">*</span><span class="ident" id="4456690">Regexp</span><span class="op" id="4456696">)</span>&nbsp;<span class="op" id="4456698">(</span><span class="op" id="4456699">*</span><span class="ident" id="4456700">Prog</span><span class="op" id="4456704">,</span>&nbsp;<span class="builtintype" id="4456706">error</span><span class="op" id="4456711">)</span>&nbsp;<span class="op" id="4456713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456716">var</span>&nbsp;<span class="ident" id="4456720">c</span>&nbsp;<span class="ident" id="4456722">compiler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456732">c</span><span class="op" id="4456733">.</span><span class="ident" id="4456734">init</span><span class="op" id="4456738">(</span><span class="op" id="4456739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456742">f</span>&nbsp;<span class="op" id="4456744">:=</span>&nbsp;<span class="ident" id="4456747">c</span><span class="op" id="4456748">.</span><span class="ident" id="4456749">compile</span><span class="op" id="4456756">(</span><span class="ident" id="4456757">re</span><span class="op" id="4456759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456762">f</span><span class="op" id="4456763">.</span><span class="ident" id="4456764">out</span><span class="op" id="4456767">.</span><span class="ident" id="4456768">patch</span><span class="op" id="4456773">(</span><span class="ident" id="4456774">c</span><span class="op" id="4456775">.</span><span class="ident" id="4456776">p</span><span class="op" id="4456777">,</span>&nbsp;<span class="ident" id="4456779">c</span><span class="op" id="4456780">.</span><span class="ident" id="4456781">inst</span><span class="op" id="4456785">(</span><span class="ident" id="4456786">InstMatch</span><span class="op" id="4456795">)</span><span class="op" id="4456796">.</span><span class="ident" id="4456797">i</span><span class="op" id="4456798">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456801">c</span><span class="op" id="4456802">.</span><span class="ident" id="4456803">p</span><span class="op" id="4456804">.</span><span class="ident" id="4456805">Start</span>&nbsp;<span class="op" id="4456811">=</span>&nbsp;<span class="builtintype" id="4456813">int</span><span class="op" id="4456816">(</span><span class="ident" id="4456817">f</span><span class="op" id="4456818">.</span><span class="ident" id="4456819">i</span><span class="op" id="4456820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456823">return</span>&nbsp;<span class="ident" id="4456830">c</span><span class="op" id="4456831">.</span><span class="ident" id="4456832">p</span><span class="op" id="4456833">,</span>&nbsp;<span class="ident" id="4456835">nil</span><br>
<span class="lineno"></span><span class="op" id="4456839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4456842">func</span>&nbsp;<span class="op" id="4456847">(</span><span class="ident" id="4456848">c</span>&nbsp;<span class="op" id="4456850">*</span><span class="ident" id="4456851">compiler</span><span class="op" id="4456859">)</span>&nbsp;<span class="ident" id="4456861">init</span><span class="op" id="4456865">(</span><span class="op" id="4456866">)</span>&nbsp;<span class="op" id="4456868">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456871">c</span><span class="op" id="4456872">.</span><span class="ident" id="4456873">p</span>&nbsp;<span class="op" id="4456875">=</span>&nbsp;<span class="builtinfunc" id="4456877">new</span><span class="op" id="4456880">(</span><span class="ident" id="4456881">Prog</span><span class="op" id="4456885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456888">c</span><span class="op" id="4456889">.</span><span class="ident" id="4456890">p</span><span class="op" id="4456891">.</span><span class="ident" id="4456892">NumCap</span>&nbsp;<span class="op" id="4456899">=</span>&nbsp;<span class="num" id="4456901">2</span>&nbsp;<span class="comment" id="4456903">//&nbsp;implicit&nbsp;(&nbsp;and&nbsp;)&nbsp;for&nbsp;whole&nbsp;match&nbsp;$0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456943">c</span><span class="op" id="4456944">.</span><span class="ident" id="4456945">inst</span><span class="op" id="4456949">(</span><span class="ident" id="4456950">InstFail</span><span class="op" id="4456958">)</span><br>
<span class="lineno"></span><span class="op" id="4456960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4456963">var</span>&nbsp;<span class="ident" id="4456967">anyRuneNotNL</span>&nbsp;<span class="op" id="4456980">=</span>&nbsp;<span class="op" id="4456982">[</span><span class="op" id="4456983">]</span><span class="builtintype" id="4456984">rune</span><span class="op" id="4456988">{</span><span class="num" id="4456989">0</span><span class="op" id="4456990">,</span>&nbsp;<span class="string" id="4456992">&#39;\n&#39;</span>&nbsp;<span class="op" id="4456997">-</span>&nbsp;<span class="num" id="4456999">1</span><span class="op" id="4457000">,</span>&nbsp;<span class="string" id="4457002">&#39;\n&#39;</span>&nbsp;<span class="op" id="4457007">+</span>&nbsp;<span class="num" id="4457009">1</span><span class="op" id="4457010">,</span>&nbsp;<span class="ident" id="4457012">unicode</span><span class="op" id="4457019">.</span><span class="ident" id="4457020">MaxRune</span><span class="op" id="4457027">}</span><br>
<span class="lineno"></span><span class="keyword" id="4457029">var</span>&nbsp;<span class="ident" id="4457033">anyRune</span>&nbsp;<span class="op" id="4457041">=</span>&nbsp;<span class="op" id="4457043">[</span><span class="op" id="4457044">]</span><span class="builtintype" id="4457045">rune</span><span class="op" id="4457049">{</span><span class="num" id="4457050">0</span><span class="op" id="4457051">,</span>&nbsp;<span class="ident" id="4457053">unicode</span><span class="op" id="4457060">.</span><span class="ident" id="4457061">MaxRune</span><span class="op" id="4457068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4457071">func</span>&nbsp;<span class="op" id="4457076">(</span><span class="ident" id="4457077">c</span>&nbsp;<span class="op" id="4457079">*</span><span class="ident" id="4457080">compiler</span><span class="op" id="4457088">)</span>&nbsp;<span class="ident" id="4457090">compile</span><span class="op" id="4457097">(</span><span class="ident" id="4457098">re</span>&nbsp;<span class="op" id="4457101">*</span><span class="ident" id="4457102">Regexp</span><span class="op" id="4457108">)</span>&nbsp;<span class="ident" id="4457110">frag</span>&nbsp;<span class="op" id="4457115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457118">switch</span>&nbsp;<span class="ident" id="4457125">re</span><span class="op" id="4457127">.</span><span class="ident" id="4457128">Op</span>&nbsp;<span class="op" id="4457131">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457134">case</span>&nbsp;<span class="ident" id="4457139">OpNoMatch</span><span class="op" id="4457148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457152">return</span>&nbsp;<span class="ident" id="4457159">c</span><span class="op" id="4457160">.</span><span class="ident" id="4457161">fail</span><span class="op" id="4457165">(</span><span class="op" id="4457166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457169">case</span>&nbsp;<span class="ident" id="4457174">OpEmptyMatch</span><span class="op" id="4457186">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457190">return</span>&nbsp;<span class="ident" id="4457197">c</span><span class="op" id="4457198">.</span><span class="ident" id="4457199">nop</span><span class="op" id="4457202">(</span><span class="op" id="4457203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457206">case</span>&nbsp;<span class="ident" id="4457211">OpLiteral</span><span class="op" id="4457220">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457224">if</span>&nbsp;<span class="builtinfunc" id="4457227">len</span><span class="op" id="4457230">(</span><span class="ident" id="4457231">re</span><span class="op" id="4457233">.</span><span class="ident" id="4457234">Rune</span><span class="op" id="4457238">)</span>&nbsp;<span class="op" id="4457240">==</span>&nbsp;<span class="num" id="4457243">0</span>&nbsp;<span class="op" id="4457245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457250">return</span>&nbsp;<span class="ident" id="4457257">c</span><span class="op" id="4457258">.</span><span class="ident" id="4457259">nop</span><span class="op" id="4457262">(</span><span class="op" id="4457263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4457267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457271">var</span>&nbsp;<span class="ident" id="4457275">f</span>&nbsp;<span class="ident" id="4457277">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457284">for</span>&nbsp;<span class="ident" id="4457288">j</span>&nbsp;<span class="op" id="4457290">:=</span>&nbsp;<span class="keyword" id="4457293">range</span>&nbsp;<span class="ident" id="4457299">re</span><span class="op" id="4457301">.</span><span class="ident" id="4457302">Rune</span>&nbsp;<span class="op" id="4457307">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457312">f1</span>&nbsp;<span class="op" id="4457315">:=</span>&nbsp;<span class="ident" id="4457318">c</span><span class="op" id="4457319">.</span><span class="builtintype" id="4457320">rune</span><span class="op" id="4457324">(</span><span class="ident" id="4457325">re</span><span class="op" id="4457327">.</span><span class="ident" id="4457328">Rune</span><span class="op" id="4457332">[</span><span class="ident" id="4457333">j</span><span class="op" id="4457334">:</span><span class="ident" id="4457335">j</span><span class="op" id="4457336">+</span><span class="num" id="4457337">1</span><span class="op" id="4457338">]</span><span class="op" id="4457339">,</span>&nbsp;<span class="ident" id="4457341">re</span><span class="op" id="4457343">.</span><span class="ident" id="4457344">Flags</span><span class="op" id="4457349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457354">if</span>&nbsp;<span class="ident" id="4457357">j</span>&nbsp;<span class="op" id="4457359">==</span>&nbsp;<span class="num" id="4457362">0</span>&nbsp;<span class="op" id="4457364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457370">f</span>&nbsp;<span class="op" id="4457372">=</span>&nbsp;<span class="ident" id="4457374">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4457380">}</span>&nbsp;<span class="keyword" id="4457382">else</span>&nbsp;<span class="op" id="4457387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457393">f</span>&nbsp;<span class="op" id="4457395">=</span>&nbsp;<span class="ident" id="4457397">c</span><span class="op" id="4457398">.</span><span class="ident" id="4457399">cat</span><span class="op" id="4457402">(</span><span class="ident" id="4457403">f</span><span class="op" id="4457404">,</span>&nbsp;<span class="ident" id="4457406">f1</span><span class="op" id="4457408">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4457413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4457417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457421">return</span>&nbsp;<span class="ident" id="4457428">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457431">case</span>&nbsp;<span class="ident" id="4457436">OpCharClass</span><span class="op" id="4457447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457451">return</span>&nbsp;<span class="ident" id="4457458">c</span><span class="op" id="4457459">.</span><span class="builtintype" id="4457460">rune</span><span class="op" id="4457464">(</span><span class="ident" id="4457465">re</span><span class="op" id="4457467">.</span><span class="ident" id="4457468">Rune</span><span class="op" id="4457472">,</span>&nbsp;<span class="ident" id="4457474">re</span><span class="op" id="4457476">.</span><span class="ident" id="4457477">Flags</span><span class="op" id="4457482">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457485">case</span>&nbsp;<span class="ident" id="4457490">OpAnyCharNotNL</span><span class="op" id="4457504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457508">return</span>&nbsp;<span class="ident" id="4457515">c</span><span class="op" id="4457516">.</span><span class="builtintype" id="4457517">rune</span><span class="op" id="4457521">(</span><span class="ident" id="4457522">anyRuneNotNL</span><span class="op" id="4457534">,</span>&nbsp;<span class="num" id="4457536">0</span><span class="op" id="4457537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457540">case</span>&nbsp;<span class="ident" id="4457545">OpAnyChar</span><span class="op" id="4457554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457558">return</span>&nbsp;<span class="ident" id="4457565">c</span><span class="op" id="4457566">.</span><span class="builtintype" id="4457567">rune</span><span class="op" id="4457571">(</span><span class="ident" id="4457572">anyRune</span><span class="op" id="4457579">,</span>&nbsp;<span class="num" id="4457581">0</span><span class="op" id="4457582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457585">case</span>&nbsp;<span class="ident" id="4457590">OpBeginLine</span><span class="op" id="4457601">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457605">return</span>&nbsp;<span class="ident" id="4457612">c</span><span class="op" id="4457613">.</span><span class="ident" id="4457614">empty</span><span class="op" id="4457619">(</span><span class="ident" id="4457620">EmptyBeginLine</span><span class="op" id="4457634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457637">case</span>&nbsp;<span class="ident" id="4457642">OpEndLine</span><span class="op" id="4457651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457655">return</span>&nbsp;<span class="ident" id="4457662">c</span><span class="op" id="4457663">.</span><span class="ident" id="4457664">empty</span><span class="op" id="4457669">(</span><span class="ident" id="4457670">EmptyEndLine</span><span class="op" id="4457682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457685">case</span>&nbsp;<span class="ident" id="4457690">OpBeginText</span><span class="op" id="4457701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457705">return</span>&nbsp;<span class="ident" id="4457712">c</span><span class="op" id="4457713">.</span><span class="ident" id="4457714">empty</span><span class="op" id="4457719">(</span><span class="ident" id="4457720">EmptyBeginText</span><span class="op" id="4457734">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457737">case</span>&nbsp;<span class="ident" id="4457742">OpEndText</span><span class="op" id="4457751">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457755">return</span>&nbsp;<span class="ident" id="4457762">c</span><span class="op" id="4457763">.</span><span class="ident" id="4457764">empty</span><span class="op" id="4457769">(</span><span class="ident" id="4457770">EmptyEndText</span><span class="op" id="4457782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457785">case</span>&nbsp;<span class="ident" id="4457790">OpWordBoundary</span><span class="op" id="4457804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457808">return</span>&nbsp;<span class="ident" id="4457815">c</span><span class="op" id="4457816">.</span><span class="ident" id="4457817">empty</span><span class="op" id="4457822">(</span><span class="ident" id="4457823">EmptyWordBoundary</span><span class="op" id="4457840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457843">case</span>&nbsp;<span class="ident" id="4457848">OpNoWordBoundary</span><span class="op" id="4457864">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457868">return</span>&nbsp;<span class="ident" id="4457875">c</span><span class="op" id="4457876">.</span><span class="ident" id="4457877">empty</span><span class="op" id="4457882">(</span><span class="ident" id="4457883">EmptyNoWordBoundary</span><span class="op" id="4457902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457905">case</span>&nbsp;<span class="ident" id="4457910">OpCapture</span><span class="op" id="4457919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457923">bra</span>&nbsp;<span class="op" id="4457927">:=</span>&nbsp;<span class="ident" id="4457930">c</span><span class="op" id="4457931">.</span><span class="builtinfunc" id="4457932">cap</span><span class="op" id="4457935">(</span><span class="builtintype" id="4457936">uint32</span><span class="op" id="4457942">(</span><span class="ident" id="4457943">re</span><span class="op" id="4457945">.</span><span class="ident" id="4457946">Cap</span>&nbsp;<span class="op" id="4457950">&lt;&lt;</span>&nbsp;<span class="num" id="4457953">1</span><span class="op" id="4457954">)</span><span class="op" id="4457955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457959">sub</span>&nbsp;<span class="op" id="4457963">:=</span>&nbsp;<span class="ident" id="4457966">c</span><span class="op" id="4457967">.</span><span class="ident" id="4457968">compile</span><span class="op" id="4457975">(</span><span class="ident" id="4457976">re</span><span class="op" id="4457978">.</span><span class="ident" id="4457979">Sub</span><span class="op" id="4457982">[</span><span class="num" id="4457983">0</span><span class="op" id="4457984">]</span><span class="op" id="4457985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457989">ket</span>&nbsp;<span class="op" id="4457993">:=</span>&nbsp;<span class="ident" id="4457996">c</span><span class="op" id="4457997">.</span><span class="builtinfunc" id="4457998">cap</span><span class="op" id="4458001">(</span><span class="builtintype" id="4458002">uint32</span><span class="op" id="4458008">(</span><span class="ident" id="4458009">re</span><span class="op" id="4458011">.</span><span class="ident" id="4458012">Cap</span><span class="op" id="4458015">&lt;&lt;</span><span class="num" id="4458017">1</span>&nbsp;<span class="op" id="4458019">|</span>&nbsp;<span class="num" id="4458021">1</span><span class="op" id="4458022">)</span><span class="op" id="4458023">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458027">return</span>&nbsp;<span class="ident" id="4458034">c</span><span class="op" id="4458035">.</span><span class="ident" id="4458036">cat</span><span class="op" id="4458039">(</span><span class="ident" id="4458040">c</span><span class="op" id="4458041">.</span><span class="ident" id="4458042">cat</span><span class="op" id="4458045">(</span><span class="ident" id="4458046">bra</span><span class="op" id="4458049">,</span>&nbsp;<span class="ident" id="4458051">sub</span><span class="op" id="4458054">)</span><span class="op" id="4458055">,</span>&nbsp;<span class="ident" id="4458057">ket</span><span class="op" id="4458060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458063">case</span>&nbsp;<span class="ident" id="4458068">OpStar</span><span class="op" id="4458074">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458078">return</span>&nbsp;<span class="ident" id="4458085">c</span><span class="op" id="4458086">.</span><span class="ident" id="4458087">star</span><span class="op" id="4458091">(</span><span class="ident" id="4458092">c</span><span class="op" id="4458093">.</span><span class="ident" id="4458094">compile</span><span class="op" id="4458101">(</span><span class="ident" id="4458102">re</span><span class="op" id="4458104">.</span><span class="ident" id="4458105">Sub</span><span class="op" id="4458108">[</span><span class="num" id="4458109">0</span><span class="op" id="4458110">]</span><span class="op" id="4458111">)</span><span class="op" id="4458112">,</span>&nbsp;<span class="ident" id="4458114">re</span><span class="op" id="4458116">.</span><span class="ident" id="4458117">Flags</span><span class="op" id="4458122">&amp;</span><span class="ident" id="4458123">NonGreedy</span>&nbsp;<span class="op" id="4458133">!=</span>&nbsp;<span class="num" id="4458136">0</span><span class="op" id="4458137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458140">case</span>&nbsp;<span class="ident" id="4458145">OpPlus</span><span class="op" id="4458151">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458155">return</span>&nbsp;<span class="ident" id="4458162">c</span><span class="op" id="4458163">.</span><span class="ident" id="4458164">plus</span><span class="op" id="4458168">(</span><span class="ident" id="4458169">c</span><span class="op" id="4458170">.</span><span class="ident" id="4458171">compile</span><span class="op" id="4458178">(</span><span class="ident" id="4458179">re</span><span class="op" id="4458181">.</span><span class="ident" id="4458182">Sub</span><span class="op" id="4458185">[</span><span class="num" id="4458186">0</span><span class="op" id="4458187">]</span><span class="op" id="4458188">)</span><span class="op" id="4458189">,</span>&nbsp;<span class="ident" id="4458191">re</span><span class="op" id="4458193">.</span><span class="ident" id="4458194">Flags</span><span class="op" id="4458199">&amp;</span><span class="ident" id="4458200">NonGreedy</span>&nbsp;<span class="op" id="4458210">!=</span>&nbsp;<span class="num" id="4458213">0</span><span class="op" id="4458214">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458217">case</span>&nbsp;<span class="ident" id="4458222">OpQuest</span><span class="op" id="4458229">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458233">return</span>&nbsp;<span class="ident" id="4458240">c</span><span class="op" id="4458241">.</span><span class="ident" id="4458242">quest</span><span class="op" id="4458247">(</span><span class="ident" id="4458248">c</span><span class="op" id="4458249">.</span><span class="ident" id="4458250">compile</span><span class="op" id="4458257">(</span><span class="ident" id="4458258">re</span><span class="op" id="4458260">.</span><span class="ident" id="4458261">Sub</span><span class="op" id="4458264">[</span><span class="num" id="4458265">0</span><span class="op" id="4458266">]</span><span class="op" id="4458267">)</span><span class="op" id="4458268">,</span>&nbsp;<span class="ident" id="4458270">re</span><span class="op" id="4458272">.</span><span class="ident" id="4458273">Flags</span><span class="op" id="4458278">&amp;</span><span class="ident" id="4458279">NonGreedy</span>&nbsp;<span class="op" id="4458289">!=</span>&nbsp;<span class="num" id="4458292">0</span><span class="op" id="4458293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458296">case</span>&nbsp;<span class="ident" id="4458301">OpConcat</span><span class="op" id="4458309">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458313">if</span>&nbsp;<span class="builtinfunc" id="4458316">len</span><span class="op" id="4458319">(</span><span class="ident" id="4458320">re</span><span class="op" id="4458322">.</span><span class="ident" id="4458323">Sub</span><span class="op" id="4458326">)</span>&nbsp;<span class="op" id="4458328">==</span>&nbsp;<span class="num" id="4458331">0</span>&nbsp;<span class="op" id="4458333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458338">return</span>&nbsp;<span class="ident" id="4458345">c</span><span class="op" id="4458346">.</span><span class="ident" id="4458347">nop</span><span class="op" id="4458350">(</span><span class="op" id="4458351">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4458355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458359">var</span>&nbsp;<span class="ident" id="4458363">f</span>&nbsp;<span class="ident" id="4458365">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458372">for</span>&nbsp;<span class="ident" id="4458376">i</span><span class="op" id="4458377">,</span>&nbsp;<span class="ident" id="4458379">sub</span>&nbsp;<span class="op" id="4458383">:=</span>&nbsp;<span class="keyword" id="4458386">range</span>&nbsp;<span class="ident" id="4458392">re</span><span class="op" id="4458394">.</span><span class="ident" id="4458395">Sub</span>&nbsp;<span class="op" id="4458399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458404">if</span>&nbsp;<span class="ident" id="4458407">i</span>&nbsp;<span class="op" id="4458409">==</span>&nbsp;<span class="num" id="4458412">0</span>&nbsp;<span class="op" id="4458414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458420">f</span>&nbsp;<span class="op" id="4458422">=</span>&nbsp;<span class="ident" id="4458424">c</span><span class="op" id="4458425">.</span><span class="ident" id="4458426">compile</span><span class="op" id="4458433">(</span><span class="ident" id="4458434">sub</span><span class="op" id="4458437">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4458442">}</span>&nbsp;<span class="keyword" id="4458444">else</span>&nbsp;<span class="op" id="4458449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458455">f</span>&nbsp;<span class="op" id="4458457">=</span>&nbsp;<span class="ident" id="4458459">c</span><span class="op" id="4458460">.</span><span class="ident" id="4458461">cat</span><span class="op" id="4458464">(</span><span class="ident" id="4458465">f</span><span class="op" id="4458466">,</span>&nbsp;<span class="ident" id="4458468">c</span><span class="op" id="4458469">.</span><span class="ident" id="4458470">compile</span><span class="op" id="4458477">(</span><span class="ident" id="4458478">sub</span><span class="op" id="4458481">)</span><span class="op" id="4458482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4458487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4458491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458495">return</span>&nbsp;<span class="ident" id="4458502">f</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458505">case</span>&nbsp;<span class="ident" id="4458510">OpAlternate</span><span class="op" id="4458521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458525">var</span>&nbsp;<span class="ident" id="4458529">f</span>&nbsp;<span class="ident" id="4458531">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458538">for</span>&nbsp;<span class="ident" id="4458542">_</span><span class="op" id="4458543">,</span>&nbsp;<span class="ident" id="4458545">sub</span>&nbsp;<span class="op" id="4458549">:=</span>&nbsp;<span class="keyword" id="4458552">range</span>&nbsp;<span class="ident" id="4458558">re</span><span class="op" id="4458560">.</span><span class="ident" id="4458561">Sub</span>&nbsp;<span class="op" id="4458565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458570">f</span>&nbsp;<span class="op" id="4458572">=</span>&nbsp;<span class="ident" id="4458574">c</span><span class="op" id="4458575">.</span><span class="ident" id="4458576">alt</span><span class="op" id="4458579">(</span><span class="ident" id="4458580">f</span><span class="op" id="4458581">,</span>&nbsp;<span class="ident" id="4458583">c</span><span class="op" id="4458584">.</span><span class="ident" id="4458585">compile</span><span class="op" id="4458592">(</span><span class="ident" id="4458593">sub</span><span class="op" id="4458596">)</span><span class="op" id="4458597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4458601">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458605">return</span>&nbsp;<span class="ident" id="4458612">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4458615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4458618">panic</span><span class="op" id="4458623">(</span><span class="string" id="4458624">&#34;regexp:&nbsp;unhandled&nbsp;case&nbsp;in&nbsp;compile&#34;</span><span class="op" id="4458659">)</span><br>
<span class="lineno"></span><span class="op" id="4458661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="4458664">func</span>&nbsp;<span class="op" id="4458669">(</span><span class="ident" id="4458670">c</span>&nbsp;<span class="op" id="4458672">*</span><span class="ident" id="4458673">compiler</span><span class="op" id="4458681">)</span>&nbsp;<span class="ident" id="4458683">inst</span><span class="op" id="4458687">(</span><span class="ident" id="4458688">op</span>&nbsp;<span class="ident" id="4458691">InstOp</span><span class="op" id="4458697">)</span>&nbsp;<span class="ident" id="4458699">frag</span>&nbsp;<span class="op" id="4458704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4458707">//&nbsp;TODO:&nbsp;impose&nbsp;length&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458737">f</span>&nbsp;<span class="op" id="4458739">:=</span>&nbsp;<span class="ident" id="4458742">frag</span><span class="op" id="4458746">{</span><span class="ident" id="4458747">i</span><span class="op" id="4458748">:</span>&nbsp;<span class="builtintype" id="4458750">uint32</span><span class="op" id="4458756">(</span><span class="builtinfunc" id="4458757">len</span><span class="op" id="4458760">(</span><span class="ident" id="4458761">c</span><span class="op" id="4458762">.</span><span class="ident" id="4458763">p</span><span class="op" id="4458764">.</span><span class="ident" id="4458765">Inst</span><span class="op" id="4458769">)</span><span class="op" id="4458770">)</span><span class="op" id="4458771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458774">c</span><span class="op" id="4458775">.</span><span class="ident" id="4458776">p</span><span class="op" id="4458777">.</span><span class="ident" id="4458778">Inst</span>&nbsp;<span class="op" id="4458783">=</span>&nbsp;<span class="builtinfunc" id="4458785">append</span><span class="op" id="4458791">(</span><span class="ident" id="4458792">c</span><span class="op" id="4458793">.</span><span class="ident" id="4458794">p</span><span class="op" id="4458795">.</span><span class="ident" id="4458796">Inst</span><span class="op" id="4458800">,</span>&nbsp;<span class="ident" id="4458802">Inst</span><span class="op" id="4458806">{</span><span class="ident" id="4458807">Op</span><span class="op" id="4458809">:</span>&nbsp;<span class="ident" id="4458811">op</span><span class="op" id="4458813">}</span><span class="op" id="4458814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458817">return</span>&nbsp;<span class="ident" id="4458824">f</span><br>
<span class="lineno">175</span><span class="op" id="4458826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4458829">func</span>&nbsp;<span class="op" id="4458834">(</span><span class="ident" id="4458835">c</span>&nbsp;<span class="op" id="4458837">*</span><span class="ident" id="4458838">compiler</span><span class="op" id="4458846">)</span>&nbsp;<span class="ident" id="4458848">nop</span><span class="op" id="4458851">(</span><span class="op" id="4458852">)</span>&nbsp;<span class="ident" id="4458854">frag</span>&nbsp;<span class="op" id="4458859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458862">f</span>&nbsp;<span class="op" id="4458864">:=</span>&nbsp;<span class="ident" id="4458867">c</span><span class="op" id="4458868">.</span><span class="ident" id="4458869">inst</span><span class="op" id="4458873">(</span><span class="ident" id="4458874">InstNop</span><span class="op" id="4458881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458884">f</span><span class="op" id="4458885">.</span><span class="ident" id="4458886">out</span>&nbsp;<span class="op" id="4458890">=</span>&nbsp;<span class="ident" id="4458892">patchList</span><span class="op" id="4458901">(</span><span class="ident" id="4458902">f</span><span class="op" id="4458903">.</span><span class="ident" id="4458904">i</span>&nbsp;<span class="op" id="4458906">&lt;&lt;</span>&nbsp;<span class="num" id="4458909">1</span><span class="op" id="4458910">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458913">return</span>&nbsp;<span class="ident" id="4458920">f</span><br>
<span class="lineno"></span><span class="op" id="4458922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4458925">func</span>&nbsp;<span class="op" id="4458930">(</span><span class="ident" id="4458931">c</span>&nbsp;<span class="op" id="4458933">*</span><span class="ident" id="4458934">compiler</span><span class="op" id="4458942">)</span>&nbsp;<span class="ident" id="4458944">fail</span><span class="op" id="4458948">(</span><span class="op" id="4458949">)</span>&nbsp;<span class="ident" id="4458951">frag</span>&nbsp;<span class="op" id="4458956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458959">return</span>&nbsp;<span class="ident" id="4458966">frag</span><span class="op" id="4458970">{</span><span class="op" id="4458971">}</span><br>
<span class="lineno">185</span><span class="op" id="4458973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4458976">func</span>&nbsp;<span class="op" id="4458981">(</span><span class="ident" id="4458982">c</span>&nbsp;<span class="op" id="4458984">*</span><span class="ident" id="4458985">compiler</span><span class="op" id="4458993">)</span>&nbsp;<span class="builtinfunc" id="4458995">cap</span><span class="op" id="4458998">(</span><span class="ident" id="4458999">arg</span>&nbsp;<span class="builtintype" id="4459003">uint32</span><span class="op" id="4459009">)</span>&nbsp;<span class="ident" id="4459011">frag</span>&nbsp;<span class="op" id="4459016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459019">f</span>&nbsp;<span class="op" id="4459021">:=</span>&nbsp;<span class="ident" id="4459024">c</span><span class="op" id="4459025">.</span><span class="ident" id="4459026">inst</span><span class="op" id="4459030">(</span><span class="ident" id="4459031">InstCapture</span><span class="op" id="4459042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459045">f</span><span class="op" id="4459046">.</span><span class="ident" id="4459047">out</span>&nbsp;<span class="op" id="4459051">=</span>&nbsp;<span class="ident" id="4459053">patchList</span><span class="op" id="4459062">(</span><span class="ident" id="4459063">f</span><span class="op" id="4459064">.</span><span class="ident" id="4459065">i</span>&nbsp;<span class="op" id="4459067">&lt;&lt;</span>&nbsp;<span class="num" id="4459070">1</span><span class="op" id="4459071">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459074">c</span><span class="op" id="4459075">.</span><span class="ident" id="4459076">p</span><span class="op" id="4459077">.</span><span class="ident" id="4459078">Inst</span><span class="op" id="4459082">[</span><span class="ident" id="4459083">f</span><span class="op" id="4459084">.</span><span class="ident" id="4459085">i</span><span class="op" id="4459086">]</span><span class="op" id="4459087">.</span><span class="ident" id="4459088">Arg</span>&nbsp;<span class="op" id="4459092">=</span>&nbsp;<span class="ident" id="4459094">arg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459100">if</span>&nbsp;<span class="ident" id="4459103">c</span><span class="op" id="4459104">.</span><span class="ident" id="4459105">p</span><span class="op" id="4459106">.</span><span class="ident" id="4459107">NumCap</span>&nbsp;<span class="op" id="4459114">&lt;</span>&nbsp;<span class="builtintype" id="4459116">int</span><span class="op" id="4459119">(</span><span class="ident" id="4459120">arg</span><span class="op" id="4459123">)</span><span class="op" id="4459124">+</span><span class="num" id="4459125">1</span>&nbsp;<span class="op" id="4459127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459131">c</span><span class="op" id="4459132">.</span><span class="ident" id="4459133">p</span><span class="op" id="4459134">.</span><span class="ident" id="4459135">NumCap</span>&nbsp;<span class="op" id="4459142">=</span>&nbsp;<span class="builtintype" id="4459144">int</span><span class="op" id="4459147">(</span><span class="ident" id="4459148">arg</span><span class="op" id="4459151">)</span>&nbsp;<span class="op" id="4459153">+</span>&nbsp;<span class="num" id="4459155">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4459158">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459161">return</span>&nbsp;<span class="ident" id="4459168">f</span><br>
<span class="lineno"></span><span class="op" id="4459170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4459173">func</span>&nbsp;<span class="op" id="4459178">(</span><span class="ident" id="4459179">c</span>&nbsp;<span class="op" id="4459181">*</span><span class="ident" id="4459182">compiler</span><span class="op" id="4459190">)</span>&nbsp;<span class="ident" id="4459192">cat</span><span class="op" id="4459195">(</span><span class="ident" id="4459196">f1</span><span class="op" id="4459198">,</span>&nbsp;<span class="ident" id="4459200">f2</span>&nbsp;<span class="ident" id="4459203">frag</span><span class="op" id="4459207">)</span>&nbsp;<span class="ident" id="4459209">frag</span>&nbsp;<span class="op" id="4459214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4459217">//&nbsp;concat&nbsp;of&nbsp;failure&nbsp;is&nbsp;failure</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459250">if</span>&nbsp;<span class="ident" id="4459253">f1</span><span class="op" id="4459255">.</span><span class="ident" id="4459256">i</span>&nbsp;<span class="op" id="4459258">==</span>&nbsp;<span class="num" id="4459261">0</span>&nbsp;<span class="op" id="4459263">||</span>&nbsp;<span class="ident" id="4459266">f2</span><span class="op" id="4459268">.</span><span class="ident" id="4459269">i</span>&nbsp;<span class="op" id="4459271">==</span>&nbsp;<span class="num" id="4459274">0</span>&nbsp;<span class="op" id="4459276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459280">return</span>&nbsp;<span class="ident" id="4459287">frag</span><span class="op" id="4459291">{</span><span class="op" id="4459292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4459295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4459299">//&nbsp;TODO:&nbsp;elide&nbsp;nop</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459320">f1</span><span class="op" id="4459322">.</span><span class="ident" id="4459323">out</span><span class="op" id="4459326">.</span><span class="ident" id="4459327">patch</span><span class="op" id="4459332">(</span><span class="ident" id="4459333">c</span><span class="op" id="4459334">.</span><span class="ident" id="4459335">p</span><span class="op" id="4459336">,</span>&nbsp;<span class="ident" id="4459338">f2</span><span class="op" id="4459340">.</span><span class="ident" id="4459341">i</span><span class="op" id="4459342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459345">return</span>&nbsp;<span class="ident" id="4459352">frag</span><span class="op" id="4459356">{</span><span class="ident" id="4459357">f1</span><span class="op" id="4459359">.</span><span class="ident" id="4459360">i</span><span class="op" id="4459361">,</span>&nbsp;<span class="ident" id="4459363">f2</span><span class="op" id="4459365">.</span><span class="ident" id="4459366">out</span><span class="op" id="4459369">}</span><br>
<span class="lineno"></span><span class="op" id="4459371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="4459374">func</span>&nbsp;<span class="op" id="4459379">(</span><span class="ident" id="4459380">c</span>&nbsp;<span class="op" id="4459382">*</span><span class="ident" id="4459383">compiler</span><span class="op" id="4459391">)</span>&nbsp;<span class="ident" id="4459393">alt</span><span class="op" id="4459396">(</span><span class="ident" id="4459397">f1</span><span class="op" id="4459399">,</span>&nbsp;<span class="ident" id="4459401">f2</span>&nbsp;<span class="ident" id="4459404">frag</span><span class="op" id="4459408">)</span>&nbsp;<span class="ident" id="4459410">frag</span>&nbsp;<span class="op" id="4459415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4459418">//&nbsp;alt&nbsp;of&nbsp;failure&nbsp;is&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459446">if</span>&nbsp;<span class="ident" id="4459449">f1</span><span class="op" id="4459451">.</span><span class="ident" id="4459452">i</span>&nbsp;<span class="op" id="4459454">==</span>&nbsp;<span class="num" id="4459457">0</span>&nbsp;<span class="op" id="4459459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459463">return</span>&nbsp;<span class="ident" id="4459470">f2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4459474">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459477">if</span>&nbsp;<span class="ident" id="4459480">f2</span><span class="op" id="4459482">.</span><span class="ident" id="4459483">i</span>&nbsp;<span class="op" id="4459485">==</span>&nbsp;<span class="num" id="4459488">0</span>&nbsp;<span class="op" id="4459490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459494">return</span>&nbsp;<span class="ident" id="4459501">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4459505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459509">f</span>&nbsp;<span class="op" id="4459511">:=</span>&nbsp;<span class="ident" id="4459514">c</span><span class="op" id="4459515">.</span><span class="ident" id="4459516">inst</span><span class="op" id="4459520">(</span><span class="ident" id="4459521">InstAlt</span><span class="op" id="4459528">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459531">i</span>&nbsp;<span class="op" id="4459533">:=</span>&nbsp;<span class="op" id="4459536">&amp;</span><span class="ident" id="4459537">c</span><span class="op" id="4459538">.</span><span class="ident" id="4459539">p</span><span class="op" id="4459540">.</span><span class="ident" id="4459541">Inst</span><span class="op" id="4459545">[</span><span class="ident" id="4459546">f</span><span class="op" id="4459547">.</span><span class="ident" id="4459548">i</span><span class="op" id="4459549">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459552">i</span><span class="op" id="4459553">.</span><span class="ident" id="4459554">Out</span>&nbsp;<span class="op" id="4459558">=</span>&nbsp;<span class="ident" id="4459560">f1</span><span class="op" id="4459562">.</span><span class="ident" id="4459563">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459566">i</span><span class="op" id="4459567">.</span><span class="ident" id="4459568">Arg</span>&nbsp;<span class="op" id="4459572">=</span>&nbsp;<span class="ident" id="4459574">f2</span><span class="op" id="4459576">.</span><span class="ident" id="4459577">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459580">f</span><span class="op" id="4459581">.</span><span class="ident" id="4459582">out</span>&nbsp;<span class="op" id="4459586">=</span>&nbsp;<span class="ident" id="4459588">f1</span><span class="op" id="4459590">.</span><span class="ident" id="4459591">out</span><span class="op" id="4459594">.</span><span class="builtinfunc" id="4459595">append</span><span class="op" id="4459601">(</span><span class="ident" id="4459602">c</span><span class="op" id="4459603">.</span><span class="ident" id="4459604">p</span><span class="op" id="4459605">,</span>&nbsp;<span class="ident" id="4459607">f2</span><span class="op" id="4459609">.</span><span class="ident" id="4459610">out</span><span class="op" id="4459613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459616">return</span>&nbsp;<span class="ident" id="4459623">f</span><br>
<span class="lineno">225</span><span class="op" id="4459625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4459628">func</span>&nbsp;<span class="op" id="4459633">(</span><span class="ident" id="4459634">c</span>&nbsp;<span class="op" id="4459636">*</span><span class="ident" id="4459637">compiler</span><span class="op" id="4459645">)</span>&nbsp;<span class="ident" id="4459647">quest</span><span class="op" id="4459652">(</span><span class="ident" id="4459653">f1</span>&nbsp;<span class="ident" id="4459656">frag</span><span class="op" id="4459660">,</span>&nbsp;<span class="ident" id="4459662">nongreedy</span>&nbsp;<span class="builtintype" id="4459672">bool</span><span class="op" id="4459676">)</span>&nbsp;<span class="ident" id="4459678">frag</span>&nbsp;<span class="op" id="4459683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459686">f</span>&nbsp;<span class="op" id="4459688">:=</span>&nbsp;<span class="ident" id="4459691">c</span><span class="op" id="4459692">.</span><span class="ident" id="4459693">inst</span><span class="op" id="4459697">(</span><span class="ident" id="4459698">InstAlt</span><span class="op" id="4459705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459708">i</span>&nbsp;<span class="op" id="4459710">:=</span>&nbsp;<span class="op" id="4459713">&amp;</span><span class="ident" id="4459714">c</span><span class="op" id="4459715">.</span><span class="ident" id="4459716">p</span><span class="op" id="4459717">.</span><span class="ident" id="4459718">Inst</span><span class="op" id="4459722">[</span><span class="ident" id="4459723">f</span><span class="op" id="4459724">.</span><span class="ident" id="4459725">i</span><span class="op" id="4459726">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459729">if</span>&nbsp;<span class="ident" id="4459732">nongreedy</span>&nbsp;<span class="op" id="4459742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459746">i</span><span class="op" id="4459747">.</span><span class="ident" id="4459748">Arg</span>&nbsp;<span class="op" id="4459752">=</span>&nbsp;<span class="ident" id="4459754">f1</span><span class="op" id="4459756">.</span><span class="ident" id="4459757">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459761">f</span><span class="op" id="4459762">.</span><span class="ident" id="4459763">out</span>&nbsp;<span class="op" id="4459767">=</span>&nbsp;<span class="ident" id="4459769">patchList</span><span class="op" id="4459778">(</span><span class="ident" id="4459779">f</span><span class="op" id="4459780">.</span><span class="ident" id="4459781">i</span>&nbsp;<span class="op" id="4459783">&lt;&lt;</span>&nbsp;<span class="num" id="4459786">1</span><span class="op" id="4459787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4459790">}</span>&nbsp;<span class="keyword" id="4459792">else</span>&nbsp;<span class="op" id="4459797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459801">i</span><span class="op" id="4459802">.</span><span class="ident" id="4459803">Out</span>&nbsp;<span class="op" id="4459807">=</span>&nbsp;<span class="ident" id="4459809">f1</span><span class="op" id="4459811">.</span><span class="ident" id="4459812">i</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459816">f</span><span class="op" id="4459817">.</span><span class="ident" id="4459818">out</span>&nbsp;<span class="op" id="4459822">=</span>&nbsp;<span class="ident" id="4459824">patchList</span><span class="op" id="4459833">(</span><span class="ident" id="4459834">f</span><span class="op" id="4459835">.</span><span class="ident" id="4459836">i</span><span class="op" id="4459837">&lt;&lt;</span><span class="num" id="4459839">1</span>&nbsp;<span class="op" id="4459841">|</span>&nbsp;<span class="num" id="4459843">1</span><span class="op" id="4459844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4459847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459850">f</span><span class="op" id="4459851">.</span><span class="ident" id="4459852">out</span>&nbsp;<span class="op" id="4459856">=</span>&nbsp;<span class="ident" id="4459858">f</span><span class="op" id="4459859">.</span><span class="ident" id="4459860">out</span><span class="op" id="4459863">.</span><span class="builtinfunc" id="4459864">append</span><span class="op" id="4459870">(</span><span class="ident" id="4459871">c</span><span class="op" id="4459872">.</span><span class="ident" id="4459873">p</span><span class="op" id="4459874">,</span>&nbsp;<span class="ident" id="4459876">f1</span><span class="op" id="4459878">.</span><span class="ident" id="4459879">out</span><span class="op" id="4459882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459885">return</span>&nbsp;<span class="ident" id="4459892">f</span><br>
<span class="lineno"></span><span class="op" id="4459894">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="4459897">func</span>&nbsp;<span class="op" id="4459902">(</span><span class="ident" id="4459903">c</span>&nbsp;<span class="op" id="4459905">*</span><span class="ident" id="4459906">compiler</span><span class="op" id="4459914">)</span>&nbsp;<span class="ident" id="4459916">star</span><span class="op" id="4459920">(</span><span class="ident" id="4459921">f1</span>&nbsp;<span class="ident" id="4459924">frag</span><span class="op" id="4459928">,</span>&nbsp;<span class="ident" id="4459930">nongreedy</span>&nbsp;<span class="builtintype" id="4459940">bool</span><span class="op" id="4459944">)</span>&nbsp;<span class="ident" id="4459946">frag</span>&nbsp;<span class="op" id="4459951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459954">f</span>&nbsp;<span class="op" id="4459956">:=</span>&nbsp;<span class="ident" id="4459959">c</span><span class="op" id="4459960">.</span><span class="ident" id="4459961">inst</span><span class="op" id="4459965">(</span><span class="ident" id="4459966">InstAlt</span><span class="op" id="4459973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459976">i</span>&nbsp;<span class="op" id="4459978">:=</span>&nbsp;<span class="op" id="4459981">&amp;</span><span class="ident" id="4459982">c</span><span class="op" id="4459983">.</span><span class="ident" id="4459984">p</span><span class="op" id="4459985">.</span><span class="ident" id="4459986">Inst</span><span class="op" id="4459990">[</span><span class="ident" id="4459991">f</span><span class="op" id="4459992">.</span><span class="ident" id="4459993">i</span><span class="op" id="4459994">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459997">if</span>&nbsp;<span class="ident" id="4460000">nongreedy</span>&nbsp;<span class="op" id="4460010">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460014">i</span><span class="op" id="4460015">.</span><span class="ident" id="4460016">Arg</span>&nbsp;<span class="op" id="4460020">=</span>&nbsp;<span class="ident" id="4460022">f1</span><span class="op" id="4460024">.</span><span class="ident" id="4460025">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460029">f</span><span class="op" id="4460030">.</span><span class="ident" id="4460031">out</span>&nbsp;<span class="op" id="4460035">=</span>&nbsp;<span class="ident" id="4460037">patchList</span><span class="op" id="4460046">(</span><span class="ident" id="4460047">f</span><span class="op" id="4460048">.</span><span class="ident" id="4460049">i</span>&nbsp;<span class="op" id="4460051">&lt;&lt;</span>&nbsp;<span class="num" id="4460054">1</span><span class="op" id="4460055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4460058">}</span>&nbsp;<span class="keyword" id="4460060">else</span>&nbsp;<span class="op" id="4460065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460069">i</span><span class="op" id="4460070">.</span><span class="ident" id="4460071">Out</span>&nbsp;<span class="op" id="4460075">=</span>&nbsp;<span class="ident" id="4460077">f1</span><span class="op" id="4460079">.</span><span class="ident" id="4460080">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460084">f</span><span class="op" id="4460085">.</span><span class="ident" id="4460086">out</span>&nbsp;<span class="op" id="4460090">=</span>&nbsp;<span class="ident" id="4460092">patchList</span><span class="op" id="4460101">(</span><span class="ident" id="4460102">f</span><span class="op" id="4460103">.</span><span class="ident" id="4460104">i</span><span class="op" id="4460105">&lt;&lt;</span><span class="num" id="4460107">1</span>&nbsp;<span class="op" id="4460109">|</span>&nbsp;<span class="num" id="4460111">1</span><span class="op" id="4460112">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4460115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460118">f1</span><span class="op" id="4460120">.</span><span class="ident" id="4460121">out</span><span class="op" id="4460124">.</span><span class="ident" id="4460125">patch</span><span class="op" id="4460130">(</span><span class="ident" id="4460131">c</span><span class="op" id="4460132">.</span><span class="ident" id="4460133">p</span><span class="op" id="4460134">,</span>&nbsp;<span class="ident" id="4460136">f</span><span class="op" id="4460137">.</span><span class="ident" id="4460138">i</span><span class="op" id="4460139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460142">return</span>&nbsp;<span class="ident" id="4460149">f</span><br>
<span class="lineno"></span><span class="op" id="4460151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="4460154">func</span>&nbsp;<span class="op" id="4460159">(</span><span class="ident" id="4460160">c</span>&nbsp;<span class="op" id="4460162">*</span><span class="ident" id="4460163">compiler</span><span class="op" id="4460171">)</span>&nbsp;<span class="ident" id="4460173">plus</span><span class="op" id="4460177">(</span><span class="ident" id="4460178">f1</span>&nbsp;<span class="ident" id="4460181">frag</span><span class="op" id="4460185">,</span>&nbsp;<span class="ident" id="4460187">nongreedy</span>&nbsp;<span class="builtintype" id="4460197">bool</span><span class="op" id="4460201">)</span>&nbsp;<span class="ident" id="4460203">frag</span>&nbsp;<span class="op" id="4460208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460211">return</span>&nbsp;<span class="ident" id="4460218">frag</span><span class="op" id="4460222">{</span><span class="ident" id="4460223">f1</span><span class="op" id="4460225">.</span><span class="ident" id="4460226">i</span><span class="op" id="4460227">,</span>&nbsp;<span class="ident" id="4460229">c</span><span class="op" id="4460230">.</span><span class="ident" id="4460231">star</span><span class="op" id="4460235">(</span><span class="ident" id="4460236">f1</span><span class="op" id="4460238">,</span>&nbsp;<span class="ident" id="4460240">nongreedy</span><span class="op" id="4460249">)</span><span class="op" id="4460250">.</span><span class="ident" id="4460251">out</span><span class="op" id="4460254">}</span><br>
<span class="lineno"></span><span class="op" id="4460256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4460259">func</span>&nbsp;<span class="op" id="4460264">(</span><span class="ident" id="4460265">c</span>&nbsp;<span class="op" id="4460267">*</span><span class="ident" id="4460268">compiler</span><span class="op" id="4460276">)</span>&nbsp;<span class="ident" id="4460278">empty</span><span class="op" id="4460283">(</span><span class="ident" id="4460284">op</span>&nbsp;<span class="ident" id="4460287">EmptyOp</span><span class="op" id="4460294">)</span>&nbsp;<span class="ident" id="4460296">frag</span>&nbsp;<span class="op" id="4460301">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460304">f</span>&nbsp;<span class="op" id="4460306">:=</span>&nbsp;<span class="ident" id="4460309">c</span><span class="op" id="4460310">.</span><span class="ident" id="4460311">inst</span><span class="op" id="4460315">(</span><span class="ident" id="4460316">InstEmptyWidth</span><span class="op" id="4460330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460333">c</span><span class="op" id="4460334">.</span><span class="ident" id="4460335">p</span><span class="op" id="4460336">.</span><span class="ident" id="4460337">Inst</span><span class="op" id="4460341">[</span><span class="ident" id="4460342">f</span><span class="op" id="4460343">.</span><span class="ident" id="4460344">i</span><span class="op" id="4460345">]</span><span class="op" id="4460346">.</span><span class="ident" id="4460347">Arg</span>&nbsp;<span class="op" id="4460351">=</span>&nbsp;<span class="builtintype" id="4460353">uint32</span><span class="op" id="4460359">(</span><span class="ident" id="4460360">op</span><span class="op" id="4460362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460365">f</span><span class="op" id="4460366">.</span><span class="ident" id="4460367">out</span>&nbsp;<span class="op" id="4460371">=</span>&nbsp;<span class="ident" id="4460373">patchList</span><span class="op" id="4460382">(</span><span class="ident" id="4460383">f</span><span class="op" id="4460384">.</span><span class="ident" id="4460385">i</span>&nbsp;<span class="op" id="4460387">&lt;&lt;</span>&nbsp;<span class="num" id="4460390">1</span><span class="op" id="4460391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460394">return</span>&nbsp;<span class="ident" id="4460401">f</span><br>
<span class="lineno"></span><span class="op" id="4460403">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="4460406">func</span>&nbsp;<span class="op" id="4460411">(</span><span class="ident" id="4460412">c</span>&nbsp;<span class="op" id="4460414">*</span><span class="ident" id="4460415">compiler</span><span class="op" id="4460423">)</span>&nbsp;<span class="builtintype" id="4460425">rune</span><span class="op" id="4460429">(</span><span class="ident" id="4460430">r</span>&nbsp;<span class="op" id="4460432">[</span><span class="op" id="4460433">]</span><span class="builtintype" id="4460434">rune</span><span class="op" id="4460438">,</span>&nbsp;<span class="ident" id="4460440">flags</span>&nbsp;<span class="ident" id="4460446">Flags</span><span class="op" id="4460451">)</span>&nbsp;<span class="ident" id="4460453">frag</span>&nbsp;<span class="op" id="4460458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460461">f</span>&nbsp;<span class="op" id="4460463">:=</span>&nbsp;<span class="ident" id="4460466">c</span><span class="op" id="4460467">.</span><span class="ident" id="4460468">inst</span><span class="op" id="4460472">(</span><span class="ident" id="4460473">InstRune</span><span class="op" id="4460481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460484">i</span>&nbsp;<span class="op" id="4460486">:=</span>&nbsp;<span class="op" id="4460489">&amp;</span><span class="ident" id="4460490">c</span><span class="op" id="4460491">.</span><span class="ident" id="4460492">p</span><span class="op" id="4460493">.</span><span class="ident" id="4460494">Inst</span><span class="op" id="4460498">[</span><span class="ident" id="4460499">f</span><span class="op" id="4460500">.</span><span class="ident" id="4460501">i</span><span class="op" id="4460502">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460505">i</span><span class="op" id="4460506">.</span><span class="ident" id="4460507">Rune</span>&nbsp;<span class="op" id="4460512">=</span>&nbsp;<span class="ident" id="4460514">r</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460517">flags</span>&nbsp;<span class="op" id="4460523">&amp;=</span>&nbsp;<span class="ident" id="4460526">FoldCase</span>&nbsp;<span class="comment" id="4460535">//&nbsp;only&nbsp;relevant&nbsp;flag&nbsp;is&nbsp;FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460570">if</span>&nbsp;<span class="builtinfunc" id="4460573">len</span><span class="op" id="4460576">(</span><span class="ident" id="4460577">r</span><span class="op" id="4460578">)</span>&nbsp;<span class="op" id="4460580">!=</span>&nbsp;<span class="num" id="4460583">1</span>&nbsp;<span class="op" id="4460585">||</span>&nbsp;<span class="ident" id="4460588">unicode</span><span class="op" id="4460595">.</span><span class="ident" id="4460596">SimpleFold</span><span class="op" id="4460606">(</span><span class="ident" id="4460607">r</span><span class="op" id="4460608">[</span><span class="num" id="4460609">0</span><span class="op" id="4460610">]</span><span class="op" id="4460611">)</span>&nbsp;<span class="op" id="4460613">==</span>&nbsp;<span class="ident" id="4460616">r</span><span class="op" id="4460617">[</span><span class="num" id="4460618">0</span><span class="op" id="4460619">]</span>&nbsp;<span class="op" id="4460621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4460625">//&nbsp;and&nbsp;sometimes&nbsp;not&nbsp;even&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460658">flags</span>&nbsp;<span class="op" id="4460664">&amp;^=</span>&nbsp;<span class="ident" id="4460668">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4460678">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460681">i</span><span class="op" id="4460682">.</span><span class="ident" id="4460683">Arg</span>&nbsp;<span class="op" id="4460687">=</span>&nbsp;<span class="builtintype" id="4460689">uint32</span><span class="op" id="4460695">(</span><span class="ident" id="4460696">flags</span><span class="op" id="4460701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460704">f</span><span class="op" id="4460705">.</span><span class="ident" id="4460706">out</span>&nbsp;<span class="op" id="4460710">=</span>&nbsp;<span class="ident" id="4460712">patchList</span><span class="op" id="4460721">(</span><span class="ident" id="4460722">f</span><span class="op" id="4460723">.</span><span class="ident" id="4460724">i</span>&nbsp;<span class="op" id="4460726">&lt;&lt;</span>&nbsp;<span class="num" id="4460729">1</span><span class="op" id="4460730">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4460734">//&nbsp;Special&nbsp;cases&nbsp;for&nbsp;exec&nbsp;machine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460770">switch</span>&nbsp;<span class="op" id="4460777">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460780">case</span>&nbsp;<span class="ident" id="4460785">flags</span><span class="op" id="4460790">&amp;</span><span class="ident" id="4460791">FoldCase</span>&nbsp;<span class="op" id="4460800">==</span>&nbsp;<span class="num" id="4460803">0</span>&nbsp;<span class="op" id="4460805">&amp;&amp;</span>&nbsp;<span class="op" id="4460808">(</span><span class="builtinfunc" id="4460809">len</span><span class="op" id="4460812">(</span><span class="ident" id="4460813">r</span><span class="op" id="4460814">)</span>&nbsp;<span class="op" id="4460816">==</span>&nbsp;<span class="num" id="4460819">1</span>&nbsp;<span class="op" id="4460821">||</span>&nbsp;<span class="builtinfunc" id="4460824">len</span><span class="op" id="4460827">(</span><span class="ident" id="4460828">r</span><span class="op" id="4460829">)</span>&nbsp;<span class="op" id="4460831">==</span>&nbsp;<span class="num" id="4460834">2</span>&nbsp;<span class="op" id="4460836">&amp;&amp;</span>&nbsp;<span class="ident" id="4460839">r</span><span class="op" id="4460840">[</span><span class="num" id="4460841">0</span><span class="op" id="4460842">]</span>&nbsp;<span class="op" id="4460844">==</span>&nbsp;<span class="ident" id="4460847">r</span><span class="op" id="4460848">[</span><span class="num" id="4460849">1</span><span class="op" id="4460850">]</span><span class="op" id="4460851">)</span><span class="op" id="4460852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460856">i</span><span class="op" id="4460857">.</span><span class="ident" id="4460858">Op</span>&nbsp;<span class="op" id="4460861">=</span>&nbsp;<span class="ident" id="4460863">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460874">case</span>&nbsp;<span class="builtinfunc" id="4460879">len</span><span class="op" id="4460882">(</span><span class="ident" id="4460883">r</span><span class="op" id="4460884">)</span>&nbsp;<span class="op" id="4460886">==</span>&nbsp;<span class="num" id="4460889">2</span>&nbsp;<span class="op" id="4460891">&amp;&amp;</span>&nbsp;<span class="ident" id="4460894">r</span><span class="op" id="4460895">[</span><span class="num" id="4460896">0</span><span class="op" id="4460897">]</span>&nbsp;<span class="op" id="4460899">==</span>&nbsp;<span class="num" id="4460902">0</span>&nbsp;<span class="op" id="4460904">&amp;&amp;</span>&nbsp;<span class="ident" id="4460907">r</span><span class="op" id="4460908">[</span><span class="num" id="4460909">1</span><span class="op" id="4460910">]</span>&nbsp;<span class="op" id="4460912">==</span>&nbsp;<span class="ident" id="4460915">unicode</span><span class="op" id="4460922">.</span><span class="ident" id="4460923">MaxRune</span><span class="op" id="4460930">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460934">i</span><span class="op" id="4460935">.</span><span class="ident" id="4460936">Op</span>&nbsp;<span class="op" id="4460939">=</span>&nbsp;<span class="ident" id="4460941">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460954">case</span>&nbsp;<span class="builtinfunc" id="4460959">len</span><span class="op" id="4460962">(</span><span class="ident" id="4460963">r</span><span class="op" id="4460964">)</span>&nbsp;<span class="op" id="4460966">==</span>&nbsp;<span class="num" id="4460969">4</span>&nbsp;<span class="op" id="4460971">&amp;&amp;</span>&nbsp;<span class="ident" id="4460974">r</span><span class="op" id="4460975">[</span><span class="num" id="4460976">0</span><span class="op" id="4460977">]</span>&nbsp;<span class="op" id="4460979">==</span>&nbsp;<span class="num" id="4460982">0</span>&nbsp;<span class="op" id="4460984">&amp;&amp;</span>&nbsp;<span class="ident" id="4460987">r</span><span class="op" id="4460988">[</span><span class="num" id="4460989">1</span><span class="op" id="4460990">]</span>&nbsp;<span class="op" id="4460992">==</span>&nbsp;<span class="string" id="4460995">&#39;\n&#39;</span><span class="op" id="4460999">-</span><span class="num" id="4461000">1</span>&nbsp;<span class="op" id="4461002">&amp;&amp;</span>&nbsp;<span class="ident" id="4461005">r</span><span class="op" id="4461006">[</span><span class="num" id="4461007">2</span><span class="op" id="4461008">]</span>&nbsp;<span class="op" id="4461010">==</span>&nbsp;<span class="string" id="4461013">&#39;\n&#39;</span><span class="op" id="4461017">+</span><span class="num" id="4461018">1</span>&nbsp;<span class="op" id="4461020">&amp;&amp;</span>&nbsp;<span class="ident" id="4461023">r</span><span class="op" id="4461024">[</span><span class="num" id="4461025">3</span><span class="op" id="4461026">]</span>&nbsp;<span class="op" id="4461028">==</span>&nbsp;<span class="ident" id="4461031">unicode</span><span class="op" id="4461038">.</span><span class="ident" id="4461039">MaxRune</span><span class="op" id="4461046">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461050">i</span><span class="op" id="4461051">.</span><span class="ident" id="4461052">Op</span>&nbsp;<span class="op" id="4461055">=</span>&nbsp;<span class="ident" id="4461057">InstRuneAnyNotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4461075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4461079">return</span>&nbsp;<span class="ident" id="4461086">f</span><br>
<span class="lineno"></span><span class="op" id="4461088">}</span>
</div>
</body>
</html>
