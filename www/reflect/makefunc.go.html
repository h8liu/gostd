<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2817843">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2817899">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2817953">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2818004">//&nbsp;MakeFunc&nbsp;implementation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2818033">package</span>&nbsp;<span class="ident" id="2818041">reflect</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2818050">import</span>&nbsp;<span class="op" id="2818057">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2818060">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2818069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2818072">//&nbsp;makeFuncImpl&nbsp;is&nbsp;the&nbsp;closure&nbsp;value&nbsp;implementing&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2818135">//&nbsp;returned&nbsp;by&nbsp;MakeFunc.</span><br>
<span class="lineno">15</span><span class="keyword" id="2818160">type</span>&nbsp;<span class="ident" id="2818165">makeFuncImpl</span>&nbsp;<span class="keyword" id="2818178">struct</span>&nbsp;<span class="op" id="2818185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818188">code</span>&nbsp;&nbsp;<span class="builtintype" id="2818194">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818203">stack</span>&nbsp;<span class="op" id="2818209">*</span><span class="ident" id="2818210"><a href="/reflect/type.go.html#2873228">bitVector</a></span>&nbsp;<span class="comment" id="2818220">//&nbsp;stack&nbsp;bitmap&nbsp;for&nbsp;args&nbsp;-&nbsp;offset&nbsp;known&nbsp;to&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818272">typ</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2818278">*</span><span class="ident" id="2818279"><a href="/reflect/type.go.html#2833129">funcType</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818289">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818295">func</span><span class="op" id="2818299">(</span><span class="op" id="2818300">[</span><span class="op" id="2818301">]</span><span class="ident" id="2818302"><a href="/reflect/value.go.html#2875697">Value</a></span><span class="op" id="2818307">)</span>&nbsp;<span class="op" id="2818309">[</span><span class="op" id="2818310">]</span><span class="ident" id="2818311"><a href="/reflect/value.go.html#2875697">Value</a></span><br>
<span class="lineno">20</span><span class="op" id="2818317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2818320">//&nbsp;MakeFunc&nbsp;returns&nbsp;a&nbsp;new&nbsp;function&nbsp;of&nbsp;the&nbsp;given&nbsp;Type</span><br>
<span class="lineno"></span><span class="comment" id="2818373">//&nbsp;that&nbsp;wraps&nbsp;the&nbsp;function&nbsp;fn.&nbsp;When&nbsp;called,&nbsp;that&nbsp;new&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2818435">//&nbsp;does&nbsp;the&nbsp;following:</span><br>
<span class="lineno">25</span><span class="comment" id="2818458">//</span><br>
<span class="lineno"></span><span class="comment" id="2818461">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;converts&nbsp;its&nbsp;arguments&nbsp;to&nbsp;a&nbsp;slice&nbsp;of&nbsp;Values.</span><br>
<span class="lineno"></span><span class="comment" id="2818511">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;runs&nbsp;results&nbsp;:=&nbsp;fn(args).</span><br>
<span class="lineno"></span><span class="comment" id="2818542">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;returns&nbsp;the&nbsp;results&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;Values,&nbsp;one&nbsp;per&nbsp;formal&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="2818612">//</span><br>
<span class="lineno">30</span><span class="comment" id="2818615">//&nbsp;The&nbsp;implementation&nbsp;fn&nbsp;can&nbsp;assume&nbsp;that&nbsp;the&nbsp;argument&nbsp;Value&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="2818681">//&nbsp;has&nbsp;the&nbsp;number&nbsp;and&nbsp;type&nbsp;of&nbsp;arguments&nbsp;given&nbsp;by&nbsp;typ.</span><br>
<span class="lineno"></span><span class="comment" id="2818735">//&nbsp;If&nbsp;typ&nbsp;describes&nbsp;a&nbsp;variadic&nbsp;function,&nbsp;the&nbsp;final&nbsp;Value&nbsp;is&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="2818802">//&nbsp;a&nbsp;slice&nbsp;representing&nbsp;the&nbsp;variadic&nbsp;arguments,&nbsp;as&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2818860">//&nbsp;body&nbsp;of&nbsp;a&nbsp;variadic&nbsp;function.&nbsp;The&nbsp;result&nbsp;Value&nbsp;slice&nbsp;returned&nbsp;by&nbsp;fn</span><br>
<span class="lineno">35</span><span class="comment" id="2818930">//&nbsp;must&nbsp;have&nbsp;the&nbsp;number&nbsp;and&nbsp;type&nbsp;of&nbsp;results&nbsp;given&nbsp;by&nbsp;typ.</span><br>
<span class="lineno"></span><span class="comment" id="2818988">//</span><br>
<span class="lineno"></span><span class="comment" id="2818991">//&nbsp;The&nbsp;Value.Call&nbsp;method&nbsp;allows&nbsp;the&nbsp;caller&nbsp;to&nbsp;invoke&nbsp;a&nbsp;typed&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2819061">//&nbsp;in&nbsp;terms&nbsp;of&nbsp;Values;&nbsp;in&nbsp;contrast,&nbsp;MakeFunc&nbsp;allows&nbsp;the&nbsp;caller&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="2819137">//&nbsp;a&nbsp;typed&nbsp;function&nbsp;in&nbsp;terms&nbsp;of&nbsp;Values.</span><br>
<span class="lineno">40</span><span class="comment" id="2819177">//</span><br>
<span class="lineno"></span><span class="comment" id="2819180">//&nbsp;The&nbsp;Examples&nbsp;section&nbsp;of&nbsp;the&nbsp;documentation&nbsp;includes&nbsp;an&nbsp;illustration</span><br>
<span class="lineno"></span><span class="comment" id="2819250">//&nbsp;of&nbsp;how&nbsp;to&nbsp;use&nbsp;MakeFunc&nbsp;to&nbsp;build&nbsp;a&nbsp;swap&nbsp;function&nbsp;for&nbsp;different&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="2819322">//</span><br>
<span class="lineno"></span><span class="keyword" id="2819325">func</span>&nbsp;<span class="ident" id="2819330">MakeFunc</span><span class="op" id="2819338">(</span><span class="ident" id="2819339">typ</span>&nbsp;<span class="ident" id="2819343"><a href="/reflect/type.go.html#2823607">Type</a></span><span class="op" id="2819347">,</span>&nbsp;<span class="ident" id="2819349">fn</span>&nbsp;<span class="keyword" id="2819352">func</span><span class="op" id="2819356">(</span><span class="ident" id="2819357">args</span>&nbsp;<span class="op" id="2819362">[</span><span class="op" id="2819363">]</span><span class="ident" id="2819364"><a href="/reflect/value.go.html#2875697">Value</a></span><span class="op" id="2819369">)</span>&nbsp;<span class="op" id="2819371">(</span><span class="ident" id="2819372">results</span>&nbsp;<span class="op" id="2819380">[</span><span class="op" id="2819381">]</span><span class="ident" id="2819382"><a href="/reflect/value.go.html#2875697">Value</a></span><span class="op" id="2819387">)</span><span class="op" id="2819388">)</span>&nbsp;<span class="ident" id="2819390"><a href="/reflect/value.go.html#2875697">Value</a></span>&nbsp;<span class="op" id="2819396">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819399">if</span>&nbsp;<span class="ident" id="2819402"><a href="/reflect/makefunc.go.html#2819339">typ</a></span><span class="op" id="2819405">.</span><span class="ident" id="2819406">Kind</span><span class="op" id="2819410">(</span><span class="op" id="2819411">)</span>&nbsp;<span class="op" id="2819413">!=</span>&nbsp;<span class="ident" id="2819416"><a href="/reflect/type.go.html#2830175">Func</a></span>&nbsp;<span class="op" id="2819421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2819425">panic</span><span class="op" id="2819430">(</span><span class="string" id="2819431">&#34;reflect:&nbsp;call&nbsp;of&nbsp;MakeFunc&nbsp;with&nbsp;non-Func&nbsp;type&#34;</span><span class="op" id="2819477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2819480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819484">t</span>&nbsp;<span class="op" id="2819486">:=</span>&nbsp;<span class="ident" id="2819489"><a href="/reflect/makefunc.go.html#2819339">typ</a></span><span class="op" id="2819492">.</span><span class="ident" id="2819493">common</span><span class="op" id="2819499">(</span><span class="op" id="2819500">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819503">ftyp</span>&nbsp;<span class="op" id="2819508">:=</span>&nbsp;<span class="op" id="2819511">(</span><span class="op" id="2819512">*</span><span class="ident" id="2819513"><a href="/reflect/type.go.html#2833129">funcType</a></span><span class="op" id="2819521">)</span><span class="op" id="2819522">(</span><span class="ident" id="2819523"><a href="/reflect/makefunc.go.html#2818060">unsafe</a></span><span class="op" id="2819529">.</span><span class="ident" id="2819530">Pointer</span><span class="op" id="2819537">(</span><span class="ident" id="2819538"><a href="/reflect/makefunc.go.html#2819484">t</a></span><span class="op" id="2819539">)</span><span class="op" id="2819540">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2819544">//&nbsp;Indirect&nbsp;Go&nbsp;func&nbsp;value&nbsp;(dummy)&nbsp;to&nbsp;obtain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2819589">//&nbsp;actual&nbsp;code&nbsp;address.&nbsp;(A&nbsp;Go&nbsp;func&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2819644">//&nbsp;to&nbsp;a&nbsp;C&nbsp;function&nbsp;pointer.&nbsp;http://golang.org/s/go11func.)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819704">dummy</span>&nbsp;<span class="op" id="2819710">:=</span>&nbsp;<span class="ident" id="2819713"><a href="/reflect/makefunc.go.html#2820330">makeFuncStub</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819727">code</span>&nbsp;<span class="op" id="2819732">:=</span>&nbsp;<span class="op" id="2819735">*</span><span class="op" id="2819736">*</span><span class="op" id="2819737">(</span><span class="op" id="2819738">*</span><span class="op" id="2819739">*</span><span class="builtintype" id="2819740">uintptr</span><span class="op" id="2819747">)</span><span class="op" id="2819748">(</span><span class="ident" id="2819749"><a href="/reflect/makefunc.go.html#2818060">unsafe</a></span><span class="op" id="2819755">.</span><span class="ident" id="2819756">Pointer</span><span class="op" id="2819763">(</span><span class="op" id="2819764">&amp;</span><span class="ident" id="2819765"><a href="/reflect/makefunc.go.html#2819704">dummy</a></span><span class="op" id="2819770">)</span><span class="op" id="2819771">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2819775">//&nbsp;makeFuncImpl&nbsp;contains&nbsp;a&nbsp;stack&nbsp;map&nbsp;for&nbsp;use&nbsp;by&nbsp;the&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819836">_</span><span class="op" id="2819837">,</span>&nbsp;<span class="ident" id="2819839">_</span><span class="op" id="2819840">,</span>&nbsp;<span class="ident" id="2819842">_</span><span class="op" id="2819843">,</span>&nbsp;<span class="ident" id="2819845">stack</span>&nbsp;<span class="op" id="2819851">:=</span>&nbsp;<span class="ident" id="2819854"><a href="/reflect/type.go.html#2870829">funcLayout</a></span><span class="op" id="2819864">(</span><span class="ident" id="2819865"><a href="/reflect/makefunc.go.html#2819484">t</a></span><span class="op" id="2819866">,</span>&nbsp;<span class="ident" id="2819868">nil</span><span class="op" id="2819871">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819875">impl</span>&nbsp;<span class="op" id="2819880">:=</span>&nbsp;<span class="op" id="2819883">&amp;</span><span class="ident" id="2819884"><a href="/reflect/makefunc.go.html#2818165">makeFuncImpl</a></span><span class="op" id="2819896">{</span><span class="ident" id="2819897">code</span><span class="op" id="2819901">:</span>&nbsp;<span class="ident" id="2819903"><a href="/reflect/makefunc.go.html#2819727">code</a></span><span class="op" id="2819907">,</span>&nbsp;<span class="ident" id="2819909">stack</span><span class="op" id="2819914">:</span>&nbsp;<span class="ident" id="2819916"><a href="/reflect/makefunc.go.html#2819845">stack</a></span><span class="op" id="2819921">,</span>&nbsp;<span class="ident" id="2819923">typ</span><span class="op" id="2819926">:</span>&nbsp;<span class="ident" id="2819928"><a href="/reflect/makefunc.go.html#2819503">ftyp</a></span><span class="op" id="2819932">,</span>&nbsp;<span class="ident" id="2819934">fn</span><span class="op" id="2819936">:</span>&nbsp;<span class="ident" id="2819938"><a href="/reflect/makefunc.go.html#2819349">fn</a></span><span class="op" id="2819940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819944">return</span>&nbsp;<span class="ident" id="2819951"><a href="/reflect/value.go.html#2875697">Value</a></span><span class="op" id="2819956">{</span><span class="ident" id="2819957"><a href="/reflect/makefunc.go.html#2819484">t</a></span><span class="op" id="2819958">,</span>&nbsp;<span class="ident" id="2819960"><a href="/reflect/makefunc.go.html#2818060">unsafe</a></span><span class="op" id="2819966">.</span><span class="ident" id="2819967">Pointer</span><span class="op" id="2819974">(</span><span class="ident" id="2819975"><a href="/reflect/makefunc.go.html#2819875">impl</a></span><span class="op" id="2819979">)</span><span class="op" id="2819980">,</span>&nbsp;<span class="ident" id="2819982"><a href="/reflect/value.go.html#2876828">flag</a></span><span class="op" id="2819986">(</span><span class="ident" id="2819987"><a href="/reflect/type.go.html#2830175">Func</a></span><span class="op" id="2819991">)</span><span class="op" id="2819992">}</span><br>
<span class="lineno"></span><span class="op" id="2819994">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="2819997">//&nbsp;makeFuncStub&nbsp;is&nbsp;an&nbsp;assembly&nbsp;function&nbsp;that&nbsp;is&nbsp;the&nbsp;code&nbsp;half&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2820062">//&nbsp;the&nbsp;function&nbsp;returned&nbsp;from&nbsp;MakeFunc.&nbsp;It&nbsp;expects&nbsp;a&nbsp;*callReflectFunc</span><br>
<span class="lineno"></span><span class="comment" id="2820132">//&nbsp;as&nbsp;its&nbsp;context&nbsp;register,&nbsp;and&nbsp;its&nbsp;job&nbsp;is&nbsp;to&nbsp;invoke&nbsp;callReflect(ctxt,&nbsp;frame)</span><br>
<span class="lineno"></span><span class="comment" id="2820210">//&nbsp;where&nbsp;ctxt&nbsp;is&nbsp;the&nbsp;context&nbsp;register&nbsp;and&nbsp;frame&nbsp;is&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;first</span><br>
<span class="lineno">70</span><span class="comment" id="2820284">//&nbsp;word&nbsp;in&nbsp;the&nbsp;passed-in&nbsp;argument&nbsp;frame.</span><br>
<span class="lineno"></span><span class="keyword" id="2820325">func</span>&nbsp;<span class="ident" id="2820330">makeFuncStub</span><span class="op" id="2820342">(</span><span class="op" id="2820343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2820346">type</span>&nbsp;<span class="ident" id="2820351">methodValue</span>&nbsp;<span class="keyword" id="2820363">struct</span>&nbsp;<span class="op" id="2820370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2820373">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2820380">uintptr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2820389">stack</span>&nbsp;&nbsp;<span class="op" id="2820396">*</span><span class="ident" id="2820397"><a href="/reflect/type.go.html#2873228">bitVector</a></span>&nbsp;<span class="comment" id="2820407">//&nbsp;stack&nbsp;bitmap&nbsp;for&nbsp;args&nbsp;-&nbsp;offset&nbsp;known&nbsp;to&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2820459">method</span>&nbsp;<span class="builtintype" id="2820466">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2820471">rcvr</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2820478"><a href="/reflect/value.go.html#2875697">Value</a></span><br>
<span class="lineno"></span><span class="op" id="2820484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2820487">//&nbsp;makeMethodValue&nbsp;converts&nbsp;v&nbsp;from&nbsp;the&nbsp;rcvr+method&nbsp;index&nbsp;representation</span><br>
<span class="lineno"></span><span class="comment" id="2820559">//&nbsp;of&nbsp;a&nbsp;method&nbsp;value&nbsp;to&nbsp;an&nbsp;actual&nbsp;method&nbsp;func&nbsp;value,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2820621">//&nbsp;basically&nbsp;the&nbsp;receiver&nbsp;value&nbsp;with&nbsp;a&nbsp;special&nbsp;bit&nbsp;set,&nbsp;into&nbsp;a&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="2820689">//&nbsp;func&nbsp;value&nbsp;-&nbsp;a&nbsp;value&nbsp;holding&nbsp;an&nbsp;actual&nbsp;func.&nbsp;The&nbsp;output&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2820751">//&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;input&nbsp;as&nbsp;far&nbsp;as&nbsp;the&nbsp;user&nbsp;of&nbsp;package</span><br>
<span class="lineno">85</span><span class="comment" id="2820821">//&nbsp;reflect&nbsp;can&nbsp;tell,&nbsp;but&nbsp;the&nbsp;true&nbsp;func&nbsp;representation&nbsp;can&nbsp;be&nbsp;handled</span><br>
<span class="lineno"></span><span class="comment" id="2820890">//&nbsp;by&nbsp;code&nbsp;like&nbsp;Convert&nbsp;and&nbsp;Interface&nbsp;and&nbsp;Assign.</span><br>
<span class="lineno"></span><span class="keyword" id="2820940">func</span>&nbsp;<span class="ident" id="2820945">makeMethodValue</span><span class="op" id="2820960">(</span><span class="ident" id="2820961">op</span>&nbsp;<span class="builtintype" id="2820964">string</span><span class="op" id="2820970">,</span>&nbsp;<span class="ident" id="2820972">v</span>&nbsp;<span class="ident" id="2820974"><a href="/reflect/value.go.html#2875697">Value</a></span><span class="op" id="2820979">)</span>&nbsp;<span class="ident" id="2820981"><a href="/reflect/value.go.html#2875697">Value</a></span>&nbsp;<span class="op" id="2820987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820990">if</span>&nbsp;<span class="ident" id="2820993"><a href="/reflect/makefunc.go.html#2820972">v</a></span><span class="op" id="2820994">.</span><span class="ident" id="2820995">flag</span><span class="op" id="2820999">&amp;</span><span class="ident" id="2821000"><a href="/reflect/value.go.html#2877037">flagMethod</a></span>&nbsp;<span class="op" id="2821011">==</span>&nbsp;<span class="num" id="2821014">0</span>&nbsp;<span class="op" id="2821016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2821020">panic</span><span class="op" id="2821025">(</span><span class="string" id="2821026">&#34;reflect:&nbsp;internal&nbsp;error:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;makeMethodValue&#34;</span><span class="op" id="2821083">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2821086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2821090">//&nbsp;Ignoring&nbsp;the&nbsp;flagMethod&nbsp;bit,&nbsp;v&nbsp;describes&nbsp;the&nbsp;receiver,&nbsp;not&nbsp;the&nbsp;method&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821170">fl</span>&nbsp;<span class="op" id="2821173">:=</span>&nbsp;<span class="ident" id="2821176"><a href="/reflect/makefunc.go.html#2820972">v</a></span><span class="op" id="2821177">.</span><span class="ident" id="2821178">flag</span>&nbsp;<span class="op" id="2821183">&amp;</span>&nbsp;<span class="op" id="2821185">(</span><span class="ident" id="2821186"><a href="/reflect/value.go.html#2876944">flagRO</a></span>&nbsp;<span class="op" id="2821193">|</span>&nbsp;<span class="ident" id="2821195"><a href="/reflect/value.go.html#2877006">flagAddr</a></span>&nbsp;<span class="op" id="2821204">|</span>&nbsp;<span class="ident" id="2821206"><a href="/reflect/value.go.html#2876975">flagIndir</a></span><span class="op" id="2821215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821218"><a href="/reflect/makefunc.go.html#2821170">fl</a></span>&nbsp;<span class="op" id="2821221">|=</span>&nbsp;<span class="ident" id="2821224"><a href="/reflect/value.go.html#2876828">flag</a></span><span class="op" id="2821228">(</span><span class="ident" id="2821229"><a href="/reflect/makefunc.go.html#2820972">v</a></span><span class="op" id="2821230">.</span><span class="ident" id="2821231">typ</span><span class="op" id="2821234">.</span><span class="ident" id="2821235">Kind</span><span class="op" id="2821239">(</span><span class="op" id="2821240">)</span><span class="op" id="2821241">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821244">rcvr</span>&nbsp;<span class="op" id="2821249">:=</span>&nbsp;<span class="ident" id="2821252"><a href="/reflect/value.go.html#2875697">Value</a></span><span class="op" id="2821257">{</span><span class="ident" id="2821258"><a href="/reflect/makefunc.go.html#2820972">v</a></span><span class="op" id="2821259">.</span><span class="ident" id="2821260">typ</span><span class="op" id="2821263">,</span>&nbsp;<span class="ident" id="2821265"><a href="/reflect/makefunc.go.html#2820972">v</a></span><span class="op" id="2821266">.</span><span class="ident" id="2821267">ptr</span><span class="op" id="2821270">,</span>&nbsp;<span class="ident" id="2821272"><a href="/reflect/makefunc.go.html#2821170">fl</a></span><span class="op" id="2821274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2821278">//&nbsp;v.Type&nbsp;returns&nbsp;the&nbsp;actual&nbsp;type&nbsp;of&nbsp;the&nbsp;method&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821334">funcType</span>&nbsp;<span class="op" id="2821343">:=</span>&nbsp;<span class="ident" id="2821346"><a href="/reflect/makefunc.go.html#2820972">v</a></span><span class="op" id="2821347">.</span><span class="ident" id="2821348">Type</span><span class="op" id="2821352">(</span><span class="op" id="2821353">)</span><span class="op" id="2821354">.</span><span class="op" id="2821355">(</span><span class="op" id="2821356">*</span><span class="ident" id="2821357"><a href="/reflect/type.go.html#2830490">rtype</a></span><span class="op" id="2821362">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2821366">//&nbsp;Indirect&nbsp;Go&nbsp;func&nbsp;value&nbsp;(dummy)&nbsp;to&nbsp;obtain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2821411">//&nbsp;actual&nbsp;code&nbsp;address.&nbsp;(A&nbsp;Go&nbsp;func&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2821466">//&nbsp;to&nbsp;a&nbsp;C&nbsp;function&nbsp;pointer.&nbsp;http://golang.org/s/go11func.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821526">dummy</span>&nbsp;<span class="op" id="2821532">:=</span>&nbsp;<span class="ident" id="2821535"><a href="/reflect/makefunc.go.html#2822451">methodValueCall</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821552">code</span>&nbsp;<span class="op" id="2821557">:=</span>&nbsp;<span class="op" id="2821560">*</span><span class="op" id="2821561">*</span><span class="op" id="2821562">(</span><span class="op" id="2821563">*</span><span class="op" id="2821564">*</span><span class="builtintype" id="2821565">uintptr</span><span class="op" id="2821572">)</span><span class="op" id="2821573">(</span><span class="ident" id="2821574"><a href="/reflect/makefunc.go.html#2818060">unsafe</a></span><span class="op" id="2821580">.</span><span class="ident" id="2821581">Pointer</span><span class="op" id="2821588">(</span><span class="op" id="2821589">&amp;</span><span class="ident" id="2821590"><a href="/reflect/makefunc.go.html#2821526">dummy</a></span><span class="op" id="2821595">)</span><span class="op" id="2821596">)</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2821600">//&nbsp;methodValue&nbsp;contains&nbsp;a&nbsp;stack&nbsp;map&nbsp;for&nbsp;use&nbsp;by&nbsp;the&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821660">_</span><span class="op" id="2821661">,</span>&nbsp;<span class="ident" id="2821663">_</span><span class="op" id="2821664">,</span>&nbsp;<span class="ident" id="2821666">_</span><span class="op" id="2821667">,</span>&nbsp;<span class="ident" id="2821669">stack</span>&nbsp;<span class="op" id="2821675">:=</span>&nbsp;<span class="ident" id="2821678"><a href="/reflect/type.go.html#2870829">funcLayout</a></span><span class="op" id="2821688">(</span><span class="ident" id="2821689"><a href="/reflect/makefunc.go.html#2821334">funcType</a></span><span class="op" id="2821697">,</span>&nbsp;<span class="ident" id="2821699">nil</span><span class="op" id="2821702">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821706">fv</span>&nbsp;<span class="op" id="2821709">:=</span>&nbsp;<span class="op" id="2821712">&amp;</span><span class="ident" id="2821713"><a href="/reflect/makefunc.go.html#2820351">methodValue</a></span><span class="op" id="2821724">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821728">fn</span><span class="op" id="2821730">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821736"><a href="/reflect/makefunc.go.html#2821552">code</a></span><span class="op" id="2821740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821744">stack</span><span class="op" id="2821749">:</span>&nbsp;&nbsp;<span class="ident" id="2821752"><a href="/reflect/makefunc.go.html#2821669">stack</a></span><span class="op" id="2821757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821761">method</span><span class="op" id="2821767">:</span>&nbsp;<span class="builtintype" id="2821769">int</span><span class="op" id="2821772">(</span><span class="ident" id="2821773"><a href="/reflect/makefunc.go.html#2820972">v</a></span><span class="op" id="2821774">.</span><span class="ident" id="2821775">flag</span><span class="op" id="2821779">)</span>&nbsp;<span class="op" id="2821781">&gt;&gt;</span>&nbsp;<span class="ident" id="2821784"><a href="/reflect/value.go.html#2877068">flagMethodShift</a></span><span class="op" id="2821799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821803">rcvr</span><span class="op" id="2821807">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2821811"><a href="/reflect/makefunc.go.html#2821244">rcvr</a></span><span class="op" id="2821815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2821818">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2821822">//&nbsp;Cause&nbsp;panic&nbsp;if&nbsp;method&nbsp;is&nbsp;not&nbsp;appropriate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2821868">//&nbsp;The&nbsp;panic&nbsp;would&nbsp;still&nbsp;happen&nbsp;during&nbsp;the&nbsp;call&nbsp;if&nbsp;we&nbsp;omit&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2821934">//&nbsp;but&nbsp;we&nbsp;want&nbsp;Interface()&nbsp;and&nbsp;other&nbsp;operations&nbsp;to&nbsp;fail&nbsp;early.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821998"><a href="/reflect/value.go.html#2890426">methodReceiver</a></span><span class="op" id="2822012">(</span><span class="ident" id="2822013"><a href="/reflect/makefunc.go.html#2820961">op</a></span><span class="op" id="2822015">,</span>&nbsp;<span class="ident" id="2822017"><a href="/reflect/makefunc.go.html#2821706">fv</a></span><span class="op" id="2822019">.</span><span class="ident" id="2822020">rcvr</span><span class="op" id="2822024">,</span>&nbsp;<span class="ident" id="2822026"><a href="/reflect/makefunc.go.html#2821706">fv</a></span><span class="op" id="2822028">.</span><span class="ident" id="2822029">method</span><span class="op" id="2822035">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822039">return</span>&nbsp;<span class="ident" id="2822046"><a href="/reflect/value.go.html#2875697">Value</a></span><span class="op" id="2822051">{</span><span class="ident" id="2822052"><a href="/reflect/makefunc.go.html#2821334">funcType</a></span><span class="op" id="2822060">,</span>&nbsp;<span class="ident" id="2822062"><a href="/reflect/makefunc.go.html#2818060">unsafe</a></span><span class="op" id="2822068">.</span><span class="ident" id="2822069">Pointer</span><span class="op" id="2822076">(</span><span class="ident" id="2822077"><a href="/reflect/makefunc.go.html#2821706">fv</a></span><span class="op" id="2822079">)</span><span class="op" id="2822080">,</span>&nbsp;<span class="ident" id="2822082"><a href="/reflect/makefunc.go.html#2820972">v</a></span><span class="op" id="2822083">.</span><span class="ident" id="2822084">flag</span><span class="op" id="2822088">&amp;</span><span class="ident" id="2822089"><a href="/reflect/value.go.html#2876944">flagRO</a></span>&nbsp;<span class="op" id="2822096">|</span>&nbsp;<span class="ident" id="2822098"><a href="/reflect/value.go.html#2876828">flag</a></span><span class="op" id="2822102">(</span><span class="ident" id="2822103"><a href="/reflect/type.go.html#2830175">Func</a></span><span class="op" id="2822107">)</span><span class="op" id="2822108">}</span><br>
<span class="lineno"></span><span class="op" id="2822110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2822113">//&nbsp;methodValueCall&nbsp;is&nbsp;an&nbsp;assembly&nbsp;function&nbsp;that&nbsp;is&nbsp;the&nbsp;code&nbsp;half&nbsp;of</span><br>
<span class="lineno">125</span><span class="comment" id="2822181">//&nbsp;the&nbsp;function&nbsp;returned&nbsp;from&nbsp;makeMethodValue.&nbsp;It&nbsp;expects&nbsp;a&nbsp;*methodValue</span><br>
<span class="lineno"></span><span class="comment" id="2822254">//&nbsp;as&nbsp;its&nbsp;context&nbsp;register,&nbsp;and&nbsp;its&nbsp;job&nbsp;is&nbsp;to&nbsp;invoke&nbsp;callMethod(ctxt,&nbsp;frame)</span><br>
<span class="lineno"></span><span class="comment" id="2822331">//&nbsp;where&nbsp;ctxt&nbsp;is&nbsp;the&nbsp;context&nbsp;register&nbsp;and&nbsp;frame&nbsp;is&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="2822405">//&nbsp;word&nbsp;in&nbsp;the&nbsp;passed-in&nbsp;argument&nbsp;frame.</span><br>
<span class="lineno"></span><span class="keyword" id="2822446">func</span>&nbsp;<span class="ident" id="2822451">methodValueCall</span><span class="op" id="2822466">(</span><span class="op" id="2822467">)</span>
</div>
</body>
</html>
