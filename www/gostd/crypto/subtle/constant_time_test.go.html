<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8459131">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8459186">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8459240">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8459291">package</span>&nbsp;<span class="ident" id="8459299">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459307">import</span>&nbsp;<span class="op" id="8459314">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8459317">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8459328">&#34;testing/quick&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8459344">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459347">type</span>&nbsp;<span class="ident" id="8459352">TestConstantTimeCompareStruct</span>&nbsp;<span class="keyword" id="8459382">struct</span>&nbsp;<span class="op" id="8459389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459392">a</span><span class="op" id="8459393">,</span>&nbsp;<span class="ident" id="8459395">b</span>&nbsp;<span class="op" id="8459397">[</span><span class="op" id="8459398">]</span><span class="builtintype" id="8459399">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459405">out</span>&nbsp;&nbsp;<span class="builtintype" id="8459410">int</span><br>
<span class="lineno">15</span><span class="op" id="8459414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459417">var</span>&nbsp;<span class="ident" id="8459421">testConstantTimeCompareData</span>&nbsp;<span class="op" id="8459449">=</span>&nbsp;<span class="op" id="8459451">[</span><span class="op" id="8459452">]</span><span class="ident" id="8459453">TestConstantTimeCompareStruct</span><span class="op" id="8459482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459485">{</span><span class="op" id="8459486">[</span><span class="op" id="8459487">]</span><span class="builtintype" id="8459488">byte</span><span class="op" id="8459492">{</span><span class="op" id="8459493">}</span><span class="op" id="8459494">,</span>&nbsp;<span class="op" id="8459496">[</span><span class="op" id="8459497">]</span><span class="builtintype" id="8459498">byte</span><span class="op" id="8459502">{</span><span class="op" id="8459503">}</span><span class="op" id="8459504">,</span>&nbsp;<span class="num" id="8459506">1</span><span class="op" id="8459507">}</span><span class="op" id="8459508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459511">{</span><span class="op" id="8459512">[</span><span class="op" id="8459513">]</span><span class="builtintype" id="8459514">byte</span><span class="op" id="8459518">{</span><span class="num" id="8459519">0x11</span><span class="op" id="8459523">}</span><span class="op" id="8459524">,</span>&nbsp;<span class="op" id="8459526">[</span><span class="op" id="8459527">]</span><span class="builtintype" id="8459528">byte</span><span class="op" id="8459532">{</span><span class="num" id="8459533">0x11</span><span class="op" id="8459537">}</span><span class="op" id="8459538">,</span>&nbsp;<span class="num" id="8459540">1</span><span class="op" id="8459541">}</span><span class="op" id="8459542">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459545">{</span><span class="op" id="8459546">[</span><span class="op" id="8459547">]</span><span class="builtintype" id="8459548">byte</span><span class="op" id="8459552">{</span><span class="num" id="8459553">0x12</span><span class="op" id="8459557">}</span><span class="op" id="8459558">,</span>&nbsp;<span class="op" id="8459560">[</span><span class="op" id="8459561">]</span><span class="builtintype" id="8459562">byte</span><span class="op" id="8459566">{</span><span class="num" id="8459567">0x11</span><span class="op" id="8459571">}</span><span class="op" id="8459572">,</span>&nbsp;<span class="num" id="8459574">0</span><span class="op" id="8459575">}</span><span class="op" id="8459576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459579">{</span><span class="op" id="8459580">[</span><span class="op" id="8459581">]</span><span class="builtintype" id="8459582">byte</span><span class="op" id="8459586">{</span><span class="num" id="8459587">0x11</span><span class="op" id="8459591">}</span><span class="op" id="8459592">,</span>&nbsp;<span class="op" id="8459594">[</span><span class="op" id="8459595">]</span><span class="builtintype" id="8459596">byte</span><span class="op" id="8459600">{</span><span class="num" id="8459601">0x11</span><span class="op" id="8459605">,</span>&nbsp;<span class="num" id="8459607">0x12</span><span class="op" id="8459611">}</span><span class="op" id="8459612">,</span>&nbsp;<span class="num" id="8459614">0</span><span class="op" id="8459615">}</span><span class="op" id="8459616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459619">{</span><span class="op" id="8459620">[</span><span class="op" id="8459621">]</span><span class="builtintype" id="8459622">byte</span><span class="op" id="8459626">{</span><span class="num" id="8459627">0x11</span><span class="op" id="8459631">,</span>&nbsp;<span class="num" id="8459633">0x12</span><span class="op" id="8459637">}</span><span class="op" id="8459638">,</span>&nbsp;<span class="op" id="8459640">[</span><span class="op" id="8459641">]</span><span class="builtintype" id="8459642">byte</span><span class="op" id="8459646">{</span><span class="num" id="8459647">0x11</span><span class="op" id="8459651">}</span><span class="op" id="8459652">,</span>&nbsp;<span class="num" id="8459654">0</span><span class="op" id="8459655">}</span><span class="op" id="8459656">,</span><br>
<span class="lineno"></span><span class="op" id="8459658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8459661">func</span>&nbsp;<span class="ident" id="8459666">TestConstantTimeCompare</span><span class="op" id="8459689">(</span><span class="ident" id="8459690">t</span>&nbsp;<span class="op" id="8459692">*</span><span class="ident" id="8459693">testing</span><span class="op" id="8459700">.</span><span class="ident" id="8459701">T</span><span class="op" id="8459702">)</span>&nbsp;<span class="op" id="8459704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459707">for</span>&nbsp;<span class="ident" id="8459711">i</span><span class="op" id="8459712">,</span>&nbsp;<span class="ident" id="8459714">test</span>&nbsp;<span class="op" id="8459719">:=</span>&nbsp;<span class="keyword" id="8459722">range</span>&nbsp;<span class="ident" id="8459728">testConstantTimeCompareData</span>&nbsp;<span class="op" id="8459756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459760">if</span>&nbsp;<span class="ident" id="8459763">r</span>&nbsp;<span class="op" id="8459765">:=</span>&nbsp;<span class="ident" id="8459768">ConstantTimeCompare</span><span class="op" id="8459787">(</span><span class="ident" id="8459788">test</span><span class="op" id="8459792">.</span><span class="ident" id="8459793">a</span><span class="op" id="8459794">,</span>&nbsp;<span class="ident" id="8459796">test</span><span class="op" id="8459800">.</span><span class="ident" id="8459801">b</span><span class="op" id="8459802">)</span><span class="op" id="8459803">;</span>&nbsp;<span class="ident" id="8459805">r</span>&nbsp;<span class="op" id="8459807">!=</span>&nbsp;<span class="ident" id="8459810">test</span><span class="op" id="8459814">.</span><span class="ident" id="8459815">out</span>&nbsp;<span class="op" id="8459819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459824">t</span><span class="op" id="8459825">.</span><span class="ident" id="8459826">Errorf</span><span class="op" id="8459832">(</span><span class="string" id="8459833">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="8459867">,</span>&nbsp;<span class="ident" id="8459869">i</span><span class="op" id="8459870">,</span>&nbsp;<span class="ident" id="8459872">r</span><span class="op" id="8459873">,</span>&nbsp;<span class="ident" id="8459875">test</span><span class="op" id="8459879">.</span><span class="ident" id="8459880">out</span><span class="op" id="8459883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459887">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459890">}</span><br>
<span class="lineno"></span><span class="op" id="8459892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459895">type</span>&nbsp;<span class="ident" id="8459900">TestConstantTimeByteEqStruct</span>&nbsp;<span class="keyword" id="8459929">struct</span>&nbsp;<span class="op" id="8459936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459939">a</span><span class="op" id="8459940">,</span>&nbsp;<span class="ident" id="8459942">b</span>&nbsp;<span class="builtintype" id="8459944">uint8</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459951">out</span>&nbsp;&nbsp;<span class="builtintype" id="8459956">int</span><br>
<span class="lineno"></span><span class="op" id="8459960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459963">var</span>&nbsp;<span class="ident" id="8459967">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="8459994">=</span>&nbsp;<span class="op" id="8459996">[</span><span class="op" id="8459997">]</span><span class="ident" id="8459998">TestConstantTimeByteEqStruct</span><span class="op" id="8460026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460029">{</span><span class="num" id="8460030">0</span><span class="op" id="8460031">,</span>&nbsp;<span class="num" id="8460033">0</span><span class="op" id="8460034">,</span>&nbsp;<span class="num" id="8460036">1</span><span class="op" id="8460037">}</span><span class="op" id="8460038">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460041">{</span><span class="num" id="8460042">0</span><span class="op" id="8460043">,</span>&nbsp;<span class="num" id="8460045">1</span><span class="op" id="8460046">,</span>&nbsp;<span class="num" id="8460048">0</span><span class="op" id="8460049">}</span><span class="op" id="8460050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460053">{</span><span class="num" id="8460054">1</span><span class="op" id="8460055">,</span>&nbsp;<span class="num" id="8460057">0</span><span class="op" id="8460058">,</span>&nbsp;<span class="num" id="8460060">0</span><span class="op" id="8460061">}</span><span class="op" id="8460062">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460065">{</span><span class="num" id="8460066">0xff</span><span class="op" id="8460070">,</span>&nbsp;<span class="num" id="8460072">0xff</span><span class="op" id="8460076">,</span>&nbsp;<span class="num" id="8460078">1</span><span class="op" id="8460079">}</span><span class="op" id="8460080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460083">{</span><span class="num" id="8460084">0xff</span><span class="op" id="8460088">,</span>&nbsp;<span class="num" id="8460090">0xfe</span><span class="op" id="8460094">,</span>&nbsp;<span class="num" id="8460096">0</span><span class="op" id="8460097">}</span><span class="op" id="8460098">,</span><br>
<span class="lineno"></span><span class="op" id="8460100">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8460103">func</span>&nbsp;<span class="ident" id="8460108">byteEq</span><span class="op" id="8460114">(</span><span class="ident" id="8460115">a</span><span class="op" id="8460116">,</span>&nbsp;<span class="ident" id="8460118">b</span>&nbsp;<span class="builtintype" id="8460120">uint8</span><span class="op" id="8460125">)</span>&nbsp;<span class="builtintype" id="8460127">int</span>&nbsp;<span class="op" id="8460131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460134">if</span>&nbsp;<span class="ident" id="8460137">a</span>&nbsp;<span class="op" id="8460139">==</span>&nbsp;<span class="ident" id="8460142">b</span>&nbsp;<span class="op" id="8460144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460148">return</span>&nbsp;<span class="num" id="8460155">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460158">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460161">return</span>&nbsp;<span class="num" id="8460168">0</span><br>
<span class="lineno"></span><span class="op" id="8460170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8460173">func</span>&nbsp;<span class="ident" id="8460178">TestConstantTimeByteEq</span><span class="op" id="8460200">(</span><span class="ident" id="8460201">t</span>&nbsp;<span class="op" id="8460203">*</span><span class="ident" id="8460204">testing</span><span class="op" id="8460211">.</span><span class="ident" id="8460212">T</span><span class="op" id="8460213">)</span>&nbsp;<span class="op" id="8460215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460218">for</span>&nbsp;<span class="ident" id="8460222">i</span><span class="op" id="8460223">,</span>&nbsp;<span class="ident" id="8460225">test</span>&nbsp;<span class="op" id="8460230">:=</span>&nbsp;<span class="keyword" id="8460233">range</span>&nbsp;<span class="ident" id="8460239">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="8460266">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460270">if</span>&nbsp;<span class="ident" id="8460273">r</span>&nbsp;<span class="op" id="8460275">:=</span>&nbsp;<span class="ident" id="8460278">ConstantTimeByteEq</span><span class="op" id="8460296">(</span><span class="ident" id="8460297">test</span><span class="op" id="8460301">.</span><span class="ident" id="8460302">a</span><span class="op" id="8460303">,</span>&nbsp;<span class="ident" id="8460305">test</span><span class="op" id="8460309">.</span><span class="ident" id="8460310">b</span><span class="op" id="8460311">)</span><span class="op" id="8460312">;</span>&nbsp;<span class="ident" id="8460314">r</span>&nbsp;<span class="op" id="8460316">!=</span>&nbsp;<span class="ident" id="8460319">test</span><span class="op" id="8460323">.</span><span class="ident" id="8460324">out</span>&nbsp;<span class="op" id="8460328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460333">t</span><span class="op" id="8460334">.</span><span class="ident" id="8460335">Errorf</span><span class="op" id="8460341">(</span><span class="string" id="8460342">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="8460376">,</span>&nbsp;<span class="ident" id="8460378">i</span><span class="op" id="8460379">,</span>&nbsp;<span class="ident" id="8460381">r</span><span class="op" id="8460382">,</span>&nbsp;<span class="ident" id="8460384">test</span><span class="op" id="8460388">.</span><span class="ident" id="8460389">out</span><span class="op" id="8460392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460402">err</span>&nbsp;<span class="op" id="8460406">:=</span>&nbsp;<span class="ident" id="8460409">quick</span><span class="op" id="8460414">.</span><span class="ident" id="8460415">CheckEqual</span><span class="op" id="8460425">(</span><span class="ident" id="8460426">ConstantTimeByteEq</span><span class="op" id="8460444">,</span>&nbsp;<span class="ident" id="8460446">byteEq</span><span class="op" id="8460452">,</span>&nbsp;<span class="ident" id="8460454">nil</span><span class="op" id="8460457">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460460">if</span>&nbsp;<span class="ident" id="8460463">err</span>&nbsp;<span class="op" id="8460467">!=</span>&nbsp;<span class="ident" id="8460470">nil</span>&nbsp;<span class="op" id="8460474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460478">t</span><span class="op" id="8460479">.</span><span class="ident" id="8460480">Error</span><span class="op" id="8460485">(</span><span class="ident" id="8460486">err</span><span class="op" id="8460489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460492">}</span><br>
<span class="lineno"></span><span class="op" id="8460494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="8460497">func</span>&nbsp;<span class="ident" id="8460502">eq</span><span class="op" id="8460504">(</span><span class="ident" id="8460505">a</span><span class="op" id="8460506">,</span>&nbsp;<span class="ident" id="8460508">b</span>&nbsp;<span class="builtintype" id="8460510">int32</span><span class="op" id="8460515">)</span>&nbsp;<span class="builtintype" id="8460517">int</span>&nbsp;<span class="op" id="8460521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460524">if</span>&nbsp;<span class="ident" id="8460527">a</span>&nbsp;<span class="op" id="8460529">==</span>&nbsp;<span class="ident" id="8460532">b</span>&nbsp;<span class="op" id="8460534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460538">return</span>&nbsp;<span class="num" id="8460545">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460551">return</span>&nbsp;<span class="num" id="8460558">0</span><br>
<span class="lineno">70</span><span class="op" id="8460560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8460563">func</span>&nbsp;<span class="ident" id="8460568">TestConstantTimeEq</span><span class="op" id="8460586">(</span><span class="ident" id="8460587">t</span>&nbsp;<span class="op" id="8460589">*</span><span class="ident" id="8460590">testing</span><span class="op" id="8460597">.</span><span class="ident" id="8460598">T</span><span class="op" id="8460599">)</span>&nbsp;<span class="op" id="8460601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460604">err</span>&nbsp;<span class="op" id="8460608">:=</span>&nbsp;<span class="ident" id="8460611">quick</span><span class="op" id="8460616">.</span><span class="ident" id="8460617">CheckEqual</span><span class="op" id="8460627">(</span><span class="ident" id="8460628">ConstantTimeEq</span><span class="op" id="8460642">,</span>&nbsp;<span class="ident" id="8460644">eq</span><span class="op" id="8460646">,</span>&nbsp;<span class="ident" id="8460648">nil</span><span class="op" id="8460651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460654">if</span>&nbsp;<span class="ident" id="8460657">err</span>&nbsp;<span class="op" id="8460661">!=</span>&nbsp;<span class="ident" id="8460664">nil</span>&nbsp;<span class="op" id="8460668">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460672">t</span><span class="op" id="8460673">.</span><span class="ident" id="8460674">Error</span><span class="op" id="8460679">(</span><span class="ident" id="8460680">err</span><span class="op" id="8460683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460686">}</span><br>
<span class="lineno"></span><span class="op" id="8460688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8460691">func</span>&nbsp;<span class="ident" id="8460696">makeCopy</span><span class="op" id="8460704">(</span><span class="ident" id="8460705">v</span>&nbsp;<span class="builtintype" id="8460707">int</span><span class="op" id="8460710">,</span>&nbsp;<span class="ident" id="8460712">x</span><span class="op" id="8460713">,</span>&nbsp;<span class="ident" id="8460715">y</span>&nbsp;<span class="op" id="8460717">[</span><span class="op" id="8460718">]</span><span class="builtintype" id="8460719">byte</span><span class="op" id="8460723">)</span>&nbsp;<span class="op" id="8460725">[</span><span class="op" id="8460726">]</span><span class="builtintype" id="8460727">byte</span>&nbsp;<span class="op" id="8460732">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460735">if</span>&nbsp;<span class="builtinfunc" id="8460738">len</span><span class="op" id="8460741">(</span><span class="ident" id="8460742">x</span><span class="op" id="8460743">)</span>&nbsp;<span class="op" id="8460745">&gt;</span>&nbsp;<span class="builtinfunc" id="8460747">len</span><span class="op" id="8460750">(</span><span class="ident" id="8460751">y</span><span class="op" id="8460752">)</span>&nbsp;<span class="op" id="8460754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460758">x</span>&nbsp;<span class="op" id="8460760">=</span>&nbsp;<span class="ident" id="8460762">x</span><span class="op" id="8460763">[</span><span class="num" id="8460764">0</span><span class="op" id="8460765">:</span><span class="builtinfunc" id="8460766">len</span><span class="op" id="8460769">(</span><span class="ident" id="8460770">y</span><span class="op" id="8460771">)</span><span class="op" id="8460772">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460775">}</span>&nbsp;<span class="keyword" id="8460777">else</span>&nbsp;<span class="op" id="8460782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460786">y</span>&nbsp;<span class="op" id="8460788">=</span>&nbsp;<span class="ident" id="8460790">y</span><span class="op" id="8460791">[</span><span class="num" id="8460792">0</span><span class="op" id="8460793">:</span><span class="builtinfunc" id="8460794">len</span><span class="op" id="8460797">(</span><span class="ident" id="8460798">x</span><span class="op" id="8460799">)</span><span class="op" id="8460800">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460803">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460806">if</span>&nbsp;<span class="ident" id="8460809">v</span>&nbsp;<span class="op" id="8460811">==</span>&nbsp;<span class="num" id="8460814">1</span>&nbsp;<span class="op" id="8460816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8460820">copy</span><span class="op" id="8460824">(</span><span class="ident" id="8460825">x</span><span class="op" id="8460826">,</span>&nbsp;<span class="ident" id="8460828">y</span><span class="op" id="8460829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460835">return</span>&nbsp;<span class="ident" id="8460842">x</span><br>
<span class="lineno"></span><span class="op" id="8460844">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="8460847">func</span>&nbsp;<span class="ident" id="8460852">constantTimeCopyWrapper</span><span class="op" id="8460875">(</span><span class="ident" id="8460876">v</span>&nbsp;<span class="builtintype" id="8460878">int</span><span class="op" id="8460881">,</span>&nbsp;<span class="ident" id="8460883">x</span><span class="op" id="8460884">,</span>&nbsp;<span class="ident" id="8460886">y</span>&nbsp;<span class="op" id="8460888">[</span><span class="op" id="8460889">]</span><span class="builtintype" id="8460890">byte</span><span class="op" id="8460894">)</span>&nbsp;<span class="op" id="8460896">[</span><span class="op" id="8460897">]</span><span class="builtintype" id="8460898">byte</span>&nbsp;<span class="op" id="8460903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460906">if</span>&nbsp;<span class="builtinfunc" id="8460909">len</span><span class="op" id="8460912">(</span><span class="ident" id="8460913">x</span><span class="op" id="8460914">)</span>&nbsp;<span class="op" id="8460916">&gt;</span>&nbsp;<span class="builtinfunc" id="8460918">len</span><span class="op" id="8460921">(</span><span class="ident" id="8460922">y</span><span class="op" id="8460923">)</span>&nbsp;<span class="op" id="8460925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460929">x</span>&nbsp;<span class="op" id="8460931">=</span>&nbsp;<span class="ident" id="8460933">x</span><span class="op" id="8460934">[</span><span class="num" id="8460935">0</span><span class="op" id="8460936">:</span><span class="builtinfunc" id="8460937">len</span><span class="op" id="8460940">(</span><span class="ident" id="8460941">y</span><span class="op" id="8460942">)</span><span class="op" id="8460943">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460946">}</span>&nbsp;<span class="keyword" id="8460948">else</span>&nbsp;<span class="op" id="8460953">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460957">y</span>&nbsp;<span class="op" id="8460959">=</span>&nbsp;<span class="ident" id="8460961">y</span><span class="op" id="8460962">[</span><span class="num" id="8460963">0</span><span class="op" id="8460964">:</span><span class="builtinfunc" id="8460965">len</span><span class="op" id="8460968">(</span><span class="ident" id="8460969">x</span><span class="op" id="8460970">)</span><span class="op" id="8460971">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460977">v</span>&nbsp;<span class="op" id="8460979">&amp;=</span>&nbsp;<span class="num" id="8460982">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460985">ConstantTimeCopy</span><span class="op" id="8461001">(</span><span class="ident" id="8461002">v</span><span class="op" id="8461003">,</span>&nbsp;<span class="ident" id="8461005">x</span><span class="op" id="8461006">,</span>&nbsp;<span class="ident" id="8461008">y</span><span class="op" id="8461009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461012">return</span>&nbsp;<span class="ident" id="8461019">x</span><br>
<span class="lineno">100</span><span class="op" id="8461021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8461024">func</span>&nbsp;<span class="ident" id="8461029">TestConstantTimeCopy</span><span class="op" id="8461049">(</span><span class="ident" id="8461050">t</span>&nbsp;<span class="op" id="8461052">*</span><span class="ident" id="8461053">testing</span><span class="op" id="8461060">.</span><span class="ident" id="8461061">T</span><span class="op" id="8461062">)</span>&nbsp;<span class="op" id="8461064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461067">err</span>&nbsp;<span class="op" id="8461071">:=</span>&nbsp;<span class="ident" id="8461074">quick</span><span class="op" id="8461079">.</span><span class="ident" id="8461080">CheckEqual</span><span class="op" id="8461090">(</span><span class="ident" id="8461091">constantTimeCopyWrapper</span><span class="op" id="8461114">,</span>&nbsp;<span class="ident" id="8461116">makeCopy</span><span class="op" id="8461124">,</span>&nbsp;<span class="ident" id="8461126">nil</span><span class="op" id="8461129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461132">if</span>&nbsp;<span class="ident" id="8461135">err</span>&nbsp;<span class="op" id="8461139">!=</span>&nbsp;<span class="ident" id="8461142">nil</span>&nbsp;<span class="op" id="8461146">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461150">t</span><span class="op" id="8461151">.</span><span class="ident" id="8461152">Error</span><span class="op" id="8461157">(</span><span class="ident" id="8461158">err</span><span class="op" id="8461161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461164">}</span><br>
<span class="lineno"></span><span class="op" id="8461166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8461169">var</span>&nbsp;<span class="ident" id="8461173">lessOrEqTests</span>&nbsp;<span class="op" id="8461187">=</span>&nbsp;<span class="op" id="8461189">[</span><span class="op" id="8461190">]</span><span class="keyword" id="8461191">struct</span>&nbsp;<span class="op" id="8461198">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461201">x</span><span class="op" id="8461202">,</span>&nbsp;<span class="ident" id="8461204">y</span><span class="op" id="8461205">,</span>&nbsp;<span class="ident" id="8461207">result</span>&nbsp;<span class="builtintype" id="8461214">int</span><br>
<span class="lineno"></span><span class="op" id="8461218">}</span><span class="op" id="8461219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461222">{</span><span class="num" id="8461223">0</span><span class="op" id="8461224">,</span>&nbsp;<span class="num" id="8461226">0</span><span class="op" id="8461227">,</span>&nbsp;<span class="num" id="8461229">1</span><span class="op" id="8461230">}</span><span class="op" id="8461231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461234">{</span><span class="num" id="8461235">1</span><span class="op" id="8461236">,</span>&nbsp;<span class="num" id="8461238">0</span><span class="op" id="8461239">,</span>&nbsp;<span class="num" id="8461241">0</span><span class="op" id="8461242">}</span><span class="op" id="8461243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461246">{</span><span class="num" id="8461247">0</span><span class="op" id="8461248">,</span>&nbsp;<span class="num" id="8461250">1</span><span class="op" id="8461251">,</span>&nbsp;<span class="num" id="8461253">1</span><span class="op" id="8461254">}</span><span class="op" id="8461255">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461258">{</span><span class="num" id="8461259">10</span><span class="op" id="8461261">,</span>&nbsp;<span class="num" id="8461263">20</span><span class="op" id="8461265">,</span>&nbsp;<span class="num" id="8461267">1</span><span class="op" id="8461268">}</span><span class="op" id="8461269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461272">{</span><span class="num" id="8461273">20</span><span class="op" id="8461275">,</span>&nbsp;<span class="num" id="8461277">10</span><span class="op" id="8461279">,</span>&nbsp;<span class="num" id="8461281">0</span><span class="op" id="8461282">}</span><span class="op" id="8461283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461286">{</span><span class="num" id="8461287">10</span><span class="op" id="8461289">,</span>&nbsp;<span class="num" id="8461291">10</span><span class="op" id="8461293">,</span>&nbsp;<span class="num" id="8461295">1</span><span class="op" id="8461296">}</span><span class="op" id="8461297">,</span><br>
<span class="lineno"></span><span class="op" id="8461299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8461302">func</span>&nbsp;<span class="ident" id="8461307">TestConstantTimeLessOrEq</span><span class="op" id="8461331">(</span><span class="ident" id="8461332">t</span>&nbsp;<span class="op" id="8461334">*</span><span class="ident" id="8461335">testing</span><span class="op" id="8461342">.</span><span class="ident" id="8461343">T</span><span class="op" id="8461344">)</span>&nbsp;<span class="op" id="8461346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461349">for</span>&nbsp;<span class="ident" id="8461353">i</span><span class="op" id="8461354">,</span>&nbsp;<span class="ident" id="8461356">test</span>&nbsp;<span class="op" id="8461361">:=</span>&nbsp;<span class="keyword" id="8461364">range</span>&nbsp;<span class="ident" id="8461370">lessOrEqTests</span>&nbsp;<span class="op" id="8461384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461388">result</span>&nbsp;<span class="op" id="8461395">:=</span>&nbsp;<span class="ident" id="8461398">ConstantTimeLessOrEq</span><span class="op" id="8461418">(</span><span class="ident" id="8461419">test</span><span class="op" id="8461423">.</span><span class="ident" id="8461424">x</span><span class="op" id="8461425">,</span>&nbsp;<span class="ident" id="8461427">test</span><span class="op" id="8461431">.</span><span class="ident" id="8461432">y</span><span class="op" id="8461433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461437">if</span>&nbsp;<span class="ident" id="8461440">result</span>&nbsp;<span class="op" id="8461447">!=</span>&nbsp;<span class="ident" id="8461450">test</span><span class="op" id="8461454">.</span><span class="ident" id="8461455">result</span>&nbsp;<span class="op" id="8461462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461467">t</span><span class="op" id="8461468">.</span><span class="ident" id="8461469">Errorf</span><span class="op" id="8461475">(</span><span class="string" id="8461476">&#34;#%d:&nbsp;%d&nbsp;&lt;=&nbsp;%d&nbsp;gave&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8461512">,</span>&nbsp;<span class="ident" id="8461514">i</span><span class="op" id="8461515">,</span>&nbsp;<span class="ident" id="8461517">test</span><span class="op" id="8461521">.</span><span class="ident" id="8461522">x</span><span class="op" id="8461523">,</span>&nbsp;<span class="ident" id="8461525">test</span><span class="op" id="8461529">.</span><span class="ident" id="8461530">y</span><span class="op" id="8461531">,</span>&nbsp;<span class="ident" id="8461533">result</span><span class="op" id="8461539">,</span>&nbsp;<span class="ident" id="8461541">test</span><span class="op" id="8461545">.</span><span class="ident" id="8461546">result</span><span class="op" id="8461552">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461559">}</span><br>
<span class="lineno"></span><span class="op" id="8461561">}</span>
</div>
</body>
</html>
