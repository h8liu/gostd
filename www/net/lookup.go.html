<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2641199">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2641255">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2641309">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2641360">package</span>&nbsp;<span class="ident" id="2641368">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2641373">import</span>&nbsp;<span class="string" id="2641380">&#34;time&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2641388">//&nbsp;protocols&nbsp;contains&nbsp;minimal&nbsp;mappings&nbsp;between&nbsp;internet&nbsp;protocol</span><br>
<span class="lineno">10</span><span class="comment" id="2641453">//&nbsp;names&nbsp;and&nbsp;numbers&nbsp;for&nbsp;platforms&nbsp;that&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;complete&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2641523">//&nbsp;protocol&nbsp;numbers.</span><br>
<span class="lineno"></span><span class="comment" id="2641544">//</span><br>
<span class="lineno"></span><span class="comment" id="2641547">//&nbsp;See&nbsp;http://www.iana.org/assignments/protocol-numbers</span><br>
<span class="lineno"></span><span class="keyword" id="2641603">var</span>&nbsp;<span class="ident" id="2641607">protocols</span>&nbsp;<span class="op" id="2641617">=</span>&nbsp;<span class="keyword" id="2641619">map</span><span class="op" id="2641622">[</span><span class="builtintype" id="2641623">string</span><span class="op" id="2641629">]</span><span class="builtintype" id="2641630">int</span><span class="op" id="2641633">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2641636">&#34;icmp&#34;</span><span class="op" id="2641642">:</span>&nbsp;<span class="num" id="2641644">1</span><span class="op" id="2641645">,</span>&nbsp;<span class="string" id="2641647">&#34;ICMP&#34;</span><span class="op" id="2641653">:</span>&nbsp;<span class="num" id="2641655">1</span><span class="op" id="2641656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2641659">&#34;igmp&#34;</span><span class="op" id="2641665">:</span>&nbsp;<span class="num" id="2641667">2</span><span class="op" id="2641668">,</span>&nbsp;<span class="string" id="2641670">&#34;IGMP&#34;</span><span class="op" id="2641676">:</span>&nbsp;<span class="num" id="2641678">2</span><span class="op" id="2641679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2641682">&#34;tcp&#34;</span><span class="op" id="2641687">:</span>&nbsp;<span class="num" id="2641689">6</span><span class="op" id="2641690">,</span>&nbsp;<span class="string" id="2641692">&#34;TCP&#34;</span><span class="op" id="2641697">:</span>&nbsp;<span class="num" id="2641699">6</span><span class="op" id="2641700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2641703">&#34;udp&#34;</span><span class="op" id="2641708">:</span>&nbsp;<span class="num" id="2641710">17</span><span class="op" id="2641712">,</span>&nbsp;<span class="string" id="2641714">&#34;UDP&#34;</span><span class="op" id="2641719">:</span>&nbsp;<span class="num" id="2641721">17</span><span class="op" id="2641723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2641726">&#34;ipv6-icmp&#34;</span><span class="op" id="2641737">:</span>&nbsp;<span class="num" id="2641739">58</span><span class="op" id="2641741">,</span>&nbsp;<span class="string" id="2641743">&#34;IPV6-ICMP&#34;</span><span class="op" id="2641754">:</span>&nbsp;<span class="num" id="2641756">58</span><span class="op" id="2641758">,</span>&nbsp;<span class="string" id="2641760">&#34;IPv6-ICMP&#34;</span><span class="op" id="2641771">:</span>&nbsp;<span class="num" id="2641773">58</span><span class="op" id="2641775">,</span><br>
<span class="lineno">20</span><span class="op" id="2641777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2641780">//&nbsp;LookupHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;given&nbsp;host&nbsp;using&nbsp;the&nbsp;local&nbsp;resolver.</span><br>
<span class="lineno"></span><span class="comment" id="2641844">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;that&nbsp;host&#39;s&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="2641893">func</span>&nbsp;<span class="ident" id="2641898">LookupHost</span><span class="op" id="2641908">(</span><span class="ident" id="2641909">host</span>&nbsp;<span class="builtintype" id="2641914">string</span><span class="op" id="2641920">)</span>&nbsp;<span class="op" id="2641922">(</span><span class="ident" id="2641923">addrs</span>&nbsp;<span class="op" id="2641929">[</span><span class="op" id="2641930">]</span><span class="builtintype" id="2641931">string</span><span class="op" id="2641937">,</span>&nbsp;<span class="ident" id="2641939">err</span>&nbsp;<span class="builtintype" id="2641943">error</span><span class="op" id="2641948">)</span>&nbsp;<span class="op" id="2641950">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2641953">return</span>&nbsp;<span class="ident" id="2641960"><a href="/net/lookup_unix.go.html#2646963">lookupHost</a></span><span class="op" id="2641970">(</span><span class="ident" id="2641971"><a href="/net/lookup.go.html#2641909">host</a></span><span class="op" id="2641975">)</span><br>
<span class="lineno"></span><span class="op" id="2641977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2641980">//&nbsp;LookupIP&nbsp;looks&nbsp;up&nbsp;host&nbsp;using&nbsp;the&nbsp;local&nbsp;resolver.</span><br>
<span class="lineno"></span><span class="comment" id="2642032">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;that&nbsp;host&#39;s&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno">30</span><span class="keyword" id="2642095">func</span>&nbsp;<span class="ident" id="2642100">LookupIP</span><span class="op" id="2642108">(</span><span class="ident" id="2642109">host</span>&nbsp;<span class="builtintype" id="2642114">string</span><span class="op" id="2642120">)</span>&nbsp;<span class="op" id="2642122">(</span><span class="ident" id="2642123">addrs</span>&nbsp;<span class="op" id="2642129">[</span><span class="op" id="2642130">]</span><span class="ident" id="2642131"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2642133">,</span>&nbsp;<span class="ident" id="2642135">err</span>&nbsp;<span class="builtintype" id="2642139">error</span><span class="op" id="2642144">)</span>&nbsp;<span class="op" id="2642146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2642149">return</span>&nbsp;<span class="ident" id="2642156"><a href="/net/lookup.go.html#2642384">lookupIPMerge</a></span><span class="op" id="2642169">(</span><span class="ident" id="2642170"><a href="/net/lookup.go.html#2642109">host</a></span><span class="op" id="2642174">)</span><br>
<span class="lineno"></span><span class="op" id="2642176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2642179">var</span>&nbsp;<span class="ident" id="2642183">lookupGroup</span>&nbsp;<span class="ident" id="2642195"><a href="/net/singleflight.go.html#2673436">singleflight</a></span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="2642209">//&nbsp;lookupIPMerge&nbsp;wraps&nbsp;lookupIP,&nbsp;but&nbsp;makes&nbsp;sure&nbsp;that&nbsp;for&nbsp;any&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="2642276">//&nbsp;host,&nbsp;only&nbsp;one&nbsp;lookup&nbsp;is&nbsp;in-flight&nbsp;at&nbsp;a&nbsp;time.&nbsp;The&nbsp;returned&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="2642345">//&nbsp;is&nbsp;always&nbsp;owned&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="keyword" id="2642379">func</span>&nbsp;<span class="ident" id="2642384">lookupIPMerge</span><span class="op" id="2642397">(</span><span class="ident" id="2642398">host</span>&nbsp;<span class="builtintype" id="2642403">string</span><span class="op" id="2642409">)</span>&nbsp;<span class="op" id="2642411">(</span><span class="ident" id="2642412">addrs</span>&nbsp;<span class="op" id="2642418">[</span><span class="op" id="2642419">]</span><span class="ident" id="2642420"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2642422">,</span>&nbsp;<span class="ident" id="2642424">err</span>&nbsp;<span class="builtintype" id="2642428">error</span><span class="op" id="2642433">)</span>&nbsp;<span class="op" id="2642435">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2642438">addrsi</span><span class="op" id="2642444">,</span>&nbsp;<span class="ident" id="2642446"><a href="/net/lookup.go.html#2642424">err</a></span><span class="op" id="2642449">,</span>&nbsp;<span class="ident" id="2642451">shared</span>&nbsp;<span class="op" id="2642458">:=</span>&nbsp;<span class="ident" id="2642461"><a href="/net/lookup.go.html#2642183">lookupGroup</a></span><span class="op" id="2642472">.</span><span class="ident" id="2642473">Do</span><span class="op" id="2642475">(</span><span class="ident" id="2642476"><a href="/net/lookup.go.html#2642398">host</a></span><span class="op" id="2642480">,</span>&nbsp;<span class="keyword" id="2642482">func</span><span class="op" id="2642486">(</span><span class="op" id="2642487">)</span>&nbsp;<span class="op" id="2642489">(</span><span class="keyword" id="2642490">interface</span><span class="op" id="2642499">{</span><span class="op" id="2642500">}</span><span class="op" id="2642501">,</span>&nbsp;<span class="builtintype" id="2642503">error</span><span class="op" id="2642508">)</span>&nbsp;<span class="op" id="2642510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2642514">return</span>&nbsp;<span class="ident" id="2642521"><a href="/net/lookup_unix.go.html#2647119">lookupIP</a></span><span class="op" id="2642529">(</span><span class="ident" id="2642530"><a href="/net/lookup.go.html#2642398">host</a></span><span class="op" id="2642534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2642537">}</span><span class="op" id="2642538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2642541">return</span>&nbsp;<span class="ident" id="2642548"><a href="/net/lookup.go.html#2642696">lookupIPReturn</a></span><span class="op" id="2642562">(</span><span class="ident" id="2642563"><a href="/net/lookup.go.html#2642438">addrsi</a></span><span class="op" id="2642569">,</span>&nbsp;<span class="ident" id="2642571"><a href="/net/lookup.go.html#2642424">err</a></span><span class="op" id="2642574">,</span>&nbsp;<span class="ident" id="2642576"><a href="/net/lookup.go.html#2642451">shared</a></span><span class="op" id="2642582">)</span><br>
<span class="lineno"></span><span class="op" id="2642584">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2642587">//&nbsp;lookupIPReturn&nbsp;turns&nbsp;the&nbsp;return&nbsp;values&nbsp;from&nbsp;singleflight.Do&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="2642655">//&nbsp;the&nbsp;return&nbsp;values&nbsp;from&nbsp;LookupIP.</span><br>
<span class="lineno"></span><span class="keyword" id="2642691">func</span>&nbsp;<span class="ident" id="2642696">lookupIPReturn</span><span class="op" id="2642710">(</span><span class="ident" id="2642711">addrsi</span>&nbsp;<span class="keyword" id="2642718">interface</span><span class="op" id="2642727">{</span><span class="op" id="2642728">}</span><span class="op" id="2642729">,</span>&nbsp;<span class="ident" id="2642731">err</span>&nbsp;<span class="builtintype" id="2642735">error</span><span class="op" id="2642740">,</span>&nbsp;<span class="ident" id="2642742">shared</span>&nbsp;<span class="builtintype" id="2642749">bool</span><span class="op" id="2642753">)</span>&nbsp;<span class="op" id="2642755">(</span><span class="op" id="2642756">[</span><span class="op" id="2642757">]</span><span class="ident" id="2642758"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2642760">,</span>&nbsp;<span class="builtintype" id="2642762">error</span><span class="op" id="2642767">)</span>&nbsp;<span class="op" id="2642769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2642772">if</span>&nbsp;<span class="ident" id="2642775"><a href="/net/lookup.go.html#2642731">err</a></span>&nbsp;<span class="op" id="2642779">!=</span>&nbsp;<span class="ident" id="2642782">nil</span>&nbsp;<span class="op" id="2642786">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2642790">return</span>&nbsp;<span class="ident" id="2642797">nil</span><span class="op" id="2642800">,</span>&nbsp;<span class="ident" id="2642802"><a href="/net/lookup.go.html#2642731">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2642807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2642810">addrs</span>&nbsp;<span class="op" id="2642816">:=</span>&nbsp;<span class="ident" id="2642819"><a href="/net/lookup.go.html#2642711">addrsi</a></span><span class="op" id="2642825">.</span><span class="op" id="2642826">(</span><span class="op" id="2642827">[</span><span class="op" id="2642828">]</span><span class="ident" id="2642829"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2642831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2642834">if</span>&nbsp;<span class="ident" id="2642837"><a href="/net/lookup.go.html#2642742">shared</a></span>&nbsp;<span class="op" id="2642844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2642848">clone</span>&nbsp;<span class="op" id="2642854">:=</span>&nbsp;<span class="builtinfunc" id="2642857">make</span><span class="op" id="2642861">(</span><span class="op" id="2642862">[</span><span class="op" id="2642863">]</span><span class="ident" id="2642864"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2642866">,</span>&nbsp;<span class="builtinfunc" id="2642868">len</span><span class="op" id="2642871">(</span><span class="ident" id="2642872"><a href="/net/lookup.go.html#2642810">addrs</a></span><span class="op" id="2642877">)</span><span class="op" id="2642878">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2642882">copy</span><span class="op" id="2642886">(</span><span class="ident" id="2642887"><a href="/net/lookup.go.html#2642848">clone</a></span><span class="op" id="2642892">,</span>&nbsp;<span class="ident" id="2642894"><a href="/net/lookup.go.html#2642810">addrs</a></span><span class="op" id="2642899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2642903"><a href="/net/lookup.go.html#2642810">addrs</a></span>&nbsp;<span class="op" id="2642909">=</span>&nbsp;<span class="ident" id="2642911"><a href="/net/lookup.go.html#2642848">clone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2642918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2642921">return</span>&nbsp;<span class="ident" id="2642928"><a href="/net/lookup.go.html#2642810">addrs</a></span><span class="op" id="2642933">,</span>&nbsp;<span class="ident" id="2642935">nil</span><br>
<span class="lineno"></span><span class="op" id="2642939">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="2642942">//&nbsp;lookupIPDeadline&nbsp;looks&nbsp;up&nbsp;a&nbsp;hostname&nbsp;with&nbsp;a&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="2642999">func</span>&nbsp;<span class="ident" id="2643004">lookupIPDeadline</span><span class="op" id="2643020">(</span><span class="ident" id="2643021">host</span>&nbsp;<span class="builtintype" id="2643026">string</span><span class="op" id="2643032">,</span>&nbsp;<span class="ident" id="2643034">deadline</span>&nbsp;<span class="ident" id="2643043"><a href="/net/lookup.go.html#2641380">time</a></span><span class="op" id="2643047">.</span><span class="ident" id="2643048">Time</span><span class="op" id="2643052">)</span>&nbsp;<span class="op" id="2643054">(</span><span class="ident" id="2643055">addrs</span>&nbsp;<span class="op" id="2643061">[</span><span class="op" id="2643062">]</span><span class="ident" id="2643063"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2643065">,</span>&nbsp;<span class="ident" id="2643067">err</span>&nbsp;<span class="builtintype" id="2643071">error</span><span class="op" id="2643076">)</span>&nbsp;<span class="op" id="2643078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2643081">if</span>&nbsp;<span class="ident" id="2643084"><a href="/net/lookup.go.html#2643034">deadline</a></span><span class="op" id="2643092">.</span><span class="ident" id="2643093">IsZero</span><span class="op" id="2643099">(</span><span class="op" id="2643100">)</span>&nbsp;<span class="op" id="2643102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2643106">return</span>&nbsp;<span class="ident" id="2643113"><a href="/net/lookup.go.html#2642384">lookupIPMerge</a></span><span class="op" id="2643126">(</span><span class="ident" id="2643127"><a href="/net/lookup.go.html#2643021">host</a></span><span class="op" id="2643131">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2643134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2643138">//&nbsp;We&nbsp;could&nbsp;push&nbsp;the&nbsp;deadline&nbsp;down&nbsp;into&nbsp;the&nbsp;name&nbsp;resolution</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2643199">//&nbsp;functions.&nbsp;&nbsp;However,&nbsp;the&nbsp;most&nbsp;commonly&nbsp;used&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2643262">//&nbsp;calls&nbsp;getaddrinfo,&nbsp;which&nbsp;has&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2643308">timeout</span>&nbsp;<span class="op" id="2643316">:=</span>&nbsp;<span class="ident" id="2643319"><a href="/net/lookup.go.html#2643034">deadline</a></span><span class="op" id="2643327">.</span><span class="ident" id="2643328">Sub</span><span class="op" id="2643331">(</span><span class="ident" id="2643332"><a href="/net/lookup.go.html#2641380">time</a></span><span class="op" id="2643336">.</span><span class="ident" id="2643337">Now</span><span class="op" id="2643340">(</span><span class="op" id="2643341">)</span><span class="op" id="2643342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2643345">if</span>&nbsp;<span class="ident" id="2643348"><a href="/net/lookup.go.html#2643308">timeout</a></span>&nbsp;<span class="op" id="2643356">&lt;=</span>&nbsp;<span class="num" id="2643359">0</span>&nbsp;<span class="op" id="2643361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2643365">return</span>&nbsp;<span class="ident" id="2643372">nil</span><span class="op" id="2643375">,</span>&nbsp;<span class="ident" id="2643377"><a href="/net/net.go.html#2659253">errTimeout</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2643389">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2643392">t</span>&nbsp;<span class="op" id="2643394">:=</span>&nbsp;<span class="ident" id="2643397"><a href="/net/lookup.go.html#2641380">time</a></span><span class="op" id="2643401">.</span><span class="ident" id="2643402">NewTimer</span><span class="op" id="2643410">(</span><span class="ident" id="2643411"><a href="/net/lookup.go.html#2643308">timeout</a></span><span class="op" id="2643418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2643421">defer</span>&nbsp;<span class="ident" id="2643427"><a href="/net/lookup.go.html#2643392">t</a></span><span class="op" id="2643428">.</span><span class="ident" id="2643429">Stop</span><span class="op" id="2643433">(</span><span class="op" id="2643434">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2643438">ch</span>&nbsp;<span class="op" id="2643441">:=</span>&nbsp;<span class="ident" id="2643444"><a href="/net/lookup.go.html#2642183">lookupGroup</a></span><span class="op" id="2643455">.</span><span class="ident" id="2643456">DoChan</span><span class="op" id="2643462">(</span><span class="ident" id="2643463"><a href="/net/lookup.go.html#2643021">host</a></span><span class="op" id="2643467">,</span>&nbsp;<span class="keyword" id="2643469">func</span><span class="op" id="2643473">(</span><span class="op" id="2643474">)</span>&nbsp;<span class="op" id="2643476">(</span><span class="keyword" id="2643477">interface</span><span class="op" id="2643486">{</span><span class="op" id="2643487">}</span><span class="op" id="2643488">,</span>&nbsp;<span class="builtintype" id="2643490">error</span><span class="op" id="2643495">)</span>&nbsp;<span class="op" id="2643497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2643501">return</span>&nbsp;<span class="ident" id="2643508"><a href="/net/lookup_unix.go.html#2647119">lookupIP</a></span><span class="op" id="2643516">(</span><span class="ident" id="2643517"><a href="/net/lookup.go.html#2643021">host</a></span><span class="op" id="2643521">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2643524">}</span><span class="op" id="2643525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2643529">select</span>&nbsp;<span class="op" id="2643536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2643539">case</span>&nbsp;<span class="op" id="2643544">&lt;-</span><span class="ident" id="2643546"><a href="/net/lookup.go.html#2643392">t</a></span><span class="op" id="2643547">.</span><span class="ident" id="2643548">C</span><span class="op" id="2643549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2643553">//&nbsp;The&nbsp;DNS&nbsp;lookup&nbsp;timed&nbsp;out&nbsp;for&nbsp;some&nbsp;reason.&nbsp;&nbsp;Force</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2643607">//&nbsp;future&nbsp;requests&nbsp;to&nbsp;start&nbsp;the&nbsp;DNS&nbsp;lookup&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2643658">//&nbsp;rather&nbsp;than&nbsp;waiting&nbsp;for&nbsp;the&nbsp;current&nbsp;lookup&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2643709">//&nbsp;complete.&nbsp;&nbsp;See&nbsp;issue&nbsp;8602.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2643741"><a href="/net/lookup.go.html#2642183">lookupGroup</a></span><span class="op" id="2643752">.</span><span class="ident" id="2643753">Forget</span><span class="op" id="2643759">(</span><span class="ident" id="2643760"><a href="/net/lookup.go.html#2643021">host</a></span><span class="op" id="2643764">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2643769">return</span>&nbsp;<span class="ident" id="2643776">nil</span><span class="op" id="2643779">,</span>&nbsp;<span class="ident" id="2643781"><a href="/net/net.go.html#2659253">errTimeout</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2643794">case</span>&nbsp;<span class="ident" id="2643799">r</span>&nbsp;<span class="op" id="2643801">:=</span>&nbsp;<span class="op" id="2643804">&lt;-</span><span class="ident" id="2643806"><a href="/net/lookup.go.html#2643438">ch</a></span><span class="op" id="2643808">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2643812">return</span>&nbsp;<span class="ident" id="2643819"><a href="/net/lookup.go.html#2642696">lookupIPReturn</a></span><span class="op" id="2643833">(</span><span class="ident" id="2643834"><a href="/net/lookup.go.html#2643799">r</a></span><span class="op" id="2643835">.</span><span class="ident" id="2643836">v</span><span class="op" id="2643837">,</span>&nbsp;<span class="ident" id="2643839"><a href="/net/lookup.go.html#2643799">r</a></span><span class="op" id="2643840">.</span><span class="ident" id="2643841">err</span><span class="op" id="2643844">,</span>&nbsp;<span class="ident" id="2643846"><a href="/net/lookup.go.html#2643799">r</a></span><span class="op" id="2643847">.</span><span class="ident" id="2643848">shared</span><span class="op" id="2643854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2643857">}</span><br>
<span class="lineno">95</span><span class="op" id="2643859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2643862">//&nbsp;LookupPort&nbsp;looks&nbsp;up&nbsp;the&nbsp;port&nbsp;for&nbsp;the&nbsp;given&nbsp;network&nbsp;and&nbsp;service.</span><br>
<span class="lineno"></span><span class="keyword" id="2643929">func</span>&nbsp;<span class="ident" id="2643934">LookupPort</span><span class="op" id="2643944">(</span><span class="ident" id="2643945">network</span><span class="op" id="2643952">,</span>&nbsp;<span class="ident" id="2643954">service</span>&nbsp;<span class="builtintype" id="2643962">string</span><span class="op" id="2643968">)</span>&nbsp;<span class="op" id="2643970">(</span><span class="ident" id="2643971">port</span>&nbsp;<span class="builtintype" id="2643976">int</span><span class="op" id="2643979">,</span>&nbsp;<span class="ident" id="2643981">err</span>&nbsp;<span class="builtintype" id="2643985">error</span><span class="op" id="2643990">)</span>&nbsp;<span class="op" id="2643992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2643995">return</span>&nbsp;<span class="ident" id="2644002"><a href="/net/lookup_unix.go.html#2647265">lookupPort</a></span><span class="op" id="2644012">(</span><span class="ident" id="2644013"><a href="/net/lookup.go.html#2643945">network</a></span><span class="op" id="2644020">,</span>&nbsp;<span class="ident" id="2644022"><a href="/net/lookup.go.html#2643954">service</a></span><span class="op" id="2644029">)</span><br>
<span class="lineno">100</span><span class="op" id="2644031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2644034">//&nbsp;LookupCNAME&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;DNS&nbsp;host&nbsp;for&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="2644100">//&nbsp;Callers&nbsp;that&nbsp;do&nbsp;not&nbsp;care&nbsp;about&nbsp;the&nbsp;canonical&nbsp;name&nbsp;can&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="2644162">//&nbsp;LookupHost&nbsp;or&nbsp;LookupIP&nbsp;directly;&nbsp;both&nbsp;take&nbsp;care&nbsp;of&nbsp;resolving</span><br>
<span class="lineno">105</span><span class="comment" id="2644226">//&nbsp;the&nbsp;canonical&nbsp;name&nbsp;as&nbsp;part&nbsp;of&nbsp;the&nbsp;lookup.</span><br>
<span class="lineno"></span><span class="keyword" id="2644271">func</span>&nbsp;<span class="ident" id="2644276">LookupCNAME</span><span class="op" id="2644287">(</span><span class="ident" id="2644288">name</span>&nbsp;<span class="builtintype" id="2644293">string</span><span class="op" id="2644299">)</span>&nbsp;<span class="op" id="2644301">(</span><span class="ident" id="2644302">cname</span>&nbsp;<span class="builtintype" id="2644308">string</span><span class="op" id="2644314">,</span>&nbsp;<span class="ident" id="2644316">err</span>&nbsp;<span class="builtintype" id="2644320">error</span><span class="op" id="2644325">)</span>&nbsp;<span class="op" id="2644327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2644330">return</span>&nbsp;<span class="ident" id="2644337"><a href="/net/lookup_unix.go.html#2647449">lookupCNAME</a></span><span class="op" id="2644348">(</span><span class="ident" id="2644349"><a href="/net/lookup.go.html#2644288">name</a></span><span class="op" id="2644353">)</span><br>
<span class="lineno"></span><span class="op" id="2644355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="2644358">//&nbsp;LookupSRV&nbsp;tries&nbsp;to&nbsp;resolve&nbsp;an&nbsp;SRV&nbsp;query&nbsp;of&nbsp;the&nbsp;given&nbsp;service,</span><br>
<span class="lineno"></span><span class="comment" id="2644423">//&nbsp;protocol,&nbsp;and&nbsp;domain&nbsp;name.&nbsp;&nbsp;The&nbsp;proto&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;or&nbsp;&#34;udp&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2644483">//&nbsp;The&nbsp;returned&nbsp;records&nbsp;are&nbsp;sorted&nbsp;by&nbsp;priority&nbsp;and&nbsp;randomized</span><br>
<span class="lineno"></span><span class="comment" id="2644545">//&nbsp;by&nbsp;weight&nbsp;within&nbsp;a&nbsp;priority.</span><br>
<span class="lineno"></span><span class="comment" id="2644577">//</span><br>
<span class="lineno">115</span><span class="comment" id="2644580">//&nbsp;LookupSRV&nbsp;constructs&nbsp;the&nbsp;DNS&nbsp;name&nbsp;to&nbsp;look&nbsp;up&nbsp;following&nbsp;RFC&nbsp;2782.</span><br>
<span class="lineno"></span><span class="comment" id="2644648">//&nbsp;That&nbsp;is,&nbsp;it&nbsp;looks&nbsp;up&nbsp;_service._proto.name.&nbsp;&nbsp;To&nbsp;accommodate&nbsp;services</span><br>
<span class="lineno"></span><span class="comment" id="2644719">//&nbsp;publishing&nbsp;SRV&nbsp;records&nbsp;under&nbsp;non-standard&nbsp;names,&nbsp;if&nbsp;both&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="2644787">//&nbsp;and&nbsp;proto&nbsp;are&nbsp;empty&nbsp;strings,&nbsp;LookupSRV&nbsp;looks&nbsp;up&nbsp;name&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="2644853">func</span>&nbsp;<span class="ident" id="2644858">LookupSRV</span><span class="op" id="2644867">(</span><span class="ident" id="2644868">service</span><span class="op" id="2644875">,</span>&nbsp;<span class="ident" id="2644877">proto</span><span class="op" id="2644882">,</span>&nbsp;<span class="ident" id="2644884">name</span>&nbsp;<span class="builtintype" id="2644889">string</span><span class="op" id="2644895">)</span>&nbsp;<span class="op" id="2644897">(</span><span class="ident" id="2644898">cname</span>&nbsp;<span class="builtintype" id="2644904">string</span><span class="op" id="2644910">,</span>&nbsp;<span class="ident" id="2644912">addrs</span>&nbsp;<span class="op" id="2644918">[</span><span class="op" id="2644919">]</span><span class="op" id="2644920">*</span><span class="ident" id="2644921"><a href="/net/dnsclient.go.html#2530811">SRV</a></span><span class="op" id="2644924">,</span>&nbsp;<span class="ident" id="2644926">err</span>&nbsp;<span class="builtintype" id="2644930">error</span><span class="op" id="2644935">)</span>&nbsp;<span class="op" id="2644937">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2644940">return</span>&nbsp;<span class="ident" id="2644947"><a href="/net/lookup_unix.go.html#2647606">lookupSRV</a></span><span class="op" id="2644956">(</span><span class="ident" id="2644957"><a href="/net/lookup.go.html#2644868">service</a></span><span class="op" id="2644964">,</span>&nbsp;<span class="ident" id="2644966"><a href="/net/lookup.go.html#2644877">proto</a></span><span class="op" id="2644971">,</span>&nbsp;<span class="ident" id="2644973"><a href="/net/lookup.go.html#2644884">name</a></span><span class="op" id="2644977">)</span><br>
<span class="lineno"></span><span class="op" id="2644979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2644982">//&nbsp;LookupMX&nbsp;returns&nbsp;the&nbsp;DNS&nbsp;MX&nbsp;records&nbsp;for&nbsp;the&nbsp;given&nbsp;domain&nbsp;name&nbsp;sorted&nbsp;by&nbsp;preference.</span><br>
<span class="lineno"></span><span class="keyword" id="2645069">func</span>&nbsp;<span class="ident" id="2645074">LookupMX</span><span class="op" id="2645082">(</span><span class="ident" id="2645083">name</span>&nbsp;<span class="builtintype" id="2645088">string</span><span class="op" id="2645094">)</span>&nbsp;<span class="op" id="2645096">(</span><span class="ident" id="2645097">mx</span>&nbsp;<span class="op" id="2645100">[</span><span class="op" id="2645101">]</span><span class="op" id="2645102">*</span><span class="ident" id="2645103"><a href="/net/dnsclient.go.html#2532096">MX</a></span><span class="op" id="2645105">,</span>&nbsp;<span class="ident" id="2645107">err</span>&nbsp;<span class="builtintype" id="2645111">error</span><span class="op" id="2645116">)</span>&nbsp;<span class="op" id="2645118">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2645121">return</span>&nbsp;<span class="ident" id="2645128"><a href="/net/lookup_unix.go.html#2648121">lookupMX</a></span><span class="op" id="2645136">(</span><span class="ident" id="2645137"><a href="/net/lookup.go.html#2645083">name</a></span><span class="op" id="2645141">)</span><br>
<span class="lineno"></span><span class="op" id="2645143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2645146">//&nbsp;LookupNS&nbsp;returns&nbsp;the&nbsp;DNS&nbsp;NS&nbsp;records&nbsp;for&nbsp;the&nbsp;given&nbsp;domain&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2645212">func</span>&nbsp;<span class="ident" id="2645217">LookupNS</span><span class="op" id="2645225">(</span><span class="ident" id="2645226">name</span>&nbsp;<span class="builtintype" id="2645231">string</span><span class="op" id="2645237">)</span>&nbsp;<span class="op" id="2645239">(</span><span class="ident" id="2645240">ns</span>&nbsp;<span class="op" id="2645243">[</span><span class="op" id="2645244">]</span><span class="op" id="2645245">*</span><span class="ident" id="2645246"><a href="/net/dnsclient.go.html#2532618">NS</a></span><span class="op" id="2645248">,</span>&nbsp;<span class="ident" id="2645250">err</span>&nbsp;<span class="builtintype" id="2645254">error</span><span class="op" id="2645259">)</span>&nbsp;<span class="op" id="2645261">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2645264">return</span>&nbsp;<span class="ident" id="2645271"><a href="/net/lookup_unix.go.html#2648390">lookupNS</a></span><span class="op" id="2645279">(</span><span class="ident" id="2645280"><a href="/net/lookup.go.html#2645226">name</a></span><span class="op" id="2645284">)</span><br>
<span class="lineno"></span><span class="op" id="2645286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2645289">//&nbsp;LookupTXT&nbsp;returns&nbsp;the&nbsp;DNS&nbsp;TXT&nbsp;records&nbsp;for&nbsp;the&nbsp;given&nbsp;domain&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2645357">func</span>&nbsp;<span class="ident" id="2645362">LookupTXT</span><span class="op" id="2645371">(</span><span class="ident" id="2645372">name</span>&nbsp;<span class="builtintype" id="2645377">string</span><span class="op" id="2645383">)</span>&nbsp;<span class="op" id="2645385">(</span><span class="ident" id="2645386">txt</span>&nbsp;<span class="op" id="2645390">[</span><span class="op" id="2645391">]</span><span class="builtintype" id="2645392">string</span><span class="op" id="2645398">,</span>&nbsp;<span class="ident" id="2645400">err</span>&nbsp;<span class="builtintype" id="2645404">error</span><span class="op" id="2645409">)</span>&nbsp;<span class="op" id="2645411">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2645414">return</span>&nbsp;<span class="ident" id="2645421"><a href="/net/lookup_unix.go.html#2648630">lookupTXT</a></span><span class="op" id="2645430">(</span><span class="ident" id="2645431"><a href="/net/lookup.go.html#2645372">name</a></span><span class="op" id="2645435">)</span><br>
<span class="lineno"></span><span class="op" id="2645437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2645440">//&nbsp;LookupAddr&nbsp;performs&nbsp;a&nbsp;reverse&nbsp;lookup&nbsp;for&nbsp;the&nbsp;given&nbsp;address,&nbsp;returning&nbsp;a&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="2645520">//&nbsp;of&nbsp;names&nbsp;mapping&nbsp;to&nbsp;that&nbsp;address.</span><br>
<span class="lineno">140</span><span class="keyword" id="2645557">func</span>&nbsp;<span class="ident" id="2645562">LookupAddr</span><span class="op" id="2645572">(</span><span class="ident" id="2645573">addr</span>&nbsp;<span class="builtintype" id="2645578">string</span><span class="op" id="2645584">)</span>&nbsp;<span class="op" id="2645586">(</span><span class="ident" id="2645587">name</span>&nbsp;<span class="op" id="2645592">[</span><span class="op" id="2645593">]</span><span class="builtintype" id="2645594">string</span><span class="op" id="2645600">,</span>&nbsp;<span class="ident" id="2645602">err</span>&nbsp;<span class="builtintype" id="2645606">error</span><span class="op" id="2645611">)</span>&nbsp;<span class="op" id="2645613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2645616">return</span>&nbsp;<span class="ident" id="2645623"><a href="/net/lookup_unix.go.html#2648869">lookupAddr</a></span><span class="op" id="2645633">(</span><span class="ident" id="2645634"><a href="/net/lookup.go.html#2645573">addr</a></span><span class="op" id="2645638">)</span><br>
<span class="lineno"></span><span class="op" id="2645640">}</span>
</div>
</body>
</html>
