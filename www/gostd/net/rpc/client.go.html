<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5068613">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5068668">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5068722">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5068773">package</span>&nbsp;<span class="ident" id="5068781">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5068786">import</span>&nbsp;<span class="op" id="5068793">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068796">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068805">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068821">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068831">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068837">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068844">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068851">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068863">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5068870">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5068873">//&nbsp;ServerError&nbsp;represents&nbsp;an&nbsp;error&nbsp;that&nbsp;has&nbsp;been&nbsp;returned&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5068936">//&nbsp;the&nbsp;remote&nbsp;side&nbsp;of&nbsp;the&nbsp;RPC&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="5068978">type</span>&nbsp;<span class="ident" id="5068983">ServerError</span>&nbsp;<span class="builtintype" id="5068995">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5069003">func</span>&nbsp;<span class="op" id="5069008">(</span><span class="ident" id="5069009">e</span>&nbsp;<span class="ident" id="5069011">ServerError</span><span class="op" id="5069022">)</span>&nbsp;<span class="ident" id="5069024">Error</span><span class="op" id="5069029">(</span><span class="op" id="5069030">)</span>&nbsp;<span class="builtintype" id="5069032">string</span>&nbsp;<span class="op" id="5069039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5069042">return</span>&nbsp;<span class="builtintype" id="5069049">string</span><span class="op" id="5069055">(</span><span class="ident" id="5069056">e</span><span class="op" id="5069057">)</span><br>
<span class="lineno"></span><span class="op" id="5069059">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5069062">var</span>&nbsp;<span class="ident" id="5069066">ErrShutdown</span>&nbsp;<span class="op" id="5069078">=</span>&nbsp;<span class="ident" id="5069080">errors</span><span class="op" id="5069086">.</span><span class="ident" id="5069087">New</span><span class="op" id="5069090">(</span><span class="string" id="5069091">&#34;connection&nbsp;is&nbsp;shut&nbsp;down&#34;</span><span class="op" id="5069116">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5069119">//&nbsp;Call&nbsp;represents&nbsp;an&nbsp;active&nbsp;RPC.</span><br>
<span class="lineno"></span><span class="keyword" id="5069153">type</span>&nbsp;<span class="ident" id="5069158">Call</span>&nbsp;<span class="keyword" id="5069163">struct</span>&nbsp;<span class="op" id="5069170">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069173">ServiceMethod</span>&nbsp;<span class="builtintype" id="5069187">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5069199">//&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069247">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5069261">interface</span><span class="op" id="5069270">{</span><span class="op" id="5069271">}</span>&nbsp;<span class="comment" id="5069273">//&nbsp;The&nbsp;argument&nbsp;to&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069317">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5069331">interface</span><span class="op" id="5069340">{</span><span class="op" id="5069341">}</span>&nbsp;<span class="comment" id="5069343">//&nbsp;The&nbsp;reply&nbsp;from&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069386">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5069400">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5069412">//&nbsp;After&nbsp;completion,&nbsp;the&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069452">Done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5069466">chan</span>&nbsp;<span class="op" id="5069471">*</span><span class="ident" id="5069472">Call</span>&nbsp;&nbsp;<span class="comment" id="5069478">//&nbsp;Strobes&nbsp;when&nbsp;call&nbsp;is&nbsp;complete.</span><br>
<span class="lineno">35</span><span class="op" id="5069512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5069515">//&nbsp;Client&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Client.</span><br>
<span class="lineno"></span><span class="comment" id="5069551">//&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;outstanding&nbsp;Calls&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5069605">//&nbsp;with&nbsp;a&nbsp;single&nbsp;Client,&nbsp;and&nbsp;a&nbsp;Client&nbsp;may&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno">40</span><span class="comment" id="5069658">//&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="keyword" id="5069697">type</span>&nbsp;<span class="ident" id="5069702">Client</span>&nbsp;<span class="keyword" id="5069709">struct</span>&nbsp;<span class="op" id="5069716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069719">codec</span>&nbsp;<span class="ident" id="5069725">ClientCodec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069739">reqMutex</span>&nbsp;<span class="ident" id="5069748">sync</span><span class="op" id="5069752">.</span><span class="ident" id="5069753">Mutex</span>&nbsp;<span class="comment" id="5069759">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069782">request</span>&nbsp;&nbsp;<span class="ident" id="5069791">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069801">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069810">sync</span><span class="op" id="5069814">.</span><span class="ident" id="5069815">Mutex</span>&nbsp;<span class="comment" id="5069821">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069844">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069853">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069861">pending</span>&nbsp;&nbsp;<span class="keyword" id="5069870">map</span><span class="op" id="5069873">[</span><span class="ident" id="5069874">uint64</span><span class="op" id="5069880">]</span><span class="op" id="5069881">*</span><span class="ident" id="5069882">Call</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069888">closing</span>&nbsp;&nbsp;<span class="builtintype" id="5069897">bool</span>&nbsp;<span class="comment" id="5069902">//&nbsp;user&nbsp;has&nbsp;called&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069928">shutdown</span>&nbsp;<span class="builtintype" id="5069937">bool</span>&nbsp;<span class="comment" id="5069942">//&nbsp;server&nbsp;has&nbsp;told&nbsp;us&nbsp;to&nbsp;stop</span><br>
<span class="lineno"></span><span class="op" id="5069972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5069975">//&nbsp;A&nbsp;ClientCodec&nbsp;implements&nbsp;writing&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and</span><br>
<span class="lineno">55</span><span class="comment" id="5070031">//&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;client&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="5070098">//&nbsp;The&nbsp;client&nbsp;calls&nbsp;WriteRequest&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5070168">//&nbsp;and&nbsp;calls&nbsp;ReadResponseHeader&nbsp;and&nbsp;ReadResponseBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5070230">//&nbsp;to&nbsp;read&nbsp;responses.&nbsp;&nbsp;The&nbsp;client&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5070299">//&nbsp;connection.&nbsp;ReadResponseBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">60</span><span class="comment" id="5070356">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;response&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5070422">//&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5070436">type</span>&nbsp;<span class="ident" id="5070441">ClientCodec</span>&nbsp;<span class="keyword" id="5070453">interface</span>&nbsp;<span class="op" id="5070463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5070466">//&nbsp;WriteRequest&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070539">WriteRequest</span><span class="op" id="5070551">(</span><span class="op" id="5070552">*</span><span class="ident" id="5070553">Request</span><span class="op" id="5070560">,</span>&nbsp;<span class="keyword" id="5070562">interface</span><span class="op" id="5070571">{</span><span class="op" id="5070572">}</span><span class="op" id="5070573">)</span>&nbsp;<span class="builtintype" id="5070575">error</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070582">ReadResponseHeader</span><span class="op" id="5070600">(</span><span class="op" id="5070601">*</span><span class="ident" id="5070602">Response</span><span class="op" id="5070610">)</span>&nbsp;<span class="builtintype" id="5070612">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070619">ReadResponseBody</span><span class="op" id="5070635">(</span><span class="keyword" id="5070636">interface</span><span class="op" id="5070645">{</span><span class="op" id="5070646">}</span><span class="op" id="5070647">)</span>&nbsp;<span class="builtintype" id="5070649">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070657">Close</span><span class="op" id="5070662">(</span><span class="op" id="5070663">)</span>&nbsp;<span class="builtintype" id="5070665">error</span><br>
<span class="lineno"></span><span class="op" id="5070671">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5070674">func</span>&nbsp;<span class="op" id="5070679">(</span><span class="ident" id="5070680">client</span>&nbsp;<span class="op" id="5070687">*</span><span class="ident" id="5070688">Client</span><span class="op" id="5070694">)</span>&nbsp;<span class="ident" id="5070696">send</span><span class="op" id="5070700">(</span><span class="ident" id="5070701">call</span>&nbsp;<span class="op" id="5070706">*</span><span class="ident" id="5070707">Call</span><span class="op" id="5070711">)</span>&nbsp;<span class="op" id="5070713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070716">client</span><span class="op" id="5070722">.</span><span class="ident" id="5070723">reqMutex</span><span class="op" id="5070731">.</span><span class="ident" id="5070732">Lock</span><span class="op" id="5070736">(</span><span class="op" id="5070737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070740">defer</span>&nbsp;<span class="ident" id="5070746">client</span><span class="op" id="5070752">.</span><span class="ident" id="5070753">reqMutex</span><span class="op" id="5070761">.</span><span class="ident" id="5070762">Unlock</span><span class="op" id="5070768">(</span><span class="op" id="5070769">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5070773">//&nbsp;Register&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070797">client</span><span class="op" id="5070803">.</span><span class="ident" id="5070804">mutex</span><span class="op" id="5070809">.</span><span class="ident" id="5070810">Lock</span><span class="op" id="5070814">(</span><span class="op" id="5070815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070818">if</span>&nbsp;<span class="ident" id="5070821">client</span><span class="op" id="5070827">.</span><span class="ident" id="5070828">shutdown</span>&nbsp;<span class="op" id="5070837">||</span>&nbsp;<span class="ident" id="5070840">client</span><span class="op" id="5070846">.</span><span class="ident" id="5070847">closing</span>&nbsp;<span class="op" id="5070855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070859">call</span><span class="op" id="5070863">.</span><span class="ident" id="5070864">Error</span>&nbsp;<span class="op" id="5070870">=</span>&nbsp;<span class="ident" id="5070872">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070886">client</span><span class="op" id="5070892">.</span><span class="ident" id="5070893">mutex</span><span class="op" id="5070898">.</span><span class="ident" id="5070899">Unlock</span><span class="op" id="5070905">(</span><span class="op" id="5070906">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070910">call</span><span class="op" id="5070914">.</span><span class="ident" id="5070915">done</span><span class="op" id="5070919">(</span><span class="op" id="5070920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070924">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070935">seq</span>&nbsp;<span class="op" id="5070939">:=</span>&nbsp;<span class="ident" id="5070942">client</span><span class="op" id="5070948">.</span><span class="ident" id="5070949">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070954">client</span><span class="op" id="5070960">.</span><span class="ident" id="5070961">seq</span><span class="op" id="5070964">++</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070968">client</span><span class="op" id="5070974">.</span><span class="ident" id="5070975">pending</span><span class="op" id="5070982">[</span><span class="ident" id="5070983">seq</span><span class="op" id="5070986">]</span>&nbsp;<span class="op" id="5070988">=</span>&nbsp;<span class="ident" id="5070990">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070996">client</span><span class="op" id="5071002">.</span><span class="ident" id="5071003">mutex</span><span class="op" id="5071008">.</span><span class="ident" id="5071009">Unlock</span><span class="op" id="5071015">(</span><span class="op" id="5071016">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5071020">//&nbsp;Encode&nbsp;and&nbsp;send&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071053">client</span><span class="op" id="5071059">.</span><span class="ident" id="5071060">request</span><span class="op" id="5071067">.</span><span class="ident" id="5071068">Seq</span>&nbsp;<span class="op" id="5071072">=</span>&nbsp;<span class="ident" id="5071074">seq</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071079">client</span><span class="op" id="5071085">.</span><span class="ident" id="5071086">request</span><span class="op" id="5071093">.</span><span class="ident" id="5071094">ServiceMethod</span>&nbsp;<span class="op" id="5071108">=</span>&nbsp;<span class="ident" id="5071110">call</span><span class="op" id="5071114">.</span><span class="ident" id="5071115">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071130">err</span>&nbsp;<span class="op" id="5071134">:=</span>&nbsp;<span class="ident" id="5071137">client</span><span class="op" id="5071143">.</span><span class="ident" id="5071144">codec</span><span class="op" id="5071149">.</span><span class="ident" id="5071150">WriteRequest</span><span class="op" id="5071162">(</span><span class="op" id="5071163">&amp;</span><span class="ident" id="5071164">client</span><span class="op" id="5071170">.</span><span class="ident" id="5071171">request</span><span class="op" id="5071178">,</span>&nbsp;<span class="ident" id="5071180">call</span><span class="op" id="5071184">.</span><span class="ident" id="5071185">Args</span><span class="op" id="5071189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5071192">if</span>&nbsp;<span class="ident" id="5071195">err</span>&nbsp;<span class="op" id="5071199">!=</span>&nbsp;<span class="ident" id="5071202">nil</span>&nbsp;<span class="op" id="5071206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071210">client</span><span class="op" id="5071216">.</span><span class="ident" id="5071217">mutex</span><span class="op" id="5071222">.</span><span class="ident" id="5071223">Lock</span><span class="op" id="5071227">(</span><span class="op" id="5071228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071232">call</span>&nbsp;<span class="op" id="5071237">=</span>&nbsp;<span class="ident" id="5071239">client</span><span class="op" id="5071245">.</span><span class="ident" id="5071246">pending</span><span class="op" id="5071253">[</span><span class="ident" id="5071254">seq</span><span class="op" id="5071257">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5071261">delete</span><span class="op" id="5071267">(</span><span class="ident" id="5071268">client</span><span class="op" id="5071274">.</span><span class="ident" id="5071275">pending</span><span class="op" id="5071282">,</span>&nbsp;<span class="ident" id="5071284">seq</span><span class="op" id="5071287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071291">client</span><span class="op" id="5071297">.</span><span class="ident" id="5071298">mutex</span><span class="op" id="5071303">.</span><span class="ident" id="5071304">Unlock</span><span class="op" id="5071310">(</span><span class="op" id="5071311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5071315">if</span>&nbsp;<span class="ident" id="5071318">call</span>&nbsp;<span class="op" id="5071323">!=</span>&nbsp;<span class="ident" id="5071326">nil</span>&nbsp;<span class="op" id="5071330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071335">call</span><span class="op" id="5071339">.</span><span class="ident" id="5071340">Error</span>&nbsp;<span class="op" id="5071346">=</span>&nbsp;<span class="ident" id="5071348">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071355">call</span><span class="op" id="5071359">.</span><span class="ident" id="5071360">done</span><span class="op" id="5071364">(</span><span class="op" id="5071365">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5071369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5071372">}</span><br>
<span class="lineno"></span><span class="op" id="5071374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5071377">func</span>&nbsp;<span class="op" id="5071382">(</span><span class="ident" id="5071383">client</span>&nbsp;<span class="op" id="5071390">*</span><span class="ident" id="5071391">Client</span><span class="op" id="5071397">)</span>&nbsp;<span class="ident" id="5071399">input</span><span class="op" id="5071404">(</span><span class="op" id="5071405">)</span>&nbsp;<span class="op" id="5071407">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5071410">var</span>&nbsp;<span class="ident" id="5071414">err</span>&nbsp;<span class="builtintype" id="5071418">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5071425">var</span>&nbsp;<span class="ident" id="5071429">response</span>&nbsp;<span class="ident" id="5071438">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5071448">for</span>&nbsp;<span class="ident" id="5071452">err</span>&nbsp;<span class="op" id="5071456">==</span>&nbsp;<span class="ident" id="5071459">nil</span>&nbsp;<span class="op" id="5071463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071467">response</span>&nbsp;<span class="op" id="5071476">=</span>&nbsp;<span class="ident" id="5071478">Response</span><span class="op" id="5071486">{</span><span class="op" id="5071487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071491">err</span>&nbsp;<span class="op" id="5071495">=</span>&nbsp;<span class="ident" id="5071497">client</span><span class="op" id="5071503">.</span><span class="ident" id="5071504">codec</span><span class="op" id="5071509">.</span><span class="ident" id="5071510">ReadResponseHeader</span><span class="op" id="5071528">(</span><span class="op" id="5071529">&amp;</span><span class="ident" id="5071530">response</span><span class="op" id="5071538">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5071542">if</span>&nbsp;<span class="ident" id="5071545">err</span>&nbsp;<span class="op" id="5071549">!=</span>&nbsp;<span class="ident" id="5071552">nil</span>&nbsp;<span class="op" id="5071556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5071561">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5071569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071573">seq</span>&nbsp;<span class="op" id="5071577">:=</span>&nbsp;<span class="ident" id="5071580">response</span><span class="op" id="5071588">.</span><span class="ident" id="5071589">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071595">client</span><span class="op" id="5071601">.</span><span class="ident" id="5071602">mutex</span><span class="op" id="5071607">.</span><span class="ident" id="5071608">Lock</span><span class="op" id="5071612">(</span><span class="op" id="5071613">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071617">call</span>&nbsp;<span class="op" id="5071622">:=</span>&nbsp;<span class="ident" id="5071625">client</span><span class="op" id="5071631">.</span><span class="ident" id="5071632">pending</span><span class="op" id="5071639">[</span><span class="ident" id="5071640">seq</span><span class="op" id="5071643">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5071647">delete</span><span class="op" id="5071653">(</span><span class="ident" id="5071654">client</span><span class="op" id="5071660">.</span><span class="ident" id="5071661">pending</span><span class="op" id="5071668">,</span>&nbsp;<span class="ident" id="5071670">seq</span><span class="op" id="5071673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5071677">client</span><span class="op" id="5071683">.</span><span class="ident" id="5071684">mutex</span><span class="op" id="5071689">.</span><span class="ident" id="5071690">Unlock</span><span class="op" id="5071696">(</span><span class="op" id="5071697">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5071702">switch</span>&nbsp;<span class="op" id="5071709">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5071713">case</span>&nbsp;<span class="ident" id="5071718">call</span>&nbsp;<span class="op" id="5071723">==</span>&nbsp;<span class="ident" id="5071726">nil</span><span class="op" id="5071729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5071734">//&nbsp;We&#39;ve&nbsp;got&nbsp;no&nbsp;pending&nbsp;call.&nbsp;That&nbsp;usually&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5071791">//&nbsp;WriteRequest&nbsp;partially&nbsp;failed,&nbsp;and&nbsp;call&nbsp;was&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5071849">//&nbsp;removed;&nbsp;response&nbsp;is&nbsp;a&nbsp;server&nbsp;telling&nbsp;us&nbsp;about&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5071905">//&nbsp;error&nbsp;reading&nbsp;request&nbsp;body.&nbsp;We&nbsp;should&nbsp;still&nbsp;attempt</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5071963">//&nbsp;to&nbsp;read&nbsp;error&nbsp;body,&nbsp;but&nbsp;there&#39;s&nbsp;no&nbsp;one&nbsp;to&nbsp;give&nbsp;it&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072023">err</span>&nbsp;<span class="op" id="5072027">=</span>&nbsp;<span class="ident" id="5072029">client</span><span class="op" id="5072035">.</span><span class="ident" id="5072036">codec</span><span class="op" id="5072041">.</span><span class="ident" id="5072042">ReadResponseBody</span><span class="op" id="5072058">(</span><span class="ident" id="5072059">nil</span><span class="op" id="5072062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072067">if</span>&nbsp;<span class="ident" id="5072070">err</span>&nbsp;<span class="op" id="5072074">!=</span>&nbsp;<span class="ident" id="5072077">nil</span>&nbsp;<span class="op" id="5072081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072087">err</span>&nbsp;<span class="op" id="5072091">=</span>&nbsp;<span class="ident" id="5072093">errors</span><span class="op" id="5072099">.</span><span class="ident" id="5072100">New</span><span class="op" id="5072103">(</span><span class="string" id="5072104">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5072127">+</span>&nbsp;<span class="ident" id="5072129">err</span><span class="op" id="5072132">.</span><span class="ident" id="5072133">Error</span><span class="op" id="5072138">(</span><span class="op" id="5072139">)</span><span class="op" id="5072140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072145">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072149">case</span>&nbsp;<span class="ident" id="5072154">response</span><span class="op" id="5072162">.</span><span class="ident" id="5072163">Error</span>&nbsp;<span class="op" id="5072169">!=</span>&nbsp;<span class="string" id="5072172">&#34;&#34;</span><span class="op" id="5072174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5072179">//&nbsp;We&#39;ve&nbsp;got&nbsp;an&nbsp;error&nbsp;response.&nbsp;Give&nbsp;this&nbsp;to&nbsp;the&nbsp;request;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5072240">//&nbsp;any&nbsp;subsequent&nbsp;requests&nbsp;will&nbsp;get&nbsp;the&nbsp;ReadResponseBody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5072300">//&nbsp;error&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072329">call</span><span class="op" id="5072333">.</span><span class="ident" id="5072334">Error</span>&nbsp;<span class="op" id="5072340">=</span>&nbsp;<span class="ident" id="5072342">ServerError</span><span class="op" id="5072353">(</span><span class="ident" id="5072354">response</span><span class="op" id="5072362">.</span><span class="ident" id="5072363">Error</span><span class="op" id="5072368">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072373">err</span>&nbsp;<span class="op" id="5072377">=</span>&nbsp;<span class="ident" id="5072379">client</span><span class="op" id="5072385">.</span><span class="ident" id="5072386">codec</span><span class="op" id="5072391">.</span><span class="ident" id="5072392">ReadResponseBody</span><span class="op" id="5072408">(</span><span class="ident" id="5072409">nil</span><span class="op" id="5072412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072417">if</span>&nbsp;<span class="ident" id="5072420">err</span>&nbsp;<span class="op" id="5072424">!=</span>&nbsp;<span class="ident" id="5072427">nil</span>&nbsp;<span class="op" id="5072431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072437">err</span>&nbsp;<span class="op" id="5072441">=</span>&nbsp;<span class="ident" id="5072443">errors</span><span class="op" id="5072449">.</span><span class="ident" id="5072450">New</span><span class="op" id="5072453">(</span><span class="string" id="5072454">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5072477">+</span>&nbsp;<span class="ident" id="5072479">err</span><span class="op" id="5072482">.</span><span class="ident" id="5072483">Error</span><span class="op" id="5072488">(</span><span class="op" id="5072489">)</span><span class="op" id="5072490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072500">call</span><span class="op" id="5072504">.</span><span class="ident" id="5072505">done</span><span class="op" id="5072509">(</span><span class="op" id="5072510">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072514">default</span><span class="op" id="5072521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072526">err</span>&nbsp;<span class="op" id="5072530">=</span>&nbsp;<span class="ident" id="5072532">client</span><span class="op" id="5072538">.</span><span class="ident" id="5072539">codec</span><span class="op" id="5072544">.</span><span class="ident" id="5072545">ReadResponseBody</span><span class="op" id="5072561">(</span><span class="ident" id="5072562">call</span><span class="op" id="5072566">.</span><span class="ident" id="5072567">Reply</span><span class="op" id="5072572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072577">if</span>&nbsp;<span class="ident" id="5072580">err</span>&nbsp;<span class="op" id="5072584">!=</span>&nbsp;<span class="ident" id="5072587">nil</span>&nbsp;<span class="op" id="5072591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072597">call</span><span class="op" id="5072601">.</span><span class="ident" id="5072602">Error</span>&nbsp;<span class="op" id="5072608">=</span>&nbsp;<span class="ident" id="5072610">errors</span><span class="op" id="5072616">.</span><span class="ident" id="5072617">New</span><span class="op" id="5072620">(</span><span class="string" id="5072621">&#34;reading&nbsp;body&nbsp;&#34;</span>&nbsp;<span class="op" id="5072637">+</span>&nbsp;<span class="ident" id="5072639">err</span><span class="op" id="5072642">.</span><span class="ident" id="5072643">Error</span><span class="op" id="5072648">(</span><span class="op" id="5072649">)</span><span class="op" id="5072650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072655">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072660">call</span><span class="op" id="5072664">.</span><span class="ident" id="5072665">done</span><span class="op" id="5072669">(</span><span class="op" id="5072670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5072680">//&nbsp;Terminate&nbsp;pending&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072709">client</span><span class="op" id="5072715">.</span><span class="ident" id="5072716">reqMutex</span><span class="op" id="5072724">.</span><span class="ident" id="5072725">Lock</span><span class="op" id="5072729">(</span><span class="op" id="5072730">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072733">client</span><span class="op" id="5072739">.</span><span class="ident" id="5072740">mutex</span><span class="op" id="5072745">.</span><span class="ident" id="5072746">Lock</span><span class="op" id="5072750">(</span><span class="op" id="5072751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072754">client</span><span class="op" id="5072760">.</span><span class="ident" id="5072761">shutdown</span>&nbsp;<span class="op" id="5072770">=</span>&nbsp;<span class="builtintype" id="5072772">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072778">closing</span>&nbsp;<span class="op" id="5072786">:=</span>&nbsp;<span class="ident" id="5072789">client</span><span class="op" id="5072795">.</span><span class="ident" id="5072796">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072805">if</span>&nbsp;<span class="ident" id="5072808">err</span>&nbsp;<span class="op" id="5072812">==</span>&nbsp;<span class="ident" id="5072815">io</span><span class="op" id="5072817">.</span><span class="ident" id="5072818">EOF</span>&nbsp;<span class="op" id="5072822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072826">if</span>&nbsp;<span class="ident" id="5072829">closing</span>&nbsp;<span class="op" id="5072837">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072842">err</span>&nbsp;<span class="op" id="5072846">=</span>&nbsp;<span class="ident" id="5072848">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072862">}</span>&nbsp;<span class="keyword" id="5072864">else</span>&nbsp;<span class="op" id="5072869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072874">err</span>&nbsp;<span class="op" id="5072878">=</span>&nbsp;<span class="ident" id="5072880">io</span><span class="op" id="5072882">.</span><span class="ident" id="5072883">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072905">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072908">for</span>&nbsp;<span class="ident" id="5072912">_</span><span class="op" id="5072913">,</span>&nbsp;<span class="ident" id="5072915">call</span>&nbsp;<span class="op" id="5072920">:=</span>&nbsp;<span class="keyword" id="5072923">range</span>&nbsp;<span class="ident" id="5072929">client</span><span class="op" id="5072935">.</span><span class="ident" id="5072936">pending</span>&nbsp;<span class="op" id="5072944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072948">call</span><span class="op" id="5072952">.</span><span class="ident" id="5072953">Error</span>&nbsp;<span class="op" id="5072959">=</span>&nbsp;<span class="ident" id="5072961">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072967">call</span><span class="op" id="5072971">.</span><span class="ident" id="5072972">done</span><span class="op" id="5072976">(</span><span class="op" id="5072977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072983">client</span><span class="op" id="5072989">.</span><span class="ident" id="5072990">mutex</span><span class="op" id="5072995">.</span><span class="ident" id="5072996">Unlock</span><span class="op" id="5073002">(</span><span class="op" id="5073003">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073006">client</span><span class="op" id="5073012">.</span><span class="ident" id="5073013">reqMutex</span><span class="op" id="5073021">.</span><span class="ident" id="5073022">Unlock</span><span class="op" id="5073028">(</span><span class="op" id="5073029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073032">if</span>&nbsp;<span class="ident" id="5073035">debugLog</span>&nbsp;<span class="op" id="5073044">&amp;&amp;</span>&nbsp;<span class="ident" id="5073047">err</span>&nbsp;<span class="op" id="5073051">!=</span>&nbsp;<span class="ident" id="5073054">io</span><span class="op" id="5073056">.</span><span class="ident" id="5073057">EOF</span>&nbsp;<span class="op" id="5073061">&amp;&amp;</span>&nbsp;<span class="op" id="5073064">!</span><span class="ident" id="5073065">closing</span>&nbsp;<span class="op" id="5073073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073077">log</span><span class="op" id="5073080">.</span><span class="ident" id="5073081">Println</span><span class="op" id="5073088">(</span><span class="string" id="5073089">&#34;rpc:&nbsp;client&nbsp;protocol&nbsp;error:&#34;</span><span class="op" id="5073118">,</span>&nbsp;<span class="ident" id="5073120">err</span><span class="op" id="5073123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073126">}</span><br>
<span class="lineno"></span><span class="op" id="5073128">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5073131">func</span>&nbsp;<span class="op" id="5073136">(</span><span class="ident" id="5073137">call</span>&nbsp;<span class="op" id="5073142">*</span><span class="ident" id="5073143">Call</span><span class="op" id="5073147">)</span>&nbsp;<span class="ident" id="5073149">done</span><span class="op" id="5073153">(</span><span class="op" id="5073154">)</span>&nbsp;<span class="op" id="5073156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073159">select</span>&nbsp;<span class="op" id="5073166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073169">case</span>&nbsp;<span class="ident" id="5073174">call</span><span class="op" id="5073178">.</span><span class="ident" id="5073179">Done</span>&nbsp;<span class="op" id="5073184">&lt;-</span>&nbsp;<span class="ident" id="5073187">call</span><span class="op" id="5073191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073195">//&nbsp;ok</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073202">default</span><span class="op" id="5073209">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073213">//&nbsp;We&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;block&nbsp;here.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073290">//&nbsp;sure&nbsp;the&nbsp;channel&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;space.&nbsp;See&nbsp;comment&nbsp;in&nbsp;Go().</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073358">if</span>&nbsp;<span class="ident" id="5073361">debugLog</span>&nbsp;<span class="op" id="5073370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073375">log</span><span class="op" id="5073378">.</span><span class="ident" id="5073379">Println</span><span class="op" id="5073386">(</span><span class="string" id="5073387">&#34;rpc:&nbsp;discarding&nbsp;Call&nbsp;reply&nbsp;due&nbsp;to&nbsp;insufficient&nbsp;Done&nbsp;chan&nbsp;capacity&#34;</span><span class="op" id="5073454">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073461">}</span><br>
<span class="lineno"></span><span class="op" id="5073463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5073466">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno">185</span><span class="comment" id="5073526">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5073581">//&nbsp;It&nbsp;adds&nbsp;a&nbsp;buffer&nbsp;to&nbsp;the&nbsp;write&nbsp;side&nbsp;of&nbsp;the&nbsp;connection&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5073640">//&nbsp;the&nbsp;header&nbsp;and&nbsp;payload&nbsp;are&nbsp;sent&nbsp;as&nbsp;a&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="5073686">func</span>&nbsp;<span class="ident" id="5073691">NewClient</span><span class="op" id="5073700">(</span><span class="ident" id="5073701">conn</span>&nbsp;<span class="ident" id="5073706">io</span><span class="op" id="5073708">.</span><span class="ident" id="5073709">ReadWriteCloser</span><span class="op" id="5073724">)</span>&nbsp;<span class="op" id="5073726">*</span><span class="ident" id="5073727">Client</span>&nbsp;<span class="op" id="5073734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073737">encBuf</span>&nbsp;<span class="op" id="5073744">:=</span>&nbsp;<span class="ident" id="5073747">bufio</span><span class="op" id="5073752">.</span><span class="ident" id="5073753">NewWriter</span><span class="op" id="5073762">(</span><span class="ident" id="5073763">conn</span><span class="op" id="5073767">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073770">client</span>&nbsp;<span class="op" id="5073777">:=</span>&nbsp;<span class="op" id="5073780">&amp;</span><span class="ident" id="5073781">gobClientCodec</span><span class="op" id="5073795">{</span><span class="ident" id="5073796">conn</span><span class="op" id="5073800">,</span>&nbsp;<span class="ident" id="5073802">gob</span><span class="op" id="5073805">.</span><span class="ident" id="5073806">NewDecoder</span><span class="op" id="5073816">(</span><span class="ident" id="5073817">conn</span><span class="op" id="5073821">)</span><span class="op" id="5073822">,</span>&nbsp;<span class="ident" id="5073824">gob</span><span class="op" id="5073827">.</span><span class="ident" id="5073828">NewEncoder</span><span class="op" id="5073838">(</span><span class="ident" id="5073839">encBuf</span><span class="op" id="5073845">)</span><span class="op" id="5073846">,</span>&nbsp;<span class="ident" id="5073848">encBuf</span><span class="op" id="5073854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073857">return</span>&nbsp;<span class="ident" id="5073864">NewClientWithCodec</span><span class="op" id="5073882">(</span><span class="ident" id="5073883">client</span><span class="op" id="5073889">)</span><br>
<span class="lineno"></span><span class="op" id="5073891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5073894">//&nbsp;NewClientWithCodec&nbsp;is&nbsp;like&nbsp;NewClient&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified</span><br>
<span class="lineno">195</span><span class="comment" id="5073957">//&nbsp;codec&nbsp;to&nbsp;encode&nbsp;requests&nbsp;and&nbsp;decode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="5074007">func</span>&nbsp;<span class="ident" id="5074012">NewClientWithCodec</span><span class="op" id="5074030">(</span><span class="ident" id="5074031">codec</span>&nbsp;<span class="ident" id="5074037">ClientCodec</span><span class="op" id="5074048">)</span>&nbsp;<span class="op" id="5074050">*</span><span class="ident" id="5074051">Client</span>&nbsp;<span class="op" id="5074058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074061">client</span>&nbsp;<span class="op" id="5074068">:=</span>&nbsp;<span class="op" id="5074071">&amp;</span><span class="ident" id="5074072">Client</span><span class="op" id="5074078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074082">codec</span><span class="op" id="5074087">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5074091">codec</span><span class="op" id="5074096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074100">pending</span><span class="op" id="5074107">:</span>&nbsp;<span class="builtinfunc" id="5074109">make</span><span class="op" id="5074113">(</span><span class="keyword" id="5074114">map</span><span class="op" id="5074117">[</span><span class="ident" id="5074118">uint64</span><span class="op" id="5074124">]</span><span class="op" id="5074125">*</span><span class="ident" id="5074126">Call</span><span class="op" id="5074130">)</span><span class="op" id="5074131">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074137">go</span>&nbsp;<span class="ident" id="5074140">client</span><span class="op" id="5074146">.</span><span class="ident" id="5074147">input</span><span class="op" id="5074152">(</span><span class="op" id="5074153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074156">return</span>&nbsp;<span class="ident" id="5074163">client</span><br>
<span class="lineno"></span><span class="op" id="5074170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="5074173">type</span>&nbsp;<span class="ident" id="5074178">gobClientCodec</span>&nbsp;<span class="keyword" id="5074193">struct</span>&nbsp;<span class="op" id="5074200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074203">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5074210">io</span><span class="op" id="5074212">.</span><span class="ident" id="5074213">ReadWriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074230">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5074237">*</span><span class="ident" id="5074238">gob</span><span class="op" id="5074241">.</span><span class="ident" id="5074242">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074251">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5074258">*</span><span class="ident" id="5074259">gob</span><span class="op" id="5074262">.</span><span class="ident" id="5074263">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074272">encBuf</span>&nbsp;<span class="op" id="5074279">*</span><span class="ident" id="5074280">bufio</span><span class="op" id="5074285">.</span><span class="ident" id="5074286">Writer</span><br>
<span class="lineno">210</span><span class="op" id="5074293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5074296">func</span>&nbsp;<span class="op" id="5074301">(</span><span class="ident" id="5074302">c</span>&nbsp;<span class="op" id="5074304">*</span><span class="ident" id="5074305">gobClientCodec</span><span class="op" id="5074319">)</span>&nbsp;<span class="ident" id="5074321">WriteRequest</span><span class="op" id="5074333">(</span><span class="ident" id="5074334">r</span>&nbsp;<span class="op" id="5074336">*</span><span class="ident" id="5074337">Request</span><span class="op" id="5074344">,</span>&nbsp;<span class="ident" id="5074346">body</span>&nbsp;<span class="keyword" id="5074351">interface</span><span class="op" id="5074360">{</span><span class="op" id="5074361">}</span><span class="op" id="5074362">)</span>&nbsp;<span class="op" id="5074364">(</span><span class="ident" id="5074365">err</span>&nbsp;<span class="builtintype" id="5074369">error</span><span class="op" id="5074374">)</span>&nbsp;<span class="op" id="5074376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074379">if</span>&nbsp;<span class="ident" id="5074382">err</span>&nbsp;<span class="op" id="5074386">=</span>&nbsp;<span class="ident" id="5074388">c</span><span class="op" id="5074389">.</span><span class="ident" id="5074390">enc</span><span class="op" id="5074393">.</span><span class="ident" id="5074394">Encode</span><span class="op" id="5074400">(</span><span class="ident" id="5074401">r</span><span class="op" id="5074402">)</span><span class="op" id="5074403">;</span>&nbsp;<span class="ident" id="5074405">err</span>&nbsp;<span class="op" id="5074409">!=</span>&nbsp;<span class="ident" id="5074412">nil</span>&nbsp;<span class="op" id="5074416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074420">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074431">if</span>&nbsp;<span class="ident" id="5074434">err</span>&nbsp;<span class="op" id="5074438">=</span>&nbsp;<span class="ident" id="5074440">c</span><span class="op" id="5074441">.</span><span class="ident" id="5074442">enc</span><span class="op" id="5074445">.</span><span class="ident" id="5074446">Encode</span><span class="op" id="5074452">(</span><span class="ident" id="5074453">body</span><span class="op" id="5074457">)</span><span class="op" id="5074458">;</span>&nbsp;<span class="ident" id="5074460">err</span>&nbsp;<span class="op" id="5074464">!=</span>&nbsp;<span class="ident" id="5074467">nil</span>&nbsp;<span class="op" id="5074471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074475">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074486">return</span>&nbsp;<span class="ident" id="5074493">c</span><span class="op" id="5074494">.</span><span class="ident" id="5074495">encBuf</span><span class="op" id="5074501">.</span><span class="ident" id="5074502">Flush</span><span class="op" id="5074507">(</span><span class="op" id="5074508">)</span><br>
<span class="lineno">220</span><span class="op" id="5074510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5074513">func</span>&nbsp;<span class="op" id="5074518">(</span><span class="ident" id="5074519">c</span>&nbsp;<span class="op" id="5074521">*</span><span class="ident" id="5074522">gobClientCodec</span><span class="op" id="5074536">)</span>&nbsp;<span class="ident" id="5074538">ReadResponseHeader</span><span class="op" id="5074556">(</span><span class="ident" id="5074557">r</span>&nbsp;<span class="op" id="5074559">*</span><span class="ident" id="5074560">Response</span><span class="op" id="5074568">)</span>&nbsp;<span class="builtintype" id="5074570">error</span>&nbsp;<span class="op" id="5074576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074579">return</span>&nbsp;<span class="ident" id="5074586">c</span><span class="op" id="5074587">.</span><span class="ident" id="5074588">dec</span><span class="op" id="5074591">.</span><span class="ident" id="5074592">Decode</span><span class="op" id="5074598">(</span><span class="ident" id="5074599">r</span><span class="op" id="5074600">)</span><br>
<span class="lineno"></span><span class="op" id="5074602">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="5074605">func</span>&nbsp;<span class="op" id="5074610">(</span><span class="ident" id="5074611">c</span>&nbsp;<span class="op" id="5074613">*</span><span class="ident" id="5074614">gobClientCodec</span><span class="op" id="5074628">)</span>&nbsp;<span class="ident" id="5074630">ReadResponseBody</span><span class="op" id="5074646">(</span><span class="ident" id="5074647">body</span>&nbsp;<span class="keyword" id="5074652">interface</span><span class="op" id="5074661">{</span><span class="op" id="5074662">}</span><span class="op" id="5074663">)</span>&nbsp;<span class="builtintype" id="5074665">error</span>&nbsp;<span class="op" id="5074671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074674">return</span>&nbsp;<span class="ident" id="5074681">c</span><span class="op" id="5074682">.</span><span class="ident" id="5074683">dec</span><span class="op" id="5074686">.</span><span class="ident" id="5074687">Decode</span><span class="op" id="5074693">(</span><span class="ident" id="5074694">body</span><span class="op" id="5074698">)</span><br>
<span class="lineno"></span><span class="op" id="5074700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5074703">func</span>&nbsp;<span class="op" id="5074708">(</span><span class="ident" id="5074709">c</span>&nbsp;<span class="op" id="5074711">*</span><span class="ident" id="5074712">gobClientCodec</span><span class="op" id="5074726">)</span>&nbsp;<span class="ident" id="5074728">Close</span><span class="op" id="5074733">(</span><span class="op" id="5074734">)</span>&nbsp;<span class="builtintype" id="5074736">error</span>&nbsp;<span class="op" id="5074742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074745">return</span>&nbsp;<span class="ident" id="5074752">c</span><span class="op" id="5074753">.</span><span class="ident" id="5074754">rwc</span><span class="op" id="5074757">.</span><span class="ident" id="5074758">Close</span><span class="op" id="5074763">(</span><span class="op" id="5074764">)</span><br>
<span class="lineno"></span><span class="op" id="5074766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5074769">//&nbsp;DialHTTP&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address</span><br>
<span class="lineno">235</span><span class="comment" id="5074845">//&nbsp;listening&nbsp;on&nbsp;the&nbsp;default&nbsp;HTTP&nbsp;RPC&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5074888">func</span>&nbsp;<span class="ident" id="5074893">DialHTTP</span><span class="op" id="5074901">(</span><span class="ident" id="5074902">network</span><span class="op" id="5074909">,</span>&nbsp;<span class="ident" id="5074911">address</span>&nbsp;<span class="builtintype" id="5074919">string</span><span class="op" id="5074925">)</span>&nbsp;<span class="op" id="5074927">(</span><span class="op" id="5074928">*</span><span class="ident" id="5074929">Client</span><span class="op" id="5074935">,</span>&nbsp;<span class="builtintype" id="5074937">error</span><span class="op" id="5074942">)</span>&nbsp;<span class="op" id="5074944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074947">return</span>&nbsp;<span class="ident" id="5074954">DialHTTPPath</span><span class="op" id="5074966">(</span><span class="ident" id="5074967">network</span><span class="op" id="5074974">,</span>&nbsp;<span class="ident" id="5074976">address</span><span class="op" id="5074983">,</span>&nbsp;<span class="ident" id="5074985">DefaultRPCPath</span><span class="op" id="5074999">)</span><br>
<span class="lineno"></span><span class="op" id="5075001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="5075004">//&nbsp;DialHTTPPath&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="5075051">//&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address&nbsp;and&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5075097">func</span>&nbsp;<span class="ident" id="5075102">DialHTTPPath</span><span class="op" id="5075114">(</span><span class="ident" id="5075115">network</span><span class="op" id="5075122">,</span>&nbsp;<span class="ident" id="5075124">address</span><span class="op" id="5075131">,</span>&nbsp;<span class="ident" id="5075133">path</span>&nbsp;<span class="builtintype" id="5075138">string</span><span class="op" id="5075144">)</span>&nbsp;<span class="op" id="5075146">(</span><span class="op" id="5075147">*</span><span class="ident" id="5075148">Client</span><span class="op" id="5075154">,</span>&nbsp;<span class="builtintype" id="5075156">error</span><span class="op" id="5075161">)</span>&nbsp;<span class="op" id="5075163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075166">var</span>&nbsp;<span class="ident" id="5075170">err</span>&nbsp;<span class="builtintype" id="5075174">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075181">conn</span><span class="op" id="5075185">,</span>&nbsp;<span class="ident" id="5075187">err</span>&nbsp;<span class="op" id="5075191">:=</span>&nbsp;<span class="ident" id="5075194">net</span><span class="op" id="5075197">.</span><span class="ident" id="5075198">Dial</span><span class="op" id="5075202">(</span><span class="ident" id="5075203">network</span><span class="op" id="5075210">,</span>&nbsp;<span class="ident" id="5075212">address</span><span class="op" id="5075219">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075222">if</span>&nbsp;<span class="ident" id="5075225">err</span>&nbsp;<span class="op" id="5075229">!=</span>&nbsp;<span class="ident" id="5075232">nil</span>&nbsp;<span class="op" id="5075236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075240">return</span>&nbsp;<span class="ident" id="5075247">nil</span><span class="op" id="5075250">,</span>&nbsp;<span class="ident" id="5075252">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075260">io</span><span class="op" id="5075262">.</span><span class="ident" id="5075263">WriteString</span><span class="op" id="5075274">(</span><span class="ident" id="5075275">conn</span><span class="op" id="5075279">,</span>&nbsp;<span class="string" id="5075281">&#34;CONNECT&nbsp;&#34;</span><span class="op" id="5075291">+</span><span class="ident" id="5075292">path</span><span class="op" id="5075296">+</span><span class="string" id="5075297">&#34;&nbsp;HTTP/1.0\n\n&#34;</span><span class="op" id="5075312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5075316">//&nbsp;Require&nbsp;successful&nbsp;HTTP&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5075353">//&nbsp;before&nbsp;switching&nbsp;to&nbsp;RPC&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075391">resp</span><span class="op" id="5075395">,</span>&nbsp;<span class="ident" id="5075397">err</span>&nbsp;<span class="op" id="5075401">:=</span>&nbsp;<span class="ident" id="5075404">http</span><span class="op" id="5075408">.</span><span class="ident" id="5075409">ReadResponse</span><span class="op" id="5075421">(</span><span class="ident" id="5075422">bufio</span><span class="op" id="5075427">.</span><span class="ident" id="5075428">NewReader</span><span class="op" id="5075437">(</span><span class="ident" id="5075438">conn</span><span class="op" id="5075442">)</span><span class="op" id="5075443">,</span>&nbsp;<span class="op" id="5075445">&amp;</span><span class="ident" id="5075446">http</span><span class="op" id="5075450">.</span><span class="ident" id="5075451">Request</span><span class="op" id="5075458">{</span><span class="ident" id="5075459">Method</span><span class="op" id="5075465">:</span>&nbsp;<span class="string" id="5075467">&#34;CONNECT&#34;</span><span class="op" id="5075476">}</span><span class="op" id="5075477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075480">if</span>&nbsp;<span class="ident" id="5075483">err</span>&nbsp;<span class="op" id="5075487">==</span>&nbsp;<span class="ident" id="5075490">nil</span>&nbsp;<span class="op" id="5075494">&amp;&amp;</span>&nbsp;<span class="ident" id="5075497">resp</span><span class="op" id="5075501">.</span><span class="ident" id="5075502">Status</span>&nbsp;<span class="op" id="5075509">==</span>&nbsp;<span class="ident" id="5075512">connected</span>&nbsp;<span class="op" id="5075522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075526">return</span>&nbsp;<span class="ident" id="5075533">NewClient</span><span class="op" id="5075542">(</span><span class="ident" id="5075543">conn</span><span class="op" id="5075547">)</span><span class="op" id="5075548">,</span>&nbsp;<span class="ident" id="5075550">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075558">if</span>&nbsp;<span class="ident" id="5075561">err</span>&nbsp;<span class="op" id="5075565">==</span>&nbsp;<span class="ident" id="5075568">nil</span>&nbsp;<span class="op" id="5075572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075576">err</span>&nbsp;<span class="op" id="5075580">=</span>&nbsp;<span class="ident" id="5075582">errors</span><span class="op" id="5075588">.</span><span class="ident" id="5075589">New</span><span class="op" id="5075592">(</span><span class="string" id="5075593">&#34;unexpected&nbsp;HTTP&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="5075622">+</span>&nbsp;<span class="ident" id="5075624">resp</span><span class="op" id="5075628">.</span><span class="ident" id="5075629">Status</span><span class="op" id="5075635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075641">conn</span><span class="op" id="5075645">.</span><span class="ident" id="5075646">Close</span><span class="op" id="5075651">(</span><span class="op" id="5075652">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075655">return</span>&nbsp;<span class="ident" id="5075662">nil</span><span class="op" id="5075665">,</span>&nbsp;<span class="op" id="5075667">&amp;</span><span class="ident" id="5075668">net</span><span class="op" id="5075671">.</span><span class="ident" id="5075672">OpError</span><span class="op" id="5075679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075683">Op</span><span class="op" id="5075685">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5075689">&#34;dial-http&#34;</span><span class="op" id="5075700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075704">Net</span><span class="op" id="5075707">:</span>&nbsp;&nbsp;<span class="ident" id="5075710">network</span>&nbsp;<span class="op" id="5075718">+</span>&nbsp;<span class="string" id="5075720">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5075724">+</span>&nbsp;<span class="ident" id="5075726">address</span><span class="op" id="5075733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075737">Addr</span><span class="op" id="5075741">:</span>&nbsp;<span class="ident" id="5075743">nil</span><span class="op" id="5075746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075750">Err</span><span class="op" id="5075753">:</span>&nbsp;&nbsp;<span class="ident" id="5075756">err</span><span class="op" id="5075759">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075762">}</span><br>
<span class="lineno"></span><span class="op" id="5075764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5075767">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;an&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5075835">func</span>&nbsp;<span class="ident" id="5075840">Dial</span><span class="op" id="5075844">(</span><span class="ident" id="5075845">network</span><span class="op" id="5075852">,</span>&nbsp;<span class="ident" id="5075854">address</span>&nbsp;<span class="builtintype" id="5075862">string</span><span class="op" id="5075868">)</span>&nbsp;<span class="op" id="5075870">(</span><span class="op" id="5075871">*</span><span class="ident" id="5075872">Client</span><span class="op" id="5075878">,</span>&nbsp;<span class="builtintype" id="5075880">error</span><span class="op" id="5075885">)</span>&nbsp;<span class="op" id="5075887">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075890">conn</span><span class="op" id="5075894">,</span>&nbsp;<span class="ident" id="5075896">err</span>&nbsp;<span class="op" id="5075900">:=</span>&nbsp;<span class="ident" id="5075903">net</span><span class="op" id="5075906">.</span><span class="ident" id="5075907">Dial</span><span class="op" id="5075911">(</span><span class="ident" id="5075912">network</span><span class="op" id="5075919">,</span>&nbsp;<span class="ident" id="5075921">address</span><span class="op" id="5075928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075931">if</span>&nbsp;<span class="ident" id="5075934">err</span>&nbsp;<span class="op" id="5075938">!=</span>&nbsp;<span class="ident" id="5075941">nil</span>&nbsp;<span class="op" id="5075945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075949">return</span>&nbsp;<span class="ident" id="5075956">nil</span><span class="op" id="5075959">,</span>&nbsp;<span class="ident" id="5075961">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075969">return</span>&nbsp;<span class="ident" id="5075976">NewClient</span><span class="op" id="5075985">(</span><span class="ident" id="5075986">conn</span><span class="op" id="5075990">)</span><span class="op" id="5075991">,</span>&nbsp;<span class="ident" id="5075993">nil</span><br>
<span class="lineno">275</span><span class="op" id="5075997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5076000">func</span>&nbsp;<span class="op" id="5076005">(</span><span class="ident" id="5076006">client</span>&nbsp;<span class="op" id="5076013">*</span><span class="ident" id="5076014">Client</span><span class="op" id="5076020">)</span>&nbsp;<span class="ident" id="5076022">Close</span><span class="op" id="5076027">(</span><span class="op" id="5076028">)</span>&nbsp;<span class="builtintype" id="5076030">error</span>&nbsp;<span class="op" id="5076036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076039">client</span><span class="op" id="5076045">.</span><span class="ident" id="5076046">mutex</span><span class="op" id="5076051">.</span><span class="ident" id="5076052">Lock</span><span class="op" id="5076056">(</span><span class="op" id="5076057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076060">if</span>&nbsp;<span class="ident" id="5076063">client</span><span class="op" id="5076069">.</span><span class="ident" id="5076070">closing</span>&nbsp;<span class="op" id="5076078">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076082">client</span><span class="op" id="5076088">.</span><span class="ident" id="5076089">mutex</span><span class="op" id="5076094">.</span><span class="ident" id="5076095">Unlock</span><span class="op" id="5076101">(</span><span class="op" id="5076102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076106">return</span>&nbsp;<span class="ident" id="5076113">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076129">client</span><span class="op" id="5076135">.</span><span class="ident" id="5076136">closing</span>&nbsp;<span class="op" id="5076144">=</span>&nbsp;<span class="builtintype" id="5076146">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076152">client</span><span class="op" id="5076158">.</span><span class="ident" id="5076159">mutex</span><span class="op" id="5076164">.</span><span class="ident" id="5076165">Unlock</span><span class="op" id="5076171">(</span><span class="op" id="5076172">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076175">return</span>&nbsp;<span class="ident" id="5076182">client</span><span class="op" id="5076188">.</span><span class="ident" id="5076189">codec</span><span class="op" id="5076194">.</span><span class="ident" id="5076195">Close</span><span class="op" id="5076200">(</span><span class="op" id="5076201">)</span><br>
<span class="lineno"></span><span class="op" id="5076203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5076206">//&nbsp;Go&nbsp;invokes&nbsp;the&nbsp;function&nbsp;asynchronously.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;Call&nbsp;structure&nbsp;representing</span><br>
<span class="lineno"></span><span class="comment" id="5076293">//&nbsp;the&nbsp;invocation.&nbsp;&nbsp;The&nbsp;done&nbsp;channel&nbsp;will&nbsp;signal&nbsp;when&nbsp;the&nbsp;call&nbsp;is&nbsp;complete&nbsp;by&nbsp;returning</span><br>
<span class="lineno">290</span><span class="comment" id="5076381">//&nbsp;the&nbsp;same&nbsp;Call&nbsp;object.&nbsp;&nbsp;If&nbsp;done&nbsp;is&nbsp;nil,&nbsp;Go&nbsp;will&nbsp;allocate&nbsp;a&nbsp;new&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="5076455">//&nbsp;If&nbsp;non-nil,&nbsp;done&nbsp;must&nbsp;be&nbsp;buffered&nbsp;or&nbsp;Go&nbsp;will&nbsp;deliberately&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="5076523">func</span>&nbsp;<span class="op" id="5076528">(</span><span class="ident" id="5076529">client</span>&nbsp;<span class="op" id="5076536">*</span><span class="ident" id="5076537">Client</span><span class="op" id="5076543">)</span>&nbsp;<span class="ident" id="5076545">Go</span><span class="op" id="5076547">(</span><span class="ident" id="5076548">serviceMethod</span>&nbsp;<span class="builtintype" id="5076562">string</span><span class="op" id="5076568">,</span>&nbsp;<span class="ident" id="5076570">args</span>&nbsp;<span class="keyword" id="5076575">interface</span><span class="op" id="5076584">{</span><span class="op" id="5076585">}</span><span class="op" id="5076586">,</span>&nbsp;<span class="ident" id="5076588">reply</span>&nbsp;<span class="keyword" id="5076594">interface</span><span class="op" id="5076603">{</span><span class="op" id="5076604">}</span><span class="op" id="5076605">,</span>&nbsp;<span class="ident" id="5076607">done</span>&nbsp;<span class="keyword" id="5076612">chan</span>&nbsp;<span class="op" id="5076617">*</span><span class="ident" id="5076618">Call</span><span class="op" id="5076622">)</span>&nbsp;<span class="op" id="5076624">*</span><span class="ident" id="5076625">Call</span>&nbsp;<span class="op" id="5076630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076633">call</span>&nbsp;<span class="op" id="5076638">:=</span>&nbsp;<span class="builtinfunc" id="5076641">new</span><span class="op" id="5076644">(</span><span class="ident" id="5076645">Call</span><span class="op" id="5076649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076652">call</span><span class="op" id="5076656">.</span><span class="ident" id="5076657">ServiceMethod</span>&nbsp;<span class="op" id="5076671">=</span>&nbsp;<span class="ident" id="5076673">serviceMethod</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076688">call</span><span class="op" id="5076692">.</span><span class="ident" id="5076693">Args</span>&nbsp;<span class="op" id="5076698">=</span>&nbsp;<span class="ident" id="5076700">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076706">call</span><span class="op" id="5076710">.</span><span class="ident" id="5076711">Reply</span>&nbsp;<span class="op" id="5076717">=</span>&nbsp;<span class="ident" id="5076719">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076726">if</span>&nbsp;<span class="ident" id="5076729">done</span>&nbsp;<span class="op" id="5076734">==</span>&nbsp;<span class="ident" id="5076737">nil</span>&nbsp;<span class="op" id="5076741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076745">done</span>&nbsp;<span class="op" id="5076750">=</span>&nbsp;<span class="builtinfunc" id="5076752">make</span><span class="op" id="5076756">(</span><span class="keyword" id="5076757">chan</span>&nbsp;<span class="op" id="5076762">*</span><span class="ident" id="5076763">Call</span><span class="op" id="5076767">,</span>&nbsp;<span class="num" id="5076769">10</span><span class="op" id="5076771">)</span>&nbsp;<span class="comment" id="5076773">//&nbsp;buffered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076787">}</span>&nbsp;<span class="keyword" id="5076789">else</span>&nbsp;<span class="op" id="5076794">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5076798">//&nbsp;If&nbsp;caller&nbsp;passes&nbsp;done&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;must&nbsp;arrange&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5076854">//&nbsp;done&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;for&nbsp;the&nbsp;number&nbsp;of&nbsp;simultaneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5076913">//&nbsp;RPCs&nbsp;that&nbsp;will&nbsp;be&nbsp;using&nbsp;that&nbsp;channel.&nbsp;&nbsp;If&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5076972">//&nbsp;is&nbsp;totally&nbsp;unbuffered,&nbsp;it&#39;s&nbsp;best&nbsp;not&nbsp;to&nbsp;run&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077029">if</span>&nbsp;<span class="builtinfunc" id="5077032">cap</span><span class="op" id="5077035">(</span><span class="ident" id="5077036">done</span><span class="op" id="5077040">)</span>&nbsp;<span class="op" id="5077042">==</span>&nbsp;<span class="num" id="5077045">0</span>&nbsp;<span class="op" id="5077047">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077052">log</span><span class="op" id="5077055">.</span><span class="ident" id="5077056">Panic</span><span class="op" id="5077061">(</span><span class="string" id="5077062">&#34;rpc:&nbsp;done&nbsp;channel&nbsp;is&nbsp;unbuffered&#34;</span><span class="op" id="5077095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5077099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5077102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077105">call</span><span class="op" id="5077109">.</span><span class="ident" id="5077110">Done</span>&nbsp;<span class="op" id="5077115">=</span>&nbsp;<span class="ident" id="5077117">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077123">client</span><span class="op" id="5077129">.</span><span class="ident" id="5077130">send</span><span class="op" id="5077134">(</span><span class="ident" id="5077135">call</span><span class="op" id="5077139">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077142">return</span>&nbsp;<span class="ident" id="5077149">call</span><br>
<span class="lineno"></span><span class="op" id="5077154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5077157">//&nbsp;Call&nbsp;invokes&nbsp;the&nbsp;named&nbsp;function,&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;complete,&nbsp;and&nbsp;returns&nbsp;its&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span><span class="keyword" id="5077249">func</span>&nbsp;<span class="op" id="5077254">(</span><span class="ident" id="5077255">client</span>&nbsp;<span class="op" id="5077262">*</span><span class="ident" id="5077263">Client</span><span class="op" id="5077269">)</span>&nbsp;<span class="ident" id="5077271">Call</span><span class="op" id="5077275">(</span><span class="ident" id="5077276">serviceMethod</span>&nbsp;<span class="builtintype" id="5077290">string</span><span class="op" id="5077296">,</span>&nbsp;<span class="ident" id="5077298">args</span>&nbsp;<span class="keyword" id="5077303">interface</span><span class="op" id="5077312">{</span><span class="op" id="5077313">}</span><span class="op" id="5077314">,</span>&nbsp;<span class="ident" id="5077316">reply</span>&nbsp;<span class="keyword" id="5077322">interface</span><span class="op" id="5077331">{</span><span class="op" id="5077332">}</span><span class="op" id="5077333">)</span>&nbsp;<span class="builtintype" id="5077335">error</span>&nbsp;<span class="op" id="5077341">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077344">call</span>&nbsp;<span class="op" id="5077349">:=</span>&nbsp;<span class="op" id="5077352">&lt;-</span><span class="ident" id="5077354">client</span><span class="op" id="5077360">.</span><span class="ident" id="5077361">Go</span><span class="op" id="5077363">(</span><span class="ident" id="5077364">serviceMethod</span><span class="op" id="5077377">,</span>&nbsp;<span class="ident" id="5077379">args</span><span class="op" id="5077383">,</span>&nbsp;<span class="ident" id="5077385">reply</span><span class="op" id="5077390">,</span>&nbsp;<span class="builtinfunc" id="5077392">make</span><span class="op" id="5077396">(</span><span class="keyword" id="5077397">chan</span>&nbsp;<span class="op" id="5077402">*</span><span class="ident" id="5077403">Call</span><span class="op" id="5077407">,</span>&nbsp;<span class="num" id="5077409">1</span><span class="op" id="5077410">)</span><span class="op" id="5077411">)</span><span class="op" id="5077412">.</span><span class="ident" id="5077413">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077419">return</span>&nbsp;<span class="ident" id="5077426">call</span><span class="op" id="5077430">.</span><span class="ident" id="5077431">Error</span><br>
<span class="lineno"></span><span class="op" id="5077437">}</span>
</div>
</body>
</html>
