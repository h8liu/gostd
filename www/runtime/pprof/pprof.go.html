<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4821193">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4821249">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4821303">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4821354">//&nbsp;Package&nbsp;pprof&nbsp;writes&nbsp;runtime&nbsp;profiling&nbsp;data&nbsp;in&nbsp;the&nbsp;format&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="4821424">//&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="4821460">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="4821501">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="keyword" id="4821548">package</span>&nbsp;<span class="ident" id="4821556">pprof</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4821563">import</span>&nbsp;<span class="op" id="4821570">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4821573">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4821582">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4821591">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4821598">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4821604">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4821615">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4821623">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4821634">&#34;sync&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4821642">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span><span class="op" id="4821659">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4821662">//&nbsp;BUG(rsc):&nbsp;Profiles&nbsp;are&nbsp;incomplete&nbsp;and&nbsp;inaccurate&nbsp;on&nbsp;NetBSD&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span><span class="comment" id="4821734">//&nbsp;See&nbsp;http://golang.org/issue/6047&nbsp;for&nbsp;details.</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4821784">//&nbsp;A&nbsp;Profile&nbsp;is&nbsp;a&nbsp;collection&nbsp;of&nbsp;stack&nbsp;traces&nbsp;showing&nbsp;the&nbsp;call&nbsp;sequences</span><br>
<span class="lineno"></span><span class="comment" id="4821856">//&nbsp;that&nbsp;led&nbsp;to&nbsp;instances&nbsp;of&nbsp;a&nbsp;particular&nbsp;event,&nbsp;such&nbsp;as&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="4821924">//&nbsp;Packages&nbsp;can&nbsp;create&nbsp;and&nbsp;maintain&nbsp;their&nbsp;own&nbsp;profiles;&nbsp;the&nbsp;most&nbsp;common</span><br>
<span class="lineno"></span><span class="comment" id="4821996">//&nbsp;use&nbsp;is&nbsp;for&nbsp;tracking&nbsp;resources&nbsp;that&nbsp;must&nbsp;be&nbsp;explicitly&nbsp;closed,&nbsp;such&nbsp;as&nbsp;files</span><br>
<span class="lineno">30</span><span class="comment" id="4822075">//&nbsp;or&nbsp;network&nbsp;connections.</span><br>
<span class="lineno"></span><span class="comment" id="4822102">//</span><br>
<span class="lineno"></span><span class="comment" id="4822105">//&nbsp;A&nbsp;Profile&#39;s&nbsp;methods&nbsp;can&nbsp;be&nbsp;called&nbsp;from&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="comment" id="4822183">//</span><br>
<span class="lineno"></span><span class="comment" id="4822186">//&nbsp;Each&nbsp;Profile&nbsp;has&nbsp;a&nbsp;unique&nbsp;name.&nbsp;&nbsp;A&nbsp;few&nbsp;profiles&nbsp;are&nbsp;predefined:</span><br>
<span class="lineno">35</span><span class="comment" id="4822253">//</span><br>
<span class="lineno"></span><span class="comment" id="4822256">//&nbsp;&nbsp;&nbsp;&nbspgoroutine&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;stack&nbsp;traces&nbsp;of&nbsp;all&nbsp;current&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="4822313">//&nbsp;&nbsp;&nbsp;&nbspheap&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;sampling&nbsp;of&nbsp;all&nbsp;heap&nbsp;allocations</span><br>
<span class="lineno"></span><span class="comment" id="4822366">//&nbsp;&nbsp;&nbsp;&nbspthreadcreate&nbsp;-&nbsp;stack&nbsp;traces&nbsp;that&nbsp;led&nbsp;to&nbsp;the&nbsp;creation&nbsp;of&nbsp;new&nbsp;OS&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="4822440">//&nbsp;&nbsp;&nbsp;&nbspblock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;stack&nbsp;traces&nbsp;that&nbsp;led&nbsp;to&nbsp;blocking&nbsp;on&nbsp;synchronization&nbsp;primitives</span><br>
<span class="lineno">40</span><span class="comment" id="4822522">//</span><br>
<span class="lineno"></span><span class="comment" id="4822525">//&nbsp;These&nbsp;predefined&nbsp;profiles&nbsp;maintain&nbsp;themselves&nbsp;and&nbsp;panic&nbsp;on&nbsp;an&nbsp;explicit</span><br>
<span class="lineno"></span><span class="comment" id="4822599">//&nbsp;Add&nbsp;or&nbsp;Remove&nbsp;method&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="4822629">//</span><br>
<span class="lineno"></span><span class="comment" id="4822632">//&nbsp;The&nbsp;CPU&nbsp;profile&nbsp;is&nbsp;not&nbsp;available&nbsp;as&nbsp;a&nbsp;Profile.&nbsp;&nbsp;It&nbsp;has&nbsp;a&nbsp;special&nbsp;API,</span><br>
<span class="lineno">45</span><span class="comment" id="4822705">//&nbsp;the&nbsp;StartCPUProfile&nbsp;and&nbsp;StopCPUProfile&nbsp;functions,&nbsp;because&nbsp;it&nbsp;streams</span><br>
<span class="lineno"></span><span class="comment" id="4822777">//&nbsp;output&nbsp;to&nbsp;a&nbsp;writer&nbsp;during&nbsp;profiling.</span><br>
<span class="lineno"></span><span class="comment" id="4822817">//</span><br>
<span class="lineno"></span><span class="keyword" id="4822820">type</span>&nbsp;<span class="ident" id="4822825">Profile</span>&nbsp;<span class="keyword" id="4822833">struct</span>&nbsp;<span class="op" id="4822840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822843">name</span>&nbsp;&nbsp;<span class="builtintype" id="4822849">string</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822857">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822863">sync</span><span class="op" id="4822867">.</span><span class="ident" id="4822868">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822875">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822881">map</span><span class="op" id="4822884">[</span><span class="keyword" id="4822885">interface</span><span class="op" id="4822894">{</span><span class="op" id="4822895">}</span><span class="op" id="4822896">]</span><span class="op" id="4822897">[</span><span class="op" id="4822898">]</span><span class="builtintype" id="4822899">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822908">count</span>&nbsp;<span class="keyword" id="4822914">func</span><span class="op" id="4822918">(</span><span class="op" id="4822919">)</span>&nbsp;<span class="builtintype" id="4822921">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822926">write</span>&nbsp;<span class="keyword" id="4822932">func</span><span class="op" id="4822936">(</span><span class="ident" id="4822937">io</span><span class="op" id="4822939">.</span><span class="ident" id="4822940">Writer</span><span class="op" id="4822946">,</span>&nbsp;<span class="builtintype" id="4822948">int</span><span class="op" id="4822951">)</span>&nbsp;<span class="builtintype" id="4822953">error</span><br>
<span class="lineno"></span><span class="op" id="4822959">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4822962">//&nbsp;profiles&nbsp;records&nbsp;all&nbsp;registered&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="4823007">var</span>&nbsp;<span class="ident" id="4823011">profiles</span>&nbsp;<span class="keyword" id="4823020">struct</span>&nbsp;<span class="op" id="4823027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823030">mu</span>&nbsp;<span class="ident" id="4823033">sync</span><span class="op" id="4823037">.</span><span class="ident" id="4823038">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823045">m</span>&nbsp;&nbsp;<span class="keyword" id="4823048">map</span><span class="op" id="4823051">[</span><span class="builtintype" id="4823052">string</span><span class="op" id="4823058">]</span><span class="op" id="4823059">*</span><span class="ident" id="4823060">Profile</span><br>
<span class="lineno">60</span><span class="op" id="4823068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4823071">var</span>&nbsp;<span class="ident" id="4823075">goroutineProfile</span>&nbsp;<span class="op" id="4823092">=</span>&nbsp;<span class="op" id="4823094">&amp;</span><span class="ident" id="4823095">Profile</span><span class="op" id="4823102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823105">name</span><span class="op" id="4823109">:</span>&nbsp;&nbsp;<span class="string" id="4823112">&#34;goroutine&#34;</span><span class="op" id="4823123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823126">count</span><span class="op" id="4823131">:</span>&nbsp;<span class="ident" id="4823133">countGoroutine</span><span class="op" id="4823147">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823150">write</span><span class="op" id="4823155">:</span>&nbsp;<span class="ident" id="4823157">writeGoroutine</span><span class="op" id="4823171">,</span><br>
<span class="lineno"></span><span class="op" id="4823173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4823176">var</span>&nbsp;<span class="ident" id="4823180">threadcreateProfile</span>&nbsp;<span class="op" id="4823200">=</span>&nbsp;<span class="op" id="4823202">&amp;</span><span class="ident" id="4823203">Profile</span><span class="op" id="4823210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823213">name</span><span class="op" id="4823217">:</span>&nbsp;&nbsp;<span class="string" id="4823220">&#34;threadcreate&#34;</span><span class="op" id="4823234">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823237">count</span><span class="op" id="4823242">:</span>&nbsp;<span class="ident" id="4823244">countThreadCreate</span><span class="op" id="4823261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823264">write</span><span class="op" id="4823269">:</span>&nbsp;<span class="ident" id="4823271">writeThreadCreate</span><span class="op" id="4823288">,</span><br>
<span class="lineno"></span><span class="op" id="4823290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4823293">var</span>&nbsp;<span class="ident" id="4823297">heapProfile</span>&nbsp;<span class="op" id="4823309">=</span>&nbsp;<span class="op" id="4823311">&amp;</span><span class="ident" id="4823312">Profile</span><span class="op" id="4823319">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823322">name</span><span class="op" id="4823326">:</span>&nbsp;&nbsp;<span class="string" id="4823329">&#34;heap&#34;</span><span class="op" id="4823335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823338">count</span><span class="op" id="4823343">:</span>&nbsp;<span class="ident" id="4823345">countHeap</span><span class="op" id="4823354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823357">write</span><span class="op" id="4823362">:</span>&nbsp;<span class="ident" id="4823364">writeHeap</span><span class="op" id="4823373">,</span><br>
<span class="lineno"></span><span class="op" id="4823375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4823378">var</span>&nbsp;<span class="ident" id="4823382">blockProfile</span>&nbsp;<span class="op" id="4823395">=</span>&nbsp;<span class="op" id="4823397">&amp;</span><span class="ident" id="4823398">Profile</span><span class="op" id="4823405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823408">name</span><span class="op" id="4823412">:</span>&nbsp;&nbsp;<span class="string" id="4823415">&#34;block&#34;</span><span class="op" id="4823422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823425">count</span><span class="op" id="4823430">:</span>&nbsp;<span class="ident" id="4823432">countBlock</span><span class="op" id="4823442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823445">write</span><span class="op" id="4823450">:</span>&nbsp;<span class="ident" id="4823452">writeBlock</span><span class="op" id="4823462">,</span><br>
<span class="lineno"></span><span class="op" id="4823464">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="4823467">func</span>&nbsp;<span class="ident" id="4823472">lockProfiles</span><span class="op" id="4823484">(</span><span class="op" id="4823485">)</span>&nbsp;<span class="op" id="4823487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823490">profiles</span><span class="op" id="4823498">.</span><span class="ident" id="4823499">mu</span><span class="op" id="4823501">.</span><span class="ident" id="4823502">Lock</span><span class="op" id="4823506">(</span><span class="op" id="4823507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823510">if</span>&nbsp;<span class="ident" id="4823513">profiles</span><span class="op" id="4823521">.</span><span class="ident" id="4823522">m</span>&nbsp;<span class="op" id="4823524">==</span>&nbsp;<span class="ident" id="4823527">nil</span>&nbsp;<span class="op" id="4823531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4823535">//&nbsp;Initial&nbsp;built-in&nbsp;profiles.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823567">profiles</span><span class="op" id="4823575">.</span><span class="ident" id="4823576">m</span>&nbsp;<span class="op" id="4823578">=</span>&nbsp;<span class="keyword" id="4823580">map</span><span class="op" id="4823583">[</span><span class="builtintype" id="4823584">string</span><span class="op" id="4823590">]</span><span class="op" id="4823591">*</span><span class="ident" id="4823592">Profile</span><span class="op" id="4823599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823604">&#34;goroutine&#34;</span><span class="op" id="4823615">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823620">goroutineProfile</span><span class="op" id="4823636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823641">&#34;threadcreate&#34;</span><span class="op" id="4823655">:</span>&nbsp;<span class="ident" id="4823657">threadcreateProfile</span><span class="op" id="4823676">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823681">&#34;heap&#34;</span><span class="op" id="4823687">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823697">heapProfile</span><span class="op" id="4823708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823713">&#34;block&#34;</span><span class="op" id="4823720">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823729">blockProfile</span><span class="op" id="4823741">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823748">}</span><br>
<span class="lineno"></span><span class="op" id="4823750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4823753">func</span>&nbsp;<span class="ident" id="4823758">unlockProfiles</span><span class="op" id="4823772">(</span><span class="op" id="4823773">)</span>&nbsp;<span class="op" id="4823775">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823778">profiles</span><span class="op" id="4823786">.</span><span class="ident" id="4823787">mu</span><span class="op" id="4823789">.</span><span class="ident" id="4823790">Unlock</span><span class="op" id="4823796">(</span><span class="op" id="4823797">)</span><br>
<span class="lineno"></span><span class="op" id="4823799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4823802">//&nbsp;NewProfile&nbsp;creates&nbsp;a&nbsp;new&nbsp;profile&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="4823859">//&nbsp;If&nbsp;a&nbsp;profile&nbsp;with&nbsp;that&nbsp;name&nbsp;already&nbsp;exists,&nbsp;NewProfile&nbsp;panics.</span><br>
<span class="lineno">105</span><span class="comment" id="4823925">//&nbsp;The&nbsp;convention&nbsp;is&nbsp;to&nbsp;use&nbsp;a&nbsp;&#39;import/path.&#39;&nbsp;prefix&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="4823987">//&nbsp;separate&nbsp;name&nbsp;spaces&nbsp;for&nbsp;each&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4824029">func</span>&nbsp;<span class="ident" id="4824034">NewProfile</span><span class="op" id="4824044">(</span><span class="ident" id="4824045">name</span>&nbsp;<span class="builtintype" id="4824050">string</span><span class="op" id="4824056">)</span>&nbsp;<span class="op" id="4824058">*</span><span class="ident" id="4824059">Profile</span>&nbsp;<span class="op" id="4824067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824070">lockProfiles</span><span class="op" id="4824082">(</span><span class="op" id="4824083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824086">defer</span>&nbsp;<span class="ident" id="4824092">unlockProfiles</span><span class="op" id="4824106">(</span><span class="op" id="4824107">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824110">if</span>&nbsp;<span class="ident" id="4824113">name</span>&nbsp;<span class="op" id="4824118">==</span>&nbsp;<span class="string" id="4824121">&#34;&#34;</span>&nbsp;<span class="op" id="4824124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4824128">panic</span><span class="op" id="4824133">(</span><span class="string" id="4824134">&#34;pprof:&nbsp;NewProfile&nbsp;with&nbsp;empty&nbsp;name&#34;</span><span class="op" id="4824169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4824172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824175">if</span>&nbsp;<span class="ident" id="4824178">profiles</span><span class="op" id="4824186">.</span><span class="ident" id="4824187">m</span><span class="op" id="4824188">[</span><span class="ident" id="4824189">name</span><span class="op" id="4824193">]</span>&nbsp;<span class="op" id="4824195">!=</span>&nbsp;<span class="ident" id="4824198">nil</span>&nbsp;<span class="op" id="4824202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4824206">panic</span><span class="op" id="4824211">(</span><span class="string" id="4824212">&#34;pprof:&nbsp;NewProfile&nbsp;name&nbsp;already&nbsp;in&nbsp;use:&nbsp;&#34;</span>&nbsp;<span class="op" id="4824254">+</span>&nbsp;<span class="ident" id="4824256">name</span><span class="op" id="4824260">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4824263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824266">p</span>&nbsp;<span class="op" id="4824268">:=</span>&nbsp;<span class="op" id="4824271">&amp;</span><span class="ident" id="4824272">Profile</span><span class="op" id="4824279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824283">name</span><span class="op" id="4824287">:</span>&nbsp;<span class="ident" id="4824289">name</span><span class="op" id="4824293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824297">m</span><span class="op" id="4824298">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824303">map</span><span class="op" id="4824306">[</span><span class="keyword" id="4824307">interface</span><span class="op" id="4824316">{</span><span class="op" id="4824317">}</span><span class="op" id="4824318">]</span><span class="op" id="4824319">[</span><span class="op" id="4824320">]</span><span class="builtintype" id="4824321">uintptr</span><span class="op" id="4824328">{</span><span class="op" id="4824329">}</span><span class="op" id="4824330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4824333">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824336">profiles</span><span class="op" id="4824344">.</span><span class="ident" id="4824345">m</span><span class="op" id="4824346">[</span><span class="ident" id="4824347">name</span><span class="op" id="4824351">]</span>&nbsp;<span class="op" id="4824353">=</span>&nbsp;<span class="ident" id="4824355">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824358">return</span>&nbsp;<span class="ident" id="4824365">p</span><br>
<span class="lineno"></span><span class="op" id="4824367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4824370">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;profile&nbsp;with&nbsp;the&nbsp;given&nbsp;name,&nbsp;or&nbsp;nil&nbsp;if&nbsp;no&nbsp;such&nbsp;profile&nbsp;exists.</span><br>
<span class="lineno">125</span><span class="keyword" id="4824455">func</span>&nbsp;<span class="ident" id="4824460">Lookup</span><span class="op" id="4824466">(</span><span class="ident" id="4824467">name</span>&nbsp;<span class="builtintype" id="4824472">string</span><span class="op" id="4824478">)</span>&nbsp;<span class="op" id="4824480">*</span><span class="ident" id="4824481">Profile</span>&nbsp;<span class="op" id="4824489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824492">lockProfiles</span><span class="op" id="4824504">(</span><span class="op" id="4824505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824508">defer</span>&nbsp;<span class="ident" id="4824514">unlockProfiles</span><span class="op" id="4824528">(</span><span class="op" id="4824529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824532">return</span>&nbsp;<span class="ident" id="4824539">profiles</span><span class="op" id="4824547">.</span><span class="ident" id="4824548">m</span><span class="op" id="4824549">[</span><span class="ident" id="4824550">name</span><span class="op" id="4824554">]</span><br>
<span class="lineno"></span><span class="op" id="4824556">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4824559">//&nbsp;Profiles&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;the&nbsp;known&nbsp;profiles,&nbsp;sorted&nbsp;by&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4824630">func</span>&nbsp;<span class="ident" id="4824635">Profiles</span><span class="op" id="4824643">(</span><span class="op" id="4824644">)</span>&nbsp;<span class="op" id="4824646">[</span><span class="op" id="4824647">]</span><span class="op" id="4824648">*</span><span class="ident" id="4824649">Profile</span>&nbsp;<span class="op" id="4824657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824660">lockProfiles</span><span class="op" id="4824672">(</span><span class="op" id="4824673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824676">defer</span>&nbsp;<span class="ident" id="4824682">unlockProfiles</span><span class="op" id="4824696">(</span><span class="op" id="4824697">)</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824701">var</span>&nbsp;<span class="ident" id="4824705">all</span>&nbsp;<span class="op" id="4824709">[</span><span class="op" id="4824710">]</span><span class="op" id="4824711">*</span><span class="ident" id="4824712">Profile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824721">for</span>&nbsp;<span class="ident" id="4824725">_</span><span class="op" id="4824726">,</span>&nbsp;<span class="ident" id="4824728">p</span>&nbsp;<span class="op" id="4824730">:=</span>&nbsp;<span class="keyword" id="4824733">range</span>&nbsp;<span class="ident" id="4824739">profiles</span><span class="op" id="4824747">.</span><span class="ident" id="4824748">m</span>&nbsp;<span class="op" id="4824750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824754">all</span>&nbsp;<span class="op" id="4824758">=</span>&nbsp;<span class="builtinfunc" id="4824760">append</span><span class="op" id="4824766">(</span><span class="ident" id="4824767">all</span><span class="op" id="4824770">,</span>&nbsp;<span class="ident" id="4824772">p</span><span class="op" id="4824773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4824776">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824780">sort</span><span class="op" id="4824784">.</span><span class="ident" id="4824785">Sort</span><span class="op" id="4824789">(</span><span class="ident" id="4824790">byName</span><span class="op" id="4824796">(</span><span class="ident" id="4824797">all</span><span class="op" id="4824800">)</span><span class="op" id="4824801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824804">return</span>&nbsp;<span class="ident" id="4824811">all</span><br>
<span class="lineno"></span><span class="op" id="4824815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="4824818">type</span>&nbsp;<span class="ident" id="4824823">byName</span>&nbsp;<span class="op" id="4824830">[</span><span class="op" id="4824831">]</span><span class="op" id="4824832">*</span><span class="ident" id="4824833">Profile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4824842">func</span>&nbsp;<span class="op" id="4824847">(</span><span class="ident" id="4824848">x</span>&nbsp;<span class="ident" id="4824850">byName</span><span class="op" id="4824856">)</span>&nbsp;<span class="ident" id="4824858">Len</span><span class="op" id="4824861">(</span><span class="op" id="4824862">)</span>&nbsp;<span class="builtintype" id="4824864">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4824878">{</span>&nbsp;<span class="keyword" id="4824880">return</span>&nbsp;<span class="builtinfunc" id="4824887">len</span><span class="op" id="4824890">(</span><span class="ident" id="4824891">x</span><span class="op" id="4824892">)</span>&nbsp;<span class="op" id="4824894">}</span><br>
<span class="lineno"></span><span class="keyword" id="4824896">func</span>&nbsp;<span class="op" id="4824901">(</span><span class="ident" id="4824902">x</span>&nbsp;<span class="ident" id="4824904">byName</span><span class="op" id="4824910">)</span>&nbsp;<span class="ident" id="4824912">Swap</span><span class="op" id="4824916">(</span><span class="ident" id="4824917">i</span><span class="op" id="4824918">,</span>&nbsp;<span class="ident" id="4824920">j</span>&nbsp;<span class="builtintype" id="4824922">int</span><span class="op" id="4824925">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4824932">{</span>&nbsp;<span class="ident" id="4824934">x</span><span class="op" id="4824935">[</span><span class="ident" id="4824936">i</span><span class="op" id="4824937">]</span><span class="op" id="4824938">,</span>&nbsp;<span class="ident" id="4824940">x</span><span class="op" id="4824941">[</span><span class="ident" id="4824942">j</span><span class="op" id="4824943">]</span>&nbsp;<span class="op" id="4824945">=</span>&nbsp;<span class="ident" id="4824947">x</span><span class="op" id="4824948">[</span><span class="ident" id="4824949">j</span><span class="op" id="4824950">]</span><span class="op" id="4824951">,</span>&nbsp;<span class="ident" id="4824953">x</span><span class="op" id="4824954">[</span><span class="ident" id="4824955">i</span><span class="op" id="4824956">]</span>&nbsp;<span class="op" id="4824958">}</span><br>
<span class="lineno"></span><span class="keyword" id="4824960">func</span>&nbsp;<span class="op" id="4824965">(</span><span class="ident" id="4824966">x</span>&nbsp;<span class="ident" id="4824968">byName</span><span class="op" id="4824974">)</span>&nbsp;<span class="ident" id="4824976">Less</span><span class="op" id="4824980">(</span><span class="ident" id="4824981">i</span><span class="op" id="4824982">,</span>&nbsp;<span class="ident" id="4824984">j</span>&nbsp;<span class="builtintype" id="4824986">int</span><span class="op" id="4824989">)</span>&nbsp;<span class="builtintype" id="4824991">bool</span>&nbsp;<span class="op" id="4824996">{</span>&nbsp;<span class="keyword" id="4824998">return</span>&nbsp;<span class="ident" id="4825005">x</span><span class="op" id="4825006">[</span><span class="ident" id="4825007">i</span><span class="op" id="4825008">]</span><span class="op" id="4825009">.</span><span class="ident" id="4825010">name</span>&nbsp;<span class="op" id="4825015">&lt;</span>&nbsp;<span class="ident" id="4825017">x</span><span class="op" id="4825018">[</span><span class="ident" id="4825019">j</span><span class="op" id="4825020">]</span><span class="op" id="4825021">.</span><span class="ident" id="4825022">name</span>&nbsp;<span class="op" id="4825027">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="4825030">//&nbsp;Name&nbsp;returns&nbsp;this&nbsp;profile&#39;s&nbsp;name,&nbsp;which&nbsp;can&nbsp;be&nbsp;passed&nbsp;to&nbsp;Lookup&nbsp;to&nbsp;reobtain&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4825122">func</span>&nbsp;<span class="op" id="4825127">(</span><span class="ident" id="4825128">p</span>&nbsp;<span class="op" id="4825130">*</span><span class="ident" id="4825131">Profile</span><span class="op" id="4825138">)</span>&nbsp;<span class="ident" id="4825140">Name</span><span class="op" id="4825144">(</span><span class="op" id="4825145">)</span>&nbsp;<span class="builtintype" id="4825147">string</span>&nbsp;<span class="op" id="4825154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4825157">return</span>&nbsp;<span class="ident" id="4825164">p</span><span class="op" id="4825165">.</span><span class="ident" id="4825166">name</span><br>
<span class="lineno"></span><span class="op" id="4825171">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="4825174">//&nbsp;Count&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;execution&nbsp;stacks&nbsp;currently&nbsp;in&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4825248">func</span>&nbsp;<span class="op" id="4825253">(</span><span class="ident" id="4825254">p</span>&nbsp;<span class="op" id="4825256">*</span><span class="ident" id="4825257">Profile</span><span class="op" id="4825264">)</span>&nbsp;<span class="ident" id="4825266">Count</span><span class="op" id="4825271">(</span><span class="op" id="4825272">)</span>&nbsp;<span class="builtintype" id="4825274">int</span>&nbsp;<span class="op" id="4825278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825281">p</span><span class="op" id="4825282">.</span><span class="ident" id="4825283">mu</span><span class="op" id="4825285">.</span><span class="ident" id="4825286">Lock</span><span class="op" id="4825290">(</span><span class="op" id="4825291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4825294">defer</span>&nbsp;<span class="ident" id="4825300">p</span><span class="op" id="4825301">.</span><span class="ident" id="4825302">mu</span><span class="op" id="4825304">.</span><span class="ident" id="4825305">Unlock</span><span class="op" id="4825311">(</span><span class="op" id="4825312">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4825315">if</span>&nbsp;<span class="ident" id="4825318">p</span><span class="op" id="4825319">.</span><span class="ident" id="4825320">count</span>&nbsp;<span class="op" id="4825326">!=</span>&nbsp;<span class="ident" id="4825329">nil</span>&nbsp;<span class="op" id="4825333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4825337">return</span>&nbsp;<span class="ident" id="4825344">p</span><span class="op" id="4825345">.</span><span class="ident" id="4825346">count</span><span class="op" id="4825351">(</span><span class="op" id="4825352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4825355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4825358">return</span>&nbsp;<span class="builtinfunc" id="4825365">len</span><span class="op" id="4825368">(</span><span class="ident" id="4825369">p</span><span class="op" id="4825370">.</span><span class="ident" id="4825371">m</span><span class="op" id="4825372">)</span><br>
<span class="lineno"></span><span class="op" id="4825374">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="4825377">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;current&nbsp;execution&nbsp;stack&nbsp;to&nbsp;the&nbsp;profile,&nbsp;associated&nbsp;with&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4825456">//&nbsp;Add&nbsp;stores&nbsp;value&nbsp;in&nbsp;an&nbsp;internal&nbsp;map,&nbsp;so&nbsp;value&nbsp;must&nbsp;be&nbsp;suitable&nbsp;for&nbsp;use&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4825533">//&nbsp;a&nbsp;map&nbsp;key&nbsp;and&nbsp;will&nbsp;not&nbsp;be&nbsp;garbage&nbsp;collected&nbsp;until&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="4825604">//&nbsp;call&nbsp;to&nbsp;Remove.&nbsp;&nbsp;Add&nbsp;panics&nbsp;if&nbsp;the&nbsp;profile&nbsp;already&nbsp;contains&nbsp;a&nbsp;stack&nbsp;for&nbsp;value.</span><br>
<span class="lineno">170</span><span class="comment" id="4825686">//</span><br>
<span class="lineno"></span><span class="comment" id="4825689">//&nbsp;The&nbsp;skip&nbsp;parameter&nbsp;has&nbsp;the&nbsp;same&nbsp;meaning&nbsp;as&nbsp;runtime.Caller&#39;s&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="4825757">//&nbsp;and&nbsp;controls&nbsp;where&nbsp;the&nbsp;stack&nbsp;trace&nbsp;begins.&nbsp;&nbsp;Passing&nbsp;skip=0&nbsp;begins&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4825830">//&nbsp;trace&nbsp;in&nbsp;the&nbsp;function&nbsp;calling&nbsp;Add.&nbsp;&nbsp;For&nbsp;example,&nbsp;given&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="4825893">//&nbsp;execution&nbsp;stack:</span><br>
<span class="lineno">175</span><span class="comment" id="4825913">//</span><br>
<span class="lineno"></span><span class="comment" id="4825916">//&nbsp;&nbsp;&nbsp;&nbspAdd</span><br>
<span class="lineno"></span><span class="comment" id="4825923">//&nbsp;&nbsp;&nbsp;&nbspcalled&nbsp;from&nbsp;rpc.NewClient</span><br>
<span class="lineno"></span><span class="comment" id="4825952">//&nbsp;&nbsp;&nbsp;&nbspcalled&nbsp;from&nbsp;mypkg.Run</span><br>
<span class="lineno"></span><span class="comment" id="4825977">//&nbsp;&nbsp;&nbsp;&nbspcalled&nbsp;from&nbsp;main.main</span><br>
<span class="lineno">180</span><span class="comment" id="4826002">//</span><br>
<span class="lineno"></span><span class="comment" id="4826005">//&nbsp;Passing&nbsp;skip=0&nbsp;begins&nbsp;the&nbsp;stack&nbsp;trace&nbsp;at&nbsp;the&nbsp;call&nbsp;to&nbsp;Add&nbsp;inside&nbsp;rpc.NewClient.</span><br>
<span class="lineno"></span><span class="comment" id="4826087">//&nbsp;Passing&nbsp;skip=1&nbsp;begins&nbsp;the&nbsp;stack&nbsp;trace&nbsp;at&nbsp;the&nbsp;call&nbsp;to&nbsp;NewClient&nbsp;inside&nbsp;mypkg.Run.</span><br>
<span class="lineno"></span><span class="comment" id="4826171">//</span><br>
<span class="lineno"></span><span class="keyword" id="4826174">func</span>&nbsp;<span class="op" id="4826179">(</span><span class="ident" id="4826180">p</span>&nbsp;<span class="op" id="4826182">*</span><span class="ident" id="4826183">Profile</span><span class="op" id="4826190">)</span>&nbsp;<span class="ident" id="4826192">Add</span><span class="op" id="4826195">(</span><span class="ident" id="4826196">value</span>&nbsp;<span class="keyword" id="4826202">interface</span><span class="op" id="4826211">{</span><span class="op" id="4826212">}</span><span class="op" id="4826213">,</span>&nbsp;<span class="ident" id="4826215">skip</span>&nbsp;<span class="builtintype" id="4826220">int</span><span class="op" id="4826223">)</span>&nbsp;<span class="op" id="4826225">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826228">if</span>&nbsp;<span class="ident" id="4826231">p</span><span class="op" id="4826232">.</span><span class="ident" id="4826233">name</span>&nbsp;<span class="op" id="4826238">==</span>&nbsp;<span class="string" id="4826241">&#34;&#34;</span>&nbsp;<span class="op" id="4826244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4826248">panic</span><span class="op" id="4826253">(</span><span class="string" id="4826254">&#34;pprof:&nbsp;use&nbsp;of&nbsp;uninitialized&nbsp;Profile&#34;</span><span class="op" id="4826291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4826294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826297">if</span>&nbsp;<span class="ident" id="4826300">p</span><span class="op" id="4826301">.</span><span class="ident" id="4826302">write</span>&nbsp;<span class="op" id="4826308">!=</span>&nbsp;<span class="ident" id="4826311">nil</span>&nbsp;<span class="op" id="4826315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4826319">panic</span><span class="op" id="4826324">(</span><span class="string" id="4826325">&#34;pprof:&nbsp;Add&nbsp;called&nbsp;on&nbsp;built-in&nbsp;Profile&nbsp;&#34;</span>&nbsp;<span class="op" id="4826366">+</span>&nbsp;<span class="ident" id="4826368">p</span><span class="op" id="4826369">.</span><span class="ident" id="4826370">name</span><span class="op" id="4826374">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4826377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826381">stk</span>&nbsp;<span class="op" id="4826385">:=</span>&nbsp;<span class="builtinfunc" id="4826388">make</span><span class="op" id="4826392">(</span><span class="op" id="4826393">[</span><span class="op" id="4826394">]</span><span class="builtintype" id="4826395">uintptr</span><span class="op" id="4826402">,</span>&nbsp;<span class="num" id="4826404">32</span><span class="op" id="4826406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826409">n</span>&nbsp;<span class="op" id="4826411">:=</span>&nbsp;<span class="ident" id="4826414">runtime</span><span class="op" id="4826421">.</span><span class="ident" id="4826422">Callers</span><span class="op" id="4826429">(</span><span class="ident" id="4826430">skip</span><span class="op" id="4826434">+</span><span class="num" id="4826435">1</span><span class="op" id="4826436">,</span>&nbsp;<span class="ident" id="4826438">stk</span><span class="op" id="4826441">[</span><span class="op" id="4826442">:</span><span class="op" id="4826443">]</span><span class="op" id="4826444">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826448">p</span><span class="op" id="4826449">.</span><span class="ident" id="4826450">mu</span><span class="op" id="4826452">.</span><span class="ident" id="4826453">Lock</span><span class="op" id="4826457">(</span><span class="op" id="4826458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826461">defer</span>&nbsp;<span class="ident" id="4826467">p</span><span class="op" id="4826468">.</span><span class="ident" id="4826469">mu</span><span class="op" id="4826471">.</span><span class="ident" id="4826472">Unlock</span><span class="op" id="4826478">(</span><span class="op" id="4826479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826482">if</span>&nbsp;<span class="ident" id="4826485">p</span><span class="op" id="4826486">.</span><span class="ident" id="4826487">m</span><span class="op" id="4826488">[</span><span class="ident" id="4826489">value</span><span class="op" id="4826494">]</span>&nbsp;<span class="op" id="4826496">!=</span>&nbsp;<span class="ident" id="4826499">nil</span>&nbsp;<span class="op" id="4826503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4826507">panic</span><span class="op" id="4826512">(</span><span class="string" id="4826513">&#34;pprof:&nbsp;Profile.Add&nbsp;of&nbsp;duplicate&nbsp;value&#34;</span><span class="op" id="4826552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4826555">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826558">p</span><span class="op" id="4826559">.</span><span class="ident" id="4826560">m</span><span class="op" id="4826561">[</span><span class="ident" id="4826562">value</span><span class="op" id="4826567">]</span>&nbsp;<span class="op" id="4826569">=</span>&nbsp;<span class="ident" id="4826571">stk</span><span class="op" id="4826574">[</span><span class="op" id="4826575">:</span><span class="ident" id="4826576">n</span><span class="op" id="4826577">]</span><br>
<span class="lineno"></span><span class="op" id="4826579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4826582">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;execution&nbsp;stack&nbsp;associated&nbsp;with&nbsp;value&nbsp;from&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="4826660">//&nbsp;It&nbsp;is&nbsp;a&nbsp;no-op&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;profile.</span><br>
<span class="lineno">205</span><span class="keyword" id="4826713">func</span>&nbsp;<span class="op" id="4826718">(</span><span class="ident" id="4826719">p</span>&nbsp;<span class="op" id="4826721">*</span><span class="ident" id="4826722">Profile</span><span class="op" id="4826729">)</span>&nbsp;<span class="ident" id="4826731">Remove</span><span class="op" id="4826737">(</span><span class="ident" id="4826738">value</span>&nbsp;<span class="keyword" id="4826744">interface</span><span class="op" id="4826753">{</span><span class="op" id="4826754">}</span><span class="op" id="4826755">)</span>&nbsp;<span class="op" id="4826757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826760">p</span><span class="op" id="4826761">.</span><span class="ident" id="4826762">mu</span><span class="op" id="4826764">.</span><span class="ident" id="4826765">Lock</span><span class="op" id="4826769">(</span><span class="op" id="4826770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826773">defer</span>&nbsp;<span class="ident" id="4826779">p</span><span class="op" id="4826780">.</span><span class="ident" id="4826781">mu</span><span class="op" id="4826783">.</span><span class="ident" id="4826784">Unlock</span><span class="op" id="4826790">(</span><span class="op" id="4826791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4826794">delete</span><span class="op" id="4826800">(</span><span class="ident" id="4826801">p</span><span class="op" id="4826802">.</span><span class="ident" id="4826803">m</span><span class="op" id="4826804">,</span>&nbsp;<span class="ident" id="4826806">value</span><span class="op" id="4826811">)</span><br>
<span class="lineno"></span><span class="op" id="4826813">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="comment" id="4826816">//&nbsp;WriteTo&nbsp;writes&nbsp;a&nbsp;pprof-formatted&nbsp;snapshot&nbsp;of&nbsp;the&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4826882">//&nbsp;If&nbsp;a&nbsp;write&nbsp;to&nbsp;w&nbsp;returns&nbsp;an&nbsp;error,&nbsp;WriteTo&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4826947">//&nbsp;Otherwise,&nbsp;WriteTo&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="4826982">//</span><br>
<span class="lineno">215</span><span class="comment" id="4826985">//&nbsp;The&nbsp;debug&nbsp;parameter&nbsp;enables&nbsp;additional&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="4827035">//&nbsp;Passing&nbsp;debug=0&nbsp;prints&nbsp;only&nbsp;the&nbsp;hexadecimal&nbsp;addresses&nbsp;that&nbsp;pprof&nbsp;needs.</span><br>
<span class="lineno"></span><span class="comment" id="4827110">//&nbsp;Passing&nbsp;debug=1&nbsp;adds&nbsp;comments&nbsp;translating&nbsp;addresses&nbsp;to&nbsp;function&nbsp;names</span><br>
<span class="lineno"></span><span class="comment" id="4827183">//&nbsp;and&nbsp;line&nbsp;numbers,&nbsp;so&nbsp;that&nbsp;a&nbsp;programmer&nbsp;can&nbsp;read&nbsp;the&nbsp;profile&nbsp;without&nbsp;tools.</span><br>
<span class="lineno"></span><span class="comment" id="4827261">//</span><br>
<span class="lineno">220</span><span class="comment" id="4827264">//&nbsp;The&nbsp;predefined&nbsp;profiles&nbsp;may&nbsp;assign&nbsp;meaning&nbsp;to&nbsp;other&nbsp;debug&nbsp;values;</span><br>
<span class="lineno"></span><span class="comment" id="4827333">//&nbsp;for&nbsp;example,&nbsp;when&nbsp;printing&nbsp;the&nbsp;&#34;goroutine&#34;&nbsp;profile,&nbsp;debug=2&nbsp;means&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4827405">//&nbsp;print&nbsp;the&nbsp;goroutine&nbsp;stacks&nbsp;in&nbsp;the&nbsp;same&nbsp;form&nbsp;that&nbsp;a&nbsp;Go&nbsp;program&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="4827475">//&nbsp;when&nbsp;dying&nbsp;due&nbsp;to&nbsp;an&nbsp;unrecovered&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="4827518">func</span>&nbsp;<span class="op" id="4827523">(</span><span class="ident" id="4827524">p</span>&nbsp;<span class="op" id="4827526">*</span><span class="ident" id="4827527">Profile</span><span class="op" id="4827534">)</span>&nbsp;<span class="ident" id="4827536">WriteTo</span><span class="op" id="4827543">(</span><span class="ident" id="4827544">w</span>&nbsp;<span class="ident" id="4827546">io</span><span class="op" id="4827548">.</span><span class="ident" id="4827549">Writer</span><span class="op" id="4827555">,</span>&nbsp;<span class="ident" id="4827557">debug</span>&nbsp;<span class="builtintype" id="4827563">int</span><span class="op" id="4827566">)</span>&nbsp;<span class="builtintype" id="4827568">error</span>&nbsp;<span class="op" id="4827574">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827577">if</span>&nbsp;<span class="ident" id="4827580">p</span><span class="op" id="4827581">.</span><span class="ident" id="4827582">name</span>&nbsp;<span class="op" id="4827587">==</span>&nbsp;<span class="string" id="4827590">&#34;&#34;</span>&nbsp;<span class="op" id="4827593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4827597">panic</span><span class="op" id="4827602">(</span><span class="string" id="4827603">&#34;pprof:&nbsp;use&nbsp;of&nbsp;zero&nbsp;Profile&#34;</span><span class="op" id="4827631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827637">if</span>&nbsp;<span class="ident" id="4827640">p</span><span class="op" id="4827641">.</span><span class="ident" id="4827642">write</span>&nbsp;<span class="op" id="4827648">!=</span>&nbsp;<span class="ident" id="4827651">nil</span>&nbsp;<span class="op" id="4827655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827659">return</span>&nbsp;<span class="ident" id="4827666">p</span><span class="op" id="4827667">.</span><span class="ident" id="4827668">write</span><span class="op" id="4827673">(</span><span class="ident" id="4827674">w</span><span class="op" id="4827675">,</span>&nbsp;<span class="ident" id="4827677">debug</span><span class="op" id="4827682">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827689">//&nbsp;Obtain&nbsp;consistent&nbsp;snapshot&nbsp;under&nbsp;lock;&nbsp;then&nbsp;process&nbsp;without&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827759">var</span>&nbsp;<span class="ident" id="4827763">all</span>&nbsp;<span class="op" id="4827767">[</span><span class="op" id="4827768">]</span><span class="op" id="4827769">[</span><span class="op" id="4827770">]</span><span class="builtintype" id="4827771">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827780">p</span><span class="op" id="4827781">.</span><span class="ident" id="4827782">mu</span><span class="op" id="4827784">.</span><span class="ident" id="4827785">Lock</span><span class="op" id="4827789">(</span><span class="op" id="4827790">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827793">for</span>&nbsp;<span class="ident" id="4827797">_</span><span class="op" id="4827798">,</span>&nbsp;<span class="ident" id="4827800">stk</span>&nbsp;<span class="op" id="4827804">:=</span>&nbsp;<span class="keyword" id="4827807">range</span>&nbsp;<span class="ident" id="4827813">p</span><span class="op" id="4827814">.</span><span class="ident" id="4827815">m</span>&nbsp;<span class="op" id="4827817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827821">all</span>&nbsp;<span class="op" id="4827825">=</span>&nbsp;<span class="builtinfunc" id="4827827">append</span><span class="op" id="4827833">(</span><span class="ident" id="4827834">all</span><span class="op" id="4827837">,</span>&nbsp;<span class="ident" id="4827839">stk</span><span class="op" id="4827842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827848">p</span><span class="op" id="4827849">.</span><span class="ident" id="4827850">mu</span><span class="op" id="4827852">.</span><span class="ident" id="4827853">Unlock</span><span class="op" id="4827859">(</span><span class="op" id="4827860">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827864">//&nbsp;Map&nbsp;order&nbsp;is&nbsp;non-deterministic;&nbsp;make&nbsp;output&nbsp;deterministic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827927">sort</span><span class="op" id="4827931">.</span><span class="ident" id="4827932">Sort</span><span class="op" id="4827936">(</span><span class="ident" id="4827937">stackProfile</span><span class="op" id="4827949">(</span><span class="ident" id="4827950">all</span><span class="op" id="4827953">)</span><span class="op" id="4827954">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827958">return</span>&nbsp;<span class="ident" id="4827965">printCountProfile</span><span class="op" id="4827982">(</span><span class="ident" id="4827983">w</span><span class="op" id="4827984">,</span>&nbsp;<span class="ident" id="4827986">debug</span><span class="op" id="4827991">,</span>&nbsp;<span class="ident" id="4827993">p</span><span class="op" id="4827994">.</span><span class="ident" id="4827995">name</span><span class="op" id="4827999">,</span>&nbsp;<span class="ident" id="4828001">stackProfile</span><span class="op" id="4828013">(</span><span class="ident" id="4828014">all</span><span class="op" id="4828017">)</span><span class="op" id="4828018">)</span><br>
<span class="lineno"></span><span class="op" id="4828020">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="4828023">type</span>&nbsp;<span class="ident" id="4828028">stackProfile</span>&nbsp;<span class="op" id="4828041">[</span><span class="op" id="4828042">]</span><span class="op" id="4828043">[</span><span class="op" id="4828044">]</span><span class="builtintype" id="4828045">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4828054">func</span>&nbsp;<span class="op" id="4828059">(</span><span class="ident" id="4828060">x</span>&nbsp;<span class="ident" id="4828062">stackProfile</span><span class="op" id="4828074">)</span>&nbsp;<span class="ident" id="4828076">Len</span><span class="op" id="4828079">(</span><span class="op" id="4828080">)</span>&nbsp;<span class="builtintype" id="4828082">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828099">{</span>&nbsp;<span class="keyword" id="4828101">return</span>&nbsp;<span class="builtinfunc" id="4828108">len</span><span class="op" id="4828111">(</span><span class="ident" id="4828112">x</span><span class="op" id="4828113">)</span>&nbsp;<span class="op" id="4828115">}</span><br>
<span class="lineno"></span><span class="keyword" id="4828117">func</span>&nbsp;<span class="op" id="4828122">(</span><span class="ident" id="4828123">x</span>&nbsp;<span class="ident" id="4828125">stackProfile</span><span class="op" id="4828137">)</span>&nbsp;<span class="ident" id="4828139">Stack</span><span class="op" id="4828144">(</span><span class="ident" id="4828145">i</span>&nbsp;<span class="builtintype" id="4828147">int</span><span class="op" id="4828150">)</span>&nbsp;<span class="op" id="4828152">[</span><span class="op" id="4828153">]</span><span class="builtintype" id="4828154">uintptr</span>&nbsp;<span class="op" id="4828162">{</span>&nbsp;<span class="keyword" id="4828164">return</span>&nbsp;<span class="ident" id="4828171">x</span><span class="op" id="4828172">[</span><span class="ident" id="4828173">i</span><span class="op" id="4828174">]</span>&nbsp;<span class="op" id="4828176">}</span><br>
<span class="lineno">250</span><span class="keyword" id="4828178">func</span>&nbsp;<span class="op" id="4828183">(</span><span class="ident" id="4828184">x</span>&nbsp;<span class="ident" id="4828186">stackProfile</span><span class="op" id="4828198">)</span>&nbsp;<span class="ident" id="4828200">Swap</span><span class="op" id="4828204">(</span><span class="ident" id="4828205">i</span><span class="op" id="4828206">,</span>&nbsp;<span class="ident" id="4828208">j</span>&nbsp;<span class="builtintype" id="4828210">int</span><span class="op" id="4828213">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828223">{</span>&nbsp;<span class="ident" id="4828225">x</span><span class="op" id="4828226">[</span><span class="ident" id="4828227">i</span><span class="op" id="4828228">]</span><span class="op" id="4828229">,</span>&nbsp;<span class="ident" id="4828231">x</span><span class="op" id="4828232">[</span><span class="ident" id="4828233">j</span><span class="op" id="4828234">]</span>&nbsp;<span class="op" id="4828236">=</span>&nbsp;<span class="ident" id="4828238">x</span><span class="op" id="4828239">[</span><span class="ident" id="4828240">j</span><span class="op" id="4828241">]</span><span class="op" id="4828242">,</span>&nbsp;<span class="ident" id="4828244">x</span><span class="op" id="4828245">[</span><span class="ident" id="4828246">i</span><span class="op" id="4828247">]</span>&nbsp;<span class="op" id="4828249">}</span><br>
<span class="lineno"></span><span class="keyword" id="4828251">func</span>&nbsp;<span class="op" id="4828256">(</span><span class="ident" id="4828257">x</span>&nbsp;<span class="ident" id="4828259">stackProfile</span><span class="op" id="4828271">)</span>&nbsp;<span class="ident" id="4828273">Less</span><span class="op" id="4828277">(</span><span class="ident" id="4828278">i</span><span class="op" id="4828279">,</span>&nbsp;<span class="ident" id="4828281">j</span>&nbsp;<span class="builtintype" id="4828283">int</span><span class="op" id="4828286">)</span>&nbsp;<span class="builtintype" id="4828288">bool</span>&nbsp;<span class="op" id="4828293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828296">t</span><span class="op" id="4828297">,</span>&nbsp;<span class="ident" id="4828299">u</span>&nbsp;<span class="op" id="4828301">:=</span>&nbsp;<span class="ident" id="4828304">x</span><span class="op" id="4828305">[</span><span class="ident" id="4828306">i</span><span class="op" id="4828307">]</span><span class="op" id="4828308">,</span>&nbsp;<span class="ident" id="4828310">x</span><span class="op" id="4828311">[</span><span class="ident" id="4828312">j</span><span class="op" id="4828313">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828316">for</span>&nbsp;<span class="ident" id="4828320">k</span>&nbsp;<span class="op" id="4828322">:=</span>&nbsp;<span class="num" id="4828325">0</span><span class="op" id="4828326">;</span>&nbsp;<span class="ident" id="4828328">k</span>&nbsp;<span class="op" id="4828330">&lt;</span>&nbsp;<span class="builtinfunc" id="4828332">len</span><span class="op" id="4828335">(</span><span class="ident" id="4828336">t</span><span class="op" id="4828337">)</span>&nbsp;<span class="op" id="4828339">&amp;&amp;</span>&nbsp;<span class="ident" id="4828342">k</span>&nbsp;<span class="op" id="4828344">&lt;</span>&nbsp;<span class="builtinfunc" id="4828346">len</span><span class="op" id="4828349">(</span><span class="ident" id="4828350">u</span><span class="op" id="4828351">)</span><span class="op" id="4828352">;</span>&nbsp;<span class="ident" id="4828354">k</span><span class="op" id="4828355">++</span>&nbsp;<span class="op" id="4828358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828362">if</span>&nbsp;<span class="ident" id="4828365">t</span><span class="op" id="4828366">[</span><span class="ident" id="4828367">k</span><span class="op" id="4828368">]</span>&nbsp;<span class="op" id="4828370">!=</span>&nbsp;<span class="ident" id="4828373">u</span><span class="op" id="4828374">[</span><span class="ident" id="4828375">k</span><span class="op" id="4828376">]</span>&nbsp;<span class="op" id="4828378">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828383">return</span>&nbsp;<span class="ident" id="4828390">t</span><span class="op" id="4828391">[</span><span class="ident" id="4828392">k</span><span class="op" id="4828393">]</span>&nbsp;<span class="op" id="4828395">&lt;</span>&nbsp;<span class="ident" id="4828397">u</span><span class="op" id="4828398">[</span><span class="ident" id="4828399">k</span><span class="op" id="4828400">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828410">return</span>&nbsp;<span class="builtinfunc" id="4828417">len</span><span class="op" id="4828420">(</span><span class="ident" id="4828421">t</span><span class="op" id="4828422">)</span>&nbsp;<span class="op" id="4828424">&lt;</span>&nbsp;<span class="builtinfunc" id="4828426">len</span><span class="op" id="4828429">(</span><span class="ident" id="4828430">u</span><span class="op" id="4828431">)</span><br>
<span class="lineno"></span><span class="op" id="4828433">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="4828436">//&nbsp;A&nbsp;countProfile&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;stack&nbsp;traces&nbsp;to&nbsp;be&nbsp;printed&nbsp;as&nbsp;counts</span><br>
<span class="lineno"></span><span class="comment" id="4828503">//&nbsp;grouped&nbsp;by&nbsp;stack&nbsp;trace.&nbsp;&nbsp;There&nbsp;are&nbsp;multiple&nbsp;implementations:</span><br>
<span class="lineno"></span><span class="comment" id="4828567">//&nbsp;all&nbsp;that&nbsp;matters&nbsp;is&nbsp;that&nbsp;we&nbsp;can&nbsp;find&nbsp;out&nbsp;how&nbsp;many&nbsp;traces&nbsp;there&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4828637">//&nbsp;and&nbsp;obtain&nbsp;each&nbsp;trace&nbsp;in&nbsp;turn.</span><br>
<span class="lineno">265</span><span class="keyword" id="4828671">type</span>&nbsp;<span class="ident" id="4828676">countProfile</span>&nbsp;<span class="keyword" id="4828689">interface</span>&nbsp;<span class="op" id="4828699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828702">Len</span><span class="op" id="4828705">(</span><span class="op" id="4828706">)</span>&nbsp;<span class="builtintype" id="4828708">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828713">Stack</span><span class="op" id="4828718">(</span><span class="ident" id="4828719">i</span>&nbsp;<span class="builtintype" id="4828721">int</span><span class="op" id="4828724">)</span>&nbsp;<span class="op" id="4828726">[</span><span class="op" id="4828727">]</span><span class="builtintype" id="4828728">uintptr</span><br>
<span class="lineno"></span><span class="op" id="4828736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4828739">//&nbsp;printCountProfile&nbsp;prints&nbsp;a&nbsp;countProfile&nbsp;at&nbsp;the&nbsp;specified&nbsp;debug&nbsp;level.</span><br>
<span class="lineno"></span><span class="keyword" id="4828812">func</span>&nbsp;<span class="ident" id="4828817">printCountProfile</span><span class="op" id="4828834">(</span><span class="ident" id="4828835">w</span>&nbsp;<span class="ident" id="4828837">io</span><span class="op" id="4828839">.</span><span class="ident" id="4828840">Writer</span><span class="op" id="4828846">,</span>&nbsp;<span class="ident" id="4828848">debug</span>&nbsp;<span class="builtintype" id="4828854">int</span><span class="op" id="4828857">,</span>&nbsp;<span class="ident" id="4828859">name</span>&nbsp;<span class="builtintype" id="4828864">string</span><span class="op" id="4828870">,</span>&nbsp;<span class="ident" id="4828872">p</span>&nbsp;<span class="ident" id="4828874">countProfile</span><span class="op" id="4828886">)</span>&nbsp;<span class="builtintype" id="4828888">error</span>&nbsp;<span class="op" id="4828894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828897">b</span>&nbsp;<span class="op" id="4828899">:=</span>&nbsp;<span class="ident" id="4828902">bufio</span><span class="op" id="4828907">.</span><span class="ident" id="4828908">NewWriter</span><span class="op" id="4828917">(</span><span class="ident" id="4828918">w</span><span class="op" id="4828919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828922">var</span>&nbsp;<span class="ident" id="4828926">tw</span>&nbsp;<span class="op" id="4828929">*</span><span class="ident" id="4828930">tabwriter</span><span class="op" id="4828939">.</span><span class="ident" id="4828940">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828948">w</span>&nbsp;<span class="op" id="4828950">=</span>&nbsp;<span class="ident" id="4828952">b</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828955">if</span>&nbsp;<span class="ident" id="4828958">debug</span>&nbsp;<span class="op" id="4828964">&gt;</span>&nbsp;<span class="num" id="4828966">0</span>&nbsp;<span class="op" id="4828968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828972">tw</span>&nbsp;<span class="op" id="4828975">=</span>&nbsp;<span class="ident" id="4828977">tabwriter</span><span class="op" id="4828986">.</span><span class="ident" id="4828987">NewWriter</span><span class="op" id="4828996">(</span><span class="ident" id="4828997">w</span><span class="op" id="4828998">,</span>&nbsp;<span class="num" id="4829000">1</span><span class="op" id="4829001">,</span>&nbsp;<span class="num" id="4829003">8</span><span class="op" id="4829004">,</span>&nbsp;<span class="num" id="4829006">1</span><span class="op" id="4829007">,</span>&nbsp;<span class="string" id="4829009">&#39;\t&#39;</span><span class="op" id="4829013">,</span>&nbsp;<span class="num" id="4829015">0</span><span class="op" id="4829016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829020">w</span>&nbsp;<span class="op" id="4829022">=</span>&nbsp;<span class="ident" id="4829024">tw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829032">fmt</span><span class="op" id="4829035">.</span><span class="ident" id="4829036">Fprintf</span><span class="op" id="4829043">(</span><span class="ident" id="4829044">w</span><span class="op" id="4829045">,</span>&nbsp;<span class="string" id="4829047">&#34;%s&nbsp;profile:&nbsp;total&nbsp;%d\n&#34;</span><span class="op" id="4829071">,</span>&nbsp;<span class="ident" id="4829073">name</span><span class="op" id="4829077">,</span>&nbsp;<span class="ident" id="4829079">p</span><span class="op" id="4829080">.</span><span class="ident" id="4829081">Len</span><span class="op" id="4829084">(</span><span class="op" id="4829085">)</span><span class="op" id="4829086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4829090">//&nbsp;Build&nbsp;count&nbsp;of&nbsp;each&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829121">var</span>&nbsp;<span class="ident" id="4829125">buf</span>&nbsp;<span class="ident" id="4829129">bytes</span><span class="op" id="4829134">.</span><span class="ident" id="4829135">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829143">key</span>&nbsp;<span class="op" id="4829147">:=</span>&nbsp;<span class="keyword" id="4829150">func</span><span class="op" id="4829154">(</span><span class="ident" id="4829155">stk</span>&nbsp;<span class="op" id="4829159">[</span><span class="op" id="4829160">]</span><span class="builtintype" id="4829161">uintptr</span><span class="op" id="4829168">)</span>&nbsp;<span class="builtintype" id="4829170">string</span>&nbsp;<span class="op" id="4829177">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829181">buf</span><span class="op" id="4829184">.</span><span class="ident" id="4829185">Reset</span><span class="op" id="4829190">(</span><span class="op" id="4829191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829195">fmt</span><span class="op" id="4829198">.</span><span class="ident" id="4829199">Fprintf</span><span class="op" id="4829206">(</span><span class="op" id="4829207">&amp;</span><span class="ident" id="4829208">buf</span><span class="op" id="4829211">,</span>&nbsp;<span class="string" id="4829213">&#34;@&#34;</span><span class="op" id="4829216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829220">for</span>&nbsp;<span class="ident" id="4829224">_</span><span class="op" id="4829225">,</span>&nbsp;<span class="ident" id="4829227">pc</span>&nbsp;<span class="op" id="4829230">:=</span>&nbsp;<span class="keyword" id="4829233">range</span>&nbsp;<span class="ident" id="4829239">stk</span>&nbsp;<span class="op" id="4829243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829248">fmt</span><span class="op" id="4829251">.</span><span class="ident" id="4829252">Fprintf</span><span class="op" id="4829259">(</span><span class="op" id="4829260">&amp;</span><span class="ident" id="4829261">buf</span><span class="op" id="4829264">,</span>&nbsp;<span class="string" id="4829266">&#34;&nbsp;%#x&#34;</span><span class="op" id="4829272">,</span>&nbsp;<span class="ident" id="4829274">pc</span><span class="op" id="4829276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829280">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829284">return</span>&nbsp;<span class="ident" id="4829291">buf</span><span class="op" id="4829294">.</span><span class="ident" id="4829295">String</span><span class="op" id="4829301">(</span><span class="op" id="4829302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829308">m</span>&nbsp;<span class="op" id="4829310">:=</span>&nbsp;<span class="keyword" id="4829313">map</span><span class="op" id="4829316">[</span><span class="builtintype" id="4829317">string</span><span class="op" id="4829323">]</span><span class="builtintype" id="4829324">int</span><span class="op" id="4829327">{</span><span class="op" id="4829328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829331">n</span>&nbsp;<span class="op" id="4829333">:=</span>&nbsp;<span class="ident" id="4829336">p</span><span class="op" id="4829337">.</span><span class="ident" id="4829338">Len</span><span class="op" id="4829341">(</span><span class="op" id="4829342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829345">for</span>&nbsp;<span class="ident" id="4829349">i</span>&nbsp;<span class="op" id="4829351">:=</span>&nbsp;<span class="num" id="4829354">0</span><span class="op" id="4829355">;</span>&nbsp;<span class="ident" id="4829357">i</span>&nbsp;<span class="op" id="4829359">&lt;</span>&nbsp;<span class="ident" id="4829361">n</span><span class="op" id="4829362">;</span>&nbsp;<span class="ident" id="4829364">i</span><span class="op" id="4829365">++</span>&nbsp;<span class="op" id="4829368">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829372">m</span><span class="op" id="4829373">[</span><span class="ident" id="4829374">key</span><span class="op" id="4829377">(</span><span class="ident" id="4829378">p</span><span class="op" id="4829379">.</span><span class="ident" id="4829380">Stack</span><span class="op" id="4829385">(</span><span class="ident" id="4829386">i</span><span class="op" id="4829387">)</span><span class="op" id="4829388">)</span><span class="op" id="4829389">]</span><span class="op" id="4829390">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4829398">//&nbsp;Print&nbsp;stacks,&nbsp;listing&nbsp;count&nbsp;on&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;a&nbsp;unique&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829469">for</span>&nbsp;<span class="ident" id="4829473">i</span>&nbsp;<span class="op" id="4829475">:=</span>&nbsp;<span class="num" id="4829478">0</span><span class="op" id="4829479">;</span>&nbsp;<span class="ident" id="4829481">i</span>&nbsp;<span class="op" id="4829483">&lt;</span>&nbsp;<span class="ident" id="4829485">n</span><span class="op" id="4829486">;</span>&nbsp;<span class="ident" id="4829488">i</span><span class="op" id="4829489">++</span>&nbsp;<span class="op" id="4829492">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829496">stk</span>&nbsp;<span class="op" id="4829500">:=</span>&nbsp;<span class="ident" id="4829503">p</span><span class="op" id="4829504">.</span><span class="ident" id="4829505">Stack</span><span class="op" id="4829510">(</span><span class="ident" id="4829511">i</span><span class="op" id="4829512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829516">s</span>&nbsp;<span class="op" id="4829518">:=</span>&nbsp;<span class="ident" id="4829521">key</span><span class="op" id="4829524">(</span><span class="ident" id="4829525">stk</span><span class="op" id="4829528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829532">if</span>&nbsp;<span class="ident" id="4829535">count</span>&nbsp;<span class="op" id="4829541">:=</span>&nbsp;<span class="ident" id="4829544">m</span><span class="op" id="4829545">[</span><span class="ident" id="4829546">s</span><span class="op" id="4829547">]</span><span class="op" id="4829548">;</span>&nbsp;<span class="ident" id="4829550">count</span>&nbsp;<span class="op" id="4829556">!=</span>&nbsp;<span class="num" id="4829559">0</span>&nbsp;<span class="op" id="4829561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829566">fmt</span><span class="op" id="4829569">.</span><span class="ident" id="4829570">Fprintf</span><span class="op" id="4829577">(</span><span class="ident" id="4829578">w</span><span class="op" id="4829579">,</span>&nbsp;<span class="string" id="4829581">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="4829590">,</span>&nbsp;<span class="ident" id="4829592">count</span><span class="op" id="4829597">,</span>&nbsp;<span class="ident" id="4829599">s</span><span class="op" id="4829600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829605">if</span>&nbsp;<span class="ident" id="4829608">debug</span>&nbsp;<span class="op" id="4829614">&gt;</span>&nbsp;<span class="num" id="4829616">0</span>&nbsp;<span class="op" id="4829618">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829624">printStackRecord</span><span class="op" id="4829640">(</span><span class="ident" id="4829641">w</span><span class="op" id="4829642">,</span>&nbsp;<span class="ident" id="4829644">stk</span><span class="op" id="4829647">,</span>&nbsp;<span class="ident" id="4829649">false</span><span class="op" id="4829654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4829664">delete</span><span class="op" id="4829670">(</span><span class="ident" id="4829671">m</span><span class="op" id="4829672">,</span>&nbsp;<span class="ident" id="4829674">s</span><span class="op" id="4829675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829682">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829686">if</span>&nbsp;<span class="ident" id="4829689">tw</span>&nbsp;<span class="op" id="4829692">!=</span>&nbsp;<span class="ident" id="4829695">nil</span>&nbsp;<span class="op" id="4829699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829703">tw</span><span class="op" id="4829705">.</span><span class="ident" id="4829706">Flush</span><span class="op" id="4829711">(</span><span class="op" id="4829712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829718">return</span>&nbsp;<span class="ident" id="4829725">b</span><span class="op" id="4829726">.</span><span class="ident" id="4829727">Flush</span><span class="op" id="4829732">(</span><span class="op" id="4829733">)</span><br>
<span class="lineno">315</span><span class="op" id="4829735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4829738">//&nbsp;printStackRecord&nbsp;prints&nbsp;the&nbsp;function&nbsp;+&nbsp;source&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4829804">//&nbsp;for&nbsp;a&nbsp;single&nbsp;stack&nbsp;trace.</span><br>
<span class="lineno"></span><span class="keyword" id="4829833">func</span>&nbsp;<span class="ident" id="4829838">printStackRecord</span><span class="op" id="4829854">(</span><span class="ident" id="4829855">w</span>&nbsp;<span class="ident" id="4829857">io</span><span class="op" id="4829859">.</span><span class="ident" id="4829860">Writer</span><span class="op" id="4829866">,</span>&nbsp;<span class="ident" id="4829868">stk</span>&nbsp;<span class="op" id="4829872">[</span><span class="op" id="4829873">]</span><span class="builtintype" id="4829874">uintptr</span><span class="op" id="4829881">,</span>&nbsp;<span class="ident" id="4829883">allFrames</span>&nbsp;<span class="builtintype" id="4829893">bool</span><span class="op" id="4829897">)</span>&nbsp;<span class="op" id="4829899">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829902">show</span>&nbsp;<span class="op" id="4829907">:=</span>&nbsp;<span class="ident" id="4829910">allFrames</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829921">wasPanic</span>&nbsp;<span class="op" id="4829930">:=</span>&nbsp;<span class="ident" id="4829933">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829940">for</span>&nbsp;<span class="ident" id="4829944">i</span><span class="op" id="4829945">,</span>&nbsp;<span class="ident" id="4829947">pc</span>&nbsp;<span class="op" id="4829950">:=</span>&nbsp;<span class="keyword" id="4829953">range</span>&nbsp;<span class="ident" id="4829959">stk</span>&nbsp;<span class="op" id="4829963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829967">f</span>&nbsp;<span class="op" id="4829969">:=</span>&nbsp;<span class="ident" id="4829972">runtime</span><span class="op" id="4829979">.</span><span class="ident" id="4829980">FuncForPC</span><span class="op" id="4829989">(</span><span class="ident" id="4829990">pc</span><span class="op" id="4829992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829996">if</span>&nbsp;<span class="ident" id="4829999">f</span>&nbsp;<span class="op" id="4830001">==</span>&nbsp;<span class="ident" id="4830004">nil</span>&nbsp;<span class="op" id="4830008">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830013">show</span>&nbsp;<span class="op" id="4830018">=</span>&nbsp;<span class="ident" id="4830020">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830028">fmt</span><span class="op" id="4830031">.</span><span class="ident" id="4830032">Fprintf</span><span class="op" id="4830039">(</span><span class="ident" id="4830040">w</span><span class="op" id="4830041">,</span>&nbsp;<span class="string" id="4830043">&#34;#\t%#x\n&#34;</span><span class="op" id="4830053">,</span>&nbsp;<span class="ident" id="4830055">pc</span><span class="op" id="4830057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830062">wasPanic</span>&nbsp;<span class="op" id="4830071">=</span>&nbsp;<span class="ident" id="4830073">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830081">}</span>&nbsp;<span class="keyword" id="4830083">else</span>&nbsp;<span class="op" id="4830088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830093">tracepc</span>&nbsp;<span class="op" id="4830101">:=</span>&nbsp;<span class="ident" id="4830104">pc</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830110">//&nbsp;Back&nbsp;up&nbsp;to&nbsp;call&nbsp;instruction.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830145">if</span>&nbsp;<span class="ident" id="4830148">i</span>&nbsp;<span class="op" id="4830150">&gt;</span>&nbsp;<span class="num" id="4830152">0</span>&nbsp;<span class="op" id="4830154">&amp;&amp;</span>&nbsp;<span class="ident" id="4830157">pc</span>&nbsp;<span class="op" id="4830160">&gt;</span>&nbsp;<span class="ident" id="4830162">f</span><span class="op" id="4830163">.</span><span class="ident" id="4830164">Entry</span><span class="op" id="4830169">(</span><span class="op" id="4830170">)</span>&nbsp;<span class="op" id="4830172">&amp;&amp;</span>&nbsp;<span class="op" id="4830175">!</span><span class="ident" id="4830176">wasPanic</span>&nbsp;<span class="op" id="4830185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830191">if</span>&nbsp;<span class="ident" id="4830194">runtime</span><span class="op" id="4830201">.</span><span class="ident" id="4830202">GOARCH</span>&nbsp;<span class="op" id="4830209">==</span>&nbsp;<span class="string" id="4830212">&#34;386&#34;</span>&nbsp;<span class="op" id="4830218">||</span>&nbsp;<span class="ident" id="4830221">runtime</span><span class="op" id="4830228">.</span><span class="ident" id="4830229">GOARCH</span>&nbsp;<span class="op" id="4830236">==</span>&nbsp;<span class="string" id="4830239">&#34;amd64&#34;</span>&nbsp;<span class="op" id="4830247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830254">tracepc</span><span class="op" id="4830261">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830268">}</span>&nbsp;<span class="keyword" id="4830270">else</span>&nbsp;<span class="op" id="4830275">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830282">tracepc</span>&nbsp;<span class="op" id="4830290">-=</span>&nbsp;<span class="num" id="4830293">4</span>&nbsp;<span class="comment" id="4830295">//&nbsp;arm,&nbsp;etc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830321">file</span><span class="op" id="4830325">,</span>&nbsp;<span class="ident" id="4830327">line</span>&nbsp;<span class="op" id="4830332">:=</span>&nbsp;<span class="ident" id="4830335">f</span><span class="op" id="4830336">.</span><span class="ident" id="4830337">FileLine</span><span class="op" id="4830345">(</span><span class="ident" id="4830346">tracepc</span><span class="op" id="4830353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830358">name</span>&nbsp;<span class="op" id="4830363">:=</span>&nbsp;<span class="ident" id="4830366">f</span><span class="op" id="4830367">.</span><span class="ident" id="4830368">Name</span><span class="op" id="4830372">(</span><span class="op" id="4830373">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830378">//&nbsp;Hide&nbsp;runtime.goexit&nbsp;and&nbsp;any&nbsp;runtime&nbsp;functions&nbsp;at&nbsp;the&nbsp;beginning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830448">//&nbsp;This&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;allocation&nbsp;traces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830499">wasPanic</span>&nbsp;<span class="op" id="4830508">=</span>&nbsp;<span class="ident" id="4830510">name</span>&nbsp;<span class="op" id="4830515">==</span>&nbsp;<span class="string" id="4830518">&#34;runtime.panic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830537">if</span>&nbsp;<span class="ident" id="4830540">name</span>&nbsp;<span class="op" id="4830545">==</span>&nbsp;<span class="string" id="4830548">&#34;runtime.goexit&#34;</span>&nbsp;<span class="op" id="4830565">||</span>&nbsp;<span class="op" id="4830568">!</span><span class="ident" id="4830569">show</span>&nbsp;<span class="op" id="4830574">&amp;&amp;</span>&nbsp;<span class="ident" id="4830577">strings</span><span class="op" id="4830584">.</span><span class="ident" id="4830585">HasPrefix</span><span class="op" id="4830594">(</span><span class="ident" id="4830595">name</span><span class="op" id="4830599">,</span>&nbsp;<span class="string" id="4830601">&#34;runtime.&#34;</span><span class="op" id="4830611">)</span>&nbsp;<span class="op" id="4830613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830619">continue</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830636">show</span>&nbsp;<span class="op" id="4830641">=</span>&nbsp;<span class="ident" id="4830643">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830651">fmt</span><span class="op" id="4830654">.</span><span class="ident" id="4830655">Fprintf</span><span class="op" id="4830662">(</span><span class="ident" id="4830663">w</span><span class="op" id="4830664">,</span>&nbsp;<span class="string" id="4830666">&#34;#\t%#x\t%s+%#x\t%s:%d\n&#34;</span><span class="op" id="4830691">,</span>&nbsp;<span class="ident" id="4830693">pc</span><span class="op" id="4830695">,</span>&nbsp;<span class="ident" id="4830697">name</span><span class="op" id="4830701">,</span>&nbsp;<span class="ident" id="4830703">pc</span><span class="op" id="4830705">-</span><span class="ident" id="4830706">f</span><span class="op" id="4830707">.</span><span class="ident" id="4830708">Entry</span><span class="op" id="4830713">(</span><span class="op" id="4830714">)</span><span class="op" id="4830715">,</span>&nbsp;<span class="ident" id="4830717">file</span><span class="op" id="4830721">,</span>&nbsp;<span class="ident" id="4830723">line</span><span class="op" id="4830727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830734">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830737">if</span>&nbsp;<span class="op" id="4830740">!</span><span class="ident" id="4830741">show</span>&nbsp;<span class="op" id="4830746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830750">//&nbsp;We&nbsp;didn&#39;t&nbsp;print&nbsp;anything;&nbsp;do&nbsp;it&nbsp;again,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830794">//&nbsp;and&nbsp;this&nbsp;time&nbsp;include&nbsp;runtime&nbsp;functions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830840">printStackRecord</span><span class="op" id="4830856">(</span><span class="ident" id="4830857">w</span><span class="op" id="4830858">,</span>&nbsp;<span class="ident" id="4830860">stk</span><span class="op" id="4830863">,</span>&nbsp;<span class="ident" id="4830865">true</span><span class="op" id="4830869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830873">return</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830884">fmt</span><span class="op" id="4830887">.</span><span class="ident" id="4830888">Fprintf</span><span class="op" id="4830895">(</span><span class="ident" id="4830896">w</span><span class="op" id="4830897">,</span>&nbsp;<span class="string" id="4830899">&#34;\n&#34;</span><span class="op" id="4830903">)</span><br>
<span class="lineno"></span><span class="op" id="4830905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4830908">//&nbsp;Interface&nbsp;to&nbsp;system&nbsp;profiles.</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="4830942">type</span>&nbsp;<span class="ident" id="4830947">byInUseBytes</span>&nbsp;<span class="op" id="4830960">[</span><span class="op" id="4830961">]</span><span class="ident" id="4830962">runtime</span><span class="op" id="4830969">.</span><span class="ident" id="4830970">MemProfileRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4830988">func</span>&nbsp;<span class="op" id="4830993">(</span><span class="ident" id="4830994">x</span>&nbsp;<span class="ident" id="4830996">byInUseBytes</span><span class="op" id="4831008">)</span>&nbsp;<span class="ident" id="4831010">Len</span><span class="op" id="4831013">(</span><span class="op" id="4831014">)</span>&nbsp;<span class="builtintype" id="4831016">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831030">{</span>&nbsp;<span class="keyword" id="4831032">return</span>&nbsp;<span class="builtinfunc" id="4831039">len</span><span class="op" id="4831042">(</span><span class="ident" id="4831043">x</span><span class="op" id="4831044">)</span>&nbsp;<span class="op" id="4831046">}</span><br>
<span class="lineno"></span><span class="keyword" id="4831048">func</span>&nbsp;<span class="op" id="4831053">(</span><span class="ident" id="4831054">x</span>&nbsp;<span class="ident" id="4831056">byInUseBytes</span><span class="op" id="4831068">)</span>&nbsp;<span class="ident" id="4831070">Swap</span><span class="op" id="4831074">(</span><span class="ident" id="4831075">i</span><span class="op" id="4831076">,</span>&nbsp;<span class="ident" id="4831078">j</span>&nbsp;<span class="builtintype" id="4831080">int</span><span class="op" id="4831083">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831090">{</span>&nbsp;<span class="ident" id="4831092">x</span><span class="op" id="4831093">[</span><span class="ident" id="4831094">i</span><span class="op" id="4831095">]</span><span class="op" id="4831096">,</span>&nbsp;<span class="ident" id="4831098">x</span><span class="op" id="4831099">[</span><span class="ident" id="4831100">j</span><span class="op" id="4831101">]</span>&nbsp;<span class="op" id="4831103">=</span>&nbsp;<span class="ident" id="4831105">x</span><span class="op" id="4831106">[</span><span class="ident" id="4831107">j</span><span class="op" id="4831108">]</span><span class="op" id="4831109">,</span>&nbsp;<span class="ident" id="4831111">x</span><span class="op" id="4831112">[</span><span class="ident" id="4831113">i</span><span class="op" id="4831114">]</span>&nbsp;<span class="op" id="4831116">}</span><br>
<span class="lineno">365</span><span class="keyword" id="4831118">func</span>&nbsp;<span class="op" id="4831123">(</span><span class="ident" id="4831124">x</span>&nbsp;<span class="ident" id="4831126">byInUseBytes</span><span class="op" id="4831138">)</span>&nbsp;<span class="ident" id="4831140">Less</span><span class="op" id="4831144">(</span><span class="ident" id="4831145">i</span><span class="op" id="4831146">,</span>&nbsp;<span class="ident" id="4831148">j</span>&nbsp;<span class="builtintype" id="4831150">int</span><span class="op" id="4831153">)</span>&nbsp;<span class="builtintype" id="4831155">bool</span>&nbsp;<span class="op" id="4831160">{</span>&nbsp;<span class="keyword" id="4831162">return</span>&nbsp;<span class="ident" id="4831169">x</span><span class="op" id="4831170">[</span><span class="ident" id="4831171">i</span><span class="op" id="4831172">]</span><span class="op" id="4831173">.</span><span class="ident" id="4831174">InUseBytes</span><span class="op" id="4831184">(</span><span class="op" id="4831185">)</span>&nbsp;<span class="op" id="4831187">&gt;</span>&nbsp;<span class="ident" id="4831189">x</span><span class="op" id="4831190">[</span><span class="ident" id="4831191">j</span><span class="op" id="4831192">]</span><span class="op" id="4831193">.</span><span class="ident" id="4831194">InUseBytes</span><span class="op" id="4831204">(</span><span class="op" id="4831205">)</span>&nbsp;<span class="op" id="4831207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4831210">//&nbsp;WriteHeapProfile&nbsp;is&nbsp;shorthand&nbsp;for&nbsp;Lookup(&#34;heap&#34;).WriteTo(w,&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="4831277">//&nbsp;It&nbsp;is&nbsp;preserved&nbsp;for&nbsp;backwards&nbsp;compatibility.</span><br>
<span class="lineno"></span><span class="keyword" id="4831325">func</span>&nbsp;<span class="ident" id="4831330">WriteHeapProfile</span><span class="op" id="4831346">(</span><span class="ident" id="4831347">w</span>&nbsp;<span class="ident" id="4831349">io</span><span class="op" id="4831351">.</span><span class="ident" id="4831352">Writer</span><span class="op" id="4831358">)</span>&nbsp;<span class="builtintype" id="4831360">error</span>&nbsp;<span class="op" id="4831366">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831369">return</span>&nbsp;<span class="ident" id="4831376">writeHeap</span><span class="op" id="4831385">(</span><span class="ident" id="4831386">w</span><span class="op" id="4831387">,</span>&nbsp;<span class="num" id="4831389">0</span><span class="op" id="4831390">)</span><br>
<span class="lineno"></span><span class="op" id="4831392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4831395">//&nbsp;countHeap&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;heap&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4831459">func</span>&nbsp;<span class="ident" id="4831464">countHeap</span><span class="op" id="4831473">(</span><span class="op" id="4831474">)</span>&nbsp;<span class="builtintype" id="4831476">int</span>&nbsp;<span class="op" id="4831480">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831483">n</span><span class="op" id="4831484">,</span>&nbsp;<span class="ident" id="4831486">_</span>&nbsp;<span class="op" id="4831488">:=</span>&nbsp;<span class="ident" id="4831491">runtime</span><span class="op" id="4831498">.</span><span class="ident" id="4831499">MemProfile</span><span class="op" id="4831509">(</span><span class="ident" id="4831510">nil</span><span class="op" id="4831513">,</span>&nbsp;<span class="ident" id="4831515">true</span><span class="op" id="4831519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831522">return</span>&nbsp;<span class="ident" id="4831529">n</span><br>
<span class="lineno"></span><span class="op" id="4831531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4831534">//&nbsp;writeHeap&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;heap&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno">380</span><span class="keyword" id="4831593">func</span>&nbsp;<span class="ident" id="4831598">writeHeap</span><span class="op" id="4831607">(</span><span class="ident" id="4831608">w</span>&nbsp;<span class="ident" id="4831610">io</span><span class="op" id="4831612">.</span><span class="ident" id="4831613">Writer</span><span class="op" id="4831619">,</span>&nbsp;<span class="ident" id="4831621">debug</span>&nbsp;<span class="builtintype" id="4831627">int</span><span class="op" id="4831630">)</span>&nbsp;<span class="builtintype" id="4831632">error</span>&nbsp;<span class="op" id="4831638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4831641">//&nbsp;Find&nbsp;out&nbsp;how&nbsp;many&nbsp;records&nbsp;there&nbsp;are&nbsp;(MemProfile(nil,&nbsp;true)),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4831706">//&nbsp;allocate&nbsp;that&nbsp;many&nbsp;records,&nbsp;and&nbsp;get&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4831756">//&nbsp;There&#39;s&nbsp;a&nbsp;race—more&nbsp;records&nbsp;might&nbsp;be&nbsp;added&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4831813">//&nbsp;the&nbsp;two&nbsp;calls—so&nbsp;allocate&nbsp;a&nbsp;few&nbsp;extra&nbsp;records&nbsp;for&nbsp;safety</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4831876">//&nbsp;and&nbsp;also&nbsp;try&nbsp;again&nbsp;if&nbsp;we&#39;re&nbsp;very&nbsp;unlucky.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4831922">//&nbsp;The&nbsp;loop&nbsp;should&nbsp;only&nbsp;execute&nbsp;one&nbsp;iteration&nbsp;in&nbsp;the&nbsp;common&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831989">var</span>&nbsp;<span class="ident" id="4831993">p</span>&nbsp;<span class="op" id="4831995">[</span><span class="op" id="4831996">]</span><span class="ident" id="4831997">runtime</span><span class="op" id="4832004">.</span><span class="ident" id="4832005">MemProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832023">n</span><span class="op" id="4832024">,</span>&nbsp;<span class="ident" id="4832026">ok</span>&nbsp;<span class="op" id="4832029">:=</span>&nbsp;<span class="ident" id="4832032">runtime</span><span class="op" id="4832039">.</span><span class="ident" id="4832040">MemProfile</span><span class="op" id="4832050">(</span><span class="ident" id="4832051">nil</span><span class="op" id="4832054">,</span>&nbsp;<span class="ident" id="4832056">true</span><span class="op" id="4832060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832063">for</span>&nbsp;<span class="op" id="4832067">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4832071">//&nbsp;Allocate&nbsp;room&nbsp;for&nbsp;a&nbsp;slightly&nbsp;bigger&nbsp;profile,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4832121">//&nbsp;in&nbsp;case&nbsp;a&nbsp;few&nbsp;more&nbsp;entries&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4832169">//&nbsp;since&nbsp;the&nbsp;call&nbsp;to&nbsp;MemProfile.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832204">p</span>&nbsp;<span class="op" id="4832206">=</span>&nbsp;<span class="builtinfunc" id="4832208">make</span><span class="op" id="4832212">(</span><span class="op" id="4832213">[</span><span class="op" id="4832214">]</span><span class="ident" id="4832215">runtime</span><span class="op" id="4832222">.</span><span class="ident" id="4832223">MemProfileRecord</span><span class="op" id="4832239">,</span>&nbsp;<span class="ident" id="4832241">n</span><span class="op" id="4832242">+</span><span class="num" id="4832243">50</span><span class="op" id="4832245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832249">n</span><span class="op" id="4832250">,</span>&nbsp;<span class="ident" id="4832252">ok</span>&nbsp;<span class="op" id="4832255">=</span>&nbsp;<span class="ident" id="4832257">runtime</span><span class="op" id="4832264">.</span><span class="ident" id="4832265">MemProfile</span><span class="op" id="4832275">(</span><span class="ident" id="4832276">p</span><span class="op" id="4832277">,</span>&nbsp;<span class="ident" id="4832279">true</span><span class="op" id="4832283">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832287">if</span>&nbsp;<span class="ident" id="4832290">ok</span>&nbsp;<span class="op" id="4832293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832298">p</span>&nbsp;<span class="op" id="4832300">=</span>&nbsp;<span class="ident" id="4832302">p</span><span class="op" id="4832303">[</span><span class="num" id="4832304">0</span><span class="op" id="4832305">:</span><span class="ident" id="4832306">n</span><span class="op" id="4832307">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832312">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4832320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4832324">//&nbsp;Profile&nbsp;grew;&nbsp;try&nbsp;again.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4832353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832357">sort</span><span class="op" id="4832361">.</span><span class="ident" id="4832362">Sort</span><span class="op" id="4832366">(</span><span class="ident" id="4832367">byInUseBytes</span><span class="op" id="4832379">(</span><span class="ident" id="4832380">p</span><span class="op" id="4832381">)</span><span class="op" id="4832382">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832386">b</span>&nbsp;<span class="op" id="4832388">:=</span>&nbsp;<span class="ident" id="4832391">bufio</span><span class="op" id="4832396">.</span><span class="ident" id="4832397">NewWriter</span><span class="op" id="4832406">(</span><span class="ident" id="4832407">w</span><span class="op" id="4832408">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832411">var</span>&nbsp;<span class="ident" id="4832415">tw</span>&nbsp;<span class="op" id="4832418">*</span><span class="ident" id="4832419">tabwriter</span><span class="op" id="4832428">.</span><span class="ident" id="4832429">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832437">w</span>&nbsp;<span class="op" id="4832439">=</span>&nbsp;<span class="ident" id="4832441">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832444">if</span>&nbsp;<span class="ident" id="4832447">debug</span>&nbsp;<span class="op" id="4832453">&gt;</span>&nbsp;<span class="num" id="4832455">0</span>&nbsp;<span class="op" id="4832457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832461">tw</span>&nbsp;<span class="op" id="4832464">=</span>&nbsp;<span class="ident" id="4832466">tabwriter</span><span class="op" id="4832475">.</span><span class="ident" id="4832476">NewWriter</span><span class="op" id="4832485">(</span><span class="ident" id="4832486">w</span><span class="op" id="4832487">,</span>&nbsp;<span class="num" id="4832489">1</span><span class="op" id="4832490">,</span>&nbsp;<span class="num" id="4832492">8</span><span class="op" id="4832493">,</span>&nbsp;<span class="num" id="4832495">1</span><span class="op" id="4832496">,</span>&nbsp;<span class="string" id="4832498">&#39;\t&#39;</span><span class="op" id="4832502">,</span>&nbsp;<span class="num" id="4832504">0</span><span class="op" id="4832505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832509">w</span>&nbsp;<span class="op" id="4832511">=</span>&nbsp;<span class="ident" id="4832513">tw</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4832517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832521">var</span>&nbsp;<span class="ident" id="4832525">total</span>&nbsp;<span class="ident" id="4832531">runtime</span><span class="op" id="4832538">.</span><span class="ident" id="4832539">MemProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832557">for</span>&nbsp;<span class="ident" id="4832561">i</span>&nbsp;<span class="op" id="4832563">:=</span>&nbsp;<span class="keyword" id="4832566">range</span>&nbsp;<span class="ident" id="4832572">p</span>&nbsp;<span class="op" id="4832574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832578">r</span>&nbsp;<span class="op" id="4832580">:=</span>&nbsp;<span class="op" id="4832583">&amp;</span><span class="ident" id="4832584">p</span><span class="op" id="4832585">[</span><span class="ident" id="4832586">i</span><span class="op" id="4832587">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832591">total</span><span class="op" id="4832596">.</span><span class="ident" id="4832597">AllocBytes</span>&nbsp;<span class="op" id="4832608">+=</span>&nbsp;<span class="ident" id="4832611">r</span><span class="op" id="4832612">.</span><span class="ident" id="4832613">AllocBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832626">total</span><span class="op" id="4832631">.</span><span class="ident" id="4832632">AllocObjects</span>&nbsp;<span class="op" id="4832645">+=</span>&nbsp;<span class="ident" id="4832648">r</span><span class="op" id="4832649">.</span><span class="ident" id="4832650">AllocObjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832665">total</span><span class="op" id="4832670">.</span><span class="ident" id="4832671">FreeBytes</span>&nbsp;<span class="op" id="4832681">+=</span>&nbsp;<span class="ident" id="4832684">r</span><span class="op" id="4832685">.</span><span class="ident" id="4832686">FreeBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832698">total</span><span class="op" id="4832703">.</span><span class="ident" id="4832704">FreeObjects</span>&nbsp;<span class="op" id="4832716">+=</span>&nbsp;<span class="ident" id="4832719">r</span><span class="op" id="4832720">.</span><span class="ident" id="4832721">FreeObjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4832734">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4832738">//&nbsp;Technically&nbsp;the&nbsp;rate&nbsp;is&nbsp;MemProfileRate&nbsp;not&nbsp;2*MemProfileRate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4832803">//&nbsp;but&nbsp;early&nbsp;versions&nbsp;of&nbsp;the&nbsp;C++&nbsp;heap&nbsp;profiler&nbsp;reported&nbsp;2*MemProfileRate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4832878">//&nbsp;so&nbsp;that&#39;s&nbsp;what&nbsp;pprof&nbsp;has&nbsp;come&nbsp;to&nbsp;expect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832923">fmt</span><span class="op" id="4832926">.</span><span class="ident" id="4832927">Fprintf</span><span class="op" id="4832934">(</span><span class="ident" id="4832935">w</span><span class="op" id="4832936">,</span>&nbsp;<span class="string" id="4832938">&#34;heap&nbsp;profile:&nbsp;%d:&nbsp;%d&nbsp;[%d:&nbsp;%d]&nbsp;@&nbsp;heap/%d\n&#34;</span><span class="op" id="4832981">,</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832985">total</span><span class="op" id="4832990">.</span><span class="ident" id="4832991">InUseObjects</span><span class="op" id="4833003">(</span><span class="op" id="4833004">)</span><span class="op" id="4833005">,</span>&nbsp;<span class="ident" id="4833007">total</span><span class="op" id="4833012">.</span><span class="ident" id="4833013">InUseBytes</span><span class="op" id="4833023">(</span><span class="op" id="4833024">)</span><span class="op" id="4833025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833029">total</span><span class="op" id="4833034">.</span><span class="ident" id="4833035">AllocObjects</span><span class="op" id="4833047">,</span>&nbsp;<span class="ident" id="4833049">total</span><span class="op" id="4833054">.</span><span class="ident" id="4833055">AllocBytes</span><span class="op" id="4833065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4833069">2</span><span class="op" id="4833070">*</span><span class="ident" id="4833071">runtime</span><span class="op" id="4833078">.</span><span class="ident" id="4833079">MemProfileRate</span><span class="op" id="4833093">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833097">for</span>&nbsp;<span class="ident" id="4833101">i</span>&nbsp;<span class="op" id="4833103">:=</span>&nbsp;<span class="keyword" id="4833106">range</span>&nbsp;<span class="ident" id="4833112">p</span>&nbsp;<span class="op" id="4833114">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833118">r</span>&nbsp;<span class="op" id="4833120">:=</span>&nbsp;<span class="op" id="4833123">&amp;</span><span class="ident" id="4833124">p</span><span class="op" id="4833125">[</span><span class="ident" id="4833126">i</span><span class="op" id="4833127">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833131">fmt</span><span class="op" id="4833134">.</span><span class="ident" id="4833135">Fprintf</span><span class="op" id="4833142">(</span><span class="ident" id="4833143">w</span><span class="op" id="4833144">,</span>&nbsp;<span class="string" id="4833146">&#34;%d:&nbsp;%d&nbsp;[%d:&nbsp;%d]&nbsp;@&#34;</span><span class="op" id="4833165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833170">r</span><span class="op" id="4833171">.</span><span class="ident" id="4833172">InUseObjects</span><span class="op" id="4833184">(</span><span class="op" id="4833185">)</span><span class="op" id="4833186">,</span>&nbsp;<span class="ident" id="4833188">r</span><span class="op" id="4833189">.</span><span class="ident" id="4833190">InUseBytes</span><span class="op" id="4833200">(</span><span class="op" id="4833201">)</span><span class="op" id="4833202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833207">r</span><span class="op" id="4833208">.</span><span class="ident" id="4833209">AllocObjects</span><span class="op" id="4833221">,</span>&nbsp;<span class="ident" id="4833223">r</span><span class="op" id="4833224">.</span><span class="ident" id="4833225">AllocBytes</span><span class="op" id="4833235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833239">for</span>&nbsp;<span class="ident" id="4833243">_</span><span class="op" id="4833244">,</span>&nbsp;<span class="ident" id="4833246">pc</span>&nbsp;<span class="op" id="4833249">:=</span>&nbsp;<span class="keyword" id="4833252">range</span>&nbsp;<span class="ident" id="4833258">r</span><span class="op" id="4833259">.</span><span class="ident" id="4833260">Stack</span><span class="op" id="4833265">(</span><span class="op" id="4833266">)</span>&nbsp;<span class="op" id="4833268">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833273">fmt</span><span class="op" id="4833276">.</span><span class="ident" id="4833277">Fprintf</span><span class="op" id="4833284">(</span><span class="ident" id="4833285">w</span><span class="op" id="4833286">,</span>&nbsp;<span class="string" id="4833288">&#34;&nbsp;%#x&#34;</span><span class="op" id="4833294">,</span>&nbsp;<span class="ident" id="4833296">pc</span><span class="op" id="4833298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833306">fmt</span><span class="op" id="4833309">.</span><span class="ident" id="4833310">Fprintf</span><span class="op" id="4833317">(</span><span class="ident" id="4833318">w</span><span class="op" id="4833319">,</span>&nbsp;<span class="string" id="4833321">&#34;\n&#34;</span><span class="op" id="4833325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833329">if</span>&nbsp;<span class="ident" id="4833332">debug</span>&nbsp;<span class="op" id="4833338">&gt;</span>&nbsp;<span class="num" id="4833340">0</span>&nbsp;<span class="op" id="4833342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833347">printStackRecord</span><span class="op" id="4833363">(</span><span class="ident" id="4833364">w</span><span class="op" id="4833365">,</span>&nbsp;<span class="ident" id="4833367">r</span><span class="op" id="4833368">.</span><span class="ident" id="4833369">Stack</span><span class="op" id="4833374">(</span><span class="op" id="4833375">)</span><span class="op" id="4833376">,</span>&nbsp;<span class="ident" id="4833378">false</span><span class="op" id="4833383">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4833394">//&nbsp;Print&nbsp;memstats&nbsp;information&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4833430">//&nbsp;Pprof&nbsp;will&nbsp;ignore,&nbsp;but&nbsp;useful&nbsp;for&nbsp;people</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833475">if</span>&nbsp;<span class="ident" id="4833478">debug</span>&nbsp;<span class="op" id="4833484">&gt;</span>&nbsp;<span class="num" id="4833486">0</span>&nbsp;<span class="op" id="4833488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833492">s</span>&nbsp;<span class="op" id="4833494">:=</span>&nbsp;<span class="builtinfunc" id="4833497">new</span><span class="op" id="4833500">(</span><span class="ident" id="4833501">runtime</span><span class="op" id="4833508">.</span><span class="ident" id="4833509">MemStats</span><span class="op" id="4833517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833521">runtime</span><span class="op" id="4833528">.</span><span class="ident" id="4833529">ReadMemStats</span><span class="op" id="4833541">(</span><span class="ident" id="4833542">s</span><span class="op" id="4833543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833547">fmt</span><span class="op" id="4833550">.</span><span class="ident" id="4833551">Fprintf</span><span class="op" id="4833558">(</span><span class="ident" id="4833559">w</span><span class="op" id="4833560">,</span>&nbsp;<span class="string" id="4833562">&#34;\n#&nbsp;runtime.MemStats\n&#34;</span><span class="op" id="4833586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833590">fmt</span><span class="op" id="4833593">.</span><span class="ident" id="4833594">Fprintf</span><span class="op" id="4833601">(</span><span class="ident" id="4833602">w</span><span class="op" id="4833603">,</span>&nbsp;<span class="string" id="4833605">&#34;#&nbsp;Alloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4833621">,</span>&nbsp;<span class="ident" id="4833623">s</span><span class="op" id="4833624">.</span><span class="ident" id="4833625">Alloc</span><span class="op" id="4833630">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833634">fmt</span><span class="op" id="4833637">.</span><span class="ident" id="4833638">Fprintf</span><span class="op" id="4833645">(</span><span class="ident" id="4833646">w</span><span class="op" id="4833647">,</span>&nbsp;<span class="string" id="4833649">&#34;#&nbsp;TotalAlloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4833670">,</span>&nbsp;<span class="ident" id="4833672">s</span><span class="op" id="4833673">.</span><span class="ident" id="4833674">TotalAlloc</span><span class="op" id="4833684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833688">fmt</span><span class="op" id="4833691">.</span><span class="ident" id="4833692">Fprintf</span><span class="op" id="4833699">(</span><span class="ident" id="4833700">w</span><span class="op" id="4833701">,</span>&nbsp;<span class="string" id="4833703">&#34;#&nbsp;Sys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4833717">,</span>&nbsp;<span class="ident" id="4833719">s</span><span class="op" id="4833720">.</span><span class="ident" id="4833721">Sys</span><span class="op" id="4833724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833728">fmt</span><span class="op" id="4833731">.</span><span class="ident" id="4833732">Fprintf</span><span class="op" id="4833739">(</span><span class="ident" id="4833740">w</span><span class="op" id="4833741">,</span>&nbsp;<span class="string" id="4833743">&#34;#&nbsp;Lookups&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4833761">,</span>&nbsp;<span class="ident" id="4833763">s</span><span class="op" id="4833764">.</span><span class="ident" id="4833765">Lookups</span><span class="op" id="4833772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833776">fmt</span><span class="op" id="4833779">.</span><span class="ident" id="4833780">Fprintf</span><span class="op" id="4833787">(</span><span class="ident" id="4833788">w</span><span class="op" id="4833789">,</span>&nbsp;<span class="string" id="4833791">&#34;#&nbsp;Mallocs&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4833809">,</span>&nbsp;<span class="ident" id="4833811">s</span><span class="op" id="4833812">.</span><span class="ident" id="4833813">Mallocs</span><span class="op" id="4833820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833824">fmt</span><span class="op" id="4833827">.</span><span class="ident" id="4833828">Fprintf</span><span class="op" id="4833835">(</span><span class="ident" id="4833836">w</span><span class="op" id="4833837">,</span>&nbsp;<span class="string" id="4833839">&#34;#&nbsp;Frees&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4833855">,</span>&nbsp;<span class="ident" id="4833857">s</span><span class="op" id="4833858">.</span><span class="ident" id="4833859">Frees</span><span class="op" id="4833864">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833869">fmt</span><span class="op" id="4833872">.</span><span class="ident" id="4833873">Fprintf</span><span class="op" id="4833880">(</span><span class="ident" id="4833881">w</span><span class="op" id="4833882">,</span>&nbsp;<span class="string" id="4833884">&#34;#&nbsp;HeapAlloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4833904">,</span>&nbsp;<span class="ident" id="4833906">s</span><span class="op" id="4833907">.</span><span class="ident" id="4833908">HeapAlloc</span><span class="op" id="4833917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833921">fmt</span><span class="op" id="4833924">.</span><span class="ident" id="4833925">Fprintf</span><span class="op" id="4833932">(</span><span class="ident" id="4833933">w</span><span class="op" id="4833934">,</span>&nbsp;<span class="string" id="4833936">&#34;#&nbsp;HeapSys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4833954">,</span>&nbsp;<span class="ident" id="4833956">s</span><span class="op" id="4833957">.</span><span class="ident" id="4833958">HeapSys</span><span class="op" id="4833965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833969">fmt</span><span class="op" id="4833972">.</span><span class="ident" id="4833973">Fprintf</span><span class="op" id="4833980">(</span><span class="ident" id="4833981">w</span><span class="op" id="4833982">,</span>&nbsp;<span class="string" id="4833984">&#34;#&nbsp;HeapIdle&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4834003">,</span>&nbsp;<span class="ident" id="4834005">s</span><span class="op" id="4834006">.</span><span class="ident" id="4834007">HeapIdle</span><span class="op" id="4834015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834019">fmt</span><span class="op" id="4834022">.</span><span class="ident" id="4834023">Fprintf</span><span class="op" id="4834030">(</span><span class="ident" id="4834031">w</span><span class="op" id="4834032">,</span>&nbsp;<span class="string" id="4834034">&#34;#&nbsp;HeapInuse&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4834054">,</span>&nbsp;<span class="ident" id="4834056">s</span><span class="op" id="4834057">.</span><span class="ident" id="4834058">HeapInuse</span><span class="op" id="4834067">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834071">fmt</span><span class="op" id="4834074">.</span><span class="ident" id="4834075">Fprintf</span><span class="op" id="4834082">(</span><span class="ident" id="4834083">w</span><span class="op" id="4834084">,</span>&nbsp;<span class="string" id="4834086">&#34;#&nbsp;HeapReleased&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4834109">,</span>&nbsp;<span class="ident" id="4834111">s</span><span class="op" id="4834112">.</span><span class="ident" id="4834113">HeapReleased</span><span class="op" id="4834125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834129">fmt</span><span class="op" id="4834132">.</span><span class="ident" id="4834133">Fprintf</span><span class="op" id="4834140">(</span><span class="ident" id="4834141">w</span><span class="op" id="4834142">,</span>&nbsp;<span class="string" id="4834144">&#34;#&nbsp;HeapObjects&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4834166">,</span>&nbsp;<span class="ident" id="4834168">s</span><span class="op" id="4834169">.</span><span class="ident" id="4834170">HeapObjects</span><span class="op" id="4834181">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834186">fmt</span><span class="op" id="4834189">.</span><span class="ident" id="4834190">Fprintf</span><span class="op" id="4834197">(</span><span class="ident" id="4834198">w</span><span class="op" id="4834199">,</span>&nbsp;<span class="string" id="4834201">&#34;#&nbsp;Stack&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="4834222">,</span>&nbsp;<span class="ident" id="4834224">s</span><span class="op" id="4834225">.</span><span class="ident" id="4834226">StackInuse</span><span class="op" id="4834236">,</span>&nbsp;<span class="ident" id="4834238">s</span><span class="op" id="4834239">.</span><span class="ident" id="4834240">StackSys</span><span class="op" id="4834248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834252">fmt</span><span class="op" id="4834255">.</span><span class="ident" id="4834256">Fprintf</span><span class="op" id="4834263">(</span><span class="ident" id="4834264">w</span><span class="op" id="4834265">,</span>&nbsp;<span class="string" id="4834267">&#34;#&nbsp;MSpan&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="4834288">,</span>&nbsp;<span class="ident" id="4834290">s</span><span class="op" id="4834291">.</span><span class="ident" id="4834292">MSpanInuse</span><span class="op" id="4834302">,</span>&nbsp;<span class="ident" id="4834304">s</span><span class="op" id="4834305">.</span><span class="ident" id="4834306">MSpanSys</span><span class="op" id="4834314">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834318">fmt</span><span class="op" id="4834321">.</span><span class="ident" id="4834322">Fprintf</span><span class="op" id="4834329">(</span><span class="ident" id="4834330">w</span><span class="op" id="4834331">,</span>&nbsp;<span class="string" id="4834333">&#34;#&nbsp;MCache&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="4834355">,</span>&nbsp;<span class="ident" id="4834357">s</span><span class="op" id="4834358">.</span><span class="ident" id="4834359">MCacheInuse</span><span class="op" id="4834370">,</span>&nbsp;<span class="ident" id="4834372">s</span><span class="op" id="4834373">.</span><span class="ident" id="4834374">MCacheSys</span><span class="op" id="4834383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834387">fmt</span><span class="op" id="4834390">.</span><span class="ident" id="4834391">Fprintf</span><span class="op" id="4834398">(</span><span class="ident" id="4834399">w</span><span class="op" id="4834400">,</span>&nbsp;<span class="string" id="4834402">&#34;#&nbsp;BuckHashSys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4834424">,</span>&nbsp;<span class="ident" id="4834426">s</span><span class="op" id="4834427">.</span><span class="ident" id="4834428">BuckHashSys</span><span class="op" id="4834439">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834444">fmt</span><span class="op" id="4834447">.</span><span class="ident" id="4834448">Fprintf</span><span class="op" id="4834455">(</span><span class="ident" id="4834456">w</span><span class="op" id="4834457">,</span>&nbsp;<span class="string" id="4834459">&#34;#&nbsp;NextGC&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4834476">,</span>&nbsp;<span class="ident" id="4834478">s</span><span class="op" id="4834479">.</span><span class="ident" id="4834480">NextGC</span><span class="op" id="4834486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834490">fmt</span><span class="op" id="4834493">.</span><span class="ident" id="4834494">Fprintf</span><span class="op" id="4834501">(</span><span class="ident" id="4834502">w</span><span class="op" id="4834503">,</span>&nbsp;<span class="string" id="4834505">&#34;#&nbsp;PauseNs&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4834523">,</span>&nbsp;<span class="ident" id="4834525">s</span><span class="op" id="4834526">.</span><span class="ident" id="4834527">PauseNs</span><span class="op" id="4834534">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834538">fmt</span><span class="op" id="4834541">.</span><span class="ident" id="4834542">Fprintf</span><span class="op" id="4834549">(</span><span class="ident" id="4834550">w</span><span class="op" id="4834551">,</span>&nbsp;<span class="string" id="4834553">&#34;#&nbsp;NumGC&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4834569">,</span>&nbsp;<span class="ident" id="4834571">s</span><span class="op" id="4834572">.</span><span class="ident" id="4834573">NumGC</span><span class="op" id="4834578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834582">fmt</span><span class="op" id="4834585">.</span><span class="ident" id="4834586">Fprintf</span><span class="op" id="4834593">(</span><span class="ident" id="4834594">w</span><span class="op" id="4834595">,</span>&nbsp;<span class="string" id="4834597">&#34;#&nbsp;EnableGC&nbsp;=&nbsp;%v\n&#34;</span><span class="op" id="4834616">,</span>&nbsp;<span class="ident" id="4834618">s</span><span class="op" id="4834619">.</span><span class="ident" id="4834620">EnableGC</span><span class="op" id="4834628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834632">fmt</span><span class="op" id="4834635">.</span><span class="ident" id="4834636">Fprintf</span><span class="op" id="4834643">(</span><span class="ident" id="4834644">w</span><span class="op" id="4834645">,</span>&nbsp;<span class="string" id="4834647">&#34;#&nbsp;DebugGC&nbsp;=&nbsp;%v\n&#34;</span><span class="op" id="4834665">,</span>&nbsp;<span class="ident" id="4834667">s</span><span class="op" id="4834668">.</span><span class="ident" id="4834669">DebugGC</span><span class="op" id="4834676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834683">if</span>&nbsp;<span class="ident" id="4834686">tw</span>&nbsp;<span class="op" id="4834689">!=</span>&nbsp;<span class="ident" id="4834692">nil</span>&nbsp;<span class="op" id="4834696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834700">tw</span><span class="op" id="4834702">.</span><span class="ident" id="4834703">Flush</span><span class="op" id="4834708">(</span><span class="op" id="4834709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834715">return</span>&nbsp;<span class="ident" id="4834722">b</span><span class="op" id="4834723">.</span><span class="ident" id="4834724">Flush</span><span class="op" id="4834729">(</span><span class="op" id="4834730">)</span><br>
<span class="lineno"></span><span class="op" id="4834732">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="4834735">//&nbsp;countThreadCreate&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;current&nbsp;ThreadCreateProfile.</span><br>
<span class="lineno"></span><span class="keyword" id="4834809">func</span>&nbsp;<span class="ident" id="4834814">countThreadCreate</span><span class="op" id="4834831">(</span><span class="op" id="4834832">)</span>&nbsp;<span class="builtintype" id="4834834">int</span>&nbsp;<span class="op" id="4834838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834841">n</span><span class="op" id="4834842">,</span>&nbsp;<span class="ident" id="4834844">_</span>&nbsp;<span class="op" id="4834846">:=</span>&nbsp;<span class="ident" id="4834849">runtime</span><span class="op" id="4834856">.</span><span class="ident" id="4834857">ThreadCreateProfile</span><span class="op" id="4834876">(</span><span class="ident" id="4834877">nil</span><span class="op" id="4834880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834883">return</span>&nbsp;<span class="ident" id="4834890">n</span><br>
<span class="lineno">485</span><span class="op" id="4834892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4834895">//&nbsp;writeThreadCreate&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;ThreadCreateProfile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4834969">func</span>&nbsp;<span class="ident" id="4834974">writeThreadCreate</span><span class="op" id="4834991">(</span><span class="ident" id="4834992">w</span>&nbsp;<span class="ident" id="4834994">io</span><span class="op" id="4834996">.</span><span class="ident" id="4834997">Writer</span><span class="op" id="4835003">,</span>&nbsp;<span class="ident" id="4835005">debug</span>&nbsp;<span class="builtintype" id="4835011">int</span><span class="op" id="4835014">)</span>&nbsp;<span class="builtintype" id="4835016">error</span>&nbsp;<span class="op" id="4835022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835025">return</span>&nbsp;<span class="ident" id="4835032">writeRuntimeProfile</span><span class="op" id="4835051">(</span><span class="ident" id="4835052">w</span><span class="op" id="4835053">,</span>&nbsp;<span class="ident" id="4835055">debug</span><span class="op" id="4835060">,</span>&nbsp;<span class="string" id="4835062">&#34;threadcreate&#34;</span><span class="op" id="4835076">,</span>&nbsp;<span class="ident" id="4835078">runtime</span><span class="op" id="4835085">.</span><span class="ident" id="4835086">ThreadCreateProfile</span><span class="op" id="4835105">)</span><br>
<span class="lineno">490</span><span class="op" id="4835107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4835110">//&nbsp;countGoroutine&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4835162">func</span>&nbsp;<span class="ident" id="4835167">countGoroutine</span><span class="op" id="4835181">(</span><span class="op" id="4835182">)</span>&nbsp;<span class="builtintype" id="4835184">int</span>&nbsp;<span class="op" id="4835188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835191">return</span>&nbsp;<span class="ident" id="4835198">runtime</span><span class="op" id="4835205">.</span><span class="ident" id="4835206">NumGoroutine</span><span class="op" id="4835218">(</span><span class="op" id="4835219">)</span><br>
<span class="lineno">495</span><span class="op" id="4835221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4835224">//&nbsp;writeGoroutine&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;GoroutineProfile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4835292">func</span>&nbsp;<span class="ident" id="4835297">writeGoroutine</span><span class="op" id="4835311">(</span><span class="ident" id="4835312">w</span>&nbsp;<span class="ident" id="4835314">io</span><span class="op" id="4835316">.</span><span class="ident" id="4835317">Writer</span><span class="op" id="4835323">,</span>&nbsp;<span class="ident" id="4835325">debug</span>&nbsp;<span class="builtintype" id="4835331">int</span><span class="op" id="4835334">)</span>&nbsp;<span class="builtintype" id="4835336">error</span>&nbsp;<span class="op" id="4835342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835345">if</span>&nbsp;<span class="ident" id="4835348">debug</span>&nbsp;<span class="op" id="4835354">&gt;=</span>&nbsp;<span class="num" id="4835357">2</span>&nbsp;<span class="op" id="4835359">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835363">return</span>&nbsp;<span class="ident" id="4835370">writeGoroutineStacks</span><span class="op" id="4835390">(</span><span class="ident" id="4835391">w</span><span class="op" id="4835392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835398">return</span>&nbsp;<span class="ident" id="4835405">writeRuntimeProfile</span><span class="op" id="4835424">(</span><span class="ident" id="4835425">w</span><span class="op" id="4835426">,</span>&nbsp;<span class="ident" id="4835428">debug</span><span class="op" id="4835433">,</span>&nbsp;<span class="string" id="4835435">&#34;goroutine&#34;</span><span class="op" id="4835446">,</span>&nbsp;<span class="ident" id="4835448">runtime</span><span class="op" id="4835455">.</span><span class="ident" id="4835456">GoroutineProfile</span><span class="op" id="4835472">)</span><br>
<span class="lineno"></span><span class="op" id="4835474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="4835477">func</span>&nbsp;<span class="ident" id="4835482">writeGoroutineStacks</span><span class="op" id="4835502">(</span><span class="ident" id="4835503">w</span>&nbsp;<span class="ident" id="4835505">io</span><span class="op" id="4835507">.</span><span class="ident" id="4835508">Writer</span><span class="op" id="4835514">)</span>&nbsp;<span class="builtintype" id="4835516">error</span>&nbsp;<span class="op" id="4835522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4835525">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;big&nbsp;the&nbsp;buffer&nbsp;needs&nbsp;to&nbsp;be&nbsp;to&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4835585">//&nbsp;all&nbsp;the&nbsp;goroutines.&nbsp;&nbsp;Start&nbsp;with&nbsp;1&nbsp;MB&nbsp;and&nbsp;try&nbsp;a&nbsp;few&nbsp;times,&nbsp;doubling&nbsp;each&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4835667">//&nbsp;Give&nbsp;up&nbsp;and&nbsp;use&nbsp;a&nbsp;truncated&nbsp;trace&nbsp;if&nbsp;64&nbsp;MB&nbsp;is&nbsp;not&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835729">buf</span>&nbsp;<span class="op" id="4835733">:=</span>&nbsp;<span class="builtinfunc" id="4835736">make</span><span class="op" id="4835740">(</span><span class="op" id="4835741">[</span><span class="op" id="4835742">]</span><span class="builtintype" id="4835743">byte</span><span class="op" id="4835747">,</span>&nbsp;<span class="num" id="4835749">1</span><span class="op" id="4835750">&lt;&lt;</span><span class="num" id="4835752">20</span><span class="op" id="4835754">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835757">for</span>&nbsp;<span class="ident" id="4835761">i</span>&nbsp;<span class="op" id="4835763">:=</span>&nbsp;<span class="num" id="4835766">0</span><span class="op" id="4835767">;</span>&nbsp;<span class="op" id="4835769">;</span>&nbsp;<span class="ident" id="4835771">i</span><span class="op" id="4835772">++</span>&nbsp;<span class="op" id="4835775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835779">n</span>&nbsp;<span class="op" id="4835781">:=</span>&nbsp;<span class="ident" id="4835784">runtime</span><span class="op" id="4835791">.</span><span class="ident" id="4835792">Stack</span><span class="op" id="4835797">(</span><span class="ident" id="4835798">buf</span><span class="op" id="4835801">,</span>&nbsp;<span class="ident" id="4835803">true</span><span class="op" id="4835807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835811">if</span>&nbsp;<span class="ident" id="4835814">n</span>&nbsp;<span class="op" id="4835816">&lt;</span>&nbsp;<span class="builtinfunc" id="4835818">len</span><span class="op" id="4835821">(</span><span class="ident" id="4835822">buf</span><span class="op" id="4835825">)</span>&nbsp;<span class="op" id="4835827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835832">buf</span>&nbsp;<span class="op" id="4835836">=</span>&nbsp;<span class="ident" id="4835838">buf</span><span class="op" id="4835841">[</span><span class="op" id="4835842">:</span><span class="ident" id="4835843">n</span><span class="op" id="4835844">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835849">break</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835861">if</span>&nbsp;<span class="builtinfunc" id="4835864">len</span><span class="op" id="4835867">(</span><span class="ident" id="4835868">buf</span><span class="op" id="4835871">)</span>&nbsp;<span class="op" id="4835873">&gt;=</span>&nbsp;<span class="num" id="4835876">64</span><span class="op" id="4835878">&lt;&lt;</span><span class="num" id="4835880">20</span>&nbsp;<span class="op" id="4835883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4835888">//&nbsp;Filled&nbsp;64&nbsp;MB&nbsp;-&nbsp;stop&nbsp;there.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835921">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835929">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835933">buf</span>&nbsp;<span class="op" id="4835937">=</span>&nbsp;<span class="builtinfunc" id="4835939">make</span><span class="op" id="4835943">(</span><span class="op" id="4835944">[</span><span class="op" id="4835945">]</span><span class="builtintype" id="4835946">byte</span><span class="op" id="4835950">,</span>&nbsp;<span class="num" id="4835952">2</span><span class="op" id="4835953">*</span><span class="builtinfunc" id="4835954">len</span><span class="op" id="4835957">(</span><span class="ident" id="4835958">buf</span><span class="op" id="4835961">)</span><span class="op" id="4835962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835968">_</span><span class="op" id="4835969">,</span>&nbsp;<span class="ident" id="4835971">err</span>&nbsp;<span class="op" id="4835975">:=</span>&nbsp;<span class="ident" id="4835978">w</span><span class="op" id="4835979">.</span><span class="ident" id="4835980">Write</span><span class="op" id="4835985">(</span><span class="ident" id="4835986">buf</span><span class="op" id="4835989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835992">return</span>&nbsp;<span class="ident" id="4835999">err</span><br>
<span class="lineno"></span><span class="op" id="4836003">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span><span class="keyword" id="4836006">func</span>&nbsp;<span class="ident" id="4836011">writeRuntimeProfile</span><span class="op" id="4836030">(</span><span class="ident" id="4836031">w</span>&nbsp;<span class="ident" id="4836033">io</span><span class="op" id="4836035">.</span><span class="ident" id="4836036">Writer</span><span class="op" id="4836042">,</span>&nbsp;<span class="ident" id="4836044">debug</span>&nbsp;<span class="builtintype" id="4836050">int</span><span class="op" id="4836053">,</span>&nbsp;<span class="ident" id="4836055">name</span>&nbsp;<span class="builtintype" id="4836060">string</span><span class="op" id="4836066">,</span>&nbsp;<span class="ident" id="4836068">fetch</span>&nbsp;<span class="keyword" id="4836074">func</span><span class="op" id="4836078">(</span><span class="op" id="4836079">[</span><span class="op" id="4836080">]</span><span class="ident" id="4836081">runtime</span><span class="op" id="4836088">.</span><span class="ident" id="4836089">StackRecord</span><span class="op" id="4836100">)</span>&nbsp;<span class="op" id="4836102">(</span><span class="builtintype" id="4836103">int</span><span class="op" id="4836106">,</span>&nbsp;<span class="builtintype" id="4836108">bool</span><span class="op" id="4836112">)</span><span class="op" id="4836113">)</span>&nbsp;<span class="builtintype" id="4836115">error</span>&nbsp;<span class="op" id="4836121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836124">//&nbsp;Find&nbsp;out&nbsp;how&nbsp;many&nbsp;records&nbsp;there&nbsp;are&nbsp;(fetch(nil)),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836178">//&nbsp;allocate&nbsp;that&nbsp;many&nbsp;records,&nbsp;and&nbsp;get&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836228">//&nbsp;There&#39;s&nbsp;a&nbsp;race—more&nbsp;records&nbsp;might&nbsp;be&nbsp;added&nbsp;between</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836285">//&nbsp;the&nbsp;two&nbsp;calls—so&nbsp;allocate&nbsp;a&nbsp;few&nbsp;extra&nbsp;records&nbsp;for&nbsp;safety</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836348">//&nbsp;and&nbsp;also&nbsp;try&nbsp;again&nbsp;if&nbsp;we&#39;re&nbsp;very&nbsp;unlucky.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836394">//&nbsp;The&nbsp;loop&nbsp;should&nbsp;only&nbsp;execute&nbsp;one&nbsp;iteration&nbsp;in&nbsp;the&nbsp;common&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836461">var</span>&nbsp;<span class="ident" id="4836465">p</span>&nbsp;<span class="op" id="4836467">[</span><span class="op" id="4836468">]</span><span class="ident" id="4836469">runtime</span><span class="op" id="4836476">.</span><span class="ident" id="4836477">StackRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836490">n</span><span class="op" id="4836491">,</span>&nbsp;<span class="ident" id="4836493">ok</span>&nbsp;<span class="op" id="4836496">:=</span>&nbsp;<span class="ident" id="4836499">fetch</span><span class="op" id="4836504">(</span><span class="ident" id="4836505">nil</span><span class="op" id="4836508">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836511">for</span>&nbsp;<span class="op" id="4836515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836519">//&nbsp;Allocate&nbsp;room&nbsp;for&nbsp;a&nbsp;slightly&nbsp;bigger&nbsp;profile,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836569">//&nbsp;in&nbsp;case&nbsp;a&nbsp;few&nbsp;more&nbsp;entries&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836617">//&nbsp;since&nbsp;the&nbsp;call&nbsp;to&nbsp;ThreadProfile.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836655">p</span>&nbsp;<span class="op" id="4836657">=</span>&nbsp;<span class="builtinfunc" id="4836659">make</span><span class="op" id="4836663">(</span><span class="op" id="4836664">[</span><span class="op" id="4836665">]</span><span class="ident" id="4836666">runtime</span><span class="op" id="4836673">.</span><span class="ident" id="4836674">StackRecord</span><span class="op" id="4836685">,</span>&nbsp;<span class="ident" id="4836687">n</span><span class="op" id="4836688">+</span><span class="num" id="4836689">10</span><span class="op" id="4836691">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836695">n</span><span class="op" id="4836696">,</span>&nbsp;<span class="ident" id="4836698">ok</span>&nbsp;<span class="op" id="4836701">=</span>&nbsp;<span class="ident" id="4836703">fetch</span><span class="op" id="4836708">(</span><span class="ident" id="4836709">p</span><span class="op" id="4836710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836714">if</span>&nbsp;<span class="ident" id="4836717">ok</span>&nbsp;<span class="op" id="4836720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836725">p</span>&nbsp;<span class="op" id="4836727">=</span>&nbsp;<span class="ident" id="4836729">p</span><span class="op" id="4836730">[</span><span class="num" id="4836731">0</span><span class="op" id="4836732">:</span><span class="ident" id="4836733">n</span><span class="op" id="4836734">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836739">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4836747">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836751">//&nbsp;Profile&nbsp;grew;&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4836780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836784">return</span>&nbsp;<span class="ident" id="4836791">printCountProfile</span><span class="op" id="4836808">(</span><span class="ident" id="4836809">w</span><span class="op" id="4836810">,</span>&nbsp;<span class="ident" id="4836812">debug</span><span class="op" id="4836817">,</span>&nbsp;<span class="ident" id="4836819">name</span><span class="op" id="4836823">,</span>&nbsp;<span class="ident" id="4836825">runtimeProfile</span><span class="op" id="4836839">(</span><span class="ident" id="4836840">p</span><span class="op" id="4836841">)</span><span class="op" id="4836842">)</span><br>
<span class="lineno"></span><span class="op" id="4836844">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="keyword" id="4836847">type</span>&nbsp;<span class="ident" id="4836852">runtimeProfile</span>&nbsp;<span class="op" id="4836867">[</span><span class="op" id="4836868">]</span><span class="ident" id="4836869">runtime</span><span class="op" id="4836876">.</span><span class="ident" id="4836877">StackRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4836890">func</span>&nbsp;<span class="op" id="4836895">(</span><span class="ident" id="4836896">p</span>&nbsp;<span class="ident" id="4836898">runtimeProfile</span><span class="op" id="4836912">)</span>&nbsp;<span class="ident" id="4836914">Len</span><span class="op" id="4836917">(</span><span class="op" id="4836918">)</span>&nbsp;<span class="builtintype" id="4836920">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4836937">{</span>&nbsp;<span class="keyword" id="4836939">return</span>&nbsp;<span class="builtinfunc" id="4836946">len</span><span class="op" id="4836949">(</span><span class="ident" id="4836950">p</span><span class="op" id="4836951">)</span>&nbsp;<span class="op" id="4836953">}</span><br>
<span class="lineno"></span><span class="keyword" id="4836955">func</span>&nbsp;<span class="op" id="4836960">(</span><span class="ident" id="4836961">p</span>&nbsp;<span class="ident" id="4836963">runtimeProfile</span><span class="op" id="4836977">)</span>&nbsp;<span class="ident" id="4836979">Stack</span><span class="op" id="4836984">(</span><span class="ident" id="4836985">i</span>&nbsp;<span class="builtintype" id="4836987">int</span><span class="op" id="4836990">)</span>&nbsp;<span class="op" id="4836992">[</span><span class="op" id="4836993">]</span><span class="builtintype" id="4836994">uintptr</span>&nbsp;<span class="op" id="4837002">{</span>&nbsp;<span class="keyword" id="4837004">return</span>&nbsp;<span class="ident" id="4837011">p</span><span class="op" id="4837012">[</span><span class="ident" id="4837013">i</span><span class="op" id="4837014">]</span><span class="op" id="4837015">.</span><span class="ident" id="4837016">Stack</span><span class="op" id="4837021">(</span><span class="op" id="4837022">)</span>&nbsp;<span class="op" id="4837024">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="4837027">var</span>&nbsp;<span class="ident" id="4837031">cpu</span>&nbsp;<span class="keyword" id="4837035">struct</span>&nbsp;<span class="op" id="4837042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837045">sync</span><span class="op" id="4837049">.</span><span class="ident" id="4837050">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837057">profiling</span>&nbsp;<span class="builtintype" id="4837067">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837073">done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4837083">chan</span>&nbsp;<span class="builtintype" id="4837088">bool</span><br>
<span class="lineno">560</span><span class="op" id="4837093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4837096">//&nbsp;StartCPUProfile&nbsp;enables&nbsp;CPU&nbsp;profiling&nbsp;for&nbsp;the&nbsp;current&nbsp;process.</span><br>
<span class="lineno"></span><span class="comment" id="4837162">//&nbsp;While&nbsp;profiling,&nbsp;the&nbsp;profile&nbsp;will&nbsp;be&nbsp;buffered&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4837229">//&nbsp;StartCPUProfile&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;profiling&nbsp;is&nbsp;already&nbsp;enabled.</span><br>
<span class="lineno">565</span><span class="keyword" id="4837298">func</span>&nbsp;<span class="ident" id="4837303">StartCPUProfile</span><span class="op" id="4837318">(</span><span class="ident" id="4837319">w</span>&nbsp;<span class="ident" id="4837321">io</span><span class="op" id="4837323">.</span><span class="ident" id="4837324">Writer</span><span class="op" id="4837330">)</span>&nbsp;<span class="builtintype" id="4837332">error</span>&nbsp;<span class="op" id="4837338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837341">//&nbsp;The&nbsp;runtime&nbsp;routines&nbsp;allow&nbsp;a&nbsp;variable&nbsp;profiling&nbsp;rate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837399">//&nbsp;but&nbsp;in&nbsp;practice&nbsp;operating&nbsp;systems&nbsp;cannot&nbsp;trigger&nbsp;signals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837460">//&nbsp;at&nbsp;more&nbsp;than&nbsp;about&nbsp;500&nbsp;Hz,&nbsp;and&nbsp;our&nbsp;processing&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837517">//&nbsp;signal&nbsp;is&nbsp;not&nbsp;cheap&nbsp;(mostly&nbsp;getting&nbsp;the&nbsp;stack&nbsp;trace).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837575">//&nbsp;100&nbsp;Hz&nbsp;is&nbsp;a&nbsp;reasonable&nbsp;choice:&nbsp;it&nbsp;is&nbsp;frequent&nbsp;enough&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837635">//&nbsp;produce&nbsp;useful&nbsp;data,&nbsp;rare&nbsp;enough&nbsp;not&nbsp;to&nbsp;bog&nbsp;down&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837692">//&nbsp;system,&nbsp;and&nbsp;a&nbsp;nice&nbsp;round&nbsp;number&nbsp;to&nbsp;make&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837747">//&nbsp;convert&nbsp;sample&nbsp;counts&nbsp;to&nbsp;seconds.&nbsp;&nbsp;Instead&nbsp;of&nbsp;requiring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837807">//&nbsp;each&nbsp;client&nbsp;to&nbsp;specify&nbsp;the&nbsp;frequency,&nbsp;we&nbsp;hard&nbsp;code&nbsp;it.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4837866">const</span>&nbsp;<span class="ident" id="4837872">hz</span>&nbsp;<span class="op" id="4837875">=</span>&nbsp;<span class="num" id="4837877">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837883">cpu</span><span class="op" id="4837886">.</span><span class="ident" id="4837887">Lock</span><span class="op" id="4837891">(</span><span class="op" id="4837892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4837895">defer</span>&nbsp;<span class="ident" id="4837901">cpu</span><span class="op" id="4837904">.</span><span class="ident" id="4837905">Unlock</span><span class="op" id="4837911">(</span><span class="op" id="4837912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4837915">if</span>&nbsp;<span class="ident" id="4837918">cpu</span><span class="op" id="4837921">.</span><span class="ident" id="4837922">done</span>&nbsp;<span class="op" id="4837927">==</span>&nbsp;<span class="ident" id="4837930">nil</span>&nbsp;<span class="op" id="4837934">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837938">cpu</span><span class="op" id="4837941">.</span><span class="ident" id="4837942">done</span>&nbsp;<span class="op" id="4837947">=</span>&nbsp;<span class="builtinfunc" id="4837949">make</span><span class="op" id="4837953">(</span><span class="keyword" id="4837954">chan</span>&nbsp;<span class="builtintype" id="4837959">bool</span><span class="op" id="4837963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4837966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837969">//&nbsp;Double-check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4837987">if</span>&nbsp;<span class="ident" id="4837990">cpu</span><span class="op" id="4837993">.</span><span class="ident" id="4837994">profiling</span>&nbsp;<span class="op" id="4838004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838008">return</span>&nbsp;<span class="ident" id="4838015">fmt</span><span class="op" id="4838018">.</span><span class="ident" id="4838019">Errorf</span><span class="op" id="4838025">(</span><span class="string" id="4838026">&#34;cpu&nbsp;profiling&nbsp;already&nbsp;in&nbsp;use&#34;</span><span class="op" id="4838056">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4838059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838062">cpu</span><span class="op" id="4838065">.</span><span class="ident" id="4838066">profiling</span>&nbsp;<span class="op" id="4838076">=</span>&nbsp;<span class="ident" id="4838078">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838084">runtime</span><span class="op" id="4838091">.</span><span class="ident" id="4838092">SetCPUProfileRate</span><span class="op" id="4838109">(</span><span class="ident" id="4838110">hz</span><span class="op" id="4838112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838115">go</span>&nbsp;<span class="ident" id="4838118">profileWriter</span><span class="op" id="4838131">(</span><span class="ident" id="4838132">w</span><span class="op" id="4838133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838136">return</span>&nbsp;<span class="ident" id="4838143">nil</span><br>
<span class="lineno">590</span><span class="op" id="4838147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4838150">func</span>&nbsp;<span class="ident" id="4838155">profileWriter</span><span class="op" id="4838168">(</span><span class="ident" id="4838169">w</span>&nbsp;<span class="ident" id="4838171">io</span><span class="op" id="4838173">.</span><span class="ident" id="4838174">Writer</span><span class="op" id="4838180">)</span>&nbsp;<span class="op" id="4838182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838185">for</span>&nbsp;<span class="op" id="4838189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838193">data</span>&nbsp;<span class="op" id="4838198">:=</span>&nbsp;<span class="ident" id="4838201">runtime</span><span class="op" id="4838208">.</span><span class="ident" id="4838209">CPUProfile</span><span class="op" id="4838219">(</span><span class="op" id="4838220">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838224">if</span>&nbsp;<span class="ident" id="4838227">data</span>&nbsp;<span class="op" id="4838232">==</span>&nbsp;<span class="ident" id="4838235">nil</span>&nbsp;<span class="op" id="4838239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838244">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4838252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838256">w</span><span class="op" id="4838257">.</span><span class="ident" id="4838258">Write</span><span class="op" id="4838263">(</span><span class="ident" id="4838264">data</span><span class="op" id="4838268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4838271">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838274">cpu</span><span class="op" id="4838277">.</span><span class="ident" id="4838278">done</span>&nbsp;<span class="op" id="4838283">&lt;-</span>&nbsp;<span class="ident" id="4838286">true</span><br>
<span class="lineno"></span><span class="op" id="4838291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4838294">//&nbsp;StopCPUProfile&nbsp;stops&nbsp;the&nbsp;current&nbsp;CPU&nbsp;profile,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="4838351">//&nbsp;StopCPUProfile&nbsp;only&nbsp;returns&nbsp;after&nbsp;all&nbsp;the&nbsp;writes&nbsp;for&nbsp;the</span><br>
<span class="lineno">605</span><span class="comment" id="4838411">//&nbsp;profile&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span><span class="keyword" id="4838438">func</span>&nbsp;<span class="ident" id="4838443">StopCPUProfile</span><span class="op" id="4838457">(</span><span class="op" id="4838458">)</span>&nbsp;<span class="op" id="4838460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838463">cpu</span><span class="op" id="4838466">.</span><span class="ident" id="4838467">Lock</span><span class="op" id="4838471">(</span><span class="op" id="4838472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838475">defer</span>&nbsp;<span class="ident" id="4838481">cpu</span><span class="op" id="4838484">.</span><span class="ident" id="4838485">Unlock</span><span class="op" id="4838491">(</span><span class="op" id="4838492">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838496">if</span>&nbsp;<span class="op" id="4838499">!</span><span class="ident" id="4838500">cpu</span><span class="op" id="4838503">.</span><span class="ident" id="4838504">profiling</span>&nbsp;<span class="op" id="4838514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838518">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4838526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838529">cpu</span><span class="op" id="4838532">.</span><span class="ident" id="4838533">profiling</span>&nbsp;<span class="op" id="4838543">=</span>&nbsp;<span class="ident" id="4838545">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838552">runtime</span><span class="op" id="4838559">.</span><span class="ident" id="4838560">SetCPUProfileRate</span><span class="op" id="4838577">(</span><span class="num" id="4838578">0</span><span class="op" id="4838579">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4838582">&lt;-</span><span class="ident" id="4838584">cpu</span><span class="op" id="4838587">.</span><span class="ident" id="4838588">done</span><br>
<span class="lineno"></span><span class="op" id="4838593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4838596">type</span>&nbsp;<span class="ident" id="4838601">byCycles</span>&nbsp;<span class="op" id="4838610">[</span><span class="op" id="4838611">]</span><span class="ident" id="4838612">runtime</span><span class="op" id="4838619">.</span><span class="ident" id="4838620">BlockProfileRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno">620</span><span class="keyword" id="4838640">func</span>&nbsp;<span class="op" id="4838645">(</span><span class="ident" id="4838646">x</span>&nbsp;<span class="ident" id="4838648">byCycles</span><span class="op" id="4838656">)</span>&nbsp;<span class="ident" id="4838658">Len</span><span class="op" id="4838661">(</span><span class="op" id="4838662">)</span>&nbsp;<span class="builtintype" id="4838664">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4838678">{</span>&nbsp;<span class="keyword" id="4838680">return</span>&nbsp;<span class="builtinfunc" id="4838687">len</span><span class="op" id="4838690">(</span><span class="ident" id="4838691">x</span><span class="op" id="4838692">)</span>&nbsp;<span class="op" id="4838694">}</span><br>
<span class="lineno"></span><span class="keyword" id="4838696">func</span>&nbsp;<span class="op" id="4838701">(</span><span class="ident" id="4838702">x</span>&nbsp;<span class="ident" id="4838704">byCycles</span><span class="op" id="4838712">)</span>&nbsp;<span class="ident" id="4838714">Swap</span><span class="op" id="4838718">(</span><span class="ident" id="4838719">i</span><span class="op" id="4838720">,</span>&nbsp;<span class="ident" id="4838722">j</span>&nbsp;<span class="builtintype" id="4838724">int</span><span class="op" id="4838727">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4838734">{</span>&nbsp;<span class="ident" id="4838736">x</span><span class="op" id="4838737">[</span><span class="ident" id="4838738">i</span><span class="op" id="4838739">]</span><span class="op" id="4838740">,</span>&nbsp;<span class="ident" id="4838742">x</span><span class="op" id="4838743">[</span><span class="ident" id="4838744">j</span><span class="op" id="4838745">]</span>&nbsp;<span class="op" id="4838747">=</span>&nbsp;<span class="ident" id="4838749">x</span><span class="op" id="4838750">[</span><span class="ident" id="4838751">j</span><span class="op" id="4838752">]</span><span class="op" id="4838753">,</span>&nbsp;<span class="ident" id="4838755">x</span><span class="op" id="4838756">[</span><span class="ident" id="4838757">i</span><span class="op" id="4838758">]</span>&nbsp;<span class="op" id="4838760">}</span><br>
<span class="lineno"></span><span class="keyword" id="4838762">func</span>&nbsp;<span class="op" id="4838767">(</span><span class="ident" id="4838768">x</span>&nbsp;<span class="ident" id="4838770">byCycles</span><span class="op" id="4838778">)</span>&nbsp;<span class="ident" id="4838780">Less</span><span class="op" id="4838784">(</span><span class="ident" id="4838785">i</span><span class="op" id="4838786">,</span>&nbsp;<span class="ident" id="4838788">j</span>&nbsp;<span class="builtintype" id="4838790">int</span><span class="op" id="4838793">)</span>&nbsp;<span class="builtintype" id="4838795">bool</span>&nbsp;<span class="op" id="4838800">{</span>&nbsp;<span class="keyword" id="4838802">return</span>&nbsp;<span class="ident" id="4838809">x</span><span class="op" id="4838810">[</span><span class="ident" id="4838811">i</span><span class="op" id="4838812">]</span><span class="op" id="4838813">.</span><span class="ident" id="4838814">Cycles</span>&nbsp;<span class="op" id="4838821">&gt;</span>&nbsp;<span class="ident" id="4838823">x</span><span class="op" id="4838824">[</span><span class="ident" id="4838825">j</span><span class="op" id="4838826">]</span><span class="op" id="4838827">.</span><span class="ident" id="4838828">Cycles</span>&nbsp;<span class="op" id="4838835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4838838">//&nbsp;countBlock&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;blocking&nbsp;profile.</span><br>
<span class="lineno">625</span><span class="keyword" id="4838907">func</span>&nbsp;<span class="ident" id="4838912">countBlock</span><span class="op" id="4838922">(</span><span class="op" id="4838923">)</span>&nbsp;<span class="builtintype" id="4838925">int</span>&nbsp;<span class="op" id="4838929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838932">n</span><span class="op" id="4838933">,</span>&nbsp;<span class="ident" id="4838935">_</span>&nbsp;<span class="op" id="4838937">:=</span>&nbsp;<span class="ident" id="4838940">runtime</span><span class="op" id="4838947">.</span><span class="ident" id="4838948">BlockProfile</span><span class="op" id="4838960">(</span><span class="ident" id="4838961">nil</span><span class="op" id="4838964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838967">return</span>&nbsp;<span class="ident" id="4838974">n</span><br>
<span class="lineno"></span><span class="op" id="4838976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="comment" id="4838979">//&nbsp;writeBlock&nbsp;writes&nbsp;the&nbsp;current&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4839035">func</span>&nbsp;<span class="ident" id="4839040">writeBlock</span><span class="op" id="4839050">(</span><span class="ident" id="4839051">w</span>&nbsp;<span class="ident" id="4839053">io</span><span class="op" id="4839055">.</span><span class="ident" id="4839056">Writer</span><span class="op" id="4839062">,</span>&nbsp;<span class="ident" id="4839064">debug</span>&nbsp;<span class="builtintype" id="4839070">int</span><span class="op" id="4839073">)</span>&nbsp;<span class="builtintype" id="4839075">error</span>&nbsp;<span class="op" id="4839081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4839084">var</span>&nbsp;<span class="ident" id="4839088">p</span>&nbsp;<span class="op" id="4839090">[</span><span class="op" id="4839091">]</span><span class="ident" id="4839092">runtime</span><span class="op" id="4839099">.</span><span class="ident" id="4839100">BlockProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839120">n</span><span class="op" id="4839121">,</span>&nbsp;<span class="ident" id="4839123">ok</span>&nbsp;<span class="op" id="4839126">:=</span>&nbsp;<span class="ident" id="4839129">runtime</span><span class="op" id="4839136">.</span><span class="ident" id="4839137">BlockProfile</span><span class="op" id="4839149">(</span><span class="ident" id="4839150">nil</span><span class="op" id="4839153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4839156">for</span>&nbsp;<span class="op" id="4839160">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839164">p</span>&nbsp;<span class="op" id="4839166">=</span>&nbsp;<span class="builtinfunc" id="4839168">make</span><span class="op" id="4839172">(</span><span class="op" id="4839173">[</span><span class="op" id="4839174">]</span><span class="ident" id="4839175">runtime</span><span class="op" id="4839182">.</span><span class="ident" id="4839183">BlockProfileRecord</span><span class="op" id="4839201">,</span>&nbsp;<span class="ident" id="4839203">n</span><span class="op" id="4839204">+</span><span class="num" id="4839205">50</span><span class="op" id="4839207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839211">n</span><span class="op" id="4839212">,</span>&nbsp;<span class="ident" id="4839214">ok</span>&nbsp;<span class="op" id="4839217">=</span>&nbsp;<span class="ident" id="4839219">runtime</span><span class="op" id="4839226">.</span><span class="ident" id="4839227">BlockProfile</span><span class="op" id="4839239">(</span><span class="ident" id="4839240">p</span><span class="op" id="4839241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4839245">if</span>&nbsp;<span class="ident" id="4839248">ok</span>&nbsp;<span class="op" id="4839251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839256">p</span>&nbsp;<span class="op" id="4839258">=</span>&nbsp;<span class="ident" id="4839260">p</span><span class="op" id="4839261">[</span><span class="op" id="4839262">:</span><span class="ident" id="4839263">n</span><span class="op" id="4839264">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4839269">break</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4839277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4839280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839284">sort</span><span class="op" id="4839288">.</span><span class="ident" id="4839289">Sort</span><span class="op" id="4839293">(</span><span class="ident" id="4839294">byCycles</span><span class="op" id="4839302">(</span><span class="ident" id="4839303">p</span><span class="op" id="4839304">)</span><span class="op" id="4839305">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839309">b</span>&nbsp;<span class="op" id="4839311">:=</span>&nbsp;<span class="ident" id="4839314">bufio</span><span class="op" id="4839319">.</span><span class="ident" id="4839320">NewWriter</span><span class="op" id="4839329">(</span><span class="ident" id="4839330">w</span><span class="op" id="4839331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4839334">var</span>&nbsp;<span class="ident" id="4839338">tw</span>&nbsp;<span class="op" id="4839341">*</span><span class="ident" id="4839342">tabwriter</span><span class="op" id="4839351">.</span><span class="ident" id="4839352">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839360">w</span>&nbsp;<span class="op" id="4839362">=</span>&nbsp;<span class="ident" id="4839364">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4839367">if</span>&nbsp;<span class="ident" id="4839370">debug</span>&nbsp;<span class="op" id="4839376">&gt;</span>&nbsp;<span class="num" id="4839378">0</span>&nbsp;<span class="op" id="4839380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839384">tw</span>&nbsp;<span class="op" id="4839387">=</span>&nbsp;<span class="ident" id="4839389">tabwriter</span><span class="op" id="4839398">.</span><span class="ident" id="4839399">NewWriter</span><span class="op" id="4839408">(</span><span class="ident" id="4839409">w</span><span class="op" id="4839410">,</span>&nbsp;<span class="num" id="4839412">1</span><span class="op" id="4839413">,</span>&nbsp;<span class="num" id="4839415">8</span><span class="op" id="4839416">,</span>&nbsp;<span class="num" id="4839418">1</span><span class="op" id="4839419">,</span>&nbsp;<span class="string" id="4839421">&#39;\t&#39;</span><span class="op" id="4839425">,</span>&nbsp;<span class="num" id="4839427">0</span><span class="op" id="4839428">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839432">w</span>&nbsp;<span class="op" id="4839434">=</span>&nbsp;<span class="ident" id="4839436">tw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4839440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839444">fmt</span><span class="op" id="4839447">.</span><span class="ident" id="4839448">Fprintf</span><span class="op" id="4839455">(</span><span class="ident" id="4839456">w</span><span class="op" id="4839457">,</span>&nbsp;<span class="string" id="4839459">&#34;---&nbsp;contention:\n&#34;</span><span class="op" id="4839478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839481">fmt</span><span class="op" id="4839484">.</span><span class="ident" id="4839485">Fprintf</span><span class="op" id="4839492">(</span><span class="ident" id="4839493">w</span><span class="op" id="4839494">,</span>&nbsp;<span class="string" id="4839496">&#34;cycles/second=%v\n&#34;</span><span class="op" id="4839516">,</span>&nbsp;<span class="ident" id="4839518">runtime_cyclesPerSecond</span><span class="op" id="4839541">(</span><span class="op" id="4839542">)</span><span class="op" id="4839543">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4839546">for</span>&nbsp;<span class="ident" id="4839550">i</span>&nbsp;<span class="op" id="4839552">:=</span>&nbsp;<span class="keyword" id="4839555">range</span>&nbsp;<span class="ident" id="4839561">p</span>&nbsp;<span class="op" id="4839563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839567">r</span>&nbsp;<span class="op" id="4839569">:=</span>&nbsp;<span class="op" id="4839572">&amp;</span><span class="ident" id="4839573">p</span><span class="op" id="4839574">[</span><span class="ident" id="4839575">i</span><span class="op" id="4839576">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839580">fmt</span><span class="op" id="4839583">.</span><span class="ident" id="4839584">Fprintf</span><span class="op" id="4839591">(</span><span class="ident" id="4839592">w</span><span class="op" id="4839593">,</span>&nbsp;<span class="string" id="4839595">&#34;%v&nbsp;%v&nbsp;@&#34;</span><span class="op" id="4839604">,</span>&nbsp;<span class="ident" id="4839606">r</span><span class="op" id="4839607">.</span><span class="ident" id="4839608">Cycles</span><span class="op" id="4839614">,</span>&nbsp;<span class="ident" id="4839616">r</span><span class="op" id="4839617">.</span><span class="ident" id="4839618">Count</span><span class="op" id="4839623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4839627">for</span>&nbsp;<span class="ident" id="4839631">_</span><span class="op" id="4839632">,</span>&nbsp;<span class="ident" id="4839634">pc</span>&nbsp;<span class="op" id="4839637">:=</span>&nbsp;<span class="keyword" id="4839640">range</span>&nbsp;<span class="ident" id="4839646">r</span><span class="op" id="4839647">.</span><span class="ident" id="4839648">Stack</span><span class="op" id="4839653">(</span><span class="op" id="4839654">)</span>&nbsp;<span class="op" id="4839656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839661">fmt</span><span class="op" id="4839664">.</span><span class="ident" id="4839665">Fprintf</span><span class="op" id="4839672">(</span><span class="ident" id="4839673">w</span><span class="op" id="4839674">,</span>&nbsp;<span class="string" id="4839676">&#34;&nbsp;%#x&#34;</span><span class="op" id="4839682">,</span>&nbsp;<span class="ident" id="4839684">pc</span><span class="op" id="4839686">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4839690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839694">fmt</span><span class="op" id="4839697">.</span><span class="ident" id="4839698">Fprint</span><span class="op" id="4839704">(</span><span class="ident" id="4839705">w</span><span class="op" id="4839706">,</span>&nbsp;<span class="string" id="4839708">&#34;\n&#34;</span><span class="op" id="4839712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4839716">if</span>&nbsp;<span class="ident" id="4839719">debug</span>&nbsp;<span class="op" id="4839725">&gt;</span>&nbsp;<span class="num" id="4839727">0</span>&nbsp;<span class="op" id="4839729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839734">printStackRecord</span><span class="op" id="4839750">(</span><span class="ident" id="4839751">w</span><span class="op" id="4839752">,</span>&nbsp;<span class="ident" id="4839754">r</span><span class="op" id="4839755">.</span><span class="ident" id="4839756">Stack</span><span class="op" id="4839761">(</span><span class="op" id="4839762">)</span><span class="op" id="4839763">,</span>&nbsp;<span class="ident" id="4839765">true</span><span class="op" id="4839769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4839773">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4839776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4839780">if</span>&nbsp;<span class="ident" id="4839783">tw</span>&nbsp;<span class="op" id="4839786">!=</span>&nbsp;<span class="ident" id="4839789">nil</span>&nbsp;<span class="op" id="4839793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4839797">tw</span><span class="op" id="4839799">.</span><span class="ident" id="4839800">Flush</span><span class="op" id="4839805">(</span><span class="op" id="4839806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4839809">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4839812">return</span>&nbsp;<span class="ident" id="4839819">b</span><span class="op" id="4839820">.</span><span class="ident" id="4839821">Flush</span><span class="op" id="4839826">(</span><span class="op" id="4839827">)</span><br>
<span class="lineno"></span><span class="op" id="4839829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4839832">func</span>&nbsp;<span class="ident" id="4839837">runtime_cyclesPerSecond</span><span class="op" id="4839860">(</span><span class="op" id="4839861">)</span>&nbsp;<span class="ident" id="4839863">int64</span>
</div>
</body>
</html>
