<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bufio</h2>
<ul>
<li><a href="/gostd/bufio/bufio.go.html" class="current">bufio.go</a></li>
<li><a href="/gostd/bufio/bufio_test.go.html">bufio_test.go</a></li>
<li><a href="/gostd/bufio/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bufio/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bufio/scan.go.html">scan.go</a></li>
<li><a href="/gostd/bufio/scan_test.go.html">scan_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1819645">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1819700">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1819754">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1819805">//&nbsp;Package&nbsp;bufio&nbsp;implements&nbsp;buffered&nbsp;I/O.&nbsp;&nbsp;It&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;or&nbsp;io.Writer</span><br>
<span class="lineno"></span><span class="comment" id="1819883">//&nbsp;object,&nbsp;creating&nbsp;another&nbsp;object&nbsp;(Reader&nbsp;or&nbsp;Writer)&nbsp;that&nbsp;also&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="1819958">//&nbsp;the&nbsp;interface&nbsp;but&nbsp;provides&nbsp;buffering&nbsp;and&nbsp;some&nbsp;help&nbsp;for&nbsp;textual&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="1820029">package</span>&nbsp;<span class="ident" id="1820037">bufio</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1820044">import</span>&nbsp;<span class="op" id="1820051">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1820054">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1820063">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1820073">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1820079">&#34;unicode/utf8&#34;</span><br>
<span class="lineno">15</span><span class="op" id="1820094">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1820097">const</span>&nbsp;<span class="op" id="1820103">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1820106">defaultBufSize</span>&nbsp;<span class="op" id="1820121">=</span>&nbsp;<span class="num" id="1820123">4096</span><br>
<span class="lineno"></span><span class="op" id="1820128">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1820131">var</span>&nbsp;<span class="op" id="1820135">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1820138">ErrInvalidUnreadByte</span>&nbsp;<span class="op" id="1820159">=</span>&nbsp;<span class="ident" id="1820161">errors</span><span class="op" id="1820167">.</span><span class="ident" id="1820168">New</span><span class="op" id="1820171">(</span><span class="string" id="1820172">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadByte&#34;</span><span class="op" id="1820206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1820209">ErrInvalidUnreadRune</span>&nbsp;<span class="op" id="1820230">=</span>&nbsp;<span class="ident" id="1820232">errors</span><span class="op" id="1820238">.</span><span class="ident" id="1820239">New</span><span class="op" id="1820242">(</span><span class="string" id="1820243">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadRune&#34;</span><span class="op" id="1820277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1820280">ErrBufferFull</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1820301">=</span>&nbsp;<span class="ident" id="1820303">errors</span><span class="op" id="1820309">.</span><span class="ident" id="1820310">New</span><span class="op" id="1820313">(</span><span class="string" id="1820314">&#34;bufio:&nbsp;buffer&nbsp;full&#34;</span><span class="op" id="1820334">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1820337">ErrNegativeCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1820358">=</span>&nbsp;<span class="ident" id="1820360">errors</span><span class="op" id="1820366">.</span><span class="ident" id="1820367">New</span><span class="op" id="1820370">(</span><span class="string" id="1820371">&#34;bufio:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="1820394">)</span><br>
<span class="lineno"></span><span class="op" id="1820396">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1820399">//&nbsp;Buffered&nbsp;input.</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="1820419">//&nbsp;Reader&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Reader&nbsp;object.</span><br>
<span class="lineno"></span><span class="keyword" id="1820475">type</span>&nbsp;<span class="ident" id="1820480">Reader</span>&nbsp;<span class="keyword" id="1820487">struct</span>&nbsp;<span class="op" id="1820494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1820497">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1820510">[</span><span class="op" id="1820511">]</span><span class="builtintype" id="1820512">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1820518">rd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1820531">io</span><span class="op" id="1820533">.</span><span class="ident" id="1820534">Reader</span>&nbsp;<span class="comment" id="1820541">//&nbsp;reader&nbsp;provided&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1820575">r</span><span class="op" id="1820576">,</span>&nbsp;<span class="ident" id="1820578">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1820588">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1820598">//&nbsp;buf&nbsp;read&nbsp;and&nbsp;write&nbsp;positions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1820631">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1820644">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1820651">lastByte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1820664">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1820669">lastRuneSize</span>&nbsp;<span class="builtintype" id="1820682">int</span><br>
<span class="lineno"></span><span class="op" id="1820686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1820689">const</span>&nbsp;<span class="ident" id="1820695">minReadBufferSize</span>&nbsp;<span class="op" id="1820713">=</span>&nbsp;<span class="num" id="1820715">16</span><br>
<span class="lineno"></span><span class="keyword" id="1820718">const</span>&nbsp;<span class="ident" id="1820724">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="1820749">=</span>&nbsp;<span class="num" id="1820751">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1820756">//&nbsp;NewReaderSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="1820834">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Reader&nbsp;is&nbsp;already&nbsp;a&nbsp;Reader&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno">45</span><span class="comment" id="1820907">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="1820950">func</span>&nbsp;<span class="ident" id="1820955">NewReaderSize</span><span class="op" id="1820968">(</span><span class="ident" id="1820969">rd</span>&nbsp;<span class="ident" id="1820972">io</span><span class="op" id="1820974">.</span><span class="ident" id="1820975">Reader</span><span class="op" id="1820981">,</span>&nbsp;<span class="ident" id="1820983">size</span>&nbsp;<span class="builtintype" id="1820988">int</span><span class="op" id="1820991">)</span>&nbsp;<span class="op" id="1820993">*</span><span class="ident" id="1820994">Reader</span>&nbsp;<span class="op" id="1821001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1821004">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Reader?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1821032">b</span><span class="op" id="1821033">,</span>&nbsp;<span class="ident" id="1821035">ok</span>&nbsp;<span class="op" id="1821038">:=</span>&nbsp;<span class="ident" id="1821041">rd</span><span class="op" id="1821043">.</span><span class="op" id="1821044">(</span><span class="op" id="1821045">*</span><span class="ident" id="1821046">Reader</span><span class="op" id="1821052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1821055">if</span>&nbsp;<span class="ident" id="1821058">ok</span>&nbsp;<span class="op" id="1821061">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1821064">len</span><span class="op" id="1821067">(</span><span class="ident" id="1821068">b</span><span class="op" id="1821069">.</span><span class="ident" id="1821070">buf</span><span class="op" id="1821073">)</span>&nbsp;<span class="op" id="1821075">&gt;=</span>&nbsp;<span class="ident" id="1821078">size</span>&nbsp;<span class="op" id="1821083">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1821087">return</span>&nbsp;<span class="ident" id="1821094">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1821097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1821100">if</span>&nbsp;<span class="ident" id="1821103">size</span>&nbsp;<span class="op" id="1821108">&lt;</span>&nbsp;<span class="ident" id="1821110">minReadBufferSize</span>&nbsp;<span class="op" id="1821128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1821132">size</span>&nbsp;<span class="op" id="1821137">=</span>&nbsp;<span class="ident" id="1821139">minReadBufferSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1821158">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1821161">r</span>&nbsp;<span class="op" id="1821163">:=</span>&nbsp;<span class="builtinfunc" id="1821166">new</span><span class="op" id="1821169">(</span><span class="ident" id="1821170">Reader</span><span class="op" id="1821176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1821179">r</span><span class="op" id="1821180">.</span><span class="ident" id="1821181">reset</span><span class="op" id="1821186">(</span><span class="builtinfunc" id="1821187">make</span><span class="op" id="1821191">(</span><span class="op" id="1821192">[</span><span class="op" id="1821193">]</span><span class="builtintype" id="1821194">byte</span><span class="op" id="1821198">,</span>&nbsp;<span class="ident" id="1821200">size</span><span class="op" id="1821204">)</span><span class="op" id="1821205">,</span>&nbsp;<span class="ident" id="1821207">rd</span><span class="op" id="1821209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1821212">return</span>&nbsp;<span class="ident" id="1821219">r</span><br>
<span class="lineno"></span><span class="op" id="1821221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="1821224">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="1821293">func</span>&nbsp;<span class="ident" id="1821298">NewReader</span><span class="op" id="1821307">(</span><span class="ident" id="1821308">rd</span>&nbsp;<span class="ident" id="1821311">io</span><span class="op" id="1821313">.</span><span class="ident" id="1821314">Reader</span><span class="op" id="1821320">)</span>&nbsp;<span class="op" id="1821322">*</span><span class="ident" id="1821323">Reader</span>&nbsp;<span class="op" id="1821330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1821333">return</span>&nbsp;<span class="ident" id="1821340">NewReaderSize</span><span class="op" id="1821353">(</span><span class="ident" id="1821354">rd</span><span class="op" id="1821356">,</span>&nbsp;<span class="ident" id="1821358">defaultBufSize</span><span class="op" id="1821372">)</span><br>
<span class="lineno"></span><span class="op" id="1821374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="1821377">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data,&nbsp;resets&nbsp;all&nbsp;state,&nbsp;and&nbsp;switches</span><br>
<span class="lineno"></span><span class="comment" id="1821445">//&nbsp;the&nbsp;buffered&nbsp;reader&nbsp;to&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="1821484">func</span>&nbsp;<span class="op" id="1821489">(</span><span class="ident" id="1821490">b</span>&nbsp;<span class="op" id="1821492">*</span><span class="ident" id="1821493">Reader</span><span class="op" id="1821499">)</span>&nbsp;<span class="ident" id="1821501">Reset</span><span class="op" id="1821506">(</span><span class="ident" id="1821507">r</span>&nbsp;<span class="ident" id="1821509">io</span><span class="op" id="1821511">.</span><span class="ident" id="1821512">Reader</span><span class="op" id="1821518">)</span>&nbsp;<span class="op" id="1821520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1821523">b</span><span class="op" id="1821524">.</span><span class="ident" id="1821525">reset</span><span class="op" id="1821530">(</span><span class="ident" id="1821531">b</span><span class="op" id="1821532">.</span><span class="ident" id="1821533">buf</span><span class="op" id="1821536">,</span>&nbsp;<span class="ident" id="1821538">r</span><span class="op" id="1821539">)</span><br>
<span class="lineno"></span><span class="op" id="1821541">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="1821544">func</span>&nbsp;<span class="op" id="1821549">(</span><span class="ident" id="1821550">b</span>&nbsp;<span class="op" id="1821552">*</span><span class="ident" id="1821553">Reader</span><span class="op" id="1821559">)</span>&nbsp;<span class="ident" id="1821561">reset</span><span class="op" id="1821566">(</span><span class="ident" id="1821567">buf</span>&nbsp;<span class="op" id="1821571">[</span><span class="op" id="1821572">]</span><span class="builtintype" id="1821573">byte</span><span class="op" id="1821577">,</span>&nbsp;<span class="ident" id="1821579">r</span>&nbsp;<span class="ident" id="1821581">io</span><span class="op" id="1821583">.</span><span class="ident" id="1821584">Reader</span><span class="op" id="1821590">)</span>&nbsp;<span class="op" id="1821592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1821595">*</span><span class="ident" id="1821596">b</span>&nbsp;<span class="op" id="1821598">=</span>&nbsp;<span class="ident" id="1821600">Reader</span><span class="op" id="1821606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1821610">buf</span><span class="op" id="1821613">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1821624">buf</span><span class="op" id="1821627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1821631">rd</span><span class="op" id="1821633">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1821645">r</span><span class="op" id="1821646">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1821650">lastByte</span><span class="op" id="1821658">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1821664">-</span><span class="num" id="1821665">1</span><span class="op" id="1821666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1821670">lastRuneSize</span><span class="op" id="1821682">:</span>&nbsp;<span class="op" id="1821684">-</span><span class="num" id="1821685">1</span><span class="op" id="1821686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1821689">}</span><br>
<span class="lineno"></span><span class="op" id="1821691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="1821694">var</span>&nbsp;<span class="ident" id="1821698">errNegativeRead</span>&nbsp;<span class="op" id="1821714">=</span>&nbsp;<span class="ident" id="1821716">errors</span><span class="op" id="1821722">.</span><span class="ident" id="1821723">New</span><span class="op" id="1821726">(</span><span class="string" id="1821727">&#34;bufio:&nbsp;reader&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Read&#34;</span><span class="op" id="1821776">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1821779">//&nbsp;fill&nbsp;reads&nbsp;a&nbsp;new&nbsp;chunk&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1821822">func</span>&nbsp;<span class="op" id="1821827">(</span><span class="ident" id="1821828">b</span>&nbsp;<span class="op" id="1821830">*</span><span class="ident" id="1821831">Reader</span><span class="op" id="1821837">)</span>&nbsp;<span class="ident" id="1821839">fill</span><span class="op" id="1821843">(</span><span class="op" id="1821844">)</span>&nbsp;<span class="op" id="1821846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1821849">//&nbsp;Slide&nbsp;existing&nbsp;data&nbsp;to&nbsp;beginning.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1821887">if</span>&nbsp;<span class="ident" id="1821890">b</span><span class="op" id="1821891">.</span><span class="ident" id="1821892">r</span>&nbsp;<span class="op" id="1821894">&gt;</span>&nbsp;<span class="num" id="1821896">0</span>&nbsp;<span class="op" id="1821898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1821902">copy</span><span class="op" id="1821906">(</span><span class="ident" id="1821907">b</span><span class="op" id="1821908">.</span><span class="ident" id="1821909">buf</span><span class="op" id="1821912">,</span>&nbsp;<span class="ident" id="1821914">b</span><span class="op" id="1821915">.</span><span class="ident" id="1821916">buf</span><span class="op" id="1821919">[</span><span class="ident" id="1821920">b</span><span class="op" id="1821921">.</span><span class="ident" id="1821922">r</span><span class="op" id="1821923">:</span><span class="ident" id="1821924">b</span><span class="op" id="1821925">.</span><span class="ident" id="1821926">w</span><span class="op" id="1821927">]</span><span class="op" id="1821928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1821932">b</span><span class="op" id="1821933">.</span><span class="ident" id="1821934">w</span>&nbsp;<span class="op" id="1821936">-=</span>&nbsp;<span class="ident" id="1821939">b</span><span class="op" id="1821940">.</span><span class="ident" id="1821941">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1821945">b</span><span class="op" id="1821946">.</span><span class="ident" id="1821947">r</span>&nbsp;<span class="op" id="1821949">=</span>&nbsp;<span class="num" id="1821951">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1821954">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1821958">if</span>&nbsp;<span class="ident" id="1821961">b</span><span class="op" id="1821962">.</span><span class="ident" id="1821963">w</span>&nbsp;<span class="op" id="1821965">&gt;=</span>&nbsp;<span class="builtinfunc" id="1821968">len</span><span class="op" id="1821971">(</span><span class="ident" id="1821972">b</span><span class="op" id="1821973">.</span><span class="ident" id="1821974">buf</span><span class="op" id="1821977">)</span>&nbsp;<span class="op" id="1821979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1821983">panic</span><span class="op" id="1821988">(</span><span class="string" id="1821989">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;fill&nbsp;full&nbsp;buffer&#34;</span><span class="op" id="1822023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1822026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1822030">//&nbsp;Read&nbsp;new&nbsp;data:&nbsp;try&nbsp;a&nbsp;limited&nbsp;number&nbsp;of&nbsp;times.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822080">for</span>&nbsp;<span class="ident" id="1822084">i</span>&nbsp;<span class="op" id="1822086">:=</span>&nbsp;<span class="ident" id="1822089">maxConsecutiveEmptyReads</span><span class="op" id="1822113">;</span>&nbsp;<span class="ident" id="1822115">i</span>&nbsp;<span class="op" id="1822117">&gt;</span>&nbsp;<span class="num" id="1822119">0</span><span class="op" id="1822120">;</span>&nbsp;<span class="ident" id="1822122">i</span><span class="op" id="1822123">--</span>&nbsp;<span class="op" id="1822126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1822130">n</span><span class="op" id="1822131">,</span>&nbsp;<span class="ident" id="1822133">err</span>&nbsp;<span class="op" id="1822137">:=</span>&nbsp;<span class="ident" id="1822140">b</span><span class="op" id="1822141">.</span><span class="ident" id="1822142">rd</span><span class="op" id="1822144">.</span><span class="ident" id="1822145">Read</span><span class="op" id="1822149">(</span><span class="ident" id="1822150">b</span><span class="op" id="1822151">.</span><span class="ident" id="1822152">buf</span><span class="op" id="1822155">[</span><span class="ident" id="1822156">b</span><span class="op" id="1822157">.</span><span class="ident" id="1822158">w</span><span class="op" id="1822159">:</span><span class="op" id="1822160">]</span><span class="op" id="1822161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822165">if</span>&nbsp;<span class="ident" id="1822168">n</span>&nbsp;<span class="op" id="1822170">&lt;</span>&nbsp;<span class="num" id="1822172">0</span>&nbsp;<span class="op" id="1822174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1822179">panic</span><span class="op" id="1822184">(</span><span class="ident" id="1822185">errNegativeRead</span><span class="op" id="1822200">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1822204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1822208">b</span><span class="op" id="1822209">.</span><span class="ident" id="1822210">w</span>&nbsp;<span class="op" id="1822212">+=</span>&nbsp;<span class="ident" id="1822215">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822219">if</span>&nbsp;<span class="ident" id="1822222">err</span>&nbsp;<span class="op" id="1822226">!=</span>&nbsp;<span class="builtintype" id="1822229">nil</span>&nbsp;<span class="op" id="1822233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1822238">b</span><span class="op" id="1822239">.</span><span class="ident" id="1822240">err</span>&nbsp;<span class="op" id="1822244">=</span>&nbsp;<span class="ident" id="1822246">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822253">return</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1822262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822266">if</span>&nbsp;<span class="ident" id="1822269">n</span>&nbsp;<span class="op" id="1822271">&gt;</span>&nbsp;<span class="num" id="1822273">0</span>&nbsp;<span class="op" id="1822275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822280">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1822289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1822292">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1822295">b</span><span class="op" id="1822296">.</span><span class="ident" id="1822297">err</span>&nbsp;<span class="op" id="1822301">=</span>&nbsp;<span class="ident" id="1822303">io</span><span class="op" id="1822305">.</span><span class="ident" id="1822306">ErrNoProgress</span><br>
<span class="lineno"></span><span class="op" id="1822320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1822323">func</span>&nbsp;<span class="op" id="1822328">(</span><span class="ident" id="1822329">b</span>&nbsp;<span class="op" id="1822331">*</span><span class="ident" id="1822332">Reader</span><span class="op" id="1822338">)</span>&nbsp;<span class="ident" id="1822340">readErr</span><span class="op" id="1822347">(</span><span class="op" id="1822348">)</span>&nbsp;<span class="builtintype" id="1822350">error</span>&nbsp;<span class="op" id="1822356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1822359">err</span>&nbsp;<span class="op" id="1822363">:=</span>&nbsp;<span class="ident" id="1822366">b</span><span class="op" id="1822367">.</span><span class="ident" id="1822368">err</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1822373">b</span><span class="op" id="1822374">.</span><span class="ident" id="1822375">err</span>&nbsp;<span class="op" id="1822379">=</span>&nbsp;<span class="builtintype" id="1822381">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822386">return</span>&nbsp;<span class="ident" id="1822393">err</span><br>
<span class="lineno"></span><span class="op" id="1822397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1822400">//&nbsp;Peek&nbsp;returns&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;without&nbsp;advancing&nbsp;the&nbsp;reader.&nbsp;The&nbsp;bytes&nbsp;stop</span><br>
<span class="lineno">120</span><span class="comment" id="1822478">//&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read&nbsp;call.&nbsp;If&nbsp;Peek&nbsp;returns&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1822555">//&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining&nbsp;why&nbsp;the&nbsp;read&nbsp;is&nbsp;short.&nbsp;The&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1822627">//&nbsp;ErrBufferFull&nbsp;if&nbsp;n&nbsp;is&nbsp;larger&nbsp;than&nbsp;b&#39;s&nbsp;buffer&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="1822681">func</span>&nbsp;<span class="op" id="1822686">(</span><span class="ident" id="1822687">b</span>&nbsp;<span class="op" id="1822689">*</span><span class="ident" id="1822690">Reader</span><span class="op" id="1822696">)</span>&nbsp;<span class="ident" id="1822698">Peek</span><span class="op" id="1822702">(</span><span class="ident" id="1822703">n</span>&nbsp;<span class="builtintype" id="1822705">int</span><span class="op" id="1822708">)</span>&nbsp;<span class="op" id="1822710">(</span><span class="op" id="1822711">[</span><span class="op" id="1822712">]</span><span class="builtintype" id="1822713">byte</span><span class="op" id="1822717">,</span>&nbsp;<span class="builtintype" id="1822719">error</span><span class="op" id="1822724">)</span>&nbsp;<span class="op" id="1822726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822729">if</span>&nbsp;<span class="ident" id="1822732">n</span>&nbsp;<span class="op" id="1822734">&lt;</span>&nbsp;<span class="num" id="1822736">0</span>&nbsp;<span class="op" id="1822738">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822742">return</span>&nbsp;<span class="builtintype" id="1822749">nil</span><span class="op" id="1822752">,</span>&nbsp;<span class="ident" id="1822754">ErrNegativeCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1822772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822775">if</span>&nbsp;<span class="ident" id="1822778">n</span>&nbsp;<span class="op" id="1822780">&gt;</span>&nbsp;<span class="builtinfunc" id="1822782">len</span><span class="op" id="1822785">(</span><span class="ident" id="1822786">b</span><span class="op" id="1822787">.</span><span class="ident" id="1822788">buf</span><span class="op" id="1822791">)</span>&nbsp;<span class="op" id="1822793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822797">return</span>&nbsp;<span class="builtintype" id="1822804">nil</span><span class="op" id="1822807">,</span>&nbsp;<span class="ident" id="1822809">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1822824">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1822827">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(b.buf)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822852">for</span>&nbsp;<span class="ident" id="1822856">b</span><span class="op" id="1822857">.</span><span class="ident" id="1822858">w</span><span class="op" id="1822859">-</span><span class="ident" id="1822860">b</span><span class="op" id="1822861">.</span><span class="ident" id="1822862">r</span>&nbsp;<span class="op" id="1822864">&lt;</span>&nbsp;<span class="ident" id="1822866">n</span>&nbsp;<span class="op" id="1822868">&amp;&amp;</span>&nbsp;<span class="ident" id="1822871">b</span><span class="op" id="1822872">.</span><span class="ident" id="1822873">err</span>&nbsp;<span class="op" id="1822877">==</span>&nbsp;<span class="builtintype" id="1822880">nil</span>&nbsp;<span class="op" id="1822884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1822888">b</span><span class="op" id="1822889">.</span><span class="ident" id="1822890">fill</span><span class="op" id="1822894">(</span><span class="op" id="1822895">)</span>&nbsp;<span class="comment" id="1822897">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(b.buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1822944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822948">var</span>&nbsp;<span class="ident" id="1822952">err</span>&nbsp;<span class="builtintype" id="1822956">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1822963">if</span>&nbsp;<span class="ident" id="1822966">avail</span>&nbsp;<span class="op" id="1822972">:=</span>&nbsp;<span class="ident" id="1822975">b</span><span class="op" id="1822976">.</span><span class="ident" id="1822977">w</span>&nbsp;<span class="op" id="1822979">-</span>&nbsp;<span class="ident" id="1822981">b</span><span class="op" id="1822982">.</span><span class="ident" id="1822983">r</span><span class="op" id="1822984">;</span>&nbsp;<span class="ident" id="1822986">avail</span>&nbsp;<span class="op" id="1822992">&lt;</span>&nbsp;<span class="ident" id="1822994">n</span>&nbsp;<span class="op" id="1822996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1823000">//&nbsp;not&nbsp;enough&nbsp;data&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1823031">n</span>&nbsp;<span class="op" id="1823033">=</span>&nbsp;<span class="ident" id="1823035">avail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1823043">err</span>&nbsp;<span class="op" id="1823047">=</span>&nbsp;<span class="ident" id="1823049">b</span><span class="op" id="1823050">.</span><span class="ident" id="1823051">readErr</span><span class="op" id="1823058">(</span><span class="op" id="1823059">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1823063">if</span>&nbsp;<span class="ident" id="1823066">err</span>&nbsp;<span class="op" id="1823070">==</span>&nbsp;<span class="builtintype" id="1823073">nil</span>&nbsp;<span class="op" id="1823077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1823082">err</span>&nbsp;<span class="op" id="1823086">=</span>&nbsp;<span class="ident" id="1823088">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1823104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1823107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1823110">return</span>&nbsp;<span class="ident" id="1823117">b</span><span class="op" id="1823118">.</span><span class="ident" id="1823119">buf</span><span class="op" id="1823122">[</span><span class="ident" id="1823123">b</span><span class="op" id="1823124">.</span><span class="ident" id="1823125">r</span>&nbsp;<span class="op" id="1823127">:</span>&nbsp;<span class="ident" id="1823129">b</span><span class="op" id="1823130">.</span><span class="ident" id="1823131">r</span><span class="op" id="1823132">+</span><span class="ident" id="1823133">n</span><span class="op" id="1823134">]</span><span class="op" id="1823135">,</span>&nbsp;<span class="ident" id="1823137">err</span><br>
<span class="lineno">145</span><span class="op" id="1823141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1823144">//&nbsp;Read&nbsp;reads&nbsp;data&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="1823171">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="1823218">//&nbsp;It&nbsp;calls&nbsp;Read&nbsp;at&nbsp;most&nbsp;once&nbsp;on&nbsp;the&nbsp;underlying&nbsp;Reader,</span><br>
<span class="lineno">150</span><span class="comment" id="1823274">//&nbsp;hence&nbsp;n&nbsp;may&nbsp;be&nbsp;less&nbsp;than&nbsp;len(p).</span><br>
<span class="lineno"></span><span class="comment" id="1823310">//&nbsp;At&nbsp;EOF,&nbsp;the&nbsp;count&nbsp;will&nbsp;be&nbsp;zero&nbsp;and&nbsp;err&nbsp;will&nbsp;be&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1823368">func</span>&nbsp;<span class="op" id="1823373">(</span><span class="ident" id="1823374">b</span>&nbsp;<span class="op" id="1823376">*</span><span class="ident" id="1823377">Reader</span><span class="op" id="1823383">)</span>&nbsp;<span class="ident" id="1823385">Read</span><span class="op" id="1823389">(</span><span class="ident" id="1823390">p</span>&nbsp;<span class="op" id="1823392">[</span><span class="op" id="1823393">]</span><span class="builtintype" id="1823394">byte</span><span class="op" id="1823398">)</span>&nbsp;<span class="op" id="1823400">(</span><span class="ident" id="1823401">n</span>&nbsp;<span class="builtintype" id="1823403">int</span><span class="op" id="1823406">,</span>&nbsp;<span class="ident" id="1823408">err</span>&nbsp;<span class="builtintype" id="1823412">error</span><span class="op" id="1823417">)</span>&nbsp;<span class="op" id="1823419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1823422">n</span>&nbsp;<span class="op" id="1823424">=</span>&nbsp;<span class="builtinfunc" id="1823426">len</span><span class="op" id="1823429">(</span><span class="ident" id="1823430">p</span><span class="op" id="1823431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1823434">if</span>&nbsp;<span class="ident" id="1823437">n</span>&nbsp;<span class="op" id="1823439">==</span>&nbsp;<span class="num" id="1823442">0</span>&nbsp;<span class="op" id="1823444">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1823448">return</span>&nbsp;<span class="num" id="1823455">0</span><span class="op" id="1823456">,</span>&nbsp;<span class="ident" id="1823458">b</span><span class="op" id="1823459">.</span><span class="ident" id="1823460">readErr</span><span class="op" id="1823467">(</span><span class="op" id="1823468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1823471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1823474">if</span>&nbsp;<span class="ident" id="1823477">b</span><span class="op" id="1823478">.</span><span class="ident" id="1823479">r</span>&nbsp;<span class="op" id="1823481">==</span>&nbsp;<span class="ident" id="1823484">b</span><span class="op" id="1823485">.</span><span class="ident" id="1823486">w</span>&nbsp;<span class="op" id="1823488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1823492">if</span>&nbsp;<span class="ident" id="1823495">b</span><span class="op" id="1823496">.</span><span class="ident" id="1823497">err</span>&nbsp;<span class="op" id="1823501">!=</span>&nbsp;<span class="builtintype" id="1823504">nil</span>&nbsp;<span class="op" id="1823508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1823513">return</span>&nbsp;<span class="num" id="1823520">0</span><span class="op" id="1823521">,</span>&nbsp;<span class="ident" id="1823523">b</span><span class="op" id="1823524">.</span><span class="ident" id="1823525">readErr</span><span class="op" id="1823532">(</span><span class="op" id="1823533">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1823537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1823541">if</span>&nbsp;<span class="builtinfunc" id="1823544">len</span><span class="op" id="1823547">(</span><span class="ident" id="1823548">p</span><span class="op" id="1823549">)</span>&nbsp;<span class="op" id="1823551">&gt;=</span>&nbsp;<span class="builtinfunc" id="1823554">len</span><span class="op" id="1823557">(</span><span class="ident" id="1823558">b</span><span class="op" id="1823559">.</span><span class="ident" id="1823560">buf</span><span class="op" id="1823563">)</span>&nbsp;<span class="op" id="1823565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1823570">//&nbsp;Large&nbsp;read,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1823602">//&nbsp;Read&nbsp;directly&nbsp;into&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1823644">n</span><span class="op" id="1823645">,</span>&nbsp;<span class="ident" id="1823647">b</span><span class="op" id="1823648">.</span><span class="ident" id="1823649">err</span>&nbsp;<span class="op" id="1823653">=</span>&nbsp;<span class="ident" id="1823655">b</span><span class="op" id="1823656">.</span><span class="ident" id="1823657">rd</span><span class="op" id="1823659">.</span><span class="ident" id="1823660">Read</span><span class="op" id="1823664">(</span><span class="ident" id="1823665">p</span><span class="op" id="1823666">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1823671">if</span>&nbsp;<span class="ident" id="1823674">n</span>&nbsp;<span class="op" id="1823676">&lt;</span>&nbsp;<span class="num" id="1823678">0</span>&nbsp;<span class="op" id="1823680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1823686">panic</span><span class="op" id="1823691">(</span><span class="ident" id="1823692">errNegativeRead</span><span class="op" id="1823707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1823712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1823717">if</span>&nbsp;<span class="ident" id="1823720">n</span>&nbsp;<span class="op" id="1823722">&gt;</span>&nbsp;<span class="num" id="1823724">0</span>&nbsp;<span class="op" id="1823726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1823732">b</span><span class="op" id="1823733">.</span><span class="ident" id="1823734">lastByte</span>&nbsp;<span class="op" id="1823743">=</span>&nbsp;<span class="builtintype" id="1823745">int</span><span class="op" id="1823748">(</span><span class="ident" id="1823749">p</span><span class="op" id="1823750">[</span><span class="ident" id="1823751">n</span><span class="op" id="1823752">-</span><span class="num" id="1823753">1</span><span class="op" id="1823754">]</span><span class="op" id="1823755">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1823761">b</span><span class="op" id="1823762">.</span><span class="ident" id="1823763">lastRuneSize</span>&nbsp;<span class="op" id="1823776">=</span>&nbsp;<span class="op" id="1823778">-</span><span class="num" id="1823779">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1823784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1823789">return</span>&nbsp;<span class="ident" id="1823796">n</span><span class="op" id="1823797">,</span>&nbsp;<span class="ident" id="1823799">b</span><span class="op" id="1823800">.</span><span class="ident" id="1823801">readErr</span><span class="op" id="1823808">(</span><span class="op" id="1823809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1823813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1823817">b</span><span class="op" id="1823818">.</span><span class="ident" id="1823819">fill</span><span class="op" id="1823823">(</span><span class="op" id="1823824">)</span>&nbsp;<span class="comment" id="1823826">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1823847">if</span>&nbsp;<span class="ident" id="1823850">b</span><span class="op" id="1823851">.</span><span class="ident" id="1823852">r</span>&nbsp;<span class="op" id="1823854">==</span>&nbsp;<span class="ident" id="1823857">b</span><span class="op" id="1823858">.</span><span class="ident" id="1823859">w</span>&nbsp;<span class="op" id="1823861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1823866">return</span>&nbsp;<span class="num" id="1823873">0</span><span class="op" id="1823874">,</span>&nbsp;<span class="ident" id="1823876">b</span><span class="op" id="1823877">.</span><span class="ident" id="1823878">readErr</span><span class="op" id="1823885">(</span><span class="op" id="1823886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1823890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1823893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1823897">//&nbsp;copy&nbsp;as&nbsp;much&nbsp;as&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1823924">n</span>&nbsp;<span class="op" id="1823926">=</span>&nbsp;<span class="builtinfunc" id="1823928">copy</span><span class="op" id="1823932">(</span><span class="ident" id="1823933">p</span><span class="op" id="1823934">,</span>&nbsp;<span class="ident" id="1823936">b</span><span class="op" id="1823937">.</span><span class="ident" id="1823938">buf</span><span class="op" id="1823941">[</span><span class="ident" id="1823942">b</span><span class="op" id="1823943">.</span><span class="ident" id="1823944">r</span><span class="op" id="1823945">:</span><span class="ident" id="1823946">b</span><span class="op" id="1823947">.</span><span class="ident" id="1823948">w</span><span class="op" id="1823949">]</span><span class="op" id="1823950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1823953">b</span><span class="op" id="1823954">.</span><span class="ident" id="1823955">r</span>&nbsp;<span class="op" id="1823957">+=</span>&nbsp;<span class="ident" id="1823960">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1823963">b</span><span class="op" id="1823964">.</span><span class="ident" id="1823965">lastByte</span>&nbsp;<span class="op" id="1823974">=</span>&nbsp;<span class="builtintype" id="1823976">int</span><span class="op" id="1823979">(</span><span class="ident" id="1823980">b</span><span class="op" id="1823981">.</span><span class="ident" id="1823982">buf</span><span class="op" id="1823985">[</span><span class="ident" id="1823986">b</span><span class="op" id="1823987">.</span><span class="ident" id="1823988">r</span><span class="op" id="1823989">-</span><span class="num" id="1823990">1</span><span class="op" id="1823991">]</span><span class="op" id="1823992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1823995">b</span><span class="op" id="1823996">.</span><span class="ident" id="1823997">lastRuneSize</span>&nbsp;<span class="op" id="1824010">=</span>&nbsp;<span class="op" id="1824012">-</span><span class="num" id="1824013">1</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1824016">return</span>&nbsp;<span class="ident" id="1824023">n</span><span class="op" id="1824024">,</span>&nbsp;<span class="builtintype" id="1824026">nil</span><br>
<span class="lineno"></span><span class="op" id="1824030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1824033">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="comment" id="1824078">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">190</span><span class="keyword" id="1824124">func</span>&nbsp;<span class="op" id="1824129">(</span><span class="ident" id="1824130">b</span>&nbsp;<span class="op" id="1824132">*</span><span class="ident" id="1824133">Reader</span><span class="op" id="1824139">)</span>&nbsp;<span class="ident" id="1824141">ReadByte</span><span class="op" id="1824149">(</span><span class="op" id="1824150">)</span>&nbsp;<span class="op" id="1824152">(</span><span class="ident" id="1824153">c</span>&nbsp;<span class="builtintype" id="1824155">byte</span><span class="op" id="1824159">,</span>&nbsp;<span class="ident" id="1824161">err</span>&nbsp;<span class="builtintype" id="1824165">error</span><span class="op" id="1824170">)</span>&nbsp;<span class="op" id="1824172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1824175">b</span><span class="op" id="1824176">.</span><span class="ident" id="1824177">lastRuneSize</span>&nbsp;<span class="op" id="1824190">=</span>&nbsp;<span class="op" id="1824192">-</span><span class="num" id="1824193">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1824196">for</span>&nbsp;<span class="ident" id="1824200">b</span><span class="op" id="1824201">.</span><span class="ident" id="1824202">r</span>&nbsp;<span class="op" id="1824204">==</span>&nbsp;<span class="ident" id="1824207">b</span><span class="op" id="1824208">.</span><span class="ident" id="1824209">w</span>&nbsp;<span class="op" id="1824211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1824215">if</span>&nbsp;<span class="ident" id="1824218">b</span><span class="op" id="1824219">.</span><span class="ident" id="1824220">err</span>&nbsp;<span class="op" id="1824224">!=</span>&nbsp;<span class="builtintype" id="1824227">nil</span>&nbsp;<span class="op" id="1824231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1824236">return</span>&nbsp;<span class="num" id="1824243">0</span><span class="op" id="1824244">,</span>&nbsp;<span class="ident" id="1824246">b</span><span class="op" id="1824247">.</span><span class="ident" id="1824248">readErr</span><span class="op" id="1824255">(</span><span class="op" id="1824256">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1824260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1824264">b</span><span class="op" id="1824265">.</span><span class="ident" id="1824266">fill</span><span class="op" id="1824270">(</span><span class="op" id="1824271">)</span>&nbsp;<span class="comment" id="1824273">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1824293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1824296">c</span>&nbsp;<span class="op" id="1824298">=</span>&nbsp;<span class="ident" id="1824300">b</span><span class="op" id="1824301">.</span><span class="ident" id="1824302">buf</span><span class="op" id="1824305">[</span><span class="ident" id="1824306">b</span><span class="op" id="1824307">.</span><span class="ident" id="1824308">r</span><span class="op" id="1824309">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1824312">b</span><span class="op" id="1824313">.</span><span class="ident" id="1824314">r</span><span class="op" id="1824315">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1824319">b</span><span class="op" id="1824320">.</span><span class="ident" id="1824321">lastByte</span>&nbsp;<span class="op" id="1824330">=</span>&nbsp;<span class="builtintype" id="1824332">int</span><span class="op" id="1824335">(</span><span class="ident" id="1824336">c</span><span class="op" id="1824337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1824340">return</span>&nbsp;<span class="ident" id="1824347">c</span><span class="op" id="1824348">,</span>&nbsp;<span class="builtintype" id="1824350">nil</span><br>
<span class="lineno"></span><span class="op" id="1824354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1824357">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte.&nbsp;&nbsp;Only&nbsp;the&nbsp;most&nbsp;recently&nbsp;read&nbsp;byte&nbsp;can&nbsp;be&nbsp;unread.</span><br>
<span class="lineno">205</span><span class="keyword" id="1824443">func</span>&nbsp;<span class="op" id="1824448">(</span><span class="ident" id="1824449">b</span>&nbsp;<span class="op" id="1824451">*</span><span class="ident" id="1824452">Reader</span><span class="op" id="1824458">)</span>&nbsp;<span class="ident" id="1824460">UnreadByte</span><span class="op" id="1824470">(</span><span class="op" id="1824471">)</span>&nbsp;<span class="builtintype" id="1824473">error</span>&nbsp;<span class="op" id="1824479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1824482">if</span>&nbsp;<span class="ident" id="1824485">b</span><span class="op" id="1824486">.</span><span class="ident" id="1824487">lastByte</span>&nbsp;<span class="op" id="1824496">&lt;</span>&nbsp;<span class="num" id="1824498">0</span>&nbsp;<span class="op" id="1824500">||</span>&nbsp;<span class="ident" id="1824503">b</span><span class="op" id="1824504">.</span><span class="ident" id="1824505">r</span>&nbsp;<span class="op" id="1824507">==</span>&nbsp;<span class="num" id="1824510">0</span>&nbsp;<span class="op" id="1824512">&amp;&amp;</span>&nbsp;<span class="ident" id="1824515">b</span><span class="op" id="1824516">.</span><span class="ident" id="1824517">w</span>&nbsp;<span class="op" id="1824519">&gt;</span>&nbsp;<span class="num" id="1824521">0</span>&nbsp;<span class="op" id="1824523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1824527">return</span>&nbsp;<span class="ident" id="1824534">ErrInvalidUnreadByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1824556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1824559">//&nbsp;b.r&nbsp;&gt;&nbsp;0&nbsp;||&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1824583">if</span>&nbsp;<span class="ident" id="1824586">b</span><span class="op" id="1824587">.</span><span class="ident" id="1824588">r</span>&nbsp;<span class="op" id="1824590">&gt;</span>&nbsp;<span class="num" id="1824592">0</span>&nbsp;<span class="op" id="1824594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1824598">b</span><span class="op" id="1824599">.</span><span class="ident" id="1824600">r</span><span class="op" id="1824601">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1824605">}</span>&nbsp;<span class="keyword" id="1824607">else</span>&nbsp;<span class="op" id="1824612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1824616">//&nbsp;b.r&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1824642">b</span><span class="op" id="1824643">.</span><span class="ident" id="1824644">w</span>&nbsp;<span class="op" id="1824646">=</span>&nbsp;<span class="num" id="1824648">1</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1824651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1824654">b</span><span class="op" id="1824655">.</span><span class="ident" id="1824656">buf</span><span class="op" id="1824659">[</span><span class="ident" id="1824660">b</span><span class="op" id="1824661">.</span><span class="ident" id="1824662">r</span><span class="op" id="1824663">]</span>&nbsp;<span class="op" id="1824665">=</span>&nbsp;<span class="builtintype" id="1824667">byte</span><span class="op" id="1824671">(</span><span class="ident" id="1824672">b</span><span class="op" id="1824673">.</span><span class="ident" id="1824674">lastByte</span><span class="op" id="1824682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1824685">b</span><span class="op" id="1824686">.</span><span class="ident" id="1824687">lastByte</span>&nbsp;<span class="op" id="1824696">=</span>&nbsp;<span class="op" id="1824698">-</span><span class="num" id="1824699">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1824702">b</span><span class="op" id="1824703">.</span><span class="ident" id="1824704">lastRuneSize</span>&nbsp;<span class="op" id="1824717">=</span>&nbsp;<span class="op" id="1824719">-</span><span class="num" id="1824720">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1824723">return</span>&nbsp;<span class="builtintype" id="1824730">nil</span><br>
<span class="lineno">220</span><span class="op" id="1824734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1824737">//&nbsp;ReadRune&nbsp;reads&nbsp;a&nbsp;single&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character&nbsp;and&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1824812">//&nbsp;rune&nbsp;and&nbsp;its&nbsp;size&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;the&nbsp;encoded&nbsp;rune&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;consumes&nbsp;one&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="1824896">//&nbsp;and&nbsp;returns&nbsp;unicode.ReplacementChar&nbsp;(U+FFFD)&nbsp;with&nbsp;a&nbsp;size&nbsp;of&nbsp;1.</span><br>
<span class="lineno">225</span><span class="keyword" id="1824962">func</span>&nbsp;<span class="op" id="1824967">(</span><span class="ident" id="1824968">b</span>&nbsp;<span class="op" id="1824970">*</span><span class="ident" id="1824971">Reader</span><span class="op" id="1824977">)</span>&nbsp;<span class="ident" id="1824979">ReadRune</span><span class="op" id="1824987">(</span><span class="op" id="1824988">)</span>&nbsp;<span class="op" id="1824990">(</span><span class="ident" id="1824991">r</span>&nbsp;<span class="builtintype" id="1824993">rune</span><span class="op" id="1824997">,</span>&nbsp;<span class="ident" id="1824999">size</span>&nbsp;<span class="builtintype" id="1825004">int</span><span class="op" id="1825007">,</span>&nbsp;<span class="ident" id="1825009">err</span>&nbsp;<span class="builtintype" id="1825013">error</span><span class="op" id="1825018">)</span>&nbsp;<span class="op" id="1825020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1825023">for</span>&nbsp;<span class="ident" id="1825027">b</span><span class="op" id="1825028">.</span><span class="ident" id="1825029">r</span><span class="op" id="1825030">+</span><span class="ident" id="1825031">utf8</span><span class="op" id="1825035">.</span><span class="ident" id="1825036">UTFMax</span>&nbsp;<span class="op" id="1825043">&gt;</span>&nbsp;<span class="ident" id="1825045">b</span><span class="op" id="1825046">.</span><span class="ident" id="1825047">w</span>&nbsp;<span class="op" id="1825049">&amp;&amp;</span>&nbsp;<span class="op" id="1825052">!</span><span class="ident" id="1825053">utf8</span><span class="op" id="1825057">.</span><span class="ident" id="1825058">FullRune</span><span class="op" id="1825066">(</span><span class="ident" id="1825067">b</span><span class="op" id="1825068">.</span><span class="ident" id="1825069">buf</span><span class="op" id="1825072">[</span><span class="ident" id="1825073">b</span><span class="op" id="1825074">.</span><span class="ident" id="1825075">r</span><span class="op" id="1825076">:</span><span class="ident" id="1825077">b</span><span class="op" id="1825078">.</span><span class="ident" id="1825079">w</span><span class="op" id="1825080">]</span><span class="op" id="1825081">)</span>&nbsp;<span class="op" id="1825083">&amp;&amp;</span>&nbsp;<span class="ident" id="1825086">b</span><span class="op" id="1825087">.</span><span class="ident" id="1825088">err</span>&nbsp;<span class="op" id="1825092">==</span>&nbsp;<span class="builtintype" id="1825095">nil</span>&nbsp;<span class="op" id="1825099">&amp;&amp;</span>&nbsp;<span class="ident" id="1825102">b</span><span class="op" id="1825103">.</span><span class="ident" id="1825104">w</span><span class="op" id="1825105">-</span><span class="ident" id="1825106">b</span><span class="op" id="1825107">.</span><span class="ident" id="1825108">r</span>&nbsp;<span class="op" id="1825110">&lt;</span>&nbsp;<span class="builtinfunc" id="1825112">len</span><span class="op" id="1825115">(</span><span class="ident" id="1825116">b</span><span class="op" id="1825117">.</span><span class="ident" id="1825118">buf</span><span class="op" id="1825121">)</span>&nbsp;<span class="op" id="1825123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1825127">b</span><span class="op" id="1825128">.</span><span class="ident" id="1825129">fill</span><span class="op" id="1825133">(</span><span class="op" id="1825134">)</span>&nbsp;<span class="comment" id="1825136">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1825181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1825184">b</span><span class="op" id="1825185">.</span><span class="ident" id="1825186">lastRuneSize</span>&nbsp;<span class="op" id="1825199">=</span>&nbsp;<span class="op" id="1825201">-</span><span class="num" id="1825202">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1825205">if</span>&nbsp;<span class="ident" id="1825208">b</span><span class="op" id="1825209">.</span><span class="ident" id="1825210">r</span>&nbsp;<span class="op" id="1825212">==</span>&nbsp;<span class="ident" id="1825215">b</span><span class="op" id="1825216">.</span><span class="ident" id="1825217">w</span>&nbsp;<span class="op" id="1825219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1825223">return</span>&nbsp;<span class="num" id="1825230">0</span><span class="op" id="1825231">,</span>&nbsp;<span class="num" id="1825233">0</span><span class="op" id="1825234">,</span>&nbsp;<span class="ident" id="1825236">b</span><span class="op" id="1825237">.</span><span class="ident" id="1825238">readErr</span><span class="op" id="1825245">(</span><span class="op" id="1825246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1825249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1825252">r</span><span class="op" id="1825253">,</span>&nbsp;<span class="ident" id="1825255">size</span>&nbsp;<span class="op" id="1825260">=</span>&nbsp;<span class="builtintype" id="1825262">rune</span><span class="op" id="1825266">(</span><span class="ident" id="1825267">b</span><span class="op" id="1825268">.</span><span class="ident" id="1825269">buf</span><span class="op" id="1825272">[</span><span class="ident" id="1825273">b</span><span class="op" id="1825274">.</span><span class="ident" id="1825275">r</span><span class="op" id="1825276">]</span><span class="op" id="1825277">)</span><span class="op" id="1825278">,</span>&nbsp;<span class="num" id="1825280">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1825283">if</span>&nbsp;<span class="ident" id="1825286">r</span>&nbsp;<span class="op" id="1825288">&gt;=</span>&nbsp;<span class="num" id="1825291">0x80</span>&nbsp;<span class="op" id="1825296">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1825300">r</span><span class="op" id="1825301">,</span>&nbsp;<span class="ident" id="1825303">size</span>&nbsp;<span class="op" id="1825308">=</span>&nbsp;<span class="ident" id="1825310">utf8</span><span class="op" id="1825314">.</span><span class="ident" id="1825315">DecodeRune</span><span class="op" id="1825325">(</span><span class="ident" id="1825326">b</span><span class="op" id="1825327">.</span><span class="ident" id="1825328">buf</span><span class="op" id="1825331">[</span><span class="ident" id="1825332">b</span><span class="op" id="1825333">.</span><span class="ident" id="1825334">r</span><span class="op" id="1825335">:</span><span class="ident" id="1825336">b</span><span class="op" id="1825337">.</span><span class="ident" id="1825338">w</span><span class="op" id="1825339">]</span><span class="op" id="1825340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1825343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1825346">b</span><span class="op" id="1825347">.</span><span class="ident" id="1825348">r</span>&nbsp;<span class="op" id="1825350">+=</span>&nbsp;<span class="ident" id="1825353">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1825359">b</span><span class="op" id="1825360">.</span><span class="ident" id="1825361">lastByte</span>&nbsp;<span class="op" id="1825370">=</span>&nbsp;<span class="builtintype" id="1825372">int</span><span class="op" id="1825375">(</span><span class="ident" id="1825376">b</span><span class="op" id="1825377">.</span><span class="ident" id="1825378">buf</span><span class="op" id="1825381">[</span><span class="ident" id="1825382">b</span><span class="op" id="1825383">.</span><span class="ident" id="1825384">r</span><span class="op" id="1825385">-</span><span class="num" id="1825386">1</span><span class="op" id="1825387">]</span><span class="op" id="1825388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1825391">b</span><span class="op" id="1825392">.</span><span class="ident" id="1825393">lastRuneSize</span>&nbsp;<span class="op" id="1825406">=</span>&nbsp;<span class="ident" id="1825408">size</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1825414">return</span>&nbsp;<span class="ident" id="1825421">r</span><span class="op" id="1825422">,</span>&nbsp;<span class="ident" id="1825424">size</span><span class="op" id="1825428">,</span>&nbsp;<span class="builtintype" id="1825430">nil</span><br>
<span class="lineno"></span><span class="op" id="1825434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1825437">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune.&nbsp;&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;operation&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1825512">//&nbsp;the&nbsp;buffer&nbsp;was&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this</span><br>
<span class="lineno">245</span><span class="comment" id="1825585">//&nbsp;regard&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="1825659">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno"></span><span class="keyword" id="1825688">func</span>&nbsp;<span class="op" id="1825693">(</span><span class="ident" id="1825694">b</span>&nbsp;<span class="op" id="1825696">*</span><span class="ident" id="1825697">Reader</span><span class="op" id="1825703">)</span>&nbsp;<span class="ident" id="1825705">UnreadRune</span><span class="op" id="1825715">(</span><span class="op" id="1825716">)</span>&nbsp;<span class="builtintype" id="1825718">error</span>&nbsp;<span class="op" id="1825724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1825727">if</span>&nbsp;<span class="ident" id="1825730">b</span><span class="op" id="1825731">.</span><span class="ident" id="1825732">lastRuneSize</span>&nbsp;<span class="op" id="1825745">&lt;</span>&nbsp;<span class="num" id="1825747">0</span>&nbsp;<span class="op" id="1825749">||</span>&nbsp;<span class="ident" id="1825752">b</span><span class="op" id="1825753">.</span><span class="ident" id="1825754">r</span>&nbsp;<span class="op" id="1825756">&lt;</span>&nbsp;<span class="ident" id="1825758">b</span><span class="op" id="1825759">.</span><span class="ident" id="1825760">lastRuneSize</span>&nbsp;<span class="op" id="1825773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1825777">return</span>&nbsp;<span class="ident" id="1825784">ErrInvalidUnreadRune</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1825806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1825809">b</span><span class="op" id="1825810">.</span><span class="ident" id="1825811">r</span>&nbsp;<span class="op" id="1825813">-=</span>&nbsp;<span class="ident" id="1825816">b</span><span class="op" id="1825817">.</span><span class="ident" id="1825818">lastRuneSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1825832">b</span><span class="op" id="1825833">.</span><span class="ident" id="1825834">lastByte</span>&nbsp;<span class="op" id="1825843">=</span>&nbsp;<span class="op" id="1825845">-</span><span class="num" id="1825846">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1825849">b</span><span class="op" id="1825850">.</span><span class="ident" id="1825851">lastRuneSize</span>&nbsp;<span class="op" id="1825864">=</span>&nbsp;<span class="op" id="1825866">-</span><span class="num" id="1825867">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1825870">return</span>&nbsp;<span class="builtintype" id="1825877">nil</span><br>
<span class="lineno">255</span><span class="op" id="1825881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1825884">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;from&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1825966">func</span>&nbsp;<span class="op" id="1825971">(</span><span class="ident" id="1825972">b</span>&nbsp;<span class="op" id="1825974">*</span><span class="ident" id="1825975">Reader</span><span class="op" id="1825981">)</span>&nbsp;<span class="ident" id="1825983">Buffered</span><span class="op" id="1825991">(</span><span class="op" id="1825992">)</span>&nbsp;<span class="builtintype" id="1825994">int</span>&nbsp;<span class="op" id="1825998">{</span>&nbsp;<span class="keyword" id="1826000">return</span>&nbsp;<span class="ident" id="1826007">b</span><span class="op" id="1826008">.</span><span class="ident" id="1826009">w</span>&nbsp;<span class="op" id="1826011">-</span>&nbsp;<span class="ident" id="1826013">b</span><span class="op" id="1826014">.</span><span class="ident" id="1826015">r</span>&nbsp;<span class="op" id="1826017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="1826020">//&nbsp;ReadSlice&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="1826089">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;pointing&nbsp;at&nbsp;the&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1826147">//&nbsp;The&nbsp;bytes&nbsp;stop&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read.</span><br>
<span class="lineno"></span><span class="comment" id="1826195">//&nbsp;If&nbsp;ReadSlice&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1826259">//&nbsp;it&nbsp;returns&nbsp;all&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">265</span><span class="comment" id="1826337">//&nbsp;ReadSlice&nbsp;fails&nbsp;with&nbsp;error&nbsp;ErrBufferFull&nbsp;if&nbsp;the&nbsp;buffer&nbsp;fills&nbsp;without&nbsp;a&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="1826418">//&nbsp;Because&nbsp;the&nbsp;data&nbsp;returned&nbsp;from&nbsp;ReadSlice&nbsp;will&nbsp;be&nbsp;overwritten</span><br>
<span class="lineno"></span><span class="comment" id="1826482">//&nbsp;by&nbsp;the&nbsp;next&nbsp;I/O&nbsp;operation,&nbsp;most&nbsp;clients&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="1826536">//&nbsp;ReadBytes&nbsp;or&nbsp;ReadString&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="1826572">//&nbsp;ReadSlice&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;line&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">270</span><span class="keyword" id="1826647">func</span>&nbsp;<span class="op" id="1826652">(</span><span class="ident" id="1826653">b</span>&nbsp;<span class="op" id="1826655">*</span><span class="ident" id="1826656">Reader</span><span class="op" id="1826662">)</span>&nbsp;<span class="ident" id="1826664">ReadSlice</span><span class="op" id="1826673">(</span><span class="ident" id="1826674">delim</span>&nbsp;<span class="builtintype" id="1826680">byte</span><span class="op" id="1826684">)</span>&nbsp;<span class="op" id="1826686">(</span><span class="ident" id="1826687">line</span>&nbsp;<span class="op" id="1826692">[</span><span class="op" id="1826693">]</span><span class="builtintype" id="1826694">byte</span><span class="op" id="1826698">,</span>&nbsp;<span class="ident" id="1826700">err</span>&nbsp;<span class="builtintype" id="1826704">error</span><span class="op" id="1826709">)</span>&nbsp;<span class="op" id="1826711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1826714">for</span>&nbsp;<span class="op" id="1826718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1826722">//&nbsp;Search&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1826742">if</span>&nbsp;<span class="ident" id="1826745">i</span>&nbsp;<span class="op" id="1826747">:=</span>&nbsp;<span class="ident" id="1826750">bytes</span><span class="op" id="1826755">.</span><span class="ident" id="1826756">IndexByte</span><span class="op" id="1826765">(</span><span class="ident" id="1826766">b</span><span class="op" id="1826767">.</span><span class="ident" id="1826768">buf</span><span class="op" id="1826771">[</span><span class="ident" id="1826772">b</span><span class="op" id="1826773">.</span><span class="ident" id="1826774">r</span><span class="op" id="1826775">:</span><span class="ident" id="1826776">b</span><span class="op" id="1826777">.</span><span class="ident" id="1826778">w</span><span class="op" id="1826779">]</span><span class="op" id="1826780">,</span>&nbsp;<span class="ident" id="1826782">delim</span><span class="op" id="1826787">)</span><span class="op" id="1826788">;</span>&nbsp;<span class="ident" id="1826790">i</span>&nbsp;<span class="op" id="1826792">&gt;=</span>&nbsp;<span class="num" id="1826795">0</span>&nbsp;<span class="op" id="1826797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1826802">line</span>&nbsp;<span class="op" id="1826807">=</span>&nbsp;<span class="ident" id="1826809">b</span><span class="op" id="1826810">.</span><span class="ident" id="1826811">buf</span><span class="op" id="1826814">[</span><span class="ident" id="1826815">b</span><span class="op" id="1826816">.</span><span class="ident" id="1826817">r</span>&nbsp;<span class="op" id="1826819">:</span>&nbsp;<span class="ident" id="1826821">b</span><span class="op" id="1826822">.</span><span class="ident" id="1826823">r</span><span class="op" id="1826824">+</span><span class="ident" id="1826825">i</span><span class="op" id="1826826">+</span><span class="num" id="1826827">1</span><span class="op" id="1826828">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1826833">b</span><span class="op" id="1826834">.</span><span class="ident" id="1826835">r</span>&nbsp;<span class="op" id="1826837">+=</span>&nbsp;<span class="ident" id="1826840">i</span>&nbsp;<span class="op" id="1826842">+</span>&nbsp;<span class="num" id="1826844">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1826849">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1826857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1826862">//&nbsp;Pending&nbsp;error?</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1826882">if</span>&nbsp;<span class="ident" id="1826885">b</span><span class="op" id="1826886">.</span><span class="ident" id="1826887">err</span>&nbsp;<span class="op" id="1826891">!=</span>&nbsp;<span class="builtintype" id="1826894">nil</span>&nbsp;<span class="op" id="1826898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1826903">line</span>&nbsp;<span class="op" id="1826908">=</span>&nbsp;<span class="ident" id="1826910">b</span><span class="op" id="1826911">.</span><span class="ident" id="1826912">buf</span><span class="op" id="1826915">[</span><span class="ident" id="1826916">b</span><span class="op" id="1826917">.</span><span class="ident" id="1826918">r</span><span class="op" id="1826919">:</span><span class="ident" id="1826920">b</span><span class="op" id="1826921">.</span><span class="ident" id="1826922">w</span><span class="op" id="1826923">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1826928">b</span><span class="op" id="1826929">.</span><span class="ident" id="1826930">r</span>&nbsp;<span class="op" id="1826932">=</span>&nbsp;<span class="ident" id="1826934">b</span><span class="op" id="1826935">.</span><span class="ident" id="1826936">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1826941">err</span>&nbsp;<span class="op" id="1826945">=</span>&nbsp;<span class="ident" id="1826947">b</span><span class="op" id="1826948">.</span><span class="ident" id="1826949">readErr</span><span class="op" id="1826956">(</span><span class="op" id="1826957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1826962">break</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1826970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1826975">//&nbsp;Buffer&nbsp;full?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1826993">if</span>&nbsp;<span class="ident" id="1826996">b</span><span class="op" id="1826997">.</span><span class="ident" id="1826998">Buffered</span><span class="op" id="1827006">(</span><span class="op" id="1827007">)</span>&nbsp;<span class="op" id="1827009">&gt;=</span>&nbsp;<span class="builtinfunc" id="1827012">len</span><span class="op" id="1827015">(</span><span class="ident" id="1827016">b</span><span class="op" id="1827017">.</span><span class="ident" id="1827018">buf</span><span class="op" id="1827021">)</span>&nbsp;<span class="op" id="1827023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1827028">b</span><span class="op" id="1827029">.</span><span class="ident" id="1827030">r</span>&nbsp;<span class="op" id="1827032">=</span>&nbsp;<span class="ident" id="1827034">b</span><span class="op" id="1827035">.</span><span class="ident" id="1827036">w</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1827041">line</span>&nbsp;<span class="op" id="1827046">=</span>&nbsp;<span class="ident" id="1827048">b</span><span class="op" id="1827049">.</span><span class="ident" id="1827050">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1827057">err</span>&nbsp;<span class="op" id="1827061">=</span>&nbsp;<span class="ident" id="1827063">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1827080">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1827088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1827093">b</span><span class="op" id="1827094">.</span><span class="ident" id="1827095">fill</span><span class="op" id="1827099">(</span><span class="op" id="1827100">)</span>&nbsp;<span class="comment" id="1827102">//&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1827125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1827129">//&nbsp;Handle&nbsp;last&nbsp;byte,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1827159">if</span>&nbsp;<span class="ident" id="1827162">i</span>&nbsp;<span class="op" id="1827164">:=</span>&nbsp;<span class="builtinfunc" id="1827167">len</span><span class="op" id="1827170">(</span><span class="ident" id="1827171">line</span><span class="op" id="1827175">)</span>&nbsp;<span class="op" id="1827177">-</span>&nbsp;<span class="num" id="1827179">1</span><span class="op" id="1827180">;</span>&nbsp;<span class="ident" id="1827182">i</span>&nbsp;<span class="op" id="1827184">&gt;=</span>&nbsp;<span class="num" id="1827187">0</span>&nbsp;<span class="op" id="1827189">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1827193">b</span><span class="op" id="1827194">.</span><span class="ident" id="1827195">lastByte</span>&nbsp;<span class="op" id="1827204">=</span>&nbsp;<span class="builtintype" id="1827206">int</span><span class="op" id="1827209">(</span><span class="ident" id="1827210">line</span><span class="op" id="1827214">[</span><span class="ident" id="1827215">i</span><span class="op" id="1827216">]</span><span class="op" id="1827217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1827221">b</span><span class="op" id="1827222">.</span><span class="ident" id="1827223">lastRuneSize</span>&nbsp;<span class="op" id="1827236">=</span>&nbsp;<span class="op" id="1827238">-</span><span class="num" id="1827239">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1827242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1827246">return</span><br>
<span class="lineno">305</span><span class="op" id="1827253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1827256">//&nbsp;ReadLine&nbsp;is&nbsp;a&nbsp;low-level&nbsp;line-reading&nbsp;primitive.&nbsp;Most&nbsp;callers&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="1827331">//&nbsp;ReadBytes(&#39;\n&#39;)&nbsp;or&nbsp;ReadString(&#39;\n&#39;)&nbsp;instead&nbsp;or&nbsp;use&nbsp;a&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="comment" id="1827396">//</span><br>
<span class="lineno">310</span><span class="comment" id="1827399">//&nbsp;ReadLine&nbsp;tries&nbsp;to&nbsp;return&nbsp;a&nbsp;single&nbsp;line,&nbsp;not&nbsp;including&nbsp;the&nbsp;end-of-line&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1827479">//&nbsp;If&nbsp;the&nbsp;line&nbsp;was&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;buffer&nbsp;then&nbsp;isPrefix&nbsp;is&nbsp;set&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1827551">//&nbsp;beginning&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;returned.&nbsp;The&nbsp;rest&nbsp;of&nbsp;the&nbsp;line&nbsp;will&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="1827627">//&nbsp;from&nbsp;future&nbsp;calls.&nbsp;isPrefix&nbsp;will&nbsp;be&nbsp;false&nbsp;when&nbsp;returning&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span><span class="comment" id="1827705">//&nbsp;of&nbsp;the&nbsp;line.&nbsp;The&nbsp;returned&nbsp;buffer&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to</span><br>
<span class="lineno">315</span><span class="comment" id="1827778">//&nbsp;ReadLine.&nbsp;ReadLine&nbsp;either&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;line&nbsp;or&nbsp;it&nbsp;returns&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="1827854">//&nbsp;never&nbsp;both.</span><br>
<span class="lineno"></span><span class="comment" id="1827869">//</span><br>
<span class="lineno"></span><span class="comment" id="1827872">//&nbsp;The&nbsp;text&nbsp;returned&nbsp;from&nbsp;ReadLine&nbsp;does&nbsp;not&nbsp;include&nbsp;the&nbsp;line&nbsp;end&nbsp;(&#34;\r\n&#34;&nbsp;or&nbsp;&#34;\n&#34;).</span><br>
<span class="lineno"></span><span class="comment" id="1827955">//&nbsp;No&nbsp;indication&nbsp;or&nbsp;error&nbsp;is&nbsp;given&nbsp;if&nbsp;the&nbsp;input&nbsp;ends&nbsp;without&nbsp;a&nbsp;final&nbsp;line&nbsp;end.</span><br>
<span class="lineno">320</span><span class="comment" id="1828034">//&nbsp;Calling&nbsp;UnreadByte&nbsp;after&nbsp;ReadLine&nbsp;will&nbsp;always&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="1828109">//&nbsp;(possibly&nbsp;a&nbsp;character&nbsp;belonging&nbsp;to&nbsp;the&nbsp;line&nbsp;end)&nbsp;even&nbsp;if&nbsp;that&nbsp;byte&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1828186">//&nbsp;part&nbsp;of&nbsp;the&nbsp;line&nbsp;returned&nbsp;by&nbsp;ReadLine.</span><br>
<span class="lineno"></span><span class="keyword" id="1828228">func</span>&nbsp;<span class="op" id="1828233">(</span><span class="ident" id="1828234">b</span>&nbsp;<span class="op" id="1828236">*</span><span class="ident" id="1828237">Reader</span><span class="op" id="1828243">)</span>&nbsp;<span class="ident" id="1828245">ReadLine</span><span class="op" id="1828253">(</span><span class="op" id="1828254">)</span>&nbsp;<span class="op" id="1828256">(</span><span class="ident" id="1828257">line</span>&nbsp;<span class="op" id="1828262">[</span><span class="op" id="1828263">]</span><span class="builtintype" id="1828264">byte</span><span class="op" id="1828268">,</span>&nbsp;<span class="ident" id="1828270">isPrefix</span>&nbsp;<span class="builtintype" id="1828279">bool</span><span class="op" id="1828283">,</span>&nbsp;<span class="ident" id="1828285">err</span>&nbsp;<span class="builtintype" id="1828289">error</span><span class="op" id="1828294">)</span>&nbsp;<span class="op" id="1828296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1828299">line</span><span class="op" id="1828303">,</span>&nbsp;<span class="ident" id="1828305">err</span>&nbsp;<span class="op" id="1828309">=</span>&nbsp;<span class="ident" id="1828311">b</span><span class="op" id="1828312">.</span><span class="ident" id="1828313">ReadSlice</span><span class="op" id="1828322">(</span><span class="string" id="1828323">&#39;\n&#39;</span><span class="op" id="1828327">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1828330">if</span>&nbsp;<span class="ident" id="1828333">err</span>&nbsp;<span class="op" id="1828337">==</span>&nbsp;<span class="ident" id="1828340">ErrBufferFull</span>&nbsp;<span class="op" id="1828354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1828358">//&nbsp;Handle&nbsp;the&nbsp;case&nbsp;where&nbsp;&#34;\r\n&#34;&nbsp;straddles&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1828414">if</span>&nbsp;<span class="builtinfunc" id="1828417">len</span><span class="op" id="1828420">(</span><span class="ident" id="1828421">line</span><span class="op" id="1828425">)</span>&nbsp;<span class="op" id="1828427">&gt;</span>&nbsp;<span class="num" id="1828429">0</span>&nbsp;<span class="op" id="1828431">&amp;&amp;</span>&nbsp;<span class="ident" id="1828434">line</span><span class="op" id="1828438">[</span><span class="builtinfunc" id="1828439">len</span><span class="op" id="1828442">(</span><span class="ident" id="1828443">line</span><span class="op" id="1828447">)</span><span class="op" id="1828448">-</span><span class="num" id="1828449">1</span><span class="op" id="1828450">]</span>&nbsp;<span class="op" id="1828452">==</span>&nbsp;<span class="string" id="1828455">&#39;\r&#39;</span>&nbsp;<span class="op" id="1828460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1828465">//&nbsp;Put&nbsp;the&nbsp;&#39;\r&#39;&nbsp;back&nbsp;on&nbsp;buf&nbsp;and&nbsp;drop&nbsp;it&nbsp;from&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1828519">//&nbsp;Let&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;ReadLine&nbsp;check&nbsp;for&nbsp;&#34;\r\n&#34;.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1828573">if</span>&nbsp;<span class="ident" id="1828576">b</span><span class="op" id="1828577">.</span><span class="ident" id="1828578">r</span>&nbsp;<span class="op" id="1828580">==</span>&nbsp;<span class="num" id="1828583">0</span>&nbsp;<span class="op" id="1828585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1828591">//&nbsp;should&nbsp;be&nbsp;unreachable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1828620">panic</span><span class="op" id="1828625">(</span><span class="string" id="1828626">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;rewind&nbsp;past&nbsp;start&nbsp;of&nbsp;buffer&#34;</span><span class="op" id="1828671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1828676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1828681">b</span><span class="op" id="1828682">.</span><span class="ident" id="1828683">r</span><span class="op" id="1828684">--</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1828690">line</span>&nbsp;<span class="op" id="1828695">=</span>&nbsp;<span class="ident" id="1828697">line</span><span class="op" id="1828701">[</span><span class="op" id="1828702">:</span><span class="builtinfunc" id="1828703">len</span><span class="op" id="1828706">(</span><span class="ident" id="1828707">line</span><span class="op" id="1828711">)</span><span class="op" id="1828712">-</span><span class="num" id="1828713">1</span><span class="op" id="1828714">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1828718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1828722">return</span>&nbsp;<span class="ident" id="1828729">line</span><span class="op" id="1828733">,</span>&nbsp;<span class="builtintype" id="1828735">true</span><span class="op" id="1828739">,</span>&nbsp;<span class="builtintype" id="1828741">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1828746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1828750">if</span>&nbsp;<span class="builtinfunc" id="1828753">len</span><span class="op" id="1828756">(</span><span class="ident" id="1828757">line</span><span class="op" id="1828761">)</span>&nbsp;<span class="op" id="1828763">==</span>&nbsp;<span class="num" id="1828766">0</span>&nbsp;<span class="op" id="1828768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1828772">if</span>&nbsp;<span class="ident" id="1828775">err</span>&nbsp;<span class="op" id="1828779">!=</span>&nbsp;<span class="builtintype" id="1828782">nil</span>&nbsp;<span class="op" id="1828786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1828791">line</span>&nbsp;<span class="op" id="1828796">=</span>&nbsp;<span class="builtintype" id="1828798">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1828804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1828808">return</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1828816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1828819">err</span>&nbsp;<span class="op" id="1828823">=</span>&nbsp;<span class="builtintype" id="1828825">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1828831">if</span>&nbsp;<span class="ident" id="1828834">line</span><span class="op" id="1828838">[</span><span class="builtinfunc" id="1828839">len</span><span class="op" id="1828842">(</span><span class="ident" id="1828843">line</span><span class="op" id="1828847">)</span><span class="op" id="1828848">-</span><span class="num" id="1828849">1</span><span class="op" id="1828850">]</span>&nbsp;<span class="op" id="1828852">==</span>&nbsp;<span class="string" id="1828855">&#39;\n&#39;</span>&nbsp;<span class="op" id="1828860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1828864">drop</span>&nbsp;<span class="op" id="1828869">:=</span>&nbsp;<span class="num" id="1828872">1</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1828876">if</span>&nbsp;<span class="builtinfunc" id="1828879">len</span><span class="op" id="1828882">(</span><span class="ident" id="1828883">line</span><span class="op" id="1828887">)</span>&nbsp;<span class="op" id="1828889">&gt;</span>&nbsp;<span class="num" id="1828891">1</span>&nbsp;<span class="op" id="1828893">&amp;&amp;</span>&nbsp;<span class="ident" id="1828896">line</span><span class="op" id="1828900">[</span><span class="builtinfunc" id="1828901">len</span><span class="op" id="1828904">(</span><span class="ident" id="1828905">line</span><span class="op" id="1828909">)</span><span class="op" id="1828910">-</span><span class="num" id="1828911">2</span><span class="op" id="1828912">]</span>&nbsp;<span class="op" id="1828914">==</span>&nbsp;<span class="string" id="1828917">&#39;\r&#39;</span>&nbsp;<span class="op" id="1828922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1828927">drop</span>&nbsp;<span class="op" id="1828932">=</span>&nbsp;<span class="num" id="1828934">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1828938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1828942">line</span>&nbsp;<span class="op" id="1828947">=</span>&nbsp;<span class="ident" id="1828949">line</span><span class="op" id="1828953">[</span><span class="op" id="1828954">:</span><span class="builtinfunc" id="1828955">len</span><span class="op" id="1828958">(</span><span class="ident" id="1828959">line</span><span class="op" id="1828963">)</span><span class="op" id="1828964">-</span><span class="ident" id="1828965">drop</span><span class="op" id="1828969">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1828972">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1828975">return</span><br>
<span class="lineno"></span><span class="op" id="1828982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1828985">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="1829054">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno">360</span><span class="comment" id="1829130">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1829194">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="1829276">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1829357">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="1829367">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno">365</span><span class="keyword" id="1829421">func</span>&nbsp;<span class="op" id="1829426">(</span><span class="ident" id="1829427">b</span>&nbsp;<span class="op" id="1829429">*</span><span class="ident" id="1829430">Reader</span><span class="op" id="1829436">)</span>&nbsp;<span class="ident" id="1829438">ReadBytes</span><span class="op" id="1829447">(</span><span class="ident" id="1829448">delim</span>&nbsp;<span class="builtintype" id="1829454">byte</span><span class="op" id="1829458">)</span>&nbsp;<span class="op" id="1829460">(</span><span class="ident" id="1829461">line</span>&nbsp;<span class="op" id="1829466">[</span><span class="op" id="1829467">]</span><span class="builtintype" id="1829468">byte</span><span class="op" id="1829472">,</span>&nbsp;<span class="ident" id="1829474">err</span>&nbsp;<span class="builtintype" id="1829478">error</span><span class="op" id="1829483">)</span>&nbsp;<span class="op" id="1829485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1829488">//&nbsp;Use&nbsp;ReadSlice&nbsp;to&nbsp;look&nbsp;for&nbsp;array,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1829525">//&nbsp;accumulating&nbsp;full&nbsp;buffers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1829556">var</span>&nbsp;<span class="ident" id="1829560">frag</span>&nbsp;<span class="op" id="1829565">[</span><span class="op" id="1829566">]</span><span class="builtintype" id="1829567">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1829573">var</span>&nbsp;<span class="ident" id="1829577">full</span>&nbsp;<span class="op" id="1829582">[</span><span class="op" id="1829583">]</span><span class="op" id="1829584">[</span><span class="op" id="1829585">]</span><span class="builtintype" id="1829586">byte</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1829592">err</span>&nbsp;<span class="op" id="1829596">=</span>&nbsp;<span class="builtintype" id="1829598">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1829604">for</span>&nbsp;<span class="op" id="1829608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1829612">var</span>&nbsp;<span class="ident" id="1829616">e</span>&nbsp;<span class="builtintype" id="1829618">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1829626">frag</span><span class="op" id="1829630">,</span>&nbsp;<span class="ident" id="1829632">e</span>&nbsp;<span class="op" id="1829634">=</span>&nbsp;<span class="ident" id="1829636">b</span><span class="op" id="1829637">.</span><span class="ident" id="1829638">ReadSlice</span><span class="op" id="1829647">(</span><span class="ident" id="1829648">delim</span><span class="op" id="1829653">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1829657">if</span>&nbsp;<span class="ident" id="1829660">e</span>&nbsp;<span class="op" id="1829662">==</span>&nbsp;<span class="builtintype" id="1829665">nil</span>&nbsp;<span class="op" id="1829669">{</span>&nbsp;<span class="comment" id="1829671">//&nbsp;got&nbsp;final&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1829696">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1829704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1829708">if</span>&nbsp;<span class="ident" id="1829711">e</span>&nbsp;<span class="op" id="1829713">!=</span>&nbsp;<span class="ident" id="1829716">ErrBufferFull</span>&nbsp;<span class="op" id="1829730">{</span>&nbsp;<span class="comment" id="1829732">//&nbsp;unexpected&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1829755">err</span>&nbsp;<span class="op" id="1829759">=</span>&nbsp;<span class="ident" id="1829761">e</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1829766">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1829774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1829779">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1829811">buf</span>&nbsp;<span class="op" id="1829815">:=</span>&nbsp;<span class="builtinfunc" id="1829818">make</span><span class="op" id="1829822">(</span><span class="op" id="1829823">[</span><span class="op" id="1829824">]</span><span class="builtintype" id="1829825">byte</span><span class="op" id="1829829">,</span>&nbsp;<span class="builtinfunc" id="1829831">len</span><span class="op" id="1829834">(</span><span class="ident" id="1829835">frag</span><span class="op" id="1829839">)</span><span class="op" id="1829840">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1829844">copy</span><span class="op" id="1829848">(</span><span class="ident" id="1829849">buf</span><span class="op" id="1829852">,</span>&nbsp;<span class="ident" id="1829854">frag</span><span class="op" id="1829858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1829862">full</span>&nbsp;<span class="op" id="1829867">=</span>&nbsp;<span class="builtinfunc" id="1829869">append</span><span class="op" id="1829875">(</span><span class="ident" id="1829876">full</span><span class="op" id="1829880">,</span>&nbsp;<span class="ident" id="1829882">buf</span><span class="op" id="1829885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1829888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1829892">//&nbsp;Allocate&nbsp;new&nbsp;buffer&nbsp;to&nbsp;hold&nbsp;the&nbsp;full&nbsp;pieces&nbsp;and&nbsp;the&nbsp;fragment.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1829958">n</span>&nbsp;<span class="op" id="1829960">:=</span>&nbsp;<span class="num" id="1829963">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1829966">for</span>&nbsp;<span class="ident" id="1829970">i</span>&nbsp;<span class="op" id="1829972">:=</span>&nbsp;<span class="keyword" id="1829975">range</span>&nbsp;<span class="ident" id="1829981">full</span>&nbsp;<span class="op" id="1829986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1829990">n</span>&nbsp;<span class="op" id="1829992">+=</span>&nbsp;<span class="builtinfunc" id="1829995">len</span><span class="op" id="1829998">(</span><span class="ident" id="1829999">full</span><span class="op" id="1830003">[</span><span class="ident" id="1830004">i</span><span class="op" id="1830005">]</span><span class="op" id="1830006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1830009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1830012">n</span>&nbsp;<span class="op" id="1830014">+=</span>&nbsp;<span class="builtinfunc" id="1830017">len</span><span class="op" id="1830020">(</span><span class="ident" id="1830021">frag</span><span class="op" id="1830025">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1830029">//&nbsp;Copy&nbsp;full&nbsp;pieces&nbsp;and&nbsp;fragment&nbsp;in.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1830067">buf</span>&nbsp;<span class="op" id="1830071">:=</span>&nbsp;<span class="builtinfunc" id="1830074">make</span><span class="op" id="1830078">(</span><span class="op" id="1830079">[</span><span class="op" id="1830080">]</span><span class="builtintype" id="1830081">byte</span><span class="op" id="1830085">,</span>&nbsp;<span class="ident" id="1830087">n</span><span class="op" id="1830088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1830091">n</span>&nbsp;<span class="op" id="1830093">=</span>&nbsp;<span class="num" id="1830095">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1830098">for</span>&nbsp;<span class="ident" id="1830102">i</span>&nbsp;<span class="op" id="1830104">:=</span>&nbsp;<span class="keyword" id="1830107">range</span>&nbsp;<span class="ident" id="1830113">full</span>&nbsp;<span class="op" id="1830118">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1830122">n</span>&nbsp;<span class="op" id="1830124">+=</span>&nbsp;<span class="builtinfunc" id="1830127">copy</span><span class="op" id="1830131">(</span><span class="ident" id="1830132">buf</span><span class="op" id="1830135">[</span><span class="ident" id="1830136">n</span><span class="op" id="1830137">:</span><span class="op" id="1830138">]</span><span class="op" id="1830139">,</span>&nbsp;<span class="ident" id="1830141">full</span><span class="op" id="1830145">[</span><span class="ident" id="1830146">i</span><span class="op" id="1830147">]</span><span class="op" id="1830148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1830151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1830154">copy</span><span class="op" id="1830158">(</span><span class="ident" id="1830159">buf</span><span class="op" id="1830162">[</span><span class="ident" id="1830163">n</span><span class="op" id="1830164">:</span><span class="op" id="1830165">]</span><span class="op" id="1830166">,</span>&nbsp;<span class="ident" id="1830168">frag</span><span class="op" id="1830172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1830175">return</span>&nbsp;<span class="ident" id="1830182">buf</span><span class="op" id="1830185">,</span>&nbsp;<span class="ident" id="1830187">err</span><br>
<span class="lineno"></span><span class="op" id="1830191">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="1830194">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="1830264">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1830341">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1830406">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">410</span><span class="comment" id="1830488">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1830570">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="1830580">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno"></span><span class="keyword" id="1830634">func</span>&nbsp;<span class="op" id="1830639">(</span><span class="ident" id="1830640">b</span>&nbsp;<span class="op" id="1830642">*</span><span class="ident" id="1830643">Reader</span><span class="op" id="1830649">)</span>&nbsp;<span class="ident" id="1830651">ReadString</span><span class="op" id="1830661">(</span><span class="ident" id="1830662">delim</span>&nbsp;<span class="builtintype" id="1830668">byte</span><span class="op" id="1830672">)</span>&nbsp;<span class="op" id="1830674">(</span><span class="ident" id="1830675">line</span>&nbsp;<span class="builtintype" id="1830680">string</span><span class="op" id="1830686">,</span>&nbsp;<span class="ident" id="1830688">err</span>&nbsp;<span class="builtintype" id="1830692">error</span><span class="op" id="1830697">)</span>&nbsp;<span class="op" id="1830699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1830702">bytes</span><span class="op" id="1830707">,</span>&nbsp;<span class="ident" id="1830709">err</span>&nbsp;<span class="op" id="1830713">:=</span>&nbsp;<span class="ident" id="1830716">b</span><span class="op" id="1830717">.</span><span class="ident" id="1830718">ReadBytes</span><span class="op" id="1830727">(</span><span class="ident" id="1830728">delim</span><span class="op" id="1830733">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1830736">line</span>&nbsp;<span class="op" id="1830741">=</span>&nbsp;<span class="builtintype" id="1830743">string</span><span class="op" id="1830749">(</span><span class="ident" id="1830750">bytes</span><span class="op" id="1830755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1830758">return</span>&nbsp;<span class="ident" id="1830765">line</span><span class="op" id="1830769">,</span>&nbsp;<span class="ident" id="1830771">err</span><br>
<span class="lineno"></span><span class="op" id="1830775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1830778">//&nbsp;WriteTo&nbsp;implements&nbsp;io.WriterTo.</span><br>
<span class="lineno">420</span><span class="keyword" id="1830813">func</span>&nbsp;<span class="op" id="1830818">(</span><span class="ident" id="1830819">b</span>&nbsp;<span class="op" id="1830821">*</span><span class="ident" id="1830822">Reader</span><span class="op" id="1830828">)</span>&nbsp;<span class="ident" id="1830830">WriteTo</span><span class="op" id="1830837">(</span><span class="ident" id="1830838">w</span>&nbsp;<span class="ident" id="1830840">io</span><span class="op" id="1830842">.</span><span class="ident" id="1830843">Writer</span><span class="op" id="1830849">)</span>&nbsp;<span class="op" id="1830851">(</span><span class="ident" id="1830852">n</span>&nbsp;<span class="builtintype" id="1830854">int64</span><span class="op" id="1830859">,</span>&nbsp;<span class="ident" id="1830861">err</span>&nbsp;<span class="builtintype" id="1830865">error</span><span class="op" id="1830870">)</span>&nbsp;<span class="op" id="1830872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1830875">n</span><span class="op" id="1830876">,</span>&nbsp;<span class="ident" id="1830878">err</span>&nbsp;<span class="op" id="1830882">=</span>&nbsp;<span class="ident" id="1830884">b</span><span class="op" id="1830885">.</span><span class="ident" id="1830886">writeBuf</span><span class="op" id="1830894">(</span><span class="ident" id="1830895">w</span><span class="op" id="1830896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1830899">if</span>&nbsp;<span class="ident" id="1830902">err</span>&nbsp;<span class="op" id="1830906">!=</span>&nbsp;<span class="builtintype" id="1830909">nil</span>&nbsp;<span class="op" id="1830913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1830917">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1830925">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1830929">if</span>&nbsp;<span class="ident" id="1830932">r</span><span class="op" id="1830933">,</span>&nbsp;<span class="ident" id="1830935">ok</span>&nbsp;<span class="op" id="1830938">:=</span>&nbsp;<span class="ident" id="1830941">b</span><span class="op" id="1830942">.</span><span class="ident" id="1830943">rd</span><span class="op" id="1830945">.</span><span class="op" id="1830946">(</span><span class="ident" id="1830947">io</span><span class="op" id="1830949">.</span><span class="ident" id="1830950">WriterTo</span><span class="op" id="1830958">)</span><span class="op" id="1830959">;</span>&nbsp;<span class="ident" id="1830961">ok</span>&nbsp;<span class="op" id="1830964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1830968">m</span><span class="op" id="1830969">,</span>&nbsp;<span class="ident" id="1830971">err</span>&nbsp;<span class="op" id="1830975">:=</span>&nbsp;<span class="ident" id="1830978">r</span><span class="op" id="1830979">.</span><span class="ident" id="1830980">WriteTo</span><span class="op" id="1830987">(</span><span class="ident" id="1830988">w</span><span class="op" id="1830989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1830993">n</span>&nbsp;<span class="op" id="1830995">+=</span>&nbsp;<span class="ident" id="1830998">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1831002">return</span>&nbsp;<span class="ident" id="1831009">n</span><span class="op" id="1831010">,</span>&nbsp;<span class="ident" id="1831012">err</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1831017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1831021">if</span>&nbsp;<span class="ident" id="1831024">w</span><span class="op" id="1831025">,</span>&nbsp;<span class="ident" id="1831027">ok</span>&nbsp;<span class="op" id="1831030">:=</span>&nbsp;<span class="ident" id="1831033">w</span><span class="op" id="1831034">.</span><span class="op" id="1831035">(</span><span class="ident" id="1831036">io</span><span class="op" id="1831038">.</span><span class="ident" id="1831039">ReaderFrom</span><span class="op" id="1831049">)</span><span class="op" id="1831050">;</span>&nbsp;<span class="ident" id="1831052">ok</span>&nbsp;<span class="op" id="1831055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1831059">m</span><span class="op" id="1831060">,</span>&nbsp;<span class="ident" id="1831062">err</span>&nbsp;<span class="op" id="1831066">:=</span>&nbsp;<span class="ident" id="1831069">w</span><span class="op" id="1831070">.</span><span class="ident" id="1831071">ReadFrom</span><span class="op" id="1831079">(</span><span class="ident" id="1831080">b</span><span class="op" id="1831081">.</span><span class="ident" id="1831082">rd</span><span class="op" id="1831084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1831088">n</span>&nbsp;<span class="op" id="1831090">+=</span>&nbsp;<span class="ident" id="1831093">m</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1831097">return</span>&nbsp;<span class="ident" id="1831104">n</span><span class="op" id="1831105">,</span>&nbsp;<span class="ident" id="1831107">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1831112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1831116">if</span>&nbsp;<span class="ident" id="1831119">b</span><span class="op" id="1831120">.</span><span class="ident" id="1831121">w</span><span class="op" id="1831122">-</span><span class="ident" id="1831123">b</span><span class="op" id="1831124">.</span><span class="ident" id="1831125">r</span>&nbsp;<span class="op" id="1831127">&lt;</span>&nbsp;<span class="builtinfunc" id="1831129">len</span><span class="op" id="1831132">(</span><span class="ident" id="1831133">b</span><span class="op" id="1831134">.</span><span class="ident" id="1831135">buf</span><span class="op" id="1831138">)</span>&nbsp;<span class="op" id="1831140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1831144">b</span><span class="op" id="1831145">.</span><span class="ident" id="1831146">fill</span><span class="op" id="1831150">(</span><span class="op" id="1831151">)</span>&nbsp;<span class="comment" id="1831153">//&nbsp;buffer&nbsp;not&nbsp;full</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1831173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1831177">for</span>&nbsp;<span class="ident" id="1831181">b</span><span class="op" id="1831182">.</span><span class="ident" id="1831183">r</span>&nbsp;<span class="op" id="1831185">&lt;</span>&nbsp;<span class="ident" id="1831187">b</span><span class="op" id="1831188">.</span><span class="ident" id="1831189">w</span>&nbsp;<span class="op" id="1831191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1831195">//&nbsp;b.r&nbsp;&lt;&nbsp;b.w&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1831233">m</span><span class="op" id="1831234">,</span>&nbsp;<span class="ident" id="1831236">err</span>&nbsp;<span class="op" id="1831240">:=</span>&nbsp;<span class="ident" id="1831243">b</span><span class="op" id="1831244">.</span><span class="ident" id="1831245">writeBuf</span><span class="op" id="1831253">(</span><span class="ident" id="1831254">w</span><span class="op" id="1831255">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1831259">n</span>&nbsp;<span class="op" id="1831261">+=</span>&nbsp;<span class="ident" id="1831264">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1831268">if</span>&nbsp;<span class="ident" id="1831271">err</span>&nbsp;<span class="op" id="1831275">!=</span>&nbsp;<span class="builtintype" id="1831278">nil</span>&nbsp;<span class="op" id="1831282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1831287">return</span>&nbsp;<span class="ident" id="1831294">n</span><span class="op" id="1831295">,</span>&nbsp;<span class="ident" id="1831297">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1831303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1831307">b</span><span class="op" id="1831308">.</span><span class="ident" id="1831309">fill</span><span class="op" id="1831313">(</span><span class="op" id="1831314">)</span>&nbsp;<span class="comment" id="1831316">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1831336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1831340">if</span>&nbsp;<span class="ident" id="1831343">b</span><span class="op" id="1831344">.</span><span class="ident" id="1831345">err</span>&nbsp;<span class="op" id="1831349">==</span>&nbsp;<span class="ident" id="1831352">io</span><span class="op" id="1831354">.</span><span class="ident" id="1831355">EOF</span>&nbsp;<span class="op" id="1831359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1831363">b</span><span class="op" id="1831364">.</span><span class="ident" id="1831365">err</span>&nbsp;<span class="op" id="1831369">=</span>&nbsp;<span class="builtintype" id="1831371">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1831376">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1831380">return</span>&nbsp;<span class="ident" id="1831387">n</span><span class="op" id="1831388">,</span>&nbsp;<span class="ident" id="1831390">b</span><span class="op" id="1831391">.</span><span class="ident" id="1831392">readErr</span><span class="op" id="1831399">(</span><span class="op" id="1831400">)</span><br>
<span class="lineno"></span><span class="op" id="1831402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1831405">var</span>&nbsp;<span class="ident" id="1831409">errNegativeWrite</span>&nbsp;<span class="op" id="1831426">=</span>&nbsp;<span class="ident" id="1831428">errors</span><span class="op" id="1831434">.</span><span class="ident" id="1831435">New</span><span class="op" id="1831438">(</span><span class="string" id="1831439">&#34;bufio:&nbsp;writer&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Write&#34;</span><span class="op" id="1831489">)</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="1831492">//&nbsp;writeBuf&nbsp;writes&nbsp;the&nbsp;Reader&#39;s&nbsp;buffer&nbsp;to&nbsp;the&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="1831546">func</span>&nbsp;<span class="op" id="1831551">(</span><span class="ident" id="1831552">b</span>&nbsp;<span class="op" id="1831554">*</span><span class="ident" id="1831555">Reader</span><span class="op" id="1831561">)</span>&nbsp;<span class="ident" id="1831563">writeBuf</span><span class="op" id="1831571">(</span><span class="ident" id="1831572">w</span>&nbsp;<span class="ident" id="1831574">io</span><span class="op" id="1831576">.</span><span class="ident" id="1831577">Writer</span><span class="op" id="1831583">)</span>&nbsp;<span class="op" id="1831585">(</span><span class="builtintype" id="1831586">int64</span><span class="op" id="1831591">,</span>&nbsp;<span class="builtintype" id="1831593">error</span><span class="op" id="1831598">)</span>&nbsp;<span class="op" id="1831600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1831603">n</span><span class="op" id="1831604">,</span>&nbsp;<span class="ident" id="1831606">err</span>&nbsp;<span class="op" id="1831610">:=</span>&nbsp;<span class="ident" id="1831613">w</span><span class="op" id="1831614">.</span><span class="ident" id="1831615">Write</span><span class="op" id="1831620">(</span><span class="ident" id="1831621">b</span><span class="op" id="1831622">.</span><span class="ident" id="1831623">buf</span><span class="op" id="1831626">[</span><span class="ident" id="1831627">b</span><span class="op" id="1831628">.</span><span class="ident" id="1831629">r</span><span class="op" id="1831630">:</span><span class="ident" id="1831631">b</span><span class="op" id="1831632">.</span><span class="ident" id="1831633">w</span><span class="op" id="1831634">]</span><span class="op" id="1831635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1831638">if</span>&nbsp;<span class="ident" id="1831641">n</span>&nbsp;<span class="op" id="1831643">&lt;</span>&nbsp;<span class="num" id="1831645">0</span>&nbsp;<span class="op" id="1831647">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1831651">panic</span><span class="op" id="1831656">(</span><span class="ident" id="1831657">errNegativeWrite</span><span class="op" id="1831673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1831676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1831679">b</span><span class="op" id="1831680">.</span><span class="ident" id="1831681">r</span>&nbsp;<span class="op" id="1831683">+=</span>&nbsp;<span class="ident" id="1831686">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1831689">return</span>&nbsp;<span class="builtintype" id="1831696">int64</span><span class="op" id="1831701">(</span><span class="ident" id="1831702">n</span><span class="op" id="1831703">)</span><span class="op" id="1831704">,</span>&nbsp;<span class="ident" id="1831706">err</span><br>
<span class="lineno"></span><span class="op" id="1831710">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="1831713">//&nbsp;buffered&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1831733">//&nbsp;Writer&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Writer&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="1831789">//&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;writing&nbsp;to&nbsp;a&nbsp;Writer,&nbsp;no&nbsp;more&nbsp;data&nbsp;will&nbsp;be</span><br>
<span class="lineno">475</span><span class="comment" id="1831853">//&nbsp;accepted&nbsp;and&nbsp;all&nbsp;subsequent&nbsp;writes&nbsp;will&nbsp;return&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="1831914">//&nbsp;After&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;written,&nbsp;the&nbsp;client&nbsp;should&nbsp;call&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1831977">//&nbsp;Flush&nbsp;method&nbsp;to&nbsp;guarantee&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;forwarded&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1832037">//&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="1832066">type</span>&nbsp;<span class="ident" id="1832071">Writer</span>&nbsp;<span class="keyword" id="1832078">struct</span>&nbsp;<span class="op" id="1832085">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1832088">err</span>&nbsp;<span class="builtintype" id="1832092">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1832099">buf</span>&nbsp;<span class="op" id="1832103">[</span><span class="op" id="1832104">]</span><span class="builtintype" id="1832105">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1832111">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1832115">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1832120">wr</span>&nbsp;&nbsp;<span class="ident" id="1832124">io</span><span class="op" id="1832126">.</span><span class="ident" id="1832127">Writer</span><br>
<span class="lineno"></span><span class="op" id="1832134">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="1832137">//&nbsp;NewWriterSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="1832215">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Writer&nbsp;is&nbsp;already&nbsp;a&nbsp;Writer&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="1832288">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="1832331">func</span>&nbsp;<span class="ident" id="1832336">NewWriterSize</span><span class="op" id="1832349">(</span><span class="ident" id="1832350">w</span>&nbsp;<span class="ident" id="1832352">io</span><span class="op" id="1832354">.</span><span class="ident" id="1832355">Writer</span><span class="op" id="1832361">,</span>&nbsp;<span class="ident" id="1832363">size</span>&nbsp;<span class="builtintype" id="1832368">int</span><span class="op" id="1832371">)</span>&nbsp;<span class="op" id="1832373">*</span><span class="ident" id="1832374">Writer</span>&nbsp;<span class="op" id="1832381">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1832384">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Writer?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1832412">b</span><span class="op" id="1832413">,</span>&nbsp;<span class="ident" id="1832415">ok</span>&nbsp;<span class="op" id="1832418">:=</span>&nbsp;<span class="ident" id="1832421">w</span><span class="op" id="1832422">.</span><span class="op" id="1832423">(</span><span class="op" id="1832424">*</span><span class="ident" id="1832425">Writer</span><span class="op" id="1832431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1832434">if</span>&nbsp;<span class="ident" id="1832437">ok</span>&nbsp;<span class="op" id="1832440">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1832443">len</span><span class="op" id="1832446">(</span><span class="ident" id="1832447">b</span><span class="op" id="1832448">.</span><span class="ident" id="1832449">buf</span><span class="op" id="1832452">)</span>&nbsp;<span class="op" id="1832454">&gt;=</span>&nbsp;<span class="ident" id="1832457">size</span>&nbsp;<span class="op" id="1832462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1832466">return</span>&nbsp;<span class="ident" id="1832473">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1832476">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1832479">if</span>&nbsp;<span class="ident" id="1832482">size</span>&nbsp;<span class="op" id="1832487">&lt;=</span>&nbsp;<span class="num" id="1832490">0</span>&nbsp;<span class="op" id="1832492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1832496">size</span>&nbsp;<span class="op" id="1832501">=</span>&nbsp;<span class="ident" id="1832503">defaultBufSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1832519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1832522">return</span>&nbsp;<span class="op" id="1832529">&amp;</span><span class="ident" id="1832530">Writer</span><span class="op" id="1832536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1832540">buf</span><span class="op" id="1832543">:</span>&nbsp;<span class="builtinfunc" id="1832545">make</span><span class="op" id="1832549">(</span><span class="op" id="1832550">[</span><span class="op" id="1832551">]</span><span class="builtintype" id="1832552">byte</span><span class="op" id="1832556">,</span>&nbsp;<span class="ident" id="1832558">size</span><span class="op" id="1832562">)</span><span class="op" id="1832563">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1832567">wr</span><span class="op" id="1832569">:</span>&nbsp;&nbsp;<span class="ident" id="1832572">w</span><span class="op" id="1832573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1832576">}</span><br>
<span class="lineno"></span><span class="op" id="1832578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1832581">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno">505</span><span class="keyword" id="1832650">func</span>&nbsp;<span class="ident" id="1832655">NewWriter</span><span class="op" id="1832664">(</span><span class="ident" id="1832665">w</span>&nbsp;<span class="ident" id="1832667">io</span><span class="op" id="1832669">.</span><span class="ident" id="1832670">Writer</span><span class="op" id="1832676">)</span>&nbsp;<span class="op" id="1832678">*</span><span class="ident" id="1832679">Writer</span>&nbsp;<span class="op" id="1832686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1832689">return</span>&nbsp;<span class="ident" id="1832696">NewWriterSize</span><span class="op" id="1832709">(</span><span class="ident" id="1832710">w</span><span class="op" id="1832711">,</span>&nbsp;<span class="ident" id="1832713">defaultBufSize</span><span class="op" id="1832727">)</span><br>
<span class="lineno"></span><span class="op" id="1832729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1832732">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;unflushed&nbsp;buffered&nbsp;data,&nbsp;clears&nbsp;any&nbsp;error,&nbsp;and</span><br>
<span class="lineno">510</span><span class="comment" id="1832801">//&nbsp;resets&nbsp;b&nbsp;to&nbsp;write&nbsp;its&nbsp;output&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="1832839">func</span>&nbsp;<span class="op" id="1832844">(</span><span class="ident" id="1832845">b</span>&nbsp;<span class="op" id="1832847">*</span><span class="ident" id="1832848">Writer</span><span class="op" id="1832854">)</span>&nbsp;<span class="ident" id="1832856">Reset</span><span class="op" id="1832861">(</span><span class="ident" id="1832862">w</span>&nbsp;<span class="ident" id="1832864">io</span><span class="op" id="1832866">.</span><span class="ident" id="1832867">Writer</span><span class="op" id="1832873">)</span>&nbsp;<span class="op" id="1832875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1832878">b</span><span class="op" id="1832879">.</span><span class="ident" id="1832880">err</span>&nbsp;<span class="op" id="1832884">=</span>&nbsp;<span class="builtintype" id="1832886">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1832891">b</span><span class="op" id="1832892">.</span><span class="ident" id="1832893">n</span>&nbsp;<span class="op" id="1832895">=</span>&nbsp;<span class="num" id="1832897">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1832900">b</span><span class="op" id="1832901">.</span><span class="ident" id="1832902">wr</span>&nbsp;<span class="op" id="1832905">=</span>&nbsp;<span class="ident" id="1832907">w</span><br>
<span class="lineno">515</span><span class="op" id="1832909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1832912">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="1832975">func</span>&nbsp;<span class="op" id="1832980">(</span><span class="ident" id="1832981">b</span>&nbsp;<span class="op" id="1832983">*</span><span class="ident" id="1832984">Writer</span><span class="op" id="1832990">)</span>&nbsp;<span class="ident" id="1832992">Flush</span><span class="op" id="1832997">(</span><span class="op" id="1832998">)</span>&nbsp;<span class="builtintype" id="1833000">error</span>&nbsp;<span class="op" id="1833006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1833009">err</span>&nbsp;<span class="op" id="1833013">:=</span>&nbsp;<span class="ident" id="1833016">b</span><span class="op" id="1833017">.</span><span class="ident" id="1833018">flush</span><span class="op" id="1833023">(</span><span class="op" id="1833024">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1833027">return</span>&nbsp;<span class="ident" id="1833034">err</span><br>
<span class="lineno"></span><span class="op" id="1833038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1833041">func</span>&nbsp;<span class="op" id="1833046">(</span><span class="ident" id="1833047">b</span>&nbsp;<span class="op" id="1833049">*</span><span class="ident" id="1833050">Writer</span><span class="op" id="1833056">)</span>&nbsp;<span class="ident" id="1833058">flush</span><span class="op" id="1833063">(</span><span class="op" id="1833064">)</span>&nbsp;<span class="builtintype" id="1833066">error</span>&nbsp;<span class="op" id="1833072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1833075">if</span>&nbsp;<span class="ident" id="1833078">b</span><span class="op" id="1833079">.</span><span class="ident" id="1833080">err</span>&nbsp;<span class="op" id="1833084">!=</span>&nbsp;<span class="builtintype" id="1833087">nil</span>&nbsp;<span class="op" id="1833091">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1833095">return</span>&nbsp;<span class="ident" id="1833102">b</span><span class="op" id="1833103">.</span><span class="ident" id="1833104">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1833109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1833112">if</span>&nbsp;<span class="ident" id="1833115">b</span><span class="op" id="1833116">.</span><span class="ident" id="1833117">n</span>&nbsp;<span class="op" id="1833119">==</span>&nbsp;<span class="num" id="1833122">0</span>&nbsp;<span class="op" id="1833124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1833128">return</span>&nbsp;<span class="builtintype" id="1833135">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1833140">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1833143">n</span><span class="op" id="1833144">,</span>&nbsp;<span class="ident" id="1833146">err</span>&nbsp;<span class="op" id="1833150">:=</span>&nbsp;<span class="ident" id="1833153">b</span><span class="op" id="1833154">.</span><span class="ident" id="1833155">wr</span><span class="op" id="1833157">.</span><span class="ident" id="1833158">Write</span><span class="op" id="1833163">(</span><span class="ident" id="1833164">b</span><span class="op" id="1833165">.</span><span class="ident" id="1833166">buf</span><span class="op" id="1833169">[</span><span class="num" id="1833170">0</span><span class="op" id="1833171">:</span><span class="ident" id="1833172">b</span><span class="op" id="1833173">.</span><span class="ident" id="1833174">n</span><span class="op" id="1833175">]</span><span class="op" id="1833176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1833179">if</span>&nbsp;<span class="ident" id="1833182">n</span>&nbsp;<span class="op" id="1833184">&lt;</span>&nbsp;<span class="ident" id="1833186">b</span><span class="op" id="1833187">.</span><span class="ident" id="1833188">n</span>&nbsp;<span class="op" id="1833190">&amp;&amp;</span>&nbsp;<span class="ident" id="1833193">err</span>&nbsp;<span class="op" id="1833197">==</span>&nbsp;<span class="builtintype" id="1833200">nil</span>&nbsp;<span class="op" id="1833204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1833208">err</span>&nbsp;<span class="op" id="1833212">=</span>&nbsp;<span class="ident" id="1833214">io</span><span class="op" id="1833216">.</span><span class="ident" id="1833217">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1833232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1833235">if</span>&nbsp;<span class="ident" id="1833238">err</span>&nbsp;<span class="op" id="1833242">!=</span>&nbsp;<span class="builtintype" id="1833245">nil</span>&nbsp;<span class="op" id="1833249">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1833253">if</span>&nbsp;<span class="ident" id="1833256">n</span>&nbsp;<span class="op" id="1833258">&gt;</span>&nbsp;<span class="num" id="1833260">0</span>&nbsp;<span class="op" id="1833262">&amp;&amp;</span>&nbsp;<span class="ident" id="1833265">n</span>&nbsp;<span class="op" id="1833267">&lt;</span>&nbsp;<span class="ident" id="1833269">b</span><span class="op" id="1833270">.</span><span class="ident" id="1833271">n</span>&nbsp;<span class="op" id="1833273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1833278">copy</span><span class="op" id="1833282">(</span><span class="ident" id="1833283">b</span><span class="op" id="1833284">.</span><span class="ident" id="1833285">buf</span><span class="op" id="1833288">[</span><span class="num" id="1833289">0</span><span class="op" id="1833290">:</span><span class="ident" id="1833291">b</span><span class="op" id="1833292">.</span><span class="ident" id="1833293">n</span><span class="op" id="1833294">-</span><span class="ident" id="1833295">n</span><span class="op" id="1833296">]</span><span class="op" id="1833297">,</span>&nbsp;<span class="ident" id="1833299">b</span><span class="op" id="1833300">.</span><span class="ident" id="1833301">buf</span><span class="op" id="1833304">[</span><span class="ident" id="1833305">n</span><span class="op" id="1833306">:</span><span class="ident" id="1833307">b</span><span class="op" id="1833308">.</span><span class="ident" id="1833309">n</span><span class="op" id="1833310">]</span><span class="op" id="1833311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1833315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1833319">b</span><span class="op" id="1833320">.</span><span class="ident" id="1833321">n</span>&nbsp;<span class="op" id="1833323">-=</span>&nbsp;<span class="ident" id="1833326">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1833330">b</span><span class="op" id="1833331">.</span><span class="ident" id="1833332">err</span>&nbsp;<span class="op" id="1833336">=</span>&nbsp;<span class="ident" id="1833338">err</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1833344">return</span>&nbsp;<span class="ident" id="1833351">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1833356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1833359">b</span><span class="op" id="1833360">.</span><span class="ident" id="1833361">n</span>&nbsp;<span class="op" id="1833363">=</span>&nbsp;<span class="num" id="1833365">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1833368">return</span>&nbsp;<span class="builtintype" id="1833375">nil</span><br>
<span class="lineno"></span><span class="op" id="1833379">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="1833382">//&nbsp;Available&nbsp;returns&nbsp;how&nbsp;many&nbsp;bytes&nbsp;are&nbsp;unused&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1833444">func</span>&nbsp;<span class="op" id="1833449">(</span><span class="ident" id="1833450">b</span>&nbsp;<span class="op" id="1833452">*</span><span class="ident" id="1833453">Writer</span><span class="op" id="1833459">)</span>&nbsp;<span class="ident" id="1833461">Available</span><span class="op" id="1833470">(</span><span class="op" id="1833471">)</span>&nbsp;<span class="builtintype" id="1833473">int</span>&nbsp;<span class="op" id="1833477">{</span>&nbsp;<span class="keyword" id="1833479">return</span>&nbsp;<span class="builtinfunc" id="1833486">len</span><span class="op" id="1833489">(</span><span class="ident" id="1833490">b</span><span class="op" id="1833491">.</span><span class="ident" id="1833492">buf</span><span class="op" id="1833495">)</span>&nbsp;<span class="op" id="1833497">-</span>&nbsp;<span class="ident" id="1833499">b</span><span class="op" id="1833500">.</span><span class="ident" id="1833501">n</span>&nbsp;<span class="op" id="1833503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1833506">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;have&nbsp;been&nbsp;written&nbsp;into&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno">550</span><span class="keyword" id="1833594">func</span>&nbsp;<span class="op" id="1833599">(</span><span class="ident" id="1833600">b</span>&nbsp;<span class="op" id="1833602">*</span><span class="ident" id="1833603">Writer</span><span class="op" id="1833609">)</span>&nbsp;<span class="ident" id="1833611">Buffered</span><span class="op" id="1833619">(</span><span class="op" id="1833620">)</span>&nbsp;<span class="builtintype" id="1833622">int</span>&nbsp;<span class="op" id="1833626">{</span>&nbsp;<span class="keyword" id="1833628">return</span>&nbsp;<span class="ident" id="1833635">b</span><span class="op" id="1833636">.</span><span class="ident" id="1833637">n</span>&nbsp;<span class="op" id="1833639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1833642">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1833693">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="1833736">//&nbsp;If&nbsp;nn&nbsp;&lt;&nbsp;len(p),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">555</span><span class="comment" id="1833791">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="1833818">func</span>&nbsp;<span class="op" id="1833823">(</span><span class="ident" id="1833824">b</span>&nbsp;<span class="op" id="1833826">*</span><span class="ident" id="1833827">Writer</span><span class="op" id="1833833">)</span>&nbsp;<span class="ident" id="1833835">Write</span><span class="op" id="1833840">(</span><span class="ident" id="1833841">p</span>&nbsp;<span class="op" id="1833843">[</span><span class="op" id="1833844">]</span><span class="builtintype" id="1833845">byte</span><span class="op" id="1833849">)</span>&nbsp;<span class="op" id="1833851">(</span><span class="ident" id="1833852">nn</span>&nbsp;<span class="builtintype" id="1833855">int</span><span class="op" id="1833858">,</span>&nbsp;<span class="ident" id="1833860">err</span>&nbsp;<span class="builtintype" id="1833864">error</span><span class="op" id="1833869">)</span>&nbsp;<span class="op" id="1833871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1833874">for</span>&nbsp;<span class="builtinfunc" id="1833878">len</span><span class="op" id="1833881">(</span><span class="ident" id="1833882">p</span><span class="op" id="1833883">)</span>&nbsp;<span class="op" id="1833885">&gt;</span>&nbsp;<span class="ident" id="1833887">b</span><span class="op" id="1833888">.</span><span class="ident" id="1833889">Available</span><span class="op" id="1833898">(</span><span class="op" id="1833899">)</span>&nbsp;<span class="op" id="1833901">&amp;&amp;</span>&nbsp;<span class="ident" id="1833904">b</span><span class="op" id="1833905">.</span><span class="ident" id="1833906">err</span>&nbsp;<span class="op" id="1833910">==</span>&nbsp;<span class="builtintype" id="1833913">nil</span>&nbsp;<span class="op" id="1833917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1833921">var</span>&nbsp;<span class="ident" id="1833925">n</span>&nbsp;<span class="builtintype" id="1833927">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1833933">if</span>&nbsp;<span class="ident" id="1833936">b</span><span class="op" id="1833937">.</span><span class="ident" id="1833938">Buffered</span><span class="op" id="1833946">(</span><span class="op" id="1833947">)</span>&nbsp;<span class="op" id="1833949">==</span>&nbsp;<span class="num" id="1833952">0</span>&nbsp;<span class="op" id="1833954">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1833959">//&nbsp;Large&nbsp;write,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1833992">//&nbsp;Write&nbsp;directly&nbsp;from&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834035">n</span><span class="op" id="1834036">,</span>&nbsp;<span class="ident" id="1834038">b</span><span class="op" id="1834039">.</span><span class="ident" id="1834040">err</span>&nbsp;<span class="op" id="1834044">=</span>&nbsp;<span class="ident" id="1834046">b</span><span class="op" id="1834047">.</span><span class="ident" id="1834048">wr</span><span class="op" id="1834050">.</span><span class="ident" id="1834051">Write</span><span class="op" id="1834056">(</span><span class="ident" id="1834057">p</span><span class="op" id="1834058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1834062">}</span>&nbsp;<span class="keyword" id="1834064">else</span>&nbsp;<span class="op" id="1834069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834074">n</span>&nbsp;<span class="op" id="1834076">=</span>&nbsp;<span class="builtinfunc" id="1834078">copy</span><span class="op" id="1834082">(</span><span class="ident" id="1834083">b</span><span class="op" id="1834084">.</span><span class="ident" id="1834085">buf</span><span class="op" id="1834088">[</span><span class="ident" id="1834089">b</span><span class="op" id="1834090">.</span><span class="ident" id="1834091">n</span><span class="op" id="1834092">:</span><span class="op" id="1834093">]</span><span class="op" id="1834094">,</span>&nbsp;<span class="ident" id="1834096">p</span><span class="op" id="1834097">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834102">b</span><span class="op" id="1834103">.</span><span class="ident" id="1834104">n</span>&nbsp;<span class="op" id="1834106">+=</span>&nbsp;<span class="ident" id="1834109">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834114">b</span><span class="op" id="1834115">.</span><span class="ident" id="1834116">flush</span><span class="op" id="1834121">(</span><span class="op" id="1834122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1834126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834130">nn</span>&nbsp;<span class="op" id="1834133">+=</span>&nbsp;<span class="ident" id="1834136">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834140">p</span>&nbsp;<span class="op" id="1834142">=</span>&nbsp;<span class="ident" id="1834144">p</span><span class="op" id="1834145">[</span><span class="ident" id="1834146">n</span><span class="op" id="1834147">:</span><span class="op" id="1834148">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1834151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834154">if</span>&nbsp;<span class="ident" id="1834157">b</span><span class="op" id="1834158">.</span><span class="ident" id="1834159">err</span>&nbsp;<span class="op" id="1834163">!=</span>&nbsp;<span class="builtintype" id="1834166">nil</span>&nbsp;<span class="op" id="1834170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834174">return</span>&nbsp;<span class="ident" id="1834181">nn</span><span class="op" id="1834183">,</span>&nbsp;<span class="ident" id="1834185">b</span><span class="op" id="1834186">.</span><span class="ident" id="1834187">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1834192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834195">n</span>&nbsp;<span class="op" id="1834197">:=</span>&nbsp;<span class="builtinfunc" id="1834200">copy</span><span class="op" id="1834204">(</span><span class="ident" id="1834205">b</span><span class="op" id="1834206">.</span><span class="ident" id="1834207">buf</span><span class="op" id="1834210">[</span><span class="ident" id="1834211">b</span><span class="op" id="1834212">.</span><span class="ident" id="1834213">n</span><span class="op" id="1834214">:</span><span class="op" id="1834215">]</span><span class="op" id="1834216">,</span>&nbsp;<span class="ident" id="1834218">p</span><span class="op" id="1834219">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834222">b</span><span class="op" id="1834223">.</span><span class="ident" id="1834224">n</span>&nbsp;<span class="op" id="1834226">+=</span>&nbsp;<span class="ident" id="1834229">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834232">nn</span>&nbsp;<span class="op" id="1834235">+=</span>&nbsp;<span class="ident" id="1834238">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834241">return</span>&nbsp;<span class="ident" id="1834248">nn</span><span class="op" id="1834250">,</span>&nbsp;<span class="builtintype" id="1834252">nil</span><br>
<span class="lineno"></span><span class="op" id="1834256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="1834259">//&nbsp;WriteByte&nbsp;writes&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="1834294">func</span>&nbsp;<span class="op" id="1834299">(</span><span class="ident" id="1834300">b</span>&nbsp;<span class="op" id="1834302">*</span><span class="ident" id="1834303">Writer</span><span class="op" id="1834309">)</span>&nbsp;<span class="ident" id="1834311">WriteByte</span><span class="op" id="1834320">(</span><span class="ident" id="1834321">c</span>&nbsp;<span class="builtintype" id="1834323">byte</span><span class="op" id="1834327">)</span>&nbsp;<span class="builtintype" id="1834329">error</span>&nbsp;<span class="op" id="1834335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834338">if</span>&nbsp;<span class="ident" id="1834341">b</span><span class="op" id="1834342">.</span><span class="ident" id="1834343">err</span>&nbsp;<span class="op" id="1834347">!=</span>&nbsp;<span class="builtintype" id="1834350">nil</span>&nbsp;<span class="op" id="1834354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834358">return</span>&nbsp;<span class="ident" id="1834365">b</span><span class="op" id="1834366">.</span><span class="ident" id="1834367">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1834372">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834375">if</span>&nbsp;<span class="ident" id="1834378">b</span><span class="op" id="1834379">.</span><span class="ident" id="1834380">Available</span><span class="op" id="1834389">(</span><span class="op" id="1834390">)</span>&nbsp;<span class="op" id="1834392">&lt;=</span>&nbsp;<span class="num" id="1834395">0</span>&nbsp;<span class="op" id="1834397">&amp;&amp;</span>&nbsp;<span class="ident" id="1834400">b</span><span class="op" id="1834401">.</span><span class="ident" id="1834402">flush</span><span class="op" id="1834407">(</span><span class="op" id="1834408">)</span>&nbsp;<span class="op" id="1834410">!=</span>&nbsp;<span class="builtintype" id="1834413">nil</span>&nbsp;<span class="op" id="1834417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834421">return</span>&nbsp;<span class="ident" id="1834428">b</span><span class="op" id="1834429">.</span><span class="ident" id="1834430">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1834435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834438">b</span><span class="op" id="1834439">.</span><span class="ident" id="1834440">buf</span><span class="op" id="1834443">[</span><span class="ident" id="1834444">b</span><span class="op" id="1834445">.</span><span class="ident" id="1834446">n</span><span class="op" id="1834447">]</span>&nbsp;<span class="op" id="1834449">=</span>&nbsp;<span class="ident" id="1834451">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834454">b</span><span class="op" id="1834455">.</span><span class="ident" id="1834456">n</span><span class="op" id="1834457">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834461">return</span>&nbsp;<span class="builtintype" id="1834468">nil</span><br>
<span class="lineno"></span><span class="op" id="1834472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1834475">//&nbsp;WriteRune&nbsp;writes&nbsp;a&nbsp;single&nbsp;Unicode&nbsp;code&nbsp;point,&nbsp;returning</span><br>
<span class="lineno"></span><span class="comment" id="1834534">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;any&nbsp;error.</span><br>
<span class="lineno">595</span><span class="keyword" id="1834580">func</span>&nbsp;<span class="op" id="1834585">(</span><span class="ident" id="1834586">b</span>&nbsp;<span class="op" id="1834588">*</span><span class="ident" id="1834589">Writer</span><span class="op" id="1834595">)</span>&nbsp;<span class="ident" id="1834597">WriteRune</span><span class="op" id="1834606">(</span><span class="ident" id="1834607">r</span>&nbsp;<span class="builtintype" id="1834609">rune</span><span class="op" id="1834613">)</span>&nbsp;<span class="op" id="1834615">(</span><span class="ident" id="1834616">size</span>&nbsp;<span class="builtintype" id="1834621">int</span><span class="op" id="1834624">,</span>&nbsp;<span class="ident" id="1834626">err</span>&nbsp;<span class="builtintype" id="1834630">error</span><span class="op" id="1834635">)</span>&nbsp;<span class="op" id="1834637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834640">if</span>&nbsp;<span class="ident" id="1834643">r</span>&nbsp;<span class="op" id="1834645">&lt;</span>&nbsp;<span class="ident" id="1834647">utf8</span><span class="op" id="1834651">.</span><span class="ident" id="1834652">RuneSelf</span>&nbsp;<span class="op" id="1834661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834665">err</span>&nbsp;<span class="op" id="1834669">=</span>&nbsp;<span class="ident" id="1834671">b</span><span class="op" id="1834672">.</span><span class="ident" id="1834673">WriteByte</span><span class="op" id="1834682">(</span><span class="builtintype" id="1834683">byte</span><span class="op" id="1834687">(</span><span class="ident" id="1834688">r</span><span class="op" id="1834689">)</span><span class="op" id="1834690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834694">if</span>&nbsp;<span class="ident" id="1834697">err</span>&nbsp;<span class="op" id="1834701">!=</span>&nbsp;<span class="builtintype" id="1834704">nil</span>&nbsp;<span class="op" id="1834708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834713">return</span>&nbsp;<span class="num" id="1834720">0</span><span class="op" id="1834721">,</span>&nbsp;<span class="ident" id="1834723">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1834729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834733">return</span>&nbsp;<span class="num" id="1834740">1</span><span class="op" id="1834741">,</span>&nbsp;<span class="builtintype" id="1834743">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1834748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834751">if</span>&nbsp;<span class="ident" id="1834754">b</span><span class="op" id="1834755">.</span><span class="ident" id="1834756">err</span>&nbsp;<span class="op" id="1834760">!=</span>&nbsp;<span class="builtintype" id="1834763">nil</span>&nbsp;<span class="op" id="1834767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834771">return</span>&nbsp;<span class="num" id="1834778">0</span><span class="op" id="1834779">,</span>&nbsp;<span class="ident" id="1834781">b</span><span class="op" id="1834782">.</span><span class="ident" id="1834783">err</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1834788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834791">n</span>&nbsp;<span class="op" id="1834793">:=</span>&nbsp;<span class="ident" id="1834796">b</span><span class="op" id="1834797">.</span><span class="ident" id="1834798">Available</span><span class="op" id="1834807">(</span><span class="op" id="1834808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834811">if</span>&nbsp;<span class="ident" id="1834814">n</span>&nbsp;<span class="op" id="1834816">&lt;</span>&nbsp;<span class="ident" id="1834818">utf8</span><span class="op" id="1834822">.</span><span class="ident" id="1834823">UTFMax</span>&nbsp;<span class="op" id="1834830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834834">if</span>&nbsp;<span class="ident" id="1834837">b</span><span class="op" id="1834838">.</span><span class="ident" id="1834839">flush</span><span class="op" id="1834844">(</span><span class="op" id="1834845">)</span><span class="op" id="1834846">;</span>&nbsp;<span class="ident" id="1834848">b</span><span class="op" id="1834849">.</span><span class="ident" id="1834850">err</span>&nbsp;<span class="op" id="1834854">!=</span>&nbsp;<span class="builtintype" id="1834857">nil</span>&nbsp;<span class="op" id="1834861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834866">return</span>&nbsp;<span class="num" id="1834873">0</span><span class="op" id="1834874">,</span>&nbsp;<span class="ident" id="1834876">b</span><span class="op" id="1834877">.</span><span class="ident" id="1834878">err</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1834884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1834888">n</span>&nbsp;<span class="op" id="1834890">=</span>&nbsp;<span class="ident" id="1834892">b</span><span class="op" id="1834893">.</span><span class="ident" id="1834894">Available</span><span class="op" id="1834903">(</span><span class="op" id="1834904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834908">if</span>&nbsp;<span class="ident" id="1834911">n</span>&nbsp;<span class="op" id="1834913">&lt;</span>&nbsp;<span class="ident" id="1834915">utf8</span><span class="op" id="1834919">.</span><span class="ident" id="1834920">UTFMax</span>&nbsp;<span class="op" id="1834927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1834932">//&nbsp;Can&nbsp;only&nbsp;happen&nbsp;if&nbsp;buffer&nbsp;is&nbsp;silly&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1834980">return</span>&nbsp;<span class="ident" id="1834987">b</span><span class="op" id="1834988">.</span><span class="ident" id="1834989">WriteString</span><span class="op" id="1835000">(</span><span class="builtintype" id="1835001">string</span><span class="op" id="1835007">(</span><span class="ident" id="1835008">r</span><span class="op" id="1835009">)</span><span class="op" id="1835010">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1835014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1835017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835020">size</span>&nbsp;<span class="op" id="1835025">=</span>&nbsp;<span class="ident" id="1835027">utf8</span><span class="op" id="1835031">.</span><span class="ident" id="1835032">EncodeRune</span><span class="op" id="1835042">(</span><span class="ident" id="1835043">b</span><span class="op" id="1835044">.</span><span class="ident" id="1835045">buf</span><span class="op" id="1835048">[</span><span class="ident" id="1835049">b</span><span class="op" id="1835050">.</span><span class="ident" id="1835051">n</span><span class="op" id="1835052">:</span><span class="op" id="1835053">]</span><span class="op" id="1835054">,</span>&nbsp;<span class="ident" id="1835056">r</span><span class="op" id="1835057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835060">b</span><span class="op" id="1835061">.</span><span class="ident" id="1835062">n</span>&nbsp;<span class="op" id="1835064">+=</span>&nbsp;<span class="ident" id="1835067">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835073">return</span>&nbsp;<span class="ident" id="1835080">size</span><span class="op" id="1835084">,</span>&nbsp;<span class="builtintype" id="1835086">nil</span><br>
<span class="lineno">620</span><span class="op" id="1835090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1835093">//&nbsp;WriteString&nbsp;writes&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1835125">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="1835168">//&nbsp;If&nbsp;the&nbsp;count&nbsp;is&nbsp;less&nbsp;than&nbsp;len(s),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">625</span><span class="comment" id="1835241">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="1835268">func</span>&nbsp;<span class="op" id="1835273">(</span><span class="ident" id="1835274">b</span>&nbsp;<span class="op" id="1835276">*</span><span class="ident" id="1835277">Writer</span><span class="op" id="1835283">)</span>&nbsp;<span class="ident" id="1835285">WriteString</span><span class="op" id="1835296">(</span><span class="ident" id="1835297">s</span>&nbsp;<span class="builtintype" id="1835299">string</span><span class="op" id="1835305">)</span>&nbsp;<span class="op" id="1835307">(</span><span class="builtintype" id="1835308">int</span><span class="op" id="1835311">,</span>&nbsp;<span class="builtintype" id="1835313">error</span><span class="op" id="1835318">)</span>&nbsp;<span class="op" id="1835320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835323">nn</span>&nbsp;<span class="op" id="1835326">:=</span>&nbsp;<span class="num" id="1835329">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835332">for</span>&nbsp;<span class="builtinfunc" id="1835336">len</span><span class="op" id="1835339">(</span><span class="ident" id="1835340">s</span><span class="op" id="1835341">)</span>&nbsp;<span class="op" id="1835343">&gt;</span>&nbsp;<span class="ident" id="1835345">b</span><span class="op" id="1835346">.</span><span class="ident" id="1835347">Available</span><span class="op" id="1835356">(</span><span class="op" id="1835357">)</span>&nbsp;<span class="op" id="1835359">&amp;&amp;</span>&nbsp;<span class="ident" id="1835362">b</span><span class="op" id="1835363">.</span><span class="ident" id="1835364">err</span>&nbsp;<span class="op" id="1835368">==</span>&nbsp;<span class="builtintype" id="1835371">nil</span>&nbsp;<span class="op" id="1835375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835379">n</span>&nbsp;<span class="op" id="1835381">:=</span>&nbsp;<span class="builtinfunc" id="1835384">copy</span><span class="op" id="1835388">(</span><span class="ident" id="1835389">b</span><span class="op" id="1835390">.</span><span class="ident" id="1835391">buf</span><span class="op" id="1835394">[</span><span class="ident" id="1835395">b</span><span class="op" id="1835396">.</span><span class="ident" id="1835397">n</span><span class="op" id="1835398">:</span><span class="op" id="1835399">]</span><span class="op" id="1835400">,</span>&nbsp;<span class="ident" id="1835402">s</span><span class="op" id="1835403">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835407">b</span><span class="op" id="1835408">.</span><span class="ident" id="1835409">n</span>&nbsp;<span class="op" id="1835411">+=</span>&nbsp;<span class="ident" id="1835414">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835418">nn</span>&nbsp;<span class="op" id="1835421">+=</span>&nbsp;<span class="ident" id="1835424">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835428">s</span>&nbsp;<span class="op" id="1835430">=</span>&nbsp;<span class="ident" id="1835432">s</span><span class="op" id="1835433">[</span><span class="ident" id="1835434">n</span><span class="op" id="1835435">:</span><span class="op" id="1835436">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835440">b</span><span class="op" id="1835441">.</span><span class="ident" id="1835442">flush</span><span class="op" id="1835447">(</span><span class="op" id="1835448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1835451">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835454">if</span>&nbsp;<span class="ident" id="1835457">b</span><span class="op" id="1835458">.</span><span class="ident" id="1835459">err</span>&nbsp;<span class="op" id="1835463">!=</span>&nbsp;<span class="builtintype" id="1835466">nil</span>&nbsp;<span class="op" id="1835470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835474">return</span>&nbsp;<span class="ident" id="1835481">nn</span><span class="op" id="1835483">,</span>&nbsp;<span class="ident" id="1835485">b</span><span class="op" id="1835486">.</span><span class="ident" id="1835487">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1835492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835495">n</span>&nbsp;<span class="op" id="1835497">:=</span>&nbsp;<span class="builtinfunc" id="1835500">copy</span><span class="op" id="1835504">(</span><span class="ident" id="1835505">b</span><span class="op" id="1835506">.</span><span class="ident" id="1835507">buf</span><span class="op" id="1835510">[</span><span class="ident" id="1835511">b</span><span class="op" id="1835512">.</span><span class="ident" id="1835513">n</span><span class="op" id="1835514">:</span><span class="op" id="1835515">]</span><span class="op" id="1835516">,</span>&nbsp;<span class="ident" id="1835518">s</span><span class="op" id="1835519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835522">b</span><span class="op" id="1835523">.</span><span class="ident" id="1835524">n</span>&nbsp;<span class="op" id="1835526">+=</span>&nbsp;<span class="ident" id="1835529">n</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835532">nn</span>&nbsp;<span class="op" id="1835535">+=</span>&nbsp;<span class="ident" id="1835538">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835541">return</span>&nbsp;<span class="ident" id="1835548">nn</span><span class="op" id="1835550">,</span>&nbsp;<span class="builtintype" id="1835552">nil</span><br>
<span class="lineno"></span><span class="op" id="1835556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1835559">//&nbsp;ReadFrom&nbsp;implements&nbsp;io.ReaderFrom.</span><br>
<span class="lineno">645</span><span class="keyword" id="1835597">func</span>&nbsp;<span class="op" id="1835602">(</span><span class="ident" id="1835603">b</span>&nbsp;<span class="op" id="1835605">*</span><span class="ident" id="1835606">Writer</span><span class="op" id="1835612">)</span>&nbsp;<span class="ident" id="1835614">ReadFrom</span><span class="op" id="1835622">(</span><span class="ident" id="1835623">r</span>&nbsp;<span class="ident" id="1835625">io</span><span class="op" id="1835627">.</span><span class="ident" id="1835628">Reader</span><span class="op" id="1835634">)</span>&nbsp;<span class="op" id="1835636">(</span><span class="ident" id="1835637">n</span>&nbsp;<span class="builtintype" id="1835639">int64</span><span class="op" id="1835644">,</span>&nbsp;<span class="ident" id="1835646">err</span>&nbsp;<span class="builtintype" id="1835650">error</span><span class="op" id="1835655">)</span>&nbsp;<span class="op" id="1835657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835660">if</span>&nbsp;<span class="ident" id="1835663">b</span><span class="op" id="1835664">.</span><span class="ident" id="1835665">Buffered</span><span class="op" id="1835673">(</span><span class="op" id="1835674">)</span>&nbsp;<span class="op" id="1835676">==</span>&nbsp;<span class="num" id="1835679">0</span>&nbsp;<span class="op" id="1835681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835685">if</span>&nbsp;<span class="ident" id="1835688">w</span><span class="op" id="1835689">,</span>&nbsp;<span class="ident" id="1835691">ok</span>&nbsp;<span class="op" id="1835694">:=</span>&nbsp;<span class="ident" id="1835697">b</span><span class="op" id="1835698">.</span><span class="ident" id="1835699">wr</span><span class="op" id="1835701">.</span><span class="op" id="1835702">(</span><span class="ident" id="1835703">io</span><span class="op" id="1835705">.</span><span class="ident" id="1835706">ReaderFrom</span><span class="op" id="1835716">)</span><span class="op" id="1835717">;</span>&nbsp;<span class="ident" id="1835719">ok</span>&nbsp;<span class="op" id="1835722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835727">return</span>&nbsp;<span class="ident" id="1835734">w</span><span class="op" id="1835735">.</span><span class="ident" id="1835736">ReadFrom</span><span class="op" id="1835744">(</span><span class="ident" id="1835745">r</span><span class="op" id="1835746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1835750">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1835753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835756">var</span>&nbsp;<span class="ident" id="1835760">m</span>&nbsp;<span class="builtintype" id="1835762">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835767">for</span>&nbsp;<span class="op" id="1835771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835775">if</span>&nbsp;<span class="ident" id="1835778">b</span><span class="op" id="1835779">.</span><span class="ident" id="1835780">Available</span><span class="op" id="1835789">(</span><span class="op" id="1835790">)</span>&nbsp;<span class="op" id="1835792">==</span>&nbsp;<span class="num" id="1835795">0</span>&nbsp;<span class="op" id="1835797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835802">if</span>&nbsp;<span class="ident" id="1835805">err1</span>&nbsp;<span class="op" id="1835810">:=</span>&nbsp;<span class="ident" id="1835813">b</span><span class="op" id="1835814">.</span><span class="ident" id="1835815">flush</span><span class="op" id="1835820">(</span><span class="op" id="1835821">)</span><span class="op" id="1835822">;</span>&nbsp;<span class="ident" id="1835824">err1</span>&nbsp;<span class="op" id="1835829">!=</span>&nbsp;<span class="builtintype" id="1835832">nil</span>&nbsp;<span class="op" id="1835836">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835842">return</span>&nbsp;<span class="ident" id="1835849">n</span><span class="op" id="1835850">,</span>&nbsp;<span class="ident" id="1835852">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1835860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1835864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835868">nr</span>&nbsp;<span class="op" id="1835871">:=</span>&nbsp;<span class="num" id="1835874">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835878">for</span>&nbsp;<span class="ident" id="1835882">nr</span>&nbsp;<span class="op" id="1835885">&lt;</span>&nbsp;<span class="ident" id="1835887">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="1835912">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835917">m</span><span class="op" id="1835918">,</span>&nbsp;<span class="ident" id="1835920">err</span>&nbsp;<span class="op" id="1835924">=</span>&nbsp;<span class="ident" id="1835926">r</span><span class="op" id="1835927">.</span><span class="ident" id="1835928">Read</span><span class="op" id="1835932">(</span><span class="ident" id="1835933">b</span><span class="op" id="1835934">.</span><span class="ident" id="1835935">buf</span><span class="op" id="1835938">[</span><span class="ident" id="1835939">b</span><span class="op" id="1835940">.</span><span class="ident" id="1835941">n</span><span class="op" id="1835942">:</span><span class="op" id="1835943">]</span><span class="op" id="1835944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835949">if</span>&nbsp;<span class="ident" id="1835952">m</span>&nbsp;<span class="op" id="1835954">!=</span>&nbsp;<span class="num" id="1835957">0</span>&nbsp;<span class="op" id="1835959">||</span>&nbsp;<span class="ident" id="1835962">err</span>&nbsp;<span class="op" id="1835966">!=</span>&nbsp;<span class="builtintype" id="1835969">nil</span>&nbsp;<span class="op" id="1835973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1835979">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1835988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1835993">nr</span><span class="op" id="1835995">++</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1836000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1836004">if</span>&nbsp;<span class="ident" id="1836007">nr</span>&nbsp;<span class="op" id="1836010">==</span>&nbsp;<span class="ident" id="1836013">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="1836038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1836043">return</span>&nbsp;<span class="ident" id="1836050">n</span><span class="op" id="1836051">,</span>&nbsp;<span class="ident" id="1836053">io</span><span class="op" id="1836055">.</span><span class="ident" id="1836056">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1836072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1836076">b</span><span class="op" id="1836077">.</span><span class="ident" id="1836078">n</span>&nbsp;<span class="op" id="1836080">+=</span>&nbsp;<span class="ident" id="1836083">m</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1836087">n</span>&nbsp;<span class="op" id="1836089">+=</span>&nbsp;<span class="builtintype" id="1836092">int64</span><span class="op" id="1836097">(</span><span class="ident" id="1836098">m</span><span class="op" id="1836099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1836103">if</span>&nbsp;<span class="ident" id="1836106">err</span>&nbsp;<span class="op" id="1836110">!=</span>&nbsp;<span class="builtintype" id="1836113">nil</span>&nbsp;<span class="op" id="1836117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1836122">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1836130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1836133">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1836136">if</span>&nbsp;<span class="ident" id="1836139">err</span>&nbsp;<span class="op" id="1836143">==</span>&nbsp;<span class="ident" id="1836146">io</span><span class="op" id="1836148">.</span><span class="ident" id="1836149">EOF</span>&nbsp;<span class="op" id="1836153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1836157">//&nbsp;If&nbsp;we&nbsp;filled&nbsp;the&nbsp;buffer&nbsp;exactly,&nbsp;flush&nbsp;pre-emptively.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1836216">if</span>&nbsp;<span class="ident" id="1836219">b</span><span class="op" id="1836220">.</span><span class="ident" id="1836221">Available</span><span class="op" id="1836230">(</span><span class="op" id="1836231">)</span>&nbsp;<span class="op" id="1836233">==</span>&nbsp;<span class="num" id="1836236">0</span>&nbsp;<span class="op" id="1836238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1836243">err</span>&nbsp;<span class="op" id="1836247">=</span>&nbsp;<span class="ident" id="1836249">b</span><span class="op" id="1836250">.</span><span class="ident" id="1836251">flush</span><span class="op" id="1836256">(</span><span class="op" id="1836257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1836261">}</span>&nbsp;<span class="keyword" id="1836263">else</span>&nbsp;<span class="op" id="1836268">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1836273">err</span>&nbsp;<span class="op" id="1836277">=</span>&nbsp;<span class="builtintype" id="1836279">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1836285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1836288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1836291">return</span>&nbsp;<span class="ident" id="1836298">n</span><span class="op" id="1836299">,</span>&nbsp;<span class="ident" id="1836301">err</span><br>
<span class="lineno"></span><span class="op" id="1836305">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="1836308">//&nbsp;buffered&nbsp;input&nbsp;and&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1836338">//&nbsp;ReadWriter&nbsp;stores&nbsp;pointers&nbsp;to&nbsp;a&nbsp;Reader&nbsp;and&nbsp;a&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="1836394">//&nbsp;It&nbsp;implements&nbsp;io.ReadWriter.</span><br>
<span class="lineno">690</span><span class="keyword" id="1836426">type</span>&nbsp;<span class="ident" id="1836431">ReadWriter</span>&nbsp;<span class="keyword" id="1836442">struct</span>&nbsp;<span class="op" id="1836449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1836452">*</span><span class="ident" id="1836453">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1836461">*</span><span class="ident" id="1836462">Writer</span><br>
<span class="lineno"></span><span class="op" id="1836469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="1836472">//&nbsp;NewReadWriter&nbsp;allocates&nbsp;a&nbsp;new&nbsp;ReadWriter&nbsp;that&nbsp;dispatches&nbsp;to&nbsp;r&nbsp;and&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="1836544">func</span>&nbsp;<span class="ident" id="1836549">NewReadWriter</span><span class="op" id="1836562">(</span><span class="ident" id="1836563">r</span>&nbsp;<span class="op" id="1836565">*</span><span class="ident" id="1836566">Reader</span><span class="op" id="1836572">,</span>&nbsp;<span class="ident" id="1836574">w</span>&nbsp;<span class="op" id="1836576">*</span><span class="ident" id="1836577">Writer</span><span class="op" id="1836583">)</span>&nbsp;<span class="op" id="1836585">*</span><span class="ident" id="1836586">ReadWriter</span>&nbsp;<span class="op" id="1836597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1836600">return</span>&nbsp;<span class="op" id="1836607">&amp;</span><span class="ident" id="1836608">ReadWriter</span><span class="op" id="1836618">{</span><span class="ident" id="1836619">r</span><span class="op" id="1836620">,</span>&nbsp;<span class="ident" id="1836622">w</span><span class="op" id="1836623">}</span><br>
<span class="lineno"></span><span class="op" id="1836625">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
