<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8495168">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8495224">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8495278">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8495329">//&nbsp;Bridge&nbsp;package&nbsp;to&nbsp;expose&nbsp;http&nbsp;internals&nbsp;to&nbsp;tests&nbsp;in&nbsp;the&nbsp;http_test</span><br>
<span class="lineno"></span><span class="comment" id="8495398">//&nbsp;package.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8495411">package</span>&nbsp;<span class="ident" id="8495419">http</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="8495425">import</span>&nbsp;<span class="op" id="8495432">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8495435">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8495442">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8495453">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8495460">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8495463">func</span>&nbsp;<span class="ident" id="8495468">NewLoggingConn</span><span class="op" id="8495482">(</span><span class="ident" id="8495483">baseName</span>&nbsp;<span class="builtintype" id="8495492">string</span><span class="op" id="8495498">,</span>&nbsp;<span class="ident" id="8495500">c</span>&nbsp;<span class="ident" id="8495502">net</span><span class="op" id="8495505">.</span><span class="ident" id="8495506">Conn</span><span class="op" id="8495510">)</span>&nbsp;<span class="ident" id="8495512">net</span><span class="op" id="8495515">.</span><span class="ident" id="8495516">Conn</span>&nbsp;<span class="op" id="8495521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8495524">return</span>&nbsp;<span class="ident" id="8495531">newLoggingConn</span><span class="op" id="8495545">(</span><span class="ident" id="8495546">baseName</span><span class="op" id="8495554">,</span>&nbsp;<span class="ident" id="8495556">c</span><span class="op" id="8495557">)</span><br>
<span class="lineno"></span><span class="op" id="8495559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8495562">var</span>&nbsp;<span class="ident" id="8495566">ExportAppendTime</span>&nbsp;<span class="op" id="8495583">=</span>&nbsp;<span class="ident" id="8495585">appendTime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8495597">func</span>&nbsp;<span class="op" id="8495602">(</span><span class="ident" id="8495603">t</span>&nbsp;<span class="op" id="8495605">*</span><span class="ident" id="8495606">Transport</span><span class="op" id="8495615">)</span>&nbsp;<span class="ident" id="8495617">NumPendingRequestsForTesting</span><span class="op" id="8495645">(</span><span class="op" id="8495646">)</span>&nbsp;<span class="builtintype" id="8495648">int</span>&nbsp;<span class="op" id="8495652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495655">t</span><span class="op" id="8495656">.</span><span class="ident" id="8495657">reqMu</span><span class="op" id="8495662">.</span><span class="ident" id="8495663">Lock</span><span class="op" id="8495667">(</span><span class="op" id="8495668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8495671">defer</span>&nbsp;<span class="ident" id="8495677">t</span><span class="op" id="8495678">.</span><span class="ident" id="8495679">reqMu</span><span class="op" id="8495684">.</span><span class="ident" id="8495685">Unlock</span><span class="op" id="8495691">(</span><span class="op" id="8495692">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8495695">return</span>&nbsp;<span class="builtinfunc" id="8495702">len</span><span class="op" id="8495705">(</span><span class="ident" id="8495706">t</span><span class="op" id="8495707">.</span><span class="ident" id="8495708">reqCanceler</span><span class="op" id="8495719">)</span><br>
<span class="lineno"></span><span class="op" id="8495721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8495724">func</span>&nbsp;<span class="op" id="8495729">(</span><span class="ident" id="8495730">t</span>&nbsp;<span class="op" id="8495732">*</span><span class="ident" id="8495733">Transport</span><span class="op" id="8495742">)</span>&nbsp;<span class="ident" id="8495744">IdleConnKeysForTesting</span><span class="op" id="8495766">(</span><span class="op" id="8495767">)</span>&nbsp;<span class="op" id="8495769">(</span><span class="ident" id="8495770">keys</span>&nbsp;<span class="op" id="8495775">[</span><span class="op" id="8495776">]</span><span class="builtintype" id="8495777">string</span><span class="op" id="8495783">)</span>&nbsp;<span class="op" id="8495785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495788">keys</span>&nbsp;<span class="op" id="8495793">=</span>&nbsp;<span class="builtinfunc" id="8495795">make</span><span class="op" id="8495799">(</span><span class="op" id="8495800">[</span><span class="op" id="8495801">]</span><span class="builtintype" id="8495802">string</span><span class="op" id="8495808">,</span>&nbsp;<span class="num" id="8495810">0</span><span class="op" id="8495811">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495814">t</span><span class="op" id="8495815">.</span><span class="ident" id="8495816">idleMu</span><span class="op" id="8495822">.</span><span class="ident" id="8495823">Lock</span><span class="op" id="8495827">(</span><span class="op" id="8495828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8495831">defer</span>&nbsp;<span class="ident" id="8495837">t</span><span class="op" id="8495838">.</span><span class="ident" id="8495839">idleMu</span><span class="op" id="8495845">.</span><span class="ident" id="8495846">Unlock</span><span class="op" id="8495852">(</span><span class="op" id="8495853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8495856">if</span>&nbsp;<span class="ident" id="8495859">t</span><span class="op" id="8495860">.</span><span class="ident" id="8495861">idleConn</span>&nbsp;<span class="op" id="8495870">==</span>&nbsp;<span class="ident" id="8495873">nil</span>&nbsp;<span class="op" id="8495877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8495881">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8495889">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8495892">for</span>&nbsp;<span class="ident" id="8495896">key</span>&nbsp;<span class="op" id="8495900">:=</span>&nbsp;<span class="keyword" id="8495903">range</span>&nbsp;<span class="ident" id="8495909">t</span><span class="op" id="8495910">.</span><span class="ident" id="8495911">idleConn</span>&nbsp;<span class="op" id="8495920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495924">keys</span>&nbsp;<span class="op" id="8495929">=</span>&nbsp;<span class="builtinfunc" id="8495931">append</span><span class="op" id="8495937">(</span><span class="ident" id="8495938">keys</span><span class="op" id="8495942">,</span>&nbsp;<span class="ident" id="8495944">key</span><span class="op" id="8495947">.</span><span class="ident" id="8495948">String</span><span class="op" id="8495954">(</span><span class="op" id="8495955">)</span><span class="op" id="8495956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8495959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8495962">return</span><br>
<span class="lineno"></span><span class="op" id="8495969">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8495972">func</span>&nbsp;<span class="op" id="8495977">(</span><span class="ident" id="8495978">t</span>&nbsp;<span class="op" id="8495980">*</span><span class="ident" id="8495981">Transport</span><span class="op" id="8495990">)</span>&nbsp;<span class="ident" id="8495992">IdleConnCountForTesting</span><span class="op" id="8496015">(</span><span class="ident" id="8496016">cacheKey</span>&nbsp;<span class="builtintype" id="8496025">string</span><span class="op" id="8496031">)</span>&nbsp;<span class="builtintype" id="8496033">int</span>&nbsp;<span class="op" id="8496037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8496040">t</span><span class="op" id="8496041">.</span><span class="ident" id="8496042">idleMu</span><span class="op" id="8496048">.</span><span class="ident" id="8496049">Lock</span><span class="op" id="8496053">(</span><span class="op" id="8496054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496057">defer</span>&nbsp;<span class="ident" id="8496063">t</span><span class="op" id="8496064">.</span><span class="ident" id="8496065">idleMu</span><span class="op" id="8496071">.</span><span class="ident" id="8496072">Unlock</span><span class="op" id="8496078">(</span><span class="op" id="8496079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496082">if</span>&nbsp;<span class="ident" id="8496085">t</span><span class="op" id="8496086">.</span><span class="ident" id="8496087">idleConn</span>&nbsp;<span class="op" id="8496096">==</span>&nbsp;<span class="ident" id="8496099">nil</span>&nbsp;<span class="op" id="8496103">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496107">return</span>&nbsp;<span class="num" id="8496114">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8496117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496120">for</span>&nbsp;<span class="ident" id="8496124">k</span><span class="op" id="8496125">,</span>&nbsp;<span class="ident" id="8496127">conns</span>&nbsp;<span class="op" id="8496133">:=</span>&nbsp;<span class="keyword" id="8496136">range</span>&nbsp;<span class="ident" id="8496142">t</span><span class="op" id="8496143">.</span><span class="ident" id="8496144">idleConn</span>&nbsp;<span class="op" id="8496153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496157">if</span>&nbsp;<span class="ident" id="8496160">k</span><span class="op" id="8496161">.</span><span class="ident" id="8496162">String</span><span class="op" id="8496168">(</span><span class="op" id="8496169">)</span>&nbsp;<span class="op" id="8496171">==</span>&nbsp;<span class="ident" id="8496174">cacheKey</span>&nbsp;<span class="op" id="8496183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496188">return</span>&nbsp;<span class="builtinfunc" id="8496195">len</span><span class="op" id="8496198">(</span><span class="ident" id="8496199">conns</span><span class="op" id="8496204">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8496208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8496211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496214">return</span>&nbsp;<span class="num" id="8496221">0</span><br>
<span class="lineno"></span><span class="op" id="8496223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8496226">func</span>&nbsp;<span class="op" id="8496231">(</span><span class="ident" id="8496232">t</span>&nbsp;<span class="op" id="8496234">*</span><span class="ident" id="8496235">Transport</span><span class="op" id="8496244">)</span>&nbsp;<span class="ident" id="8496246">IdleConnChMapSizeForTesting</span><span class="op" id="8496273">(</span><span class="op" id="8496274">)</span>&nbsp;<span class="builtintype" id="8496276">int</span>&nbsp;<span class="op" id="8496280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8496283">t</span><span class="op" id="8496284">.</span><span class="ident" id="8496285">idleMu</span><span class="op" id="8496291">.</span><span class="ident" id="8496292">Lock</span><span class="op" id="8496296">(</span><span class="op" id="8496297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496300">defer</span>&nbsp;<span class="ident" id="8496306">t</span><span class="op" id="8496307">.</span><span class="ident" id="8496308">idleMu</span><span class="op" id="8496314">.</span><span class="ident" id="8496315">Unlock</span><span class="op" id="8496321">(</span><span class="op" id="8496322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496325">return</span>&nbsp;<span class="builtinfunc" id="8496332">len</span><span class="op" id="8496335">(</span><span class="ident" id="8496336">t</span><span class="op" id="8496337">.</span><span class="ident" id="8496338">idleConnCh</span><span class="op" id="8496348">)</span><br>
<span class="lineno"></span><span class="op" id="8496350">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="8496353">func</span>&nbsp;<span class="op" id="8496358">(</span><span class="ident" id="8496359">t</span>&nbsp;<span class="op" id="8496361">*</span><span class="ident" id="8496362">Transport</span><span class="op" id="8496371">)</span>&nbsp;<span class="ident" id="8496373">IsIdleForTesting</span><span class="op" id="8496389">(</span><span class="op" id="8496390">)</span>&nbsp;<span class="builtintype" id="8496392">bool</span>&nbsp;<span class="op" id="8496397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8496400">t</span><span class="op" id="8496401">.</span><span class="ident" id="8496402">idleMu</span><span class="op" id="8496408">.</span><span class="ident" id="8496409">Lock</span><span class="op" id="8496413">(</span><span class="op" id="8496414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496417">defer</span>&nbsp;<span class="ident" id="8496423">t</span><span class="op" id="8496424">.</span><span class="ident" id="8496425">idleMu</span><span class="op" id="8496431">.</span><span class="ident" id="8496432">Unlock</span><span class="op" id="8496438">(</span><span class="op" id="8496439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496442">return</span>&nbsp;<span class="ident" id="8496449">t</span><span class="op" id="8496450">.</span><span class="ident" id="8496451">wantIdle</span><br>
<span class="lineno">65</span><span class="op" id="8496460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8496463">func</span>&nbsp;<span class="op" id="8496468">(</span><span class="ident" id="8496469">t</span>&nbsp;<span class="op" id="8496471">*</span><span class="ident" id="8496472">Transport</span><span class="op" id="8496481">)</span>&nbsp;<span class="ident" id="8496483">RequestIdleConnChForTesting</span><span class="op" id="8496510">(</span><span class="op" id="8496511">)</span>&nbsp;<span class="op" id="8496513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8496516">t</span><span class="op" id="8496517">.</span><span class="ident" id="8496518">getIdleConnCh</span><span class="op" id="8496531">(</span><span class="ident" id="8496532">connectMethod</span><span class="op" id="8496545">{</span><span class="ident" id="8496546">nil</span><span class="op" id="8496549">,</span>&nbsp;<span class="string" id="8496551">&#34;http&#34;</span><span class="op" id="8496557">,</span>&nbsp;<span class="string" id="8496559">&#34;example.com&#34;</span><span class="op" id="8496572">}</span><span class="op" id="8496573">)</span><br>
<span class="lineno"></span><span class="op" id="8496575">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="8496578">func</span>&nbsp;<span class="op" id="8496583">(</span><span class="ident" id="8496584">t</span>&nbsp;<span class="op" id="8496586">*</span><span class="ident" id="8496587">Transport</span><span class="op" id="8496596">)</span>&nbsp;<span class="ident" id="8496598">PutIdleTestConn</span><span class="op" id="8496613">(</span><span class="op" id="8496614">)</span>&nbsp;<span class="builtintype" id="8496616">bool</span>&nbsp;<span class="op" id="8496621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8496624">c</span><span class="op" id="8496625">,</span>&nbsp;<span class="ident" id="8496627">_</span>&nbsp;<span class="op" id="8496629">:=</span>&nbsp;<span class="ident" id="8496632">net</span><span class="op" id="8496635">.</span><span class="ident" id="8496636">Pipe</span><span class="op" id="8496640">(</span><span class="op" id="8496641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496644">return</span>&nbsp;<span class="ident" id="8496651">t</span><span class="op" id="8496652">.</span><span class="ident" id="8496653">putIdleConn</span><span class="op" id="8496664">(</span><span class="op" id="8496665">&amp;</span><span class="ident" id="8496666">persistConn</span><span class="op" id="8496677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8496681">t</span><span class="op" id="8496682">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8496691">t</span><span class="op" id="8496692">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8496696">conn</span><span class="op" id="8496700">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8496706">c</span><span class="op" id="8496707">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8496727">//&nbsp;dummy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8496738">closech</span><span class="op" id="8496745">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="8496748">make</span><span class="op" id="8496752">(</span><span class="keyword" id="8496753">chan</span>&nbsp;<span class="keyword" id="8496758">struct</span><span class="op" id="8496764">{</span><span class="op" id="8496765">}</span><span class="op" id="8496766">)</span><span class="op" id="8496767">,</span>&nbsp;<span class="comment" id="8496769">//&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8496794">cacheKey</span><span class="op" id="8496802">:</span>&nbsp;<span class="ident" id="8496804">connectMethodKey</span><span class="op" id="8496820">{</span><span class="string" id="8496821">&#34;&#34;</span><span class="op" id="8496823">,</span>&nbsp;<span class="string" id="8496825">&#34;http&#34;</span><span class="op" id="8496831">,</span>&nbsp;<span class="string" id="8496833">&#34;example.com&#34;</span><span class="op" id="8496846">}</span><span class="op" id="8496847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8496850">}</span><span class="op" id="8496851">)</span><br>
<span class="lineno"></span><span class="op" id="8496853">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="8496856">func</span>&nbsp;<span class="ident" id="8496861">NewTestTimeoutHandler</span><span class="op" id="8496882">(</span><span class="ident" id="8496883">handler</span>&nbsp;<span class="ident" id="8496891">Handler</span><span class="op" id="8496898">,</span>&nbsp;<span class="ident" id="8496900">ch</span>&nbsp;<span class="op" id="8496903">&lt;-</span><span class="keyword" id="8496905">chan</span>&nbsp;<span class="ident" id="8496910">time</span><span class="op" id="8496914">.</span><span class="ident" id="8496915">Time</span><span class="op" id="8496919">)</span>&nbsp;<span class="ident" id="8496921">Handler</span>&nbsp;<span class="op" id="8496929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8496932">f</span>&nbsp;<span class="op" id="8496934">:=</span>&nbsp;<span class="keyword" id="8496937">func</span><span class="op" id="8496941">(</span><span class="op" id="8496942">)</span>&nbsp;<span class="op" id="8496944">&lt;-</span><span class="keyword" id="8496946">chan</span>&nbsp;<span class="ident" id="8496951">time</span><span class="op" id="8496955">.</span><span class="ident" id="8496956">Time</span>&nbsp;<span class="op" id="8496961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496965">return</span>&nbsp;<span class="ident" id="8496972">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8496976">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8496979">return</span>&nbsp;<span class="op" id="8496986">&amp;</span><span class="ident" id="8496987">timeoutHandler</span><span class="op" id="8497001">{</span><span class="ident" id="8497002">handler</span><span class="op" id="8497009">,</span>&nbsp;<span class="ident" id="8497011">f</span><span class="op" id="8497012">,</span>&nbsp;<span class="string" id="8497014">&#34;&#34;</span><span class="op" id="8497016">}</span><br>
<span class="lineno"></span><span class="op" id="8497018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8497021">func</span>&nbsp;<span class="ident" id="8497026">ResetCachedEnvironment</span><span class="op" id="8497048">(</span><span class="op" id="8497049">)</span>&nbsp;<span class="op" id="8497051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8497054">httpProxyEnv</span><span class="op" id="8497066">.</span><span class="ident" id="8497067">reset</span><span class="op" id="8497072">(</span><span class="op" id="8497073">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8497076">httpsProxyEnv</span><span class="op" id="8497089">.</span><span class="ident" id="8497090">reset</span><span class="op" id="8497095">(</span><span class="op" id="8497096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8497099">noProxyEnv</span><span class="op" id="8497109">.</span><span class="ident" id="8497110">reset</span><span class="op" id="8497115">(</span><span class="op" id="8497116">)</span><br>
<span class="lineno"></span><span class="op" id="8497118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8497121">var</span>&nbsp;<span class="ident" id="8497125">DefaultUserAgent</span>&nbsp;<span class="op" id="8497142">=</span>&nbsp;<span class="ident" id="8497144">defaultUserAgent</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="8497162">func</span>&nbsp;<span class="ident" id="8497167">ExportRefererForURL</span><span class="op" id="8497186">(</span><span class="ident" id="8497187">lastReq</span><span class="op" id="8497194">,</span>&nbsp;<span class="ident" id="8497196">newReq</span>&nbsp;<span class="op" id="8497203">*</span><span class="ident" id="8497204">url</span><span class="op" id="8497207">.</span><span class="ident" id="8497208">URL</span><span class="op" id="8497211">)</span>&nbsp;<span class="builtintype" id="8497213">string</span>&nbsp;<span class="op" id="8497220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8497223">return</span>&nbsp;<span class="ident" id="8497230">refererForURL</span><span class="op" id="8497243">(</span><span class="ident" id="8497244">lastReq</span><span class="op" id="8497251">,</span>&nbsp;<span class="ident" id="8497253">newReq</span><span class="op" id="8497259">)</span><br>
<span class="lineno"></span><span class="op" id="8497261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="8497264">//&nbsp;SetPendingDialHooks&nbsp;sets&nbsp;the&nbsp;hooks&nbsp;that&nbsp;run&nbsp;before&nbsp;and&nbsp;after&nbsp;handling</span><br>
<span class="lineno"></span><span class="comment" id="8497337">//&nbsp;pending&nbsp;dials.</span><br>
<span class="lineno"></span><span class="keyword" id="8497355">func</span>&nbsp;<span class="ident" id="8497360">SetPendingDialHooks</span><span class="op" id="8497379">(</span><span class="ident" id="8497380">before</span><span class="op" id="8497386">,</span>&nbsp;<span class="ident" id="8497388">after</span>&nbsp;<span class="keyword" id="8497394">func</span><span class="op" id="8497398">(</span><span class="op" id="8497399">)</span><span class="op" id="8497400">)</span>&nbsp;<span class="op" id="8497402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8497405">prePendingDial</span><span class="op" id="8497419">,</span>&nbsp;<span class="ident" id="8497421">postPendingDial</span>&nbsp;<span class="op" id="8497437">=</span>&nbsp;<span class="ident" id="8497439">before</span><span class="op" id="8497445">,</span>&nbsp;<span class="ident" id="8497447">after</span><br>
<span class="lineno"></span><span class="op" id="8497453">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8497456">var</span>&nbsp;<span class="ident" id="8497460">ExportServerNewConn</span>&nbsp;<span class="op" id="8497480">=</span>&nbsp;<span class="op" id="8497482">(</span><span class="op" id="8497483">*</span><span class="ident" id="8497484">Server</span><span class="op" id="8497490">)</span><span class="op" id="8497491">.</span><span class="ident" id="8497492">newConn</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8497501">var</span>&nbsp;<span class="ident" id="8497505">ExportCloseWriteAndWait</span>&nbsp;<span class="op" id="8497529">=</span>&nbsp;<span class="op" id="8497531">(</span><span class="op" id="8497532">*</span><span class="ident" id="8497533">conn</span><span class="op" id="8497537">)</span><span class="op" id="8497538">.</span><span class="ident" id="8497539">closeWriteAndWait</span>
</div>
</body>
</html>
