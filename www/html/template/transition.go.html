<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4465596">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4465651">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4465705">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4465756">package</span>&nbsp;<span class="ident" id="4465764">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4465774">import</span>&nbsp;<span class="op" id="4465781">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4465784">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4465793">&#34;strings&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4465803">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4465806">//&nbsp;transitionFunc&nbsp;is&nbsp;the&nbsp;array&nbsp;of&nbsp;context&nbsp;transition&nbsp;functions&nbsp;for&nbsp;text&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="4465885">//&nbsp;A&nbsp;transition&nbsp;function&nbsp;takes&nbsp;a&nbsp;context&nbsp;and&nbsp;template&nbsp;text&nbsp;input,&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4465963">//&nbsp;the&nbsp;updated&nbsp;context&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;consumed&nbsp;from&nbsp;the&nbsp;front&nbsp;of&nbsp;the</span><br>
<span class="lineno">15</span><span class="comment" id="4466041">//&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="4466051">var</span>&nbsp;<span class="ident" id="4466055">transitionFunc</span>&nbsp;<span class="op" id="4466070">=</span>&nbsp;<span class="op" id="4466072">[</span><span class="op" id="4466073">...</span><span class="op" id="4466076">]</span><span class="keyword" id="4466077">func</span><span class="op" id="4466081">(</span><span class="ident" id="4466082">context</span><span class="op" id="4466089">,</span>&nbsp;<span class="op" id="4466091">[</span><span class="op" id="4466092">]</span><span class="builtintype" id="4466093">byte</span><span class="op" id="4466097">)</span>&nbsp;<span class="op" id="4466099">(</span><span class="ident" id="4466100">context</span><span class="op" id="4466107">,</span>&nbsp;<span class="builtintype" id="4466109">int</span><span class="op" id="4466112">)</span><span class="op" id="4466113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466116">stateText</span><span class="op" id="4466125">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466134">tText</span><span class="op" id="4466139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466142">stateTag</span><span class="op" id="4466150">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466160">tTag</span><span class="op" id="4466164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466167">stateAttrName</span><span class="op" id="4466180">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466185">tAttrName</span><span class="op" id="4466194">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466197">stateAfterName</span><span class="op" id="4466211">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4466215">tAfterName</span><span class="op" id="4466225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466228">stateBeforeValue</span><span class="op" id="4466244">:</span>&nbsp;<span class="ident" id="4466246">tBeforeValue</span><span class="op" id="4466258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466261">stateHTMLCmt</span><span class="op" id="4466273">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466279">tHTMLCmt</span><span class="op" id="4466287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466290">stateRCDATA</span><span class="op" id="4466301">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466308">tSpecialTagEnd</span><span class="op" id="4466322">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466325">stateAttr</span><span class="op" id="4466334">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466343">tAttr</span><span class="op" id="4466348">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466351">stateURL</span><span class="op" id="4466359">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466369">tURL</span><span class="op" id="4466373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466376">stateJS</span><span class="op" id="4466383">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466394">tJS</span><span class="op" id="4466397">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466400">stateJSDqStr</span><span class="op" id="4466412">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466418">tJSDelimited</span><span class="op" id="4466430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466433">stateJSSqStr</span><span class="op" id="4466445">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466451">tJSDelimited</span><span class="op" id="4466463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466466">stateJSRegexp</span><span class="op" id="4466479">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466484">tJSDelimited</span><span class="op" id="4466496">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466499">stateJSBlockCmt</span><span class="op" id="4466514">:</span>&nbsp;&nbsp;<span class="ident" id="4466517">tBlockCmt</span><span class="op" id="4466526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466529">stateJSLineCmt</span><span class="op" id="4466543">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4466547">tLineCmt</span><span class="op" id="4466555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466558">stateCSS</span><span class="op" id="4466566">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466576">tCSS</span><span class="op" id="4466580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466583">stateCSSDqStr</span><span class="op" id="4466596">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466601">tCSSStr</span><span class="op" id="4466608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466611">stateCSSSqStr</span><span class="op" id="4466624">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466629">tCSSStr</span><span class="op" id="4466636">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466639">stateCSSDqURL</span><span class="op" id="4466652">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466657">tCSSStr</span><span class="op" id="4466664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466667">stateCSSSqURL</span><span class="op" id="4466680">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466685">tCSSStr</span><span class="op" id="4466692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466695">stateCSSURL</span><span class="op" id="4466706">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466713">tCSSStr</span><span class="op" id="4466720">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466723">stateCSSBlockCmt</span><span class="op" id="4466739">:</span>&nbsp;<span class="ident" id="4466741">tBlockCmt</span><span class="op" id="4466750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466753">stateCSSLineCmt</span><span class="op" id="4466768">:</span>&nbsp;&nbsp;<span class="ident" id="4466771">tLineCmt</span><span class="op" id="4466779">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466782">stateError</span><span class="op" id="4466792">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466800">tError</span><span class="op" id="4466806">,</span><br>
<span class="lineno"></span><span class="op" id="4466808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4466811">var</span>&nbsp;<span class="ident" id="4466815">commentStart</span>&nbsp;<span class="op" id="4466828">=</span>&nbsp;<span class="op" id="4466830">[</span><span class="op" id="4466831">]</span><span class="builtintype" id="4466832">byte</span><span class="op" id="4466836">(</span><span class="string" id="4466837">&#34;&lt;!--&#34;</span><span class="op" id="4466843">)</span><br>
<span class="lineno"></span><span class="keyword" id="4466845">var</span>&nbsp;<span class="ident" id="4466849">commentEnd</span>&nbsp;<span class="op" id="4466860">=</span>&nbsp;<span class="op" id="4466862">[</span><span class="op" id="4466863">]</span><span class="builtintype" id="4466864">byte</span><span class="op" id="4466868">(</span><span class="string" id="4466869">&#34;--&gt;&#34;</span><span class="op" id="4466874">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4466877">//&nbsp;tText&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;text&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4466941">func</span>&nbsp;<span class="ident" id="4466946">tText</span><span class="op" id="4466951">(</span><span class="ident" id="4466952">c</span>&nbsp;<span class="ident" id="4466954">context</span><span class="op" id="4466961">,</span>&nbsp;<span class="ident" id="4466963">s</span>&nbsp;<span class="op" id="4466965">[</span><span class="op" id="4466966">]</span><span class="builtintype" id="4466967">byte</span><span class="op" id="4466971">)</span>&nbsp;<span class="op" id="4466973">(</span><span class="ident" id="4466974">context</span><span class="op" id="4466981">,</span>&nbsp;<span class="builtintype" id="4466983">int</span><span class="op" id="4466986">)</span>&nbsp;<span class="op" id="4466988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466991">k</span>&nbsp;<span class="op" id="4466993">:=</span>&nbsp;<span class="num" id="4466996">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466999">for</span>&nbsp;<span class="op" id="4467003">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467007">i</span>&nbsp;<span class="op" id="4467009">:=</span>&nbsp;<span class="ident" id="4467012">k</span>&nbsp;<span class="op" id="4467014">+</span>&nbsp;<span class="ident" id="4467016">bytes</span><span class="op" id="4467021">.</span><span class="ident" id="4467022">IndexByte</span><span class="op" id="4467031">(</span><span class="ident" id="4467032">s</span><span class="op" id="4467033">[</span><span class="ident" id="4467034">k</span><span class="op" id="4467035">:</span><span class="op" id="4467036">]</span><span class="op" id="4467037">,</span>&nbsp;<span class="string" id="4467039">&#39;&lt;&#39;</span><span class="op" id="4467042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467046">if</span>&nbsp;<span class="ident" id="4467049">i</span>&nbsp;<span class="op" id="4467051">&lt;</span>&nbsp;<span class="ident" id="4467053">k</span>&nbsp;<span class="op" id="4467055">||</span>&nbsp;<span class="ident" id="4467058">i</span><span class="op" id="4467059">+</span><span class="num" id="4467060">1</span>&nbsp;<span class="op" id="4467062">==</span>&nbsp;<span class="builtinfunc" id="4467065">len</span><span class="op" id="4467068">(</span><span class="ident" id="4467069">s</span><span class="op" id="4467070">)</span>&nbsp;<span class="op" id="4467072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467077">return</span>&nbsp;<span class="ident" id="4467084">c</span><span class="op" id="4467085">,</span>&nbsp;<span class="builtinfunc" id="4467087">len</span><span class="op" id="4467090">(</span><span class="ident" id="4467091">s</span><span class="op" id="4467092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467096">}</span>&nbsp;<span class="keyword" id="4467098">else</span>&nbsp;<span class="keyword" id="4467103">if</span>&nbsp;<span class="ident" id="4467106">i</span><span class="op" id="4467107">+</span><span class="num" id="4467108">4</span>&nbsp;<span class="op" id="4467110">&lt;=</span>&nbsp;<span class="builtinfunc" id="4467113">len</span><span class="op" id="4467116">(</span><span class="ident" id="4467117">s</span><span class="op" id="4467118">)</span>&nbsp;<span class="op" id="4467120">&amp;&amp;</span>&nbsp;<span class="ident" id="4467123">bytes</span><span class="op" id="4467128">.</span><span class="ident" id="4467129">Equal</span><span class="op" id="4467134">(</span><span class="ident" id="4467135">commentStart</span><span class="op" id="4467147">,</span>&nbsp;<span class="ident" id="4467149">s</span><span class="op" id="4467150">[</span><span class="ident" id="4467151">i</span><span class="op" id="4467152">:</span><span class="ident" id="4467153">i</span><span class="op" id="4467154">+</span><span class="num" id="4467155">4</span><span class="op" id="4467156">]</span><span class="op" id="4467157">)</span>&nbsp;<span class="op" id="4467159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467164">return</span>&nbsp;<span class="ident" id="4467171">context</span><span class="op" id="4467178">{</span><span class="ident" id="4467179">state</span><span class="op" id="4467184">:</span>&nbsp;<span class="ident" id="4467186">stateHTMLCmt</span><span class="op" id="4467198">}</span><span class="op" id="4467199">,</span>&nbsp;<span class="ident" id="4467201">i</span>&nbsp;<span class="op" id="4467203">+</span>&nbsp;<span class="num" id="4467205">4</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467213">i</span><span class="op" id="4467214">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467219">end</span>&nbsp;<span class="op" id="4467223">:=</span>&nbsp;<span class="ident" id="4467226">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467234">if</span>&nbsp;<span class="ident" id="4467237">s</span><span class="op" id="4467238">[</span><span class="ident" id="4467239">i</span><span class="op" id="4467240">]</span>&nbsp;<span class="op" id="4467242">==</span>&nbsp;<span class="string" id="4467245">&#39;/&#39;</span>&nbsp;<span class="op" id="4467249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467254">if</span>&nbsp;<span class="ident" id="4467257">i</span><span class="op" id="4467258">+</span><span class="num" id="4467259">1</span>&nbsp;<span class="op" id="4467261">==</span>&nbsp;<span class="builtinfunc" id="4467264">len</span><span class="op" id="4467267">(</span><span class="ident" id="4467268">s</span><span class="op" id="4467269">)</span>&nbsp;<span class="op" id="4467271">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467277">return</span>&nbsp;<span class="ident" id="4467284">c</span><span class="op" id="4467285">,</span>&nbsp;<span class="builtinfunc" id="4467287">len</span><span class="op" id="4467290">(</span><span class="ident" id="4467291">s</span><span class="op" id="4467292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467302">end</span><span class="op" id="4467305">,</span>&nbsp;<span class="ident" id="4467307">i</span>&nbsp;<span class="op" id="4467309">=</span>&nbsp;<span class="ident" id="4467311">true</span><span class="op" id="4467315">,</span>&nbsp;<span class="ident" id="4467317">i</span><span class="op" id="4467318">+</span><span class="num" id="4467319">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467327">j</span><span class="op" id="4467328">,</span>&nbsp;<span class="ident" id="4467330">e</span>&nbsp;<span class="op" id="4467332">:=</span>&nbsp;<span class="ident" id="4467335">eatTagName</span><span class="op" id="4467345">(</span><span class="ident" id="4467346">s</span><span class="op" id="4467347">,</span>&nbsp;<span class="ident" id="4467349">i</span><span class="op" id="4467350">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467354">if</span>&nbsp;<span class="ident" id="4467357">j</span>&nbsp;<span class="op" id="4467359">!=</span>&nbsp;<span class="ident" id="4467362">i</span>&nbsp;<span class="op" id="4467364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467369">if</span>&nbsp;<span class="ident" id="4467372">end</span>&nbsp;<span class="op" id="4467376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467382">e</span>&nbsp;<span class="op" id="4467384">=</span>&nbsp;<span class="ident" id="4467386">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467406">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467437">return</span>&nbsp;<span class="ident" id="4467444">context</span><span class="op" id="4467451">{</span><span class="ident" id="4467452">state</span><span class="op" id="4467457">:</span>&nbsp;<span class="ident" id="4467459">stateTag</span><span class="op" id="4467467">,</span>&nbsp;<span class="ident" id="4467469">element</span><span class="op" id="4467476">:</span>&nbsp;<span class="ident" id="4467478">e</span><span class="op" id="4467479">}</span><span class="op" id="4467480">,</span>&nbsp;<span class="ident" id="4467482">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467490">k</span>&nbsp;<span class="op" id="4467492">=</span>&nbsp;<span class="ident" id="4467494">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467497">}</span><br>
<span class="lineno"></span><span class="op" id="4467499">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="4467502">var</span>&nbsp;<span class="ident" id="4467506">elementContentType</span>&nbsp;<span class="op" id="4467525">=</span>&nbsp;<span class="op" id="4467527">[</span><span class="op" id="4467528">...</span><span class="op" id="4467531">]</span><span class="ident" id="4467532">state</span><span class="op" id="4467537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467540">elementNone</span><span class="op" id="4467551">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467557">stateText</span><span class="op" id="4467566">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467569">elementScript</span><span class="op" id="4467582">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4467586">stateJS</span><span class="op" id="4467593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467596">elementStyle</span><span class="op" id="4467608">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467613">stateCSS</span><span class="op" id="4467621">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467624">elementTextarea</span><span class="op" id="4467639">:</span>&nbsp;<span class="ident" id="4467641">stateRCDATA</span><span class="op" id="4467652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467655">elementTitle</span><span class="op" id="4467667">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467672">stateRCDATA</span><span class="op" id="4467683">,</span><br>
<span class="lineno"></span><span class="op" id="4467685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4467688">//&nbsp;tTag&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;tag&nbsp;state.</span><br>
<span class="lineno">85</span><span class="keyword" id="4467750">func</span>&nbsp;<span class="ident" id="4467755">tTag</span><span class="op" id="4467759">(</span><span class="ident" id="4467760">c</span>&nbsp;<span class="ident" id="4467762">context</span><span class="op" id="4467769">,</span>&nbsp;<span class="ident" id="4467771">s</span>&nbsp;<span class="op" id="4467773">[</span><span class="op" id="4467774">]</span><span class="builtintype" id="4467775">byte</span><span class="op" id="4467779">)</span>&nbsp;<span class="op" id="4467781">(</span><span class="ident" id="4467782">context</span><span class="op" id="4467789">,</span>&nbsp;<span class="builtintype" id="4467791">int</span><span class="op" id="4467794">)</span>&nbsp;<span class="op" id="4467796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467799">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467828">i</span>&nbsp;<span class="op" id="4467830">:=</span>&nbsp;<span class="ident" id="4467833">eatWhiteSpace</span><span class="op" id="4467846">(</span><span class="ident" id="4467847">s</span><span class="op" id="4467848">,</span>&nbsp;<span class="num" id="4467850">0</span><span class="op" id="4467851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467854">if</span>&nbsp;<span class="ident" id="4467857">i</span>&nbsp;<span class="op" id="4467859">==</span>&nbsp;<span class="builtinfunc" id="4467862">len</span><span class="op" id="4467865">(</span><span class="ident" id="4467866">s</span><span class="op" id="4467867">)</span>&nbsp;<span class="op" id="4467869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467873">return</span>&nbsp;<span class="ident" id="4467880">c</span><span class="op" id="4467881">,</span>&nbsp;<span class="builtinfunc" id="4467883">len</span><span class="op" id="4467886">(</span><span class="ident" id="4467887">s</span><span class="op" id="4467888">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467894">if</span>&nbsp;<span class="ident" id="4467897">s</span><span class="op" id="4467898">[</span><span class="ident" id="4467899">i</span><span class="op" id="4467900">]</span>&nbsp;<span class="op" id="4467902">==</span>&nbsp;<span class="string" id="4467905">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4467909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467913">return</span>&nbsp;<span class="ident" id="4467920">context</span><span class="op" id="4467927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467932">state</span><span class="op" id="4467937">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4467941">elementContentType</span><span class="op" id="4467959">[</span><span class="ident" id="4467960">c</span><span class="op" id="4467961">.</span><span class="ident" id="4467962">element</span><span class="op" id="4467969">]</span><span class="op" id="4467970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467975">element</span><span class="op" id="4467982">:</span>&nbsp;<span class="ident" id="4467984">c</span><span class="op" id="4467985">.</span><span class="ident" id="4467986">element</span><span class="op" id="4467993">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467997">}</span><span class="op" id="4467998">,</span>&nbsp;<span class="ident" id="4468000">i</span>&nbsp;<span class="op" id="4468002">+</span>&nbsp;<span class="num" id="4468004">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468010">j</span><span class="op" id="4468011">,</span>&nbsp;<span class="ident" id="4468013">err</span>&nbsp;<span class="op" id="4468017">:=</span>&nbsp;<span class="ident" id="4468020">eatAttrName</span><span class="op" id="4468031">(</span><span class="ident" id="4468032">s</span><span class="op" id="4468033">,</span>&nbsp;<span class="ident" id="4468035">i</span><span class="op" id="4468036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468039">if</span>&nbsp;<span class="ident" id="4468042">err</span>&nbsp;<span class="op" id="4468046">!=</span>&nbsp;<span class="ident" id="4468049">nil</span>&nbsp;<span class="op" id="4468053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468057">return</span>&nbsp;<span class="ident" id="4468064">context</span><span class="op" id="4468071">{</span><span class="ident" id="4468072">state</span><span class="op" id="4468077">:</span>&nbsp;<span class="ident" id="4468079">stateError</span><span class="op" id="4468089">,</span>&nbsp;<span class="ident" id="4468091">err</span><span class="op" id="4468094">:</span>&nbsp;<span class="ident" id="4468096">err</span><span class="op" id="4468099">}</span><span class="op" id="4468100">,</span>&nbsp;<span class="builtinfunc" id="4468102">len</span><span class="op" id="4468105">(</span><span class="ident" id="4468106">s</span><span class="op" id="4468107">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468113">state</span><span class="op" id="4468118">,</span>&nbsp;<span class="ident" id="4468120">attr</span>&nbsp;<span class="op" id="4468125">:=</span>&nbsp;<span class="ident" id="4468128">stateTag</span><span class="op" id="4468136">,</span>&nbsp;<span class="ident" id="4468138">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468148">if</span>&nbsp;<span class="ident" id="4468151">i</span>&nbsp;<span class="op" id="4468153">==</span>&nbsp;<span class="ident" id="4468156">j</span>&nbsp;<span class="op" id="4468158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468162">return</span>&nbsp;<span class="ident" id="4468169">context</span><span class="op" id="4468176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468181">state</span><span class="op" id="4468186">:</span>&nbsp;<span class="ident" id="4468188">stateError</span><span class="op" id="4468198">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468203">err</span><span class="op" id="4468206">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4468210">errorf</span><span class="op" id="4468216">(</span><span class="ident" id="4468217">ErrBadHTML</span><span class="op" id="4468227">,</span>&nbsp;<span class="ident" id="4468229">nil</span><span class="op" id="4468232">,</span>&nbsp;<span class="num" id="4468234">0</span><span class="op" id="4468235">,</span>&nbsp;<span class="string" id="4468237">&#34;expected&nbsp;space,&nbsp;attr&nbsp;name,&nbsp;or&nbsp;end&nbsp;of&nbsp;tag,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="4468291">,</span>&nbsp;<span class="ident" id="4468293">s</span><span class="op" id="4468294">[</span><span class="ident" id="4468295">i</span><span class="op" id="4468296">:</span><span class="op" id="4468297">]</span><span class="op" id="4468298">)</span><span class="op" id="4468299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468303">}</span><span class="op" id="4468304">,</span>&nbsp;<span class="builtinfunc" id="4468306">len</span><span class="op" id="4468309">(</span><span class="ident" id="4468310">s</span><span class="op" id="4468311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468317">switch</span>&nbsp;<span class="ident" id="4468324">attrType</span><span class="op" id="4468332">(</span><span class="builtintype" id="4468333">string</span><span class="op" id="4468339">(</span><span class="ident" id="4468340">s</span><span class="op" id="4468341">[</span><span class="ident" id="4468342">i</span><span class="op" id="4468343">:</span><span class="ident" id="4468344">j</span><span class="op" id="4468345">]</span><span class="op" id="4468346">)</span><span class="op" id="4468347">)</span>&nbsp;<span class="op" id="4468349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468352">case</span>&nbsp;<span class="ident" id="4468357">contentTypeURL</span><span class="op" id="4468371">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468375">attr</span>&nbsp;<span class="op" id="4468380">=</span>&nbsp;<span class="ident" id="4468382">attrURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468391">case</span>&nbsp;<span class="ident" id="4468396">contentTypeCSS</span><span class="op" id="4468410">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468414">attr</span>&nbsp;<span class="op" id="4468419">=</span>&nbsp;<span class="ident" id="4468421">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468432">case</span>&nbsp;<span class="ident" id="4468437">contentTypeJS</span><span class="op" id="4468450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468454">attr</span>&nbsp;<span class="op" id="4468459">=</span>&nbsp;<span class="ident" id="4468461">attrScript</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468476">if</span>&nbsp;<span class="ident" id="4468479">j</span>&nbsp;<span class="op" id="4468481">==</span>&nbsp;<span class="builtinfunc" id="4468484">len</span><span class="op" id="4468487">(</span><span class="ident" id="4468488">s</span><span class="op" id="4468489">)</span>&nbsp;<span class="op" id="4468491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468495">state</span>&nbsp;<span class="op" id="4468501">=</span>&nbsp;<span class="ident" id="4468503">stateAttrName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468518">}</span>&nbsp;<span class="keyword" id="4468520">else</span>&nbsp;<span class="op" id="4468525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468529">state</span>&nbsp;<span class="op" id="4468535">=</span>&nbsp;<span class="ident" id="4468537">stateAfterName</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468556">return</span>&nbsp;<span class="ident" id="4468563">context</span><span class="op" id="4468570">{</span><span class="ident" id="4468571">state</span><span class="op" id="4468576">:</span>&nbsp;<span class="ident" id="4468578">state</span><span class="op" id="4468583">,</span>&nbsp;<span class="ident" id="4468585">element</span><span class="op" id="4468592">:</span>&nbsp;<span class="ident" id="4468594">c</span><span class="op" id="4468595">.</span><span class="ident" id="4468596">element</span><span class="op" id="4468603">,</span>&nbsp;<span class="ident" id="4468605">attr</span><span class="op" id="4468609">:</span>&nbsp;<span class="ident" id="4468611">attr</span><span class="op" id="4468615">}</span><span class="op" id="4468616">,</span>&nbsp;<span class="ident" id="4468618">j</span><br>
<span class="lineno"></span><span class="op" id="4468620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4468623">//&nbsp;tAttrName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAttrName.</span><br>
<span class="lineno">125</span><span class="keyword" id="4468690">func</span>&nbsp;<span class="ident" id="4468695">tAttrName</span><span class="op" id="4468704">(</span><span class="ident" id="4468705">c</span>&nbsp;<span class="ident" id="4468707">context</span><span class="op" id="4468714">,</span>&nbsp;<span class="ident" id="4468716">s</span>&nbsp;<span class="op" id="4468718">[</span><span class="op" id="4468719">]</span><span class="builtintype" id="4468720">byte</span><span class="op" id="4468724">)</span>&nbsp;<span class="op" id="4468726">(</span><span class="ident" id="4468727">context</span><span class="op" id="4468734">,</span>&nbsp;<span class="builtintype" id="4468736">int</span><span class="op" id="4468739">)</span>&nbsp;<span class="op" id="4468741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468744">i</span><span class="op" id="4468745">,</span>&nbsp;<span class="ident" id="4468747">err</span>&nbsp;<span class="op" id="4468751">:=</span>&nbsp;<span class="ident" id="4468754">eatAttrName</span><span class="op" id="4468765">(</span><span class="ident" id="4468766">s</span><span class="op" id="4468767">,</span>&nbsp;<span class="num" id="4468769">0</span><span class="op" id="4468770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468773">if</span>&nbsp;<span class="ident" id="4468776">err</span>&nbsp;<span class="op" id="4468780">!=</span>&nbsp;<span class="ident" id="4468783">nil</span>&nbsp;<span class="op" id="4468787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468791">return</span>&nbsp;<span class="ident" id="4468798">context</span><span class="op" id="4468805">{</span><span class="ident" id="4468806">state</span><span class="op" id="4468811">:</span>&nbsp;<span class="ident" id="4468813">stateError</span><span class="op" id="4468823">,</span>&nbsp;<span class="ident" id="4468825">err</span><span class="op" id="4468828">:</span>&nbsp;<span class="ident" id="4468830">err</span><span class="op" id="4468833">}</span><span class="op" id="4468834">,</span>&nbsp;<span class="builtinfunc" id="4468836">len</span><span class="op" id="4468839">(</span><span class="ident" id="4468840">s</span><span class="op" id="4468841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468844">}</span>&nbsp;<span class="keyword" id="4468846">else</span>&nbsp;<span class="keyword" id="4468851">if</span>&nbsp;<span class="ident" id="4468854">i</span>&nbsp;<span class="op" id="4468856">!=</span>&nbsp;<span class="builtinfunc" id="4468859">len</span><span class="op" id="4468862">(</span><span class="ident" id="4468863">s</span><span class="op" id="4468864">)</span>&nbsp;<span class="op" id="4468866">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468870">c</span><span class="op" id="4468871">.</span><span class="ident" id="4468872">state</span>&nbsp;<span class="op" id="4468878">=</span>&nbsp;<span class="ident" id="4468880">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468899">return</span>&nbsp;<span class="ident" id="4468906">c</span><span class="op" id="4468907">,</span>&nbsp;<span class="ident" id="4468909">i</span><br>
<span class="lineno"></span><span class="op" id="4468911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="4468914">//&nbsp;tAfterName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAfterName.</span><br>
<span class="lineno"></span><span class="keyword" id="4468983">func</span>&nbsp;<span class="ident" id="4468988">tAfterName</span><span class="op" id="4468998">(</span><span class="ident" id="4468999">c</span>&nbsp;<span class="ident" id="4469001">context</span><span class="op" id="4469008">,</span>&nbsp;<span class="ident" id="4469010">s</span>&nbsp;<span class="op" id="4469012">[</span><span class="op" id="4469013">]</span><span class="builtintype" id="4469014">byte</span><span class="op" id="4469018">)</span>&nbsp;<span class="op" id="4469020">(</span><span class="ident" id="4469021">context</span><span class="op" id="4469028">,</span>&nbsp;<span class="builtintype" id="4469030">int</span><span class="op" id="4469033">)</span>&nbsp;<span class="op" id="4469035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469038">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469075">i</span>&nbsp;<span class="op" id="4469077">:=</span>&nbsp;<span class="ident" id="4469080">eatWhiteSpace</span><span class="op" id="4469093">(</span><span class="ident" id="4469094">s</span><span class="op" id="4469095">,</span>&nbsp;<span class="num" id="4469097">0</span><span class="op" id="4469098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469101">if</span>&nbsp;<span class="ident" id="4469104">i</span>&nbsp;<span class="op" id="4469106">==</span>&nbsp;<span class="builtinfunc" id="4469109">len</span><span class="op" id="4469112">(</span><span class="ident" id="4469113">s</span><span class="op" id="4469114">)</span>&nbsp;<span class="op" id="4469116">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469120">return</span>&nbsp;<span class="ident" id="4469127">c</span><span class="op" id="4469128">,</span>&nbsp;<span class="builtinfunc" id="4469130">len</span><span class="op" id="4469133">(</span><span class="ident" id="4469134">s</span><span class="op" id="4469135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469138">}</span>&nbsp;<span class="keyword" id="4469140">else</span>&nbsp;<span class="keyword" id="4469145">if</span>&nbsp;<span class="ident" id="4469148">s</span><span class="op" id="4469149">[</span><span class="ident" id="4469150">i</span><span class="op" id="4469151">]</span>&nbsp;<span class="op" id="4469153">!=</span>&nbsp;<span class="string" id="4469156">&#39;=&#39;</span>&nbsp;<span class="op" id="4469160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469164">//&nbsp;Occurs&nbsp;due&nbsp;to&nbsp;tag&nbsp;ending&nbsp;&#39;&gt;&#39;,&nbsp;and&nbsp;valueless&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469224">c</span><span class="op" id="4469225">.</span><span class="ident" id="4469226">state</span>&nbsp;<span class="op" id="4469232">=</span>&nbsp;<span class="ident" id="4469234">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469245">return</span>&nbsp;<span class="ident" id="4469252">c</span><span class="op" id="4469253">,</span>&nbsp;<span class="ident" id="4469255">i</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469261">c</span><span class="op" id="4469262">.</span><span class="ident" id="4469263">state</span>&nbsp;<span class="op" id="4469269">=</span>&nbsp;<span class="ident" id="4469271">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469289">//&nbsp;Consume&nbsp;the&nbsp;&#34;=&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469310">return</span>&nbsp;<span class="ident" id="4469317">c</span><span class="op" id="4469318">,</span>&nbsp;<span class="ident" id="4469320">i</span>&nbsp;<span class="op" id="4469322">+</span>&nbsp;<span class="num" id="4469324">1</span><br>
<span class="lineno"></span><span class="op" id="4469326">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="4469329">var</span>&nbsp;<span class="ident" id="4469333">attrStartStates</span>&nbsp;<span class="op" id="4469349">=</span>&nbsp;<span class="op" id="4469351">[</span><span class="op" id="4469352">...</span><span class="op" id="4469355">]</span><span class="ident" id="4469356">state</span><span class="op" id="4469361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469364">attrNone</span><span class="op" id="4469372">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4469376">stateAttr</span><span class="op" id="4469385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469388">attrScript</span><span class="op" id="4469398">:</span>&nbsp;<span class="ident" id="4469400">stateJS</span><span class="op" id="4469407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469410">attrStyle</span><span class="op" id="4469419">:</span>&nbsp;&nbsp;<span class="ident" id="4469422">stateCSS</span><span class="op" id="4469430">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469433">attrURL</span><span class="op" id="4469440">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469445">stateURL</span><span class="op" id="4469453">,</span><br>
<span class="lineno"></span><span class="op" id="4469455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4469458">//&nbsp;tBeforeValue&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateBeforeValue.</span><br>
<span class="lineno"></span><span class="keyword" id="4469531">func</span>&nbsp;<span class="ident" id="4469536">tBeforeValue</span><span class="op" id="4469548">(</span><span class="ident" id="4469549">c</span>&nbsp;<span class="ident" id="4469551">context</span><span class="op" id="4469558">,</span>&nbsp;<span class="ident" id="4469560">s</span>&nbsp;<span class="op" id="4469562">[</span><span class="op" id="4469563">]</span><span class="builtintype" id="4469564">byte</span><span class="op" id="4469568">)</span>&nbsp;<span class="op" id="4469570">(</span><span class="ident" id="4469571">context</span><span class="op" id="4469578">,</span>&nbsp;<span class="builtintype" id="4469580">int</span><span class="op" id="4469583">)</span>&nbsp;<span class="op" id="4469585">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469588">i</span>&nbsp;<span class="op" id="4469590">:=</span>&nbsp;<span class="ident" id="4469593">eatWhiteSpace</span><span class="op" id="4469606">(</span><span class="ident" id="4469607">s</span><span class="op" id="4469608">,</span>&nbsp;<span class="num" id="4469610">0</span><span class="op" id="4469611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469614">if</span>&nbsp;<span class="ident" id="4469617">i</span>&nbsp;<span class="op" id="4469619">==</span>&nbsp;<span class="builtinfunc" id="4469622">len</span><span class="op" id="4469625">(</span><span class="ident" id="4469626">s</span><span class="op" id="4469627">)</span>&nbsp;<span class="op" id="4469629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469633">return</span>&nbsp;<span class="ident" id="4469640">c</span><span class="op" id="4469641">,</span>&nbsp;<span class="builtinfunc" id="4469643">len</span><span class="op" id="4469646">(</span><span class="ident" id="4469647">s</span><span class="op" id="4469648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469654">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;delimiter.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469688">delim</span>&nbsp;<span class="op" id="4469694">:=</span>&nbsp;<span class="ident" id="4469697">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469717">switch</span>&nbsp;<span class="ident" id="4469724">s</span><span class="op" id="4469725">[</span><span class="ident" id="4469726">i</span><span class="op" id="4469727">]</span>&nbsp;<span class="op" id="4469729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469732">case</span>&nbsp;<span class="string" id="4469737">&#39;\&#39;&#39;</span><span class="op" id="4469741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469745">delim</span><span class="op" id="4469750">,</span>&nbsp;<span class="ident" id="4469752">i</span>&nbsp;<span class="op" id="4469754">=</span>&nbsp;<span class="ident" id="4469756">delimSingleQuote</span><span class="op" id="4469772">,</span>&nbsp;<span class="ident" id="4469774">i</span><span class="op" id="4469775">+</span><span class="num" id="4469776">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469779">case</span>&nbsp;<span class="string" id="4469784">&#39;&#34;&#39;</span><span class="op" id="4469787">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469791">delim</span><span class="op" id="4469796">,</span>&nbsp;<span class="ident" id="4469798">i</span>&nbsp;<span class="op" id="4469800">=</span>&nbsp;<span class="ident" id="4469802">delimDoubleQuote</span><span class="op" id="4469818">,</span>&nbsp;<span class="ident" id="4469820">i</span><span class="op" id="4469821">+</span><span class="num" id="4469822">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469828">c</span><span class="op" id="4469829">.</span><span class="ident" id="4469830">state</span><span class="op" id="4469835">,</span>&nbsp;<span class="ident" id="4469837">c</span><span class="op" id="4469838">.</span><span class="ident" id="4469839">delim</span><span class="op" id="4469844">,</span>&nbsp;<span class="ident" id="4469846">c</span><span class="op" id="4469847">.</span><span class="ident" id="4469848">attr</span>&nbsp;<span class="op" id="4469853">=</span>&nbsp;<span class="ident" id="4469855">attrStartStates</span><span class="op" id="4469870">[</span><span class="ident" id="4469871">c</span><span class="op" id="4469872">.</span><span class="ident" id="4469873">attr</span><span class="op" id="4469877">]</span><span class="op" id="4469878">,</span>&nbsp;<span class="ident" id="4469880">delim</span><span class="op" id="4469885">,</span>&nbsp;<span class="ident" id="4469887">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469897">return</span>&nbsp;<span class="ident" id="4469904">c</span><span class="op" id="4469905">,</span>&nbsp;<span class="ident" id="4469907">i</span><br>
<span class="lineno"></span><span class="op" id="4469909">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4469912">//&nbsp;tHTMLCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateHTMLCmt.</span><br>
<span class="lineno"></span><span class="keyword" id="4469977">func</span>&nbsp;<span class="ident" id="4469982">tHTMLCmt</span><span class="op" id="4469990">(</span><span class="ident" id="4469991">c</span>&nbsp;<span class="ident" id="4469993">context</span><span class="op" id="4470000">,</span>&nbsp;<span class="ident" id="4470002">s</span>&nbsp;<span class="op" id="4470004">[</span><span class="op" id="4470005">]</span><span class="builtintype" id="4470006">byte</span><span class="op" id="4470010">)</span>&nbsp;<span class="op" id="4470012">(</span><span class="ident" id="4470013">context</span><span class="op" id="4470020">,</span>&nbsp;<span class="builtintype" id="4470022">int</span><span class="op" id="4470025">)</span>&nbsp;<span class="op" id="4470027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470030">if</span>&nbsp;<span class="ident" id="4470033">i</span>&nbsp;<span class="op" id="4470035">:=</span>&nbsp;<span class="ident" id="4470038">bytes</span><span class="op" id="4470043">.</span><span class="ident" id="4470044">Index</span><span class="op" id="4470049">(</span><span class="ident" id="4470050">s</span><span class="op" id="4470051">,</span>&nbsp;<span class="ident" id="4470053">commentEnd</span><span class="op" id="4470063">)</span><span class="op" id="4470064">;</span>&nbsp;<span class="ident" id="4470066">i</span>&nbsp;<span class="op" id="4470068">!=</span>&nbsp;<span class="op" id="4470071">-</span><span class="num" id="4470072">1</span>&nbsp;<span class="op" id="4470074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470078">return</span>&nbsp;<span class="ident" id="4470085">context</span><span class="op" id="4470092">{</span><span class="op" id="4470093">}</span><span class="op" id="4470094">,</span>&nbsp;<span class="ident" id="4470096">i</span>&nbsp;<span class="op" id="4470098">+</span>&nbsp;<span class="num" id="4470100">3</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4470103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470106">return</span>&nbsp;<span class="ident" id="4470113">c</span><span class="op" id="4470114">,</span>&nbsp;<span class="builtinfunc" id="4470116">len</span><span class="op" id="4470119">(</span><span class="ident" id="4470120">s</span><span class="op" id="4470121">)</span><br>
<span class="lineno"></span><span class="op" id="4470123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4470126">//&nbsp;specialTagEndMarkers&nbsp;maps&nbsp;element&nbsp;types&nbsp;to&nbsp;the&nbsp;character&nbsp;sequence&nbsp;that</span><br>
<span class="lineno">185</span><span class="comment" id="4470200">//&nbsp;case-insensitively&nbsp;signals&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;special&nbsp;tag&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="4470263">var</span>&nbsp;<span class="ident" id="4470267">specialTagEndMarkers</span>&nbsp;<span class="op" id="4470288">=</span>&nbsp;<span class="op" id="4470290">[</span><span class="op" id="4470291">...</span><span class="op" id="4470294">]</span><span class="builtintype" id="4470295">string</span><span class="op" id="4470301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470304">elementScript</span><span class="op" id="4470317">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4470321">&#34;&lt;/script&#34;</span><span class="op" id="4470331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470334">elementStyle</span><span class="op" id="4470346">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4470351">&#34;&lt;/style&#34;</span><span class="op" id="4470360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470363">elementTextarea</span><span class="op" id="4470378">:</span>&nbsp;<span class="string" id="4470380">&#34;&lt;/textarea&#34;</span><span class="op" id="4470392">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470395">elementTitle</span><span class="op" id="4470407">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4470412">&#34;&lt;/title&#34;</span><span class="op" id="4470421">,</span><br>
<span class="lineno"></span><span class="op" id="4470423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4470426">//&nbsp;tSpecialTagEnd&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;raw&nbsp;text&nbsp;and&nbsp;RCDATA</span><br>
<span class="lineno"></span><span class="comment" id="4470503">//&nbsp;element&nbsp;states.</span><br>
<span class="lineno">195</span><span class="keyword" id="4470522">func</span>&nbsp;<span class="ident" id="4470527">tSpecialTagEnd</span><span class="op" id="4470541">(</span><span class="ident" id="4470542">c</span>&nbsp;<span class="ident" id="4470544">context</span><span class="op" id="4470551">,</span>&nbsp;<span class="ident" id="4470553">s</span>&nbsp;<span class="op" id="4470555">[</span><span class="op" id="4470556">]</span><span class="builtintype" id="4470557">byte</span><span class="op" id="4470561">)</span>&nbsp;<span class="op" id="4470563">(</span><span class="ident" id="4470564">context</span><span class="op" id="4470571">,</span>&nbsp;<span class="builtintype" id="4470573">int</span><span class="op" id="4470576">)</span>&nbsp;<span class="op" id="4470578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470581">if</span>&nbsp;<span class="ident" id="4470584">c</span><span class="op" id="4470585">.</span><span class="ident" id="4470586">element</span>&nbsp;<span class="op" id="4470594">!=</span>&nbsp;<span class="ident" id="4470597">elementNone</span>&nbsp;<span class="op" id="4470609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470613">if</span>&nbsp;<span class="ident" id="4470616">i</span>&nbsp;<span class="op" id="4470618">:=</span>&nbsp;<span class="ident" id="4470621">strings</span><span class="op" id="4470628">.</span><span class="ident" id="4470629">Index</span><span class="op" id="4470634">(</span><span class="ident" id="4470635">strings</span><span class="op" id="4470642">.</span><span class="ident" id="4470643">ToLower</span><span class="op" id="4470650">(</span><span class="builtintype" id="4470651">string</span><span class="op" id="4470657">(</span><span class="ident" id="4470658">s</span><span class="op" id="4470659">)</span><span class="op" id="4470660">)</span><span class="op" id="4470661">,</span>&nbsp;<span class="ident" id="4470663">specialTagEndMarkers</span><span class="op" id="4470683">[</span><span class="ident" id="4470684">c</span><span class="op" id="4470685">.</span><span class="ident" id="4470686">element</span><span class="op" id="4470693">]</span><span class="op" id="4470694">)</span><span class="op" id="4470695">;</span>&nbsp;<span class="ident" id="4470697">i</span>&nbsp;<span class="op" id="4470699">!=</span>&nbsp;<span class="op" id="4470702">-</span><span class="num" id="4470703">1</span>&nbsp;<span class="op" id="4470705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470710">return</span>&nbsp;<span class="ident" id="4470717">context</span><span class="op" id="4470724">{</span><span class="op" id="4470725">}</span><span class="op" id="4470726">,</span>&nbsp;<span class="ident" id="4470728">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4470732">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4470735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470738">return</span>&nbsp;<span class="ident" id="4470745">c</span><span class="op" id="4470746">,</span>&nbsp;<span class="builtinfunc" id="4470748">len</span><span class="op" id="4470751">(</span><span class="ident" id="4470752">s</span><span class="op" id="4470753">)</span><br>
<span class="lineno"></span><span class="op" id="4470755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4470758">//&nbsp;tAttr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;attribute&nbsp;state.</span><br>
<span class="lineno">205</span><span class="keyword" id="4470827">func</span>&nbsp;<span class="ident" id="4470832">tAttr</span><span class="op" id="4470837">(</span><span class="ident" id="4470838">c</span>&nbsp;<span class="ident" id="4470840">context</span><span class="op" id="4470847">,</span>&nbsp;<span class="ident" id="4470849">s</span>&nbsp;<span class="op" id="4470851">[</span><span class="op" id="4470852">]</span><span class="builtintype" id="4470853">byte</span><span class="op" id="4470857">)</span>&nbsp;<span class="op" id="4470859">(</span><span class="ident" id="4470860">context</span><span class="op" id="4470867">,</span>&nbsp;<span class="builtintype" id="4470869">int</span><span class="op" id="4470872">)</span>&nbsp;<span class="op" id="4470874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470877">return</span>&nbsp;<span class="ident" id="4470884">c</span><span class="op" id="4470885">,</span>&nbsp;<span class="builtinfunc" id="4470887">len</span><span class="op" id="4470890">(</span><span class="ident" id="4470891">s</span><span class="op" id="4470892">)</span><br>
<span class="lineno"></span><span class="op" id="4470894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4470897">//&nbsp;tURL&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;URL&nbsp;state.</span><br>
<span class="lineno">210</span><span class="keyword" id="4470959">func</span>&nbsp;<span class="ident" id="4470964">tURL</span><span class="op" id="4470968">(</span><span class="ident" id="4470969">c</span>&nbsp;<span class="ident" id="4470971">context</span><span class="op" id="4470978">,</span>&nbsp;<span class="ident" id="4470980">s</span>&nbsp;<span class="op" id="4470982">[</span><span class="op" id="4470983">]</span><span class="builtintype" id="4470984">byte</span><span class="op" id="4470988">)</span>&nbsp;<span class="op" id="4470990">(</span><span class="ident" id="4470991">context</span><span class="op" id="4470998">,</span>&nbsp;<span class="builtintype" id="4471000">int</span><span class="op" id="4471003">)</span>&nbsp;<span class="op" id="4471005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471008">if</span>&nbsp;<span class="ident" id="4471011">bytes</span><span class="op" id="4471016">.</span><span class="ident" id="4471017">IndexAny</span><span class="op" id="4471025">(</span><span class="ident" id="4471026">s</span><span class="op" id="4471027">,</span>&nbsp;<span class="string" id="4471029">&#34;#?&#34;</span><span class="op" id="4471033">)</span>&nbsp;<span class="op" id="4471035">&gt;=</span>&nbsp;<span class="num" id="4471038">0</span>&nbsp;<span class="op" id="4471040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471044">c</span><span class="op" id="4471045">.</span><span class="ident" id="4471046">urlPart</span>&nbsp;<span class="op" id="4471054">=</span>&nbsp;<span class="ident" id="4471056">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4471076">}</span>&nbsp;<span class="keyword" id="4471078">else</span>&nbsp;<span class="keyword" id="4471083">if</span>&nbsp;<span class="builtinfunc" id="4471086">len</span><span class="op" id="4471089">(</span><span class="ident" id="4471090">s</span><span class="op" id="4471091">)</span>&nbsp;<span class="op" id="4471093">!=</span>&nbsp;<span class="ident" id="4471096">eatWhiteSpace</span><span class="op" id="4471109">(</span><span class="ident" id="4471110">s</span><span class="op" id="4471111">,</span>&nbsp;<span class="num" id="4471113">0</span><span class="op" id="4471114">)</span>&nbsp;<span class="op" id="4471116">&amp;&amp;</span>&nbsp;<span class="ident" id="4471119">c</span><span class="op" id="4471120">.</span><span class="ident" id="4471121">urlPart</span>&nbsp;<span class="op" id="4471129">==</span>&nbsp;<span class="ident" id="4471132">urlPartNone</span>&nbsp;<span class="op" id="4471144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471148">//&nbsp;HTML5&nbsp;uses&nbsp;&#34;Valid&nbsp;URL&nbsp;potentially&nbsp;surrounded&nbsp;by&nbsp;spaces&#34;&nbsp;for</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471213">//&nbsp;attrs:&nbsp;http://www.w3.org/TR/html5/index.html#attributes-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471276">c</span><span class="op" id="4471277">.</span><span class="ident" id="4471278">urlPart</span>&nbsp;<span class="op" id="4471286">=</span>&nbsp;<span class="ident" id="4471288">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4471305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471308">return</span>&nbsp;<span class="ident" id="4471315">c</span><span class="op" id="4471316">,</span>&nbsp;<span class="builtinfunc" id="4471318">len</span><span class="op" id="4471321">(</span><span class="ident" id="4471322">s</span><span class="op" id="4471323">)</span><br>
<span class="lineno"></span><span class="op" id="4471325">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="4471328">//&nbsp;tJS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4471388">func</span>&nbsp;<span class="ident" id="4471393">tJS</span><span class="op" id="4471396">(</span><span class="ident" id="4471397">c</span>&nbsp;<span class="ident" id="4471399">context</span><span class="op" id="4471406">,</span>&nbsp;<span class="ident" id="4471408">s</span>&nbsp;<span class="op" id="4471410">[</span><span class="op" id="4471411">]</span><span class="builtintype" id="4471412">byte</span><span class="op" id="4471416">)</span>&nbsp;<span class="op" id="4471418">(</span><span class="ident" id="4471419">context</span><span class="op" id="4471426">,</span>&nbsp;<span class="builtintype" id="4471428">int</span><span class="op" id="4471431">)</span>&nbsp;<span class="op" id="4471433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471436">i</span>&nbsp;<span class="op" id="4471438">:=</span>&nbsp;<span class="ident" id="4471441">bytes</span><span class="op" id="4471446">.</span><span class="ident" id="4471447">IndexAny</span><span class="op" id="4471455">(</span><span class="ident" id="4471456">s</span><span class="op" id="4471457">,</span>&nbsp;<span class="string" id="4471459">`&#34;&#39;/`</span><span class="op" id="4471464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471467">if</span>&nbsp;<span class="ident" id="4471470">i</span>&nbsp;<span class="op" id="4471472">==</span>&nbsp;<span class="op" id="4471475">-</span><span class="num" id="4471476">1</span>&nbsp;<span class="op" id="4471478">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471482">//&nbsp;Entire&nbsp;input&nbsp;is&nbsp;non&nbsp;string,&nbsp;comment,&nbsp;regexp&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471539">c</span><span class="op" id="4471540">.</span><span class="ident" id="4471541">jsCtx</span>&nbsp;<span class="op" id="4471547">=</span>&nbsp;<span class="ident" id="4471549">nextJSCtx</span><span class="op" id="4471558">(</span><span class="ident" id="4471559">s</span><span class="op" id="4471560">,</span>&nbsp;<span class="ident" id="4471562">c</span><span class="op" id="4471563">.</span><span class="ident" id="4471564">jsCtx</span><span class="op" id="4471569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471573">return</span>&nbsp;<span class="ident" id="4471580">c</span><span class="op" id="4471581">,</span>&nbsp;<span class="builtinfunc" id="4471583">len</span><span class="op" id="4471586">(</span><span class="ident" id="4471587">s</span><span class="op" id="4471588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4471591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471594">c</span><span class="op" id="4471595">.</span><span class="ident" id="4471596">jsCtx</span>&nbsp;<span class="op" id="4471602">=</span>&nbsp;<span class="ident" id="4471604">nextJSCtx</span><span class="op" id="4471613">(</span><span class="ident" id="4471614">s</span><span class="op" id="4471615">[</span><span class="op" id="4471616">:</span><span class="ident" id="4471617">i</span><span class="op" id="4471618">]</span><span class="op" id="4471619">,</span>&nbsp;<span class="ident" id="4471621">c</span><span class="op" id="4471622">.</span><span class="ident" id="4471623">jsCtx</span><span class="op" id="4471628">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471631">switch</span>&nbsp;<span class="ident" id="4471638">s</span><span class="op" id="4471639">[</span><span class="ident" id="4471640">i</span><span class="op" id="4471641">]</span>&nbsp;<span class="op" id="4471643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471646">case</span>&nbsp;<span class="string" id="4471651">&#39;&#34;&#39;</span><span class="op" id="4471654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471658">c</span><span class="op" id="4471659">.</span><span class="ident" id="4471660">state</span><span class="op" id="4471665">,</span>&nbsp;<span class="ident" id="4471667">c</span><span class="op" id="4471668">.</span><span class="ident" id="4471669">jsCtx</span>&nbsp;<span class="op" id="4471675">=</span>&nbsp;<span class="ident" id="4471677">stateJSDqStr</span><span class="op" id="4471689">,</span>&nbsp;<span class="ident" id="4471691">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471704">case</span>&nbsp;<span class="string" id="4471709">&#39;\&#39;&#39;</span><span class="op" id="4471713">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471717">c</span><span class="op" id="4471718">.</span><span class="ident" id="4471719">state</span><span class="op" id="4471724">,</span>&nbsp;<span class="ident" id="4471726">c</span><span class="op" id="4471727">.</span><span class="ident" id="4471728">jsCtx</span>&nbsp;<span class="op" id="4471734">=</span>&nbsp;<span class="ident" id="4471736">stateJSSqStr</span><span class="op" id="4471748">,</span>&nbsp;<span class="ident" id="4471750">jsCtxRegexp</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471763">case</span>&nbsp;<span class="string" id="4471768">&#39;/&#39;</span><span class="op" id="4471771">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471775">switch</span>&nbsp;<span class="op" id="4471782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471786">case</span>&nbsp;<span class="ident" id="4471791">i</span><span class="op" id="4471792">+</span><span class="num" id="4471793">1</span>&nbsp;<span class="op" id="4471795">&lt;</span>&nbsp;<span class="builtinfunc" id="4471797">len</span><span class="op" id="4471800">(</span><span class="ident" id="4471801">s</span><span class="op" id="4471802">)</span>&nbsp;<span class="op" id="4471804">&amp;&amp;</span>&nbsp;<span class="ident" id="4471807">s</span><span class="op" id="4471808">[</span><span class="ident" id="4471809">i</span><span class="op" id="4471810">+</span><span class="num" id="4471811">1</span><span class="op" id="4471812">]</span>&nbsp;<span class="op" id="4471814">==</span>&nbsp;<span class="string" id="4471817">&#39;/&#39;</span><span class="op" id="4471820">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471825">c</span><span class="op" id="4471826">.</span><span class="ident" id="4471827">state</span><span class="op" id="4471832">,</span>&nbsp;<span class="ident" id="4471834">i</span>&nbsp;<span class="op" id="4471836">=</span>&nbsp;<span class="ident" id="4471838">stateJSLineCmt</span><span class="op" id="4471852">,</span>&nbsp;<span class="ident" id="4471854">i</span><span class="op" id="4471855">+</span><span class="num" id="4471856">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471860">case</span>&nbsp;<span class="ident" id="4471865">i</span><span class="op" id="4471866">+</span><span class="num" id="4471867">1</span>&nbsp;<span class="op" id="4471869">&lt;</span>&nbsp;<span class="builtinfunc" id="4471871">len</span><span class="op" id="4471874">(</span><span class="ident" id="4471875">s</span><span class="op" id="4471876">)</span>&nbsp;<span class="op" id="4471878">&amp;&amp;</span>&nbsp;<span class="ident" id="4471881">s</span><span class="op" id="4471882">[</span><span class="ident" id="4471883">i</span><span class="op" id="4471884">+</span><span class="num" id="4471885">1</span><span class="op" id="4471886">]</span>&nbsp;<span class="op" id="4471888">==</span>&nbsp;<span class="string" id="4471891">&#39;*&#39;</span><span class="op" id="4471894">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471899">c</span><span class="op" id="4471900">.</span><span class="ident" id="4471901">state</span><span class="op" id="4471906">,</span>&nbsp;<span class="ident" id="4471908">i</span>&nbsp;<span class="op" id="4471910">=</span>&nbsp;<span class="ident" id="4471912">stateJSBlockCmt</span><span class="op" id="4471927">,</span>&nbsp;<span class="ident" id="4471929">i</span><span class="op" id="4471930">+</span><span class="num" id="4471931">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471935">case</span>&nbsp;<span class="ident" id="4471940">c</span><span class="op" id="4471941">.</span><span class="ident" id="4471942">jsCtx</span>&nbsp;<span class="op" id="4471948">==</span>&nbsp;<span class="ident" id="4471951">jsCtxRegexp</span><span class="op" id="4471962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471967">c</span><span class="op" id="4471968">.</span><span class="ident" id="4471969">state</span>&nbsp;<span class="op" id="4471975">=</span>&nbsp;<span class="ident" id="4471977">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471993">case</span>&nbsp;<span class="ident" id="4471998">c</span><span class="op" id="4471999">.</span><span class="ident" id="4472000">jsCtx</span>&nbsp;<span class="op" id="4472006">==</span>&nbsp;<span class="ident" id="4472009">jsCtxDivOp</span><span class="op" id="4472019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472024">c</span><span class="op" id="4472025">.</span><span class="ident" id="4472026">jsCtx</span>&nbsp;<span class="op" id="4472032">=</span>&nbsp;<span class="ident" id="4472034">jsCtxRegexp</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472048">default</span><span class="op" id="4472055">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472060">return</span>&nbsp;<span class="ident" id="4472067">context</span><span class="op" id="4472074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472080">state</span><span class="op" id="4472085">:</span>&nbsp;<span class="ident" id="4472087">stateError</span><span class="op" id="4472097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472103">err</span><span class="op" id="4472106">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4472110">errorf</span><span class="op" id="4472116">(</span><span class="ident" id="4472117">ErrSlashAmbig</span><span class="op" id="4472130">,</span>&nbsp;<span class="ident" id="4472132">nil</span><span class="op" id="4472135">,</span>&nbsp;<span class="num" id="4472137">0</span><span class="op" id="4472138">,</span>&nbsp;<span class="string" id="4472140">&#34;&#39;/&#39;&nbsp;could&nbsp;start&nbsp;a&nbsp;division&nbsp;or&nbsp;regexp:&nbsp;%.32q&#34;</span><span class="op" id="4472185">,</span>&nbsp;<span class="ident" id="4472187">s</span><span class="op" id="4472188">[</span><span class="ident" id="4472189">i</span><span class="op" id="4472190">:</span><span class="op" id="4472191">]</span><span class="op" id="4472192">)</span><span class="op" id="4472193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472198">}</span><span class="op" id="4472199">,</span>&nbsp;<span class="builtinfunc" id="4472201">len</span><span class="op" id="4472204">(</span><span class="ident" id="4472205">s</span><span class="op" id="4472206">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472213">default</span><span class="op" id="4472220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4472224">panic</span><span class="op" id="4472229">(</span><span class="string" id="4472230">&#34;unreachable&#34;</span><span class="op" id="4472243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472249">return</span>&nbsp;<span class="ident" id="4472256">c</span><span class="op" id="4472257">,</span>&nbsp;<span class="ident" id="4472259">i</span>&nbsp;<span class="op" id="4472261">+</span>&nbsp;<span class="num" id="4472263">1</span><br>
<span class="lineno">255</span><span class="op" id="4472265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4472268">//&nbsp;tJSDelimited&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;string&nbsp;and&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="4472348">//&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="4472359">func</span>&nbsp;<span class="ident" id="4472364">tJSDelimited</span><span class="op" id="4472376">(</span><span class="ident" id="4472377">c</span>&nbsp;<span class="ident" id="4472379">context</span><span class="op" id="4472386">,</span>&nbsp;<span class="ident" id="4472388">s</span>&nbsp;<span class="op" id="4472390">[</span><span class="op" id="4472391">]</span><span class="builtintype" id="4472392">byte</span><span class="op" id="4472396">)</span>&nbsp;<span class="op" id="4472398">(</span><span class="ident" id="4472399">context</span><span class="op" id="4472406">,</span>&nbsp;<span class="builtintype" id="4472408">int</span><span class="op" id="4472411">)</span>&nbsp;<span class="op" id="4472413">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472416">specials</span>&nbsp;<span class="op" id="4472425">:=</span>&nbsp;<span class="string" id="4472428">`\&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472434">switch</span>&nbsp;<span class="ident" id="4472441">c</span><span class="op" id="4472442">.</span><span class="ident" id="4472443">state</span>&nbsp;<span class="op" id="4472449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472452">case</span>&nbsp;<span class="ident" id="4472457">stateJSSqStr</span><span class="op" id="4472469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472473">specials</span>&nbsp;<span class="op" id="4472482">=</span>&nbsp;<span class="string" id="4472484">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472490">case</span>&nbsp;<span class="ident" id="4472495">stateJSRegexp</span><span class="op" id="4472508">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472512">specials</span>&nbsp;<span class="op" id="4472521">=</span>&nbsp;<span class="string" id="4472523">`\/[]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472535">k</span><span class="op" id="4472536">,</span>&nbsp;<span class="ident" id="4472538">inCharset</span>&nbsp;<span class="op" id="4472548">:=</span>&nbsp;<span class="num" id="4472551">0</span><span class="op" id="4472552">,</span>&nbsp;<span class="ident" id="4472554">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472561">for</span>&nbsp;<span class="op" id="4472565">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472569">i</span>&nbsp;<span class="op" id="4472571">:=</span>&nbsp;<span class="ident" id="4472574">k</span>&nbsp;<span class="op" id="4472576">+</span>&nbsp;<span class="ident" id="4472578">bytes</span><span class="op" id="4472583">.</span><span class="ident" id="4472584">IndexAny</span><span class="op" id="4472592">(</span><span class="ident" id="4472593">s</span><span class="op" id="4472594">[</span><span class="ident" id="4472595">k</span><span class="op" id="4472596">:</span><span class="op" id="4472597">]</span><span class="op" id="4472598">,</span>&nbsp;<span class="ident" id="4472600">specials</span><span class="op" id="4472608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472612">if</span>&nbsp;<span class="ident" id="4472615">i</span>&nbsp;<span class="op" id="4472617">&lt;</span>&nbsp;<span class="ident" id="4472619">k</span>&nbsp;<span class="op" id="4472621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472626">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472638">switch</span>&nbsp;<span class="ident" id="4472645">s</span><span class="op" id="4472646">[</span><span class="ident" id="4472647">i</span><span class="op" id="4472648">]</span>&nbsp;<span class="op" id="4472650">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472654">case</span>&nbsp;<span class="string" id="4472659">&#39;\\&#39;</span><span class="op" id="4472663">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472668">i</span><span class="op" id="4472669">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472675">if</span>&nbsp;<span class="ident" id="4472678">i</span>&nbsp;<span class="op" id="4472680">==</span>&nbsp;<span class="builtinfunc" id="4472683">len</span><span class="op" id="4472686">(</span><span class="ident" id="4472687">s</span><span class="op" id="4472688">)</span>&nbsp;<span class="op" id="4472690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472696">return</span>&nbsp;<span class="ident" id="4472703">context</span><span class="op" id="4472710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472717">state</span><span class="op" id="4472722">:</span>&nbsp;<span class="ident" id="4472724">stateError</span><span class="op" id="4472734">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472741">err</span><span class="op" id="4472744">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4472748">errorf</span><span class="op" id="4472754">(</span><span class="ident" id="4472755">ErrPartialEscape</span><span class="op" id="4472771">,</span>&nbsp;<span class="ident" id="4472773">nil</span><span class="op" id="4472776">,</span>&nbsp;<span class="num" id="4472778">0</span><span class="op" id="4472779">,</span>&nbsp;<span class="string" id="4472781">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;JS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="4472826">,</span>&nbsp;<span class="ident" id="4472828">s</span><span class="op" id="4472829">)</span><span class="op" id="4472830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472836">}</span><span class="op" id="4472837">,</span>&nbsp;<span class="builtinfunc" id="4472839">len</span><span class="op" id="4472842">(</span><span class="ident" id="4472843">s</span><span class="op" id="4472844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472853">case</span>&nbsp;<span class="string" id="4472858">&#39;[&#39;</span><span class="op" id="4472861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472866">inCharset</span>&nbsp;<span class="op" id="4472876">=</span>&nbsp;<span class="ident" id="4472878">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472885">case</span>&nbsp;<span class="string" id="4472890">&#39;]&#39;</span><span class="op" id="4472893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472898">inCharset</span>&nbsp;<span class="op" id="4472908">=</span>&nbsp;<span class="ident" id="4472910">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472918">default</span><span class="op" id="4472925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4472930">//&nbsp;end&nbsp;delimiter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472950">if</span>&nbsp;<span class="op" id="4472953">!</span><span class="ident" id="4472954">inCharset</span>&nbsp;<span class="op" id="4472964">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472970">c</span><span class="op" id="4472971">.</span><span class="ident" id="4472972">state</span><span class="op" id="4472977">,</span>&nbsp;<span class="ident" id="4472979">c</span><span class="op" id="4472980">.</span><span class="ident" id="4472981">jsCtx</span>&nbsp;<span class="op" id="4472987">=</span>&nbsp;<span class="ident" id="4472989">stateJS</span><span class="op" id="4472996">,</span>&nbsp;<span class="ident" id="4472998">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473013">return</span>&nbsp;<span class="ident" id="4473020">c</span><span class="op" id="4473021">,</span>&nbsp;<span class="ident" id="4473023">i</span>&nbsp;<span class="op" id="4473025">+</span>&nbsp;<span class="num" id="4473027">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4473032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4473036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473040">k</span>&nbsp;<span class="op" id="4473042">=</span>&nbsp;<span class="ident" id="4473044">i</span>&nbsp;<span class="op" id="4473046">+</span>&nbsp;<span class="num" id="4473048">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4473051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473055">if</span>&nbsp;<span class="ident" id="4473058">inCharset</span>&nbsp;<span class="op" id="4473068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473072">//&nbsp;This&nbsp;can&nbsp;be&nbsp;fixed&nbsp;by&nbsp;making&nbsp;context&nbsp;richer&nbsp;if&nbsp;interpolation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473137">//&nbsp;into&nbsp;charsets&nbsp;is&nbsp;desired.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473168">return</span>&nbsp;<span class="ident" id="4473175">context</span><span class="op" id="4473182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473187">state</span><span class="op" id="4473192">:</span>&nbsp;<span class="ident" id="4473194">stateError</span><span class="op" id="4473204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473209">err</span><span class="op" id="4473212">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4473216">errorf</span><span class="op" id="4473222">(</span><span class="ident" id="4473223">ErrPartialCharset</span><span class="op" id="4473240">,</span>&nbsp;<span class="ident" id="4473242">nil</span><span class="op" id="4473245">,</span>&nbsp;<span class="num" id="4473247">0</span><span class="op" id="4473248">,</span>&nbsp;<span class="string" id="4473250">&#34;unfinished&nbsp;JS&nbsp;regexp&nbsp;charset:&nbsp;%q&#34;</span><span class="op" id="4473284">,</span>&nbsp;<span class="ident" id="4473286">s</span><span class="op" id="4473287">)</span><span class="op" id="4473288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4473292">}</span><span class="op" id="4473293">,</span>&nbsp;<span class="builtinfunc" id="4473295">len</span><span class="op" id="4473298">(</span><span class="ident" id="4473299">s</span><span class="op" id="4473300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4473303">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473307">return</span>&nbsp;<span class="ident" id="4473314">c</span><span class="op" id="4473315">,</span>&nbsp;<span class="builtinfunc" id="4473317">len</span><span class="op" id="4473320">(</span><span class="ident" id="4473321">s</span><span class="op" id="4473322">)</span><br>
<span class="lineno"></span><span class="op" id="4473324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4473327">var</span>&nbsp;<span class="ident" id="4473331">blockCommentEnd</span>&nbsp;<span class="op" id="4473347">=</span>&nbsp;<span class="op" id="4473349">[</span><span class="op" id="4473350">]</span><span class="builtintype" id="4473351">byte</span><span class="op" id="4473355">(</span><span class="string" id="4473356">&#34;*/&#34;</span><span class="op" id="4473360">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="comment" id="4473363">//&nbsp;tBlockCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;/*comment*/&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="4473435">func</span>&nbsp;<span class="ident" id="4473440">tBlockCmt</span><span class="op" id="4473449">(</span><span class="ident" id="4473450">c</span>&nbsp;<span class="ident" id="4473452">context</span><span class="op" id="4473459">,</span>&nbsp;<span class="ident" id="4473461">s</span>&nbsp;<span class="op" id="4473463">[</span><span class="op" id="4473464">]</span><span class="builtintype" id="4473465">byte</span><span class="op" id="4473469">)</span>&nbsp;<span class="op" id="4473471">(</span><span class="ident" id="4473472">context</span><span class="op" id="4473479">,</span>&nbsp;<span class="builtintype" id="4473481">int</span><span class="op" id="4473484">)</span>&nbsp;<span class="op" id="4473486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473489">i</span>&nbsp;<span class="op" id="4473491">:=</span>&nbsp;<span class="ident" id="4473494">bytes</span><span class="op" id="4473499">.</span><span class="ident" id="4473500">Index</span><span class="op" id="4473505">(</span><span class="ident" id="4473506">s</span><span class="op" id="4473507">,</span>&nbsp;<span class="ident" id="4473509">blockCommentEnd</span><span class="op" id="4473524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473527">if</span>&nbsp;<span class="ident" id="4473530">i</span>&nbsp;<span class="op" id="4473532">==</span>&nbsp;<span class="op" id="4473535">-</span><span class="num" id="4473536">1</span>&nbsp;<span class="op" id="4473538">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473542">return</span>&nbsp;<span class="ident" id="4473549">c</span><span class="op" id="4473550">,</span>&nbsp;<span class="builtinfunc" id="4473552">len</span><span class="op" id="4473555">(</span><span class="ident" id="4473556">s</span><span class="op" id="4473557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4473560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473563">switch</span>&nbsp;<span class="ident" id="4473570">c</span><span class="op" id="4473571">.</span><span class="ident" id="4473572">state</span>&nbsp;<span class="op" id="4473578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473581">case</span>&nbsp;<span class="ident" id="4473586">stateJSBlockCmt</span><span class="op" id="4473601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473605">c</span><span class="op" id="4473606">.</span><span class="ident" id="4473607">state</span>&nbsp;<span class="op" id="4473613">=</span>&nbsp;<span class="ident" id="4473615">stateJS</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473624">case</span>&nbsp;<span class="ident" id="4473629">stateCSSBlockCmt</span><span class="op" id="4473645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473649">c</span><span class="op" id="4473650">.</span><span class="ident" id="4473651">state</span>&nbsp;<span class="op" id="4473657">=</span>&nbsp;<span class="ident" id="4473659">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473669">default</span><span class="op" id="4473676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4473680">panic</span><span class="op" id="4473685">(</span><span class="ident" id="4473686">c</span><span class="op" id="4473687">.</span><span class="ident" id="4473688">state</span><span class="op" id="4473693">.</span><span class="ident" id="4473694">String</span><span class="op" id="4473700">(</span><span class="op" id="4473701">)</span><span class="op" id="4473702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4473705">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473708">return</span>&nbsp;<span class="ident" id="4473715">c</span><span class="op" id="4473716">,</span>&nbsp;<span class="ident" id="4473718">i</span>&nbsp;<span class="op" id="4473720">+</span>&nbsp;<span class="num" id="4473722">2</span><br>
<span class="lineno"></span><span class="op" id="4473724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4473727">//&nbsp;tLineCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;//comment&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="4473796">func</span>&nbsp;<span class="ident" id="4473801">tLineCmt</span><span class="op" id="4473809">(</span><span class="ident" id="4473810">c</span>&nbsp;<span class="ident" id="4473812">context</span><span class="op" id="4473819">,</span>&nbsp;<span class="ident" id="4473821">s</span>&nbsp;<span class="op" id="4473823">[</span><span class="op" id="4473824">]</span><span class="builtintype" id="4473825">byte</span><span class="op" id="4473829">)</span>&nbsp;<span class="op" id="4473831">(</span><span class="ident" id="4473832">context</span><span class="op" id="4473839">,</span>&nbsp;<span class="builtintype" id="4473841">int</span><span class="op" id="4473844">)</span>&nbsp;<span class="op" id="4473846">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473849">var</span>&nbsp;<span class="ident" id="4473853">lineTerminators</span>&nbsp;<span class="builtintype" id="4473869">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473877">var</span>&nbsp;<span class="ident" id="4473881">endState</span>&nbsp;<span class="ident" id="4473890">state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473897">switch</span>&nbsp;<span class="ident" id="4473904">c</span><span class="op" id="4473905">.</span><span class="ident" id="4473906">state</span>&nbsp;<span class="op" id="4473912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473915">case</span>&nbsp;<span class="ident" id="4473920">stateJSLineCmt</span><span class="op" id="4473934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473938">lineTerminators</span><span class="op" id="4473953">,</span>&nbsp;<span class="ident" id="4473955">endState</span>&nbsp;<span class="op" id="4473964">=</span>&nbsp;<span class="string" id="4473966">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="4473984">,</span>&nbsp;<span class="ident" id="4473986">stateJS</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473995">case</span>&nbsp;<span class="ident" id="4474000">stateCSSLineCmt</span><span class="op" id="4474015">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474019">lineTerminators</span><span class="op" id="4474034">,</span>&nbsp;<span class="ident" id="4474036">endState</span>&nbsp;<span class="op" id="4474045">=</span>&nbsp;<span class="string" id="4474047">&#34;\n\f\r&#34;</span><span class="op" id="4474055">,</span>&nbsp;<span class="ident" id="4474057">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474068">//&nbsp;Line&nbsp;comments&nbsp;are&nbsp;not&nbsp;part&nbsp;of&nbsp;any&nbsp;published&nbsp;CSS&nbsp;standard&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474134">//&nbsp;are&nbsp;supported&nbsp;by&nbsp;the&nbsp;4&nbsp;major&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474178">//&nbsp;This&nbsp;defines&nbsp;line&nbsp;comments&nbsp;as</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474213">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINECOMMENT&nbsp;::=&nbsp;&#34;//&#34;&nbsp;[^\n\f\d]*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474254">//&nbsp;since&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nl&nbsp;defines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474317">//&nbsp;newlines:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474332">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;::=&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#xC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474373">default</span><span class="op" id="4474380">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4474384">panic</span><span class="op" id="4474389">(</span><span class="ident" id="4474390">c</span><span class="op" id="4474391">.</span><span class="ident" id="4474392">state</span><span class="op" id="4474397">.</span><span class="ident" id="4474398">String</span><span class="op" id="4474404">(</span><span class="op" id="4474405">)</span><span class="op" id="4474406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474413">i</span>&nbsp;<span class="op" id="4474415">:=</span>&nbsp;<span class="ident" id="4474418">bytes</span><span class="op" id="4474423">.</span><span class="ident" id="4474424">IndexAny</span><span class="op" id="4474432">(</span><span class="ident" id="4474433">s</span><span class="op" id="4474434">,</span>&nbsp;<span class="ident" id="4474436">lineTerminators</span><span class="op" id="4474451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474454">if</span>&nbsp;<span class="ident" id="4474457">i</span>&nbsp;<span class="op" id="4474459">==</span>&nbsp;<span class="op" id="4474462">-</span><span class="num" id="4474463">1</span>&nbsp;<span class="op" id="4474465">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474469">return</span>&nbsp;<span class="ident" id="4474476">c</span><span class="op" id="4474477">,</span>&nbsp;<span class="builtinfunc" id="4474479">len</span><span class="op" id="4474482">(</span><span class="ident" id="4474483">s</span><span class="op" id="4474484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474490">c</span><span class="op" id="4474491">.</span><span class="ident" id="4474492">state</span>&nbsp;<span class="op" id="4474498">=</span>&nbsp;<span class="ident" id="4474500">endState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474510">//&nbsp;Per&nbsp;section&nbsp;7.4&nbsp;of&nbsp;EcmaScript&nbsp;5&nbsp;:&nbsp;http://es5.github.com/#x7.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474576">//&nbsp;&#34;However,&nbsp;the&nbsp;LineTerminator&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;not</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474639">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;single-line&nbsp;comment;&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474699">//&nbsp;recognized&nbsp;separately&nbsp;by&nbsp;the&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;becomes&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474765">//&nbsp;of&nbsp;the&nbsp;stream&nbsp;of&nbsp;input&nbsp;elements&nbsp;for&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474829">return</span>&nbsp;<span class="ident" id="4474836">c</span><span class="op" id="4474837">,</span>&nbsp;<span class="ident" id="4474839">i</span><br>
<span class="lineno"></span><span class="op" id="4474841">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="4474844">//&nbsp;tCSS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4474906">func</span>&nbsp;<span class="ident" id="4474911">tCSS</span><span class="op" id="4474915">(</span><span class="ident" id="4474916">c</span>&nbsp;<span class="ident" id="4474918">context</span><span class="op" id="4474925">,</span>&nbsp;<span class="ident" id="4474927">s</span>&nbsp;<span class="op" id="4474929">[</span><span class="op" id="4474930">]</span><span class="builtintype" id="4474931">byte</span><span class="op" id="4474935">)</span>&nbsp;<span class="op" id="4474937">(</span><span class="ident" id="4474938">context</span><span class="op" id="4474945">,</span>&nbsp;<span class="builtintype" id="4474947">int</span><span class="op" id="4474950">)</span>&nbsp;<span class="op" id="4474952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474955">//&nbsp;CSS&nbsp;quoted&nbsp;strings&nbsp;are&nbsp;almost&nbsp;never&nbsp;used&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475012">//&nbsp;(1)&nbsp;URLs&nbsp;as&nbsp;in&nbsp;background:&nbsp;&#34;/foo.png&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475054">//&nbsp;(2)&nbsp;Multiword&nbsp;font-names&nbsp;as&nbsp;in&nbsp;font-family:&nbsp;&#34;Times&nbsp;New&nbsp;Roman&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475120">//&nbsp;(3)&nbsp;List&nbsp;separators&nbsp;in&nbsp;content&nbsp;values&nbsp;as&nbsp;in&nbsp;inline-lists:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475182">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475197">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;{&nbsp;list-style:&nbsp;none;&nbsp;padding:0&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475250">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li&nbsp;{&nbsp;display:&nbsp;inline&nbsp;}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475296">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:before&nbsp;{&nbsp;content:&nbsp;&#34;,&nbsp;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475347">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:first-child:before&nbsp;{&nbsp;content:&nbsp;&#34;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475408">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475424">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;class=inlineList&gt;&lt;li&gt;One&lt;li&gt;Two&lt;li&gt;Three&lt;/ul&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475481">//&nbsp;(4)&nbsp;Attribute&nbsp;value&nbsp;selectors&nbsp;as&nbsp;in&nbsp;a[href=&#34;http://example.com/&#34;]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475551">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475555">//&nbsp;We&nbsp;conservatively&nbsp;treat&nbsp;all&nbsp;strings&nbsp;as&nbsp;URLs,&nbsp;but&nbsp;make&nbsp;some</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475618">//&nbsp;allowances&nbsp;to&nbsp;avoid&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475653">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475657">//&nbsp;In&nbsp;(1),&nbsp;our&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;justified.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475711">//&nbsp;In&nbsp;(2),&nbsp;valid&nbsp;font&nbsp;names&nbsp;do&nbsp;not&nbsp;contain&nbsp;&#39;:&#39;,&nbsp;&#39;?&#39;,&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475780">//&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;fine&nbsp;since&nbsp;we&nbsp;will&nbsp;never&nbsp;transition&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475852">//&nbsp;urlPartPreQuery.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475873">//&nbsp;In&nbsp;(3),&nbsp;our&nbsp;protocol&nbsp;heuristic&nbsp;should&nbsp;not&nbsp;be&nbsp;tripped,&nbsp;and&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475941">//&nbsp;should&nbsp;not&nbsp;be&nbsp;non-space&nbsp;content&nbsp;after&nbsp;a&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476011">//&nbsp;we&nbsp;only&nbsp;%-encode&nbsp;RFC&nbsp;3986&nbsp;reserved&nbsp;characters&nbsp;we&nbsp;are&nbsp;ok.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476072">//&nbsp;In&nbsp;(4),&nbsp;we&nbsp;should&nbsp;URL&nbsp;escape&nbsp;for&nbsp;URL&nbsp;attributes,&nbsp;and&nbsp;for&nbsp;others&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476143">//&nbsp;have&nbsp;the&nbsp;attribute&nbsp;name&nbsp;available&nbsp;if&nbsp;our&nbsp;conservative&nbsp;assumption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476212">//&nbsp;proves&nbsp;problematic&nbsp;for&nbsp;real&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476251">k</span>&nbsp;<span class="op" id="4476253">:=</span>&nbsp;<span class="num" id="4476256">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476259">for</span>&nbsp;<span class="op" id="4476263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476267">i</span>&nbsp;<span class="op" id="4476269">:=</span>&nbsp;<span class="ident" id="4476272">k</span>&nbsp;<span class="op" id="4476274">+</span>&nbsp;<span class="ident" id="4476276">bytes</span><span class="op" id="4476281">.</span><span class="ident" id="4476282">IndexAny</span><span class="op" id="4476290">(</span><span class="ident" id="4476291">s</span><span class="op" id="4476292">[</span><span class="ident" id="4476293">k</span><span class="op" id="4476294">:</span><span class="op" id="4476295">]</span><span class="op" id="4476296">,</span>&nbsp;<span class="string" id="4476298">`(&#34;&#39;/`</span><span class="op" id="4476304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476308">if</span>&nbsp;<span class="ident" id="4476311">i</span>&nbsp;<span class="op" id="4476313">&lt;</span>&nbsp;<span class="ident" id="4476315">k</span>&nbsp;<span class="op" id="4476317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476322">return</span>&nbsp;<span class="ident" id="4476329">c</span><span class="op" id="4476330">,</span>&nbsp;<span class="builtinfunc" id="4476332">len</span><span class="op" id="4476335">(</span><span class="ident" id="4476336">s</span><span class="op" id="4476337">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476345">switch</span>&nbsp;<span class="ident" id="4476352">s</span><span class="op" id="4476353">[</span><span class="ident" id="4476354">i</span><span class="op" id="4476355">]</span>&nbsp;<span class="op" id="4476357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476361">case</span>&nbsp;<span class="string" id="4476366">&#39;(&#39;</span><span class="op" id="4476369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476374">//&nbsp;Look&nbsp;for&nbsp;url&nbsp;to&nbsp;the&nbsp;left.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476406">p</span>&nbsp;<span class="op" id="4476408">:=</span>&nbsp;<span class="ident" id="4476411">bytes</span><span class="op" id="4476416">.</span><span class="ident" id="4476417">TrimRight</span><span class="op" id="4476426">(</span><span class="ident" id="4476427">s</span><span class="op" id="4476428">[</span><span class="op" id="4476429">:</span><span class="ident" id="4476430">i</span><span class="op" id="4476431">]</span><span class="op" id="4476432">,</span>&nbsp;<span class="string" id="4476434">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="4476445">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476450">if</span>&nbsp;<span class="ident" id="4476453">endsWithCSSKeyword</span><span class="op" id="4476471">(</span><span class="ident" id="4476472">p</span><span class="op" id="4476473">,</span>&nbsp;<span class="string" id="4476475">&#34;url&#34;</span><span class="op" id="4476480">)</span>&nbsp;<span class="op" id="4476482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476488">j</span>&nbsp;<span class="op" id="4476490">:=</span>&nbsp;<span class="builtinfunc" id="4476493">len</span><span class="op" id="4476496">(</span><span class="ident" id="4476497">s</span><span class="op" id="4476498">)</span>&nbsp;<span class="op" id="4476500">-</span>&nbsp;<span class="builtinfunc" id="4476502">len</span><span class="op" id="4476505">(</span><span class="ident" id="4476506">bytes</span><span class="op" id="4476511">.</span><span class="ident" id="4476512">TrimLeft</span><span class="op" id="4476520">(</span><span class="ident" id="4476521">s</span><span class="op" id="4476522">[</span><span class="ident" id="4476523">i</span><span class="op" id="4476524">+</span><span class="num" id="4476525">1</span><span class="op" id="4476526">:</span><span class="op" id="4476527">]</span><span class="op" id="4476528">,</span>&nbsp;<span class="string" id="4476530">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="4476541">)</span><span class="op" id="4476542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476548">switch</span>&nbsp;<span class="op" id="4476555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476561">case</span>&nbsp;<span class="ident" id="4476566">j</span>&nbsp;<span class="op" id="4476568">!=</span>&nbsp;<span class="builtinfunc" id="4476571">len</span><span class="op" id="4476574">(</span><span class="ident" id="4476575">s</span><span class="op" id="4476576">)</span>&nbsp;<span class="op" id="4476578">&amp;&amp;</span>&nbsp;<span class="ident" id="4476581">s</span><span class="op" id="4476582">[</span><span class="ident" id="4476583">j</span><span class="op" id="4476584">]</span>&nbsp;<span class="op" id="4476586">==</span>&nbsp;<span class="string" id="4476589">&#39;&#34;&#39;</span><span class="op" id="4476592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476599">c</span><span class="op" id="4476600">.</span><span class="ident" id="4476601">state</span><span class="op" id="4476606">,</span>&nbsp;<span class="ident" id="4476608">j</span>&nbsp;<span class="op" id="4476610">=</span>&nbsp;<span class="ident" id="4476612">stateCSSDqURL</span><span class="op" id="4476625">,</span>&nbsp;<span class="ident" id="4476627">j</span><span class="op" id="4476628">+</span><span class="num" id="4476629">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476635">case</span>&nbsp;<span class="ident" id="4476640">j</span>&nbsp;<span class="op" id="4476642">!=</span>&nbsp;<span class="builtinfunc" id="4476645">len</span><span class="op" id="4476648">(</span><span class="ident" id="4476649">s</span><span class="op" id="4476650">)</span>&nbsp;<span class="op" id="4476652">&amp;&amp;</span>&nbsp;<span class="ident" id="4476655">s</span><span class="op" id="4476656">[</span><span class="ident" id="4476657">j</span><span class="op" id="4476658">]</span>&nbsp;<span class="op" id="4476660">==</span>&nbsp;<span class="string" id="4476663">&#39;\&#39;&#39;</span><span class="op" id="4476667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476674">c</span><span class="op" id="4476675">.</span><span class="ident" id="4476676">state</span><span class="op" id="4476681">,</span>&nbsp;<span class="ident" id="4476683">j</span>&nbsp;<span class="op" id="4476685">=</span>&nbsp;<span class="ident" id="4476687">stateCSSSqURL</span><span class="op" id="4476700">,</span>&nbsp;<span class="ident" id="4476702">j</span><span class="op" id="4476703">+</span><span class="num" id="4476704">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476710">default</span><span class="op" id="4476717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476724">c</span><span class="op" id="4476725">.</span><span class="ident" id="4476726">state</span>&nbsp;<span class="op" id="4476732">=</span>&nbsp;<span class="ident" id="4476734">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476750">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476756">return</span>&nbsp;<span class="ident" id="4476763">c</span><span class="op" id="4476764">,</span>&nbsp;<span class="ident" id="4476766">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476775">case</span>&nbsp;<span class="string" id="4476780">&#39;/&#39;</span><span class="op" id="4476783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476788">if</span>&nbsp;<span class="ident" id="4476791">i</span><span class="op" id="4476792">+</span><span class="num" id="4476793">1</span>&nbsp;<span class="op" id="4476795">&lt;</span>&nbsp;<span class="builtinfunc" id="4476797">len</span><span class="op" id="4476800">(</span><span class="ident" id="4476801">s</span><span class="op" id="4476802">)</span>&nbsp;<span class="op" id="4476804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476810">switch</span>&nbsp;<span class="ident" id="4476817">s</span><span class="op" id="4476818">[</span><span class="ident" id="4476819">i</span><span class="op" id="4476820">+</span><span class="num" id="4476821">1</span><span class="op" id="4476822">]</span>&nbsp;<span class="op" id="4476824">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476830">case</span>&nbsp;<span class="string" id="4476835">&#39;/&#39;</span><span class="op" id="4476838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476845">c</span><span class="op" id="4476846">.</span><span class="ident" id="4476847">state</span>&nbsp;<span class="op" id="4476853">=</span>&nbsp;<span class="ident" id="4476855">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476876">return</span>&nbsp;<span class="ident" id="4476883">c</span><span class="op" id="4476884">,</span>&nbsp;<span class="ident" id="4476886">i</span>&nbsp;<span class="op" id="4476888">+</span>&nbsp;<span class="num" id="4476890">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476896">case</span>&nbsp;<span class="string" id="4476901">&#39;*&#39;</span><span class="op" id="4476904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476911">c</span><span class="op" id="4476912">.</span><span class="ident" id="4476913">state</span>&nbsp;<span class="op" id="4476919">=</span>&nbsp;<span class="ident" id="4476921">stateCSSBlockCmt</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476943">return</span>&nbsp;<span class="ident" id="4476950">c</span><span class="op" id="4476951">,</span>&nbsp;<span class="ident" id="4476953">i</span>&nbsp;<span class="op" id="4476955">+</span>&nbsp;<span class="num" id="4476957">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476972">case</span>&nbsp;<span class="string" id="4476977">&#39;&#34;&#39;</span><span class="op" id="4476980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476985">c</span><span class="op" id="4476986">.</span><span class="ident" id="4476987">state</span>&nbsp;<span class="op" id="4476993">=</span>&nbsp;<span class="ident" id="4476995">stateCSSDqStr</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477012">return</span>&nbsp;<span class="ident" id="4477019">c</span><span class="op" id="4477020">,</span>&nbsp;<span class="ident" id="4477022">i</span>&nbsp;<span class="op" id="4477024">+</span>&nbsp;<span class="num" id="4477026">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477030">case</span>&nbsp;<span class="string" id="4477035">&#39;\&#39;&#39;</span><span class="op" id="4477039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477044">c</span><span class="op" id="4477045">.</span><span class="ident" id="4477046">state</span>&nbsp;<span class="op" id="4477052">=</span>&nbsp;<span class="ident" id="4477054">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477071">return</span>&nbsp;<span class="ident" id="4477078">c</span><span class="op" id="4477079">,</span>&nbsp;<span class="ident" id="4477081">i</span>&nbsp;<span class="op" id="4477083">+</span>&nbsp;<span class="num" id="4477085">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477089">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477093">k</span>&nbsp;<span class="op" id="4477095">=</span>&nbsp;<span class="ident" id="4477097">i</span>&nbsp;<span class="op" id="4477099">+</span>&nbsp;<span class="num" id="4477101">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477104">}</span><br>
<span class="lineno"></span><span class="op" id="4477106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4477109">//&nbsp;tCSSStr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;string&nbsp;and&nbsp;URL&nbsp;states.</span><br>
<span class="lineno">435</span><span class="keyword" id="4477190">func</span>&nbsp;<span class="ident" id="4477195">tCSSStr</span><span class="op" id="4477202">(</span><span class="ident" id="4477203">c</span>&nbsp;<span class="ident" id="4477205">context</span><span class="op" id="4477212">,</span>&nbsp;<span class="ident" id="4477214">s</span>&nbsp;<span class="op" id="4477216">[</span><span class="op" id="4477217">]</span><span class="builtintype" id="4477218">byte</span><span class="op" id="4477222">)</span>&nbsp;<span class="op" id="4477224">(</span><span class="ident" id="4477225">context</span><span class="op" id="4477232">,</span>&nbsp;<span class="builtintype" id="4477234">int</span><span class="op" id="4477237">)</span>&nbsp;<span class="op" id="4477239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477242">var</span>&nbsp;<span class="ident" id="4477246">endAndEsc</span>&nbsp;<span class="builtintype" id="4477256">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477264">switch</span>&nbsp;<span class="ident" id="4477271">c</span><span class="op" id="4477272">.</span><span class="ident" id="4477273">state</span>&nbsp;<span class="op" id="4477279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477282">case</span>&nbsp;<span class="ident" id="4477287">stateCSSDqStr</span><span class="op" id="4477300">,</span>&nbsp;<span class="ident" id="4477302">stateCSSDqURL</span><span class="op" id="4477315">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477319">endAndEsc</span>&nbsp;<span class="op" id="4477329">=</span>&nbsp;<span class="string" id="4477331">`\&#34;`</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477337">case</span>&nbsp;<span class="ident" id="4477342">stateCSSSqStr</span><span class="op" id="4477355">,</span>&nbsp;<span class="ident" id="4477357">stateCSSSqURL</span><span class="op" id="4477370">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477374">endAndEsc</span>&nbsp;<span class="op" id="4477384">=</span>&nbsp;<span class="string" id="4477386">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477392">case</span>&nbsp;<span class="ident" id="4477397">stateCSSURL</span><span class="op" id="4477408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4477412">//&nbsp;Unquoted&nbsp;URLs&nbsp;end&nbsp;with&nbsp;a&nbsp;newline&nbsp;or&nbsp;close&nbsp;parenthesis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4477472">//&nbsp;The&nbsp;below&nbsp;includes&nbsp;the&nbsp;wc&nbsp;(whitespace&nbsp;character)&nbsp;and&nbsp;nl.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477534">endAndEsc</span>&nbsp;<span class="op" id="4477544">=</span>&nbsp;<span class="string" id="4477546">&#34;\\\t\n\f\r&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477562">default</span><span class="op" id="4477569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4477573">panic</span><span class="op" id="4477578">(</span><span class="ident" id="4477579">c</span><span class="op" id="4477580">.</span><span class="ident" id="4477581">state</span><span class="op" id="4477586">.</span><span class="ident" id="4477587">String</span><span class="op" id="4477593">(</span><span class="op" id="4477594">)</span><span class="op" id="4477595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477602">k</span>&nbsp;<span class="op" id="4477604">:=</span>&nbsp;<span class="num" id="4477607">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477610">for</span>&nbsp;<span class="op" id="4477614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477618">i</span>&nbsp;<span class="op" id="4477620">:=</span>&nbsp;<span class="ident" id="4477623">k</span>&nbsp;<span class="op" id="4477625">+</span>&nbsp;<span class="ident" id="4477627">bytes</span><span class="op" id="4477632">.</span><span class="ident" id="4477633">IndexAny</span><span class="op" id="4477641">(</span><span class="ident" id="4477642">s</span><span class="op" id="4477643">[</span><span class="ident" id="4477644">k</span><span class="op" id="4477645">:</span><span class="op" id="4477646">]</span><span class="op" id="4477647">,</span>&nbsp;<span class="ident" id="4477649">endAndEsc</span><span class="op" id="4477658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477662">if</span>&nbsp;<span class="ident" id="4477665">i</span>&nbsp;<span class="op" id="4477667">&lt;</span>&nbsp;<span class="ident" id="4477669">k</span>&nbsp;<span class="op" id="4477671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477676">c</span><span class="op" id="4477677">,</span>&nbsp;<span class="ident" id="4477679">nread</span>&nbsp;<span class="op" id="4477685">:=</span>&nbsp;<span class="ident" id="4477688">tURL</span><span class="op" id="4477692">(</span><span class="ident" id="4477693">c</span><span class="op" id="4477694">,</span>&nbsp;<span class="ident" id="4477696">decodeCSS</span><span class="op" id="4477705">(</span><span class="ident" id="4477706">s</span><span class="op" id="4477707">[</span><span class="ident" id="4477708">k</span><span class="op" id="4477709">:</span><span class="op" id="4477710">]</span><span class="op" id="4477711">)</span><span class="op" id="4477712">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477717">return</span>&nbsp;<span class="ident" id="4477724">c</span><span class="op" id="4477725">,</span>&nbsp;<span class="ident" id="4477727">k</span>&nbsp;<span class="op" id="4477729">+</span>&nbsp;<span class="ident" id="4477731">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477743">if</span>&nbsp;<span class="ident" id="4477746">s</span><span class="op" id="4477747">[</span><span class="ident" id="4477748">i</span><span class="op" id="4477749">]</span>&nbsp;<span class="op" id="4477751">==</span>&nbsp;<span class="string" id="4477754">&#39;\\&#39;</span>&nbsp;<span class="op" id="4477759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477764">i</span><span class="op" id="4477765">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477771">if</span>&nbsp;<span class="ident" id="4477774">i</span>&nbsp;<span class="op" id="4477776">==</span>&nbsp;<span class="builtinfunc" id="4477779">len</span><span class="op" id="4477782">(</span><span class="ident" id="4477783">s</span><span class="op" id="4477784">)</span>&nbsp;<span class="op" id="4477786">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477792">return</span>&nbsp;<span class="ident" id="4477799">context</span><span class="op" id="4477806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477813">state</span><span class="op" id="4477818">:</span>&nbsp;<span class="ident" id="4477820">stateError</span><span class="op" id="4477830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477837">err</span><span class="op" id="4477840">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4477844">errorf</span><span class="op" id="4477850">(</span><span class="ident" id="4477851">ErrPartialEscape</span><span class="op" id="4477867">,</span>&nbsp;<span class="ident" id="4477869">nil</span><span class="op" id="4477872">,</span>&nbsp;<span class="num" id="4477874">0</span><span class="op" id="4477875">,</span>&nbsp;<span class="string" id="4477877">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;CSS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="4477923">,</span>&nbsp;<span class="ident" id="4477925">s</span><span class="op" id="4477926">)</span><span class="op" id="4477927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477933">}</span><span class="op" id="4477934">,</span>&nbsp;<span class="builtinfunc" id="4477936">len</span><span class="op" id="4477939">(</span><span class="ident" id="4477940">s</span><span class="op" id="4477941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477946">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477950">}</span>&nbsp;<span class="keyword" id="4477952">else</span>&nbsp;<span class="op" id="4477957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477962">c</span><span class="op" id="4477963">.</span><span class="ident" id="4477964">state</span>&nbsp;<span class="op" id="4477970">=</span>&nbsp;<span class="ident" id="4477972">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477984">return</span>&nbsp;<span class="ident" id="4477991">c</span><span class="op" id="4477992">,</span>&nbsp;<span class="ident" id="4477994">i</span>&nbsp;<span class="op" id="4477996">+</span>&nbsp;<span class="num" id="4477998">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4478002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478006">c</span><span class="op" id="4478007">,</span>&nbsp;<span class="ident" id="4478009">_</span>&nbsp;<span class="op" id="4478011">=</span>&nbsp;<span class="ident" id="4478013">tURL</span><span class="op" id="4478017">(</span><span class="ident" id="4478018">c</span><span class="op" id="4478019">,</span>&nbsp;<span class="ident" id="4478021">decodeCSS</span><span class="op" id="4478030">(</span><span class="ident" id="4478031">s</span><span class="op" id="4478032">[</span><span class="op" id="4478033">:</span><span class="ident" id="4478034">i</span><span class="op" id="4478035">+</span><span class="num" id="4478036">1</span><span class="op" id="4478037">]</span><span class="op" id="4478038">)</span><span class="op" id="4478039">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478043">k</span>&nbsp;<span class="op" id="4478045">=</span>&nbsp;<span class="ident" id="4478047">i</span>&nbsp;<span class="op" id="4478049">+</span>&nbsp;<span class="num" id="4478051">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4478054">}</span><br>
<span class="lineno"></span><span class="op" id="4478056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4478059">//&nbsp;tError&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;error&nbsp;state.</span><br>
<span class="lineno">475</span><span class="keyword" id="4478125">func</span>&nbsp;<span class="ident" id="4478130">tError</span><span class="op" id="4478136">(</span><span class="ident" id="4478137">c</span>&nbsp;<span class="ident" id="4478139">context</span><span class="op" id="4478146">,</span>&nbsp;<span class="ident" id="4478148">s</span>&nbsp;<span class="op" id="4478150">[</span><span class="op" id="4478151">]</span><span class="builtintype" id="4478152">byte</span><span class="op" id="4478156">)</span>&nbsp;<span class="op" id="4478158">(</span><span class="ident" id="4478159">context</span><span class="op" id="4478166">,</span>&nbsp;<span class="builtintype" id="4478168">int</span><span class="op" id="4478171">)</span>&nbsp;<span class="op" id="4478173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478176">return</span>&nbsp;<span class="ident" id="4478183">c</span><span class="op" id="4478184">,</span>&nbsp;<span class="builtinfunc" id="4478186">len</span><span class="op" id="4478189">(</span><span class="ident" id="4478190">s</span><span class="op" id="4478191">)</span><br>
<span class="lineno"></span><span class="op" id="4478193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4478196">//&nbsp;eatAttrName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">480</span><span class="comment" id="4478272">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;s[i:]&nbsp;does&nbsp;not&nbsp;look&nbsp;like&nbsp;it&nbsp;begins&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4478341">//&nbsp;attribute&nbsp;name,&nbsp;such&nbsp;as&nbsp;encountering&nbsp;a&nbsp;quote&nbsp;mark&nbsp;without&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="4478414">//&nbsp;equals&nbsp;sign.</span><br>
<span class="lineno"></span><span class="keyword" id="4478430">func</span>&nbsp;<span class="ident" id="4478435">eatAttrName</span><span class="op" id="4478446">(</span><span class="ident" id="4478447">s</span>&nbsp;<span class="op" id="4478449">[</span><span class="op" id="4478450">]</span><span class="builtintype" id="4478451">byte</span><span class="op" id="4478455">,</span>&nbsp;<span class="ident" id="4478457">i</span>&nbsp;<span class="builtintype" id="4478459">int</span><span class="op" id="4478462">)</span>&nbsp;<span class="op" id="4478464">(</span><span class="builtintype" id="4478465">int</span><span class="op" id="4478468">,</span>&nbsp;<span class="op" id="4478470">*</span><span class="ident" id="4478471">Error</span><span class="op" id="4478476">)</span>&nbsp;<span class="op" id="4478478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478481">for</span>&nbsp;<span class="ident" id="4478485">j</span>&nbsp;<span class="op" id="4478487">:=</span>&nbsp;<span class="ident" id="4478490">i</span><span class="op" id="4478491">;</span>&nbsp;<span class="ident" id="4478493">j</span>&nbsp;<span class="op" id="4478495">&lt;</span>&nbsp;<span class="builtinfunc" id="4478497">len</span><span class="op" id="4478500">(</span><span class="ident" id="4478501">s</span><span class="op" id="4478502">)</span><span class="op" id="4478503">;</span>&nbsp;<span class="ident" id="4478505">j</span><span class="op" id="4478506">++</span>&nbsp;<span class="op" id="4478509">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478513">switch</span>&nbsp;<span class="ident" id="4478520">s</span><span class="op" id="4478521">[</span><span class="ident" id="4478522">j</span><span class="op" id="4478523">]</span>&nbsp;<span class="op" id="4478525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478529">case</span>&nbsp;<span class="string" id="4478534">&#39;&nbsp;&#39;</span><span class="op" id="4478537">,</span>&nbsp;<span class="string" id="4478539">&#39;\t&#39;</span><span class="op" id="4478543">,</span>&nbsp;<span class="string" id="4478545">&#39;\n&#39;</span><span class="op" id="4478549">,</span>&nbsp;<span class="string" id="4478551">&#39;\f&#39;</span><span class="op" id="4478555">,</span>&nbsp;<span class="string" id="4478557">&#39;\r&#39;</span><span class="op" id="4478561">,</span>&nbsp;<span class="string" id="4478563">&#39;=&#39;</span><span class="op" id="4478566">,</span>&nbsp;<span class="string" id="4478568">&#39;&gt;&#39;</span><span class="op" id="4478571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478576">return</span>&nbsp;<span class="ident" id="4478583">j</span><span class="op" id="4478584">,</span>&nbsp;<span class="ident" id="4478586">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478592">case</span>&nbsp;<span class="string" id="4478597">&#39;\&#39;&#39;</span><span class="op" id="4478601">,</span>&nbsp;<span class="string" id="4478603">&#39;&#34;&#39;</span><span class="op" id="4478606">,</span>&nbsp;<span class="string" id="4478608">&#39;&lt;&#39;</span><span class="op" id="4478611">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478616">//&nbsp;These&nbsp;result&nbsp;in&nbsp;a&nbsp;parse&nbsp;warning&nbsp;in&nbsp;HTML5&nbsp;and&nbsp;are</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478671">//&nbsp;indicative&nbsp;of&nbsp;serious&nbsp;problems&nbsp;if&nbsp;seen&nbsp;in&nbsp;an&nbsp;attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478727">//&nbsp;name&nbsp;in&nbsp;a&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478753">return</span>&nbsp;<span class="op" id="4478760">-</span><span class="num" id="4478761">1</span><span class="op" id="4478762">,</span>&nbsp;<span class="ident" id="4478764">errorf</span><span class="op" id="4478770">(</span><span class="ident" id="4478771">ErrBadHTML</span><span class="op" id="4478781">,</span>&nbsp;<span class="ident" id="4478783">nil</span><span class="op" id="4478786">,</span>&nbsp;<span class="num" id="4478788">0</span><span class="op" id="4478789">,</span>&nbsp;<span class="string" id="4478791">&#34;%q&nbsp;in&nbsp;attribute&nbsp;name:&nbsp;%.32q&#34;</span><span class="op" id="4478820">,</span>&nbsp;<span class="ident" id="4478822">s</span><span class="op" id="4478823">[</span><span class="ident" id="4478824">j</span><span class="op" id="4478825">:</span><span class="ident" id="4478826">j</span><span class="op" id="4478827">+</span><span class="num" id="4478828">1</span><span class="op" id="4478829">]</span><span class="op" id="4478830">,</span>&nbsp;<span class="ident" id="4478832">s</span><span class="op" id="4478833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478837">default</span><span class="op" id="4478844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478849">//&nbsp;No-op.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4478861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4478864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478867">return</span>&nbsp;<span class="builtinfunc" id="4478874">len</span><span class="op" id="4478877">(</span><span class="ident" id="4478878">s</span><span class="op" id="4478879">)</span><span class="op" id="4478880">,</span>&nbsp;<span class="ident" id="4478882">nil</span><br>
<span class="lineno"></span><span class="op" id="4478886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="4478889">var</span>&nbsp;<span class="ident" id="4478893">elementNameMap</span>&nbsp;<span class="op" id="4478908">=</span>&nbsp;<span class="keyword" id="4478910">map</span><span class="op" id="4478913">[</span><span class="builtintype" id="4478914">string</span><span class="op" id="4478920">]</span><span class="ident" id="4478921">element</span><span class="op" id="4478928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4478931">&#34;script&#34;</span><span class="op" id="4478939">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4478943">elementScript</span><span class="op" id="4478956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4478959">&#34;style&#34;</span><span class="op" id="4478966">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4478971">elementStyle</span><span class="op" id="4478983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4478986">&#34;textarea&#34;</span><span class="op" id="4478996">:</span>&nbsp;<span class="ident" id="4478998">elementTextarea</span><span class="op" id="4479013">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4479016">&#34;title&#34;</span><span class="op" id="4479023">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4479028">elementTitle</span><span class="op" id="4479040">,</span><br>
<span class="lineno">505</span><span class="op" id="4479042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4479045">//&nbsp;asciiAlpha&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="4479097">func</span>&nbsp;<span class="ident" id="4479102">asciiAlpha</span><span class="op" id="4479112">(</span><span class="ident" id="4479113">c</span>&nbsp;<span class="builtintype" id="4479115">byte</span><span class="op" id="4479119">)</span>&nbsp;<span class="builtintype" id="4479121">bool</span>&nbsp;<span class="op" id="4479126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479129">return</span>&nbsp;<span class="string" id="4479136">&#39;A&#39;</span>&nbsp;<span class="op" id="4479140">&lt;=</span>&nbsp;<span class="ident" id="4479143">c</span>&nbsp;<span class="op" id="4479145">&amp;&amp;</span>&nbsp;<span class="ident" id="4479148">c</span>&nbsp;<span class="op" id="4479150">&lt;=</span>&nbsp;<span class="string" id="4479153">&#39;Z&#39;</span>&nbsp;<span class="op" id="4479157">||</span>&nbsp;<span class="string" id="4479160">&#39;a&#39;</span>&nbsp;<span class="op" id="4479164">&lt;=</span>&nbsp;<span class="ident" id="4479167">c</span>&nbsp;<span class="op" id="4479169">&amp;&amp;</span>&nbsp;<span class="ident" id="4479172">c</span>&nbsp;<span class="op" id="4479174">&lt;=</span>&nbsp;<span class="string" id="4479177">&#39;z&#39;</span><br>
<span class="lineno">510</span><span class="op" id="4479181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4479184">//&nbsp;asciiAlphaNum&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;or&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="4479248">func</span>&nbsp;<span class="ident" id="4479253">asciiAlphaNum</span><span class="op" id="4479266">(</span><span class="ident" id="4479267">c</span>&nbsp;<span class="builtintype" id="4479269">byte</span><span class="op" id="4479273">)</span>&nbsp;<span class="builtintype" id="4479275">bool</span>&nbsp;<span class="op" id="4479280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479283">return</span>&nbsp;<span class="ident" id="4479290">asciiAlpha</span><span class="op" id="4479300">(</span><span class="ident" id="4479301">c</span><span class="op" id="4479302">)</span>&nbsp;<span class="op" id="4479304">||</span>&nbsp;<span class="string" id="4479307">&#39;0&#39;</span>&nbsp;<span class="op" id="4479311">&lt;=</span>&nbsp;<span class="ident" id="4479314">c</span>&nbsp;<span class="op" id="4479316">&amp;&amp;</span>&nbsp;<span class="ident" id="4479319">c</span>&nbsp;<span class="op" id="4479321">&lt;=</span>&nbsp;<span class="string" id="4479324">&#39;9&#39;</span><br>
<span class="lineno">515</span><span class="op" id="4479328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4479331">//&nbsp;eatTagName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;a&nbsp;tag&nbsp;name&nbsp;and&nbsp;the&nbsp;tag&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4479416">func</span>&nbsp;<span class="ident" id="4479421">eatTagName</span><span class="op" id="4479431">(</span><span class="ident" id="4479432">s</span>&nbsp;<span class="op" id="4479434">[</span><span class="op" id="4479435">]</span><span class="builtintype" id="4479436">byte</span><span class="op" id="4479440">,</span>&nbsp;<span class="ident" id="4479442">i</span>&nbsp;<span class="builtintype" id="4479444">int</span><span class="op" id="4479447">)</span>&nbsp;<span class="op" id="4479449">(</span><span class="builtintype" id="4479450">int</span><span class="op" id="4479453">,</span>&nbsp;<span class="ident" id="4479455">element</span><span class="op" id="4479462">)</span>&nbsp;<span class="op" id="4479464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479467">if</span>&nbsp;<span class="ident" id="4479470">i</span>&nbsp;<span class="op" id="4479472">==</span>&nbsp;<span class="builtinfunc" id="4479475">len</span><span class="op" id="4479478">(</span><span class="ident" id="4479479">s</span><span class="op" id="4479480">)</span>&nbsp;<span class="op" id="4479482">||</span>&nbsp;<span class="op" id="4479485">!</span><span class="ident" id="4479486">asciiAlpha</span><span class="op" id="4479496">(</span><span class="ident" id="4479497">s</span><span class="op" id="4479498">[</span><span class="ident" id="4479499">i</span><span class="op" id="4479500">]</span><span class="op" id="4479501">)</span>&nbsp;<span class="op" id="4479503">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479507">return</span>&nbsp;<span class="ident" id="4479514">i</span><span class="op" id="4479515">,</span>&nbsp;<span class="ident" id="4479517">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479533">j</span>&nbsp;<span class="op" id="4479535">:=</span>&nbsp;<span class="ident" id="4479538">i</span>&nbsp;<span class="op" id="4479540">+</span>&nbsp;<span class="num" id="4479542">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479545">for</span>&nbsp;<span class="ident" id="4479549">j</span>&nbsp;<span class="op" id="4479551">&lt;</span>&nbsp;<span class="builtinfunc" id="4479553">len</span><span class="op" id="4479556">(</span><span class="ident" id="4479557">s</span><span class="op" id="4479558">)</span>&nbsp;<span class="op" id="4479560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479564">x</span>&nbsp;<span class="op" id="4479566">:=</span>&nbsp;<span class="ident" id="4479569">s</span><span class="op" id="4479570">[</span><span class="ident" id="4479571">j</span><span class="op" id="4479572">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479576">if</span>&nbsp;<span class="ident" id="4479579">asciiAlphaNum</span><span class="op" id="4479592">(</span><span class="ident" id="4479593">x</span><span class="op" id="4479594">)</span>&nbsp;<span class="op" id="4479596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479601">j</span><span class="op" id="4479602">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479608">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479623">//&nbsp;Allow&nbsp;&#34;x-y&#34;&nbsp;or&nbsp;&#34;x:y&#34;&nbsp;but&nbsp;not&nbsp;&#34;x-&#34;,&nbsp;&#34;-y&#34;,&nbsp;or&nbsp;&#34;x--y&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479680">if</span>&nbsp;<span class="op" id="4479683">(</span><span class="ident" id="4479684">x</span>&nbsp;<span class="op" id="4479686">==</span>&nbsp;<span class="string" id="4479689">&#39;:&#39;</span>&nbsp;<span class="op" id="4479693">||</span>&nbsp;<span class="ident" id="4479696">x</span>&nbsp;<span class="op" id="4479698">==</span>&nbsp;<span class="string" id="4479701">&#39;-&#39;</span><span class="op" id="4479704">)</span>&nbsp;<span class="op" id="4479706">&amp;&amp;</span>&nbsp;<span class="ident" id="4479709">j</span><span class="op" id="4479710">+</span><span class="num" id="4479711">1</span>&nbsp;<span class="op" id="4479713">&lt;</span>&nbsp;<span class="builtinfunc" id="4479715">len</span><span class="op" id="4479718">(</span><span class="ident" id="4479719">s</span><span class="op" id="4479720">)</span>&nbsp;<span class="op" id="4479722">&amp;&amp;</span>&nbsp;<span class="ident" id="4479725">asciiAlphaNum</span><span class="op" id="4479738">(</span><span class="ident" id="4479739">s</span><span class="op" id="4479740">[</span><span class="ident" id="4479741">j</span><span class="op" id="4479742">+</span><span class="num" id="4479743">1</span><span class="op" id="4479744">]</span><span class="op" id="4479745">)</span>&nbsp;<span class="op" id="4479747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479752">j</span>&nbsp;<span class="op" id="4479754">+=</span>&nbsp;<span class="num" id="4479757">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479762">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479777">break</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479787">return</span>&nbsp;<span class="ident" id="4479794">j</span><span class="op" id="4479795">,</span>&nbsp;<span class="ident" id="4479797">elementNameMap</span><span class="op" id="4479811">[</span><span class="ident" id="4479812">strings</span><span class="op" id="4479819">.</span><span class="ident" id="4479820">ToLower</span><span class="op" id="4479827">(</span><span class="builtintype" id="4479828">string</span><span class="op" id="4479834">(</span><span class="ident" id="4479835">s</span><span class="op" id="4479836">[</span><span class="ident" id="4479837">i</span><span class="op" id="4479838">:</span><span class="ident" id="4479839">j</span><span class="op" id="4479840">]</span><span class="op" id="4479841">)</span><span class="op" id="4479842">)</span><span class="op" id="4479843">]</span><br>
<span class="lineno"></span><span class="op" id="4479845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4479848">//&nbsp;eatWhiteSpace&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;white&nbsp;space.</span><br>
<span class="lineno">540</span><span class="keyword" id="4479920">func</span>&nbsp;<span class="ident" id="4479925">eatWhiteSpace</span><span class="op" id="4479938">(</span><span class="ident" id="4479939">s</span>&nbsp;<span class="op" id="4479941">[</span><span class="op" id="4479942">]</span><span class="builtintype" id="4479943">byte</span><span class="op" id="4479947">,</span>&nbsp;<span class="ident" id="4479949">i</span>&nbsp;<span class="builtintype" id="4479951">int</span><span class="op" id="4479954">)</span>&nbsp;<span class="builtintype" id="4479956">int</span>&nbsp;<span class="op" id="4479960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479963">for</span>&nbsp;<span class="ident" id="4479967">j</span>&nbsp;<span class="op" id="4479969">:=</span>&nbsp;<span class="ident" id="4479972">i</span><span class="op" id="4479973">;</span>&nbsp;<span class="ident" id="4479975">j</span>&nbsp;<span class="op" id="4479977">&lt;</span>&nbsp;<span class="builtinfunc" id="4479979">len</span><span class="op" id="4479982">(</span><span class="ident" id="4479983">s</span><span class="op" id="4479984">)</span><span class="op" id="4479985">;</span>&nbsp;<span class="ident" id="4479987">j</span><span class="op" id="4479988">++</span>&nbsp;<span class="op" id="4479991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479995">switch</span>&nbsp;<span class="ident" id="4480002">s</span><span class="op" id="4480003">[</span><span class="ident" id="4480004">j</span><span class="op" id="4480005">]</span>&nbsp;<span class="op" id="4480007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480011">case</span>&nbsp;<span class="string" id="4480016">&#39;&nbsp;&#39;</span><span class="op" id="4480019">,</span>&nbsp;<span class="string" id="4480021">&#39;\t&#39;</span><span class="op" id="4480025">,</span>&nbsp;<span class="string" id="4480027">&#39;\n&#39;</span><span class="op" id="4480031">,</span>&nbsp;<span class="string" id="4480033">&#39;\f&#39;</span><span class="op" id="4480037">,</span>&nbsp;<span class="string" id="4480039">&#39;\r&#39;</span><span class="op" id="4480043">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480048">//&nbsp;No-op.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480060">default</span><span class="op" id="4480067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480072">return</span>&nbsp;<span class="ident" id="4480079">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4480083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4480086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480089">return</span>&nbsp;<span class="builtinfunc" id="4480096">len</span><span class="op" id="4480099">(</span><span class="ident" id="4480100">s</span><span class="op" id="4480101">)</span><br>
<span class="lineno">550</span><span class="op" id="4480103">}</span>
</div>
</body>
</html>
