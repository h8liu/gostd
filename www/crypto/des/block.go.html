<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4031562">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4031617">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4031671">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4031722">package</span>&nbsp;<span class="ident" id="4031730">des</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4031735">import</span>&nbsp;<span class="op" id="4031742">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4031745">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span><span class="op" id="4031763">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4031766">func</span>&nbsp;<span class="ident" id="4031771">cryptBlock</span><span class="op" id="4031781">(</span><span class="ident" id="4031782">subkeys</span>&nbsp;<span class="op" id="4031790">[</span><span class="op" id="4031791">]</span><span class="ident" id="4031792">uint64</span><span class="op" id="4031798">,</span>&nbsp;<span class="ident" id="4031800">dst</span><span class="op" id="4031803">,</span>&nbsp;<span class="ident" id="4031805">src</span>&nbsp;<span class="op" id="4031809">[</span><span class="op" id="4031810">]</span><span class="builtintype" id="4031811">byte</span><span class="op" id="4031815">,</span>&nbsp;<span class="ident" id="4031817">decrypt</span>&nbsp;<span class="builtintype" id="4031825">bool</span><span class="op" id="4031829">)</span>&nbsp;<span class="op" id="4031831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4031834">b</span>&nbsp;<span class="op" id="4031836">:=</span>&nbsp;<span class="ident" id="4031839">binary</span><span class="op" id="4031845">.</span><span class="ident" id="4031846">BigEndian</span><span class="op" id="4031855">.</span><span class="ident" id="4031856">Uint64</span><span class="op" id="4031862">(</span><span class="ident" id="4031863">src</span><span class="op" id="4031866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4031869">b</span>&nbsp;<span class="op" id="4031871">=</span>&nbsp;<span class="ident" id="4031873">permuteInitialBlock</span><span class="op" id="4031892">(</span><span class="ident" id="4031893">b</span><span class="op" id="4031894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4031897">left</span><span class="op" id="4031901">,</span>&nbsp;<span class="ident" id="4031903">right</span>&nbsp;<span class="op" id="4031909">:=</span>&nbsp;<span class="builtintype" id="4031912">uint32</span><span class="op" id="4031918">(</span><span class="ident" id="4031919">b</span><span class="op" id="4031920">&gt;&gt;</span><span class="num" id="4031922">32</span><span class="op" id="4031924">)</span><span class="op" id="4031925">,</span>&nbsp;<span class="builtintype" id="4031927">uint32</span><span class="op" id="4031933">(</span><span class="ident" id="4031934">b</span><span class="op" id="4031935">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4031939">var</span>&nbsp;<span class="ident" id="4031943">subkey</span>&nbsp;<span class="ident" id="4031950">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4031958">for</span>&nbsp;<span class="ident" id="4031962">i</span>&nbsp;<span class="op" id="4031964">:=</span>&nbsp;<span class="num" id="4031967">0</span><span class="op" id="4031968">;</span>&nbsp;<span class="ident" id="4031970">i</span>&nbsp;<span class="op" id="4031972">&lt;</span>&nbsp;<span class="num" id="4031974">16</span><span class="op" id="4031976">;</span>&nbsp;<span class="ident" id="4031978">i</span><span class="op" id="4031979">++</span>&nbsp;<span class="op" id="4031982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4031986">if</span>&nbsp;<span class="ident" id="4031989">decrypt</span>&nbsp;<span class="op" id="4031997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032002">subkey</span>&nbsp;<span class="op" id="4032009">=</span>&nbsp;<span class="ident" id="4032011">subkeys</span><span class="op" id="4032018">[</span><span class="num" id="4032019">15</span><span class="op" id="4032021">-</span><span class="ident" id="4032022">i</span><span class="op" id="4032023">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4032027">}</span>&nbsp;<span class="keyword" id="4032029">else</span>&nbsp;<span class="op" id="4032034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032039">subkey</span>&nbsp;<span class="op" id="4032046">=</span>&nbsp;<span class="ident" id="4032048">subkeys</span><span class="op" id="4032055">[</span><span class="ident" id="4032056">i</span><span class="op" id="4032057">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4032061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032066">left</span><span class="op" id="4032070">,</span>&nbsp;<span class="ident" id="4032072">right</span>&nbsp;<span class="op" id="4032078">=</span>&nbsp;<span class="ident" id="4032080">right</span><span class="op" id="4032085">,</span>&nbsp;<span class="ident" id="4032087">left</span><span class="op" id="4032091">^</span><span class="ident" id="4032092">feistel</span><span class="op" id="4032099">(</span><span class="ident" id="4032100">right</span><span class="op" id="4032105">,</span>&nbsp;<span class="ident" id="4032107">subkey</span><span class="op" id="4032113">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4032116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4032119">//&nbsp;switch&nbsp;left&nbsp;&amp;&nbsp;right&nbsp;and&nbsp;perform&nbsp;final&nbsp;permutation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032173">preOutput</span>&nbsp;<span class="op" id="4032183">:=</span>&nbsp;<span class="op" id="4032186">(</span><span class="ident" id="4032187">uint64</span><span class="op" id="4032193">(</span><span class="ident" id="4032194">right</span><span class="op" id="4032199">)</span>&nbsp;<span class="op" id="4032201">&lt;&lt;</span>&nbsp;<span class="num" id="4032204">32</span><span class="op" id="4032206">)</span>&nbsp;<span class="op" id="4032208">|</span>&nbsp;<span class="ident" id="4032210">uint64</span><span class="op" id="4032216">(</span><span class="ident" id="4032217">left</span><span class="op" id="4032221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032224">binary</span><span class="op" id="4032230">.</span><span class="ident" id="4032231">BigEndian</span><span class="op" id="4032240">.</span><span class="ident" id="4032241">PutUint64</span><span class="op" id="4032250">(</span><span class="ident" id="4032251">dst</span><span class="op" id="4032254">,</span>&nbsp;<span class="ident" id="4032256">permuteFinalBlock</span><span class="op" id="4032273">(</span><span class="ident" id="4032274">preOutput</span><span class="op" id="4032283">)</span><span class="op" id="4032284">)</span><br>
<span class="lineno"></span><span class="op" id="4032286">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4032289">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;subkeys.</span><br>
<span class="lineno"></span><span class="keyword" id="4032348">func</span>&nbsp;<span class="ident" id="4032353">encryptBlock</span><span class="op" id="4032365">(</span><span class="ident" id="4032366">subkeys</span>&nbsp;<span class="op" id="4032374">[</span><span class="op" id="4032375">]</span><span class="ident" id="4032376">uint64</span><span class="op" id="4032382">,</span>&nbsp;<span class="ident" id="4032384">dst</span><span class="op" id="4032387">,</span>&nbsp;<span class="ident" id="4032389">src</span>&nbsp;<span class="op" id="4032393">[</span><span class="op" id="4032394">]</span><span class="builtintype" id="4032395">byte</span><span class="op" id="4032399">)</span>&nbsp;<span class="op" id="4032401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032404">cryptBlock</span><span class="op" id="4032414">(</span><span class="ident" id="4032415">subkeys</span><span class="op" id="4032422">,</span>&nbsp;<span class="ident" id="4032424">dst</span><span class="op" id="4032427">,</span>&nbsp;<span class="ident" id="4032429">src</span><span class="op" id="4032432">,</span>&nbsp;<span class="ident" id="4032434">false</span><span class="op" id="4032439">)</span><br>
<span class="lineno"></span><span class="op" id="4032441">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="4032444">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;subkeys.</span><br>
<span class="lineno"></span><span class="keyword" id="4032503">func</span>&nbsp;<span class="ident" id="4032508">decryptBlock</span><span class="op" id="4032520">(</span><span class="ident" id="4032521">subkeys</span>&nbsp;<span class="op" id="4032529">[</span><span class="op" id="4032530">]</span><span class="ident" id="4032531">uint64</span><span class="op" id="4032537">,</span>&nbsp;<span class="ident" id="4032539">dst</span><span class="op" id="4032542">,</span>&nbsp;<span class="ident" id="4032544">src</span>&nbsp;<span class="op" id="4032548">[</span><span class="op" id="4032549">]</span><span class="builtintype" id="4032550">byte</span><span class="op" id="4032554">)</span>&nbsp;<span class="op" id="4032556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032559">cryptBlock</span><span class="op" id="4032569">(</span><span class="ident" id="4032570">subkeys</span><span class="op" id="4032577">,</span>&nbsp;<span class="ident" id="4032579">dst</span><span class="op" id="4032582">,</span>&nbsp;<span class="ident" id="4032584">src</span><span class="op" id="4032587">,</span>&nbsp;<span class="ident" id="4032589">true</span><span class="op" id="4032593">)</span><br>
<span class="lineno"></span><span class="op" id="4032595">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4032598">//&nbsp;DES&nbsp;Feistel&nbsp;function</span><br>
<span class="lineno"></span><span class="keyword" id="4032622">func</span>&nbsp;<span class="ident" id="4032627">feistel</span><span class="op" id="4032634">(</span><span class="ident" id="4032635">right</span>&nbsp;<span class="builtintype" id="4032641">uint32</span><span class="op" id="4032647">,</span>&nbsp;<span class="ident" id="4032649">key</span>&nbsp;<span class="ident" id="4032653">uint64</span><span class="op" id="4032659">)</span>&nbsp;<span class="op" id="4032661">(</span><span class="ident" id="4032662">result</span>&nbsp;<span class="builtintype" id="4032669">uint32</span><span class="op" id="4032675">)</span>&nbsp;<span class="op" id="4032677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032680">sBoxLocations</span>&nbsp;<span class="op" id="4032694">:=</span>&nbsp;<span class="ident" id="4032697">key</span>&nbsp;<span class="op" id="4032701">^</span>&nbsp;<span class="ident" id="4032703">expandBlock</span><span class="op" id="4032714">(</span><span class="ident" id="4032715">right</span><span class="op" id="4032720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4032723">var</span>&nbsp;<span class="ident" id="4032727">sBoxResult</span>&nbsp;<span class="builtintype" id="4032738">uint32</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4032746">for</span>&nbsp;<span class="ident" id="4032750">i</span>&nbsp;<span class="op" id="4032752">:=</span>&nbsp;<span class="builtintype" id="4032755">uint8</span><span class="op" id="4032760">(</span><span class="num" id="4032761">0</span><span class="op" id="4032762">)</span><span class="op" id="4032763">;</span>&nbsp;<span class="ident" id="4032765">i</span>&nbsp;<span class="op" id="4032767">&lt;</span>&nbsp;<span class="num" id="4032769">8</span><span class="op" id="4032770">;</span>&nbsp;<span class="ident" id="4032772">i</span><span class="op" id="4032773">++</span>&nbsp;<span class="op" id="4032776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032780">sBoxLocation</span>&nbsp;<span class="op" id="4032793">:=</span>&nbsp;<span class="builtintype" id="4032796">uint8</span><span class="op" id="4032801">(</span><span class="ident" id="4032802">sBoxLocations</span><span class="op" id="4032815">&gt;&gt;</span><span class="num" id="4032817">42</span><span class="op" id="4032819">)</span>&nbsp;<span class="op" id="4032821">&amp;</span>&nbsp;<span class="num" id="4032823">0x3f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032830">sBoxLocations</span>&nbsp;<span class="op" id="4032844">&lt;&lt;=</span>&nbsp;<span class="num" id="4032848">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4032852">//&nbsp;row&nbsp;determined&nbsp;by&nbsp;1st&nbsp;and&nbsp;6th&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4032891">//&nbsp;column&nbsp;is&nbsp;middle&nbsp;four&nbsp;bits</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032923">row</span>&nbsp;<span class="op" id="4032927">:=</span>&nbsp;<span class="op" id="4032930">(</span><span class="ident" id="4032931">sBoxLocation</span>&nbsp;<span class="op" id="4032944">&amp;</span>&nbsp;<span class="num" id="4032946">0x1</span><span class="op" id="4032949">)</span>&nbsp;<span class="op" id="4032951">|</span>&nbsp;<span class="op" id="4032953">(</span><span class="op" id="4032954">(</span><span class="ident" id="4032955">sBoxLocation</span>&nbsp;<span class="op" id="4032968">&amp;</span>&nbsp;<span class="num" id="4032970">0x20</span><span class="op" id="4032974">)</span>&nbsp;<span class="op" id="4032976">&gt;&gt;</span>&nbsp;<span class="num" id="4032979">4</span><span class="op" id="4032980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032984">column</span>&nbsp;<span class="op" id="4032991">:=</span>&nbsp;<span class="op" id="4032994">(</span><span class="ident" id="4032995">sBoxLocation</span>&nbsp;<span class="op" id="4033008">&gt;&gt;</span>&nbsp;<span class="num" id="4033011">1</span><span class="op" id="4033012">)</span>&nbsp;<span class="op" id="4033014">&amp;</span>&nbsp;<span class="num" id="4033016">0xf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033022">sBoxResult</span>&nbsp;<span class="op" id="4033033">^=</span>&nbsp;<span class="ident" id="4033036">feistelBox</span><span class="op" id="4033046">[</span><span class="ident" id="4033047">i</span><span class="op" id="4033048">]</span><span class="op" id="4033049">[</span><span class="num" id="4033050">16</span><span class="op" id="4033052">*</span><span class="ident" id="4033053">row</span><span class="op" id="4033056">+</span><span class="ident" id="4033057">column</span><span class="op" id="4033063">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4033066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033069">return</span>&nbsp;<span class="ident" id="4033076">sBoxResult</span><br>
<span class="lineno">55</span><span class="op" id="4033087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4033090">//&nbsp;feistelBox[s][16*i+j]&nbsp;contains&nbsp;the&nbsp;output&nbsp;of&nbsp;permutationFunction</span><br>
<span class="lineno"></span><span class="comment" id="4033158">//&nbsp;for&nbsp;sBoxes[s][i][j]&nbsp;&lt;&lt;&nbsp;4*(7-s)</span><br>
<span class="lineno"></span><span class="keyword" id="4033192">var</span>&nbsp;<span class="ident" id="4033196">feistelBox</span>&nbsp;<span class="op" id="4033207">[</span><span class="num" id="4033208">8</span><span class="op" id="4033209">]</span><span class="op" id="4033210">[</span><span class="num" id="4033211">64</span><span class="op" id="4033213">]</span><span class="builtintype" id="4033214">uint32</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="4033222">//&nbsp;general&nbsp;purpose&nbsp;function&nbsp;to&nbsp;perform&nbsp;DES&nbsp;block&nbsp;permutations</span><br>
<span class="lineno"></span><span class="keyword" id="4033284">func</span>&nbsp;<span class="ident" id="4033289">permuteBlock</span><span class="op" id="4033301">(</span><span class="ident" id="4033302">src</span>&nbsp;<span class="ident" id="4033306">uint64</span><span class="op" id="4033312">,</span>&nbsp;<span class="ident" id="4033314">permutation</span>&nbsp;<span class="op" id="4033326">[</span><span class="op" id="4033327">]</span><span class="builtintype" id="4033328">uint8</span><span class="op" id="4033333">)</span>&nbsp;<span class="op" id="4033335">(</span><span class="ident" id="4033336">block</span>&nbsp;<span class="ident" id="4033342">uint64</span><span class="op" id="4033348">)</span>&nbsp;<span class="op" id="4033350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033353">for</span>&nbsp;<span class="ident" id="4033357">position</span><span class="op" id="4033365">,</span>&nbsp;<span class="ident" id="4033367">n</span>&nbsp;<span class="op" id="4033369">:=</span>&nbsp;<span class="keyword" id="4033372">range</span>&nbsp;<span class="ident" id="4033378">permutation</span>&nbsp;<span class="op" id="4033390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033394">bit</span>&nbsp;<span class="op" id="4033398">:=</span>&nbsp;<span class="op" id="4033401">(</span><span class="ident" id="4033402">src</span>&nbsp;<span class="op" id="4033406">&gt;&gt;</span>&nbsp;<span class="ident" id="4033409">n</span><span class="op" id="4033410">)</span>&nbsp;<span class="op" id="4033412">&amp;</span>&nbsp;<span class="num" id="4033414">1</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033418">block</span>&nbsp;<span class="op" id="4033424">|=</span>&nbsp;<span class="ident" id="4033427">bit</span>&nbsp;<span class="op" id="4033431">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4033434">uint</span><span class="op" id="4033438">(</span><span class="op" id="4033439">(</span><span class="builtinfunc" id="4033440">len</span><span class="op" id="4033443">(</span><span class="ident" id="4033444">permutation</span><span class="op" id="4033455">)</span><span class="op" id="4033456">-</span><span class="num" id="4033457">1</span><span class="op" id="4033458">)</span><span class="op" id="4033459">-</span><span class="ident" id="4033460">position</span><span class="op" id="4033468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4033471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033474">return</span><br>
<span class="lineno"></span><span class="op" id="4033481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="4033484">func</span>&nbsp;<span class="ident" id="4033489">init</span><span class="op" id="4033493">(</span><span class="op" id="4033494">)</span>&nbsp;<span class="op" id="4033496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033499">for</span>&nbsp;<span class="ident" id="4033503">s</span>&nbsp;<span class="op" id="4033505">:=</span>&nbsp;<span class="keyword" id="4033508">range</span>&nbsp;<span class="ident" id="4033514">sBoxes</span>&nbsp;<span class="op" id="4033521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033525">for</span>&nbsp;<span class="ident" id="4033529">i</span>&nbsp;<span class="op" id="4033531">:=</span>&nbsp;<span class="num" id="4033534">0</span><span class="op" id="4033535">;</span>&nbsp;<span class="ident" id="4033537">i</span>&nbsp;<span class="op" id="4033539">&lt;</span>&nbsp;<span class="num" id="4033541">4</span><span class="op" id="4033542">;</span>&nbsp;<span class="ident" id="4033544">i</span><span class="op" id="4033545">++</span>&nbsp;<span class="op" id="4033548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033553">for</span>&nbsp;<span class="ident" id="4033557">j</span>&nbsp;<span class="op" id="4033559">:=</span>&nbsp;<span class="num" id="4033562">0</span><span class="op" id="4033563">;</span>&nbsp;<span class="ident" id="4033565">j</span>&nbsp;<span class="op" id="4033567">&lt;</span>&nbsp;<span class="num" id="4033569">16</span><span class="op" id="4033571">;</span>&nbsp;<span class="ident" id="4033573">j</span><span class="op" id="4033574">++</span>&nbsp;<span class="op" id="4033577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033583">f</span>&nbsp;<span class="op" id="4033585">:=</span>&nbsp;<span class="ident" id="4033588">uint64</span><span class="op" id="4033594">(</span><span class="ident" id="4033595">sBoxes</span><span class="op" id="4033601">[</span><span class="ident" id="4033602">s</span><span class="op" id="4033603">]</span><span class="op" id="4033604">[</span><span class="ident" id="4033605">i</span><span class="op" id="4033606">]</span><span class="op" id="4033607">[</span><span class="ident" id="4033608">j</span><span class="op" id="4033609">]</span><span class="op" id="4033610">)</span>&nbsp;<span class="op" id="4033612">&lt;&lt;</span>&nbsp;<span class="op" id="4033615">(</span><span class="num" id="4033616">4</span>&nbsp;<span class="op" id="4033618">*</span>&nbsp;<span class="op" id="4033620">(</span><span class="num" id="4033621">7</span>&nbsp;<span class="op" id="4033623">-</span>&nbsp;<span class="builtintype" id="4033625">uint</span><span class="op" id="4033629">(</span><span class="ident" id="4033630">s</span><span class="op" id="4033631">)</span><span class="op" id="4033632">)</span><span class="op" id="4033633">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033639">f</span>&nbsp;<span class="op" id="4033641">=</span>&nbsp;<span class="ident" id="4033643">permuteBlock</span><span class="op" id="4033655">(</span><span class="ident" id="4033656">uint64</span><span class="op" id="4033662">(</span><span class="ident" id="4033663">f</span><span class="op" id="4033664">)</span><span class="op" id="4033665">,</span>&nbsp;<span class="ident" id="4033667">permutationFunction</span><span class="op" id="4033686">[</span><span class="op" id="4033687">:</span><span class="op" id="4033688">]</span><span class="op" id="4033689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033695">feistelBox</span><span class="op" id="4033705">[</span><span class="ident" id="4033706">s</span><span class="op" id="4033707">]</span><span class="op" id="4033708">[</span><span class="num" id="4033709">16</span><span class="op" id="4033711">*</span><span class="ident" id="4033712">i</span><span class="op" id="4033713">+</span><span class="ident" id="4033714">j</span><span class="op" id="4033715">]</span>&nbsp;<span class="op" id="4033717">=</span>&nbsp;<span class="builtintype" id="4033719">uint32</span><span class="op" id="4033725">(</span><span class="ident" id="4033726">f</span><span class="op" id="4033727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4033732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4033736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4033739">}</span><br>
<span class="lineno">80</span><span class="op" id="4033741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4033744">//&nbsp;expandBlock&nbsp;expands&nbsp;an&nbsp;input&nbsp;block&nbsp;of&nbsp;32&nbsp;bits,</span><br>
<span class="lineno"></span><span class="comment" id="4033794">//&nbsp;producing&nbsp;an&nbsp;output&nbsp;block&nbsp;of&nbsp;48&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4033835">func</span>&nbsp;<span class="ident" id="4033840">expandBlock</span><span class="op" id="4033851">(</span><span class="ident" id="4033852">src</span>&nbsp;<span class="builtintype" id="4033856">uint32</span><span class="op" id="4033862">)</span>&nbsp;<span class="op" id="4033864">(</span><span class="ident" id="4033865">block</span>&nbsp;<span class="ident" id="4033871">uint64</span><span class="op" id="4033877">)</span>&nbsp;<span class="op" id="4033879">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4033882">//&nbsp;rotate&nbsp;the&nbsp;5&nbsp;highest&nbsp;bits&nbsp;to&nbsp;the&nbsp;right.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033926">src</span>&nbsp;<span class="op" id="4033930">=</span>&nbsp;<span class="op" id="4033932">(</span><span class="ident" id="4033933">src</span>&nbsp;<span class="op" id="4033937">&lt;&lt;</span>&nbsp;<span class="num" id="4033940">5</span><span class="op" id="4033941">)</span>&nbsp;<span class="op" id="4033943">|</span>&nbsp;<span class="op" id="4033945">(</span><span class="ident" id="4033946">src</span>&nbsp;<span class="op" id="4033950">&gt;&gt;</span>&nbsp;<span class="num" id="4033953">27</span><span class="op" id="4033955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033958">for</span>&nbsp;<span class="ident" id="4033962">i</span>&nbsp;<span class="op" id="4033964">:=</span>&nbsp;<span class="num" id="4033967">0</span><span class="op" id="4033968">;</span>&nbsp;<span class="ident" id="4033970">i</span>&nbsp;<span class="op" id="4033972">&lt;</span>&nbsp;<span class="num" id="4033974">8</span><span class="op" id="4033975">;</span>&nbsp;<span class="ident" id="4033977">i</span><span class="op" id="4033978">++</span>&nbsp;<span class="op" id="4033981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033985">block</span>&nbsp;<span class="op" id="4033991">&lt;&lt;=</span>&nbsp;<span class="num" id="4033995">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4033999">//&nbsp;take&nbsp;the&nbsp;6&nbsp;bits&nbsp;on&nbsp;the&nbsp;right</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034033">block</span>&nbsp;<span class="op" id="4034039">|=</span>&nbsp;<span class="ident" id="4034042">uint64</span><span class="op" id="4034048">(</span><span class="ident" id="4034049">src</span><span class="op" id="4034052">)</span>&nbsp;<span class="op" id="4034054">&amp;</span>&nbsp;<span class="op" id="4034056">(</span><span class="num" id="4034057">1</span><span class="op" id="4034058">&lt;&lt;</span><span class="num" id="4034060">6</span>&nbsp;<span class="op" id="4034062">-</span>&nbsp;<span class="num" id="4034064">1</span><span class="op" id="4034065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034069">//&nbsp;advance&nbsp;by&nbsp;4&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034093">src</span>&nbsp;<span class="op" id="4034097">=</span>&nbsp;<span class="op" id="4034099">(</span><span class="ident" id="4034100">src</span>&nbsp;<span class="op" id="4034104">&lt;&lt;</span>&nbsp;<span class="num" id="4034107">4</span><span class="op" id="4034108">)</span>&nbsp;<span class="op" id="4034110">|</span>&nbsp;<span class="op" id="4034112">(</span><span class="ident" id="4034113">src</span>&nbsp;<span class="op" id="4034117">&gt;&gt;</span>&nbsp;<span class="num" id="4034120">28</span><span class="op" id="4034122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4034125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4034128">return</span><br>
<span class="lineno">95</span><span class="op" id="4034135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4034138">//&nbsp;permuteInitialBlock&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;permutation&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="4034202">//&nbsp;by&nbsp;initialPermutation.</span><br>
<span class="lineno"></span><span class="keyword" id="4034228">func</span>&nbsp;<span class="ident" id="4034233">permuteInitialBlock</span><span class="op" id="4034252">(</span><span class="ident" id="4034253">block</span>&nbsp;<span class="ident" id="4034259">uint64</span><span class="op" id="4034265">)</span>&nbsp;<span class="ident" id="4034267">uint64</span>&nbsp;<span class="op" id="4034274">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034277">//&nbsp;block&nbsp;=&nbsp;b7&nbsp;b6&nbsp;b5&nbsp;b4&nbsp;b3&nbsp;b2&nbsp;b1&nbsp;b0&nbsp;(8&nbsp;bytes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034323">b1</span>&nbsp;<span class="op" id="4034326">:=</span>&nbsp;<span class="ident" id="4034329">block</span>&nbsp;<span class="op" id="4034335">&gt;&gt;</span>&nbsp;<span class="num" id="4034338">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034342">b2</span>&nbsp;<span class="op" id="4034345">:=</span>&nbsp;<span class="ident" id="4034348">block</span>&nbsp;<span class="op" id="4034354">&lt;&lt;</span>&nbsp;<span class="num" id="4034357">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034361">block</span>&nbsp;<span class="op" id="4034367">^=</span>&nbsp;<span class="ident" id="4034370">b1</span>&nbsp;<span class="op" id="4034373">^</span>&nbsp;<span class="ident" id="4034375">b2</span>&nbsp;<span class="op" id="4034378">^</span>&nbsp;<span class="ident" id="4034380">b1</span><span class="op" id="4034382">&lt;&lt;</span><span class="num" id="4034384">48</span>&nbsp;<span class="op" id="4034387">^</span>&nbsp;<span class="ident" id="4034389">b2</span><span class="op" id="4034391">&gt;&gt;</span><span class="num" id="4034393">48</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034398">//&nbsp;block&nbsp;=&nbsp;b1&nbsp;b0&nbsp;b5&nbsp;b4&nbsp;b3&nbsp;b2&nbsp;b7&nbsp;b6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034434">b1</span>&nbsp;<span class="op" id="4034437">=</span>&nbsp;<span class="ident" id="4034439">block</span>&nbsp;<span class="op" id="4034445">&gt;&gt;</span>&nbsp;<span class="num" id="4034448">32</span>&nbsp;<span class="op" id="4034451">&amp;</span>&nbsp;<span class="num" id="4034453">0xff00ff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034463">b2</span>&nbsp;<span class="op" id="4034466">=</span>&nbsp;<span class="op" id="4034468">(</span><span class="ident" id="4034469">block</span>&nbsp;<span class="op" id="4034475">&amp;</span>&nbsp;<span class="num" id="4034477">0xff00ff00</span><span class="op" id="4034487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034490">block</span>&nbsp;<span class="op" id="4034496">^=</span>&nbsp;<span class="ident" id="4034499">b1</span><span class="op" id="4034501">&lt;&lt;</span><span class="num" id="4034503">32</span>&nbsp;<span class="op" id="4034506">^</span>&nbsp;<span class="ident" id="4034508">b2</span>&nbsp;<span class="op" id="4034511">^</span>&nbsp;<span class="ident" id="4034513">b1</span><span class="op" id="4034515">&lt;&lt;</span><span class="num" id="4034517">8</span>&nbsp;<span class="op" id="4034519">^</span>&nbsp;<span class="ident" id="4034521">b2</span><span class="op" id="4034523">&lt;&lt;</span><span class="num" id="4034525">24</span>&nbsp;<span class="comment" id="4034528">//&nbsp;exchange&nbsp;b0&nbsp;b4&nbsp;with&nbsp;b3&nbsp;b7</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034559">//&nbsp;block&nbsp;is&nbsp;now&nbsp;b1&nbsp;b3&nbsp;b5&nbsp;b7&nbsp;b0&nbsp;b2&nbsp;b4&nbsp;b7,&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034618">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034646">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034674">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034702">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;56</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034730">//&nbsp;&nbsp;7&nbsp;&nbsp;6&nbsp;&nbsp;5&nbsp;&nbsp;4&nbsp;&nbsp;3&nbsp;&nbsp;2&nbsp;&nbsp;1&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034758">//&nbsp;23&nbsp;22&nbsp;21&nbsp;20&nbsp;19&nbsp;18&nbsp;17&nbsp;16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034786">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034814">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;48</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034843">//&nbsp;exchange&nbsp;4,5,6,7&nbsp;with&nbsp;32,33,34,35&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034886">b1</span>&nbsp;<span class="op" id="4034889">=</span>&nbsp;<span class="ident" id="4034891">block</span>&nbsp;<span class="op" id="4034897">&amp;</span>&nbsp;<span class="num" id="4034899">0x0f0f00000f0f0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034919">b2</span>&nbsp;<span class="op" id="4034922">=</span>&nbsp;<span class="ident" id="4034924">block</span>&nbsp;<span class="op" id="4034930">&amp;</span>&nbsp;<span class="num" id="4034932">0x0000f0f00000f0f0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034952">block</span>&nbsp;<span class="op" id="4034958">^=</span>&nbsp;<span class="ident" id="4034961">b1</span>&nbsp;<span class="op" id="4034964">^</span>&nbsp;<span class="ident" id="4034966">b2</span>&nbsp;<span class="op" id="4034969">^</span>&nbsp;<span class="ident" id="4034971">b1</span><span class="op" id="4034973">&gt;&gt;</span><span class="num" id="4034975">12</span>&nbsp;<span class="op" id="4034978">^</span>&nbsp;<span class="ident" id="4034980">b2</span><span class="op" id="4034982">&lt;&lt;</span><span class="num" id="4034984">12</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4034989">//&nbsp;block&nbsp;is&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035019">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035023">//&nbsp;&nbsp;&nbsp;[+8]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[+40]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035048">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035052">//&nbsp;&nbsp;7&nbsp;&nbsp;6&nbsp;&nbsp;5&nbsp;&nbsp;4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035068">//&nbsp;23&nbsp;22&nbsp;21&nbsp;20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035084">//&nbsp;&nbsp;3&nbsp;&nbsp;2&nbsp;&nbsp;1&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035100">//&nbsp;19&nbsp;18&nbsp;17&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;[+32]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035126">//&nbsp;exchange&nbsp;0,1,4,5&nbsp;with&nbsp;18,19,22,23</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4035164">b1</span>&nbsp;<span class="op" id="4035167">=</span>&nbsp;<span class="ident" id="4035169">block</span>&nbsp;<span class="op" id="4035175">&amp;</span>&nbsp;<span class="num" id="4035177">0x3300330033003300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4035197">b2</span>&nbsp;<span class="op" id="4035200">=</span>&nbsp;<span class="ident" id="4035202">block</span>&nbsp;<span class="op" id="4035208">&amp;</span>&nbsp;<span class="num" id="4035210">0x00cc00cc00cc00cc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4035230">block</span>&nbsp;<span class="op" id="4035236">^=</span>&nbsp;<span class="ident" id="4035239">b1</span>&nbsp;<span class="op" id="4035242">^</span>&nbsp;<span class="ident" id="4035244">b2</span>&nbsp;<span class="op" id="4035247">^</span>&nbsp;<span class="ident" id="4035249">b1</span><span class="op" id="4035251">&gt;&gt;</span><span class="num" id="4035253">6</span>&nbsp;<span class="op" id="4035255">^</span>&nbsp;<span class="ident" id="4035257">b2</span><span class="op" id="4035259">&lt;&lt;</span><span class="num" id="4035261">6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035265">//&nbsp;block&nbsp;is&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035295">//&nbsp;15&nbsp;14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035305">//&nbsp;13&nbsp;12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035315">//&nbsp;11&nbsp;10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035325">//&nbsp;&nbsp;9&nbsp;&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035335">//&nbsp;&nbsp;7&nbsp;&nbsp;6</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035345">//&nbsp;&nbsp;5&nbsp;&nbsp;4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035355">//&nbsp;&nbsp;3&nbsp;&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035365">//&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;[+16]&nbsp;[+32]&nbsp;[+64]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035394">//&nbsp;exchange&nbsp;0,2,4,6&nbsp;with&nbsp;9,11,13,15:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4035432">b1</span>&nbsp;<span class="op" id="4035435">=</span>&nbsp;<span class="ident" id="4035437">block</span>&nbsp;<span class="op" id="4035443">&amp;</span>&nbsp;<span class="num" id="4035445">0xaaaaaaaa55555555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4035465">block</span>&nbsp;<span class="op" id="4035471">^=</span>&nbsp;<span class="ident" id="4035474">b1</span>&nbsp;<span class="op" id="4035477">^</span>&nbsp;<span class="ident" id="4035479">b1</span><span class="op" id="4035481">&gt;&gt;</span><span class="num" id="4035483">33</span>&nbsp;<span class="op" id="4035486">^</span>&nbsp;<span class="ident" id="4035488">b1</span><span class="op" id="4035490">&lt;&lt;</span><span class="num" id="4035492">33</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035497">//&nbsp;block&nbsp;is&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035527">//&nbsp;6&nbsp;14&nbsp;22&nbsp;30&nbsp;38&nbsp;46&nbsp;54&nbsp;62</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035554">//&nbsp;4&nbsp;12&nbsp;20&nbsp;28&nbsp;36&nbsp;44&nbsp;52&nbsp;60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035581">//&nbsp;2&nbsp;10&nbsp;18&nbsp;26&nbsp;34&nbsp;42&nbsp;50&nbsp;58</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035608">//&nbsp;0&nbsp;&nbsp;8&nbsp;16&nbsp;24&nbsp;32&nbsp;40&nbsp;48&nbsp;56</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035635">//&nbsp;7&nbsp;15&nbsp;23&nbsp;31&nbsp;39&nbsp;47&nbsp;55&nbsp;63</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035662">//&nbsp;5&nbsp;13&nbsp;21&nbsp;29&nbsp;37&nbsp;45&nbsp;53&nbsp;61</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035689">//&nbsp;3&nbsp;11&nbsp;19&nbsp;27&nbsp;35&nbsp;43&nbsp;51&nbsp;59</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035716">//&nbsp;1&nbsp;&nbsp;9&nbsp;17&nbsp;25&nbsp;33&nbsp;41&nbsp;49&nbsp;57</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4035743">return</span>&nbsp;<span class="ident" id="4035750">block</span><br>
<span class="lineno"></span><span class="op" id="4035756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4035759">//&nbsp;permuteInitialBlock&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;permutation&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="4035823">//&nbsp;by&nbsp;finalPermutation.</span><br>
<span class="lineno"></span><span class="keyword" id="4035847">func</span>&nbsp;<span class="ident" id="4035852">permuteFinalBlock</span><span class="op" id="4035869">(</span><span class="ident" id="4035870">block</span>&nbsp;<span class="ident" id="4035876">uint64</span><span class="op" id="4035882">)</span>&nbsp;<span class="ident" id="4035884">uint64</span>&nbsp;<span class="op" id="4035891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035894">//&nbsp;Perform&nbsp;the&nbsp;same&nbsp;bit&nbsp;exchanges&nbsp;as&nbsp;permuteInitialBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4035952">//&nbsp;but&nbsp;in&nbsp;reverse&nbsp;order.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4035978">b1</span>&nbsp;<span class="op" id="4035981">:=</span>&nbsp;<span class="ident" id="4035984">block</span>&nbsp;<span class="op" id="4035990">&amp;</span>&nbsp;<span class="num" id="4035992">0xaaaaaaaa55555555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036012">block</span>&nbsp;<span class="op" id="4036018">^=</span>&nbsp;<span class="ident" id="4036021">b1</span>&nbsp;<span class="op" id="4036024">^</span>&nbsp;<span class="ident" id="4036026">b1</span><span class="op" id="4036028">&gt;&gt;</span><span class="num" id="4036030">33</span>&nbsp;<span class="op" id="4036033">^</span>&nbsp;<span class="ident" id="4036035">b1</span><span class="op" id="4036037">&lt;&lt;</span><span class="num" id="4036039">33</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036044">b1</span>&nbsp;<span class="op" id="4036047">=</span>&nbsp;<span class="ident" id="4036049">block</span>&nbsp;<span class="op" id="4036055">&amp;</span>&nbsp;<span class="num" id="4036057">0x3300330033003300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036077">b2</span>&nbsp;<span class="op" id="4036080">:=</span>&nbsp;<span class="ident" id="4036083">block</span>&nbsp;<span class="op" id="4036089">&amp;</span>&nbsp;<span class="num" id="4036091">0x00cc00cc00cc00cc</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036111">block</span>&nbsp;<span class="op" id="4036117">^=</span>&nbsp;<span class="ident" id="4036120">b1</span>&nbsp;<span class="op" id="4036123">^</span>&nbsp;<span class="ident" id="4036125">b2</span>&nbsp;<span class="op" id="4036128">^</span>&nbsp;<span class="ident" id="4036130">b1</span><span class="op" id="4036132">&gt;&gt;</span><span class="num" id="4036134">6</span>&nbsp;<span class="op" id="4036136">^</span>&nbsp;<span class="ident" id="4036138">b2</span><span class="op" id="4036140">&lt;&lt;</span><span class="num" id="4036142">6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036146">b1</span>&nbsp;<span class="op" id="4036149">=</span>&nbsp;<span class="ident" id="4036151">block</span>&nbsp;<span class="op" id="4036157">&amp;</span>&nbsp;<span class="num" id="4036159">0x0f0f00000f0f0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036179">b2</span>&nbsp;<span class="op" id="4036182">=</span>&nbsp;<span class="ident" id="4036184">block</span>&nbsp;<span class="op" id="4036190">&amp;</span>&nbsp;<span class="num" id="4036192">0x0000f0f00000f0f0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036212">block</span>&nbsp;<span class="op" id="4036218">^=</span>&nbsp;<span class="ident" id="4036221">b1</span>&nbsp;<span class="op" id="4036224">^</span>&nbsp;<span class="ident" id="4036226">b2</span>&nbsp;<span class="op" id="4036229">^</span>&nbsp;<span class="ident" id="4036231">b1</span><span class="op" id="4036233">&gt;&gt;</span><span class="num" id="4036235">12</span>&nbsp;<span class="op" id="4036238">^</span>&nbsp;<span class="ident" id="4036240">b2</span><span class="op" id="4036242">&lt;&lt;</span><span class="num" id="4036244">12</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036249">b1</span>&nbsp;<span class="op" id="4036252">=</span>&nbsp;<span class="ident" id="4036254">block</span>&nbsp;<span class="op" id="4036260">&gt;&gt;</span>&nbsp;<span class="num" id="4036263">32</span>&nbsp;<span class="op" id="4036266">&amp;</span>&nbsp;<span class="num" id="4036268">0xff00ff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036278">b2</span>&nbsp;<span class="op" id="4036281">=</span>&nbsp;<span class="op" id="4036283">(</span><span class="ident" id="4036284">block</span>&nbsp;<span class="op" id="4036290">&amp;</span>&nbsp;<span class="num" id="4036292">0xff00ff00</span><span class="op" id="4036302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036305">block</span>&nbsp;<span class="op" id="4036311">^=</span>&nbsp;<span class="ident" id="4036314">b1</span><span class="op" id="4036316">&lt;&lt;</span><span class="num" id="4036318">32</span>&nbsp;<span class="op" id="4036321">^</span>&nbsp;<span class="ident" id="4036323">b2</span>&nbsp;<span class="op" id="4036326">^</span>&nbsp;<span class="ident" id="4036328">b1</span><span class="op" id="4036330">&lt;&lt;</span><span class="num" id="4036332">8</span>&nbsp;<span class="op" id="4036334">^</span>&nbsp;<span class="ident" id="4036336">b2</span><span class="op" id="4036338">&lt;&lt;</span><span class="num" id="4036340">24</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036345">b1</span>&nbsp;<span class="op" id="4036348">=</span>&nbsp;<span class="ident" id="4036350">block</span>&nbsp;<span class="op" id="4036356">&gt;&gt;</span>&nbsp;<span class="num" id="4036359">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036363">b2</span>&nbsp;<span class="op" id="4036366">=</span>&nbsp;<span class="ident" id="4036368">block</span>&nbsp;<span class="op" id="4036374">&lt;&lt;</span>&nbsp;<span class="num" id="4036377">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036381">block</span>&nbsp;<span class="op" id="4036387">^=</span>&nbsp;<span class="ident" id="4036390">b1</span>&nbsp;<span class="op" id="4036393">^</span>&nbsp;<span class="ident" id="4036395">b2</span>&nbsp;<span class="op" id="4036398">^</span>&nbsp;<span class="ident" id="4036400">b1</span><span class="op" id="4036402">&lt;&lt;</span><span class="num" id="4036404">48</span>&nbsp;<span class="op" id="4036407">^</span>&nbsp;<span class="ident" id="4036409">b2</span><span class="op" id="4036411">&gt;&gt;</span><span class="num" id="4036413">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036417">return</span>&nbsp;<span class="ident" id="4036424">block</span><br>
<span class="lineno"></span><span class="op" id="4036430">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="4036433">//&nbsp;creates&nbsp;16&nbsp;28-bit&nbsp;blocks&nbsp;rotated&nbsp;according</span><br>
<span class="lineno"></span><span class="comment" id="4036479">//&nbsp;to&nbsp;the&nbsp;rotation&nbsp;schedule</span><br>
<span class="lineno"></span><span class="keyword" id="4036507">func</span>&nbsp;<span class="ident" id="4036512">ksRotate</span><span class="op" id="4036520">(</span><span class="ident" id="4036521">in</span>&nbsp;<span class="builtintype" id="4036524">uint32</span><span class="op" id="4036530">)</span>&nbsp;<span class="op" id="4036532">(</span><span class="ident" id="4036533">out</span>&nbsp;<span class="op" id="4036537">[</span><span class="op" id="4036538">]</span><span class="builtintype" id="4036539">uint32</span><span class="op" id="4036545">)</span>&nbsp;<span class="op" id="4036547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036550">out</span>&nbsp;<span class="op" id="4036554">=</span>&nbsp;<span class="builtinfunc" id="4036556">make</span><span class="op" id="4036560">(</span><span class="op" id="4036561">[</span><span class="op" id="4036562">]</span><span class="builtintype" id="4036563">uint32</span><span class="op" id="4036569">,</span>&nbsp;<span class="num" id="4036571">16</span><span class="op" id="4036573">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036576">last</span>&nbsp;<span class="op" id="4036581">:=</span>&nbsp;<span class="ident" id="4036584">in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036588">for</span>&nbsp;<span class="ident" id="4036592">i</span>&nbsp;<span class="op" id="4036594">:=</span>&nbsp;<span class="num" id="4036597">0</span><span class="op" id="4036598">;</span>&nbsp;<span class="ident" id="4036600">i</span>&nbsp;<span class="op" id="4036602">&lt;</span>&nbsp;<span class="num" id="4036604">16</span><span class="op" id="4036606">;</span>&nbsp;<span class="ident" id="4036608">i</span><span class="op" id="4036609">++</span>&nbsp;<span class="op" id="4036612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4036616">//&nbsp;28-bit&nbsp;circular&nbsp;left&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036648">left</span>&nbsp;<span class="op" id="4036653">:=</span>&nbsp;<span class="op" id="4036656">(</span><span class="ident" id="4036657">last</span>&nbsp;<span class="op" id="4036662">&lt;&lt;</span>&nbsp;<span class="op" id="4036665">(</span><span class="num" id="4036666">4</span>&nbsp;<span class="op" id="4036668">+</span>&nbsp;<span class="ident" id="4036670">ksRotations</span><span class="op" id="4036681">[</span><span class="ident" id="4036682">i</span><span class="op" id="4036683">]</span><span class="op" id="4036684">)</span><span class="op" id="4036685">)</span>&nbsp;<span class="op" id="4036687">&gt;&gt;</span>&nbsp;<span class="num" id="4036690">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036694">right</span>&nbsp;<span class="op" id="4036700">:=</span>&nbsp;<span class="op" id="4036703">(</span><span class="ident" id="4036704">last</span>&nbsp;<span class="op" id="4036709">&lt;&lt;</span>&nbsp;<span class="num" id="4036712">4</span><span class="op" id="4036713">)</span>&nbsp;<span class="op" id="4036715">&gt;&gt;</span>&nbsp;<span class="op" id="4036718">(</span><span class="num" id="4036719">32</span>&nbsp;<span class="op" id="4036722">-</span>&nbsp;<span class="ident" id="4036724">ksRotations</span><span class="op" id="4036735">[</span><span class="ident" id="4036736">i</span><span class="op" id="4036737">]</span><span class="op" id="4036738">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036742">out</span><span class="op" id="4036745">[</span><span class="ident" id="4036746">i</span><span class="op" id="4036747">]</span>&nbsp;<span class="op" id="4036749">=</span>&nbsp;<span class="ident" id="4036751">left</span>&nbsp;<span class="op" id="4036756">|</span>&nbsp;<span class="ident" id="4036758">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036766">last</span>&nbsp;<span class="op" id="4036771">=</span>&nbsp;<span class="ident" id="4036773">out</span><span class="op" id="4036776">[</span><span class="ident" id="4036777">i</span><span class="op" id="4036778">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4036781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036784">return</span><br>
<span class="lineno"></span><span class="op" id="4036791">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="4036794">//&nbsp;creates&nbsp;16&nbsp;56-bit&nbsp;subkeys&nbsp;from&nbsp;the&nbsp;original&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="4036845">func</span>&nbsp;<span class="op" id="4036850">(</span><span class="ident" id="4036851">c</span>&nbsp;<span class="op" id="4036853">*</span><span class="ident" id="4036854">desCipher</span><span class="op" id="4036863">)</span>&nbsp;<span class="ident" id="4036865">generateSubkeys</span><span class="op" id="4036880">(</span><span class="ident" id="4036881">keyBytes</span>&nbsp;<span class="op" id="4036890">[</span><span class="op" id="4036891">]</span><span class="builtintype" id="4036892">byte</span><span class="op" id="4036896">)</span>&nbsp;<span class="op" id="4036898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4036901">//&nbsp;apply&nbsp;PC1&nbsp;permutation&nbsp;to&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036934">key</span>&nbsp;<span class="op" id="4036938">:=</span>&nbsp;<span class="ident" id="4036941">binary</span><span class="op" id="4036947">.</span><span class="ident" id="4036948">BigEndian</span><span class="op" id="4036957">.</span><span class="ident" id="4036958">Uint64</span><span class="op" id="4036964">(</span><span class="ident" id="4036965">keyBytes</span><span class="op" id="4036973">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036976">permutedKey</span>&nbsp;<span class="op" id="4036988">:=</span>&nbsp;<span class="ident" id="4036991">permuteBlock</span><span class="op" id="4037003">(</span><span class="ident" id="4037004">key</span><span class="op" id="4037007">,</span>&nbsp;<span class="ident" id="4037009">permutedChoice1</span><span class="op" id="4037024">[</span><span class="op" id="4037025">:</span><span class="op" id="4037026">]</span><span class="op" id="4037027">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4037031">//&nbsp;rotate&nbsp;halves&nbsp;of&nbsp;permuted&nbsp;key&nbsp;according&nbsp;to&nbsp;the&nbsp;rotation&nbsp;schedule</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037100">leftRotations</span>&nbsp;<span class="op" id="4037114">:=</span>&nbsp;<span class="ident" id="4037117">ksRotate</span><span class="op" id="4037125">(</span><span class="builtintype" id="4037126">uint32</span><span class="op" id="4037132">(</span><span class="ident" id="4037133">permutedKey</span>&nbsp;<span class="op" id="4037145">&gt;&gt;</span>&nbsp;<span class="num" id="4037148">28</span><span class="op" id="4037150">)</span><span class="op" id="4037151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037154">rightRotations</span>&nbsp;<span class="op" id="4037169">:=</span>&nbsp;<span class="ident" id="4037172">ksRotate</span><span class="op" id="4037180">(</span><span class="builtintype" id="4037181">uint32</span><span class="op" id="4037187">(</span><span class="ident" id="4037188">permutedKey</span><span class="op" id="4037199">&lt;&lt;</span><span class="num" id="4037201">4</span><span class="op" id="4037202">)</span>&nbsp;<span class="op" id="4037204">&gt;&gt;</span>&nbsp;<span class="num" id="4037207">4</span><span class="op" id="4037208">)</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4037212">//&nbsp;generate&nbsp;subkeys</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037233">for</span>&nbsp;<span class="ident" id="4037237">i</span>&nbsp;<span class="op" id="4037239">:=</span>&nbsp;<span class="num" id="4037242">0</span><span class="op" id="4037243">;</span>&nbsp;<span class="ident" id="4037245">i</span>&nbsp;<span class="op" id="4037247">&lt;</span>&nbsp;<span class="num" id="4037249">16</span><span class="op" id="4037251">;</span>&nbsp;<span class="ident" id="4037253">i</span><span class="op" id="4037254">++</span>&nbsp;<span class="op" id="4037257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4037261">//&nbsp;combine&nbsp;halves&nbsp;to&nbsp;form&nbsp;56-bit&nbsp;input&nbsp;to&nbsp;PC2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037309">pc2Input</span>&nbsp;<span class="op" id="4037318">:=</span>&nbsp;<span class="ident" id="4037321">uint64</span><span class="op" id="4037327">(</span><span class="ident" id="4037328">leftRotations</span><span class="op" id="4037341">[</span><span class="ident" id="4037342">i</span><span class="op" id="4037343">]</span><span class="op" id="4037344">)</span><span class="op" id="4037345">&lt;&lt;</span><span class="num" id="4037347">28</span>&nbsp;<span class="op" id="4037350">|</span>&nbsp;<span class="ident" id="4037352">uint64</span><span class="op" id="4037358">(</span><span class="ident" id="4037359">rightRotations</span><span class="op" id="4037373">[</span><span class="ident" id="4037374">i</span><span class="op" id="4037375">]</span><span class="op" id="4037376">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4037380">//&nbsp;apply&nbsp;PC2&nbsp;permutation&nbsp;to&nbsp;7&nbsp;byte&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037423">c</span><span class="op" id="4037424">.</span><span class="ident" id="4037425">subkeys</span><span class="op" id="4037432">[</span><span class="ident" id="4037433">i</span><span class="op" id="4037434">]</span>&nbsp;<span class="op" id="4037436">=</span>&nbsp;<span class="ident" id="4037438">permuteBlock</span><span class="op" id="4037450">(</span><span class="ident" id="4037451">pc2Input</span><span class="op" id="4037459">,</span>&nbsp;<span class="ident" id="4037461">permutedChoice2</span><span class="op" id="4037476">[</span><span class="op" id="4037477">:</span><span class="op" id="4037478">]</span><span class="op" id="4037479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037482">}</span><br>
<span class="lineno"></span><span class="op" id="4037484">}</span>
</div>
</body>
</html>
