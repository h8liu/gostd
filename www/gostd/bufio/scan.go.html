<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bufio</h2>
<ul>
<li><a href="/gostd/bufio/bufio.go.html">bufio.go</a></li>
<li><a href="/gostd/bufio/bufio_test.go.html">bufio_test.go</a></li>
<li><a href="/gostd/bufio/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bufio/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bufio/scan.go.html" class="current">scan.go</a></li>
<li><a href="/gostd/bufio/scan_test.go.html">scan_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2859719">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2859774">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2859828">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2859879">package</span>&nbsp;<span class="ident" id="2859887">bufio</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2859894">import</span>&nbsp;<span class="op" id="2859901">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2859904">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2859913">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2859923">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2859929">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2859944">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2859947">//&nbsp;Scanner&nbsp;provides&nbsp;a&nbsp;convenient&nbsp;interface&nbsp;for&nbsp;reading&nbsp;data&nbsp;such&nbsp;as</span><br>
<span class="lineno">15</span><span class="comment" id="2860015">//&nbsp;a&nbsp;file&nbsp;of&nbsp;newline-delimited&nbsp;lines&nbsp;of&nbsp;text.&nbsp;Successive&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2860081">//&nbsp;the&nbsp;Scan&nbsp;method&nbsp;will&nbsp;step&nbsp;through&nbsp;the&nbsp;&#39;tokens&#39;&nbsp;of&nbsp;a&nbsp;file,&nbsp;skipping</span><br>
<span class="lineno"></span><span class="comment" id="2860151">//&nbsp;the&nbsp;bytes&nbsp;between&nbsp;the&nbsp;tokens.&nbsp;The&nbsp;specification&nbsp;of&nbsp;a&nbsp;token&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2860216">//&nbsp;defined&nbsp;by&nbsp;a&nbsp;split&nbsp;function&nbsp;of&nbsp;type&nbsp;SplitFunc;&nbsp;the&nbsp;default&nbsp;split</span><br>
<span class="lineno"></span><span class="comment" id="2860284">//&nbsp;function&nbsp;breaks&nbsp;the&nbsp;input&nbsp;into&nbsp;lines&nbsp;with&nbsp;line&nbsp;termination&nbsp;stripped.&nbsp;Split</span><br>
<span class="lineno">20</span><span class="comment" id="2860362">//&nbsp;functions&nbsp;are&nbsp;defined&nbsp;in&nbsp;this&nbsp;package&nbsp;for&nbsp;scanning&nbsp;a&nbsp;file&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="2860428">//&nbsp;lines,&nbsp;bytes,&nbsp;UTF-8-encoded&nbsp;runes,&nbsp;and&nbsp;space-delimited&nbsp;words.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="2860497">//&nbsp;client&nbsp;may&nbsp;instead&nbsp;provide&nbsp;a&nbsp;custom&nbsp;split&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="2860552">//</span><br>
<span class="lineno"></span><span class="comment" id="2860555">//&nbsp;Scanning&nbsp;stops&nbsp;unrecoverably&nbsp;at&nbsp;EOF,&nbsp;the&nbsp;first&nbsp;I/O&nbsp;error,&nbsp;or&nbsp;a&nbsp;token&nbsp;too</span><br>
<span class="lineno">25</span><span class="comment" id="2860631">//&nbsp;large&nbsp;to&nbsp;fit&nbsp;in&nbsp;the&nbsp;buffer.&nbsp;When&nbsp;a&nbsp;scan&nbsp;stops,&nbsp;the&nbsp;reader&nbsp;may&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="2860701">//&nbsp;advanced&nbsp;arbitrarily&nbsp;far&nbsp;past&nbsp;the&nbsp;last&nbsp;token.&nbsp;Programs&nbsp;that&nbsp;need&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="2860774">//&nbsp;control&nbsp;over&nbsp;error&nbsp;handling&nbsp;or&nbsp;large&nbsp;tokens,&nbsp;or&nbsp;must&nbsp;run&nbsp;sequential&nbsp;scans</span><br>
<span class="lineno"></span><span class="comment" id="2860851">//&nbsp;on&nbsp;a&nbsp;reader,&nbsp;should&nbsp;use&nbsp;bufio.Reader&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="2860900">//</span><br>
<span class="lineno">30</span><span class="keyword" id="2860903">type</span>&nbsp;<span class="ident" id="2860908">Scanner</span>&nbsp;<span class="keyword" id="2860916">struct</span>&nbsp;<span class="op" id="2860923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2860926">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2860939">io</span><span class="op" id="2860941">.</span><span class="ident" id="2860942">Reader</span>&nbsp;<span class="comment" id="2860949">//&nbsp;The&nbsp;reader&nbsp;provided&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2860988">split</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2861001">SplitFunc</span>&nbsp;<span class="comment" id="2861011">//&nbsp;The&nbsp;function&nbsp;to&nbsp;split&nbsp;the&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2861049">maxTokenSize</span>&nbsp;<span class="builtintype" id="2861062">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2861072">//&nbsp;Maximum&nbsp;size&nbsp;of&nbsp;a&nbsp;token;&nbsp;modified&nbsp;by&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2861120">token</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2861133">[</span><span class="op" id="2861134">]</span><span class="builtintype" id="2861135">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2861143">//&nbsp;Last&nbsp;token&nbsp;returned&nbsp;by&nbsp;split.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2861177">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2861190">[</span><span class="op" id="2861191">]</span><span class="builtintype" id="2861192">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2861200">//&nbsp;Buffer&nbsp;used&nbsp;as&nbsp;argument&nbsp;to&nbsp;split.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2861238">start</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2861251">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2861261">//&nbsp;First&nbsp;non-processed&nbsp;byte&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2861298">end</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2861311">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2861321">//&nbsp;End&nbsp;of&nbsp;data&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2861345">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2861358">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2861368">//&nbsp;Sticky&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2861386">empties</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2861399">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2861409">//&nbsp;Count&nbsp;of&nbsp;successive&nbsp;empty&nbsp;tokens.</span><br>
<span class="lineno">40</span><span class="op" id="2861446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2861449">//&nbsp;SplitFunc&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;the&nbsp;split&nbsp;function&nbsp;used&nbsp;to&nbsp;tokenize&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2861522">//&nbsp;input.&nbsp;The&nbsp;arguments&nbsp;are&nbsp;an&nbsp;initial&nbsp;substring&nbsp;of&nbsp;the&nbsp;remaining&nbsp;unprocessed</span><br>
<span class="lineno"></span><span class="comment" id="2861600">//&nbsp;data&nbsp;and&nbsp;a&nbsp;flag,&nbsp;atEOF,&nbsp;that&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Reader&nbsp;has&nbsp;no&nbsp;more&nbsp;data</span><br>
<span class="lineno">45</span><span class="comment" id="2861676">//&nbsp;to&nbsp;give.&nbsp;The&nbsp;return&nbsp;values&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;advance&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="2861751">//&nbsp;and&nbsp;the&nbsp;next&nbsp;token&nbsp;to&nbsp;return&nbsp;to&nbsp;the&nbsp;user,&nbsp;plus&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2861826">//&nbsp;data&nbsp;does&nbsp;not&nbsp;yet&nbsp;hold&nbsp;a&nbsp;complete&nbsp;token,&nbsp;for&nbsp;instance&nbsp;if&nbsp;it&nbsp;has&nbsp;no&nbsp;newline</span><br>
<span class="lineno"></span><span class="comment" id="2861904">//&nbsp;while&nbsp;scanning&nbsp;lines,&nbsp;SplitFunc&nbsp;can&nbsp;return&nbsp;(0,&nbsp;nil,&nbsp;nil)&nbsp;to&nbsp;signal&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2861978">//&nbsp;Scanner&nbsp;to&nbsp;read&nbsp;more&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;and&nbsp;try&nbsp;again&nbsp;with&nbsp;a&nbsp;longer&nbsp;slice</span><br>
<span class="lineno">50</span><span class="comment" id="2862056">//&nbsp;starting&nbsp;at&nbsp;the&nbsp;same&nbsp;point&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="2862100">//</span><br>
<span class="lineno"></span><span class="comment" id="2862103">//&nbsp;If&nbsp;the&nbsp;returned&nbsp;error&nbsp;is&nbsp;non-nil,&nbsp;scanning&nbsp;stops&nbsp;and&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="2862169">//&nbsp;is&nbsp;returned&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="2862199">//</span><br>
<span class="lineno">55</span><span class="comment" id="2862202">//&nbsp;The&nbsp;function&nbsp;is&nbsp;never&nbsp;called&nbsp;with&nbsp;an&nbsp;empty&nbsp;data&nbsp;slice&nbsp;unless&nbsp;atEOF</span><br>
<span class="lineno"></span><span class="comment" id="2862272">//&nbsp;is&nbsp;true.&nbsp;If&nbsp;atEOF&nbsp;is&nbsp;true,&nbsp;however,&nbsp;data&nbsp;may&nbsp;be&nbsp;non-empty&nbsp;and,</span><br>
<span class="lineno"></span><span class="comment" id="2862338">//&nbsp;as&nbsp;always,&nbsp;holds&nbsp;unprocessed&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="2862376">type</span>&nbsp;<span class="ident" id="2862381">SplitFunc</span>&nbsp;<span class="keyword" id="2862391">func</span><span class="op" id="2862395">(</span><span class="ident" id="2862396">data</span>&nbsp;<span class="op" id="2862401">[</span><span class="op" id="2862402">]</span><span class="builtintype" id="2862403">byte</span><span class="op" id="2862407">,</span>&nbsp;<span class="ident" id="2862409">atEOF</span>&nbsp;<span class="builtintype" id="2862415">bool</span><span class="op" id="2862419">)</span>&nbsp;<span class="op" id="2862421">(</span><span class="ident" id="2862422">advance</span>&nbsp;<span class="builtintype" id="2862430">int</span><span class="op" id="2862433">,</span>&nbsp;<span class="ident" id="2862435">token</span>&nbsp;<span class="op" id="2862441">[</span><span class="op" id="2862442">]</span><span class="builtintype" id="2862443">byte</span><span class="op" id="2862447">,</span>&nbsp;<span class="ident" id="2862449">err</span>&nbsp;<span class="builtintype" id="2862453">error</span><span class="op" id="2862458">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="2862461">//&nbsp;Errors&nbsp;returned&nbsp;by&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="keyword" id="2862492">var</span>&nbsp;<span class="op" id="2862496">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2862499">ErrTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2862518">=</span>&nbsp;<span class="ident" id="2862520">errors</span><span class="op" id="2862526">.</span><span class="ident" id="2862527">New</span><span class="op" id="2862530">(</span><span class="string" id="2862531">&#34;bufio.Scanner:&nbsp;token&nbsp;too&nbsp;long&#34;</span><span class="op" id="2862562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2862565">ErrNegativeAdvance</span>&nbsp;<span class="op" id="2862584">=</span>&nbsp;<span class="ident" id="2862586">errors</span><span class="op" id="2862592">.</span><span class="ident" id="2862593">New</span><span class="op" id="2862596">(</span><span class="string" id="2862597">&#34;bufio.Scanner:&nbsp;SplitFunc&nbsp;returns&nbsp;negative&nbsp;advance&nbsp;count&#34;</span><span class="op" id="2862654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2862657">ErrAdvanceTooFar</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2862676">=</span>&nbsp;<span class="ident" id="2862678">errors</span><span class="op" id="2862684">.</span><span class="ident" id="2862685">New</span><span class="op" id="2862688">(</span><span class="string" id="2862689">&#34;bufio.Scanner:&nbsp;SplitFunc&nbsp;returns&nbsp;advance&nbsp;count&nbsp;beyond&nbsp;input&#34;</span><span class="op" id="2862750">)</span><br>
<span class="lineno">65</span><span class="op" id="2862752">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2862755">const</span>&nbsp;<span class="op" id="2862761">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2862764">//&nbsp;MaxScanTokenSize&nbsp;is&nbsp;the&nbsp;maximum&nbsp;size&nbsp;used&nbsp;to&nbsp;buffer&nbsp;a&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2862829">//&nbsp;The&nbsp;actual&nbsp;maximum&nbsp;token&nbsp;size&nbsp;may&nbsp;be&nbsp;smaller&nbsp;as&nbsp;the&nbsp;buffer</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2862892">//&nbsp;may&nbsp;need&nbsp;to&nbsp;include,&nbsp;for&nbsp;instance,&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2862942">MaxScanTokenSize</span>&nbsp;<span class="op" id="2862959">=</span>&nbsp;<span class="num" id="2862961">64</span>&nbsp;<span class="op" id="2862964">*</span>&nbsp;<span class="num" id="2862966">1024</span><br>
<span class="lineno"></span><span class="op" id="2862971">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2862974">//&nbsp;NewScanner&nbsp;returns&nbsp;a&nbsp;new&nbsp;Scanner&nbsp;to&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno">75</span><span class="comment" id="2863026">//&nbsp;The&nbsp;split&nbsp;function&nbsp;defaults&nbsp;to&nbsp;ScanLines.</span><br>
<span class="lineno"></span><span class="keyword" id="2863071">func</span>&nbsp;<span class="ident" id="2863076">NewScanner</span><span class="op" id="2863086">(</span><span class="ident" id="2863087">r</span>&nbsp;<span class="ident" id="2863089">io</span><span class="op" id="2863091">.</span><span class="ident" id="2863092">Reader</span><span class="op" id="2863098">)</span>&nbsp;<span class="op" id="2863100">*</span><span class="ident" id="2863101">Scanner</span>&nbsp;<span class="op" id="2863109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2863112">return</span>&nbsp;<span class="op" id="2863119">&amp;</span><span class="ident" id="2863120">Scanner</span><span class="op" id="2863127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2863131">r</span><span class="op" id="2863132">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2863145">r</span><span class="op" id="2863146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2863150">split</span><span class="op" id="2863155">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2863164">ScanLines</span><span class="op" id="2863173">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2863177">maxTokenSize</span><span class="op" id="2863189">:</span>&nbsp;<span class="ident" id="2863191">MaxScanTokenSize</span><span class="op" id="2863207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2863211">buf</span><span class="op" id="2863214">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2863225">make</span><span class="op" id="2863229">(</span><span class="op" id="2863230">[</span><span class="op" id="2863231">]</span><span class="builtintype" id="2863232">byte</span><span class="op" id="2863236">,</span>&nbsp;<span class="num" id="2863238">4096</span><span class="op" id="2863242">)</span><span class="op" id="2863243">,</span>&nbsp;<span class="comment" id="2863245">//&nbsp;Plausible&nbsp;starting&nbsp;size;&nbsp;needn&#39;t&nbsp;be&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2863292">}</span><br>
<span class="lineno"></span><span class="op" id="2863294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="2863297">//&nbsp;Err&nbsp;returns&nbsp;the&nbsp;first&nbsp;non-EOF&nbsp;error&nbsp;that&nbsp;was&nbsp;encountered&nbsp;by&nbsp;the&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="keyword" id="2863373">func</span>&nbsp;<span class="op" id="2863378">(</span><span class="ident" id="2863379">s</span>&nbsp;<span class="op" id="2863381">*</span><span class="ident" id="2863382">Scanner</span><span class="op" id="2863389">)</span>&nbsp;<span class="ident" id="2863391">Err</span><span class="op" id="2863394">(</span><span class="op" id="2863395">)</span>&nbsp;<span class="builtintype" id="2863397">error</span>&nbsp;<span class="op" id="2863403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2863406">if</span>&nbsp;<span class="ident" id="2863409">s</span><span class="op" id="2863410">.</span><span class="ident" id="2863411">err</span>&nbsp;<span class="op" id="2863415">==</span>&nbsp;<span class="ident" id="2863418">io</span><span class="op" id="2863420">.</span><span class="ident" id="2863421">EOF</span>&nbsp;<span class="op" id="2863425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2863429">return</span>&nbsp;<span class="ident" id="2863436">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2863441">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2863444">return</span>&nbsp;<span class="ident" id="2863451">s</span><span class="op" id="2863452">.</span><span class="ident" id="2863453">err</span><br>
<span class="lineno"></span><span class="op" id="2863457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2863460">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;most&nbsp;recent&nbsp;token&nbsp;generated&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Scan.</span><br>
<span class="lineno"></span><span class="comment" id="2863528">//&nbsp;The&nbsp;underlying&nbsp;array&nbsp;may&nbsp;point&nbsp;to&nbsp;data&nbsp;that&nbsp;will&nbsp;be&nbsp;overwritten</span><br>
<span class="lineno">95</span><span class="comment" id="2863595">//&nbsp;by&nbsp;a&nbsp;subsequent&nbsp;call&nbsp;to&nbsp;Scan.&nbsp;It&nbsp;does&nbsp;no&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="2863651">func</span>&nbsp;<span class="op" id="2863656">(</span><span class="ident" id="2863657">s</span>&nbsp;<span class="op" id="2863659">*</span><span class="ident" id="2863660">Scanner</span><span class="op" id="2863667">)</span>&nbsp;<span class="ident" id="2863669">Bytes</span><span class="op" id="2863674">(</span><span class="op" id="2863675">)</span>&nbsp;<span class="op" id="2863677">[</span><span class="op" id="2863678">]</span><span class="builtintype" id="2863679">byte</span>&nbsp;<span class="op" id="2863684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2863687">return</span>&nbsp;<span class="ident" id="2863694">s</span><span class="op" id="2863695">.</span><span class="ident" id="2863696">token</span><br>
<span class="lineno"></span><span class="op" id="2863702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2863705">//&nbsp;Text&nbsp;returns&nbsp;the&nbsp;most&nbsp;recent&nbsp;token&nbsp;generated&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Scan</span><br>
<span class="lineno"></span><span class="comment" id="2863771">//&nbsp;as&nbsp;a&nbsp;newly&nbsp;allocated&nbsp;string&nbsp;holding&nbsp;its&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="2863821">func</span>&nbsp;<span class="op" id="2863826">(</span><span class="ident" id="2863827">s</span>&nbsp;<span class="op" id="2863829">*</span><span class="ident" id="2863830">Scanner</span><span class="op" id="2863837">)</span>&nbsp;<span class="ident" id="2863839">Text</span><span class="op" id="2863843">(</span><span class="op" id="2863844">)</span>&nbsp;<span class="builtintype" id="2863846">string</span>&nbsp;<span class="op" id="2863853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2863856">return</span>&nbsp;<span class="builtintype" id="2863863">string</span><span class="op" id="2863869">(</span><span class="ident" id="2863870">s</span><span class="op" id="2863871">.</span><span class="ident" id="2863872">token</span><span class="op" id="2863877">)</span><br>
<span class="lineno"></span><span class="op" id="2863879">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="2863882">//&nbsp;Scan&nbsp;advances&nbsp;the&nbsp;Scanner&nbsp;to&nbsp;the&nbsp;next&nbsp;token,&nbsp;which&nbsp;will&nbsp;then&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="2863949">//&nbsp;available&nbsp;through&nbsp;the&nbsp;Bytes&nbsp;or&nbsp;Text&nbsp;method.&nbsp;It&nbsp;returns&nbsp;false&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2864022">//&nbsp;scan&nbsp;stops,&nbsp;either&nbsp;by&nbsp;reaching&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;or&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="2864090">//&nbsp;After&nbsp;Scan&nbsp;returns&nbsp;false,&nbsp;the&nbsp;Err&nbsp;method&nbsp;will&nbsp;return&nbsp;any&nbsp;error&nbsp;that</span><br>
<span class="lineno">110</span><span class="comment" id="2864161">//&nbsp;occurred&nbsp;during&nbsp;scanning,&nbsp;except&nbsp;that&nbsp;if&nbsp;it&nbsp;was&nbsp;io.EOF,&nbsp;Err</span><br>
<span class="lineno"></span><span class="comment" id="2864224">//&nbsp;will&nbsp;return&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="2864244">//&nbsp;Split&nbsp;panics&nbsp;if&nbsp;the&nbsp;split&nbsp;function&nbsp;returns&nbsp;100&nbsp;empty&nbsp;tokens&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="2864315">//&nbsp;advancing&nbsp;the&nbsp;input.&nbsp;This&nbsp;is&nbsp;a&nbsp;common&nbsp;error&nbsp;mode&nbsp;for&nbsp;scanners.</span><br>
<span class="lineno"></span><span class="keyword" id="2864381">func</span>&nbsp;<span class="op" id="2864386">(</span><span class="ident" id="2864387">s</span>&nbsp;<span class="op" id="2864389">*</span><span class="ident" id="2864390">Scanner</span><span class="op" id="2864397">)</span>&nbsp;<span class="ident" id="2864399">Scan</span><span class="op" id="2864403">(</span><span class="op" id="2864404">)</span>&nbsp;<span class="builtintype" id="2864406">bool</span>&nbsp;<span class="op" id="2864411">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2864414">//&nbsp;Loop&nbsp;until&nbsp;we&nbsp;have&nbsp;a&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2864446">for</span>&nbsp;<span class="op" id="2864450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2864454">//&nbsp;See&nbsp;if&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;token&nbsp;with&nbsp;what&nbsp;we&nbsp;already&nbsp;have.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2864512">//&nbsp;If&nbsp;we&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;data&nbsp;but&nbsp;have&nbsp;an&nbsp;error,&nbsp;give&nbsp;the&nbsp;split&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2864585">//&nbsp;a&nbsp;chance&nbsp;to&nbsp;recover&nbsp;any&nbsp;remaining,&nbsp;possibly&nbsp;empty&nbsp;token.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2864647">if</span>&nbsp;<span class="ident" id="2864650">s</span><span class="op" id="2864651">.</span><span class="ident" id="2864652">end</span>&nbsp;<span class="op" id="2864656">&gt;</span>&nbsp;<span class="ident" id="2864658">s</span><span class="op" id="2864659">.</span><span class="ident" id="2864660">start</span>&nbsp;<span class="op" id="2864666">||</span>&nbsp;<span class="ident" id="2864669">s</span><span class="op" id="2864670">.</span><span class="ident" id="2864671">err</span>&nbsp;<span class="op" id="2864675">!=</span>&nbsp;<span class="ident" id="2864678">nil</span>&nbsp;<span class="op" id="2864682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2864687">advance</span><span class="op" id="2864694">,</span>&nbsp;<span class="ident" id="2864696">token</span><span class="op" id="2864701">,</span>&nbsp;<span class="ident" id="2864703">err</span>&nbsp;<span class="op" id="2864707">:=</span>&nbsp;<span class="ident" id="2864710">s</span><span class="op" id="2864711">.</span><span class="ident" id="2864712">split</span><span class="op" id="2864717">(</span><span class="ident" id="2864718">s</span><span class="op" id="2864719">.</span><span class="ident" id="2864720">buf</span><span class="op" id="2864723">[</span><span class="ident" id="2864724">s</span><span class="op" id="2864725">.</span><span class="ident" id="2864726">start</span><span class="op" id="2864731">:</span><span class="ident" id="2864732">s</span><span class="op" id="2864733">.</span><span class="ident" id="2864734">end</span><span class="op" id="2864737">]</span><span class="op" id="2864738">,</span>&nbsp;<span class="ident" id="2864740">s</span><span class="op" id="2864741">.</span><span class="ident" id="2864742">err</span>&nbsp;<span class="op" id="2864746">!=</span>&nbsp;<span class="ident" id="2864749">nil</span><span class="op" id="2864752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2864757">if</span>&nbsp;<span class="ident" id="2864760">err</span>&nbsp;<span class="op" id="2864764">!=</span>&nbsp;<span class="ident" id="2864767">nil</span>&nbsp;<span class="op" id="2864771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2864777">s</span><span class="op" id="2864778">.</span><span class="ident" id="2864779">setErr</span><span class="op" id="2864785">(</span><span class="ident" id="2864786">err</span><span class="op" id="2864789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2864795">return</span>&nbsp;<span class="builtintype" id="2864802">false</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2864811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2864816">if</span>&nbsp;<span class="op" id="2864819">!</span><span class="ident" id="2864820">s</span><span class="op" id="2864821">.</span><span class="ident" id="2864822">advance</span><span class="op" id="2864829">(</span><span class="ident" id="2864830">advance</span><span class="op" id="2864837">)</span>&nbsp;<span class="op" id="2864839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2864845">return</span>&nbsp;<span class="builtintype" id="2864852">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2864861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2864866">s</span><span class="op" id="2864867">.</span><span class="ident" id="2864868">token</span>&nbsp;<span class="op" id="2864874">=</span>&nbsp;<span class="ident" id="2864876">token</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2864885">if</span>&nbsp;<span class="ident" id="2864888">token</span>&nbsp;<span class="op" id="2864894">!=</span>&nbsp;<span class="ident" id="2864897">nil</span>&nbsp;<span class="op" id="2864901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2864907">if</span>&nbsp;<span class="ident" id="2864910">s</span><span class="op" id="2864911">.</span><span class="ident" id="2864912">err</span>&nbsp;<span class="op" id="2864916">==</span>&nbsp;<span class="ident" id="2864919">nil</span>&nbsp;<span class="op" id="2864923">||</span>&nbsp;<span class="ident" id="2864926">advance</span>&nbsp;<span class="op" id="2864934">&gt;</span>&nbsp;<span class="num" id="2864936">0</span>&nbsp;<span class="op" id="2864938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2864945">s</span><span class="op" id="2864946">.</span><span class="ident" id="2864947">empties</span>&nbsp;<span class="op" id="2864955">=</span>&nbsp;<span class="num" id="2864957">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2864963">}</span>&nbsp;<span class="keyword" id="2864965">else</span>&nbsp;<span class="op" id="2864970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2864977">//&nbsp;Returning&nbsp;tokens&nbsp;not&nbsp;advancing&nbsp;input&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2865030">s</span><span class="op" id="2865031">.</span><span class="ident" id="2865032">empties</span><span class="op" id="2865039">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2865047">if</span>&nbsp;<span class="ident" id="2865050">s</span><span class="op" id="2865051">.</span><span class="ident" id="2865052">empties</span>&nbsp;<span class="op" id="2865060">&gt;</span>&nbsp;<span class="num" id="2865062">100</span>&nbsp;<span class="op" id="2865066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2865074">panic</span><span class="op" id="2865079">(</span><span class="string" id="2865080">&#34;bufio.Scan:&nbsp;100&nbsp;empty&nbsp;tokens&nbsp;without&nbsp;progressing&#34;</span><span class="op" id="2865130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2865137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2865143">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2865149">return</span>&nbsp;<span class="builtintype" id="2865156">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2865164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2865168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2865172">//&nbsp;We&nbsp;cannot&nbsp;generate&nbsp;a&nbsp;token&nbsp;with&nbsp;what&nbsp;we&nbsp;are&nbsp;holding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2865230">//&nbsp;If&nbsp;we&#39;ve&nbsp;already&nbsp;hit&nbsp;EOF&nbsp;or&nbsp;an&nbsp;I/O&nbsp;error,&nbsp;we&nbsp;are&nbsp;done.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2865290">if</span>&nbsp;<span class="ident" id="2865293">s</span><span class="op" id="2865294">.</span><span class="ident" id="2865295">err</span>&nbsp;<span class="op" id="2865299">!=</span>&nbsp;<span class="ident" id="2865302">nil</span>&nbsp;<span class="op" id="2865306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2865311">//&nbsp;Shut&nbsp;it&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2865331">s</span><span class="op" id="2865332">.</span><span class="ident" id="2865333">start</span>&nbsp;<span class="op" id="2865339">=</span>&nbsp;<span class="num" id="2865341">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2865346">s</span><span class="op" id="2865347">.</span><span class="ident" id="2865348">end</span>&nbsp;<span class="op" id="2865352">=</span>&nbsp;<span class="num" id="2865354">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2865359">return</span>&nbsp;<span class="builtintype" id="2865366">false</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2865374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2865378">//&nbsp;Must&nbsp;read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2865404">//&nbsp;First,&nbsp;shift&nbsp;data&nbsp;to&nbsp;beginning&nbsp;of&nbsp;buffer&nbsp;if&nbsp;there&#39;s&nbsp;lots&nbsp;of&nbsp;empty&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2865481">//&nbsp;or&nbsp;space&nbsp;is&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2865506">if</span>&nbsp;<span class="ident" id="2865509">s</span><span class="op" id="2865510">.</span><span class="ident" id="2865511">start</span>&nbsp;<span class="op" id="2865517">&gt;</span>&nbsp;<span class="num" id="2865519">0</span>&nbsp;<span class="op" id="2865521">&amp;&amp;</span>&nbsp;<span class="op" id="2865524">(</span><span class="ident" id="2865525">s</span><span class="op" id="2865526">.</span><span class="ident" id="2865527">end</span>&nbsp;<span class="op" id="2865531">==</span>&nbsp;<span class="builtinfunc" id="2865534">len</span><span class="op" id="2865537">(</span><span class="ident" id="2865538">s</span><span class="op" id="2865539">.</span><span class="ident" id="2865540">buf</span><span class="op" id="2865543">)</span>&nbsp;<span class="op" id="2865545">||</span>&nbsp;<span class="ident" id="2865548">s</span><span class="op" id="2865549">.</span><span class="ident" id="2865550">start</span>&nbsp;<span class="op" id="2865556">&gt;</span>&nbsp;<span class="builtinfunc" id="2865558">len</span><span class="op" id="2865561">(</span><span class="ident" id="2865562">s</span><span class="op" id="2865563">.</span><span class="ident" id="2865564">buf</span><span class="op" id="2865567">)</span><span class="op" id="2865568">/</span><span class="num" id="2865569">2</span><span class="op" id="2865570">)</span>&nbsp;<span class="op" id="2865572">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2865577">copy</span><span class="op" id="2865581">(</span><span class="ident" id="2865582">s</span><span class="op" id="2865583">.</span><span class="ident" id="2865584">buf</span><span class="op" id="2865587">,</span>&nbsp;<span class="ident" id="2865589">s</span><span class="op" id="2865590">.</span><span class="ident" id="2865591">buf</span><span class="op" id="2865594">[</span><span class="ident" id="2865595">s</span><span class="op" id="2865596">.</span><span class="ident" id="2865597">start</span><span class="op" id="2865602">:</span><span class="ident" id="2865603">s</span><span class="op" id="2865604">.</span><span class="ident" id="2865605">end</span><span class="op" id="2865608">]</span><span class="op" id="2865609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2865614">s</span><span class="op" id="2865615">.</span><span class="ident" id="2865616">end</span>&nbsp;<span class="op" id="2865620">-=</span>&nbsp;<span class="ident" id="2865623">s</span><span class="op" id="2865624">.</span><span class="ident" id="2865625">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2865634">s</span><span class="op" id="2865635">.</span><span class="ident" id="2865636">start</span>&nbsp;<span class="op" id="2865642">=</span>&nbsp;<span class="num" id="2865644">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2865648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2865652">//&nbsp;Is&nbsp;the&nbsp;buffer&nbsp;full?&nbsp;If&nbsp;so,&nbsp;resize.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2865692">if</span>&nbsp;<span class="ident" id="2865695">s</span><span class="op" id="2865696">.</span><span class="ident" id="2865697">end</span>&nbsp;<span class="op" id="2865701">==</span>&nbsp;<span class="builtinfunc" id="2865704">len</span><span class="op" id="2865707">(</span><span class="ident" id="2865708">s</span><span class="op" id="2865709">.</span><span class="ident" id="2865710">buf</span><span class="op" id="2865713">)</span>&nbsp;<span class="op" id="2865715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2865720">if</span>&nbsp;<span class="builtinfunc" id="2865723">len</span><span class="op" id="2865726">(</span><span class="ident" id="2865727">s</span><span class="op" id="2865728">.</span><span class="ident" id="2865729">buf</span><span class="op" id="2865732">)</span>&nbsp;<span class="op" id="2865734">&gt;=</span>&nbsp;<span class="ident" id="2865737">s</span><span class="op" id="2865738">.</span><span class="ident" id="2865739">maxTokenSize</span>&nbsp;<span class="op" id="2865752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2865758">s</span><span class="op" id="2865759">.</span><span class="ident" id="2865760">setErr</span><span class="op" id="2865766">(</span><span class="ident" id="2865767">ErrTooLong</span><span class="op" id="2865777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2865783">return</span>&nbsp;<span class="builtintype" id="2865790">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2865799">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2865804">newSize</span>&nbsp;<span class="op" id="2865812">:=</span>&nbsp;<span class="builtinfunc" id="2865815">len</span><span class="op" id="2865818">(</span><span class="ident" id="2865819">s</span><span class="op" id="2865820">.</span><span class="ident" id="2865821">buf</span><span class="op" id="2865824">)</span>&nbsp;<span class="op" id="2865826">*</span>&nbsp;<span class="num" id="2865828">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2865833">if</span>&nbsp;<span class="ident" id="2865836">newSize</span>&nbsp;<span class="op" id="2865844">&gt;</span>&nbsp;<span class="ident" id="2865846">s</span><span class="op" id="2865847">.</span><span class="ident" id="2865848">maxTokenSize</span>&nbsp;<span class="op" id="2865861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2865867">newSize</span>&nbsp;<span class="op" id="2865875">=</span>&nbsp;<span class="ident" id="2865877">s</span><span class="op" id="2865878">.</span><span class="ident" id="2865879">maxTokenSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2865895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2865900">newBuf</span>&nbsp;<span class="op" id="2865907">:=</span>&nbsp;<span class="builtinfunc" id="2865910">make</span><span class="op" id="2865914">(</span><span class="op" id="2865915">[</span><span class="op" id="2865916">]</span><span class="builtintype" id="2865917">byte</span><span class="op" id="2865921">,</span>&nbsp;<span class="ident" id="2865923">newSize</span><span class="op" id="2865930">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2865935">copy</span><span class="op" id="2865939">(</span><span class="ident" id="2865940">newBuf</span><span class="op" id="2865946">,</span>&nbsp;<span class="ident" id="2865948">s</span><span class="op" id="2865949">.</span><span class="ident" id="2865950">buf</span><span class="op" id="2865953">[</span><span class="ident" id="2865954">s</span><span class="op" id="2865955">.</span><span class="ident" id="2865956">start</span><span class="op" id="2865961">:</span><span class="ident" id="2865962">s</span><span class="op" id="2865963">.</span><span class="ident" id="2865964">end</span><span class="op" id="2865967">]</span><span class="op" id="2865968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2865973">s</span><span class="op" id="2865974">.</span><span class="ident" id="2865975">buf</span>&nbsp;<span class="op" id="2865979">=</span>&nbsp;<span class="ident" id="2865981">newBuf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2865991">s</span><span class="op" id="2865992">.</span><span class="ident" id="2865993">end</span>&nbsp;<span class="op" id="2865997">-=</span>&nbsp;<span class="ident" id="2866000">s</span><span class="op" id="2866001">.</span><span class="ident" id="2866002">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2866011">s</span><span class="op" id="2866012">.</span><span class="ident" id="2866013">start</span>&nbsp;<span class="op" id="2866019">=</span>&nbsp;<span class="num" id="2866021">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866026">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2866037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2866041">//&nbsp;Finally&nbsp;we&nbsp;can&nbsp;read&nbsp;some&nbsp;input.&nbsp;Make&nbsp;sure&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;stuck&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2866112">//&nbsp;a&nbsp;misbehaving&nbsp;Reader.&nbsp;Officially&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;do&nbsp;this,&nbsp;but&nbsp;let&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2866186">//&nbsp;be&nbsp;extra&nbsp;careful:&nbsp;Scanner&nbsp;is&nbsp;for&nbsp;safe,&nbsp;simple&nbsp;jobs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866243">for</span>&nbsp;<span class="ident" id="2866247">loop</span>&nbsp;<span class="op" id="2866252">:=</span>&nbsp;<span class="num" id="2866255">0</span><span class="op" id="2866256">;</span>&nbsp;<span class="op" id="2866258">;</span>&nbsp;<span class="op" id="2866260">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2866265">n</span><span class="op" id="2866266">,</span>&nbsp;<span class="ident" id="2866268">err</span>&nbsp;<span class="op" id="2866272">:=</span>&nbsp;<span class="ident" id="2866275">s</span><span class="op" id="2866276">.</span><span class="ident" id="2866277">r</span><span class="op" id="2866278">.</span><span class="ident" id="2866279">Read</span><span class="op" id="2866283">(</span><span class="ident" id="2866284">s</span><span class="op" id="2866285">.</span><span class="ident" id="2866286">buf</span><span class="op" id="2866289">[</span><span class="ident" id="2866290">s</span><span class="op" id="2866291">.</span><span class="ident" id="2866292">end</span><span class="op" id="2866295">:</span><span class="builtinfunc" id="2866296">len</span><span class="op" id="2866299">(</span><span class="ident" id="2866300">s</span><span class="op" id="2866301">.</span><span class="ident" id="2866302">buf</span><span class="op" id="2866305">)</span><span class="op" id="2866306">]</span><span class="op" id="2866307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2866312">s</span><span class="op" id="2866313">.</span><span class="ident" id="2866314">end</span>&nbsp;<span class="op" id="2866318">+=</span>&nbsp;<span class="ident" id="2866321">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866326">if</span>&nbsp;<span class="ident" id="2866329">err</span>&nbsp;<span class="op" id="2866333">!=</span>&nbsp;<span class="ident" id="2866336">nil</span>&nbsp;<span class="op" id="2866340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2866346">s</span><span class="op" id="2866347">.</span><span class="ident" id="2866348">setErr</span><span class="op" id="2866354">(</span><span class="ident" id="2866355">err</span><span class="op" id="2866358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866364">break</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2866373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866378">if</span>&nbsp;<span class="ident" id="2866381">n</span>&nbsp;<span class="op" id="2866383">&gt;</span>&nbsp;<span class="num" id="2866385">0</span>&nbsp;<span class="op" id="2866387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2866393">s</span><span class="op" id="2866394">.</span><span class="ident" id="2866395">empties</span>&nbsp;<span class="op" id="2866403">=</span>&nbsp;<span class="num" id="2866405">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866411">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2866420">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2866425">loop</span><span class="op" id="2866429">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866435">if</span>&nbsp;<span class="ident" id="2866438">loop</span>&nbsp;<span class="op" id="2866443">&gt;</span>&nbsp;<span class="ident" id="2866445">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="2866470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2866476">s</span><span class="op" id="2866477">.</span><span class="ident" id="2866478">setErr</span><span class="op" id="2866484">(</span><span class="ident" id="2866485">io</span><span class="op" id="2866487">.</span><span class="ident" id="2866488">ErrNoProgress</span><span class="op" id="2866501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866507">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2866516">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2866520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2866523">}</span><br>
<span class="lineno"></span><span class="op" id="2866525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2866528">//&nbsp;advance&nbsp;consumes&nbsp;n&nbsp;bytes&nbsp;of&nbsp;the&nbsp;buffer.&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;advance&nbsp;was&nbsp;legal.</span><br>
<span class="lineno">200</span><span class="keyword" id="2866613">func</span>&nbsp;<span class="op" id="2866618">(</span><span class="ident" id="2866619">s</span>&nbsp;<span class="op" id="2866621">*</span><span class="ident" id="2866622">Scanner</span><span class="op" id="2866629">)</span>&nbsp;<span class="ident" id="2866631">advance</span><span class="op" id="2866638">(</span><span class="ident" id="2866639">n</span>&nbsp;<span class="builtintype" id="2866641">int</span><span class="op" id="2866644">)</span>&nbsp;<span class="builtintype" id="2866646">bool</span>&nbsp;<span class="op" id="2866651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866654">if</span>&nbsp;<span class="ident" id="2866657">n</span>&nbsp;<span class="op" id="2866659">&lt;</span>&nbsp;<span class="num" id="2866661">0</span>&nbsp;<span class="op" id="2866663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2866667">s</span><span class="op" id="2866668">.</span><span class="ident" id="2866669">setErr</span><span class="op" id="2866675">(</span><span class="ident" id="2866676">ErrNegativeAdvance</span><span class="op" id="2866694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866698">return</span>&nbsp;<span class="builtintype" id="2866705">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2866712">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866715">if</span>&nbsp;<span class="ident" id="2866718">n</span>&nbsp;<span class="op" id="2866720">&gt;</span>&nbsp;<span class="ident" id="2866722">s</span><span class="op" id="2866723">.</span><span class="ident" id="2866724">end</span><span class="op" id="2866727">-</span><span class="ident" id="2866728">s</span><span class="op" id="2866729">.</span><span class="ident" id="2866730">start</span>&nbsp;<span class="op" id="2866736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2866740">s</span><span class="op" id="2866741">.</span><span class="ident" id="2866742">setErr</span><span class="op" id="2866748">(</span><span class="ident" id="2866749">ErrAdvanceTooFar</span><span class="op" id="2866765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866769">return</span>&nbsp;<span class="builtintype" id="2866776">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2866783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2866786">s</span><span class="op" id="2866787">.</span><span class="ident" id="2866788">start</span>&nbsp;<span class="op" id="2866794">+=</span>&nbsp;<span class="ident" id="2866797">n</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866800">return</span>&nbsp;<span class="builtintype" id="2866807">true</span><br>
<span class="lineno"></span><span class="op" id="2866812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2866815">//&nbsp;setErr&nbsp;records&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered.</span><br>
<span class="lineno"></span><span class="keyword" id="2866862">func</span>&nbsp;<span class="op" id="2866867">(</span><span class="ident" id="2866868">s</span>&nbsp;<span class="op" id="2866870">*</span><span class="ident" id="2866871">Scanner</span><span class="op" id="2866878">)</span>&nbsp;<span class="ident" id="2866880">setErr</span><span class="op" id="2866886">(</span><span class="ident" id="2866887">err</span>&nbsp;<span class="builtintype" id="2866891">error</span><span class="op" id="2866896">)</span>&nbsp;<span class="op" id="2866898">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2866901">if</span>&nbsp;<span class="ident" id="2866904">s</span><span class="op" id="2866905">.</span><span class="ident" id="2866906">err</span>&nbsp;<span class="op" id="2866910">==</span>&nbsp;<span class="ident" id="2866913">nil</span>&nbsp;<span class="op" id="2866917">||</span>&nbsp;<span class="ident" id="2866920">s</span><span class="op" id="2866921">.</span><span class="ident" id="2866922">err</span>&nbsp;<span class="op" id="2866926">==</span>&nbsp;<span class="ident" id="2866929">io</span><span class="op" id="2866931">.</span><span class="ident" id="2866932">EOF</span>&nbsp;<span class="op" id="2866936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2866940">s</span><span class="op" id="2866941">.</span><span class="ident" id="2866942">err</span>&nbsp;<span class="op" id="2866946">=</span>&nbsp;<span class="ident" id="2866948">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2866953">}</span><br>
<span class="lineno"></span><span class="op" id="2866955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="2866958">//&nbsp;Split&nbsp;sets&nbsp;the&nbsp;split&nbsp;function&nbsp;for&nbsp;the&nbsp;Scanner.&nbsp;If&nbsp;called,&nbsp;it&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="2867030">//&nbsp;called&nbsp;before&nbsp;Scan.&nbsp;The&nbsp;default&nbsp;split&nbsp;function&nbsp;is&nbsp;ScanLines.</span><br>
<span class="lineno"></span><span class="keyword" id="2867094">func</span>&nbsp;<span class="op" id="2867099">(</span><span class="ident" id="2867100">s</span>&nbsp;<span class="op" id="2867102">*</span><span class="ident" id="2867103">Scanner</span><span class="op" id="2867110">)</span>&nbsp;<span class="ident" id="2867112">Split</span><span class="op" id="2867117">(</span><span class="ident" id="2867118">split</span>&nbsp;<span class="ident" id="2867124">SplitFunc</span><span class="op" id="2867133">)</span>&nbsp;<span class="op" id="2867135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2867138">s</span><span class="op" id="2867139">.</span><span class="ident" id="2867140">split</span>&nbsp;<span class="op" id="2867146">=</span>&nbsp;<span class="ident" id="2867148">split</span><br>
<span class="lineno"></span><span class="op" id="2867154">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2867157">//&nbsp;Split&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2867177">//&nbsp;ScanBytes&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each&nbsp;byte&nbsp;as&nbsp;a&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="2867259">func</span>&nbsp;<span class="ident" id="2867264">ScanBytes</span><span class="op" id="2867273">(</span><span class="ident" id="2867274">data</span>&nbsp;<span class="op" id="2867279">[</span><span class="op" id="2867280">]</span><span class="builtintype" id="2867281">byte</span><span class="op" id="2867285">,</span>&nbsp;<span class="ident" id="2867287">atEOF</span>&nbsp;<span class="builtintype" id="2867293">bool</span><span class="op" id="2867297">)</span>&nbsp;<span class="op" id="2867299">(</span><span class="ident" id="2867300">advance</span>&nbsp;<span class="builtintype" id="2867308">int</span><span class="op" id="2867311">,</span>&nbsp;<span class="ident" id="2867313">token</span>&nbsp;<span class="op" id="2867319">[</span><span class="op" id="2867320">]</span><span class="builtintype" id="2867321">byte</span><span class="op" id="2867325">,</span>&nbsp;<span class="ident" id="2867327">err</span>&nbsp;<span class="builtintype" id="2867331">error</span><span class="op" id="2867336">)</span>&nbsp;<span class="op" id="2867338">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2867341">if</span>&nbsp;<span class="ident" id="2867344">atEOF</span>&nbsp;<span class="op" id="2867350">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2867353">len</span><span class="op" id="2867356">(</span><span class="ident" id="2867357">data</span><span class="op" id="2867361">)</span>&nbsp;<span class="op" id="2867363">==</span>&nbsp;<span class="num" id="2867366">0</span>&nbsp;<span class="op" id="2867368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2867372">return</span>&nbsp;<span class="num" id="2867379">0</span><span class="op" id="2867380">,</span>&nbsp;<span class="ident" id="2867382">nil</span><span class="op" id="2867385">,</span>&nbsp;<span class="ident" id="2867387">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2867392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2867395">return</span>&nbsp;<span class="num" id="2867402">1</span><span class="op" id="2867403">,</span>&nbsp;<span class="ident" id="2867405">data</span><span class="op" id="2867409">[</span><span class="num" id="2867410">0</span><span class="op" id="2867411">:</span><span class="num" id="2867412">1</span><span class="op" id="2867413">]</span><span class="op" id="2867414">,</span>&nbsp;<span class="ident" id="2867416">nil</span><br>
<span class="lineno"></span><span class="op" id="2867420">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="2867423">var</span>&nbsp;<span class="ident" id="2867427">errorRune</span>&nbsp;<span class="op" id="2867437">=</span>&nbsp;<span class="op" id="2867439">[</span><span class="op" id="2867440">]</span><span class="builtintype" id="2867441">byte</span><span class="op" id="2867445">(</span><span class="builtintype" id="2867446">string</span><span class="op" id="2867452">(</span><span class="ident" id="2867453">utf8</span><span class="op" id="2867457">.</span><span class="ident" id="2867458">RuneError</span><span class="op" id="2867467">)</span><span class="op" id="2867468">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2867471">//&nbsp;ScanRunes&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="2867536">//&nbsp;UTF-8-encoded&nbsp;rune&nbsp;as&nbsp;a&nbsp;token.&nbsp;The&nbsp;sequence&nbsp;of&nbsp;runes&nbsp;returned&nbsp;is</span><br>
<span class="lineno">240</span><span class="comment" id="2867604">//&nbsp;equivalent&nbsp;to&nbsp;that&nbsp;from&nbsp;a&nbsp;range&nbsp;loop&nbsp;over&nbsp;the&nbsp;input&nbsp;as&nbsp;a&nbsp;string,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="2867678">//&nbsp;means&nbsp;that&nbsp;erroneous&nbsp;UTF-8&nbsp;encodings&nbsp;translate&nbsp;to&nbsp;U+FFFD&nbsp;=&nbsp;&#34;\xef\xbf\xbd&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2867756">//&nbsp;Because&nbsp;of&nbsp;the&nbsp;Scan&nbsp;interface,&nbsp;this&nbsp;makes&nbsp;it&nbsp;impossible&nbsp;for&nbsp;the&nbsp;client&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2867833">//&nbsp;distinguish&nbsp;correctly&nbsp;encoded&nbsp;replacement&nbsp;runes&nbsp;from&nbsp;encoding&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="2867906">func</span>&nbsp;<span class="ident" id="2867911">ScanRunes</span><span class="op" id="2867920">(</span><span class="ident" id="2867921">data</span>&nbsp;<span class="op" id="2867926">[</span><span class="op" id="2867927">]</span><span class="builtintype" id="2867928">byte</span><span class="op" id="2867932">,</span>&nbsp;<span class="ident" id="2867934">atEOF</span>&nbsp;<span class="builtintype" id="2867940">bool</span><span class="op" id="2867944">)</span>&nbsp;<span class="op" id="2867946">(</span><span class="ident" id="2867947">advance</span>&nbsp;<span class="builtintype" id="2867955">int</span><span class="op" id="2867958">,</span>&nbsp;<span class="ident" id="2867960">token</span>&nbsp;<span class="op" id="2867966">[</span><span class="op" id="2867967">]</span><span class="builtintype" id="2867968">byte</span><span class="op" id="2867972">,</span>&nbsp;<span class="ident" id="2867974">err</span>&nbsp;<span class="builtintype" id="2867978">error</span><span class="op" id="2867983">)</span>&nbsp;<span class="op" id="2867985">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2867988">if</span>&nbsp;<span class="ident" id="2867991">atEOF</span>&nbsp;<span class="op" id="2867997">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2868000">len</span><span class="op" id="2868003">(</span><span class="ident" id="2868004">data</span><span class="op" id="2868008">)</span>&nbsp;<span class="op" id="2868010">==</span>&nbsp;<span class="num" id="2868013">0</span>&nbsp;<span class="op" id="2868015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2868019">return</span>&nbsp;<span class="num" id="2868026">0</span><span class="op" id="2868027">,</span>&nbsp;<span class="ident" id="2868029">nil</span><span class="op" id="2868032">,</span>&nbsp;<span class="ident" id="2868034">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2868039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2868043">//&nbsp;Fast&nbsp;path&nbsp;1:&nbsp;ASCII.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2868067">if</span>&nbsp;<span class="ident" id="2868070">data</span><span class="op" id="2868074">[</span><span class="num" id="2868075">0</span><span class="op" id="2868076">]</span>&nbsp;<span class="op" id="2868078">&lt;</span>&nbsp;<span class="ident" id="2868080">utf8</span><span class="op" id="2868084">.</span><span class="ident" id="2868085">RuneSelf</span>&nbsp;<span class="op" id="2868094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2868098">return</span>&nbsp;<span class="num" id="2868105">1</span><span class="op" id="2868106">,</span>&nbsp;<span class="ident" id="2868108">data</span><span class="op" id="2868112">[</span><span class="num" id="2868113">0</span><span class="op" id="2868114">:</span><span class="num" id="2868115">1</span><span class="op" id="2868116">]</span><span class="op" id="2868117">,</span>&nbsp;<span class="ident" id="2868119">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2868124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2868128">//&nbsp;Fast&nbsp;path&nbsp;2:&nbsp;Correct&nbsp;UTF-8&nbsp;decode&nbsp;without&nbsp;error.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2868181">_</span><span class="op" id="2868182">,</span>&nbsp;<span class="ident" id="2868184">width</span>&nbsp;<span class="op" id="2868190">:=</span>&nbsp;<span class="ident" id="2868193">utf8</span><span class="op" id="2868197">.</span><span class="ident" id="2868198">DecodeRune</span><span class="op" id="2868208">(</span><span class="ident" id="2868209">data</span><span class="op" id="2868213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2868216">if</span>&nbsp;<span class="ident" id="2868219">width</span>&nbsp;<span class="op" id="2868225">&gt;</span>&nbsp;<span class="num" id="2868227">1</span>&nbsp;<span class="op" id="2868229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2868233">//&nbsp;It&#39;s&nbsp;a&nbsp;valid&nbsp;encoding.&nbsp;Width&nbsp;cannot&nbsp;be&nbsp;one&nbsp;for&nbsp;a&nbsp;correctly&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2868305">//&nbsp;non-ASCII&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2868326">return</span>&nbsp;<span class="ident" id="2868333">width</span><span class="op" id="2868338">,</span>&nbsp;<span class="ident" id="2868340">data</span><span class="op" id="2868344">[</span><span class="num" id="2868345">0</span><span class="op" id="2868346">:</span><span class="ident" id="2868347">width</span><span class="op" id="2868352">]</span><span class="op" id="2868353">,</span>&nbsp;<span class="ident" id="2868355">nil</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2868360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2868364">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;an&nbsp;error:&nbsp;we&nbsp;have&nbsp;width==1&nbsp;and&nbsp;implicitly&nbsp;r==utf8.RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2868442">//&nbsp;Is&nbsp;the&nbsp;error&nbsp;because&nbsp;there&nbsp;wasn&#39;t&nbsp;a&nbsp;full&nbsp;rune&nbsp;to&nbsp;be&nbsp;decoded?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2868507">//&nbsp;FullRune&nbsp;distinguishes&nbsp;correctly&nbsp;between&nbsp;erroneous&nbsp;and&nbsp;incomplete&nbsp;encodings.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2868588">if</span>&nbsp;<span class="op" id="2868591">!</span><span class="ident" id="2868592">atEOF</span>&nbsp;<span class="op" id="2868598">&amp;&amp;</span>&nbsp;<span class="op" id="2868601">!</span><span class="ident" id="2868602">utf8</span><span class="op" id="2868606">.</span><span class="ident" id="2868607">FullRune</span><span class="op" id="2868615">(</span><span class="ident" id="2868616">data</span><span class="op" id="2868620">)</span>&nbsp;<span class="op" id="2868622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2868626">//&nbsp;Incomplete;&nbsp;get&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2868659">return</span>&nbsp;<span class="num" id="2868666">0</span><span class="op" id="2868667">,</span>&nbsp;<span class="ident" id="2868669">nil</span><span class="op" id="2868672">,</span>&nbsp;<span class="ident" id="2868674">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2868679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2868683">//&nbsp;We&nbsp;have&nbsp;a&nbsp;real&nbsp;UTF-8&nbsp;encoding&nbsp;error.&nbsp;Return&nbsp;a&nbsp;properly&nbsp;encoded&nbsp;error&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2868761">//&nbsp;but&nbsp;advance&nbsp;only&nbsp;one&nbsp;byte.&nbsp;This&nbsp;matches&nbsp;the&nbsp;behavior&nbsp;of&nbsp;a&nbsp;range&nbsp;loop&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2868839">//&nbsp;an&nbsp;incorrectly&nbsp;encoded&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2868874">return</span>&nbsp;<span class="num" id="2868881">1</span><span class="op" id="2868882">,</span>&nbsp;<span class="ident" id="2868884">errorRune</span><span class="op" id="2868893">,</span>&nbsp;<span class="ident" id="2868895">nil</span><br>
<span class="lineno"></span><span class="op" id="2868899">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="2868902">//&nbsp;dropCR&nbsp;drops&nbsp;a&nbsp;terminal&nbsp;\r&nbsp;from&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="2868947">func</span>&nbsp;<span class="ident" id="2868952">dropCR</span><span class="op" id="2868958">(</span><span class="ident" id="2868959">data</span>&nbsp;<span class="op" id="2868964">[</span><span class="op" id="2868965">]</span><span class="builtintype" id="2868966">byte</span><span class="op" id="2868970">)</span>&nbsp;<span class="op" id="2868972">[</span><span class="op" id="2868973">]</span><span class="builtintype" id="2868974">byte</span>&nbsp;<span class="op" id="2868979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2868982">if</span>&nbsp;<span class="builtinfunc" id="2868985">len</span><span class="op" id="2868988">(</span><span class="ident" id="2868989">data</span><span class="op" id="2868993">)</span>&nbsp;<span class="op" id="2868995">&gt;</span>&nbsp;<span class="num" id="2868997">0</span>&nbsp;<span class="op" id="2868999">&amp;&amp;</span>&nbsp;<span class="ident" id="2869002">data</span><span class="op" id="2869006">[</span><span class="builtinfunc" id="2869007">len</span><span class="op" id="2869010">(</span><span class="ident" id="2869011">data</span><span class="op" id="2869015">)</span><span class="op" id="2869016">-</span><span class="num" id="2869017">1</span><span class="op" id="2869018">]</span>&nbsp;<span class="op" id="2869020">==</span>&nbsp;<span class="string" id="2869023">&#39;\r&#39;</span>&nbsp;<span class="op" id="2869028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2869032">return</span>&nbsp;<span class="ident" id="2869039">data</span><span class="op" id="2869043">[</span><span class="num" id="2869044">0</span>&nbsp;<span class="op" id="2869046">:</span>&nbsp;<span class="builtinfunc" id="2869048">len</span><span class="op" id="2869051">(</span><span class="ident" id="2869052">data</span><span class="op" id="2869056">)</span><span class="op" id="2869057">-</span><span class="num" id="2869058">1</span><span class="op" id="2869059">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2869062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2869065">return</span>&nbsp;<span class="ident" id="2869072">data</span><br>
<span class="lineno"></span><span class="op" id="2869077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2869080">//&nbsp;ScanLines&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each&nbsp;line&nbsp;of</span><br>
<span class="lineno">285</span><span class="comment" id="2869153">//&nbsp;text,&nbsp;stripped&nbsp;of&nbsp;any&nbsp;trailing&nbsp;end-of-line&nbsp;marker.&nbsp;The&nbsp;returned&nbsp;line&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="2869229">//&nbsp;be&nbsp;empty.&nbsp;The&nbsp;end-of-line&nbsp;marker&nbsp;is&nbsp;one&nbsp;optional&nbsp;carriage&nbsp;return&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="2869306">//&nbsp;by&nbsp;one&nbsp;mandatory&nbsp;newline.&nbsp;In&nbsp;regular&nbsp;expression&nbsp;notation,&nbsp;it&nbsp;is&nbsp;`\r?\n`.</span><br>
<span class="lineno"></span><span class="comment" id="2869382">//&nbsp;The&nbsp;last&nbsp;non-empty&nbsp;line&nbsp;of&nbsp;input&nbsp;will&nbsp;be&nbsp;returned&nbsp;even&nbsp;if&nbsp;it&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="2869453">//&nbsp;newline.</span><br>
<span class="lineno">290</span><span class="keyword" id="2869465">func</span>&nbsp;<span class="ident" id="2869470">ScanLines</span><span class="op" id="2869479">(</span><span class="ident" id="2869480">data</span>&nbsp;<span class="op" id="2869485">[</span><span class="op" id="2869486">]</span><span class="builtintype" id="2869487">byte</span><span class="op" id="2869491">,</span>&nbsp;<span class="ident" id="2869493">atEOF</span>&nbsp;<span class="builtintype" id="2869499">bool</span><span class="op" id="2869503">)</span>&nbsp;<span class="op" id="2869505">(</span><span class="ident" id="2869506">advance</span>&nbsp;<span class="builtintype" id="2869514">int</span><span class="op" id="2869517">,</span>&nbsp;<span class="ident" id="2869519">token</span>&nbsp;<span class="op" id="2869525">[</span><span class="op" id="2869526">]</span><span class="builtintype" id="2869527">byte</span><span class="op" id="2869531">,</span>&nbsp;<span class="ident" id="2869533">err</span>&nbsp;<span class="builtintype" id="2869537">error</span><span class="op" id="2869542">)</span>&nbsp;<span class="op" id="2869544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2869547">if</span>&nbsp;<span class="ident" id="2869550">atEOF</span>&nbsp;<span class="op" id="2869556">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2869559">len</span><span class="op" id="2869562">(</span><span class="ident" id="2869563">data</span><span class="op" id="2869567">)</span>&nbsp;<span class="op" id="2869569">==</span>&nbsp;<span class="num" id="2869572">0</span>&nbsp;<span class="op" id="2869574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2869578">return</span>&nbsp;<span class="num" id="2869585">0</span><span class="op" id="2869586">,</span>&nbsp;<span class="ident" id="2869588">nil</span><span class="op" id="2869591">,</span>&nbsp;<span class="ident" id="2869593">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2869598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2869601">if</span>&nbsp;<span class="ident" id="2869604">i</span>&nbsp;<span class="op" id="2869606">:=</span>&nbsp;<span class="ident" id="2869609">bytes</span><span class="op" id="2869614">.</span><span class="ident" id="2869615">IndexByte</span><span class="op" id="2869624">(</span><span class="ident" id="2869625">data</span><span class="op" id="2869629">,</span>&nbsp;<span class="string" id="2869631">&#39;\n&#39;</span><span class="op" id="2869635">)</span><span class="op" id="2869636">;</span>&nbsp;<span class="ident" id="2869638">i</span>&nbsp;<span class="op" id="2869640">&gt;=</span>&nbsp;<span class="num" id="2869643">0</span>&nbsp;<span class="op" id="2869645">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2869649">//&nbsp;We&nbsp;have&nbsp;a&nbsp;full&nbsp;newline-terminated&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2869694">return</span>&nbsp;<span class="ident" id="2869701">i</span>&nbsp;<span class="op" id="2869703">+</span>&nbsp;<span class="num" id="2869705">1</span><span class="op" id="2869706">,</span>&nbsp;<span class="ident" id="2869708">dropCR</span><span class="op" id="2869714">(</span><span class="ident" id="2869715">data</span><span class="op" id="2869719">[</span><span class="num" id="2869720">0</span><span class="op" id="2869721">:</span><span class="ident" id="2869722">i</span><span class="op" id="2869723">]</span><span class="op" id="2869724">)</span><span class="op" id="2869725">,</span>&nbsp;<span class="ident" id="2869727">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2869732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2869735">//&nbsp;If&nbsp;we&#39;re&nbsp;at&nbsp;EOF,&nbsp;we&nbsp;have&nbsp;a&nbsp;final,&nbsp;non-terminated&nbsp;line.&nbsp;Return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2869805">if</span>&nbsp;<span class="ident" id="2869808">atEOF</span>&nbsp;<span class="op" id="2869814">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2869818">return</span>&nbsp;<span class="builtinfunc" id="2869825">len</span><span class="op" id="2869828">(</span><span class="ident" id="2869829">data</span><span class="op" id="2869833">)</span><span class="op" id="2869834">,</span>&nbsp;<span class="ident" id="2869836">dropCR</span><span class="op" id="2869842">(</span><span class="ident" id="2869843">data</span><span class="op" id="2869847">)</span><span class="op" id="2869848">,</span>&nbsp;<span class="ident" id="2869850">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2869855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2869858">//&nbsp;Request&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2869881">return</span>&nbsp;<span class="num" id="2869888">0</span><span class="op" id="2869889">,</span>&nbsp;<span class="ident" id="2869891">nil</span><span class="op" id="2869894">,</span>&nbsp;<span class="ident" id="2869896">nil</span><br>
<span class="lineno"></span><span class="op" id="2869900">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="comment" id="2869903">//&nbsp;isSpace&nbsp;reports&nbsp;whether&nbsp;the&nbsp;character&nbsp;is&nbsp;a&nbsp;Unicode&nbsp;white&nbsp;space&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="2869980">//&nbsp;We&nbsp;avoid&nbsp;dependency&nbsp;on&nbsp;the&nbsp;unicode&nbsp;package,&nbsp;but&nbsp;check&nbsp;validity&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="2870068">//&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="2870085">func</span>&nbsp;<span class="ident" id="2870090">isSpace</span><span class="op" id="2870097">(</span><span class="ident" id="2870098">r</span>&nbsp;<span class="builtintype" id="2870100">rune</span><span class="op" id="2870104">)</span>&nbsp;<span class="builtintype" id="2870106">bool</span>&nbsp;<span class="op" id="2870111">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870114">if</span>&nbsp;<span class="ident" id="2870117">r</span>&nbsp;<span class="op" id="2870119">&lt;=</span>&nbsp;<span class="string" id="2870122">&#39;\u00FF&#39;</span>&nbsp;<span class="op" id="2870131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2870135">//&nbsp;Obvious&nbsp;ASCII&nbsp;ones:&nbsp;\t&nbsp;through&nbsp;\r&nbsp;plus&nbsp;space.&nbsp;Plus&nbsp;two&nbsp;Latin-1&nbsp;oddballs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870213">switch</span>&nbsp;<span class="ident" id="2870220">r</span>&nbsp;<span class="op" id="2870222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870226">case</span>&nbsp;<span class="string" id="2870231">&#39;&nbsp;&#39;</span><span class="op" id="2870234">,</span>&nbsp;<span class="string" id="2870236">&#39;\t&#39;</span><span class="op" id="2870240">,</span>&nbsp;<span class="string" id="2870242">&#39;\n&#39;</span><span class="op" id="2870246">,</span>&nbsp;<span class="string" id="2870248">&#39;\v&#39;</span><span class="op" id="2870252">,</span>&nbsp;<span class="string" id="2870254">&#39;\f&#39;</span><span class="op" id="2870258">,</span>&nbsp;<span class="string" id="2870260">&#39;\r&#39;</span><span class="op" id="2870264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870269">return</span>&nbsp;<span class="builtintype" id="2870276">true</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870283">case</span>&nbsp;<span class="string" id="2870288">&#39;\u0085&#39;</span><span class="op" id="2870296">,</span>&nbsp;<span class="string" id="2870298">&#39;\u00A0&#39;</span><span class="op" id="2870306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870311">return</span>&nbsp;<span class="builtintype" id="2870318">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2870325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870329">return</span>&nbsp;<span class="builtintype" id="2870336">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2870343">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2870346">//&nbsp;High-valued&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870368">if</span>&nbsp;<span class="string" id="2870371">&#39;\u2000&#39;</span>&nbsp;<span class="op" id="2870380">&lt;=</span>&nbsp;<span class="ident" id="2870383">r</span>&nbsp;<span class="op" id="2870385">&amp;&amp;</span>&nbsp;<span class="ident" id="2870388">r</span>&nbsp;<span class="op" id="2870390">&lt;=</span>&nbsp;<span class="string" id="2870393">&#39;\u200a&#39;</span>&nbsp;<span class="op" id="2870402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870406">return</span>&nbsp;<span class="builtintype" id="2870413">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2870419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870422">switch</span>&nbsp;<span class="ident" id="2870429">r</span>&nbsp;<span class="op" id="2870431">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870434">case</span>&nbsp;<span class="string" id="2870439">&#39;\u1680&#39;</span><span class="op" id="2870447">,</span>&nbsp;<span class="string" id="2870449">&#39;\u2028&#39;</span><span class="op" id="2870457">,</span>&nbsp;<span class="string" id="2870459">&#39;\u2029&#39;</span><span class="op" id="2870467">,</span>&nbsp;<span class="string" id="2870469">&#39;\u202f&#39;</span><span class="op" id="2870477">,</span>&nbsp;<span class="string" id="2870479">&#39;\u205f&#39;</span><span class="op" id="2870487">,</span>&nbsp;<span class="string" id="2870489">&#39;\u3000&#39;</span><span class="op" id="2870497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870501">return</span>&nbsp;<span class="builtintype" id="2870508">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2870514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870517">return</span>&nbsp;<span class="builtintype" id="2870524">false</span><br>
<span class="lineno"></span><span class="op" id="2870530">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2870533">//&nbsp;ScanWords&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="2870598">//&nbsp;space-separated&nbsp;word&nbsp;of&nbsp;text,&nbsp;with&nbsp;surrounding&nbsp;spaces&nbsp;deleted.&nbsp;It&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="2870672">//&nbsp;never&nbsp;return&nbsp;an&nbsp;empty&nbsp;string.&nbsp;The&nbsp;definition&nbsp;of&nbsp;space&nbsp;is&nbsp;set&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2870739">//&nbsp;unicode.IsSpace.</span><br>
<span class="lineno">335</span><span class="keyword" id="2870759">func</span>&nbsp;<span class="ident" id="2870764">ScanWords</span><span class="op" id="2870773">(</span><span class="ident" id="2870774">data</span>&nbsp;<span class="op" id="2870779">[</span><span class="op" id="2870780">]</span><span class="builtintype" id="2870781">byte</span><span class="op" id="2870785">,</span>&nbsp;<span class="ident" id="2870787">atEOF</span>&nbsp;<span class="builtintype" id="2870793">bool</span><span class="op" id="2870797">)</span>&nbsp;<span class="op" id="2870799">(</span><span class="ident" id="2870800">advance</span>&nbsp;<span class="builtintype" id="2870808">int</span><span class="op" id="2870811">,</span>&nbsp;<span class="ident" id="2870813">token</span>&nbsp;<span class="op" id="2870819">[</span><span class="op" id="2870820">]</span><span class="builtintype" id="2870821">byte</span><span class="op" id="2870825">,</span>&nbsp;<span class="ident" id="2870827">err</span>&nbsp;<span class="builtintype" id="2870831">error</span><span class="op" id="2870836">)</span>&nbsp;<span class="op" id="2870838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2870841">//&nbsp;Skip&nbsp;leading&nbsp;spaces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2870866">start</span>&nbsp;<span class="op" id="2870872">:=</span>&nbsp;<span class="num" id="2870875">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870878">for</span>&nbsp;<span class="ident" id="2870882">width</span>&nbsp;<span class="op" id="2870888">:=</span>&nbsp;<span class="num" id="2870891">0</span><span class="op" id="2870892">;</span>&nbsp;<span class="ident" id="2870894">start</span>&nbsp;<span class="op" id="2870900">&lt;</span>&nbsp;<span class="builtinfunc" id="2870902">len</span><span class="op" id="2870905">(</span><span class="ident" id="2870906">data</span><span class="op" id="2870910">)</span><span class="op" id="2870911">;</span>&nbsp;<span class="ident" id="2870913">start</span>&nbsp;<span class="op" id="2870919">+=</span>&nbsp;<span class="ident" id="2870922">width</span>&nbsp;<span class="op" id="2870928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870932">var</span>&nbsp;<span class="ident" id="2870936">r</span>&nbsp;<span class="builtintype" id="2870938">rune</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2870945">r</span><span class="op" id="2870946">,</span>&nbsp;<span class="ident" id="2870948">width</span>&nbsp;<span class="op" id="2870954">=</span>&nbsp;<span class="ident" id="2870956">utf8</span><span class="op" id="2870960">.</span><span class="ident" id="2870961">DecodeRune</span><span class="op" id="2870971">(</span><span class="ident" id="2870972">data</span><span class="op" id="2870976">[</span><span class="ident" id="2870977">start</span><span class="op" id="2870982">:</span><span class="op" id="2870983">]</span><span class="op" id="2870984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2870988">if</span>&nbsp;<span class="op" id="2870991">!</span><span class="ident" id="2870992">isSpace</span><span class="op" id="2870999">(</span><span class="ident" id="2871000">r</span><span class="op" id="2871001">)</span>&nbsp;<span class="op" id="2871003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2871008">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2871016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2871019">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2871022">//&nbsp;Scan&nbsp;until&nbsp;space,&nbsp;marking&nbsp;end&nbsp;of&nbsp;word.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2871065">for</span>&nbsp;<span class="ident" id="2871069">width</span><span class="op" id="2871074">,</span>&nbsp;<span class="ident" id="2871076">i</span>&nbsp;<span class="op" id="2871078">:=</span>&nbsp;<span class="num" id="2871081">0</span><span class="op" id="2871082">,</span>&nbsp;<span class="ident" id="2871084">start</span><span class="op" id="2871089">;</span>&nbsp;<span class="ident" id="2871091">i</span>&nbsp;<span class="op" id="2871093">&lt;</span>&nbsp;<span class="builtinfunc" id="2871095">len</span><span class="op" id="2871098">(</span><span class="ident" id="2871099">data</span><span class="op" id="2871103">)</span><span class="op" id="2871104">;</span>&nbsp;<span class="ident" id="2871106">i</span>&nbsp;<span class="op" id="2871108">+=</span>&nbsp;<span class="ident" id="2871111">width</span>&nbsp;<span class="op" id="2871117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2871121">var</span>&nbsp;<span class="ident" id="2871125">r</span>&nbsp;<span class="builtintype" id="2871127">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2871134">r</span><span class="op" id="2871135">,</span>&nbsp;<span class="ident" id="2871137">width</span>&nbsp;<span class="op" id="2871143">=</span>&nbsp;<span class="ident" id="2871145">utf8</span><span class="op" id="2871149">.</span><span class="ident" id="2871150">DecodeRune</span><span class="op" id="2871160">(</span><span class="ident" id="2871161">data</span><span class="op" id="2871165">[</span><span class="ident" id="2871166">i</span><span class="op" id="2871167">:</span><span class="op" id="2871168">]</span><span class="op" id="2871169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2871173">if</span>&nbsp;<span class="ident" id="2871176">isSpace</span><span class="op" id="2871183">(</span><span class="ident" id="2871184">r</span><span class="op" id="2871185">)</span>&nbsp;<span class="op" id="2871187">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2871192">return</span>&nbsp;<span class="ident" id="2871199">i</span>&nbsp;<span class="op" id="2871201">+</span>&nbsp;<span class="ident" id="2871203">width</span><span class="op" id="2871208">,</span>&nbsp;<span class="ident" id="2871210">data</span><span class="op" id="2871214">[</span><span class="ident" id="2871215">start</span><span class="op" id="2871220">:</span><span class="ident" id="2871221">i</span><span class="op" id="2871222">]</span><span class="op" id="2871223">,</span>&nbsp;<span class="ident" id="2871225">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2871231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2871234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2871237">//&nbsp;If&nbsp;we&#39;re&nbsp;at&nbsp;EOF,&nbsp;we&nbsp;have&nbsp;a&nbsp;final,&nbsp;non-empty,&nbsp;non-terminated&nbsp;word.&nbsp;Return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2871318">if</span>&nbsp;<span class="ident" id="2871321">atEOF</span>&nbsp;<span class="op" id="2871327">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2871330">len</span><span class="op" id="2871333">(</span><span class="ident" id="2871334">data</span><span class="op" id="2871338">)</span>&nbsp;<span class="op" id="2871340">&gt;</span>&nbsp;<span class="ident" id="2871342">start</span>&nbsp;<span class="op" id="2871348">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2871352">return</span>&nbsp;<span class="builtinfunc" id="2871359">len</span><span class="op" id="2871362">(</span><span class="ident" id="2871363">data</span><span class="op" id="2871367">)</span><span class="op" id="2871368">,</span>&nbsp;<span class="ident" id="2871370">data</span><span class="op" id="2871374">[</span><span class="ident" id="2871375">start</span><span class="op" id="2871380">:</span><span class="op" id="2871381">]</span><span class="op" id="2871382">,</span>&nbsp;<span class="ident" id="2871384">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2871389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2871392">//&nbsp;Request&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2871415">return</span>&nbsp;<span class="ident" id="2871422">start</span><span class="op" id="2871427">,</span>&nbsp;<span class="ident" id="2871429">nil</span><span class="op" id="2871432">,</span>&nbsp;<span class="ident" id="2871434">nil</span><br>
<span class="lineno"></span><span class="op" id="2871438">}</span>
</div>
</body>
</html>
