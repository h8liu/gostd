<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3340149">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3340204">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3340258">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3340309">//&nbsp;HTTP&nbsp;file&nbsp;system&nbsp;request&nbsp;handler</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3340346">package</span>&nbsp;<span class="ident" id="3340354">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3340360">import</span>&nbsp;<span class="op" id="3340367">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3340370">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3340380">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3340387">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3340393">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3340401">&#34;mime/multipart&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3340419">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3340436">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3340447">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3340453">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3340461">&#34;path/filepath&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3340478">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3340489">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3340500">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3340507">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3340510">//&nbsp;A&nbsp;Dir&nbsp;implements&nbsp;FileSystem&nbsp;using&nbsp;the&nbsp;native&nbsp;file&nbsp;system&nbsp;restricted&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3340586">//&nbsp;specific&nbsp;directory&nbsp;tree.</span><br>
<span class="lineno"></span><span class="comment" id="3340614">//</span><br>
<span class="lineno"></span><span class="comment" id="3340617">//&nbsp;While&nbsp;the&nbsp;FileSystem.Open&nbsp;method&nbsp;takes&nbsp;&#39;/&#39;-separated&nbsp;paths,&nbsp;a&nbsp;Dir&#39;s&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="3340695">//&nbsp;value&nbsp;is&nbsp;a&nbsp;filename&nbsp;on&nbsp;the&nbsp;native&nbsp;file&nbsp;system,&nbsp;not&nbsp;a&nbsp;URL,&nbsp;so&nbsp;it&nbsp;is&nbsp;separated</span><br>
<span class="lineno">30</span><span class="comment" id="3340775">//&nbsp;by&nbsp;filepath.Separator,&nbsp;which&nbsp;isn&#39;t&nbsp;necessarily&nbsp;&#39;/&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="3340830">//</span><br>
<span class="lineno"></span><span class="comment" id="3340833">//&nbsp;An&nbsp;empty&nbsp;Dir&nbsp;is&nbsp;treated&nbsp;as&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3340868">type</span>&nbsp;<span class="ident" id="3340873">Dir</span>&nbsp;<span class="builtintype" id="3340877">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="3340885">func</span>&nbsp;<span class="op" id="3340890">(</span><span class="ident" id="3340891">d</span>&nbsp;<span class="ident" id="3340893"><a href="/net/http/fs.go.html#3340873">Dir</a></span><span class="op" id="3340896">)</span>&nbsp;<span class="ident" id="3340898">Open</span><span class="op" id="3340902">(</span><span class="ident" id="3340903">name</span>&nbsp;<span class="builtintype" id="3340908">string</span><span class="op" id="3340914">)</span>&nbsp;<span class="op" id="3340916">(</span><span class="ident" id="3340917"><a href="/net/http/fs.go.html#3341745">File</a></span><span class="op" id="3340921">,</span>&nbsp;<span class="builtintype" id="3340923">error</span><span class="op" id="3340928">)</span>&nbsp;<span class="op" id="3340930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340933">if</span>&nbsp;<span class="ident" id="3340936"><a href="/net/http/fs.go.html#3340461">filepath</a></span><span class="op" id="3340944">.</span><span class="ident" id="3340945">Separator</span>&nbsp;<span class="op" id="3340955">!=</span>&nbsp;<span class="string" id="3340958">&#39;/&#39;</span>&nbsp;<span class="op" id="3340962">&amp;&amp;</span>&nbsp;<span class="ident" id="3340965"><a href="/net/http/fs.go.html#3340489">strings</a></span><span class="op" id="3340972">.</span><span class="ident" id="3340973">IndexRune</span><span class="op" id="3340982">(</span><span class="ident" id="3340983"><a href="/net/http/fs.go.html#3340903">name</a></span><span class="op" id="3340987">,</span>&nbsp;<span class="ident" id="3340989"><a href="/net/http/fs.go.html#3340461">filepath</a></span><span class="op" id="3340997">.</span><span class="ident" id="3340998">Separator</span><span class="op" id="3341007">)</span>&nbsp;<span class="op" id="3341009">&gt;=</span>&nbsp;<span class="num" id="3341012">0</span>&nbsp;<span class="op" id="3341014">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341019"><a href="/net/http/fs.go.html#3340489">strings</a></span><span class="op" id="3341026">.</span><span class="ident" id="3341027">Contains</span><span class="op" id="3341035">(</span><span class="ident" id="3341036"><a href="/net/http/fs.go.html#3340903">name</a></span><span class="op" id="3341040">,</span>&nbsp;<span class="string" id="3341042">&#34;\x00&#34;</span><span class="op" id="3341048">)</span>&nbsp;<span class="op" id="3341050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341054">return</span>&nbsp;<span class="ident" id="3341061">nil</span><span class="op" id="3341064">,</span>&nbsp;<span class="ident" id="3341066"><a href="/net/http/fs.go.html#3340370">errors</a></span><span class="op" id="3341072">.</span><span class="ident" id="3341073">New</span><span class="op" id="3341076">(</span><span class="string" id="3341077">&#34;http:&nbsp;invalid&nbsp;character&nbsp;in&nbsp;file&nbsp;path&#34;</span><span class="op" id="3341115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341118">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341121">dir</span>&nbsp;<span class="op" id="3341125">:=</span>&nbsp;<span class="builtintype" id="3341128">string</span><span class="op" id="3341134">(</span><span class="ident" id="3341135"><a href="/net/http/fs.go.html#3340891">d</a></span><span class="op" id="3341136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341139">if</span>&nbsp;<span class="ident" id="3341142"><a href="/net/http/fs.go.html#3341121">dir</a></span>&nbsp;<span class="op" id="3341146">==</span>&nbsp;<span class="string" id="3341149">&#34;&#34;</span>&nbsp;<span class="op" id="3341152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341156"><a href="/net/http/fs.go.html#3341121">dir</a></span>&nbsp;<span class="op" id="3341160">=</span>&nbsp;<span class="string" id="3341162">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341170">f</span><span class="op" id="3341171">,</span>&nbsp;<span class="ident" id="3341173">err</span>&nbsp;<span class="op" id="3341177">:=</span>&nbsp;<span class="ident" id="3341180"><a href="/net/http/fs.go.html#3340447">os</a></span><span class="op" id="3341182">.</span><span class="ident" id="3341183">Open</span><span class="op" id="3341187">(</span><span class="ident" id="3341188"><a href="/net/http/fs.go.html#3340461">filepath</a></span><span class="op" id="3341196">.</span><span class="ident" id="3341197">Join</span><span class="op" id="3341201">(</span><span class="ident" id="3341202"><a href="/net/http/fs.go.html#3341121">dir</a></span><span class="op" id="3341205">,</span>&nbsp;<span class="ident" id="3341207"><a href="/net/http/fs.go.html#3340461">filepath</a></span><span class="op" id="3341215">.</span><span class="ident" id="3341216">FromSlash</span><span class="op" id="3341225">(</span><span class="ident" id="3341226"><a href="/net/http/fs.go.html#3340453">path</a></span><span class="op" id="3341230">.</span><span class="ident" id="3341231">Clean</span><span class="op" id="3341236">(</span><span class="string" id="3341237">&#34;/&#34;</span><span class="op" id="3341240">+</span><span class="ident" id="3341241"><a href="/net/http/fs.go.html#3340903">name</a></span><span class="op" id="3341245">)</span><span class="op" id="3341246">)</span><span class="op" id="3341247">)</span><span class="op" id="3341248">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341251">if</span>&nbsp;<span class="ident" id="3341254"><a href="/net/http/fs.go.html#3341173">err</a></span>&nbsp;<span class="op" id="3341258">!=</span>&nbsp;<span class="ident" id="3341261">nil</span>&nbsp;<span class="op" id="3341265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341269">return</span>&nbsp;<span class="ident" id="3341276">nil</span><span class="op" id="3341279">,</span>&nbsp;<span class="ident" id="3341281"><a href="/net/http/fs.go.html#3341173">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341289">return</span>&nbsp;<span class="ident" id="3341296"><a href="/net/http/fs.go.html#3341170">f</a></span><span class="op" id="3341297">,</span>&nbsp;<span class="ident" id="3341299">nil</span><br>
<span class="lineno"></span><span class="op" id="3341303">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="3341306">//&nbsp;A&nbsp;FileSystem&nbsp;implements&nbsp;access&nbsp;to&nbsp;a&nbsp;collection&nbsp;of&nbsp;named&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3341372">//&nbsp;The&nbsp;elements&nbsp;in&nbsp;a&nbsp;file&nbsp;path&nbsp;are&nbsp;separated&nbsp;by&nbsp;slash&nbsp;(&#39;/&#39;,&nbsp;U+002F)</span><br>
<span class="lineno"></span><span class="comment" id="3341440">//&nbsp;characters,&nbsp;regardless&nbsp;of&nbsp;host&nbsp;operating&nbsp;system&nbsp;convention.</span><br>
<span class="lineno"></span><span class="keyword" id="3341503">type</span>&nbsp;<span class="ident" id="3341508">FileSystem</span>&nbsp;<span class="keyword" id="3341519">interface</span>&nbsp;<span class="op" id="3341529">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341532">Open</span><span class="op" id="3341536">(</span><span class="ident" id="3341537">name</span>&nbsp;<span class="builtintype" id="3341542">string</span><span class="op" id="3341548">)</span>&nbsp;<span class="op" id="3341550">(</span><span class="ident" id="3341551"><a href="/net/http/fs.go.html#3341745">File</a></span><span class="op" id="3341555">,</span>&nbsp;<span class="builtintype" id="3341557">error</span><span class="op" id="3341562">)</span><br>
<span class="lineno"></span><span class="op" id="3341564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3341567">//&nbsp;A&nbsp;File&nbsp;is&nbsp;returned&nbsp;by&nbsp;a&nbsp;FileSystem&#39;s&nbsp;Open&nbsp;method&nbsp;and&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3341630">//&nbsp;served&nbsp;by&nbsp;the&nbsp;FileServer&nbsp;implementation.</span><br>
<span class="lineno">60</span><span class="comment" id="3341674">//</span><br>
<span class="lineno"></span><span class="comment" id="3341677">//&nbsp;The&nbsp;methods&nbsp;should&nbsp;behave&nbsp;the&nbsp;same&nbsp;as&nbsp;those&nbsp;on&nbsp;an&nbsp;*os.File.</span><br>
<span class="lineno"></span><span class="keyword" id="3341740">type</span>&nbsp;<span class="ident" id="3341745">File</span>&nbsp;<span class="keyword" id="3341750">interface</span>&nbsp;<span class="op" id="3341760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341763"><a href="/net/http/fs.go.html#3340387">io</a></span><span class="op" id="3341765">.</span><span class="ident" id="3341766">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341774"><a href="/net/http/fs.go.html#3340387">io</a></span><span class="op" id="3341776">.</span><span class="ident" id="3341777">Reader</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341785">Readdir</span><span class="op" id="3341792">(</span><span class="ident" id="3341793">count</span>&nbsp;<span class="builtintype" id="3341799">int</span><span class="op" id="3341802">)</span>&nbsp;<span class="op" id="3341804">(</span><span class="op" id="3341805">[</span><span class="op" id="3341806">]</span><span class="ident" id="3341807"><a href="/net/http/fs.go.html#3340447">os</a></span><span class="op" id="3341809">.</span><span class="ident" id="3341810">FileInfo</span><span class="op" id="3341818">,</span>&nbsp;<span class="builtintype" id="3341820">error</span><span class="op" id="3341825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341828">Seek</span><span class="op" id="3341832">(</span><span class="ident" id="3341833">offset</span>&nbsp;<span class="ident" id="3341840">int64</span><span class="op" id="3341845">,</span>&nbsp;<span class="ident" id="3341847">whence</span>&nbsp;<span class="builtintype" id="3341854">int</span><span class="op" id="3341857">)</span>&nbsp;<span class="op" id="3341859">(</span><span class="ident" id="3341860">int64</span><span class="op" id="3341865">,</span>&nbsp;<span class="builtintype" id="3341867">error</span><span class="op" id="3341872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341875">Stat</span><span class="op" id="3341879">(</span><span class="op" id="3341880">)</span>&nbsp;<span class="op" id="3341882">(</span><span class="ident" id="3341883"><a href="/net/http/fs.go.html#3340447">os</a></span><span class="op" id="3341885">.</span><span class="ident" id="3341886">FileInfo</span><span class="op" id="3341894">,</span>&nbsp;<span class="builtintype" id="3341896">error</span><span class="op" id="3341901">)</span><br>
<span class="lineno"></span><span class="op" id="3341903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="3341906">func</span>&nbsp;<span class="ident" id="3341911">dirList</span><span class="op" id="3341918">(</span><span class="ident" id="3341919">w</span>&nbsp;<span class="ident" id="3341921"><a href="/net/http/server.go.html#3401101">ResponseWriter</a></span><span class="op" id="3341935">,</span>&nbsp;<span class="ident" id="3341937">f</span>&nbsp;<span class="ident" id="3341939"><a href="/net/http/fs.go.html#3341745">File</a></span><span class="op" id="3341943">)</span>&nbsp;<span class="op" id="3341945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341948"><a href="/net/http/fs.go.html#3341919">w</a></span><span class="op" id="3341949">.</span><span class="ident" id="3341950">Header</span><span class="op" id="3341956">(</span><span class="op" id="3341957">)</span><span class="op" id="3341958">.</span><span class="ident" id="3341959">Set</span><span class="op" id="3341962">(</span><span class="string" id="3341963">&#34;Content-Type&#34;</span><span class="op" id="3341977">,</span>&nbsp;<span class="string" id="3341979">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="3342005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3342008"><a href="/net/http/fs.go.html#3340380">fmt</a></span><span class="op" id="3342011">.</span><span class="ident" id="3342012">Fprintf</span><span class="op" id="3342019">(</span><span class="ident" id="3342020"><a href="/net/http/fs.go.html#3341919">w</a></span><span class="op" id="3342021">,</span>&nbsp;<span class="string" id="3342023">&#34;&lt;pre&gt;\n&#34;</span><span class="op" id="3342032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3342035">for</span>&nbsp;<span class="op" id="3342039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3342043">dirs</span><span class="op" id="3342047">,</span>&nbsp;<span class="ident" id="3342049">err</span>&nbsp;<span class="op" id="3342053">:=</span>&nbsp;<span class="ident" id="3342056"><a href="/net/http/fs.go.html#3341937">f</a></span><span class="op" id="3342057">.</span><span class="ident" id="3342058">Readdir</span><span class="op" id="3342065">(</span><span class="num" id="3342066">100</span><span class="op" id="3342069">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3342073">if</span>&nbsp;<span class="ident" id="3342076"><a href="/net/http/fs.go.html#3342049">err</a></span>&nbsp;<span class="op" id="3342080">!=</span>&nbsp;<span class="ident" id="3342083">nil</span>&nbsp;<span class="op" id="3342087">||</span>&nbsp;<span class="builtinfunc" id="3342090">len</span><span class="op" id="3342093">(</span><span class="ident" id="3342094"><a href="/net/http/fs.go.html#3342043">dirs</a></span><span class="op" id="3342098">)</span>&nbsp;<span class="op" id="3342100">==</span>&nbsp;<span class="num" id="3342103">0</span>&nbsp;<span class="op" id="3342105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3342110">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3342118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3342122">for</span>&nbsp;<span class="ident" id="3342126">_</span><span class="op" id="3342127">,</span>&nbsp;<span class="ident" id="3342129">d</span>&nbsp;<span class="op" id="3342131">:=</span>&nbsp;<span class="keyword" id="3342134">range</span>&nbsp;<span class="ident" id="3342140"><a href="/net/http/fs.go.html#3342043">dirs</a></span>&nbsp;<span class="op" id="3342145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3342150">name</span>&nbsp;<span class="op" id="3342155">:=</span>&nbsp;<span class="ident" id="3342158"><a href="/net/http/fs.go.html#3342129">d</a></span><span class="op" id="3342159">.</span><span class="ident" id="3342160">Name</span><span class="op" id="3342164">(</span><span class="op" id="3342165">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3342170">if</span>&nbsp;<span class="ident" id="3342173"><a href="/net/http/fs.go.html#3342129">d</a></span><span class="op" id="3342174">.</span><span class="ident" id="3342175">IsDir</span><span class="op" id="3342180">(</span><span class="op" id="3342181">)</span>&nbsp;<span class="op" id="3342183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3342189"><a href="/net/http/fs.go.html#3342150">name</a></span>&nbsp;<span class="op" id="3342194">+=</span>&nbsp;<span class="string" id="3342197">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3342204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342209">//&nbsp;name&nbsp;may&nbsp;contain&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;which&nbsp;must&nbsp;be&nbsp;escaped&nbsp;to&nbsp;remain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342276">//&nbsp;part&nbsp;of&nbsp;the&nbsp;URL&nbsp;path,&nbsp;and&nbsp;not&nbsp;indicate&nbsp;the&nbsp;start&nbsp;of&nbsp;a&nbsp;query</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342342">//&nbsp;string&nbsp;or&nbsp;fragment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3342368">url</span>&nbsp;<span class="op" id="3342372">:=</span>&nbsp;<span class="ident" id="3342375"><a href="/net/http/fs.go.html#3340436">url</a></span><span class="op" id="3342378">.</span><span class="ident" id="3342379">URL</span><span class="op" id="3342382">{</span><span class="ident" id="3342383">Path</span><span class="op" id="3342387">:</span>&nbsp;<span class="ident" id="3342389"><a href="/net/http/fs.go.html#3342150">name</a></span><span class="op" id="3342393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3342398"><a href="/net/http/fs.go.html#3340380">fmt</a></span><span class="op" id="3342401">.</span><span class="ident" id="3342402">Fprintf</span><span class="op" id="3342409">(</span><span class="ident" id="3342410"><a href="/net/http/fs.go.html#3341919">w</a></span><span class="op" id="3342411">,</span>&nbsp;<span class="string" id="3342413">&#34;&lt;a&nbsp;href=\&#34;%s\&#34;&gt;%s&lt;/a&gt;\n&#34;</span><span class="op" id="3342438">,</span>&nbsp;<span class="ident" id="3342440"><a href="/net/http/fs.go.html#3342368">url</a></span><span class="op" id="3342443">.</span><span class="ident" id="3342444">String</span><span class="op" id="3342450">(</span><span class="op" id="3342451">)</span><span class="op" id="3342452">,</span>&nbsp;<span class="ident" id="3342454"><a href="/net/http/server.go.html#3439459">htmlReplacer</a></span><span class="op" id="3342466">.</span><span class="ident" id="3342467">Replace</span><span class="op" id="3342474">(</span><span class="ident" id="3342475"><a href="/net/http/fs.go.html#3342150">name</a></span><span class="op" id="3342479">)</span><span class="op" id="3342480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3342484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3342487">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3342490"><a href="/net/http/fs.go.html#3340380">fmt</a></span><span class="op" id="3342493">.</span><span class="ident" id="3342494">Fprintf</span><span class="op" id="3342501">(</span><span class="ident" id="3342502"><a href="/net/http/fs.go.html#3341919">w</a></span><span class="op" id="3342503">,</span>&nbsp;<span class="string" id="3342505">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="3342515">)</span><br>
<span class="lineno"></span><span class="op" id="3342517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3342520">//&nbsp;ServeContent&nbsp;replies&nbsp;to&nbsp;the&nbsp;request&nbsp;using&nbsp;the&nbsp;content&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3342584">//&nbsp;provided&nbsp;ReadSeeker.&nbsp;&nbsp;The&nbsp;main&nbsp;benefit&nbsp;of&nbsp;ServeContent&nbsp;over&nbsp;io.Copy</span><br>
<span class="lineno">95</span><span class="comment" id="3342655">//&nbsp;is&nbsp;that&nbsp;it&nbsp;handles&nbsp;Range&nbsp;requests&nbsp;properly,&nbsp;sets&nbsp;the&nbsp;MIME&nbsp;type,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3342726">//&nbsp;handles&nbsp;If-Modified-Since&nbsp;requests.</span><br>
<span class="lineno"></span><span class="comment" id="3342765">//</span><br>
<span class="lineno"></span><span class="comment" id="3342768">//&nbsp;If&nbsp;the&nbsp;response&#39;s&nbsp;Content-Type&nbsp;header&nbsp;is&nbsp;not&nbsp;set,&nbsp;ServeContent</span><br>
<span class="lineno"></span><span class="comment" id="3342834">//&nbsp;first&nbsp;tries&nbsp;to&nbsp;deduce&nbsp;the&nbsp;type&nbsp;from&nbsp;name&#39;s&nbsp;file&nbsp;extension&nbsp;and,</span><br>
<span class="lineno">100</span><span class="comment" id="3342900">//&nbsp;if&nbsp;that&nbsp;fails,&nbsp;falls&nbsp;back&nbsp;to&nbsp;reading&nbsp;the&nbsp;first&nbsp;block&nbsp;of&nbsp;the&nbsp;content</span><br>
<span class="lineno"></span><span class="comment" id="3342971">//&nbsp;and&nbsp;passing&nbsp;it&nbsp;to&nbsp;DetectContentType.</span><br>
<span class="lineno"></span><span class="comment" id="3343011">//&nbsp;The&nbsp;name&nbsp;is&nbsp;otherwise&nbsp;unused;&nbsp;in&nbsp;particular&nbsp;it&nbsp;can&nbsp;be&nbsp;empty&nbsp;and&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3343081">//&nbsp;never&nbsp;sent&nbsp;in&nbsp;the&nbsp;response.</span><br>
<span class="lineno"></span><span class="comment" id="3343112">//</span><br>
<span class="lineno">105</span><span class="comment" id="3343115">//&nbsp;If&nbsp;modtime&nbsp;is&nbsp;not&nbsp;the&nbsp;zero&nbsp;time,&nbsp;ServeContent&nbsp;includes&nbsp;it&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3343181">//&nbsp;Last-Modified&nbsp;header&nbsp;in&nbsp;the&nbsp;response.&nbsp;&nbsp;If&nbsp;the&nbsp;request&nbsp;includes&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3343250">//&nbsp;If-Modified-Since&nbsp;header,&nbsp;ServeContent&nbsp;uses&nbsp;modtime&nbsp;to&nbsp;decide</span><br>
<span class="lineno"></span><span class="comment" id="3343315">//&nbsp;whether&nbsp;the&nbsp;content&nbsp;needs&nbsp;to&nbsp;be&nbsp;sent&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span><span class="comment" id="3343363">//</span><br>
<span class="lineno">110</span><span class="comment" id="3343366">//&nbsp;The&nbsp;content&#39;s&nbsp;Seek&nbsp;method&nbsp;must&nbsp;work:&nbsp;ServeContent&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="3343424">//&nbsp;a&nbsp;seek&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;content&nbsp;to&nbsp;determine&nbsp;its&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="3343483">//</span><br>
<span class="lineno"></span><span class="comment" id="3343486">//&nbsp;If&nbsp;the&nbsp;caller&nbsp;has&nbsp;set&nbsp;w&#39;s&nbsp;ETag&nbsp;header,&nbsp;ServeContent&nbsp;uses&nbsp;it&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3343552">//&nbsp;handle&nbsp;requests&nbsp;using&nbsp;If-Range&nbsp;and&nbsp;If-None-Match.</span><br>
<span class="lineno">115</span><span class="comment" id="3343605">//</span><br>
<span class="lineno"></span><span class="comment" id="3343608">//&nbsp;Note&nbsp;that&nbsp;*os.File&nbsp;implements&nbsp;the&nbsp;io.ReadSeeker&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3343670">func</span>&nbsp;<span class="ident" id="3343675">ServeContent</span><span class="op" id="3343687">(</span><span class="ident" id="3343688">w</span>&nbsp;<span class="ident" id="3343690"><a href="/net/http/server.go.html#3401101">ResponseWriter</a></span><span class="op" id="3343704">,</span>&nbsp;<span class="ident" id="3343706">req</span>&nbsp;<span class="op" id="3343710">*</span><span class="ident" id="3343711"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3343718">,</span>&nbsp;<span class="ident" id="3343720">name</span>&nbsp;<span class="builtintype" id="3343725">string</span><span class="op" id="3343731">,</span>&nbsp;<span class="ident" id="3343733">modtime</span>&nbsp;<span class="ident" id="3343741"><a href="/net/http/fs.go.html#3340500">time</a></span><span class="op" id="3343745">.</span><span class="ident" id="3343746">Time</span><span class="op" id="3343750">,</span>&nbsp;<span class="ident" id="3343752">content</span>&nbsp;<span class="ident" id="3343760"><a href="/net/http/fs.go.html#3340387">io</a></span><span class="op" id="3343762">.</span><span class="ident" id="3343763">ReadSeeker</span><span class="op" id="3343773">)</span>&nbsp;<span class="op" id="3343775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3343778">sizeFunc</span>&nbsp;<span class="op" id="3343787">:=</span>&nbsp;<span class="keyword" id="3343790">func</span><span class="op" id="3343794">(</span><span class="op" id="3343795">)</span>&nbsp;<span class="op" id="3343797">(</span><span class="ident" id="3343798">int64</span><span class="op" id="3343803">,</span>&nbsp;<span class="builtintype" id="3343805">error</span><span class="op" id="3343810">)</span>&nbsp;<span class="op" id="3343812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3343816">size</span><span class="op" id="3343820">,</span>&nbsp;<span class="ident" id="3343822">err</span>&nbsp;<span class="op" id="3343826">:=</span>&nbsp;<span class="ident" id="3343829"><a href="/net/http/fs.go.html#3343752">content</a></span><span class="op" id="3343836">.</span><span class="ident" id="3343837">Seek</span><span class="op" id="3343841">(</span><span class="num" id="3343842">0</span><span class="op" id="3343843">,</span>&nbsp;<span class="ident" id="3343845"><a href="/net/http/fs.go.html#3340447">os</a></span><span class="op" id="3343847">.</span><span class="ident" id="3343848">SEEK_END</span><span class="op" id="3343856">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3343860">if</span>&nbsp;<span class="ident" id="3343863"><a href="/net/http/fs.go.html#3343822">err</a></span>&nbsp;<span class="op" id="3343867">!=</span>&nbsp;<span class="ident" id="3343870">nil</span>&nbsp;<span class="op" id="3343874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3343879">return</span>&nbsp;<span class="num" id="3343886">0</span><span class="op" id="3343887">,</span>&nbsp;<span class="ident" id="3343889"><a href="/net/http/fs.go.html#3344287">errSeeker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3343901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3343905">_</span><span class="op" id="3343906">,</span>&nbsp;<span class="ident" id="3343908"><a href="/net/http/fs.go.html#3343822">err</a></span>&nbsp;<span class="op" id="3343912">=</span>&nbsp;<span class="ident" id="3343914"><a href="/net/http/fs.go.html#3343752">content</a></span><span class="op" id="3343921">.</span><span class="ident" id="3343922">Seek</span><span class="op" id="3343926">(</span><span class="num" id="3343927">0</span><span class="op" id="3343928">,</span>&nbsp;<span class="ident" id="3343930"><a href="/net/http/fs.go.html#3340447">os</a></span><span class="op" id="3343932">.</span><span class="ident" id="3343933">SEEK_SET</span><span class="op" id="3343941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3343945">if</span>&nbsp;<span class="ident" id="3343948"><a href="/net/http/fs.go.html#3343822">err</a></span>&nbsp;<span class="op" id="3343952">!=</span>&nbsp;<span class="ident" id="3343955">nil</span>&nbsp;<span class="op" id="3343959">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3343964">return</span>&nbsp;<span class="num" id="3343971">0</span><span class="op" id="3343972">,</span>&nbsp;<span class="ident" id="3343974"><a href="/net/http/fs.go.html#3344287">errSeeker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3343986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3343990">return</span>&nbsp;<span class="ident" id="3343997"><a href="/net/http/fs.go.html#3343816">size</a></span><span class="op" id="3344001">,</span>&nbsp;<span class="ident" id="3344003">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3344008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3344011"><a href="/net/http/fs.go.html#3344606">serveContent</a></span><span class="op" id="3344023">(</span><span class="ident" id="3344024"><a href="/net/http/fs.go.html#3343688">w</a></span><span class="op" id="3344025">,</span>&nbsp;<span class="ident" id="3344027"><a href="/net/http/fs.go.html#3343706">req</a></span><span class="op" id="3344030">,</span>&nbsp;<span class="ident" id="3344032"><a href="/net/http/fs.go.html#3343720">name</a></span><span class="op" id="3344036">,</span>&nbsp;<span class="ident" id="3344038"><a href="/net/http/fs.go.html#3343733">modtime</a></span><span class="op" id="3344045">,</span>&nbsp;<span class="ident" id="3344047"><a href="/net/http/fs.go.html#3343778">sizeFunc</a></span><span class="op" id="3344055">,</span>&nbsp;<span class="ident" id="3344057"><a href="/net/http/fs.go.html#3343752">content</a></span><span class="op" id="3344064">)</span><br>
<span class="lineno">130</span><span class="op" id="3344066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3344069">//&nbsp;errSeeker&nbsp;is&nbsp;returned&nbsp;by&nbsp;ServeContent&#39;s&nbsp;sizeFunc&nbsp;when&nbsp;the&nbsp;content</span><br>
<span class="lineno"></span><span class="comment" id="3344138">//&nbsp;doesn&#39;t&nbsp;seek&nbsp;properly.&nbsp;The&nbsp;underlying&nbsp;Seeker&#39;s&nbsp;error&nbsp;text&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="3344205">//&nbsp;included&nbsp;in&nbsp;the&nbsp;sizeFunc&nbsp;reply&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;sent&nbsp;over&nbsp;HTTP&nbsp;to&nbsp;end</span><br>
<span class="lineno">135</span><span class="comment" id="3344273">//&nbsp;users.</span><br>
<span class="lineno"></span><span class="keyword" id="3344283">var</span>&nbsp;<span class="ident" id="3344287">errSeeker</span>&nbsp;<span class="op" id="3344297">=</span>&nbsp;<span class="ident" id="3344299"><a href="/net/http/fs.go.html#3340370">errors</a></span><span class="op" id="3344305">.</span><span class="ident" id="3344306">New</span><span class="op" id="3344309">(</span><span class="string" id="3344310">&#34;seeker&nbsp;can&#39;t&nbsp;seek&#34;</span><span class="op" id="3344329">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3344332">//&nbsp;if&nbsp;name&nbsp;is&nbsp;empty,&nbsp;filename&nbsp;is&nbsp;unknown.&nbsp;(used&nbsp;for&nbsp;mime&nbsp;type,&nbsp;before&nbsp;sniffing)</span><br>
<span class="lineno"></span><span class="comment" id="3344412">//&nbsp;if&nbsp;modtime.IsZero(),&nbsp;modtime&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno">140</span><span class="comment" id="3344456">//&nbsp;content&nbsp;must&nbsp;be&nbsp;seeked&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="3344512">//&nbsp;The&nbsp;sizeFunc&nbsp;is&nbsp;called&nbsp;at&nbsp;most&nbsp;once.&nbsp;Its&nbsp;error,&nbsp;if&nbsp;any,&nbsp;is&nbsp;sent&nbsp;in&nbsp;the&nbsp;HTTP&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="3344601">func</span>&nbsp;<span class="ident" id="3344606">serveContent</span><span class="op" id="3344618">(</span><span class="ident" id="3344619">w</span>&nbsp;<span class="ident" id="3344621"><a href="/net/http/server.go.html#3401101">ResponseWriter</a></span><span class="op" id="3344635">,</span>&nbsp;<span class="ident" id="3344637">r</span>&nbsp;<span class="op" id="3344639">*</span><span class="ident" id="3344640"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3344647">,</span>&nbsp;<span class="ident" id="3344649">name</span>&nbsp;<span class="builtintype" id="3344654">string</span><span class="op" id="3344660">,</span>&nbsp;<span class="ident" id="3344662">modtime</span>&nbsp;<span class="ident" id="3344670"><a href="/net/http/fs.go.html#3340500">time</a></span><span class="op" id="3344674">.</span><span class="ident" id="3344675">Time</span><span class="op" id="3344679">,</span>&nbsp;<span class="ident" id="3344681">sizeFunc</span>&nbsp;<span class="keyword" id="3344690">func</span><span class="op" id="3344694">(</span><span class="op" id="3344695">)</span>&nbsp;<span class="op" id="3344697">(</span><span class="ident" id="3344698">int64</span><span class="op" id="3344703">,</span>&nbsp;<span class="builtintype" id="3344705">error</span><span class="op" id="3344710">)</span><span class="op" id="3344711">,</span>&nbsp;<span class="ident" id="3344713">content</span>&nbsp;<span class="ident" id="3344721"><a href="/net/http/fs.go.html#3340387">io</a></span><span class="op" id="3344723">.</span><span class="ident" id="3344724">ReadSeeker</span><span class="op" id="3344734">)</span>&nbsp;<span class="op" id="3344736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3344739">if</span>&nbsp;<span class="ident" id="3344742"><a href="/net/http/fs.go.html#3348236">checkLastModified</a></span><span class="op" id="3344759">(</span><span class="ident" id="3344760"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3344761">,</span>&nbsp;<span class="ident" id="3344763"><a href="/net/http/fs.go.html#3344637">r</a></span><span class="op" id="3344764">,</span>&nbsp;<span class="ident" id="3344766"><a href="/net/http/fs.go.html#3344662">modtime</a></span><span class="op" id="3344773">)</span>&nbsp;<span class="op" id="3344775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3344779">return</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3344787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3344790">rangeReq</span><span class="op" id="3344798">,</span>&nbsp;<span class="ident" id="3344800">done</span>&nbsp;<span class="op" id="3344805">:=</span>&nbsp;<span class="ident" id="3344808"><a href="/net/http/fs.go.html#3349198">checkETag</a></span><span class="op" id="3344817">(</span><span class="ident" id="3344818"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3344819">,</span>&nbsp;<span class="ident" id="3344821"><a href="/net/http/fs.go.html#3344637">r</a></span><span class="op" id="3344822">,</span>&nbsp;<span class="ident" id="3344824"><a href="/net/http/fs.go.html#3344662">modtime</a></span><span class="op" id="3344831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3344834">if</span>&nbsp;<span class="ident" id="3344837"><a href="/net/http/fs.go.html#3344800">done</a></span>&nbsp;<span class="op" id="3344842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3344846">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3344854">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3344858">code</span>&nbsp;<span class="op" id="3344863">:=</span>&nbsp;<span class="ident" id="3344866"><a href="/net/http/status.go.html#3466742">StatusOK</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344877">//&nbsp;If&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;set,&nbsp;use&nbsp;the&nbsp;file&#39;s&nbsp;extension&nbsp;to&nbsp;find&nbsp;it,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344949">//&nbsp;if&nbsp;the&nbsp;Content-Type&nbsp;is&nbsp;unset&nbsp;explicitly,&nbsp;do&nbsp;not&nbsp;sniff&nbsp;the&nbsp;type.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345017">ctypes</span><span class="op" id="3345023">,</span>&nbsp;<span class="ident" id="3345025">haveType</span>&nbsp;<span class="op" id="3345034">:=</span>&nbsp;<span class="ident" id="3345037"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3345038">.</span><span class="ident" id="3345039">Header</span><span class="op" id="3345045">(</span><span class="op" id="3345046">)</span><span class="op" id="3345047">[</span><span class="string" id="3345048">&#34;Content-Type&#34;</span><span class="op" id="3345062">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345065">var</span>&nbsp;<span class="ident" id="3345069">ctype</span>&nbsp;<span class="builtintype" id="3345075">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345083">if</span>&nbsp;<span class="op" id="3345086">!</span><span class="ident" id="3345087"><a href="/net/http/fs.go.html#3345025">haveType</a></span>&nbsp;<span class="op" id="3345096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345100"><a href="/net/http/fs.go.html#3345069">ctype</a></span>&nbsp;<span class="op" id="3345106">=</span>&nbsp;<span class="ident" id="3345108"><a href="/net/http/fs.go.html#3340393">mime</a></span><span class="op" id="3345112">.</span><span class="ident" id="3345113">TypeByExtension</span><span class="op" id="3345128">(</span><span class="ident" id="3345129"><a href="/net/http/fs.go.html#3340461">filepath</a></span><span class="op" id="3345137">.</span><span class="ident" id="3345138">Ext</span><span class="op" id="3345141">(</span><span class="ident" id="3345142"><a href="/net/http/fs.go.html#3344649">name</a></span><span class="op" id="3345146">)</span><span class="op" id="3345147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345151">if</span>&nbsp;<span class="ident" id="3345154"><a href="/net/http/fs.go.html#3345069">ctype</a></span>&nbsp;<span class="op" id="3345160">==</span>&nbsp;<span class="string" id="3345163">&#34;&#34;</span>&nbsp;<span class="op" id="3345166">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345171">//&nbsp;read&nbsp;a&nbsp;chunk&nbsp;to&nbsp;decide&nbsp;between&nbsp;utf-8&nbsp;text&nbsp;and&nbsp;binary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345230">var</span>&nbsp;<span class="ident" id="3345234">buf</span>&nbsp;<span class="op" id="3345238">[</span><span class="ident" id="3345239"><a href="/net/http/sniff.go.html#3461444">sniffLen</a></span><span class="op" id="3345247">]</span><span class="builtintype" id="3345248">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345256">n</span><span class="op" id="3345257">,</span>&nbsp;<span class="ident" id="3345259">_</span>&nbsp;<span class="op" id="3345261">:=</span>&nbsp;<span class="ident" id="3345264"><a href="/net/http/fs.go.html#3340387">io</a></span><span class="op" id="3345266">.</span><span class="ident" id="3345267">ReadFull</span><span class="op" id="3345275">(</span><span class="ident" id="3345276"><a href="/net/http/fs.go.html#3344713">content</a></span><span class="op" id="3345283">,</span>&nbsp;<span class="ident" id="3345285"><a href="/net/http/fs.go.html#3345234">buf</a></span><span class="op" id="3345288">[</span><span class="op" id="3345289">:</span><span class="op" id="3345290">]</span><span class="op" id="3345291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345296"><a href="/net/http/fs.go.html#3345069">ctype</a></span>&nbsp;<span class="op" id="3345302">=</span>&nbsp;<span class="ident" id="3345304"><a href="/net/http/sniff.go.html#3461809">DetectContentType</a></span><span class="op" id="3345321">(</span><span class="ident" id="3345322"><a href="/net/http/fs.go.html#3345234">buf</a></span><span class="op" id="3345325">[</span><span class="op" id="3345326">:</span><span class="ident" id="3345327"><a href="/net/http/fs.go.html#3345256">n</a></span><span class="op" id="3345328">]</span><span class="op" id="3345329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345334">_</span><span class="op" id="3345335">,</span>&nbsp;<span class="ident" id="3345337">err</span>&nbsp;<span class="op" id="3345341">:=</span>&nbsp;<span class="ident" id="3345344"><a href="/net/http/fs.go.html#3344713">content</a></span><span class="op" id="3345351">.</span><span class="ident" id="3345352">Seek</span><span class="op" id="3345356">(</span><span class="num" id="3345357">0</span><span class="op" id="3345358">,</span>&nbsp;<span class="ident" id="3345360"><a href="/net/http/fs.go.html#3340447">os</a></span><span class="op" id="3345362">.</span><span class="ident" id="3345363">SEEK_SET</span><span class="op" id="3345371">)</span>&nbsp;<span class="comment" id="3345373">//&nbsp;rewind&nbsp;to&nbsp;output&nbsp;whole&nbsp;file</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345407">if</span>&nbsp;<span class="ident" id="3345410"><a href="/net/http/fs.go.html#3345337">err</a></span>&nbsp;<span class="op" id="3345414">!=</span>&nbsp;<span class="ident" id="3345417">nil</span>&nbsp;<span class="op" id="3345421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345427"><a href="/net/http/server.go.html#3436450">Error</a></span><span class="op" id="3345432">(</span><span class="ident" id="3345433"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3345434">,</span>&nbsp;<span class="string" id="3345436">&#34;seeker&nbsp;can&#39;t&nbsp;seek&#34;</span><span class="op" id="3345455">,</span>&nbsp;<span class="ident" id="3345457"><a href="/net/http/status.go.html#3467998">StatusInternalServerError</a></span><span class="op" id="3345482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345488">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3345498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3345502">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345506"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3345507">.</span><span class="ident" id="3345508">Header</span><span class="op" id="3345514">(</span><span class="op" id="3345515">)</span><span class="op" id="3345516">.</span><span class="ident" id="3345517">Set</span><span class="op" id="3345520">(</span><span class="string" id="3345521">&#34;Content-Type&#34;</span><span class="op" id="3345535">,</span>&nbsp;<span class="ident" id="3345537"><a href="/net/http/fs.go.html#3345069">ctype</a></span><span class="op" id="3345542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3345545">}</span>&nbsp;<span class="keyword" id="3345547">else</span>&nbsp;<span class="keyword" id="3345552">if</span>&nbsp;<span class="builtinfunc" id="3345555">len</span><span class="op" id="3345558">(</span><span class="ident" id="3345559"><a href="/net/http/fs.go.html#3345017">ctypes</a></span><span class="op" id="3345565">)</span>&nbsp;<span class="op" id="3345567">&gt;</span>&nbsp;<span class="num" id="3345569">0</span>&nbsp;<span class="op" id="3345571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345575"><a href="/net/http/fs.go.html#3345069">ctype</a></span>&nbsp;<span class="op" id="3345581">=</span>&nbsp;<span class="ident" id="3345583"><a href="/net/http/fs.go.html#3345017">ctypes</a></span><span class="op" id="3345589">[</span><span class="num" id="3345590">0</span><span class="op" id="3345591">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3345594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345598">size</span><span class="op" id="3345602">,</span>&nbsp;<span class="ident" id="3345604">err</span>&nbsp;<span class="op" id="3345608">:=</span>&nbsp;<span class="ident" id="3345611"><a href="/net/http/fs.go.html#3344681">sizeFunc</a></span><span class="op" id="3345619">(</span><span class="op" id="3345620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345623">if</span>&nbsp;<span class="ident" id="3345626"><a href="/net/http/fs.go.html#3345604">err</a></span>&nbsp;<span class="op" id="3345630">!=</span>&nbsp;<span class="ident" id="3345633">nil</span>&nbsp;<span class="op" id="3345637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345641"><a href="/net/http/server.go.html#3436450">Error</a></span><span class="op" id="3345646">(</span><span class="ident" id="3345647"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3345648">,</span>&nbsp;<span class="ident" id="3345650"><a href="/net/http/fs.go.html#3345604">err</a></span><span class="op" id="3345653">.</span><span class="ident" id="3345654">Error</span><span class="op" id="3345659">(</span><span class="op" id="3345660">)</span><span class="op" id="3345661">,</span>&nbsp;<span class="ident" id="3345663"><a href="/net/http/status.go.html#3467998">StatusInternalServerError</a></span><span class="op" id="3345688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345692">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3345700">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345704">//&nbsp;handle&nbsp;Content-Range&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345737">sendSize</span>&nbsp;<span class="op" id="3345746">:=</span>&nbsp;<span class="ident" id="3345749"><a href="/net/http/fs.go.html#3345598">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345755">var</span>&nbsp;<span class="ident" id="3345759">sendContent</span>&nbsp;<span class="ident" id="3345771"><a href="/net/http/fs.go.html#3340387">io</a></span><span class="op" id="3345773">.</span><span class="ident" id="3345774">Reader</span>&nbsp;<span class="op" id="3345781">=</span>&nbsp;<span class="ident" id="3345783"><a href="/net/http/fs.go.html#3344713">content</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345792">if</span>&nbsp;<span class="ident" id="3345795"><a href="/net/http/fs.go.html#3345598">size</a></span>&nbsp;<span class="op" id="3345800">&gt;=</span>&nbsp;<span class="num" id="3345803">0</span>&nbsp;<span class="op" id="3345805">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345809">ranges</span><span class="op" id="3345815">,</span>&nbsp;<span class="ident" id="3345817">err</span>&nbsp;<span class="op" id="3345821">:=</span>&nbsp;<span class="ident" id="3345824"><a href="/net/http/fs.go.html#3354155">parseRange</a></span><span class="op" id="3345834">(</span><span class="ident" id="3345835"><a href="/net/http/fs.go.html#3344790">rangeReq</a></span><span class="op" id="3345843">,</span>&nbsp;<span class="ident" id="3345845"><a href="/net/http/fs.go.html#3345598">size</a></span><span class="op" id="3345849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345853">if</span>&nbsp;<span class="ident" id="3345856"><a href="/net/http/fs.go.html#3345817">err</a></span>&nbsp;<span class="op" id="3345860">!=</span>&nbsp;<span class="ident" id="3345863">nil</span>&nbsp;<span class="op" id="3345867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345872"><a href="/net/http/server.go.html#3436450">Error</a></span><span class="op" id="3345877">(</span><span class="ident" id="3345878"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3345879">,</span>&nbsp;<span class="ident" id="3345881"><a href="/net/http/fs.go.html#3345817">err</a></span><span class="op" id="3345884">.</span><span class="ident" id="3345885">Error</span><span class="op" id="3345890">(</span><span class="op" id="3345891">)</span><span class="op" id="3345892">,</span>&nbsp;<span class="ident" id="3345894"><a href="/net/http/status.go.html#3467871">StatusRequestedRangeNotSatisfiable</a></span><span class="op" id="3345928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345933">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3345942">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345946">if</span>&nbsp;<span class="ident" id="3345949"><a href="/net/http/fs.go.html#3356182">sumRangesSize</a></span><span class="op" id="3345962">(</span><span class="ident" id="3345963"><a href="/net/http/fs.go.html#3345809">ranges</a></span><span class="op" id="3345969">)</span>&nbsp;<span class="op" id="3345971">&gt;</span>&nbsp;<span class="ident" id="3345973"><a href="/net/http/fs.go.html#3345598">size</a></span>&nbsp;<span class="op" id="3345978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345983">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;all&nbsp;the&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346033">//&nbsp;is&nbsp;larger&nbsp;than&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;file&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346078">//&nbsp;itself,&nbsp;so&nbsp;this&nbsp;is&nbsp;probably&nbsp;an&nbsp;attack,&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346128">//&nbsp;dumb&nbsp;client.&nbsp;&nbsp;Ignore&nbsp;the&nbsp;range&nbsp;request.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346174"><a href="/net/http/fs.go.html#3345809">ranges</a></span>&nbsp;<span class="op" id="3346181">=</span>&nbsp;<span class="ident" id="3346183">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346193">switch</span>&nbsp;<span class="op" id="3346200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346204">case</span>&nbsp;<span class="builtinfunc" id="3346209">len</span><span class="op" id="3346212">(</span><span class="ident" id="3346213"><a href="/net/http/fs.go.html#3345809">ranges</a></span><span class="op" id="3346219">)</span>&nbsp;<span class="op" id="3346221">==</span>&nbsp;<span class="num" id="3346224">1</span><span class="op" id="3346225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346230">//&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;14.16:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346261">//&nbsp;&#34;When&nbsp;an&nbsp;HTTP&nbsp;message&nbsp;includes&nbsp;the&nbsp;content&nbsp;of&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346322">//&nbsp;range&nbsp;(for&nbsp;example,&nbsp;a&nbsp;response&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346378">//&nbsp;single&nbsp;range,&nbsp;or&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;a&nbsp;set&nbsp;of&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346434">//&nbsp;that&nbsp;overlap&nbsp;without&nbsp;any&nbsp;holes),&nbsp;this&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346489">//&nbsp;transmitted&nbsp;with&nbsp;a&nbsp;Content-Range&nbsp;header,&nbsp;and&nbsp;a</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346542">//&nbsp;Content-Length&nbsp;header&nbsp;showing&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346598">//&nbsp;actually&nbsp;transferred.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346626">//&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346636">//&nbsp;A&nbsp;response&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;a&nbsp;single&nbsp;range&nbsp;MUST&nbsp;NOT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346694">//&nbsp;be&nbsp;sent&nbsp;using&nbsp;the&nbsp;multipart/byteranges&nbsp;media&nbsp;type.&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346752">ra</span>&nbsp;<span class="op" id="3346755">:=</span>&nbsp;<span class="ident" id="3346758"><a href="/net/http/fs.go.html#3345809">ranges</a></span><span class="op" id="3346764">[</span><span class="num" id="3346765">0</span><span class="op" id="3346766">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346771">if</span>&nbsp;<span class="ident" id="3346774">_</span><span class="op" id="3346775">,</span>&nbsp;<span class="ident" id="3346777">err</span>&nbsp;<span class="op" id="3346781">:=</span>&nbsp;<span class="ident" id="3346784"><a href="/net/http/fs.go.html#3344713">content</a></span><span class="op" id="3346791">.</span><span class="ident" id="3346792">Seek</span><span class="op" id="3346796">(</span><span class="ident" id="3346797"><a href="/net/http/fs.go.html#3346752">ra</a></span><span class="op" id="3346799">.</span><span class="ident" id="3346800">start</span><span class="op" id="3346805">,</span>&nbsp;<span class="ident" id="3346807"><a href="/net/http/fs.go.html#3340447">os</a></span><span class="op" id="3346809">.</span><span class="ident" id="3346810">SEEK_SET</span><span class="op" id="3346818">)</span><span class="op" id="3346819">;</span>&nbsp;<span class="ident" id="3346821"><a href="/net/http/fs.go.html#3346777">err</a></span>&nbsp;<span class="op" id="3346825">!=</span>&nbsp;<span class="ident" id="3346828">nil</span>&nbsp;<span class="op" id="3346832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346838"><a href="/net/http/server.go.html#3436450">Error</a></span><span class="op" id="3346843">(</span><span class="ident" id="3346844"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3346845">,</span>&nbsp;<span class="ident" id="3346847"><a href="/net/http/fs.go.html#3346777">err</a></span><span class="op" id="3346850">.</span><span class="ident" id="3346851">Error</span><span class="op" id="3346856">(</span><span class="op" id="3346857">)</span><span class="op" id="3346858">,</span>&nbsp;<span class="ident" id="3346860"><a href="/net/http/status.go.html#3467871">StatusRequestedRangeNotSatisfiable</a></span><span class="op" id="3346894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346900">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346910">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346915"><a href="/net/http/fs.go.html#3345737">sendSize</a></span>&nbsp;<span class="op" id="3346924">=</span>&nbsp;<span class="ident" id="3346926"><a href="/net/http/fs.go.html#3346752">ra</a></span><span class="op" id="3346928">.</span><span class="ident" id="3346929">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346939"><a href="/net/http/fs.go.html#3344858">code</a></span>&nbsp;<span class="op" id="3346944">=</span>&nbsp;<span class="ident" id="3346946"><a href="/net/http/status.go.html#3466946">StatusPartialContent</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346970"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3346971">.</span><span class="ident" id="3346972">Header</span><span class="op" id="3346978">(</span><span class="op" id="3346979">)</span><span class="op" id="3346980">.</span><span class="ident" id="3346981">Set</span><span class="op" id="3346984">(</span><span class="string" id="3346985">&#34;Content-Range&#34;</span><span class="op" id="3347000">,</span>&nbsp;<span class="ident" id="3347002"><a href="/net/http/fs.go.html#3346752">ra</a></span><span class="op" id="3347004">.</span><span class="ident" id="3347005">contentRange</span><span class="op" id="3347017">(</span><span class="ident" id="3347018"><a href="/net/http/fs.go.html#3345598">size</a></span><span class="op" id="3347022">)</span><span class="op" id="3347023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347027">case</span>&nbsp;<span class="builtinfunc" id="3347032">len</span><span class="op" id="3347035">(</span><span class="ident" id="3347036"><a href="/net/http/fs.go.html#3345809">ranges</a></span><span class="op" id="3347042">)</span>&nbsp;<span class="op" id="3347044">&gt;</span>&nbsp;<span class="num" id="3347046">1</span><span class="op" id="3347047">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347052"><a href="/net/http/fs.go.html#3345737">sendSize</a></span>&nbsp;<span class="op" id="3347061">=</span>&nbsp;<span class="ident" id="3347063"><a href="/net/http/fs.go.html#3355876">rangesMIMESize</a></span><span class="op" id="3347077">(</span><span class="ident" id="3347078"><a href="/net/http/fs.go.html#3345809">ranges</a></span><span class="op" id="3347084">,</span>&nbsp;<span class="ident" id="3347086"><a href="/net/http/fs.go.html#3345069">ctype</a></span><span class="op" id="3347091">,</span>&nbsp;<span class="ident" id="3347093"><a href="/net/http/fs.go.html#3345598">size</a></span><span class="op" id="3347097">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347102"><a href="/net/http/fs.go.html#3344858">code</a></span>&nbsp;<span class="op" id="3347107">=</span>&nbsp;<span class="ident" id="3347109"><a href="/net/http/status.go.html#3466946">StatusPartialContent</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347134">pr</span><span class="op" id="3347136">,</span>&nbsp;<span class="ident" id="3347138">pw</span>&nbsp;<span class="op" id="3347141">:=</span>&nbsp;<span class="ident" id="3347144"><a href="/net/http/fs.go.html#3340387">io</a></span><span class="op" id="3347146">.</span><span class="ident" id="3347147">Pipe</span><span class="op" id="3347151">(</span><span class="op" id="3347152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347157">mw</span>&nbsp;<span class="op" id="3347160">:=</span>&nbsp;<span class="ident" id="3347163"><a href="/net/http/fs.go.html#3340401">multipart</a></span><span class="op" id="3347172">.</span><span class="ident" id="3347173">NewWriter</span><span class="op" id="3347182">(</span><span class="ident" id="3347183"><a href="/net/http/fs.go.html#3347138">pw</a></span><span class="op" id="3347185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347190"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3347191">.</span><span class="ident" id="3347192">Header</span><span class="op" id="3347198">(</span><span class="op" id="3347199">)</span><span class="op" id="3347200">.</span><span class="ident" id="3347201">Set</span><span class="op" id="3347204">(</span><span class="string" id="3347205">&#34;Content-Type&#34;</span><span class="op" id="3347219">,</span>&nbsp;<span class="string" id="3347221">&#34;multipart/byteranges;&nbsp;boundary=&#34;</span><span class="op" id="3347254">+</span><span class="ident" id="3347255"><a href="/net/http/fs.go.html#3347157">mw</a></span><span class="op" id="3347257">.</span><span class="ident" id="3347258">Boundary</span><span class="op" id="3347266">(</span><span class="op" id="3347267">)</span><span class="op" id="3347268">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347273"><a href="/net/http/fs.go.html#3345759">sendContent</a></span>&nbsp;<span class="op" id="3347285">=</span>&nbsp;<span class="ident" id="3347287"><a href="/net/http/fs.go.html#3347134">pr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347293">defer</span>&nbsp;<span class="ident" id="3347299"><a href="/net/http/fs.go.html#3347134">pr</a></span><span class="op" id="3347301">.</span><span class="ident" id="3347302">Close</span><span class="op" id="3347307">(</span><span class="op" id="3347308">)</span>&nbsp;<span class="comment" id="3347310">//&nbsp;cause&nbsp;writing&nbsp;goroutine&nbsp;to&nbsp;fail&nbsp;and&nbsp;exit&nbsp;if&nbsp;CopyN&nbsp;doesn&#39;t&nbsp;finish.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347382">go</span>&nbsp;<span class="keyword" id="3347385">func</span><span class="op" id="3347389">(</span><span class="op" id="3347390">)</span>&nbsp;<span class="op" id="3347392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347398">for</span>&nbsp;<span class="ident" id="3347402">_</span><span class="op" id="3347403">,</span>&nbsp;<span class="ident" id="3347405">ra</span>&nbsp;<span class="op" id="3347408">:=</span>&nbsp;<span class="keyword" id="3347411">range</span>&nbsp;<span class="ident" id="3347417"><a href="/net/http/fs.go.html#3345809">ranges</a></span>&nbsp;<span class="op" id="3347424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347431">part</span><span class="op" id="3347435">,</span>&nbsp;<span class="ident" id="3347437">err</span>&nbsp;<span class="op" id="3347441">:=</span>&nbsp;<span class="ident" id="3347444"><a href="/net/http/fs.go.html#3347157">mw</a></span><span class="op" id="3347446">.</span><span class="ident" id="3347447">CreatePart</span><span class="op" id="3347457">(</span><span class="ident" id="3347458"><a href="/net/http/fs.go.html#3347405">ra</a></span><span class="op" id="3347460">.</span><span class="ident" id="3347461">mimeHeader</span><span class="op" id="3347471">(</span><span class="ident" id="3347472"><a href="/net/http/fs.go.html#3345069">ctype</a></span><span class="op" id="3347477">,</span>&nbsp;<span class="ident" id="3347479"><a href="/net/http/fs.go.html#3345598">size</a></span><span class="op" id="3347483">)</span><span class="op" id="3347484">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347491">if</span>&nbsp;<span class="ident" id="3347494"><a href="/net/http/fs.go.html#3347437">err</a></span>&nbsp;<span class="op" id="3347498">!=</span>&nbsp;<span class="ident" id="3347501">nil</span>&nbsp;<span class="op" id="3347505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347513"><a href="/net/http/fs.go.html#3347138">pw</a></span><span class="op" id="3347515">.</span><span class="ident" id="3347516">CloseWithError</span><span class="op" id="3347530">(</span><span class="ident" id="3347531"><a href="/net/http/fs.go.html#3347437">err</a></span><span class="op" id="3347534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347542">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347561">if</span>&nbsp;<span class="ident" id="3347564">_</span><span class="op" id="3347565">,</span>&nbsp;<span class="ident" id="3347567">err</span>&nbsp;<span class="op" id="3347571">:=</span>&nbsp;<span class="ident" id="3347574"><a href="/net/http/fs.go.html#3344713">content</a></span><span class="op" id="3347581">.</span><span class="ident" id="3347582">Seek</span><span class="op" id="3347586">(</span><span class="ident" id="3347587"><a href="/net/http/fs.go.html#3347405">ra</a></span><span class="op" id="3347589">.</span><span class="ident" id="3347590">start</span><span class="op" id="3347595">,</span>&nbsp;<span class="ident" id="3347597"><a href="/net/http/fs.go.html#3340447">os</a></span><span class="op" id="3347599">.</span><span class="ident" id="3347600">SEEK_SET</span><span class="op" id="3347608">)</span><span class="op" id="3347609">;</span>&nbsp;<span class="ident" id="3347611"><a href="/net/http/fs.go.html#3347567">err</a></span>&nbsp;<span class="op" id="3347615">!=</span>&nbsp;<span class="ident" id="3347618">nil</span>&nbsp;<span class="op" id="3347622">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347630"><a href="/net/http/fs.go.html#3347138">pw</a></span><span class="op" id="3347632">.</span><span class="ident" id="3347633">CloseWithError</span><span class="op" id="3347647">(</span><span class="ident" id="3347648"><a href="/net/http/fs.go.html#3347567">err</a></span><span class="op" id="3347651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347659">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347678">if</span>&nbsp;<span class="ident" id="3347681">_</span><span class="op" id="3347682">,</span>&nbsp;<span class="ident" id="3347684">err</span>&nbsp;<span class="op" id="3347688">:=</span>&nbsp;<span class="ident" id="3347691"><a href="/net/http/fs.go.html#3340387">io</a></span><span class="op" id="3347693">.</span><span class="ident" id="3347694">CopyN</span><span class="op" id="3347699">(</span><span class="ident" id="3347700"><a href="/net/http/fs.go.html#3347431">part</a></span><span class="op" id="3347704">,</span>&nbsp;<span class="ident" id="3347706"><a href="/net/http/fs.go.html#3344713">content</a></span><span class="op" id="3347713">,</span>&nbsp;<span class="ident" id="3347715"><a href="/net/http/fs.go.html#3347405">ra</a></span><span class="op" id="3347717">.</span><span class="ident" id="3347718">length</span><span class="op" id="3347724">)</span><span class="op" id="3347725">;</span>&nbsp;<span class="ident" id="3347727"><a href="/net/http/fs.go.html#3347684">err</a></span>&nbsp;<span class="op" id="3347731">!=</span>&nbsp;<span class="ident" id="3347734">nil</span>&nbsp;<span class="op" id="3347738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347746"><a href="/net/http/fs.go.html#3347138">pw</a></span><span class="op" id="3347748">.</span><span class="ident" id="3347749">CloseWithError</span><span class="op" id="3347763">(</span><span class="ident" id="3347764"><a href="/net/http/fs.go.html#3347684">err</a></span><span class="op" id="3347767">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347775">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347799"><a href="/net/http/fs.go.html#3347157">mw</a></span><span class="op" id="3347801">.</span><span class="ident" id="3347802">Close</span><span class="op" id="3347807">(</span><span class="op" id="3347808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347814"><a href="/net/http/fs.go.html#3347138">pw</a></span><span class="op" id="3347816">.</span><span class="ident" id="3347817">Close</span><span class="op" id="3347822">(</span><span class="op" id="3347823">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347828">}</span><span class="op" id="3347829">(</span><span class="op" id="3347830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347839"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3347840">.</span><span class="ident" id="3347841">Header</span><span class="op" id="3347847">(</span><span class="op" id="3347848">)</span><span class="op" id="3347849">.</span><span class="ident" id="3347850">Set</span><span class="op" id="3347853">(</span><span class="string" id="3347854">&#34;Accept-Ranges&#34;</span><span class="op" id="3347869">,</span>&nbsp;<span class="string" id="3347871">&#34;bytes&#34;</span><span class="op" id="3347878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347882">if</span>&nbsp;<span class="ident" id="3347885"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3347886">.</span><span class="ident" id="3347887">Header</span><span class="op" id="3347893">(</span><span class="op" id="3347894">)</span><span class="op" id="3347895">.</span><span class="ident" id="3347896">Get</span><span class="op" id="3347899">(</span><span class="string" id="3347900">&#34;Content-Encoding&#34;</span><span class="op" id="3347918">)</span>&nbsp;<span class="op" id="3347920">==</span>&nbsp;<span class="string" id="3347923">&#34;&#34;</span>&nbsp;<span class="op" id="3347926">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347931"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3347932">.</span><span class="ident" id="3347933">Header</span><span class="op" id="3347939">(</span><span class="op" id="3347940">)</span><span class="op" id="3347941">.</span><span class="ident" id="3347942">Set</span><span class="op" id="3347945">(</span><span class="string" id="3347946">&#34;Content-Length&#34;</span><span class="op" id="3347962">,</span>&nbsp;<span class="ident" id="3347964"><a href="/net/http/fs.go.html#3340478">strconv</a></span><span class="op" id="3347971">.</span><span class="ident" id="3347972">FormatInt</span><span class="op" id="3347981">(</span><span class="ident" id="3347982"><a href="/net/http/fs.go.html#3345737">sendSize</a></span><span class="op" id="3347990">,</span>&nbsp;<span class="num" id="3347992">10</span><span class="op" id="3347994">)</span><span class="op" id="3347995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348006"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3348007">.</span><span class="ident" id="3348008">WriteHeader</span><span class="op" id="3348019">(</span><span class="ident" id="3348020"><a href="/net/http/fs.go.html#3344858">code</a></span><span class="op" id="3348024">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348028">if</span>&nbsp;<span class="ident" id="3348031"><a href="/net/http/fs.go.html#3344637">r</a></span><span class="op" id="3348032">.</span><span class="ident" id="3348033">Method</span>&nbsp;<span class="op" id="3348040">!=</span>&nbsp;<span class="string" id="3348043">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3348050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348054"><a href="/net/http/fs.go.html#3340387">io</a></span><span class="op" id="3348056">.</span><span class="ident" id="3348057">CopyN</span><span class="op" id="3348062">(</span><span class="ident" id="3348063"><a href="/net/http/fs.go.html#3344619">w</a></span><span class="op" id="3348064">,</span>&nbsp;<span class="ident" id="3348066"><a href="/net/http/fs.go.html#3345759">sendContent</a></span><span class="op" id="3348077">,</span>&nbsp;<span class="ident" id="3348079"><a href="/net/http/fs.go.html#3345737">sendSize</a></span><span class="op" id="3348087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348090">}</span><br>
<span class="lineno"></span><span class="op" id="3348092">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="3348095">//&nbsp;modtime&nbsp;is&nbsp;the&nbsp;modification&nbsp;time&nbsp;of&nbsp;the&nbsp;resource&nbsp;to&nbsp;be&nbsp;served,&nbsp;or&nbsp;IsZero().</span><br>
<span class="lineno"></span><span class="comment" id="3348174">//&nbsp;return&nbsp;value&nbsp;is&nbsp;whether&nbsp;this&nbsp;request&nbsp;is&nbsp;now&nbsp;complete.</span><br>
<span class="lineno"></span><span class="keyword" id="3348231">func</span>&nbsp;<span class="ident" id="3348236">checkLastModified</span><span class="op" id="3348253">(</span><span class="ident" id="3348254">w</span>&nbsp;<span class="ident" id="3348256"><a href="/net/http/server.go.html#3401101">ResponseWriter</a></span><span class="op" id="3348270">,</span>&nbsp;<span class="ident" id="3348272">r</span>&nbsp;<span class="op" id="3348274">*</span><span class="ident" id="3348275"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3348282">,</span>&nbsp;<span class="ident" id="3348284">modtime</span>&nbsp;<span class="ident" id="3348292"><a href="/net/http/fs.go.html#3340500">time</a></span><span class="op" id="3348296">.</span><span class="ident" id="3348297">Time</span><span class="op" id="3348301">)</span>&nbsp;<span class="builtintype" id="3348303">bool</span>&nbsp;<span class="op" id="3348308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348311">if</span>&nbsp;<span class="ident" id="3348314"><a href="/net/http/fs.go.html#3348284">modtime</a></span><span class="op" id="3348321">.</span><span class="ident" id="3348322">IsZero</span><span class="op" id="3348328">(</span><span class="op" id="3348329">)</span>&nbsp;<span class="op" id="3348331">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348335">return</span>&nbsp;<span class="builtintype" id="3348342">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348353">//&nbsp;The&nbsp;Date-Modified&nbsp;header&nbsp;truncates&nbsp;sub-second&nbsp;precision,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348417">//&nbsp;use&nbsp;mtime&nbsp;&lt;&nbsp;t+1s&nbsp;instead&nbsp;of&nbsp;mtime&nbsp;&lt;=&nbsp;t&nbsp;to&nbsp;check&nbsp;for&nbsp;unmodified.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348485">if</span>&nbsp;<span class="ident" id="3348488">t</span><span class="op" id="3348489">,</span>&nbsp;<span class="ident" id="3348491">err</span>&nbsp;<span class="op" id="3348495">:=</span>&nbsp;<span class="ident" id="3348498"><a href="/net/http/fs.go.html#3340500">time</a></span><span class="op" id="3348502">.</span><span class="ident" id="3348503">Parse</span><span class="op" id="3348508">(</span><span class="ident" id="3348509"><a href="/net/http/server.go.html#3414785">TimeFormat</a></span><span class="op" id="3348519">,</span>&nbsp;<span class="ident" id="3348521"><a href="/net/http/fs.go.html#3348272">r</a></span><span class="op" id="3348522">.</span><span class="ident" id="3348523">Header</span><span class="op" id="3348529">.</span><span class="ident" id="3348530">Get</span><span class="op" id="3348533">(</span><span class="string" id="3348534">&#34;If-Modified-Since&#34;</span><span class="op" id="3348553">)</span><span class="op" id="3348554">)</span><span class="op" id="3348555">;</span>&nbsp;<span class="ident" id="3348557"><a href="/net/http/fs.go.html#3348491">err</a></span>&nbsp;<span class="op" id="3348561">==</span>&nbsp;<span class="ident" id="3348564">nil</span>&nbsp;<span class="op" id="3348568">&amp;&amp;</span>&nbsp;<span class="ident" id="3348571"><a href="/net/http/fs.go.html#3348284">modtime</a></span><span class="op" id="3348578">.</span><span class="ident" id="3348579">Before</span><span class="op" id="3348585">(</span><span class="ident" id="3348586"><a href="/net/http/fs.go.html#3348488">t</a></span><span class="op" id="3348587">.</span><span class="ident" id="3348588">Add</span><span class="op" id="3348591">(</span><span class="num" id="3348592">1</span><span class="op" id="3348593">*</span><span class="ident" id="3348594"><a href="/net/http/fs.go.html#3340500">time</a></span><span class="op" id="3348598">.</span><span class="ident" id="3348599">Second</span><span class="op" id="3348605">)</span><span class="op" id="3348606">)</span>&nbsp;<span class="op" id="3348608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348612">h</span>&nbsp;<span class="op" id="3348614">:=</span>&nbsp;<span class="ident" id="3348617"><a href="/net/http/fs.go.html#3348254">w</a></span><span class="op" id="3348618">.</span><span class="ident" id="3348619">Header</span><span class="op" id="3348625">(</span><span class="op" id="3348626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3348630">delete</span><span class="op" id="3348636">(</span><span class="ident" id="3348637"><a href="/net/http/fs.go.html#3348612">h</a></span><span class="op" id="3348638">,</span>&nbsp;<span class="string" id="3348640">&#34;Content-Type&#34;</span><span class="op" id="3348654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3348658">delete</span><span class="op" id="3348664">(</span><span class="ident" id="3348665"><a href="/net/http/fs.go.html#3348612">h</a></span><span class="op" id="3348666">,</span>&nbsp;<span class="string" id="3348668">&#34;Content-Length&#34;</span><span class="op" id="3348684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348688"><a href="/net/http/fs.go.html#3348254">w</a></span><span class="op" id="3348689">.</span><span class="ident" id="3348690">WriteHeader</span><span class="op" id="3348701">(</span><span class="ident" id="3348702"><a href="/net/http/status.go.html#3467105">StatusNotModified</a></span><span class="op" id="3348719">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348723">return</span>&nbsp;<span class="builtintype" id="3348730">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348739"><a href="/net/http/fs.go.html#3348254">w</a></span><span class="op" id="3348740">.</span><span class="ident" id="3348741">Header</span><span class="op" id="3348747">(</span><span class="op" id="3348748">)</span><span class="op" id="3348749">.</span><span class="ident" id="3348750">Set</span><span class="op" id="3348753">(</span><span class="string" id="3348754">&#34;Last-Modified&#34;</span><span class="op" id="3348769">,</span>&nbsp;<span class="ident" id="3348771"><a href="/net/http/fs.go.html#3348284">modtime</a></span><span class="op" id="3348778">.</span><span class="ident" id="3348779">UTC</span><span class="op" id="3348782">(</span><span class="op" id="3348783">)</span><span class="op" id="3348784">.</span><span class="ident" id="3348785">Format</span><span class="op" id="3348791">(</span><span class="ident" id="3348792"><a href="/net/http/server.go.html#3414785">TimeFormat</a></span><span class="op" id="3348802">)</span><span class="op" id="3348803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348806">return</span>&nbsp;<span class="builtintype" id="3348813">false</span><br>
<span class="lineno"></span><span class="op" id="3348819">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3348822">//&nbsp;checkETag&nbsp;implements&nbsp;If-None-Match&nbsp;and&nbsp;If-Range&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="3348881">//</span><br>
<span class="lineno"></span><span class="comment" id="3348884">//&nbsp;The&nbsp;ETag&nbsp;or&nbsp;modtime&nbsp;must&nbsp;have&nbsp;been&nbsp;previously&nbsp;set&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3348944">//&nbsp;ResponseWriter&#39;s&nbsp;headers.&nbsp;&nbsp;The&nbsp;modtime&nbsp;is&nbsp;only&nbsp;compared&nbsp;at&nbsp;second</span><br>
<span class="lineno">285</span><span class="comment" id="3349013">//&nbsp;granularity&nbsp;and&nbsp;may&nbsp;be&nbsp;the&nbsp;zero&nbsp;value&nbsp;to&nbsp;mean&nbsp;unknown.</span><br>
<span class="lineno"></span><span class="comment" id="3349071">//</span><br>
<span class="lineno"></span><span class="comment" id="3349074">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;effective&nbsp;request&nbsp;&#34;Range&#34;&nbsp;header&nbsp;to&nbsp;use&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3349145">//&nbsp;whether&nbsp;this&nbsp;request&nbsp;is&nbsp;now&nbsp;considered&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="3349193">func</span>&nbsp;<span class="ident" id="3349198">checkETag</span><span class="op" id="3349207">(</span><span class="ident" id="3349208">w</span>&nbsp;<span class="ident" id="3349210"><a href="/net/http/server.go.html#3401101">ResponseWriter</a></span><span class="op" id="3349224">,</span>&nbsp;<span class="ident" id="3349226">r</span>&nbsp;<span class="op" id="3349228">*</span><span class="ident" id="3349229"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3349236">,</span>&nbsp;<span class="ident" id="3349238">modtime</span>&nbsp;<span class="ident" id="3349246"><a href="/net/http/fs.go.html#3340500">time</a></span><span class="op" id="3349250">.</span><span class="ident" id="3349251">Time</span><span class="op" id="3349255">)</span>&nbsp;<span class="op" id="3349257">(</span><span class="ident" id="3349258">rangeReq</span>&nbsp;<span class="builtintype" id="3349267">string</span><span class="op" id="3349273">,</span>&nbsp;<span class="ident" id="3349275">done</span>&nbsp;<span class="builtintype" id="3349280">bool</span><span class="op" id="3349284">)</span>&nbsp;<span class="op" id="3349286">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349289">etag</span>&nbsp;<span class="op" id="3349294">:=</span>&nbsp;<span class="ident" id="3349297"><a href="/net/http/fs.go.html#3349208">w</a></span><span class="op" id="3349298">.</span><span class="ident" id="3349299">Header</span><span class="op" id="3349305">(</span><span class="op" id="3349306">)</span><span class="op" id="3349307">.</span><span class="ident" id="3349308">get</span><span class="op" id="3349311">(</span><span class="string" id="3349312">&#34;Etag&#34;</span><span class="op" id="3349318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349321"><a href="/net/http/fs.go.html#3349258">rangeReq</a></span>&nbsp;<span class="op" id="3349330">=</span>&nbsp;<span class="ident" id="3349332"><a href="/net/http/fs.go.html#3349226">r</a></span><span class="op" id="3349333">.</span><span class="ident" id="3349334">Header</span><span class="op" id="3349340">.</span><span class="ident" id="3349341">get</span><span class="op" id="3349344">(</span><span class="string" id="3349345">&#34;Range&#34;</span><span class="op" id="3349352">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349356">//&nbsp;Invalidate&nbsp;the&nbsp;range&nbsp;request&nbsp;if&nbsp;the&nbsp;entity&nbsp;doesn&#39;t&nbsp;match&nbsp;the&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349425">//&nbsp;the&nbsp;client&nbsp;was&nbsp;expecting.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349455">//&nbsp;&#34;If-Range:&nbsp;version&#34;&nbsp;means&nbsp;&#34;ignore&nbsp;the&nbsp;Range:&nbsp;header&nbsp;unless&nbsp;version&nbsp;matches&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349538">//&nbsp;current&nbsp;file.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349557">//&nbsp;We&nbsp;only&nbsp;support&nbsp;ETag&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349592">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;have&nbsp;set&nbsp;the&nbsp;ETag&nbsp;on&nbsp;the&nbsp;response&nbsp;already.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349655">if</span>&nbsp;<span class="ident" id="3349658">ir</span>&nbsp;<span class="op" id="3349661">:=</span>&nbsp;<span class="ident" id="3349664"><a href="/net/http/fs.go.html#3349226">r</a></span><span class="op" id="3349665">.</span><span class="ident" id="3349666">Header</span><span class="op" id="3349672">.</span><span class="ident" id="3349673">get</span><span class="op" id="3349676">(</span><span class="string" id="3349677">&#34;If-Range&#34;</span><span class="op" id="3349687">)</span><span class="op" id="3349688">;</span>&nbsp;<span class="ident" id="3349690"><a href="/net/http/fs.go.html#3349658">ir</a></span>&nbsp;<span class="op" id="3349693">!=</span>&nbsp;<span class="string" id="3349696">&#34;&#34;</span>&nbsp;<span class="op" id="3349699">&amp;&amp;</span>&nbsp;<span class="ident" id="3349702"><a href="/net/http/fs.go.html#3349658">ir</a></span>&nbsp;<span class="op" id="3349705">!=</span>&nbsp;<span class="ident" id="3349708"><a href="/net/http/fs.go.html#3349289">etag</a></span>&nbsp;<span class="op" id="3349713">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349717">//&nbsp;The&nbsp;If-Range&nbsp;value&nbsp;is&nbsp;typically&nbsp;the&nbsp;ETag&nbsp;value,&nbsp;but&nbsp;it&nbsp;may&nbsp;also&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349789">//&nbsp;the&nbsp;modtime&nbsp;date.&nbsp;See&nbsp;golang.org/issue/8367.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349839">timeMatches</span>&nbsp;<span class="op" id="3349851">:=</span>&nbsp;<span class="builtintype" id="3349854">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349862">if</span>&nbsp;<span class="op" id="3349865">!</span><span class="ident" id="3349866"><a href="/net/http/fs.go.html#3349238">modtime</a></span><span class="op" id="3349873">.</span><span class="ident" id="3349874">IsZero</span><span class="op" id="3349880">(</span><span class="op" id="3349881">)</span>&nbsp;<span class="op" id="3349883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349888">if</span>&nbsp;<span class="ident" id="3349891">t</span><span class="op" id="3349892">,</span>&nbsp;<span class="ident" id="3349894">err</span>&nbsp;<span class="op" id="3349898">:=</span>&nbsp;<span class="ident" id="3349901"><a href="/net/http/header.go.html#3358207">ParseTime</a></span><span class="op" id="3349910">(</span><span class="ident" id="3349911"><a href="/net/http/fs.go.html#3349658">ir</a></span><span class="op" id="3349913">)</span><span class="op" id="3349914">;</span>&nbsp;<span class="ident" id="3349916"><a href="/net/http/fs.go.html#3349894">err</a></span>&nbsp;<span class="op" id="3349920">==</span>&nbsp;<span class="ident" id="3349923">nil</span>&nbsp;<span class="op" id="3349927">&amp;&amp;</span>&nbsp;<span class="ident" id="3349930"><a href="/net/http/fs.go.html#3349891">t</a></span><span class="op" id="3349931">.</span><span class="ident" id="3349932">Unix</span><span class="op" id="3349936">(</span><span class="op" id="3349937">)</span>&nbsp;<span class="op" id="3349939">==</span>&nbsp;<span class="ident" id="3349942"><a href="/net/http/fs.go.html#3349238">modtime</a></span><span class="op" id="3349949">.</span><span class="ident" id="3349950">Unix</span><span class="op" id="3349954">(</span><span class="op" id="3349955">)</span>&nbsp;<span class="op" id="3349957">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349963"><a href="/net/http/fs.go.html#3349839">timeMatches</a></span>&nbsp;<span class="op" id="3349975">=</span>&nbsp;<span class="builtintype" id="3349977">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349993">if</span>&nbsp;<span class="op" id="3349996">!</span><span class="ident" id="3349997"><a href="/net/http/fs.go.html#3349839">timeMatches</a></span>&nbsp;<span class="op" id="3350009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350014"><a href="/net/http/fs.go.html#3349258">rangeReq</a></span>&nbsp;<span class="op" id="3350023">=</span>&nbsp;<span class="string" id="3350025">&#34;&#34;</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350037">if</span>&nbsp;<span class="ident" id="3350040">inm</span>&nbsp;<span class="op" id="3350044">:=</span>&nbsp;<span class="ident" id="3350047"><a href="/net/http/fs.go.html#3349226">r</a></span><span class="op" id="3350048">.</span><span class="ident" id="3350049">Header</span><span class="op" id="3350055">.</span><span class="ident" id="3350056">get</span><span class="op" id="3350059">(</span><span class="string" id="3350060">&#34;If-None-Match&#34;</span><span class="op" id="3350075">)</span><span class="op" id="3350076">;</span>&nbsp;<span class="ident" id="3350078"><a href="/net/http/fs.go.html#3350040">inm</a></span>&nbsp;<span class="op" id="3350082">!=</span>&nbsp;<span class="string" id="3350085">&#34;&#34;</span>&nbsp;<span class="op" id="3350088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350092">//&nbsp;Must&nbsp;know&nbsp;ETag.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350113">if</span>&nbsp;<span class="ident" id="3350116"><a href="/net/http/fs.go.html#3349289">etag</a></span>&nbsp;<span class="op" id="3350121">==</span>&nbsp;<span class="string" id="3350124">&#34;&#34;</span>&nbsp;<span class="op" id="3350127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350132">return</span>&nbsp;<span class="ident" id="3350139"><a href="/net/http/fs.go.html#3349258">rangeReq</a></span><span class="op" id="3350147">,</span>&nbsp;<span class="builtintype" id="3350149">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350162">//&nbsp;TODO(bradfitz):&nbsp;non-GET/HEAD&nbsp;requests&nbsp;require&nbsp;more&nbsp;work:</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350224">//&nbsp;sending&nbsp;a&nbsp;different&nbsp;status&nbsp;code&nbsp;on&nbsp;matches,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350277">//&nbsp;also&nbsp;can&#39;t&nbsp;use&nbsp;weak&nbsp;cache&nbsp;validators&nbsp;(those&nbsp;with&nbsp;a&nbsp;&#34;W/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350337">//&nbsp;prefix).&nbsp;&nbsp;But&nbsp;most&nbsp;users&nbsp;of&nbsp;ServeContent&nbsp;will&nbsp;be&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350397">//&nbsp;it&nbsp;on&nbsp;GET&nbsp;or&nbsp;HEAD,&nbsp;so&nbsp;only&nbsp;support&nbsp;those&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350452">if</span>&nbsp;<span class="ident" id="3350455"><a href="/net/http/fs.go.html#3349226">r</a></span><span class="op" id="3350456">.</span><span class="ident" id="3350457">Method</span>&nbsp;<span class="op" id="3350464">!=</span>&nbsp;<span class="string" id="3350467">&#34;GET&#34;</span>&nbsp;<span class="op" id="3350473">&amp;&amp;</span>&nbsp;<span class="ident" id="3350476"><a href="/net/http/fs.go.html#3349226">r</a></span><span class="op" id="3350477">.</span><span class="ident" id="3350478">Method</span>&nbsp;<span class="op" id="3350485">!=</span>&nbsp;<span class="string" id="3350488">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3350495">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350500">return</span>&nbsp;<span class="ident" id="3350507"><a href="/net/http/fs.go.html#3349258">rangeReq</a></span><span class="op" id="3350515">,</span>&nbsp;<span class="builtintype" id="3350517">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350530">//&nbsp;TODO(bradfitz):&nbsp;deal&nbsp;with&nbsp;comma-separated&nbsp;or&nbsp;multiple-valued</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350596">//&nbsp;list&nbsp;of&nbsp;If-None-match&nbsp;values.&nbsp;&nbsp;For&nbsp;now&nbsp;just&nbsp;handle&nbsp;the&nbsp;common</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350663">//&nbsp;case&nbsp;of&nbsp;a&nbsp;single&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350691">if</span>&nbsp;<span class="ident" id="3350694"><a href="/net/http/fs.go.html#3350040">inm</a></span>&nbsp;<span class="op" id="3350698">==</span>&nbsp;<span class="ident" id="3350701"><a href="/net/http/fs.go.html#3349289">etag</a></span>&nbsp;<span class="op" id="3350706">||</span>&nbsp;<span class="ident" id="3350709"><a href="/net/http/fs.go.html#3350040">inm</a></span>&nbsp;<span class="op" id="3350713">==</span>&nbsp;<span class="string" id="3350716">&#34;*&#34;</span>&nbsp;<span class="op" id="3350720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350725">h</span>&nbsp;<span class="op" id="3350727">:=</span>&nbsp;<span class="ident" id="3350730"><a href="/net/http/fs.go.html#3349208">w</a></span><span class="op" id="3350731">.</span><span class="ident" id="3350732">Header</span><span class="op" id="3350738">(</span><span class="op" id="3350739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3350744">delete</span><span class="op" id="3350750">(</span><span class="ident" id="3350751"><a href="/net/http/fs.go.html#3350725">h</a></span><span class="op" id="3350752">,</span>&nbsp;<span class="string" id="3350754">&#34;Content-Type&#34;</span><span class="op" id="3350768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3350773">delete</span><span class="op" id="3350779">(</span><span class="ident" id="3350780"><a href="/net/http/fs.go.html#3350725">h</a></span><span class="op" id="3350781">,</span>&nbsp;<span class="string" id="3350783">&#34;Content-Length&#34;</span><span class="op" id="3350799">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350804"><a href="/net/http/fs.go.html#3349208">w</a></span><span class="op" id="3350805">.</span><span class="ident" id="3350806">WriteHeader</span><span class="op" id="3350817">(</span><span class="ident" id="3350818"><a href="/net/http/status.go.html#3467105">StatusNotModified</a></span><span class="op" id="3350835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350840">return</span>&nbsp;<span class="string" id="3350847">&#34;&#34;</span><span class="op" id="3350849">,</span>&nbsp;<span class="builtintype" id="3350851">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350864">return</span>&nbsp;<span class="ident" id="3350871"><a href="/net/http/fs.go.html#3349258">rangeReq</a></span><span class="op" id="3350879">,</span>&nbsp;<span class="builtintype" id="3350881">false</span><br>
<span class="lineno">340</span><span class="op" id="3350887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3350890">//&nbsp;name&nbsp;is&nbsp;&#39;/&#39;-separated,&nbsp;not&nbsp;filepath.Separator.</span><br>
<span class="lineno"></span><span class="keyword" id="3350940">func</span>&nbsp;<span class="ident" id="3350945">serveFile</span><span class="op" id="3350954">(</span><span class="ident" id="3350955">w</span>&nbsp;<span class="ident" id="3350957"><a href="/net/http/server.go.html#3401101">ResponseWriter</a></span><span class="op" id="3350971">,</span>&nbsp;<span class="ident" id="3350973">r</span>&nbsp;<span class="op" id="3350975">*</span><span class="ident" id="3350976"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3350983">,</span>&nbsp;<span class="ident" id="3350985">fs</span>&nbsp;<span class="ident" id="3350988"><a href="/net/http/fs.go.html#3341508">FileSystem</a></span><span class="op" id="3350998">,</span>&nbsp;<span class="ident" id="3351000">name</span>&nbsp;<span class="builtintype" id="3351005">string</span><span class="op" id="3351011">,</span>&nbsp;<span class="ident" id="3351013">redirect</span>&nbsp;<span class="builtintype" id="3351022">bool</span><span class="op" id="3351026">)</span>&nbsp;<span class="op" id="3351028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351031">const</span>&nbsp;<span class="ident" id="3351037">indexPage</span>&nbsp;<span class="op" id="3351047">=</span>&nbsp;<span class="string" id="3351049">&#34;/index.html&#34;</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3351065">//&nbsp;redirect&nbsp;.../index.html&nbsp;to&nbsp;.../</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3351101">//&nbsp;can&#39;t&nbsp;use&nbsp;Redirect()&nbsp;because&nbsp;that&nbsp;would&nbsp;make&nbsp;the&nbsp;path&nbsp;absolute,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3351169">//&nbsp;which&nbsp;would&nbsp;be&nbsp;a&nbsp;problem&nbsp;running&nbsp;under&nbsp;StripPrefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351224">if</span>&nbsp;<span class="ident" id="3351227"><a href="/net/http/fs.go.html#3340489">strings</a></span><span class="op" id="3351234">.</span><span class="ident" id="3351235">HasSuffix</span><span class="op" id="3351244">(</span><span class="ident" id="3351245"><a href="/net/http/fs.go.html#3350973">r</a></span><span class="op" id="3351246">.</span><span class="ident" id="3351247">URL</span><span class="op" id="3351250">.</span><span class="ident" id="3351251">Path</span><span class="op" id="3351255">,</span>&nbsp;<span class="ident" id="3351257"><a href="/net/http/fs.go.html#3351037">indexPage</a></span><span class="op" id="3351266">)</span>&nbsp;<span class="op" id="3351268">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351272"><a href="/net/http/fs.go.html#3352630">localRedirect</a></span><span class="op" id="3351285">(</span><span class="ident" id="3351286"><a href="/net/http/fs.go.html#3350955">w</a></span><span class="op" id="3351287">,</span>&nbsp;<span class="ident" id="3351289"><a href="/net/http/fs.go.html#3350973">r</a></span><span class="op" id="3351290">,</span>&nbsp;<span class="string" id="3351292">&#34;./&#34;</span><span class="op" id="3351296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351300">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351312">f</span><span class="op" id="3351313">,</span>&nbsp;<span class="ident" id="3351315">err</span>&nbsp;<span class="op" id="3351319">:=</span>&nbsp;<span class="ident" id="3351322"><a href="/net/http/fs.go.html#3350985">fs</a></span><span class="op" id="3351324">.</span><span class="ident" id="3351325">Open</span><span class="op" id="3351329">(</span><span class="ident" id="3351330"><a href="/net/http/fs.go.html#3351000">name</a></span><span class="op" id="3351334">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351337">if</span>&nbsp;<span class="ident" id="3351340"><a href="/net/http/fs.go.html#3351315">err</a></span>&nbsp;<span class="op" id="3351344">!=</span>&nbsp;<span class="ident" id="3351347">nil</span>&nbsp;<span class="op" id="3351351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3351355">//&nbsp;TODO&nbsp;expose&nbsp;actual&nbsp;error?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351386"><a href="/net/http/server.go.html#3436683">NotFound</a></span><span class="op" id="3351394">(</span><span class="ident" id="3351395"><a href="/net/http/fs.go.html#3350955">w</a></span><span class="op" id="3351396">,</span>&nbsp;<span class="ident" id="3351398"><a href="/net/http/fs.go.html#3350973">r</a></span><span class="op" id="3351399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351403">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351411">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351414">defer</span>&nbsp;<span class="ident" id="3351420"><a href="/net/http/fs.go.html#3351312">f</a></span><span class="op" id="3351421">.</span><span class="ident" id="3351422">Close</span><span class="op" id="3351427">(</span><span class="op" id="3351428">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351432">d</span><span class="op" id="3351433">,</span>&nbsp;<span class="ident" id="3351435">err1</span>&nbsp;<span class="op" id="3351440">:=</span>&nbsp;<span class="ident" id="3351443"><a href="/net/http/fs.go.html#3351312">f</a></span><span class="op" id="3351444">.</span><span class="ident" id="3351445">Stat</span><span class="op" id="3351449">(</span><span class="op" id="3351450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351453">if</span>&nbsp;<span class="ident" id="3351456"><a href="/net/http/fs.go.html#3351435">err1</a></span>&nbsp;<span class="op" id="3351461">!=</span>&nbsp;<span class="ident" id="3351464">nil</span>&nbsp;<span class="op" id="3351468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3351472">//&nbsp;TODO&nbsp;expose&nbsp;actual&nbsp;error?</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351503"><a href="/net/http/server.go.html#3436683">NotFound</a></span><span class="op" id="3351511">(</span><span class="ident" id="3351512"><a href="/net/http/fs.go.html#3350955">w</a></span><span class="op" id="3351513">,</span>&nbsp;<span class="ident" id="3351515"><a href="/net/http/fs.go.html#3350973">r</a></span><span class="op" id="3351516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351520">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351532">if</span>&nbsp;<span class="ident" id="3351535"><a href="/net/http/fs.go.html#3351013">redirect</a></span>&nbsp;<span class="op" id="3351544">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3351548">//&nbsp;redirect&nbsp;to&nbsp;canonical&nbsp;path:&nbsp;/&nbsp;at&nbsp;end&nbsp;of&nbsp;directory&nbsp;url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3351607">//&nbsp;r.URL.Path&nbsp;always&nbsp;begins&nbsp;with&nbsp;/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351644">url</span>&nbsp;<span class="op" id="3351648">:=</span>&nbsp;<span class="ident" id="3351651"><a href="/net/http/fs.go.html#3350973">r</a></span><span class="op" id="3351652">.</span><span class="ident" id="3351653">URL</span><span class="op" id="3351656">.</span><span class="ident" id="3351657">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351664">if</span>&nbsp;<span class="ident" id="3351667"><a href="/net/http/fs.go.html#3351432">d</a></span><span class="op" id="3351668">.</span><span class="ident" id="3351669">IsDir</span><span class="op" id="3351674">(</span><span class="op" id="3351675">)</span>&nbsp;<span class="op" id="3351677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351682">if</span>&nbsp;<span class="ident" id="3351685"><a href="/net/http/fs.go.html#3351644">url</a></span><span class="op" id="3351688">[</span><span class="builtinfunc" id="3351689">len</span><span class="op" id="3351692">(</span><span class="ident" id="3351693"><a href="/net/http/fs.go.html#3351644">url</a></span><span class="op" id="3351696">)</span><span class="op" id="3351697">-</span><span class="num" id="3351698">1</span><span class="op" id="3351699">]</span>&nbsp;<span class="op" id="3351701">!=</span>&nbsp;<span class="string" id="3351704">&#39;/&#39;</span>&nbsp;<span class="op" id="3351708">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351714"><a href="/net/http/fs.go.html#3352630">localRedirect</a></span><span class="op" id="3351727">(</span><span class="ident" id="3351728"><a href="/net/http/fs.go.html#3350955">w</a></span><span class="op" id="3351729">,</span>&nbsp;<span class="ident" id="3351731"><a href="/net/http/fs.go.html#3350973">r</a></span><span class="op" id="3351732">,</span>&nbsp;<span class="ident" id="3351734"><a href="/net/http/fs.go.html#3340453">path</a></span><span class="op" id="3351738">.</span><span class="ident" id="3351739">Base</span><span class="op" id="3351743">(</span><span class="ident" id="3351744"><a href="/net/http/fs.go.html#3351644">url</a></span><span class="op" id="3351747">)</span><span class="op" id="3351748">+</span><span class="string" id="3351749">&#34;/&#34;</span><span class="op" id="3351752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351758">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351772">}</span>&nbsp;<span class="keyword" id="3351774">else</span>&nbsp;<span class="op" id="3351779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351784">if</span>&nbsp;<span class="ident" id="3351787"><a href="/net/http/fs.go.html#3351644">url</a></span><span class="op" id="3351790">[</span><span class="builtinfunc" id="3351791">len</span><span class="op" id="3351794">(</span><span class="ident" id="3351795"><a href="/net/http/fs.go.html#3351644">url</a></span><span class="op" id="3351798">)</span><span class="op" id="3351799">-</span><span class="num" id="3351800">1</span><span class="op" id="3351801">]</span>&nbsp;<span class="op" id="3351803">==</span>&nbsp;<span class="string" id="3351806">&#39;/&#39;</span>&nbsp;<span class="op" id="3351810">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351816"><a href="/net/http/fs.go.html#3352630">localRedirect</a></span><span class="op" id="3351829">(</span><span class="ident" id="3351830"><a href="/net/http/fs.go.html#3350955">w</a></span><span class="op" id="3351831">,</span>&nbsp;<span class="ident" id="3351833"><a href="/net/http/fs.go.html#3350973">r</a></span><span class="op" id="3351834">,</span>&nbsp;<span class="string" id="3351836">&#34;../&#34;</span><span class="op" id="3351841">+</span><span class="ident" id="3351842"><a href="/net/http/fs.go.html#3340453">path</a></span><span class="op" id="3351846">.</span><span class="ident" id="3351847">Base</span><span class="op" id="3351851">(</span><span class="ident" id="3351852"><a href="/net/http/fs.go.html#3351644">url</a></span><span class="op" id="3351855">)</span><span class="op" id="3351856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351862">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351879">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3351883">//&nbsp;use&nbsp;contents&nbsp;of&nbsp;index.html&nbsp;for&nbsp;directory,&nbsp;if&nbsp;present</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351940">if</span>&nbsp;<span class="ident" id="3351943"><a href="/net/http/fs.go.html#3351432">d</a></span><span class="op" id="3351944">.</span><span class="ident" id="3351945">IsDir</span><span class="op" id="3351950">(</span><span class="op" id="3351951">)</span>&nbsp;<span class="op" id="3351953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351957">index</span>&nbsp;<span class="op" id="3351963">:=</span>&nbsp;<span class="ident" id="3351966"><a href="/net/http/fs.go.html#3340489">strings</a></span><span class="op" id="3351973">.</span><span class="ident" id="3351974">TrimSuffix</span><span class="op" id="3351984">(</span><span class="ident" id="3351985"><a href="/net/http/fs.go.html#3351000">name</a></span><span class="op" id="3351989">,</span>&nbsp;<span class="string" id="3351991">&#34;/&#34;</span><span class="op" id="3351994">)</span>&nbsp;<span class="op" id="3351996">+</span>&nbsp;<span class="ident" id="3351998"><a href="/net/http/fs.go.html#3351037">indexPage</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352010">ff</span><span class="op" id="3352012">,</span>&nbsp;<span class="ident" id="3352014">err</span>&nbsp;<span class="op" id="3352018">:=</span>&nbsp;<span class="ident" id="3352021"><a href="/net/http/fs.go.html#3350985">fs</a></span><span class="op" id="3352023">.</span><span class="ident" id="3352024">Open</span><span class="op" id="3352028">(</span><span class="ident" id="3352029"><a href="/net/http/fs.go.html#3351957">index</a></span><span class="op" id="3352034">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352038">if</span>&nbsp;<span class="ident" id="3352041"><a href="/net/http/fs.go.html#3352014">err</a></span>&nbsp;<span class="op" id="3352045">==</span>&nbsp;<span class="ident" id="3352048">nil</span>&nbsp;<span class="op" id="3352052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352057">defer</span>&nbsp;<span class="ident" id="3352063"><a href="/net/http/fs.go.html#3352010">ff</a></span><span class="op" id="3352065">.</span><span class="ident" id="3352066">Close</span><span class="op" id="3352071">(</span><span class="op" id="3352072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352077">dd</span><span class="op" id="3352079">,</span>&nbsp;<span class="ident" id="3352081">err</span>&nbsp;<span class="op" id="3352085">:=</span>&nbsp;<span class="ident" id="3352088"><a href="/net/http/fs.go.html#3352010">ff</a></span><span class="op" id="3352090">.</span><span class="ident" id="3352091">Stat</span><span class="op" id="3352095">(</span><span class="op" id="3352096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352101">if</span>&nbsp;<span class="ident" id="3352104"><a href="/net/http/fs.go.html#3352081">err</a></span>&nbsp;<span class="op" id="3352108">==</span>&nbsp;<span class="ident" id="3352111">nil</span>&nbsp;<span class="op" id="3352115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352121"><a href="/net/http/fs.go.html#3351000">name</a></span>&nbsp;<span class="op" id="3352126">=</span>&nbsp;<span class="ident" id="3352128"><a href="/net/http/fs.go.html#3351957">index</a></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352138"><a href="/net/http/fs.go.html#3351432">d</a></span>&nbsp;<span class="op" id="3352140">=</span>&nbsp;<span class="ident" id="3352142"><a href="/net/http/fs.go.html#3352077">dd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352149"><a href="/net/http/fs.go.html#3351312">f</a></span>&nbsp;<span class="op" id="3352151">=</span>&nbsp;<span class="ident" id="3352153"><a href="/net/http/fs.go.html#3352010">ff</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352166">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3352170">//&nbsp;Still&nbsp;a&nbsp;directory?&nbsp;(we&nbsp;didn&#39;t&nbsp;find&nbsp;an&nbsp;index.html&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352229">if</span>&nbsp;<span class="ident" id="3352232"><a href="/net/http/fs.go.html#3351432">d</a></span><span class="op" id="3352233">.</span><span class="ident" id="3352234">IsDir</span><span class="op" id="3352239">(</span><span class="op" id="3352240">)</span>&nbsp;<span class="op" id="3352242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352246">if</span>&nbsp;<span class="ident" id="3352249"><a href="/net/http/fs.go.html#3348236">checkLastModified</a></span><span class="op" id="3352266">(</span><span class="ident" id="3352267"><a href="/net/http/fs.go.html#3350955">w</a></span><span class="op" id="3352268">,</span>&nbsp;<span class="ident" id="3352270"><a href="/net/http/fs.go.html#3350973">r</a></span><span class="op" id="3352271">,</span>&nbsp;<span class="ident" id="3352273"><a href="/net/http/fs.go.html#3351432">d</a></span><span class="op" id="3352274">.</span><span class="ident" id="3352275">ModTime</span><span class="op" id="3352282">(</span><span class="op" id="3352283">)</span><span class="op" id="3352284">)</span>&nbsp;<span class="op" id="3352286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352291">return</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352304"><a href="/net/http/fs.go.html#3341911">dirList</a></span><span class="op" id="3352311">(</span><span class="ident" id="3352312"><a href="/net/http/fs.go.html#3350955">w</a></span><span class="op" id="3352313">,</span>&nbsp;<span class="ident" id="3352315"><a href="/net/http/fs.go.html#3351312">f</a></span><span class="op" id="3352316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352320">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3352332">//&nbsp;serveContent&nbsp;will&nbsp;check&nbsp;modification&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352378">sizeFunc</span>&nbsp;<span class="op" id="3352387">:=</span>&nbsp;<span class="keyword" id="3352390">func</span><span class="op" id="3352394">(</span><span class="op" id="3352395">)</span>&nbsp;<span class="op" id="3352397">(</span><span class="ident" id="3352398">int64</span><span class="op" id="3352403">,</span>&nbsp;<span class="builtintype" id="3352405">error</span><span class="op" id="3352410">)</span>&nbsp;<span class="op" id="3352412">{</span>&nbsp;<span class="keyword" id="3352414">return</span>&nbsp;<span class="ident" id="3352421"><a href="/net/http/fs.go.html#3351432">d</a></span><span class="op" id="3352422">.</span><span class="ident" id="3352423">Size</span><span class="op" id="3352427">(</span><span class="op" id="3352428">)</span><span class="op" id="3352429">,</span>&nbsp;<span class="ident" id="3352431">nil</span>&nbsp;<span class="op" id="3352435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352438"><a href="/net/http/fs.go.html#3344606">serveContent</a></span><span class="op" id="3352450">(</span><span class="ident" id="3352451"><a href="/net/http/fs.go.html#3350955">w</a></span><span class="op" id="3352452">,</span>&nbsp;<span class="ident" id="3352454"><a href="/net/http/fs.go.html#3350973">r</a></span><span class="op" id="3352455">,</span>&nbsp;<span class="ident" id="3352457"><a href="/net/http/fs.go.html#3351432">d</a></span><span class="op" id="3352458">.</span><span class="ident" id="3352459">Name</span><span class="op" id="3352463">(</span><span class="op" id="3352464">)</span><span class="op" id="3352465">,</span>&nbsp;<span class="ident" id="3352467"><a href="/net/http/fs.go.html#3351432">d</a></span><span class="op" id="3352468">.</span><span class="ident" id="3352469">ModTime</span><span class="op" id="3352476">(</span><span class="op" id="3352477">)</span><span class="op" id="3352478">,</span>&nbsp;<span class="ident" id="3352480"><a href="/net/http/fs.go.html#3352378">sizeFunc</a></span><span class="op" id="3352488">,</span>&nbsp;<span class="ident" id="3352490"><a href="/net/http/fs.go.html#3351312">f</a></span><span class="op" id="3352491">)</span><br>
<span class="lineno"></span><span class="op" id="3352493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="3352496">//&nbsp;localRedirect&nbsp;gives&nbsp;a&nbsp;Moved&nbsp;Permanently&nbsp;response.</span><br>
<span class="lineno"></span><span class="comment" id="3352549">//&nbsp;It&nbsp;does&nbsp;not&nbsp;convert&nbsp;relative&nbsp;paths&nbsp;to&nbsp;absolute&nbsp;paths&nbsp;like&nbsp;Redirect&nbsp;does.</span><br>
<span class="lineno"></span><span class="keyword" id="3352625">func</span>&nbsp;<span class="ident" id="3352630">localRedirect</span><span class="op" id="3352643">(</span><span class="ident" id="3352644">w</span>&nbsp;<span class="ident" id="3352646"><a href="/net/http/server.go.html#3401101">ResponseWriter</a></span><span class="op" id="3352660">,</span>&nbsp;<span class="ident" id="3352662">r</span>&nbsp;<span class="op" id="3352664">*</span><span class="ident" id="3352665"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3352672">,</span>&nbsp;<span class="ident" id="3352674">newPath</span>&nbsp;<span class="builtintype" id="3352682">string</span><span class="op" id="3352688">)</span>&nbsp;<span class="op" id="3352690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352693">if</span>&nbsp;<span class="ident" id="3352696">q</span>&nbsp;<span class="op" id="3352698">:=</span>&nbsp;<span class="ident" id="3352701"><a href="/net/http/fs.go.html#3352662">r</a></span><span class="op" id="3352702">.</span><span class="ident" id="3352703">URL</span><span class="op" id="3352706">.</span><span class="ident" id="3352707">RawQuery</span><span class="op" id="3352715">;</span>&nbsp;<span class="ident" id="3352717"><a href="/net/http/fs.go.html#3352696">q</a></span>&nbsp;<span class="op" id="3352719">!=</span>&nbsp;<span class="string" id="3352722">&#34;&#34;</span>&nbsp;<span class="op" id="3352725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352729"><a href="/net/http/fs.go.html#3352674">newPath</a></span>&nbsp;<span class="op" id="3352737">+=</span>&nbsp;<span class="string" id="3352740">&#34;?&#34;</span>&nbsp;<span class="op" id="3352744">+</span>&nbsp;<span class="ident" id="3352746"><a href="/net/http/fs.go.html#3352696">q</a></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352752"><a href="/net/http/fs.go.html#3352644">w</a></span><span class="op" id="3352753">.</span><span class="ident" id="3352754">Header</span><span class="op" id="3352760">(</span><span class="op" id="3352761">)</span><span class="op" id="3352762">.</span><span class="ident" id="3352763">Set</span><span class="op" id="3352766">(</span><span class="string" id="3352767">&#34;Location&#34;</span><span class="op" id="3352777">,</span>&nbsp;<span class="ident" id="3352779"><a href="/net/http/fs.go.html#3352674">newPath</a></span><span class="op" id="3352786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352789"><a href="/net/http/fs.go.html#3352644">w</a></span><span class="op" id="3352790">.</span><span class="ident" id="3352791">WriteHeader</span><span class="op" id="3352802">(</span><span class="ident" id="3352803"><a href="/net/http/status.go.html#3467012">StatusMovedPermanently</a></span><span class="op" id="3352825">)</span><br>
<span class="lineno"></span><span class="op" id="3352827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="comment" id="3352830">//&nbsp;ServeFile&nbsp;replies&nbsp;to&nbsp;the&nbsp;request&nbsp;with&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="3352916">func</span>&nbsp;<span class="ident" id="3352921">ServeFile</span><span class="op" id="3352930">(</span><span class="ident" id="3352931">w</span>&nbsp;<span class="ident" id="3352933"><a href="/net/http/server.go.html#3401101">ResponseWriter</a></span><span class="op" id="3352947">,</span>&nbsp;<span class="ident" id="3352949">r</span>&nbsp;<span class="op" id="3352951">*</span><span class="ident" id="3352952"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3352959">,</span>&nbsp;<span class="ident" id="3352961">name</span>&nbsp;<span class="builtintype" id="3352966">string</span><span class="op" id="3352972">)</span>&nbsp;<span class="op" id="3352974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352977">dir</span><span class="op" id="3352980">,</span>&nbsp;<span class="ident" id="3352982">file</span>&nbsp;<span class="op" id="3352987">:=</span>&nbsp;<span class="ident" id="3352990"><a href="/net/http/fs.go.html#3340461">filepath</a></span><span class="op" id="3352998">.</span><span class="ident" id="3352999">Split</span><span class="op" id="3353004">(</span><span class="ident" id="3353005"><a href="/net/http/fs.go.html#3352961">name</a></span><span class="op" id="3353009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3353012"><a href="/net/http/fs.go.html#3350945">serveFile</a></span><span class="op" id="3353021">(</span><span class="ident" id="3353022"><a href="/net/http/fs.go.html#3352931">w</a></span><span class="op" id="3353023">,</span>&nbsp;<span class="ident" id="3353025"><a href="/net/http/fs.go.html#3352949">r</a></span><span class="op" id="3353026">,</span>&nbsp;<span class="ident" id="3353028"><a href="/net/http/fs.go.html#3340873">Dir</a></span><span class="op" id="3353031">(</span><span class="ident" id="3353032"><a href="/net/http/fs.go.html#3352977">dir</a></span><span class="op" id="3353035">)</span><span class="op" id="3353036">,</span>&nbsp;<span class="ident" id="3353038"><a href="/net/http/fs.go.html#3352982">file</a></span><span class="op" id="3353042">,</span>&nbsp;<span class="builtintype" id="3353044">false</span><span class="op" id="3353049">)</span><br>
<span class="lineno"></span><span class="op" id="3353051">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span><span class="keyword" id="3353054">type</span>&nbsp;<span class="ident" id="3353059">fileHandler</span>&nbsp;<span class="keyword" id="3353071">struct</span>&nbsp;<span class="op" id="3353078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3353081">root</span>&nbsp;<span class="ident" id="3353086"><a href="/net/http/fs.go.html#3341508">FileSystem</a></span><br>
<span class="lineno"></span><span class="op" id="3353097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="3353100">//&nbsp;FileServer&nbsp;returns&nbsp;a&nbsp;handler&nbsp;that&nbsp;serves&nbsp;HTTP&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="3353158">//&nbsp;with&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;file&nbsp;system&nbsp;rooted&nbsp;at&nbsp;root.</span><br>
<span class="lineno"></span><span class="comment" id="3353214">//</span><br>
<span class="lineno"></span><span class="comment" id="3353217">//&nbsp;To&nbsp;use&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;file&nbsp;system&nbsp;implementation,</span><br>
<span class="lineno"></span><span class="comment" id="3353278">//&nbsp;use&nbsp;http.Dir:</span><br>
<span class="lineno">440</span><span class="comment" id="3353295">//</span><br>
<span class="lineno"></span><span class="comment" id="3353298">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http.Handle(&#34;/&#34;,&nbsp;http.FileServer(http.Dir(&#34;/tmp&#34;)))</span><br>
<span class="lineno"></span><span class="keyword" id="3353357">func</span>&nbsp;<span class="ident" id="3353362">FileServer</span><span class="op" id="3353372">(</span><span class="ident" id="3353373">root</span>&nbsp;<span class="ident" id="3353378"><a href="/net/http/fs.go.html#3341508">FileSystem</a></span><span class="op" id="3353388">)</span>&nbsp;<span class="ident" id="3353390"><a href="/net/http/server.go.html#3400945">Handler</a></span>&nbsp;<span class="op" id="3353398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3353401">return</span>&nbsp;<span class="op" id="3353408">&amp;</span><span class="ident" id="3353409"><a href="/net/http/fs.go.html#3353059">fileHandler</a></span><span class="op" id="3353420">{</span><span class="ident" id="3353421"><a href="/net/http/fs.go.html#3353373">root</a></span><span class="op" id="3353425">}</span><br>
<span class="lineno"></span><span class="op" id="3353427">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="3353430">func</span>&nbsp;<span class="op" id="3353435">(</span><span class="ident" id="3353436">f</span>&nbsp;<span class="op" id="3353438">*</span><span class="ident" id="3353439"><a href="/net/http/fs.go.html#3353059">fileHandler</a></span><span class="op" id="3353450">)</span>&nbsp;<span class="ident" id="3353452">ServeHTTP</span><span class="op" id="3353461">(</span><span class="ident" id="3353462">w</span>&nbsp;<span class="ident" id="3353464"><a href="/net/http/server.go.html#3401101">ResponseWriter</a></span><span class="op" id="3353478">,</span>&nbsp;<span class="ident" id="3353480">r</span>&nbsp;<span class="op" id="3353482">*</span><span class="ident" id="3353483"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3353490">)</span>&nbsp;<span class="op" id="3353492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3353495">upath</span>&nbsp;<span class="op" id="3353501">:=</span>&nbsp;<span class="ident" id="3353504"><a href="/net/http/fs.go.html#3353480">r</a></span><span class="op" id="3353505">.</span><span class="ident" id="3353506">URL</span><span class="op" id="3353509">.</span><span class="ident" id="3353510">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3353516">if</span>&nbsp;<span class="op" id="3353519">!</span><span class="ident" id="3353520"><a href="/net/http/fs.go.html#3340489">strings</a></span><span class="op" id="3353527">.</span><span class="ident" id="3353528">HasPrefix</span><span class="op" id="3353537">(</span><span class="ident" id="3353538"><a href="/net/http/fs.go.html#3353495">upath</a></span><span class="op" id="3353543">,</span>&nbsp;<span class="string" id="3353545">&#34;/&#34;</span><span class="op" id="3353548">)</span>&nbsp;<span class="op" id="3353550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3353554"><a href="/net/http/fs.go.html#3353495">upath</a></span>&nbsp;<span class="op" id="3353560">=</span>&nbsp;<span class="string" id="3353562">&#34;/&#34;</span>&nbsp;<span class="op" id="3353566">+</span>&nbsp;<span class="ident" id="3353568"><a href="/net/http/fs.go.html#3353495">upath</a></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3353576"><a href="/net/http/fs.go.html#3353480">r</a></span><span class="op" id="3353577">.</span><span class="ident" id="3353578">URL</span><span class="op" id="3353581">.</span><span class="ident" id="3353582">Path</span>&nbsp;<span class="op" id="3353587">=</span>&nbsp;<span class="ident" id="3353589"><a href="/net/http/fs.go.html#3353495">upath</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3353596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3353599"><a href="/net/http/fs.go.html#3350945">serveFile</a></span><span class="op" id="3353608">(</span><span class="ident" id="3353609"><a href="/net/http/fs.go.html#3353462">w</a></span><span class="op" id="3353610">,</span>&nbsp;<span class="ident" id="3353612"><a href="/net/http/fs.go.html#3353480">r</a></span><span class="op" id="3353613">,</span>&nbsp;<span class="ident" id="3353615"><a href="/net/http/fs.go.html#3353436">f</a></span><span class="op" id="3353616">.</span><span class="ident" id="3353617">root</span><span class="op" id="3353621">,</span>&nbsp;<span class="ident" id="3353623"><a href="/net/http/fs.go.html#3340453">path</a></span><span class="op" id="3353627">.</span><span class="ident" id="3353628">Clean</span><span class="op" id="3353633">(</span><span class="ident" id="3353634"><a href="/net/http/fs.go.html#3353495">upath</a></span><span class="op" id="3353639">)</span><span class="op" id="3353640">,</span>&nbsp;<span class="builtintype" id="3353642">true</span><span class="op" id="3353646">)</span><br>
<span class="lineno"></span><span class="op" id="3353648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="3353651">//&nbsp;httpRange&nbsp;specifies&nbsp;the&nbsp;byte&nbsp;range&nbsp;to&nbsp;be&nbsp;sent&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="keyword" id="3353715">type</span>&nbsp;<span class="ident" id="3353720">httpRange</span>&nbsp;<span class="keyword" id="3353730">struct</span>&nbsp;<span class="op" id="3353737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3353740">start</span><span class="op" id="3353745">,</span>&nbsp;<span class="ident" id="3353747">length</span>&nbsp;<span class="ident" id="3353754">int64</span><br>
<span class="lineno"></span><span class="op" id="3353760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="keyword" id="3353763">func</span>&nbsp;<span class="op" id="3353768">(</span><span class="ident" id="3353769">r</span>&nbsp;<span class="ident" id="3353771"><a href="/net/http/fs.go.html#3353720">httpRange</a></span><span class="op" id="3353780">)</span>&nbsp;<span class="ident" id="3353782">contentRange</span><span class="op" id="3353794">(</span><span class="ident" id="3353795">size</span>&nbsp;<span class="ident" id="3353800">int64</span><span class="op" id="3353805">)</span>&nbsp;<span class="builtintype" id="3353807">string</span>&nbsp;<span class="op" id="3353814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3353817">return</span>&nbsp;<span class="ident" id="3353824"><a href="/net/http/fs.go.html#3340380">fmt</a></span><span class="op" id="3353827">.</span><span class="ident" id="3353828">Sprintf</span><span class="op" id="3353835">(</span><span class="string" id="3353836">&#34;bytes&nbsp;%d-%d/%d&#34;</span><span class="op" id="3353852">,</span>&nbsp;<span class="ident" id="3353854"><a href="/net/http/fs.go.html#3353769">r</a></span><span class="op" id="3353855">.</span><span class="ident" id="3353856">start</span><span class="op" id="3353861">,</span>&nbsp;<span class="ident" id="3353863"><a href="/net/http/fs.go.html#3353769">r</a></span><span class="op" id="3353864">.</span><span class="ident" id="3353865">start</span><span class="op" id="3353870">+</span><span class="ident" id="3353871"><a href="/net/http/fs.go.html#3353769">r</a></span><span class="op" id="3353872">.</span><span class="ident" id="3353873">length</span><span class="op" id="3353879">-</span><span class="num" id="3353880">1</span><span class="op" id="3353881">,</span>&nbsp;<span class="ident" id="3353883"><a href="/net/http/fs.go.html#3353795">size</a></span><span class="op" id="3353887">)</span><br>
<span class="lineno"></span><span class="op" id="3353889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3353892">func</span>&nbsp;<span class="op" id="3353897">(</span><span class="ident" id="3353898">r</span>&nbsp;<span class="ident" id="3353900"><a href="/net/http/fs.go.html#3353720">httpRange</a></span><span class="op" id="3353909">)</span>&nbsp;<span class="ident" id="3353911">mimeHeader</span><span class="op" id="3353921">(</span><span class="ident" id="3353922">contentType</span>&nbsp;<span class="builtintype" id="3353934">string</span><span class="op" id="3353940">,</span>&nbsp;<span class="ident" id="3353942">size</span>&nbsp;<span class="ident" id="3353947">int64</span><span class="op" id="3353952">)</span>&nbsp;<span class="ident" id="3353954"><a href="/net/http/fs.go.html#3340419">textproto</a></span><span class="op" id="3353963">.</span><span class="ident" id="3353964">MIMEHeader</span>&nbsp;<span class="op" id="3353975">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3353978">return</span>&nbsp;<span class="ident" id="3353985"><a href="/net/http/fs.go.html#3340419">textproto</a></span><span class="op" id="3353994">.</span><span class="ident" id="3353995">MIMEHeader</span><span class="op" id="3354005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3354009">&#34;Content-Range&#34;</span><span class="op" id="3354024">:</span>&nbsp;<span class="op" id="3354026">{</span><span class="ident" id="3354027"><a href="/net/http/fs.go.html#3353898">r</a></span><span class="op" id="3354028">.</span><span class="ident" id="3354029">contentRange</span><span class="op" id="3354041">(</span><span class="ident" id="3354042"><a href="/net/http/fs.go.html#3353942">size</a></span><span class="op" id="3354046">)</span><span class="op" id="3354047">}</span><span class="op" id="3354048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3354052">&#34;Content-Type&#34;</span><span class="op" id="3354066">:</span>&nbsp;&nbsp;<span class="op" id="3354069">{</span><span class="ident" id="3354070"><a href="/net/http/fs.go.html#3353922">contentType</a></span><span class="op" id="3354081">}</span><span class="op" id="3354082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354085">}</span><br>
<span class="lineno"></span><span class="op" id="3354087">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="3354090">//&nbsp;parseRange&nbsp;parses&nbsp;a&nbsp;Range&nbsp;header&nbsp;string&nbsp;as&nbsp;per&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="keyword" id="3354150">func</span>&nbsp;<span class="ident" id="3354155">parseRange</span><span class="op" id="3354165">(</span><span class="ident" id="3354166">s</span>&nbsp;<span class="builtintype" id="3354168">string</span><span class="op" id="3354174">,</span>&nbsp;<span class="ident" id="3354176">size</span>&nbsp;<span class="ident" id="3354181">int64</span><span class="op" id="3354186">)</span>&nbsp;<span class="op" id="3354188">(</span><span class="op" id="3354189">[</span><span class="op" id="3354190">]</span><span class="ident" id="3354191"><a href="/net/http/fs.go.html#3353720">httpRange</a></span><span class="op" id="3354200">,</span>&nbsp;<span class="builtintype" id="3354202">error</span><span class="op" id="3354207">)</span>&nbsp;<span class="op" id="3354209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354212">if</span>&nbsp;<span class="ident" id="3354215"><a href="/net/http/fs.go.html#3354166">s</a></span>&nbsp;<span class="op" id="3354217">==</span>&nbsp;<span class="string" id="3354220">&#34;&#34;</span>&nbsp;<span class="op" id="3354223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354227">return</span>&nbsp;<span class="ident" id="3354234">nil</span><span class="op" id="3354237">,</span>&nbsp;<span class="ident" id="3354239">nil</span>&nbsp;<span class="comment" id="3354243">//&nbsp;header&nbsp;not&nbsp;present</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354269">const</span>&nbsp;<span class="ident" id="3354275">b</span>&nbsp;<span class="op" id="3354277">=</span>&nbsp;<span class="string" id="3354279">&#34;bytes=&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354289">if</span>&nbsp;<span class="op" id="3354292">!</span><span class="ident" id="3354293"><a href="/net/http/fs.go.html#3340489">strings</a></span><span class="op" id="3354300">.</span><span class="ident" id="3354301">HasPrefix</span><span class="op" id="3354310">(</span><span class="ident" id="3354311"><a href="/net/http/fs.go.html#3354166">s</a></span><span class="op" id="3354312">,</span>&nbsp;<span class="ident" id="3354314"><a href="/net/http/fs.go.html#3354275">b</a></span><span class="op" id="3354315">)</span>&nbsp;<span class="op" id="3354317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354321">return</span>&nbsp;<span class="ident" id="3354328">nil</span><span class="op" id="3354331">,</span>&nbsp;<span class="ident" id="3354333"><a href="/net/http/fs.go.html#3340370">errors</a></span><span class="op" id="3354339">.</span><span class="ident" id="3354340">New</span><span class="op" id="3354343">(</span><span class="string" id="3354344">&#34;invalid&nbsp;range&#34;</span><span class="op" id="3354359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354362">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354365">var</span>&nbsp;<span class="ident" id="3354369">ranges</span>&nbsp;<span class="op" id="3354376">[</span><span class="op" id="3354377">]</span><span class="ident" id="3354378"><a href="/net/http/fs.go.html#3353720">httpRange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354389">for</span>&nbsp;<span class="ident" id="3354393">_</span><span class="op" id="3354394">,</span>&nbsp;<span class="ident" id="3354396">ra</span>&nbsp;<span class="op" id="3354399">:=</span>&nbsp;<span class="keyword" id="3354402">range</span>&nbsp;<span class="ident" id="3354408"><a href="/net/http/fs.go.html#3340489">strings</a></span><span class="op" id="3354415">.</span><span class="ident" id="3354416">Split</span><span class="op" id="3354421">(</span><span class="ident" id="3354422"><a href="/net/http/fs.go.html#3354166">s</a></span><span class="op" id="3354423">[</span><span class="builtinfunc" id="3354424">len</span><span class="op" id="3354427">(</span><span class="ident" id="3354428"><a href="/net/http/fs.go.html#3354275">b</a></span><span class="op" id="3354429">)</span><span class="op" id="3354430">:</span><span class="op" id="3354431">]</span><span class="op" id="3354432">,</span>&nbsp;<span class="string" id="3354434">&#34;,&#34;</span><span class="op" id="3354437">)</span>&nbsp;<span class="op" id="3354439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354443"><a href="/net/http/fs.go.html#3354396">ra</a></span>&nbsp;<span class="op" id="3354446">=</span>&nbsp;<span class="ident" id="3354448"><a href="/net/http/fs.go.html#3340489">strings</a></span><span class="op" id="3354455">.</span><span class="ident" id="3354456">TrimSpace</span><span class="op" id="3354465">(</span><span class="ident" id="3354466"><a href="/net/http/fs.go.html#3354396">ra</a></span><span class="op" id="3354468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354472">if</span>&nbsp;<span class="ident" id="3354475"><a href="/net/http/fs.go.html#3354396">ra</a></span>&nbsp;<span class="op" id="3354478">==</span>&nbsp;<span class="string" id="3354481">&#34;&#34;</span>&nbsp;<span class="op" id="3354484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354489">continue</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354504">i</span>&nbsp;<span class="op" id="3354506">:=</span>&nbsp;<span class="ident" id="3354509"><a href="/net/http/fs.go.html#3340489">strings</a></span><span class="op" id="3354516">.</span><span class="ident" id="3354517">Index</span><span class="op" id="3354522">(</span><span class="ident" id="3354523"><a href="/net/http/fs.go.html#3354396">ra</a></span><span class="op" id="3354525">,</span>&nbsp;<span class="string" id="3354527">&#34;-&#34;</span><span class="op" id="3354530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354534">if</span>&nbsp;<span class="ident" id="3354537"><a href="/net/http/fs.go.html#3354504">i</a></span>&nbsp;<span class="op" id="3354539">&lt;</span>&nbsp;<span class="num" id="3354541">0</span>&nbsp;<span class="op" id="3354543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354548">return</span>&nbsp;<span class="ident" id="3354555">nil</span><span class="op" id="3354558">,</span>&nbsp;<span class="ident" id="3354560"><a href="/net/http/fs.go.html#3340370">errors</a></span><span class="op" id="3354566">.</span><span class="ident" id="3354567">New</span><span class="op" id="3354570">(</span><span class="string" id="3354571">&#34;invalid&nbsp;range&#34;</span><span class="op" id="3354586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354590">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354594">start</span><span class="op" id="3354599">,</span>&nbsp;<span class="ident" id="3354601">end</span>&nbsp;<span class="op" id="3354605">:=</span>&nbsp;<span class="ident" id="3354608"><a href="/net/http/fs.go.html#3340489">strings</a></span><span class="op" id="3354615">.</span><span class="ident" id="3354616">TrimSpace</span><span class="op" id="3354625">(</span><span class="ident" id="3354626"><a href="/net/http/fs.go.html#3354396">ra</a></span><span class="op" id="3354628">[</span><span class="op" id="3354629">:</span><span class="ident" id="3354630"><a href="/net/http/fs.go.html#3354504">i</a></span><span class="op" id="3354631">]</span><span class="op" id="3354632">)</span><span class="op" id="3354633">,</span>&nbsp;<span class="ident" id="3354635"><a href="/net/http/fs.go.html#3340489">strings</a></span><span class="op" id="3354642">.</span><span class="ident" id="3354643">TrimSpace</span><span class="op" id="3354652">(</span><span class="ident" id="3354653"><a href="/net/http/fs.go.html#3354396">ra</a></span><span class="op" id="3354655">[</span><span class="ident" id="3354656"><a href="/net/http/fs.go.html#3354504">i</a></span><span class="op" id="3354657">+</span><span class="num" id="3354658">1</span><span class="op" id="3354659">:</span><span class="op" id="3354660">]</span><span class="op" id="3354661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354665">var</span>&nbsp;<span class="ident" id="3354669">r</span>&nbsp;<span class="ident" id="3354671"><a href="/net/http/fs.go.html#3353720">httpRange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354683">if</span>&nbsp;<span class="ident" id="3354686"><a href="/net/http/fs.go.html#3354594">start</a></span>&nbsp;<span class="op" id="3354692">==</span>&nbsp;<span class="string" id="3354695">&#34;&#34;</span>&nbsp;<span class="op" id="3354698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3354703">//&nbsp;If&nbsp;no&nbsp;start&nbsp;is&nbsp;specified,&nbsp;end&nbsp;specifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3354753">//&nbsp;range&nbsp;start&nbsp;relative&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354804">i</span><span class="op" id="3354805">,</span>&nbsp;<span class="ident" id="3354807">err</span>&nbsp;<span class="op" id="3354811">:=</span>&nbsp;<span class="ident" id="3354814"><a href="/net/http/fs.go.html#3340478">strconv</a></span><span class="op" id="3354821">.</span><span class="ident" id="3354822">ParseInt</span><span class="op" id="3354830">(</span><span class="ident" id="3354831"><a href="/net/http/fs.go.html#3354601">end</a></span><span class="op" id="3354834">,</span>&nbsp;<span class="num" id="3354836">10</span><span class="op" id="3354838">,</span>&nbsp;<span class="num" id="3354840">64</span><span class="op" id="3354842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354847">if</span>&nbsp;<span class="ident" id="3354850"><a href="/net/http/fs.go.html#3354807">err</a></span>&nbsp;<span class="op" id="3354854">!=</span>&nbsp;<span class="ident" id="3354857">nil</span>&nbsp;<span class="op" id="3354861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354867">return</span>&nbsp;<span class="ident" id="3354874">nil</span><span class="op" id="3354877">,</span>&nbsp;<span class="ident" id="3354879"><a href="/net/http/fs.go.html#3340370">errors</a></span><span class="op" id="3354885">.</span><span class="ident" id="3354886">New</span><span class="op" id="3354889">(</span><span class="string" id="3354890">&#34;invalid&nbsp;range&#34;</span><span class="op" id="3354905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354915">if</span>&nbsp;<span class="ident" id="3354918"><a href="/net/http/fs.go.html#3354804">i</a></span>&nbsp;<span class="op" id="3354920">&gt;</span>&nbsp;<span class="ident" id="3354922"><a href="/net/http/fs.go.html#3354176">size</a></span>&nbsp;<span class="op" id="3354927">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354933"><a href="/net/http/fs.go.html#3354804">i</a></span>&nbsp;<span class="op" id="3354935">=</span>&nbsp;<span class="ident" id="3354937"><a href="/net/http/fs.go.html#3354176">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354950"><a href="/net/http/fs.go.html#3354669">r</a></span><span class="op" id="3354951">.</span><span class="ident" id="3354952">start</span>&nbsp;<span class="op" id="3354958">=</span>&nbsp;<span class="ident" id="3354960"><a href="/net/http/fs.go.html#3354176">size</a></span>&nbsp;<span class="op" id="3354965">-</span>&nbsp;<span class="ident" id="3354967"><a href="/net/http/fs.go.html#3354804">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354972"><a href="/net/http/fs.go.html#3354669">r</a></span><span class="op" id="3354973">.</span><span class="ident" id="3354974">length</span>&nbsp;<span class="op" id="3354981">=</span>&nbsp;<span class="ident" id="3354983"><a href="/net/http/fs.go.html#3354176">size</a></span>&nbsp;<span class="op" id="3354988">-</span>&nbsp;<span class="ident" id="3354990"><a href="/net/http/fs.go.html#3354669">r</a></span><span class="op" id="3354991">.</span><span class="ident" id="3354992">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355000">}</span>&nbsp;<span class="keyword" id="3355002">else</span>&nbsp;<span class="op" id="3355007">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355012">i</span><span class="op" id="3355013">,</span>&nbsp;<span class="ident" id="3355015">err</span>&nbsp;<span class="op" id="3355019">:=</span>&nbsp;<span class="ident" id="3355022"><a href="/net/http/fs.go.html#3340478">strconv</a></span><span class="op" id="3355029">.</span><span class="ident" id="3355030">ParseInt</span><span class="op" id="3355038">(</span><span class="ident" id="3355039"><a href="/net/http/fs.go.html#3354594">start</a></span><span class="op" id="3355044">,</span>&nbsp;<span class="num" id="3355046">10</span><span class="op" id="3355048">,</span>&nbsp;<span class="num" id="3355050">64</span><span class="op" id="3355052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355057">if</span>&nbsp;<span class="ident" id="3355060"><a href="/net/http/fs.go.html#3355015">err</a></span>&nbsp;<span class="op" id="3355064">!=</span>&nbsp;<span class="ident" id="3355067">nil</span>&nbsp;<span class="op" id="3355071">||</span>&nbsp;<span class="ident" id="3355074"><a href="/net/http/fs.go.html#3355012">i</a></span>&nbsp;<span class="op" id="3355076">&gt;</span>&nbsp;<span class="ident" id="3355078"><a href="/net/http/fs.go.html#3354176">size</a></span>&nbsp;<span class="op" id="3355083">||</span>&nbsp;<span class="ident" id="3355086"><a href="/net/http/fs.go.html#3355012">i</a></span>&nbsp;<span class="op" id="3355088">&lt;</span>&nbsp;<span class="num" id="3355090">0</span>&nbsp;<span class="op" id="3355092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355098">return</span>&nbsp;<span class="ident" id="3355105">nil</span><span class="op" id="3355108">,</span>&nbsp;<span class="ident" id="3355110"><a href="/net/http/fs.go.html#3340370">errors</a></span><span class="op" id="3355116">.</span><span class="ident" id="3355117">New</span><span class="op" id="3355120">(</span><span class="string" id="3355121">&#34;invalid&nbsp;range&#34;</span><span class="op" id="3355136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355146"><a href="/net/http/fs.go.html#3354669">r</a></span><span class="op" id="3355147">.</span><span class="ident" id="3355148">start</span>&nbsp;<span class="op" id="3355154">=</span>&nbsp;<span class="ident" id="3355156"><a href="/net/http/fs.go.html#3355012">i</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355161">if</span>&nbsp;<span class="ident" id="3355164"><a href="/net/http/fs.go.html#3354601">end</a></span>&nbsp;<span class="op" id="3355168">==</span>&nbsp;<span class="string" id="3355171">&#34;&#34;</span>&nbsp;<span class="op" id="3355174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3355180">//&nbsp;If&nbsp;no&nbsp;end&nbsp;is&nbsp;specified,&nbsp;range&nbsp;extends&nbsp;to&nbsp;end&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355245"><a href="/net/http/fs.go.html#3354669">r</a></span><span class="op" id="3355246">.</span><span class="ident" id="3355247">length</span>&nbsp;<span class="op" id="3355254">=</span>&nbsp;<span class="ident" id="3355256"><a href="/net/http/fs.go.html#3354176">size</a></span>&nbsp;<span class="op" id="3355261">-</span>&nbsp;<span class="ident" id="3355263"><a href="/net/http/fs.go.html#3354669">r</a></span><span class="op" id="3355264">.</span><span class="ident" id="3355265">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355274">}</span>&nbsp;<span class="keyword" id="3355276">else</span>&nbsp;<span class="op" id="3355281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355287">i</span><span class="op" id="3355288">,</span>&nbsp;<span class="ident" id="3355290">err</span>&nbsp;<span class="op" id="3355294">:=</span>&nbsp;<span class="ident" id="3355297"><a href="/net/http/fs.go.html#3340478">strconv</a></span><span class="op" id="3355304">.</span><span class="ident" id="3355305">ParseInt</span><span class="op" id="3355313">(</span><span class="ident" id="3355314"><a href="/net/http/fs.go.html#3354601">end</a></span><span class="op" id="3355317">,</span>&nbsp;<span class="num" id="3355319">10</span><span class="op" id="3355321">,</span>&nbsp;<span class="num" id="3355323">64</span><span class="op" id="3355325">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355331">if</span>&nbsp;<span class="ident" id="3355334"><a href="/net/http/fs.go.html#3355290">err</a></span>&nbsp;<span class="op" id="3355338">!=</span>&nbsp;<span class="ident" id="3355341">nil</span>&nbsp;<span class="op" id="3355345">||</span>&nbsp;<span class="ident" id="3355348"><a href="/net/http/fs.go.html#3354669">r</a></span><span class="op" id="3355349">.</span><span class="ident" id="3355350">start</span>&nbsp;<span class="op" id="3355356">&gt;</span>&nbsp;<span class="ident" id="3355358"><a href="/net/http/fs.go.html#3355287">i</a></span>&nbsp;<span class="op" id="3355360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355367">return</span>&nbsp;<span class="ident" id="3355374">nil</span><span class="op" id="3355377">,</span>&nbsp;<span class="ident" id="3355379"><a href="/net/http/fs.go.html#3340370">errors</a></span><span class="op" id="3355385">.</span><span class="ident" id="3355386">New</span><span class="op" id="3355389">(</span><span class="string" id="3355390">&#34;invalid&nbsp;range&#34;</span><span class="op" id="3355405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355417">if</span>&nbsp;<span class="ident" id="3355420"><a href="/net/http/fs.go.html#3355287">i</a></span>&nbsp;<span class="op" id="3355422">&gt;=</span>&nbsp;<span class="ident" id="3355425"><a href="/net/http/fs.go.html#3354176">size</a></span>&nbsp;<span class="op" id="3355430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355437"><a href="/net/http/fs.go.html#3355287">i</a></span>&nbsp;<span class="op" id="3355439">=</span>&nbsp;<span class="ident" id="3355441"><a href="/net/http/fs.go.html#3354176">size</a></span>&nbsp;<span class="op" id="3355446">-</span>&nbsp;<span class="num" id="3355448">1</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355460"><a href="/net/http/fs.go.html#3354669">r</a></span><span class="op" id="3355461">.</span><span class="ident" id="3355462">length</span>&nbsp;<span class="op" id="3355469">=</span>&nbsp;<span class="ident" id="3355471"><a href="/net/http/fs.go.html#3355287">i</a></span>&nbsp;<span class="op" id="3355473">-</span>&nbsp;<span class="ident" id="3355475"><a href="/net/http/fs.go.html#3354669">r</a></span><span class="op" id="3355476">.</span><span class="ident" id="3355477">start</span>&nbsp;<span class="op" id="3355483">+</span>&nbsp;<span class="num" id="3355485">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355498"><a href="/net/http/fs.go.html#3354369">ranges</a></span>&nbsp;<span class="op" id="3355505">=</span>&nbsp;<span class="builtinfunc" id="3355507">append</span><span class="op" id="3355513">(</span><span class="ident" id="3355514"><a href="/net/http/fs.go.html#3354369">ranges</a></span><span class="op" id="3355520">,</span>&nbsp;<span class="ident" id="3355522"><a href="/net/http/fs.go.html#3354669">r</a></span><span class="op" id="3355523">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355529">return</span>&nbsp;<span class="ident" id="3355536"><a href="/net/http/fs.go.html#3354369">ranges</a></span><span class="op" id="3355542">,</span>&nbsp;<span class="ident" id="3355544">nil</span><br>
<span class="lineno"></span><span class="op" id="3355548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3355551">//&nbsp;countingWriter&nbsp;counts&nbsp;how&nbsp;many&nbsp;bytes&nbsp;have&nbsp;been&nbsp;written&nbsp;to&nbsp;it.</span><br>
<span class="lineno">530</span><span class="keyword" id="3355616">type</span>&nbsp;<span class="ident" id="3355621">countingWriter</span>&nbsp;<span class="ident" id="3355636">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3355643">func</span>&nbsp;<span class="op" id="3355648">(</span><span class="ident" id="3355649">w</span>&nbsp;<span class="op" id="3355651">*</span><span class="ident" id="3355652"><a href="/net/http/fs.go.html#3355621">countingWriter</a></span><span class="op" id="3355666">)</span>&nbsp;<span class="ident" id="3355668">Write</span><span class="op" id="3355673">(</span><span class="ident" id="3355674">p</span>&nbsp;<span class="op" id="3355676">[</span><span class="op" id="3355677">]</span><span class="builtintype" id="3355678">byte</span><span class="op" id="3355682">)</span>&nbsp;<span class="op" id="3355684">(</span><span class="ident" id="3355685">n</span>&nbsp;<span class="builtintype" id="3355687">int</span><span class="op" id="3355690">,</span>&nbsp;<span class="ident" id="3355692">err</span>&nbsp;<span class="builtintype" id="3355696">error</span><span class="op" id="3355701">)</span>&nbsp;<span class="op" id="3355703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355706">*</span><span class="ident" id="3355707"><a href="/net/http/fs.go.html#3355649">w</a></span>&nbsp;<span class="op" id="3355709">+=</span>&nbsp;<span class="ident" id="3355712"><a href="/net/http/fs.go.html#3355621">countingWriter</a></span><span class="op" id="3355726">(</span><span class="builtinfunc" id="3355727">len</span><span class="op" id="3355730">(</span><span class="ident" id="3355731"><a href="/net/http/fs.go.html#3355674">p</a></span><span class="op" id="3355732">)</span><span class="op" id="3355733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355736">return</span>&nbsp;<span class="builtinfunc" id="3355743">len</span><span class="op" id="3355746">(</span><span class="ident" id="3355747"><a href="/net/http/fs.go.html#3355674">p</a></span><span class="op" id="3355748">)</span><span class="op" id="3355749">,</span>&nbsp;<span class="ident" id="3355751">nil</span><br>
<span class="lineno">535</span><span class="op" id="3355755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3355758">//&nbsp;rangesMIMESize&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;it&nbsp;takes&nbsp;to&nbsp;encode&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3355827">//&nbsp;provided&nbsp;ranges&nbsp;as&nbsp;a&nbsp;multipart&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="3355871">func</span>&nbsp;<span class="ident" id="3355876">rangesMIMESize</span><span class="op" id="3355890">(</span><span class="ident" id="3355891">ranges</span>&nbsp;<span class="op" id="3355898">[</span><span class="op" id="3355899">]</span><span class="ident" id="3355900"><a href="/net/http/fs.go.html#3353720">httpRange</a></span><span class="op" id="3355909">,</span>&nbsp;<span class="ident" id="3355911">contentType</span>&nbsp;<span class="builtintype" id="3355923">string</span><span class="op" id="3355929">,</span>&nbsp;<span class="ident" id="3355931">contentSize</span>&nbsp;<span class="ident" id="3355943">int64</span><span class="op" id="3355948">)</span>&nbsp;<span class="op" id="3355950">(</span><span class="ident" id="3355951">encSize</span>&nbsp;<span class="ident" id="3355959">int64</span><span class="op" id="3355964">)</span>&nbsp;<span class="op" id="3355966">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355969">var</span>&nbsp;<span class="ident" id="3355973">w</span>&nbsp;<span class="ident" id="3355975"><a href="/net/http/fs.go.html#3355621">countingWriter</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355991">mw</span>&nbsp;<span class="op" id="3355994">:=</span>&nbsp;<span class="ident" id="3355997"><a href="/net/http/fs.go.html#3340401">multipart</a></span><span class="op" id="3356006">.</span><span class="ident" id="3356007">NewWriter</span><span class="op" id="3356016">(</span><span class="op" id="3356017">&amp;</span><span class="ident" id="3356018"><a href="/net/http/fs.go.html#3355973">w</a></span><span class="op" id="3356019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356022">for</span>&nbsp;<span class="ident" id="3356026">_</span><span class="op" id="3356027">,</span>&nbsp;<span class="ident" id="3356029">ra</span>&nbsp;<span class="op" id="3356032">:=</span>&nbsp;<span class="keyword" id="3356035">range</span>&nbsp;<span class="ident" id="3356041"><a href="/net/http/fs.go.html#3355891">ranges</a></span>&nbsp;<span class="op" id="3356048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356052"><a href="/net/http/fs.go.html#3355991">mw</a></span><span class="op" id="3356054">.</span><span class="ident" id="3356055">CreatePart</span><span class="op" id="3356065">(</span><span class="ident" id="3356066"><a href="/net/http/fs.go.html#3356029">ra</a></span><span class="op" id="3356068">.</span><span class="ident" id="3356069">mimeHeader</span><span class="op" id="3356079">(</span><span class="ident" id="3356080"><a href="/net/http/fs.go.html#3355911">contentType</a></span><span class="op" id="3356091">,</span>&nbsp;<span class="ident" id="3356093"><a href="/net/http/fs.go.html#3355931">contentSize</a></span><span class="op" id="3356104">)</span><span class="op" id="3356105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356109"><a href="/net/http/fs.go.html#3355951">encSize</a></span>&nbsp;<span class="op" id="3356117">+=</span>&nbsp;<span class="ident" id="3356120"><a href="/net/http/fs.go.html#3356029">ra</a></span><span class="op" id="3356122">.</span><span class="ident" id="3356123">length</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3356131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356134"><a href="/net/http/fs.go.html#3355991">mw</a></span><span class="op" id="3356136">.</span><span class="ident" id="3356137">Close</span><span class="op" id="3356142">(</span><span class="op" id="3356143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356146"><a href="/net/http/fs.go.html#3355951">encSize</a></span>&nbsp;<span class="op" id="3356154">+=</span>&nbsp;<span class="ident" id="3356157">int64</span><span class="op" id="3356162">(</span><span class="ident" id="3356163"><a href="/net/http/fs.go.html#3355973">w</a></span><span class="op" id="3356164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356167">return</span><br>
<span class="lineno"></span><span class="op" id="3356174">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="keyword" id="3356177">func</span>&nbsp;<span class="ident" id="3356182">sumRangesSize</span><span class="op" id="3356195">(</span><span class="ident" id="3356196">ranges</span>&nbsp;<span class="op" id="3356203">[</span><span class="op" id="3356204">]</span><span class="ident" id="3356205"><a href="/net/http/fs.go.html#3353720">httpRange</a></span><span class="op" id="3356214">)</span>&nbsp;<span class="op" id="3356216">(</span><span class="ident" id="3356217">size</span>&nbsp;<span class="ident" id="3356222">int64</span><span class="op" id="3356227">)</span>&nbsp;<span class="op" id="3356229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356232">for</span>&nbsp;<span class="ident" id="3356236">_</span><span class="op" id="3356237">,</span>&nbsp;<span class="ident" id="3356239">ra</span>&nbsp;<span class="op" id="3356242">:=</span>&nbsp;<span class="keyword" id="3356245">range</span>&nbsp;<span class="ident" id="3356251"><a href="/net/http/fs.go.html#3356196">ranges</a></span>&nbsp;<span class="op" id="3356258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356262"><a href="/net/http/fs.go.html#3356217">size</a></span>&nbsp;<span class="op" id="3356267">+=</span>&nbsp;<span class="ident" id="3356270"><a href="/net/http/fs.go.html#3356239">ra</a></span><span class="op" id="3356272">.</span><span class="ident" id="3356273">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3356281">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356284">return</span><br>
<span class="lineno"></span><span class="op" id="3356291">}</span>
</div>
</body>
</html>
