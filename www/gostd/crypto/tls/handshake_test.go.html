<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7290331">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7290386">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7290440">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7290491">package</span>&nbsp;<span class="ident" id="7290499">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7290504">import</span>&nbsp;<span class="op" id="7290511">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7290514">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7290523">&#34;encoding/hex&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7290539">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7290549">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7290557">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7290564">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7290570">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7290583">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7290590">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7290601">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7290612">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="7290619">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="7290622">//&nbsp;TLS&nbsp;reference&nbsp;tests&nbsp;run&nbsp;a&nbsp;connection&nbsp;against&nbsp;a&nbsp;reference&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="7290697">//&nbsp;(OpenSSL)&nbsp;of&nbsp;TLS&nbsp;and&nbsp;record&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;The&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="7290774">//&nbsp;code,&nbsp;during&nbsp;a&nbsp;test,&nbsp;is&nbsp;configured&nbsp;with&nbsp;deterministic&nbsp;randomness&nbsp;and&nbsp;so&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7290853">//&nbsp;reference&nbsp;test&nbsp;can&nbsp;be&nbsp;reproduced&nbsp;exactly&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno">25</span><span class="comment" id="7290912">//</span><br>
<span class="lineno"></span><span class="comment" id="7290915">//&nbsp;In&nbsp;order&nbsp;to&nbsp;save&nbsp;everyone&nbsp;who&nbsp;wishes&nbsp;to&nbsp;run&nbsp;the&nbsp;tests&nbsp;from&nbsp;needing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7290989">//&nbsp;reference&nbsp;implementation&nbsp;installed,&nbsp;the&nbsp;reference&nbsp;connections&nbsp;are&nbsp;saved&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7291067">//&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata&nbsp;directory.&nbsp;Thus&nbsp;running&nbsp;the&nbsp;tests&nbsp;involves&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="7291143">//&nbsp;external,&nbsp;but&nbsp;creating&nbsp;and&nbsp;updating&nbsp;them&nbsp;requires&nbsp;the&nbsp;reference</span><br>
<span class="lineno">30</span><span class="comment" id="7291210">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="7291229">//</span><br>
<span class="lineno"></span><span class="comment" id="7291232">//&nbsp;Tests&nbsp;can&nbsp;be&nbsp;updated&nbsp;by&nbsp;running&nbsp;them&nbsp;with&nbsp;the&nbsp;-update&nbsp;flag.&nbsp;This&nbsp;will&nbsp;cause</span><br>
<span class="lineno"></span><span class="comment" id="7291311">//&nbsp;the&nbsp;test&nbsp;files.&nbsp;Generally&nbsp;one&nbsp;should&nbsp;combine&nbsp;the&nbsp;-update&nbsp;flag&nbsp;with&nbsp;-test.run</span><br>
<span class="lineno"></span><span class="comment" id="7291391">//&nbsp;to&nbsp;updated&nbsp;a&nbsp;specific&nbsp;test.&nbsp;Since&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;will&nbsp;always</span><br>
<span class="lineno">35</span><span class="comment" id="7291469">//&nbsp;generate&nbsp;fresh&nbsp;random&nbsp;numbers,&nbsp;large&nbsp;parts&nbsp;of&nbsp;the&nbsp;reference&nbsp;connection&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="7291548">//&nbsp;always&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7291567">var</span>&nbsp;<span class="ident" id="7291571">update</span>&nbsp;<span class="op" id="7291578">=</span>&nbsp;<span class="ident" id="7291580">flag</span><span class="op" id="7291584">.</span><span class="ident" id="7291585">Bool</span><span class="op" id="7291589">(</span><span class="string" id="7291590">&#34;update&#34;</span><span class="op" id="7291598">,</span>&nbsp;<span class="builtintype" id="7291600">false</span><span class="op" id="7291605">,</span>&nbsp;<span class="string" id="7291607">&#34;update&nbsp;golden&nbsp;files&nbsp;on&nbsp;disk&#34;</span><span class="op" id="7291636">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="7291639">//&nbsp;recordingConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;that&nbsp;records&nbsp;the&nbsp;traffic&nbsp;that&nbsp;passes&nbsp;through&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="7291719">//&nbsp;WriteTo&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;produce&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;later&nbsp;be&nbsp;loaded&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="7291793">//&nbsp;ParseTestData.</span><br>
<span class="lineno"></span><span class="keyword" id="7291811">type</span>&nbsp;<span class="ident" id="7291816">recordingConn</span>&nbsp;<span class="keyword" id="7291830">struct</span>&nbsp;<span class="op" id="7291837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291840">net</span><span class="op" id="7291843">.</span><span class="ident" id="7291844">Conn</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291850">sync</span><span class="op" id="7291854">.</span><span class="ident" id="7291855">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291862">flows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7291870">[</span><span class="op" id="7291871">]</span><span class="op" id="7291872">[</span><span class="op" id="7291873">]</span><span class="builtintype" id="7291874">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291880">reading</span>&nbsp;<span class="builtintype" id="7291888">bool</span><br>
<span class="lineno"></span><span class="op" id="7291893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7291896">func</span>&nbsp;<span class="op" id="7291901">(</span><span class="ident" id="7291902">r</span>&nbsp;<span class="op" id="7291904">*</span><span class="ident" id="7291905">recordingConn</span><span class="op" id="7291918">)</span>&nbsp;<span class="ident" id="7291920">Read</span><span class="op" id="7291924">(</span><span class="ident" id="7291925">b</span>&nbsp;<span class="op" id="7291927">[</span><span class="op" id="7291928">]</span><span class="builtintype" id="7291929">byte</span><span class="op" id="7291933">)</span>&nbsp;<span class="op" id="7291935">(</span><span class="ident" id="7291936">n</span>&nbsp;<span class="builtintype" id="7291938">int</span><span class="op" id="7291941">,</span>&nbsp;<span class="ident" id="7291943">err</span>&nbsp;<span class="builtintype" id="7291947">error</span><span class="op" id="7291952">)</span>&nbsp;<span class="op" id="7291954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291957">if</span>&nbsp;<span class="ident" id="7291960">n</span><span class="op" id="7291961">,</span>&nbsp;<span class="ident" id="7291963">err</span>&nbsp;<span class="op" id="7291967">=</span>&nbsp;<span class="ident" id="7291969">r</span><span class="op" id="7291970">.</span><span class="ident" id="7291971">Conn</span><span class="op" id="7291975">.</span><span class="ident" id="7291976">Read</span><span class="op" id="7291980">(</span><span class="ident" id="7291981">b</span><span class="op" id="7291982">)</span><span class="op" id="7291983">;</span>&nbsp;<span class="ident" id="7291985">n</span>&nbsp;<span class="op" id="7291987">==</span>&nbsp;<span class="num" id="7291990">0</span>&nbsp;<span class="op" id="7291992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291996">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292007">b</span>&nbsp;<span class="op" id="7292009">=</span>&nbsp;<span class="ident" id="7292011">b</span><span class="op" id="7292012">[</span><span class="op" id="7292013">:</span><span class="ident" id="7292014">n</span><span class="op" id="7292015">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292019">r</span><span class="op" id="7292020">.</span><span class="ident" id="7292021">Lock</span><span class="op" id="7292025">(</span><span class="op" id="7292026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292029">defer</span>&nbsp;<span class="ident" id="7292035">r</span><span class="op" id="7292036">.</span><span class="ident" id="7292037">Unlock</span><span class="op" id="7292043">(</span><span class="op" id="7292044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292048">if</span>&nbsp;<span class="ident" id="7292051">l</span>&nbsp;<span class="op" id="7292053">:=</span>&nbsp;<span class="builtinfunc" id="7292056">len</span><span class="op" id="7292059">(</span><span class="ident" id="7292060">r</span><span class="op" id="7292061">.</span><span class="ident" id="7292062">flows</span><span class="op" id="7292067">)</span><span class="op" id="7292068">;</span>&nbsp;<span class="ident" id="7292070">l</span>&nbsp;<span class="op" id="7292072">==</span>&nbsp;<span class="num" id="7292075">0</span>&nbsp;<span class="op" id="7292077">||</span>&nbsp;<span class="op" id="7292080">!</span><span class="ident" id="7292081">r</span><span class="op" id="7292082">.</span><span class="ident" id="7292083">reading</span>&nbsp;<span class="op" id="7292091">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292095">buf</span>&nbsp;<span class="op" id="7292099">:=</span>&nbsp;<span class="builtinfunc" id="7292102">make</span><span class="op" id="7292106">(</span><span class="op" id="7292107">[</span><span class="op" id="7292108">]</span><span class="builtintype" id="7292109">byte</span><span class="op" id="7292113">,</span>&nbsp;<span class="builtinfunc" id="7292115">len</span><span class="op" id="7292118">(</span><span class="ident" id="7292119">b</span><span class="op" id="7292120">)</span><span class="op" id="7292121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7292125">copy</span><span class="op" id="7292129">(</span><span class="ident" id="7292130">buf</span><span class="op" id="7292133">,</span>&nbsp;<span class="ident" id="7292135">b</span><span class="op" id="7292136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292140">r</span><span class="op" id="7292141">.</span><span class="ident" id="7292142">flows</span>&nbsp;<span class="op" id="7292148">=</span>&nbsp;<span class="builtinfunc" id="7292150">append</span><span class="op" id="7292156">(</span><span class="ident" id="7292157">r</span><span class="op" id="7292158">.</span><span class="ident" id="7292159">flows</span><span class="op" id="7292164">,</span>&nbsp;<span class="ident" id="7292166">buf</span><span class="op" id="7292169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292172">}</span>&nbsp;<span class="keyword" id="7292174">else</span>&nbsp;<span class="op" id="7292179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292183">r</span><span class="op" id="7292184">.</span><span class="ident" id="7292185">flows</span><span class="op" id="7292190">[</span><span class="ident" id="7292191">l</span><span class="op" id="7292192">-</span><span class="num" id="7292193">1</span><span class="op" id="7292194">]</span>&nbsp;<span class="op" id="7292196">=</span>&nbsp;<span class="builtinfunc" id="7292198">append</span><span class="op" id="7292204">(</span><span class="ident" id="7292205">r</span><span class="op" id="7292206">.</span><span class="ident" id="7292207">flows</span><span class="op" id="7292212">[</span><span class="ident" id="7292213">l</span><span class="op" id="7292214">-</span><span class="num" id="7292215">1</span><span class="op" id="7292216">]</span><span class="op" id="7292217">,</span>&nbsp;<span class="ident" id="7292219">b</span><span class="op" id="7292220">[</span><span class="op" id="7292221">:</span><span class="ident" id="7292222">n</span><span class="op" id="7292223">]</span><span class="op" id="7292224">...</span><span class="op" id="7292227">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292233">r</span><span class="op" id="7292234">.</span><span class="ident" id="7292235">reading</span>&nbsp;<span class="op" id="7292243">=</span>&nbsp;<span class="builtintype" id="7292245">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292251">return</span><br>
<span class="lineno"></span><span class="op" id="7292258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7292261">func</span>&nbsp;<span class="op" id="7292266">(</span><span class="ident" id="7292267">r</span>&nbsp;<span class="op" id="7292269">*</span><span class="ident" id="7292270">recordingConn</span><span class="op" id="7292283">)</span>&nbsp;<span class="ident" id="7292285">Write</span><span class="op" id="7292290">(</span><span class="ident" id="7292291">b</span>&nbsp;<span class="op" id="7292293">[</span><span class="op" id="7292294">]</span><span class="builtintype" id="7292295">byte</span><span class="op" id="7292299">)</span>&nbsp;<span class="op" id="7292301">(</span><span class="ident" id="7292302">n</span>&nbsp;<span class="builtintype" id="7292304">int</span><span class="op" id="7292307">,</span>&nbsp;<span class="ident" id="7292309">err</span>&nbsp;<span class="builtintype" id="7292313">error</span><span class="op" id="7292318">)</span>&nbsp;<span class="op" id="7292320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292323">if</span>&nbsp;<span class="ident" id="7292326">n</span><span class="op" id="7292327">,</span>&nbsp;<span class="ident" id="7292329">err</span>&nbsp;<span class="op" id="7292333">=</span>&nbsp;<span class="ident" id="7292335">r</span><span class="op" id="7292336">.</span><span class="ident" id="7292337">Conn</span><span class="op" id="7292341">.</span><span class="ident" id="7292342">Write</span><span class="op" id="7292347">(</span><span class="ident" id="7292348">b</span><span class="op" id="7292349">)</span><span class="op" id="7292350">;</span>&nbsp;<span class="ident" id="7292352">n</span>&nbsp;<span class="op" id="7292354">==</span>&nbsp;<span class="num" id="7292357">0</span>&nbsp;<span class="op" id="7292359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292363">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292374">b</span>&nbsp;<span class="op" id="7292376">=</span>&nbsp;<span class="ident" id="7292378">b</span><span class="op" id="7292379">[</span><span class="op" id="7292380">:</span><span class="ident" id="7292381">n</span><span class="op" id="7292382">]</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292386">r</span><span class="op" id="7292387">.</span><span class="ident" id="7292388">Lock</span><span class="op" id="7292392">(</span><span class="op" id="7292393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292396">defer</span>&nbsp;<span class="ident" id="7292402">r</span><span class="op" id="7292403">.</span><span class="ident" id="7292404">Unlock</span><span class="op" id="7292410">(</span><span class="op" id="7292411">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292415">if</span>&nbsp;<span class="ident" id="7292418">l</span>&nbsp;<span class="op" id="7292420">:=</span>&nbsp;<span class="builtinfunc" id="7292423">len</span><span class="op" id="7292426">(</span><span class="ident" id="7292427">r</span><span class="op" id="7292428">.</span><span class="ident" id="7292429">flows</span><span class="op" id="7292434">)</span><span class="op" id="7292435">;</span>&nbsp;<span class="ident" id="7292437">l</span>&nbsp;<span class="op" id="7292439">==</span>&nbsp;<span class="num" id="7292442">0</span>&nbsp;<span class="op" id="7292444">||</span>&nbsp;<span class="ident" id="7292447">r</span><span class="op" id="7292448">.</span><span class="ident" id="7292449">reading</span>&nbsp;<span class="op" id="7292457">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292461">buf</span>&nbsp;<span class="op" id="7292465">:=</span>&nbsp;<span class="builtinfunc" id="7292468">make</span><span class="op" id="7292472">(</span><span class="op" id="7292473">[</span><span class="op" id="7292474">]</span><span class="builtintype" id="7292475">byte</span><span class="op" id="7292479">,</span>&nbsp;<span class="builtinfunc" id="7292481">len</span><span class="op" id="7292484">(</span><span class="ident" id="7292485">b</span><span class="op" id="7292486">)</span><span class="op" id="7292487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7292491">copy</span><span class="op" id="7292495">(</span><span class="ident" id="7292496">buf</span><span class="op" id="7292499">,</span>&nbsp;<span class="ident" id="7292501">b</span><span class="op" id="7292502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292506">r</span><span class="op" id="7292507">.</span><span class="ident" id="7292508">flows</span>&nbsp;<span class="op" id="7292514">=</span>&nbsp;<span class="builtinfunc" id="7292516">append</span><span class="op" id="7292522">(</span><span class="ident" id="7292523">r</span><span class="op" id="7292524">.</span><span class="ident" id="7292525">flows</span><span class="op" id="7292530">,</span>&nbsp;<span class="ident" id="7292532">buf</span><span class="op" id="7292535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292538">}</span>&nbsp;<span class="keyword" id="7292540">else</span>&nbsp;<span class="op" id="7292545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292549">r</span><span class="op" id="7292550">.</span><span class="ident" id="7292551">flows</span><span class="op" id="7292556">[</span><span class="ident" id="7292557">l</span><span class="op" id="7292558">-</span><span class="num" id="7292559">1</span><span class="op" id="7292560">]</span>&nbsp;<span class="op" id="7292562">=</span>&nbsp;<span class="builtinfunc" id="7292564">append</span><span class="op" id="7292570">(</span><span class="ident" id="7292571">r</span><span class="op" id="7292572">.</span><span class="ident" id="7292573">flows</span><span class="op" id="7292578">[</span><span class="ident" id="7292579">l</span><span class="op" id="7292580">-</span><span class="num" id="7292581">1</span><span class="op" id="7292582">]</span><span class="op" id="7292583">,</span>&nbsp;<span class="ident" id="7292585">b</span><span class="op" id="7292586">[</span><span class="op" id="7292587">:</span><span class="ident" id="7292588">n</span><span class="op" id="7292589">]</span><span class="op" id="7292590">...</span><span class="op" id="7292593">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292599">r</span><span class="op" id="7292600">.</span><span class="ident" id="7292601">reading</span>&nbsp;<span class="op" id="7292609">=</span>&nbsp;<span class="builtintype" id="7292611">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292618">return</span><br>
<span class="lineno"></span><span class="op" id="7292625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="7292628">//&nbsp;WriteTo&nbsp;writes&nbsp;Go&nbsp;source&nbsp;code&nbsp;to&nbsp;w&nbsp;that&nbsp;contains&nbsp;the&nbsp;recorded&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="7292702">func</span>&nbsp;<span class="op" id="7292707">(</span><span class="ident" id="7292708">r</span>&nbsp;<span class="op" id="7292710">*</span><span class="ident" id="7292711">recordingConn</span><span class="op" id="7292724">)</span>&nbsp;<span class="ident" id="7292726">WriteTo</span><span class="op" id="7292733">(</span><span class="ident" id="7292734">w</span>&nbsp;<span class="ident" id="7292736">io</span><span class="op" id="7292738">.</span><span class="ident" id="7292739">Writer</span><span class="op" id="7292745">)</span>&nbsp;<span class="op" id="7292747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7292750">//&nbsp;TLS&nbsp;always&nbsp;starts&nbsp;with&nbsp;a&nbsp;client&nbsp;to&nbsp;server&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292802">clientToServer</span>&nbsp;<span class="op" id="7292817">:=</span>&nbsp;<span class="builtintype" id="7292820">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292827">for</span>&nbsp;<span class="ident" id="7292831">i</span><span class="op" id="7292832">,</span>&nbsp;<span class="ident" id="7292834">flow</span>&nbsp;<span class="op" id="7292839">:=</span>&nbsp;<span class="keyword" id="7292842">range</span>&nbsp;<span class="ident" id="7292848">r</span><span class="op" id="7292849">.</span><span class="ident" id="7292850">flows</span>&nbsp;<span class="op" id="7292856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292860">source</span><span class="op" id="7292866">,</span>&nbsp;<span class="ident" id="7292868">dest</span>&nbsp;<span class="op" id="7292873">:=</span>&nbsp;<span class="string" id="7292876">&#34;client&#34;</span><span class="op" id="7292884">,</span>&nbsp;<span class="string" id="7292886">&#34;server&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292897">if</span>&nbsp;<span class="op" id="7292900">!</span><span class="ident" id="7292901">clientToServer</span>&nbsp;<span class="op" id="7292916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292921">source</span><span class="op" id="7292927">,</span>&nbsp;<span class="ident" id="7292929">dest</span>&nbsp;<span class="op" id="7292934">=</span>&nbsp;<span class="ident" id="7292936">dest</span><span class="op" id="7292940">,</span>&nbsp;<span class="ident" id="7292942">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292951">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292955">fmt</span><span class="op" id="7292958">.</span><span class="ident" id="7292959">Fprintf</span><span class="op" id="7292966">(</span><span class="ident" id="7292967">w</span><span class="op" id="7292968">,</span>&nbsp;<span class="string" id="7292970">&#34;&gt;&gt;&gt;&nbsp;Flow&nbsp;%d&nbsp;(%s&nbsp;to&nbsp;%s)\n&#34;</span><span class="op" id="7292996">,</span>&nbsp;<span class="ident" id="7292998">i</span><span class="op" id="7292999">+</span><span class="num" id="7293000">1</span><span class="op" id="7293001">,</span>&nbsp;<span class="ident" id="7293003">source</span><span class="op" id="7293009">,</span>&nbsp;<span class="ident" id="7293011">dest</span><span class="op" id="7293015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293019">dumper</span>&nbsp;<span class="op" id="7293026">:=</span>&nbsp;<span class="ident" id="7293029">hex</span><span class="op" id="7293032">.</span><span class="ident" id="7293033">Dumper</span><span class="op" id="7293039">(</span><span class="ident" id="7293040">w</span><span class="op" id="7293041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293045">dumper</span><span class="op" id="7293051">.</span><span class="ident" id="7293052">Write</span><span class="op" id="7293057">(</span><span class="ident" id="7293058">flow</span><span class="op" id="7293062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293066">dumper</span><span class="op" id="7293072">.</span><span class="ident" id="7293073">Close</span><span class="op" id="7293078">(</span><span class="op" id="7293079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293083">clientToServer</span>&nbsp;<span class="op" id="7293098">=</span>&nbsp;<span class="op" id="7293100">!</span><span class="ident" id="7293101">clientToServer</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293117">}</span><br>
<span class="lineno"></span><span class="op" id="7293119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7293122">func</span>&nbsp;<span class="ident" id="7293127">parseTestData</span><span class="op" id="7293140">(</span><span class="ident" id="7293141">r</span>&nbsp;<span class="ident" id="7293143">io</span><span class="op" id="7293145">.</span><span class="ident" id="7293146">Reader</span><span class="op" id="7293152">)</span>&nbsp;<span class="op" id="7293154">(</span><span class="ident" id="7293155">flows</span>&nbsp;<span class="op" id="7293161">[</span><span class="op" id="7293162">]</span><span class="op" id="7293163">[</span><span class="op" id="7293164">]</span><span class="builtintype" id="7293165">byte</span><span class="op" id="7293169">,</span>&nbsp;<span class="ident" id="7293171">err</span>&nbsp;<span class="builtintype" id="7293175">error</span><span class="op" id="7293180">)</span>&nbsp;<span class="op" id="7293182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293185">var</span>&nbsp;<span class="ident" id="7293189">currentFlow</span>&nbsp;<span class="op" id="7293201">[</span><span class="op" id="7293202">]</span><span class="builtintype" id="7293203">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293210">scanner</span>&nbsp;<span class="op" id="7293218">:=</span>&nbsp;<span class="ident" id="7293221">bufio</span><span class="op" id="7293226">.</span><span class="ident" id="7293227">NewScanner</span><span class="op" id="7293237">(</span><span class="ident" id="7293238">r</span><span class="op" id="7293239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293242">for</span>&nbsp;<span class="ident" id="7293246">scanner</span><span class="op" id="7293253">.</span><span class="ident" id="7293254">Scan</span><span class="op" id="7293258">(</span><span class="op" id="7293259">)</span>&nbsp;<span class="op" id="7293261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293265">line</span>&nbsp;<span class="op" id="7293270">:=</span>&nbsp;<span class="ident" id="7293273">scanner</span><span class="op" id="7293280">.</span><span class="ident" id="7293281">Text</span><span class="op" id="7293285">(</span><span class="op" id="7293286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7293290">//&nbsp;If&nbsp;the&nbsp;line&nbsp;starts&nbsp;with&nbsp;&#34;&gt;&gt;&gt;&nbsp;&#34;&nbsp;then&nbsp;it&nbsp;marks&nbsp;the&nbsp;beginning</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7293354">//&nbsp;of&nbsp;a&nbsp;new&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293374">if</span>&nbsp;<span class="ident" id="7293377">strings</span><span class="op" id="7293384">.</span><span class="ident" id="7293385">HasPrefix</span><span class="op" id="7293394">(</span><span class="ident" id="7293395">line</span><span class="op" id="7293399">,</span>&nbsp;<span class="string" id="7293401">&#34;&gt;&gt;&gt;&nbsp;&#34;</span><span class="op" id="7293407">)</span>&nbsp;<span class="op" id="7293409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293414">if</span>&nbsp;<span class="builtinfunc" id="7293417">len</span><span class="op" id="7293420">(</span><span class="ident" id="7293421">currentFlow</span><span class="op" id="7293432">)</span>&nbsp;<span class="op" id="7293434">&gt;</span>&nbsp;<span class="num" id="7293436">0</span>&nbsp;<span class="op" id="7293438">||</span>&nbsp;<span class="builtinfunc" id="7293441">len</span><span class="op" id="7293444">(</span><span class="ident" id="7293445">flows</span><span class="op" id="7293450">)</span>&nbsp;<span class="op" id="7293452">&gt;</span>&nbsp;<span class="num" id="7293454">0</span>&nbsp;<span class="op" id="7293456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293462">flows</span>&nbsp;<span class="op" id="7293468">=</span>&nbsp;<span class="builtinfunc" id="7293470">append</span><span class="op" id="7293476">(</span><span class="ident" id="7293477">flows</span><span class="op" id="7293482">,</span>&nbsp;<span class="ident" id="7293484">currentFlow</span><span class="op" id="7293495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293501">currentFlow</span>&nbsp;<span class="op" id="7293513">=</span>&nbsp;<span class="ident" id="7293515">nil</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293527">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7293543">//&nbsp;Otherwise&nbsp;the&nbsp;line&nbsp;is&nbsp;a&nbsp;line&nbsp;of&nbsp;hex&nbsp;dump&nbsp;that&nbsp;looks&nbsp;like:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7293606">//&nbsp;00000170&nbsp;&nbsp;fc&nbsp;f5&nbsp;06&nbsp;bf&nbsp;(...)&nbsp;&nbsp;|.....X{&amp;?......!|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7293659">//&nbsp;(Some&nbsp;bytes&nbsp;have&nbsp;been&nbsp;omitted&nbsp;from&nbsp;the&nbsp;middle&nbsp;section.)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293721">if</span>&nbsp;<span class="ident" id="7293724">i</span>&nbsp;<span class="op" id="7293726">:=</span>&nbsp;<span class="ident" id="7293729">strings</span><span class="op" id="7293736">.</span><span class="ident" id="7293737">IndexByte</span><span class="op" id="7293746">(</span><span class="ident" id="7293747">line</span><span class="op" id="7293751">,</span>&nbsp;<span class="string" id="7293753">&#39;&nbsp;&#39;</span><span class="op" id="7293756">)</span><span class="op" id="7293757">;</span>&nbsp;<span class="ident" id="7293759">i</span>&nbsp;<span class="op" id="7293761">&gt;=</span>&nbsp;<span class="num" id="7293764">0</span>&nbsp;<span class="op" id="7293766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293771">line</span>&nbsp;<span class="op" id="7293776">=</span>&nbsp;<span class="ident" id="7293778">line</span><span class="op" id="7293782">[</span><span class="ident" id="7293783">i</span><span class="op" id="7293784">:</span><span class="op" id="7293785">]</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293789">}</span>&nbsp;<span class="keyword" id="7293791">else</span>&nbsp;<span class="op" id="7293796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293801">return</span>&nbsp;<span class="ident" id="7293808">nil</span><span class="op" id="7293811">,</span>&nbsp;<span class="ident" id="7293813">errors</span><span class="op" id="7293819">.</span><span class="ident" id="7293820">New</span><span class="op" id="7293823">(</span><span class="string" id="7293824">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7293843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293852">if</span>&nbsp;<span class="ident" id="7293855">i</span>&nbsp;<span class="op" id="7293857">:=</span>&nbsp;<span class="ident" id="7293860">strings</span><span class="op" id="7293867">.</span><span class="ident" id="7293868">IndexByte</span><span class="op" id="7293877">(</span><span class="ident" id="7293878">line</span><span class="op" id="7293882">,</span>&nbsp;<span class="string" id="7293884">&#39;|&#39;</span><span class="op" id="7293887">)</span><span class="op" id="7293888">;</span>&nbsp;<span class="ident" id="7293890">i</span>&nbsp;<span class="op" id="7293892">&gt;=</span>&nbsp;<span class="num" id="7293895">0</span>&nbsp;<span class="op" id="7293897">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293902">line</span>&nbsp;<span class="op" id="7293907">=</span>&nbsp;<span class="ident" id="7293909">line</span><span class="op" id="7293913">[</span><span class="op" id="7293914">:</span><span class="ident" id="7293915">i</span><span class="op" id="7293916">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293920">}</span>&nbsp;<span class="keyword" id="7293922">else</span>&nbsp;<span class="op" id="7293927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293932">return</span>&nbsp;<span class="ident" id="7293939">nil</span><span class="op" id="7293942">,</span>&nbsp;<span class="ident" id="7293944">errors</span><span class="op" id="7293950">.</span><span class="ident" id="7293951">New</span><span class="op" id="7293954">(</span><span class="string" id="7293955">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7293974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293983">hexBytes</span>&nbsp;<span class="op" id="7293992">:=</span>&nbsp;<span class="ident" id="7293995">strings</span><span class="op" id="7294002">.</span><span class="ident" id="7294003">Fields</span><span class="op" id="7294009">(</span><span class="ident" id="7294010">line</span><span class="op" id="7294014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294018">for</span>&nbsp;<span class="ident" id="7294022">_</span><span class="op" id="7294023">,</span>&nbsp;<span class="ident" id="7294025">hexByte</span>&nbsp;<span class="op" id="7294033">:=</span>&nbsp;<span class="keyword" id="7294036">range</span>&nbsp;<span class="ident" id="7294042">hexBytes</span>&nbsp;<span class="op" id="7294051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294056">val</span><span class="op" id="7294059">,</span>&nbsp;<span class="ident" id="7294061">err</span>&nbsp;<span class="op" id="7294065">:=</span>&nbsp;<span class="ident" id="7294068">strconv</span><span class="op" id="7294075">.</span><span class="ident" id="7294076">ParseUint</span><span class="op" id="7294085">(</span><span class="ident" id="7294086">hexByte</span><span class="op" id="7294093">,</span>&nbsp;<span class="num" id="7294095">16</span><span class="op" id="7294097">,</span>&nbsp;<span class="num" id="7294099">8</span><span class="op" id="7294100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294105">if</span>&nbsp;<span class="ident" id="7294108">err</span>&nbsp;<span class="op" id="7294112">!=</span>&nbsp;<span class="ident" id="7294115">nil</span>&nbsp;<span class="op" id="7294119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294125">return</span>&nbsp;<span class="ident" id="7294132">nil</span><span class="op" id="7294135">,</span>&nbsp;<span class="ident" id="7294137">errors</span><span class="op" id="7294143">.</span><span class="ident" id="7294144">New</span><span class="op" id="7294147">(</span><span class="string" id="7294148">&#34;invalid&nbsp;hex&nbsp;byte&nbsp;in&nbsp;test&nbsp;data:&nbsp;&#34;</span>&nbsp;<span class="op" id="7294182">+</span>&nbsp;<span class="ident" id="7294184">err</span><span class="op" id="7294187">.</span><span class="ident" id="7294188">Error</span><span class="op" id="7294193">(</span><span class="op" id="7294194">)</span><span class="op" id="7294195">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7294200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294205">currentFlow</span>&nbsp;<span class="op" id="7294217">=</span>&nbsp;<span class="builtinfunc" id="7294219">append</span><span class="op" id="7294225">(</span><span class="ident" id="7294226">currentFlow</span><span class="op" id="7294237">,</span>&nbsp;<span class="builtintype" id="7294239">byte</span><span class="op" id="7294243">(</span><span class="ident" id="7294244">val</span><span class="op" id="7294247">)</span><span class="op" id="7294248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7294252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7294255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294259">if</span>&nbsp;<span class="builtinfunc" id="7294262">len</span><span class="op" id="7294265">(</span><span class="ident" id="7294266">currentFlow</span><span class="op" id="7294277">)</span>&nbsp;<span class="op" id="7294279">&gt;</span>&nbsp;<span class="num" id="7294281">0</span>&nbsp;<span class="op" id="7294283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294287">flows</span>&nbsp;<span class="op" id="7294293">=</span>&nbsp;<span class="builtinfunc" id="7294295">append</span><span class="op" id="7294301">(</span><span class="ident" id="7294302">flows</span><span class="op" id="7294307">,</span>&nbsp;<span class="ident" id="7294309">currentFlow</span><span class="op" id="7294320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7294323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294327">return</span>&nbsp;<span class="ident" id="7294334">flows</span><span class="op" id="7294339">,</span>&nbsp;<span class="ident" id="7294341">nil</span><br>
<span class="lineno">155</span><span class="op" id="7294345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7294348">//&nbsp;tempFile&nbsp;creates&nbsp;a&nbsp;temp&nbsp;file&nbsp;containing&nbsp;contents&nbsp;and&nbsp;returns&nbsp;its&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="7294422">func</span>&nbsp;<span class="ident" id="7294427">tempFile</span><span class="op" id="7294435">(</span><span class="ident" id="7294436">contents</span>&nbsp;<span class="builtintype" id="7294445">string</span><span class="op" id="7294451">)</span>&nbsp;<span class="builtintype" id="7294453">string</span>&nbsp;<span class="op" id="7294460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294463">file</span><span class="op" id="7294467">,</span>&nbsp;<span class="ident" id="7294469">err</span>&nbsp;<span class="op" id="7294473">:=</span>&nbsp;<span class="ident" id="7294476">ioutil</span><span class="op" id="7294482">.</span><span class="ident" id="7294483">TempFile</span><span class="op" id="7294491">(</span><span class="string" id="7294492">&#34;&#34;</span><span class="op" id="7294494">,</span>&nbsp;<span class="string" id="7294496">&#34;go-tls-test&#34;</span><span class="op" id="7294509">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294512">if</span>&nbsp;<span class="ident" id="7294515">err</span>&nbsp;<span class="op" id="7294519">!=</span>&nbsp;<span class="ident" id="7294522">nil</span>&nbsp;<span class="op" id="7294526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7294530">panic</span><span class="op" id="7294535">(</span><span class="string" id="7294536">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file:&nbsp;&#34;</span>&nbsp;<span class="op" id="7294567">+</span>&nbsp;<span class="ident" id="7294569">err</span><span class="op" id="7294572">.</span><span class="ident" id="7294573">Error</span><span class="op" id="7294578">(</span><span class="op" id="7294579">)</span><span class="op" id="7294580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7294583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294586">path</span>&nbsp;<span class="op" id="7294591">:=</span>&nbsp;<span class="ident" id="7294594">file</span><span class="op" id="7294598">.</span><span class="ident" id="7294599">Name</span><span class="op" id="7294603">(</span><span class="op" id="7294604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294607">file</span><span class="op" id="7294611">.</span><span class="ident" id="7294612">WriteString</span><span class="op" id="7294623">(</span><span class="ident" id="7294624">contents</span><span class="op" id="7294632">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294635">file</span><span class="op" id="7294639">.</span><span class="ident" id="7294640">Close</span><span class="op" id="7294645">(</span><span class="op" id="7294646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294649">return</span>&nbsp;<span class="ident" id="7294656">path</span><br>
<span class="lineno"></span><span class="op" id="7294661">}</span>
</div>
</body>
</html>
