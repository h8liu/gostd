<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html" class="current">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3350903">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3350958">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3351012">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3351063">package</span>&nbsp;<span class="ident" id="3351071">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3351078">type</span>&nbsp;<span class="ident" id="3351083">serializedFile</span>&nbsp;<span class="keyword" id="3351098">struct</span>&nbsp;<span class="op" id="3351105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3351108">//&nbsp;fields&nbsp;correspond&nbsp;1:1&nbsp;to&nbsp;fields&nbsp;with&nbsp;same&nbsp;(lower-case)&nbsp;name&nbsp;in&nbsp;File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351180">Name</span>&nbsp;&nbsp;<span class="builtintype" id="3351186">string</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351194">Base</span>&nbsp;&nbsp;<span class="builtintype" id="3351200">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351205">Size</span>&nbsp;&nbsp;<span class="builtintype" id="3351211">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351216">Lines</span>&nbsp;<span class="op" id="3351222">[</span><span class="op" id="3351223">]</span><span class="builtintype" id="3351224">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351229">Infos</span>&nbsp;<span class="op" id="3351235">[</span><span class="op" id="3351236">]</span><span class="ident" id="3351237">lineInfo</span><br>
<span class="lineno"></span><span class="op" id="3351246">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3351249">type</span>&nbsp;<span class="ident" id="3351254">serializedFileSet</span>&nbsp;<span class="keyword" id="3351272">struct</span>&nbsp;<span class="op" id="3351279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351282">Base</span>&nbsp;&nbsp;<span class="builtintype" id="3351288">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351293">Files</span>&nbsp;<span class="op" id="3351299">[</span><span class="op" id="3351300">]</span><span class="ident" id="3351301">serializedFile</span><br>
<span class="lineno"></span><span class="op" id="3351316">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="3351319">//&nbsp;Read&nbsp;calls&nbsp;decode&nbsp;to&nbsp;deserialize&nbsp;a&nbsp;file&nbsp;set&nbsp;into&nbsp;s;&nbsp;s&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3351393">func</span>&nbsp;<span class="op" id="3351398">(</span><span class="ident" id="3351399">s</span>&nbsp;<span class="op" id="3351401">*</span><span class="ident" id="3351402">FileSet</span><span class="op" id="3351409">)</span>&nbsp;<span class="ident" id="3351411">Read</span><span class="op" id="3351415">(</span><span class="ident" id="3351416">decode</span>&nbsp;<span class="keyword" id="3351423">func</span><span class="op" id="3351427">(</span><span class="keyword" id="3351428">interface</span><span class="op" id="3351437">{</span><span class="op" id="3351438">}</span><span class="op" id="3351439">)</span>&nbsp;<span class="builtintype" id="3351441">error</span><span class="op" id="3351446">)</span>&nbsp;<span class="builtintype" id="3351448">error</span>&nbsp;<span class="op" id="3351454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351457">var</span>&nbsp;<span class="ident" id="3351461">ss</span>&nbsp;<span class="ident" id="3351464">serializedFileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351483">if</span>&nbsp;<span class="ident" id="3351486">err</span>&nbsp;<span class="op" id="3351490">:=</span>&nbsp;<span class="ident" id="3351493">decode</span><span class="op" id="3351499">(</span><span class="op" id="3351500">&amp;</span><span class="ident" id="3351501">ss</span><span class="op" id="3351503">)</span><span class="op" id="3351504">;</span>&nbsp;<span class="ident" id="3351506">err</span>&nbsp;<span class="op" id="3351510">!=</span>&nbsp;<span class="ident" id="3351513">nil</span>&nbsp;<span class="op" id="3351517">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351521">return</span>&nbsp;<span class="ident" id="3351528">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3351533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351537">s</span><span class="op" id="3351538">.</span><span class="ident" id="3351539">mutex</span><span class="op" id="3351544">.</span><span class="ident" id="3351545">Lock</span><span class="op" id="3351549">(</span><span class="op" id="3351550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351553">s</span><span class="op" id="3351554">.</span><span class="ident" id="3351555">base</span>&nbsp;<span class="op" id="3351560">=</span>&nbsp;<span class="ident" id="3351562">ss</span><span class="op" id="3351564">.</span><span class="ident" id="3351565">Base</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351571">files</span>&nbsp;<span class="op" id="3351577">:=</span>&nbsp;<span class="builtinfunc" id="3351580">make</span><span class="op" id="3351584">(</span><span class="op" id="3351585">[</span><span class="op" id="3351586">]</span><span class="op" id="3351587">*</span><span class="ident" id="3351588">File</span><span class="op" id="3351592">,</span>&nbsp;<span class="builtinfunc" id="3351594">len</span><span class="op" id="3351597">(</span><span class="ident" id="3351598">ss</span><span class="op" id="3351600">.</span><span class="ident" id="3351601">Files</span><span class="op" id="3351606">)</span><span class="op" id="3351607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351610">for</span>&nbsp;<span class="ident" id="3351614">i</span>&nbsp;<span class="op" id="3351616">:=</span>&nbsp;<span class="num" id="3351619">0</span><span class="op" id="3351620">;</span>&nbsp;<span class="ident" id="3351622">i</span>&nbsp;<span class="op" id="3351624">&lt;</span>&nbsp;<span class="builtinfunc" id="3351626">len</span><span class="op" id="3351629">(</span><span class="ident" id="3351630">ss</span><span class="op" id="3351632">.</span><span class="ident" id="3351633">Files</span><span class="op" id="3351638">)</span><span class="op" id="3351639">;</span>&nbsp;<span class="ident" id="3351641">i</span><span class="op" id="3351642">++</span>&nbsp;<span class="op" id="3351645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351649">f</span>&nbsp;<span class="op" id="3351651">:=</span>&nbsp;<span class="op" id="3351654">&amp;</span><span class="ident" id="3351655">ss</span><span class="op" id="3351657">.</span><span class="ident" id="3351658">Files</span><span class="op" id="3351663">[</span><span class="ident" id="3351664">i</span><span class="op" id="3351665">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351669">files</span><span class="op" id="3351674">[</span><span class="ident" id="3351675">i</span><span class="op" id="3351676">]</span>&nbsp;<span class="op" id="3351678">=</span>&nbsp;<span class="op" id="3351680">&amp;</span><span class="ident" id="3351681">File</span><span class="op" id="3351685">{</span><span class="ident" id="3351686">s</span><span class="op" id="3351687">,</span>&nbsp;<span class="ident" id="3351689">f</span><span class="op" id="3351690">.</span><span class="ident" id="3351691">Name</span><span class="op" id="3351695">,</span>&nbsp;<span class="ident" id="3351697">f</span><span class="op" id="3351698">.</span><span class="ident" id="3351699">Base</span><span class="op" id="3351703">,</span>&nbsp;<span class="ident" id="3351705">f</span><span class="op" id="3351706">.</span><span class="ident" id="3351707">Size</span><span class="op" id="3351711">,</span>&nbsp;<span class="ident" id="3351713">f</span><span class="op" id="3351714">.</span><span class="ident" id="3351715">Lines</span><span class="op" id="3351720">,</span>&nbsp;<span class="ident" id="3351722">f</span><span class="op" id="3351723">.</span><span class="ident" id="3351724">Infos</span><span class="op" id="3351729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3351732">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351735">s</span><span class="op" id="3351736">.</span><span class="ident" id="3351737">files</span>&nbsp;<span class="op" id="3351743">=</span>&nbsp;<span class="ident" id="3351745">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351752">s</span><span class="op" id="3351753">.</span><span class="ident" id="3351754">last</span>&nbsp;<span class="op" id="3351759">=</span>&nbsp;<span class="ident" id="3351761">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351766">s</span><span class="op" id="3351767">.</span><span class="ident" id="3351768">mutex</span><span class="op" id="3351773">.</span><span class="ident" id="3351774">Unlock</span><span class="op" id="3351780">(</span><span class="op" id="3351781">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351785">return</span>&nbsp;<span class="ident" id="3351792">nil</span><br>
<span class="lineno">40</span><span class="op" id="3351796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3351799">//&nbsp;Write&nbsp;calls&nbsp;encode&nbsp;to&nbsp;serialize&nbsp;the&nbsp;file&nbsp;set&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3351850">func</span>&nbsp;<span class="op" id="3351855">(</span><span class="ident" id="3351856">s</span>&nbsp;<span class="op" id="3351858">*</span><span class="ident" id="3351859">FileSet</span><span class="op" id="3351866">)</span>&nbsp;<span class="ident" id="3351868">Write</span><span class="op" id="3351873">(</span><span class="ident" id="3351874">encode</span>&nbsp;<span class="keyword" id="3351881">func</span><span class="op" id="3351885">(</span><span class="keyword" id="3351886">interface</span><span class="op" id="3351895">{</span><span class="op" id="3351896">}</span><span class="op" id="3351897">)</span>&nbsp;<span class="builtintype" id="3351899">error</span><span class="op" id="3351904">)</span>&nbsp;<span class="builtintype" id="3351906">error</span>&nbsp;<span class="op" id="3351912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351915">var</span>&nbsp;<span class="ident" id="3351919">ss</span>&nbsp;<span class="ident" id="3351922">serializedFileSet</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351942">s</span><span class="op" id="3351943">.</span><span class="ident" id="3351944">mutex</span><span class="op" id="3351949">.</span><span class="ident" id="3351950">Lock</span><span class="op" id="3351954">(</span><span class="op" id="3351955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351958">ss</span><span class="op" id="3351960">.</span><span class="ident" id="3351961">Base</span>&nbsp;<span class="op" id="3351966">=</span>&nbsp;<span class="ident" id="3351968">s</span><span class="op" id="3351969">.</span><span class="ident" id="3351970">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351976">files</span>&nbsp;<span class="op" id="3351982">:=</span>&nbsp;<span class="builtinfunc" id="3351985">make</span><span class="op" id="3351989">(</span><span class="op" id="3351990">[</span><span class="op" id="3351991">]</span><span class="ident" id="3351992">serializedFile</span><span class="op" id="3352006">,</span>&nbsp;<span class="builtinfunc" id="3352008">len</span><span class="op" id="3352011">(</span><span class="ident" id="3352012">s</span><span class="op" id="3352013">.</span><span class="ident" id="3352014">files</span><span class="op" id="3352019">)</span><span class="op" id="3352020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352023">for</span>&nbsp;<span class="ident" id="3352027">i</span><span class="op" id="3352028">,</span>&nbsp;<span class="ident" id="3352030">f</span>&nbsp;<span class="op" id="3352032">:=</span>&nbsp;<span class="keyword" id="3352035">range</span>&nbsp;<span class="ident" id="3352041">s</span><span class="op" id="3352042">.</span><span class="ident" id="3352043">files</span>&nbsp;<span class="op" id="3352049">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3352053">files</span><span class="op" id="3352058">[</span><span class="ident" id="3352059">i</span><span class="op" id="3352060">]</span>&nbsp;<span class="op" id="3352062">=</span>&nbsp;<span class="ident" id="3352064">serializedFile</span><span class="op" id="3352078">{</span><span class="ident" id="3352079">f</span><span class="op" id="3352080">.</span><span class="ident" id="3352081">name</span><span class="op" id="3352085">,</span>&nbsp;<span class="ident" id="3352087">f</span><span class="op" id="3352088">.</span><span class="ident" id="3352089">base</span><span class="op" id="3352093">,</span>&nbsp;<span class="ident" id="3352095">f</span><span class="op" id="3352096">.</span><span class="ident" id="3352097">size</span><span class="op" id="3352101">,</span>&nbsp;<span class="ident" id="3352103">f</span><span class="op" id="3352104">.</span><span class="ident" id="3352105">lines</span><span class="op" id="3352110">,</span>&nbsp;<span class="ident" id="3352112">f</span><span class="op" id="3352113">.</span><span class="ident" id="3352114">infos</span><span class="op" id="3352119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3352122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3352125">ss</span><span class="op" id="3352127">.</span><span class="ident" id="3352128">Files</span>&nbsp;<span class="op" id="3352134">=</span>&nbsp;<span class="ident" id="3352136">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3352143">s</span><span class="op" id="3352144">.</span><span class="ident" id="3352145">mutex</span><span class="op" id="3352150">.</span><span class="ident" id="3352151">Unlock</span><span class="op" id="3352157">(</span><span class="op" id="3352158">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352162">return</span>&nbsp;<span class="ident" id="3352169">encode</span><span class="op" id="3352175">(</span><span class="ident" id="3352176">ss</span><span class="op" id="3352178">)</span><br>
<span class="lineno"></span><span class="op" id="3352180">}</span>
</div>
</body>
</html>
