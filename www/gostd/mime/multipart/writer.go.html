<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4281387">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4281442">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4281496">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4281547">package</span>&nbsp;<span class="ident" id="4281555">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4281566">import</span>&nbsp;<span class="op" id="4281573">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4281576">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4281585">&#34;crypto/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4281600">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4281610">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4281617">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4281623">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4281640">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4281650">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4281653">//&nbsp;A&nbsp;Writer&nbsp;generates&nbsp;multipart&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="4281695">type</span>&nbsp;<span class="ident" id="4281700">Writer</span>&nbsp;<span class="keyword" id="4281707">struct</span>&nbsp;<span class="op" id="4281714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281717">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281726">io</span><span class="op" id="4281728">.</span><span class="ident" id="4281729">Writer</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281737">boundary</span>&nbsp;<span class="builtintype" id="4281746">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281754">lastpart</span>&nbsp;<span class="op" id="4281763">*</span><span class="ident" id="4281764">part</span><br>
<span class="lineno"></span><span class="op" id="4281769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4281772">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;multipart&nbsp;Writer&nbsp;with&nbsp;a&nbsp;random&nbsp;boundary,</span><br>
<span class="lineno">25</span><span class="comment" id="4281840">//&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4281857">func</span>&nbsp;<span class="ident" id="4281862">NewWriter</span><span class="op" id="4281871">(</span><span class="ident" id="4281872">w</span>&nbsp;<span class="ident" id="4281874">io</span><span class="op" id="4281876">.</span><span class="ident" id="4281877">Writer</span><span class="op" id="4281883">)</span>&nbsp;<span class="op" id="4281885">*</span><span class="ident" id="4281886">Writer</span>&nbsp;<span class="op" id="4281893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281896">return</span>&nbsp;<span class="op" id="4281903">&amp;</span><span class="ident" id="4281904">Writer</span><span class="op" id="4281910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281914">w</span><span class="op" id="4281915">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281924">w</span><span class="op" id="4281925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281929">boundary</span><span class="op" id="4281937">:</span>&nbsp;<span class="ident" id="4281939">randomBoundary</span><span class="op" id="4281953">(</span><span class="op" id="4281954">)</span><span class="op" id="4281955">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4281958">}</span><br>
<span class="lineno"></span><span class="op" id="4281960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4281963">//&nbsp;Boundary&nbsp;returns&nbsp;the&nbsp;Writer&#39;s&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="4282006">func</span>&nbsp;<span class="op" id="4282011">(</span><span class="ident" id="4282012">w</span>&nbsp;<span class="op" id="4282014">*</span><span class="ident" id="4282015">Writer</span><span class="op" id="4282021">)</span>&nbsp;<span class="ident" id="4282023">Boundary</span><span class="op" id="4282031">(</span><span class="op" id="4282032">)</span>&nbsp;<span class="builtintype" id="4282034">string</span>&nbsp;<span class="op" id="4282041">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282044">return</span>&nbsp;<span class="ident" id="4282051">w</span><span class="op" id="4282052">.</span><span class="ident" id="4282053">boundary</span><br>
<span class="lineno"></span><span class="op" id="4282062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4282065">//&nbsp;SetBoundary&nbsp;overrides&nbsp;the&nbsp;Writer&#39;s&nbsp;default&nbsp;randomly-generated</span><br>
<span class="lineno"></span><span class="comment" id="4282130">//&nbsp;boundary&nbsp;separator&nbsp;with&nbsp;an&nbsp;explicit&nbsp;value.</span><br>
<span class="lineno">40</span><span class="comment" id="4282176">//</span><br>
<span class="lineno"></span><span class="comment" id="4282179">//&nbsp;SetBoundary&nbsp;must&nbsp;be&nbsp;called&nbsp;before&nbsp;any&nbsp;parts&nbsp;are&nbsp;created,&nbsp;may&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="4282248">//&nbsp;contain&nbsp;certain&nbsp;ASCII&nbsp;characters,&nbsp;and&nbsp;must&nbsp;be&nbsp;1-69&nbsp;bytes&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="4282314">func</span>&nbsp;<span class="op" id="4282319">(</span><span class="ident" id="4282320">w</span>&nbsp;<span class="op" id="4282322">*</span><span class="ident" id="4282323">Writer</span><span class="op" id="4282329">)</span>&nbsp;<span class="ident" id="4282331">SetBoundary</span><span class="op" id="4282342">(</span><span class="ident" id="4282343">boundary</span>&nbsp;<span class="builtintype" id="4282352">string</span><span class="op" id="4282358">)</span>&nbsp;<span class="builtintype" id="4282360">error</span>&nbsp;<span class="op" id="4282366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282369">if</span>&nbsp;<span class="ident" id="4282372">w</span><span class="op" id="4282373">.</span><span class="ident" id="4282374">lastpart</span>&nbsp;<span class="op" id="4282383">!=</span>&nbsp;<span class="builtintype" id="4282386">nil</span>&nbsp;<span class="op" id="4282390">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282394">return</span>&nbsp;<span class="ident" id="4282401">errors</span><span class="op" id="4282407">.</span><span class="ident" id="4282408">New</span><span class="op" id="4282411">(</span><span class="string" id="4282412">&#34;mime:&nbsp;SetBoundary&nbsp;called&nbsp;after&nbsp;write&#34;</span><span class="op" id="4282450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4282456">//&nbsp;rfc2046#section-5.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282482">if</span>&nbsp;<span class="builtinfunc" id="4282485">len</span><span class="op" id="4282488">(</span><span class="ident" id="4282489">boundary</span><span class="op" id="4282497">)</span>&nbsp;<span class="op" id="4282499">&lt;</span>&nbsp;<span class="num" id="4282501">1</span>&nbsp;<span class="op" id="4282503">||</span>&nbsp;<span class="builtinfunc" id="4282506">len</span><span class="op" id="4282509">(</span><span class="ident" id="4282510">boundary</span><span class="op" id="4282518">)</span>&nbsp;<span class="op" id="4282520">&gt;</span>&nbsp;<span class="num" id="4282522">69</span>&nbsp;<span class="op" id="4282525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282529">return</span>&nbsp;<span class="ident" id="4282536">errors</span><span class="op" id="4282542">.</span><span class="ident" id="4282543">New</span><span class="op" id="4282546">(</span><span class="string" id="4282547">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;length&#34;</span><span class="op" id="4282578">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282584">for</span>&nbsp;<span class="ident" id="4282588">_</span><span class="op" id="4282589">,</span>&nbsp;<span class="ident" id="4282591">b</span>&nbsp;<span class="op" id="4282593">:=</span>&nbsp;<span class="keyword" id="4282596">range</span>&nbsp;<span class="ident" id="4282602">boundary</span>&nbsp;<span class="op" id="4282611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282615">if</span>&nbsp;<span class="string" id="4282618">&#39;A&#39;</span>&nbsp;<span class="op" id="4282622">&lt;=</span>&nbsp;<span class="ident" id="4282625">b</span>&nbsp;<span class="op" id="4282627">&amp;&amp;</span>&nbsp;<span class="ident" id="4282630">b</span>&nbsp;<span class="op" id="4282632">&lt;=</span>&nbsp;<span class="string" id="4282635">&#39;Z&#39;</span>&nbsp;<span class="op" id="4282639">||</span>&nbsp;<span class="string" id="4282642">&#39;a&#39;</span>&nbsp;<span class="op" id="4282646">&lt;=</span>&nbsp;<span class="ident" id="4282649">b</span>&nbsp;<span class="op" id="4282651">&amp;&amp;</span>&nbsp;<span class="ident" id="4282654">b</span>&nbsp;<span class="op" id="4282656">&lt;=</span>&nbsp;<span class="string" id="4282659">&#39;z&#39;</span>&nbsp;<span class="op" id="4282663">||</span>&nbsp;<span class="string" id="4282666">&#39;0&#39;</span>&nbsp;<span class="op" id="4282670">&lt;=</span>&nbsp;<span class="ident" id="4282673">b</span>&nbsp;<span class="op" id="4282675">&amp;&amp;</span>&nbsp;<span class="ident" id="4282678">b</span>&nbsp;<span class="op" id="4282680">&lt;=</span>&nbsp;<span class="string" id="4282683">&#39;9&#39;</span>&nbsp;<span class="op" id="4282687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282692">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282703">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282707">switch</span>&nbsp;<span class="ident" id="4282714">b</span>&nbsp;<span class="op" id="4282716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282720">case</span>&nbsp;<span class="string" id="4282725">&#39;\&#39;&#39;</span><span class="op" id="4282729">,</span>&nbsp;<span class="string" id="4282731">&#39;(&#39;</span><span class="op" id="4282734">,</span>&nbsp;<span class="string" id="4282736">&#39;)&#39;</span><span class="op" id="4282739">,</span>&nbsp;<span class="string" id="4282741">&#39;+&#39;</span><span class="op" id="4282744">,</span>&nbsp;<span class="string" id="4282746">&#39;_&#39;</span><span class="op" id="4282749">,</span>&nbsp;<span class="string" id="4282751">&#39;,&#39;</span><span class="op" id="4282754">,</span>&nbsp;<span class="string" id="4282756">&#39;-&#39;</span><span class="op" id="4282759">,</span>&nbsp;<span class="string" id="4282761">&#39;.&#39;</span><span class="op" id="4282764">,</span>&nbsp;<span class="string" id="4282766">&#39;/&#39;</span><span class="op" id="4282769">,</span>&nbsp;<span class="string" id="4282771">&#39;:&#39;</span><span class="op" id="4282774">,</span>&nbsp;<span class="string" id="4282776">&#39;=&#39;</span><span class="op" id="4282779">,</span>&nbsp;<span class="string" id="4282781">&#39;?&#39;</span><span class="op" id="4282784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282789">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282804">return</span>&nbsp;<span class="ident" id="4282811">errors</span><span class="op" id="4282817">.</span><span class="ident" id="4282818">New</span><span class="op" id="4282821">(</span><span class="string" id="4282822">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;character&#34;</span><span class="op" id="4282856">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282862">w</span><span class="op" id="4282863">.</span><span class="ident" id="4282864">boundary</span>&nbsp;<span class="op" id="4282873">=</span>&nbsp;<span class="ident" id="4282875">boundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282885">return</span>&nbsp;<span class="builtintype" id="4282892">nil</span><br>
<span class="lineno"></span><span class="op" id="4282896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4282899">//&nbsp;FormDataContentType&nbsp;returns&nbsp;the&nbsp;Content-Type&nbsp;for&nbsp;an&nbsp;HTTP</span><br>
<span class="lineno"></span><span class="comment" id="4282959">//&nbsp;multipart/form-data&nbsp;with&nbsp;this&nbsp;Writer&#39;s&nbsp;Boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="4283011">func</span>&nbsp;<span class="op" id="4283016">(</span><span class="ident" id="4283017">w</span>&nbsp;<span class="op" id="4283019">*</span><span class="ident" id="4283020">Writer</span><span class="op" id="4283026">)</span>&nbsp;<span class="ident" id="4283028">FormDataContentType</span><span class="op" id="4283047">(</span><span class="op" id="4283048">)</span>&nbsp;<span class="builtintype" id="4283050">string</span>&nbsp;<span class="op" id="4283057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283060">return</span>&nbsp;<span class="string" id="4283067">&#34;multipart/form-data;&nbsp;boundary=&#34;</span>&nbsp;<span class="op" id="4283100">+</span>&nbsp;<span class="ident" id="4283102">w</span><span class="op" id="4283103">.</span><span class="ident" id="4283104">boundary</span><br>
<span class="lineno"></span><span class="op" id="4283113">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4283116">func</span>&nbsp;<span class="ident" id="4283121">randomBoundary</span><span class="op" id="4283135">(</span><span class="op" id="4283136">)</span>&nbsp;<span class="builtintype" id="4283138">string</span>&nbsp;<span class="op" id="4283145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283148">var</span>&nbsp;<span class="ident" id="4283152">buf</span>&nbsp;<span class="op" id="4283156">[</span><span class="num" id="4283157">30</span><span class="op" id="4283159">]</span><span class="builtintype" id="4283160">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283166">_</span><span class="op" id="4283167">,</span>&nbsp;<span class="ident" id="4283169">err</span>&nbsp;<span class="op" id="4283173">:=</span>&nbsp;<span class="ident" id="4283176">io</span><span class="op" id="4283178">.</span><span class="ident" id="4283179">ReadFull</span><span class="op" id="4283187">(</span><span class="ident" id="4283188">rand</span><span class="op" id="4283192">.</span><span class="ident" id="4283193">Reader</span><span class="op" id="4283199">,</span>&nbsp;<span class="ident" id="4283201">buf</span><span class="op" id="4283204">[</span><span class="op" id="4283205">:</span><span class="op" id="4283206">]</span><span class="op" id="4283207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283210">if</span>&nbsp;<span class="ident" id="4283213">err</span>&nbsp;<span class="op" id="4283217">!=</span>&nbsp;<span class="builtintype" id="4283220">nil</span>&nbsp;<span class="op" id="4283224">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4283228">panic</span><span class="op" id="4283233">(</span><span class="ident" id="4283234">err</span><span class="op" id="4283237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283243">return</span>&nbsp;<span class="ident" id="4283250">fmt</span><span class="op" id="4283253">.</span><span class="ident" id="4283254">Sprintf</span><span class="op" id="4283261">(</span><span class="string" id="4283262">&#34;%x&#34;</span><span class="op" id="4283266">,</span>&nbsp;<span class="ident" id="4283268">buf</span><span class="op" id="4283271">[</span><span class="op" id="4283272">:</span><span class="op" id="4283273">]</span><span class="op" id="4283274">)</span><br>
<span class="lineno"></span><span class="op" id="4283276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4283279">//&nbsp;CreatePart&nbsp;creates&nbsp;a&nbsp;new&nbsp;multipart&nbsp;section&nbsp;with&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="4283343">//&nbsp;header.&nbsp;The&nbsp;body&nbsp;of&nbsp;the&nbsp;part&nbsp;should&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="4283409">//&nbsp;Writer.&nbsp;After&nbsp;calling&nbsp;CreatePart,&nbsp;any&nbsp;previous&nbsp;part&nbsp;may&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="4283478">//&nbsp;be&nbsp;written&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="4283496">func</span>&nbsp;<span class="op" id="4283501">(</span><span class="ident" id="4283502">w</span>&nbsp;<span class="op" id="4283504">*</span><span class="ident" id="4283505">Writer</span><span class="op" id="4283511">)</span>&nbsp;<span class="ident" id="4283513">CreatePart</span><span class="op" id="4283523">(</span><span class="ident" id="4283524">header</span>&nbsp;<span class="ident" id="4283531">textproto</span><span class="op" id="4283540">.</span><span class="ident" id="4283541">MIMEHeader</span><span class="op" id="4283551">)</span>&nbsp;<span class="op" id="4283553">(</span><span class="ident" id="4283554">io</span><span class="op" id="4283556">.</span><span class="ident" id="4283557">Writer</span><span class="op" id="4283563">,</span>&nbsp;<span class="builtintype" id="4283565">error</span><span class="op" id="4283570">)</span>&nbsp;<span class="op" id="4283572">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283575">if</span>&nbsp;<span class="ident" id="4283578">w</span><span class="op" id="4283579">.</span><span class="ident" id="4283580">lastpart</span>&nbsp;<span class="op" id="4283589">!=</span>&nbsp;<span class="builtintype" id="4283592">nil</span>&nbsp;<span class="op" id="4283596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283600">if</span>&nbsp;<span class="ident" id="4283603">err</span>&nbsp;<span class="op" id="4283607">:=</span>&nbsp;<span class="ident" id="4283610">w</span><span class="op" id="4283611">.</span><span class="ident" id="4283612">lastpart</span><span class="op" id="4283620">.</span><span class="builtinfunc" id="4283621">close</span><span class="op" id="4283626">(</span><span class="op" id="4283627">)</span><span class="op" id="4283628">;</span>&nbsp;<span class="ident" id="4283630">err</span>&nbsp;<span class="op" id="4283634">!=</span>&nbsp;<span class="builtintype" id="4283637">nil</span>&nbsp;<span class="op" id="4283641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283646">return</span>&nbsp;<span class="builtintype" id="4283653">nil</span><span class="op" id="4283656">,</span>&nbsp;<span class="ident" id="4283658">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283667">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283670">var</span>&nbsp;<span class="ident" id="4283674">b</span>&nbsp;<span class="ident" id="4283676">bytes</span><span class="op" id="4283681">.</span><span class="ident" id="4283682">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283690">if</span>&nbsp;<span class="ident" id="4283693">w</span><span class="op" id="4283694">.</span><span class="ident" id="4283695">lastpart</span>&nbsp;<span class="op" id="4283704">!=</span>&nbsp;<span class="builtintype" id="4283707">nil</span>&nbsp;<span class="op" id="4283711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283715">fmt</span><span class="op" id="4283718">.</span><span class="ident" id="4283719">Fprintf</span><span class="op" id="4283726">(</span><span class="op" id="4283727">&amp;</span><span class="ident" id="4283728">b</span><span class="op" id="4283729">,</span>&nbsp;<span class="string" id="4283731">&#34;\r\n--%s\r\n&#34;</span><span class="op" id="4283745">,</span>&nbsp;<span class="ident" id="4283747">w</span><span class="op" id="4283748">.</span><span class="ident" id="4283749">boundary</span><span class="op" id="4283757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283760">}</span>&nbsp;<span class="keyword" id="4283762">else</span>&nbsp;<span class="op" id="4283767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283771">fmt</span><span class="op" id="4283774">.</span><span class="ident" id="4283775">Fprintf</span><span class="op" id="4283782">(</span><span class="op" id="4283783">&amp;</span><span class="ident" id="4283784">b</span><span class="op" id="4283785">,</span>&nbsp;<span class="string" id="4283787">&#34;--%s\r\n&#34;</span><span class="op" id="4283797">,</span>&nbsp;<span class="ident" id="4283799">w</span><span class="op" id="4283800">.</span><span class="ident" id="4283801">boundary</span><span class="op" id="4283809">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4283815">//&nbsp;TODO(bradfitz):&nbsp;move&nbsp;this&nbsp;to&nbsp;textproto.MimeHeader.Write(w),&nbsp;have&nbsp;it&nbsp;sort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4283892">//&nbsp;and&nbsp;clean,&nbsp;like&nbsp;http.Header.Write(w)&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283939">for</span>&nbsp;<span class="ident" id="4283943">k</span><span class="op" id="4283944">,</span>&nbsp;<span class="ident" id="4283946">vv</span>&nbsp;<span class="op" id="4283949">:=</span>&nbsp;<span class="keyword" id="4283952">range</span>&nbsp;<span class="ident" id="4283958">header</span>&nbsp;<span class="op" id="4283965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283969">for</span>&nbsp;<span class="ident" id="4283973">_</span><span class="op" id="4283974">,</span>&nbsp;<span class="ident" id="4283976">v</span>&nbsp;<span class="op" id="4283978">:=</span>&nbsp;<span class="keyword" id="4283981">range</span>&nbsp;<span class="ident" id="4283987">vv</span>&nbsp;<span class="op" id="4283990">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283995">fmt</span><span class="op" id="4283998">.</span><span class="ident" id="4283999">Fprintf</span><span class="op" id="4284006">(</span><span class="op" id="4284007">&amp;</span><span class="ident" id="4284008">b</span><span class="op" id="4284009">,</span>&nbsp;<span class="string" id="4284011">&#34;%s:&nbsp;%s\r\n&#34;</span><span class="op" id="4284023">,</span>&nbsp;<span class="ident" id="4284025">k</span><span class="op" id="4284026">,</span>&nbsp;<span class="ident" id="4284028">v</span><span class="op" id="4284029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284039">fmt</span><span class="op" id="4284042">.</span><span class="ident" id="4284043">Fprintf</span><span class="op" id="4284050">(</span><span class="op" id="4284051">&amp;</span><span class="ident" id="4284052">b</span><span class="op" id="4284053">,</span>&nbsp;<span class="string" id="4284055">&#34;\r\n&#34;</span><span class="op" id="4284061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284064">_</span><span class="op" id="4284065">,</span>&nbsp;<span class="ident" id="4284067">err</span>&nbsp;<span class="op" id="4284071">:=</span>&nbsp;<span class="ident" id="4284074">io</span><span class="op" id="4284076">.</span><span class="ident" id="4284077">Copy</span><span class="op" id="4284081">(</span><span class="ident" id="4284082">w</span><span class="op" id="4284083">.</span><span class="ident" id="4284084">w</span><span class="op" id="4284085">,</span>&nbsp;<span class="op" id="4284087">&amp;</span><span class="ident" id="4284088">b</span><span class="op" id="4284089">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284092">if</span>&nbsp;<span class="ident" id="4284095">err</span>&nbsp;<span class="op" id="4284099">!=</span>&nbsp;<span class="builtintype" id="4284102">nil</span>&nbsp;<span class="op" id="4284106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284110">return</span>&nbsp;<span class="builtintype" id="4284117">nil</span><span class="op" id="4284120">,</span>&nbsp;<span class="ident" id="4284122">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284130">p</span>&nbsp;<span class="op" id="4284132">:=</span>&nbsp;<span class="op" id="4284135">&amp;</span><span class="ident" id="4284136">part</span><span class="op" id="4284140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284144">mw</span><span class="op" id="4284146">:</span>&nbsp;<span class="ident" id="4284148">w</span><span class="op" id="4284149">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284155">w</span><span class="op" id="4284156">.</span><span class="ident" id="4284157">lastpart</span>&nbsp;<span class="op" id="4284166">=</span>&nbsp;<span class="ident" id="4284168">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284171">return</span>&nbsp;<span class="ident" id="4284178">p</span><span class="op" id="4284179">,</span>&nbsp;<span class="builtintype" id="4284181">nil</span><br>
<span class="lineno"></span><span class="op" id="4284185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4284188">var</span>&nbsp;<span class="ident" id="4284192">quoteEscaper</span>&nbsp;<span class="op" id="4284205">=</span>&nbsp;<span class="ident" id="4284207">strings</span><span class="op" id="4284214">.</span><span class="ident" id="4284215">NewReplacer</span><span class="op" id="4284226">(</span><span class="string" id="4284227">&#34;\\&#34;</span><span class="op" id="4284231">,</span>&nbsp;<span class="string" id="4284233">&#34;\\\\&#34;</span><span class="op" id="4284239">,</span>&nbsp;<span class="string" id="4284241">`&#34;`</span><span class="op" id="4284244">,</span>&nbsp;<span class="string" id="4284246">&#34;\\\&#34;&#34;</span><span class="op" id="4284252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4284255">func</span>&nbsp;<span class="ident" id="4284260">escapeQuotes</span><span class="op" id="4284272">(</span><span class="ident" id="4284273">s</span>&nbsp;<span class="builtintype" id="4284275">string</span><span class="op" id="4284281">)</span>&nbsp;<span class="builtintype" id="4284283">string</span>&nbsp;<span class="op" id="4284290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284293">return</span>&nbsp;<span class="ident" id="4284300">quoteEscaper</span><span class="op" id="4284312">.</span><span class="ident" id="4284313">Replace</span><span class="op" id="4284320">(</span><span class="ident" id="4284321">s</span><span class="op" id="4284322">)</span><br>
<span class="lineno"></span><span class="op" id="4284324">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4284327">//&nbsp;CreateFormFile&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;around&nbsp;CreatePart.&nbsp;It&nbsp;creates</span><br>
<span class="lineno"></span><span class="comment" id="4284400">//&nbsp;a&nbsp;new&nbsp;form-data&nbsp;header&nbsp;with&nbsp;the&nbsp;provided&nbsp;field&nbsp;name&nbsp;and&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4284470">func</span>&nbsp;<span class="op" id="4284475">(</span><span class="ident" id="4284476">w</span>&nbsp;<span class="op" id="4284478">*</span><span class="ident" id="4284479">Writer</span><span class="op" id="4284485">)</span>&nbsp;<span class="ident" id="4284487">CreateFormFile</span><span class="op" id="4284501">(</span><span class="ident" id="4284502">fieldname</span><span class="op" id="4284511">,</span>&nbsp;<span class="ident" id="4284513">filename</span>&nbsp;<span class="builtintype" id="4284522">string</span><span class="op" id="4284528">)</span>&nbsp;<span class="op" id="4284530">(</span><span class="ident" id="4284531">io</span><span class="op" id="4284533">.</span><span class="ident" id="4284534">Writer</span><span class="op" id="4284540">,</span>&nbsp;<span class="builtintype" id="4284542">error</span><span class="op" id="4284547">)</span>&nbsp;<span class="op" id="4284549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284552">h</span>&nbsp;<span class="op" id="4284554">:=</span>&nbsp;<span class="builtinfunc" id="4284557">make</span><span class="op" id="4284561">(</span><span class="ident" id="4284562">textproto</span><span class="op" id="4284571">.</span><span class="ident" id="4284572">MIMEHeader</span><span class="op" id="4284582">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284585">h</span><span class="op" id="4284586">.</span><span class="ident" id="4284587">Set</span><span class="op" id="4284590">(</span><span class="string" id="4284591">&#34;Content-Disposition&#34;</span><span class="op" id="4284612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284616">fmt</span><span class="op" id="4284619">.</span><span class="ident" id="4284620">Sprintf</span><span class="op" id="4284627">(</span><span class="string" id="4284628">`form-data;&nbsp;name=&#34;%s&#34;;&nbsp;filename=&#34;%s&#34;`</span><span class="op" id="4284665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284670">escapeQuotes</span><span class="op" id="4284682">(</span><span class="ident" id="4284683">fieldname</span><span class="op" id="4284692">)</span><span class="op" id="4284693">,</span>&nbsp;<span class="ident" id="4284695">escapeQuotes</span><span class="op" id="4284707">(</span><span class="ident" id="4284708">filename</span><span class="op" id="4284716">)</span><span class="op" id="4284717">)</span><span class="op" id="4284718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284721">h</span><span class="op" id="4284722">.</span><span class="ident" id="4284723">Set</span><span class="op" id="4284726">(</span><span class="string" id="4284727">&#34;Content-Type&#34;</span><span class="op" id="4284741">,</span>&nbsp;<span class="string" id="4284743">&#34;application/octet-stream&#34;</span><span class="op" id="4284769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284772">return</span>&nbsp;<span class="ident" id="4284779">w</span><span class="op" id="4284780">.</span><span class="ident" id="4284781">CreatePart</span><span class="op" id="4284791">(</span><span class="ident" id="4284792">h</span><span class="op" id="4284793">)</span><br>
<span class="lineno">130</span><span class="op" id="4284795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4284798">//&nbsp;CreateFormField&nbsp;calls&nbsp;CreatePart&nbsp;with&nbsp;a&nbsp;header&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4284858">//&nbsp;given&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4284879">func</span>&nbsp;<span class="op" id="4284884">(</span><span class="ident" id="4284885">w</span>&nbsp;<span class="op" id="4284887">*</span><span class="ident" id="4284888">Writer</span><span class="op" id="4284894">)</span>&nbsp;<span class="ident" id="4284896">CreateFormField</span><span class="op" id="4284911">(</span><span class="ident" id="4284912">fieldname</span>&nbsp;<span class="builtintype" id="4284922">string</span><span class="op" id="4284928">)</span>&nbsp;<span class="op" id="4284930">(</span><span class="ident" id="4284931">io</span><span class="op" id="4284933">.</span><span class="ident" id="4284934">Writer</span><span class="op" id="4284940">,</span>&nbsp;<span class="builtintype" id="4284942">error</span><span class="op" id="4284947">)</span>&nbsp;<span class="op" id="4284949">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284952">h</span>&nbsp;<span class="op" id="4284954">:=</span>&nbsp;<span class="builtinfunc" id="4284957">make</span><span class="op" id="4284961">(</span><span class="ident" id="4284962">textproto</span><span class="op" id="4284971">.</span><span class="ident" id="4284972">MIMEHeader</span><span class="op" id="4284982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284985">h</span><span class="op" id="4284986">.</span><span class="ident" id="4284987">Set</span><span class="op" id="4284990">(</span><span class="string" id="4284991">&#34;Content-Disposition&#34;</span><span class="op" id="4285012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285016">fmt</span><span class="op" id="4285019">.</span><span class="ident" id="4285020">Sprintf</span><span class="op" id="4285027">(</span><span class="string" id="4285028">`form-data;&nbsp;name=&#34;%s&#34;`</span><span class="op" id="4285050">,</span>&nbsp;<span class="ident" id="4285052">escapeQuotes</span><span class="op" id="4285064">(</span><span class="ident" id="4285065">fieldname</span><span class="op" id="4285074">)</span><span class="op" id="4285075">)</span><span class="op" id="4285076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285079">return</span>&nbsp;<span class="ident" id="4285086">w</span><span class="op" id="4285087">.</span><span class="ident" id="4285088">CreatePart</span><span class="op" id="4285098">(</span><span class="ident" id="4285099">h</span><span class="op" id="4285100">)</span><br>
<span class="lineno"></span><span class="op" id="4285102">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="4285105">//&nbsp;WriteField&nbsp;calls&nbsp;CreateFormField&nbsp;and&nbsp;then&nbsp;writes&nbsp;the&nbsp;given&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4285174">func</span>&nbsp;<span class="op" id="4285179">(</span><span class="ident" id="4285180">w</span>&nbsp;<span class="op" id="4285182">*</span><span class="ident" id="4285183">Writer</span><span class="op" id="4285189">)</span>&nbsp;<span class="ident" id="4285191">WriteField</span><span class="op" id="4285201">(</span><span class="ident" id="4285202">fieldname</span><span class="op" id="4285211">,</span>&nbsp;<span class="ident" id="4285213">value</span>&nbsp;<span class="builtintype" id="4285219">string</span><span class="op" id="4285225">)</span>&nbsp;<span class="builtintype" id="4285227">error</span>&nbsp;<span class="op" id="4285233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285236">p</span><span class="op" id="4285237">,</span>&nbsp;<span class="ident" id="4285239">err</span>&nbsp;<span class="op" id="4285243">:=</span>&nbsp;<span class="ident" id="4285246">w</span><span class="op" id="4285247">.</span><span class="ident" id="4285248">CreateFormField</span><span class="op" id="4285263">(</span><span class="ident" id="4285264">fieldname</span><span class="op" id="4285273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285276">if</span>&nbsp;<span class="ident" id="4285279">err</span>&nbsp;<span class="op" id="4285283">!=</span>&nbsp;<span class="builtintype" id="4285286">nil</span>&nbsp;<span class="op" id="4285290">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285294">return</span>&nbsp;<span class="ident" id="4285301">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4285306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285309">_</span><span class="op" id="4285310">,</span>&nbsp;<span class="ident" id="4285312">err</span>&nbsp;<span class="op" id="4285316">=</span>&nbsp;<span class="ident" id="4285318">p</span><span class="op" id="4285319">.</span><span class="ident" id="4285320">Write</span><span class="op" id="4285325">(</span><span class="op" id="4285326">[</span><span class="op" id="4285327">]</span><span class="builtintype" id="4285328">byte</span><span class="op" id="4285332">(</span><span class="ident" id="4285333">value</span><span class="op" id="4285338">)</span><span class="op" id="4285339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285342">return</span>&nbsp;<span class="ident" id="4285349">err</span><br>
<span class="lineno"></span><span class="op" id="4285353">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="4285356">//&nbsp;Close&nbsp;finishes&nbsp;the&nbsp;multipart&nbsp;message&nbsp;and&nbsp;writes&nbsp;the&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="4285420">//&nbsp;boundary&nbsp;end&nbsp;line&nbsp;to&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="4285456">func</span>&nbsp;<span class="op" id="4285461">(</span><span class="ident" id="4285462">w</span>&nbsp;<span class="op" id="4285464">*</span><span class="ident" id="4285465">Writer</span><span class="op" id="4285471">)</span>&nbsp;<span class="ident" id="4285473">Close</span><span class="op" id="4285478">(</span><span class="op" id="4285479">)</span>&nbsp;<span class="builtintype" id="4285481">error</span>&nbsp;<span class="op" id="4285487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285490">if</span>&nbsp;<span class="ident" id="4285493">w</span><span class="op" id="4285494">.</span><span class="ident" id="4285495">lastpart</span>&nbsp;<span class="op" id="4285504">!=</span>&nbsp;<span class="builtintype" id="4285507">nil</span>&nbsp;<span class="op" id="4285511">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285515">if</span>&nbsp;<span class="ident" id="4285518">err</span>&nbsp;<span class="op" id="4285522">:=</span>&nbsp;<span class="ident" id="4285525">w</span><span class="op" id="4285526">.</span><span class="ident" id="4285527">lastpart</span><span class="op" id="4285535">.</span><span class="builtinfunc" id="4285536">close</span><span class="op" id="4285541">(</span><span class="op" id="4285542">)</span><span class="op" id="4285543">;</span>&nbsp;<span class="ident" id="4285545">err</span>&nbsp;<span class="op" id="4285549">!=</span>&nbsp;<span class="builtintype" id="4285552">nil</span>&nbsp;<span class="op" id="4285556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285561">return</span>&nbsp;<span class="ident" id="4285568">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4285574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285578">w</span><span class="op" id="4285579">.</span><span class="ident" id="4285580">lastpart</span>&nbsp;<span class="op" id="4285589">=</span>&nbsp;<span class="builtintype" id="4285591">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4285596">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285599">_</span><span class="op" id="4285600">,</span>&nbsp;<span class="ident" id="4285602">err</span>&nbsp;<span class="op" id="4285606">:=</span>&nbsp;<span class="ident" id="4285609">fmt</span><span class="op" id="4285612">.</span><span class="ident" id="4285613">Fprintf</span><span class="op" id="4285620">(</span><span class="ident" id="4285621">w</span><span class="op" id="4285622">.</span><span class="ident" id="4285623">w</span><span class="op" id="4285624">,</span>&nbsp;<span class="string" id="4285626">&#34;\r\n--%s--\r\n&#34;</span><span class="op" id="4285642">,</span>&nbsp;<span class="ident" id="4285644">w</span><span class="op" id="4285645">.</span><span class="ident" id="4285646">boundary</span><span class="op" id="4285654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285657">return</span>&nbsp;<span class="ident" id="4285664">err</span><br>
<span class="lineno"></span><span class="op" id="4285668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4285671">type</span>&nbsp;<span class="ident" id="4285676">part</span>&nbsp;<span class="keyword" id="4285681">struct</span>&nbsp;<span class="op" id="4285688">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285691">mw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4285698">*</span><span class="ident" id="4285699">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285707">closed</span>&nbsp;<span class="builtintype" id="4285714">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285720">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4285727">error</span>&nbsp;<span class="comment" id="4285733">//&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;writing</span><br>
<span class="lineno"></span><span class="op" id="4285769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="4285772">func</span>&nbsp;<span class="op" id="4285777">(</span><span class="ident" id="4285778">p</span>&nbsp;<span class="op" id="4285780">*</span><span class="ident" id="4285781">part</span><span class="op" id="4285785">)</span>&nbsp;<span class="builtinfunc" id="4285787">close</span><span class="op" id="4285792">(</span><span class="op" id="4285793">)</span>&nbsp;<span class="builtintype" id="4285795">error</span>&nbsp;<span class="op" id="4285801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285804">p</span><span class="op" id="4285805">.</span><span class="ident" id="4285806">closed</span>&nbsp;<span class="op" id="4285813">=</span>&nbsp;<span class="builtintype" id="4285815">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285821">return</span>&nbsp;<span class="ident" id="4285828">p</span><span class="op" id="4285829">.</span><span class="ident" id="4285830">we</span><br>
<span class="lineno"></span><span class="op" id="4285833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="4285836">func</span>&nbsp;<span class="op" id="4285841">(</span><span class="ident" id="4285842">p</span>&nbsp;<span class="op" id="4285844">*</span><span class="ident" id="4285845">part</span><span class="op" id="4285849">)</span>&nbsp;<span class="ident" id="4285851">Write</span><span class="op" id="4285856">(</span><span class="ident" id="4285857">d</span>&nbsp;<span class="op" id="4285859">[</span><span class="op" id="4285860">]</span><span class="builtintype" id="4285861">byte</span><span class="op" id="4285865">)</span>&nbsp;<span class="op" id="4285867">(</span><span class="ident" id="4285868">n</span>&nbsp;<span class="builtintype" id="4285870">int</span><span class="op" id="4285873">,</span>&nbsp;<span class="ident" id="4285875">err</span>&nbsp;<span class="builtintype" id="4285879">error</span><span class="op" id="4285884">)</span>&nbsp;<span class="op" id="4285886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285889">if</span>&nbsp;<span class="ident" id="4285892">p</span><span class="op" id="4285893">.</span><span class="ident" id="4285894">closed</span>&nbsp;<span class="op" id="4285901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285905">return</span>&nbsp;<span class="num" id="4285912">0</span><span class="op" id="4285913">,</span>&nbsp;<span class="ident" id="4285915">errors</span><span class="op" id="4285921">.</span><span class="ident" id="4285922">New</span><span class="op" id="4285925">(</span><span class="string" id="4285926">&#34;multipart:&nbsp;can&#39;t&nbsp;write&nbsp;to&nbsp;finished&nbsp;part&#34;</span><span class="op" id="4285967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4285970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285973">n</span><span class="op" id="4285974">,</span>&nbsp;<span class="ident" id="4285976">err</span>&nbsp;<span class="op" id="4285980">=</span>&nbsp;<span class="ident" id="4285982">p</span><span class="op" id="4285983">.</span><span class="ident" id="4285984">mw</span><span class="op" id="4285986">.</span><span class="ident" id="4285987">w</span><span class="op" id="4285988">.</span><span class="ident" id="4285989">Write</span><span class="op" id="4285994">(</span><span class="ident" id="4285995">d</span><span class="op" id="4285996">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285999">if</span>&nbsp;<span class="ident" id="4286002">err</span>&nbsp;<span class="op" id="4286006">!=</span>&nbsp;<span class="builtintype" id="4286009">nil</span>&nbsp;<span class="op" id="4286013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4286017">p</span><span class="op" id="4286018">.</span><span class="ident" id="4286019">we</span>&nbsp;<span class="op" id="4286022">=</span>&nbsp;<span class="ident" id="4286024">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4286029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4286032">return</span><br>
<span class="lineno"></span><span class="op" id="4286039">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
