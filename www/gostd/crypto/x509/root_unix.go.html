<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4315271">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4315326">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4315380">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4315431">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4315494">package</span>&nbsp;<span class="ident" id="4315502">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4315508">import</span>&nbsp;<span class="string" id="4315515">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4315528">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4315583">var</span>&nbsp;<span class="ident" id="4315587">certFiles</span>&nbsp;<span class="op" id="4315597">=</span>&nbsp;<span class="op" id="4315599">[</span><span class="op" id="4315600">]</span><span class="builtintype" id="4315601">string</span><span class="op" id="4315607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4315610">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="4315646">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4315652">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4315682">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="4315716">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4315724">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4315740">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="4315764">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4315782">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4315795">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="4315814">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4315837">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4315849">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="4315889">,</span>&nbsp;<span class="comment" id="4315891">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4315913">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="4315938">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4315955">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4315968">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="4316000">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4316010">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="4316027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4316030">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="4316102">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="4316149">var</span>&nbsp;<span class="ident" id="4316153">certDirectories</span>&nbsp;<span class="op" id="4316169">=</span>&nbsp;<span class="op" id="4316171">[</span><span class="op" id="4316172">]</span><span class="builtintype" id="4316173">string</span><span class="op" id="4316179">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4316182">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="4316212">,</span>&nbsp;<span class="comment" id="4316214">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="4316226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4316229">func</span>&nbsp;<span class="op" id="4316234">(</span><span class="ident" id="4316235">c</span>&nbsp;<span class="op" id="4316237">*</span><span class="ident" id="4316238">Certificate</span><span class="op" id="4316249">)</span>&nbsp;<span class="ident" id="4316251">systemVerify</span><span class="op" id="4316263">(</span><span class="ident" id="4316264">opts</span>&nbsp;<span class="op" id="4316269">*</span><span class="ident" id="4316270">VerifyOptions</span><span class="op" id="4316283">)</span>&nbsp;<span class="op" id="4316285">(</span><span class="ident" id="4316286">chains</span>&nbsp;<span class="op" id="4316293">[</span><span class="op" id="4316294">]</span><span class="op" id="4316295">[</span><span class="op" id="4316296">]</span><span class="op" id="4316297">*</span><span class="ident" id="4316298">Certificate</span><span class="op" id="4316309">,</span>&nbsp;<span class="ident" id="4316311">err</span>&nbsp;<span class="builtintype" id="4316315">error</span><span class="op" id="4316320">)</span>&nbsp;<span class="op" id="4316322">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316325">return</span>&nbsp;<span class="ident" id="4316332">nil</span><span class="op" id="4316335">,</span>&nbsp;<span class="ident" id="4316337">nil</span><br>
<span class="lineno"></span><span class="op" id="4316341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4316344">func</span>&nbsp;<span class="ident" id="4316349">initSystemRoots</span><span class="op" id="4316364">(</span><span class="op" id="4316365">)</span>&nbsp;<span class="op" id="4316367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316370">roots</span>&nbsp;<span class="op" id="4316376">:=</span>&nbsp;<span class="ident" id="4316379">NewCertPool</span><span class="op" id="4316390">(</span><span class="op" id="4316391">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316394">for</span>&nbsp;<span class="ident" id="4316398">_</span><span class="op" id="4316399">,</span>&nbsp;<span class="ident" id="4316401">file</span>&nbsp;<span class="op" id="4316406">:=</span>&nbsp;<span class="keyword" id="4316409">range</span>&nbsp;<span class="ident" id="4316415">certFiles</span>&nbsp;<span class="op" id="4316425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316429">data</span><span class="op" id="4316433">,</span>&nbsp;<span class="ident" id="4316435">err</span>&nbsp;<span class="op" id="4316439">:=</span>&nbsp;<span class="ident" id="4316442">ioutil</span><span class="op" id="4316448">.</span><span class="ident" id="4316449">ReadFile</span><span class="op" id="4316457">(</span><span class="ident" id="4316458">file</span><span class="op" id="4316462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316466">if</span>&nbsp;<span class="ident" id="4316469">err</span>&nbsp;<span class="op" id="4316473">==</span>&nbsp;<span class="ident" id="4316476">nil</span>&nbsp;<span class="op" id="4316480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316485">roots</span><span class="op" id="4316490">.</span><span class="ident" id="4316491">AppendCertsFromPEM</span><span class="op" id="4316509">(</span><span class="ident" id="4316510">data</span><span class="op" id="4316514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316519">systemRoots</span>&nbsp;<span class="op" id="4316531">=</span>&nbsp;<span class="ident" id="4316533">roots</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316542">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316558">for</span>&nbsp;<span class="ident" id="4316562">_</span><span class="op" id="4316563">,</span>&nbsp;<span class="ident" id="4316565">directory</span>&nbsp;<span class="op" id="4316575">:=</span>&nbsp;<span class="keyword" id="4316578">range</span>&nbsp;<span class="ident" id="4316584">certDirectories</span>&nbsp;<span class="op" id="4316600">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316604">fis</span><span class="op" id="4316607">,</span>&nbsp;<span class="ident" id="4316609">err</span>&nbsp;<span class="op" id="4316613">:=</span>&nbsp;<span class="ident" id="4316616">ioutil</span><span class="op" id="4316622">.</span><span class="ident" id="4316623">ReadDir</span><span class="op" id="4316630">(</span><span class="ident" id="4316631">directory</span><span class="op" id="4316640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316644">if</span>&nbsp;<span class="ident" id="4316647">err</span>&nbsp;<span class="op" id="4316651">!=</span>&nbsp;<span class="ident" id="4316654">nil</span>&nbsp;<span class="op" id="4316658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316663">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316678">rootsAdded</span>&nbsp;<span class="op" id="4316689">:=</span>&nbsp;<span class="builtintype" id="4316692">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316700">for</span>&nbsp;<span class="ident" id="4316704">_</span><span class="op" id="4316705">,</span>&nbsp;<span class="ident" id="4316707">fi</span>&nbsp;<span class="op" id="4316710">:=</span>&nbsp;<span class="keyword" id="4316713">range</span>&nbsp;<span class="ident" id="4316719">fis</span>&nbsp;<span class="op" id="4316723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316728">data</span><span class="op" id="4316732">,</span>&nbsp;<span class="ident" id="4316734">err</span>&nbsp;<span class="op" id="4316738">:=</span>&nbsp;<span class="ident" id="4316741">ioutil</span><span class="op" id="4316747">.</span><span class="ident" id="4316748">ReadFile</span><span class="op" id="4316756">(</span><span class="ident" id="4316757">directory</span>&nbsp;<span class="op" id="4316767">+</span>&nbsp;<span class="string" id="4316769">&#34;/&#34;</span>&nbsp;<span class="op" id="4316773">+</span>&nbsp;<span class="ident" id="4316775">fi</span><span class="op" id="4316777">.</span><span class="ident" id="4316778">Name</span><span class="op" id="4316782">(</span><span class="op" id="4316783">)</span><span class="op" id="4316784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316789">if</span>&nbsp;<span class="ident" id="4316792">err</span>&nbsp;<span class="op" id="4316796">==</span>&nbsp;<span class="ident" id="4316799">nil</span>&nbsp;<span class="op" id="4316803">&amp;&amp;</span>&nbsp;<span class="ident" id="4316806">roots</span><span class="op" id="4316811">.</span><span class="ident" id="4316812">AppendCertsFromPEM</span><span class="op" id="4316830">(</span><span class="ident" id="4316831">data</span><span class="op" id="4316835">)</span>&nbsp;<span class="op" id="4316837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316843">rootsAdded</span>&nbsp;<span class="op" id="4316854">=</span>&nbsp;<span class="builtintype" id="4316856">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316864">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316872">if</span>&nbsp;<span class="ident" id="4316875">rootsAdded</span>&nbsp;<span class="op" id="4316886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316891">systemRoots</span>&nbsp;<span class="op" id="4316903">=</span>&nbsp;<span class="ident" id="4316905">roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316914">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316923">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4316930">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4317002">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="4317052">}</span>
</div>
</body>
</html>
