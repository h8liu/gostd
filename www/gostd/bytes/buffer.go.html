<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html" class="current">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1379606">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1379661">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1379715">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1379766">package</span>&nbsp;<span class="ident" id="1379774">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1379781">//&nbsp;Simple&nbsp;byte&nbsp;buffer&nbsp;for&nbsp;marshaling&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1379825">import</span>&nbsp;<span class="op" id="1379832">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1379835">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1379845">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1379851">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="1379866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1379869">//&nbsp;A&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;variable-sized&nbsp;buffer&nbsp;of&nbsp;bytes&nbsp;with&nbsp;Read&nbsp;and&nbsp;Write&nbsp;methods.</span><br>
<span class="lineno"></span><span class="comment" id="1379946">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Buffer&nbsp;is&nbsp;an&nbsp;empty&nbsp;buffer&nbsp;ready&nbsp;to&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="1380008">type</span>&nbsp;<span class="ident" id="1380013">Buffer</span>&nbsp;<span class="keyword" id="1380020">struct</span>&nbsp;<span class="op" id="1380027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380030">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1380040">[</span><span class="op" id="1380041">]</span><span class="builtintype" id="1380042">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1380058">//&nbsp;contents&nbsp;are&nbsp;the&nbsp;bytes&nbsp;buf[off&nbsp;:&nbsp;len(buf)]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380105">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1380115">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1380133">//&nbsp;read&nbsp;at&nbsp;&amp;buf[off],&nbsp;write&nbsp;at&nbsp;&amp;buf[len(buf)]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380180">runeBytes</span>&nbsp;<span class="op" id="1380190">[</span><span class="ident" id="1380191">utf8</span><span class="op" id="1380195">.</span><span class="ident" id="1380196">UTFMax</span><span class="op" id="1380202">]</span><span class="builtintype" id="1380203">byte</span>&nbsp;<span class="comment" id="1380208">//&nbsp;avoid&nbsp;allocation&nbsp;of&nbsp;slice&nbsp;on&nbsp;each&nbsp;WriteByte&nbsp;or&nbsp;Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380264">bootstrap</span>&nbsp;<span class="op" id="1380274">[</span><span class="num" id="1380275">64</span><span class="op" id="1380277">]</span><span class="builtintype" id="1380278">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1380292">//&nbsp;memory&nbsp;to&nbsp;hold&nbsp;first&nbsp;slice;&nbsp;helps&nbsp;small&nbsp;buffers&nbsp;(Printf)&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380371">lastRead</span>&nbsp;&nbsp;<span class="ident" id="1380381">readOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1380399">//&nbsp;last&nbsp;read&nbsp;operation,&nbsp;so&nbsp;that&nbsp;Unread*&nbsp;can&nbsp;work&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="op" id="1380459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1380462">//&nbsp;The&nbsp;readOp&nbsp;constants&nbsp;describe&nbsp;the&nbsp;last&nbsp;action&nbsp;performed&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1380524">//&nbsp;the&nbsp;buffer,&nbsp;so&nbsp;that&nbsp;UnreadRune&nbsp;and&nbsp;UnreadByte&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="1380577">//&nbsp;check&nbsp;for&nbsp;invalid&nbsp;usage.</span><br>
<span class="lineno"></span><span class="keyword" id="1380605">type</span>&nbsp;<span class="ident" id="1380610">readOp</span>&nbsp;<span class="builtintype" id="1380617">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="1380622">const</span>&nbsp;<span class="op" id="1380628">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380631">opInvalid</span>&nbsp;&nbsp;<span class="ident" id="1380642">readOp</span>&nbsp;<span class="op" id="1380649">=</span>&nbsp;<span class="ident" id="1380651">iota</span>&nbsp;<span class="comment" id="1380656">//&nbsp;Non-read&nbsp;operation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380680">opReadRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1380705">//&nbsp;Read&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380720">opRead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1380745">//&nbsp;Any&nbsp;other&nbsp;read&nbsp;operation.</span><br>
<span class="lineno"></span><span class="op" id="1380774">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1380777">//&nbsp;ErrTooLarge&nbsp;is&nbsp;passed&nbsp;to&nbsp;panic&nbsp;if&nbsp;memory&nbsp;cannot&nbsp;be&nbsp;allocated&nbsp;to&nbsp;store&nbsp;data&nbsp;in&nbsp;a&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1380868">var</span>&nbsp;<span class="ident" id="1380872">ErrTooLarge</span>&nbsp;<span class="op" id="1380884">=</span>&nbsp;<span class="ident" id="1380886">errors</span><span class="op" id="1380892">.</span><span class="ident" id="1380893">New</span><span class="op" id="1380896">(</span><span class="string" id="1380897">&#34;bytes.Buffer:&nbsp;too&nbsp;large&#34;</span><span class="op" id="1380922">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1380925">//&nbsp;Bytes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno">40</span><span class="comment" id="1381003">//&nbsp;len(b.Bytes())&nbsp;==&nbsp;b.Len().&nbsp;&nbsp;If&nbsp;the&nbsp;caller&nbsp;changes&nbsp;the&nbsp;contents&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1381076">//&nbsp;returned&nbsp;slice,&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;buffer&nbsp;will&nbsp;change&nbsp;provided&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="1381149">//&nbsp;are&nbsp;no&nbsp;intervening&nbsp;method&nbsp;calls&nbsp;on&nbsp;the&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1381199">func</span>&nbsp;<span class="op" id="1381204">(</span><span class="ident" id="1381205">b</span>&nbsp;<span class="op" id="1381207">*</span><span class="ident" id="1381208">Buffer</span><span class="op" id="1381214">)</span>&nbsp;<span class="ident" id="1381216">Bytes</span><span class="op" id="1381221">(</span><span class="op" id="1381222">)</span>&nbsp;<span class="op" id="1381224">[</span><span class="op" id="1381225">]</span><span class="builtintype" id="1381226">byte</span>&nbsp;<span class="op" id="1381231">{</span>&nbsp;<span class="keyword" id="1381233">return</span>&nbsp;<span class="ident" id="1381240">b</span><span class="op" id="1381241">.</span><span class="ident" id="1381242">buf</span><span class="op" id="1381245">[</span><span class="ident" id="1381246">b</span><span class="op" id="1381247">.</span><span class="ident" id="1381248">off</span><span class="op" id="1381251">:</span><span class="op" id="1381252">]</span>&nbsp;<span class="op" id="1381254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="1381257">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1381324">//&nbsp;as&nbsp;a&nbsp;string.&nbsp;&nbsp;If&nbsp;the&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;it&nbsp;returns&nbsp;&#34;&lt;nil&gt;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="1381393">func</span>&nbsp;<span class="op" id="1381398">(</span><span class="ident" id="1381399">b</span>&nbsp;<span class="op" id="1381401">*</span><span class="ident" id="1381402">Buffer</span><span class="op" id="1381408">)</span>&nbsp;<span class="ident" id="1381410">String</span><span class="op" id="1381416">(</span><span class="op" id="1381417">)</span>&nbsp;<span class="builtintype" id="1381419">string</span>&nbsp;<span class="op" id="1381426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381429">if</span>&nbsp;<span class="ident" id="1381432">b</span>&nbsp;<span class="op" id="1381434">==</span>&nbsp;<span class="ident" id="1381437">nil</span>&nbsp;<span class="op" id="1381441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1381445">//&nbsp;Special&nbsp;case,&nbsp;useful&nbsp;in&nbsp;debugging.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381485">return</span>&nbsp;<span class="string" id="1381492">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1381501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381504">return</span>&nbsp;<span class="builtintype" id="1381511">string</span><span class="op" id="1381517">(</span><span class="ident" id="1381518">b</span><span class="op" id="1381519">.</span><span class="ident" id="1381520">buf</span><span class="op" id="1381523">[</span><span class="ident" id="1381524">b</span><span class="op" id="1381525">.</span><span class="ident" id="1381526">off</span><span class="op" id="1381529">:</span><span class="op" id="1381530">]</span><span class="op" id="1381531">)</span><br>
<span class="lineno"></span><span class="op" id="1381533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1381536">//&nbsp;Len&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno"></span><span class="comment" id="1381608">//&nbsp;b.Len()&nbsp;==&nbsp;len(b.Bytes()).</span><br>
<span class="lineno"></span><span class="keyword" id="1381638">func</span>&nbsp;<span class="op" id="1381643">(</span><span class="ident" id="1381644">b</span>&nbsp;<span class="op" id="1381646">*</span><span class="ident" id="1381647">Buffer</span><span class="op" id="1381653">)</span>&nbsp;<span class="ident" id="1381655">Len</span><span class="op" id="1381658">(</span><span class="op" id="1381659">)</span>&nbsp;<span class="builtintype" id="1381661">int</span>&nbsp;<span class="op" id="1381665">{</span>&nbsp;<span class="keyword" id="1381667">return</span>&nbsp;<span class="builtinfunc" id="1381674">len</span><span class="op" id="1381677">(</span><span class="ident" id="1381678">b</span><span class="op" id="1381679">.</span><span class="ident" id="1381680">buf</span><span class="op" id="1381683">)</span>&nbsp;<span class="op" id="1381685">-</span>&nbsp;<span class="ident" id="1381687">b</span><span class="op" id="1381688">.</span><span class="ident" id="1381689">off</span>&nbsp;<span class="op" id="1381693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1381696">//&nbsp;Truncate&nbsp;discards&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;n&nbsp;unread&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">60</span><span class="comment" id="1381767">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;n&nbsp;is&nbsp;negative&nbsp;or&nbsp;greater&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1381839">func</span>&nbsp;<span class="op" id="1381844">(</span><span class="ident" id="1381845">b</span>&nbsp;<span class="op" id="1381847">*</span><span class="ident" id="1381848">Buffer</span><span class="op" id="1381854">)</span>&nbsp;<span class="ident" id="1381856">Truncate</span><span class="op" id="1381864">(</span><span class="ident" id="1381865">n</span>&nbsp;<span class="builtintype" id="1381867">int</span><span class="op" id="1381870">)</span>&nbsp;<span class="op" id="1381872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381875">b</span><span class="op" id="1381876">.</span><span class="ident" id="1381877">lastRead</span>&nbsp;<span class="op" id="1381886">=</span>&nbsp;<span class="ident" id="1381888">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381899">switch</span>&nbsp;<span class="op" id="1381906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381909">case</span>&nbsp;<span class="ident" id="1381914">n</span>&nbsp;<span class="op" id="1381916">&lt;</span>&nbsp;<span class="num" id="1381918">0</span>&nbsp;<span class="op" id="1381920">||</span>&nbsp;<span class="ident" id="1381923">n</span>&nbsp;<span class="op" id="1381925">&gt;</span>&nbsp;<span class="ident" id="1381927">b</span><span class="op" id="1381928">.</span><span class="ident" id="1381929">Len</span><span class="op" id="1381932">(</span><span class="op" id="1381933">)</span><span class="op" id="1381934">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1381938">panic</span><span class="op" id="1381943">(</span><span class="string" id="1381944">&#34;bytes.Buffer:&nbsp;truncation&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1381983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381986">case</span>&nbsp;<span class="ident" id="1381991">n</span>&nbsp;<span class="op" id="1381993">==</span>&nbsp;<span class="num" id="1381996">0</span><span class="op" id="1381997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382001">//&nbsp;Reuse&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382026">b</span><span class="op" id="1382027">.</span><span class="ident" id="1382028">off</span>&nbsp;<span class="op" id="1382032">=</span>&nbsp;<span class="num" id="1382034">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382037">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382040">b</span><span class="op" id="1382041">.</span><span class="ident" id="1382042">buf</span>&nbsp;<span class="op" id="1382046">=</span>&nbsp;<span class="ident" id="1382048">b</span><span class="op" id="1382049">.</span><span class="ident" id="1382050">buf</span><span class="op" id="1382053">[</span><span class="num" id="1382054">0</span>&nbsp;<span class="op" id="1382056">:</span>&nbsp;<span class="ident" id="1382058">b</span><span class="op" id="1382059">.</span><span class="ident" id="1382060">off</span><span class="op" id="1382063">+</span><span class="ident" id="1382064">n</span><span class="op" id="1382065">]</span><br>
<span class="lineno"></span><span class="op" id="1382067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1382070">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;buffer&nbsp;so&nbsp;it&nbsp;has&nbsp;no&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="1382119">//&nbsp;b.Reset()&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;b.Truncate(0).</span><br>
<span class="lineno">75</span><span class="keyword" id="1382162">func</span>&nbsp;<span class="op" id="1382167">(</span><span class="ident" id="1382168">b</span>&nbsp;<span class="op" id="1382170">*</span><span class="ident" id="1382171">Buffer</span><span class="op" id="1382177">)</span>&nbsp;<span class="ident" id="1382179">Reset</span><span class="op" id="1382184">(</span><span class="op" id="1382185">)</span>&nbsp;<span class="op" id="1382187">{</span>&nbsp;<span class="ident" id="1382189">b</span><span class="op" id="1382190">.</span><span class="ident" id="1382191">Truncate</span><span class="op" id="1382199">(</span><span class="num" id="1382200">0</span><span class="op" id="1382201">)</span>&nbsp;<span class="op" id="1382203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1382206">//&nbsp;grow&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for&nbsp;n&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1382268">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;bytes&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="1382323">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">80</span><span class="keyword" id="1382383">func</span>&nbsp;<span class="op" id="1382388">(</span><span class="ident" id="1382389">b</span>&nbsp;<span class="op" id="1382391">*</span><span class="ident" id="1382392">Buffer</span><span class="op" id="1382398">)</span>&nbsp;<span class="ident" id="1382400">grow</span><span class="op" id="1382404">(</span><span class="ident" id="1382405">n</span>&nbsp;<span class="builtintype" id="1382407">int</span><span class="op" id="1382410">)</span>&nbsp;<span class="builtintype" id="1382412">int</span>&nbsp;<span class="op" id="1382416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382419">m</span>&nbsp;<span class="op" id="1382421">:=</span>&nbsp;<span class="ident" id="1382424">b</span><span class="op" id="1382425">.</span><span class="ident" id="1382426">Len</span><span class="op" id="1382429">(</span><span class="op" id="1382430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382433">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382481">if</span>&nbsp;<span class="ident" id="1382484">m</span>&nbsp;<span class="op" id="1382486">==</span>&nbsp;<span class="num" id="1382489">0</span>&nbsp;<span class="op" id="1382491">&amp;&amp;</span>&nbsp;<span class="ident" id="1382494">b</span><span class="op" id="1382495">.</span><span class="ident" id="1382496">off</span>&nbsp;<span class="op" id="1382500">!=</span>&nbsp;<span class="num" id="1382503">0</span>&nbsp;<span class="op" id="1382505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382509">b</span><span class="op" id="1382510">.</span><span class="ident" id="1382511">Truncate</span><span class="op" id="1382519">(</span><span class="num" id="1382520">0</span><span class="op" id="1382521">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382527">if</span>&nbsp;<span class="builtinfunc" id="1382530">len</span><span class="op" id="1382533">(</span><span class="ident" id="1382534">b</span><span class="op" id="1382535">.</span><span class="ident" id="1382536">buf</span><span class="op" id="1382539">)</span><span class="op" id="1382540">+</span><span class="ident" id="1382541">n</span>&nbsp;<span class="op" id="1382543">&gt;</span>&nbsp;<span class="builtinfunc" id="1382545">cap</span><span class="op" id="1382548">(</span><span class="ident" id="1382549">b</span><span class="op" id="1382550">.</span><span class="ident" id="1382551">buf</span><span class="op" id="1382554">)</span>&nbsp;<span class="op" id="1382556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382560">var</span>&nbsp;<span class="ident" id="1382564">buf</span>&nbsp;<span class="op" id="1382568">[</span><span class="op" id="1382569">]</span><span class="builtintype" id="1382570">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382577">if</span>&nbsp;<span class="ident" id="1382580">b</span><span class="op" id="1382581">.</span><span class="ident" id="1382582">buf</span>&nbsp;<span class="op" id="1382586">==</span>&nbsp;<span class="ident" id="1382589">nil</span>&nbsp;<span class="op" id="1382593">&amp;&amp;</span>&nbsp;<span class="ident" id="1382596">n</span>&nbsp;<span class="op" id="1382598">&lt;=</span>&nbsp;<span class="builtinfunc" id="1382601">len</span><span class="op" id="1382604">(</span><span class="ident" id="1382605">b</span><span class="op" id="1382606">.</span><span class="ident" id="1382607">bootstrap</span><span class="op" id="1382616">)</span>&nbsp;<span class="op" id="1382618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382623">buf</span>&nbsp;<span class="op" id="1382627">=</span>&nbsp;<span class="ident" id="1382629">b</span><span class="op" id="1382630">.</span><span class="ident" id="1382631">bootstrap</span><span class="op" id="1382640">[</span><span class="num" id="1382641">0</span><span class="op" id="1382642">:</span><span class="op" id="1382643">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382647">}</span>&nbsp;<span class="keyword" id="1382649">else</span>&nbsp;<span class="keyword" id="1382654">if</span>&nbsp;<span class="ident" id="1382657">m</span><span class="op" id="1382658">+</span><span class="ident" id="1382659">n</span>&nbsp;<span class="op" id="1382661">&lt;=</span>&nbsp;<span class="builtinfunc" id="1382664">cap</span><span class="op" id="1382667">(</span><span class="ident" id="1382668">b</span><span class="op" id="1382669">.</span><span class="ident" id="1382670">buf</span><span class="op" id="1382673">)</span><span class="op" id="1382674">/</span><span class="num" id="1382675">2</span>&nbsp;<span class="op" id="1382677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382682">//&nbsp;We&nbsp;can&nbsp;slide&nbsp;things&nbsp;down&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382741">//&nbsp;slice.&nbsp;We&nbsp;only&nbsp;need&nbsp;m+n&nbsp;&lt;=&nbsp;cap(b.buf)&nbsp;to&nbsp;slide,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382799">//&nbsp;we&nbsp;instead&nbsp;let&nbsp;capacity&nbsp;get&nbsp;twice&nbsp;as&nbsp;large&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382854">//&nbsp;don&#39;t&nbsp;spend&nbsp;all&nbsp;our&nbsp;time&nbsp;copying.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1382894">copy</span><span class="op" id="1382898">(</span><span class="ident" id="1382899">b</span><span class="op" id="1382900">.</span><span class="ident" id="1382901">buf</span><span class="op" id="1382904">[</span><span class="op" id="1382905">:</span><span class="op" id="1382906">]</span><span class="op" id="1382907">,</span>&nbsp;<span class="ident" id="1382909">b</span><span class="op" id="1382910">.</span><span class="ident" id="1382911">buf</span><span class="op" id="1382914">[</span><span class="ident" id="1382915">b</span><span class="op" id="1382916">.</span><span class="ident" id="1382917">off</span><span class="op" id="1382920">:</span><span class="op" id="1382921">]</span><span class="op" id="1382922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382927">buf</span>&nbsp;<span class="op" id="1382931">=</span>&nbsp;<span class="ident" id="1382933">b</span><span class="op" id="1382934">.</span><span class="ident" id="1382935">buf</span><span class="op" id="1382938">[</span><span class="op" id="1382939">:</span><span class="ident" id="1382940">m</span><span class="op" id="1382941">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382945">}</span>&nbsp;<span class="keyword" id="1382947">else</span>&nbsp;<span class="op" id="1382952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382957">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;anywhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382989">buf</span>&nbsp;<span class="op" id="1382993">=</span>&nbsp;<span class="ident" id="1382995">makeSlice</span><span class="op" id="1383004">(</span><span class="num" id="1383005">2</span><span class="op" id="1383006">*</span><span class="builtinfunc" id="1383007">cap</span><span class="op" id="1383010">(</span><span class="ident" id="1383011">b</span><span class="op" id="1383012">.</span><span class="ident" id="1383013">buf</span><span class="op" id="1383016">)</span>&nbsp;<span class="op" id="1383018">+</span>&nbsp;<span class="ident" id="1383020">n</span><span class="op" id="1383021">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1383026">copy</span><span class="op" id="1383030">(</span><span class="ident" id="1383031">buf</span><span class="op" id="1383034">,</span>&nbsp;<span class="ident" id="1383036">b</span><span class="op" id="1383037">.</span><span class="ident" id="1383038">buf</span><span class="op" id="1383041">[</span><span class="ident" id="1383042">b</span><span class="op" id="1383043">.</span><span class="ident" id="1383044">off</span><span class="op" id="1383047">:</span><span class="op" id="1383048">]</span><span class="op" id="1383049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383057">b</span><span class="op" id="1383058">.</span><span class="ident" id="1383059">buf</span>&nbsp;<span class="op" id="1383063">=</span>&nbsp;<span class="ident" id="1383065">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383071">b</span><span class="op" id="1383072">.</span><span class="ident" id="1383073">off</span>&nbsp;<span class="op" id="1383077">=</span>&nbsp;<span class="num" id="1383079">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383082">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383085">b</span><span class="op" id="1383086">.</span><span class="ident" id="1383087">buf</span>&nbsp;<span class="op" id="1383091">=</span>&nbsp;<span class="ident" id="1383093">b</span><span class="op" id="1383094">.</span><span class="ident" id="1383095">buf</span><span class="op" id="1383098">[</span><span class="num" id="1383099">0</span>&nbsp;<span class="op" id="1383101">:</span>&nbsp;<span class="ident" id="1383103">b</span><span class="op" id="1383104">.</span><span class="ident" id="1383105">off</span><span class="op" id="1383108">+</span><span class="ident" id="1383109">m</span><span class="op" id="1383110">+</span><span class="ident" id="1383111">n</span><span class="op" id="1383112">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383115">return</span>&nbsp;<span class="ident" id="1383122">b</span><span class="op" id="1383123">.</span><span class="ident" id="1383124">off</span>&nbsp;<span class="op" id="1383128">+</span>&nbsp;<span class="ident" id="1383130">m</span><br>
<span class="lineno"></span><span class="op" id="1383132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1383135">//&nbsp;Grow&nbsp;grows&nbsp;the&nbsp;buffer&#39;s&nbsp;capacity,&nbsp;if&nbsp;necessary,&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for</span><br>
<span class="lineno">110</span><span class="comment" id="1383209">//&nbsp;another&nbsp;n&nbsp;bytes.&nbsp;After&nbsp;Grow(n),&nbsp;at&nbsp;least&nbsp;n&nbsp;bytes&nbsp;can&nbsp;be&nbsp;written&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1383283">//&nbsp;buffer&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="1383321">//&nbsp;If&nbsp;n&nbsp;is&nbsp;negative,&nbsp;Grow&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="comment" id="1383359">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1383419">func</span>&nbsp;<span class="op" id="1383424">(</span><span class="ident" id="1383425">b</span>&nbsp;<span class="op" id="1383427">*</span><span class="ident" id="1383428">Buffer</span><span class="op" id="1383434">)</span>&nbsp;<span class="ident" id="1383436">Grow</span><span class="op" id="1383440">(</span><span class="ident" id="1383441">n</span>&nbsp;<span class="builtintype" id="1383443">int</span><span class="op" id="1383446">)</span>&nbsp;<span class="op" id="1383448">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383451">if</span>&nbsp;<span class="ident" id="1383454">n</span>&nbsp;<span class="op" id="1383456">&lt;</span>&nbsp;<span class="num" id="1383458">0</span>&nbsp;<span class="op" id="1383460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1383464">panic</span><span class="op" id="1383469">(</span><span class="string" id="1383470">&#34;bytes.Buffer.Grow:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="1383505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383511">m</span>&nbsp;<span class="op" id="1383513">:=</span>&nbsp;<span class="ident" id="1383516">b</span><span class="op" id="1383517">.</span><span class="ident" id="1383518">grow</span><span class="op" id="1383522">(</span><span class="ident" id="1383523">n</span><span class="op" id="1383524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383527">b</span><span class="op" id="1383528">.</span><span class="ident" id="1383529">buf</span>&nbsp;<span class="op" id="1383533">=</span>&nbsp;<span class="ident" id="1383535">b</span><span class="op" id="1383536">.</span><span class="ident" id="1383537">buf</span><span class="op" id="1383540">[</span><span class="num" id="1383541">0</span><span class="op" id="1383542">:</span><span class="ident" id="1383543">m</span><span class="op" id="1383544">]</span><br>
<span class="lineno">120</span><span class="op" id="1383546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1383549">//&nbsp;Write&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1383621">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;p;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1383697">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;Write&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">125</span><span class="keyword" id="1383761">func</span>&nbsp;<span class="op" id="1383766">(</span><span class="ident" id="1383767">b</span>&nbsp;<span class="op" id="1383769">*</span><span class="ident" id="1383770">Buffer</span><span class="op" id="1383776">)</span>&nbsp;<span class="ident" id="1383778">Write</span><span class="op" id="1383783">(</span><span class="ident" id="1383784">p</span>&nbsp;<span class="op" id="1383786">[</span><span class="op" id="1383787">]</span><span class="builtintype" id="1383788">byte</span><span class="op" id="1383792">)</span>&nbsp;<span class="op" id="1383794">(</span><span class="ident" id="1383795">n</span>&nbsp;<span class="builtintype" id="1383797">int</span><span class="op" id="1383800">,</span>&nbsp;<span class="ident" id="1383802">err</span>&nbsp;<span class="builtintype" id="1383806">error</span><span class="op" id="1383811">)</span>&nbsp;<span class="op" id="1383813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383816">b</span><span class="op" id="1383817">.</span><span class="ident" id="1383818">lastRead</span>&nbsp;<span class="op" id="1383827">=</span>&nbsp;<span class="ident" id="1383829">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383840">m</span>&nbsp;<span class="op" id="1383842">:=</span>&nbsp;<span class="ident" id="1383845">b</span><span class="op" id="1383846">.</span><span class="ident" id="1383847">grow</span><span class="op" id="1383851">(</span><span class="builtinfunc" id="1383852">len</span><span class="op" id="1383855">(</span><span class="ident" id="1383856">p</span><span class="op" id="1383857">)</span><span class="op" id="1383858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383861">return</span>&nbsp;<span class="builtinfunc" id="1383868">copy</span><span class="op" id="1383872">(</span><span class="ident" id="1383873">b</span><span class="op" id="1383874">.</span><span class="ident" id="1383875">buf</span><span class="op" id="1383878">[</span><span class="ident" id="1383879">m</span><span class="op" id="1383880">:</span><span class="op" id="1383881">]</span><span class="op" id="1383882">,</span>&nbsp;<span class="ident" id="1383884">p</span><span class="op" id="1383885">)</span><span class="op" id="1383886">,</span>&nbsp;<span class="ident" id="1383888">nil</span><br>
<span class="lineno"></span><span class="op" id="1383892">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1383895">//&nbsp;WriteString&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;s&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1383973">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;s;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1384049">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteString&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1384119">func</span>&nbsp;<span class="op" id="1384124">(</span><span class="ident" id="1384125">b</span>&nbsp;<span class="op" id="1384127">*</span><span class="ident" id="1384128">Buffer</span><span class="op" id="1384134">)</span>&nbsp;<span class="ident" id="1384136">WriteString</span><span class="op" id="1384147">(</span><span class="ident" id="1384148">s</span>&nbsp;<span class="builtintype" id="1384150">string</span><span class="op" id="1384156">)</span>&nbsp;<span class="op" id="1384158">(</span><span class="ident" id="1384159">n</span>&nbsp;<span class="builtintype" id="1384161">int</span><span class="op" id="1384164">,</span>&nbsp;<span class="ident" id="1384166">err</span>&nbsp;<span class="builtintype" id="1384170">error</span><span class="op" id="1384175">)</span>&nbsp;<span class="op" id="1384177">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384180">b</span><span class="op" id="1384181">.</span><span class="ident" id="1384182">lastRead</span>&nbsp;<span class="op" id="1384191">=</span>&nbsp;<span class="ident" id="1384193">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384204">m</span>&nbsp;<span class="op" id="1384206">:=</span>&nbsp;<span class="ident" id="1384209">b</span><span class="op" id="1384210">.</span><span class="ident" id="1384211">grow</span><span class="op" id="1384215">(</span><span class="builtinfunc" id="1384216">len</span><span class="op" id="1384219">(</span><span class="ident" id="1384220">s</span><span class="op" id="1384221">)</span><span class="op" id="1384222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1384225">return</span>&nbsp;<span class="builtinfunc" id="1384232">copy</span><span class="op" id="1384236">(</span><span class="ident" id="1384237">b</span><span class="op" id="1384238">.</span><span class="ident" id="1384239">buf</span><span class="op" id="1384242">[</span><span class="ident" id="1384243">m</span><span class="op" id="1384244">:</span><span class="op" id="1384245">]</span><span class="op" id="1384246">,</span>&nbsp;<span class="ident" id="1384248">s</span><span class="op" id="1384249">)</span><span class="op" id="1384250">,</span>&nbsp;<span class="ident" id="1384252">nil</span><br>
<span class="lineno"></span><span class="op" id="1384256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1384259">//&nbsp;MinRead&nbsp;is&nbsp;the&nbsp;minimum&nbsp;slice&nbsp;size&nbsp;passed&nbsp;to&nbsp;a&nbsp;Read&nbsp;call&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1384321">//&nbsp;Buffer.ReadFrom.&nbsp;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;Buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;MinRead&nbsp;bytes&nbsp;beyond</span><br>
<span class="lineno"></span><span class="comment" id="1384398">//&nbsp;what&nbsp;is&nbsp;required&nbsp;to&nbsp;hold&nbsp;the&nbsp;contents&nbsp;of&nbsp;r,&nbsp;ReadFrom&nbsp;will&nbsp;not&nbsp;grow&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1384472">//&nbsp;underlying&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1384494">const</span>&nbsp;<span class="ident" id="1384500">MinRead</span>&nbsp;<span class="op" id="1384508">=</span>&nbsp;<span class="num" id="1384510">512</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1384515">//&nbsp;ReadFrom&nbsp;reads&nbsp;data&nbsp;from&nbsp;r&nbsp;until&nbsp;EOF&nbsp;and&nbsp;appends&nbsp;it&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing</span><br>
<span class="lineno"></span><span class="comment" id="1384593">//&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="1384670">//&nbsp;error&nbsp;except&nbsp;io.EOF&nbsp;encountered&nbsp;during&nbsp;the&nbsp;read&nbsp;is&nbsp;also&nbsp;returned.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1384746">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;ReadFrom&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">150</span><span class="keyword" id="1384813">func</span>&nbsp;<span class="op" id="1384818">(</span><span class="ident" id="1384819">b</span>&nbsp;<span class="op" id="1384821">*</span><span class="ident" id="1384822">Buffer</span><span class="op" id="1384828">)</span>&nbsp;<span class="ident" id="1384830">ReadFrom</span><span class="op" id="1384838">(</span><span class="ident" id="1384839">r</span>&nbsp;<span class="ident" id="1384841">io</span><span class="op" id="1384843">.</span><span class="ident" id="1384844">Reader</span><span class="op" id="1384850">)</span>&nbsp;<span class="op" id="1384852">(</span><span class="ident" id="1384853">n</span>&nbsp;<span class="ident" id="1384855">int64</span><span class="op" id="1384860">,</span>&nbsp;<span class="ident" id="1384862">err</span>&nbsp;<span class="builtintype" id="1384866">error</span><span class="op" id="1384871">)</span>&nbsp;<span class="op" id="1384873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384876">b</span><span class="op" id="1384877">.</span><span class="ident" id="1384878">lastRead</span>&nbsp;<span class="op" id="1384887">=</span>&nbsp;<span class="ident" id="1384889">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1384900">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1384948">if</span>&nbsp;<span class="ident" id="1384951">b</span><span class="op" id="1384952">.</span><span class="ident" id="1384953">off</span>&nbsp;<span class="op" id="1384957">&gt;=</span>&nbsp;<span class="builtinfunc" id="1384960">len</span><span class="op" id="1384963">(</span><span class="ident" id="1384964">b</span><span class="op" id="1384965">.</span><span class="ident" id="1384966">buf</span><span class="op" id="1384969">)</span>&nbsp;<span class="op" id="1384971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384975">b</span><span class="op" id="1384976">.</span><span class="ident" id="1384977">Truncate</span><span class="op" id="1384985">(</span><span class="num" id="1384986">0</span><span class="op" id="1384987">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1384990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1384993">for</span>&nbsp;<span class="op" id="1384997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1385001">if</span>&nbsp;<span class="ident" id="1385004">free</span>&nbsp;<span class="op" id="1385009">:=</span>&nbsp;<span class="builtinfunc" id="1385012">cap</span><span class="op" id="1385015">(</span><span class="ident" id="1385016">b</span><span class="op" id="1385017">.</span><span class="ident" id="1385018">buf</span><span class="op" id="1385021">)</span>&nbsp;<span class="op" id="1385023">-</span>&nbsp;<span class="builtinfunc" id="1385025">len</span><span class="op" id="1385028">(</span><span class="ident" id="1385029">b</span><span class="op" id="1385030">.</span><span class="ident" id="1385031">buf</span><span class="op" id="1385034">)</span><span class="op" id="1385035">;</span>&nbsp;<span class="ident" id="1385037">free</span>&nbsp;<span class="op" id="1385042">&lt;</span>&nbsp;<span class="ident" id="1385044">MinRead</span>&nbsp;<span class="op" id="1385052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1385057">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1385087">newBuf</span>&nbsp;<span class="op" id="1385094">:=</span>&nbsp;<span class="ident" id="1385097">b</span><span class="op" id="1385098">.</span><span class="ident" id="1385099">buf</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1385106">if</span>&nbsp;<span class="ident" id="1385109">b</span><span class="op" id="1385110">.</span><span class="ident" id="1385111">off</span><span class="op" id="1385114">+</span><span class="ident" id="1385115">free</span>&nbsp;<span class="op" id="1385120">&lt;</span>&nbsp;<span class="ident" id="1385122">MinRead</span>&nbsp;<span class="op" id="1385130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1385136">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;using&nbsp;beginning&nbsp;of&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1385187">//&nbsp;double&nbsp;buffer&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1385217">newBuf</span>&nbsp;<span class="op" id="1385224">=</span>&nbsp;<span class="ident" id="1385226">makeSlice</span><span class="op" id="1385235">(</span><span class="num" id="1385236">2</span><span class="op" id="1385237">*</span><span class="builtinfunc" id="1385238">cap</span><span class="op" id="1385241">(</span><span class="ident" id="1385242">b</span><span class="op" id="1385243">.</span><span class="ident" id="1385244">buf</span><span class="op" id="1385247">)</span>&nbsp;<span class="op" id="1385249">+</span>&nbsp;<span class="ident" id="1385251">MinRead</span><span class="op" id="1385258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1385263">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1385268">copy</span><span class="op" id="1385272">(</span><span class="ident" id="1385273">newBuf</span><span class="op" id="1385279">,</span>&nbsp;<span class="ident" id="1385281">b</span><span class="op" id="1385282">.</span><span class="ident" id="1385283">buf</span><span class="op" id="1385286">[</span><span class="ident" id="1385287">b</span><span class="op" id="1385288">.</span><span class="ident" id="1385289">off</span><span class="op" id="1385292">:</span><span class="op" id="1385293">]</span><span class="op" id="1385294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1385299">b</span><span class="op" id="1385300">.</span><span class="ident" id="1385301">buf</span>&nbsp;<span class="op" id="1385305">=</span>&nbsp;<span class="ident" id="1385307">newBuf</span><span class="op" id="1385313">[</span><span class="op" id="1385314">:</span><span class="builtinfunc" id="1385315">len</span><span class="op" id="1385318">(</span><span class="ident" id="1385319">b</span><span class="op" id="1385320">.</span><span class="ident" id="1385321">buf</span><span class="op" id="1385324">)</span><span class="op" id="1385325">-</span><span class="ident" id="1385326">b</span><span class="op" id="1385327">.</span><span class="ident" id="1385328">off</span><span class="op" id="1385331">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1385336">b</span><span class="op" id="1385337">.</span><span class="ident" id="1385338">off</span>&nbsp;<span class="op" id="1385342">=</span>&nbsp;<span class="num" id="1385344">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1385348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1385352">m</span><span class="op" id="1385353">,</span>&nbsp;<span class="ident" id="1385355">e</span>&nbsp;<span class="op" id="1385357">:=</span>&nbsp;<span class="ident" id="1385360">r</span><span class="op" id="1385361">.</span><span class="ident" id="1385362">Read</span><span class="op" id="1385366">(</span><span class="ident" id="1385367">b</span><span class="op" id="1385368">.</span><span class="ident" id="1385369">buf</span><span class="op" id="1385372">[</span><span class="builtinfunc" id="1385373">len</span><span class="op" id="1385376">(</span><span class="ident" id="1385377">b</span><span class="op" id="1385378">.</span><span class="ident" id="1385379">buf</span><span class="op" id="1385382">)</span><span class="op" id="1385383">:</span><span class="builtinfunc" id="1385384">cap</span><span class="op" id="1385387">(</span><span class="ident" id="1385388">b</span><span class="op" id="1385389">.</span><span class="ident" id="1385390">buf</span><span class="op" id="1385393">)</span><span class="op" id="1385394">]</span><span class="op" id="1385395">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1385399">b</span><span class="op" id="1385400">.</span><span class="ident" id="1385401">buf</span>&nbsp;<span class="op" id="1385405">=</span>&nbsp;<span class="ident" id="1385407">b</span><span class="op" id="1385408">.</span><span class="ident" id="1385409">buf</span><span class="op" id="1385412">[</span><span class="num" id="1385413">0</span>&nbsp;<span class="op" id="1385415">:</span>&nbsp;<span class="builtinfunc" id="1385417">len</span><span class="op" id="1385420">(</span><span class="ident" id="1385421">b</span><span class="op" id="1385422">.</span><span class="ident" id="1385423">buf</span><span class="op" id="1385426">)</span><span class="op" id="1385427">+</span><span class="ident" id="1385428">m</span><span class="op" id="1385429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1385433">n</span>&nbsp;<span class="op" id="1385435">+=</span>&nbsp;<span class="ident" id="1385438">int64</span><span class="op" id="1385443">(</span><span class="ident" id="1385444">m</span><span class="op" id="1385445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1385449">if</span>&nbsp;<span class="ident" id="1385452">e</span>&nbsp;<span class="op" id="1385454">==</span>&nbsp;<span class="ident" id="1385457">io</span><span class="op" id="1385459">.</span><span class="ident" id="1385460">EOF</span>&nbsp;<span class="op" id="1385464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1385469">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1385477">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1385481">if</span>&nbsp;<span class="ident" id="1385484">e</span>&nbsp;<span class="op" id="1385486">!=</span>&nbsp;<span class="ident" id="1385489">nil</span>&nbsp;<span class="op" id="1385493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1385498">return</span>&nbsp;<span class="ident" id="1385505">n</span><span class="op" id="1385506">,</span>&nbsp;<span class="ident" id="1385508">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1385512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1385515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1385518">return</span>&nbsp;<span class="ident" id="1385525">n</span><span class="op" id="1385526">,</span>&nbsp;<span class="ident" id="1385528">nil</span>&nbsp;<span class="comment" id="1385532">//&nbsp;err&nbsp;is&nbsp;EOF,&nbsp;so&nbsp;return&nbsp;nil&nbsp;explicitly</span><br>
<span class="lineno">180</span><span class="op" id="1385572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1385575">//&nbsp;makeSlice&nbsp;allocates&nbsp;a&nbsp;slice&nbsp;of&nbsp;size&nbsp;n.&nbsp;If&nbsp;the&nbsp;allocation&nbsp;fails,&nbsp;it&nbsp;panics</span><br>
<span class="lineno"></span><span class="comment" id="1385652">//&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1385673">func</span>&nbsp;<span class="ident" id="1385678">makeSlice</span><span class="op" id="1385687">(</span><span class="ident" id="1385688">n</span>&nbsp;<span class="builtintype" id="1385690">int</span><span class="op" id="1385693">)</span>&nbsp;<span class="op" id="1385695">[</span><span class="op" id="1385696">]</span><span class="builtintype" id="1385697">byte</span>&nbsp;<span class="op" id="1385702">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1385705">//&nbsp;If&nbsp;the&nbsp;make&nbsp;fails,&nbsp;give&nbsp;a&nbsp;known&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1385748">defer</span>&nbsp;<span class="keyword" id="1385754">func</span><span class="op" id="1385758">(</span><span class="op" id="1385759">)</span>&nbsp;<span class="op" id="1385761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1385765">if</span>&nbsp;<span class="builtinfunc" id="1385768">recover</span><span class="op" id="1385775">(</span><span class="op" id="1385776">)</span>&nbsp;<span class="op" id="1385778">!=</span>&nbsp;<span class="ident" id="1385781">nil</span>&nbsp;<span class="op" id="1385785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1385790">panic</span><span class="op" id="1385795">(</span><span class="ident" id="1385796">ErrTooLarge</span><span class="op" id="1385807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1385811">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1385814">}</span><span class="op" id="1385815">(</span><span class="op" id="1385816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1385819">return</span>&nbsp;<span class="builtinfunc" id="1385826">make</span><span class="op" id="1385830">(</span><span class="op" id="1385831">[</span><span class="op" id="1385832">]</span><span class="builtintype" id="1385833">byte</span><span class="op" id="1385837">,</span>&nbsp;<span class="ident" id="1385839">n</span><span class="op" id="1385840">)</span><br>
<span class="lineno"></span><span class="op" id="1385842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1385845">//&nbsp;WriteTo&nbsp;writes&nbsp;data&nbsp;to&nbsp;w&nbsp;until&nbsp;the&nbsp;buffer&nbsp;is&nbsp;drained&nbsp;or&nbsp;an&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno">195</span><span class="comment" id="1385921">//&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written;&nbsp;it&nbsp;always&nbsp;fits&nbsp;into&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="1385998">//&nbsp;int,&nbsp;but&nbsp;it&nbsp;is&nbsp;int64&nbsp;to&nbsp;match&nbsp;the&nbsp;io.WriterTo&nbsp;interface.&nbsp;Any&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="1386068">//&nbsp;encountered&nbsp;during&nbsp;the&nbsp;write&nbsp;is&nbsp;also&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="1386118">func</span>&nbsp;<span class="op" id="1386123">(</span><span class="ident" id="1386124">b</span>&nbsp;<span class="op" id="1386126">*</span><span class="ident" id="1386127">Buffer</span><span class="op" id="1386133">)</span>&nbsp;<span class="ident" id="1386135">WriteTo</span><span class="op" id="1386142">(</span><span class="ident" id="1386143">w</span>&nbsp;<span class="ident" id="1386145">io</span><span class="op" id="1386147">.</span><span class="ident" id="1386148">Writer</span><span class="op" id="1386154">)</span>&nbsp;<span class="op" id="1386156">(</span><span class="ident" id="1386157">n</span>&nbsp;<span class="ident" id="1386159">int64</span><span class="op" id="1386164">,</span>&nbsp;<span class="ident" id="1386166">err</span>&nbsp;<span class="builtintype" id="1386170">error</span><span class="op" id="1386175">)</span>&nbsp;<span class="op" id="1386177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1386180">b</span><span class="op" id="1386181">.</span><span class="ident" id="1386182">lastRead</span>&nbsp;<span class="op" id="1386191">=</span>&nbsp;<span class="ident" id="1386193">opInvalid</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1386204">if</span>&nbsp;<span class="ident" id="1386207">b</span><span class="op" id="1386208">.</span><span class="ident" id="1386209">off</span>&nbsp;<span class="op" id="1386213">&lt;</span>&nbsp;<span class="builtinfunc" id="1386215">len</span><span class="op" id="1386218">(</span><span class="ident" id="1386219">b</span><span class="op" id="1386220">.</span><span class="ident" id="1386221">buf</span><span class="op" id="1386224">)</span>&nbsp;<span class="op" id="1386226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1386230">nBytes</span>&nbsp;<span class="op" id="1386237">:=</span>&nbsp;<span class="ident" id="1386240">b</span><span class="op" id="1386241">.</span><span class="ident" id="1386242">Len</span><span class="op" id="1386245">(</span><span class="op" id="1386246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1386250">m</span><span class="op" id="1386251">,</span>&nbsp;<span class="ident" id="1386253">e</span>&nbsp;<span class="op" id="1386255">:=</span>&nbsp;<span class="ident" id="1386258">w</span><span class="op" id="1386259">.</span><span class="ident" id="1386260">Write</span><span class="op" id="1386265">(</span><span class="ident" id="1386266">b</span><span class="op" id="1386267">.</span><span class="ident" id="1386268">buf</span><span class="op" id="1386271">[</span><span class="ident" id="1386272">b</span><span class="op" id="1386273">.</span><span class="ident" id="1386274">off</span><span class="op" id="1386277">:</span><span class="op" id="1386278">]</span><span class="op" id="1386279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1386283">if</span>&nbsp;<span class="ident" id="1386286">m</span>&nbsp;<span class="op" id="1386288">&gt;</span>&nbsp;<span class="ident" id="1386290">nBytes</span>&nbsp;<span class="op" id="1386297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1386302">panic</span><span class="op" id="1386307">(</span><span class="string" id="1386308">&#34;bytes.Buffer.WriteTo:&nbsp;invalid&nbsp;Write&nbsp;count&#34;</span><span class="op" id="1386351">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1386355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1386359">b</span><span class="op" id="1386360">.</span><span class="ident" id="1386361">off</span>&nbsp;<span class="op" id="1386365">+=</span>&nbsp;<span class="ident" id="1386368">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1386372">n</span>&nbsp;<span class="op" id="1386374">=</span>&nbsp;<span class="ident" id="1386376">int64</span><span class="op" id="1386381">(</span><span class="ident" id="1386382">m</span><span class="op" id="1386383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1386387">if</span>&nbsp;<span class="ident" id="1386390">e</span>&nbsp;<span class="op" id="1386392">!=</span>&nbsp;<span class="ident" id="1386395">nil</span>&nbsp;<span class="op" id="1386399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1386404">return</span>&nbsp;<span class="ident" id="1386411">n</span><span class="op" id="1386412">,</span>&nbsp;<span class="ident" id="1386414">e</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1386418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386422">//&nbsp;all&nbsp;bytes&nbsp;should&nbsp;have&nbsp;been&nbsp;written,&nbsp;by&nbsp;definition&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386480">//&nbsp;Write&nbsp;method&nbsp;in&nbsp;io.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1386511">if</span>&nbsp;<span class="ident" id="1386514">m</span>&nbsp;<span class="op" id="1386516">!=</span>&nbsp;<span class="ident" id="1386519">nBytes</span>&nbsp;<span class="op" id="1386526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1386531">return</span>&nbsp;<span class="ident" id="1386538">n</span><span class="op" id="1386539">,</span>&nbsp;<span class="ident" id="1386541">io</span><span class="op" id="1386543">.</span><span class="ident" id="1386544">ErrShortWrite</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1386560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1386563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386566">//&nbsp;Buffer&nbsp;is&nbsp;now&nbsp;empty;&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1386598">b</span><span class="op" id="1386599">.</span><span class="ident" id="1386600">Truncate</span><span class="op" id="1386608">(</span><span class="num" id="1386609">0</span><span class="op" id="1386610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1386613">return</span><br>
<span class="lineno">220</span><span class="op" id="1386620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1386623">//&nbsp;WriteByte&nbsp;appends&nbsp;the&nbsp;byte&nbsp;c&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="comment" id="1386700">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;always&nbsp;nil,&nbsp;but&nbsp;is&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1386777">//&nbsp;WriteByte.&nbsp;If&nbsp;the&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteByte&nbsp;will&nbsp;panic&nbsp;with</span><br>
<span class="lineno">225</span><span class="comment" id="1386850">//&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1386866">func</span>&nbsp;<span class="op" id="1386871">(</span><span class="ident" id="1386872">b</span>&nbsp;<span class="op" id="1386874">*</span><span class="ident" id="1386875">Buffer</span><span class="op" id="1386881">)</span>&nbsp;<span class="ident" id="1386883">WriteByte</span><span class="op" id="1386892">(</span><span class="ident" id="1386893">c</span>&nbsp;<span class="builtintype" id="1386895">byte</span><span class="op" id="1386899">)</span>&nbsp;<span class="builtintype" id="1386901">error</span>&nbsp;<span class="op" id="1386907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1386910">b</span><span class="op" id="1386911">.</span><span class="ident" id="1386912">lastRead</span>&nbsp;<span class="op" id="1386921">=</span>&nbsp;<span class="ident" id="1386923">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1386934">m</span>&nbsp;<span class="op" id="1386936">:=</span>&nbsp;<span class="ident" id="1386939">b</span><span class="op" id="1386940">.</span><span class="ident" id="1386941">grow</span><span class="op" id="1386945">(</span><span class="num" id="1386946">1</span><span class="op" id="1386947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1386950">b</span><span class="op" id="1386951">.</span><span class="ident" id="1386952">buf</span><span class="op" id="1386955">[</span><span class="ident" id="1386956">m</span><span class="op" id="1386957">]</span>&nbsp;<span class="op" id="1386959">=</span>&nbsp;<span class="ident" id="1386961">c</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1386964">return</span>&nbsp;<span class="ident" id="1386971">nil</span><br>
<span class="lineno"></span><span class="op" id="1386975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1386978">//&nbsp;WriteRune&nbsp;appends&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1387049">//&nbsp;buffer,&nbsp;returning&nbsp;its&nbsp;length&nbsp;and&nbsp;an&nbsp;error,&nbsp;which&nbsp;is&nbsp;always&nbsp;nil&nbsp;but&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="1387122">//&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s&nbsp;WriteRune.&nbsp;The&nbsp;buffer&nbsp;is&nbsp;grown&nbsp;as&nbsp;needed;</span><br>
<span class="lineno"></span><span class="comment" id="1387200">//&nbsp;if&nbsp;it&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteRune&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1387267">func</span>&nbsp;<span class="op" id="1387272">(</span><span class="ident" id="1387273">b</span>&nbsp;<span class="op" id="1387275">*</span><span class="ident" id="1387276">Buffer</span><span class="op" id="1387282">)</span>&nbsp;<span class="ident" id="1387284">WriteRune</span><span class="op" id="1387293">(</span><span class="ident" id="1387294">r</span>&nbsp;<span class="builtintype" id="1387296">rune</span><span class="op" id="1387300">)</span>&nbsp;<span class="op" id="1387302">(</span><span class="ident" id="1387303">n</span>&nbsp;<span class="builtintype" id="1387305">int</span><span class="op" id="1387308">,</span>&nbsp;<span class="ident" id="1387310">err</span>&nbsp;<span class="builtintype" id="1387314">error</span><span class="op" id="1387319">)</span>&nbsp;<span class="op" id="1387321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1387324">if</span>&nbsp;<span class="ident" id="1387327">r</span>&nbsp;<span class="op" id="1387329">&lt;</span>&nbsp;<span class="ident" id="1387331">utf8</span><span class="op" id="1387335">.</span><span class="ident" id="1387336">RuneSelf</span>&nbsp;<span class="op" id="1387345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1387349">b</span><span class="op" id="1387350">.</span><span class="ident" id="1387351">WriteByte</span><span class="op" id="1387360">(</span><span class="builtintype" id="1387361">byte</span><span class="op" id="1387365">(</span><span class="ident" id="1387366">r</span><span class="op" id="1387367">)</span><span class="op" id="1387368">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1387372">return</span>&nbsp;<span class="num" id="1387379">1</span><span class="op" id="1387380">,</span>&nbsp;<span class="ident" id="1387382">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1387387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1387390">n</span>&nbsp;<span class="op" id="1387392">=</span>&nbsp;<span class="ident" id="1387394">utf8</span><span class="op" id="1387398">.</span><span class="ident" id="1387399">EncodeRune</span><span class="op" id="1387409">(</span><span class="ident" id="1387410">b</span><span class="op" id="1387411">.</span><span class="ident" id="1387412">runeBytes</span><span class="op" id="1387421">[</span><span class="num" id="1387422">0</span><span class="op" id="1387423">:</span><span class="op" id="1387424">]</span><span class="op" id="1387425">,</span>&nbsp;<span class="ident" id="1387427">r</span><span class="op" id="1387428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1387431">b</span><span class="op" id="1387432">.</span><span class="ident" id="1387433">Write</span><span class="op" id="1387438">(</span><span class="ident" id="1387439">b</span><span class="op" id="1387440">.</span><span class="ident" id="1387441">runeBytes</span><span class="op" id="1387450">[</span><span class="num" id="1387451">0</span><span class="op" id="1387452">:</span><span class="ident" id="1387453">n</span><span class="op" id="1387454">]</span><span class="op" id="1387455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1387458">return</span>&nbsp;<span class="ident" id="1387465">n</span><span class="op" id="1387466">,</span>&nbsp;<span class="ident" id="1387468">nil</span><br>
<span class="lineno">245</span><span class="op" id="1387472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1387475">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;len(p)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer&nbsp;or&nbsp;until&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1387547">//&nbsp;is&nbsp;drained.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1387619">//&nbsp;buffer&nbsp;has&nbsp;no&nbsp;data&nbsp;to&nbsp;return,&nbsp;err&nbsp;is&nbsp;io.EOF&nbsp;(unless&nbsp;len(p)&nbsp;is&nbsp;zero);</span><br>
<span class="lineno">250</span><span class="comment" id="1387691">//&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="1387715">func</span>&nbsp;<span class="op" id="1387720">(</span><span class="ident" id="1387721">b</span>&nbsp;<span class="op" id="1387723">*</span><span class="ident" id="1387724">Buffer</span><span class="op" id="1387730">)</span>&nbsp;<span class="ident" id="1387732">Read</span><span class="op" id="1387736">(</span><span class="ident" id="1387737">p</span>&nbsp;<span class="op" id="1387739">[</span><span class="op" id="1387740">]</span><span class="builtintype" id="1387741">byte</span><span class="op" id="1387745">)</span>&nbsp;<span class="op" id="1387747">(</span><span class="ident" id="1387748">n</span>&nbsp;<span class="builtintype" id="1387750">int</span><span class="op" id="1387753">,</span>&nbsp;<span class="ident" id="1387755">err</span>&nbsp;<span class="builtintype" id="1387759">error</span><span class="op" id="1387764">)</span>&nbsp;<span class="op" id="1387766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1387769">b</span><span class="op" id="1387770">.</span><span class="ident" id="1387771">lastRead</span>&nbsp;<span class="op" id="1387780">=</span>&nbsp;<span class="ident" id="1387782">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1387793">if</span>&nbsp;<span class="ident" id="1387796">b</span><span class="op" id="1387797">.</span><span class="ident" id="1387798">off</span>&nbsp;<span class="op" id="1387802">&gt;=</span>&nbsp;<span class="builtinfunc" id="1387805">len</span><span class="op" id="1387808">(</span><span class="ident" id="1387809">b</span><span class="op" id="1387810">.</span><span class="ident" id="1387811">buf</span><span class="op" id="1387814">)</span>&nbsp;<span class="op" id="1387816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387820">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1387866">b</span><span class="op" id="1387867">.</span><span class="ident" id="1387868">Truncate</span><span class="op" id="1387876">(</span><span class="num" id="1387877">0</span><span class="op" id="1387878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1387882">if</span>&nbsp;<span class="builtinfunc" id="1387885">len</span><span class="op" id="1387888">(</span><span class="ident" id="1387889">p</span><span class="op" id="1387890">)</span>&nbsp;<span class="op" id="1387892">==</span>&nbsp;<span class="num" id="1387895">0</span>&nbsp;<span class="op" id="1387897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1387902">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1387911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1387915">return</span>&nbsp;<span class="num" id="1387922">0</span><span class="op" id="1387923">,</span>&nbsp;<span class="ident" id="1387925">io</span><span class="op" id="1387927">.</span><span class="ident" id="1387928">EOF</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1387933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1387936">n</span>&nbsp;<span class="op" id="1387938">=</span>&nbsp;<span class="builtinfunc" id="1387940">copy</span><span class="op" id="1387944">(</span><span class="ident" id="1387945">p</span><span class="op" id="1387946">,</span>&nbsp;<span class="ident" id="1387948">b</span><span class="op" id="1387949">.</span><span class="ident" id="1387950">buf</span><span class="op" id="1387953">[</span><span class="ident" id="1387954">b</span><span class="op" id="1387955">.</span><span class="ident" id="1387956">off</span><span class="op" id="1387959">:</span><span class="op" id="1387960">]</span><span class="op" id="1387961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1387964">b</span><span class="op" id="1387965">.</span><span class="ident" id="1387966">off</span>&nbsp;<span class="op" id="1387970">+=</span>&nbsp;<span class="ident" id="1387973">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1387976">if</span>&nbsp;<span class="ident" id="1387979">n</span>&nbsp;<span class="op" id="1387981">&gt;</span>&nbsp;<span class="num" id="1387983">0</span>&nbsp;<span class="op" id="1387985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1387989">b</span><span class="op" id="1387990">.</span><span class="ident" id="1387991">lastRead</span>&nbsp;<span class="op" id="1388000">=</span>&nbsp;<span class="ident" id="1388002">opRead</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1388010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1388013">return</span><br>
<span class="lineno"></span><span class="op" id="1388020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1388023">//&nbsp;Next&nbsp;returns&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer,</span><br>
<span class="lineno">270</span><span class="comment" id="1388092">//&nbsp;advancing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;if&nbsp;the&nbsp;bytes&nbsp;had&nbsp;been&nbsp;returned&nbsp;by&nbsp;Read.</span><br>
<span class="lineno"></span><span class="comment" id="1388159">//&nbsp;If&nbsp;there&nbsp;are&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;Next&nbsp;returns&nbsp;the&nbsp;entire&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1388241">//&nbsp;The&nbsp;slice&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;read&nbsp;or&nbsp;write&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="1388315">func</span>&nbsp;<span class="op" id="1388320">(</span><span class="ident" id="1388321">b</span>&nbsp;<span class="op" id="1388323">*</span><span class="ident" id="1388324">Buffer</span><span class="op" id="1388330">)</span>&nbsp;<span class="ident" id="1388332">Next</span><span class="op" id="1388336">(</span><span class="ident" id="1388337">n</span>&nbsp;<span class="builtintype" id="1388339">int</span><span class="op" id="1388342">)</span>&nbsp;<span class="op" id="1388344">[</span><span class="op" id="1388345">]</span><span class="builtintype" id="1388346">byte</span>&nbsp;<span class="op" id="1388351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388354">b</span><span class="op" id="1388355">.</span><span class="ident" id="1388356">lastRead</span>&nbsp;<span class="op" id="1388365">=</span>&nbsp;<span class="ident" id="1388367">opInvalid</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388378">m</span>&nbsp;<span class="op" id="1388380">:=</span>&nbsp;<span class="ident" id="1388383">b</span><span class="op" id="1388384">.</span><span class="ident" id="1388385">Len</span><span class="op" id="1388388">(</span><span class="op" id="1388389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1388392">if</span>&nbsp;<span class="ident" id="1388395">n</span>&nbsp;<span class="op" id="1388397">&gt;</span>&nbsp;<span class="ident" id="1388399">m</span>&nbsp;<span class="op" id="1388401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388405">n</span>&nbsp;<span class="op" id="1388407">=</span>&nbsp;<span class="ident" id="1388409">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1388412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388415">data</span>&nbsp;<span class="op" id="1388420">:=</span>&nbsp;<span class="ident" id="1388423">b</span><span class="op" id="1388424">.</span><span class="ident" id="1388425">buf</span><span class="op" id="1388428">[</span><span class="ident" id="1388429">b</span><span class="op" id="1388430">.</span><span class="ident" id="1388431">off</span>&nbsp;<span class="op" id="1388435">:</span>&nbsp;<span class="ident" id="1388437">b</span><span class="op" id="1388438">.</span><span class="ident" id="1388439">off</span><span class="op" id="1388442">+</span><span class="ident" id="1388443">n</span><span class="op" id="1388444">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388447">b</span><span class="op" id="1388448">.</span><span class="ident" id="1388449">off</span>&nbsp;<span class="op" id="1388453">+=</span>&nbsp;<span class="ident" id="1388456">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1388459">if</span>&nbsp;<span class="ident" id="1388462">n</span>&nbsp;<span class="op" id="1388464">&gt;</span>&nbsp;<span class="num" id="1388466">0</span>&nbsp;<span class="op" id="1388468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388472">b</span><span class="op" id="1388473">.</span><span class="ident" id="1388474">lastRead</span>&nbsp;<span class="op" id="1388483">=</span>&nbsp;<span class="ident" id="1388485">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1388493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1388496">return</span>&nbsp;<span class="ident" id="1388503">data</span><br>
<span class="lineno">285</span><span class="op" id="1388508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1388511">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1388572">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;it&nbsp;returns&nbsp;error&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1388625">func</span>&nbsp;<span class="op" id="1388630">(</span><span class="ident" id="1388631">b</span>&nbsp;<span class="op" id="1388633">*</span><span class="ident" id="1388634">Buffer</span><span class="op" id="1388640">)</span>&nbsp;<span class="ident" id="1388642">ReadByte</span><span class="op" id="1388650">(</span><span class="op" id="1388651">)</span>&nbsp;<span class="op" id="1388653">(</span><span class="ident" id="1388654">c</span>&nbsp;<span class="builtintype" id="1388656">byte</span><span class="op" id="1388660">,</span>&nbsp;<span class="ident" id="1388662">err</span>&nbsp;<span class="builtintype" id="1388666">error</span><span class="op" id="1388671">)</span>&nbsp;<span class="op" id="1388673">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388676">b</span><span class="op" id="1388677">.</span><span class="ident" id="1388678">lastRead</span>&nbsp;<span class="op" id="1388687">=</span>&nbsp;<span class="ident" id="1388689">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1388700">if</span>&nbsp;<span class="ident" id="1388703">b</span><span class="op" id="1388704">.</span><span class="ident" id="1388705">off</span>&nbsp;<span class="op" id="1388709">&gt;=</span>&nbsp;<span class="builtinfunc" id="1388712">len</span><span class="op" id="1388715">(</span><span class="ident" id="1388716">b</span><span class="op" id="1388717">.</span><span class="ident" id="1388718">buf</span><span class="op" id="1388721">)</span>&nbsp;<span class="op" id="1388723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388727">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388773">b</span><span class="op" id="1388774">.</span><span class="ident" id="1388775">Truncate</span><span class="op" id="1388783">(</span><span class="num" id="1388784">0</span><span class="op" id="1388785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1388789">return</span>&nbsp;<span class="num" id="1388796">0</span><span class="op" id="1388797">,</span>&nbsp;<span class="ident" id="1388799">io</span><span class="op" id="1388801">.</span><span class="ident" id="1388802">EOF</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1388807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388810">c</span>&nbsp;<span class="op" id="1388812">=</span>&nbsp;<span class="ident" id="1388814">b</span><span class="op" id="1388815">.</span><span class="ident" id="1388816">buf</span><span class="op" id="1388819">[</span><span class="ident" id="1388820">b</span><span class="op" id="1388821">.</span><span class="ident" id="1388822">off</span><span class="op" id="1388825">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388828">b</span><span class="op" id="1388829">.</span><span class="ident" id="1388830">off</span><span class="op" id="1388833">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388837">b</span><span class="op" id="1388838">.</span><span class="ident" id="1388839">lastRead</span>&nbsp;<span class="op" id="1388848">=</span>&nbsp;<span class="ident" id="1388850">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1388858">return</span>&nbsp;<span class="ident" id="1388865">c</span><span class="op" id="1388866">,</span>&nbsp;<span class="ident" id="1388868">nil</span><br>
<span class="lineno">300</span><span class="op" id="1388872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1388875">//&nbsp;ReadRune&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="1388928">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1388967">//&nbsp;If&nbsp;no&nbsp;bytes&nbsp;are&nbsp;available,&nbsp;the&nbsp;error&nbsp;returned&nbsp;is&nbsp;io.EOF.</span><br>
<span class="lineno">305</span><span class="comment" id="1389027">//&nbsp;If&nbsp;the&nbsp;bytes&nbsp;are&nbsp;an&nbsp;erroneous&nbsp;UTF-8&nbsp;encoding,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1389079">//&nbsp;consumes&nbsp;one&nbsp;byte&nbsp;and&nbsp;returns&nbsp;U+FFFD,&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="1389123">func</span>&nbsp;<span class="op" id="1389128">(</span><span class="ident" id="1389129">b</span>&nbsp;<span class="op" id="1389131">*</span><span class="ident" id="1389132">Buffer</span><span class="op" id="1389138">)</span>&nbsp;<span class="ident" id="1389140">ReadRune</span><span class="op" id="1389148">(</span><span class="op" id="1389149">)</span>&nbsp;<span class="op" id="1389151">(</span><span class="ident" id="1389152">r</span>&nbsp;<span class="builtintype" id="1389154">rune</span><span class="op" id="1389158">,</span>&nbsp;<span class="ident" id="1389160">size</span>&nbsp;<span class="builtintype" id="1389165">int</span><span class="op" id="1389168">,</span>&nbsp;<span class="ident" id="1389170">err</span>&nbsp;<span class="builtintype" id="1389174">error</span><span class="op" id="1389179">)</span>&nbsp;<span class="op" id="1389181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1389184">b</span><span class="op" id="1389185">.</span><span class="ident" id="1389186">lastRead</span>&nbsp;<span class="op" id="1389195">=</span>&nbsp;<span class="ident" id="1389197">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1389208">if</span>&nbsp;<span class="ident" id="1389211">b</span><span class="op" id="1389212">.</span><span class="ident" id="1389213">off</span>&nbsp;<span class="op" id="1389217">&gt;=</span>&nbsp;<span class="builtinfunc" id="1389220">len</span><span class="op" id="1389223">(</span><span class="ident" id="1389224">b</span><span class="op" id="1389225">.</span><span class="ident" id="1389226">buf</span><span class="op" id="1389229">)</span>&nbsp;<span class="op" id="1389231">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389235">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1389281">b</span><span class="op" id="1389282">.</span><span class="ident" id="1389283">Truncate</span><span class="op" id="1389291">(</span><span class="num" id="1389292">0</span><span class="op" id="1389293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1389297">return</span>&nbsp;<span class="num" id="1389304">0</span><span class="op" id="1389305">,</span>&nbsp;<span class="num" id="1389307">0</span><span class="op" id="1389308">,</span>&nbsp;<span class="ident" id="1389310">io</span><span class="op" id="1389312">.</span><span class="ident" id="1389313">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1389318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1389321">b</span><span class="op" id="1389322">.</span><span class="ident" id="1389323">lastRead</span>&nbsp;<span class="op" id="1389332">=</span>&nbsp;<span class="ident" id="1389334">opReadRune</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1389346">c</span>&nbsp;<span class="op" id="1389348">:=</span>&nbsp;<span class="ident" id="1389351">b</span><span class="op" id="1389352">.</span><span class="ident" id="1389353">buf</span><span class="op" id="1389356">[</span><span class="ident" id="1389357">b</span><span class="op" id="1389358">.</span><span class="ident" id="1389359">off</span><span class="op" id="1389362">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1389365">if</span>&nbsp;<span class="ident" id="1389368">c</span>&nbsp;<span class="op" id="1389370">&lt;</span>&nbsp;<span class="ident" id="1389372">utf8</span><span class="op" id="1389376">.</span><span class="ident" id="1389377">RuneSelf</span>&nbsp;<span class="op" id="1389386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1389390">b</span><span class="op" id="1389391">.</span><span class="ident" id="1389392">off</span><span class="op" id="1389395">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1389400">return</span>&nbsp;<span class="builtintype" id="1389407">rune</span><span class="op" id="1389411">(</span><span class="ident" id="1389412">c</span><span class="op" id="1389413">)</span><span class="op" id="1389414">,</span>&nbsp;<span class="num" id="1389416">1</span><span class="op" id="1389417">,</span>&nbsp;<span class="ident" id="1389419">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1389424">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1389427">r</span><span class="op" id="1389428">,</span>&nbsp;<span class="ident" id="1389430">n</span>&nbsp;<span class="op" id="1389432">:=</span>&nbsp;<span class="ident" id="1389435">utf8</span><span class="op" id="1389439">.</span><span class="ident" id="1389440">DecodeRune</span><span class="op" id="1389450">(</span><span class="ident" id="1389451">b</span><span class="op" id="1389452">.</span><span class="ident" id="1389453">buf</span><span class="op" id="1389456">[</span><span class="ident" id="1389457">b</span><span class="op" id="1389458">.</span><span class="ident" id="1389459">off</span><span class="op" id="1389462">:</span><span class="op" id="1389463">]</span><span class="op" id="1389464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1389467">b</span><span class="op" id="1389468">.</span><span class="ident" id="1389469">off</span>&nbsp;<span class="op" id="1389473">+=</span>&nbsp;<span class="ident" id="1389476">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1389479">return</span>&nbsp;<span class="ident" id="1389486">r</span><span class="op" id="1389487">,</span>&nbsp;<span class="ident" id="1389489">n</span><span class="op" id="1389490">,</span>&nbsp;<span class="ident" id="1389492">nil</span><br>
<span class="lineno"></span><span class="op" id="1389496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="1389499">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune&nbsp;returned&nbsp;by&nbsp;ReadRune.</span><br>
<span class="lineno"></span><span class="comment" id="1389557">//&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;or&nbsp;write&nbsp;operation&nbsp;on&nbsp;the&nbsp;buffer&nbsp;was</span><br>
<span class="lineno"></span><span class="comment" id="1389621">//&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this&nbsp;regard</span><br>
<span class="lineno"></span><span class="comment" id="1389686">//&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="1389753">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno">330</span><span class="keyword" id="1389782">func</span>&nbsp;<span class="op" id="1389787">(</span><span class="ident" id="1389788">b</span>&nbsp;<span class="op" id="1389790">*</span><span class="ident" id="1389791">Buffer</span><span class="op" id="1389797">)</span>&nbsp;<span class="ident" id="1389799">UnreadRune</span><span class="op" id="1389809">(</span><span class="op" id="1389810">)</span>&nbsp;<span class="builtintype" id="1389812">error</span>&nbsp;<span class="op" id="1389818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1389821">if</span>&nbsp;<span class="ident" id="1389824">b</span><span class="op" id="1389825">.</span><span class="ident" id="1389826">lastRead</span>&nbsp;<span class="op" id="1389835">!=</span>&nbsp;<span class="ident" id="1389838">opReadRune</span>&nbsp;<span class="op" id="1389849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1389853">return</span>&nbsp;<span class="ident" id="1389860">errors</span><span class="op" id="1389866">.</span><span class="ident" id="1389867">New</span><span class="op" id="1389870">(</span><span class="string" id="1389871">&#34;bytes.Buffer:&nbsp;UnreadRune:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;ReadRune&#34;</span><span class="op" id="1389934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1389937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1389940">b</span><span class="op" id="1389941">.</span><span class="ident" id="1389942">lastRead</span>&nbsp;<span class="op" id="1389951">=</span>&nbsp;<span class="ident" id="1389953">opInvalid</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1389964">if</span>&nbsp;<span class="ident" id="1389967">b</span><span class="op" id="1389968">.</span><span class="ident" id="1389969">off</span>&nbsp;<span class="op" id="1389973">&gt;</span>&nbsp;<span class="num" id="1389975">0</span>&nbsp;<span class="op" id="1389977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1389981">_</span><span class="op" id="1389982">,</span>&nbsp;<span class="ident" id="1389984">n</span>&nbsp;<span class="op" id="1389986">:=</span>&nbsp;<span class="ident" id="1389989">utf8</span><span class="op" id="1389993">.</span><span class="ident" id="1389994">DecodeLastRune</span><span class="op" id="1390008">(</span><span class="ident" id="1390009">b</span><span class="op" id="1390010">.</span><span class="ident" id="1390011">buf</span><span class="op" id="1390014">[</span><span class="num" id="1390015">0</span><span class="op" id="1390016">:</span><span class="ident" id="1390017">b</span><span class="op" id="1390018">.</span><span class="ident" id="1390019">off</span><span class="op" id="1390022">]</span><span class="op" id="1390023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390027">b</span><span class="op" id="1390028">.</span><span class="ident" id="1390029">off</span>&nbsp;<span class="op" id="1390033">-=</span>&nbsp;<span class="ident" id="1390036">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1390039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1390042">return</span>&nbsp;<span class="ident" id="1390049">nil</span><br>
<span class="lineno">340</span><span class="op" id="1390053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1390056">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte&nbsp;returned&nbsp;by&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span><span class="comment" id="1390120">//&nbsp;read&nbsp;operation.&nbsp;&nbsp;If&nbsp;write&nbsp;has&nbsp;happened&nbsp;since&nbsp;the&nbsp;last&nbsp;read,&nbsp;UnreadByte</span><br>
<span class="lineno"></span><span class="comment" id="1390194">//&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">345</span><span class="keyword" id="1390215">func</span>&nbsp;<span class="op" id="1390220">(</span><span class="ident" id="1390221">b</span>&nbsp;<span class="op" id="1390223">*</span><span class="ident" id="1390224">Buffer</span><span class="op" id="1390230">)</span>&nbsp;<span class="ident" id="1390232">UnreadByte</span><span class="op" id="1390242">(</span><span class="op" id="1390243">)</span>&nbsp;<span class="builtintype" id="1390245">error</span>&nbsp;<span class="op" id="1390251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1390254">if</span>&nbsp;<span class="ident" id="1390257">b</span><span class="op" id="1390258">.</span><span class="ident" id="1390259">lastRead</span>&nbsp;<span class="op" id="1390268">!=</span>&nbsp;<span class="ident" id="1390271">opReadRune</span>&nbsp;<span class="op" id="1390282">&amp;&amp;</span>&nbsp;<span class="ident" id="1390285">b</span><span class="op" id="1390286">.</span><span class="ident" id="1390287">lastRead</span>&nbsp;<span class="op" id="1390296">!=</span>&nbsp;<span class="ident" id="1390299">opRead</span>&nbsp;<span class="op" id="1390306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1390310">return</span>&nbsp;<span class="ident" id="1390317">errors</span><span class="op" id="1390323">.</span><span class="ident" id="1390324">New</span><span class="op" id="1390327">(</span><span class="string" id="1390328">&#34;bytes.Buffer:&nbsp;UnreadByte:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;a&nbsp;read&#34;</span><span class="op" id="1390389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1390392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390395">b</span><span class="op" id="1390396">.</span><span class="ident" id="1390397">lastRead</span>&nbsp;<span class="op" id="1390406">=</span>&nbsp;<span class="ident" id="1390408">opInvalid</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1390419">if</span>&nbsp;<span class="ident" id="1390422">b</span><span class="op" id="1390423">.</span><span class="ident" id="1390424">off</span>&nbsp;<span class="op" id="1390428">&gt;</span>&nbsp;<span class="num" id="1390430">0</span>&nbsp;<span class="op" id="1390432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390436">b</span><span class="op" id="1390437">.</span><span class="ident" id="1390438">off</span><span class="op" id="1390441">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1390445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1390448">return</span>&nbsp;<span class="ident" id="1390455">nil</span><br>
<span class="lineno"></span><span class="op" id="1390459">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="1390462">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="1390531">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1390607">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1390671">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">360</span><span class="comment" id="1390753">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1390834">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="keyword" id="1390844">func</span>&nbsp;<span class="op" id="1390849">(</span><span class="ident" id="1390850">b</span>&nbsp;<span class="op" id="1390852">*</span><span class="ident" id="1390853">Buffer</span><span class="op" id="1390859">)</span>&nbsp;<span class="ident" id="1390861">ReadBytes</span><span class="op" id="1390870">(</span><span class="ident" id="1390871">delim</span>&nbsp;<span class="builtintype" id="1390877">byte</span><span class="op" id="1390881">)</span>&nbsp;<span class="op" id="1390883">(</span><span class="ident" id="1390884">line</span>&nbsp;<span class="op" id="1390889">[</span><span class="op" id="1390890">]</span><span class="builtintype" id="1390891">byte</span><span class="op" id="1390895">,</span>&nbsp;<span class="ident" id="1390897">err</span>&nbsp;<span class="builtintype" id="1390901">error</span><span class="op" id="1390906">)</span>&nbsp;<span class="op" id="1390908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390911">slice</span><span class="op" id="1390916">,</span>&nbsp;<span class="ident" id="1390918">err</span>&nbsp;<span class="op" id="1390922">:=</span>&nbsp;<span class="ident" id="1390925">b</span><span class="op" id="1390926">.</span><span class="ident" id="1390927">readSlice</span><span class="op" id="1390936">(</span><span class="ident" id="1390937">delim</span><span class="op" id="1390942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390945">//&nbsp;return&nbsp;a&nbsp;copy&nbsp;of&nbsp;slice.&nbsp;The&nbsp;buffer&#39;s&nbsp;backing&nbsp;array&nbsp;may</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1391004">//&nbsp;be&nbsp;overwritten&nbsp;by&nbsp;later&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391039">line</span>&nbsp;<span class="op" id="1391044">=</span>&nbsp;<span class="builtinfunc" id="1391046">append</span><span class="op" id="1391052">(</span><span class="ident" id="1391053">line</span><span class="op" id="1391057">,</span>&nbsp;<span class="ident" id="1391059">slice</span><span class="op" id="1391064">...</span><span class="op" id="1391067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391070">return</span><br>
<span class="lineno"></span><span class="op" id="1391077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="comment" id="1391080">//&nbsp;readSlice&nbsp;is&nbsp;like&nbsp;ReadBytes&nbsp;but&nbsp;returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;internal&nbsp;buffer&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1391160">func</span>&nbsp;<span class="op" id="1391165">(</span><span class="ident" id="1391166">b</span>&nbsp;<span class="op" id="1391168">*</span><span class="ident" id="1391169">Buffer</span><span class="op" id="1391175">)</span>&nbsp;<span class="ident" id="1391177">readSlice</span><span class="op" id="1391186">(</span><span class="ident" id="1391187">delim</span>&nbsp;<span class="builtintype" id="1391193">byte</span><span class="op" id="1391197">)</span>&nbsp;<span class="op" id="1391199">(</span><span class="ident" id="1391200">line</span>&nbsp;<span class="op" id="1391205">[</span><span class="op" id="1391206">]</span><span class="builtintype" id="1391207">byte</span><span class="op" id="1391211">,</span>&nbsp;<span class="ident" id="1391213">err</span>&nbsp;<span class="builtintype" id="1391217">error</span><span class="op" id="1391222">)</span>&nbsp;<span class="op" id="1391224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391227">i</span>&nbsp;<span class="op" id="1391229">:=</span>&nbsp;<span class="ident" id="1391232">IndexByte</span><span class="op" id="1391241">(</span><span class="ident" id="1391242">b</span><span class="op" id="1391243">.</span><span class="ident" id="1391244">buf</span><span class="op" id="1391247">[</span><span class="ident" id="1391248">b</span><span class="op" id="1391249">.</span><span class="ident" id="1391250">off</span><span class="op" id="1391253">:</span><span class="op" id="1391254">]</span><span class="op" id="1391255">,</span>&nbsp;<span class="ident" id="1391257">delim</span><span class="op" id="1391262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391265">end</span>&nbsp;<span class="op" id="1391269">:=</span>&nbsp;<span class="ident" id="1391272">b</span><span class="op" id="1391273">.</span><span class="ident" id="1391274">off</span>&nbsp;<span class="op" id="1391278">+</span>&nbsp;<span class="ident" id="1391280">i</span>&nbsp;<span class="op" id="1391282">+</span>&nbsp;<span class="num" id="1391284">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391287">if</span>&nbsp;<span class="ident" id="1391290">i</span>&nbsp;<span class="op" id="1391292">&lt;</span>&nbsp;<span class="num" id="1391294">0</span>&nbsp;<span class="op" id="1391296">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391300">end</span>&nbsp;<span class="op" id="1391304">=</span>&nbsp;<span class="builtinfunc" id="1391306">len</span><span class="op" id="1391309">(</span><span class="ident" id="1391310">b</span><span class="op" id="1391311">.</span><span class="ident" id="1391312">buf</span><span class="op" id="1391315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391319">err</span>&nbsp;<span class="op" id="1391323">=</span>&nbsp;<span class="ident" id="1391325">io</span><span class="op" id="1391327">.</span><span class="ident" id="1391328">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1391333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391336">line</span>&nbsp;<span class="op" id="1391341">=</span>&nbsp;<span class="ident" id="1391343">b</span><span class="op" id="1391344">.</span><span class="ident" id="1391345">buf</span><span class="op" id="1391348">[</span><span class="ident" id="1391349">b</span><span class="op" id="1391350">.</span><span class="ident" id="1391351">off</span><span class="op" id="1391354">:</span><span class="ident" id="1391355">end</span><span class="op" id="1391358">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391361">b</span><span class="op" id="1391362">.</span><span class="ident" id="1391363">off</span>&nbsp;<span class="op" id="1391367">=</span>&nbsp;<span class="ident" id="1391369">end</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391374">b</span><span class="op" id="1391375">.</span><span class="ident" id="1391376">lastRead</span>&nbsp;<span class="op" id="1391385">=</span>&nbsp;<span class="ident" id="1391387">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391395">return</span>&nbsp;<span class="ident" id="1391402">line</span><span class="op" id="1391406">,</span>&nbsp;<span class="ident" id="1391408">err</span><br>
<span class="lineno"></span><span class="op" id="1391412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1391415">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno">385</span><span class="comment" id="1391485">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1391562">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1391627">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="1391709">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="1391788">//&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">390</span><span class="keyword" id="1391801">func</span>&nbsp;<span class="op" id="1391806">(</span><span class="ident" id="1391807">b</span>&nbsp;<span class="op" id="1391809">*</span><span class="ident" id="1391810">Buffer</span><span class="op" id="1391816">)</span>&nbsp;<span class="ident" id="1391818">ReadString</span><span class="op" id="1391828">(</span><span class="ident" id="1391829">delim</span>&nbsp;<span class="builtintype" id="1391835">byte</span><span class="op" id="1391839">)</span>&nbsp;<span class="op" id="1391841">(</span><span class="ident" id="1391842">line</span>&nbsp;<span class="builtintype" id="1391847">string</span><span class="op" id="1391853">,</span>&nbsp;<span class="ident" id="1391855">err</span>&nbsp;<span class="builtintype" id="1391859">error</span><span class="op" id="1391864">)</span>&nbsp;<span class="op" id="1391866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391869">slice</span><span class="op" id="1391874">,</span>&nbsp;<span class="ident" id="1391876">err</span>&nbsp;<span class="op" id="1391880">:=</span>&nbsp;<span class="ident" id="1391883">b</span><span class="op" id="1391884">.</span><span class="ident" id="1391885">readSlice</span><span class="op" id="1391894">(</span><span class="ident" id="1391895">delim</span><span class="op" id="1391900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391903">return</span>&nbsp;<span class="builtintype" id="1391910">string</span><span class="op" id="1391916">(</span><span class="ident" id="1391917">slice</span><span class="op" id="1391922">)</span><span class="op" id="1391923">,</span>&nbsp;<span class="ident" id="1391925">err</span><br>
<span class="lineno"></span><span class="op" id="1391929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="comment" id="1391932">//&nbsp;NewBuffer&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;buf&nbsp;as&nbsp;its&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="1392007">//&nbsp;contents.&nbsp;&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;Buffer&nbsp;to&nbsp;read&nbsp;existing&nbsp;data.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="1392083">//&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;size&nbsp;the&nbsp;internal&nbsp;buffer&nbsp;for&nbsp;writing.&nbsp;To&nbsp;do&nbsp;that,</span><br>
<span class="lineno"></span><span class="comment" id="1392156">//&nbsp;buf&nbsp;should&nbsp;have&nbsp;the&nbsp;desired&nbsp;capacity&nbsp;but&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="1392218">//</span><br>
<span class="lineno">400</span><span class="comment" id="1392221">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1392292">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1392330">func</span>&nbsp;<span class="ident" id="1392335">NewBuffer</span><span class="op" id="1392344">(</span><span class="ident" id="1392345">buf</span>&nbsp;<span class="op" id="1392349">[</span><span class="op" id="1392350">]</span><span class="builtintype" id="1392351">byte</span><span class="op" id="1392355">)</span>&nbsp;<span class="op" id="1392357">*</span><span class="ident" id="1392358">Buffer</span>&nbsp;<span class="op" id="1392365">{</span>&nbsp;<span class="keyword" id="1392367">return</span>&nbsp;<span class="op" id="1392374">&amp;</span><span class="ident" id="1392375">Buffer</span><span class="op" id="1392381">{</span><span class="ident" id="1392382">buf</span><span class="op" id="1392385">:</span>&nbsp;<span class="ident" id="1392387">buf</span><span class="op" id="1392390">}</span>&nbsp;<span class="op" id="1392392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1392395">//&nbsp;NewBufferString&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;string&nbsp;s&nbsp;as&nbsp;its</span><br>
<span class="lineno">405</span><span class="comment" id="1392473">//&nbsp;initial&nbsp;contents.&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;buffer&nbsp;to&nbsp;read&nbsp;an&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="1392549">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1392560">//</span><br>
<span class="lineno"></span><span class="comment" id="1392563">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1392634">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno">410</span><span class="keyword" id="1392672">func</span>&nbsp;<span class="ident" id="1392677">NewBufferString</span><span class="op" id="1392692">(</span><span class="ident" id="1392693">s</span>&nbsp;<span class="builtintype" id="1392695">string</span><span class="op" id="1392701">)</span>&nbsp;<span class="op" id="1392703">*</span><span class="ident" id="1392704">Buffer</span>&nbsp;<span class="op" id="1392711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392714">return</span>&nbsp;<span class="op" id="1392721">&amp;</span><span class="ident" id="1392722">Buffer</span><span class="op" id="1392728">{</span><span class="ident" id="1392729">buf</span><span class="op" id="1392732">:</span>&nbsp;<span class="op" id="1392734">[</span><span class="op" id="1392735">]</span><span class="builtintype" id="1392736">byte</span><span class="op" id="1392740">(</span><span class="ident" id="1392741">s</span><span class="op" id="1392742">)</span><span class="op" id="1392743">}</span><br>
<span class="lineno"></span><span class="op" id="1392745">}</span>
</div>
</body>
</html>
