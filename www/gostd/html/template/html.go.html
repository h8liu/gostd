<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html" class="current">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5074328">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5074383">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5074437">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5074488">package</span>&nbsp;<span class="ident" id="5074496">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5074506">import</span>&nbsp;<span class="op" id="5074513">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5074516">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5074525">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5074532">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5074543">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5074558">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5074561">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="5074635">func</span>&nbsp;<span class="ident" id="5074640">htmlNospaceEscaper</span><span class="op" id="5074658">(</span><span class="ident" id="5074659">args</span>&nbsp;<span class="op" id="5074664">...</span><span class="keyword" id="5074667">interface</span><span class="op" id="5074676">{</span><span class="op" id="5074677">}</span><span class="op" id="5074678">)</span>&nbsp;<span class="builtintype" id="5074680">string</span>&nbsp;<span class="op" id="5074687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074690">s</span><span class="op" id="5074691">,</span>&nbsp;<span class="ident" id="5074693">t</span>&nbsp;<span class="op" id="5074695">:=</span>&nbsp;<span class="ident" id="5074698">stringify</span><span class="op" id="5074707">(</span><span class="ident" id="5074708">args</span><span class="op" id="5074712">...</span><span class="op" id="5074715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074718">if</span>&nbsp;<span class="ident" id="5074721">t</span>&nbsp;<span class="op" id="5074723">==</span>&nbsp;<span class="ident" id="5074726">contentTypeHTML</span>&nbsp;<span class="op" id="5074742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074746">return</span>&nbsp;<span class="ident" id="5074753">htmlReplacer</span><span class="op" id="5074765">(</span><span class="ident" id="5074766">stripTags</span><span class="op" id="5074775">(</span><span class="ident" id="5074776">s</span><span class="op" id="5074777">)</span><span class="op" id="5074778">,</span>&nbsp;<span class="ident" id="5074780">htmlNospaceNormReplacementTable</span><span class="op" id="5074811">,</span>&nbsp;<span class="builtintype" id="5074813">false</span><span class="op" id="5074818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074821">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074824">return</span>&nbsp;<span class="ident" id="5074831">htmlReplacer</span><span class="op" id="5074843">(</span><span class="ident" id="5074844">s</span><span class="op" id="5074845">,</span>&nbsp;<span class="ident" id="5074847">htmlNospaceReplacementTable</span><span class="op" id="5074874">,</span>&nbsp;<span class="builtintype" id="5074876">false</span><span class="op" id="5074881">)</span><br>
<span class="lineno"></span><span class="op" id="5074883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5074886">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5074951">func</span>&nbsp;<span class="ident" id="5074956">attrEscaper</span><span class="op" id="5074967">(</span><span class="ident" id="5074968">args</span>&nbsp;<span class="op" id="5074973">...</span><span class="keyword" id="5074976">interface</span><span class="op" id="5074985">{</span><span class="op" id="5074986">}</span><span class="op" id="5074987">)</span>&nbsp;<span class="builtintype" id="5074989">string</span>&nbsp;<span class="op" id="5074996">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074999">s</span><span class="op" id="5075000">,</span>&nbsp;<span class="ident" id="5075002">t</span>&nbsp;<span class="op" id="5075004">:=</span>&nbsp;<span class="ident" id="5075007">stringify</span><span class="op" id="5075016">(</span><span class="ident" id="5075017">args</span><span class="op" id="5075021">...</span><span class="op" id="5075024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075027">if</span>&nbsp;<span class="ident" id="5075030">t</span>&nbsp;<span class="op" id="5075032">==</span>&nbsp;<span class="ident" id="5075035">contentTypeHTML</span>&nbsp;<span class="op" id="5075051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075055">return</span>&nbsp;<span class="ident" id="5075062">htmlReplacer</span><span class="op" id="5075074">(</span><span class="ident" id="5075075">stripTags</span><span class="op" id="5075084">(</span><span class="ident" id="5075085">s</span><span class="op" id="5075086">)</span><span class="op" id="5075087">,</span>&nbsp;<span class="ident" id="5075089">htmlNormReplacementTable</span><span class="op" id="5075113">,</span>&nbsp;<span class="builtintype" id="5075115">true</span><span class="op" id="5075119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075125">return</span>&nbsp;<span class="ident" id="5075132">htmlReplacer</span><span class="op" id="5075144">(</span><span class="ident" id="5075145">s</span><span class="op" id="5075146">,</span>&nbsp;<span class="ident" id="5075148">htmlReplacementTable</span><span class="op" id="5075168">,</span>&nbsp;<span class="builtintype" id="5075170">true</span><span class="op" id="5075174">)</span><br>
<span class="lineno">30</span><span class="op" id="5075176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5075179">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="5075245">func</span>&nbsp;<span class="ident" id="5075250">rcdataEscaper</span><span class="op" id="5075263">(</span><span class="ident" id="5075264">args</span>&nbsp;<span class="op" id="5075269">...</span><span class="keyword" id="5075272">interface</span><span class="op" id="5075281">{</span><span class="op" id="5075282">}</span><span class="op" id="5075283">)</span>&nbsp;<span class="builtintype" id="5075285">string</span>&nbsp;<span class="op" id="5075292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075295">s</span><span class="op" id="5075296">,</span>&nbsp;<span class="ident" id="5075298">t</span>&nbsp;<span class="op" id="5075300">:=</span>&nbsp;<span class="ident" id="5075303">stringify</span><span class="op" id="5075312">(</span><span class="ident" id="5075313">args</span><span class="op" id="5075317">...</span><span class="op" id="5075320">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075323">if</span>&nbsp;<span class="ident" id="5075326">t</span>&nbsp;<span class="op" id="5075328">==</span>&nbsp;<span class="ident" id="5075331">contentTypeHTML</span>&nbsp;<span class="op" id="5075347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075351">return</span>&nbsp;<span class="ident" id="5075358">htmlReplacer</span><span class="op" id="5075370">(</span><span class="ident" id="5075371">s</span><span class="op" id="5075372">,</span>&nbsp;<span class="ident" id="5075374">htmlNormReplacementTable</span><span class="op" id="5075398">,</span>&nbsp;<span class="builtintype" id="5075400">true</span><span class="op" id="5075404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075410">return</span>&nbsp;<span class="ident" id="5075417">htmlReplacer</span><span class="op" id="5075429">(</span><span class="ident" id="5075430">s</span><span class="op" id="5075431">,</span>&nbsp;<span class="ident" id="5075433">htmlReplacementTable</span><span class="op" id="5075453">,</span>&nbsp;<span class="builtintype" id="5075455">true</span><span class="op" id="5075459">)</span><br>
<span class="lineno"></span><span class="op" id="5075461">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="5075464">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5075515">func</span>&nbsp;<span class="ident" id="5075520">htmlEscaper</span><span class="op" id="5075531">(</span><span class="ident" id="5075532">args</span>&nbsp;<span class="op" id="5075537">...</span><span class="keyword" id="5075540">interface</span><span class="op" id="5075549">{</span><span class="op" id="5075550">}</span><span class="op" id="5075551">)</span>&nbsp;<span class="builtintype" id="5075553">string</span>&nbsp;<span class="op" id="5075560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075563">s</span><span class="op" id="5075564">,</span>&nbsp;<span class="ident" id="5075566">t</span>&nbsp;<span class="op" id="5075568">:=</span>&nbsp;<span class="ident" id="5075571">stringify</span><span class="op" id="5075580">(</span><span class="ident" id="5075581">args</span><span class="op" id="5075585">...</span><span class="op" id="5075588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075591">if</span>&nbsp;<span class="ident" id="5075594">t</span>&nbsp;<span class="op" id="5075596">==</span>&nbsp;<span class="ident" id="5075599">contentTypeHTML</span>&nbsp;<span class="op" id="5075615">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075619">return</span>&nbsp;<span class="ident" id="5075626">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075632">return</span>&nbsp;<span class="ident" id="5075639">htmlReplacer</span><span class="op" id="5075651">(</span><span class="ident" id="5075652">s</span><span class="op" id="5075653">,</span>&nbsp;<span class="ident" id="5075655">htmlReplacementTable</span><span class="op" id="5075675">,</span>&nbsp;<span class="builtintype" id="5075677">true</span><span class="op" id="5075681">)</span><br>
<span class="lineno"></span><span class="op" id="5075683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5075686">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="5075753">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5075807">var</span>&nbsp;<span class="ident" id="5075811">htmlReplacementTable</span>&nbsp;<span class="op" id="5075832">=</span>&nbsp;<span class="op" id="5075834">[</span><span class="op" id="5075835">]</span><span class="builtintype" id="5075836">string</span><span class="op" id="5075842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5075845">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5075921">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5075978">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5076036">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5076042">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5076060">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5076132">0</span><span class="op" id="5076133">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5076138">&#34;\uFFFD&#34;</span><span class="op" id="5076146">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076149">&#39;&#34;&#39;</span><span class="op" id="5076152">:</span>&nbsp;&nbsp;<span class="string" id="5076155">&#34;&amp;#34;&#34;</span><span class="op" id="5076162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076165">&#39;&amp;&#39;</span><span class="op" id="5076168">:</span>&nbsp;&nbsp;<span class="string" id="5076171">&#34;&amp;amp;&#34;</span><span class="op" id="5076178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076181">&#39;\&#39;&#39;</span><span class="op" id="5076185">:</span>&nbsp;<span class="string" id="5076187">&#34;&amp;#39;&#34;</span><span class="op" id="5076194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076197">&#39;+&#39;</span><span class="op" id="5076200">:</span>&nbsp;&nbsp;<span class="string" id="5076203">&#34;&amp;#43;&#34;</span><span class="op" id="5076210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076213">&#39;&lt;&#39;</span><span class="op" id="5076216">:</span>&nbsp;&nbsp;<span class="string" id="5076219">&#34;&amp;lt;&#34;</span><span class="op" id="5076225">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076228">&#39;&gt;&#39;</span><span class="op" id="5076231">:</span>&nbsp;&nbsp;<span class="string" id="5076234">&#34;&amp;gt;&#34;</span><span class="op" id="5076240">,</span><br>
<span class="lineno"></span><span class="op" id="5076242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5076245">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5076321">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="5076363">var</span>&nbsp;<span class="ident" id="5076367">htmlNormReplacementTable</span>&nbsp;<span class="op" id="5076392">=</span>&nbsp;<span class="op" id="5076394">[</span><span class="op" id="5076395">]</span><span class="builtintype" id="5076396">string</span><span class="op" id="5076402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5076405">0</span><span class="op" id="5076406">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5076411">&#34;\uFFFD&#34;</span><span class="op" id="5076419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076422">&#39;&#34;&#39;</span><span class="op" id="5076425">:</span>&nbsp;&nbsp;<span class="string" id="5076428">&#34;&amp;#34;&#34;</span><span class="op" id="5076435">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076438">&#39;\&#39;&#39;</span><span class="op" id="5076442">:</span>&nbsp;<span class="string" id="5076444">&#34;&amp;#39;&#34;</span><span class="op" id="5076451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076454">&#39;+&#39;</span><span class="op" id="5076457">:</span>&nbsp;&nbsp;<span class="string" id="5076460">&#34;&amp;#43;&#34;</span><span class="op" id="5076467">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076470">&#39;&lt;&#39;</span><span class="op" id="5076473">:</span>&nbsp;&nbsp;<span class="string" id="5076476">&#34;&amp;lt;&#34;</span><span class="op" id="5076482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076485">&#39;&gt;&#39;</span><span class="op" id="5076488">:</span>&nbsp;&nbsp;<span class="string" id="5076491">&#34;&amp;gt;&#34;</span><span class="op" id="5076497">,</span><br>
<span class="lineno"></span><span class="op" id="5076499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5076502">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="5076576">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5076615">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5076681">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="5076738">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="5076758">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="5076784">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="5076842">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5076877">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="5076910">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5076972">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="5077016">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5077085">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5077090">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="5077123">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="5077140">var</span>&nbsp;<span class="ident" id="5077144">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="5077172">=</span>&nbsp;<span class="op" id="5077174">[</span><span class="op" id="5077175">]</span><span class="builtintype" id="5077176">string</span><span class="op" id="5077182">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5077185">0</span><span class="op" id="5077186">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5077191">&#34;&amp;#xfffd;&#34;</span><span class="op" id="5077201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077204">&#39;\t&#39;</span><span class="op" id="5077208">:</span>&nbsp;<span class="string" id="5077210">&#34;&amp;#9;&#34;</span><span class="op" id="5077216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077219">&#39;\n&#39;</span><span class="op" id="5077223">:</span>&nbsp;<span class="string" id="5077225">&#34;&amp;#10;&#34;</span><span class="op" id="5077232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077235">&#39;\v&#39;</span><span class="op" id="5077239">:</span>&nbsp;<span class="string" id="5077241">&#34;&amp;#11;&#34;</span><span class="op" id="5077248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077251">&#39;\f&#39;</span><span class="op" id="5077255">:</span>&nbsp;<span class="string" id="5077257">&#34;&amp;#12;&#34;</span><span class="op" id="5077264">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077267">&#39;\r&#39;</span><span class="op" id="5077271">:</span>&nbsp;<span class="string" id="5077273">&#34;&amp;#13;&#34;</span><span class="op" id="5077280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077283">&#39;&nbsp;&#39;</span><span class="op" id="5077286">:</span>&nbsp;&nbsp;<span class="string" id="5077289">&#34;&amp;#32;&#34;</span><span class="op" id="5077296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077299">&#39;&#34;&#39;</span><span class="op" id="5077302">:</span>&nbsp;&nbsp;<span class="string" id="5077305">&#34;&amp;#34;&#34;</span><span class="op" id="5077312">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077315">&#39;&amp;&#39;</span><span class="op" id="5077318">:</span>&nbsp;&nbsp;<span class="string" id="5077321">&#34;&amp;amp;&#34;</span><span class="op" id="5077328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077331">&#39;\&#39;&#39;</span><span class="op" id="5077335">:</span>&nbsp;<span class="string" id="5077337">&#34;&amp;#39;&#34;</span><span class="op" id="5077344">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077347">&#39;+&#39;</span><span class="op" id="5077350">:</span>&nbsp;&nbsp;<span class="string" id="5077353">&#34;&amp;#43;&#34;</span><span class="op" id="5077360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077363">&#39;&lt;&#39;</span><span class="op" id="5077366">:</span>&nbsp;&nbsp;<span class="string" id="5077369">&#34;&amp;lt;&#34;</span><span class="op" id="5077375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077378">&#39;=&#39;</span><span class="op" id="5077381">:</span>&nbsp;&nbsp;<span class="string" id="5077384">&#34;&amp;#61;&#34;</span><span class="op" id="5077391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077394">&#39;&gt;&#39;</span><span class="op" id="5077397">:</span>&nbsp;&nbsp;<span class="string" id="5077400">&#34;&amp;gt;&#34;</span><span class="op" id="5077406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5077409">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5077465">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5077500">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077542">&#39;`&#39;</span><span class="op" id="5077545">:</span>&nbsp;<span class="string" id="5077547">&#34;&amp;#96;&#34;</span><span class="op" id="5077554">,</span><br>
<span class="lineno"></span><span class="op" id="5077556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5077559">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="5077634">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="5077691">var</span>&nbsp;<span class="ident" id="5077695">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="5077727">=</span>&nbsp;<span class="op" id="5077729">[</span><span class="op" id="5077730">]</span><span class="builtintype" id="5077731">string</span><span class="op" id="5077737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5077740">0</span><span class="op" id="5077741">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5077746">&#34;&amp;#xfffd;&#34;</span><span class="op" id="5077756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077759">&#39;\t&#39;</span><span class="op" id="5077763">:</span>&nbsp;<span class="string" id="5077765">&#34;&amp;#9;&#34;</span><span class="op" id="5077771">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077774">&#39;\n&#39;</span><span class="op" id="5077778">:</span>&nbsp;<span class="string" id="5077780">&#34;&amp;#10;&#34;</span><span class="op" id="5077787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077790">&#39;\v&#39;</span><span class="op" id="5077794">:</span>&nbsp;<span class="string" id="5077796">&#34;&amp;#11;&#34;</span><span class="op" id="5077803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077806">&#39;\f&#39;</span><span class="op" id="5077810">:</span>&nbsp;<span class="string" id="5077812">&#34;&amp;#12;&#34;</span><span class="op" id="5077819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077822">&#39;\r&#39;</span><span class="op" id="5077826">:</span>&nbsp;<span class="string" id="5077828">&#34;&amp;#13;&#34;</span><span class="op" id="5077835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077838">&#39;&nbsp;&#39;</span><span class="op" id="5077841">:</span>&nbsp;&nbsp;<span class="string" id="5077844">&#34;&amp;#32;&#34;</span><span class="op" id="5077851">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077854">&#39;&#34;&#39;</span><span class="op" id="5077857">:</span>&nbsp;&nbsp;<span class="string" id="5077860">&#34;&amp;#34;&#34;</span><span class="op" id="5077867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077870">&#39;\&#39;&#39;</span><span class="op" id="5077874">:</span>&nbsp;<span class="string" id="5077876">&#34;&amp;#39;&#34;</span><span class="op" id="5077883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077886">&#39;+&#39;</span><span class="op" id="5077889">:</span>&nbsp;&nbsp;<span class="string" id="5077892">&#34;&amp;#43;&#34;</span><span class="op" id="5077899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077902">&#39;&lt;&#39;</span><span class="op" id="5077905">:</span>&nbsp;&nbsp;<span class="string" id="5077908">&#34;&amp;lt;&#34;</span><span class="op" id="5077914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077917">&#39;=&#39;</span><span class="op" id="5077920">:</span>&nbsp;&nbsp;<span class="string" id="5077923">&#34;&amp;#61;&#34;</span><span class="op" id="5077930">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5077933">&#39;&gt;&#39;</span><span class="op" id="5077936">:</span>&nbsp;&nbsp;<span class="string" id="5077939">&#34;&amp;gt;&#34;</span><span class="op" id="5077945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5077948">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078004">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078039">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5078081">&#39;`&#39;</span><span class="op" id="5078084">:</span>&nbsp;<span class="string" id="5078086">&#34;&amp;#96;&#34;</span><span class="op" id="5078093">,</span><br>
<span class="lineno">135</span><span class="op" id="5078095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5078098">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="5078174">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="5078253">func</span>&nbsp;<span class="ident" id="5078258">htmlReplacer</span><span class="op" id="5078270">(</span><span class="ident" id="5078271">s</span>&nbsp;<span class="builtintype" id="5078273">string</span><span class="op" id="5078279">,</span>&nbsp;<span class="ident" id="5078281">replacementTable</span>&nbsp;<span class="op" id="5078298">[</span><span class="op" id="5078299">]</span><span class="builtintype" id="5078300">string</span><span class="op" id="5078306">,</span>&nbsp;<span class="ident" id="5078308">badRunes</span>&nbsp;<span class="builtintype" id="5078317">bool</span><span class="op" id="5078321">)</span>&nbsp;<span class="builtintype" id="5078323">string</span>&nbsp;<span class="op" id="5078330">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078333">written</span><span class="op" id="5078340">,</span>&nbsp;<span class="ident" id="5078342">b</span>&nbsp;<span class="op" id="5078344">:=</span>&nbsp;<span class="num" id="5078347">0</span><span class="op" id="5078348">,</span>&nbsp;<span class="builtinfunc" id="5078350">new</span><span class="op" id="5078353">(</span><span class="ident" id="5078354">bytes</span><span class="op" id="5078359">.</span><span class="ident" id="5078360">Buffer</span><span class="op" id="5078366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078369">for</span>&nbsp;<span class="ident" id="5078373">i</span><span class="op" id="5078374">,</span>&nbsp;<span class="ident" id="5078376">r</span>&nbsp;<span class="op" id="5078378">:=</span>&nbsp;<span class="keyword" id="5078381">range</span>&nbsp;<span class="ident" id="5078387">s</span>&nbsp;<span class="op" id="5078389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078393">if</span>&nbsp;<span class="builtintype" id="5078396">int</span><span class="op" id="5078399">(</span><span class="ident" id="5078400">r</span><span class="op" id="5078401">)</span>&nbsp;<span class="op" id="5078403">&lt;</span>&nbsp;<span class="builtinfunc" id="5078405">len</span><span class="op" id="5078408">(</span><span class="ident" id="5078409">replacementTable</span><span class="op" id="5078425">)</span>&nbsp;<span class="op" id="5078427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078432">if</span>&nbsp;<span class="ident" id="5078435">repl</span>&nbsp;<span class="op" id="5078440">:=</span>&nbsp;<span class="ident" id="5078443">replacementTable</span><span class="op" id="5078459">[</span><span class="ident" id="5078460">r</span><span class="op" id="5078461">]</span><span class="op" id="5078462">;</span>&nbsp;<span class="builtinfunc" id="5078464">len</span><span class="op" id="5078467">(</span><span class="ident" id="5078468">repl</span><span class="op" id="5078472">)</span>&nbsp;<span class="op" id="5078474">!=</span>&nbsp;<span class="num" id="5078477">0</span>&nbsp;<span class="op" id="5078479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078485">b</span><span class="op" id="5078486">.</span><span class="ident" id="5078487">WriteString</span><span class="op" id="5078498">(</span><span class="ident" id="5078499">s</span><span class="op" id="5078500">[</span><span class="ident" id="5078501">written</span><span class="op" id="5078508">:</span><span class="ident" id="5078509">i</span><span class="op" id="5078510">]</span><span class="op" id="5078511">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078517">b</span><span class="op" id="5078518">.</span><span class="ident" id="5078519">WriteString</span><span class="op" id="5078530">(</span><span class="ident" id="5078531">repl</span><span class="op" id="5078535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078541">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078590">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078626">written</span>&nbsp;<span class="op" id="5078634">=</span>&nbsp;<span class="ident" id="5078636">i</span>&nbsp;<span class="op" id="5078638">+</span>&nbsp;<span class="ident" id="5078640">utf8</span><span class="op" id="5078644">.</span><span class="ident" id="5078645">RuneLen</span><span class="op" id="5078652">(</span><span class="ident" id="5078653">r</span><span class="op" id="5078654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078659">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078663">}</span>&nbsp;<span class="keyword" id="5078665">else</span>&nbsp;<span class="keyword" id="5078670">if</span>&nbsp;<span class="ident" id="5078673">badRunes</span>&nbsp;<span class="op" id="5078682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078687">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078700">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078755">}</span>&nbsp;<span class="keyword" id="5078757">else</span>&nbsp;<span class="keyword" id="5078762">if</span>&nbsp;<span class="num" id="5078765">0xfdd0</span>&nbsp;<span class="op" id="5078772">&lt;=</span>&nbsp;<span class="ident" id="5078775">r</span>&nbsp;<span class="op" id="5078777">&amp;&amp;</span>&nbsp;<span class="ident" id="5078780">r</span>&nbsp;<span class="op" id="5078782">&lt;=</span>&nbsp;<span class="num" id="5078785">0xfdef</span>&nbsp;<span class="op" id="5078792">||</span>&nbsp;<span class="num" id="5078795">0xfff0</span>&nbsp;<span class="op" id="5078802">&lt;=</span>&nbsp;<span class="ident" id="5078805">r</span>&nbsp;<span class="op" id="5078807">&amp;&amp;</span>&nbsp;<span class="ident" id="5078810">r</span>&nbsp;<span class="op" id="5078812">&lt;=</span>&nbsp;<span class="num" id="5078815">0xffff</span>&nbsp;<span class="op" id="5078822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078827">fmt</span><span class="op" id="5078830">.</span><span class="ident" id="5078831">Fprintf</span><span class="op" id="5078838">(</span><span class="ident" id="5078839">b</span><span class="op" id="5078840">,</span>&nbsp;<span class="string" id="5078842">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="5078852">,</span>&nbsp;<span class="ident" id="5078854">s</span><span class="op" id="5078855">[</span><span class="ident" id="5078856">written</span><span class="op" id="5078863">:</span><span class="ident" id="5078864">i</span><span class="op" id="5078865">]</span><span class="op" id="5078866">,</span>&nbsp;<span class="ident" id="5078868">r</span><span class="op" id="5078869">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078874">written</span>&nbsp;<span class="op" id="5078882">=</span>&nbsp;<span class="ident" id="5078884">i</span>&nbsp;<span class="op" id="5078886">+</span>&nbsp;<span class="ident" id="5078888">utf8</span><span class="op" id="5078892">.</span><span class="ident" id="5078893">RuneLen</span><span class="op" id="5078900">(</span><span class="ident" id="5078901">r</span><span class="op" id="5078902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078912">if</span>&nbsp;<span class="ident" id="5078915">written</span>&nbsp;<span class="op" id="5078923">==</span>&nbsp;<span class="num" id="5078926">0</span>&nbsp;<span class="op" id="5078928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078932">return</span>&nbsp;<span class="ident" id="5078939">s</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078945">b</span><span class="op" id="5078946">.</span><span class="ident" id="5078947">WriteString</span><span class="op" id="5078958">(</span><span class="ident" id="5078959">s</span><span class="op" id="5078960">[</span><span class="ident" id="5078961">written</span><span class="op" id="5078968">:</span><span class="op" id="5078969">]</span><span class="op" id="5078970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078973">return</span>&nbsp;<span class="ident" id="5078980">b</span><span class="op" id="5078981">.</span><span class="ident" id="5078982">String</span><span class="op" id="5078988">(</span><span class="op" id="5078989">)</span><br>
<span class="lineno"></span><span class="op" id="5078991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5078994">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="5079066">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="5079141">func</span>&nbsp;<span class="ident" id="5079146">stripTags</span><span class="op" id="5079155">(</span><span class="ident" id="5079156">html</span>&nbsp;<span class="builtintype" id="5079161">string</span><span class="op" id="5079167">)</span>&nbsp;<span class="builtintype" id="5079169">string</span>&nbsp;<span class="op" id="5079176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079179">var</span>&nbsp;<span class="ident" id="5079183">b</span>&nbsp;<span class="ident" id="5079185">bytes</span><span class="op" id="5079190">.</span><span class="ident" id="5079191">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079199">s</span><span class="op" id="5079200">,</span>&nbsp;<span class="ident" id="5079202">c</span><span class="op" id="5079203">,</span>&nbsp;<span class="ident" id="5079205">i</span><span class="op" id="5079206">,</span>&nbsp;<span class="ident" id="5079208">allText</span>&nbsp;<span class="op" id="5079216">:=</span>&nbsp;<span class="op" id="5079219">[</span><span class="op" id="5079220">]</span><span class="builtintype" id="5079221">byte</span><span class="op" id="5079225">(</span><span class="ident" id="5079226">html</span><span class="op" id="5079230">)</span><span class="op" id="5079231">,</span>&nbsp;<span class="ident" id="5079233">context</span><span class="op" id="5079240">{</span><span class="op" id="5079241">}</span><span class="op" id="5079242">,</span>&nbsp;<span class="num" id="5079244">0</span><span class="op" id="5079245">,</span>&nbsp;<span class="builtintype" id="5079247">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079253">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079308">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079351">for</span>&nbsp;<span class="ident" id="5079355">i</span>&nbsp;<span class="op" id="5079357">!=</span>&nbsp;<span class="builtinfunc" id="5079360">len</span><span class="op" id="5079363">(</span><span class="ident" id="5079364">s</span><span class="op" id="5079365">)</span>&nbsp;<span class="op" id="5079367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079371">if</span>&nbsp;<span class="ident" id="5079374">c</span><span class="op" id="5079375">.</span><span class="ident" id="5079376">delim</span>&nbsp;<span class="op" id="5079382">==</span>&nbsp;<span class="ident" id="5079385">delimNone</span>&nbsp;<span class="op" id="5079395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079400">st</span>&nbsp;<span class="op" id="5079403">:=</span>&nbsp;<span class="ident" id="5079406">c</span><span class="op" id="5079407">.</span><span class="ident" id="5079408">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079417">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079476">if</span>&nbsp;<span class="ident" id="5079479">c</span><span class="op" id="5079480">.</span><span class="ident" id="5079481">element</span>&nbsp;<span class="op" id="5079489">!=</span>&nbsp;<span class="ident" id="5079492">elementNone</span>&nbsp;<span class="op" id="5079504">&amp;&amp;</span>&nbsp;<span class="op" id="5079507">!</span><span class="ident" id="5079508">isInTag</span><span class="op" id="5079515">(</span><span class="ident" id="5079516">st</span><span class="op" id="5079518">)</span>&nbsp;<span class="op" id="5079520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079526">st</span>&nbsp;<span class="op" id="5079529">=</span>&nbsp;<span class="ident" id="5079531">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079551">d</span><span class="op" id="5079552">,</span>&nbsp;<span class="ident" id="5079554">nread</span>&nbsp;<span class="op" id="5079560">:=</span>&nbsp;<span class="ident" id="5079563">transitionFunc</span><span class="op" id="5079577">[</span><span class="ident" id="5079578">st</span><span class="op" id="5079580">]</span><span class="op" id="5079581">(</span><span class="ident" id="5079582">c</span><span class="op" id="5079583">,</span>&nbsp;<span class="ident" id="5079585">s</span><span class="op" id="5079586">[</span><span class="ident" id="5079587">i</span><span class="op" id="5079588">:</span><span class="op" id="5079589">]</span><span class="op" id="5079590">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079595">i1</span>&nbsp;<span class="op" id="5079598">:=</span>&nbsp;<span class="ident" id="5079601">i</span>&nbsp;<span class="op" id="5079603">+</span>&nbsp;<span class="ident" id="5079605">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079614">if</span>&nbsp;<span class="ident" id="5079617">c</span><span class="op" id="5079618">.</span><span class="ident" id="5079619">state</span>&nbsp;<span class="op" id="5079625">==</span>&nbsp;<span class="ident" id="5079628">stateText</span>&nbsp;<span class="op" id="5079638">||</span>&nbsp;<span class="ident" id="5079641">c</span><span class="op" id="5079642">.</span><span class="ident" id="5079643">state</span>&nbsp;<span class="op" id="5079649">==</span>&nbsp;<span class="ident" id="5079652">stateRCDATA</span>&nbsp;<span class="op" id="5079664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079670">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079726">j</span>&nbsp;<span class="op" id="5079728">:=</span>&nbsp;<span class="ident" id="5079731">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079738">if</span>&nbsp;<span class="ident" id="5079741">d</span><span class="op" id="5079742">.</span><span class="ident" id="5079743">state</span>&nbsp;<span class="op" id="5079749">!=</span>&nbsp;<span class="ident" id="5079752">c</span><span class="op" id="5079753">.</span><span class="ident" id="5079754">state</span>&nbsp;<span class="op" id="5079760">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079767">for</span>&nbsp;<span class="ident" id="5079771">j1</span>&nbsp;<span class="op" id="5079774">:=</span>&nbsp;<span class="ident" id="5079777">j</span>&nbsp;<span class="op" id="5079779">-</span>&nbsp;<span class="num" id="5079781">1</span><span class="op" id="5079782">;</span>&nbsp;<span class="ident" id="5079784">j1</span>&nbsp;<span class="op" id="5079787">&gt;=</span>&nbsp;<span class="ident" id="5079790">i</span><span class="op" id="5079791">;</span>&nbsp;<span class="ident" id="5079793">j1</span><span class="op" id="5079795">--</span>&nbsp;<span class="op" id="5079798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079806">if</span>&nbsp;<span class="ident" id="5079809">s</span><span class="op" id="5079810">[</span><span class="ident" id="5079811">j1</span><span class="op" id="5079813">]</span>&nbsp;<span class="op" id="5079815">==</span>&nbsp;<span class="string" id="5079818">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5079822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079831">j</span>&nbsp;<span class="op" id="5079833">=</span>&nbsp;<span class="ident" id="5079835">j1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079845">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079857">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079876">b</span><span class="op" id="5079877">.</span><span class="ident" id="5079878">Write</span><span class="op" id="5079883">(</span><span class="ident" id="5079884">s</span><span class="op" id="5079885">[</span><span class="ident" id="5079886">i</span><span class="op" id="5079887">:</span><span class="ident" id="5079888">j</span><span class="op" id="5079889">]</span><span class="op" id="5079890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079895">}</span>&nbsp;<span class="keyword" id="5079897">else</span>&nbsp;<span class="op" id="5079902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079908">allText</span>&nbsp;<span class="op" id="5079916">=</span>&nbsp;<span class="builtintype" id="5079918">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079932">c</span><span class="op" id="5079933">,</span>&nbsp;<span class="ident" id="5079935">i</span>&nbsp;<span class="op" id="5079937">=</span>&nbsp;<span class="ident" id="5079939">d</span><span class="op" id="5079940">,</span>&nbsp;<span class="ident" id="5079942">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079948">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079963">i1</span>&nbsp;<span class="op" id="5079966">:=</span>&nbsp;<span class="ident" id="5079969">i</span>&nbsp;<span class="op" id="5079971">+</span>&nbsp;<span class="ident" id="5079973">bytes</span><span class="op" id="5079978">.</span><span class="ident" id="5079979">IndexAny</span><span class="op" id="5079987">(</span><span class="ident" id="5079988">s</span><span class="op" id="5079989">[</span><span class="ident" id="5079990">i</span><span class="op" id="5079991">:</span><span class="op" id="5079992">]</span><span class="op" id="5079993">,</span>&nbsp;<span class="ident" id="5079995">delimEnds</span><span class="op" id="5080004">[</span><span class="ident" id="5080005">c</span><span class="op" id="5080006">.</span><span class="ident" id="5080007">delim</span><span class="op" id="5080012">]</span><span class="op" id="5080013">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080017">if</span>&nbsp;<span class="ident" id="5080020">i1</span>&nbsp;<span class="op" id="5080023">&lt;</span>&nbsp;<span class="ident" id="5080025">i</span>&nbsp;<span class="op" id="5080027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080032">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080044">if</span>&nbsp;<span class="ident" id="5080047">c</span><span class="op" id="5080048">.</span><span class="ident" id="5080049">delim</span>&nbsp;<span class="op" id="5080055">!=</span>&nbsp;<span class="ident" id="5080058">delimSpaceOrTagEnd</span>&nbsp;<span class="op" id="5080077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5080082">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080107">i1</span><span class="op" id="5080109">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080118">c</span><span class="op" id="5080119">,</span>&nbsp;<span class="ident" id="5080121">i</span>&nbsp;<span class="op" id="5080123">=</span>&nbsp;<span class="ident" id="5080125">context</span><span class="op" id="5080132">{</span><span class="ident" id="5080133">state</span><span class="op" id="5080138">:</span>&nbsp;<span class="ident" id="5080140">stateTag</span><span class="op" id="5080148">,</span>&nbsp;<span class="ident" id="5080150">element</span><span class="op" id="5080157">:</span>&nbsp;<span class="ident" id="5080159">c</span><span class="op" id="5080160">.</span><span class="ident" id="5080161">element</span><span class="op" id="5080168">}</span><span class="op" id="5080169">,</span>&nbsp;<span class="ident" id="5080171">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080178">if</span>&nbsp;<span class="ident" id="5080181">allText</span>&nbsp;<span class="op" id="5080189">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080193">return</span>&nbsp;<span class="ident" id="5080200">html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080206">}</span>&nbsp;<span class="keyword" id="5080208">else</span>&nbsp;<span class="keyword" id="5080213">if</span>&nbsp;<span class="ident" id="5080216">c</span><span class="op" id="5080217">.</span><span class="ident" id="5080218">state</span>&nbsp;<span class="op" id="5080224">==</span>&nbsp;<span class="ident" id="5080227">stateText</span>&nbsp;<span class="op" id="5080237">||</span>&nbsp;<span class="ident" id="5080240">c</span><span class="op" id="5080241">.</span><span class="ident" id="5080242">state</span>&nbsp;<span class="op" id="5080248">==</span>&nbsp;<span class="ident" id="5080251">stateRCDATA</span>&nbsp;<span class="op" id="5080263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080267">b</span><span class="op" id="5080268">.</span><span class="ident" id="5080269">Write</span><span class="op" id="5080274">(</span><span class="ident" id="5080275">s</span><span class="op" id="5080276">[</span><span class="ident" id="5080277">i</span><span class="op" id="5080278">:</span><span class="op" id="5080279">]</span><span class="op" id="5080280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080286">return</span>&nbsp;<span class="ident" id="5080293">b</span><span class="op" id="5080294">.</span><span class="ident" id="5080295">String</span><span class="op" id="5080301">(</span><span class="op" id="5080302">)</span><br>
<span class="lineno">215</span><span class="op" id="5080304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5080307">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5080381">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="5080413">func</span>&nbsp;<span class="ident" id="5080418">htmlNameFilter</span><span class="op" id="5080432">(</span><span class="ident" id="5080433">args</span>&nbsp;<span class="op" id="5080438">...</span><span class="keyword" id="5080441">interface</span><span class="op" id="5080450">{</span><span class="op" id="5080451">}</span><span class="op" id="5080452">)</span>&nbsp;<span class="builtintype" id="5080454">string</span>&nbsp;<span class="op" id="5080461">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080464">s</span><span class="op" id="5080465">,</span>&nbsp;<span class="ident" id="5080467">t</span>&nbsp;<span class="op" id="5080469">:=</span>&nbsp;<span class="ident" id="5080472">stringify</span><span class="op" id="5080481">(</span><span class="ident" id="5080482">args</span><span class="op" id="5080486">...</span><span class="op" id="5080489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080492">if</span>&nbsp;<span class="ident" id="5080495">t</span>&nbsp;<span class="op" id="5080497">==</span>&nbsp;<span class="ident" id="5080500">contentTypeHTMLAttr</span>&nbsp;<span class="op" id="5080520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080524">return</span>&nbsp;<span class="ident" id="5080531">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080537">if</span>&nbsp;<span class="builtinfunc" id="5080540">len</span><span class="op" id="5080543">(</span><span class="ident" id="5080544">s</span><span class="op" id="5080545">)</span>&nbsp;<span class="op" id="5080547">==</span>&nbsp;<span class="num" id="5080550">0</span>&nbsp;<span class="op" id="5080552">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5080556">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5080604">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5080640">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5080698">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5080759">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080774">return</span>&nbsp;<span class="ident" id="5080781">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080800">s</span>&nbsp;<span class="op" id="5080802">=</span>&nbsp;<span class="ident" id="5080804">strings</span><span class="op" id="5080811">.</span><span class="ident" id="5080812">ToLower</span><span class="op" id="5080819">(</span><span class="ident" id="5080820">s</span><span class="op" id="5080821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080824">if</span>&nbsp;<span class="ident" id="5080827">t</span>&nbsp;<span class="op" id="5080829">:=</span>&nbsp;<span class="ident" id="5080832">attrType</span><span class="op" id="5080840">(</span><span class="ident" id="5080841">s</span><span class="op" id="5080842">)</span><span class="op" id="5080843">;</span>&nbsp;<span class="ident" id="5080845">t</span>&nbsp;<span class="op" id="5080847">!=</span>&nbsp;<span class="ident" id="5080850">contentTypePlain</span>&nbsp;<span class="op" id="5080867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5080871">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5080943">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080960">return</span>&nbsp;<span class="ident" id="5080967">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080986">for</span>&nbsp;<span class="ident" id="5080990">_</span><span class="op" id="5080991">,</span>&nbsp;<span class="ident" id="5080993">r</span>&nbsp;<span class="op" id="5080995">:=</span>&nbsp;<span class="keyword" id="5080998">range</span>&nbsp;<span class="ident" id="5081004">s</span>&nbsp;<span class="op" id="5081006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081010">switch</span>&nbsp;<span class="op" id="5081017">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081021">case</span>&nbsp;<span class="string" id="5081026">&#39;0&#39;</span>&nbsp;<span class="op" id="5081030">&lt;=</span>&nbsp;<span class="ident" id="5081033">r</span>&nbsp;<span class="op" id="5081035">&amp;&amp;</span>&nbsp;<span class="ident" id="5081038">r</span>&nbsp;<span class="op" id="5081040">&lt;=</span>&nbsp;<span class="string" id="5081043">&#39;9&#39;</span><span class="op" id="5081046">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081050">case</span>&nbsp;<span class="string" id="5081055">&#39;a&#39;</span>&nbsp;<span class="op" id="5081059">&lt;=</span>&nbsp;<span class="ident" id="5081062">r</span>&nbsp;<span class="op" id="5081064">&amp;&amp;</span>&nbsp;<span class="ident" id="5081067">r</span>&nbsp;<span class="op" id="5081069">&lt;=</span>&nbsp;<span class="string" id="5081072">&#39;z&#39;</span><span class="op" id="5081075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081079">default</span><span class="op" id="5081086">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081091">return</span>&nbsp;<span class="ident" id="5081098">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5081115">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5081118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081121">return</span>&nbsp;<span class="ident" id="5081128">s</span><br>
<span class="lineno"></span><span class="op" id="5081130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5081133">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="5081197">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5081263">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="5081340">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5081379">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5081454">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="5081484">func</span>&nbsp;<span class="ident" id="5081489">commentEscaper</span><span class="op" id="5081503">(</span><span class="ident" id="5081504">args</span>&nbsp;<span class="op" id="5081509">...</span><span class="keyword" id="5081512">interface</span><span class="op" id="5081521">{</span><span class="op" id="5081522">}</span><span class="op" id="5081523">)</span>&nbsp;<span class="builtintype" id="5081525">string</span>&nbsp;<span class="op" id="5081532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081535">return</span>&nbsp;<span class="string" id="5081542">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="5081545">}</span>
</div>
</body>
</html>
