<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4364981">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4365036">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4365090">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4365141">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="4365206">package</span>&nbsp;<span class="ident" id="4365214">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4365219">import</span>&nbsp;<span class="op" id="4365226">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4365229">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4365239">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4365254">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4365271">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4365281">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4365289">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4365295">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4365306">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4365309">var</span>&nbsp;<span class="ident" id="4365313">bigZero</span>&nbsp;<span class="op" id="4365321">=</span>&nbsp;<span class="ident" id="4365323">big</span><span class="op" id="4365326">.</span><span class="ident" id="4365327">NewInt</span><span class="op" id="4365333">(</span><span class="num" id="4365334">0</span><span class="op" id="4365335">)</span><br>
<span class="lineno"></span><span class="keyword" id="4365337">var</span>&nbsp;<span class="ident" id="4365341">bigOne</span>&nbsp;<span class="op" id="4365348">=</span>&nbsp;<span class="ident" id="4365350">big</span><span class="op" id="4365353">.</span><span class="ident" id="4365354">NewInt</span><span class="op" id="4365360">(</span><span class="num" id="4365361">1</span><span class="op" id="4365362">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4365365">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4365422">type</span>&nbsp;<span class="ident" id="4365427">PublicKey</span>&nbsp;<span class="keyword" id="4365437">struct</span>&nbsp;<span class="op" id="4365444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365447">N</span>&nbsp;<span class="op" id="4365449">*</span><span class="ident" id="4365450">big</span><span class="op" id="4365453">.</span><span class="ident" id="4365454">Int</span>&nbsp;<span class="comment" id="4365458">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365470">E</span>&nbsp;<span class="builtintype" id="4365472">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4365481">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="4365500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4365503">var</span>&nbsp;<span class="op" id="4365507">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365510">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4365533">=</span>&nbsp;<span class="ident" id="4365535">errors</span><span class="op" id="4365541">.</span><span class="ident" id="4365542">New</span><span class="op" id="4365545">(</span><span class="string" id="4365546">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="4365582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365585">errPublicExponentSmall</span>&nbsp;<span class="op" id="4365608">=</span>&nbsp;<span class="ident" id="4365610">errors</span><span class="op" id="4365616">.</span><span class="ident" id="4365617">New</span><span class="op" id="4365620">(</span><span class="string" id="4365621">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="4365660">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365663">errPublicExponentLarge</span>&nbsp;<span class="op" id="4365686">=</span>&nbsp;<span class="ident" id="4365688">errors</span><span class="op" id="4365694">.</span><span class="ident" id="4365695">New</span><span class="op" id="4365698">(</span><span class="string" id="4365699">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="4365738">)</span><br>
<span class="lineno"></span><span class="op" id="4365740">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4365743">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4365802">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="4365862">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="4365917">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4365951">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="4366006">func</span>&nbsp;<span class="ident" id="4366011">checkPub</span><span class="op" id="4366019">(</span><span class="ident" id="4366020">pub</span>&nbsp;<span class="op" id="4366024">*</span><span class="ident" id="4366025">PublicKey</span><span class="op" id="4366034">)</span>&nbsp;<span class="builtintype" id="4366036">error</span>&nbsp;<span class="op" id="4366042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366045">if</span>&nbsp;<span class="ident" id="4366048">pub</span><span class="op" id="4366051">.</span><span class="ident" id="4366052">N</span>&nbsp;<span class="op" id="4366054">==</span>&nbsp;<span class="ident" id="4366057">nil</span>&nbsp;<span class="op" id="4366061">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366065">return</span>&nbsp;<span class="ident" id="4366072">errPublicModulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4366090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366093">if</span>&nbsp;<span class="ident" id="4366096">pub</span><span class="op" id="4366099">.</span><span class="ident" id="4366100">E</span>&nbsp;<span class="op" id="4366102">&lt;</span>&nbsp;<span class="num" id="4366104">2</span>&nbsp;<span class="op" id="4366106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366110">return</span>&nbsp;<span class="ident" id="4366117">errPublicExponentSmall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4366141">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366144">if</span>&nbsp;<span class="ident" id="4366147">pub</span><span class="op" id="4366150">.</span><span class="ident" id="4366151">E</span>&nbsp;<span class="op" id="4366153">&gt;</span>&nbsp;<span class="num" id="4366155">1</span><span class="op" id="4366156">&lt;&lt;</span><span class="num" id="4366158">31</span><span class="op" id="4366160">-</span><span class="num" id="4366161">1</span>&nbsp;<span class="op" id="4366163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366167">return</span>&nbsp;<span class="ident" id="4366174">errPublicExponentLarge</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4366198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366201">return</span>&nbsp;<span class="ident" id="4366208">nil</span><br>
<span class="lineno"></span><span class="op" id="4366212">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4366215">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="4366253">type</span>&nbsp;<span class="ident" id="4366258">PrivateKey</span>&nbsp;<span class="keyword" id="4366269">struct</span>&nbsp;<span class="op" id="4366276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366279">PublicKey</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4366300">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366317">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4366327">*</span><span class="ident" id="4366328">big</span><span class="op" id="4366331">.</span><span class="ident" id="4366332">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4366338">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366359">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4366369">[</span><span class="op" id="4366370">]</span><span class="op" id="4366371">*</span><span class="ident" id="4366372">big</span><span class="op" id="4366375">.</span><span class="ident" id="4366376">Int</span>&nbsp;<span class="comment" id="4366380">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4366424">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4366490">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366520">Precomputed</span>&nbsp;<span class="ident" id="4366532">PrecomputedValues</span><br>
<span class="lineno">60</span><span class="op" id="4366550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4366553">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="4366609">func</span>&nbsp;<span class="op" id="4366614">(</span><span class="ident" id="4366615">priv</span>&nbsp;<span class="op" id="4366620">*</span><span class="ident" id="4366621">PrivateKey</span><span class="op" id="4366631">)</span>&nbsp;<span class="ident" id="4366633">Public</span><span class="op" id="4366639">(</span><span class="op" id="4366640">)</span>&nbsp;<span class="ident" id="4366642">crypto</span><span class="op" id="4366648">.</span><span class="ident" id="4366649">PublicKey</span>&nbsp;<span class="op" id="4366659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366662">return</span>&nbsp;<span class="op" id="4366669">&amp;</span><span class="ident" id="4366670">priv</span><span class="op" id="4366674">.</span><span class="ident" id="4366675">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="4366685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4366688">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4366760">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4366839">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="4366917">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="4366994">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4367024">func</span>&nbsp;<span class="op" id="4367029">(</span><span class="ident" id="4367030">priv</span>&nbsp;<span class="op" id="4367035">*</span><span class="ident" id="4367036">PrivateKey</span><span class="op" id="4367046">)</span>&nbsp;<span class="ident" id="4367048">Sign</span><span class="op" id="4367052">(</span><span class="ident" id="4367053">rand</span>&nbsp;<span class="ident" id="4367058">io</span><span class="op" id="4367060">.</span><span class="ident" id="4367061">Reader</span><span class="op" id="4367067">,</span>&nbsp;<span class="ident" id="4367069">msg</span>&nbsp;<span class="op" id="4367073">[</span><span class="op" id="4367074">]</span><span class="builtintype" id="4367075">byte</span><span class="op" id="4367079">,</span>&nbsp;<span class="ident" id="4367081">opts</span>&nbsp;<span class="ident" id="4367086">crypto</span><span class="op" id="4367092">.</span><span class="ident" id="4367093">SignerOpts</span><span class="op" id="4367103">)</span>&nbsp;<span class="op" id="4367105">(</span><span class="op" id="4367106">[</span><span class="op" id="4367107">]</span><span class="builtintype" id="4367108">byte</span><span class="op" id="4367112">,</span>&nbsp;<span class="builtintype" id="4367114">error</span><span class="op" id="4367119">)</span>&nbsp;<span class="op" id="4367121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367124">if</span>&nbsp;<span class="ident" id="4367127">pssOpts</span><span class="op" id="4367134">,</span>&nbsp;<span class="ident" id="4367136">ok</span>&nbsp;<span class="op" id="4367139">:=</span>&nbsp;<span class="ident" id="4367142">opts</span><span class="op" id="4367146">.</span><span class="op" id="4367147">(</span><span class="op" id="4367148">*</span><span class="ident" id="4367149">PSSOptions</span><span class="op" id="4367159">)</span><span class="op" id="4367160">;</span>&nbsp;<span class="ident" id="4367162">ok</span>&nbsp;<span class="op" id="4367165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367169">return</span>&nbsp;<span class="ident" id="4367176">SignPSS</span><span class="op" id="4367183">(</span><span class="ident" id="4367184">rand</span><span class="op" id="4367188">,</span>&nbsp;<span class="ident" id="4367190">priv</span><span class="op" id="4367194">,</span>&nbsp;<span class="ident" id="4367196">pssOpts</span><span class="op" id="4367203">.</span><span class="ident" id="4367204">Hash</span><span class="op" id="4367208">,</span>&nbsp;<span class="ident" id="4367210">msg</span><span class="op" id="4367213">,</span>&nbsp;<span class="ident" id="4367215">pssOpts</span><span class="op" id="4367222">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4367225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367229">return</span>&nbsp;<span class="ident" id="4367236">SignPKCS1v15</span><span class="op" id="4367248">(</span><span class="ident" id="4367249">rand</span><span class="op" id="4367253">,</span>&nbsp;<span class="ident" id="4367255">priv</span><span class="op" id="4367259">,</span>&nbsp;<span class="ident" id="4367261">opts</span><span class="op" id="4367265">.</span><span class="ident" id="4367266">HashFunc</span><span class="op" id="4367274">(</span><span class="op" id="4367275">)</span><span class="op" id="4367276">,</span>&nbsp;<span class="ident" id="4367278">msg</span><span class="op" id="4367281">)</span><br>
<span class="lineno"></span><span class="op" id="4367283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4367286">type</span>&nbsp;<span class="ident" id="4367291">PrecomputedValues</span>&nbsp;<span class="keyword" id="4367309">struct</span>&nbsp;<span class="op" id="4367316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367319">Dp</span><span class="op" id="4367321">,</span>&nbsp;<span class="ident" id="4367323">Dq</span>&nbsp;<span class="op" id="4367326">*</span><span class="ident" id="4367327">big</span><span class="op" id="4367330">.</span><span class="ident" id="4367331">Int</span>&nbsp;<span class="comment" id="4367335">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367364">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4367371">*</span><span class="ident" id="4367372">big</span><span class="op" id="4367375">.</span><span class="ident" id="4367376">Int</span>&nbsp;<span class="comment" id="4367380">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4367396">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4367462">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4367531">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4367594">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367629">CRTValues</span>&nbsp;<span class="op" id="4367639">[</span><span class="op" id="4367640">]</span><span class="ident" id="4367641">CRTValue</span><br>
<span class="lineno"></span><span class="op" id="4367650">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4367653">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4367724">type</span>&nbsp;<span class="ident" id="4367729">CRTValue</span>&nbsp;<span class="keyword" id="4367738">struct</span>&nbsp;<span class="op" id="4367745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367748">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4367754">*</span><span class="ident" id="4367755">big</span><span class="op" id="4367758">.</span><span class="ident" id="4367759">Int</span>&nbsp;<span class="comment" id="4367763">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367784">Coeff</span>&nbsp;<span class="op" id="4367790">*</span><span class="ident" id="4367791">big</span><span class="op" id="4367794">.</span><span class="ident" id="4367795">Int</span>&nbsp;<span class="comment" id="4367799">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367829">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4367835">*</span><span class="ident" id="4367836">big</span><span class="op" id="4367839">.</span><span class="ident" id="4367840">Int</span>&nbsp;<span class="comment" id="4367844">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="4367894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4367897">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4367950">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="4368028">func</span>&nbsp;<span class="op" id="4368033">(</span><span class="ident" id="4368034">priv</span>&nbsp;<span class="op" id="4368039">*</span><span class="ident" id="4368040">PrivateKey</span><span class="op" id="4368050">)</span>&nbsp;<span class="ident" id="4368052">Validate</span><span class="op" id="4368060">(</span><span class="op" id="4368061">)</span>&nbsp;<span class="builtintype" id="4368063">error</span>&nbsp;<span class="op" id="4368069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4368072">if</span>&nbsp;<span class="ident" id="4368075">err</span>&nbsp;<span class="op" id="4368079">:=</span>&nbsp;<span class="ident" id="4368082">checkPub</span><span class="op" id="4368090">(</span><span class="op" id="4368091">&amp;</span><span class="ident" id="4368092">priv</span><span class="op" id="4368096">.</span><span class="ident" id="4368097">PublicKey</span><span class="op" id="4368106">)</span><span class="op" id="4368107">;</span>&nbsp;<span class="ident" id="4368109">err</span>&nbsp;<span class="op" id="4368113">!=</span>&nbsp;<span class="ident" id="4368116">nil</span>&nbsp;<span class="op" id="4368120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4368124">return</span>&nbsp;<span class="ident" id="4368131">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4368136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4368140">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4368211">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4368273">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4368343">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4368410">for</span>&nbsp;<span class="ident" id="4368414">_</span><span class="op" id="4368415">,</span>&nbsp;<span class="ident" id="4368417">prime</span>&nbsp;<span class="op" id="4368423">:=</span>&nbsp;<span class="keyword" id="4368426">range</span>&nbsp;<span class="ident" id="4368432">priv</span><span class="op" id="4368436">.</span><span class="ident" id="4368437">Primes</span>&nbsp;<span class="op" id="4368444">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4368448">if</span>&nbsp;<span class="op" id="4368451">!</span><span class="ident" id="4368452">prime</span><span class="op" id="4368457">.</span><span class="ident" id="4368458">ProbablyPrime</span><span class="op" id="4368471">(</span><span class="num" id="4368472">20</span><span class="op" id="4368474">)</span>&nbsp;<span class="op" id="4368476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4368481">return</span>&nbsp;<span class="ident" id="4368488">errors</span><span class="op" id="4368494">.</span><span class="ident" id="4368495">New</span><span class="op" id="4368498">(</span><span class="string" id="4368499">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="4368538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4368542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4368545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4368549">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4368579">modulus</span>&nbsp;<span class="op" id="4368587">:=</span>&nbsp;<span class="builtinfunc" id="4368590">new</span><span class="op" id="4368593">(</span><span class="ident" id="4368594">big</span><span class="op" id="4368597">.</span><span class="ident" id="4368598">Int</span><span class="op" id="4368601">)</span><span class="op" id="4368602">.</span><span class="ident" id="4368603">Set</span><span class="op" id="4368606">(</span><span class="ident" id="4368607">bigOne</span><span class="op" id="4368613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4368616">for</span>&nbsp;<span class="ident" id="4368620">_</span><span class="op" id="4368621">,</span>&nbsp;<span class="ident" id="4368623">prime</span>&nbsp;<span class="op" id="4368629">:=</span>&nbsp;<span class="keyword" id="4368632">range</span>&nbsp;<span class="ident" id="4368638">priv</span><span class="op" id="4368642">.</span><span class="ident" id="4368643">Primes</span>&nbsp;<span class="op" id="4368650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4368654">modulus</span><span class="op" id="4368661">.</span><span class="ident" id="4368662">Mul</span><span class="op" id="4368665">(</span><span class="ident" id="4368666">modulus</span><span class="op" id="4368673">,</span>&nbsp;<span class="ident" id="4368675">prime</span><span class="op" id="4368680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4368683">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4368686">if</span>&nbsp;<span class="ident" id="4368689">modulus</span><span class="op" id="4368696">.</span><span class="ident" id="4368697">Cmp</span><span class="op" id="4368700">(</span><span class="ident" id="4368701">priv</span><span class="op" id="4368705">.</span><span class="ident" id="4368706">N</span><span class="op" id="4368707">)</span>&nbsp;<span class="op" id="4368709">!=</span>&nbsp;<span class="num" id="4368712">0</span>&nbsp;<span class="op" id="4368714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4368718">return</span>&nbsp;<span class="ident" id="4368725">errors</span><span class="op" id="4368731">.</span><span class="ident" id="4368732">New</span><span class="op" id="4368735">(</span><span class="string" id="4368736">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="4368765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4368768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4368772">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4368821">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4368894">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4368956">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4369035">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369105">congruence</span>&nbsp;<span class="op" id="4369116">:=</span>&nbsp;<span class="builtinfunc" id="4369119">new</span><span class="op" id="4369122">(</span><span class="ident" id="4369123">big</span><span class="op" id="4369126">.</span><span class="ident" id="4369127">Int</span><span class="op" id="4369130">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369133">de</span>&nbsp;<span class="op" id="4369136">:=</span>&nbsp;<span class="builtinfunc" id="4369139">new</span><span class="op" id="4369142">(</span><span class="ident" id="4369143">big</span><span class="op" id="4369146">.</span><span class="ident" id="4369147">Int</span><span class="op" id="4369150">)</span><span class="op" id="4369151">.</span><span class="ident" id="4369152">SetInt64</span><span class="op" id="4369160">(</span><span class="ident" id="4369161">int64</span><span class="op" id="4369166">(</span><span class="ident" id="4369167">priv</span><span class="op" id="4369171">.</span><span class="ident" id="4369172">E</span><span class="op" id="4369173">)</span><span class="op" id="4369174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369177">de</span><span class="op" id="4369179">.</span><span class="ident" id="4369180">Mul</span><span class="op" id="4369183">(</span><span class="ident" id="4369184">de</span><span class="op" id="4369186">,</span>&nbsp;<span class="ident" id="4369188">priv</span><span class="op" id="4369192">.</span><span class="ident" id="4369193">D</span><span class="op" id="4369194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369197">for</span>&nbsp;<span class="ident" id="4369201">_</span><span class="op" id="4369202">,</span>&nbsp;<span class="ident" id="4369204">prime</span>&nbsp;<span class="op" id="4369210">:=</span>&nbsp;<span class="keyword" id="4369213">range</span>&nbsp;<span class="ident" id="4369219">priv</span><span class="op" id="4369223">.</span><span class="ident" id="4369224">Primes</span>&nbsp;<span class="op" id="4369231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369235">pminus1</span>&nbsp;<span class="op" id="4369243">:=</span>&nbsp;<span class="builtinfunc" id="4369246">new</span><span class="op" id="4369249">(</span><span class="ident" id="4369250">big</span><span class="op" id="4369253">.</span><span class="ident" id="4369254">Int</span><span class="op" id="4369257">)</span><span class="op" id="4369258">.</span><span class="ident" id="4369259">Sub</span><span class="op" id="4369262">(</span><span class="ident" id="4369263">prime</span><span class="op" id="4369268">,</span>&nbsp;<span class="ident" id="4369270">bigOne</span><span class="op" id="4369276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369280">congruence</span><span class="op" id="4369290">.</span><span class="ident" id="4369291">Mod</span><span class="op" id="4369294">(</span><span class="ident" id="4369295">de</span><span class="op" id="4369297">,</span>&nbsp;<span class="ident" id="4369299">pminus1</span><span class="op" id="4369306">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369310">if</span>&nbsp;<span class="ident" id="4369313">congruence</span><span class="op" id="4369323">.</span><span class="ident" id="4369324">Cmp</span><span class="op" id="4369327">(</span><span class="ident" id="4369328">bigOne</span><span class="op" id="4369334">)</span>&nbsp;<span class="op" id="4369336">!=</span>&nbsp;<span class="num" id="4369339">0</span>&nbsp;<span class="op" id="4369341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369346">return</span>&nbsp;<span class="ident" id="4369353">errors</span><span class="op" id="4369359">.</span><span class="ident" id="4369360">New</span><span class="op" id="4369363">(</span><span class="string" id="4369364">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="4369395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4369399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4369402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369405">return</span>&nbsp;<span class="ident" id="4369412">nil</span><br>
<span class="lineno">140</span><span class="op" id="4369416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4369419">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4369491">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="4369550">func</span>&nbsp;<span class="ident" id="4369555">GenerateKey</span><span class="op" id="4369566">(</span><span class="ident" id="4369567">random</span>&nbsp;<span class="ident" id="4369574">io</span><span class="op" id="4369576">.</span><span class="ident" id="4369577">Reader</span><span class="op" id="4369583">,</span>&nbsp;<span class="ident" id="4369585">bits</span>&nbsp;<span class="builtintype" id="4369590">int</span><span class="op" id="4369593">)</span>&nbsp;<span class="op" id="4369595">(</span><span class="ident" id="4369596">priv</span>&nbsp;<span class="op" id="4369601">*</span><span class="ident" id="4369602">PrivateKey</span><span class="op" id="4369612">,</span>&nbsp;<span class="ident" id="4369614">err</span>&nbsp;<span class="builtintype" id="4369618">error</span><span class="op" id="4369623">)</span>&nbsp;<span class="op" id="4369625">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369628">return</span>&nbsp;<span class="ident" id="4369635">GenerateMultiPrimeKey</span><span class="op" id="4369656">(</span><span class="ident" id="4369657">random</span><span class="op" id="4369663">,</span>&nbsp;<span class="num" id="4369665">2</span><span class="op" id="4369666">,</span>&nbsp;<span class="ident" id="4369668">bits</span><span class="op" id="4369672">)</span><br>
<span class="lineno"></span><span class="op" id="4369674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4369677">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="4369755">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="4369833">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="4369909">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="4369988">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="4370065">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4370074">//</span><br>
<span class="lineno">155</span><span class="comment" id="4370077">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="4370148">//</span><br>
<span class="lineno"></span><span class="comment" id="4370151">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="4370192">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="4370266">func</span>&nbsp;<span class="ident" id="4370271">GenerateMultiPrimeKey</span><span class="op" id="4370292">(</span><span class="ident" id="4370293">random</span>&nbsp;<span class="ident" id="4370300">io</span><span class="op" id="4370302">.</span><span class="ident" id="4370303">Reader</span><span class="op" id="4370309">,</span>&nbsp;<span class="ident" id="4370311">nprimes</span>&nbsp;<span class="builtintype" id="4370319">int</span><span class="op" id="4370322">,</span>&nbsp;<span class="ident" id="4370324">bits</span>&nbsp;<span class="builtintype" id="4370329">int</span><span class="op" id="4370332">)</span>&nbsp;<span class="op" id="4370334">(</span><span class="ident" id="4370335">priv</span>&nbsp;<span class="op" id="4370340">*</span><span class="ident" id="4370341">PrivateKey</span><span class="op" id="4370351">,</span>&nbsp;<span class="ident" id="4370353">err</span>&nbsp;<span class="builtintype" id="4370357">error</span><span class="op" id="4370362">)</span>&nbsp;<span class="op" id="4370364">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370367">priv</span>&nbsp;<span class="op" id="4370372">=</span>&nbsp;<span class="builtinfunc" id="4370374">new</span><span class="op" id="4370377">(</span><span class="ident" id="4370378">PrivateKey</span><span class="op" id="4370388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370391">priv</span><span class="op" id="4370395">.</span><span class="ident" id="4370396">E</span>&nbsp;<span class="op" id="4370398">=</span>&nbsp;<span class="num" id="4370400">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4370408">if</span>&nbsp;<span class="ident" id="4370411">nprimes</span>&nbsp;<span class="op" id="4370419">&lt;</span>&nbsp;<span class="num" id="4370421">2</span>&nbsp;<span class="op" id="4370423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4370427">return</span>&nbsp;<span class="ident" id="4370434">nil</span><span class="op" id="4370437">,</span>&nbsp;<span class="ident" id="4370439">errors</span><span class="op" id="4370445">.</span><span class="ident" id="4370446">New</span><span class="op" id="4370449">(</span><span class="string" id="4370450">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="4370507">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4370510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370514">primes</span>&nbsp;<span class="op" id="4370521">:=</span>&nbsp;<span class="builtinfunc" id="4370524">make</span><span class="op" id="4370528">(</span><span class="op" id="4370529">[</span><span class="op" id="4370530">]</span><span class="op" id="4370531">*</span><span class="ident" id="4370532">big</span><span class="op" id="4370535">.</span><span class="ident" id="4370536">Int</span><span class="op" id="4370539">,</span>&nbsp;<span class="ident" id="4370541">nprimes</span><span class="op" id="4370548">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4370551">NextSetOfPrimes</span><span class="op" id="4370566">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4370569">for</span>&nbsp;<span class="op" id="4370573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370577">todo</span>&nbsp;<span class="op" id="4370582">:=</span>&nbsp;<span class="ident" id="4370585">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370592">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370652">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370686">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370737">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370762">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370786">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370854">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370859">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370923">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370994">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4371059">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371088">if</span>&nbsp;<span class="ident" id="4371091">nprimes</span>&nbsp;<span class="op" id="4371099">&gt;=</span>&nbsp;<span class="num" id="4371102">7</span>&nbsp;<span class="op" id="4371104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371109">todo</span>&nbsp;<span class="op" id="4371114">+=</span>&nbsp;<span class="op" id="4371117">(</span><span class="ident" id="4371118">nprimes</span>&nbsp;<span class="op" id="4371126">-</span>&nbsp;<span class="num" id="4371128">2</span><span class="op" id="4371129">)</span>&nbsp;<span class="op" id="4371131">/</span>&nbsp;<span class="num" id="4371133">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371141">for</span>&nbsp;<span class="ident" id="4371145">i</span>&nbsp;<span class="op" id="4371147">:=</span>&nbsp;<span class="num" id="4371150">0</span><span class="op" id="4371151">;</span>&nbsp;<span class="ident" id="4371153">i</span>&nbsp;<span class="op" id="4371155">&lt;</span>&nbsp;<span class="ident" id="4371157">nprimes</span><span class="op" id="4371164">;</span>&nbsp;<span class="ident" id="4371166">i</span><span class="op" id="4371167">++</span>&nbsp;<span class="op" id="4371170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371175">primes</span><span class="op" id="4371181">[</span><span class="ident" id="4371182">i</span><span class="op" id="4371183">]</span><span class="op" id="4371184">,</span>&nbsp;<span class="ident" id="4371186">err</span>&nbsp;<span class="op" id="4371190">=</span>&nbsp;<span class="ident" id="4371192">rand</span><span class="op" id="4371196">.</span><span class="ident" id="4371197">Prime</span><span class="op" id="4371202">(</span><span class="ident" id="4371203">random</span><span class="op" id="4371209">,</span>&nbsp;<span class="ident" id="4371211">todo</span><span class="op" id="4371215">/</span><span class="op" id="4371216">(</span><span class="ident" id="4371217">nprimes</span><span class="op" id="4371224">-</span><span class="ident" id="4371225">i</span><span class="op" id="4371226">)</span><span class="op" id="4371227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371232">if</span>&nbsp;<span class="ident" id="4371235">err</span>&nbsp;<span class="op" id="4371239">!=</span>&nbsp;<span class="ident" id="4371242">nil</span>&nbsp;<span class="op" id="4371246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371252">return</span>&nbsp;<span class="ident" id="4371259">nil</span><span class="op" id="4371262">,</span>&nbsp;<span class="ident" id="4371264">err</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371276">todo</span>&nbsp;<span class="op" id="4371281">-=</span>&nbsp;<span class="ident" id="4371284">primes</span><span class="op" id="4371290">[</span><span class="ident" id="4371291">i</span><span class="op" id="4371292">]</span><span class="op" id="4371293">.</span><span class="ident" id="4371294">BitLen</span><span class="op" id="4371300">(</span><span class="op" id="4371301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4371310">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371358">for</span>&nbsp;<span class="ident" id="4371362">i</span><span class="op" id="4371363">,</span>&nbsp;<span class="ident" id="4371365">prime</span>&nbsp;<span class="op" id="4371371">:=</span>&nbsp;<span class="keyword" id="4371374">range</span>&nbsp;<span class="ident" id="4371380">primes</span>&nbsp;<span class="op" id="4371387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371392">for</span>&nbsp;<span class="ident" id="4371396">j</span>&nbsp;<span class="op" id="4371398">:=</span>&nbsp;<span class="num" id="4371401">0</span><span class="op" id="4371402">;</span>&nbsp;<span class="ident" id="4371404">j</span>&nbsp;<span class="op" id="4371406">&lt;</span>&nbsp;<span class="ident" id="4371408">i</span><span class="op" id="4371409">;</span>&nbsp;<span class="ident" id="4371411">j</span><span class="op" id="4371412">++</span>&nbsp;<span class="op" id="4371415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371421">if</span>&nbsp;<span class="ident" id="4371424">prime</span><span class="op" id="4371429">.</span><span class="ident" id="4371430">Cmp</span><span class="op" id="4371433">(</span><span class="ident" id="4371434">primes</span><span class="op" id="4371440">[</span><span class="ident" id="4371441">j</span><span class="op" id="4371442">]</span><span class="op" id="4371443">)</span>&nbsp;<span class="op" id="4371445">==</span>&nbsp;<span class="num" id="4371448">0</span>&nbsp;<span class="op" id="4371450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371457">continue</span>&nbsp;<span class="ident" id="4371466">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371486">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371500">n</span>&nbsp;<span class="op" id="4371502">:=</span>&nbsp;<span class="builtinfunc" id="4371505">new</span><span class="op" id="4371508">(</span><span class="ident" id="4371509">big</span><span class="op" id="4371512">.</span><span class="ident" id="4371513">Int</span><span class="op" id="4371516">)</span><span class="op" id="4371517">.</span><span class="ident" id="4371518">Set</span><span class="op" id="4371521">(</span><span class="ident" id="4371522">bigOne</span><span class="op" id="4371528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371532">totient</span>&nbsp;<span class="op" id="4371540">:=</span>&nbsp;<span class="builtinfunc" id="4371543">new</span><span class="op" id="4371546">(</span><span class="ident" id="4371547">big</span><span class="op" id="4371550">.</span><span class="ident" id="4371551">Int</span><span class="op" id="4371554">)</span><span class="op" id="4371555">.</span><span class="ident" id="4371556">Set</span><span class="op" id="4371559">(</span><span class="ident" id="4371560">bigOne</span><span class="op" id="4371566">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371570">pminus1</span>&nbsp;<span class="op" id="4371578">:=</span>&nbsp;<span class="builtinfunc" id="4371581">new</span><span class="op" id="4371584">(</span><span class="ident" id="4371585">big</span><span class="op" id="4371588">.</span><span class="ident" id="4371589">Int</span><span class="op" id="4371592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371596">for</span>&nbsp;<span class="ident" id="4371600">_</span><span class="op" id="4371601">,</span>&nbsp;<span class="ident" id="4371603">prime</span>&nbsp;<span class="op" id="4371609">:=</span>&nbsp;<span class="keyword" id="4371612">range</span>&nbsp;<span class="ident" id="4371618">primes</span>&nbsp;<span class="op" id="4371625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371630">n</span><span class="op" id="4371631">.</span><span class="ident" id="4371632">Mul</span><span class="op" id="4371635">(</span><span class="ident" id="4371636">n</span><span class="op" id="4371637">,</span>&nbsp;<span class="ident" id="4371639">prime</span><span class="op" id="4371644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371649">pminus1</span><span class="op" id="4371656">.</span><span class="ident" id="4371657">Sub</span><span class="op" id="4371660">(</span><span class="ident" id="4371661">prime</span><span class="op" id="4371666">,</span>&nbsp;<span class="ident" id="4371668">bigOne</span><span class="op" id="4371674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371679">totient</span><span class="op" id="4371686">.</span><span class="ident" id="4371687">Mul</span><span class="op" id="4371690">(</span><span class="ident" id="4371691">totient</span><span class="op" id="4371698">,</span>&nbsp;<span class="ident" id="4371700">pminus1</span><span class="op" id="4371707">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371715">if</span>&nbsp;<span class="ident" id="4371718">n</span><span class="op" id="4371719">.</span><span class="ident" id="4371720">BitLen</span><span class="op" id="4371726">(</span><span class="op" id="4371727">)</span>&nbsp;<span class="op" id="4371729">!=</span>&nbsp;<span class="ident" id="4371732">bits</span>&nbsp;<span class="op" id="4371737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4371742">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4371798">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4371859">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371915">continue</span>&nbsp;<span class="ident" id="4371924">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371947">g</span>&nbsp;<span class="op" id="4371949">:=</span>&nbsp;<span class="builtinfunc" id="4371952">new</span><span class="op" id="4371955">(</span><span class="ident" id="4371956">big</span><span class="op" id="4371959">.</span><span class="ident" id="4371960">Int</span><span class="op" id="4371963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371967">priv</span><span class="op" id="4371971">.</span><span class="ident" id="4371972">D</span>&nbsp;<span class="op" id="4371974">=</span>&nbsp;<span class="builtinfunc" id="4371976">new</span><span class="op" id="4371979">(</span><span class="ident" id="4371980">big</span><span class="op" id="4371983">.</span><span class="ident" id="4371984">Int</span><span class="op" id="4371987">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371991">y</span>&nbsp;<span class="op" id="4371993">:=</span>&nbsp;<span class="builtinfunc" id="4371996">new</span><span class="op" id="4371999">(</span><span class="ident" id="4372000">big</span><span class="op" id="4372003">.</span><span class="ident" id="4372004">Int</span><span class="op" id="4372007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372011">e</span>&nbsp;<span class="op" id="4372013">:=</span>&nbsp;<span class="ident" id="4372016">big</span><span class="op" id="4372019">.</span><span class="ident" id="4372020">NewInt</span><span class="op" id="4372026">(</span><span class="ident" id="4372027">int64</span><span class="op" id="4372032">(</span><span class="ident" id="4372033">priv</span><span class="op" id="4372037">.</span><span class="ident" id="4372038">E</span><span class="op" id="4372039">)</span><span class="op" id="4372040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372044">g</span><span class="op" id="4372045">.</span><span class="ident" id="4372046">GCD</span><span class="op" id="4372049">(</span><span class="ident" id="4372050">priv</span><span class="op" id="4372054">.</span><span class="ident" id="4372055">D</span><span class="op" id="4372056">,</span>&nbsp;<span class="ident" id="4372058">y</span><span class="op" id="4372059">,</span>&nbsp;<span class="ident" id="4372061">e</span><span class="op" id="4372062">,</span>&nbsp;<span class="ident" id="4372064">totient</span><span class="op" id="4372071">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372076">if</span>&nbsp;<span class="ident" id="4372079">g</span><span class="op" id="4372080">.</span><span class="ident" id="4372081">Cmp</span><span class="op" id="4372084">(</span><span class="ident" id="4372085">bigOne</span><span class="op" id="4372091">)</span>&nbsp;<span class="op" id="4372093">==</span>&nbsp;<span class="num" id="4372096">0</span>&nbsp;<span class="op" id="4372098">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372103">if</span>&nbsp;<span class="ident" id="4372106">priv</span><span class="op" id="4372110">.</span><span class="ident" id="4372111">D</span><span class="op" id="4372112">.</span><span class="ident" id="4372113">Sign</span><span class="op" id="4372117">(</span><span class="op" id="4372118">)</span>&nbsp;<span class="op" id="4372120">&lt;</span>&nbsp;<span class="num" id="4372122">0</span>&nbsp;<span class="op" id="4372124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372130">priv</span><span class="op" id="4372134">.</span><span class="ident" id="4372135">D</span><span class="op" id="4372136">.</span><span class="ident" id="4372137">Add</span><span class="op" id="4372140">(</span><span class="ident" id="4372141">priv</span><span class="op" id="4372145">.</span><span class="ident" id="4372146">D</span><span class="op" id="4372147">,</span>&nbsp;<span class="ident" id="4372149">totient</span><span class="op" id="4372156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372166">priv</span><span class="op" id="4372170">.</span><span class="ident" id="4372171">Primes</span>&nbsp;<span class="op" id="4372178">=</span>&nbsp;<span class="ident" id="4372180">primes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372190">priv</span><span class="op" id="4372194">.</span><span class="ident" id="4372195">N</span>&nbsp;<span class="op" id="4372197">=</span>&nbsp;<span class="ident" id="4372199">n</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372205">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372220">priv</span><span class="op" id="4372224">.</span><span class="ident" id="4372225">Precompute</span><span class="op" id="4372235">(</span><span class="op" id="4372236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372239">return</span><br>
<span class="lineno"></span><span class="op" id="4372246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4372249">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="4372307">func</span>&nbsp;<span class="ident" id="4372312">incCounter</span><span class="op" id="4372322">(</span><span class="ident" id="4372323">c</span>&nbsp;<span class="op" id="4372325">*</span><span class="op" id="4372326">[</span><span class="num" id="4372327">4</span><span class="op" id="4372328">]</span><span class="builtintype" id="4372329">byte</span><span class="op" id="4372333">)</span>&nbsp;<span class="op" id="4372335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372338">if</span>&nbsp;<span class="ident" id="4372341">c</span><span class="op" id="4372342">[</span><span class="num" id="4372343">3</span><span class="op" id="4372344">]</span><span class="op" id="4372345">++</span><span class="op" id="4372347">;</span>&nbsp;<span class="ident" id="4372349">c</span><span class="op" id="4372350">[</span><span class="num" id="4372351">3</span><span class="op" id="4372352">]</span>&nbsp;<span class="op" id="4372354">!=</span>&nbsp;<span class="num" id="4372357">0</span>&nbsp;<span class="op" id="4372359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372363">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372374">if</span>&nbsp;<span class="ident" id="4372377">c</span><span class="op" id="4372378">[</span><span class="num" id="4372379">2</span><span class="op" id="4372380">]</span><span class="op" id="4372381">++</span><span class="op" id="4372383">;</span>&nbsp;<span class="ident" id="4372385">c</span><span class="op" id="4372386">[</span><span class="num" id="4372387">2</span><span class="op" id="4372388">]</span>&nbsp;<span class="op" id="4372390">!=</span>&nbsp;<span class="num" id="4372393">0</span>&nbsp;<span class="op" id="4372395">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372399">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372410">if</span>&nbsp;<span class="ident" id="4372413">c</span><span class="op" id="4372414">[</span><span class="num" id="4372415">1</span><span class="op" id="4372416">]</span><span class="op" id="4372417">++</span><span class="op" id="4372419">;</span>&nbsp;<span class="ident" id="4372421">c</span><span class="op" id="4372422">[</span><span class="num" id="4372423">1</span><span class="op" id="4372424">]</span>&nbsp;<span class="op" id="4372426">!=</span>&nbsp;<span class="num" id="4372429">0</span>&nbsp;<span class="op" id="4372431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372435">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372443">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372446">c</span><span class="op" id="4372447">[</span><span class="num" id="4372448">0</span><span class="op" id="4372449">]</span><span class="op" id="4372450">++</span><br>
<span class="lineno"></span><span class="op" id="4372453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4372456">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4372535">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="4372564">func</span>&nbsp;<span class="ident" id="4372569">mgf1XOR</span><span class="op" id="4372576">(</span><span class="ident" id="4372577">out</span>&nbsp;<span class="op" id="4372581">[</span><span class="op" id="4372582">]</span><span class="builtintype" id="4372583">byte</span><span class="op" id="4372587">,</span>&nbsp;<span class="ident" id="4372589">hash</span>&nbsp;<span class="ident" id="4372594">hash</span><span class="op" id="4372598">.</span><span class="ident" id="4372599">Hash</span><span class="op" id="4372603">,</span>&nbsp;<span class="ident" id="4372605">seed</span>&nbsp;<span class="op" id="4372610">[</span><span class="op" id="4372611">]</span><span class="builtintype" id="4372612">byte</span><span class="op" id="4372616">)</span>&nbsp;<span class="op" id="4372618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372621">var</span>&nbsp;<span class="ident" id="4372625">counter</span>&nbsp;<span class="op" id="4372633">[</span><span class="num" id="4372634">4</span><span class="op" id="4372635">]</span><span class="builtintype" id="4372636">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372642">var</span>&nbsp;<span class="ident" id="4372646">digest</span>&nbsp;<span class="op" id="4372653">[</span><span class="op" id="4372654">]</span><span class="builtintype" id="4372655">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372662">done</span>&nbsp;<span class="op" id="4372667">:=</span>&nbsp;<span class="num" id="4372670">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372673">for</span>&nbsp;<span class="ident" id="4372677">done</span>&nbsp;<span class="op" id="4372682">&lt;</span>&nbsp;<span class="builtinfunc" id="4372684">len</span><span class="op" id="4372687">(</span><span class="ident" id="4372688">out</span><span class="op" id="4372691">)</span>&nbsp;<span class="op" id="4372693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372697">hash</span><span class="op" id="4372701">.</span><span class="ident" id="4372702">Write</span><span class="op" id="4372707">(</span><span class="ident" id="4372708">seed</span><span class="op" id="4372712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372716">hash</span><span class="op" id="4372720">.</span><span class="ident" id="4372721">Write</span><span class="op" id="4372726">(</span><span class="ident" id="4372727">counter</span><span class="op" id="4372734">[</span><span class="num" id="4372735">0</span><span class="op" id="4372736">:</span><span class="num" id="4372737">4</span><span class="op" id="4372738">]</span><span class="op" id="4372739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372743">digest</span>&nbsp;<span class="op" id="4372750">=</span>&nbsp;<span class="ident" id="4372752">hash</span><span class="op" id="4372756">.</span><span class="ident" id="4372757">Sum</span><span class="op" id="4372760">(</span><span class="ident" id="4372761">digest</span><span class="op" id="4372767">[</span><span class="op" id="4372768">:</span><span class="num" id="4372769">0</span><span class="op" id="4372770">]</span><span class="op" id="4372771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372775">hash</span><span class="op" id="4372779">.</span><span class="ident" id="4372780">Reset</span><span class="op" id="4372785">(</span><span class="op" id="4372786">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372791">for</span>&nbsp;<span class="ident" id="4372795">i</span>&nbsp;<span class="op" id="4372797">:=</span>&nbsp;<span class="num" id="4372800">0</span><span class="op" id="4372801">;</span>&nbsp;<span class="ident" id="4372803">i</span>&nbsp;<span class="op" id="4372805">&lt;</span>&nbsp;<span class="builtinfunc" id="4372807">len</span><span class="op" id="4372810">(</span><span class="ident" id="4372811">digest</span><span class="op" id="4372817">)</span>&nbsp;<span class="op" id="4372819">&amp;&amp;</span>&nbsp;<span class="ident" id="4372822">done</span>&nbsp;<span class="op" id="4372827">&lt;</span>&nbsp;<span class="builtinfunc" id="4372829">len</span><span class="op" id="4372832">(</span><span class="ident" id="4372833">out</span><span class="op" id="4372836">)</span><span class="op" id="4372837">;</span>&nbsp;<span class="ident" id="4372839">i</span><span class="op" id="4372840">++</span>&nbsp;<span class="op" id="4372843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372848">out</span><span class="op" id="4372851">[</span><span class="ident" id="4372852">done</span><span class="op" id="4372856">]</span>&nbsp;<span class="op" id="4372858">^=</span>&nbsp;<span class="ident" id="4372861">digest</span><span class="op" id="4372867">[</span><span class="ident" id="4372868">i</span><span class="op" id="4372869">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372874">done</span><span class="op" id="4372878">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372883">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372887">incCounter</span><span class="op" id="4372897">(</span><span class="op" id="4372898">&amp;</span><span class="ident" id="4372899">counter</span><span class="op" id="4372906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372909">}</span><br>
<span class="lineno"></span><span class="op" id="4372911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4372914">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="4372993">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4373038">var</span>&nbsp;<span class="ident" id="4373042">ErrMessageTooLong</span>&nbsp;<span class="op" id="4373060">=</span>&nbsp;<span class="ident" id="4373062">errors</span><span class="op" id="4373068">.</span><span class="ident" id="4373069">New</span><span class="op" id="4373072">(</span><span class="string" id="4373073">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="4373127">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4373130">func</span>&nbsp;<span class="ident" id="4373135">encrypt</span><span class="op" id="4373142">(</span><span class="ident" id="4373143">c</span>&nbsp;<span class="op" id="4373145">*</span><span class="ident" id="4373146">big</span><span class="op" id="4373149">.</span><span class="ident" id="4373150">Int</span><span class="op" id="4373153">,</span>&nbsp;<span class="ident" id="4373155">pub</span>&nbsp;<span class="op" id="4373159">*</span><span class="ident" id="4373160">PublicKey</span><span class="op" id="4373169">,</span>&nbsp;<span class="ident" id="4373171">m</span>&nbsp;<span class="op" id="4373173">*</span><span class="ident" id="4373174">big</span><span class="op" id="4373177">.</span><span class="ident" id="4373178">Int</span><span class="op" id="4373181">)</span>&nbsp;<span class="op" id="4373183">*</span><span class="ident" id="4373184">big</span><span class="op" id="4373187">.</span><span class="ident" id="4373188">Int</span>&nbsp;<span class="op" id="4373192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373195">e</span>&nbsp;<span class="op" id="4373197">:=</span>&nbsp;<span class="ident" id="4373200">big</span><span class="op" id="4373203">.</span><span class="ident" id="4373204">NewInt</span><span class="op" id="4373210">(</span><span class="ident" id="4373211">int64</span><span class="op" id="4373216">(</span><span class="ident" id="4373217">pub</span><span class="op" id="4373220">.</span><span class="ident" id="4373221">E</span><span class="op" id="4373222">)</span><span class="op" id="4373223">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373226">c</span><span class="op" id="4373227">.</span><span class="ident" id="4373228">Exp</span><span class="op" id="4373231">(</span><span class="ident" id="4373232">m</span><span class="op" id="4373233">,</span>&nbsp;<span class="ident" id="4373235">e</span><span class="op" id="4373236">,</span>&nbsp;<span class="ident" id="4373238">pub</span><span class="op" id="4373241">.</span><span class="ident" id="4373242">N</span><span class="op" id="4373243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373246">return</span>&nbsp;<span class="ident" id="4373253">c</span><br>
<span class="lineno"></span><span class="op" id="4373255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4373258">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="4373315">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="4373391">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4373424">func</span>&nbsp;<span class="ident" id="4373429">EncryptOAEP</span><span class="op" id="4373440">(</span><span class="ident" id="4373441">hash</span>&nbsp;<span class="ident" id="4373446">hash</span><span class="op" id="4373450">.</span><span class="ident" id="4373451">Hash</span><span class="op" id="4373455">,</span>&nbsp;<span class="ident" id="4373457">random</span>&nbsp;<span class="ident" id="4373464">io</span><span class="op" id="4373466">.</span><span class="ident" id="4373467">Reader</span><span class="op" id="4373473">,</span>&nbsp;<span class="ident" id="4373475">pub</span>&nbsp;<span class="op" id="4373479">*</span><span class="ident" id="4373480">PublicKey</span><span class="op" id="4373489">,</span>&nbsp;<span class="ident" id="4373491">msg</span>&nbsp;<span class="op" id="4373495">[</span><span class="op" id="4373496">]</span><span class="builtintype" id="4373497">byte</span><span class="op" id="4373501">,</span>&nbsp;<span class="ident" id="4373503">label</span>&nbsp;<span class="op" id="4373509">[</span><span class="op" id="4373510">]</span><span class="builtintype" id="4373511">byte</span><span class="op" id="4373515">)</span>&nbsp;<span class="op" id="4373517">(</span><span class="ident" id="4373518">out</span>&nbsp;<span class="op" id="4373522">[</span><span class="op" id="4373523">]</span><span class="builtintype" id="4373524">byte</span><span class="op" id="4373528">,</span>&nbsp;<span class="ident" id="4373530">err</span>&nbsp;<span class="builtintype" id="4373534">error</span><span class="op" id="4373539">)</span>&nbsp;<span class="op" id="4373541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373544">if</span>&nbsp;<span class="ident" id="4373547">err</span>&nbsp;<span class="op" id="4373551">:=</span>&nbsp;<span class="ident" id="4373554">checkPub</span><span class="op" id="4373562">(</span><span class="ident" id="4373563">pub</span><span class="op" id="4373566">)</span><span class="op" id="4373567">;</span>&nbsp;<span class="ident" id="4373569">err</span>&nbsp;<span class="op" id="4373573">!=</span>&nbsp;<span class="ident" id="4373576">nil</span>&nbsp;<span class="op" id="4373580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373584">return</span>&nbsp;<span class="ident" id="4373591">nil</span><span class="op" id="4373594">,</span>&nbsp;<span class="ident" id="4373596">err</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4373601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373604">hash</span><span class="op" id="4373608">.</span><span class="ident" id="4373609">Reset</span><span class="op" id="4373614">(</span><span class="op" id="4373615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373618">k</span>&nbsp;<span class="op" id="4373620">:=</span>&nbsp;<span class="op" id="4373623">(</span><span class="ident" id="4373624">pub</span><span class="op" id="4373627">.</span><span class="ident" id="4373628">N</span><span class="op" id="4373629">.</span><span class="ident" id="4373630">BitLen</span><span class="op" id="4373636">(</span><span class="op" id="4373637">)</span>&nbsp;<span class="op" id="4373639">+</span>&nbsp;<span class="num" id="4373641">7</span><span class="op" id="4373642">)</span>&nbsp;<span class="op" id="4373644">/</span>&nbsp;<span class="num" id="4373646">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373649">if</span>&nbsp;<span class="builtinfunc" id="4373652">len</span><span class="op" id="4373655">(</span><span class="ident" id="4373656">msg</span><span class="op" id="4373659">)</span>&nbsp;<span class="op" id="4373661">&gt;</span>&nbsp;<span class="ident" id="4373663">k</span><span class="op" id="4373664">-</span><span class="num" id="4373665">2</span><span class="op" id="4373666">*</span><span class="ident" id="4373667">hash</span><span class="op" id="4373671">.</span><span class="ident" id="4373672">Size</span><span class="op" id="4373676">(</span><span class="op" id="4373677">)</span><span class="op" id="4373678">-</span><span class="num" id="4373679">2</span>&nbsp;<span class="op" id="4373681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373685">err</span>&nbsp;<span class="op" id="4373689">=</span>&nbsp;<span class="ident" id="4373691">ErrMessageTooLong</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373711">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4373719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373723">hash</span><span class="op" id="4373727">.</span><span class="ident" id="4373728">Write</span><span class="op" id="4373733">(</span><span class="ident" id="4373734">label</span><span class="op" id="4373739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373742">lHash</span>&nbsp;<span class="op" id="4373748">:=</span>&nbsp;<span class="ident" id="4373751">hash</span><span class="op" id="4373755">.</span><span class="ident" id="4373756">Sum</span><span class="op" id="4373759">(</span><span class="ident" id="4373760">nil</span><span class="op" id="4373763">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373766">hash</span><span class="op" id="4373770">.</span><span class="ident" id="4373771">Reset</span><span class="op" id="4373776">(</span><span class="op" id="4373777">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373781">em</span>&nbsp;<span class="op" id="4373784">:=</span>&nbsp;<span class="builtinfunc" id="4373787">make</span><span class="op" id="4373791">(</span><span class="op" id="4373792">[</span><span class="op" id="4373793">]</span><span class="builtintype" id="4373794">byte</span><span class="op" id="4373798">,</span>&nbsp;<span class="ident" id="4373800">k</span><span class="op" id="4373801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373804">seed</span>&nbsp;<span class="op" id="4373809">:=</span>&nbsp;<span class="ident" id="4373812">em</span><span class="op" id="4373814">[</span><span class="num" id="4373815">1</span>&nbsp;<span class="op" id="4373817">:</span>&nbsp;<span class="num" id="4373819">1</span><span class="op" id="4373820">+</span><span class="ident" id="4373821">hash</span><span class="op" id="4373825">.</span><span class="ident" id="4373826">Size</span><span class="op" id="4373830">(</span><span class="op" id="4373831">)</span><span class="op" id="4373832">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373835">db</span>&nbsp;<span class="op" id="4373838">:=</span>&nbsp;<span class="ident" id="4373841">em</span><span class="op" id="4373843">[</span><span class="num" id="4373844">1</span><span class="op" id="4373845">+</span><span class="ident" id="4373846">hash</span><span class="op" id="4373850">.</span><span class="ident" id="4373851">Size</span><span class="op" id="4373855">(</span><span class="op" id="4373856">)</span><span class="op" id="4373857">:</span><span class="op" id="4373858">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4373862">copy</span><span class="op" id="4373866">(</span><span class="ident" id="4373867">db</span><span class="op" id="4373869">[</span><span class="num" id="4373870">0</span><span class="op" id="4373871">:</span><span class="ident" id="4373872">hash</span><span class="op" id="4373876">.</span><span class="ident" id="4373877">Size</span><span class="op" id="4373881">(</span><span class="op" id="4373882">)</span><span class="op" id="4373883">]</span><span class="op" id="4373884">,</span>&nbsp;<span class="ident" id="4373886">lHash</span><span class="op" id="4373891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373894">db</span><span class="op" id="4373896">[</span><span class="builtinfunc" id="4373897">len</span><span class="op" id="4373900">(</span><span class="ident" id="4373901">db</span><span class="op" id="4373903">)</span><span class="op" id="4373904">-</span><span class="builtinfunc" id="4373905">len</span><span class="op" id="4373908">(</span><span class="ident" id="4373909">msg</span><span class="op" id="4373912">)</span><span class="op" id="4373913">-</span><span class="num" id="4373914">1</span><span class="op" id="4373915">]</span>&nbsp;<span class="op" id="4373917">=</span>&nbsp;<span class="num" id="4373919">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4373922">copy</span><span class="op" id="4373926">(</span><span class="ident" id="4373927">db</span><span class="op" id="4373929">[</span><span class="builtinfunc" id="4373930">len</span><span class="op" id="4373933">(</span><span class="ident" id="4373934">db</span><span class="op" id="4373936">)</span><span class="op" id="4373937">-</span><span class="builtinfunc" id="4373938">len</span><span class="op" id="4373941">(</span><span class="ident" id="4373942">msg</span><span class="op" id="4373945">)</span><span class="op" id="4373946">:</span><span class="op" id="4373947">]</span><span class="op" id="4373948">,</span>&nbsp;<span class="ident" id="4373950">msg</span><span class="op" id="4373953">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373957">_</span><span class="op" id="4373958">,</span>&nbsp;<span class="ident" id="4373960">err</span>&nbsp;<span class="op" id="4373964">=</span>&nbsp;<span class="ident" id="4373966">io</span><span class="op" id="4373968">.</span><span class="ident" id="4373969">ReadFull</span><span class="op" id="4373977">(</span><span class="ident" id="4373978">random</span><span class="op" id="4373984">,</span>&nbsp;<span class="ident" id="4373986">seed</span><span class="op" id="4373990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373993">if</span>&nbsp;<span class="ident" id="4373996">err</span>&nbsp;<span class="op" id="4374000">!=</span>&nbsp;<span class="ident" id="4374003">nil</span>&nbsp;<span class="op" id="4374007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374011">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374023">mgf1XOR</span><span class="op" id="4374030">(</span><span class="ident" id="4374031">db</span><span class="op" id="4374033">,</span>&nbsp;<span class="ident" id="4374035">hash</span><span class="op" id="4374039">,</span>&nbsp;<span class="ident" id="4374041">seed</span><span class="op" id="4374045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374048">mgf1XOR</span><span class="op" id="4374055">(</span><span class="ident" id="4374056">seed</span><span class="op" id="4374060">,</span>&nbsp;<span class="ident" id="4374062">hash</span><span class="op" id="4374066">,</span>&nbsp;<span class="ident" id="4374068">db</span><span class="op" id="4374070">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374074">m</span>&nbsp;<span class="op" id="4374076">:=</span>&nbsp;<span class="builtinfunc" id="4374079">new</span><span class="op" id="4374082">(</span><span class="ident" id="4374083">big</span><span class="op" id="4374086">.</span><span class="ident" id="4374087">Int</span><span class="op" id="4374090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374093">m</span><span class="op" id="4374094">.</span><span class="ident" id="4374095">SetBytes</span><span class="op" id="4374103">(</span><span class="ident" id="4374104">em</span><span class="op" id="4374106">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374109">c</span>&nbsp;<span class="op" id="4374111">:=</span>&nbsp;<span class="ident" id="4374114">encrypt</span><span class="op" id="4374121">(</span><span class="builtinfunc" id="4374122">new</span><span class="op" id="4374125">(</span><span class="ident" id="4374126">big</span><span class="op" id="4374129">.</span><span class="ident" id="4374130">Int</span><span class="op" id="4374133">)</span><span class="op" id="4374134">,</span>&nbsp;<span class="ident" id="4374136">pub</span><span class="op" id="4374139">,</span>&nbsp;<span class="ident" id="4374141">m</span><span class="op" id="4374142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374145">out</span>&nbsp;<span class="op" id="4374149">=</span>&nbsp;<span class="ident" id="4374151">c</span><span class="op" id="4374152">.</span><span class="ident" id="4374153">Bytes</span><span class="op" id="4374158">(</span><span class="op" id="4374159">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374163">if</span>&nbsp;<span class="builtinfunc" id="4374166">len</span><span class="op" id="4374169">(</span><span class="ident" id="4374170">out</span><span class="op" id="4374173">)</span>&nbsp;<span class="op" id="4374175">&lt;</span>&nbsp;<span class="ident" id="4374177">k</span>&nbsp;<span class="op" id="4374179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4374183">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374248">t</span>&nbsp;<span class="op" id="4374250">:=</span>&nbsp;<span class="builtinfunc" id="4374253">make</span><span class="op" id="4374257">(</span><span class="op" id="4374258">[</span><span class="op" id="4374259">]</span><span class="builtintype" id="4374260">byte</span><span class="op" id="4374264">,</span>&nbsp;<span class="ident" id="4374266">k</span><span class="op" id="4374267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4374271">copy</span><span class="op" id="4374275">(</span><span class="ident" id="4374276">t</span><span class="op" id="4374277">[</span><span class="ident" id="4374278">k</span><span class="op" id="4374279">-</span><span class="builtinfunc" id="4374280">len</span><span class="op" id="4374283">(</span><span class="ident" id="4374284">out</span><span class="op" id="4374287">)</span><span class="op" id="4374288">:</span><span class="op" id="4374289">]</span><span class="op" id="4374290">,</span>&nbsp;<span class="ident" id="4374292">out</span><span class="op" id="4374295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374299">out</span>&nbsp;<span class="op" id="4374303">=</span>&nbsp;<span class="ident" id="4374305">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374312">return</span><br>
<span class="lineno"></span><span class="op" id="4374319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4374322">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="4374382">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="4374437">var</span>&nbsp;<span class="ident" id="4374441">ErrDecryption</span>&nbsp;<span class="op" id="4374455">=</span>&nbsp;<span class="ident" id="4374457">errors</span><span class="op" id="4374463">.</span><span class="ident" id="4374464">New</span><span class="op" id="4374467">(</span><span class="string" id="4374468">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="4374498">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4374501">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="4374564">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4374619">var</span>&nbsp;<span class="ident" id="4374623">ErrVerification</span>&nbsp;<span class="op" id="4374639">=</span>&nbsp;<span class="ident" id="4374641">errors</span><span class="op" id="4374647">.</span><span class="ident" id="4374648">New</span><span class="op" id="4374651">(</span><span class="string" id="4374652">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="4374684">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="4374687">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="4374767">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="4374843">func</span>&nbsp;<span class="ident" id="4374848">modInverse</span><span class="op" id="4374858">(</span><span class="ident" id="4374859">a</span><span class="op" id="4374860">,</span>&nbsp;<span class="ident" id="4374862">n</span>&nbsp;<span class="op" id="4374864">*</span><span class="ident" id="4374865">big</span><span class="op" id="4374868">.</span><span class="ident" id="4374869">Int</span><span class="op" id="4374872">)</span>&nbsp;<span class="op" id="4374874">(</span><span class="ident" id="4374875">ia</span>&nbsp;<span class="op" id="4374878">*</span><span class="ident" id="4374879">big</span><span class="op" id="4374882">.</span><span class="ident" id="4374883">Int</span><span class="op" id="4374886">,</span>&nbsp;<span class="ident" id="4374888">ok</span>&nbsp;<span class="builtintype" id="4374891">bool</span><span class="op" id="4374895">)</span>&nbsp;<span class="op" id="4374897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374900">g</span>&nbsp;<span class="op" id="4374902">:=</span>&nbsp;<span class="builtinfunc" id="4374905">new</span><span class="op" id="4374908">(</span><span class="ident" id="4374909">big</span><span class="op" id="4374912">.</span><span class="ident" id="4374913">Int</span><span class="op" id="4374916">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374919">x</span>&nbsp;<span class="op" id="4374921">:=</span>&nbsp;<span class="builtinfunc" id="4374924">new</span><span class="op" id="4374927">(</span><span class="ident" id="4374928">big</span><span class="op" id="4374931">.</span><span class="ident" id="4374932">Int</span><span class="op" id="4374935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374938">y</span>&nbsp;<span class="op" id="4374940">:=</span>&nbsp;<span class="builtinfunc" id="4374943">new</span><span class="op" id="4374946">(</span><span class="ident" id="4374947">big</span><span class="op" id="4374950">.</span><span class="ident" id="4374951">Int</span><span class="op" id="4374954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374957">g</span><span class="op" id="4374958">.</span><span class="ident" id="4374959">GCD</span><span class="op" id="4374962">(</span><span class="ident" id="4374963">x</span><span class="op" id="4374964">,</span>&nbsp;<span class="ident" id="4374966">y</span><span class="op" id="4374967">,</span>&nbsp;<span class="ident" id="4374969">a</span><span class="op" id="4374970">,</span>&nbsp;<span class="ident" id="4374972">n</span><span class="op" id="4374973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374976">if</span>&nbsp;<span class="ident" id="4374979">g</span><span class="op" id="4374980">.</span><span class="ident" id="4374981">Cmp</span><span class="op" id="4374984">(</span><span class="ident" id="4374985">bigOne</span><span class="op" id="4374991">)</span>&nbsp;<span class="op" id="4374993">!=</span>&nbsp;<span class="num" id="4374996">0</span>&nbsp;<span class="op" id="4374998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375002">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375068">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375134">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375197">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375209">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375217">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375221">if</span>&nbsp;<span class="ident" id="4375224">x</span><span class="op" id="4375225">.</span><span class="ident" id="4375226">Cmp</span><span class="op" id="4375229">(</span><span class="ident" id="4375230">bigOne</span><span class="op" id="4375236">)</span>&nbsp;<span class="op" id="4375238">&lt;</span>&nbsp;<span class="num" id="4375240">0</span>&nbsp;<span class="op" id="4375242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375246">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375311">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375341">x</span><span class="op" id="4375342">.</span><span class="ident" id="4375343">Add</span><span class="op" id="4375346">(</span><span class="ident" id="4375347">x</span><span class="op" id="4375348">,</span>&nbsp;<span class="ident" id="4375350">n</span><span class="op" id="4375351">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375358">return</span>&nbsp;<span class="ident" id="4375365">x</span><span class="op" id="4375366">,</span>&nbsp;<span class="builtintype" id="4375368">true</span><br>
<span class="lineno"></span><span class="op" id="4375373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4375376">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="4375454">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="4375472">func</span>&nbsp;<span class="op" id="4375477">(</span><span class="ident" id="4375478">priv</span>&nbsp;<span class="op" id="4375483">*</span><span class="ident" id="4375484">PrivateKey</span><span class="op" id="4375494">)</span>&nbsp;<span class="ident" id="4375496">Precompute</span><span class="op" id="4375506">(</span><span class="op" id="4375507">)</span>&nbsp;<span class="op" id="4375509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375512">if</span>&nbsp;<span class="ident" id="4375515">priv</span><span class="op" id="4375519">.</span><span class="ident" id="4375520">Precomputed</span><span class="op" id="4375531">.</span><span class="ident" id="4375532">Dp</span>&nbsp;<span class="op" id="4375535">!=</span>&nbsp;<span class="ident" id="4375538">nil</span>&nbsp;<span class="op" id="4375542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375546">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375558">priv</span><span class="op" id="4375562">.</span><span class="ident" id="4375563">Precomputed</span><span class="op" id="4375574">.</span><span class="ident" id="4375575">Dp</span>&nbsp;<span class="op" id="4375578">=</span>&nbsp;<span class="builtinfunc" id="4375580">new</span><span class="op" id="4375583">(</span><span class="ident" id="4375584">big</span><span class="op" id="4375587">.</span><span class="ident" id="4375588">Int</span><span class="op" id="4375591">)</span><span class="op" id="4375592">.</span><span class="ident" id="4375593">Sub</span><span class="op" id="4375596">(</span><span class="ident" id="4375597">priv</span><span class="op" id="4375601">.</span><span class="ident" id="4375602">Primes</span><span class="op" id="4375608">[</span><span class="num" id="4375609">0</span><span class="op" id="4375610">]</span><span class="op" id="4375611">,</span>&nbsp;<span class="ident" id="4375613">bigOne</span><span class="op" id="4375619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375622">priv</span><span class="op" id="4375626">.</span><span class="ident" id="4375627">Precomputed</span><span class="op" id="4375638">.</span><span class="ident" id="4375639">Dp</span><span class="op" id="4375641">.</span><span class="ident" id="4375642">Mod</span><span class="op" id="4375645">(</span><span class="ident" id="4375646">priv</span><span class="op" id="4375650">.</span><span class="ident" id="4375651">D</span><span class="op" id="4375652">,</span>&nbsp;<span class="ident" id="4375654">priv</span><span class="op" id="4375658">.</span><span class="ident" id="4375659">Precomputed</span><span class="op" id="4375670">.</span><span class="ident" id="4375671">Dp</span><span class="op" id="4375673">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375677">priv</span><span class="op" id="4375681">.</span><span class="ident" id="4375682">Precomputed</span><span class="op" id="4375693">.</span><span class="ident" id="4375694">Dq</span>&nbsp;<span class="op" id="4375697">=</span>&nbsp;<span class="builtinfunc" id="4375699">new</span><span class="op" id="4375702">(</span><span class="ident" id="4375703">big</span><span class="op" id="4375706">.</span><span class="ident" id="4375707">Int</span><span class="op" id="4375710">)</span><span class="op" id="4375711">.</span><span class="ident" id="4375712">Sub</span><span class="op" id="4375715">(</span><span class="ident" id="4375716">priv</span><span class="op" id="4375720">.</span><span class="ident" id="4375721">Primes</span><span class="op" id="4375727">[</span><span class="num" id="4375728">1</span><span class="op" id="4375729">]</span><span class="op" id="4375730">,</span>&nbsp;<span class="ident" id="4375732">bigOne</span><span class="op" id="4375738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375741">priv</span><span class="op" id="4375745">.</span><span class="ident" id="4375746">Precomputed</span><span class="op" id="4375757">.</span><span class="ident" id="4375758">Dq</span><span class="op" id="4375760">.</span><span class="ident" id="4375761">Mod</span><span class="op" id="4375764">(</span><span class="ident" id="4375765">priv</span><span class="op" id="4375769">.</span><span class="ident" id="4375770">D</span><span class="op" id="4375771">,</span>&nbsp;<span class="ident" id="4375773">priv</span><span class="op" id="4375777">.</span><span class="ident" id="4375778">Precomputed</span><span class="op" id="4375789">.</span><span class="ident" id="4375790">Dq</span><span class="op" id="4375792">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375796">priv</span><span class="op" id="4375800">.</span><span class="ident" id="4375801">Precomputed</span><span class="op" id="4375812">.</span><span class="ident" id="4375813">Qinv</span>&nbsp;<span class="op" id="4375818">=</span>&nbsp;<span class="builtinfunc" id="4375820">new</span><span class="op" id="4375823">(</span><span class="ident" id="4375824">big</span><span class="op" id="4375827">.</span><span class="ident" id="4375828">Int</span><span class="op" id="4375831">)</span><span class="op" id="4375832">.</span><span class="ident" id="4375833">ModInverse</span><span class="op" id="4375843">(</span><span class="ident" id="4375844">priv</span><span class="op" id="4375848">.</span><span class="ident" id="4375849">Primes</span><span class="op" id="4375855">[</span><span class="num" id="4375856">1</span><span class="op" id="4375857">]</span><span class="op" id="4375858">,</span>&nbsp;<span class="ident" id="4375860">priv</span><span class="op" id="4375864">.</span><span class="ident" id="4375865">Primes</span><span class="op" id="4375871">[</span><span class="num" id="4375872">0</span><span class="op" id="4375873">]</span><span class="op" id="4375874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375878">r</span>&nbsp;<span class="op" id="4375880">:=</span>&nbsp;<span class="builtinfunc" id="4375883">new</span><span class="op" id="4375886">(</span><span class="ident" id="4375887">big</span><span class="op" id="4375890">.</span><span class="ident" id="4375891">Int</span><span class="op" id="4375894">)</span><span class="op" id="4375895">.</span><span class="ident" id="4375896">Mul</span><span class="op" id="4375899">(</span><span class="ident" id="4375900">priv</span><span class="op" id="4375904">.</span><span class="ident" id="4375905">Primes</span><span class="op" id="4375911">[</span><span class="num" id="4375912">0</span><span class="op" id="4375913">]</span><span class="op" id="4375914">,</span>&nbsp;<span class="ident" id="4375916">priv</span><span class="op" id="4375920">.</span><span class="ident" id="4375921">Primes</span><span class="op" id="4375927">[</span><span class="num" id="4375928">1</span><span class="op" id="4375929">]</span><span class="op" id="4375930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375933">priv</span><span class="op" id="4375937">.</span><span class="ident" id="4375938">Precomputed</span><span class="op" id="4375949">.</span><span class="ident" id="4375950">CRTValues</span>&nbsp;<span class="op" id="4375960">=</span>&nbsp;<span class="builtinfunc" id="4375962">make</span><span class="op" id="4375966">(</span><span class="op" id="4375967">[</span><span class="op" id="4375968">]</span><span class="ident" id="4375969">CRTValue</span><span class="op" id="4375977">,</span>&nbsp;<span class="builtinfunc" id="4375979">len</span><span class="op" id="4375982">(</span><span class="ident" id="4375983">priv</span><span class="op" id="4375987">.</span><span class="ident" id="4375988">Primes</span><span class="op" id="4375994">)</span><span class="op" id="4375995">-</span><span class="num" id="4375996">2</span><span class="op" id="4375997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376000">for</span>&nbsp;<span class="ident" id="4376004">i</span>&nbsp;<span class="op" id="4376006">:=</span>&nbsp;<span class="num" id="4376009">2</span><span class="op" id="4376010">;</span>&nbsp;<span class="ident" id="4376012">i</span>&nbsp;<span class="op" id="4376014">&lt;</span>&nbsp;<span class="builtinfunc" id="4376016">len</span><span class="op" id="4376019">(</span><span class="ident" id="4376020">priv</span><span class="op" id="4376024">.</span><span class="ident" id="4376025">Primes</span><span class="op" id="4376031">)</span><span class="op" id="4376032">;</span>&nbsp;<span class="ident" id="4376034">i</span><span class="op" id="4376035">++</span>&nbsp;<span class="op" id="4376038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376042">prime</span>&nbsp;<span class="op" id="4376048">:=</span>&nbsp;<span class="ident" id="4376051">priv</span><span class="op" id="4376055">.</span><span class="ident" id="4376056">Primes</span><span class="op" id="4376062">[</span><span class="ident" id="4376063">i</span><span class="op" id="4376064">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376068">values</span>&nbsp;<span class="op" id="4376075">:=</span>&nbsp;<span class="op" id="4376078">&amp;</span><span class="ident" id="4376079">priv</span><span class="op" id="4376083">.</span><span class="ident" id="4376084">Precomputed</span><span class="op" id="4376095">.</span><span class="ident" id="4376096">CRTValues</span><span class="op" id="4376105">[</span><span class="ident" id="4376106">i</span><span class="op" id="4376107">-</span><span class="num" id="4376108">2</span><span class="op" id="4376109">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376114">values</span><span class="op" id="4376120">.</span><span class="ident" id="4376121">Exp</span>&nbsp;<span class="op" id="4376125">=</span>&nbsp;<span class="builtinfunc" id="4376127">new</span><span class="op" id="4376130">(</span><span class="ident" id="4376131">big</span><span class="op" id="4376134">.</span><span class="ident" id="4376135">Int</span><span class="op" id="4376138">)</span><span class="op" id="4376139">.</span><span class="ident" id="4376140">Sub</span><span class="op" id="4376143">(</span><span class="ident" id="4376144">prime</span><span class="op" id="4376149">,</span>&nbsp;<span class="ident" id="4376151">bigOne</span><span class="op" id="4376157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376161">values</span><span class="op" id="4376167">.</span><span class="ident" id="4376168">Exp</span><span class="op" id="4376171">.</span><span class="ident" id="4376172">Mod</span><span class="op" id="4376175">(</span><span class="ident" id="4376176">priv</span><span class="op" id="4376180">.</span><span class="ident" id="4376181">D</span><span class="op" id="4376182">,</span>&nbsp;<span class="ident" id="4376184">values</span><span class="op" id="4376190">.</span><span class="ident" id="4376191">Exp</span><span class="op" id="4376194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376199">values</span><span class="op" id="4376205">.</span><span class="ident" id="4376206">R</span>&nbsp;<span class="op" id="4376208">=</span>&nbsp;<span class="builtinfunc" id="4376210">new</span><span class="op" id="4376213">(</span><span class="ident" id="4376214">big</span><span class="op" id="4376217">.</span><span class="ident" id="4376218">Int</span><span class="op" id="4376221">)</span><span class="op" id="4376222">.</span><span class="ident" id="4376223">Set</span><span class="op" id="4376226">(</span><span class="ident" id="4376227">r</span><span class="op" id="4376228">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376232">values</span><span class="op" id="4376238">.</span><span class="ident" id="4376239">Coeff</span>&nbsp;<span class="op" id="4376245">=</span>&nbsp;<span class="builtinfunc" id="4376247">new</span><span class="op" id="4376250">(</span><span class="ident" id="4376251">big</span><span class="op" id="4376254">.</span><span class="ident" id="4376255">Int</span><span class="op" id="4376258">)</span><span class="op" id="4376259">.</span><span class="ident" id="4376260">ModInverse</span><span class="op" id="4376270">(</span><span class="ident" id="4376271">r</span><span class="op" id="4376272">,</span>&nbsp;<span class="ident" id="4376274">prime</span><span class="op" id="4376279">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376284">r</span><span class="op" id="4376285">.</span><span class="ident" id="4376286">Mul</span><span class="op" id="4376289">(</span><span class="ident" id="4376290">r</span><span class="op" id="4376291">,</span>&nbsp;<span class="ident" id="4376293">prime</span><span class="op" id="4376298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376301">}</span><br>
<span class="lineno"></span><span class="op" id="4376303">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="4376306">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4376384">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4376433">func</span>&nbsp;<span class="ident" id="4376438">decrypt</span><span class="op" id="4376445">(</span><span class="ident" id="4376446">random</span>&nbsp;<span class="ident" id="4376453">io</span><span class="op" id="4376455">.</span><span class="ident" id="4376456">Reader</span><span class="op" id="4376462">,</span>&nbsp;<span class="ident" id="4376464">priv</span>&nbsp;<span class="op" id="4376469">*</span><span class="ident" id="4376470">PrivateKey</span><span class="op" id="4376480">,</span>&nbsp;<span class="ident" id="4376482">c</span>&nbsp;<span class="op" id="4376484">*</span><span class="ident" id="4376485">big</span><span class="op" id="4376488">.</span><span class="ident" id="4376489">Int</span><span class="op" id="4376492">)</span>&nbsp;<span class="op" id="4376494">(</span><span class="ident" id="4376495">m</span>&nbsp;<span class="op" id="4376497">*</span><span class="ident" id="4376498">big</span><span class="op" id="4376501">.</span><span class="ident" id="4376502">Int</span><span class="op" id="4376505">,</span>&nbsp;<span class="ident" id="4376507">err</span>&nbsp;<span class="builtintype" id="4376511">error</span><span class="op" id="4376516">)</span>&nbsp;<span class="op" id="4376518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376521">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376573">if</span>&nbsp;<span class="ident" id="4376576">c</span><span class="op" id="4376577">.</span><span class="ident" id="4376578">Cmp</span><span class="op" id="4376581">(</span><span class="ident" id="4376582">priv</span><span class="op" id="4376586">.</span><span class="ident" id="4376587">N</span><span class="op" id="4376588">)</span>&nbsp;<span class="op" id="4376590">&gt;</span>&nbsp;<span class="num" id="4376592">0</span>&nbsp;<span class="op" id="4376594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376598">err</span>&nbsp;<span class="op" id="4376602">=</span>&nbsp;<span class="ident" id="4376604">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376620">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376632">var</span>&nbsp;<span class="ident" id="4376636">ir</span>&nbsp;<span class="op" id="4376639">*</span><span class="ident" id="4376640">big</span><span class="op" id="4376643">.</span><span class="ident" id="4376644">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376649">if</span>&nbsp;<span class="ident" id="4376652">random</span>&nbsp;<span class="op" id="4376659">!=</span>&nbsp;<span class="ident" id="4376662">nil</span>&nbsp;<span class="op" id="4376666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376670">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376733">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376797">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376861">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376918">var</span>&nbsp;<span class="ident" id="4376922">r</span>&nbsp;<span class="op" id="4376924">*</span><span class="ident" id="4376925">big</span><span class="op" id="4376928">.</span><span class="ident" id="4376929">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376936">for</span>&nbsp;<span class="op" id="4376940">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376945">r</span><span class="op" id="4376946">,</span>&nbsp;<span class="ident" id="4376948">err</span>&nbsp;<span class="op" id="4376952">=</span>&nbsp;<span class="ident" id="4376954">rand</span><span class="op" id="4376958">.</span><span class="ident" id="4376959">Int</span><span class="op" id="4376962">(</span><span class="ident" id="4376963">random</span><span class="op" id="4376969">,</span>&nbsp;<span class="ident" id="4376971">priv</span><span class="op" id="4376975">.</span><span class="ident" id="4376976">N</span><span class="op" id="4376977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376982">if</span>&nbsp;<span class="ident" id="4376985">err</span>&nbsp;<span class="op" id="4376989">!=</span>&nbsp;<span class="ident" id="4376992">nil</span>&nbsp;<span class="op" id="4376996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377002">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377017">if</span>&nbsp;<span class="ident" id="4377020">r</span><span class="op" id="4377021">.</span><span class="ident" id="4377022">Cmp</span><span class="op" id="4377025">(</span><span class="ident" id="4377026">bigZero</span><span class="op" id="4377033">)</span>&nbsp;<span class="op" id="4377035">==</span>&nbsp;<span class="num" id="4377038">0</span>&nbsp;<span class="op" id="4377040">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377046">r</span>&nbsp;<span class="op" id="4377048">=</span>&nbsp;<span class="ident" id="4377050">bigOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377065">var</span>&nbsp;<span class="ident" id="4377069">ok</span>&nbsp;<span class="builtintype" id="4377072">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377080">ir</span><span class="op" id="4377082">,</span>&nbsp;<span class="ident" id="4377084">ok</span>&nbsp;<span class="op" id="4377087">=</span>&nbsp;<span class="ident" id="4377089">modInverse</span><span class="op" id="4377099">(</span><span class="ident" id="4377100">r</span><span class="op" id="4377101">,</span>&nbsp;<span class="ident" id="4377103">priv</span><span class="op" id="4377107">.</span><span class="ident" id="4377108">N</span><span class="op" id="4377109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377114">if</span>&nbsp;<span class="ident" id="4377117">ok</span>&nbsp;<span class="op" id="4377120">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377126">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377143">bigE</span>&nbsp;<span class="op" id="4377148">:=</span>&nbsp;<span class="ident" id="4377151">big</span><span class="op" id="4377154">.</span><span class="ident" id="4377155">NewInt</span><span class="op" id="4377161">(</span><span class="ident" id="4377162">int64</span><span class="op" id="4377167">(</span><span class="ident" id="4377168">priv</span><span class="op" id="4377172">.</span><span class="ident" id="4377173">E</span><span class="op" id="4377174">)</span><span class="op" id="4377175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377179">rpowe</span>&nbsp;<span class="op" id="4377185">:=</span>&nbsp;<span class="builtinfunc" id="4377188">new</span><span class="op" id="4377191">(</span><span class="ident" id="4377192">big</span><span class="op" id="4377195">.</span><span class="ident" id="4377196">Int</span><span class="op" id="4377199">)</span><span class="op" id="4377200">.</span><span class="ident" id="4377201">Exp</span><span class="op" id="4377204">(</span><span class="ident" id="4377205">r</span><span class="op" id="4377206">,</span>&nbsp;<span class="ident" id="4377208">bigE</span><span class="op" id="4377212">,</span>&nbsp;<span class="ident" id="4377214">priv</span><span class="op" id="4377218">.</span><span class="ident" id="4377219">N</span><span class="op" id="4377220">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377224">cCopy</span>&nbsp;<span class="op" id="4377230">:=</span>&nbsp;<span class="builtinfunc" id="4377233">new</span><span class="op" id="4377236">(</span><span class="ident" id="4377237">big</span><span class="op" id="4377240">.</span><span class="ident" id="4377241">Int</span><span class="op" id="4377244">)</span><span class="op" id="4377245">.</span><span class="ident" id="4377246">Set</span><span class="op" id="4377249">(</span><span class="ident" id="4377250">c</span><span class="op" id="4377251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377255">cCopy</span><span class="op" id="4377260">.</span><span class="ident" id="4377261">Mul</span><span class="op" id="4377264">(</span><span class="ident" id="4377265">cCopy</span><span class="op" id="4377270">,</span>&nbsp;<span class="ident" id="4377272">rpowe</span><span class="op" id="4377277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377281">cCopy</span><span class="op" id="4377286">.</span><span class="ident" id="4377287">Mod</span><span class="op" id="4377290">(</span><span class="ident" id="4377291">cCopy</span><span class="op" id="4377296">,</span>&nbsp;<span class="ident" id="4377298">priv</span><span class="op" id="4377302">.</span><span class="ident" id="4377303">N</span><span class="op" id="4377304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377308">c</span>&nbsp;<span class="op" id="4377310">=</span>&nbsp;<span class="ident" id="4377312">cCopy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377319">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377323">if</span>&nbsp;<span class="ident" id="4377326">priv</span><span class="op" id="4377330">.</span><span class="ident" id="4377331">Precomputed</span><span class="op" id="4377342">.</span><span class="ident" id="4377343">Dp</span>&nbsp;<span class="op" id="4377346">==</span>&nbsp;<span class="ident" id="4377349">nil</span>&nbsp;<span class="op" id="4377353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377357">m</span>&nbsp;<span class="op" id="4377359">=</span>&nbsp;<span class="builtinfunc" id="4377361">new</span><span class="op" id="4377364">(</span><span class="ident" id="4377365">big</span><span class="op" id="4377368">.</span><span class="ident" id="4377369">Int</span><span class="op" id="4377372">)</span><span class="op" id="4377373">.</span><span class="ident" id="4377374">Exp</span><span class="op" id="4377377">(</span><span class="ident" id="4377378">c</span><span class="op" id="4377379">,</span>&nbsp;<span class="ident" id="4377381">priv</span><span class="op" id="4377385">.</span><span class="ident" id="4377386">D</span><span class="op" id="4377387">,</span>&nbsp;<span class="ident" id="4377389">priv</span><span class="op" id="4377393">.</span><span class="ident" id="4377394">N</span><span class="op" id="4377395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377398">}</span>&nbsp;<span class="keyword" id="4377400">else</span>&nbsp;<span class="op" id="4377405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4377409">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377467">m</span>&nbsp;<span class="op" id="4377469">=</span>&nbsp;<span class="builtinfunc" id="4377471">new</span><span class="op" id="4377474">(</span><span class="ident" id="4377475">big</span><span class="op" id="4377478">.</span><span class="ident" id="4377479">Int</span><span class="op" id="4377482">)</span><span class="op" id="4377483">.</span><span class="ident" id="4377484">Exp</span><span class="op" id="4377487">(</span><span class="ident" id="4377488">c</span><span class="op" id="4377489">,</span>&nbsp;<span class="ident" id="4377491">priv</span><span class="op" id="4377495">.</span><span class="ident" id="4377496">Precomputed</span><span class="op" id="4377507">.</span><span class="ident" id="4377508">Dp</span><span class="op" id="4377510">,</span>&nbsp;<span class="ident" id="4377512">priv</span><span class="op" id="4377516">.</span><span class="ident" id="4377517">Primes</span><span class="op" id="4377523">[</span><span class="num" id="4377524">0</span><span class="op" id="4377525">]</span><span class="op" id="4377526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377530">m2</span>&nbsp;<span class="op" id="4377533">:=</span>&nbsp;<span class="builtinfunc" id="4377536">new</span><span class="op" id="4377539">(</span><span class="ident" id="4377540">big</span><span class="op" id="4377543">.</span><span class="ident" id="4377544">Int</span><span class="op" id="4377547">)</span><span class="op" id="4377548">.</span><span class="ident" id="4377549">Exp</span><span class="op" id="4377552">(</span><span class="ident" id="4377553">c</span><span class="op" id="4377554">,</span>&nbsp;<span class="ident" id="4377556">priv</span><span class="op" id="4377560">.</span><span class="ident" id="4377561">Precomputed</span><span class="op" id="4377572">.</span><span class="ident" id="4377573">Dq</span><span class="op" id="4377575">,</span>&nbsp;<span class="ident" id="4377577">priv</span><span class="op" id="4377581">.</span><span class="ident" id="4377582">Primes</span><span class="op" id="4377588">[</span><span class="num" id="4377589">1</span><span class="op" id="4377590">]</span><span class="op" id="4377591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377595">m</span><span class="op" id="4377596">.</span><span class="ident" id="4377597">Sub</span><span class="op" id="4377600">(</span><span class="ident" id="4377601">m</span><span class="op" id="4377602">,</span>&nbsp;<span class="ident" id="4377604">m2</span><span class="op" id="4377606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377610">if</span>&nbsp;<span class="ident" id="4377613">m</span><span class="op" id="4377614">.</span><span class="ident" id="4377615">Sign</span><span class="op" id="4377619">(</span><span class="op" id="4377620">)</span>&nbsp;<span class="op" id="4377622">&lt;</span>&nbsp;<span class="num" id="4377624">0</span>&nbsp;<span class="op" id="4377626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377631">m</span><span class="op" id="4377632">.</span><span class="ident" id="4377633">Add</span><span class="op" id="4377636">(</span><span class="ident" id="4377637">m</span><span class="op" id="4377638">,</span>&nbsp;<span class="ident" id="4377640">priv</span><span class="op" id="4377644">.</span><span class="ident" id="4377645">Primes</span><span class="op" id="4377651">[</span><span class="num" id="4377652">0</span><span class="op" id="4377653">]</span><span class="op" id="4377654">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377662">m</span><span class="op" id="4377663">.</span><span class="ident" id="4377664">Mul</span><span class="op" id="4377667">(</span><span class="ident" id="4377668">m</span><span class="op" id="4377669">,</span>&nbsp;<span class="ident" id="4377671">priv</span><span class="op" id="4377675">.</span><span class="ident" id="4377676">Precomputed</span><span class="op" id="4377687">.</span><span class="ident" id="4377688">Qinv</span><span class="op" id="4377692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377696">m</span><span class="op" id="4377697">.</span><span class="ident" id="4377698">Mod</span><span class="op" id="4377701">(</span><span class="ident" id="4377702">m</span><span class="op" id="4377703">,</span>&nbsp;<span class="ident" id="4377705">priv</span><span class="op" id="4377709">.</span><span class="ident" id="4377710">Primes</span><span class="op" id="4377716">[</span><span class="num" id="4377717">0</span><span class="op" id="4377718">]</span><span class="op" id="4377719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377723">m</span><span class="op" id="4377724">.</span><span class="ident" id="4377725">Mul</span><span class="op" id="4377728">(</span><span class="ident" id="4377729">m</span><span class="op" id="4377730">,</span>&nbsp;<span class="ident" id="4377732">priv</span><span class="op" id="4377736">.</span><span class="ident" id="4377737">Primes</span><span class="op" id="4377743">[</span><span class="num" id="4377744">1</span><span class="op" id="4377745">]</span><span class="op" id="4377746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377750">m</span><span class="op" id="4377751">.</span><span class="ident" id="4377752">Add</span><span class="op" id="4377755">(</span><span class="ident" id="4377756">m</span><span class="op" id="4377757">,</span>&nbsp;<span class="ident" id="4377759">m2</span><span class="op" id="4377761">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377766">for</span>&nbsp;<span class="ident" id="4377770">i</span><span class="op" id="4377771">,</span>&nbsp;<span class="ident" id="4377773">values</span>&nbsp;<span class="op" id="4377780">:=</span>&nbsp;<span class="keyword" id="4377783">range</span>&nbsp;<span class="ident" id="4377789">priv</span><span class="op" id="4377793">.</span><span class="ident" id="4377794">Precomputed</span><span class="op" id="4377805">.</span><span class="ident" id="4377806">CRTValues</span>&nbsp;<span class="op" id="4377816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377821">prime</span>&nbsp;<span class="op" id="4377827">:=</span>&nbsp;<span class="ident" id="4377830">priv</span><span class="op" id="4377834">.</span><span class="ident" id="4377835">Primes</span><span class="op" id="4377841">[</span><span class="num" id="4377842">2</span><span class="op" id="4377843">+</span><span class="ident" id="4377844">i</span><span class="op" id="4377845">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377850">m2</span><span class="op" id="4377852">.</span><span class="ident" id="4377853">Exp</span><span class="op" id="4377856">(</span><span class="ident" id="4377857">c</span><span class="op" id="4377858">,</span>&nbsp;<span class="ident" id="4377860">values</span><span class="op" id="4377866">.</span><span class="ident" id="4377867">Exp</span><span class="op" id="4377870">,</span>&nbsp;<span class="ident" id="4377872">prime</span><span class="op" id="4377877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377882">m2</span><span class="op" id="4377884">.</span><span class="ident" id="4377885">Sub</span><span class="op" id="4377888">(</span><span class="ident" id="4377889">m2</span><span class="op" id="4377891">,</span>&nbsp;<span class="ident" id="4377893">m</span><span class="op" id="4377894">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377899">m2</span><span class="op" id="4377901">.</span><span class="ident" id="4377902">Mul</span><span class="op" id="4377905">(</span><span class="ident" id="4377906">m2</span><span class="op" id="4377908">,</span>&nbsp;<span class="ident" id="4377910">values</span><span class="op" id="4377916">.</span><span class="ident" id="4377917">Coeff</span><span class="op" id="4377922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377927">m2</span><span class="op" id="4377929">.</span><span class="ident" id="4377930">Mod</span><span class="op" id="4377933">(</span><span class="ident" id="4377934">m2</span><span class="op" id="4377936">,</span>&nbsp;<span class="ident" id="4377938">prime</span><span class="op" id="4377943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377948">if</span>&nbsp;<span class="ident" id="4377951">m2</span><span class="op" id="4377953">.</span><span class="ident" id="4377954">Sign</span><span class="op" id="4377958">(</span><span class="op" id="4377959">)</span>&nbsp;<span class="op" id="4377961">&lt;</span>&nbsp;<span class="num" id="4377963">0</span>&nbsp;<span class="op" id="4377965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377971">m2</span><span class="op" id="4377973">.</span><span class="ident" id="4377974">Add</span><span class="op" id="4377977">(</span><span class="ident" id="4377978">m2</span><span class="op" id="4377980">,</span>&nbsp;<span class="ident" id="4377982">prime</span><span class="op" id="4377987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377992">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377997">m2</span><span class="op" id="4377999">.</span><span class="ident" id="4378000">Mul</span><span class="op" id="4378003">(</span><span class="ident" id="4378004">m2</span><span class="op" id="4378006">,</span>&nbsp;<span class="ident" id="4378008">values</span><span class="op" id="4378014">.</span><span class="ident" id="4378015">R</span><span class="op" id="4378016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378021">m</span><span class="op" id="4378022">.</span><span class="ident" id="4378023">Add</span><span class="op" id="4378026">(</span><span class="ident" id="4378027">m</span><span class="op" id="4378028">,</span>&nbsp;<span class="ident" id="4378030">m2</span><span class="op" id="4378032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4378036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4378039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378043">if</span>&nbsp;<span class="ident" id="4378046">ir</span>&nbsp;<span class="op" id="4378049">!=</span>&nbsp;<span class="ident" id="4378052">nil</span>&nbsp;<span class="op" id="4378056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4378060">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378074">m</span><span class="op" id="4378075">.</span><span class="ident" id="4378076">Mul</span><span class="op" id="4378079">(</span><span class="ident" id="4378080">m</span><span class="op" id="4378081">,</span>&nbsp;<span class="ident" id="4378083">ir</span><span class="op" id="4378085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378089">m</span><span class="op" id="4378090">.</span><span class="ident" id="4378091">Mod</span><span class="op" id="4378094">(</span><span class="ident" id="4378095">m</span><span class="op" id="4378096">,</span>&nbsp;<span class="ident" id="4378098">priv</span><span class="op" id="4378102">.</span><span class="ident" id="4378103">N</span><span class="op" id="4378104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4378107">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378111">return</span><br>
<span class="lineno"></span><span class="op" id="4378118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4378121">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="4378172">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4378261">func</span>&nbsp;<span class="ident" id="4378266">DecryptOAEP</span><span class="op" id="4378277">(</span><span class="ident" id="4378278">hash</span>&nbsp;<span class="ident" id="4378283">hash</span><span class="op" id="4378287">.</span><span class="ident" id="4378288">Hash</span><span class="op" id="4378292">,</span>&nbsp;<span class="ident" id="4378294">random</span>&nbsp;<span class="ident" id="4378301">io</span><span class="op" id="4378303">.</span><span class="ident" id="4378304">Reader</span><span class="op" id="4378310">,</span>&nbsp;<span class="ident" id="4378312">priv</span>&nbsp;<span class="op" id="4378317">*</span><span class="ident" id="4378318">PrivateKey</span><span class="op" id="4378328">,</span>&nbsp;<span class="ident" id="4378330">ciphertext</span>&nbsp;<span class="op" id="4378341">[</span><span class="op" id="4378342">]</span><span class="builtintype" id="4378343">byte</span><span class="op" id="4378347">,</span>&nbsp;<span class="ident" id="4378349">label</span>&nbsp;<span class="op" id="4378355">[</span><span class="op" id="4378356">]</span><span class="builtintype" id="4378357">byte</span><span class="op" id="4378361">)</span>&nbsp;<span class="op" id="4378363">(</span><span class="ident" id="4378364">msg</span>&nbsp;<span class="op" id="4378368">[</span><span class="op" id="4378369">]</span><span class="builtintype" id="4378370">byte</span><span class="op" id="4378374">,</span>&nbsp;<span class="ident" id="4378376">err</span>&nbsp;<span class="builtintype" id="4378380">error</span><span class="op" id="4378385">)</span>&nbsp;<span class="op" id="4378387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378390">if</span>&nbsp;<span class="ident" id="4378393">err</span>&nbsp;<span class="op" id="4378397">:=</span>&nbsp;<span class="ident" id="4378400">checkPub</span><span class="op" id="4378408">(</span><span class="op" id="4378409">&amp;</span><span class="ident" id="4378410">priv</span><span class="op" id="4378414">.</span><span class="ident" id="4378415">PublicKey</span><span class="op" id="4378424">)</span><span class="op" id="4378425">;</span>&nbsp;<span class="ident" id="4378427">err</span>&nbsp;<span class="op" id="4378431">!=</span>&nbsp;<span class="ident" id="4378434">nil</span>&nbsp;<span class="op" id="4378438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378442">return</span>&nbsp;<span class="ident" id="4378449">nil</span><span class="op" id="4378452">,</span>&nbsp;<span class="ident" id="4378454">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4378459">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378462">k</span>&nbsp;<span class="op" id="4378464">:=</span>&nbsp;<span class="op" id="4378467">(</span><span class="ident" id="4378468">priv</span><span class="op" id="4378472">.</span><span class="ident" id="4378473">N</span><span class="op" id="4378474">.</span><span class="ident" id="4378475">BitLen</span><span class="op" id="4378481">(</span><span class="op" id="4378482">)</span>&nbsp;<span class="op" id="4378484">+</span>&nbsp;<span class="num" id="4378486">7</span><span class="op" id="4378487">)</span>&nbsp;<span class="op" id="4378489">/</span>&nbsp;<span class="num" id="4378491">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378494">if</span>&nbsp;<span class="builtinfunc" id="4378497">len</span><span class="op" id="4378500">(</span><span class="ident" id="4378501">ciphertext</span><span class="op" id="4378511">)</span>&nbsp;<span class="op" id="4378513">&gt;</span>&nbsp;<span class="ident" id="4378515">k</span>&nbsp;<span class="op" id="4378517">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378522">k</span>&nbsp;<span class="op" id="4378524">&lt;</span>&nbsp;<span class="ident" id="4378526">hash</span><span class="op" id="4378530">.</span><span class="ident" id="4378531">Size</span><span class="op" id="4378535">(</span><span class="op" id="4378536">)</span><span class="op" id="4378537">*</span><span class="num" id="4378538">2</span><span class="op" id="4378539">+</span><span class="num" id="4378540">2</span>&nbsp;<span class="op" id="4378542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378546">err</span>&nbsp;<span class="op" id="4378550">=</span>&nbsp;<span class="ident" id="4378552">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378568">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4378576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378580">c</span>&nbsp;<span class="op" id="4378582">:=</span>&nbsp;<span class="builtinfunc" id="4378585">new</span><span class="op" id="4378588">(</span><span class="ident" id="4378589">big</span><span class="op" id="4378592">.</span><span class="ident" id="4378593">Int</span><span class="op" id="4378596">)</span><span class="op" id="4378597">.</span><span class="ident" id="4378598">SetBytes</span><span class="op" id="4378606">(</span><span class="ident" id="4378607">ciphertext</span><span class="op" id="4378617">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378621">m</span><span class="op" id="4378622">,</span>&nbsp;<span class="ident" id="4378624">err</span>&nbsp;<span class="op" id="4378628">:=</span>&nbsp;<span class="ident" id="4378631">decrypt</span><span class="op" id="4378638">(</span><span class="ident" id="4378639">random</span><span class="op" id="4378645">,</span>&nbsp;<span class="ident" id="4378647">priv</span><span class="op" id="4378651">,</span>&nbsp;<span class="ident" id="4378653">c</span><span class="op" id="4378654">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378657">if</span>&nbsp;<span class="ident" id="4378660">err</span>&nbsp;<span class="op" id="4378664">!=</span>&nbsp;<span class="ident" id="4378667">nil</span>&nbsp;<span class="op" id="4378671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378675">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4378683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378687">hash</span><span class="op" id="4378691">.</span><span class="ident" id="4378692">Write</span><span class="op" id="4378697">(</span><span class="ident" id="4378698">label</span><span class="op" id="4378703">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378706">lHash</span>&nbsp;<span class="op" id="4378712">:=</span>&nbsp;<span class="ident" id="4378715">hash</span><span class="op" id="4378719">.</span><span class="ident" id="4378720">Sum</span><span class="op" id="4378723">(</span><span class="ident" id="4378724">nil</span><span class="op" id="4378727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378730">hash</span><span class="op" id="4378734">.</span><span class="ident" id="4378735">Reset</span><span class="op" id="4378740">(</span><span class="op" id="4378741">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4378745">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4378805">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4378878">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4378947">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4379015">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379041">em</span>&nbsp;<span class="op" id="4379044">:=</span>&nbsp;<span class="ident" id="4379047">leftPad</span><span class="op" id="4379054">(</span><span class="ident" id="4379055">m</span><span class="op" id="4379056">.</span><span class="ident" id="4379057">Bytes</span><span class="op" id="4379062">(</span><span class="op" id="4379063">)</span><span class="op" id="4379064">,</span>&nbsp;<span class="ident" id="4379066">k</span><span class="op" id="4379067">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379071">firstByteIsZero</span>&nbsp;<span class="op" id="4379087">:=</span>&nbsp;<span class="ident" id="4379090">subtle</span><span class="op" id="4379096">.</span><span class="ident" id="4379097">ConstantTimeByteEq</span><span class="op" id="4379115">(</span><span class="ident" id="4379116">em</span><span class="op" id="4379118">[</span><span class="num" id="4379119">0</span><span class="op" id="4379120">]</span><span class="op" id="4379121">,</span>&nbsp;<span class="num" id="4379123">0</span><span class="op" id="4379124">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379128">seed</span>&nbsp;<span class="op" id="4379133">:=</span>&nbsp;<span class="ident" id="4379136">em</span><span class="op" id="4379138">[</span><span class="num" id="4379139">1</span>&nbsp;<span class="op" id="4379141">:</span>&nbsp;<span class="ident" id="4379143">hash</span><span class="op" id="4379147">.</span><span class="ident" id="4379148">Size</span><span class="op" id="4379152">(</span><span class="op" id="4379153">)</span><span class="op" id="4379154">+</span><span class="num" id="4379155">1</span><span class="op" id="4379156">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379159">db</span>&nbsp;<span class="op" id="4379162">:=</span>&nbsp;<span class="ident" id="4379165">em</span><span class="op" id="4379167">[</span><span class="ident" id="4379168">hash</span><span class="op" id="4379172">.</span><span class="ident" id="4379173">Size</span><span class="op" id="4379177">(</span><span class="op" id="4379178">)</span><span class="op" id="4379179">+</span><span class="num" id="4379180">1</span><span class="op" id="4379181">:</span><span class="op" id="4379182">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379186">mgf1XOR</span><span class="op" id="4379193">(</span><span class="ident" id="4379194">seed</span><span class="op" id="4379198">,</span>&nbsp;<span class="ident" id="4379200">hash</span><span class="op" id="4379204">,</span>&nbsp;<span class="ident" id="4379206">db</span><span class="op" id="4379208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379211">mgf1XOR</span><span class="op" id="4379218">(</span><span class="ident" id="4379219">db</span><span class="op" id="4379221">,</span>&nbsp;<span class="ident" id="4379223">hash</span><span class="op" id="4379227">,</span>&nbsp;<span class="ident" id="4379229">seed</span><span class="op" id="4379233">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379237">lHash2</span>&nbsp;<span class="op" id="4379244">:=</span>&nbsp;<span class="ident" id="4379247">db</span><span class="op" id="4379249">[</span><span class="num" id="4379250">0</span><span class="op" id="4379251">:</span><span class="ident" id="4379252">hash</span><span class="op" id="4379256">.</span><span class="ident" id="4379257">Size</span><span class="op" id="4379261">(</span><span class="op" id="4379262">)</span><span class="op" id="4379263">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4379267">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4379340">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4379411">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4379479">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379535">lHash2Good</span>&nbsp;<span class="op" id="4379546">:=</span>&nbsp;<span class="ident" id="4379549">subtle</span><span class="op" id="4379555">.</span><span class="ident" id="4379556">ConstantTimeCompare</span><span class="op" id="4379575">(</span><span class="ident" id="4379576">lHash</span><span class="op" id="4379581">,</span>&nbsp;<span class="ident" id="4379583">lHash2</span><span class="op" id="4379589">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4379593">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4379664">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4379702">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4379765">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4379812">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379873">var</span>&nbsp;<span class="ident" id="4379877">lookingForIndex</span><span class="op" id="4379892">,</span>&nbsp;<span class="ident" id="4379894">index</span><span class="op" id="4379899">,</span>&nbsp;<span class="ident" id="4379901">invalid</span>&nbsp;<span class="builtintype" id="4379909">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379914">lookingForIndex</span>&nbsp;<span class="op" id="4379930">=</span>&nbsp;<span class="num" id="4379932">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379935">rest</span>&nbsp;<span class="op" id="4379940">:=</span>&nbsp;<span class="ident" id="4379943">db</span><span class="op" id="4379945">[</span><span class="ident" id="4379946">hash</span><span class="op" id="4379950">.</span><span class="ident" id="4379951">Size</span><span class="op" id="4379955">(</span><span class="op" id="4379956">)</span><span class="op" id="4379957">:</span><span class="op" id="4379958">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379962">for</span>&nbsp;<span class="ident" id="4379966">i</span>&nbsp;<span class="op" id="4379968">:=</span>&nbsp;<span class="num" id="4379971">0</span><span class="op" id="4379972">;</span>&nbsp;<span class="ident" id="4379974">i</span>&nbsp;<span class="op" id="4379976">&lt;</span>&nbsp;<span class="builtinfunc" id="4379978">len</span><span class="op" id="4379981">(</span><span class="ident" id="4379982">rest</span><span class="op" id="4379986">)</span><span class="op" id="4379987">;</span>&nbsp;<span class="ident" id="4379989">i</span><span class="op" id="4379990">++</span>&nbsp;<span class="op" id="4379993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379997">equals0</span>&nbsp;<span class="op" id="4380005">:=</span>&nbsp;<span class="ident" id="4380008">subtle</span><span class="op" id="4380014">.</span><span class="ident" id="4380015">ConstantTimeByteEq</span><span class="op" id="4380033">(</span><span class="ident" id="4380034">rest</span><span class="op" id="4380038">[</span><span class="ident" id="4380039">i</span><span class="op" id="4380040">]</span><span class="op" id="4380041">,</span>&nbsp;<span class="num" id="4380043">0</span><span class="op" id="4380044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380048">equals1</span>&nbsp;<span class="op" id="4380056">:=</span>&nbsp;<span class="ident" id="4380059">subtle</span><span class="op" id="4380065">.</span><span class="ident" id="4380066">ConstantTimeByteEq</span><span class="op" id="4380084">(</span><span class="ident" id="4380085">rest</span><span class="op" id="4380089">[</span><span class="ident" id="4380090">i</span><span class="op" id="4380091">]</span><span class="op" id="4380092">,</span>&nbsp;<span class="num" id="4380094">1</span><span class="op" id="4380095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380099">index</span>&nbsp;<span class="op" id="4380105">=</span>&nbsp;<span class="ident" id="4380107">subtle</span><span class="op" id="4380113">.</span><span class="ident" id="4380114">ConstantTimeSelect</span><span class="op" id="4380132">(</span><span class="ident" id="4380133">lookingForIndex</span><span class="op" id="4380148">&amp;</span><span class="ident" id="4380149">equals1</span><span class="op" id="4380156">,</span>&nbsp;<span class="ident" id="4380158">i</span><span class="op" id="4380159">,</span>&nbsp;<span class="ident" id="4380161">index</span><span class="op" id="4380166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380170">lookingForIndex</span>&nbsp;<span class="op" id="4380186">=</span>&nbsp;<span class="ident" id="4380188">subtle</span><span class="op" id="4380194">.</span><span class="ident" id="4380195">ConstantTimeSelect</span><span class="op" id="4380213">(</span><span class="ident" id="4380214">equals1</span><span class="op" id="4380221">,</span>&nbsp;<span class="num" id="4380223">0</span><span class="op" id="4380224">,</span>&nbsp;<span class="ident" id="4380226">lookingForIndex</span><span class="op" id="4380241">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380245">invalid</span>&nbsp;<span class="op" id="4380253">=</span>&nbsp;<span class="ident" id="4380255">subtle</span><span class="op" id="4380261">.</span><span class="ident" id="4380262">ConstantTimeSelect</span><span class="op" id="4380280">(</span><span class="ident" id="4380281">lookingForIndex</span><span class="op" id="4380296">&amp;^</span><span class="ident" id="4380298">equals0</span><span class="op" id="4380305">,</span>&nbsp;<span class="num" id="4380307">1</span><span class="op" id="4380308">,</span>&nbsp;<span class="ident" id="4380310">invalid</span><span class="op" id="4380317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4380320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380324">if</span>&nbsp;<span class="ident" id="4380327">firstByteIsZero</span><span class="op" id="4380342">&amp;</span><span class="ident" id="4380343">lHash2Good</span><span class="op" id="4380353">&amp;^</span><span class="ident" id="4380355">invalid</span><span class="op" id="4380362">&amp;^</span><span class="ident" id="4380364">lookingForIndex</span>&nbsp;<span class="op" id="4380380">!=</span>&nbsp;<span class="num" id="4380383">1</span>&nbsp;<span class="op" id="4380385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380389">err</span>&nbsp;<span class="op" id="4380393">=</span>&nbsp;<span class="ident" id="4380395">ErrDecryption</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380411">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4380419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380423">msg</span>&nbsp;<span class="op" id="4380427">=</span>&nbsp;<span class="ident" id="4380429">rest</span><span class="op" id="4380433">[</span><span class="ident" id="4380434">index</span><span class="op" id="4380439">+</span><span class="num" id="4380440">1</span><span class="op" id="4380441">:</span><span class="op" id="4380442">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380445">return</span><br>
<span class="lineno">545</span><span class="op" id="4380452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4380455">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="4380534">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4380563">func</span>&nbsp;<span class="ident" id="4380568">leftPad</span><span class="op" id="4380575">(</span><span class="ident" id="4380576">input</span>&nbsp;<span class="op" id="4380582">[</span><span class="op" id="4380583">]</span><span class="builtintype" id="4380584">byte</span><span class="op" id="4380588">,</span>&nbsp;<span class="ident" id="4380590">size</span>&nbsp;<span class="builtintype" id="4380595">int</span><span class="op" id="4380598">)</span>&nbsp;<span class="op" id="4380600">(</span><span class="ident" id="4380601">out</span>&nbsp;<span class="op" id="4380605">[</span><span class="op" id="4380606">]</span><span class="builtintype" id="4380607">byte</span><span class="op" id="4380611">)</span>&nbsp;<span class="op" id="4380613">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380616">n</span>&nbsp;<span class="op" id="4380618">:=</span>&nbsp;<span class="builtinfunc" id="4380621">len</span><span class="op" id="4380624">(</span><span class="ident" id="4380625">input</span><span class="op" id="4380630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380633">if</span>&nbsp;<span class="ident" id="4380636">n</span>&nbsp;<span class="op" id="4380638">&gt;</span>&nbsp;<span class="ident" id="4380640">size</span>&nbsp;<span class="op" id="4380645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380649">n</span>&nbsp;<span class="op" id="4380651">=</span>&nbsp;<span class="ident" id="4380653">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4380659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380662">out</span>&nbsp;<span class="op" id="4380666">=</span>&nbsp;<span class="builtinfunc" id="4380668">make</span><span class="op" id="4380672">(</span><span class="op" id="4380673">[</span><span class="op" id="4380674">]</span><span class="builtintype" id="4380675">byte</span><span class="op" id="4380679">,</span>&nbsp;<span class="ident" id="4380681">size</span><span class="op" id="4380685">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4380688">copy</span><span class="op" id="4380692">(</span><span class="ident" id="4380693">out</span><span class="op" id="4380696">[</span><span class="builtinfunc" id="4380697">len</span><span class="op" id="4380700">(</span><span class="ident" id="4380701">out</span><span class="op" id="4380704">)</span><span class="op" id="4380705">-</span><span class="ident" id="4380706">n</span><span class="op" id="4380707">:</span><span class="op" id="4380708">]</span><span class="op" id="4380709">,</span>&nbsp;<span class="ident" id="4380711">input</span><span class="op" id="4380716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380719">return</span><br>
<span class="lineno"></span><span class="op" id="4380726">}</span>
</div>
</body>
</html>
