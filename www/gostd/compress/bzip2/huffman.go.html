<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html" class="current">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4822220">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4822275">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4822329">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4822380">package</span>&nbsp;<span class="ident" id="4822388">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4822395">import</span>&nbsp;<span class="string" id="4822402">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4822410">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="4822486">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="4822497">type</span>&nbsp;<span class="ident" id="4822502">huffmanTree</span>&nbsp;<span class="keyword" id="4822514">struct</span>&nbsp;<span class="op" id="4822521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4822524">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4822595">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4822668">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822724">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822733">[</span><span class="op" id="4822734">]</span><span class="ident" id="4822735">huffmanNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822748">nextNode</span>&nbsp;<span class="builtintype" id="4822757">int</span><br>
<span class="lineno"></span><span class="op" id="4822761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4822764">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="4822844">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="4822924">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="4822984">//</span><br>
<span class="lineno"></span><span class="comment" id="4822987">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4823064">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="4823142">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="4823192">type</span>&nbsp;<span class="ident" id="4823197">huffmanNode</span>&nbsp;<span class="keyword" id="4823209">struct</span>&nbsp;<span class="op" id="4823216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823219">left</span><span class="op" id="4823223">,</span>&nbsp;<span class="ident" id="4823225">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4823241">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823249">leftValue</span><span class="op" id="4823258">,</span>&nbsp;<span class="ident" id="4823260">rightValue</span>&nbsp;<span class="builtintype" id="4823271">uint16</span><br>
<span class="lineno"></span><span class="op" id="4823278">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4823281">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="4823358">const</span>&nbsp;<span class="ident" id="4823364">invalidNodeValue</span>&nbsp;<span class="op" id="4823381">=</span>&nbsp;<span class="num" id="4823383">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4823391">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="4823468">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="4823488">func</span>&nbsp;<span class="op" id="4823493">(</span><span class="ident" id="4823494">t</span>&nbsp;<span class="op" id="4823496">*</span><span class="ident" id="4823497">huffmanTree</span><span class="op" id="4823508">)</span>&nbsp;<span class="ident" id="4823510">Decode</span><span class="op" id="4823516">(</span><span class="ident" id="4823517">br</span>&nbsp;<span class="op" id="4823520">*</span><span class="ident" id="4823521">bitReader</span><span class="op" id="4823530">)</span>&nbsp;<span class="op" id="4823532">(</span><span class="ident" id="4823533">v</span>&nbsp;<span class="builtintype" id="4823535">uint16</span><span class="op" id="4823541">)</span>&nbsp;<span class="op" id="4823543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823546">nodeIndex</span>&nbsp;<span class="op" id="4823556">:=</span>&nbsp;<span class="builtintype" id="4823559">uint16</span><span class="op" id="4823565">(</span><span class="num" id="4823566">0</span><span class="op" id="4823567">)</span>&nbsp;<span class="comment" id="4823569">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823606">for</span>&nbsp;<span class="op" id="4823610">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823614">node</span>&nbsp;<span class="op" id="4823619">:=</span>&nbsp;<span class="op" id="4823622">&amp;</span><span class="ident" id="4823623">t</span><span class="op" id="4823624">.</span><span class="ident" id="4823625">nodes</span><span class="op" id="4823630">[</span><span class="ident" id="4823631">nodeIndex</span><span class="op" id="4823640">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823644">bit</span><span class="op" id="4823647">,</span>&nbsp;<span class="ident" id="4823649">ok</span>&nbsp;<span class="op" id="4823652">:=</span>&nbsp;<span class="ident" id="4823655">br</span><span class="op" id="4823657">.</span><span class="ident" id="4823658">TryReadBit</span><span class="op" id="4823668">(</span><span class="op" id="4823669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823673">if</span>&nbsp;<span class="op" id="4823676">!</span><span class="ident" id="4823677">ok</span>&nbsp;<span class="op" id="4823680">&amp;&amp;</span>&nbsp;<span class="ident" id="4823683">br</span><span class="op" id="4823685">.</span><span class="ident" id="4823686">ReadBit</span><span class="op" id="4823693">(</span><span class="op" id="4823694">)</span>&nbsp;<span class="op" id="4823696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823701">bit</span>&nbsp;<span class="op" id="4823705">=</span>&nbsp;<span class="num" id="4823707">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823711">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4823715">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823754">if</span>&nbsp;<span class="ident" id="4823757">bit</span>&nbsp;<span class="op" id="4823761">!=</span>&nbsp;<span class="num" id="4823764">0</span>&nbsp;<span class="op" id="4823766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4823771">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823782">if</span>&nbsp;<span class="ident" id="4823785">node</span><span class="op" id="4823789">.</span><span class="ident" id="4823790">left</span>&nbsp;<span class="op" id="4823795">==</span>&nbsp;<span class="ident" id="4823798">invalidNodeValue</span>&nbsp;<span class="op" id="4823815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823821">return</span>&nbsp;<span class="ident" id="4823828">node</span><span class="op" id="4823832">.</span><span class="ident" id="4823833">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823851">nodeIndex</span>&nbsp;<span class="op" id="4823861">=</span>&nbsp;<span class="ident" id="4823863">node</span><span class="op" id="4823867">.</span><span class="ident" id="4823868">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823875">}</span>&nbsp;<span class="keyword" id="4823877">else</span>&nbsp;<span class="op" id="4823882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4823887">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823899">if</span>&nbsp;<span class="ident" id="4823902">node</span><span class="op" id="4823906">.</span><span class="ident" id="4823907">right</span>&nbsp;<span class="op" id="4823913">==</span>&nbsp;<span class="ident" id="4823916">invalidNodeValue</span>&nbsp;<span class="op" id="4823933">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823939">return</span>&nbsp;<span class="ident" id="4823946">node</span><span class="op" id="4823950">.</span><span class="ident" id="4823951">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823970">nodeIndex</span>&nbsp;<span class="op" id="4823980">=</span>&nbsp;<span class="ident" id="4823982">node</span><span class="op" id="4823986">.</span><span class="ident" id="4823987">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823998">}</span><br>
<span class="lineno">60</span><span class="op" id="4824000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4824003">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="4824076">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4824139">func</span>&nbsp;<span class="ident" id="4824144">newHuffmanTree</span><span class="op" id="4824158">(</span><span class="ident" id="4824159">lengths</span>&nbsp;<span class="op" id="4824167">[</span><span class="op" id="4824168">]</span><span class="builtintype" id="4824169">uint8</span><span class="op" id="4824174">)</span>&nbsp;<span class="op" id="4824176">(</span><span class="ident" id="4824177">huffmanTree</span><span class="op" id="4824188">,</span>&nbsp;<span class="builtintype" id="4824190">error</span><span class="op" id="4824195">)</span>&nbsp;<span class="op" id="4824197">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824200">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824270">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824335">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824397">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824465">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824536">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824606">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824645">if</span>&nbsp;<span class="builtinfunc" id="4824648">len</span><span class="op" id="4824651">(</span><span class="ident" id="4824652">lengths</span><span class="op" id="4824659">)</span>&nbsp;<span class="op" id="4824661">&lt;</span>&nbsp;<span class="num" id="4824663">2</span>&nbsp;<span class="op" id="4824665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4824669">panic</span><span class="op" id="4824674">(</span><span class="string" id="4824675">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="4824708">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4824711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824715">var</span>&nbsp;<span class="ident" id="4824719">t</span>&nbsp;<span class="ident" id="4824721">huffmanTree</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824735">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824807">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824849">pairs</span>&nbsp;<span class="op" id="4824855">:=</span>&nbsp;<span class="ident" id="4824858">huffmanSymbolLengthPairs</span><span class="op" id="4824882">(</span><span class="builtinfunc" id="4824883">make</span><span class="op" id="4824887">(</span><span class="op" id="4824888">[</span><span class="op" id="4824889">]</span><span class="ident" id="4824890">huffmanSymbolLengthPair</span><span class="op" id="4824913">,</span>&nbsp;<span class="builtinfunc" id="4824915">len</span><span class="op" id="4824918">(</span><span class="ident" id="4824919">lengths</span><span class="op" id="4824926">)</span><span class="op" id="4824927">)</span><span class="op" id="4824928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824931">for</span>&nbsp;<span class="ident" id="4824935">i</span><span class="op" id="4824936">,</span>&nbsp;<span class="ident" id="4824938">length</span>&nbsp;<span class="op" id="4824945">:=</span>&nbsp;<span class="keyword" id="4824948">range</span>&nbsp;<span class="ident" id="4824954">lengths</span>&nbsp;<span class="op" id="4824962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824966">pairs</span><span class="op" id="4824971">[</span><span class="ident" id="4824972">i</span><span class="op" id="4824973">]</span><span class="op" id="4824974">.</span><span class="ident" id="4824975">value</span>&nbsp;<span class="op" id="4824981">=</span>&nbsp;<span class="builtintype" id="4824983">uint16</span><span class="op" id="4824989">(</span><span class="ident" id="4824990">i</span><span class="op" id="4824991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824995">pairs</span><span class="op" id="4825000">[</span><span class="ident" id="4825001">i</span><span class="op" id="4825002">]</span><span class="op" id="4825003">.</span><span class="ident" id="4825004">length</span>&nbsp;<span class="op" id="4825011">=</span>&nbsp;<span class="ident" id="4825013">length</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4825021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825025">sort</span><span class="op" id="4825029">.</span><span class="ident" id="4825030">Sort</span><span class="op" id="4825034">(</span><span class="ident" id="4825035">pairs</span><span class="op" id="4825040">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825044">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825116">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825189">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825261">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825282">code</span>&nbsp;<span class="op" id="4825287">:=</span>&nbsp;<span class="builtintype" id="4825290">uint32</span><span class="op" id="4825296">(</span><span class="num" id="4825297">0</span><span class="op" id="4825298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825301">length</span>&nbsp;<span class="op" id="4825308">:=</span>&nbsp;<span class="builtintype" id="4825311">uint8</span><span class="op" id="4825316">(</span><span class="num" id="4825317">32</span><span class="op" id="4825319">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825323">codes</span>&nbsp;<span class="op" id="4825329">:=</span>&nbsp;<span class="ident" id="4825332">huffmanCodes</span><span class="op" id="4825344">(</span><span class="builtinfunc" id="4825345">make</span><span class="op" id="4825349">(</span><span class="op" id="4825350">[</span><span class="op" id="4825351">]</span><span class="ident" id="4825352">huffmanCode</span><span class="op" id="4825363">,</span>&nbsp;<span class="builtinfunc" id="4825365">len</span><span class="op" id="4825368">(</span><span class="ident" id="4825369">lengths</span><span class="op" id="4825376">)</span><span class="op" id="4825377">)</span><span class="op" id="4825378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4825381">for</span>&nbsp;<span class="ident" id="4825385">i</span>&nbsp;<span class="op" id="4825387">:=</span>&nbsp;<span class="builtinfunc" id="4825390">len</span><span class="op" id="4825393">(</span><span class="ident" id="4825394">pairs</span><span class="op" id="4825399">)</span>&nbsp;<span class="op" id="4825401">-</span>&nbsp;<span class="num" id="4825403">1</span><span class="op" id="4825404">;</span>&nbsp;<span class="ident" id="4825406">i</span>&nbsp;<span class="op" id="4825408">&gt;=</span>&nbsp;<span class="num" id="4825411">0</span><span class="op" id="4825412">;</span>&nbsp;<span class="ident" id="4825414">i</span><span class="op" id="4825415">--</span>&nbsp;<span class="op" id="4825418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4825422">if</span>&nbsp;<span class="ident" id="4825425">length</span>&nbsp;<span class="op" id="4825432">&gt;</span>&nbsp;<span class="ident" id="4825434">pairs</span><span class="op" id="4825439">[</span><span class="ident" id="4825440">i</span><span class="op" id="4825441">]</span><span class="op" id="4825442">.</span><span class="ident" id="4825443">length</span>&nbsp;<span class="op" id="4825450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825455">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825511">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825559">length</span>&nbsp;<span class="op" id="4825566">&gt;&gt;=</span>&nbsp;<span class="num" id="4825570">32</span>&nbsp;<span class="op" id="4825573">-</span>&nbsp;<span class="ident" id="4825575">pairs</span><span class="op" id="4825580">[</span><span class="ident" id="4825581">i</span><span class="op" id="4825582">]</span><span class="op" id="4825583">.</span><span class="ident" id="4825584">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825594">length</span>&nbsp;<span class="op" id="4825601">&lt;&lt;=</span>&nbsp;<span class="num" id="4825605">32</span>&nbsp;<span class="op" id="4825608">-</span>&nbsp;<span class="ident" id="4825610">pairs</span><span class="op" id="4825615">[</span><span class="ident" id="4825616">i</span><span class="op" id="4825617">]</span><span class="op" id="4825618">.</span><span class="ident" id="4825619">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825629">length</span>&nbsp;<span class="op" id="4825636">=</span>&nbsp;<span class="ident" id="4825638">pairs</span><span class="op" id="4825643">[</span><span class="ident" id="4825644">i</span><span class="op" id="4825645">]</span><span class="op" id="4825646">.</span><span class="ident" id="4825647">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4825656">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825660">codes</span><span class="op" id="4825665">[</span><span class="ident" id="4825666">i</span><span class="op" id="4825667">]</span><span class="op" id="4825668">.</span><span class="ident" id="4825669">code</span>&nbsp;<span class="op" id="4825674">=</span>&nbsp;<span class="ident" id="4825676">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825683">codes</span><span class="op" id="4825688">[</span><span class="ident" id="4825689">i</span><span class="op" id="4825690">]</span><span class="op" id="4825691">.</span><span class="ident" id="4825692">codeLen</span>&nbsp;<span class="op" id="4825700">=</span>&nbsp;<span class="ident" id="4825702">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825711">codes</span><span class="op" id="4825716">[</span><span class="ident" id="4825717">i</span><span class="op" id="4825718">]</span><span class="op" id="4825719">.</span><span class="ident" id="4825720">value</span>&nbsp;<span class="op" id="4825726">=</span>&nbsp;<span class="ident" id="4825728">pairs</span><span class="op" id="4825733">[</span><span class="ident" id="4825734">i</span><span class="op" id="4825735">]</span><span class="op" id="4825736">.</span><span class="ident" id="4825737">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825745">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825811">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825844">code</span>&nbsp;<span class="op" id="4825849">+=</span>&nbsp;<span class="num" id="4825852">1</span>&nbsp;<span class="op" id="4825854">&lt;&lt;</span>&nbsp;<span class="op" id="4825857">(</span><span class="num" id="4825858">32</span>&nbsp;<span class="op" id="4825861">-</span>&nbsp;<span class="ident" id="4825863">length</span><span class="op" id="4825869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4825872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825876">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825949">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825984">sort</span><span class="op" id="4825988">.</span><span class="ident" id="4825989">Sort</span><span class="op" id="4825993">(</span><span class="ident" id="4825994">codes</span><span class="op" id="4825999">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826003">t</span><span class="op" id="4826004">.</span><span class="ident" id="4826005">nodes</span>&nbsp;<span class="op" id="4826011">=</span>&nbsp;<span class="builtinfunc" id="4826013">make</span><span class="op" id="4826017">(</span><span class="op" id="4826018">[</span><span class="op" id="4826019">]</span><span class="ident" id="4826020">huffmanNode</span><span class="op" id="4826031">,</span>&nbsp;<span class="builtinfunc" id="4826033">len</span><span class="op" id="4826036">(</span><span class="ident" id="4826037">codes</span><span class="op" id="4826042">)</span><span class="op" id="4826043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826046">_</span><span class="op" id="4826047">,</span>&nbsp;<span class="ident" id="4826049">err</span>&nbsp;<span class="op" id="4826053">:=</span>&nbsp;<span class="ident" id="4826056">buildHuffmanNode</span><span class="op" id="4826072">(</span><span class="op" id="4826073">&amp;</span><span class="ident" id="4826074">t</span><span class="op" id="4826075">,</span>&nbsp;<span class="ident" id="4826077">codes</span><span class="op" id="4826082">,</span>&nbsp;<span class="num" id="4826084">0</span><span class="op" id="4826085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826088">return</span>&nbsp;<span class="ident" id="4826095">t</span><span class="op" id="4826096">,</span>&nbsp;<span class="ident" id="4826098">err</span><br>
<span class="lineno">120</span><span class="op" id="4826102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4826105">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4826171">type</span>&nbsp;<span class="ident" id="4826176">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="4826200">struct</span>&nbsp;<span class="op" id="4826207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826210">value</span>&nbsp;&nbsp;<span class="builtintype" id="4826217">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826225">length</span>&nbsp;<span class="builtintype" id="4826232">uint8</span><br>
<span class="lineno"></span><span class="op" id="4826238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4826241">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="4826313">type</span>&nbsp;<span class="ident" id="4826318">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="4826343">[</span><span class="op" id="4826344">]</span><span class="ident" id="4826345">huffmanSymbolLengthPair</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="4826370">func</span>&nbsp;<span class="op" id="4826375">(</span><span class="ident" id="4826376">h</span>&nbsp;<span class="ident" id="4826378">huffmanSymbolLengthPairs</span><span class="op" id="4826402">)</span>&nbsp;<span class="ident" id="4826404">Len</span><span class="op" id="4826407">(</span><span class="op" id="4826408">)</span>&nbsp;<span class="builtintype" id="4826410">int</span>&nbsp;<span class="op" id="4826414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826417">return</span>&nbsp;<span class="builtinfunc" id="4826424">len</span><span class="op" id="4826427">(</span><span class="ident" id="4826428">h</span><span class="op" id="4826429">)</span><br>
<span class="lineno"></span><span class="op" id="4826431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="4826434">func</span>&nbsp;<span class="op" id="4826439">(</span><span class="ident" id="4826440">h</span>&nbsp;<span class="ident" id="4826442">huffmanSymbolLengthPairs</span><span class="op" id="4826466">)</span>&nbsp;<span class="ident" id="4826468">Less</span><span class="op" id="4826472">(</span><span class="ident" id="4826473">i</span><span class="op" id="4826474">,</span>&nbsp;<span class="ident" id="4826476">j</span>&nbsp;<span class="builtintype" id="4826478">int</span><span class="op" id="4826481">)</span>&nbsp;<span class="builtintype" id="4826483">bool</span>&nbsp;<span class="op" id="4826488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826491">if</span>&nbsp;<span class="ident" id="4826494">h</span><span class="op" id="4826495">[</span><span class="ident" id="4826496">i</span><span class="op" id="4826497">]</span><span class="op" id="4826498">.</span><span class="ident" id="4826499">length</span>&nbsp;<span class="op" id="4826506">&lt;</span>&nbsp;<span class="ident" id="4826508">h</span><span class="op" id="4826509">[</span><span class="ident" id="4826510">j</span><span class="op" id="4826511">]</span><span class="op" id="4826512">.</span><span class="ident" id="4826513">length</span>&nbsp;<span class="op" id="4826520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826524">return</span>&nbsp;<span class="builtintype" id="4826531">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4826537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826540">if</span>&nbsp;<span class="ident" id="4826543">h</span><span class="op" id="4826544">[</span><span class="ident" id="4826545">i</span><span class="op" id="4826546">]</span><span class="op" id="4826547">.</span><span class="ident" id="4826548">length</span>&nbsp;<span class="op" id="4826555">&gt;</span>&nbsp;<span class="ident" id="4826557">h</span><span class="op" id="4826558">[</span><span class="ident" id="4826559">j</span><span class="op" id="4826560">]</span><span class="op" id="4826561">.</span><span class="ident" id="4826562">length</span>&nbsp;<span class="op" id="4826569">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826573">return</span>&nbsp;<span class="builtintype" id="4826580">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4826587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826590">if</span>&nbsp;<span class="ident" id="4826593">h</span><span class="op" id="4826594">[</span><span class="ident" id="4826595">i</span><span class="op" id="4826596">]</span><span class="op" id="4826597">.</span><span class="ident" id="4826598">value</span>&nbsp;<span class="op" id="4826604">&lt;</span>&nbsp;<span class="ident" id="4826606">h</span><span class="op" id="4826607">[</span><span class="ident" id="4826608">j</span><span class="op" id="4826609">]</span><span class="op" id="4826610">.</span><span class="ident" id="4826611">value</span>&nbsp;<span class="op" id="4826617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826621">return</span>&nbsp;<span class="builtintype" id="4826628">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4826634">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826637">return</span>&nbsp;<span class="builtintype" id="4826644">false</span><br>
<span class="lineno"></span><span class="op" id="4826650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4826653">func</span>&nbsp;<span class="op" id="4826658">(</span><span class="ident" id="4826659">h</span>&nbsp;<span class="ident" id="4826661">huffmanSymbolLengthPairs</span><span class="op" id="4826685">)</span>&nbsp;<span class="ident" id="4826687">Swap</span><span class="op" id="4826691">(</span><span class="ident" id="4826692">i</span><span class="op" id="4826693">,</span>&nbsp;<span class="ident" id="4826695">j</span>&nbsp;<span class="builtintype" id="4826697">int</span><span class="op" id="4826700">)</span>&nbsp;<span class="op" id="4826702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826705">h</span><span class="op" id="4826706">[</span><span class="ident" id="4826707">i</span><span class="op" id="4826708">]</span><span class="op" id="4826709">,</span>&nbsp;<span class="ident" id="4826711">h</span><span class="op" id="4826712">[</span><span class="ident" id="4826713">j</span><span class="op" id="4826714">]</span>&nbsp;<span class="op" id="4826716">=</span>&nbsp;<span class="ident" id="4826718">h</span><span class="op" id="4826719">[</span><span class="ident" id="4826720">j</span><span class="op" id="4826721">]</span><span class="op" id="4826722">,</span>&nbsp;<span class="ident" id="4826724">h</span><span class="op" id="4826725">[</span><span class="ident" id="4826726">i</span><span class="op" id="4826727">]</span><br>
<span class="lineno">150</span><span class="op" id="4826729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4826732">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4826792">type</span>&nbsp;<span class="ident" id="4826797">huffmanCode</span>&nbsp;<span class="keyword" id="4826809">struct</span>&nbsp;<span class="op" id="4826816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826819">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4826827">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826835">codeLen</span>&nbsp;<span class="builtintype" id="4826843">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826850">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4826858">uint16</span><br>
<span class="lineno"></span><span class="op" id="4826865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4826868">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="4826929">type</span>&nbsp;<span class="ident" id="4826934">huffmanCodes</span>&nbsp;<span class="op" id="4826947">[</span><span class="op" id="4826948">]</span><span class="ident" id="4826949">huffmanCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4826962">func</span>&nbsp;<span class="op" id="4826967">(</span><span class="ident" id="4826968">n</span>&nbsp;<span class="ident" id="4826970">huffmanCodes</span><span class="op" id="4826982">)</span>&nbsp;<span class="ident" id="4826984">Len</span><span class="op" id="4826987">(</span><span class="op" id="4826988">)</span>&nbsp;<span class="builtintype" id="4826990">int</span>&nbsp;<span class="op" id="4826994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826997">return</span>&nbsp;<span class="builtinfunc" id="4827004">len</span><span class="op" id="4827007">(</span><span class="ident" id="4827008">n</span><span class="op" id="4827009">)</span><br>
<span class="lineno"></span><span class="op" id="4827011">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="4827014">func</span>&nbsp;<span class="op" id="4827019">(</span><span class="ident" id="4827020">n</span>&nbsp;<span class="ident" id="4827022">huffmanCodes</span><span class="op" id="4827034">)</span>&nbsp;<span class="ident" id="4827036">Less</span><span class="op" id="4827040">(</span><span class="ident" id="4827041">i</span><span class="op" id="4827042">,</span>&nbsp;<span class="ident" id="4827044">j</span>&nbsp;<span class="builtintype" id="4827046">int</span><span class="op" id="4827049">)</span>&nbsp;<span class="builtintype" id="4827051">bool</span>&nbsp;<span class="op" id="4827056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827059">return</span>&nbsp;<span class="ident" id="4827066">n</span><span class="op" id="4827067">[</span><span class="ident" id="4827068">i</span><span class="op" id="4827069">]</span><span class="op" id="4827070">.</span><span class="ident" id="4827071">code</span>&nbsp;<span class="op" id="4827076">&lt;</span>&nbsp;<span class="ident" id="4827078">n</span><span class="op" id="4827079">[</span><span class="ident" id="4827080">j</span><span class="op" id="4827081">]</span><span class="op" id="4827082">.</span><span class="ident" id="4827083">code</span><br>
<span class="lineno"></span><span class="op" id="4827088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="4827091">func</span>&nbsp;<span class="op" id="4827096">(</span><span class="ident" id="4827097">n</span>&nbsp;<span class="ident" id="4827099">huffmanCodes</span><span class="op" id="4827111">)</span>&nbsp;<span class="ident" id="4827113">Swap</span><span class="op" id="4827117">(</span><span class="ident" id="4827118">i</span><span class="op" id="4827119">,</span>&nbsp;<span class="ident" id="4827121">j</span>&nbsp;<span class="builtintype" id="4827123">int</span><span class="op" id="4827126">)</span>&nbsp;<span class="op" id="4827128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827131">n</span><span class="op" id="4827132">[</span><span class="ident" id="4827133">i</span><span class="op" id="4827134">]</span><span class="op" id="4827135">,</span>&nbsp;<span class="ident" id="4827137">n</span><span class="op" id="4827138">[</span><span class="ident" id="4827139">j</span><span class="op" id="4827140">]</span>&nbsp;<span class="op" id="4827142">=</span>&nbsp;<span class="ident" id="4827144">n</span><span class="op" id="4827145">[</span><span class="ident" id="4827146">j</span><span class="op" id="4827147">]</span><span class="op" id="4827148">,</span>&nbsp;<span class="ident" id="4827150">n</span><span class="op" id="4827151">[</span><span class="ident" id="4827152">i</span><span class="op" id="4827153">]</span><br>
<span class="lineno"></span><span class="op" id="4827155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4827158">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="4827236">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="4827310">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4827331">func</span>&nbsp;<span class="ident" id="4827336">buildHuffmanNode</span><span class="op" id="4827352">(</span><span class="ident" id="4827353">t</span>&nbsp;<span class="op" id="4827355">*</span><span class="ident" id="4827356">huffmanTree</span><span class="op" id="4827367">,</span>&nbsp;<span class="ident" id="4827369">codes</span>&nbsp;<span class="op" id="4827375">[</span><span class="op" id="4827376">]</span><span class="ident" id="4827377">huffmanCode</span><span class="op" id="4827388">,</span>&nbsp;<span class="ident" id="4827390">level</span>&nbsp;<span class="builtintype" id="4827396">uint32</span><span class="op" id="4827402">)</span>&nbsp;<span class="op" id="4827404">(</span><span class="ident" id="4827405">nodeIndex</span>&nbsp;<span class="builtintype" id="4827415">uint16</span><span class="op" id="4827421">,</span>&nbsp;<span class="ident" id="4827423">err</span>&nbsp;<span class="builtintype" id="4827427">error</span><span class="op" id="4827432">)</span>&nbsp;<span class="op" id="4827434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827437">test</span>&nbsp;<span class="op" id="4827442">:=</span>&nbsp;<span class="builtintype" id="4827445">uint32</span><span class="op" id="4827451">(</span><span class="num" id="4827452">1</span><span class="op" id="4827453">)</span>&nbsp;<span class="op" id="4827455">&lt;&lt;</span>&nbsp;<span class="op" id="4827458">(</span><span class="num" id="4827459">31</span>&nbsp;<span class="op" id="4827462">-</span>&nbsp;<span class="ident" id="4827464">level</span><span class="op" id="4827469">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827473">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827566">firstRightIndex</span>&nbsp;<span class="op" id="4827582">:=</span>&nbsp;<span class="builtinfunc" id="4827585">len</span><span class="op" id="4827588">(</span><span class="ident" id="4827589">codes</span><span class="op" id="4827594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827597">for</span>&nbsp;<span class="ident" id="4827601">i</span><span class="op" id="4827602">,</span>&nbsp;<span class="ident" id="4827604">code</span>&nbsp;<span class="op" id="4827609">:=</span>&nbsp;<span class="keyword" id="4827612">range</span>&nbsp;<span class="ident" id="4827618">codes</span>&nbsp;<span class="op" id="4827624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827628">if</span>&nbsp;<span class="ident" id="4827631">code</span><span class="op" id="4827635">.</span><span class="ident" id="4827636">code</span><span class="op" id="4827640">&amp;</span><span class="ident" id="4827641">test</span>&nbsp;<span class="op" id="4827646">!=</span>&nbsp;<span class="num" id="4827649">0</span>&nbsp;<span class="op" id="4827651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827656">firstRightIndex</span>&nbsp;<span class="op" id="4827672">=</span>&nbsp;<span class="ident" id="4827674">i</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827679">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827694">left</span>&nbsp;<span class="op" id="4827699">:=</span>&nbsp;<span class="ident" id="4827702">codes</span><span class="op" id="4827707">[</span><span class="op" id="4827708">:</span><span class="ident" id="4827709">firstRightIndex</span><span class="op" id="4827724">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827727">right</span>&nbsp;<span class="op" id="4827733">:=</span>&nbsp;<span class="ident" id="4827736">codes</span><span class="op" id="4827741">[</span><span class="ident" id="4827742">firstRightIndex</span><span class="op" id="4827757">:</span><span class="op" id="4827758">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827762">if</span>&nbsp;<span class="builtinfunc" id="4827765">len</span><span class="op" id="4827768">(</span><span class="ident" id="4827769">left</span><span class="op" id="4827773">)</span>&nbsp;<span class="op" id="4827775">==</span>&nbsp;<span class="num" id="4827778">0</span>&nbsp;<span class="op" id="4827780">||</span>&nbsp;<span class="builtinfunc" id="4827783">len</span><span class="op" id="4827786">(</span><span class="ident" id="4827787">right</span><span class="op" id="4827792">)</span>&nbsp;<span class="op" id="4827794">==</span>&nbsp;<span class="num" id="4827797">0</span>&nbsp;<span class="op" id="4827799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827803">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827868">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827934">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827966">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828029">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828092">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828140">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828145">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828210">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828276">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828338">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828393">if</span>&nbsp;<span class="builtinfunc" id="4828396">len</span><span class="op" id="4828399">(</span><span class="ident" id="4828400">codes</span><span class="op" id="4828405">)</span>&nbsp;<span class="op" id="4828407">&lt;</span>&nbsp;<span class="num" id="4828409">2</span>&nbsp;<span class="op" id="4828411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828416">return</span>&nbsp;<span class="num" id="4828423">0</span><span class="op" id="4828424">,</span>&nbsp;<span class="ident" id="4828426">StructuralError</span><span class="op" id="4828441">(</span><span class="string" id="4828442">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="4828462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828471">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828536">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828595">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828611">if</span>&nbsp;<span class="ident" id="4828614">level</span>&nbsp;<span class="op" id="4828620">==</span>&nbsp;<span class="num" id="4828623">31</span>&nbsp;<span class="op" id="4828626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828631">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828688">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828747">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828798">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828824">return</span>&nbsp;<span class="num" id="4828831">0</span><span class="op" id="4828832">,</span>&nbsp;<span class="ident" id="4828834">StructuralError</span><span class="op" id="4828849">(</span><span class="string" id="4828850">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="4828881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828890">if</span>&nbsp;<span class="builtinfunc" id="4828893">len</span><span class="op" id="4828896">(</span><span class="ident" id="4828897">left</span><span class="op" id="4828901">)</span>&nbsp;<span class="op" id="4828903">==</span>&nbsp;<span class="num" id="4828906">0</span>&nbsp;<span class="op" id="4828908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828913">return</span>&nbsp;<span class="ident" id="4828920">buildHuffmanNode</span><span class="op" id="4828936">(</span><span class="ident" id="4828937">t</span><span class="op" id="4828938">,</span>&nbsp;<span class="ident" id="4828940">right</span><span class="op" id="4828945">,</span>&nbsp;<span class="ident" id="4828947">level</span><span class="op" id="4828952">+</span><span class="num" id="4828953">1</span><span class="op" id="4828954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828962">return</span>&nbsp;<span class="ident" id="4828969">buildHuffmanNode</span><span class="op" id="4828985">(</span><span class="ident" id="4828986">t</span><span class="op" id="4828987">,</span>&nbsp;<span class="ident" id="4828989">left</span><span class="op" id="4828993">,</span>&nbsp;<span class="ident" id="4828995">level</span><span class="op" id="4829000">+</span><span class="num" id="4829001">1</span><span class="op" id="4829002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829005">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829009">nodeIndex</span>&nbsp;<span class="op" id="4829019">=</span>&nbsp;<span class="builtintype" id="4829021">uint16</span><span class="op" id="4829027">(</span><span class="ident" id="4829028">t</span><span class="op" id="4829029">.</span><span class="ident" id="4829030">nextNode</span><span class="op" id="4829038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829041">node</span>&nbsp;<span class="op" id="4829046">:=</span>&nbsp;<span class="op" id="4829049">&amp;</span><span class="ident" id="4829050">t</span><span class="op" id="4829051">.</span><span class="ident" id="4829052">nodes</span><span class="op" id="4829057">[</span><span class="ident" id="4829058">t</span><span class="op" id="4829059">.</span><span class="ident" id="4829060">nextNode</span><span class="op" id="4829068">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829071">t</span><span class="op" id="4829072">.</span><span class="ident" id="4829073">nextNode</span><span class="op" id="4829081">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829086">if</span>&nbsp;<span class="builtinfunc" id="4829089">len</span><span class="op" id="4829092">(</span><span class="ident" id="4829093">left</span><span class="op" id="4829097">)</span>&nbsp;<span class="op" id="4829099">==</span>&nbsp;<span class="num" id="4829102">1</span>&nbsp;<span class="op" id="4829104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4829108">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829123">node</span><span class="op" id="4829127">.</span><span class="ident" id="4829128">left</span>&nbsp;<span class="op" id="4829133">=</span>&nbsp;<span class="ident" id="4829135">invalidNodeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829154">node</span><span class="op" id="4829158">.</span><span class="ident" id="4829159">leftValue</span>&nbsp;<span class="op" id="4829169">=</span>&nbsp;<span class="ident" id="4829171">left</span><span class="op" id="4829175">[</span><span class="num" id="4829176">0</span><span class="op" id="4829177">]</span><span class="op" id="4829178">.</span><span class="ident" id="4829179">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829186">}</span>&nbsp;<span class="keyword" id="4829188">else</span>&nbsp;<span class="op" id="4829193">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829197">node</span><span class="op" id="4829201">.</span><span class="ident" id="4829202">left</span><span class="op" id="4829206">,</span>&nbsp;<span class="ident" id="4829208">err</span>&nbsp;<span class="op" id="4829212">=</span>&nbsp;<span class="ident" id="4829214">buildHuffmanNode</span><span class="op" id="4829230">(</span><span class="ident" id="4829231">t</span><span class="op" id="4829232">,</span>&nbsp;<span class="ident" id="4829234">left</span><span class="op" id="4829238">,</span>&nbsp;<span class="ident" id="4829240">level</span><span class="op" id="4829245">+</span><span class="num" id="4829246">1</span><span class="op" id="4829247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829254">if</span>&nbsp;<span class="ident" id="4829257">err</span>&nbsp;<span class="op" id="4829261">!=</span>&nbsp;<span class="ident" id="4829264">nil</span>&nbsp;<span class="op" id="4829268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829272">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829284">if</span>&nbsp;<span class="builtinfunc" id="4829287">len</span><span class="op" id="4829290">(</span><span class="ident" id="4829291">right</span><span class="op" id="4829296">)</span>&nbsp;<span class="op" id="4829298">==</span>&nbsp;<span class="num" id="4829301">1</span>&nbsp;<span class="op" id="4829303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4829307">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829322">node</span><span class="op" id="4829326">.</span><span class="ident" id="4829327">right</span>&nbsp;<span class="op" id="4829333">=</span>&nbsp;<span class="ident" id="4829335">invalidNodeValue</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829354">node</span><span class="op" id="4829358">.</span><span class="ident" id="4829359">rightValue</span>&nbsp;<span class="op" id="4829370">=</span>&nbsp;<span class="ident" id="4829372">right</span><span class="op" id="4829377">[</span><span class="num" id="4829378">0</span><span class="op" id="4829379">]</span><span class="op" id="4829380">.</span><span class="ident" id="4829381">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829388">}</span>&nbsp;<span class="keyword" id="4829390">else</span>&nbsp;<span class="op" id="4829395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829399">node</span><span class="op" id="4829403">.</span><span class="ident" id="4829404">right</span><span class="op" id="4829409">,</span>&nbsp;<span class="ident" id="4829411">err</span>&nbsp;<span class="op" id="4829415">=</span>&nbsp;<span class="ident" id="4829417">buildHuffmanNode</span><span class="op" id="4829433">(</span><span class="ident" id="4829434">t</span><span class="op" id="4829435">,</span>&nbsp;<span class="ident" id="4829437">right</span><span class="op" id="4829442">,</span>&nbsp;<span class="ident" id="4829444">level</span><span class="op" id="4829449">+</span><span class="num" id="4829450">1</span><span class="op" id="4829451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829458">return</span><br>
<span class="lineno"></span><span class="op" id="4829465">}</span>
</div>
</body>
</html>
