<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6139162">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6139218">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6139272">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6139323">package</span>&nbsp;<span class="ident" id="6139331">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6139338">import</span>&nbsp;<span class="op" id="6139345">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6139348">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6139359">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6139367">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6139374">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6139377">//&nbsp;GCStats&nbsp;collect&nbsp;information&nbsp;about&nbsp;recent&nbsp;garbage&nbsp;collections.</span><br>
<span class="lineno"></span><span class="keyword" id="6139442">type</span>&nbsp;<span class="ident" id="6139447">GCStats</span>&nbsp;<span class="keyword" id="6139455">struct</span>&nbsp;<span class="op" id="6139462">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139465">LastGC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139480">time</span><span class="op" id="6139484">.</span><span class="ident" id="6139485">Time</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6139496">//&nbsp;time&nbsp;of&nbsp;last&nbsp;collection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139524">NumGC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139539">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6139555">//&nbsp;number&nbsp;of&nbsp;garbage&nbsp;collections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139589">PauseTotal</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139604">time</span><span class="op" id="6139608">.</span><span class="ident" id="6139609">Duration</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6139620">//&nbsp;total&nbsp;pause&nbsp;for&nbsp;all&nbsp;collections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139656">Pause</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6139671">[</span><span class="op" id="6139672">]</span><span class="ident" id="6139673">time</span><span class="op" id="6139677">.</span><span class="ident" id="6139678">Duration</span>&nbsp;<span class="comment" id="6139687">//&nbsp;pause&nbsp;history,&nbsp;most&nbsp;recent&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139724">PauseEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6139739">[</span><span class="op" id="6139740">]</span><span class="ident" id="6139741">time</span><span class="op" id="6139745">.</span><span class="ident" id="6139746">Time</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6139755">//&nbsp;pause&nbsp;end&nbsp;times&nbsp;history,&nbsp;most&nbsp;recent&nbsp;first</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139802">PauseQuantiles</span>&nbsp;<span class="op" id="6139817">[</span><span class="op" id="6139818">]</span><span class="ident" id="6139819">time</span><span class="op" id="6139823">.</span><span class="ident" id="6139824">Duration</span><br>
<span class="lineno"></span><span class="op" id="6139833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6139836">//&nbsp;ReadGCStats&nbsp;reads&nbsp;statistics&nbsp;about&nbsp;garbage&nbsp;collection&nbsp;into&nbsp;stats.</span><br>
<span class="lineno"></span><span class="comment" id="6139905">//&nbsp;The&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;pause&nbsp;history&nbsp;is&nbsp;system-dependent;</span><br>
<span class="lineno">25</span><span class="comment" id="6139972">//&nbsp;stats.Pause&nbsp;slice&nbsp;will&nbsp;be&nbsp;reused&nbsp;if&nbsp;large&nbsp;enough,&nbsp;reallocated&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="6140048">//&nbsp;ReadGCStats&nbsp;may&nbsp;use&nbsp;the&nbsp;full&nbsp;capacity&nbsp;of&nbsp;the&nbsp;stats.Pause&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="6140115">//&nbsp;If&nbsp;stats.PauseQuantiles&nbsp;is&nbsp;non-empty,&nbsp;ReadGCStats&nbsp;fills&nbsp;it&nbsp;with&nbsp;quantiles</span><br>
<span class="lineno"></span><span class="comment" id="6140192">//&nbsp;summarizing&nbsp;the&nbsp;distribution&nbsp;of&nbsp;pause&nbsp;time.&nbsp;For&nbsp;example,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6140255">//&nbsp;len(stats.PauseQuantiles)&nbsp;is&nbsp;5,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with&nbsp;the&nbsp;minimum,</span><br>
<span class="lineno">30</span><span class="comment" id="6140326">//&nbsp;25%,&nbsp;50%,&nbsp;75%,&nbsp;and&nbsp;maximum&nbsp;pause&nbsp;times.</span><br>
<span class="lineno"></span><span class="keyword" id="6140369">func</span>&nbsp;<span class="ident" id="6140374">ReadGCStats</span><span class="op" id="6140385">(</span><span class="ident" id="6140386">stats</span>&nbsp;<span class="op" id="6140392">*</span><span class="ident" id="6140393">GCStats</span><span class="op" id="6140400">)</span>&nbsp;<span class="op" id="6140402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140405">//&nbsp;Create&nbsp;a&nbsp;buffer&nbsp;with&nbsp;space&nbsp;for&nbsp;at&nbsp;least&nbsp;two&nbsp;copies&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140467">//&nbsp;pause&nbsp;history&nbsp;tracked&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;One&nbsp;will&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140530">//&nbsp;to&nbsp;the&nbsp;caller&nbsp;and&nbsp;the&nbsp;other&nbsp;will&nbsp;be&nbsp;used&nbsp;as&nbsp;transfer&nbsp;buffer</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140594">//&nbsp;for&nbsp;end&nbsp;times&nbsp;history&nbsp;and&nbsp;as&nbsp;a&nbsp;temporary&nbsp;buffer&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140650">//&nbsp;computing&nbsp;quantiles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140675">const</span>&nbsp;<span class="ident" id="6140681">maxPause</span>&nbsp;<span class="op" id="6140690">=</span>&nbsp;<span class="builtinfunc" id="6140692">len</span><span class="op" id="6140695">(</span><span class="op" id="6140696">(</span><span class="op" id="6140697">(</span><span class="op" id="6140698">*</span><span class="ident" id="6140699">runtime</span><span class="op" id="6140706">.</span><span class="ident" id="6140707">MemStats</span><span class="op" id="6140715">)</span><span class="op" id="6140716">(</span><span class="ident" id="6140717">nil</span><span class="op" id="6140720">)</span><span class="op" id="6140721">)</span><span class="op" id="6140722">.</span><span class="ident" id="6140723">PauseNs</span><span class="op" id="6140730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140733">if</span>&nbsp;<span class="builtinfunc" id="6140736">cap</span><span class="op" id="6140739">(</span><span class="ident" id="6140740">stats</span><span class="op" id="6140745">.</span><span class="ident" id="6140746">Pause</span><span class="op" id="6140751">)</span>&nbsp;<span class="op" id="6140753">&lt;</span>&nbsp;<span class="num" id="6140755">2</span><span class="op" id="6140756">*</span><span class="ident" id="6140757">maxPause</span><span class="op" id="6140765">+</span><span class="num" id="6140766">3</span>&nbsp;<span class="op" id="6140768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140772">stats</span><span class="op" id="6140777">.</span><span class="ident" id="6140778">Pause</span>&nbsp;<span class="op" id="6140784">=</span>&nbsp;<span class="builtinfunc" id="6140786">make</span><span class="op" id="6140790">(</span><span class="op" id="6140791">[</span><span class="op" id="6140792">]</span><span class="ident" id="6140793">time</span><span class="op" id="6140797">.</span><span class="ident" id="6140798">Duration</span><span class="op" id="6140806">,</span>&nbsp;<span class="num" id="6140808">2</span><span class="op" id="6140809">*</span><span class="ident" id="6140810">maxPause</span><span class="op" id="6140818">+</span><span class="num" id="6140819">3</span><span class="op" id="6140820">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6140823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140827">//&nbsp;readGCStats&nbsp;fills&nbsp;in&nbsp;the&nbsp;pause&nbsp;and&nbsp;end&nbsp;times&nbsp;histories&nbsp;(up&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140893">//&nbsp;maxPause&nbsp;entries)&nbsp;and&nbsp;then&nbsp;three&nbsp;more:&nbsp;Unix&nbsp;ns&nbsp;time&nbsp;of&nbsp;last&nbsp;GC,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140961">//&nbsp;number&nbsp;of&nbsp;GC,&nbsp;and&nbsp;total&nbsp;pause&nbsp;time&nbsp;in&nbsp;nanoseconds.&nbsp;Here&nbsp;we</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141024">//&nbsp;depend&nbsp;on&nbsp;the&nbsp;fact&nbsp;that&nbsp;time.Duration&#39;s&nbsp;native&nbsp;unit&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141083">//&nbsp;nanoseconds,&nbsp;so&nbsp;the&nbsp;pauses&nbsp;and&nbsp;the&nbsp;total&nbsp;pause&nbsp;time&nbsp;do&nbsp;not&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141151">//&nbsp;any&nbsp;conversion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141171">readGCStats</span><span class="op" id="6141182">(</span><span class="op" id="6141183">&amp;</span><span class="ident" id="6141184">stats</span><span class="op" id="6141189">.</span><span class="ident" id="6141190">Pause</span><span class="op" id="6141195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141198">n</span>&nbsp;<span class="op" id="6141200">:=</span>&nbsp;<span class="builtinfunc" id="6141203">len</span><span class="op" id="6141206">(</span><span class="ident" id="6141207">stats</span><span class="op" id="6141212">.</span><span class="ident" id="6141213">Pause</span><span class="op" id="6141218">)</span>&nbsp;<span class="op" id="6141220">-</span>&nbsp;<span class="num" id="6141222">3</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141225">stats</span><span class="op" id="6141230">.</span><span class="ident" id="6141231">LastGC</span>&nbsp;<span class="op" id="6141238">=</span>&nbsp;<span class="ident" id="6141240">time</span><span class="op" id="6141244">.</span><span class="ident" id="6141245">Unix</span><span class="op" id="6141249">(</span><span class="num" id="6141250">0</span><span class="op" id="6141251">,</span>&nbsp;<span class="ident" id="6141253">int64</span><span class="op" id="6141258">(</span><span class="ident" id="6141259">stats</span><span class="op" id="6141264">.</span><span class="ident" id="6141265">Pause</span><span class="op" id="6141270">[</span><span class="ident" id="6141271">n</span><span class="op" id="6141272">]</span><span class="op" id="6141273">)</span><span class="op" id="6141274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141277">stats</span><span class="op" id="6141282">.</span><span class="ident" id="6141283">NumGC</span>&nbsp;<span class="op" id="6141289">=</span>&nbsp;<span class="ident" id="6141291">int64</span><span class="op" id="6141296">(</span><span class="ident" id="6141297">stats</span><span class="op" id="6141302">.</span><span class="ident" id="6141303">Pause</span><span class="op" id="6141308">[</span><span class="ident" id="6141309">n</span><span class="op" id="6141310">+</span><span class="num" id="6141311">1</span><span class="op" id="6141312">]</span><span class="op" id="6141313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141316">stats</span><span class="op" id="6141321">.</span><span class="ident" id="6141322">PauseTotal</span>&nbsp;<span class="op" id="6141333">=</span>&nbsp;<span class="ident" id="6141335">stats</span><span class="op" id="6141340">.</span><span class="ident" id="6141341">Pause</span><span class="op" id="6141346">[</span><span class="ident" id="6141347">n</span><span class="op" id="6141348">+</span><span class="num" id="6141349">2</span><span class="op" id="6141350">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141353">n</span>&nbsp;<span class="op" id="6141355">/=</span>&nbsp;<span class="num" id="6141358">2</span>&nbsp;<span class="comment" id="6141360">//&nbsp;buffer&nbsp;holds&nbsp;pauses&nbsp;and&nbsp;end&nbsp;times</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141398">stats</span><span class="op" id="6141403">.</span><span class="ident" id="6141404">Pause</span>&nbsp;<span class="op" id="6141410">=</span>&nbsp;<span class="ident" id="6141412">stats</span><span class="op" id="6141417">.</span><span class="ident" id="6141418">Pause</span><span class="op" id="6141423">[</span><span class="op" id="6141424">:</span><span class="ident" id="6141425">n</span><span class="op" id="6141426">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141430">if</span>&nbsp;<span class="builtinfunc" id="6141433">cap</span><span class="op" id="6141436">(</span><span class="ident" id="6141437">stats</span><span class="op" id="6141442">.</span><span class="ident" id="6141443">PauseEnd</span><span class="op" id="6141451">)</span>&nbsp;<span class="op" id="6141453">&lt;</span>&nbsp;<span class="ident" id="6141455">maxPause</span>&nbsp;<span class="op" id="6141464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141468">stats</span><span class="op" id="6141473">.</span><span class="ident" id="6141474">PauseEnd</span>&nbsp;<span class="op" id="6141483">=</span>&nbsp;<span class="builtinfunc" id="6141485">make</span><span class="op" id="6141489">(</span><span class="op" id="6141490">[</span><span class="op" id="6141491">]</span><span class="ident" id="6141492">time</span><span class="op" id="6141496">.</span><span class="ident" id="6141497">Time</span><span class="op" id="6141501">,</span>&nbsp;<span class="num" id="6141503">0</span><span class="op" id="6141504">,</span>&nbsp;<span class="ident" id="6141506">maxPause</span><span class="op" id="6141514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141520">stats</span><span class="op" id="6141525">.</span><span class="ident" id="6141526">PauseEnd</span>&nbsp;<span class="op" id="6141535">=</span>&nbsp;<span class="ident" id="6141537">stats</span><span class="op" id="6141542">.</span><span class="ident" id="6141543">PauseEnd</span><span class="op" id="6141551">[</span><span class="op" id="6141552">:</span><span class="num" id="6141553">0</span><span class="op" id="6141554">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141557">for</span>&nbsp;<span class="ident" id="6141561">_</span><span class="op" id="6141562">,</span>&nbsp;<span class="ident" id="6141564">ns</span>&nbsp;<span class="op" id="6141567">:=</span>&nbsp;<span class="keyword" id="6141570">range</span>&nbsp;<span class="ident" id="6141576">stats</span><span class="op" id="6141581">.</span><span class="ident" id="6141582">Pause</span><span class="op" id="6141587">[</span><span class="ident" id="6141588">n</span>&nbsp;<span class="op" id="6141590">:</span>&nbsp;<span class="ident" id="6141592">n</span><span class="op" id="6141593">+</span><span class="ident" id="6141594">n</span><span class="op" id="6141595">]</span>&nbsp;<span class="op" id="6141597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141601">stats</span><span class="op" id="6141606">.</span><span class="ident" id="6141607">PauseEnd</span>&nbsp;<span class="op" id="6141616">=</span>&nbsp;<span class="builtinfunc" id="6141618">append</span><span class="op" id="6141624">(</span><span class="ident" id="6141625">stats</span><span class="op" id="6141630">.</span><span class="ident" id="6141631">PauseEnd</span><span class="op" id="6141639">,</span>&nbsp;<span class="ident" id="6141641">time</span><span class="op" id="6141645">.</span><span class="ident" id="6141646">Unix</span><span class="op" id="6141650">(</span><span class="num" id="6141651">0</span><span class="op" id="6141652">,</span>&nbsp;<span class="ident" id="6141654">int64</span><span class="op" id="6141659">(</span><span class="ident" id="6141660">ns</span><span class="op" id="6141662">)</span><span class="op" id="6141663">)</span><span class="op" id="6141664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141671">if</span>&nbsp;<span class="builtinfunc" id="6141674">len</span><span class="op" id="6141677">(</span><span class="ident" id="6141678">stats</span><span class="op" id="6141683">.</span><span class="ident" id="6141684">PauseQuantiles</span><span class="op" id="6141698">)</span>&nbsp;<span class="op" id="6141700">&gt;</span>&nbsp;<span class="num" id="6141702">0</span>&nbsp;<span class="op" id="6141704">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141708">if</span>&nbsp;<span class="ident" id="6141711">n</span>&nbsp;<span class="op" id="6141713">==</span>&nbsp;<span class="num" id="6141716">0</span>&nbsp;<span class="op" id="6141718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141723">for</span>&nbsp;<span class="ident" id="6141727">i</span>&nbsp;<span class="op" id="6141729">:=</span>&nbsp;<span class="keyword" id="6141732">range</span>&nbsp;<span class="ident" id="6141738">stats</span><span class="op" id="6141743">.</span><span class="ident" id="6141744">PauseQuantiles</span>&nbsp;<span class="op" id="6141759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141765">stats</span><span class="op" id="6141770">.</span><span class="ident" id="6141771">PauseQuantiles</span><span class="op" id="6141785">[</span><span class="ident" id="6141786">i</span><span class="op" id="6141787">]</span>&nbsp;<span class="op" id="6141789">=</span>&nbsp;<span class="num" id="6141791">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141800">}</span>&nbsp;<span class="keyword" id="6141802">else</span>&nbsp;<span class="op" id="6141807">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141812">//&nbsp;There&#39;s&nbsp;room&nbsp;for&nbsp;a&nbsp;second&nbsp;copy&nbsp;of&nbsp;the&nbsp;data&nbsp;in&nbsp;stats.Pause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141877">//&nbsp;See&nbsp;the&nbsp;allocation&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141930">sorted</span>&nbsp;<span class="op" id="6141937">:=</span>&nbsp;<span class="ident" id="6141940">stats</span><span class="op" id="6141945">.</span><span class="ident" id="6141946">Pause</span><span class="op" id="6141951">[</span><span class="ident" id="6141952">n</span>&nbsp;<span class="op" id="6141954">:</span>&nbsp;<span class="ident" id="6141956">n</span><span class="op" id="6141957">+</span><span class="ident" id="6141958">n</span><span class="op" id="6141959">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6141964">copy</span><span class="op" id="6141968">(</span><span class="ident" id="6141969">sorted</span><span class="op" id="6141975">,</span>&nbsp;<span class="ident" id="6141977">stats</span><span class="op" id="6141982">.</span><span class="ident" id="6141983">Pause</span><span class="op" id="6141988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141993">sort</span><span class="op" id="6141997">.</span><span class="ident" id="6141998">Sort</span><span class="op" id="6142002">(</span><span class="ident" id="6142003">byDuration</span><span class="op" id="6142013">(</span><span class="ident" id="6142014">sorted</span><span class="op" id="6142020">)</span><span class="op" id="6142021">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142026">nq</span>&nbsp;<span class="op" id="6142029">:=</span>&nbsp;<span class="builtinfunc" id="6142032">len</span><span class="op" id="6142035">(</span><span class="ident" id="6142036">stats</span><span class="op" id="6142041">.</span><span class="ident" id="6142042">PauseQuantiles</span><span class="op" id="6142056">)</span>&nbsp;<span class="op" id="6142058">-</span>&nbsp;<span class="num" id="6142060">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142065">for</span>&nbsp;<span class="ident" id="6142069">i</span>&nbsp;<span class="op" id="6142071">:=</span>&nbsp;<span class="num" id="6142074">0</span><span class="op" id="6142075">;</span>&nbsp;<span class="ident" id="6142077">i</span>&nbsp;<span class="op" id="6142079">&lt;</span>&nbsp;<span class="ident" id="6142081">nq</span><span class="op" id="6142083">;</span>&nbsp;<span class="ident" id="6142085">i</span><span class="op" id="6142086">++</span>&nbsp;<span class="op" id="6142089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142095">stats</span><span class="op" id="6142100">.</span><span class="ident" id="6142101">PauseQuantiles</span><span class="op" id="6142115">[</span><span class="ident" id="6142116">i</span><span class="op" id="6142117">]</span>&nbsp;<span class="op" id="6142119">=</span>&nbsp;<span class="ident" id="6142121">sorted</span><span class="op" id="6142127">[</span><span class="builtinfunc" id="6142128">len</span><span class="op" id="6142131">(</span><span class="ident" id="6142132">sorted</span><span class="op" id="6142138">)</span><span class="op" id="6142139">*</span><span class="ident" id="6142140">i</span><span class="op" id="6142141">/</span><span class="ident" id="6142142">nq</span><span class="op" id="6142144">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142154">stats</span><span class="op" id="6142159">.</span><span class="ident" id="6142160">PauseQuantiles</span><span class="op" id="6142174">[</span><span class="ident" id="6142175">nq</span><span class="op" id="6142177">]</span>&nbsp;<span class="op" id="6142179">=</span>&nbsp;<span class="ident" id="6142181">sorted</span><span class="op" id="6142187">[</span><span class="builtinfunc" id="6142188">len</span><span class="op" id="6142191">(</span><span class="ident" id="6142192">sorted</span><span class="op" id="6142198">)</span><span class="op" id="6142199">-</span><span class="num" id="6142200">1</span><span class="op" id="6142201">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142208">}</span><br>
<span class="lineno"></span><span class="op" id="6142210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6142213">type</span>&nbsp;<span class="ident" id="6142218">byDuration</span>&nbsp;<span class="op" id="6142229">[</span><span class="op" id="6142230">]</span><span class="ident" id="6142231">time</span><span class="op" id="6142235">.</span><span class="ident" id="6142236">Duration</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="6142246">func</span>&nbsp;<span class="op" id="6142251">(</span><span class="ident" id="6142252">x</span>&nbsp;<span class="ident" id="6142254">byDuration</span><span class="op" id="6142264">)</span>&nbsp;<span class="ident" id="6142266">Len</span><span class="op" id="6142269">(</span><span class="op" id="6142270">)</span>&nbsp;<span class="builtintype" id="6142272">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6142286">{</span>&nbsp;<span class="keyword" id="6142288">return</span>&nbsp;<span class="builtinfunc" id="6142295">len</span><span class="op" id="6142298">(</span><span class="ident" id="6142299">x</span><span class="op" id="6142300">)</span>&nbsp;<span class="op" id="6142302">}</span><br>
<span class="lineno"></span><span class="keyword" id="6142304">func</span>&nbsp;<span class="op" id="6142309">(</span><span class="ident" id="6142310">x</span>&nbsp;<span class="ident" id="6142312">byDuration</span><span class="op" id="6142322">)</span>&nbsp;<span class="ident" id="6142324">Swap</span><span class="op" id="6142328">(</span><span class="ident" id="6142329">i</span><span class="op" id="6142330">,</span>&nbsp;<span class="ident" id="6142332">j</span>&nbsp;<span class="builtintype" id="6142334">int</span><span class="op" id="6142337">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6142344">{</span>&nbsp;<span class="ident" id="6142346">x</span><span class="op" id="6142347">[</span><span class="ident" id="6142348">i</span><span class="op" id="6142349">]</span><span class="op" id="6142350">,</span>&nbsp;<span class="ident" id="6142352">x</span><span class="op" id="6142353">[</span><span class="ident" id="6142354">j</span><span class="op" id="6142355">]</span>&nbsp;<span class="op" id="6142357">=</span>&nbsp;<span class="ident" id="6142359">x</span><span class="op" id="6142360">[</span><span class="ident" id="6142361">j</span><span class="op" id="6142362">]</span><span class="op" id="6142363">,</span>&nbsp;<span class="ident" id="6142365">x</span><span class="op" id="6142366">[</span><span class="ident" id="6142367">i</span><span class="op" id="6142368">]</span>&nbsp;<span class="op" id="6142370">}</span><br>
<span class="lineno"></span><span class="keyword" id="6142372">func</span>&nbsp;<span class="op" id="6142377">(</span><span class="ident" id="6142378">x</span>&nbsp;<span class="ident" id="6142380">byDuration</span><span class="op" id="6142390">)</span>&nbsp;<span class="ident" id="6142392">Less</span><span class="op" id="6142396">(</span><span class="ident" id="6142397">i</span><span class="op" id="6142398">,</span>&nbsp;<span class="ident" id="6142400">j</span>&nbsp;<span class="builtintype" id="6142402">int</span><span class="op" id="6142405">)</span>&nbsp;<span class="builtintype" id="6142407">bool</span>&nbsp;<span class="op" id="6142412">{</span>&nbsp;<span class="keyword" id="6142414">return</span>&nbsp;<span class="ident" id="6142421">x</span><span class="op" id="6142422">[</span><span class="ident" id="6142423">i</span><span class="op" id="6142424">]</span>&nbsp;<span class="op" id="6142426">&lt;</span>&nbsp;<span class="ident" id="6142428">x</span><span class="op" id="6142429">[</span><span class="ident" id="6142430">j</span><span class="op" id="6142431">]</span>&nbsp;<span class="op" id="6142433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="6142436">//&nbsp;SetGCPercent&nbsp;sets&nbsp;the&nbsp;garbage&nbsp;collection&nbsp;target&nbsp;percentage:</span><br>
<span class="lineno"></span><span class="comment" id="6142499">//&nbsp;a&nbsp;collection&nbsp;is&nbsp;triggered&nbsp;when&nbsp;the&nbsp;ratio&nbsp;of&nbsp;freshly&nbsp;allocated&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6142569">//&nbsp;to&nbsp;live&nbsp;data&nbsp;remaining&nbsp;after&nbsp;the&nbsp;previous&nbsp;collection&nbsp;reaches&nbsp;this&nbsp;percentage.</span><br>
<span class="lineno"></span><span class="comment" id="6142650">//&nbsp;SetGCPercent&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.</span><br>
<span class="lineno"></span><span class="comment" id="6142696">//&nbsp;The&nbsp;initial&nbsp;setting&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;GOGC&nbsp;environment&nbsp;variable</span><br>
<span class="lineno">95</span><span class="comment" id="6142765">//&nbsp;at&nbsp;startup,&nbsp;or&nbsp;100&nbsp;if&nbsp;the&nbsp;variable&nbsp;is&nbsp;not&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="6142815">//&nbsp;A&nbsp;negative&nbsp;percentage&nbsp;disables&nbsp;garbage&nbsp;collection.</span><br>
<span class="lineno"></span><span class="keyword" id="6142869">func</span>&nbsp;<span class="ident" id="6142874">SetGCPercent</span><span class="op" id="6142886">(</span><span class="ident" id="6142887">percent</span>&nbsp;<span class="builtintype" id="6142895">int</span><span class="op" id="6142898">)</span>&nbsp;<span class="builtintype" id="6142900">int</span>&nbsp;<span class="op" id="6142904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142907">old</span>&nbsp;<span class="op" id="6142911">:=</span>&nbsp;<span class="ident" id="6142914">setGCPercent</span><span class="op" id="6142926">(</span><span class="builtintype" id="6142927">int32</span><span class="op" id="6142932">(</span><span class="ident" id="6142933">percent</span><span class="op" id="6142940">)</span><span class="op" id="6142941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142944">runtime</span><span class="op" id="6142951">.</span><span class="ident" id="6142952">GC</span><span class="op" id="6142954">(</span><span class="op" id="6142955">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142958">return</span>&nbsp;<span class="builtintype" id="6142965">int</span><span class="op" id="6142968">(</span><span class="ident" id="6142969">old</span><span class="op" id="6142972">)</span><br>
<span class="lineno"></span><span class="op" id="6142974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6142977">//&nbsp;FreeOSMemory&nbsp;forces&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;followed&nbsp;by&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6143036">//&nbsp;attempt&nbsp;to&nbsp;return&nbsp;as&nbsp;much&nbsp;memory&nbsp;to&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno">105</span><span class="comment" id="6143096">//&nbsp;as&nbsp;possible.&nbsp;(Even&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;called,&nbsp;the&nbsp;runtime&nbsp;gradually</span><br>
<span class="lineno"></span><span class="comment" id="6143163">//&nbsp;returns&nbsp;memory&nbsp;to&nbsp;the&nbsp;operating&nbsp;system&nbsp;in&nbsp;a&nbsp;background&nbsp;task.)</span><br>
<span class="lineno"></span><span class="keyword" id="6143228">func</span>&nbsp;<span class="ident" id="6143233">FreeOSMemory</span><span class="op" id="6143245">(</span><span class="op" id="6143246">)</span>&nbsp;<span class="op" id="6143248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6143251">freeOSMemory</span><span class="op" id="6143263">(</span><span class="op" id="6143264">)</span><br>
<span class="lineno"></span><span class="op" id="6143266">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="6143269">//&nbsp;SetMaxStack&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;memory&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6143323">//&nbsp;can&nbsp;be&nbsp;used&nbsp;by&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="6143367">//&nbsp;If&nbsp;any&nbsp;goroutine&nbsp;exceeds&nbsp;this&nbsp;limit&nbsp;while&nbsp;growing&nbsp;its&nbsp;stack,</span><br>
<span class="lineno"></span><span class="comment" id="6143431">//&nbsp;the&nbsp;program&nbsp;crashes.</span><br>
<span class="lineno">115</span><span class="comment" id="6143455">//&nbsp;SetMaxStack&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.</span><br>
<span class="lineno"></span><span class="comment" id="6143500">//&nbsp;The&nbsp;initial&nbsp;setting&nbsp;is&nbsp;1&nbsp;GB&nbsp;on&nbsp;64-bit&nbsp;systems,&nbsp;250&nbsp;MB&nbsp;on&nbsp;32-bit&nbsp;systems.</span><br>
<span class="lineno"></span><span class="comment" id="6143576">//</span><br>
<span class="lineno"></span><span class="comment" id="6143579">//&nbsp;SetMaxStack&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;limiting&nbsp;the&nbsp;damage&nbsp;done&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6143643">//&nbsp;goroutines&nbsp;that&nbsp;enter&nbsp;an&nbsp;infinite&nbsp;recursion.&nbsp;It&nbsp;only&nbsp;limits&nbsp;future</span><br>
<span class="lineno">120</span><span class="comment" id="6143713">//&nbsp;stack&nbsp;growth.</span><br>
<span class="lineno"></span><span class="keyword" id="6143730">func</span>&nbsp;<span class="ident" id="6143735">SetMaxStack</span><span class="op" id="6143746">(</span><span class="ident" id="6143747">bytes</span>&nbsp;<span class="builtintype" id="6143753">int</span><span class="op" id="6143756">)</span>&nbsp;<span class="builtintype" id="6143758">int</span>&nbsp;<span class="op" id="6143762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6143765">return</span>&nbsp;<span class="ident" id="6143772">setMaxStack</span><span class="op" id="6143783">(</span><span class="ident" id="6143784">bytes</span><span class="op" id="6143789">)</span><br>
<span class="lineno"></span><span class="op" id="6143791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="6143794">//&nbsp;SetMaxThreads&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span><span class="comment" id="6143855">//&nbsp;threads&nbsp;that&nbsp;the&nbsp;Go&nbsp;program&nbsp;can&nbsp;use.&nbsp;If&nbsp;it&nbsp;attempts&nbsp;to&nbsp;use&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="6143927">//&nbsp;this&nbsp;many,&nbsp;the&nbsp;program&nbsp;crashes.</span><br>
<span class="lineno"></span><span class="comment" id="6143962">//&nbsp;SetMaxThreads&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.</span><br>
<span class="lineno"></span><span class="comment" id="6144009">//&nbsp;The&nbsp;initial&nbsp;setting&nbsp;is&nbsp;10,000&nbsp;threads.</span><br>
<span class="lineno">130</span><span class="comment" id="6144051">//</span><br>
<span class="lineno"></span><span class="comment" id="6144054">//&nbsp;The&nbsp;limit&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;operating&nbsp;system&nbsp;threads,&nbsp;not&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="6144131">//&nbsp;of&nbsp;goroutines.&nbsp;A&nbsp;Go&nbsp;program&nbsp;creates&nbsp;a&nbsp;new&nbsp;thread&nbsp;only&nbsp;when&nbsp;a&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="6144205">//&nbsp;is&nbsp;ready&nbsp;to&nbsp;run&nbsp;but&nbsp;all&nbsp;the&nbsp;existing&nbsp;threads&nbsp;are&nbsp;blocked&nbsp;in&nbsp;system&nbsp;calls,&nbsp;cgo&nbsp;calls,</span><br>
<span class="lineno"></span><span class="comment" id="6144293">//&nbsp;or&nbsp;are&nbsp;locked&nbsp;to&nbsp;other&nbsp;goroutines&nbsp;due&nbsp;to&nbsp;use&nbsp;of&nbsp;runtime.LockOSThread.</span><br>
<span class="lineno">135</span><span class="comment" id="6144366">//</span><br>
<span class="lineno"></span><span class="comment" id="6144369">//&nbsp;SetMaxThreads&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;limiting&nbsp;the&nbsp;damage&nbsp;done&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6144435">//&nbsp;programs&nbsp;that&nbsp;create&nbsp;an&nbsp;unbounded&nbsp;number&nbsp;of&nbsp;threads.&nbsp;The&nbsp;idea&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="6144503">//&nbsp;to&nbsp;take&nbsp;down&nbsp;the&nbsp;program&nbsp;before&nbsp;it&nbsp;takes&nbsp;down&nbsp;the&nbsp;operating&nbsp;system.</span><br>
<span class="lineno"></span><span class="keyword" id="6144574">func</span>&nbsp;<span class="ident" id="6144579">SetMaxThreads</span><span class="op" id="6144592">(</span><span class="ident" id="6144593">threads</span>&nbsp;<span class="builtintype" id="6144601">int</span><span class="op" id="6144604">)</span>&nbsp;<span class="builtintype" id="6144606">int</span>&nbsp;<span class="op" id="6144610">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144613">return</span>&nbsp;<span class="ident" id="6144620">setMaxThreads</span><span class="op" id="6144633">(</span><span class="ident" id="6144634">threads</span><span class="op" id="6144641">)</span><br>
<span class="lineno"></span><span class="op" id="6144643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6144646">//&nbsp;SetPanicOnFault&nbsp;controls&nbsp;the&nbsp;runtime&#39;s&nbsp;behavior&nbsp;when&nbsp;a&nbsp;program&nbsp;faults</span><br>
<span class="lineno"></span><span class="comment" id="6144719">//&nbsp;at&nbsp;an&nbsp;unexpected&nbsp;(non-nil)&nbsp;address.&nbsp;Such&nbsp;faults&nbsp;are&nbsp;typically&nbsp;caused&nbsp;by</span><br>
<span class="lineno">145</span><span class="comment" id="6144794">//&nbsp;bugs&nbsp;such&nbsp;as&nbsp;runtime&nbsp;memory&nbsp;corruption,&nbsp;so&nbsp;the&nbsp;default&nbsp;response&nbsp;is&nbsp;to&nbsp;crash</span><br>
<span class="lineno"></span><span class="comment" id="6144873">//&nbsp;the&nbsp;program.&nbsp;Programs&nbsp;working&nbsp;with&nbsp;memory-mapped&nbsp;files&nbsp;or&nbsp;unsafe</span><br>
<span class="lineno"></span><span class="comment" id="6144941">//&nbsp;manipulation&nbsp;of&nbsp;memory&nbsp;may&nbsp;cause&nbsp;faults&nbsp;at&nbsp;non-nil&nbsp;addresses&nbsp;in&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="6145013">//&nbsp;dramatic&nbsp;situations;&nbsp;SetPanicOnFault&nbsp;allows&nbsp;such&nbsp;programs&nbsp;to&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="6145085">//&nbsp;that&nbsp;the&nbsp;runtime&nbsp;trigger&nbsp;only&nbsp;a&nbsp;panic,&nbsp;not&nbsp;a&nbsp;crash.</span><br>
<span class="lineno">150</span><span class="comment" id="6145140">//&nbsp;SetPanicOnFault&nbsp;applies&nbsp;only&nbsp;to&nbsp;the&nbsp;current&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="comment" id="6145198">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.</span><br>
<span class="lineno"></span><span class="keyword" id="6145234">func</span>&nbsp;<span class="ident" id="6145239">SetPanicOnFault</span><span class="op" id="6145254">(</span><span class="ident" id="6145255">enabled</span>&nbsp;<span class="builtintype" id="6145263">bool</span><span class="op" id="6145267">)</span>&nbsp;<span class="builtintype" id="6145269">bool</span>&nbsp;<span class="op" id="6145274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145277">return</span>&nbsp;<span class="ident" id="6145284">setPanicOnFault</span><span class="op" id="6145299">(</span><span class="ident" id="6145300">enabled</span><span class="op" id="6145307">)</span><br>
<span class="lineno"></span><span class="op" id="6145309">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="6145312">//&nbsp;WriteHeapDump&nbsp;writes&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;heap&nbsp;and&nbsp;the&nbsp;objects&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6145381">//&nbsp;it&nbsp;to&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="comment" id="6145417">//&nbsp;The&nbsp;heap&nbsp;dump&nbsp;format&nbsp;is&nbsp;defined&nbsp;at&nbsp;http://golang.org/s/go13heapdump.</span><br>
<span class="lineno"></span><span class="keyword" id="6145489">func</span>&nbsp;<span class="ident" id="6145494">WriteHeapDump</span><span class="op" id="6145507">(</span><span class="ident" id="6145508">fd</span>&nbsp;<span class="builtintype" id="6145511">uintptr</span><span class="op" id="6145518">)</span>
</div>
</body>
</html>
