<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3014304">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3014359">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3014413">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3014464">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-output&nbsp;fixedhuff.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3014514">//&nbsp;Package&nbsp;flate&nbsp;implements&nbsp;the&nbsp;DEFLATE&nbsp;compressed&nbsp;data&nbsp;format,&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3014591">//&nbsp;RFC&nbsp;1951.&nbsp;&nbsp;The&nbsp;gzip&nbsp;and&nbsp;zlib&nbsp;packages&nbsp;implement&nbsp;access&nbsp;to&nbsp;DEFLATE-based&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="3014671">//&nbsp;formats.</span><br>
<span class="lineno">10</span><span class="keyword" id="3014683">package</span>&nbsp;<span class="ident" id="3014691">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3014698">import</span>&nbsp;<span class="op" id="3014705">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3014708">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3014717">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3014723">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="3014733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3014736">const</span>&nbsp;<span class="op" id="3014742">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3014745">maxCodeLen</span>&nbsp;<span class="op" id="3014756">=</span>&nbsp;<span class="num" id="3014758">16</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3014764">//&nbsp;max&nbsp;length&nbsp;of&nbsp;Huffman&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3014795">maxHist</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3014806">=</span>&nbsp;<span class="num" id="3014808">32768</span>&nbsp;<span class="comment" id="3014814">//&nbsp;max&nbsp;history&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3014839">//&nbsp;The&nbsp;next&nbsp;three&nbsp;numbers&nbsp;come&nbsp;from&nbsp;the&nbsp;RFC,&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3014900">maxLit</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3014909">=</span>&nbsp;<span class="num" id="3014911">286</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3014916">maxDist</span>&nbsp;&nbsp;<span class="op" id="3014925">=</span>&nbsp;<span class="num" id="3014927">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3014931">numCodes</span>&nbsp;<span class="op" id="3014940">=</span>&nbsp;<span class="num" id="3014942">19</span>&nbsp;<span class="comment" id="3014945">//&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;Huffman&nbsp;meta-code</span><br>
<span class="lineno">25</span><span class="op" id="3014985">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3014988">//&nbsp;A&nbsp;CorruptInputError&nbsp;reports&nbsp;the&nbsp;presence&nbsp;of&nbsp;corrupt&nbsp;input&nbsp;at&nbsp;a&nbsp;given&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="3015068">type</span>&nbsp;<span class="ident" id="3015073">CorruptInputError</span>&nbsp;<span class="ident" id="3015091">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="3015098">func</span>&nbsp;<span class="op" id="3015103">(</span><span class="ident" id="3015104">e</span>&nbsp;<span class="ident" id="3015106">CorruptInputError</span><span class="op" id="3015123">)</span>&nbsp;<span class="ident" id="3015125">Error</span><span class="op" id="3015130">(</span><span class="op" id="3015131">)</span>&nbsp;<span class="builtintype" id="3015133">string</span>&nbsp;<span class="op" id="3015140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3015143">return</span>&nbsp;<span class="string" id="3015150">&#34;flate:&nbsp;corrupt&nbsp;input&nbsp;before&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="3015188">+</span>&nbsp;<span class="ident" id="3015190">strconv</span><span class="op" id="3015197">.</span><span class="ident" id="3015198">FormatInt</span><span class="op" id="3015207">(</span><span class="ident" id="3015208">int64</span><span class="op" id="3015213">(</span><span class="ident" id="3015214">e</span><span class="op" id="3015215">)</span><span class="op" id="3015216">,</span>&nbsp;<span class="num" id="3015218">10</span><span class="op" id="3015220">)</span><br>
<span class="lineno"></span><span class="op" id="3015222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3015225">//&nbsp;An&nbsp;InternalError&nbsp;reports&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;flate&nbsp;code&nbsp;itself.</span><br>
<span class="lineno">35</span><span class="keyword" id="3015288">type</span>&nbsp;<span class="ident" id="3015293">InternalError</span>&nbsp;<span class="builtintype" id="3015307">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3015315">func</span>&nbsp;<span class="op" id="3015320">(</span><span class="ident" id="3015321">e</span>&nbsp;<span class="ident" id="3015323">InternalError</span><span class="op" id="3015336">)</span>&nbsp;<span class="ident" id="3015338">Error</span><span class="op" id="3015343">(</span><span class="op" id="3015344">)</span>&nbsp;<span class="builtintype" id="3015346">string</span>&nbsp;<span class="op" id="3015353">{</span>&nbsp;<span class="keyword" id="3015355">return</span>&nbsp;<span class="string" id="3015362">&#34;flate:&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="3015388">+</span>&nbsp;<span class="builtintype" id="3015390">string</span><span class="op" id="3015396">(</span><span class="ident" id="3015397">e</span><span class="op" id="3015398">)</span>&nbsp;<span class="op" id="3015400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3015403">//&nbsp;A&nbsp;ReadError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;reading&nbsp;input.</span><br>
<span class="lineno">40</span><span class="keyword" id="3015468">type</span>&nbsp;<span class="ident" id="3015473">ReadError</span>&nbsp;<span class="keyword" id="3015483">struct</span>&nbsp;<span class="op" id="3015490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3015493">Offset</span>&nbsp;<span class="ident" id="3015500">int64</span>&nbsp;<span class="comment" id="3015506">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3015543">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3015550">error</span>&nbsp;<span class="comment" id="3015556">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="3015593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="3015596">func</span>&nbsp;<span class="op" id="3015601">(</span><span class="ident" id="3015602">e</span>&nbsp;<span class="op" id="3015604">*</span><span class="ident" id="3015605">ReadError</span><span class="op" id="3015614">)</span>&nbsp;<span class="ident" id="3015616">Error</span><span class="op" id="3015621">(</span><span class="op" id="3015622">)</span>&nbsp;<span class="builtintype" id="3015624">string</span>&nbsp;<span class="op" id="3015631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3015634">return</span>&nbsp;<span class="string" id="3015641">&#34;flate:&nbsp;read&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="3015672">+</span>&nbsp;<span class="ident" id="3015674">strconv</span><span class="op" id="3015681">.</span><span class="ident" id="3015682">FormatInt</span><span class="op" id="3015691">(</span><span class="ident" id="3015692">e</span><span class="op" id="3015693">.</span><span class="ident" id="3015694">Offset</span><span class="op" id="3015700">,</span>&nbsp;<span class="num" id="3015702">10</span><span class="op" id="3015704">)</span>&nbsp;<span class="op" id="3015706">+</span>&nbsp;<span class="string" id="3015708">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3015713">+</span>&nbsp;<span class="ident" id="3015715">e</span><span class="op" id="3015716">.</span><span class="ident" id="3015717">Err</span><span class="op" id="3015720">.</span><span class="ident" id="3015721">Error</span><span class="op" id="3015726">(</span><span class="op" id="3015727">)</span><br>
<span class="lineno"></span><span class="op" id="3015729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3015732">//&nbsp;A&nbsp;WriteError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;writing&nbsp;output.</span><br>
<span class="lineno">50</span><span class="keyword" id="3015799">type</span>&nbsp;<span class="ident" id="3015804">WriteError</span>&nbsp;<span class="keyword" id="3015815">struct</span>&nbsp;<span class="op" id="3015822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3015825">Offset</span>&nbsp;<span class="ident" id="3015832">int64</span>&nbsp;<span class="comment" id="3015838">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3015875">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3015882">error</span>&nbsp;<span class="comment" id="3015888">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="3015926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3015929">func</span>&nbsp;<span class="op" id="3015934">(</span><span class="ident" id="3015935">e</span>&nbsp;<span class="op" id="3015937">*</span><span class="ident" id="3015938">WriteError</span><span class="op" id="3015948">)</span>&nbsp;<span class="ident" id="3015950">Error</span><span class="op" id="3015955">(</span><span class="op" id="3015956">)</span>&nbsp;<span class="builtintype" id="3015958">string</span>&nbsp;<span class="op" id="3015965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3015968">return</span>&nbsp;<span class="string" id="3015975">&#34;flate:&nbsp;write&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="3016007">+</span>&nbsp;<span class="ident" id="3016009">strconv</span><span class="op" id="3016016">.</span><span class="ident" id="3016017">FormatInt</span><span class="op" id="3016026">(</span><span class="ident" id="3016027">e</span><span class="op" id="3016028">.</span><span class="ident" id="3016029">Offset</span><span class="op" id="3016035">,</span>&nbsp;<span class="num" id="3016037">10</span><span class="op" id="3016039">)</span>&nbsp;<span class="op" id="3016041">+</span>&nbsp;<span class="string" id="3016043">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3016048">+</span>&nbsp;<span class="ident" id="3016050">e</span><span class="op" id="3016051">.</span><span class="ident" id="3016052">Err</span><span class="op" id="3016055">.</span><span class="ident" id="3016056">Error</span><span class="op" id="3016061">(</span><span class="op" id="3016062">)</span><br>
<span class="lineno"></span><span class="op" id="3016064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3016067">//&nbsp;Resetter&nbsp;resets&nbsp;a&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;or&nbsp;NewReaderDict&nbsp;to</span><br>
<span class="lineno">60</span><span class="comment" id="3016141">//&nbsp;to&nbsp;switch&nbsp;to&nbsp;a&nbsp;new&nbsp;underlying&nbsp;Reader.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;ReadCloser</span><br>
<span class="lineno"></span><span class="comment" id="3016216">//&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="3016252">type</span>&nbsp;<span class="ident" id="3016257">Resetter</span>&nbsp;<span class="keyword" id="3016266">interface</span>&nbsp;<span class="op" id="3016276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3016279">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data&nbsp;and&nbsp;resets&nbsp;the&nbsp;Resetter&nbsp;as&nbsp;if&nbsp;it&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3016353">//&nbsp;newly&nbsp;initialized&nbsp;with&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3016398">Reset</span><span class="op" id="3016403">(</span><span class="ident" id="3016404">r</span>&nbsp;<span class="ident" id="3016406">io</span><span class="op" id="3016408">.</span><span class="ident" id="3016409">Reader</span><span class="op" id="3016415">,</span>&nbsp;<span class="ident" id="3016417">dict</span>&nbsp;<span class="op" id="3016422">[</span><span class="op" id="3016423">]</span><span class="builtintype" id="3016424">byte</span><span class="op" id="3016428">)</span>&nbsp;<span class="builtintype" id="3016430">error</span><br>
<span class="lineno"></span><span class="op" id="3016436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3016439">//&nbsp;Note&nbsp;that&nbsp;much&nbsp;of&nbsp;the&nbsp;implementation&nbsp;of&nbsp;huffmanDecoder&nbsp;is&nbsp;also&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="3016512">//&nbsp;into&nbsp;gen.go&nbsp;(in&nbsp;package&nbsp;main)&nbsp;for&nbsp;the&nbsp;purpose&nbsp;of&nbsp;precomputing&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="3016581">//&nbsp;fixed&nbsp;huffman&nbsp;tables&nbsp;so&nbsp;they&nbsp;can&nbsp;be&nbsp;included&nbsp;statically.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3016642">//&nbsp;The&nbsp;data&nbsp;structure&nbsp;for&nbsp;decoding&nbsp;Huffman&nbsp;tables&nbsp;is&nbsp;based&nbsp;on&nbsp;that&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3016712">//&nbsp;zlib.&nbsp;There&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;of&nbsp;a&nbsp;fixed&nbsp;bit&nbsp;width&nbsp;(huffmanChunkBits),</span><br>
<span class="lineno"></span><span class="comment" id="3016786">//&nbsp;For&nbsp;codes&nbsp;smaller&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;there&nbsp;are&nbsp;multiple&nbsp;entries</span><br>
<span class="lineno">75</span><span class="comment" id="3016856">//&nbsp;(each&nbsp;combination&nbsp;of&nbsp;trailing&nbsp;bits&nbsp;has&nbsp;the&nbsp;same&nbsp;value).&nbsp;For&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="3016925">//&nbsp;larger&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;the&nbsp;table&nbsp;contains&nbsp;a&nbsp;link&nbsp;to&nbsp;an&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="3016998">//&nbsp;table.&nbsp;The&nbsp;width&nbsp;of&nbsp;each&nbsp;entry&nbsp;in&nbsp;the&nbsp;link&nbsp;table&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="3017070">//&nbsp;size&nbsp;minus&nbsp;the&nbsp;chunk&nbsp;width.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3017102">//&nbsp;Note&nbsp;that&nbsp;you&nbsp;can&nbsp;do&nbsp;a&nbsp;lookup&nbsp;in&nbsp;the&nbsp;table&nbsp;even&nbsp;without&nbsp;all&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3017170">//&nbsp;filled.&nbsp;Since&nbsp;the&nbsp;extra&nbsp;bits&nbsp;are&nbsp;zero,&nbsp;and&nbsp;the&nbsp;DEFLATE&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="3017242">//&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;shorter&nbsp;codes&nbsp;come&nbsp;before&nbsp;longer&nbsp;ones,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3017311">//&nbsp;bit&nbsp;length&nbsp;estimate&nbsp;in&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;lower&nbsp;bound&nbsp;on&nbsp;the&nbsp;actual</span><br>
<span class="lineno"></span><span class="comment" id="3017379">//&nbsp;number&nbsp;of&nbsp;bits.</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3017399">//&nbsp;chunk&nbsp;&amp;&nbsp;15&nbsp;is&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3017431">//&nbsp;chunk&nbsp;&gt;&gt;&nbsp;4&nbsp;is&nbsp;value,&nbsp;including&nbsp;table&nbsp;link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3017477">const</span>&nbsp;<span class="op" id="3017483">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017486">huffmanChunkBits</span>&nbsp;&nbsp;<span class="op" id="3017504">=</span>&nbsp;<span class="num" id="3017506">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017509">huffmanNumChunks</span>&nbsp;&nbsp;<span class="op" id="3017527">=</span>&nbsp;<span class="num" id="3017529">1</span>&nbsp;<span class="op" id="3017531">&lt;&lt;</span>&nbsp;<span class="ident" id="3017534">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017552">huffmanCountMask</span>&nbsp;&nbsp;<span class="op" id="3017570">=</span>&nbsp;<span class="num" id="3017572">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017576">huffmanValueShift</span>&nbsp;<span class="op" id="3017594">=</span>&nbsp;<span class="num" id="3017596">4</span><br>
<span class="lineno"></span><span class="op" id="3017598">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="3017601">type</span>&nbsp;<span class="ident" id="3017606">huffmanDecoder</span>&nbsp;<span class="keyword" id="3017621">struct</span>&nbsp;<span class="op" id="3017628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017631">min</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3017640">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3017665">//&nbsp;the&nbsp;minimum&nbsp;code&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017693">chunks</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3017702">[</span><span class="ident" id="3017703">huffmanNumChunks</span><span class="op" id="3017719">]</span><span class="builtintype" id="3017720">uint32</span>&nbsp;<span class="comment" id="3017727">//&nbsp;chunks&nbsp;as&nbsp;described&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017757">links</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3017766">[</span><span class="op" id="3017767">]</span><span class="op" id="3017768">[</span><span class="op" id="3017769">]</span><span class="builtintype" id="3017770">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3017791">//&nbsp;overflow&nbsp;links</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017810">linkMask</span>&nbsp;<span class="builtintype" id="3017819">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3017844">//&nbsp;mask&nbsp;the&nbsp;width&nbsp;of&nbsp;the&nbsp;link&nbsp;table</span><br>
<span class="lineno"></span><span class="op" id="3017880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3017883">//&nbsp;Initialize&nbsp;Huffman&nbsp;decoding&nbsp;tables&nbsp;from&nbsp;array&nbsp;of&nbsp;code&nbsp;lengths.</span><br>
<span class="lineno"></span><span class="keyword" id="3017949">func</span>&nbsp;<span class="op" id="3017954">(</span><span class="ident" id="3017955">h</span>&nbsp;<span class="op" id="3017957">*</span><span class="ident" id="3017958">huffmanDecoder</span><span class="op" id="3017972">)</span>&nbsp;<span class="ident" id="3017974">init</span><span class="op" id="3017978">(</span><span class="ident" id="3017979">bits</span>&nbsp;<span class="op" id="3017984">[</span><span class="op" id="3017985">]</span><span class="builtintype" id="3017986">int</span><span class="op" id="3017989">)</span>&nbsp;<span class="builtintype" id="3017991">bool</span>&nbsp;<span class="op" id="3017996">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3017999">if</span>&nbsp;<span class="ident" id="3018002">h</span><span class="op" id="3018003">.</span><span class="ident" id="3018004">min</span>&nbsp;<span class="op" id="3018008">!=</span>&nbsp;<span class="num" id="3018011">0</span>&nbsp;<span class="op" id="3018013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018017">*</span><span class="ident" id="3018018">h</span>&nbsp;<span class="op" id="3018020">=</span>&nbsp;<span class="ident" id="3018022">huffmanDecoder</span><span class="op" id="3018036">{</span><span class="op" id="3018037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3018044">//&nbsp;Count&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;each&nbsp;length,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3018086">//&nbsp;compute&nbsp;min&nbsp;and&nbsp;max&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018118">var</span>&nbsp;<span class="ident" id="3018122">count</span>&nbsp;<span class="op" id="3018128">[</span><span class="ident" id="3018129">maxCodeLen</span><span class="op" id="3018139">]</span><span class="builtintype" id="3018140">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018145">var</span>&nbsp;<span class="ident" id="3018149">min</span><span class="op" id="3018152">,</span>&nbsp;<span class="ident" id="3018154">max</span>&nbsp;<span class="builtintype" id="3018158">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018163">for</span>&nbsp;<span class="ident" id="3018167">_</span><span class="op" id="3018168">,</span>&nbsp;<span class="ident" id="3018170">n</span>&nbsp;<span class="op" id="3018172">:=</span>&nbsp;<span class="keyword" id="3018175">range</span>&nbsp;<span class="ident" id="3018181">bits</span>&nbsp;<span class="op" id="3018186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018190">if</span>&nbsp;<span class="ident" id="3018193">n</span>&nbsp;<span class="op" id="3018195">==</span>&nbsp;<span class="num" id="3018198">0</span>&nbsp;<span class="op" id="3018200">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018205">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018220">if</span>&nbsp;<span class="ident" id="3018223">min</span>&nbsp;<span class="op" id="3018227">==</span>&nbsp;<span class="num" id="3018230">0</span>&nbsp;<span class="op" id="3018232">||</span>&nbsp;<span class="ident" id="3018235">n</span>&nbsp;<span class="op" id="3018237">&lt;</span>&nbsp;<span class="ident" id="3018239">min</span>&nbsp;<span class="op" id="3018243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018248">min</span>&nbsp;<span class="op" id="3018252">=</span>&nbsp;<span class="ident" id="3018254">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018258">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018262">if</span>&nbsp;<span class="ident" id="3018265">n</span>&nbsp;<span class="op" id="3018267">&gt;</span>&nbsp;<span class="ident" id="3018269">max</span>&nbsp;<span class="op" id="3018273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018278">max</span>&nbsp;<span class="op" id="3018282">=</span>&nbsp;<span class="ident" id="3018284">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018292">count</span><span class="op" id="3018297">[</span><span class="ident" id="3018298">n</span><span class="op" id="3018299">]</span><span class="op" id="3018300">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018304">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018307">if</span>&nbsp;<span class="ident" id="3018310">max</span>&nbsp;<span class="op" id="3018314">==</span>&nbsp;<span class="num" id="3018317">0</span>&nbsp;<span class="op" id="3018319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018323">return</span>&nbsp;<span class="builtintype" id="3018330">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018341">h</span><span class="op" id="3018342">.</span><span class="ident" id="3018343">min</span>&nbsp;<span class="op" id="3018347">=</span>&nbsp;<span class="ident" id="3018349">min</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018354">var</span>&nbsp;<span class="ident" id="3018358">linkBits</span>&nbsp;<span class="builtintype" id="3018367">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018373">var</span>&nbsp;<span class="ident" id="3018377">numLinks</span>&nbsp;<span class="builtintype" id="3018386">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018391">if</span>&nbsp;<span class="ident" id="3018394">max</span>&nbsp;<span class="op" id="3018398">&gt;</span>&nbsp;<span class="ident" id="3018400">huffmanChunkBits</span>&nbsp;<span class="op" id="3018417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018421">linkBits</span>&nbsp;<span class="op" id="3018430">=</span>&nbsp;<span class="builtintype" id="3018432">uint</span><span class="op" id="3018436">(</span><span class="ident" id="3018437">max</span><span class="op" id="3018440">)</span>&nbsp;<span class="op" id="3018442">-</span>&nbsp;<span class="ident" id="3018444">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018463">numLinks</span>&nbsp;<span class="op" id="3018472">=</span>&nbsp;<span class="num" id="3018474">1</span>&nbsp;<span class="op" id="3018476">&lt;&lt;</span>&nbsp;<span class="ident" id="3018479">linkBits</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018490">h</span><span class="op" id="3018491">.</span><span class="ident" id="3018492">linkMask</span>&nbsp;<span class="op" id="3018501">=</span>&nbsp;<span class="builtintype" id="3018503">uint32</span><span class="op" id="3018509">(</span><span class="ident" id="3018510">numLinks</span>&nbsp;<span class="op" id="3018519">-</span>&nbsp;<span class="num" id="3018521">1</span><span class="op" id="3018522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018528">code</span>&nbsp;<span class="op" id="3018533">:=</span>&nbsp;<span class="num" id="3018536">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018539">var</span>&nbsp;<span class="ident" id="3018543">nextcode</span>&nbsp;<span class="op" id="3018552">[</span><span class="ident" id="3018553">maxCodeLen</span><span class="op" id="3018563">]</span><span class="builtintype" id="3018564">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018569">for</span>&nbsp;<span class="ident" id="3018573">i</span>&nbsp;<span class="op" id="3018575">:=</span>&nbsp;<span class="ident" id="3018578">min</span><span class="op" id="3018581">;</span>&nbsp;<span class="ident" id="3018583">i</span>&nbsp;<span class="op" id="3018585">&lt;=</span>&nbsp;<span class="ident" id="3018588">max</span><span class="op" id="3018591">;</span>&nbsp;<span class="ident" id="3018593">i</span><span class="op" id="3018594">++</span>&nbsp;<span class="op" id="3018597">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018601">if</span>&nbsp;<span class="ident" id="3018604">i</span>&nbsp;<span class="op" id="3018606">==</span>&nbsp;<span class="ident" id="3018609">huffmanChunkBits</span><span class="op" id="3018625">+</span><span class="num" id="3018626">1</span>&nbsp;<span class="op" id="3018628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3018633">//&nbsp;create&nbsp;link&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018658">link</span>&nbsp;<span class="op" id="3018663">:=</span>&nbsp;<span class="ident" id="3018666">code</span>&nbsp;<span class="op" id="3018671">&gt;&gt;</span>&nbsp;<span class="num" id="3018674">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018679">if</span>&nbsp;<span class="ident" id="3018682">huffmanNumChunks</span>&nbsp;<span class="op" id="3018699">&lt;</span>&nbsp;<span class="ident" id="3018701">link</span>&nbsp;<span class="op" id="3018706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018712">return</span>&nbsp;<span class="builtintype" id="3018719">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018733">h</span><span class="op" id="3018734">.</span><span class="ident" id="3018735">links</span>&nbsp;<span class="op" id="3018741">=</span>&nbsp;<span class="builtinfunc" id="3018743">make</span><span class="op" id="3018747">(</span><span class="op" id="3018748">[</span><span class="op" id="3018749">]</span><span class="op" id="3018750">[</span><span class="op" id="3018751">]</span><span class="builtintype" id="3018752">uint32</span><span class="op" id="3018758">,</span>&nbsp;<span class="ident" id="3018760">huffmanNumChunks</span><span class="op" id="3018776">-</span><span class="ident" id="3018777">link</span><span class="op" id="3018781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018786">for</span>&nbsp;<span class="ident" id="3018790">j</span>&nbsp;<span class="op" id="3018792">:=</span>&nbsp;<span class="builtintype" id="3018795">uint</span><span class="op" id="3018799">(</span><span class="ident" id="3018800">link</span><span class="op" id="3018804">)</span><span class="op" id="3018805">;</span>&nbsp;<span class="ident" id="3018807">j</span>&nbsp;<span class="op" id="3018809">&lt;</span>&nbsp;<span class="ident" id="3018811">huffmanNumChunks</span><span class="op" id="3018827">;</span>&nbsp;<span class="ident" id="3018829">j</span><span class="op" id="3018830">++</span>&nbsp;<span class="op" id="3018833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018839">reverse</span>&nbsp;<span class="op" id="3018847">:=</span>&nbsp;<span class="builtintype" id="3018850">int</span><span class="op" id="3018853">(</span><span class="ident" id="3018854">reverseByte</span><span class="op" id="3018865">[</span><span class="ident" id="3018866">j</span><span class="op" id="3018867">&gt;&gt;</span><span class="num" id="3018869">8</span><span class="op" id="3018870">]</span><span class="op" id="3018871">)</span>&nbsp;<span class="op" id="3018873">|</span>&nbsp;<span class="builtintype" id="3018875">int</span><span class="op" id="3018878">(</span><span class="ident" id="3018879">reverseByte</span><span class="op" id="3018890">[</span><span class="ident" id="3018891">j</span><span class="op" id="3018892">&amp;</span><span class="num" id="3018893">0xff</span><span class="op" id="3018897">]</span><span class="op" id="3018898">)</span><span class="op" id="3018899">&lt;&lt;</span><span class="num" id="3018901">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018907">reverse</span>&nbsp;<span class="op" id="3018915">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="3018919">uint</span><span class="op" id="3018923">(</span><span class="num" id="3018924">16</span>&nbsp;<span class="op" id="3018927">-</span>&nbsp;<span class="ident" id="3018929">huffmanChunkBits</span><span class="op" id="3018945">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018951">off</span>&nbsp;<span class="op" id="3018955">:=</span>&nbsp;<span class="ident" id="3018958">j</span>&nbsp;<span class="op" id="3018960">-</span>&nbsp;<span class="builtintype" id="3018962">uint</span><span class="op" id="3018966">(</span><span class="ident" id="3018967">link</span><span class="op" id="3018971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018977">h</span><span class="op" id="3018978">.</span><span class="ident" id="3018979">chunks</span><span class="op" id="3018985">[</span><span class="ident" id="3018986">reverse</span><span class="op" id="3018993">]</span>&nbsp;<span class="op" id="3018995">=</span>&nbsp;<span class="builtintype" id="3018997">uint32</span><span class="op" id="3019003">(</span><span class="ident" id="3019004">off</span><span class="op" id="3019007">&lt;&lt;</span><span class="ident" id="3019009">huffmanValueShift</span>&nbsp;<span class="op" id="3019027">+</span>&nbsp;<span class="builtintype" id="3019029">uint</span><span class="op" id="3019033">(</span><span class="ident" id="3019034">i</span><span class="op" id="3019035">)</span><span class="op" id="3019036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019042">h</span><span class="op" id="3019043">.</span><span class="ident" id="3019044">links</span><span class="op" id="3019049">[</span><span class="ident" id="3019050">off</span><span class="op" id="3019053">]</span>&nbsp;<span class="op" id="3019055">=</span>&nbsp;<span class="builtinfunc" id="3019057">make</span><span class="op" id="3019061">(</span><span class="op" id="3019062">[</span><span class="op" id="3019063">]</span><span class="builtintype" id="3019064">uint32</span><span class="op" id="3019070">,</span>&nbsp;<span class="num" id="3019072">1</span><span class="op" id="3019073">&lt;&lt;</span><span class="ident" id="3019075">linkBits</span><span class="op" id="3019083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3019088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3019092">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019096">n</span>&nbsp;<span class="op" id="3019098">:=</span>&nbsp;<span class="ident" id="3019101">count</span><span class="op" id="3019106">[</span><span class="ident" id="3019107">i</span><span class="op" id="3019108">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019112">nextcode</span><span class="op" id="3019120">[</span><span class="ident" id="3019121">i</span><span class="op" id="3019122">]</span>&nbsp;<span class="op" id="3019124">=</span>&nbsp;<span class="ident" id="3019126">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019133">code</span>&nbsp;<span class="op" id="3019138">+=</span>&nbsp;<span class="ident" id="3019141">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019145">code</span>&nbsp;<span class="op" id="3019150">&lt;&lt;=</span>&nbsp;<span class="num" id="3019154">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3019157">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3019161">for</span>&nbsp;<span class="ident" id="3019165">i</span><span class="op" id="3019166">,</span>&nbsp;<span class="ident" id="3019168">n</span>&nbsp;<span class="op" id="3019170">:=</span>&nbsp;<span class="keyword" id="3019173">range</span>&nbsp;<span class="ident" id="3019179">bits</span>&nbsp;<span class="op" id="3019184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3019188">if</span>&nbsp;<span class="ident" id="3019191">n</span>&nbsp;<span class="op" id="3019193">==</span>&nbsp;<span class="num" id="3019196">0</span>&nbsp;<span class="op" id="3019198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3019203">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3019214">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019218">code</span>&nbsp;<span class="op" id="3019223">:=</span>&nbsp;<span class="ident" id="3019226">nextcode</span><span class="op" id="3019234">[</span><span class="ident" id="3019235">n</span><span class="op" id="3019236">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019240">nextcode</span><span class="op" id="3019248">[</span><span class="ident" id="3019249">n</span><span class="op" id="3019250">]</span><span class="op" id="3019251">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019256">chunk</span>&nbsp;<span class="op" id="3019262">:=</span>&nbsp;<span class="builtintype" id="3019265">uint32</span><span class="op" id="3019271">(</span><span class="ident" id="3019272">i</span><span class="op" id="3019273">&lt;&lt;</span><span class="ident" id="3019275">huffmanValueShift</span>&nbsp;<span class="op" id="3019293">|</span>&nbsp;<span class="ident" id="3019295">n</span><span class="op" id="3019296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019300">reverse</span>&nbsp;<span class="op" id="3019308">:=</span>&nbsp;<span class="builtintype" id="3019311">int</span><span class="op" id="3019314">(</span><span class="ident" id="3019315">reverseByte</span><span class="op" id="3019326">[</span><span class="ident" id="3019327">code</span><span class="op" id="3019331">&gt;&gt;</span><span class="num" id="3019333">8</span><span class="op" id="3019334">]</span><span class="op" id="3019335">)</span>&nbsp;<span class="op" id="3019337">|</span>&nbsp;<span class="builtintype" id="3019339">int</span><span class="op" id="3019342">(</span><span class="ident" id="3019343">reverseByte</span><span class="op" id="3019354">[</span><span class="ident" id="3019355">code</span><span class="op" id="3019359">&amp;</span><span class="num" id="3019360">0xff</span><span class="op" id="3019364">]</span><span class="op" id="3019365">)</span><span class="op" id="3019366">&lt;&lt;</span><span class="num" id="3019368">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019372">reverse</span>&nbsp;<span class="op" id="3019380">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="3019384">uint</span><span class="op" id="3019388">(</span><span class="num" id="3019389">16</span>&nbsp;<span class="op" id="3019392">-</span>&nbsp;<span class="ident" id="3019394">n</span><span class="op" id="3019395">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3019399">if</span>&nbsp;<span class="ident" id="3019402">n</span>&nbsp;<span class="op" id="3019404">&lt;=</span>&nbsp;<span class="ident" id="3019407">huffmanChunkBits</span>&nbsp;<span class="op" id="3019424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3019429">for</span>&nbsp;<span class="ident" id="3019433">off</span>&nbsp;<span class="op" id="3019437">:=</span>&nbsp;<span class="ident" id="3019440">reverse</span><span class="op" id="3019447">;</span>&nbsp;<span class="ident" id="3019449">off</span>&nbsp;<span class="op" id="3019453">&lt;</span>&nbsp;<span class="ident" id="3019455">huffmanNumChunks</span><span class="op" id="3019471">;</span>&nbsp;<span class="ident" id="3019473">off</span>&nbsp;<span class="op" id="3019477">+=</span>&nbsp;<span class="num" id="3019480">1</span>&nbsp;<span class="op" id="3019482">&lt;&lt;</span>&nbsp;<span class="builtintype" id="3019485">uint</span><span class="op" id="3019489">(</span><span class="ident" id="3019490">n</span><span class="op" id="3019491">)</span>&nbsp;<span class="op" id="3019493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019499">h</span><span class="op" id="3019500">.</span><span class="ident" id="3019501">chunks</span><span class="op" id="3019507">[</span><span class="ident" id="3019508">off</span><span class="op" id="3019511">]</span>&nbsp;<span class="op" id="3019513">=</span>&nbsp;<span class="ident" id="3019515">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3019524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3019528">}</span>&nbsp;<span class="keyword" id="3019530">else</span>&nbsp;<span class="op" id="3019535">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019540">value</span>&nbsp;<span class="op" id="3019546">:=</span>&nbsp;<span class="ident" id="3019549">h</span><span class="op" id="3019550">.</span><span class="ident" id="3019551">chunks</span><span class="op" id="3019557">[</span><span class="ident" id="3019558">reverse</span><span class="op" id="3019565">&amp;</span><span class="op" id="3019566">(</span><span class="ident" id="3019567">huffmanNumChunks</span><span class="op" id="3019583">-</span><span class="num" id="3019584">1</span><span class="op" id="3019585">)</span><span class="op" id="3019586">]</span>&nbsp;<span class="op" id="3019588">&gt;&gt;</span>&nbsp;<span class="ident" id="3019591">huffmanValueShift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3019612">if</span>&nbsp;<span class="ident" id="3019615">value</span>&nbsp;<span class="op" id="3019621">&gt;=</span>&nbsp;<span class="builtintype" id="3019624">uint32</span><span class="op" id="3019630">(</span><span class="builtinfunc" id="3019631">len</span><span class="op" id="3019634">(</span><span class="ident" id="3019635">h</span><span class="op" id="3019636">.</span><span class="ident" id="3019637">links</span><span class="op" id="3019642">)</span><span class="op" id="3019643">)</span>&nbsp;<span class="op" id="3019645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3019651">return</span>&nbsp;<span class="builtintype" id="3019658">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3019667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019672">linktab</span>&nbsp;<span class="op" id="3019680">:=</span>&nbsp;<span class="ident" id="3019683">h</span><span class="op" id="3019684">.</span><span class="ident" id="3019685">links</span><span class="op" id="3019690">[</span><span class="ident" id="3019691">value</span><span class="op" id="3019696">]</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019701">reverse</span>&nbsp;<span class="op" id="3019709">&gt;&gt;=</span>&nbsp;<span class="ident" id="3019713">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3019733">for</span>&nbsp;<span class="ident" id="3019737">off</span>&nbsp;<span class="op" id="3019741">:=</span>&nbsp;<span class="ident" id="3019744">reverse</span><span class="op" id="3019751">;</span>&nbsp;<span class="ident" id="3019753">off</span>&nbsp;<span class="op" id="3019757">&lt;</span>&nbsp;<span class="ident" id="3019759">numLinks</span><span class="op" id="3019767">;</span>&nbsp;<span class="ident" id="3019769">off</span>&nbsp;<span class="op" id="3019773">+=</span>&nbsp;<span class="num" id="3019776">1</span>&nbsp;<span class="op" id="3019778">&lt;&lt;</span>&nbsp;<span class="builtintype" id="3019781">uint</span><span class="op" id="3019785">(</span><span class="ident" id="3019786">n</span><span class="op" id="3019787">-</span><span class="ident" id="3019788">huffmanChunkBits</span><span class="op" id="3019804">)</span>&nbsp;<span class="op" id="3019806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019812">linktab</span><span class="op" id="3019819">[</span><span class="ident" id="3019820">off</span><span class="op" id="3019823">]</span>&nbsp;<span class="op" id="3019825">=</span>&nbsp;<span class="ident" id="3019827">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3019836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3019840">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3019843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3019846">return</span>&nbsp;<span class="builtintype" id="3019853">true</span><br>
<span class="lineno"></span><span class="op" id="3019858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3019861">//&nbsp;The&nbsp;actual&nbsp;read&nbsp;interface&nbsp;needed&nbsp;by&nbsp;NewReader.</span><br>
<span class="lineno">190</span><span class="comment" id="3019911">//&nbsp;If&nbsp;the&nbsp;passed&nbsp;in&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,</span><br>
<span class="lineno"></span><span class="comment" id="3019970">//&nbsp;the&nbsp;NewReader&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="3020021">type</span>&nbsp;<span class="ident" id="3020026">Reader</span>&nbsp;<span class="keyword" id="3020033">interface</span>&nbsp;<span class="op" id="3020043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020046">io</span><span class="op" id="3020048">.</span><span class="ident" id="3020049">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020057">io</span><span class="op" id="3020059">.</span><span class="ident" id="3020060">ByteReader</span><br>
<span class="lineno">195</span><span class="op" id="3020071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3020074">//&nbsp;Decompress&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="3020095">type</span>&nbsp;<span class="ident" id="3020100">decompressor</span>&nbsp;<span class="keyword" id="3020113">struct</span>&nbsp;<span class="op" id="3020120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3020123">//&nbsp;Input&nbsp;source.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020141">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3020149">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020157">roffset</span>&nbsp;<span class="ident" id="3020165">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020172">woffset</span>&nbsp;<span class="ident" id="3020180">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3020188">//&nbsp;Input&nbsp;bits,&nbsp;in&nbsp;top&nbsp;of&nbsp;b.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020217">b</span>&nbsp;&nbsp;<span class="builtintype" id="3020220">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020228">nb</span>&nbsp;<span class="builtintype" id="3020231">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3020238">//&nbsp;Huffman&nbsp;decoders&nbsp;for&nbsp;literal/length,&nbsp;distance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020289">h1</span><span class="op" id="3020291">,</span>&nbsp;<span class="ident" id="3020293">h2</span>&nbsp;<span class="ident" id="3020296">huffmanDecoder</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3020313">//&nbsp;Length&nbsp;arrays&nbsp;used&nbsp;to&nbsp;define&nbsp;Huffman&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020361">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3020370">*</span><span class="op" id="3020371">[</span><span class="ident" id="3020372">maxLit</span>&nbsp;<span class="op" id="3020379">+</span>&nbsp;<span class="ident" id="3020381">maxDist</span><span class="op" id="3020388">]</span><span class="builtintype" id="3020389">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020394">codebits</span>&nbsp;<span class="op" id="3020403">*</span><span class="op" id="3020404">[</span><span class="ident" id="3020405">numCodes</span><span class="op" id="3020413">]</span><span class="builtintype" id="3020414">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3020420">//&nbsp;Output&nbsp;history,&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020448">hist</span>&nbsp;&nbsp;<span class="op" id="3020454">*</span><span class="op" id="3020455">[</span><span class="ident" id="3020456">maxHist</span><span class="op" id="3020463">]</span><span class="builtintype" id="3020464">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020470">hp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3020476">int</span>&nbsp;&nbsp;<span class="comment" id="3020481">//&nbsp;current&nbsp;output&nbsp;position&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020519">hw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3020525">int</span>&nbsp;&nbsp;<span class="comment" id="3020530">//&nbsp;have&nbsp;written&nbsp;hist[0:hw]&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020566">hfull</span>&nbsp;<span class="builtintype" id="3020572">bool</span>&nbsp;<span class="comment" id="3020577">//&nbsp;buffer&nbsp;has&nbsp;filled&nbsp;at&nbsp;least&nbsp;once</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3020614">//&nbsp;Temporary&nbsp;buffer&nbsp;(avoids&nbsp;repeated&nbsp;allocation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020665">buf</span>&nbsp;<span class="op" id="3020669">[</span><span class="num" id="3020670">4</span><span class="op" id="3020671">]</span><span class="builtintype" id="3020672">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3020679">//&nbsp;Next&nbsp;step&nbsp;in&nbsp;the&nbsp;decompression,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3020715">//&nbsp;and&nbsp;decompression&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020744">step</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020753">func</span><span class="op" id="3020757">(</span><span class="op" id="3020758">*</span><span class="ident" id="3020759">decompressor</span><span class="op" id="3020771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020774">final</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3020783">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020789">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3020798">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020805">toRead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3020814">[</span><span class="op" id="3020815">]</span><span class="builtintype" id="3020816">byte</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020822">hl</span><span class="op" id="3020824">,</span>&nbsp;<span class="ident" id="3020826">hd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3020831">*</span><span class="ident" id="3020832">huffmanDecoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020848">copyLen</span>&nbsp;&nbsp;<span class="builtintype" id="3020857">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020862">copyDist</span>&nbsp;<span class="builtintype" id="3020871">int</span><br>
<span class="lineno"></span><span class="op" id="3020875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="3020878">func</span>&nbsp;<span class="op" id="3020883">(</span><span class="ident" id="3020884">f</span>&nbsp;<span class="op" id="3020886">*</span><span class="ident" id="3020887">decompressor</span><span class="op" id="3020899">)</span>&nbsp;<span class="ident" id="3020901">nextBlock</span><span class="op" id="3020910">(</span><span class="op" id="3020911">)</span>&nbsp;<span class="op" id="3020913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3020916">if</span>&nbsp;<span class="ident" id="3020919">f</span><span class="op" id="3020920">.</span><span class="ident" id="3020921">final</span>&nbsp;<span class="op" id="3020927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3020931">if</span>&nbsp;<span class="ident" id="3020934">f</span><span class="op" id="3020935">.</span><span class="ident" id="3020936">hw</span>&nbsp;<span class="op" id="3020939">!=</span>&nbsp;<span class="ident" id="3020942">f</span><span class="op" id="3020943">.</span><span class="ident" id="3020944">hp</span>&nbsp;<span class="op" id="3020947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020952">f</span><span class="op" id="3020953">.</span><span class="ident" id="3020954">flush</span><span class="op" id="3020959">(</span><span class="op" id="3020960">(</span><span class="op" id="3020961">*</span><span class="ident" id="3020962">decompressor</span><span class="op" id="3020974">)</span><span class="op" id="3020975">.</span><span class="ident" id="3020976">nextBlock</span><span class="op" id="3020985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3020990">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3020999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021003">f</span><span class="op" id="3021004">.</span><span class="ident" id="3021005">err</span>&nbsp;<span class="op" id="3021009">=</span>&nbsp;<span class="ident" id="3021011">io</span><span class="op" id="3021013">.</span><span class="ident" id="3021014">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021020">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021031">for</span>&nbsp;<span class="ident" id="3021035">f</span><span class="op" id="3021036">.</span><span class="ident" id="3021037">nb</span>&nbsp;<span class="op" id="3021040">&lt;</span>&nbsp;<span class="num" id="3021042">1</span><span class="op" id="3021043">+</span><span class="num" id="3021044">2</span>&nbsp;<span class="op" id="3021046">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021050">if</span>&nbsp;<span class="ident" id="3021053">f</span><span class="op" id="3021054">.</span><span class="ident" id="3021055">err</span>&nbsp;<span class="op" id="3021059">=</span>&nbsp;<span class="ident" id="3021061">f</span><span class="op" id="3021062">.</span><span class="ident" id="3021063">moreBits</span><span class="op" id="3021071">(</span><span class="op" id="3021072">)</span><span class="op" id="3021073">;</span>&nbsp;<span class="ident" id="3021075">f</span><span class="op" id="3021076">.</span><span class="ident" id="3021077">err</span>&nbsp;<span class="op" id="3021081">!=</span>&nbsp;<span class="ident" id="3021084">nil</span>&nbsp;<span class="op" id="3021088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021093">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021108">f</span><span class="op" id="3021109">.</span><span class="ident" id="3021110">final</span>&nbsp;<span class="op" id="3021116">=</span>&nbsp;<span class="ident" id="3021118">f</span><span class="op" id="3021119">.</span><span class="ident" id="3021120">b</span><span class="op" id="3021121">&amp;</span><span class="num" id="3021122">1</span>&nbsp;<span class="op" id="3021124">==</span>&nbsp;<span class="num" id="3021127">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021130">f</span><span class="op" id="3021131">.</span><span class="ident" id="3021132">b</span>&nbsp;<span class="op" id="3021134">&gt;&gt;=</span>&nbsp;<span class="num" id="3021138">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021141">typ</span>&nbsp;<span class="op" id="3021145">:=</span>&nbsp;<span class="ident" id="3021148">f</span><span class="op" id="3021149">.</span><span class="ident" id="3021150">b</span>&nbsp;<span class="op" id="3021152">&amp;</span>&nbsp;<span class="num" id="3021154">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021157">f</span><span class="op" id="3021158">.</span><span class="ident" id="3021159">b</span>&nbsp;<span class="op" id="3021161">&gt;&gt;=</span>&nbsp;<span class="num" id="3021165">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021168">f</span><span class="op" id="3021169">.</span><span class="ident" id="3021170">nb</span>&nbsp;<span class="op" id="3021173">-=</span>&nbsp;<span class="num" id="3021176">1</span>&nbsp;<span class="op" id="3021178">+</span>&nbsp;<span class="num" id="3021180">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021183">switch</span>&nbsp;<span class="ident" id="3021190">typ</span>&nbsp;<span class="op" id="3021194">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021197">case</span>&nbsp;<span class="num" id="3021202">0</span><span class="op" id="3021203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021207">f</span><span class="op" id="3021208">.</span><span class="ident" id="3021209">dataBlock</span><span class="op" id="3021218">(</span><span class="op" id="3021219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021222">case</span>&nbsp;<span class="num" id="3021227">1</span><span class="op" id="3021228">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021232">//&nbsp;compressed,&nbsp;fixed&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021270">f</span><span class="op" id="3021271">.</span><span class="ident" id="3021272">hl</span>&nbsp;<span class="op" id="3021275">=</span>&nbsp;<span class="op" id="3021277">&amp;</span><span class="ident" id="3021278">fixedHuffmanDecoder</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021300">f</span><span class="op" id="3021301">.</span><span class="ident" id="3021302">hd</span>&nbsp;<span class="op" id="3021305">=</span>&nbsp;<span class="ident" id="3021307">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021313">f</span><span class="op" id="3021314">.</span><span class="ident" id="3021315">huffmanBlock</span><span class="op" id="3021327">(</span><span class="op" id="3021328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021331">case</span>&nbsp;<span class="num" id="3021336">2</span><span class="op" id="3021337">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021341">//&nbsp;compressed,&nbsp;dynamic&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021381">if</span>&nbsp;<span class="ident" id="3021384">f</span><span class="op" id="3021385">.</span><span class="ident" id="3021386">err</span>&nbsp;<span class="op" id="3021390">=</span>&nbsp;<span class="ident" id="3021392">f</span><span class="op" id="3021393">.</span><span class="ident" id="3021394">readHuffman</span><span class="op" id="3021405">(</span><span class="op" id="3021406">)</span><span class="op" id="3021407">;</span>&nbsp;<span class="ident" id="3021409">f</span><span class="op" id="3021410">.</span><span class="ident" id="3021411">err</span>&nbsp;<span class="op" id="3021415">!=</span>&nbsp;<span class="ident" id="3021418">nil</span>&nbsp;<span class="op" id="3021422">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021427">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021439">f</span><span class="op" id="3021440">.</span><span class="ident" id="3021441">hl</span>&nbsp;<span class="op" id="3021444">=</span>&nbsp;<span class="op" id="3021446">&amp;</span><span class="ident" id="3021447">f</span><span class="op" id="3021448">.</span><span class="ident" id="3021449">h1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021454">f</span><span class="op" id="3021455">.</span><span class="ident" id="3021456">hd</span>&nbsp;<span class="op" id="3021459">=</span>&nbsp;<span class="op" id="3021461">&amp;</span><span class="ident" id="3021462">f</span><span class="op" id="3021463">.</span><span class="ident" id="3021464">h2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021469">f</span><span class="op" id="3021470">.</span><span class="ident" id="3021471">huffmanBlock</span><span class="op" id="3021483">(</span><span class="op" id="3021484">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021487">default</span><span class="op" id="3021494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021498">//&nbsp;3&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021518">f</span><span class="op" id="3021519">.</span><span class="ident" id="3021520">err</span>&nbsp;<span class="op" id="3021524">=</span>&nbsp;<span class="ident" id="3021526">CorruptInputError</span><span class="op" id="3021543">(</span><span class="ident" id="3021544">f</span><span class="op" id="3021545">.</span><span class="ident" id="3021546">roffset</span><span class="op" id="3021553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021556">}</span><br>
<span class="lineno"></span><span class="op" id="3021558">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="3021561">func</span>&nbsp;<span class="op" id="3021566">(</span><span class="ident" id="3021567">f</span>&nbsp;<span class="op" id="3021569">*</span><span class="ident" id="3021570">decompressor</span><span class="op" id="3021582">)</span>&nbsp;<span class="ident" id="3021584">Read</span><span class="op" id="3021588">(</span><span class="ident" id="3021589">b</span>&nbsp;<span class="op" id="3021591">[</span><span class="op" id="3021592">]</span><span class="builtintype" id="3021593">byte</span><span class="op" id="3021597">)</span>&nbsp;<span class="op" id="3021599">(</span><span class="builtintype" id="3021600">int</span><span class="op" id="3021603">,</span>&nbsp;<span class="builtintype" id="3021605">error</span><span class="op" id="3021610">)</span>&nbsp;<span class="op" id="3021612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021615">for</span>&nbsp;<span class="op" id="3021619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021623">if</span>&nbsp;<span class="builtinfunc" id="3021626">len</span><span class="op" id="3021629">(</span><span class="ident" id="3021630">f</span><span class="op" id="3021631">.</span><span class="ident" id="3021632">toRead</span><span class="op" id="3021638">)</span>&nbsp;<span class="op" id="3021640">&gt;</span>&nbsp;<span class="num" id="3021642">0</span>&nbsp;<span class="op" id="3021644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021649">n</span>&nbsp;<span class="op" id="3021651">:=</span>&nbsp;<span class="builtinfunc" id="3021654">copy</span><span class="op" id="3021658">(</span><span class="ident" id="3021659">b</span><span class="op" id="3021660">,</span>&nbsp;<span class="ident" id="3021662">f</span><span class="op" id="3021663">.</span><span class="ident" id="3021664">toRead</span><span class="op" id="3021670">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021675">f</span><span class="op" id="3021676">.</span><span class="ident" id="3021677">toRead</span>&nbsp;<span class="op" id="3021684">=</span>&nbsp;<span class="ident" id="3021686">f</span><span class="op" id="3021687">.</span><span class="ident" id="3021688">toRead</span><span class="op" id="3021694">[</span><span class="ident" id="3021695">n</span><span class="op" id="3021696">:</span><span class="op" id="3021697">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021702">return</span>&nbsp;<span class="ident" id="3021709">n</span><span class="op" id="3021710">,</span>&nbsp;<span class="ident" id="3021712">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021722">if</span>&nbsp;<span class="ident" id="3021725">f</span><span class="op" id="3021726">.</span><span class="ident" id="3021727">err</span>&nbsp;<span class="op" id="3021731">!=</span>&nbsp;<span class="ident" id="3021734">nil</span>&nbsp;<span class="op" id="3021738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021743">return</span>&nbsp;<span class="num" id="3021750">0</span><span class="op" id="3021751">,</span>&nbsp;<span class="ident" id="3021753">f</span><span class="op" id="3021754">.</span><span class="ident" id="3021755">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021765">f</span><span class="op" id="3021766">.</span><span class="ident" id="3021767">step</span><span class="op" id="3021771">(</span><span class="ident" id="3021772">f</span><span class="op" id="3021773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021776">}</span><br>
<span class="lineno"></span><span class="op" id="3021778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="3021781">func</span>&nbsp;<span class="op" id="3021786">(</span><span class="ident" id="3021787">f</span>&nbsp;<span class="op" id="3021789">*</span><span class="ident" id="3021790">decompressor</span><span class="op" id="3021802">)</span>&nbsp;<span class="ident" id="3021804">Close</span><span class="op" id="3021809">(</span><span class="op" id="3021810">)</span>&nbsp;<span class="builtintype" id="3021812">error</span>&nbsp;<span class="op" id="3021818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021821">if</span>&nbsp;<span class="ident" id="3021824">f</span><span class="op" id="3021825">.</span><span class="ident" id="3021826">err</span>&nbsp;<span class="op" id="3021830">==</span>&nbsp;<span class="ident" id="3021833">io</span><span class="op" id="3021835">.</span><span class="ident" id="3021836">EOF</span>&nbsp;<span class="op" id="3021840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021844">return</span>&nbsp;<span class="ident" id="3021851">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021859">return</span>&nbsp;<span class="ident" id="3021866">f</span><span class="op" id="3021867">.</span><span class="ident" id="3021868">err</span><br>
<span class="lineno">295</span><span class="op" id="3021872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3021875">//&nbsp;RFC&nbsp;1951&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span><span class="comment" id="3021902">//&nbsp;Compression&nbsp;with&nbsp;dynamic&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="3021945">var</span>&nbsp;<span class="ident" id="3021949">codeOrder</span>&nbsp;<span class="op" id="3021959">=</span>&nbsp;<span class="op" id="3021961">[</span><span class="op" id="3021962">...</span><span class="op" id="3021965">]</span><span class="builtintype" id="3021966">int</span><span class="op" id="3021969">{</span><span class="num" id="3021970">16</span><span class="op" id="3021972">,</span>&nbsp;<span class="num" id="3021974">17</span><span class="op" id="3021976">,</span>&nbsp;<span class="num" id="3021978">18</span><span class="op" id="3021980">,</span>&nbsp;<span class="num" id="3021982">0</span><span class="op" id="3021983">,</span>&nbsp;<span class="num" id="3021985">8</span><span class="op" id="3021986">,</span>&nbsp;<span class="num" id="3021988">7</span><span class="op" id="3021989">,</span>&nbsp;<span class="num" id="3021991">9</span><span class="op" id="3021992">,</span>&nbsp;<span class="num" id="3021994">6</span><span class="op" id="3021995">,</span>&nbsp;<span class="num" id="3021997">10</span><span class="op" id="3021999">,</span>&nbsp;<span class="num" id="3022001">5</span><span class="op" id="3022002">,</span>&nbsp;<span class="num" id="3022004">11</span><span class="op" id="3022006">,</span>&nbsp;<span class="num" id="3022008">4</span><span class="op" id="3022009">,</span>&nbsp;<span class="num" id="3022011">12</span><span class="op" id="3022013">,</span>&nbsp;<span class="num" id="3022015">3</span><span class="op" id="3022016">,</span>&nbsp;<span class="num" id="3022018">13</span><span class="op" id="3022020">,</span>&nbsp;<span class="num" id="3022022">2</span><span class="op" id="3022023">,</span>&nbsp;<span class="num" id="3022025">14</span><span class="op" id="3022027">,</span>&nbsp;<span class="num" id="3022029">1</span><span class="op" id="3022030">,</span>&nbsp;<span class="num" id="3022032">15</span><span class="op" id="3022034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3022037">func</span>&nbsp;<span class="op" id="3022042">(</span><span class="ident" id="3022043">f</span>&nbsp;<span class="op" id="3022045">*</span><span class="ident" id="3022046">decompressor</span><span class="op" id="3022058">)</span>&nbsp;<span class="ident" id="3022060">readHuffman</span><span class="op" id="3022071">(</span><span class="op" id="3022072">)</span>&nbsp;<span class="builtintype" id="3022074">error</span>&nbsp;<span class="op" id="3022080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022083">//&nbsp;HLIT[5],&nbsp;HDIST[5],&nbsp;HCLEN[4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022116">for</span>&nbsp;<span class="ident" id="3022120">f</span><span class="op" id="3022121">.</span><span class="ident" id="3022122">nb</span>&nbsp;<span class="op" id="3022125">&lt;</span>&nbsp;<span class="num" id="3022127">5</span><span class="op" id="3022128">+</span><span class="num" id="3022129">5</span><span class="op" id="3022130">+</span><span class="num" id="3022131">4</span>&nbsp;<span class="op" id="3022133">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022137">if</span>&nbsp;<span class="ident" id="3022140">err</span>&nbsp;<span class="op" id="3022144">:=</span>&nbsp;<span class="ident" id="3022147">f</span><span class="op" id="3022148">.</span><span class="ident" id="3022149">moreBits</span><span class="op" id="3022157">(</span><span class="op" id="3022158">)</span><span class="op" id="3022159">;</span>&nbsp;<span class="ident" id="3022161">err</span>&nbsp;<span class="op" id="3022165">!=</span>&nbsp;<span class="ident" id="3022168">nil</span>&nbsp;<span class="op" id="3022172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022177">return</span>&nbsp;<span class="ident" id="3022184">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022196">nlit</span>&nbsp;<span class="op" id="3022201">:=</span>&nbsp;<span class="builtintype" id="3022204">int</span><span class="op" id="3022207">(</span><span class="ident" id="3022208">f</span><span class="op" id="3022209">.</span><span class="ident" id="3022210">b</span><span class="op" id="3022211">&amp;</span><span class="num" id="3022212">0x1F</span><span class="op" id="3022216">)</span>&nbsp;<span class="op" id="3022218">+</span>&nbsp;<span class="num" id="3022220">257</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022225">if</span>&nbsp;<span class="ident" id="3022228">nlit</span>&nbsp;<span class="op" id="3022233">&gt;</span>&nbsp;<span class="ident" id="3022235">maxLit</span>&nbsp;<span class="op" id="3022242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022246">return</span>&nbsp;<span class="ident" id="3022253">CorruptInputError</span><span class="op" id="3022270">(</span><span class="ident" id="3022271">f</span><span class="op" id="3022272">.</span><span class="ident" id="3022273">roffset</span><span class="op" id="3022280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022286">f</span><span class="op" id="3022287">.</span><span class="ident" id="3022288">b</span>&nbsp;<span class="op" id="3022290">&gt;&gt;=</span>&nbsp;<span class="num" id="3022294">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022297">ndist</span>&nbsp;<span class="op" id="3022303">:=</span>&nbsp;<span class="builtintype" id="3022306">int</span><span class="op" id="3022309">(</span><span class="ident" id="3022310">f</span><span class="op" id="3022311">.</span><span class="ident" id="3022312">b</span><span class="op" id="3022313">&amp;</span><span class="num" id="3022314">0x1F</span><span class="op" id="3022318">)</span>&nbsp;<span class="op" id="3022320">+</span>&nbsp;<span class="num" id="3022322">1</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022325">//&nbsp;maxDist&nbsp;is&nbsp;32,&nbsp;so&nbsp;ndist&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022370">f</span><span class="op" id="3022371">.</span><span class="ident" id="3022372">b</span>&nbsp;<span class="op" id="3022374">&gt;&gt;=</span>&nbsp;<span class="num" id="3022378">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022381">nclen</span>&nbsp;<span class="op" id="3022387">:=</span>&nbsp;<span class="builtintype" id="3022390">int</span><span class="op" id="3022393">(</span><span class="ident" id="3022394">f</span><span class="op" id="3022395">.</span><span class="ident" id="3022396">b</span><span class="op" id="3022397">&amp;</span><span class="num" id="3022398">0xF</span><span class="op" id="3022401">)</span>&nbsp;<span class="op" id="3022403">+</span>&nbsp;<span class="num" id="3022405">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022408">//&nbsp;numCodes&nbsp;is&nbsp;19,&nbsp;so&nbsp;nclen&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022454">f</span><span class="op" id="3022455">.</span><span class="ident" id="3022456">b</span>&nbsp;<span class="op" id="3022458">&gt;&gt;=</span>&nbsp;<span class="num" id="3022462">4</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022465">f</span><span class="op" id="3022466">.</span><span class="ident" id="3022467">nb</span>&nbsp;<span class="op" id="3022470">-=</span>&nbsp;<span class="num" id="3022473">5</span>&nbsp;<span class="op" id="3022475">+</span>&nbsp;<span class="num" id="3022477">5</span>&nbsp;<span class="op" id="3022479">+</span>&nbsp;<span class="num" id="3022481">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022485">//&nbsp;(HCLEN+4)*3&nbsp;bits:&nbsp;code&nbsp;lengths&nbsp;in&nbsp;the&nbsp;magic&nbsp;codeOrder&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022550">for</span>&nbsp;<span class="ident" id="3022554">i</span>&nbsp;<span class="op" id="3022556">:=</span>&nbsp;<span class="num" id="3022559">0</span><span class="op" id="3022560">;</span>&nbsp;<span class="ident" id="3022562">i</span>&nbsp;<span class="op" id="3022564">&lt;</span>&nbsp;<span class="ident" id="3022566">nclen</span><span class="op" id="3022571">;</span>&nbsp;<span class="ident" id="3022573">i</span><span class="op" id="3022574">++</span>&nbsp;<span class="op" id="3022577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022581">for</span>&nbsp;<span class="ident" id="3022585">f</span><span class="op" id="3022586">.</span><span class="ident" id="3022587">nb</span>&nbsp;<span class="op" id="3022590">&lt;</span>&nbsp;<span class="num" id="3022592">3</span>&nbsp;<span class="op" id="3022594">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022599">if</span>&nbsp;<span class="ident" id="3022602">err</span>&nbsp;<span class="op" id="3022606">:=</span>&nbsp;<span class="ident" id="3022609">f</span><span class="op" id="3022610">.</span><span class="ident" id="3022611">moreBits</span><span class="op" id="3022619">(</span><span class="op" id="3022620">)</span><span class="op" id="3022621">;</span>&nbsp;<span class="ident" id="3022623">err</span>&nbsp;<span class="op" id="3022627">!=</span>&nbsp;<span class="ident" id="3022630">nil</span>&nbsp;<span class="op" id="3022634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022640">return</span>&nbsp;<span class="ident" id="3022647">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022662">f</span><span class="op" id="3022663">.</span><span class="ident" id="3022664">codebits</span><span class="op" id="3022672">[</span><span class="ident" id="3022673">codeOrder</span><span class="op" id="3022682">[</span><span class="ident" id="3022683">i</span><span class="op" id="3022684">]</span><span class="op" id="3022685">]</span>&nbsp;<span class="op" id="3022687">=</span>&nbsp;<span class="builtintype" id="3022689">int</span><span class="op" id="3022692">(</span><span class="ident" id="3022693">f</span><span class="op" id="3022694">.</span><span class="ident" id="3022695">b</span>&nbsp;<span class="op" id="3022697">&amp;</span>&nbsp;<span class="num" id="3022699">0x7</span><span class="op" id="3022702">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022706">f</span><span class="op" id="3022707">.</span><span class="ident" id="3022708">b</span>&nbsp;<span class="op" id="3022710">&gt;&gt;=</span>&nbsp;<span class="num" id="3022714">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022718">f</span><span class="op" id="3022719">.</span><span class="ident" id="3022720">nb</span>&nbsp;<span class="op" id="3022723">-=</span>&nbsp;<span class="num" id="3022726">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022732">for</span>&nbsp;<span class="ident" id="3022736">i</span>&nbsp;<span class="op" id="3022738">:=</span>&nbsp;<span class="ident" id="3022741">nclen</span><span class="op" id="3022746">;</span>&nbsp;<span class="ident" id="3022748">i</span>&nbsp;<span class="op" id="3022750">&lt;</span>&nbsp;<span class="builtinfunc" id="3022752">len</span><span class="op" id="3022755">(</span><span class="ident" id="3022756">codeOrder</span><span class="op" id="3022765">)</span><span class="op" id="3022766">;</span>&nbsp;<span class="ident" id="3022768">i</span><span class="op" id="3022769">++</span>&nbsp;<span class="op" id="3022772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022776">f</span><span class="op" id="3022777">.</span><span class="ident" id="3022778">codebits</span><span class="op" id="3022786">[</span><span class="ident" id="3022787">codeOrder</span><span class="op" id="3022796">[</span><span class="ident" id="3022797">i</span><span class="op" id="3022798">]</span><span class="op" id="3022799">]</span>&nbsp;<span class="op" id="3022801">=</span>&nbsp;<span class="num" id="3022803">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022809">if</span>&nbsp;<span class="op" id="3022812">!</span><span class="ident" id="3022813">f</span><span class="op" id="3022814">.</span><span class="ident" id="3022815">h1</span><span class="op" id="3022817">.</span><span class="ident" id="3022818">init</span><span class="op" id="3022822">(</span><span class="ident" id="3022823">f</span><span class="op" id="3022824">.</span><span class="ident" id="3022825">codebits</span><span class="op" id="3022833">[</span><span class="num" id="3022834">0</span><span class="op" id="3022835">:</span><span class="op" id="3022836">]</span><span class="op" id="3022837">)</span>&nbsp;<span class="op" id="3022839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022843">return</span>&nbsp;<span class="ident" id="3022850">CorruptInputError</span><span class="op" id="3022867">(</span><span class="ident" id="3022868">f</span><span class="op" id="3022869">.</span><span class="ident" id="3022870">roffset</span><span class="op" id="3022877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022884">//&nbsp;HLIT&nbsp;+&nbsp;257&nbsp;code&nbsp;lengths,&nbsp;HDIST&nbsp;+&nbsp;1&nbsp;code&nbsp;lengths,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022937">//&nbsp;using&nbsp;the&nbsp;code&nbsp;length&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022977">for</span>&nbsp;<span class="ident" id="3022981">i</span><span class="op" id="3022982">,</span>&nbsp;<span class="ident" id="3022984">n</span>&nbsp;<span class="op" id="3022986">:=</span>&nbsp;<span class="num" id="3022989">0</span><span class="op" id="3022990">,</span>&nbsp;<span class="ident" id="3022992">nlit</span><span class="op" id="3022996">+</span><span class="ident" id="3022997">ndist</span><span class="op" id="3023002">;</span>&nbsp;<span class="ident" id="3023004">i</span>&nbsp;<span class="op" id="3023006">&lt;</span>&nbsp;<span class="ident" id="3023008">n</span><span class="op" id="3023009">;</span>&nbsp;<span class="op" id="3023011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023015">x</span><span class="op" id="3023016">,</span>&nbsp;<span class="ident" id="3023018">err</span>&nbsp;<span class="op" id="3023022">:=</span>&nbsp;<span class="ident" id="3023025">f</span><span class="op" id="3023026">.</span><span class="ident" id="3023027">huffSym</span><span class="op" id="3023034">(</span><span class="op" id="3023035">&amp;</span><span class="ident" id="3023036">f</span><span class="op" id="3023037">.</span><span class="ident" id="3023038">h1</span><span class="op" id="3023040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023044">if</span>&nbsp;<span class="ident" id="3023047">err</span>&nbsp;<span class="op" id="3023051">!=</span>&nbsp;<span class="ident" id="3023054">nil</span>&nbsp;<span class="op" id="3023058">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023063">return</span>&nbsp;<span class="ident" id="3023070">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023080">if</span>&nbsp;<span class="ident" id="3023083">x</span>&nbsp;<span class="op" id="3023085">&lt;</span>&nbsp;<span class="num" id="3023087">16</span>&nbsp;<span class="op" id="3023090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023095">//&nbsp;Actual&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023116">f</span><span class="op" id="3023117">.</span><span class="ident" id="3023118">bits</span><span class="op" id="3023122">[</span><span class="ident" id="3023123">i</span><span class="op" id="3023124">]</span>&nbsp;<span class="op" id="3023126">=</span>&nbsp;<span class="ident" id="3023128">x</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023133">i</span><span class="op" id="3023134">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023140">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023155">//&nbsp;Repeat&nbsp;previous&nbsp;length&nbsp;or&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023192">var</span>&nbsp;<span class="ident" id="3023196">rep</span>&nbsp;<span class="builtintype" id="3023200">int</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023206">var</span>&nbsp;<span class="ident" id="3023210">nb</span>&nbsp;<span class="builtintype" id="3023213">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023220">var</span>&nbsp;<span class="ident" id="3023224">b</span>&nbsp;<span class="builtintype" id="3023226">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023232">switch</span>&nbsp;<span class="ident" id="3023239">x</span>&nbsp;<span class="op" id="3023241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023245">default</span><span class="op" id="3023252">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023257">return</span>&nbsp;<span class="ident" id="3023264">InternalError</span><span class="op" id="3023277">(</span><span class="string" id="3023278">&#34;unexpected&nbsp;length&nbsp;code&#34;</span><span class="op" id="3023302">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023306">case</span>&nbsp;<span class="num" id="3023311">16</span><span class="op" id="3023313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023318">rep</span>&nbsp;<span class="op" id="3023322">=</span>&nbsp;<span class="num" id="3023324">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023329">nb</span>&nbsp;<span class="op" id="3023332">=</span>&nbsp;<span class="num" id="3023334">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023339">if</span>&nbsp;<span class="ident" id="3023342">i</span>&nbsp;<span class="op" id="3023344">==</span>&nbsp;<span class="num" id="3023347">0</span>&nbsp;<span class="op" id="3023349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023355">return</span>&nbsp;<span class="ident" id="3023362">CorruptInputError</span><span class="op" id="3023379">(</span><span class="ident" id="3023380">f</span><span class="op" id="3023381">.</span><span class="ident" id="3023382">roffset</span><span class="op" id="3023389">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023399">b</span>&nbsp;<span class="op" id="3023401">=</span>&nbsp;<span class="ident" id="3023403">f</span><span class="op" id="3023404">.</span><span class="ident" id="3023405">bits</span><span class="op" id="3023409">[</span><span class="ident" id="3023410">i</span><span class="op" id="3023411">-</span><span class="num" id="3023412">1</span><span class="op" id="3023413">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023417">case</span>&nbsp;<span class="num" id="3023422">17</span><span class="op" id="3023424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023429">rep</span>&nbsp;<span class="op" id="3023433">=</span>&nbsp;<span class="num" id="3023435">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023440">nb</span>&nbsp;<span class="op" id="3023443">=</span>&nbsp;<span class="num" id="3023445">3</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023450">b</span>&nbsp;<span class="op" id="3023452">=</span>&nbsp;<span class="num" id="3023454">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023458">case</span>&nbsp;<span class="num" id="3023463">18</span><span class="op" id="3023465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023470">rep</span>&nbsp;<span class="op" id="3023474">=</span>&nbsp;<span class="num" id="3023476">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023482">nb</span>&nbsp;<span class="op" id="3023485">=</span>&nbsp;<span class="num" id="3023487">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023492">b</span>&nbsp;<span class="op" id="3023494">=</span>&nbsp;<span class="num" id="3023496">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023504">for</span>&nbsp;<span class="ident" id="3023508">f</span><span class="op" id="3023509">.</span><span class="ident" id="3023510">nb</span>&nbsp;<span class="op" id="3023513">&lt;</span>&nbsp;<span class="ident" id="3023515">nb</span>&nbsp;<span class="op" id="3023518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023523">if</span>&nbsp;<span class="ident" id="3023526">err</span>&nbsp;<span class="op" id="3023530">:=</span>&nbsp;<span class="ident" id="3023533">f</span><span class="op" id="3023534">.</span><span class="ident" id="3023535">moreBits</span><span class="op" id="3023543">(</span><span class="op" id="3023544">)</span><span class="op" id="3023545">;</span>&nbsp;<span class="ident" id="3023547">err</span>&nbsp;<span class="op" id="3023551">!=</span>&nbsp;<span class="ident" id="3023554">nil</span>&nbsp;<span class="op" id="3023558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023564">return</span>&nbsp;<span class="ident" id="3023571">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023578">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023586">rep</span>&nbsp;<span class="op" id="3023590">+=</span>&nbsp;<span class="builtintype" id="3023593">int</span><span class="op" id="3023596">(</span><span class="ident" id="3023597">f</span><span class="op" id="3023598">.</span><span class="ident" id="3023599">b</span>&nbsp;<span class="op" id="3023601">&amp;</span>&nbsp;<span class="builtintype" id="3023603">uint32</span><span class="op" id="3023609">(</span><span class="num" id="3023610">1</span><span class="op" id="3023611">&lt;&lt;</span><span class="ident" id="3023613">nb</span><span class="op" id="3023615">-</span><span class="num" id="3023616">1</span><span class="op" id="3023617">)</span><span class="op" id="3023618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023622">f</span><span class="op" id="3023623">.</span><span class="ident" id="3023624">b</span>&nbsp;<span class="op" id="3023626">&gt;&gt;=</span>&nbsp;<span class="ident" id="3023630">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023635">f</span><span class="op" id="3023636">.</span><span class="ident" id="3023637">nb</span>&nbsp;<span class="op" id="3023640">-=</span>&nbsp;<span class="ident" id="3023643">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023648">if</span>&nbsp;<span class="ident" id="3023651">i</span><span class="op" id="3023652">+</span><span class="ident" id="3023653">rep</span>&nbsp;<span class="op" id="3023657">&gt;</span>&nbsp;<span class="ident" id="3023659">n</span>&nbsp;<span class="op" id="3023661">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023666">return</span>&nbsp;<span class="ident" id="3023673">CorruptInputError</span><span class="op" id="3023690">(</span><span class="ident" id="3023691">f</span><span class="op" id="3023692">.</span><span class="ident" id="3023693">roffset</span><span class="op" id="3023700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023708">for</span>&nbsp;<span class="ident" id="3023712">j</span>&nbsp;<span class="op" id="3023714">:=</span>&nbsp;<span class="num" id="3023717">0</span><span class="op" id="3023718">;</span>&nbsp;<span class="ident" id="3023720">j</span>&nbsp;<span class="op" id="3023722">&lt;</span>&nbsp;<span class="ident" id="3023724">rep</span><span class="op" id="3023727">;</span>&nbsp;<span class="ident" id="3023729">j</span><span class="op" id="3023730">++</span>&nbsp;<span class="op" id="3023733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023738">f</span><span class="op" id="3023739">.</span><span class="ident" id="3023740">bits</span><span class="op" id="3023744">[</span><span class="ident" id="3023745">i</span><span class="op" id="3023746">]</span>&nbsp;<span class="op" id="3023748">=</span>&nbsp;<span class="ident" id="3023750">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023755">i</span><span class="op" id="3023756">++</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023768">if</span>&nbsp;<span class="op" id="3023771">!</span><span class="ident" id="3023772">f</span><span class="op" id="3023773">.</span><span class="ident" id="3023774">h1</span><span class="op" id="3023776">.</span><span class="ident" id="3023777">init</span><span class="op" id="3023781">(</span><span class="ident" id="3023782">f</span><span class="op" id="3023783">.</span><span class="ident" id="3023784">bits</span><span class="op" id="3023788">[</span><span class="num" id="3023789">0</span><span class="op" id="3023790">:</span><span class="ident" id="3023791">nlit</span><span class="op" id="3023795">]</span><span class="op" id="3023796">)</span>&nbsp;<span class="op" id="3023798">||</span>&nbsp;<span class="op" id="3023801">!</span><span class="ident" id="3023802">f</span><span class="op" id="3023803">.</span><span class="ident" id="3023804">h2</span><span class="op" id="3023806">.</span><span class="ident" id="3023807">init</span><span class="op" id="3023811">(</span><span class="ident" id="3023812">f</span><span class="op" id="3023813">.</span><span class="ident" id="3023814">bits</span><span class="op" id="3023818">[</span><span class="ident" id="3023819">nlit</span><span class="op" id="3023823">:</span><span class="ident" id="3023824">nlit</span><span class="op" id="3023828">+</span><span class="ident" id="3023829">ndist</span><span class="op" id="3023834">]</span><span class="op" id="3023835">)</span>&nbsp;<span class="op" id="3023837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023841">return</span>&nbsp;<span class="ident" id="3023848">CorruptInputError</span><span class="op" id="3023865">(</span><span class="ident" id="3023866">f</span><span class="op" id="3023867">.</span><span class="ident" id="3023868">roffset</span><span class="op" id="3023875">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023882">return</span>&nbsp;<span class="ident" id="3023889">nil</span><br>
<span class="lineno"></span><span class="op" id="3023893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="3023896">//&nbsp;Decode&nbsp;a&nbsp;single&nbsp;Huffman&nbsp;block&nbsp;from&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="3023937">//&nbsp;hl&nbsp;and&nbsp;hd&nbsp;are&nbsp;the&nbsp;Huffman&nbsp;states&nbsp;for&nbsp;the&nbsp;lit/length&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="3023999">//&nbsp;and&nbsp;the&nbsp;distance&nbsp;values,&nbsp;respectively.&nbsp;&nbsp;If&nbsp;hd&nbsp;==&nbsp;nil,&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3024066">//&nbsp;fixed&nbsp;distance&nbsp;encoding&nbsp;associated&nbsp;with&nbsp;fixed&nbsp;Huffman&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="3024131">func</span>&nbsp;<span class="op" id="3024136">(</span><span class="ident" id="3024137">f</span>&nbsp;<span class="op" id="3024139">*</span><span class="ident" id="3024140">decompressor</span><span class="op" id="3024152">)</span>&nbsp;<span class="ident" id="3024154">huffmanBlock</span><span class="op" id="3024166">(</span><span class="op" id="3024167">)</span>&nbsp;<span class="op" id="3024169">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024172">for</span>&nbsp;<span class="op" id="3024176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024180">v</span><span class="op" id="3024181">,</span>&nbsp;<span class="ident" id="3024183">err</span>&nbsp;<span class="op" id="3024187">:=</span>&nbsp;<span class="ident" id="3024190">f</span><span class="op" id="3024191">.</span><span class="ident" id="3024192">huffSym</span><span class="op" id="3024199">(</span><span class="ident" id="3024200">f</span><span class="op" id="3024201">.</span><span class="ident" id="3024202">hl</span><span class="op" id="3024204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024208">if</span>&nbsp;<span class="ident" id="3024211">err</span>&nbsp;<span class="op" id="3024215">!=</span>&nbsp;<span class="ident" id="3024218">nil</span>&nbsp;<span class="op" id="3024222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024227">f</span><span class="op" id="3024228">.</span><span class="ident" id="3024229">err</span>&nbsp;<span class="op" id="3024233">=</span>&nbsp;<span class="ident" id="3024235">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024242">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024255">var</span>&nbsp;<span class="ident" id="3024259">n</span>&nbsp;<span class="builtintype" id="3024261">uint</span>&nbsp;<span class="comment" id="3024266">//&nbsp;number&nbsp;of&nbsp;bits&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024292">var</span>&nbsp;<span class="ident" id="3024296">length</span>&nbsp;<span class="builtintype" id="3024303">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024309">switch</span>&nbsp;<span class="op" id="3024316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024320">case</span>&nbsp;<span class="ident" id="3024325">v</span>&nbsp;<span class="op" id="3024327">&lt;</span>&nbsp;<span class="num" id="3024329">256</span><span class="op" id="3024332">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024337">f</span><span class="op" id="3024338">.</span><span class="ident" id="3024339">hist</span><span class="op" id="3024343">[</span><span class="ident" id="3024344">f</span><span class="op" id="3024345">.</span><span class="ident" id="3024346">hp</span><span class="op" id="3024348">]</span>&nbsp;<span class="op" id="3024350">=</span>&nbsp;<span class="builtintype" id="3024352">byte</span><span class="op" id="3024356">(</span><span class="ident" id="3024357">v</span><span class="op" id="3024358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024363">f</span><span class="op" id="3024364">.</span><span class="ident" id="3024365">hp</span><span class="op" id="3024367">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024373">if</span>&nbsp;<span class="ident" id="3024376">f</span><span class="op" id="3024377">.</span><span class="ident" id="3024378">hp</span>&nbsp;<span class="op" id="3024381">==</span>&nbsp;<span class="builtinfunc" id="3024384">len</span><span class="op" id="3024387">(</span><span class="ident" id="3024388">f</span><span class="op" id="3024389">.</span><span class="ident" id="3024390">hist</span><span class="op" id="3024394">)</span>&nbsp;<span class="op" id="3024396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024402">//&nbsp;After&nbsp;the&nbsp;flush,&nbsp;continue&nbsp;this&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024446">f</span><span class="op" id="3024447">.</span><span class="ident" id="3024448">flush</span><span class="op" id="3024453">(</span><span class="op" id="3024454">(</span><span class="op" id="3024455">*</span><span class="ident" id="3024456">decompressor</span><span class="op" id="3024468">)</span><span class="op" id="3024469">.</span><span class="ident" id="3024470">huffmanBlock</span><span class="op" id="3024482">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024488">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024503">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024514">case</span>&nbsp;<span class="ident" id="3024519">v</span>&nbsp;<span class="op" id="3024521">==</span>&nbsp;<span class="num" id="3024524">256</span><span class="op" id="3024527">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024532">//&nbsp;Done&nbsp;with&nbsp;huffman&nbsp;block;&nbsp;read&nbsp;next&nbsp;block.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024580">f</span><span class="op" id="3024581">.</span><span class="ident" id="3024582">step</span>&nbsp;<span class="op" id="3024587">=</span>&nbsp;<span class="op" id="3024589">(</span><span class="op" id="3024590">*</span><span class="ident" id="3024591">decompressor</span><span class="op" id="3024603">)</span><span class="op" id="3024604">.</span><span class="ident" id="3024605">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024618">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024627">//&nbsp;otherwise,&nbsp;reference&nbsp;to&nbsp;older&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024667">case</span>&nbsp;<span class="ident" id="3024672">v</span>&nbsp;<span class="op" id="3024674">&lt;</span>&nbsp;<span class="num" id="3024676">265</span><span class="op" id="3024679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024684">length</span>&nbsp;<span class="op" id="3024691">=</span>&nbsp;<span class="ident" id="3024693">v</span>&nbsp;<span class="op" id="3024695">-</span>&nbsp;<span class="op" id="3024697">(</span><span class="num" id="3024698">257</span>&nbsp;<span class="op" id="3024702">-</span>&nbsp;<span class="num" id="3024704">3</span><span class="op" id="3024705">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024710">n</span>&nbsp;<span class="op" id="3024712">=</span>&nbsp;<span class="num" id="3024714">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024718">case</span>&nbsp;<span class="ident" id="3024723">v</span>&nbsp;<span class="op" id="3024725">&lt;</span>&nbsp;<span class="num" id="3024727">269</span><span class="op" id="3024730">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024735">length</span>&nbsp;<span class="op" id="3024742">=</span>&nbsp;<span class="ident" id="3024744">v</span><span class="op" id="3024745">*</span><span class="num" id="3024746">2</span>&nbsp;<span class="op" id="3024748">-</span>&nbsp;<span class="op" id="3024750">(</span><span class="num" id="3024751">265</span><span class="op" id="3024754">*</span><span class="num" id="3024755">2</span>&nbsp;<span class="op" id="3024757">-</span>&nbsp;<span class="num" id="3024759">11</span><span class="op" id="3024761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024766">n</span>&nbsp;<span class="op" id="3024768">=</span>&nbsp;<span class="num" id="3024770">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024774">case</span>&nbsp;<span class="ident" id="3024779">v</span>&nbsp;<span class="op" id="3024781">&lt;</span>&nbsp;<span class="num" id="3024783">273</span><span class="op" id="3024786">:</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024791">length</span>&nbsp;<span class="op" id="3024798">=</span>&nbsp;<span class="ident" id="3024800">v</span><span class="op" id="3024801">*</span><span class="num" id="3024802">4</span>&nbsp;<span class="op" id="3024804">-</span>&nbsp;<span class="op" id="3024806">(</span><span class="num" id="3024807">269</span><span class="op" id="3024810">*</span><span class="num" id="3024811">4</span>&nbsp;<span class="op" id="3024813">-</span>&nbsp;<span class="num" id="3024815">19</span><span class="op" id="3024817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024822">n</span>&nbsp;<span class="op" id="3024824">=</span>&nbsp;<span class="num" id="3024826">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024830">case</span>&nbsp;<span class="ident" id="3024835">v</span>&nbsp;<span class="op" id="3024837">&lt;</span>&nbsp;<span class="num" id="3024839">277</span><span class="op" id="3024842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024847">length</span>&nbsp;<span class="op" id="3024854">=</span>&nbsp;<span class="ident" id="3024856">v</span><span class="op" id="3024857">*</span><span class="num" id="3024858">8</span>&nbsp;<span class="op" id="3024860">-</span>&nbsp;<span class="op" id="3024862">(</span><span class="num" id="3024863">273</span><span class="op" id="3024866">*</span><span class="num" id="3024867">8</span>&nbsp;<span class="op" id="3024869">-</span>&nbsp;<span class="num" id="3024871">35</span><span class="op" id="3024873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024878">n</span>&nbsp;<span class="op" id="3024880">=</span>&nbsp;<span class="num" id="3024882">3</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024886">case</span>&nbsp;<span class="ident" id="3024891">v</span>&nbsp;<span class="op" id="3024893">&lt;</span>&nbsp;<span class="num" id="3024895">281</span><span class="op" id="3024898">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024903">length</span>&nbsp;<span class="op" id="3024910">=</span>&nbsp;<span class="ident" id="3024912">v</span><span class="op" id="3024913">*</span><span class="num" id="3024914">16</span>&nbsp;<span class="op" id="3024917">-</span>&nbsp;<span class="op" id="3024919">(</span><span class="num" id="3024920">277</span><span class="op" id="3024923">*</span><span class="num" id="3024924">16</span>&nbsp;<span class="op" id="3024927">-</span>&nbsp;<span class="num" id="3024929">67</span><span class="op" id="3024931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024936">n</span>&nbsp;<span class="op" id="3024938">=</span>&nbsp;<span class="num" id="3024940">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024944">case</span>&nbsp;<span class="ident" id="3024949">v</span>&nbsp;<span class="op" id="3024951">&lt;</span>&nbsp;<span class="num" id="3024953">285</span><span class="op" id="3024956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024961">length</span>&nbsp;<span class="op" id="3024968">=</span>&nbsp;<span class="ident" id="3024970">v</span><span class="op" id="3024971">*</span><span class="num" id="3024972">32</span>&nbsp;<span class="op" id="3024975">-</span>&nbsp;<span class="op" id="3024977">(</span><span class="num" id="3024978">281</span><span class="op" id="3024981">*</span><span class="num" id="3024982">32</span>&nbsp;<span class="op" id="3024985">-</span>&nbsp;<span class="num" id="3024987">131</span><span class="op" id="3024990">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024995">n</span>&nbsp;<span class="op" id="3024997">=</span>&nbsp;<span class="num" id="3024999">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025003">default</span><span class="op" id="3025010">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025015">length</span>&nbsp;<span class="op" id="3025022">=</span>&nbsp;<span class="num" id="3025024">258</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025031">n</span>&nbsp;<span class="op" id="3025033">=</span>&nbsp;<span class="num" id="3025035">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025039">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025043">if</span>&nbsp;<span class="ident" id="3025046">n</span>&nbsp;<span class="op" id="3025048">&gt;</span>&nbsp;<span class="num" id="3025050">0</span>&nbsp;<span class="op" id="3025052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025057">for</span>&nbsp;<span class="ident" id="3025061">f</span><span class="op" id="3025062">.</span><span class="ident" id="3025063">nb</span>&nbsp;<span class="op" id="3025066">&lt;</span>&nbsp;<span class="ident" id="3025068">n</span>&nbsp;<span class="op" id="3025070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025076">if</span>&nbsp;<span class="ident" id="3025079">err</span>&nbsp;<span class="op" id="3025083">=</span>&nbsp;<span class="ident" id="3025085">f</span><span class="op" id="3025086">.</span><span class="ident" id="3025087">moreBits</span><span class="op" id="3025095">(</span><span class="op" id="3025096">)</span><span class="op" id="3025097">;</span>&nbsp;<span class="ident" id="3025099">err</span>&nbsp;<span class="op" id="3025103">!=</span>&nbsp;<span class="ident" id="3025106">nil</span>&nbsp;<span class="op" id="3025110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025117">f</span><span class="op" id="3025118">.</span><span class="ident" id="3025119">err</span>&nbsp;<span class="op" id="3025123">=</span>&nbsp;<span class="ident" id="3025125">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025134">return</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025155">length</span>&nbsp;<span class="op" id="3025162">+=</span>&nbsp;<span class="builtintype" id="3025165">int</span><span class="op" id="3025168">(</span><span class="ident" id="3025169">f</span><span class="op" id="3025170">.</span><span class="ident" id="3025171">b</span>&nbsp;<span class="op" id="3025173">&amp;</span>&nbsp;<span class="builtintype" id="3025175">uint32</span><span class="op" id="3025181">(</span><span class="num" id="3025182">1</span><span class="op" id="3025183">&lt;&lt;</span><span class="ident" id="3025185">n</span><span class="op" id="3025186">-</span><span class="num" id="3025187">1</span><span class="op" id="3025188">)</span><span class="op" id="3025189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025194">f</span><span class="op" id="3025195">.</span><span class="ident" id="3025196">b</span>&nbsp;<span class="op" id="3025198">&gt;&gt;=</span>&nbsp;<span class="ident" id="3025202">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025207">f</span><span class="op" id="3025208">.</span><span class="ident" id="3025209">nb</span>&nbsp;<span class="op" id="3025212">-=</span>&nbsp;<span class="ident" id="3025215">n</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025224">var</span>&nbsp;<span class="ident" id="3025228">dist</span>&nbsp;<span class="builtintype" id="3025233">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025239">if</span>&nbsp;<span class="ident" id="3025242">f</span><span class="op" id="3025243">.</span><span class="ident" id="3025244">hd</span>&nbsp;<span class="op" id="3025247">==</span>&nbsp;<span class="ident" id="3025250">nil</span>&nbsp;<span class="op" id="3025254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025259">for</span>&nbsp;<span class="ident" id="3025263">f</span><span class="op" id="3025264">.</span><span class="ident" id="3025265">nb</span>&nbsp;<span class="op" id="3025268">&lt;</span>&nbsp;<span class="num" id="3025270">5</span>&nbsp;<span class="op" id="3025272">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025278">if</span>&nbsp;<span class="ident" id="3025281">err</span>&nbsp;<span class="op" id="3025285">=</span>&nbsp;<span class="ident" id="3025287">f</span><span class="op" id="3025288">.</span><span class="ident" id="3025289">moreBits</span><span class="op" id="3025297">(</span><span class="op" id="3025298">)</span><span class="op" id="3025299">;</span>&nbsp;<span class="ident" id="3025301">err</span>&nbsp;<span class="op" id="3025305">!=</span>&nbsp;<span class="ident" id="3025308">nil</span>&nbsp;<span class="op" id="3025312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025319">f</span><span class="op" id="3025320">.</span><span class="ident" id="3025321">err</span>&nbsp;<span class="op" id="3025325">=</span>&nbsp;<span class="ident" id="3025327">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025336">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025352">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025357">dist</span>&nbsp;<span class="op" id="3025362">=</span>&nbsp;<span class="builtintype" id="3025364">int</span><span class="op" id="3025367">(</span><span class="ident" id="3025368">reverseByte</span><span class="op" id="3025379">[</span><span class="op" id="3025380">(</span><span class="ident" id="3025381">f</span><span class="op" id="3025382">.</span><span class="ident" id="3025383">b</span><span class="op" id="3025384">&amp;</span><span class="num" id="3025385">0x1F</span><span class="op" id="3025389">)</span><span class="op" id="3025390">&lt;&lt;</span><span class="num" id="3025392">3</span><span class="op" id="3025393">]</span><span class="op" id="3025394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025399">f</span><span class="op" id="3025400">.</span><span class="ident" id="3025401">b</span>&nbsp;<span class="op" id="3025403">&gt;&gt;=</span>&nbsp;<span class="num" id="3025407">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025412">f</span><span class="op" id="3025413">.</span><span class="ident" id="3025414">nb</span>&nbsp;<span class="op" id="3025417">-=</span>&nbsp;<span class="num" id="3025420">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025424">}</span>&nbsp;<span class="keyword" id="3025426">else</span>&nbsp;<span class="op" id="3025431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025436">if</span>&nbsp;<span class="ident" id="3025439">dist</span><span class="op" id="3025443">,</span>&nbsp;<span class="ident" id="3025445">err</span>&nbsp;<span class="op" id="3025449">=</span>&nbsp;<span class="ident" id="3025451">f</span><span class="op" id="3025452">.</span><span class="ident" id="3025453">huffSym</span><span class="op" id="3025460">(</span><span class="ident" id="3025461">f</span><span class="op" id="3025462">.</span><span class="ident" id="3025463">hd</span><span class="op" id="3025465">)</span><span class="op" id="3025466">;</span>&nbsp;<span class="ident" id="3025468">err</span>&nbsp;<span class="op" id="3025472">!=</span>&nbsp;<span class="ident" id="3025475">nil</span>&nbsp;<span class="op" id="3025479">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025485">f</span><span class="op" id="3025486">.</span><span class="ident" id="3025487">err</span>&nbsp;<span class="op" id="3025491">=</span>&nbsp;<span class="ident" id="3025493">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025501">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025520">switch</span>&nbsp;<span class="op" id="3025527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025531">case</span>&nbsp;<span class="ident" id="3025536">dist</span>&nbsp;<span class="op" id="3025541">&lt;</span>&nbsp;<span class="num" id="3025543">4</span><span class="op" id="3025544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025549">dist</span><span class="op" id="3025553">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025558">case</span>&nbsp;<span class="ident" id="3025563">dist</span>&nbsp;<span class="op" id="3025568">&gt;=</span>&nbsp;<span class="num" id="3025571">30</span><span class="op" id="3025573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025578">f</span><span class="op" id="3025579">.</span><span class="ident" id="3025580">err</span>&nbsp;<span class="op" id="3025584">=</span>&nbsp;<span class="ident" id="3025586">CorruptInputError</span><span class="op" id="3025603">(</span><span class="ident" id="3025604">f</span><span class="op" id="3025605">.</span><span class="ident" id="3025606">roffset</span><span class="op" id="3025613">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025618">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025627">default</span><span class="op" id="3025634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025639">nb</span>&nbsp;<span class="op" id="3025642">:=</span>&nbsp;<span class="builtintype" id="3025645">uint</span><span class="op" id="3025649">(</span><span class="ident" id="3025650">dist</span><span class="op" id="3025654">-</span><span class="num" id="3025655">2</span><span class="op" id="3025656">)</span>&nbsp;<span class="op" id="3025658">&gt;&gt;</span>&nbsp;<span class="num" id="3025661">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025666">//&nbsp;have&nbsp;1&nbsp;bit&nbsp;in&nbsp;bottom&nbsp;of&nbsp;dist,&nbsp;need&nbsp;nb&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025716">extra</span>&nbsp;<span class="op" id="3025722">:=</span>&nbsp;<span class="op" id="3025725">(</span><span class="ident" id="3025726">dist</span>&nbsp;<span class="op" id="3025731">&amp;</span>&nbsp;<span class="num" id="3025733">1</span><span class="op" id="3025734">)</span>&nbsp;<span class="op" id="3025736">&lt;&lt;</span>&nbsp;<span class="ident" id="3025739">nb</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025745">for</span>&nbsp;<span class="ident" id="3025749">f</span><span class="op" id="3025750">.</span><span class="ident" id="3025751">nb</span>&nbsp;<span class="op" id="3025754">&lt;</span>&nbsp;<span class="ident" id="3025756">nb</span>&nbsp;<span class="op" id="3025759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025765">if</span>&nbsp;<span class="ident" id="3025768">err</span>&nbsp;<span class="op" id="3025772">=</span>&nbsp;<span class="ident" id="3025774">f</span><span class="op" id="3025775">.</span><span class="ident" id="3025776">moreBits</span><span class="op" id="3025784">(</span><span class="op" id="3025785">)</span><span class="op" id="3025786">;</span>&nbsp;<span class="ident" id="3025788">err</span>&nbsp;<span class="op" id="3025792">!=</span>&nbsp;<span class="ident" id="3025795">nil</span>&nbsp;<span class="op" id="3025799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025806">f</span><span class="op" id="3025807">.</span><span class="ident" id="3025808">err</span>&nbsp;<span class="op" id="3025812">=</span>&nbsp;<span class="ident" id="3025814">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025823">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025834">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025844">extra</span>&nbsp;<span class="op" id="3025850">|=</span>&nbsp;<span class="builtintype" id="3025853">int</span><span class="op" id="3025856">(</span><span class="ident" id="3025857">f</span><span class="op" id="3025858">.</span><span class="ident" id="3025859">b</span>&nbsp;<span class="op" id="3025861">&amp;</span>&nbsp;<span class="builtintype" id="3025863">uint32</span><span class="op" id="3025869">(</span><span class="num" id="3025870">1</span><span class="op" id="3025871">&lt;&lt;</span><span class="ident" id="3025873">nb</span><span class="op" id="3025875">-</span><span class="num" id="3025876">1</span><span class="op" id="3025877">)</span><span class="op" id="3025878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025883">f</span><span class="op" id="3025884">.</span><span class="ident" id="3025885">b</span>&nbsp;<span class="op" id="3025887">&gt;&gt;=</span>&nbsp;<span class="ident" id="3025891">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025897">f</span><span class="op" id="3025898">.</span><span class="ident" id="3025899">nb</span>&nbsp;<span class="op" id="3025902">-=</span>&nbsp;<span class="ident" id="3025905">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025911">dist</span>&nbsp;<span class="op" id="3025916">=</span>&nbsp;<span class="num" id="3025918">1</span><span class="op" id="3025919">&lt;&lt;</span><span class="op" id="3025921">(</span><span class="ident" id="3025922">nb</span><span class="op" id="3025924">+</span><span class="num" id="3025925">1</span><span class="op" id="3025926">)</span>&nbsp;<span class="op" id="3025928">+</span>&nbsp;<span class="num" id="3025930">1</span>&nbsp;<span class="op" id="3025932">+</span>&nbsp;<span class="ident" id="3025934">extra</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025947">//&nbsp;Copy&nbsp;history[-dist:-dist+length]&nbsp;into&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025998">if</span>&nbsp;<span class="ident" id="3026001">dist</span>&nbsp;<span class="op" id="3026006">&gt;</span>&nbsp;<span class="builtinfunc" id="3026008">len</span><span class="op" id="3026011">(</span><span class="ident" id="3026012">f</span><span class="op" id="3026013">.</span><span class="ident" id="3026014">hist</span><span class="op" id="3026018">)</span>&nbsp;<span class="op" id="3026020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026025">f</span><span class="op" id="3026026">.</span><span class="ident" id="3026027">err</span>&nbsp;<span class="op" id="3026031">=</span>&nbsp;<span class="ident" id="3026033">InternalError</span><span class="op" id="3026046">(</span><span class="string" id="3026047">&#34;bad&nbsp;history&nbsp;distance&#34;</span><span class="op" id="3026069">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026074">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026088">//&nbsp;No&nbsp;check&nbsp;on&nbsp;length;&nbsp;encoding&nbsp;can&nbsp;be&nbsp;prescient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026140">if</span>&nbsp;<span class="op" id="3026143">!</span><span class="ident" id="3026144">f</span><span class="op" id="3026145">.</span><span class="ident" id="3026146">hfull</span>&nbsp;<span class="op" id="3026152">&amp;&amp;</span>&nbsp;<span class="ident" id="3026155">dist</span>&nbsp;<span class="op" id="3026160">&gt;</span>&nbsp;<span class="ident" id="3026162">f</span><span class="op" id="3026163">.</span><span class="ident" id="3026164">hp</span>&nbsp;<span class="op" id="3026167">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026172">f</span><span class="op" id="3026173">.</span><span class="ident" id="3026174">err</span>&nbsp;<span class="op" id="3026178">=</span>&nbsp;<span class="ident" id="3026180">CorruptInputError</span><span class="op" id="3026197">(</span><span class="ident" id="3026198">f</span><span class="op" id="3026199">.</span><span class="ident" id="3026200">roffset</span><span class="op" id="3026207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026212">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026226">f</span><span class="op" id="3026227">.</span><span class="ident" id="3026228">copyLen</span><span class="op" id="3026235">,</span>&nbsp;<span class="ident" id="3026237">f</span><span class="op" id="3026238">.</span><span class="ident" id="3026239">copyDist</span>&nbsp;<span class="op" id="3026248">=</span>&nbsp;<span class="ident" id="3026250">length</span><span class="op" id="3026256">,</span>&nbsp;<span class="ident" id="3026258">dist</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026265">if</span>&nbsp;<span class="ident" id="3026268">f</span><span class="op" id="3026269">.</span><span class="ident" id="3026270">copyHist</span><span class="op" id="3026278">(</span><span class="op" id="3026279">)</span>&nbsp;<span class="op" id="3026281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026286">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026298">}</span><br>
<span class="lineno"></span><span class="op" id="3026300">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="comment" id="3026303">//&nbsp;copyHist&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;f.hist&nbsp;(f.copyDist&nbsp;bytes&nbsp;ago)&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="3026384">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;f.hist&nbsp;buffer&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="3026433">func</span>&nbsp;<span class="op" id="3026438">(</span><span class="ident" id="3026439">f</span>&nbsp;<span class="op" id="3026441">*</span><span class="ident" id="3026442">decompressor</span><span class="op" id="3026454">)</span>&nbsp;<span class="ident" id="3026456">copyHist</span><span class="op" id="3026464">(</span><span class="op" id="3026465">)</span>&nbsp;<span class="builtintype" id="3026467">bool</span>&nbsp;<span class="op" id="3026472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026475">p</span>&nbsp;<span class="op" id="3026477">:=</span>&nbsp;<span class="ident" id="3026480">f</span><span class="op" id="3026481">.</span><span class="ident" id="3026482">hp</span>&nbsp;<span class="op" id="3026485">-</span>&nbsp;<span class="ident" id="3026487">f</span><span class="op" id="3026488">.</span><span class="ident" id="3026489">copyDist</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026499">if</span>&nbsp;<span class="ident" id="3026502">p</span>&nbsp;<span class="op" id="3026504">&lt;</span>&nbsp;<span class="num" id="3026506">0</span>&nbsp;<span class="op" id="3026508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026512">p</span>&nbsp;<span class="op" id="3026514">+=</span>&nbsp;<span class="builtinfunc" id="3026517">len</span><span class="op" id="3026520">(</span><span class="ident" id="3026521">f</span><span class="op" id="3026522">.</span><span class="ident" id="3026523">hist</span><span class="op" id="3026527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026533">for</span>&nbsp;<span class="ident" id="3026537">f</span><span class="op" id="3026538">.</span><span class="ident" id="3026539">copyLen</span>&nbsp;<span class="op" id="3026547">&gt;</span>&nbsp;<span class="num" id="3026549">0</span>&nbsp;<span class="op" id="3026551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026555">n</span>&nbsp;<span class="op" id="3026557">:=</span>&nbsp;<span class="ident" id="3026560">f</span><span class="op" id="3026561">.</span><span class="ident" id="3026562">copyLen</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026572">if</span>&nbsp;<span class="ident" id="3026575">x</span>&nbsp;<span class="op" id="3026577">:=</span>&nbsp;<span class="builtinfunc" id="3026580">len</span><span class="op" id="3026583">(</span><span class="ident" id="3026584">f</span><span class="op" id="3026585">.</span><span class="ident" id="3026586">hist</span><span class="op" id="3026590">)</span>&nbsp;<span class="op" id="3026592">-</span>&nbsp;<span class="ident" id="3026594">f</span><span class="op" id="3026595">.</span><span class="ident" id="3026596">hp</span><span class="op" id="3026598">;</span>&nbsp;<span class="ident" id="3026600">n</span>&nbsp;<span class="op" id="3026602">&gt;</span>&nbsp;<span class="ident" id="3026604">x</span>&nbsp;<span class="op" id="3026606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026611">n</span>&nbsp;<span class="op" id="3026613">=</span>&nbsp;<span class="ident" id="3026615">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026623">if</span>&nbsp;<span class="ident" id="3026626">x</span>&nbsp;<span class="op" id="3026628">:=</span>&nbsp;<span class="builtinfunc" id="3026631">len</span><span class="op" id="3026634">(</span><span class="ident" id="3026635">f</span><span class="op" id="3026636">.</span><span class="ident" id="3026637">hist</span><span class="op" id="3026641">)</span>&nbsp;<span class="op" id="3026643">-</span>&nbsp;<span class="ident" id="3026645">p</span><span class="op" id="3026646">;</span>&nbsp;<span class="ident" id="3026648">n</span>&nbsp;<span class="op" id="3026650">&gt;</span>&nbsp;<span class="ident" id="3026652">x</span>&nbsp;<span class="op" id="3026654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026659">n</span>&nbsp;<span class="op" id="3026661">=</span>&nbsp;<span class="ident" id="3026663">x</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026671">forwardCopy</span><span class="op" id="3026682">(</span><span class="ident" id="3026683">f</span><span class="op" id="3026684">.</span><span class="ident" id="3026685">hist</span><span class="op" id="3026689">[</span><span class="op" id="3026690">:</span><span class="op" id="3026691">]</span><span class="op" id="3026692">,</span>&nbsp;<span class="ident" id="3026694">f</span><span class="op" id="3026695">.</span><span class="ident" id="3026696">hp</span><span class="op" id="3026698">,</span>&nbsp;<span class="ident" id="3026700">p</span><span class="op" id="3026701">,</span>&nbsp;<span class="ident" id="3026703">n</span><span class="op" id="3026704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026708">p</span>&nbsp;<span class="op" id="3026710">+=</span>&nbsp;<span class="ident" id="3026713">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026717">f</span><span class="op" id="3026718">.</span><span class="ident" id="3026719">hp</span>&nbsp;<span class="op" id="3026722">+=</span>&nbsp;<span class="ident" id="3026725">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026729">f</span><span class="op" id="3026730">.</span><span class="ident" id="3026731">copyLen</span>&nbsp;<span class="op" id="3026739">-=</span>&nbsp;<span class="ident" id="3026742">n</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026746">if</span>&nbsp;<span class="ident" id="3026749">f</span><span class="op" id="3026750">.</span><span class="ident" id="3026751">hp</span>&nbsp;<span class="op" id="3026754">==</span>&nbsp;<span class="builtinfunc" id="3026757">len</span><span class="op" id="3026760">(</span><span class="ident" id="3026761">f</span><span class="op" id="3026762">.</span><span class="ident" id="3026763">hist</span><span class="op" id="3026767">)</span>&nbsp;<span class="op" id="3026769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026774">//&nbsp;After&nbsp;flush&nbsp;continue&nbsp;copying&nbsp;out&nbsp;of&nbsp;history.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026825">f</span><span class="op" id="3026826">.</span><span class="ident" id="3026827">flush</span><span class="op" id="3026832">(</span><span class="op" id="3026833">(</span><span class="op" id="3026834">*</span><span class="ident" id="3026835">decompressor</span><span class="op" id="3026847">)</span><span class="op" id="3026848">.</span><span class="ident" id="3026849">copyHuff</span><span class="op" id="3026857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026862">return</span>&nbsp;<span class="builtintype" id="3026869">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026876">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026880">if</span>&nbsp;<span class="ident" id="3026883">p</span>&nbsp;<span class="op" id="3026885">==</span>&nbsp;<span class="builtinfunc" id="3026888">len</span><span class="op" id="3026891">(</span><span class="ident" id="3026892">f</span><span class="op" id="3026893">.</span><span class="ident" id="3026894">hist</span><span class="op" id="3026898">)</span>&nbsp;<span class="op" id="3026900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026905">p</span>&nbsp;<span class="op" id="3026907">=</span>&nbsp;<span class="num" id="3026909">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026919">return</span>&nbsp;<span class="builtintype" id="3026926">false</span><br>
<span class="lineno">550</span><span class="op" id="3026932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3026935">func</span>&nbsp;<span class="op" id="3026940">(</span><span class="ident" id="3026941">f</span>&nbsp;<span class="op" id="3026943">*</span><span class="ident" id="3026944">decompressor</span><span class="op" id="3026956">)</span>&nbsp;<span class="ident" id="3026958">copyHuff</span><span class="op" id="3026966">(</span><span class="op" id="3026967">)</span>&nbsp;<span class="op" id="3026969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026972">if</span>&nbsp;<span class="ident" id="3026975">f</span><span class="op" id="3026976">.</span><span class="ident" id="3026977">copyHist</span><span class="op" id="3026985">(</span><span class="op" id="3026986">)</span>&nbsp;<span class="op" id="3026988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026992">return</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3027000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027003">f</span><span class="op" id="3027004">.</span><span class="ident" id="3027005">huffmanBlock</span><span class="op" id="3027017">(</span><span class="op" id="3027018">)</span><br>
<span class="lineno"></span><span class="op" id="3027020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3027023">//&nbsp;Copy&nbsp;a&nbsp;single&nbsp;uncompressed&nbsp;data&nbsp;block&nbsp;from&nbsp;input&nbsp;to&nbsp;output.</span><br>
<span class="lineno">560</span><span class="keyword" id="3027086">func</span>&nbsp;<span class="op" id="3027091">(</span><span class="ident" id="3027092">f</span>&nbsp;<span class="op" id="3027094">*</span><span class="ident" id="3027095">decompressor</span><span class="op" id="3027107">)</span>&nbsp;<span class="ident" id="3027109">dataBlock</span><span class="op" id="3027118">(</span><span class="op" id="3027119">)</span>&nbsp;<span class="op" id="3027121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3027124">//&nbsp;Uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3027142">//&nbsp;Discard&nbsp;current&nbsp;half-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027173">f</span><span class="op" id="3027174">.</span><span class="ident" id="3027175">nb</span>&nbsp;<span class="op" id="3027178">=</span>&nbsp;<span class="num" id="3027180">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027183">f</span><span class="op" id="3027184">.</span><span class="ident" id="3027185">b</span>&nbsp;<span class="op" id="3027187">=</span>&nbsp;<span class="num" id="3027189">0</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3027193">//&nbsp;Length&nbsp;then&nbsp;ones-complement&nbsp;of&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027236">nr</span><span class="op" id="3027238">,</span>&nbsp;<span class="ident" id="3027240">err</span>&nbsp;<span class="op" id="3027244">:=</span>&nbsp;<span class="ident" id="3027247">io</span><span class="op" id="3027249">.</span><span class="ident" id="3027250">ReadFull</span><span class="op" id="3027258">(</span><span class="ident" id="3027259">f</span><span class="op" id="3027260">.</span><span class="ident" id="3027261">r</span><span class="op" id="3027262">,</span>&nbsp;<span class="ident" id="3027264">f</span><span class="op" id="3027265">.</span><span class="ident" id="3027266">buf</span><span class="op" id="3027269">[</span><span class="num" id="3027270">0</span><span class="op" id="3027271">:</span><span class="num" id="3027272">4</span><span class="op" id="3027273">]</span><span class="op" id="3027274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027277">f</span><span class="op" id="3027278">.</span><span class="ident" id="3027279">roffset</span>&nbsp;<span class="op" id="3027287">+=</span>&nbsp;<span class="ident" id="3027290">int64</span><span class="op" id="3027295">(</span><span class="ident" id="3027296">nr</span><span class="op" id="3027298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027301">if</span>&nbsp;<span class="ident" id="3027304">err</span>&nbsp;<span class="op" id="3027308">!=</span>&nbsp;<span class="ident" id="3027311">nil</span>&nbsp;<span class="op" id="3027315">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027319">f</span><span class="op" id="3027320">.</span><span class="ident" id="3027321">err</span>&nbsp;<span class="op" id="3027325">=</span>&nbsp;<span class="op" id="3027327">&amp;</span><span class="ident" id="3027328">ReadError</span><span class="op" id="3027337">{</span><span class="ident" id="3027338">f</span><span class="op" id="3027339">.</span><span class="ident" id="3027340">roffset</span><span class="op" id="3027347">,</span>&nbsp;<span class="ident" id="3027349">err</span><span class="op" id="3027352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027356">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3027364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027367">n</span>&nbsp;<span class="op" id="3027369">:=</span>&nbsp;<span class="builtintype" id="3027372">int</span><span class="op" id="3027375">(</span><span class="ident" id="3027376">f</span><span class="op" id="3027377">.</span><span class="ident" id="3027378">buf</span><span class="op" id="3027381">[</span><span class="num" id="3027382">0</span><span class="op" id="3027383">]</span><span class="op" id="3027384">)</span>&nbsp;<span class="op" id="3027386">|</span>&nbsp;<span class="builtintype" id="3027388">int</span><span class="op" id="3027391">(</span><span class="ident" id="3027392">f</span><span class="op" id="3027393">.</span><span class="ident" id="3027394">buf</span><span class="op" id="3027397">[</span><span class="num" id="3027398">1</span><span class="op" id="3027399">]</span><span class="op" id="3027400">)</span><span class="op" id="3027401">&lt;&lt;</span><span class="num" id="3027403">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027406">nn</span>&nbsp;<span class="op" id="3027409">:=</span>&nbsp;<span class="builtintype" id="3027412">int</span><span class="op" id="3027415">(</span><span class="ident" id="3027416">f</span><span class="op" id="3027417">.</span><span class="ident" id="3027418">buf</span><span class="op" id="3027421">[</span><span class="num" id="3027422">2</span><span class="op" id="3027423">]</span><span class="op" id="3027424">)</span>&nbsp;<span class="op" id="3027426">|</span>&nbsp;<span class="builtintype" id="3027428">int</span><span class="op" id="3027431">(</span><span class="ident" id="3027432">f</span><span class="op" id="3027433">.</span><span class="ident" id="3027434">buf</span><span class="op" id="3027437">[</span><span class="num" id="3027438">3</span><span class="op" id="3027439">]</span><span class="op" id="3027440">)</span><span class="op" id="3027441">&lt;&lt;</span><span class="num" id="3027443">8</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027446">if</span>&nbsp;<span class="builtintype" id="3027449">uint16</span><span class="op" id="3027455">(</span><span class="ident" id="3027456">nn</span><span class="op" id="3027458">)</span>&nbsp;<span class="op" id="3027460">!=</span>&nbsp;<span class="builtintype" id="3027463">uint16</span><span class="op" id="3027469">(</span><span class="op" id="3027470">^</span><span class="ident" id="3027471">n</span><span class="op" id="3027472">)</span>&nbsp;<span class="op" id="3027474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027478">f</span><span class="op" id="3027479">.</span><span class="ident" id="3027480">err</span>&nbsp;<span class="op" id="3027484">=</span>&nbsp;<span class="ident" id="3027486">CorruptInputError</span><span class="op" id="3027503">(</span><span class="ident" id="3027504">f</span><span class="op" id="3027505">.</span><span class="ident" id="3027506">roffset</span><span class="op" id="3027513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027517">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3027525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027529">if</span>&nbsp;<span class="ident" id="3027532">n</span>&nbsp;<span class="op" id="3027534">==</span>&nbsp;<span class="num" id="3027537">0</span>&nbsp;<span class="op" id="3027539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3027543">//&nbsp;0-length&nbsp;block&nbsp;means&nbsp;sync</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027574">f</span><span class="op" id="3027575">.</span><span class="ident" id="3027576">flush</span><span class="op" id="3027581">(</span><span class="op" id="3027582">(</span><span class="op" id="3027583">*</span><span class="ident" id="3027584">decompressor</span><span class="op" id="3027596">)</span><span class="op" id="3027597">.</span><span class="ident" id="3027598">nextBlock</span><span class="op" id="3027607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027611">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3027619">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027623">f</span><span class="op" id="3027624">.</span><span class="ident" id="3027625">copyLen</span>&nbsp;<span class="op" id="3027633">=</span>&nbsp;<span class="ident" id="3027635">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027638">f</span><span class="op" id="3027639">.</span><span class="ident" id="3027640">copyData</span><span class="op" id="3027648">(</span><span class="op" id="3027649">)</span><br>
<span class="lineno"></span><span class="op" id="3027651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3027654">//&nbsp;copyData&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;into&nbsp;f.hist.</span><br>
<span class="lineno"></span><span class="comment" id="3027729">//&nbsp;It&nbsp;pauses&nbsp;for&nbsp;reads&nbsp;when&nbsp;f.hist&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="3027773">func</span>&nbsp;<span class="op" id="3027778">(</span><span class="ident" id="3027779">f</span>&nbsp;<span class="op" id="3027781">*</span><span class="ident" id="3027782">decompressor</span><span class="op" id="3027794">)</span>&nbsp;<span class="ident" id="3027796">copyData</span><span class="op" id="3027804">(</span><span class="op" id="3027805">)</span>&nbsp;<span class="op" id="3027807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027810">n</span>&nbsp;<span class="op" id="3027812">:=</span>&nbsp;<span class="ident" id="3027815">f</span><span class="op" id="3027816">.</span><span class="ident" id="3027817">copyLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027826">for</span>&nbsp;<span class="ident" id="3027830">n</span>&nbsp;<span class="op" id="3027832">&gt;</span>&nbsp;<span class="num" id="3027834">0</span>&nbsp;<span class="op" id="3027836">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027840">m</span>&nbsp;<span class="op" id="3027842">:=</span>&nbsp;<span class="builtinfunc" id="3027845">len</span><span class="op" id="3027848">(</span><span class="ident" id="3027849">f</span><span class="op" id="3027850">.</span><span class="ident" id="3027851">hist</span><span class="op" id="3027855">)</span>&nbsp;<span class="op" id="3027857">-</span>&nbsp;<span class="ident" id="3027859">f</span><span class="op" id="3027860">.</span><span class="ident" id="3027861">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027866">if</span>&nbsp;<span class="ident" id="3027869">m</span>&nbsp;<span class="op" id="3027871">&gt;</span>&nbsp;<span class="ident" id="3027873">n</span>&nbsp;<span class="op" id="3027875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027880">m</span>&nbsp;<span class="op" id="3027882">=</span>&nbsp;<span class="ident" id="3027884">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3027888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027892">m</span><span class="op" id="3027893">,</span>&nbsp;<span class="ident" id="3027895">err</span>&nbsp;<span class="op" id="3027899">:=</span>&nbsp;<span class="ident" id="3027902">io</span><span class="op" id="3027904">.</span><span class="ident" id="3027905">ReadFull</span><span class="op" id="3027913">(</span><span class="ident" id="3027914">f</span><span class="op" id="3027915">.</span><span class="ident" id="3027916">r</span><span class="op" id="3027917">,</span>&nbsp;<span class="ident" id="3027919">f</span><span class="op" id="3027920">.</span><span class="ident" id="3027921">hist</span><span class="op" id="3027925">[</span><span class="ident" id="3027926">f</span><span class="op" id="3027927">.</span><span class="ident" id="3027928">hp</span><span class="op" id="3027930">:</span><span class="ident" id="3027931">f</span><span class="op" id="3027932">.</span><span class="ident" id="3027933">hp</span><span class="op" id="3027935">+</span><span class="ident" id="3027936">m</span><span class="op" id="3027937">]</span><span class="op" id="3027938">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027942">f</span><span class="op" id="3027943">.</span><span class="ident" id="3027944">roffset</span>&nbsp;<span class="op" id="3027952">+=</span>&nbsp;<span class="ident" id="3027955">int64</span><span class="op" id="3027960">(</span><span class="ident" id="3027961">m</span><span class="op" id="3027962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027966">if</span>&nbsp;<span class="ident" id="3027969">err</span>&nbsp;<span class="op" id="3027973">!=</span>&nbsp;<span class="ident" id="3027976">nil</span>&nbsp;<span class="op" id="3027980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027985">f</span><span class="op" id="3027986">.</span><span class="ident" id="3027987">err</span>&nbsp;<span class="op" id="3027991">=</span>&nbsp;<span class="op" id="3027993">&amp;</span><span class="ident" id="3027994">ReadError</span><span class="op" id="3028003">{</span><span class="ident" id="3028004">f</span><span class="op" id="3028005">.</span><span class="ident" id="3028006">roffset</span><span class="op" id="3028013">,</span>&nbsp;<span class="ident" id="3028015">err</span><span class="op" id="3028018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028023">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028032">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028036">n</span>&nbsp;<span class="op" id="3028038">-=</span>&nbsp;<span class="ident" id="3028041">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028045">f</span><span class="op" id="3028046">.</span><span class="ident" id="3028047">hp</span>&nbsp;<span class="op" id="3028050">+=</span>&nbsp;<span class="ident" id="3028053">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028057">if</span>&nbsp;<span class="ident" id="3028060">f</span><span class="op" id="3028061">.</span><span class="ident" id="3028062">hp</span>&nbsp;<span class="op" id="3028065">==</span>&nbsp;<span class="builtinfunc" id="3028068">len</span><span class="op" id="3028071">(</span><span class="ident" id="3028072">f</span><span class="op" id="3028073">.</span><span class="ident" id="3028074">hist</span><span class="op" id="3028078">)</span>&nbsp;<span class="op" id="3028080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028085">f</span><span class="op" id="3028086">.</span><span class="ident" id="3028087">copyLen</span>&nbsp;<span class="op" id="3028095">=</span>&nbsp;<span class="ident" id="3028097">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028102">f</span><span class="op" id="3028103">.</span><span class="ident" id="3028104">flush</span><span class="op" id="3028109">(</span><span class="op" id="3028110">(</span><span class="op" id="3028111">*</span><span class="ident" id="3028112">decompressor</span><span class="op" id="3028124">)</span><span class="op" id="3028125">.</span><span class="ident" id="3028126">copyData</span><span class="op" id="3028134">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028139">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028154">f</span><span class="op" id="3028155">.</span><span class="ident" id="3028156">step</span>&nbsp;<span class="op" id="3028161">=</span>&nbsp;<span class="op" id="3028163">(</span><span class="op" id="3028164">*</span><span class="ident" id="3028165">decompressor</span><span class="op" id="3028177">)</span><span class="op" id="3028178">.</span><span class="ident" id="3028179">nextBlock</span><br>
<span class="lineno"></span><span class="op" id="3028189">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="3028192">func</span>&nbsp;<span class="op" id="3028197">(</span><span class="ident" id="3028198">f</span>&nbsp;<span class="op" id="3028200">*</span><span class="ident" id="3028201">decompressor</span><span class="op" id="3028213">)</span>&nbsp;<span class="ident" id="3028215">setDict</span><span class="op" id="3028222">(</span><span class="ident" id="3028223">dict</span>&nbsp;<span class="op" id="3028228">[</span><span class="op" id="3028229">]</span><span class="builtintype" id="3028230">byte</span><span class="op" id="3028234">)</span>&nbsp;<span class="op" id="3028236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028239">if</span>&nbsp;<span class="builtinfunc" id="3028242">len</span><span class="op" id="3028245">(</span><span class="ident" id="3028246">dict</span><span class="op" id="3028250">)</span>&nbsp;<span class="op" id="3028252">&gt;</span>&nbsp;<span class="builtinfunc" id="3028254">len</span><span class="op" id="3028257">(</span><span class="ident" id="3028258">f</span><span class="op" id="3028259">.</span><span class="ident" id="3028260">hist</span><span class="op" id="3028264">)</span>&nbsp;<span class="op" id="3028266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3028270">//&nbsp;Will&nbsp;only&nbsp;remember&nbsp;the&nbsp;tail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028304">dict</span>&nbsp;<span class="op" id="3028309">=</span>&nbsp;<span class="ident" id="3028311">dict</span><span class="op" id="3028315">[</span><span class="builtinfunc" id="3028316">len</span><span class="op" id="3028319">(</span><span class="ident" id="3028320">dict</span><span class="op" id="3028324">)</span><span class="op" id="3028325">-</span><span class="builtinfunc" id="3028326">len</span><span class="op" id="3028329">(</span><span class="ident" id="3028330">f</span><span class="op" id="3028331">.</span><span class="ident" id="3028332">hist</span><span class="op" id="3028336">)</span><span class="op" id="3028337">:</span><span class="op" id="3028338">]</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028345">f</span><span class="op" id="3028346">.</span><span class="ident" id="3028347">hp</span>&nbsp;<span class="op" id="3028350">=</span>&nbsp;<span class="builtinfunc" id="3028352">copy</span><span class="op" id="3028356">(</span><span class="ident" id="3028357">f</span><span class="op" id="3028358">.</span><span class="ident" id="3028359">hist</span><span class="op" id="3028363">[</span><span class="op" id="3028364">:</span><span class="op" id="3028365">]</span><span class="op" id="3028366">,</span>&nbsp;<span class="ident" id="3028368">dict</span><span class="op" id="3028372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028375">if</span>&nbsp;<span class="ident" id="3028378">f</span><span class="op" id="3028379">.</span><span class="ident" id="3028380">hp</span>&nbsp;<span class="op" id="3028383">==</span>&nbsp;<span class="builtinfunc" id="3028386">len</span><span class="op" id="3028389">(</span><span class="ident" id="3028390">f</span><span class="op" id="3028391">.</span><span class="ident" id="3028392">hist</span><span class="op" id="3028396">)</span>&nbsp;<span class="op" id="3028398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028402">f</span><span class="op" id="3028403">.</span><span class="ident" id="3028404">hp</span>&nbsp;<span class="op" id="3028407">=</span>&nbsp;<span class="num" id="3028409">0</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028413">f</span><span class="op" id="3028414">.</span><span class="ident" id="3028415">hfull</span>&nbsp;<span class="op" id="3028421">=</span>&nbsp;<span class="builtintype" id="3028423">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028432">f</span><span class="op" id="3028433">.</span><span class="ident" id="3028434">hw</span>&nbsp;<span class="op" id="3028437">=</span>&nbsp;<span class="ident" id="3028439">f</span><span class="op" id="3028440">.</span><span class="ident" id="3028441">hp</span><br>
<span class="lineno"></span><span class="op" id="3028444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="3028447">func</span>&nbsp;<span class="op" id="3028452">(</span><span class="ident" id="3028453">f</span>&nbsp;<span class="op" id="3028455">*</span><span class="ident" id="3028456">decompressor</span><span class="op" id="3028468">)</span>&nbsp;<span class="ident" id="3028470">moreBits</span><span class="op" id="3028478">(</span><span class="op" id="3028479">)</span>&nbsp;<span class="builtintype" id="3028481">error</span>&nbsp;<span class="op" id="3028487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028490">c</span><span class="op" id="3028491">,</span>&nbsp;<span class="ident" id="3028493">err</span>&nbsp;<span class="op" id="3028497">:=</span>&nbsp;<span class="ident" id="3028500">f</span><span class="op" id="3028501">.</span><span class="ident" id="3028502">r</span><span class="op" id="3028503">.</span><span class="ident" id="3028504">ReadByte</span><span class="op" id="3028512">(</span><span class="op" id="3028513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028516">if</span>&nbsp;<span class="ident" id="3028519">err</span>&nbsp;<span class="op" id="3028523">!=</span>&nbsp;<span class="ident" id="3028526">nil</span>&nbsp;<span class="op" id="3028530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028534">if</span>&nbsp;<span class="ident" id="3028537">err</span>&nbsp;<span class="op" id="3028541">==</span>&nbsp;<span class="ident" id="3028544">io</span><span class="op" id="3028546">.</span><span class="ident" id="3028547">EOF</span>&nbsp;<span class="op" id="3028551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028556">err</span>&nbsp;<span class="op" id="3028560">=</span>&nbsp;<span class="ident" id="3028562">io</span><span class="op" id="3028564">.</span><span class="ident" id="3028565">ErrUnexpectedEOF</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028588">return</span>&nbsp;<span class="ident" id="3028595">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028603">f</span><span class="op" id="3028604">.</span><span class="ident" id="3028605">roffset</span><span class="op" id="3028612">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028616">f</span><span class="op" id="3028617">.</span><span class="ident" id="3028618">b</span>&nbsp;<span class="op" id="3028620">|=</span>&nbsp;<span class="builtintype" id="3028623">uint32</span><span class="op" id="3028629">(</span><span class="ident" id="3028630">c</span><span class="op" id="3028631">)</span>&nbsp;<span class="op" id="3028633">&lt;&lt;</span>&nbsp;<span class="ident" id="3028636">f</span><span class="op" id="3028637">.</span><span class="ident" id="3028638">nb</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028642">f</span><span class="op" id="3028643">.</span><span class="ident" id="3028644">nb</span>&nbsp;<span class="op" id="3028647">+=</span>&nbsp;<span class="num" id="3028650">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028653">return</span>&nbsp;<span class="ident" id="3028660">nil</span><br>
<span class="lineno"></span><span class="op" id="3028664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3028667">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Huffman-encoded&nbsp;symbol&nbsp;from&nbsp;f&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno">645</span><span class="keyword" id="3028730">func</span>&nbsp;<span class="op" id="3028735">(</span><span class="ident" id="3028736">f</span>&nbsp;<span class="op" id="3028738">*</span><span class="ident" id="3028739">decompressor</span><span class="op" id="3028751">)</span>&nbsp;<span class="ident" id="3028753">huffSym</span><span class="op" id="3028760">(</span><span class="ident" id="3028761">h</span>&nbsp;<span class="op" id="3028763">*</span><span class="ident" id="3028764">huffmanDecoder</span><span class="op" id="3028778">)</span>&nbsp;<span class="op" id="3028780">(</span><span class="builtintype" id="3028781">int</span><span class="op" id="3028784">,</span>&nbsp;<span class="builtintype" id="3028786">error</span><span class="op" id="3028791">)</span>&nbsp;<span class="op" id="3028793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028796">n</span>&nbsp;<span class="op" id="3028798">:=</span>&nbsp;<span class="builtintype" id="3028801">uint</span><span class="op" id="3028805">(</span><span class="ident" id="3028806">h</span><span class="op" id="3028807">.</span><span class="ident" id="3028808">min</span><span class="op" id="3028811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028814">for</span>&nbsp;<span class="op" id="3028818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028822">for</span>&nbsp;<span class="ident" id="3028826">f</span><span class="op" id="3028827">.</span><span class="ident" id="3028828">nb</span>&nbsp;<span class="op" id="3028831">&lt;</span>&nbsp;<span class="ident" id="3028833">n</span>&nbsp;<span class="op" id="3028835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028840">if</span>&nbsp;<span class="ident" id="3028843">err</span>&nbsp;<span class="op" id="3028847">:=</span>&nbsp;<span class="ident" id="3028850">f</span><span class="op" id="3028851">.</span><span class="ident" id="3028852">moreBits</span><span class="op" id="3028860">(</span><span class="op" id="3028861">)</span><span class="op" id="3028862">;</span>&nbsp;<span class="ident" id="3028864">err</span>&nbsp;<span class="op" id="3028868">!=</span>&nbsp;<span class="ident" id="3028871">nil</span>&nbsp;<span class="op" id="3028875">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028881">return</span>&nbsp;<span class="num" id="3028888">0</span><span class="op" id="3028889">,</span>&nbsp;<span class="ident" id="3028891">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028906">chunk</span>&nbsp;<span class="op" id="3028912">:=</span>&nbsp;<span class="ident" id="3028915">h</span><span class="op" id="3028916">.</span><span class="ident" id="3028917">chunks</span><span class="op" id="3028923">[</span><span class="ident" id="3028924">f</span><span class="op" id="3028925">.</span><span class="ident" id="3028926">b</span><span class="op" id="3028927">&amp;</span><span class="op" id="3028928">(</span><span class="ident" id="3028929">huffmanNumChunks</span><span class="op" id="3028945">-</span><span class="num" id="3028946">1</span><span class="op" id="3028947">)</span><span class="op" id="3028948">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028952">n</span>&nbsp;<span class="op" id="3028954">=</span>&nbsp;<span class="builtintype" id="3028956">uint</span><span class="op" id="3028960">(</span><span class="ident" id="3028961">chunk</span>&nbsp;<span class="op" id="3028967">&amp;</span>&nbsp;<span class="ident" id="3028969">huffmanCountMask</span><span class="op" id="3028985">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028989">if</span>&nbsp;<span class="ident" id="3028992">n</span>&nbsp;<span class="op" id="3028994">&gt;</span>&nbsp;<span class="ident" id="3028996">huffmanChunkBits</span>&nbsp;<span class="op" id="3029013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029018">chunk</span>&nbsp;<span class="op" id="3029024">=</span>&nbsp;<span class="ident" id="3029026">h</span><span class="op" id="3029027">.</span><span class="ident" id="3029028">links</span><span class="op" id="3029033">[</span><span class="ident" id="3029034">chunk</span><span class="op" id="3029039">&gt;&gt;</span><span class="ident" id="3029041">huffmanValueShift</span><span class="op" id="3029058">]</span><span class="op" id="3029059">[</span><span class="op" id="3029060">(</span><span class="ident" id="3029061">f</span><span class="op" id="3029062">.</span><span class="ident" id="3029063">b</span><span class="op" id="3029064">&gt;&gt;</span><span class="ident" id="3029066">huffmanChunkBits</span><span class="op" id="3029082">)</span><span class="op" id="3029083">&amp;</span><span class="ident" id="3029084">h</span><span class="op" id="3029085">.</span><span class="ident" id="3029086">linkMask</span><span class="op" id="3029094">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029099">n</span>&nbsp;<span class="op" id="3029101">=</span>&nbsp;<span class="builtintype" id="3029103">uint</span><span class="op" id="3029107">(</span><span class="ident" id="3029108">chunk</span>&nbsp;<span class="op" id="3029114">&amp;</span>&nbsp;<span class="ident" id="3029116">huffmanCountMask</span><span class="op" id="3029132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029137">if</span>&nbsp;<span class="ident" id="3029140">n</span>&nbsp;<span class="op" id="3029142">==</span>&nbsp;<span class="num" id="3029145">0</span>&nbsp;<span class="op" id="3029147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029153">f</span><span class="op" id="3029154">.</span><span class="ident" id="3029155">err</span>&nbsp;<span class="op" id="3029159">=</span>&nbsp;<span class="ident" id="3029161">CorruptInputError</span><span class="op" id="3029178">(</span><span class="ident" id="3029179">f</span><span class="op" id="3029180">.</span><span class="ident" id="3029181">roffset</span><span class="op" id="3029188">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029194">return</span>&nbsp;<span class="num" id="3029201">0</span><span class="op" id="3029202">,</span>&nbsp;<span class="ident" id="3029204">f</span><span class="op" id="3029205">.</span><span class="ident" id="3029206">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3029213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3029217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029221">if</span>&nbsp;<span class="ident" id="3029224">n</span>&nbsp;<span class="op" id="3029226">&lt;=</span>&nbsp;<span class="ident" id="3029229">f</span><span class="op" id="3029230">.</span><span class="ident" id="3029231">nb</span>&nbsp;<span class="op" id="3029234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029239">f</span><span class="op" id="3029240">.</span><span class="ident" id="3029241">b</span>&nbsp;<span class="op" id="3029243">&gt;&gt;=</span>&nbsp;<span class="ident" id="3029247">n</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029252">f</span><span class="op" id="3029253">.</span><span class="ident" id="3029254">nb</span>&nbsp;<span class="op" id="3029257">-=</span>&nbsp;<span class="ident" id="3029260">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029265">return</span>&nbsp;<span class="builtintype" id="3029272">int</span><span class="op" id="3029275">(</span><span class="ident" id="3029276">chunk</span>&nbsp;<span class="op" id="3029282">&gt;&gt;</span>&nbsp;<span class="ident" id="3029285">huffmanValueShift</span><span class="op" id="3029302">)</span><span class="op" id="3029303">,</span>&nbsp;<span class="ident" id="3029305">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3029311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3029314">}</span><br>
<span class="lineno"></span><span class="op" id="3029316">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="3029319">//&nbsp;Flush&nbsp;any&nbsp;buffered&nbsp;output&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3029374">func</span>&nbsp;<span class="op" id="3029379">(</span><span class="ident" id="3029380">f</span>&nbsp;<span class="op" id="3029382">*</span><span class="ident" id="3029383">decompressor</span><span class="op" id="3029395">)</span>&nbsp;<span class="ident" id="3029397">flush</span><span class="op" id="3029402">(</span><span class="ident" id="3029403">step</span>&nbsp;<span class="keyword" id="3029408">func</span><span class="op" id="3029412">(</span><span class="op" id="3029413">*</span><span class="ident" id="3029414">decompressor</span><span class="op" id="3029426">)</span><span class="op" id="3029427">)</span>&nbsp;<span class="op" id="3029429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029432">f</span><span class="op" id="3029433">.</span><span class="ident" id="3029434">toRead</span>&nbsp;<span class="op" id="3029441">=</span>&nbsp;<span class="ident" id="3029443">f</span><span class="op" id="3029444">.</span><span class="ident" id="3029445">hist</span><span class="op" id="3029449">[</span><span class="ident" id="3029450">f</span><span class="op" id="3029451">.</span><span class="ident" id="3029452">hw</span><span class="op" id="3029454">:</span><span class="ident" id="3029455">f</span><span class="op" id="3029456">.</span><span class="ident" id="3029457">hp</span><span class="op" id="3029459">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029462">f</span><span class="op" id="3029463">.</span><span class="ident" id="3029464">woffset</span>&nbsp;<span class="op" id="3029472">+=</span>&nbsp;<span class="ident" id="3029475">int64</span><span class="op" id="3029480">(</span><span class="ident" id="3029481">f</span><span class="op" id="3029482">.</span><span class="ident" id="3029483">hp</span>&nbsp;<span class="op" id="3029486">-</span>&nbsp;<span class="ident" id="3029488">f</span><span class="op" id="3029489">.</span><span class="ident" id="3029490">hw</span><span class="op" id="3029492">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029495">f</span><span class="op" id="3029496">.</span><span class="ident" id="3029497">hw</span>&nbsp;<span class="op" id="3029500">=</span>&nbsp;<span class="ident" id="3029502">f</span><span class="op" id="3029503">.</span><span class="ident" id="3029504">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029508">if</span>&nbsp;<span class="ident" id="3029511">f</span><span class="op" id="3029512">.</span><span class="ident" id="3029513">hp</span>&nbsp;<span class="op" id="3029516">==</span>&nbsp;<span class="builtinfunc" id="3029519">len</span><span class="op" id="3029522">(</span><span class="ident" id="3029523">f</span><span class="op" id="3029524">.</span><span class="ident" id="3029525">hist</span><span class="op" id="3029529">)</span>&nbsp;<span class="op" id="3029531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029535">f</span><span class="op" id="3029536">.</span><span class="ident" id="3029537">hp</span>&nbsp;<span class="op" id="3029540">=</span>&nbsp;<span class="num" id="3029542">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029546">f</span><span class="op" id="3029547">.</span><span class="ident" id="3029548">hw</span>&nbsp;<span class="op" id="3029551">=</span>&nbsp;<span class="num" id="3029553">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029557">f</span><span class="op" id="3029558">.</span><span class="ident" id="3029559">hfull</span>&nbsp;<span class="op" id="3029565">=</span>&nbsp;<span class="builtintype" id="3029567">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3029573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029576">f</span><span class="op" id="3029577">.</span><span class="ident" id="3029578">step</span>&nbsp;<span class="op" id="3029583">=</span>&nbsp;<span class="ident" id="3029585">step</span><br>
<span class="lineno"></span><span class="op" id="3029590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3029593">func</span>&nbsp;<span class="ident" id="3029598">makeReader</span><span class="op" id="3029608">(</span><span class="ident" id="3029609">r</span>&nbsp;<span class="ident" id="3029611">io</span><span class="op" id="3029613">.</span><span class="ident" id="3029614">Reader</span><span class="op" id="3029620">)</span>&nbsp;<span class="ident" id="3029622">Reader</span>&nbsp;<span class="op" id="3029629">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029632">if</span>&nbsp;<span class="ident" id="3029635">rr</span><span class="op" id="3029637">,</span>&nbsp;<span class="ident" id="3029639">ok</span>&nbsp;<span class="op" id="3029642">:=</span>&nbsp;<span class="ident" id="3029645">r</span><span class="op" id="3029646">.</span><span class="op" id="3029647">(</span><span class="ident" id="3029648">Reader</span><span class="op" id="3029654">)</span><span class="op" id="3029655">;</span>&nbsp;<span class="ident" id="3029657">ok</span>&nbsp;<span class="op" id="3029660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029664">return</span>&nbsp;<span class="ident" id="3029671">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3029675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029678">return</span>&nbsp;<span class="ident" id="3029685">bufio</span><span class="op" id="3029690">.</span><span class="ident" id="3029691">NewReader</span><span class="op" id="3029700">(</span><span class="ident" id="3029701">r</span><span class="op" id="3029702">)</span><br>
<span class="lineno"></span><span class="op" id="3029704">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="3029707">func</span>&nbsp;<span class="op" id="3029712">(</span><span class="ident" id="3029713">f</span>&nbsp;<span class="op" id="3029715">*</span><span class="ident" id="3029716">decompressor</span><span class="op" id="3029728">)</span>&nbsp;<span class="ident" id="3029730">Reset</span><span class="op" id="3029735">(</span><span class="ident" id="3029736">r</span>&nbsp;<span class="ident" id="3029738">io</span><span class="op" id="3029740">.</span><span class="ident" id="3029741">Reader</span><span class="op" id="3029747">,</span>&nbsp;<span class="ident" id="3029749">dict</span>&nbsp;<span class="op" id="3029754">[</span><span class="op" id="3029755">]</span><span class="builtintype" id="3029756">byte</span><span class="op" id="3029760">)</span>&nbsp;<span class="builtintype" id="3029762">error</span>&nbsp;<span class="op" id="3029768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3029771">*</span><span class="ident" id="3029772">f</span>&nbsp;<span class="op" id="3029774">=</span>&nbsp;<span class="ident" id="3029776">decompressor</span><span class="op" id="3029788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029792">r</span><span class="op" id="3029793">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029802">makeReader</span><span class="op" id="3029812">(</span><span class="ident" id="3029813">r</span><span class="op" id="3029814">)</span><span class="op" id="3029815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029819">bits</span><span class="op" id="3029823">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029829">f</span><span class="op" id="3029830">.</span><span class="ident" id="3029831">bits</span><span class="op" id="3029835">,</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029839">codebits</span><span class="op" id="3029847">:</span>&nbsp;<span class="ident" id="3029849">f</span><span class="op" id="3029850">.</span><span class="ident" id="3029851">codebits</span><span class="op" id="3029859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029863">hist</span><span class="op" id="3029867">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029873">f</span><span class="op" id="3029874">.</span><span class="ident" id="3029875">hist</span><span class="op" id="3029879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029883">step</span><span class="op" id="3029887">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3029893">(</span><span class="op" id="3029894">*</span><span class="ident" id="3029895">decompressor</span><span class="op" id="3029907">)</span><span class="op" id="3029908">.</span><span class="ident" id="3029909">nextBlock</span><span class="op" id="3029918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3029921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029924">if</span>&nbsp;<span class="ident" id="3029927">dict</span>&nbsp;<span class="op" id="3029932">!=</span>&nbsp;<span class="ident" id="3029935">nil</span>&nbsp;<span class="op" id="3029939">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029943">f</span><span class="op" id="3029944">.</span><span class="ident" id="3029945">setDict</span><span class="op" id="3029952">(</span><span class="ident" id="3029953">dict</span><span class="op" id="3029957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3029960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029963">return</span>&nbsp;<span class="ident" id="3029970">nil</span><br>
<span class="lineno"></span><span class="op" id="3029974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="3029977">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;ReadCloser&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3030032">//&nbsp;to&nbsp;read&nbsp;the&nbsp;uncompressed&nbsp;version&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3030074">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="3030121">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3030183">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser</span><br>
<span class="lineno">710</span><span class="comment" id="3030252">//&nbsp;when&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="3030278">//</span><br>
<span class="lineno"></span><span class="comment" id="3030281">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno"></span><span class="keyword" id="3030347">func</span>&nbsp;<span class="ident" id="3030352">NewReader</span><span class="op" id="3030361">(</span><span class="ident" id="3030362">r</span>&nbsp;<span class="ident" id="3030364">io</span><span class="op" id="3030366">.</span><span class="ident" id="3030367">Reader</span><span class="op" id="3030373">)</span>&nbsp;<span class="ident" id="3030375">io</span><span class="op" id="3030377">.</span><span class="ident" id="3030378">ReadCloser</span>&nbsp;<span class="op" id="3030389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030392">var</span>&nbsp;<span class="ident" id="3030396">f</span>&nbsp;<span class="ident" id="3030398">decompressor</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030412">f</span><span class="op" id="3030413">.</span><span class="ident" id="3030414">bits</span>&nbsp;<span class="op" id="3030419">=</span>&nbsp;<span class="builtinfunc" id="3030421">new</span><span class="op" id="3030424">(</span><span class="op" id="3030425">[</span><span class="ident" id="3030426">maxLit</span>&nbsp;<span class="op" id="3030433">+</span>&nbsp;<span class="ident" id="3030435">maxDist</span><span class="op" id="3030442">]</span><span class="builtintype" id="3030443">int</span><span class="op" id="3030446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030449">f</span><span class="op" id="3030450">.</span><span class="ident" id="3030451">codebits</span>&nbsp;<span class="op" id="3030460">=</span>&nbsp;<span class="builtinfunc" id="3030462">new</span><span class="op" id="3030465">(</span><span class="op" id="3030466">[</span><span class="ident" id="3030467">numCodes</span><span class="op" id="3030475">]</span><span class="builtintype" id="3030476">int</span><span class="op" id="3030479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030482">f</span><span class="op" id="3030483">.</span><span class="ident" id="3030484">r</span>&nbsp;<span class="op" id="3030486">=</span>&nbsp;<span class="ident" id="3030488">makeReader</span><span class="op" id="3030498">(</span><span class="ident" id="3030499">r</span><span class="op" id="3030500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030503">f</span><span class="op" id="3030504">.</span><span class="ident" id="3030505">hist</span>&nbsp;<span class="op" id="3030510">=</span>&nbsp;<span class="builtinfunc" id="3030512">new</span><span class="op" id="3030515">(</span><span class="op" id="3030516">[</span><span class="ident" id="3030517">maxHist</span><span class="op" id="3030524">]</span><span class="builtintype" id="3030525">byte</span><span class="op" id="3030529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030532">f</span><span class="op" id="3030533">.</span><span class="ident" id="3030534">step</span>&nbsp;<span class="op" id="3030539">=</span>&nbsp;<span class="op" id="3030541">(</span><span class="op" id="3030542">*</span><span class="ident" id="3030543">decompressor</span><span class="op" id="3030555">)</span><span class="op" id="3030556">.</span><span class="ident" id="3030557">nextBlock</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030568">return</span>&nbsp;<span class="op" id="3030575">&amp;</span><span class="ident" id="3030576">f</span><br>
<span class="lineno"></span><span class="op" id="3030578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3030581">//&nbsp;NewReaderDict&nbsp;is&nbsp;like&nbsp;NewReader&nbsp;but&nbsp;initializes&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="3030643">//&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;behaves&nbsp;as&nbsp;if</span><br>
<span class="lineno">725</span><span class="comment" id="3030707">//&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;stream&nbsp;started&nbsp;with&nbsp;the&nbsp;given&nbsp;dictionary,</span><br>
<span class="lineno"></span><span class="comment" id="3030774">//&nbsp;which&nbsp;has&nbsp;already&nbsp;been&nbsp;read.&nbsp;&nbsp;NewReaderDict&nbsp;is&nbsp;typically&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3030839">//&nbsp;to&nbsp;read&nbsp;data&nbsp;compressed&nbsp;by&nbsp;NewWriterDict.</span><br>
<span class="lineno"></span><span class="comment" id="3030884">//</span><br>
<span class="lineno"></span><span class="comment" id="3030887">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno">730</span><span class="keyword" id="3030953">func</span>&nbsp;<span class="ident" id="3030958">NewReaderDict</span><span class="op" id="3030971">(</span><span class="ident" id="3030972">r</span>&nbsp;<span class="ident" id="3030974">io</span><span class="op" id="3030976">.</span><span class="ident" id="3030977">Reader</span><span class="op" id="3030983">,</span>&nbsp;<span class="ident" id="3030985">dict</span>&nbsp;<span class="op" id="3030990">[</span><span class="op" id="3030991">]</span><span class="builtintype" id="3030992">byte</span><span class="op" id="3030996">)</span>&nbsp;<span class="ident" id="3030998">io</span><span class="op" id="3031000">.</span><span class="ident" id="3031001">ReadCloser</span>&nbsp;<span class="op" id="3031012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031015">var</span>&nbsp;<span class="ident" id="3031019">f</span>&nbsp;<span class="ident" id="3031021">decompressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3031035">f</span><span class="op" id="3031036">.</span><span class="ident" id="3031037">r</span>&nbsp;<span class="op" id="3031039">=</span>&nbsp;<span class="ident" id="3031041">makeReader</span><span class="op" id="3031051">(</span><span class="ident" id="3031052">r</span><span class="op" id="3031053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3031056">f</span><span class="op" id="3031057">.</span><span class="ident" id="3031058">hist</span>&nbsp;<span class="op" id="3031063">=</span>&nbsp;<span class="builtinfunc" id="3031065">new</span><span class="op" id="3031068">(</span><span class="op" id="3031069">[</span><span class="ident" id="3031070">maxHist</span><span class="op" id="3031077">]</span><span class="builtintype" id="3031078">byte</span><span class="op" id="3031082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3031085">f</span><span class="op" id="3031086">.</span><span class="ident" id="3031087">bits</span>&nbsp;<span class="op" id="3031092">=</span>&nbsp;<span class="builtinfunc" id="3031094">new</span><span class="op" id="3031097">(</span><span class="op" id="3031098">[</span><span class="ident" id="3031099">maxLit</span>&nbsp;<span class="op" id="3031106">+</span>&nbsp;<span class="ident" id="3031108">maxDist</span><span class="op" id="3031115">]</span><span class="builtintype" id="3031116">int</span><span class="op" id="3031119">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3031122">f</span><span class="op" id="3031123">.</span><span class="ident" id="3031124">codebits</span>&nbsp;<span class="op" id="3031133">=</span>&nbsp;<span class="builtinfunc" id="3031135">new</span><span class="op" id="3031138">(</span><span class="op" id="3031139">[</span><span class="ident" id="3031140">numCodes</span><span class="op" id="3031148">]</span><span class="builtintype" id="3031149">int</span><span class="op" id="3031152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3031155">f</span><span class="op" id="3031156">.</span><span class="ident" id="3031157">step</span>&nbsp;<span class="op" id="3031162">=</span>&nbsp;<span class="op" id="3031164">(</span><span class="op" id="3031165">*</span><span class="ident" id="3031166">decompressor</span><span class="op" id="3031178">)</span><span class="op" id="3031179">.</span><span class="ident" id="3031180">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3031191">f</span><span class="op" id="3031192">.</span><span class="ident" id="3031193">setDict</span><span class="op" id="3031200">(</span><span class="ident" id="3031201">dict</span><span class="op" id="3031205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031208">return</span>&nbsp;<span class="op" id="3031215">&amp;</span><span class="ident" id="3031216">f</span><br>
<span class="lineno"></span><span class="op" id="3031218">}</span>
</div>
</body>
</html>
