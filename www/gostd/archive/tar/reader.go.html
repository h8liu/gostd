<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5993639">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5993694">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5993748">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5993799">package</span>&nbsp;<span class="ident" id="5993807">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5993812">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="5993831">//&nbsp;&nbsp;&nbsp;-&nbsp;pax&nbsp;extensions</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5993854">import</span>&nbsp;<span class="op" id="5993861">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5993864">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5993873">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5993883">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5993889">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5993902">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5993908">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5993919">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5993930">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5993937">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5993940">var</span>&nbsp;<span class="op" id="5993944">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5993947">ErrHeader</span>&nbsp;<span class="op" id="5993957">=</span>&nbsp;<span class="ident" id="5993959">errors</span><span class="op" id="5993965">.</span><span class="ident" id="5993966">New</span><span class="op" id="5993969">(</span><span class="string" id="5993970">&#34;archive/tar:&nbsp;invalid&nbsp;tar&nbsp;header&#34;</span><span class="op" id="5994003">)</span><br>
<span class="lineno"></span><span class="op" id="5994005">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5994008">const</span>&nbsp;<span class="ident" id="5994014">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5994035">=</span>&nbsp;<span class="num" id="5994037">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5994040">//&nbsp;A&nbsp;Reader&nbsp;provides&nbsp;sequential&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5994113">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5994163">//&nbsp;The&nbsp;Next&nbsp;method&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;file&nbsp;in&nbsp;the&nbsp;archive&nbsp;(including&nbsp;the&nbsp;first),</span><br>
<span class="lineno">30</span><span class="comment" id="5994246">//&nbsp;and&nbsp;then&nbsp;it&nbsp;can&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;io.Reader&nbsp;to&nbsp;access&nbsp;the&nbsp;file&#39;s&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5994319">type</span>&nbsp;<span class="ident" id="5994324">Reader</span>&nbsp;<span class="keyword" id="5994331">struct</span>&nbsp;<span class="op" id="5994338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994341">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994349">io</span><span class="op" id="5994351">.</span><span class="ident" id="5994352">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994360">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5994368">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994375">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994383">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5994399">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;(ignored)&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994456">curr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994464">numBytesReader</span>&nbsp;&nbsp;<span class="comment" id="5994480">//&nbsp;reader&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994514">hdrBuff</span>&nbsp;<span class="op" id="5994522">[</span><span class="ident" id="5994523">blockSize</span><span class="op" id="5994532">]</span><span class="builtintype" id="5994533">byte</span>&nbsp;<span class="comment" id="5994538">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;readHeader</span><br>
<span class="lineno"></span><span class="op" id="5994569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5994572">//&nbsp;A&nbsp;numBytesReader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;with&nbsp;a&nbsp;numBytes&nbsp;method,&nbsp;returning&nbsp;the&nbsp;number</span><br>
<span class="lineno">40</span><span class="comment" id="5994653">//&nbsp;of&nbsp;bytes&nbsp;remaining&nbsp;in&nbsp;the&nbsp;underlying&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5994707">type</span>&nbsp;<span class="ident" id="5994712">numBytesReader</span>&nbsp;<span class="keyword" id="5994727">interface</span>&nbsp;<span class="op" id="5994737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994740">io</span><span class="op" id="5994742">.</span><span class="ident" id="5994743">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994751">numBytes</span><span class="op" id="5994759">(</span><span class="op" id="5994760">)</span>&nbsp;<span class="ident" id="5994762">int64</span><br>
<span class="lineno"></span><span class="op" id="5994768">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5994771">//&nbsp;A&nbsp;regFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5994852">type</span>&nbsp;<span class="ident" id="5994857">regFileReader</span>&nbsp;<span class="keyword" id="5994871">struct</span>&nbsp;<span class="op" id="5994878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994881">r</span>&nbsp;&nbsp;<span class="ident" id="5994884">io</span><span class="op" id="5994886">.</span><span class="ident" id="5994887">Reader</span>&nbsp;<span class="comment" id="5994894">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994916">nb</span>&nbsp;<span class="ident" id="5994919">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5994929">//&nbsp;number&nbsp;of&nbsp;unread&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">50</span><span class="op" id="5994978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5994981">//&nbsp;A&nbsp;sparseFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;sparse&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5995072">type</span>&nbsp;<span class="ident" id="5995077">sparseFileReader</span>&nbsp;<span class="keyword" id="5995094">struct</span>&nbsp;<span class="op" id="5995101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995104">rfr</span>&nbsp;<span class="op" id="5995108">*</span><span class="ident" id="5995109">regFileReader</span>&nbsp;<span class="comment" id="5995123">//&nbsp;reads&nbsp;the&nbsp;sparse-encoded&nbsp;file&nbsp;data</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995162">sp</span>&nbsp;&nbsp;<span class="op" id="5995166">[</span><span class="op" id="5995167">]</span><span class="ident" id="5995168">sparseEntry</span>&nbsp;&nbsp;<span class="comment" id="5995181">//&nbsp;the&nbsp;sparse&nbsp;map&nbsp;for&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995213">pos</span>&nbsp;<span class="ident" id="5995217">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5995232">//&nbsp;keeps&nbsp;track&nbsp;of&nbsp;file&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995265">tot</span>&nbsp;<span class="ident" id="5995269">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5995284">//&nbsp;total&nbsp;size&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="5995310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5995313">//&nbsp;Keywords&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;files&nbsp;in&nbsp;a&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="5995371">const</span>&nbsp;<span class="op" id="5995377">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995380">paxGNUSparseNumBlocks</span>&nbsp;<span class="op" id="5995402">=</span>&nbsp;<span class="string" id="5995404">&#34;GNU.sparse.numblocks&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995428">paxGNUSparseOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995450">=</span>&nbsp;<span class="string" id="5995452">&#34;GNU.sparse.offset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995473">paxGNUSparseNumBytes</span>&nbsp;&nbsp;<span class="op" id="5995495">=</span>&nbsp;<span class="string" id="5995497">&#34;GNU.sparse.numbytes&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995520">paxGNUSparseMap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995542">=</span>&nbsp;<span class="string" id="5995544">&#34;GNU.sparse.map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995562">paxGNUSparseName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995584">=</span>&nbsp;<span class="string" id="5995586">&#34;GNU.sparse.name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995605">paxGNUSparseMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995627">=</span>&nbsp;<span class="string" id="5995629">&#34;GNU.sparse.major&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995649">paxGNUSparseMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995671">=</span>&nbsp;<span class="string" id="5995673">&#34;GNU.sparse.minor&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995693">paxGNUSparseSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995715">=</span>&nbsp;<span class="string" id="5995717">&#34;GNU.sparse.size&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995736">paxGNUSparseRealSize</span>&nbsp;&nbsp;<span class="op" id="5995758">=</span>&nbsp;<span class="string" id="5995760">&#34;GNU.sparse.realsize&#34;</span><br>
<span class="lineno"></span><span class="op" id="5995782">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5995785">//&nbsp;Keywords&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;headers</span><br>
<span class="lineno"></span><span class="keyword" id="5995824">const</span>&nbsp;<span class="op" id="5995830">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995833">oldGNUSparseMainHeaderOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995876">=</span>&nbsp;<span class="num" id="5995878">386</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995883">oldGNUSparseMainHeaderIsExtendedOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995926">=</span>&nbsp;<span class="num" id="5995928">482</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995933">oldGNUSparseMainHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995976">=</span>&nbsp;<span class="num" id="5995978">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995981">oldGNUSparseExtendedHeaderIsExtendedOffset</span>&nbsp;<span class="op" id="5996024">=</span>&nbsp;<span class="num" id="5996026">504</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996031">oldGNUSparseExtendedHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5996074">=</span>&nbsp;<span class="num" id="5996076">21</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996080">oldGNUSparseOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5996123">=</span>&nbsp;<span class="num" id="5996125">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996129">oldGNUSparseNumBytesSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5996172">=</span>&nbsp;<span class="num" id="5996174">12</span><br>
<span class="lineno"></span><span class="op" id="5996177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5996180">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno">85</span><span class="keyword" id="5996230">func</span>&nbsp;<span class="ident" id="5996235">NewReader</span><span class="op" id="5996244">(</span><span class="ident" id="5996245">r</span>&nbsp;<span class="ident" id="5996247">io</span><span class="op" id="5996249">.</span><span class="ident" id="5996250">Reader</span><span class="op" id="5996256">)</span>&nbsp;<span class="op" id="5996258">*</span><span class="ident" id="5996259">Reader</span>&nbsp;<span class="op" id="5996266">{</span>&nbsp;<span class="keyword" id="5996268">return</span>&nbsp;<span class="op" id="5996275">&amp;</span><span class="ident" id="5996276">Reader</span><span class="op" id="5996282">{</span><span class="ident" id="5996283">r</span><span class="op" id="5996284">:</span>&nbsp;<span class="ident" id="5996286">r</span><span class="op" id="5996287">}</span>&nbsp;<span class="op" id="5996289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5996292">//&nbsp;Next&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5996347">func</span>&nbsp;<span class="op" id="5996352">(</span><span class="ident" id="5996353">tr</span>&nbsp;<span class="op" id="5996356">*</span><span class="ident" id="5996357">Reader</span><span class="op" id="5996363">)</span>&nbsp;<span class="ident" id="5996365">Next</span><span class="op" id="5996369">(</span><span class="op" id="5996370">)</span>&nbsp;<span class="op" id="5996372">(</span><span class="op" id="5996373">*</span><span class="ident" id="5996374">Header</span><span class="op" id="5996380">,</span>&nbsp;<span class="builtintype" id="5996382">error</span><span class="op" id="5996387">)</span>&nbsp;<span class="op" id="5996389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996392">var</span>&nbsp;<span class="ident" id="5996396">hdr</span>&nbsp;<span class="op" id="5996400">*</span><span class="ident" id="5996401">Header</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996409">if</span>&nbsp;<span class="ident" id="5996412">tr</span><span class="op" id="5996414">.</span><span class="ident" id="5996415">err</span>&nbsp;<span class="op" id="5996419">==</span>&nbsp;<span class="builtintype" id="5996422">nil</span>&nbsp;<span class="op" id="5996426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996430">tr</span><span class="op" id="5996432">.</span><span class="ident" id="5996433">skipUnread</span><span class="op" id="5996443">(</span><span class="op" id="5996444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5996447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996450">if</span>&nbsp;<span class="ident" id="5996453">tr</span><span class="op" id="5996455">.</span><span class="ident" id="5996456">err</span>&nbsp;<span class="op" id="5996460">!=</span>&nbsp;<span class="builtintype" id="5996463">nil</span>&nbsp;<span class="op" id="5996467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996471">return</span>&nbsp;<span class="ident" id="5996478">hdr</span><span class="op" id="5996481">,</span>&nbsp;<span class="ident" id="5996483">tr</span><span class="op" id="5996485">.</span><span class="ident" id="5996486">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5996491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996494">hdr</span>&nbsp;<span class="op" id="5996498">=</span>&nbsp;<span class="ident" id="5996500">tr</span><span class="op" id="5996502">.</span><span class="ident" id="5996503">readHeader</span><span class="op" id="5996513">(</span><span class="op" id="5996514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996517">if</span>&nbsp;<span class="ident" id="5996520">hdr</span>&nbsp;<span class="op" id="5996524">==</span>&nbsp;<span class="builtintype" id="5996527">nil</span>&nbsp;<span class="op" id="5996531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996535">return</span>&nbsp;<span class="ident" id="5996542">hdr</span><span class="op" id="5996545">,</span>&nbsp;<span class="ident" id="5996547">tr</span><span class="op" id="5996549">.</span><span class="ident" id="5996550">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5996555">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5996558">//&nbsp;Check&nbsp;for&nbsp;PAX/GNU&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996588">switch</span>&nbsp;<span class="ident" id="5996595">hdr</span><span class="op" id="5996598">.</span><span class="ident" id="5996599">Typeflag</span>&nbsp;<span class="op" id="5996608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996611">case</span>&nbsp;<span class="ident" id="5996616">TypeXHeader</span><span class="op" id="5996627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5996631">//&nbsp;&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996657">headers</span><span class="op" id="5996664">,</span>&nbsp;<span class="ident" id="5996666">err</span>&nbsp;<span class="op" id="5996670">:=</span>&nbsp;<span class="ident" id="5996673">parsePAX</span><span class="op" id="5996681">(</span><span class="ident" id="5996682">tr</span><span class="op" id="5996684">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996688">if</span>&nbsp;<span class="ident" id="5996691">err</span>&nbsp;<span class="op" id="5996695">!=</span>&nbsp;<span class="builtintype" id="5996698">nil</span>&nbsp;<span class="op" id="5996702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996707">return</span>&nbsp;<span class="builtintype" id="5996714">nil</span><span class="op" id="5996717">,</span>&nbsp;<span class="ident" id="5996719">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5996725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5996729">//&nbsp;We&nbsp;actually&nbsp;read&nbsp;the&nbsp;whole&nbsp;file,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5996767">//&nbsp;but&nbsp;this&nbsp;skips&nbsp;alignment&nbsp;padding</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996805">tr</span><span class="op" id="5996807">.</span><span class="ident" id="5996808">skipUnread</span><span class="op" id="5996818">(</span><span class="op" id="5996819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996823">hdr</span>&nbsp;<span class="op" id="5996827">=</span>&nbsp;<span class="ident" id="5996829">tr</span><span class="op" id="5996831">.</span><span class="ident" id="5996832">readHeader</span><span class="op" id="5996842">(</span><span class="op" id="5996843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996847">mergePAX</span><span class="op" id="5996855">(</span><span class="ident" id="5996856">hdr</span><span class="op" id="5996859">,</span>&nbsp;<span class="ident" id="5996861">headers</span><span class="op" id="5996868">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5996873">//&nbsp;Check&nbsp;for&nbsp;a&nbsp;PAX&nbsp;format&nbsp;sparse&nbsp;file</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996913">sp</span><span class="op" id="5996915">,</span>&nbsp;<span class="ident" id="5996917">err</span>&nbsp;<span class="op" id="5996921">:=</span>&nbsp;<span class="ident" id="5996924">tr</span><span class="op" id="5996926">.</span><span class="ident" id="5996927">checkForGNUSparsePAXHeaders</span><span class="op" id="5996954">(</span><span class="ident" id="5996955">hdr</span><span class="op" id="5996958">,</span>&nbsp;<span class="ident" id="5996960">headers</span><span class="op" id="5996967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996971">if</span>&nbsp;<span class="ident" id="5996974">err</span>&nbsp;<span class="op" id="5996978">!=</span>&nbsp;<span class="builtintype" id="5996981">nil</span>&nbsp;<span class="op" id="5996985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996990">tr</span><span class="op" id="5996992">.</span><span class="ident" id="5996993">err</span>&nbsp;<span class="op" id="5996997">=</span>&nbsp;<span class="ident" id="5996999">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997006">return</span>&nbsp;<span class="builtintype" id="5997013">nil</span><span class="op" id="5997016">,</span>&nbsp;<span class="ident" id="5997018">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5997024">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997028">if</span>&nbsp;<span class="ident" id="5997031">sp</span>&nbsp;<span class="op" id="5997034">!=</span>&nbsp;<span class="builtintype" id="5997037">nil</span>&nbsp;<span class="op" id="5997041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5997046">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5997098">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader&nbsp;to&nbsp;a&nbsp;sparse&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997157">tr</span><span class="op" id="5997159">.</span><span class="ident" id="5997160">curr</span>&nbsp;<span class="op" id="5997165">=</span>&nbsp;<span class="op" id="5997167">&amp;</span><span class="ident" id="5997168">sparseFileReader</span><span class="op" id="5997184">{</span><span class="ident" id="5997185">rfr</span><span class="op" id="5997188">:</span>&nbsp;<span class="ident" id="5997190">tr</span><span class="op" id="5997192">.</span><span class="ident" id="5997193">curr</span><span class="op" id="5997197">.</span><span class="op" id="5997198">(</span><span class="op" id="5997199">*</span><span class="ident" id="5997200">regFileReader</span><span class="op" id="5997213">)</span><span class="op" id="5997214">,</span>&nbsp;<span class="ident" id="5997216">sp</span><span class="op" id="5997218">:</span>&nbsp;<span class="ident" id="5997220">sp</span><span class="op" id="5997222">,</span>&nbsp;<span class="ident" id="5997224">tot</span><span class="op" id="5997227">:</span>&nbsp;<span class="ident" id="5997229">hdr</span><span class="op" id="5997232">.</span><span class="ident" id="5997233">Size</span><span class="op" id="5997237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5997241">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997245">return</span>&nbsp;<span class="ident" id="5997252">hdr</span><span class="op" id="5997255">,</span>&nbsp;<span class="builtintype" id="5997257">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997262">case</span>&nbsp;<span class="ident" id="5997267">TypeGNULongName</span><span class="op" id="5997282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5997286">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;name&nbsp;header.&nbsp;Its&nbsp;contents&nbsp;are&nbsp;the&nbsp;real&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997360">realname</span><span class="op" id="5997368">,</span>&nbsp;<span class="ident" id="5997370">err</span>&nbsp;<span class="op" id="5997374">:=</span>&nbsp;<span class="ident" id="5997377">ioutil</span><span class="op" id="5997383">.</span><span class="ident" id="5997384">ReadAll</span><span class="op" id="5997391">(</span><span class="ident" id="5997392">tr</span><span class="op" id="5997394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997398">if</span>&nbsp;<span class="ident" id="5997401">err</span>&nbsp;<span class="op" id="5997405">!=</span>&nbsp;<span class="builtintype" id="5997408">nil</span>&nbsp;<span class="op" id="5997412">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997417">return</span>&nbsp;<span class="builtintype" id="5997424">nil</span><span class="op" id="5997427">,</span>&nbsp;<span class="ident" id="5997429">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5997435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997439">hdr</span><span class="op" id="5997442">,</span>&nbsp;<span class="ident" id="5997444">err</span>&nbsp;<span class="op" id="5997448">:=</span>&nbsp;<span class="ident" id="5997451">tr</span><span class="op" id="5997453">.</span><span class="ident" id="5997454">Next</span><span class="op" id="5997458">(</span><span class="op" id="5997459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997463">hdr</span><span class="op" id="5997466">.</span><span class="ident" id="5997467">Name</span>&nbsp;<span class="op" id="5997472">=</span>&nbsp;<span class="ident" id="5997474">cString</span><span class="op" id="5997481">(</span><span class="ident" id="5997482">realname</span><span class="op" id="5997490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997494">return</span>&nbsp;<span class="ident" id="5997501">hdr</span><span class="op" id="5997504">,</span>&nbsp;<span class="ident" id="5997506">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997511">case</span>&nbsp;<span class="ident" id="5997516">TypeGNULongLink</span><span class="op" id="5997531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5997535">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;link&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997572">realname</span><span class="op" id="5997580">,</span>&nbsp;<span class="ident" id="5997582">err</span>&nbsp;<span class="op" id="5997586">:=</span>&nbsp;<span class="ident" id="5997589">ioutil</span><span class="op" id="5997595">.</span><span class="ident" id="5997596">ReadAll</span><span class="op" id="5997603">(</span><span class="ident" id="5997604">tr</span><span class="op" id="5997606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997610">if</span>&nbsp;<span class="ident" id="5997613">err</span>&nbsp;<span class="op" id="5997617">!=</span>&nbsp;<span class="builtintype" id="5997620">nil</span>&nbsp;<span class="op" id="5997624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997629">return</span>&nbsp;<span class="builtintype" id="5997636">nil</span><span class="op" id="5997639">,</span>&nbsp;<span class="ident" id="5997641">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5997647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997651">hdr</span><span class="op" id="5997654">,</span>&nbsp;<span class="ident" id="5997656">err</span>&nbsp;<span class="op" id="5997660">:=</span>&nbsp;<span class="ident" id="5997663">tr</span><span class="op" id="5997665">.</span><span class="ident" id="5997666">Next</span><span class="op" id="5997670">(</span><span class="op" id="5997671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997675">hdr</span><span class="op" id="5997678">.</span><span class="ident" id="5997679">Linkname</span>&nbsp;<span class="op" id="5997688">=</span>&nbsp;<span class="ident" id="5997690">cString</span><span class="op" id="5997697">(</span><span class="ident" id="5997698">realname</span><span class="op" id="5997706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997710">return</span>&nbsp;<span class="ident" id="5997717">hdr</span><span class="op" id="5997720">,</span>&nbsp;<span class="ident" id="5997722">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5997727">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997730">return</span>&nbsp;<span class="ident" id="5997737">hdr</span><span class="op" id="5997740">,</span>&nbsp;<span class="ident" id="5997742">tr</span><span class="op" id="5997744">.</span><span class="ident" id="5997745">err</span><br>
<span class="lineno"></span><span class="op" id="5997749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5997752">//&nbsp;checkForGNUSparsePAXHeaders&nbsp;checks&nbsp;the&nbsp;PAX&nbsp;headers&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;headers.&nbsp;If&nbsp;they&nbsp;are&nbsp;found,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5997854">//&nbsp;this&nbsp;function&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;and&nbsp;returns&nbsp;it.&nbsp;Unknown&nbsp;sparse&nbsp;formats&nbsp;are&nbsp;ignored,&nbsp;causing&nbsp;the&nbsp;file&nbsp;to</span><br>
<span class="lineno">150</span><span class="comment" id="5997964">//&nbsp;be&nbsp;treated&nbsp;as&nbsp;a&nbsp;regular&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5997997">func</span>&nbsp;<span class="op" id="5998002">(</span><span class="ident" id="5998003">tr</span>&nbsp;<span class="op" id="5998006">*</span><span class="ident" id="5998007">Reader</span><span class="op" id="5998013">)</span>&nbsp;<span class="ident" id="5998015">checkForGNUSparsePAXHeaders</span><span class="op" id="5998042">(</span><span class="ident" id="5998043">hdr</span>&nbsp;<span class="op" id="5998047">*</span><span class="ident" id="5998048">Header</span><span class="op" id="5998054">,</span>&nbsp;<span class="ident" id="5998056">headers</span>&nbsp;<span class="keyword" id="5998064">map</span><span class="op" id="5998067">[</span><span class="builtintype" id="5998068">string</span><span class="op" id="5998074">]</span><span class="builtintype" id="5998075">string</span><span class="op" id="5998081">)</span>&nbsp;<span class="op" id="5998083">(</span><span class="op" id="5998084">[</span><span class="op" id="5998085">]</span><span class="ident" id="5998086">sparseEntry</span><span class="op" id="5998097">,</span>&nbsp;<span class="builtintype" id="5998099">error</span><span class="op" id="5998104">)</span>&nbsp;<span class="op" id="5998106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5998109">var</span>&nbsp;<span class="ident" id="5998113">sparseFormat</span>&nbsp;<span class="builtintype" id="5998126">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5998135">//&nbsp;Check&nbsp;for&nbsp;sparse&nbsp;format&nbsp;indicators</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998174">major</span><span class="op" id="5998179">,</span>&nbsp;<span class="ident" id="5998181">majorOk</span>&nbsp;<span class="op" id="5998189">:=</span>&nbsp;<span class="ident" id="5998192">headers</span><span class="op" id="5998199">[</span><span class="ident" id="5998200">paxGNUSparseMajor</span><span class="op" id="5998217">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998220">minor</span><span class="op" id="5998225">,</span>&nbsp;<span class="ident" id="5998227">minorOk</span>&nbsp;<span class="op" id="5998235">:=</span>&nbsp;<span class="ident" id="5998238">headers</span><span class="op" id="5998245">[</span><span class="ident" id="5998246">paxGNUSparseMinor</span><span class="op" id="5998263">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998266">sparseName</span><span class="op" id="5998276">,</span>&nbsp;<span class="ident" id="5998278">sparseNameOk</span>&nbsp;<span class="op" id="5998291">:=</span>&nbsp;<span class="ident" id="5998294">headers</span><span class="op" id="5998301">[</span><span class="ident" id="5998302">paxGNUSparseName</span><span class="op" id="5998318">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998321">_</span><span class="op" id="5998322">,</span>&nbsp;<span class="ident" id="5998324">sparseMapOk</span>&nbsp;<span class="op" id="5998336">:=</span>&nbsp;<span class="ident" id="5998339">headers</span><span class="op" id="5998346">[</span><span class="ident" id="5998347">paxGNUSparseMap</span><span class="op" id="5998362">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998365">sparseSize</span><span class="op" id="5998375">,</span>&nbsp;<span class="ident" id="5998377">sparseSizeOk</span>&nbsp;<span class="op" id="5998390">:=</span>&nbsp;<span class="ident" id="5998393">headers</span><span class="op" id="5998400">[</span><span class="ident" id="5998401">paxGNUSparseSize</span><span class="op" id="5998417">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998420">sparseRealSize</span><span class="op" id="5998434">,</span>&nbsp;<span class="ident" id="5998436">sparseRealSizeOk</span>&nbsp;<span class="op" id="5998453">:=</span>&nbsp;<span class="ident" id="5998456">headers</span><span class="op" id="5998463">[</span><span class="ident" id="5998464">paxGNUSparseRealSize</span><span class="op" id="5998484">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5998488">//&nbsp;Identify&nbsp;which,&nbsp;if&nbsp;any,&nbsp;sparse&nbsp;format&nbsp;applies&nbsp;from&nbsp;which&nbsp;PAX&nbsp;headers&nbsp;are&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5998569">if</span>&nbsp;<span class="ident" id="5998572">majorOk</span>&nbsp;<span class="op" id="5998580">&amp;&amp;</span>&nbsp;<span class="ident" id="5998583">minorOk</span>&nbsp;<span class="op" id="5998591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998595">sparseFormat</span>&nbsp;<span class="op" id="5998608">=</span>&nbsp;<span class="ident" id="5998610">major</span>&nbsp;<span class="op" id="5998616">+</span>&nbsp;<span class="string" id="5998618">&#34;.&#34;</span>&nbsp;<span class="op" id="5998622">+</span>&nbsp;<span class="ident" id="5998624">minor</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5998631">}</span>&nbsp;<span class="keyword" id="5998633">else</span>&nbsp;<span class="keyword" id="5998638">if</span>&nbsp;<span class="ident" id="5998641">sparseNameOk</span>&nbsp;<span class="op" id="5998654">&amp;&amp;</span>&nbsp;<span class="ident" id="5998657">sparseMapOk</span>&nbsp;<span class="op" id="5998669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998673">sparseFormat</span>&nbsp;<span class="op" id="5998686">=</span>&nbsp;<span class="string" id="5998688">&#34;0.1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5998695">}</span>&nbsp;<span class="keyword" id="5998697">else</span>&nbsp;<span class="keyword" id="5998702">if</span>&nbsp;<span class="ident" id="5998705">sparseSizeOk</span>&nbsp;<span class="op" id="5998718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998722">sparseFormat</span>&nbsp;<span class="op" id="5998735">=</span>&nbsp;<span class="string" id="5998737">&#34;0.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5998744">}</span>&nbsp;<span class="keyword" id="5998746">else</span>&nbsp;<span class="op" id="5998751">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5998755">//&nbsp;Not&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5998794">return</span>&nbsp;<span class="builtintype" id="5998801">nil</span><span class="op" id="5998804">,</span>&nbsp;<span class="builtintype" id="5998806">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5998811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5998815">//&nbsp;Check&nbsp;for&nbsp;unknown&nbsp;sparse&nbsp;format</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5998851">if</span>&nbsp;<span class="ident" id="5998854">sparseFormat</span>&nbsp;<span class="op" id="5998867">!=</span>&nbsp;<span class="string" id="5998870">&#34;0.0&#34;</span>&nbsp;<span class="op" id="5998876">&amp;&amp;</span>&nbsp;<span class="ident" id="5998879">sparseFormat</span>&nbsp;<span class="op" id="5998892">!=</span>&nbsp;<span class="string" id="5998895">&#34;0.1&#34;</span>&nbsp;<span class="op" id="5998901">&amp;&amp;</span>&nbsp;<span class="ident" id="5998904">sparseFormat</span>&nbsp;<span class="op" id="5998917">!=</span>&nbsp;<span class="string" id="5998920">&#34;1.0&#34;</span>&nbsp;<span class="op" id="5998926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5998930">return</span>&nbsp;<span class="builtintype" id="5998937">nil</span><span class="op" id="5998940">,</span>&nbsp;<span class="builtintype" id="5998942">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5998947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5998951">//&nbsp;Update&nbsp;hdr&nbsp;from&nbsp;GNU&nbsp;sparse&nbsp;PAX&nbsp;headers</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5998994">if</span>&nbsp;<span class="ident" id="5998997">sparseNameOk</span>&nbsp;<span class="op" id="5999010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5999014">hdr</span><span class="op" id="5999017">.</span><span class="ident" id="5999018">Name</span>&nbsp;<span class="op" id="5999023">=</span>&nbsp;<span class="ident" id="5999025">sparseName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5999037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999040">if</span>&nbsp;<span class="ident" id="5999043">sparseSizeOk</span>&nbsp;<span class="op" id="5999056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5999060">realSize</span><span class="op" id="5999068">,</span>&nbsp;<span class="ident" id="5999070">err</span>&nbsp;<span class="op" id="5999074">:=</span>&nbsp;<span class="ident" id="5999077">strconv</span><span class="op" id="5999084">.</span><span class="ident" id="5999085">ParseInt</span><span class="op" id="5999093">(</span><span class="ident" id="5999094">sparseSize</span><span class="op" id="5999104">,</span>&nbsp;<span class="num" id="5999106">10</span><span class="op" id="5999108">,</span>&nbsp;<span class="num" id="5999110">0</span><span class="op" id="5999111">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999115">if</span>&nbsp;<span class="ident" id="5999118">err</span>&nbsp;<span class="op" id="5999122">!=</span>&nbsp;<span class="builtintype" id="5999125">nil</span>&nbsp;<span class="op" id="5999129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999134">return</span>&nbsp;<span class="builtintype" id="5999141">nil</span><span class="op" id="5999144">,</span>&nbsp;<span class="ident" id="5999146">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5999158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5999162">hdr</span><span class="op" id="5999165">.</span><span class="ident" id="5999166">Size</span>&nbsp;<span class="op" id="5999171">=</span>&nbsp;<span class="ident" id="5999173">realSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5999183">}</span>&nbsp;<span class="keyword" id="5999185">else</span>&nbsp;<span class="keyword" id="5999190">if</span>&nbsp;<span class="ident" id="5999193">sparseRealSizeOk</span>&nbsp;<span class="op" id="5999210">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5999214">realSize</span><span class="op" id="5999222">,</span>&nbsp;<span class="ident" id="5999224">err</span>&nbsp;<span class="op" id="5999228">:=</span>&nbsp;<span class="ident" id="5999231">strconv</span><span class="op" id="5999238">.</span><span class="ident" id="5999239">ParseInt</span><span class="op" id="5999247">(</span><span class="ident" id="5999248">sparseRealSize</span><span class="op" id="5999262">,</span>&nbsp;<span class="num" id="5999264">10</span><span class="op" id="5999266">,</span>&nbsp;<span class="num" id="5999268">0</span><span class="op" id="5999269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999273">if</span>&nbsp;<span class="ident" id="5999276">err</span>&nbsp;<span class="op" id="5999280">!=</span>&nbsp;<span class="builtintype" id="5999283">nil</span>&nbsp;<span class="op" id="5999287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999292">return</span>&nbsp;<span class="builtintype" id="5999299">nil</span><span class="op" id="5999302">,</span>&nbsp;<span class="ident" id="5999304">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5999316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5999320">hdr</span><span class="op" id="5999323">.</span><span class="ident" id="5999324">Size</span>&nbsp;<span class="op" id="5999329">=</span>&nbsp;<span class="ident" id="5999331">realSize</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5999341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5999345">//&nbsp;Set&nbsp;up&nbsp;the&nbsp;sparse&nbsp;map,&nbsp;according&nbsp;to&nbsp;the&nbsp;particular&nbsp;sparse&nbsp;format&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999421">var</span>&nbsp;<span class="ident" id="5999425">sp</span>&nbsp;<span class="op" id="5999428">[</span><span class="op" id="5999429">]</span><span class="ident" id="5999430">sparseEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999443">var</span>&nbsp;<span class="ident" id="5999447">err</span>&nbsp;<span class="builtintype" id="5999451">error</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999458">switch</span>&nbsp;<span class="ident" id="5999465">sparseFormat</span>&nbsp;<span class="op" id="5999478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999481">case</span>&nbsp;<span class="string" id="5999486">&#34;0.0&#34;</span><span class="op" id="5999491">,</span>&nbsp;<span class="string" id="5999493">&#34;0.1&#34;</span><span class="op" id="5999498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5999502">sp</span><span class="op" id="5999504">,</span>&nbsp;<span class="ident" id="5999506">err</span>&nbsp;<span class="op" id="5999510">=</span>&nbsp;<span class="ident" id="5999512">readGNUSparseMap0x1</span><span class="op" id="5999531">(</span><span class="ident" id="5999532">headers</span><span class="op" id="5999539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999542">case</span>&nbsp;<span class="string" id="5999547">&#34;1.0&#34;</span><span class="op" id="5999552">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5999556">sp</span><span class="op" id="5999558">,</span>&nbsp;<span class="ident" id="5999560">err</span>&nbsp;<span class="op" id="5999564">=</span>&nbsp;<span class="ident" id="5999566">readGNUSparseMap1x0</span><span class="op" id="5999585">(</span><span class="ident" id="5999586">tr</span><span class="op" id="5999588">.</span><span class="ident" id="5999589">curr</span><span class="op" id="5999593">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5999596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999599">return</span>&nbsp;<span class="ident" id="5999606">sp</span><span class="op" id="5999608">,</span>&nbsp;<span class="ident" id="5999610">err</span><br>
<span class="lineno"></span><span class="op" id="5999614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5999617">//&nbsp;mergePAX&nbsp;merges&nbsp;well&nbsp;known&nbsp;headers&nbsp;according&nbsp;to&nbsp;PAX&nbsp;standard.</span><br>
<span class="lineno">210</span><span class="comment" id="5999682">//&nbsp;In&nbsp;general&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;those&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="5999738">//&nbsp;in&nbsp;the&nbsp;header&nbsp;struct&nbsp;overwrite&nbsp;those&nbsp;found&nbsp;in&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5999798">//&nbsp;struct&nbsp;with&nbsp;higher&nbsp;precision&nbsp;or&nbsp;longer&nbsp;values.&nbsp;Esp.&nbsp;useful</span><br>
<span class="lineno"></span><span class="comment" id="5999860">//&nbsp;for&nbsp;name&nbsp;and&nbsp;linkname&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="5999893">func</span>&nbsp;<span class="ident" id="5999898">mergePAX</span><span class="op" id="5999906">(</span><span class="ident" id="5999907">hdr</span>&nbsp;<span class="op" id="5999911">*</span><span class="ident" id="5999912">Header</span><span class="op" id="5999918">,</span>&nbsp;<span class="ident" id="5999920">headers</span>&nbsp;<span class="keyword" id="5999928">map</span><span class="op" id="5999931">[</span><span class="builtintype" id="5999932">string</span><span class="op" id="5999938">]</span><span class="builtintype" id="5999939">string</span><span class="op" id="5999945">)</span>&nbsp;<span class="builtintype" id="5999947">error</span>&nbsp;<span class="op" id="5999953">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999956">for</span>&nbsp;<span class="ident" id="5999960">k</span><span class="op" id="5999961">,</span>&nbsp;<span class="ident" id="5999963">v</span>&nbsp;<span class="op" id="5999965">:=</span>&nbsp;<span class="keyword" id="5999968">range</span>&nbsp;<span class="ident" id="5999974">headers</span>&nbsp;<span class="op" id="5999982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999986">switch</span>&nbsp;<span class="ident" id="5999993">k</span>&nbsp;<span class="op" id="5999995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5999999">case</span>&nbsp;<span class="ident" id="6000004">paxPath</span><span class="op" id="6000011">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000016">hdr</span><span class="op" id="6000019">.</span><span class="ident" id="6000020">Name</span>&nbsp;<span class="op" id="6000025">=</span>&nbsp;<span class="ident" id="6000027">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000031">case</span>&nbsp;<span class="ident" id="6000036">paxLinkpath</span><span class="op" id="6000047">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000052">hdr</span><span class="op" id="6000055">.</span><span class="ident" id="6000056">Linkname</span>&nbsp;<span class="op" id="6000065">=</span>&nbsp;<span class="ident" id="6000067">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000071">case</span>&nbsp;<span class="ident" id="6000076">paxGname</span><span class="op" id="6000084">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000089">hdr</span><span class="op" id="6000092">.</span><span class="ident" id="6000093">Gname</span>&nbsp;<span class="op" id="6000099">=</span>&nbsp;<span class="ident" id="6000101">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000105">case</span>&nbsp;<span class="ident" id="6000110">paxUname</span><span class="op" id="6000118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000123">hdr</span><span class="op" id="6000126">.</span><span class="ident" id="6000127">Uname</span>&nbsp;<span class="op" id="6000133">=</span>&nbsp;<span class="ident" id="6000135">v</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000139">case</span>&nbsp;<span class="ident" id="6000144">paxUid</span><span class="op" id="6000150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000155">uid</span><span class="op" id="6000158">,</span>&nbsp;<span class="ident" id="6000160">err</span>&nbsp;<span class="op" id="6000164">:=</span>&nbsp;<span class="ident" id="6000167">strconv</span><span class="op" id="6000174">.</span><span class="ident" id="6000175">ParseInt</span><span class="op" id="6000183">(</span><span class="ident" id="6000184">v</span><span class="op" id="6000185">,</span>&nbsp;<span class="num" id="6000187">10</span><span class="op" id="6000189">,</span>&nbsp;<span class="num" id="6000191">0</span><span class="op" id="6000192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000197">if</span>&nbsp;<span class="ident" id="6000200">err</span>&nbsp;<span class="op" id="6000204">!=</span>&nbsp;<span class="builtintype" id="6000207">nil</span>&nbsp;<span class="op" id="6000211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000217">return</span>&nbsp;<span class="ident" id="6000224">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6000231">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000236">hdr</span><span class="op" id="6000239">.</span><span class="ident" id="6000240">Uid</span>&nbsp;<span class="op" id="6000244">=</span>&nbsp;<span class="builtintype" id="6000246">int</span><span class="op" id="6000249">(</span><span class="ident" id="6000250">uid</span><span class="op" id="6000253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000257">case</span>&nbsp;<span class="ident" id="6000262">paxGid</span><span class="op" id="6000268">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000273">gid</span><span class="op" id="6000276">,</span>&nbsp;<span class="ident" id="6000278">err</span>&nbsp;<span class="op" id="6000282">:=</span>&nbsp;<span class="ident" id="6000285">strconv</span><span class="op" id="6000292">.</span><span class="ident" id="6000293">ParseInt</span><span class="op" id="6000301">(</span><span class="ident" id="6000302">v</span><span class="op" id="6000303">,</span>&nbsp;<span class="num" id="6000305">10</span><span class="op" id="6000307">,</span>&nbsp;<span class="num" id="6000309">0</span><span class="op" id="6000310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000315">if</span>&nbsp;<span class="ident" id="6000318">err</span>&nbsp;<span class="op" id="6000322">!=</span>&nbsp;<span class="builtintype" id="6000325">nil</span>&nbsp;<span class="op" id="6000329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000335">return</span>&nbsp;<span class="ident" id="6000342">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6000349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000354">hdr</span><span class="op" id="6000357">.</span><span class="ident" id="6000358">Gid</span>&nbsp;<span class="op" id="6000362">=</span>&nbsp;<span class="builtintype" id="6000364">int</span><span class="op" id="6000367">(</span><span class="ident" id="6000368">gid</span><span class="op" id="6000371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000375">case</span>&nbsp;<span class="ident" id="6000380">paxAtime</span><span class="op" id="6000388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000393">t</span><span class="op" id="6000394">,</span>&nbsp;<span class="ident" id="6000396">err</span>&nbsp;<span class="op" id="6000400">:=</span>&nbsp;<span class="ident" id="6000403">parsePAXTime</span><span class="op" id="6000415">(</span><span class="ident" id="6000416">v</span><span class="op" id="6000417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000422">if</span>&nbsp;<span class="ident" id="6000425">err</span>&nbsp;<span class="op" id="6000429">!=</span>&nbsp;<span class="builtintype" id="6000432">nil</span>&nbsp;<span class="op" id="6000436">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000442">return</span>&nbsp;<span class="ident" id="6000449">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6000456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000461">hdr</span><span class="op" id="6000464">.</span><span class="ident" id="6000465">AccessTime</span>&nbsp;<span class="op" id="6000476">=</span>&nbsp;<span class="ident" id="6000478">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000482">case</span>&nbsp;<span class="ident" id="6000487">paxMtime</span><span class="op" id="6000495">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000500">t</span><span class="op" id="6000501">,</span>&nbsp;<span class="ident" id="6000503">err</span>&nbsp;<span class="op" id="6000507">:=</span>&nbsp;<span class="ident" id="6000510">parsePAXTime</span><span class="op" id="6000522">(</span><span class="ident" id="6000523">v</span><span class="op" id="6000524">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000529">if</span>&nbsp;<span class="ident" id="6000532">err</span>&nbsp;<span class="op" id="6000536">!=</span>&nbsp;<span class="builtintype" id="6000539">nil</span>&nbsp;<span class="op" id="6000543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000549">return</span>&nbsp;<span class="ident" id="6000556">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6000563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000568">hdr</span><span class="op" id="6000571">.</span><span class="ident" id="6000572">ModTime</span>&nbsp;<span class="op" id="6000580">=</span>&nbsp;<span class="ident" id="6000582">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000586">case</span>&nbsp;<span class="ident" id="6000591">paxCtime</span><span class="op" id="6000599">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000604">t</span><span class="op" id="6000605">,</span>&nbsp;<span class="ident" id="6000607">err</span>&nbsp;<span class="op" id="6000611">:=</span>&nbsp;<span class="ident" id="6000614">parsePAXTime</span><span class="op" id="6000626">(</span><span class="ident" id="6000627">v</span><span class="op" id="6000628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000633">if</span>&nbsp;<span class="ident" id="6000636">err</span>&nbsp;<span class="op" id="6000640">!=</span>&nbsp;<span class="builtintype" id="6000643">nil</span>&nbsp;<span class="op" id="6000647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000653">return</span>&nbsp;<span class="ident" id="6000660">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6000667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000672">hdr</span><span class="op" id="6000675">.</span><span class="ident" id="6000676">ChangeTime</span>&nbsp;<span class="op" id="6000687">=</span>&nbsp;<span class="ident" id="6000689">t</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000693">case</span>&nbsp;<span class="ident" id="6000698">paxSize</span><span class="op" id="6000705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000710">size</span><span class="op" id="6000714">,</span>&nbsp;<span class="ident" id="6000716">err</span>&nbsp;<span class="op" id="6000720">:=</span>&nbsp;<span class="ident" id="6000723">strconv</span><span class="op" id="6000730">.</span><span class="ident" id="6000731">ParseInt</span><span class="op" id="6000739">(</span><span class="ident" id="6000740">v</span><span class="op" id="6000741">,</span>&nbsp;<span class="num" id="6000743">10</span><span class="op" id="6000745">,</span>&nbsp;<span class="num" id="6000747">0</span><span class="op" id="6000748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000753">if</span>&nbsp;<span class="ident" id="6000756">err</span>&nbsp;<span class="op" id="6000760">!=</span>&nbsp;<span class="builtintype" id="6000763">nil</span>&nbsp;<span class="op" id="6000767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000773">return</span>&nbsp;<span class="ident" id="6000780">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6000787">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000792">hdr</span><span class="op" id="6000795">.</span><span class="ident" id="6000796">Size</span>&nbsp;<span class="op" id="6000801">=</span>&nbsp;<span class="ident" id="6000803">int64</span><span class="op" id="6000808">(</span><span class="ident" id="6000809">size</span><span class="op" id="6000813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000817">default</span><span class="op" id="6000824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000829">if</span>&nbsp;<span class="ident" id="6000832">strings</span><span class="op" id="6000839">.</span><span class="ident" id="6000840">HasPrefix</span><span class="op" id="6000849">(</span><span class="ident" id="6000850">k</span><span class="op" id="6000851">,</span>&nbsp;<span class="ident" id="6000853">paxXattr</span><span class="op" id="6000861">)</span>&nbsp;<span class="op" id="6000863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000869">if</span>&nbsp;<span class="ident" id="6000872">hdr</span><span class="op" id="6000875">.</span><span class="ident" id="6000876">Xattrs</span>&nbsp;<span class="op" id="6000883">==</span>&nbsp;<span class="builtintype" id="6000886">nil</span>&nbsp;<span class="op" id="6000890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000897">hdr</span><span class="op" id="6000900">.</span><span class="ident" id="6000901">Xattrs</span>&nbsp;<span class="op" id="6000908">=</span>&nbsp;<span class="builtinfunc" id="6000910">make</span><span class="op" id="6000914">(</span><span class="keyword" id="6000915">map</span><span class="op" id="6000918">[</span><span class="builtintype" id="6000919">string</span><span class="op" id="6000925">]</span><span class="builtintype" id="6000926">string</span><span class="op" id="6000932">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6000938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6000944">hdr</span><span class="op" id="6000947">.</span><span class="ident" id="6000948">Xattrs</span><span class="op" id="6000954">[</span><span class="ident" id="6000955">k</span><span class="op" id="6000956">[</span><span class="builtinfunc" id="6000957">len</span><span class="op" id="6000960">(</span><span class="ident" id="6000961">paxXattr</span><span class="op" id="6000969">)</span><span class="op" id="6000970">:</span><span class="op" id="6000971">]</span><span class="op" id="6000972">]</span>&nbsp;<span class="op" id="6000974">=</span>&nbsp;<span class="ident" id="6000976">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6000981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6000985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6000988">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6000991">return</span>&nbsp;<span class="builtintype" id="6000998">nil</span><br>
<span class="lineno"></span><span class="op" id="6001002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6001005">//&nbsp;parsePAXTime&nbsp;takes&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;%d.%d&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6001070">//&nbsp;the&nbsp;PAX&nbsp;specification.</span><br>
<span class="lineno">275</span><span class="keyword" id="6001096">func</span>&nbsp;<span class="ident" id="6001101">parsePAXTime</span><span class="op" id="6001113">(</span><span class="ident" id="6001114">t</span>&nbsp;<span class="builtintype" id="6001116">string</span><span class="op" id="6001122">)</span>&nbsp;<span class="op" id="6001124">(</span><span class="ident" id="6001125">time</span><span class="op" id="6001129">.</span><span class="ident" id="6001130">Time</span><span class="op" id="6001134">,</span>&nbsp;<span class="builtintype" id="6001136">error</span><span class="op" id="6001141">)</span>&nbsp;<span class="op" id="6001143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6001146">buf</span>&nbsp;<span class="op" id="6001150">:=</span>&nbsp;<span class="op" id="6001153">[</span><span class="op" id="6001154">]</span><span class="builtintype" id="6001155">byte</span><span class="op" id="6001159">(</span><span class="ident" id="6001160">t</span><span class="op" id="6001161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6001164">pos</span>&nbsp;<span class="op" id="6001168">:=</span>&nbsp;<span class="ident" id="6001171">bytes</span><span class="op" id="6001176">.</span><span class="ident" id="6001177">IndexByte</span><span class="op" id="6001186">(</span><span class="ident" id="6001187">buf</span><span class="op" id="6001190">,</span>&nbsp;<span class="string" id="6001192">&#39;.&#39;</span><span class="op" id="6001195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6001198">var</span>&nbsp;<span class="ident" id="6001202">seconds</span><span class="op" id="6001209">,</span>&nbsp;<span class="ident" id="6001211">nanoseconds</span>&nbsp;<span class="ident" id="6001223">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6001230">var</span>&nbsp;<span class="ident" id="6001234">err</span>&nbsp;<span class="builtintype" id="6001238">error</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6001245">if</span>&nbsp;<span class="ident" id="6001248">pos</span>&nbsp;<span class="op" id="6001252">==</span>&nbsp;<span class="op" id="6001255">-</span><span class="num" id="6001256">1</span>&nbsp;<span class="op" id="6001258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6001262">seconds</span><span class="op" id="6001269">,</span>&nbsp;<span class="ident" id="6001271">err</span>&nbsp;<span class="op" id="6001275">=</span>&nbsp;<span class="ident" id="6001277">strconv</span><span class="op" id="6001284">.</span><span class="ident" id="6001285">ParseInt</span><span class="op" id="6001293">(</span><span class="ident" id="6001294">t</span><span class="op" id="6001295">,</span>&nbsp;<span class="num" id="6001297">10</span><span class="op" id="6001299">,</span>&nbsp;<span class="num" id="6001301">0</span><span class="op" id="6001302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6001306">if</span>&nbsp;<span class="ident" id="6001309">err</span>&nbsp;<span class="op" id="6001313">!=</span>&nbsp;<span class="builtintype" id="6001316">nil</span>&nbsp;<span class="op" id="6001320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6001325">return</span>&nbsp;<span class="ident" id="6001332">time</span><span class="op" id="6001336">.</span><span class="ident" id="6001337">Time</span><span class="op" id="6001341">{</span><span class="op" id="6001342">}</span><span class="op" id="6001343">,</span>&nbsp;<span class="ident" id="6001345">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6001351">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6001354">}</span>&nbsp;<span class="keyword" id="6001356">else</span>&nbsp;<span class="op" id="6001361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6001365">seconds</span><span class="op" id="6001372">,</span>&nbsp;<span class="ident" id="6001374">err</span>&nbsp;<span class="op" id="6001378">=</span>&nbsp;<span class="ident" id="6001380">strconv</span><span class="op" id="6001387">.</span><span class="ident" id="6001388">ParseInt</span><span class="op" id="6001396">(</span><span class="builtintype" id="6001397">string</span><span class="op" id="6001403">(</span><span class="ident" id="6001404">buf</span><span class="op" id="6001407">[</span><span class="op" id="6001408">:</span><span class="ident" id="6001409">pos</span><span class="op" id="6001412">]</span><span class="op" id="6001413">)</span><span class="op" id="6001414">,</span>&nbsp;<span class="num" id="6001416">10</span><span class="op" id="6001418">,</span>&nbsp;<span class="num" id="6001420">0</span><span class="op" id="6001421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6001425">if</span>&nbsp;<span class="ident" id="6001428">err</span>&nbsp;<span class="op" id="6001432">!=</span>&nbsp;<span class="builtintype" id="6001435">nil</span>&nbsp;<span class="op" id="6001439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6001444">return</span>&nbsp;<span class="ident" id="6001451">time</span><span class="op" id="6001455">.</span><span class="ident" id="6001456">Time</span><span class="op" id="6001460">{</span><span class="op" id="6001461">}</span><span class="op" id="6001462">,</span>&nbsp;<span class="ident" id="6001464">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6001470">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6001474">nano_buf</span>&nbsp;<span class="op" id="6001483">:=</span>&nbsp;<span class="builtintype" id="6001486">string</span><span class="op" id="6001492">(</span><span class="ident" id="6001493">buf</span><span class="op" id="6001496">[</span><span class="ident" id="6001497">pos</span><span class="op" id="6001500">+</span><span class="num" id="6001501">1</span><span class="op" id="6001502">:</span><span class="op" id="6001503">]</span><span class="op" id="6001504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6001508">//&nbsp;Pad&nbsp;as&nbsp;needed&nbsp;before&nbsp;converting&nbsp;to&nbsp;a&nbsp;decimal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6001559">//&nbsp;For&nbsp;example&nbsp;.030&nbsp;-&gt;&nbsp;.030000000&nbsp;-&gt;&nbsp;30000000&nbsp;nanoseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6001619">if</span>&nbsp;<span class="builtinfunc" id="6001622">len</span><span class="op" id="6001625">(</span><span class="ident" id="6001626">nano_buf</span><span class="op" id="6001634">)</span>&nbsp;<span class="op" id="6001636">&lt;</span>&nbsp;<span class="ident" id="6001638">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="6001659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6001664">//&nbsp;Right&nbsp;pad</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6001680">nano_buf</span>&nbsp;<span class="op" id="6001689">+=</span>&nbsp;<span class="ident" id="6001692">strings</span><span class="op" id="6001699">.</span><span class="ident" id="6001700">Repeat</span><span class="op" id="6001706">(</span><span class="string" id="6001707">&#34;0&#34;</span><span class="op" id="6001710">,</span>&nbsp;<span class="ident" id="6001712">maxNanoSecondIntSize</span><span class="op" id="6001732">-</span><span class="builtinfunc" id="6001733">len</span><span class="op" id="6001736">(</span><span class="ident" id="6001737">nano_buf</span><span class="op" id="6001745">)</span><span class="op" id="6001746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6001750">}</span>&nbsp;<span class="keyword" id="6001752">else</span>&nbsp;<span class="keyword" id="6001757">if</span>&nbsp;<span class="builtinfunc" id="6001760">len</span><span class="op" id="6001763">(</span><span class="ident" id="6001764">nano_buf</span><span class="op" id="6001772">)</span>&nbsp;<span class="op" id="6001774">&gt;</span>&nbsp;<span class="ident" id="6001776">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="6001797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6001802">//&nbsp;Right&nbsp;truncate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6001823">nano_buf</span>&nbsp;<span class="op" id="6001832">=</span>&nbsp;<span class="ident" id="6001834">nano_buf</span><span class="op" id="6001842">[</span><span class="op" id="6001843">:</span><span class="ident" id="6001844">maxNanoSecondIntSize</span><span class="op" id="6001864">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6001868">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6001872">nanoseconds</span><span class="op" id="6001883">,</span>&nbsp;<span class="ident" id="6001885">err</span>&nbsp;<span class="op" id="6001889">=</span>&nbsp;<span class="ident" id="6001891">strconv</span><span class="op" id="6001898">.</span><span class="ident" id="6001899">ParseInt</span><span class="op" id="6001907">(</span><span class="builtintype" id="6001908">string</span><span class="op" id="6001914">(</span><span class="ident" id="6001915">nano_buf</span><span class="op" id="6001923">)</span><span class="op" id="6001924">,</span>&nbsp;<span class="num" id="6001926">10</span><span class="op" id="6001928">,</span>&nbsp;<span class="num" id="6001930">0</span><span class="op" id="6001931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6001935">if</span>&nbsp;<span class="ident" id="6001938">err</span>&nbsp;<span class="op" id="6001942">!=</span>&nbsp;<span class="builtintype" id="6001945">nil</span>&nbsp;<span class="op" id="6001949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6001954">return</span>&nbsp;<span class="ident" id="6001961">time</span><span class="op" id="6001965">.</span><span class="ident" id="6001966">Time</span><span class="op" id="6001970">{</span><span class="op" id="6001971">}</span><span class="op" id="6001972">,</span>&nbsp;<span class="ident" id="6001974">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6001980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6001983">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6001986">ts</span>&nbsp;<span class="op" id="6001989">:=</span>&nbsp;<span class="ident" id="6001992">time</span><span class="op" id="6001996">.</span><span class="ident" id="6001997">Unix</span><span class="op" id="6002001">(</span><span class="ident" id="6002002">seconds</span><span class="op" id="6002009">,</span>&nbsp;<span class="ident" id="6002011">nanoseconds</span><span class="op" id="6002022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6002025">return</span>&nbsp;<span class="ident" id="6002032">ts</span><span class="op" id="6002034">,</span>&nbsp;<span class="builtintype" id="6002036">nil</span><br>
<span class="lineno"></span><span class="op" id="6002040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6002043">//&nbsp;parsePAX&nbsp;parses&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno">310</span><span class="comment" id="6002075">//&nbsp;If&nbsp;an&nbsp;extended&nbsp;header&nbsp;(type&nbsp;&#39;x&#39;)&nbsp;is&nbsp;invalid,&nbsp;ErrHeader&nbsp;is&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="6002145">func</span>&nbsp;<span class="ident" id="6002150">parsePAX</span><span class="op" id="6002158">(</span><span class="ident" id="6002159">r</span>&nbsp;<span class="ident" id="6002161">io</span><span class="op" id="6002163">.</span><span class="ident" id="6002164">Reader</span><span class="op" id="6002170">)</span>&nbsp;<span class="op" id="6002172">(</span><span class="keyword" id="6002173">map</span><span class="op" id="6002176">[</span><span class="builtintype" id="6002177">string</span><span class="op" id="6002183">]</span><span class="builtintype" id="6002184">string</span><span class="op" id="6002190">,</span>&nbsp;<span class="builtintype" id="6002192">error</span><span class="op" id="6002197">)</span>&nbsp;<span class="op" id="6002199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6002202">buf</span><span class="op" id="6002205">,</span>&nbsp;<span class="ident" id="6002207">err</span>&nbsp;<span class="op" id="6002211">:=</span>&nbsp;<span class="ident" id="6002214">ioutil</span><span class="op" id="6002220">.</span><span class="ident" id="6002221">ReadAll</span><span class="op" id="6002228">(</span><span class="ident" id="6002229">r</span><span class="op" id="6002230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6002233">if</span>&nbsp;<span class="ident" id="6002236">err</span>&nbsp;<span class="op" id="6002240">!=</span>&nbsp;<span class="builtintype" id="6002243">nil</span>&nbsp;<span class="op" id="6002247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6002251">return</span>&nbsp;<span class="builtintype" id="6002258">nil</span><span class="op" id="6002261">,</span>&nbsp;<span class="ident" id="6002263">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6002268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6002272">//&nbsp;For&nbsp;GNU&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6002315">//&nbsp;This&nbsp;function&nbsp;transforms&nbsp;the&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;headers&nbsp;into&nbsp;sparse&nbsp;format&nbsp;0.1&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6002406">var</span>&nbsp;<span class="ident" id="6002410">sparseMap</span>&nbsp;<span class="ident" id="6002420">bytes</span><span class="op" id="6002425">.</span><span class="ident" id="6002426">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6002435">headers</span>&nbsp;<span class="op" id="6002443">:=</span>&nbsp;<span class="builtinfunc" id="6002446">make</span><span class="op" id="6002450">(</span><span class="keyword" id="6002451">map</span><span class="op" id="6002454">[</span><span class="builtintype" id="6002455">string</span><span class="op" id="6002461">]</span><span class="builtintype" id="6002462">string</span><span class="op" id="6002468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6002471">//&nbsp;Each&nbsp;record&nbsp;is&nbsp;constructed&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6002505">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;%d&nbsp;%s=%s\n&#34;,&nbsp;length,&nbsp;keyword,&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6002550">for</span>&nbsp;<span class="builtinfunc" id="6002554">len</span><span class="op" id="6002557">(</span><span class="ident" id="6002558">buf</span><span class="op" id="6002561">)</span>&nbsp;<span class="op" id="6002563">&gt;</span>&nbsp;<span class="num" id="6002565">0</span>&nbsp;<span class="op" id="6002567">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6002571">//&nbsp;or&nbsp;the&nbsp;header&nbsp;was&nbsp;empty&nbsp;to&nbsp;start&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6002615">var</span>&nbsp;<span class="ident" id="6002619">sp</span>&nbsp;<span class="builtintype" id="6002622">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6002628">//&nbsp;The&nbsp;size&nbsp;field&nbsp;ends&nbsp;at&nbsp;the&nbsp;first&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6002673">sp</span>&nbsp;<span class="op" id="6002676">=</span>&nbsp;<span class="ident" id="6002678">bytes</span><span class="op" id="6002683">.</span><span class="ident" id="6002684">IndexByte</span><span class="op" id="6002693">(</span><span class="ident" id="6002694">buf</span><span class="op" id="6002697">,</span>&nbsp;<span class="string" id="6002699">&#39;&nbsp;&#39;</span><span class="op" id="6002702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6002706">if</span>&nbsp;<span class="ident" id="6002709">sp</span>&nbsp;<span class="op" id="6002712">==</span>&nbsp;<span class="op" id="6002715">-</span><span class="num" id="6002716">1</span>&nbsp;<span class="op" id="6002718">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6002723">return</span>&nbsp;<span class="builtintype" id="6002730">nil</span><span class="op" id="6002733">,</span>&nbsp;<span class="ident" id="6002735">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6002747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6002751">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;token&nbsp;as&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6002800">n</span><span class="op" id="6002801">,</span>&nbsp;<span class="ident" id="6002803">err</span>&nbsp;<span class="op" id="6002807">:=</span>&nbsp;<span class="ident" id="6002810">strconv</span><span class="op" id="6002817">.</span><span class="ident" id="6002818">ParseInt</span><span class="op" id="6002826">(</span><span class="builtintype" id="6002827">string</span><span class="op" id="6002833">(</span><span class="ident" id="6002834">buf</span><span class="op" id="6002837">[</span><span class="op" id="6002838">:</span><span class="ident" id="6002839">sp</span><span class="op" id="6002841">]</span><span class="op" id="6002842">)</span><span class="op" id="6002843">,</span>&nbsp;<span class="num" id="6002845">10</span><span class="op" id="6002847">,</span>&nbsp;<span class="num" id="6002849">0</span><span class="op" id="6002850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6002854">if</span>&nbsp;<span class="ident" id="6002857">err</span>&nbsp;<span class="op" id="6002861">!=</span>&nbsp;<span class="builtintype" id="6002864">nil</span>&nbsp;<span class="op" id="6002868">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6002873">return</span>&nbsp;<span class="builtintype" id="6002880">nil</span><span class="op" id="6002883">,</span>&nbsp;<span class="ident" id="6002885">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6002897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6002901">//&nbsp;Extract&nbsp;everything&nbsp;between&nbsp;the&nbsp;decimal&nbsp;and&nbsp;the&nbsp;n&nbsp;-1&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6002965">//&nbsp;beginning&nbsp;to&nbsp;eat&nbsp;the&nbsp;&#39;&nbsp;&#39;,&nbsp;-1&nbsp;on&nbsp;the&nbsp;end&nbsp;to&nbsp;skip&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6003031">var</span>&nbsp;<span class="ident" id="6003035">record</span>&nbsp;<span class="op" id="6003042">[</span><span class="op" id="6003043">]</span><span class="builtintype" id="6003044">byte</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6003051">record</span><span class="op" id="6003057">,</span>&nbsp;<span class="ident" id="6003059">buf</span>&nbsp;<span class="op" id="6003063">=</span>&nbsp;<span class="ident" id="6003065">buf</span><span class="op" id="6003068">[</span><span class="ident" id="6003069">sp</span><span class="op" id="6003071">+</span><span class="num" id="6003072">1</span><span class="op" id="6003073">:</span><span class="ident" id="6003074">n</span><span class="op" id="6003075">-</span><span class="num" id="6003076">1</span><span class="op" id="6003077">]</span><span class="op" id="6003078">,</span>&nbsp;<span class="ident" id="6003080">buf</span><span class="op" id="6003083">[</span><span class="ident" id="6003084">n</span><span class="op" id="6003085">:</span><span class="op" id="6003086">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6003090">//&nbsp;The&nbsp;first&nbsp;equals&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6003154">//&nbsp;Everything&nbsp;else&nbsp;is&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6003185">eq</span>&nbsp;<span class="op" id="6003188">:=</span>&nbsp;<span class="ident" id="6003191">bytes</span><span class="op" id="6003196">.</span><span class="ident" id="6003197">IndexByte</span><span class="op" id="6003206">(</span><span class="ident" id="6003207">record</span><span class="op" id="6003213">,</span>&nbsp;<span class="string" id="6003215">&#39;=&#39;</span><span class="op" id="6003218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6003222">if</span>&nbsp;<span class="ident" id="6003225">eq</span>&nbsp;<span class="op" id="6003228">==</span>&nbsp;<span class="op" id="6003231">-</span><span class="num" id="6003232">1</span>&nbsp;<span class="op" id="6003234">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6003239">return</span>&nbsp;<span class="builtintype" id="6003246">nil</span><span class="op" id="6003249">,</span>&nbsp;<span class="ident" id="6003251">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6003263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6003267">key</span><span class="op" id="6003270">,</span>&nbsp;<span class="ident" id="6003272">value</span>&nbsp;<span class="op" id="6003278">:=</span>&nbsp;<span class="ident" id="6003281">record</span><span class="op" id="6003287">[</span><span class="op" id="6003288">:</span><span class="ident" id="6003289">eq</span><span class="op" id="6003291">]</span><span class="op" id="6003292">,</span>&nbsp;<span class="ident" id="6003294">record</span><span class="op" id="6003300">[</span><span class="ident" id="6003301">eq</span><span class="op" id="6003303">+</span><span class="num" id="6003304">1</span><span class="op" id="6003305">:</span><span class="op" id="6003306">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6003311">keyStr</span>&nbsp;<span class="op" id="6003318">:=</span>&nbsp;<span class="builtintype" id="6003321">string</span><span class="op" id="6003327">(</span><span class="ident" id="6003328">key</span><span class="op" id="6003331">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6003335">if</span>&nbsp;<span class="ident" id="6003338">keyStr</span>&nbsp;<span class="op" id="6003345">==</span>&nbsp;<span class="ident" id="6003348">paxGNUSparseOffset</span>&nbsp;<span class="op" id="6003367">||</span>&nbsp;<span class="ident" id="6003370">keyStr</span>&nbsp;<span class="op" id="6003377">==</span>&nbsp;<span class="ident" id="6003380">paxGNUSparseNumBytes</span>&nbsp;<span class="op" id="6003401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6003406">//&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;special&nbsp;key.&nbsp;Write&nbsp;to&nbsp;sparseMap&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6003500">sparseMap</span><span class="op" id="6003509">.</span><span class="ident" id="6003510">Write</span><span class="op" id="6003515">(</span><span class="ident" id="6003516">value</span><span class="op" id="6003521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6003526">sparseMap</span><span class="op" id="6003535">.</span><span class="ident" id="6003536">Write</span><span class="op" id="6003541">(</span><span class="op" id="6003542">[</span><span class="op" id="6003543">]</span><span class="builtintype" id="6003544">byte</span><span class="op" id="6003548">{</span><span class="string" id="6003549">&#39;,&#39;</span><span class="op" id="6003552">}</span><span class="op" id="6003553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6003557">}</span>&nbsp;<span class="keyword" id="6003559">else</span>&nbsp;<span class="op" id="6003564">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6003569">//&nbsp;Normal&nbsp;key.&nbsp;Set&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6003621">headers</span><span class="op" id="6003628">[</span><span class="ident" id="6003629">keyStr</span><span class="op" id="6003635">]</span>&nbsp;<span class="op" id="6003637">=</span>&nbsp;<span class="builtintype" id="6003639">string</span><span class="op" id="6003645">(</span><span class="ident" id="6003646">value</span><span class="op" id="6003651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6003655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6003658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6003661">if</span>&nbsp;<span class="ident" id="6003664">sparseMap</span><span class="op" id="6003673">.</span><span class="ident" id="6003674">Len</span><span class="op" id="6003677">(</span><span class="op" id="6003678">)</span>&nbsp;<span class="op" id="6003680">!=</span>&nbsp;<span class="num" id="6003683">0</span>&nbsp;<span class="op" id="6003685">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6003689">//&nbsp;Add&nbsp;sparse&nbsp;info&nbsp;to&nbsp;headers,&nbsp;chopping&nbsp;off&nbsp;the&nbsp;extra&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6003751">sparseMap</span><span class="op" id="6003760">.</span><span class="ident" id="6003761">Truncate</span><span class="op" id="6003769">(</span><span class="ident" id="6003770">sparseMap</span><span class="op" id="6003779">.</span><span class="ident" id="6003780">Len</span><span class="op" id="6003783">(</span><span class="op" id="6003784">)</span>&nbsp;<span class="op" id="6003786">-</span>&nbsp;<span class="num" id="6003788">1</span><span class="op" id="6003789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6003793">headers</span><span class="op" id="6003800">[</span><span class="ident" id="6003801">paxGNUSparseMap</span><span class="op" id="6003816">]</span>&nbsp;<span class="op" id="6003818">=</span>&nbsp;<span class="ident" id="6003820">sparseMap</span><span class="op" id="6003829">.</span><span class="ident" id="6003830">String</span><span class="op" id="6003836">(</span><span class="op" id="6003837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6003840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6003843">return</span>&nbsp;<span class="ident" id="6003850">headers</span><span class="op" id="6003857">,</span>&nbsp;<span class="builtintype" id="6003859">nil</span><br>
<span class="lineno">365</span><span class="op" id="6003863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6003866">//&nbsp;cString&nbsp;parses&nbsp;bytes&nbsp;as&nbsp;a&nbsp;NUL-terminated&nbsp;C-style&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="6003926">//&nbsp;If&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;is&nbsp;not&nbsp;found&nbsp;then&nbsp;the&nbsp;whole&nbsp;slice&nbsp;is&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="6004002">func</span>&nbsp;<span class="ident" id="6004007">cString</span><span class="op" id="6004014">(</span><span class="ident" id="6004015">b</span>&nbsp;<span class="op" id="6004017">[</span><span class="op" id="6004018">]</span><span class="builtintype" id="6004019">byte</span><span class="op" id="6004023">)</span>&nbsp;<span class="builtintype" id="6004025">string</span>&nbsp;<span class="op" id="6004032">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6004035">n</span>&nbsp;<span class="op" id="6004037">:=</span>&nbsp;<span class="num" id="6004040">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6004043">for</span>&nbsp;<span class="ident" id="6004047">n</span>&nbsp;<span class="op" id="6004049">&lt;</span>&nbsp;<span class="builtinfunc" id="6004051">len</span><span class="op" id="6004054">(</span><span class="ident" id="6004055">b</span><span class="op" id="6004056">)</span>&nbsp;<span class="op" id="6004058">&amp;&amp;</span>&nbsp;<span class="ident" id="6004061">b</span><span class="op" id="6004062">[</span><span class="ident" id="6004063">n</span><span class="op" id="6004064">]</span>&nbsp;<span class="op" id="6004066">!=</span>&nbsp;<span class="num" id="6004069">0</span>&nbsp;<span class="op" id="6004071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6004075">n</span><span class="op" id="6004076">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6004080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6004083">return</span>&nbsp;<span class="builtintype" id="6004090">string</span><span class="op" id="6004096">(</span><span class="ident" id="6004097">b</span><span class="op" id="6004098">[</span><span class="num" id="6004099">0</span><span class="op" id="6004100">:</span><span class="ident" id="6004101">n</span><span class="op" id="6004102">]</span><span class="op" id="6004103">)</span><br>
<span class="lineno">375</span><span class="op" id="6004105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6004108">func</span>&nbsp;<span class="op" id="6004113">(</span><span class="ident" id="6004114">tr</span>&nbsp;<span class="op" id="6004117">*</span><span class="ident" id="6004118">Reader</span><span class="op" id="6004124">)</span>&nbsp;<span class="ident" id="6004126">octal</span><span class="op" id="6004131">(</span><span class="ident" id="6004132">b</span>&nbsp;<span class="op" id="6004134">[</span><span class="op" id="6004135">]</span><span class="builtintype" id="6004136">byte</span><span class="op" id="6004140">)</span>&nbsp;<span class="ident" id="6004142">int64</span>&nbsp;<span class="op" id="6004148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6004151">//&nbsp;Check&nbsp;for&nbsp;binary&nbsp;format&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6004186">if</span>&nbsp;<span class="builtinfunc" id="6004189">len</span><span class="op" id="6004192">(</span><span class="ident" id="6004193">b</span><span class="op" id="6004194">)</span>&nbsp;<span class="op" id="6004196">&gt;</span>&nbsp;<span class="num" id="6004198">0</span>&nbsp;<span class="op" id="6004200">&amp;&amp;</span>&nbsp;<span class="ident" id="6004203">b</span><span class="op" id="6004204">[</span><span class="num" id="6004205">0</span><span class="op" id="6004206">]</span><span class="op" id="6004207">&amp;</span><span class="num" id="6004208">0x80</span>&nbsp;<span class="op" id="6004213">!=</span>&nbsp;<span class="num" id="6004216">0</span>&nbsp;<span class="op" id="6004218">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6004222">var</span>&nbsp;<span class="ident" id="6004226">x</span>&nbsp;<span class="ident" id="6004228">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6004236">for</span>&nbsp;<span class="ident" id="6004240">i</span><span class="op" id="6004241">,</span>&nbsp;<span class="ident" id="6004243">c</span>&nbsp;<span class="op" id="6004245">:=</span>&nbsp;<span class="keyword" id="6004248">range</span>&nbsp;<span class="ident" id="6004254">b</span>&nbsp;<span class="op" id="6004256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6004261">if</span>&nbsp;<span class="ident" id="6004264">i</span>&nbsp;<span class="op" id="6004266">==</span>&nbsp;<span class="num" id="6004269">0</span>&nbsp;<span class="op" id="6004271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6004277">c</span>&nbsp;<span class="op" id="6004279">&amp;=</span>&nbsp;<span class="num" id="6004282">0x7f</span>&nbsp;<span class="comment" id="6004287">//&nbsp;ignore&nbsp;signal&nbsp;bit&nbsp;in&nbsp;first&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6004325">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6004330">x</span>&nbsp;<span class="op" id="6004332">=</span>&nbsp;<span class="ident" id="6004334">x</span><span class="op" id="6004335">&lt;&lt;</span><span class="num" id="6004337">8</span>&nbsp;<span class="op" id="6004339">|</span>&nbsp;<span class="ident" id="6004341">int64</span><span class="op" id="6004346">(</span><span class="ident" id="6004347">c</span><span class="op" id="6004348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6004352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6004356">return</span>&nbsp;<span class="ident" id="6004363">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6004366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6004370">//&nbsp;Because&nbsp;unused&nbsp;fields&nbsp;are&nbsp;filled&nbsp;with&nbsp;NULs,&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6004426">//&nbsp;to&nbsp;skip&nbsp;leading&nbsp;NULs.&nbsp;Fields&nbsp;may&nbsp;also&nbsp;be&nbsp;padded&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6004483">//&nbsp;spaces&nbsp;or&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6004503">//&nbsp;So&nbsp;we&nbsp;remove&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;NULs&nbsp;and&nbsp;spaces&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6004560">//&nbsp;be&nbsp;sure.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6004573">b</span>&nbsp;<span class="op" id="6004575">=</span>&nbsp;<span class="ident" id="6004577">bytes</span><span class="op" id="6004582">.</span><span class="ident" id="6004583">Trim</span><span class="op" id="6004587">(</span><span class="ident" id="6004588">b</span><span class="op" id="6004589">,</span>&nbsp;<span class="string" id="6004591">&#34;&nbsp;\x00&#34;</span><span class="op" id="6004598">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6004602">if</span>&nbsp;<span class="builtinfunc" id="6004605">len</span><span class="op" id="6004608">(</span><span class="ident" id="6004609">b</span><span class="op" id="6004610">)</span>&nbsp;<span class="op" id="6004612">==</span>&nbsp;<span class="num" id="6004615">0</span>&nbsp;<span class="op" id="6004617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6004621">return</span>&nbsp;<span class="num" id="6004628">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6004631">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6004634">x</span><span class="op" id="6004635">,</span>&nbsp;<span class="ident" id="6004637">err</span>&nbsp;<span class="op" id="6004641">:=</span>&nbsp;<span class="ident" id="6004644">strconv</span><span class="op" id="6004651">.</span><span class="ident" id="6004652">ParseUint</span><span class="op" id="6004661">(</span><span class="ident" id="6004662">cString</span><span class="op" id="6004669">(</span><span class="ident" id="6004670">b</span><span class="op" id="6004671">)</span><span class="op" id="6004672">,</span>&nbsp;<span class="num" id="6004674">8</span><span class="op" id="6004675">,</span>&nbsp;<span class="num" id="6004677">64</span><span class="op" id="6004679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6004682">if</span>&nbsp;<span class="ident" id="6004685">err</span>&nbsp;<span class="op" id="6004689">!=</span>&nbsp;<span class="builtintype" id="6004692">nil</span>&nbsp;<span class="op" id="6004696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6004700">tr</span><span class="op" id="6004702">.</span><span class="ident" id="6004703">err</span>&nbsp;<span class="op" id="6004707">=</span>&nbsp;<span class="ident" id="6004709">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6004714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6004717">return</span>&nbsp;<span class="ident" id="6004724">int64</span><span class="op" id="6004729">(</span><span class="ident" id="6004730">x</span><span class="op" id="6004731">)</span><br>
<span class="lineno">405</span><span class="op" id="6004733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6004736">//&nbsp;skipUnread&nbsp;skips&nbsp;any&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;the&nbsp;existing&nbsp;file&nbsp;entry,&nbsp;as&nbsp;well&nbsp;as&nbsp;any&nbsp;alignment&nbsp;padding.</span><br>
<span class="lineno"></span><span class="keyword" id="6004835">func</span>&nbsp;<span class="op" id="6004840">(</span><span class="ident" id="6004841">tr</span>&nbsp;<span class="op" id="6004844">*</span><span class="ident" id="6004845">Reader</span><span class="op" id="6004851">)</span>&nbsp;<span class="ident" id="6004853">skipUnread</span><span class="op" id="6004863">(</span><span class="op" id="6004864">)</span>&nbsp;<span class="op" id="6004866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6004869">nr</span>&nbsp;<span class="op" id="6004872">:=</span>&nbsp;<span class="ident" id="6004875">tr</span><span class="op" id="6004877">.</span><span class="ident" id="6004878">numBytes</span><span class="op" id="6004886">(</span><span class="op" id="6004887">)</span>&nbsp;<span class="op" id="6004889">+</span>&nbsp;<span class="ident" id="6004891">tr</span><span class="op" id="6004893">.</span><span class="ident" id="6004894">pad</span>&nbsp;<span class="comment" id="6004898">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;skip</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6004926">tr</span><span class="op" id="6004928">.</span><span class="ident" id="6004929">curr</span><span class="op" id="6004933">,</span>&nbsp;<span class="ident" id="6004935">tr</span><span class="op" id="6004937">.</span><span class="ident" id="6004938">pad</span>&nbsp;<span class="op" id="6004942">=</span>&nbsp;<span class="builtintype" id="6004944">nil</span><span class="op" id="6004947">,</span>&nbsp;<span class="num" id="6004949">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6004952">if</span>&nbsp;<span class="ident" id="6004955">sr</span><span class="op" id="6004957">,</span>&nbsp;<span class="ident" id="6004959">ok</span>&nbsp;<span class="op" id="6004962">:=</span>&nbsp;<span class="ident" id="6004965">tr</span><span class="op" id="6004967">.</span><span class="ident" id="6004968">r</span><span class="op" id="6004969">.</span><span class="op" id="6004970">(</span><span class="ident" id="6004971">io</span><span class="op" id="6004973">.</span><span class="ident" id="6004974">Seeker</span><span class="op" id="6004980">)</span><span class="op" id="6004981">;</span>&nbsp;<span class="ident" id="6004983">ok</span>&nbsp;<span class="op" id="6004986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6004990">if</span>&nbsp;<span class="ident" id="6004993">_</span><span class="op" id="6004994">,</span>&nbsp;<span class="ident" id="6004996">err</span>&nbsp;<span class="op" id="6005000">:=</span>&nbsp;<span class="ident" id="6005003">sr</span><span class="op" id="6005005">.</span><span class="ident" id="6005006">Seek</span><span class="op" id="6005010">(</span><span class="ident" id="6005011">nr</span><span class="op" id="6005013">,</span>&nbsp;<span class="ident" id="6005015">os</span><span class="op" id="6005017">.</span><span class="ident" id="6005018">SEEK_CUR</span><span class="op" id="6005026">)</span><span class="op" id="6005027">;</span>&nbsp;<span class="ident" id="6005029">err</span>&nbsp;<span class="op" id="6005033">==</span>&nbsp;<span class="builtintype" id="6005036">nil</span>&nbsp;<span class="op" id="6005040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6005045">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005054">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005060">_</span><span class="op" id="6005061">,</span>&nbsp;<span class="ident" id="6005063">tr</span><span class="op" id="6005065">.</span><span class="ident" id="6005066">err</span>&nbsp;<span class="op" id="6005070">=</span>&nbsp;<span class="ident" id="6005072">io</span><span class="op" id="6005074">.</span><span class="ident" id="6005075">CopyN</span><span class="op" id="6005080">(</span><span class="ident" id="6005081">ioutil</span><span class="op" id="6005087">.</span><span class="ident" id="6005088">Discard</span><span class="op" id="6005095">,</span>&nbsp;<span class="ident" id="6005097">tr</span><span class="op" id="6005099">.</span><span class="ident" id="6005100">r</span><span class="op" id="6005101">,</span>&nbsp;<span class="ident" id="6005103">nr</span><span class="op" id="6005105">)</span><br>
<span class="lineno"></span><span class="op" id="6005107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6005110">func</span>&nbsp;<span class="op" id="6005115">(</span><span class="ident" id="6005116">tr</span>&nbsp;<span class="op" id="6005119">*</span><span class="ident" id="6005120">Reader</span><span class="op" id="6005126">)</span>&nbsp;<span class="ident" id="6005128">verifyChecksum</span><span class="op" id="6005142">(</span><span class="ident" id="6005143">header</span>&nbsp;<span class="op" id="6005150">[</span><span class="op" id="6005151">]</span><span class="builtintype" id="6005152">byte</span><span class="op" id="6005156">)</span>&nbsp;<span class="builtintype" id="6005158">bool</span>&nbsp;<span class="op" id="6005163">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6005166">if</span>&nbsp;<span class="ident" id="6005169">tr</span><span class="op" id="6005171">.</span><span class="ident" id="6005172">err</span>&nbsp;<span class="op" id="6005176">!=</span>&nbsp;<span class="builtintype" id="6005179">nil</span>&nbsp;<span class="op" id="6005183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6005187">return</span>&nbsp;<span class="builtintype" id="6005194">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005205">given</span>&nbsp;<span class="op" id="6005211">:=</span>&nbsp;<span class="ident" id="6005214">tr</span><span class="op" id="6005216">.</span><span class="ident" id="6005217">octal</span><span class="op" id="6005222">(</span><span class="ident" id="6005223">header</span><span class="op" id="6005229">[</span><span class="num" id="6005230">148</span><span class="op" id="6005233">:</span><span class="num" id="6005234">156</span><span class="op" id="6005237">]</span><span class="op" id="6005238">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005241">unsigned</span><span class="op" id="6005249">,</span>&nbsp;<span class="ident" id="6005251">signed</span>&nbsp;<span class="op" id="6005258">:=</span>&nbsp;<span class="ident" id="6005261">checksum</span><span class="op" id="6005269">(</span><span class="ident" id="6005270">header</span><span class="op" id="6005276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6005279">return</span>&nbsp;<span class="ident" id="6005286">given</span>&nbsp;<span class="op" id="6005292">==</span>&nbsp;<span class="ident" id="6005295">unsigned</span>&nbsp;<span class="op" id="6005304">||</span>&nbsp;<span class="ident" id="6005307">given</span>&nbsp;<span class="op" id="6005313">==</span>&nbsp;<span class="ident" id="6005316">signed</span><br>
<span class="lineno"></span><span class="op" id="6005323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6005326">func</span>&nbsp;<span class="op" id="6005331">(</span><span class="ident" id="6005332">tr</span>&nbsp;<span class="op" id="6005335">*</span><span class="ident" id="6005336">Reader</span><span class="op" id="6005342">)</span>&nbsp;<span class="ident" id="6005344">readHeader</span><span class="op" id="6005354">(</span><span class="op" id="6005355">)</span>&nbsp;<span class="op" id="6005357">*</span><span class="ident" id="6005358">Header</span>&nbsp;<span class="op" id="6005365">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005368">header</span>&nbsp;<span class="op" id="6005375">:=</span>&nbsp;<span class="ident" id="6005378">tr</span><span class="op" id="6005380">.</span><span class="ident" id="6005381">hdrBuff</span><span class="op" id="6005388">[</span><span class="op" id="6005389">:</span><span class="op" id="6005390">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6005393">copy</span><span class="op" id="6005397">(</span><span class="ident" id="6005398">header</span><span class="op" id="6005404">,</span>&nbsp;<span class="ident" id="6005406">zeroBlock</span><span class="op" id="6005415">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6005419">if</span>&nbsp;<span class="ident" id="6005422">_</span><span class="op" id="6005423">,</span>&nbsp;<span class="ident" id="6005425">tr</span><span class="op" id="6005427">.</span><span class="ident" id="6005428">err</span>&nbsp;<span class="op" id="6005432">=</span>&nbsp;<span class="ident" id="6005434">io</span><span class="op" id="6005436">.</span><span class="ident" id="6005437">ReadFull</span><span class="op" id="6005445">(</span><span class="ident" id="6005446">tr</span><span class="op" id="6005448">.</span><span class="ident" id="6005449">r</span><span class="op" id="6005450">,</span>&nbsp;<span class="ident" id="6005452">header</span><span class="op" id="6005458">)</span><span class="op" id="6005459">;</span>&nbsp;<span class="ident" id="6005461">tr</span><span class="op" id="6005463">.</span><span class="ident" id="6005464">err</span>&nbsp;<span class="op" id="6005468">!=</span>&nbsp;<span class="builtintype" id="6005471">nil</span>&nbsp;<span class="op" id="6005475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6005479">return</span>&nbsp;<span class="builtintype" id="6005486">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6005495">//&nbsp;Two&nbsp;blocks&nbsp;of&nbsp;zero&nbsp;bytes&nbsp;marks&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6005554">if</span>&nbsp;<span class="ident" id="6005557">bytes</span><span class="op" id="6005562">.</span><span class="ident" id="6005563">Equal</span><span class="op" id="6005568">(</span><span class="ident" id="6005569">header</span><span class="op" id="6005575">,</span>&nbsp;<span class="ident" id="6005577">zeroBlock</span><span class="op" id="6005586">[</span><span class="num" id="6005587">0</span><span class="op" id="6005588">:</span><span class="ident" id="6005589">blockSize</span><span class="op" id="6005598">]</span><span class="op" id="6005599">)</span>&nbsp;<span class="op" id="6005601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6005605">if</span>&nbsp;<span class="ident" id="6005608">_</span><span class="op" id="6005609">,</span>&nbsp;<span class="ident" id="6005611">tr</span><span class="op" id="6005613">.</span><span class="ident" id="6005614">err</span>&nbsp;<span class="op" id="6005618">=</span>&nbsp;<span class="ident" id="6005620">io</span><span class="op" id="6005622">.</span><span class="ident" id="6005623">ReadFull</span><span class="op" id="6005631">(</span><span class="ident" id="6005632">tr</span><span class="op" id="6005634">.</span><span class="ident" id="6005635">r</span><span class="op" id="6005636">,</span>&nbsp;<span class="ident" id="6005638">header</span><span class="op" id="6005644">)</span><span class="op" id="6005645">;</span>&nbsp;<span class="ident" id="6005647">tr</span><span class="op" id="6005649">.</span><span class="ident" id="6005650">err</span>&nbsp;<span class="op" id="6005654">!=</span>&nbsp;<span class="builtintype" id="6005657">nil</span>&nbsp;<span class="op" id="6005661">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6005666">return</span>&nbsp;<span class="builtintype" id="6005673">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6005683">if</span>&nbsp;<span class="ident" id="6005686">bytes</span><span class="op" id="6005691">.</span><span class="ident" id="6005692">Equal</span><span class="op" id="6005697">(</span><span class="ident" id="6005698">header</span><span class="op" id="6005704">,</span>&nbsp;<span class="ident" id="6005706">zeroBlock</span><span class="op" id="6005715">[</span><span class="num" id="6005716">0</span><span class="op" id="6005717">:</span><span class="ident" id="6005718">blockSize</span><span class="op" id="6005727">]</span><span class="op" id="6005728">)</span>&nbsp;<span class="op" id="6005730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005735">tr</span><span class="op" id="6005737">.</span><span class="ident" id="6005738">err</span>&nbsp;<span class="op" id="6005742">=</span>&nbsp;<span class="ident" id="6005744">io</span><span class="op" id="6005746">.</span><span class="ident" id="6005747">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005753">}</span>&nbsp;<span class="keyword" id="6005755">else</span>&nbsp;<span class="op" id="6005760">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005765">tr</span><span class="op" id="6005767">.</span><span class="ident" id="6005768">err</span>&nbsp;<span class="op" id="6005772">=</span>&nbsp;<span class="ident" id="6005774">ErrHeader</span>&nbsp;<span class="comment" id="6005784">//&nbsp;zero&nbsp;block&nbsp;and&nbsp;then&nbsp;non-zero&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6005828">return</span>&nbsp;<span class="builtintype" id="6005835">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6005844">if</span>&nbsp;<span class="op" id="6005847">!</span><span class="ident" id="6005848">tr</span><span class="op" id="6005850">.</span><span class="ident" id="6005851">verifyChecksum</span><span class="op" id="6005865">(</span><span class="ident" id="6005866">header</span><span class="op" id="6005872">)</span>&nbsp;<span class="op" id="6005874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005878">tr</span><span class="op" id="6005880">.</span><span class="ident" id="6005881">err</span>&nbsp;<span class="op" id="6005885">=</span>&nbsp;<span class="ident" id="6005887">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6005899">return</span>&nbsp;<span class="builtintype" id="6005906">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6005915">//&nbsp;Unpack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005926">hdr</span>&nbsp;<span class="op" id="6005930">:=</span>&nbsp;<span class="builtinfunc" id="6005933">new</span><span class="op" id="6005936">(</span><span class="ident" id="6005937">Header</span><span class="op" id="6005943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005946">s</span>&nbsp;<span class="op" id="6005948">:=</span>&nbsp;<span class="ident" id="6005951">slicer</span><span class="op" id="6005957">(</span><span class="ident" id="6005958">header</span><span class="op" id="6005964">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005968">hdr</span><span class="op" id="6005971">.</span><span class="ident" id="6005972">Name</span>&nbsp;<span class="op" id="6005977">=</span>&nbsp;<span class="ident" id="6005979">cString</span><span class="op" id="6005986">(</span><span class="ident" id="6005987">s</span><span class="op" id="6005988">.</span><span class="ident" id="6005989">next</span><span class="op" id="6005993">(</span><span class="num" id="6005994">100</span><span class="op" id="6005997">)</span><span class="op" id="6005998">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006001">hdr</span><span class="op" id="6006004">.</span><span class="ident" id="6006005">Mode</span>&nbsp;<span class="op" id="6006010">=</span>&nbsp;<span class="ident" id="6006012">tr</span><span class="op" id="6006014">.</span><span class="ident" id="6006015">octal</span><span class="op" id="6006020">(</span><span class="ident" id="6006021">s</span><span class="op" id="6006022">.</span><span class="ident" id="6006023">next</span><span class="op" id="6006027">(</span><span class="num" id="6006028">8</span><span class="op" id="6006029">)</span><span class="op" id="6006030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006033">hdr</span><span class="op" id="6006036">.</span><span class="ident" id="6006037">Uid</span>&nbsp;<span class="op" id="6006041">=</span>&nbsp;<span class="builtintype" id="6006043">int</span><span class="op" id="6006046">(</span><span class="ident" id="6006047">tr</span><span class="op" id="6006049">.</span><span class="ident" id="6006050">octal</span><span class="op" id="6006055">(</span><span class="ident" id="6006056">s</span><span class="op" id="6006057">.</span><span class="ident" id="6006058">next</span><span class="op" id="6006062">(</span><span class="num" id="6006063">8</span><span class="op" id="6006064">)</span><span class="op" id="6006065">)</span><span class="op" id="6006066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006069">hdr</span><span class="op" id="6006072">.</span><span class="ident" id="6006073">Gid</span>&nbsp;<span class="op" id="6006077">=</span>&nbsp;<span class="builtintype" id="6006079">int</span><span class="op" id="6006082">(</span><span class="ident" id="6006083">tr</span><span class="op" id="6006085">.</span><span class="ident" id="6006086">octal</span><span class="op" id="6006091">(</span><span class="ident" id="6006092">s</span><span class="op" id="6006093">.</span><span class="ident" id="6006094">next</span><span class="op" id="6006098">(</span><span class="num" id="6006099">8</span><span class="op" id="6006100">)</span><span class="op" id="6006101">)</span><span class="op" id="6006102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006105">hdr</span><span class="op" id="6006108">.</span><span class="ident" id="6006109">Size</span>&nbsp;<span class="op" id="6006114">=</span>&nbsp;<span class="ident" id="6006116">tr</span><span class="op" id="6006118">.</span><span class="ident" id="6006119">octal</span><span class="op" id="6006124">(</span><span class="ident" id="6006125">s</span><span class="op" id="6006126">.</span><span class="ident" id="6006127">next</span><span class="op" id="6006131">(</span><span class="num" id="6006132">12</span><span class="op" id="6006134">)</span><span class="op" id="6006135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006138">hdr</span><span class="op" id="6006141">.</span><span class="ident" id="6006142">ModTime</span>&nbsp;<span class="op" id="6006150">=</span>&nbsp;<span class="ident" id="6006152">time</span><span class="op" id="6006156">.</span><span class="ident" id="6006157">Unix</span><span class="op" id="6006161">(</span><span class="ident" id="6006162">tr</span><span class="op" id="6006164">.</span><span class="ident" id="6006165">octal</span><span class="op" id="6006170">(</span><span class="ident" id="6006171">s</span><span class="op" id="6006172">.</span><span class="ident" id="6006173">next</span><span class="op" id="6006177">(</span><span class="num" id="6006178">12</span><span class="op" id="6006180">)</span><span class="op" id="6006181">)</span><span class="op" id="6006182">,</span>&nbsp;<span class="num" id="6006184">0</span><span class="op" id="6006185">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006188">s</span><span class="op" id="6006189">.</span><span class="ident" id="6006190">next</span><span class="op" id="6006194">(</span><span class="num" id="6006195">8</span><span class="op" id="6006196">)</span>&nbsp;<span class="comment" id="6006198">//&nbsp;chksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006209">hdr</span><span class="op" id="6006212">.</span><span class="ident" id="6006213">Typeflag</span>&nbsp;<span class="op" id="6006222">=</span>&nbsp;<span class="ident" id="6006224">s</span><span class="op" id="6006225">.</span><span class="ident" id="6006226">next</span><span class="op" id="6006230">(</span><span class="num" id="6006231">1</span><span class="op" id="6006232">)</span><span class="op" id="6006233">[</span><span class="num" id="6006234">0</span><span class="op" id="6006235">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006238">hdr</span><span class="op" id="6006241">.</span><span class="ident" id="6006242">Linkname</span>&nbsp;<span class="op" id="6006251">=</span>&nbsp;<span class="ident" id="6006253">cString</span><span class="op" id="6006260">(</span><span class="ident" id="6006261">s</span><span class="op" id="6006262">.</span><span class="ident" id="6006263">next</span><span class="op" id="6006267">(</span><span class="num" id="6006268">100</span><span class="op" id="6006271">)</span><span class="op" id="6006272">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6006276">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;header&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;magic.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6006339">//&nbsp;The&nbsp;original&nbsp;(v7)&nbsp;version&nbsp;of&nbsp;tar&nbsp;had&nbsp;no&nbsp;explicit&nbsp;magic&nbsp;field,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6006405">//&nbsp;so&nbsp;its&nbsp;magic&nbsp;bytes,&nbsp;like&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;block,&nbsp;are&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006467">magic</span>&nbsp;<span class="op" id="6006473">:=</span>&nbsp;<span class="builtintype" id="6006476">string</span><span class="op" id="6006482">(</span><span class="ident" id="6006483">s</span><span class="op" id="6006484">.</span><span class="ident" id="6006485">next</span><span class="op" id="6006489">(</span><span class="num" id="6006490">8</span><span class="op" id="6006491">)</span><span class="op" id="6006492">)</span>&nbsp;<span class="comment" id="6006494">//&nbsp;contains&nbsp;version&nbsp;field&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6006530">var</span>&nbsp;<span class="ident" id="6006534">format</span>&nbsp;<span class="builtintype" id="6006541">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6006549">switch</span>&nbsp;<span class="op" id="6006556">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6006559">case</span>&nbsp;<span class="ident" id="6006564">magic</span><span class="op" id="6006569">[</span><span class="op" id="6006570">:</span><span class="num" id="6006571">6</span><span class="op" id="6006572">]</span>&nbsp;<span class="op" id="6006574">==</span>&nbsp;<span class="string" id="6006577">&#34;ustar\x00&#34;</span><span class="op" id="6006588">:</span>&nbsp;<span class="comment" id="6006590">//&nbsp;POSIX&nbsp;tar&nbsp;(1003.1-1988)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6006619">if</span>&nbsp;<span class="builtintype" id="6006622">string</span><span class="op" id="6006628">(</span><span class="ident" id="6006629">header</span><span class="op" id="6006635">[</span><span class="num" id="6006636">508</span><span class="op" id="6006639">:</span><span class="num" id="6006640">512</span><span class="op" id="6006643">]</span><span class="op" id="6006644">)</span>&nbsp;<span class="op" id="6006646">==</span>&nbsp;<span class="string" id="6006649">&#34;tar\x00&#34;</span>&nbsp;<span class="op" id="6006659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006664">format</span>&nbsp;<span class="op" id="6006671">=</span>&nbsp;<span class="string" id="6006673">&#34;star&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6006682">}</span>&nbsp;<span class="keyword" id="6006684">else</span>&nbsp;<span class="op" id="6006689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006694">format</span>&nbsp;<span class="op" id="6006701">=</span>&nbsp;<span class="string" id="6006703">&#34;posix&#34;</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6006713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6006716">case</span>&nbsp;<span class="ident" id="6006721">magic</span>&nbsp;<span class="op" id="6006727">==</span>&nbsp;<span class="string" id="6006730">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="6006743">:</span>&nbsp;<span class="comment" id="6006745">//&nbsp;old&nbsp;GNU&nbsp;tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006762">format</span>&nbsp;<span class="op" id="6006769">=</span>&nbsp;<span class="string" id="6006771">&#34;gnu&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6006778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6006782">switch</span>&nbsp;<span class="ident" id="6006789">format</span>&nbsp;<span class="op" id="6006796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6006799">case</span>&nbsp;<span class="string" id="6006804">&#34;posix&#34;</span><span class="op" id="6006811">,</span>&nbsp;<span class="string" id="6006813">&#34;gnu&#34;</span><span class="op" id="6006818">,</span>&nbsp;<span class="string" id="6006820">&#34;star&#34;</span><span class="op" id="6006826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006830">hdr</span><span class="op" id="6006833">.</span><span class="ident" id="6006834">Uname</span>&nbsp;<span class="op" id="6006840">=</span>&nbsp;<span class="ident" id="6006842">cString</span><span class="op" id="6006849">(</span><span class="ident" id="6006850">s</span><span class="op" id="6006851">.</span><span class="ident" id="6006852">next</span><span class="op" id="6006856">(</span><span class="num" id="6006857">32</span><span class="op" id="6006859">)</span><span class="op" id="6006860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006864">hdr</span><span class="op" id="6006867">.</span><span class="ident" id="6006868">Gname</span>&nbsp;<span class="op" id="6006874">=</span>&nbsp;<span class="ident" id="6006876">cString</span><span class="op" id="6006883">(</span><span class="ident" id="6006884">s</span><span class="op" id="6006885">.</span><span class="ident" id="6006886">next</span><span class="op" id="6006890">(</span><span class="num" id="6006891">32</span><span class="op" id="6006893">)</span><span class="op" id="6006894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006898">devmajor</span>&nbsp;<span class="op" id="6006907">:=</span>&nbsp;<span class="ident" id="6006910">s</span><span class="op" id="6006911">.</span><span class="ident" id="6006912">next</span><span class="op" id="6006916">(</span><span class="num" id="6006917">8</span><span class="op" id="6006918">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006922">devminor</span>&nbsp;<span class="op" id="6006931">:=</span>&nbsp;<span class="ident" id="6006934">s</span><span class="op" id="6006935">.</span><span class="ident" id="6006936">next</span><span class="op" id="6006940">(</span><span class="num" id="6006941">8</span><span class="op" id="6006942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6006946">if</span>&nbsp;<span class="ident" id="6006949">hdr</span><span class="op" id="6006952">.</span><span class="ident" id="6006953">Typeflag</span>&nbsp;<span class="op" id="6006962">==</span>&nbsp;<span class="ident" id="6006965">TypeChar</span>&nbsp;<span class="op" id="6006974">||</span>&nbsp;<span class="ident" id="6006977">hdr</span><span class="op" id="6006980">.</span><span class="ident" id="6006981">Typeflag</span>&nbsp;<span class="op" id="6006990">==</span>&nbsp;<span class="ident" id="6006993">TypeBlock</span>&nbsp;<span class="op" id="6007003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007008">hdr</span><span class="op" id="6007011">.</span><span class="ident" id="6007012">Devmajor</span>&nbsp;<span class="op" id="6007021">=</span>&nbsp;<span class="ident" id="6007023">tr</span><span class="op" id="6007025">.</span><span class="ident" id="6007026">octal</span><span class="op" id="6007031">(</span><span class="ident" id="6007032">devmajor</span><span class="op" id="6007040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007045">hdr</span><span class="op" id="6007048">.</span><span class="ident" id="6007049">Devminor</span>&nbsp;<span class="op" id="6007058">=</span>&nbsp;<span class="ident" id="6007060">tr</span><span class="op" id="6007062">.</span><span class="ident" id="6007063">octal</span><span class="op" id="6007068">(</span><span class="ident" id="6007069">devminor</span><span class="op" id="6007077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6007081">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6007085">var</span>&nbsp;<span class="ident" id="6007089">prefix</span>&nbsp;<span class="builtintype" id="6007096">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6007105">switch</span>&nbsp;<span class="ident" id="6007112">format</span>&nbsp;<span class="op" id="6007119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6007123">case</span>&nbsp;<span class="string" id="6007128">&#34;posix&#34;</span><span class="op" id="6007135">,</span>&nbsp;<span class="string" id="6007137">&#34;gnu&#34;</span><span class="op" id="6007142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007147">prefix</span>&nbsp;<span class="op" id="6007154">=</span>&nbsp;<span class="ident" id="6007156">cString</span><span class="op" id="6007163">(</span><span class="ident" id="6007164">s</span><span class="op" id="6007165">.</span><span class="ident" id="6007166">next</span><span class="op" id="6007170">(</span><span class="num" id="6007171">155</span><span class="op" id="6007174">)</span><span class="op" id="6007175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6007179">case</span>&nbsp;<span class="string" id="6007184">&#34;star&#34;</span><span class="op" id="6007190">:</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007195">prefix</span>&nbsp;<span class="op" id="6007202">=</span>&nbsp;<span class="ident" id="6007204">cString</span><span class="op" id="6007211">(</span><span class="ident" id="6007212">s</span><span class="op" id="6007213">.</span><span class="ident" id="6007214">next</span><span class="op" id="6007218">(</span><span class="num" id="6007219">131</span><span class="op" id="6007222">)</span><span class="op" id="6007223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007228">hdr</span><span class="op" id="6007231">.</span><span class="ident" id="6007232">AccessTime</span>&nbsp;<span class="op" id="6007243">=</span>&nbsp;<span class="ident" id="6007245">time</span><span class="op" id="6007249">.</span><span class="ident" id="6007250">Unix</span><span class="op" id="6007254">(</span><span class="ident" id="6007255">tr</span><span class="op" id="6007257">.</span><span class="ident" id="6007258">octal</span><span class="op" id="6007263">(</span><span class="ident" id="6007264">s</span><span class="op" id="6007265">.</span><span class="ident" id="6007266">next</span><span class="op" id="6007270">(</span><span class="num" id="6007271">12</span><span class="op" id="6007273">)</span><span class="op" id="6007274">)</span><span class="op" id="6007275">,</span>&nbsp;<span class="num" id="6007277">0</span><span class="op" id="6007278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007283">hdr</span><span class="op" id="6007286">.</span><span class="ident" id="6007287">ChangeTime</span>&nbsp;<span class="op" id="6007298">=</span>&nbsp;<span class="ident" id="6007300">time</span><span class="op" id="6007304">.</span><span class="ident" id="6007305">Unix</span><span class="op" id="6007309">(</span><span class="ident" id="6007310">tr</span><span class="op" id="6007312">.</span><span class="ident" id="6007313">octal</span><span class="op" id="6007318">(</span><span class="ident" id="6007319">s</span><span class="op" id="6007320">.</span><span class="ident" id="6007321">next</span><span class="op" id="6007325">(</span><span class="num" id="6007326">12</span><span class="op" id="6007328">)</span><span class="op" id="6007329">)</span><span class="op" id="6007330">,</span>&nbsp;<span class="num" id="6007332">0</span><span class="op" id="6007333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6007337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6007341">if</span>&nbsp;<span class="builtinfunc" id="6007344">len</span><span class="op" id="6007347">(</span><span class="ident" id="6007348">prefix</span><span class="op" id="6007354">)</span>&nbsp;<span class="op" id="6007356">&gt;</span>&nbsp;<span class="num" id="6007358">0</span>&nbsp;<span class="op" id="6007360">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007365">hdr</span><span class="op" id="6007368">.</span><span class="ident" id="6007369">Name</span>&nbsp;<span class="op" id="6007374">=</span>&nbsp;<span class="ident" id="6007376">prefix</span>&nbsp;<span class="op" id="6007383">+</span>&nbsp;<span class="string" id="6007385">&#34;/&#34;</span>&nbsp;<span class="op" id="6007389">+</span>&nbsp;<span class="ident" id="6007391">hdr</span><span class="op" id="6007394">.</span><span class="ident" id="6007395">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6007402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6007405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6007409">if</span>&nbsp;<span class="ident" id="6007412">tr</span><span class="op" id="6007414">.</span><span class="ident" id="6007415">err</span>&nbsp;<span class="op" id="6007419">!=</span>&nbsp;<span class="builtintype" id="6007422">nil</span>&nbsp;<span class="op" id="6007426">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007430">tr</span><span class="op" id="6007432">.</span><span class="ident" id="6007433">err</span>&nbsp;<span class="op" id="6007437">=</span>&nbsp;<span class="ident" id="6007439">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6007451">return</span>&nbsp;<span class="builtintype" id="6007458">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6007463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6007467">//&nbsp;Maximum&nbsp;value&nbsp;of&nbsp;hdr.Size&nbsp;is&nbsp;64&nbsp;GB&nbsp;(12&nbsp;octal&nbsp;digits),</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6007525">//&nbsp;so&nbsp;there&#39;s&nbsp;no&nbsp;risk&nbsp;of&nbsp;int64&nbsp;overflowing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007570">nb</span>&nbsp;<span class="op" id="6007573">:=</span>&nbsp;<span class="ident" id="6007576">int64</span><span class="op" id="6007581">(</span><span class="ident" id="6007582">hdr</span><span class="op" id="6007585">.</span><span class="ident" id="6007586">Size</span><span class="op" id="6007590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007593">tr</span><span class="op" id="6007595">.</span><span class="ident" id="6007596">pad</span>&nbsp;<span class="op" id="6007600">=</span>&nbsp;<span class="op" id="6007602">-</span><span class="ident" id="6007603">nb</span>&nbsp;<span class="op" id="6007606">&amp;</span>&nbsp;<span class="op" id="6007608">(</span><span class="ident" id="6007609">blockSize</span>&nbsp;<span class="op" id="6007619">-</span>&nbsp;<span class="num" id="6007621">1</span><span class="op" id="6007622">)</span>&nbsp;<span class="comment" id="6007624">//&nbsp;blockSize&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;two</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6007657">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007690">tr</span><span class="op" id="6007692">.</span><span class="ident" id="6007693">curr</span>&nbsp;<span class="op" id="6007698">=</span>&nbsp;<span class="op" id="6007700">&amp;</span><span class="ident" id="6007701">regFileReader</span><span class="op" id="6007714">{</span><span class="ident" id="6007715">r</span><span class="op" id="6007716">:</span>&nbsp;<span class="ident" id="6007718">tr</span><span class="op" id="6007720">.</span><span class="ident" id="6007721">r</span><span class="op" id="6007722">,</span>&nbsp;<span class="ident" id="6007724">nb</span><span class="op" id="6007726">:</span>&nbsp;<span class="ident" id="6007728">nb</span><span class="op" id="6007730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6007734">//&nbsp;Check&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6007777">if</span>&nbsp;<span class="ident" id="6007780">hdr</span><span class="op" id="6007783">.</span><span class="ident" id="6007784">Typeflag</span>&nbsp;<span class="op" id="6007793">==</span>&nbsp;<span class="ident" id="6007796">TypeGNUSparse</span>&nbsp;<span class="op" id="6007810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6007814">//&nbsp;Get&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007850">hdr</span><span class="op" id="6007853">.</span><span class="ident" id="6007854">Size</span>&nbsp;<span class="op" id="6007859">=</span>&nbsp;<span class="ident" id="6007861">tr</span><span class="op" id="6007863">.</span><span class="ident" id="6007864">octal</span><span class="op" id="6007869">(</span><span class="ident" id="6007870">header</span><span class="op" id="6007876">[</span><span class="num" id="6007877">483</span><span class="op" id="6007880">:</span><span class="num" id="6007881">495</span><span class="op" id="6007884">]</span><span class="op" id="6007885">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6007890">//&nbsp;Read&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007916">sp</span>&nbsp;<span class="op" id="6007919">:=</span>&nbsp;<span class="ident" id="6007922">tr</span><span class="op" id="6007924">.</span><span class="ident" id="6007925">readOldGNUSparseMap</span><span class="op" id="6007944">(</span><span class="ident" id="6007945">header</span><span class="op" id="6007951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6007955">if</span>&nbsp;<span class="ident" id="6007958">tr</span><span class="op" id="6007960">.</span><span class="ident" id="6007961">err</span>&nbsp;<span class="op" id="6007965">!=</span>&nbsp;<span class="builtintype" id="6007968">nil</span>&nbsp;<span class="op" id="6007972">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6007977">return</span>&nbsp;<span class="builtintype" id="6007984">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6007990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6007994">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;GNU&nbsp;sparse&nbsp;file.&nbsp;Update&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008066">tr</span><span class="op" id="6008068">.</span><span class="ident" id="6008069">curr</span>&nbsp;<span class="op" id="6008074">=</span>&nbsp;<span class="op" id="6008076">&amp;</span><span class="ident" id="6008077">sparseFileReader</span><span class="op" id="6008093">{</span><span class="ident" id="6008094">rfr</span><span class="op" id="6008097">:</span>&nbsp;<span class="ident" id="6008099">tr</span><span class="op" id="6008101">.</span><span class="ident" id="6008102">curr</span><span class="op" id="6008106">.</span><span class="op" id="6008107">(</span><span class="op" id="6008108">*</span><span class="ident" id="6008109">regFileReader</span><span class="op" id="6008122">)</span><span class="op" id="6008123">,</span>&nbsp;<span class="ident" id="6008125">sp</span><span class="op" id="6008127">:</span>&nbsp;<span class="ident" id="6008129">sp</span><span class="op" id="6008131">,</span>&nbsp;<span class="ident" id="6008133">tot</span><span class="op" id="6008136">:</span>&nbsp;<span class="ident" id="6008138">hdr</span><span class="op" id="6008141">.</span><span class="ident" id="6008142">Size</span><span class="op" id="6008146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6008149">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6008153">return</span>&nbsp;<span class="ident" id="6008160">hdr</span><br>
<span class="lineno"></span><span class="op" id="6008164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6008167">//&nbsp;A&nbsp;sparseEntry&nbsp;holds&nbsp;a&nbsp;single&nbsp;entry&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&#39;s&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">540</span><span class="comment" id="6008236">//&nbsp;A&nbsp;sparse&nbsp;entry&nbsp;indicates&nbsp;the&nbsp;offset&nbsp;and&nbsp;size&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6008306">//&nbsp;block&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6008324">type</span>&nbsp;<span class="ident" id="6008329">sparseEntry</span>&nbsp;<span class="keyword" id="6008341">struct</span>&nbsp;<span class="op" id="6008348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008351">offset</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6008360">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008367">numBytes</span>&nbsp;<span class="ident" id="6008376">int64</span><br>
<span class="lineno">545</span><span class="op" id="6008382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6008385">//&nbsp;readOldGNUSparseMap&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;the&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="6008469">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;tar&nbsp;header&nbsp;if&nbsp;it&#39;s&nbsp;small&nbsp;enough.&nbsp;If&nbsp;it&#39;s&nbsp;larger&nbsp;than&nbsp;four&nbsp;entries,</span><br>
<span class="lineno"></span><span class="comment" id="6008571">//&nbsp;then&nbsp;one&nbsp;or&nbsp;more&nbsp;extension&nbsp;headers&nbsp;are&nbsp;used&nbsp;to&nbsp;store&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">550</span><span class="keyword" id="6008655">func</span>&nbsp;<span class="op" id="6008660">(</span><span class="ident" id="6008661">tr</span>&nbsp;<span class="op" id="6008664">*</span><span class="ident" id="6008665">Reader</span><span class="op" id="6008671">)</span>&nbsp;<span class="ident" id="6008673">readOldGNUSparseMap</span><span class="op" id="6008692">(</span><span class="ident" id="6008693">header</span>&nbsp;<span class="op" id="6008700">[</span><span class="op" id="6008701">]</span><span class="builtintype" id="6008702">byte</span><span class="op" id="6008706">)</span>&nbsp;<span class="op" id="6008708">[</span><span class="op" id="6008709">]</span><span class="ident" id="6008710">sparseEntry</span>&nbsp;<span class="op" id="6008722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008725">isExtended</span>&nbsp;<span class="op" id="6008736">:=</span>&nbsp;<span class="ident" id="6008739">header</span><span class="op" id="6008745">[</span><span class="ident" id="6008746">oldGNUSparseMainHeaderIsExtendedOffset</span><span class="op" id="6008784">]</span>&nbsp;<span class="op" id="6008786">!=</span>&nbsp;<span class="num" id="6008789">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008792">spCap</span>&nbsp;<span class="op" id="6008798">:=</span>&nbsp;<span class="ident" id="6008801">oldGNUSparseMainHeaderNumEntries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6008835">if</span>&nbsp;<span class="ident" id="6008838">isExtended</span>&nbsp;<span class="op" id="6008849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008853">spCap</span>&nbsp;<span class="op" id="6008859">+=</span>&nbsp;<span class="ident" id="6008862">oldGNUSparseExtendedHeaderNumEntries</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6008900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008903">sp</span>&nbsp;<span class="op" id="6008906">:=</span>&nbsp;<span class="builtinfunc" id="6008909">make</span><span class="op" id="6008913">(</span><span class="op" id="6008914">[</span><span class="op" id="6008915">]</span><span class="ident" id="6008916">sparseEntry</span><span class="op" id="6008927">,</span>&nbsp;<span class="num" id="6008929">0</span><span class="op" id="6008930">,</span>&nbsp;<span class="ident" id="6008932">spCap</span><span class="op" id="6008937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6008940">s</span>&nbsp;<span class="op" id="6008942">:=</span>&nbsp;<span class="ident" id="6008945">slicer</span><span class="op" id="6008951">(</span><span class="ident" id="6008952">header</span><span class="op" id="6008958">[</span><span class="ident" id="6008959">oldGNUSparseMainHeaderOffset</span><span class="op" id="6008987">:</span><span class="op" id="6008988">]</span><span class="op" id="6008989">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6008993">//&nbsp;Read&nbsp;the&nbsp;four&nbsp;entries&nbsp;from&nbsp;the&nbsp;main&nbsp;tar&nbsp;header</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6009044">for</span>&nbsp;<span class="ident" id="6009048">i</span>&nbsp;<span class="op" id="6009050">:=</span>&nbsp;<span class="num" id="6009053">0</span><span class="op" id="6009054">;</span>&nbsp;<span class="ident" id="6009056">i</span>&nbsp;<span class="op" id="6009058">&lt;</span>&nbsp;<span class="ident" id="6009060">oldGNUSparseMainHeaderNumEntries</span><span class="op" id="6009092">;</span>&nbsp;<span class="ident" id="6009094">i</span><span class="op" id="6009095">++</span>&nbsp;<span class="op" id="6009098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6009102">offset</span>&nbsp;<span class="op" id="6009109">:=</span>&nbsp;<span class="ident" id="6009112">tr</span><span class="op" id="6009114">.</span><span class="ident" id="6009115">octal</span><span class="op" id="6009120">(</span><span class="ident" id="6009121">s</span><span class="op" id="6009122">.</span><span class="ident" id="6009123">next</span><span class="op" id="6009127">(</span><span class="ident" id="6009128">oldGNUSparseOffsetSize</span><span class="op" id="6009150">)</span><span class="op" id="6009151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6009155">numBytes</span>&nbsp;<span class="op" id="6009164">:=</span>&nbsp;<span class="ident" id="6009167">tr</span><span class="op" id="6009169">.</span><span class="ident" id="6009170">octal</span><span class="op" id="6009175">(</span><span class="ident" id="6009176">s</span><span class="op" id="6009177">.</span><span class="ident" id="6009178">next</span><span class="op" id="6009182">(</span><span class="ident" id="6009183">oldGNUSparseNumBytesSize</span><span class="op" id="6009207">)</span><span class="op" id="6009208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6009212">if</span>&nbsp;<span class="ident" id="6009215">tr</span><span class="op" id="6009217">.</span><span class="ident" id="6009218">err</span>&nbsp;<span class="op" id="6009222">!=</span>&nbsp;<span class="builtintype" id="6009225">nil</span>&nbsp;<span class="op" id="6009229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6009234">tr</span><span class="op" id="6009236">.</span><span class="ident" id="6009237">err</span>&nbsp;<span class="op" id="6009241">=</span>&nbsp;<span class="ident" id="6009243">ErrHeader</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6009256">return</span>&nbsp;<span class="builtintype" id="6009263">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6009273">if</span>&nbsp;<span class="ident" id="6009276">offset</span>&nbsp;<span class="op" id="6009283">==</span>&nbsp;<span class="num" id="6009286">0</span>&nbsp;<span class="op" id="6009288">&amp;&amp;</span>&nbsp;<span class="ident" id="6009291">numBytes</span>&nbsp;<span class="op" id="6009300">==</span>&nbsp;<span class="num" id="6009303">0</span>&nbsp;<span class="op" id="6009305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6009310">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009318">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6009322">sp</span>&nbsp;<span class="op" id="6009325">=</span>&nbsp;<span class="builtinfunc" id="6009327">append</span><span class="op" id="6009333">(</span><span class="ident" id="6009334">sp</span><span class="op" id="6009336">,</span>&nbsp;<span class="ident" id="6009338">sparseEntry</span><span class="op" id="6009349">{</span><span class="ident" id="6009350">offset</span><span class="op" id="6009356">:</span>&nbsp;<span class="ident" id="6009358">offset</span><span class="op" id="6009364">,</span>&nbsp;<span class="ident" id="6009366">numBytes</span><span class="op" id="6009374">:</span>&nbsp;<span class="ident" id="6009376">numBytes</span><span class="op" id="6009384">}</span><span class="op" id="6009385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6009392">for</span>&nbsp;<span class="ident" id="6009396">isExtended</span>&nbsp;<span class="op" id="6009407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009411">//&nbsp;There&nbsp;are&nbsp;more&nbsp;entries.&nbsp;Read&nbsp;an&nbsp;extension&nbsp;header&nbsp;and&nbsp;parse&nbsp;its&nbsp;entries.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6009488">sparseHeader</span>&nbsp;<span class="op" id="6009501">:=</span>&nbsp;<span class="builtinfunc" id="6009504">make</span><span class="op" id="6009508">(</span><span class="op" id="6009509">[</span><span class="op" id="6009510">]</span><span class="builtintype" id="6009511">byte</span><span class="op" id="6009515">,</span>&nbsp;<span class="ident" id="6009517">blockSize</span><span class="op" id="6009526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6009530">if</span>&nbsp;<span class="ident" id="6009533">_</span><span class="op" id="6009534">,</span>&nbsp;<span class="ident" id="6009536">tr</span><span class="op" id="6009538">.</span><span class="ident" id="6009539">err</span>&nbsp;<span class="op" id="6009543">=</span>&nbsp;<span class="ident" id="6009545">io</span><span class="op" id="6009547">.</span><span class="ident" id="6009548">ReadFull</span><span class="op" id="6009556">(</span><span class="ident" id="6009557">tr</span><span class="op" id="6009559">.</span><span class="ident" id="6009560">r</span><span class="op" id="6009561">,</span>&nbsp;<span class="ident" id="6009563">sparseHeader</span><span class="op" id="6009575">)</span><span class="op" id="6009576">;</span>&nbsp;<span class="ident" id="6009578">tr</span><span class="op" id="6009580">.</span><span class="ident" id="6009581">err</span>&nbsp;<span class="op" id="6009585">!=</span>&nbsp;<span class="builtintype" id="6009588">nil</span>&nbsp;<span class="op" id="6009592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6009597">return</span>&nbsp;<span class="builtintype" id="6009604">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6009614">isExtended</span>&nbsp;<span class="op" id="6009625">=</span>&nbsp;<span class="ident" id="6009627">sparseHeader</span><span class="op" id="6009639">[</span><span class="ident" id="6009640">oldGNUSparseExtendedHeaderIsExtendedOffset</span><span class="op" id="6009682">]</span>&nbsp;<span class="op" id="6009684">!=</span>&nbsp;<span class="num" id="6009687">0</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6009691">s</span>&nbsp;<span class="op" id="6009693">=</span>&nbsp;<span class="ident" id="6009695">slicer</span><span class="op" id="6009701">(</span><span class="ident" id="6009702">sparseHeader</span><span class="op" id="6009714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6009718">for</span>&nbsp;<span class="ident" id="6009722">i</span>&nbsp;<span class="op" id="6009724">:=</span>&nbsp;<span class="num" id="6009727">0</span><span class="op" id="6009728">;</span>&nbsp;<span class="ident" id="6009730">i</span>&nbsp;<span class="op" id="6009732">&lt;</span>&nbsp;<span class="ident" id="6009734">oldGNUSparseExtendedHeaderNumEntries</span><span class="op" id="6009770">;</span>&nbsp;<span class="ident" id="6009772">i</span><span class="op" id="6009773">++</span>&nbsp;<span class="op" id="6009776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6009781">offset</span>&nbsp;<span class="op" id="6009788">:=</span>&nbsp;<span class="ident" id="6009791">tr</span><span class="op" id="6009793">.</span><span class="ident" id="6009794">octal</span><span class="op" id="6009799">(</span><span class="ident" id="6009800">s</span><span class="op" id="6009801">.</span><span class="ident" id="6009802">next</span><span class="op" id="6009806">(</span><span class="ident" id="6009807">oldGNUSparseOffsetSize</span><span class="op" id="6009829">)</span><span class="op" id="6009830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6009835">numBytes</span>&nbsp;<span class="op" id="6009844">:=</span>&nbsp;<span class="ident" id="6009847">tr</span><span class="op" id="6009849">.</span><span class="ident" id="6009850">octal</span><span class="op" id="6009855">(</span><span class="ident" id="6009856">s</span><span class="op" id="6009857">.</span><span class="ident" id="6009858">next</span><span class="op" id="6009862">(</span><span class="ident" id="6009863">oldGNUSparseNumBytesSize</span><span class="op" id="6009887">)</span><span class="op" id="6009888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6009893">if</span>&nbsp;<span class="ident" id="6009896">tr</span><span class="op" id="6009898">.</span><span class="ident" id="6009899">err</span>&nbsp;<span class="op" id="6009903">!=</span>&nbsp;<span class="builtintype" id="6009906">nil</span>&nbsp;<span class="op" id="6009910">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6009916">tr</span><span class="op" id="6009918">.</span><span class="ident" id="6009919">err</span>&nbsp;<span class="op" id="6009923">=</span>&nbsp;<span class="ident" id="6009925">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6009939">return</span>&nbsp;<span class="builtintype" id="6009946">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6009958">if</span>&nbsp;<span class="ident" id="6009961">offset</span>&nbsp;<span class="op" id="6009968">==</span>&nbsp;<span class="num" id="6009971">0</span>&nbsp;<span class="op" id="6009973">&amp;&amp;</span>&nbsp;<span class="ident" id="6009976">numBytes</span>&nbsp;<span class="op" id="6009985">==</span>&nbsp;<span class="num" id="6009988">0</span>&nbsp;<span class="op" id="6009990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6009996">break</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6010005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6010010">sp</span>&nbsp;<span class="op" id="6010013">=</span>&nbsp;<span class="builtinfunc" id="6010015">append</span><span class="op" id="6010021">(</span><span class="ident" id="6010022">sp</span><span class="op" id="6010024">,</span>&nbsp;<span class="ident" id="6010026">sparseEntry</span><span class="op" id="6010037">{</span><span class="ident" id="6010038">offset</span><span class="op" id="6010044">:</span>&nbsp;<span class="ident" id="6010046">offset</span><span class="op" id="6010052">,</span>&nbsp;<span class="ident" id="6010054">numBytes</span><span class="op" id="6010062">:</span>&nbsp;<span class="ident" id="6010064">numBytes</span><span class="op" id="6010072">}</span><span class="op" id="6010073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6010077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6010080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6010083">return</span>&nbsp;<span class="ident" id="6010090">sp</span><br>
<span class="lineno">595</span><span class="op" id="6010093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6010096">//&nbsp;readGNUSparseMap1x0&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;1.0.</span><br>
<span class="lineno"></span><span class="comment" id="6010190">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;just&nbsp;before&nbsp;the&nbsp;file&nbsp;data&nbsp;and&nbsp;padded&nbsp;out&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="6010290">func</span>&nbsp;<span class="ident" id="6010295">readGNUSparseMap1x0</span><span class="op" id="6010314">(</span><span class="ident" id="6010315">r</span>&nbsp;<span class="ident" id="6010317">io</span><span class="op" id="6010319">.</span><span class="ident" id="6010320">Reader</span><span class="op" id="6010326">)</span>&nbsp;<span class="op" id="6010328">(</span><span class="op" id="6010329">[</span><span class="op" id="6010330">]</span><span class="ident" id="6010331">sparseEntry</span><span class="op" id="6010342">,</span>&nbsp;<span class="builtintype" id="6010344">error</span><span class="op" id="6010349">)</span>&nbsp;<span class="op" id="6010351">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6010354">buf</span>&nbsp;<span class="op" id="6010358">:=</span>&nbsp;<span class="builtinfunc" id="6010361">make</span><span class="op" id="6010365">(</span><span class="op" id="6010366">[</span><span class="op" id="6010367">]</span><span class="builtintype" id="6010368">byte</span><span class="op" id="6010372">,</span>&nbsp;<span class="num" id="6010374">2</span><span class="op" id="6010375">*</span><span class="ident" id="6010376">blockSize</span><span class="op" id="6010385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6010388">sparseHeader</span>&nbsp;<span class="op" id="6010401">:=</span>&nbsp;<span class="ident" id="6010404">buf</span><span class="op" id="6010407">[</span><span class="op" id="6010408">:</span><span class="ident" id="6010409">blockSize</span><span class="op" id="6010418">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010422">//&nbsp;readDecimal&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;to&nbsp;read&nbsp;a&nbsp;decimal&nbsp;integer&nbsp;from&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010505">//&nbsp;while&nbsp;making&nbsp;sure&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;file&nbsp;in&nbsp;blocks&nbsp;of&nbsp;size&nbsp;blockSize</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6010577">readDecimal</span>&nbsp;<span class="op" id="6010589">:=</span>&nbsp;<span class="keyword" id="6010592">func</span><span class="op" id="6010596">(</span><span class="op" id="6010597">)</span>&nbsp;<span class="op" id="6010599">(</span><span class="ident" id="6010600">int64</span><span class="op" id="6010605">,</span>&nbsp;<span class="builtintype" id="6010607">error</span><span class="op" id="6010612">)</span>&nbsp;<span class="op" id="6010614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010618">//&nbsp;Look&nbsp;for&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6010640">nl</span>&nbsp;<span class="op" id="6010643">:=</span>&nbsp;<span class="ident" id="6010646">bytes</span><span class="op" id="6010651">.</span><span class="ident" id="6010652">IndexByte</span><span class="op" id="6010661">(</span><span class="ident" id="6010662">sparseHeader</span><span class="op" id="6010674">,</span>&nbsp;<span class="string" id="6010676">&#39;\n&#39;</span><span class="op" id="6010680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6010684">if</span>&nbsp;<span class="ident" id="6010687">nl</span>&nbsp;<span class="op" id="6010690">==</span>&nbsp;<span class="op" id="6010693">-</span><span class="num" id="6010694">1</span>&nbsp;<span class="op" id="6010696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6010701">if</span>&nbsp;<span class="builtinfunc" id="6010704">len</span><span class="op" id="6010707">(</span><span class="ident" id="6010708">sparseHeader</span><span class="op" id="6010720">)</span>&nbsp;<span class="op" id="6010722">&gt;=</span>&nbsp;<span class="ident" id="6010725">blockSize</span>&nbsp;<span class="op" id="6010735">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010741">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6010765">return</span>&nbsp;<span class="num" id="6010772">0</span><span class="op" id="6010773">,</span>&nbsp;<span class="ident" id="6010775">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6010788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6010793">oldLen</span>&nbsp;<span class="op" id="6010800">:=</span>&nbsp;<span class="builtinfunc" id="6010803">len</span><span class="op" id="6010806">(</span><span class="ident" id="6010807">sparseHeader</span><span class="op" id="6010819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6010824">newLen</span>&nbsp;<span class="op" id="6010831">:=</span>&nbsp;<span class="ident" id="6010834">oldLen</span>&nbsp;<span class="op" id="6010841">+</span>&nbsp;<span class="ident" id="6010843">blockSize</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6010856">if</span>&nbsp;<span class="builtinfunc" id="6010859">cap</span><span class="op" id="6010862">(</span><span class="ident" id="6010863">sparseHeader</span><span class="op" id="6010875">)</span>&nbsp;<span class="op" id="6010877">&lt;</span>&nbsp;<span class="ident" id="6010879">newLen</span>&nbsp;<span class="op" id="6010886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010892">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;the&nbsp;next&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6010964">copy</span><span class="op" id="6010968">(</span><span class="ident" id="6010969">buf</span><span class="op" id="6010972">,</span>&nbsp;<span class="ident" id="6010974">sparseHeader</span><span class="op" id="6010986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6010992">sparseHeader</span>&nbsp;<span class="op" id="6011005">=</span>&nbsp;<span class="ident" id="6011007">buf</span><span class="op" id="6011010">[</span><span class="op" id="6011011">:</span><span class="ident" id="6011012">newLen</span><span class="op" id="6011018">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6011023">}</span>&nbsp;<span class="keyword" id="6011025">else</span>&nbsp;<span class="op" id="6011030">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6011036">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;and&nbsp;we&nbsp;can&nbsp;just&nbsp;reslice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6011088">sparseHeader</span>&nbsp;<span class="op" id="6011101">=</span>&nbsp;<span class="ident" id="6011103">sparseHeader</span><span class="op" id="6011115">[</span><span class="op" id="6011116">:</span><span class="ident" id="6011117">newLen</span><span class="op" id="6011123">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6011128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6011134">//&nbsp;Now&nbsp;that&nbsp;sparseHeader&nbsp;is&nbsp;large&nbsp;enough,&nbsp;read&nbsp;next&nbsp;block</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6011195">if</span>&nbsp;<span class="ident" id="6011198">_</span><span class="op" id="6011199">,</span>&nbsp;<span class="ident" id="6011201">err</span>&nbsp;<span class="op" id="6011205">:=</span>&nbsp;<span class="ident" id="6011208">io</span><span class="op" id="6011210">.</span><span class="ident" id="6011211">ReadFull</span><span class="op" id="6011219">(</span><span class="ident" id="6011220">r</span><span class="op" id="6011221">,</span>&nbsp;<span class="ident" id="6011223">sparseHeader</span><span class="op" id="6011235">[</span><span class="ident" id="6011236">oldLen</span><span class="op" id="6011242">:</span><span class="ident" id="6011243">newLen</span><span class="op" id="6011249">]</span><span class="op" id="6011250">)</span><span class="op" id="6011251">;</span>&nbsp;<span class="ident" id="6011253">err</span>&nbsp;<span class="op" id="6011257">!=</span>&nbsp;<span class="builtintype" id="6011260">nil</span>&nbsp;<span class="op" id="6011264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6011270">return</span>&nbsp;<span class="num" id="6011277">0</span><span class="op" id="6011278">,</span>&nbsp;<span class="ident" id="6011280">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6011287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6011293">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;newline&nbsp;in&nbsp;the&nbsp;new&nbsp;data</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6011334">nl</span>&nbsp;<span class="op" id="6011337">=</span>&nbsp;<span class="ident" id="6011339">bytes</span><span class="op" id="6011344">.</span><span class="ident" id="6011345">IndexByte</span><span class="op" id="6011354">(</span><span class="ident" id="6011355">sparseHeader</span><span class="op" id="6011367">[</span><span class="ident" id="6011368">oldLen</span><span class="op" id="6011374">:</span><span class="ident" id="6011375">newLen</span><span class="op" id="6011381">]</span><span class="op" id="6011382">,</span>&nbsp;<span class="string" id="6011384">&#39;\n&#39;</span><span class="op" id="6011388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6011393">if</span>&nbsp;<span class="ident" id="6011396">nl</span>&nbsp;<span class="op" id="6011399">==</span>&nbsp;<span class="op" id="6011402">-</span><span class="num" id="6011403">1</span>&nbsp;<span class="op" id="6011405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6011411">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6011435">return</span>&nbsp;<span class="num" id="6011442">0</span><span class="op" id="6011443">,</span>&nbsp;<span class="ident" id="6011445">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6011458">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6011463">nl</span>&nbsp;<span class="op" id="6011466">+=</span>&nbsp;<span class="ident" id="6011469">oldLen</span>&nbsp;<span class="comment" id="6011476">//&nbsp;We&nbsp;want&nbsp;the&nbsp;position&nbsp;from&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6011521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6011525">//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;found&nbsp;a&nbsp;newline,&nbsp;read&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6011576">n</span><span class="op" id="6011577">,</span>&nbsp;<span class="ident" id="6011579">err</span>&nbsp;<span class="op" id="6011583">:=</span>&nbsp;<span class="ident" id="6011586">strconv</span><span class="op" id="6011593">.</span><span class="ident" id="6011594">ParseInt</span><span class="op" id="6011602">(</span><span class="builtintype" id="6011603">string</span><span class="op" id="6011609">(</span><span class="ident" id="6011610">sparseHeader</span><span class="op" id="6011622">[</span><span class="op" id="6011623">:</span><span class="ident" id="6011624">nl</span><span class="op" id="6011626">]</span><span class="op" id="6011627">)</span><span class="op" id="6011628">,</span>&nbsp;<span class="num" id="6011630">10</span><span class="op" id="6011632">,</span>&nbsp;<span class="num" id="6011634">0</span><span class="op" id="6011635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6011639">if</span>&nbsp;<span class="ident" id="6011642">err</span>&nbsp;<span class="op" id="6011646">!=</span>&nbsp;<span class="builtintype" id="6011649">nil</span>&nbsp;<span class="op" id="6011653">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6011658">return</span>&nbsp;<span class="num" id="6011665">0</span><span class="op" id="6011666">,</span>&nbsp;<span class="ident" id="6011668">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6011680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6011685">//&nbsp;Update&nbsp;sparseHeader&nbsp;to&nbsp;consume&nbsp;this&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6011733">sparseHeader</span>&nbsp;<span class="op" id="6011746">=</span>&nbsp;<span class="ident" id="6011748">sparseHeader</span><span class="op" id="6011760">[</span><span class="ident" id="6011761">nl</span><span class="op" id="6011763">+</span><span class="num" id="6011764">1</span><span class="op" id="6011765">:</span><span class="op" id="6011766">]</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6011770">return</span>&nbsp;<span class="ident" id="6011777">n</span><span class="op" id="6011778">,</span>&nbsp;<span class="builtintype" id="6011780">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6011785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6011789">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6011814">if</span>&nbsp;<span class="ident" id="6011817">_</span><span class="op" id="6011818">,</span>&nbsp;<span class="ident" id="6011820">err</span>&nbsp;<span class="op" id="6011824">:=</span>&nbsp;<span class="ident" id="6011827">io</span><span class="op" id="6011829">.</span><span class="ident" id="6011830">ReadFull</span><span class="op" id="6011838">(</span><span class="ident" id="6011839">r</span><span class="op" id="6011840">,</span>&nbsp;<span class="ident" id="6011842">sparseHeader</span><span class="op" id="6011854">)</span><span class="op" id="6011855">;</span>&nbsp;<span class="ident" id="6011857">err</span>&nbsp;<span class="op" id="6011861">!=</span>&nbsp;<span class="builtintype" id="6011864">nil</span>&nbsp;<span class="op" id="6011868">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6011872">return</span>&nbsp;<span class="builtintype" id="6011879">nil</span><span class="op" id="6011882">,</span>&nbsp;<span class="ident" id="6011884">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6011889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6011893">//&nbsp;The&nbsp;first&nbsp;line&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6011943">numEntries</span><span class="op" id="6011953">,</span>&nbsp;<span class="ident" id="6011955">err</span>&nbsp;<span class="op" id="6011959">:=</span>&nbsp;<span class="ident" id="6011962">readDecimal</span><span class="op" id="6011973">(</span><span class="op" id="6011974">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6011977">if</span>&nbsp;<span class="ident" id="6011980">err</span>&nbsp;<span class="op" id="6011984">!=</span>&nbsp;<span class="builtintype" id="6011987">nil</span>&nbsp;<span class="op" id="6011991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6011995">return</span>&nbsp;<span class="builtintype" id="6012002">nil</span><span class="op" id="6012005">,</span>&nbsp;<span class="ident" id="6012007">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6012012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6012016">//&nbsp;Read&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6012041">sp</span>&nbsp;<span class="op" id="6012044">:=</span>&nbsp;<span class="builtinfunc" id="6012047">make</span><span class="op" id="6012051">(</span><span class="op" id="6012052">[</span><span class="op" id="6012053">]</span><span class="ident" id="6012054">sparseEntry</span><span class="op" id="6012065">,</span>&nbsp;<span class="num" id="6012067">0</span><span class="op" id="6012068">,</span>&nbsp;<span class="ident" id="6012070">numEntries</span><span class="op" id="6012080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6012083">for</span>&nbsp;<span class="ident" id="6012087">i</span>&nbsp;<span class="op" id="6012089">:=</span>&nbsp;<span class="ident" id="6012092">int64</span><span class="op" id="6012097">(</span><span class="num" id="6012098">0</span><span class="op" id="6012099">)</span><span class="op" id="6012100">;</span>&nbsp;<span class="ident" id="6012102">i</span>&nbsp;<span class="op" id="6012104">&lt;</span>&nbsp;<span class="ident" id="6012106">numEntries</span><span class="op" id="6012116">;</span>&nbsp;<span class="ident" id="6012118">i</span><span class="op" id="6012119">++</span>&nbsp;<span class="op" id="6012122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6012126">//&nbsp;Read&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6012147">offset</span><span class="op" id="6012153">,</span>&nbsp;<span class="ident" id="6012155">err</span>&nbsp;<span class="op" id="6012159">:=</span>&nbsp;<span class="ident" id="6012162">readDecimal</span><span class="op" id="6012173">(</span><span class="op" id="6012174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6012178">if</span>&nbsp;<span class="ident" id="6012181">err</span>&nbsp;<span class="op" id="6012185">!=</span>&nbsp;<span class="builtintype" id="6012188">nil</span>&nbsp;<span class="op" id="6012192">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6012197">return</span>&nbsp;<span class="builtintype" id="6012204">nil</span><span class="op" id="6012207">,</span>&nbsp;<span class="ident" id="6012209">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6012215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6012219">//&nbsp;Read&nbsp;numBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6012238">numBytes</span><span class="op" id="6012246">,</span>&nbsp;<span class="ident" id="6012248">err</span>&nbsp;<span class="op" id="6012252">:=</span>&nbsp;<span class="ident" id="6012255">readDecimal</span><span class="op" id="6012266">(</span><span class="op" id="6012267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6012271">if</span>&nbsp;<span class="ident" id="6012274">err</span>&nbsp;<span class="op" id="6012278">!=</span>&nbsp;<span class="builtintype" id="6012281">nil</span>&nbsp;<span class="op" id="6012285">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6012290">return</span>&nbsp;<span class="builtintype" id="6012297">nil</span><span class="op" id="6012300">,</span>&nbsp;<span class="ident" id="6012302">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6012308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6012313">sp</span>&nbsp;<span class="op" id="6012316">=</span>&nbsp;<span class="builtinfunc" id="6012318">append</span><span class="op" id="6012324">(</span><span class="ident" id="6012325">sp</span><span class="op" id="6012327">,</span>&nbsp;<span class="ident" id="6012329">sparseEntry</span><span class="op" id="6012340">{</span><span class="ident" id="6012341">offset</span><span class="op" id="6012347">:</span>&nbsp;<span class="ident" id="6012349">offset</span><span class="op" id="6012355">,</span>&nbsp;<span class="ident" id="6012357">numBytes</span><span class="op" id="6012365">:</span>&nbsp;<span class="ident" id="6012367">numBytes</span><span class="op" id="6012375">}</span><span class="op" id="6012376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6012379">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6012383">return</span>&nbsp;<span class="ident" id="6012390">sp</span><span class="op" id="6012392">,</span>&nbsp;<span class="builtintype" id="6012394">nil</span><br>
<span class="lineno"></span><span class="op" id="6012398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6012401">//&nbsp;readGNUSparseMap0x1&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;0.1.</span><br>
<span class="lineno">680</span><span class="comment" id="6012495">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="6012543">func</span>&nbsp;<span class="ident" id="6012548">readGNUSparseMap0x1</span><span class="op" id="6012567">(</span><span class="ident" id="6012568">headers</span>&nbsp;<span class="keyword" id="6012576">map</span><span class="op" id="6012579">[</span><span class="builtintype" id="6012580">string</span><span class="op" id="6012586">]</span><span class="builtintype" id="6012587">string</span><span class="op" id="6012593">)</span>&nbsp;<span class="op" id="6012595">(</span><span class="op" id="6012596">[</span><span class="op" id="6012597">]</span><span class="ident" id="6012598">sparseEntry</span><span class="op" id="6012609">,</span>&nbsp;<span class="builtintype" id="6012611">error</span><span class="op" id="6012616">)</span>&nbsp;<span class="op" id="6012618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6012621">//&nbsp;Get&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6012647">numEntriesStr</span><span class="op" id="6012660">,</span>&nbsp;<span class="ident" id="6012662">ok</span>&nbsp;<span class="op" id="6012665">:=</span>&nbsp;<span class="ident" id="6012668">headers</span><span class="op" id="6012675">[</span><span class="ident" id="6012676">paxGNUSparseNumBlocks</span><span class="op" id="6012697">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6012700">if</span>&nbsp;<span class="op" id="6012703">!</span><span class="ident" id="6012704">ok</span>&nbsp;<span class="op" id="6012707">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6012711">return</span>&nbsp;<span class="builtintype" id="6012718">nil</span><span class="op" id="6012721">,</span>&nbsp;<span class="ident" id="6012723">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6012734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6012737">numEntries</span><span class="op" id="6012747">,</span>&nbsp;<span class="ident" id="6012749">err</span>&nbsp;<span class="op" id="6012753">:=</span>&nbsp;<span class="ident" id="6012756">strconv</span><span class="op" id="6012763">.</span><span class="ident" id="6012764">ParseInt</span><span class="op" id="6012772">(</span><span class="ident" id="6012773">numEntriesStr</span><span class="op" id="6012786">,</span>&nbsp;<span class="num" id="6012788">10</span><span class="op" id="6012790">,</span>&nbsp;<span class="num" id="6012792">0</span><span class="op" id="6012793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6012796">if</span>&nbsp;<span class="ident" id="6012799">err</span>&nbsp;<span class="op" id="6012803">!=</span>&nbsp;<span class="builtintype" id="6012806">nil</span>&nbsp;<span class="op" id="6012810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6012814">return</span>&nbsp;<span class="builtintype" id="6012821">nil</span><span class="op" id="6012824">,</span>&nbsp;<span class="ident" id="6012826">ErrHeader</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6012837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6012841">sparseMap</span>&nbsp;<span class="op" id="6012851">:=</span>&nbsp;<span class="ident" id="6012854">strings</span><span class="op" id="6012861">.</span><span class="ident" id="6012862">Split</span><span class="op" id="6012867">(</span><span class="ident" id="6012868">headers</span><span class="op" id="6012875">[</span><span class="ident" id="6012876">paxGNUSparseMap</span><span class="op" id="6012891">]</span><span class="op" id="6012892">,</span>&nbsp;<span class="string" id="6012894">&#34;,&#34;</span><span class="op" id="6012897">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6012901">//&nbsp;There&nbsp;should&nbsp;be&nbsp;two&nbsp;numbers&nbsp;in&nbsp;sparseMap&nbsp;for&nbsp;each&nbsp;entry</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6012961">if</span>&nbsp;<span class="ident" id="6012964">int64</span><span class="op" id="6012969">(</span><span class="builtinfunc" id="6012970">len</span><span class="op" id="6012973">(</span><span class="ident" id="6012974">sparseMap</span><span class="op" id="6012983">)</span><span class="op" id="6012984">)</span>&nbsp;<span class="op" id="6012986">!=</span>&nbsp;<span class="num" id="6012989">2</span><span class="op" id="6012990">*</span><span class="ident" id="6012991">numEntries</span>&nbsp;<span class="op" id="6013002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6013006">return</span>&nbsp;<span class="builtintype" id="6013013">nil</span><span class="op" id="6013016">,</span>&nbsp;<span class="ident" id="6013018">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6013033">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;entries&nbsp;in&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6013080">sp</span>&nbsp;<span class="op" id="6013083">:=</span>&nbsp;<span class="builtinfunc" id="6013086">make</span><span class="op" id="6013090">(</span><span class="op" id="6013091">[</span><span class="op" id="6013092">]</span><span class="ident" id="6013093">sparseEntry</span><span class="op" id="6013104">,</span>&nbsp;<span class="num" id="6013106">0</span><span class="op" id="6013107">,</span>&nbsp;<span class="ident" id="6013109">numEntries</span><span class="op" id="6013119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6013122">for</span>&nbsp;<span class="ident" id="6013126">i</span>&nbsp;<span class="op" id="6013128">:=</span>&nbsp;<span class="ident" id="6013131">int64</span><span class="op" id="6013136">(</span><span class="num" id="6013137">0</span><span class="op" id="6013138">)</span><span class="op" id="6013139">;</span>&nbsp;<span class="ident" id="6013141">i</span>&nbsp;<span class="op" id="6013143">&lt;</span>&nbsp;<span class="ident" id="6013145">numEntries</span><span class="op" id="6013155">;</span>&nbsp;<span class="ident" id="6013157">i</span><span class="op" id="6013158">++</span>&nbsp;<span class="op" id="6013161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6013165">offset</span><span class="op" id="6013171">,</span>&nbsp;<span class="ident" id="6013173">err</span>&nbsp;<span class="op" id="6013177">:=</span>&nbsp;<span class="ident" id="6013180">strconv</span><span class="op" id="6013187">.</span><span class="ident" id="6013188">ParseInt</span><span class="op" id="6013196">(</span><span class="ident" id="6013197">sparseMap</span><span class="op" id="6013206">[</span><span class="num" id="6013207">2</span><span class="op" id="6013208">*</span><span class="ident" id="6013209">i</span><span class="op" id="6013210">]</span><span class="op" id="6013211">,</span>&nbsp;<span class="num" id="6013213">10</span><span class="op" id="6013215">,</span>&nbsp;<span class="num" id="6013217">0</span><span class="op" id="6013218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6013222">if</span>&nbsp;<span class="ident" id="6013225">err</span>&nbsp;<span class="op" id="6013229">!=</span>&nbsp;<span class="builtintype" id="6013232">nil</span>&nbsp;<span class="op" id="6013236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6013241">return</span>&nbsp;<span class="builtintype" id="6013248">nil</span><span class="op" id="6013251">,</span>&nbsp;<span class="ident" id="6013253">ErrHeader</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6013269">numBytes</span><span class="op" id="6013277">,</span>&nbsp;<span class="ident" id="6013279">err</span>&nbsp;<span class="op" id="6013283">:=</span>&nbsp;<span class="ident" id="6013286">strconv</span><span class="op" id="6013293">.</span><span class="ident" id="6013294">ParseInt</span><span class="op" id="6013302">(</span><span class="ident" id="6013303">sparseMap</span><span class="op" id="6013312">[</span><span class="num" id="6013313">2</span><span class="op" id="6013314">*</span><span class="ident" id="6013315">i</span><span class="op" id="6013316">+</span><span class="num" id="6013317">1</span><span class="op" id="6013318">]</span><span class="op" id="6013319">,</span>&nbsp;<span class="num" id="6013321">10</span><span class="op" id="6013323">,</span>&nbsp;<span class="num" id="6013325">0</span><span class="op" id="6013326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6013330">if</span>&nbsp;<span class="ident" id="6013333">err</span>&nbsp;<span class="op" id="6013337">!=</span>&nbsp;<span class="builtintype" id="6013340">nil</span>&nbsp;<span class="op" id="6013344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6013349">return</span>&nbsp;<span class="builtintype" id="6013356">nil</span><span class="op" id="6013359">,</span>&nbsp;<span class="ident" id="6013361">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013373">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6013377">sp</span>&nbsp;<span class="op" id="6013380">=</span>&nbsp;<span class="builtinfunc" id="6013382">append</span><span class="op" id="6013388">(</span><span class="ident" id="6013389">sp</span><span class="op" id="6013391">,</span>&nbsp;<span class="ident" id="6013393">sparseEntry</span><span class="op" id="6013404">{</span><span class="ident" id="6013405">offset</span><span class="op" id="6013411">:</span>&nbsp;<span class="ident" id="6013413">offset</span><span class="op" id="6013419">,</span>&nbsp;<span class="ident" id="6013421">numBytes</span><span class="op" id="6013429">:</span>&nbsp;<span class="ident" id="6013431">numBytes</span><span class="op" id="6013439">}</span><span class="op" id="6013440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6013447">return</span>&nbsp;<span class="ident" id="6013454">sp</span><span class="op" id="6013456">,</span>&nbsp;<span class="builtintype" id="6013458">nil</span><br>
<span class="lineno"></span><span class="op" id="6013462">}</span><br>
<span class="lineno">715</span><br>
<span class="lineno"></span><span class="comment" id="6013465">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;current&nbsp;file&#39;s&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="6013546">//&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;or&nbsp;0&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;current&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6013603">func</span>&nbsp;<span class="op" id="6013608">(</span><span class="ident" id="6013609">tr</span>&nbsp;<span class="op" id="6013612">*</span><span class="ident" id="6013613">Reader</span><span class="op" id="6013619">)</span>&nbsp;<span class="ident" id="6013621">numBytes</span><span class="op" id="6013629">(</span><span class="op" id="6013630">)</span>&nbsp;<span class="ident" id="6013632">int64</span>&nbsp;<span class="op" id="6013638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6013641">if</span>&nbsp;<span class="ident" id="6013644">tr</span><span class="op" id="6013646">.</span><span class="ident" id="6013647">curr</span>&nbsp;<span class="op" id="6013652">==</span>&nbsp;<span class="builtintype" id="6013655">nil</span>&nbsp;<span class="op" id="6013659">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6013663">//&nbsp;No&nbsp;current&nbsp;file,&nbsp;so&nbsp;no&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6013697">return</span>&nbsp;<span class="num" id="6013704">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6013710">return</span>&nbsp;<span class="ident" id="6013717">tr</span><span class="op" id="6013719">.</span><span class="ident" id="6013720">curr</span><span class="op" id="6013724">.</span><span class="ident" id="6013725">numBytes</span><span class="op" id="6013733">(</span><span class="op" id="6013734">)</span><br>
<span class="lineno"></span><span class="op" id="6013736">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="6013739">//&nbsp;Read&nbsp;reads&nbsp;from&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="6013796">//&nbsp;It&nbsp;returns&nbsp;0,&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;entry,</span><br>
<span class="lineno"></span><span class="comment" id="6013859">//&nbsp;until&nbsp;Next&nbsp;is&nbsp;called&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;next&nbsp;entry.</span><br>
<span class="lineno"></span><span class="keyword" id="6013913">func</span>&nbsp;<span class="op" id="6013918">(</span><span class="ident" id="6013919">tr</span>&nbsp;<span class="op" id="6013922">*</span><span class="ident" id="6013923">Reader</span><span class="op" id="6013929">)</span>&nbsp;<span class="ident" id="6013931">Read</span><span class="op" id="6013935">(</span><span class="ident" id="6013936">b</span>&nbsp;<span class="op" id="6013938">[</span><span class="op" id="6013939">]</span><span class="builtintype" id="6013940">byte</span><span class="op" id="6013944">)</span>&nbsp;<span class="op" id="6013946">(</span><span class="ident" id="6013947">n</span>&nbsp;<span class="builtintype" id="6013949">int</span><span class="op" id="6013952">,</span>&nbsp;<span class="ident" id="6013954">err</span>&nbsp;<span class="builtintype" id="6013958">error</span><span class="op" id="6013963">)</span>&nbsp;<span class="op" id="6013965">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6013968">if</span>&nbsp;<span class="ident" id="6013971">tr</span><span class="op" id="6013973">.</span><span class="ident" id="6013974">curr</span>&nbsp;<span class="op" id="6013979">==</span>&nbsp;<span class="builtintype" id="6013982">nil</span>&nbsp;<span class="op" id="6013986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6013990">return</span>&nbsp;<span class="num" id="6013997">0</span><span class="op" id="6013998">,</span>&nbsp;<span class="ident" id="6014000">io</span><span class="op" id="6014002">.</span><span class="ident" id="6014003">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6014008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6014011">n</span><span class="op" id="6014012">,</span>&nbsp;<span class="ident" id="6014014">err</span>&nbsp;<span class="op" id="6014018">=</span>&nbsp;<span class="ident" id="6014020">tr</span><span class="op" id="6014022">.</span><span class="ident" id="6014023">curr</span><span class="op" id="6014027">.</span><span class="ident" id="6014028">Read</span><span class="op" id="6014032">(</span><span class="ident" id="6014033">b</span><span class="op" id="6014034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6014037">if</span>&nbsp;<span class="ident" id="6014040">err</span>&nbsp;<span class="op" id="6014044">!=</span>&nbsp;<span class="builtintype" id="6014047">nil</span>&nbsp;<span class="op" id="6014051">&amp;&amp;</span>&nbsp;<span class="ident" id="6014054">err</span>&nbsp;<span class="op" id="6014058">!=</span>&nbsp;<span class="ident" id="6014061">io</span><span class="op" id="6014063">.</span><span class="ident" id="6014064">EOF</span>&nbsp;<span class="op" id="6014068">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6014072">tr</span><span class="op" id="6014074">.</span><span class="ident" id="6014075">err</span>&nbsp;<span class="op" id="6014079">=</span>&nbsp;<span class="ident" id="6014081">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6014086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6014089">return</span><br>
<span class="lineno"></span><span class="op" id="6014096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="6014099">func</span>&nbsp;<span class="op" id="6014104">(</span><span class="ident" id="6014105">rfr</span>&nbsp;<span class="op" id="6014109">*</span><span class="ident" id="6014110">regFileReader</span><span class="op" id="6014123">)</span>&nbsp;<span class="ident" id="6014125">Read</span><span class="op" id="6014129">(</span><span class="ident" id="6014130">b</span>&nbsp;<span class="op" id="6014132">[</span><span class="op" id="6014133">]</span><span class="builtintype" id="6014134">byte</span><span class="op" id="6014138">)</span>&nbsp;<span class="op" id="6014140">(</span><span class="ident" id="6014141">n</span>&nbsp;<span class="builtintype" id="6014143">int</span><span class="op" id="6014146">,</span>&nbsp;<span class="ident" id="6014148">err</span>&nbsp;<span class="builtintype" id="6014152">error</span><span class="op" id="6014157">)</span>&nbsp;<span class="op" id="6014159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6014162">if</span>&nbsp;<span class="ident" id="6014165">rfr</span><span class="op" id="6014168">.</span><span class="ident" id="6014169">nb</span>&nbsp;<span class="op" id="6014172">==</span>&nbsp;<span class="num" id="6014175">0</span>&nbsp;<span class="op" id="6014177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6014181">//&nbsp;file&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6014200">return</span>&nbsp;<span class="num" id="6014207">0</span><span class="op" id="6014208">,</span>&nbsp;<span class="ident" id="6014210">io</span><span class="op" id="6014212">.</span><span class="ident" id="6014213">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6014218">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6014221">if</span>&nbsp;<span class="ident" id="6014224">int64</span><span class="op" id="6014229">(</span><span class="builtinfunc" id="6014230">len</span><span class="op" id="6014233">(</span><span class="ident" id="6014234">b</span><span class="op" id="6014235">)</span><span class="op" id="6014236">)</span>&nbsp;<span class="op" id="6014238">&gt;</span>&nbsp;<span class="ident" id="6014240">rfr</span><span class="op" id="6014243">.</span><span class="ident" id="6014244">nb</span>&nbsp;<span class="op" id="6014247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6014251">b</span>&nbsp;<span class="op" id="6014253">=</span>&nbsp;<span class="ident" id="6014255">b</span><span class="op" id="6014256">[</span><span class="num" id="6014257">0</span><span class="op" id="6014258">:</span><span class="ident" id="6014259">rfr</span><span class="op" id="6014262">.</span><span class="ident" id="6014263">nb</span><span class="op" id="6014265">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6014268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6014271">n</span><span class="op" id="6014272">,</span>&nbsp;<span class="ident" id="6014274">err</span>&nbsp;<span class="op" id="6014278">=</span>&nbsp;<span class="ident" id="6014280">rfr</span><span class="op" id="6014283">.</span><span class="ident" id="6014284">r</span><span class="op" id="6014285">.</span><span class="ident" id="6014286">Read</span><span class="op" id="6014290">(</span><span class="ident" id="6014291">b</span><span class="op" id="6014292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6014295">rfr</span><span class="op" id="6014298">.</span><span class="ident" id="6014299">nb</span>&nbsp;<span class="op" id="6014302">-=</span>&nbsp;<span class="ident" id="6014305">int64</span><span class="op" id="6014310">(</span><span class="ident" id="6014311">n</span><span class="op" id="6014312">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6014316">if</span>&nbsp;<span class="ident" id="6014319">err</span>&nbsp;<span class="op" id="6014323">==</span>&nbsp;<span class="ident" id="6014326">io</span><span class="op" id="6014328">.</span><span class="ident" id="6014329">EOF</span>&nbsp;<span class="op" id="6014333">&amp;&amp;</span>&nbsp;<span class="ident" id="6014336">rfr</span><span class="op" id="6014339">.</span><span class="ident" id="6014340">nb</span>&nbsp;<span class="op" id="6014343">&gt;</span>&nbsp;<span class="num" id="6014345">0</span>&nbsp;<span class="op" id="6014347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6014351">err</span>&nbsp;<span class="op" id="6014355">=</span>&nbsp;<span class="ident" id="6014357">io</span><span class="op" id="6014359">.</span><span class="ident" id="6014360">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6014378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6014381">return</span><br>
<span class="lineno">755</span><span class="op" id="6014388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6014391">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6014483">func</span>&nbsp;<span class="op" id="6014488">(</span><span class="ident" id="6014489">rfr</span>&nbsp;<span class="op" id="6014493">*</span><span class="ident" id="6014494">regFileReader</span><span class="op" id="6014507">)</span>&nbsp;<span class="ident" id="6014509">numBytes</span><span class="op" id="6014517">(</span><span class="op" id="6014518">)</span>&nbsp;<span class="ident" id="6014520">int64</span>&nbsp;<span class="op" id="6014526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6014529">return</span>&nbsp;<span class="ident" id="6014536">rfr</span><span class="op" id="6014539">.</span><span class="ident" id="6014540">nb</span><br>
<span class="lineno">760</span><span class="op" id="6014543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6014546">//&nbsp;readHole&nbsp;reads&nbsp;a&nbsp;sparse&nbsp;file&nbsp;hole&nbsp;ending&nbsp;at&nbsp;offset&nbsp;toOffset</span><br>
<span class="lineno"></span><span class="keyword" id="6014609">func</span>&nbsp;<span class="op" id="6014614">(</span><span class="ident" id="6014615">sfr</span>&nbsp;<span class="op" id="6014619">*</span><span class="ident" id="6014620">sparseFileReader</span><span class="op" id="6014636">)</span>&nbsp;<span class="ident" id="6014638">readHole</span><span class="op" id="6014646">(</span><span class="ident" id="6014647">b</span>&nbsp;<span class="op" id="6014649">[</span><span class="op" id="6014650">]</span><span class="builtintype" id="6014651">byte</span><span class="op" id="6014655">,</span>&nbsp;<span class="ident" id="6014657">toOffset</span>&nbsp;<span class="ident" id="6014666">int64</span><span class="op" id="6014671">)</span>&nbsp;<span class="builtintype" id="6014673">int</span>&nbsp;<span class="op" id="6014677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6014680">n64</span>&nbsp;<span class="op" id="6014684">:=</span>&nbsp;<span class="ident" id="6014687">toOffset</span>&nbsp;<span class="op" id="6014696">-</span>&nbsp;<span class="ident" id="6014698">sfr</span><span class="op" id="6014701">.</span><span class="ident" id="6014702">pos</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6014707">if</span>&nbsp;<span class="ident" id="6014710">n64</span>&nbsp;<span class="op" id="6014714">&gt;</span>&nbsp;<span class="ident" id="6014716">int64</span><span class="op" id="6014721">(</span><span class="builtinfunc" id="6014722">len</span><span class="op" id="6014725">(</span><span class="ident" id="6014726">b</span><span class="op" id="6014727">)</span><span class="op" id="6014728">)</span>&nbsp;<span class="op" id="6014730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6014734">n64</span>&nbsp;<span class="op" id="6014738">=</span>&nbsp;<span class="ident" id="6014740">int64</span><span class="op" id="6014745">(</span><span class="builtinfunc" id="6014746">len</span><span class="op" id="6014749">(</span><span class="ident" id="6014750">b</span><span class="op" id="6014751">)</span><span class="op" id="6014752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6014755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6014758">n</span>&nbsp;<span class="op" id="6014760">:=</span>&nbsp;<span class="builtintype" id="6014763">int</span><span class="op" id="6014766">(</span><span class="ident" id="6014767">n64</span><span class="op" id="6014770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6014773">for</span>&nbsp;<span class="ident" id="6014777">i</span>&nbsp;<span class="op" id="6014779">:=</span>&nbsp;<span class="num" id="6014782">0</span><span class="op" id="6014783">;</span>&nbsp;<span class="ident" id="6014785">i</span>&nbsp;<span class="op" id="6014787">&lt;</span>&nbsp;<span class="ident" id="6014789">n</span><span class="op" id="6014790">;</span>&nbsp;<span class="ident" id="6014792">i</span><span class="op" id="6014793">++</span>&nbsp;<span class="op" id="6014796">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6014800">b</span><span class="op" id="6014801">[</span><span class="ident" id="6014802">i</span><span class="op" id="6014803">]</span>&nbsp;<span class="op" id="6014805">=</span>&nbsp;<span class="num" id="6014807">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6014810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6014813">sfr</span><span class="op" id="6014816">.</span><span class="ident" id="6014817">pos</span>&nbsp;<span class="op" id="6014821">+=</span>&nbsp;<span class="ident" id="6014824">n64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6014829">return</span>&nbsp;<span class="ident" id="6014836">n</span><br>
<span class="lineno"></span><span class="op" id="6014838">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="6014841">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;file&nbsp;data&nbsp;in&nbsp;expanded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="6014894">func</span>&nbsp;<span class="op" id="6014899">(</span><span class="ident" id="6014900">sfr</span>&nbsp;<span class="op" id="6014904">*</span><span class="ident" id="6014905">sparseFileReader</span><span class="op" id="6014921">)</span>&nbsp;<span class="ident" id="6014923">Read</span><span class="op" id="6014927">(</span><span class="ident" id="6014928">b</span>&nbsp;<span class="op" id="6014930">[</span><span class="op" id="6014931">]</span><span class="builtintype" id="6014932">byte</span><span class="op" id="6014936">)</span>&nbsp;<span class="op" id="6014938">(</span><span class="ident" id="6014939">n</span>&nbsp;<span class="builtintype" id="6014941">int</span><span class="op" id="6014944">,</span>&nbsp;<span class="ident" id="6014946">err</span>&nbsp;<span class="builtintype" id="6014950">error</span><span class="op" id="6014955">)</span>&nbsp;<span class="op" id="6014957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6014960">if</span>&nbsp;<span class="builtinfunc" id="6014963">len</span><span class="op" id="6014966">(</span><span class="ident" id="6014967">sfr</span><span class="op" id="6014970">.</span><span class="ident" id="6014971">sp</span><span class="op" id="6014973">)</span>&nbsp;<span class="op" id="6014975">==</span>&nbsp;<span class="num" id="6014978">0</span>&nbsp;<span class="op" id="6014980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6014984">//&nbsp;No&nbsp;more&nbsp;data&nbsp;fragments&nbsp;to&nbsp;read&nbsp;from.</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6015026">if</span>&nbsp;<span class="ident" id="6015029">sfr</span><span class="op" id="6015032">.</span><span class="ident" id="6015033">pos</span>&nbsp;<span class="op" id="6015037">&lt;</span>&nbsp;<span class="ident" id="6015039">sfr</span><span class="op" id="6015042">.</span><span class="ident" id="6015043">tot</span>&nbsp;<span class="op" id="6015047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6015052">//&nbsp;We&#39;re&nbsp;in&nbsp;the&nbsp;last&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6015081">n</span>&nbsp;<span class="op" id="6015083">=</span>&nbsp;<span class="ident" id="6015085">sfr</span><span class="op" id="6015088">.</span><span class="ident" id="6015089">readHole</span><span class="op" id="6015097">(</span><span class="ident" id="6015098">b</span><span class="op" id="6015099">,</span>&nbsp;<span class="ident" id="6015101">sfr</span><span class="op" id="6015104">.</span><span class="ident" id="6015105">tot</span><span class="op" id="6015108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6015113">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6015122">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6015126">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6015171">return</span>&nbsp;<span class="num" id="6015178">0</span><span class="op" id="6015179">,</span>&nbsp;<span class="ident" id="6015181">io</span><span class="op" id="6015183">.</span><span class="ident" id="6015184">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6015189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6015192">if</span>&nbsp;<span class="ident" id="6015195">sfr</span><span class="op" id="6015198">.</span><span class="ident" id="6015199">pos</span>&nbsp;<span class="op" id="6015203">&lt;</span>&nbsp;<span class="ident" id="6015205">sfr</span><span class="op" id="6015208">.</span><span class="ident" id="6015209">sp</span><span class="op" id="6015211">[</span><span class="num" id="6015212">0</span><span class="op" id="6015213">]</span><span class="op" id="6015214">.</span><span class="ident" id="6015215">offset</span>&nbsp;<span class="op" id="6015222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6015226">//&nbsp;We&#39;re&nbsp;in&nbsp;a&nbsp;hole</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6015247">n</span>&nbsp;<span class="op" id="6015249">=</span>&nbsp;<span class="ident" id="6015251">sfr</span><span class="op" id="6015254">.</span><span class="ident" id="6015255">readHole</span><span class="op" id="6015263">(</span><span class="ident" id="6015264">b</span><span class="op" id="6015265">,</span>&nbsp;<span class="ident" id="6015267">sfr</span><span class="op" id="6015270">.</span><span class="ident" id="6015271">sp</span><span class="op" id="6015273">[</span><span class="num" id="6015274">0</span><span class="op" id="6015275">]</span><span class="op" id="6015276">.</span><span class="ident" id="6015277">offset</span><span class="op" id="6015283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6015287">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6015295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6015299">//&nbsp;We&#39;re&nbsp;not&nbsp;in&nbsp;a&nbsp;hole,&nbsp;so&nbsp;we&#39;ll&nbsp;read&nbsp;from&nbsp;the&nbsp;next&nbsp;data&nbsp;fragment</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6015366">posInFragment</span>&nbsp;<span class="op" id="6015380">:=</span>&nbsp;<span class="ident" id="6015383">sfr</span><span class="op" id="6015386">.</span><span class="ident" id="6015387">pos</span>&nbsp;<span class="op" id="6015391">-</span>&nbsp;<span class="ident" id="6015393">sfr</span><span class="op" id="6015396">.</span><span class="ident" id="6015397">sp</span><span class="op" id="6015399">[</span><span class="num" id="6015400">0</span><span class="op" id="6015401">]</span><span class="op" id="6015402">.</span><span class="ident" id="6015403">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6015411">bytesLeft</span>&nbsp;<span class="op" id="6015421">:=</span>&nbsp;<span class="ident" id="6015424">sfr</span><span class="op" id="6015427">.</span><span class="ident" id="6015428">sp</span><span class="op" id="6015430">[</span><span class="num" id="6015431">0</span><span class="op" id="6015432">]</span><span class="op" id="6015433">.</span><span class="ident" id="6015434">numBytes</span>&nbsp;<span class="op" id="6015443">-</span>&nbsp;<span class="ident" id="6015445">posInFragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6015460">if</span>&nbsp;<span class="ident" id="6015463">int64</span><span class="op" id="6015468">(</span><span class="builtinfunc" id="6015469">len</span><span class="op" id="6015472">(</span><span class="ident" id="6015473">b</span><span class="op" id="6015474">)</span><span class="op" id="6015475">)</span>&nbsp;<span class="op" id="6015477">&gt;</span>&nbsp;<span class="ident" id="6015479">bytesLeft</span>&nbsp;<span class="op" id="6015489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6015493">b</span>&nbsp;<span class="op" id="6015495">=</span>&nbsp;<span class="ident" id="6015497">b</span><span class="op" id="6015498">[</span><span class="num" id="6015499">0</span><span class="op" id="6015500">:</span><span class="ident" id="6015501">bytesLeft</span><span class="op" id="6015510">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6015513">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6015517">n</span><span class="op" id="6015518">,</span>&nbsp;<span class="ident" id="6015520">err</span>&nbsp;<span class="op" id="6015524">=</span>&nbsp;<span class="ident" id="6015526">sfr</span><span class="op" id="6015529">.</span><span class="ident" id="6015530">rfr</span><span class="op" id="6015533">.</span><span class="ident" id="6015534">Read</span><span class="op" id="6015538">(</span><span class="ident" id="6015539">b</span><span class="op" id="6015540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6015543">sfr</span><span class="op" id="6015546">.</span><span class="ident" id="6015547">pos</span>&nbsp;<span class="op" id="6015551">+=</span>&nbsp;<span class="ident" id="6015554">int64</span><span class="op" id="6015559">(</span><span class="ident" id="6015560">n</span><span class="op" id="6015561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6015565">if</span>&nbsp;<span class="ident" id="6015568">int64</span><span class="op" id="6015573">(</span><span class="ident" id="6015574">n</span><span class="op" id="6015575">)</span>&nbsp;<span class="op" id="6015577">==</span>&nbsp;<span class="ident" id="6015580">bytesLeft</span>&nbsp;<span class="op" id="6015590">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6015594">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6015629">sfr</span><span class="op" id="6015632">.</span><span class="ident" id="6015633">sp</span>&nbsp;<span class="op" id="6015636">=</span>&nbsp;<span class="ident" id="6015638">sfr</span><span class="op" id="6015641">.</span><span class="ident" id="6015642">sp</span><span class="op" id="6015644">[</span><span class="num" id="6015645">1</span><span class="op" id="6015646">:</span><span class="op" id="6015647">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6015650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6015654">if</span>&nbsp;<span class="ident" id="6015657">err</span>&nbsp;<span class="op" id="6015661">==</span>&nbsp;<span class="ident" id="6015664">io</span><span class="op" id="6015666">.</span><span class="ident" id="6015667">EOF</span>&nbsp;<span class="op" id="6015671">&amp;&amp;</span>&nbsp;<span class="ident" id="6015674">sfr</span><span class="op" id="6015677">.</span><span class="ident" id="6015678">pos</span>&nbsp;<span class="op" id="6015682">&lt;</span>&nbsp;<span class="ident" id="6015684">sfr</span><span class="op" id="6015687">.</span><span class="ident" id="6015688">tot</span>&nbsp;<span class="op" id="6015692">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6015696">//&nbsp;We&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;last&nbsp;fragment&#39;s&nbsp;data,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;final&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6015774">err</span>&nbsp;<span class="op" id="6015778">=</span>&nbsp;<span class="builtintype" id="6015780">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6015785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6015788">return</span><br>
<span class="lineno"></span><span class="op" id="6015795">}</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="6015798">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;sparse&nbsp;file&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="6015872">//&nbsp;sparse-encoded&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6015915">func</span>&nbsp;<span class="op" id="6015920">(</span><span class="ident" id="6015921">sfr</span>&nbsp;<span class="op" id="6015925">*</span><span class="ident" id="6015926">sparseFileReader</span><span class="op" id="6015942">)</span>&nbsp;<span class="ident" id="6015944">numBytes</span><span class="op" id="6015952">(</span><span class="op" id="6015953">)</span>&nbsp;<span class="ident" id="6015955">int64</span>&nbsp;<span class="op" id="6015961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6015964">return</span>&nbsp;<span class="ident" id="6015971">sfr</span><span class="op" id="6015974">.</span><span class="ident" id="6015975">rfr</span><span class="op" id="6015978">.</span><span class="ident" id="6015979">nb</span><br>
<span class="lineno">820</span><span class="op" id="6015982">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
