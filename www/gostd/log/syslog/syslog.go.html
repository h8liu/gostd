<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>log/syslog</h2>
<ul>
<li><a href="/gostd/log/syslog/syslog.go.html" class="current">syslog.go</a></li>
<li><a href="/gostd/log/syslog/syslog_test.go.html">syslog_test.go</a></li>
<li><a href="/gostd/log/syslog/syslog_unix.go.html">syslog_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6066731">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6066786">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6066840">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6066891">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6066924">//&nbsp;Package&nbsp;syslog&nbsp;provides&nbsp;a&nbsp;simple&nbsp;interface&nbsp;to&nbsp;the&nbsp;system&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="6066988">//&nbsp;service.&nbsp;It&nbsp;can&nbsp;send&nbsp;messages&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon&nbsp;using&nbsp;UNIX</span><br>
<span class="lineno"></span><span class="comment" id="6067053">//&nbsp;domain&nbsp;sockets,&nbsp;UDP&nbsp;or&nbsp;TCP.</span><br>
<span class="lineno">10</span><span class="comment" id="6067084">//</span><br>
<span class="lineno"></span><span class="comment" id="6067087">//&nbsp;Only&nbsp;one&nbsp;call&nbsp;to&nbsp;Dial&nbsp;is&nbsp;necessary.&nbsp;On&nbsp;write&nbsp;failures,</span><br>
<span class="lineno"></span><span class="comment" id="6067145">//&nbsp;the&nbsp;syslog&nbsp;client&nbsp;will&nbsp;attempt&nbsp;to&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="6067206">//&nbsp;and&nbsp;write&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="6067226">package</span>&nbsp;<span class="ident" id="6067234">syslog</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6067242">import</span>&nbsp;<span class="op" id="6067249">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6067252">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6067262">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6067269">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6067276">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6067283">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6067289">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6067300">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6067308">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6067315">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6067318">//&nbsp;The&nbsp;Priority&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;syslog&nbsp;facility&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6067378">//&nbsp;severity.&nbsp;For&nbsp;example,&nbsp;LOG_ALERT&nbsp;|&nbsp;LOG_FTP&nbsp;sends&nbsp;an&nbsp;alert&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6067448">//&nbsp;message&nbsp;from&nbsp;the&nbsp;FTP&nbsp;facility.&nbsp;The&nbsp;default&nbsp;severity&nbsp;is&nbsp;LOG_EMERG;</span><br>
<span class="lineno">30</span><span class="comment" id="6067517">//&nbsp;the&nbsp;default&nbsp;facility&nbsp;is&nbsp;LOG_KERN.</span><br>
<span class="lineno"></span><span class="keyword" id="6067554">type</span>&nbsp;<span class="ident" id="6067559">Priority</span>&nbsp;<span class="builtintype" id="6067568">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6067573">const</span>&nbsp;<span class="ident" id="6067579">severityMask</span>&nbsp;<span class="op" id="6067592">=</span>&nbsp;<span class="num" id="6067594">0x07</span><br>
<span class="lineno"></span><span class="keyword" id="6067599">const</span>&nbsp;<span class="ident" id="6067605">facilityMask</span>&nbsp;<span class="op" id="6067618">=</span>&nbsp;<span class="num" id="6067620">0xf8</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6067626">const</span>&nbsp;<span class="op" id="6067632">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067635">//&nbsp;Severity.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067650">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067686">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067734">LOG_EMERG</span>&nbsp;<span class="ident" id="6067744">Priority</span>&nbsp;<span class="op" id="6067753">=</span>&nbsp;<span class="ident" id="6067755">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067761">LOG_ALERT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067772">LOG_CRIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067782">LOG_ERR</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067791">LOG_WARNING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067804">LOG_NOTICE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067816">LOG_INFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067826">LOG_DEBUG</span><br>
<span class="lineno"></span><span class="op" id="6067836">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6067839">const</span>&nbsp;<span class="op" id="6067845">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067848">//&nbsp;Facility.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067863">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067899">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;up&nbsp;to&nbsp;LOG_FTP&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067961">LOG_KERN</span>&nbsp;<span class="ident" id="6067970">Priority</span>&nbsp;<span class="op" id="6067979">=</span>&nbsp;<span class="ident" id="6067981">iota</span>&nbsp;<span class="op" id="6067986">&lt;&lt;</span>&nbsp;<span class="num" id="6067989">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067992">LOG_USER</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068002">LOG_MAIL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068012">LOG_DAEMON</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068024">LOG_AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068034">LOG_SYSLOG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068046">LOG_LPR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068055">LOG_NEWS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068065">LOG_UUCP</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068075">LOG_CRON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068085">LOG_AUTHPRIV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068099">LOG_FTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068108">_</span>&nbsp;<span class="comment" id="6068110">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068121">_</span>&nbsp;<span class="comment" id="6068123">//&nbsp;unused</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068134">_</span>&nbsp;<span class="comment" id="6068136">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068147">_</span>&nbsp;<span class="comment" id="6068149">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068160">LOG_LOCAL0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068172">LOG_LOCAL1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068184">LOG_LOCAL2</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068196">LOG_LOCAL3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068208">LOG_LOCAL4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068220">LOG_LOCAL5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068232">LOG_LOCAL6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068244">LOG_LOCAL7</span><br>
<span class="lineno">80</span><span class="op" id="6068255">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6068258">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6068306">type</span>&nbsp;<span class="ident" id="6068311">Writer</span>&nbsp;<span class="keyword" id="6068318">struct</span>&nbsp;<span class="op" id="6068325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068328">priority</span>&nbsp;<span class="ident" id="6068337">Priority</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068347">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6068356">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068364">hostname</span>&nbsp;<span class="builtintype" id="6068373">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068381">network</span>&nbsp;&nbsp;<span class="builtintype" id="6068390">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068398">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6068407">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068416">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6068421">sync</span><span class="op" id="6068425">.</span><span class="ident" id="6068426">Mutex</span>&nbsp;<span class="comment" id="6068432">//&nbsp;guards&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068448">conn</span>&nbsp;<span class="ident" id="6068453">serverConn</span><br>
<span class="lineno"></span><span class="op" id="6068464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6068467">//&nbsp;This&nbsp;interface&nbsp;and&nbsp;the&nbsp;separate&nbsp;syslog_unix.go&nbsp;file&nbsp;exist&nbsp;for</span><br>
<span class="lineno">95</span><span class="comment" id="6068532">//&nbsp;Solaris&nbsp;support&nbsp;as&nbsp;implemented&nbsp;by&nbsp;gccgo.&nbsp;&nbsp;On&nbsp;Solaris&nbsp;you&nbsp;can&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6068600">//&nbsp;simply&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.&nbsp;&nbsp;The&nbsp;gccgo</span><br>
<span class="lineno"></span><span class="comment" id="6068665">//&nbsp;sources&nbsp;have&nbsp;a&nbsp;syslog_solaris.go&nbsp;file&nbsp;that&nbsp;implements&nbsp;unixSyslog&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6068736">//&nbsp;return&nbsp;a&nbsp;type&nbsp;that&nbsp;satisfies&nbsp;this&nbsp;interface&nbsp;and&nbsp;simply&nbsp;calls&nbsp;the&nbsp;C</span><br>
<span class="lineno"></span><span class="comment" id="6068806">//&nbsp;library&nbsp;syslog&nbsp;function.</span><br>
<span class="lineno">100</span><span class="keyword" id="6068834">type</span>&nbsp;<span class="ident" id="6068839">serverConn</span>&nbsp;<span class="keyword" id="6068850">interface</span>&nbsp;<span class="op" id="6068860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068863">writeString</span><span class="op" id="6068874">(</span><span class="ident" id="6068875">p</span>&nbsp;<span class="ident" id="6068877">Priority</span><span class="op" id="6068885">,</span>&nbsp;<span class="ident" id="6068887">hostname</span><span class="op" id="6068895">,</span>&nbsp;<span class="ident" id="6068897">tag</span><span class="op" id="6068900">,</span>&nbsp;<span class="ident" id="6068902">s</span><span class="op" id="6068903">,</span>&nbsp;<span class="ident" id="6068905">nl</span>&nbsp;<span class="builtintype" id="6068908">string</span><span class="op" id="6068914">)</span>&nbsp;<span class="builtintype" id="6068916">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6068923">close</span><span class="op" id="6068928">(</span><span class="op" id="6068929">)</span>&nbsp;<span class="builtintype" id="6068931">error</span><br>
<span class="lineno"></span><span class="op" id="6068937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6068940">type</span>&nbsp;<span class="ident" id="6068945">netConn</span>&nbsp;<span class="keyword" id="6068953">struct</span>&nbsp;<span class="op" id="6068960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068963">local</span>&nbsp;<span class="builtintype" id="6068969">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068975">conn</span>&nbsp;&nbsp;<span class="ident" id="6068981">net</span><span class="op" id="6068984">.</span><span class="ident" id="6068985">Conn</span><br>
<span class="lineno"></span><span class="op" id="6068990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6068993">//&nbsp;New&nbsp;establishes&nbsp;a&nbsp;new&nbsp;connection&nbsp;to&nbsp;the&nbsp;system&nbsp;log&nbsp;daemon.&nbsp;&nbsp;Each</span><br>
<span class="lineno"></span><span class="comment" id="6069061">//&nbsp;write&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6069128">//&nbsp;priority&nbsp;and&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6069152">func</span>&nbsp;<span class="ident" id="6069157">New</span><span class="op" id="6069160">(</span><span class="ident" id="6069161">priority</span>&nbsp;<span class="ident" id="6069170">Priority</span><span class="op" id="6069178">,</span>&nbsp;<span class="ident" id="6069180">tag</span>&nbsp;<span class="builtintype" id="6069184">string</span><span class="op" id="6069190">)</span>&nbsp;<span class="op" id="6069192">(</span><span class="ident" id="6069193">w</span>&nbsp;<span class="op" id="6069195">*</span><span class="ident" id="6069196">Writer</span><span class="op" id="6069202">,</span>&nbsp;<span class="ident" id="6069204">err</span>&nbsp;<span class="builtintype" id="6069208">error</span><span class="op" id="6069213">)</span>&nbsp;<span class="op" id="6069215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069218">return</span>&nbsp;<span class="ident" id="6069225">Dial</span><span class="op" id="6069229">(</span><span class="string" id="6069230">&#34;&#34;</span><span class="op" id="6069232">,</span>&nbsp;<span class="string" id="6069234">&#34;&#34;</span><span class="op" id="6069236">,</span>&nbsp;<span class="ident" id="6069238">priority</span><span class="op" id="6069246">,</span>&nbsp;<span class="ident" id="6069248">tag</span><span class="op" id="6069251">)</span><br>
<span class="lineno">115</span><span class="op" id="6069253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6069256">//&nbsp;Dial&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;log&nbsp;daemon&nbsp;by&nbsp;connecting&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6069322">//&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;specified&nbsp;network.&nbsp;&nbsp;Each&nbsp;write&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6069393">//&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given&nbsp;facility,&nbsp;severity&nbsp;and</span><br>
<span class="lineno">120</span><span class="comment" id="6069461">//&nbsp;tag.</span><br>
<span class="lineno"></span><span class="comment" id="6069469">//&nbsp;If&nbsp;network&nbsp;is&nbsp;empty,&nbsp;Dial&nbsp;will&nbsp;connect&nbsp;to&nbsp;the&nbsp;local&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6069539">func</span>&nbsp;<span class="ident" id="6069544">Dial</span><span class="op" id="6069548">(</span><span class="ident" id="6069549">network</span><span class="op" id="6069556">,</span>&nbsp;<span class="ident" id="6069558">raddr</span>&nbsp;<span class="builtintype" id="6069564">string</span><span class="op" id="6069570">,</span>&nbsp;<span class="ident" id="6069572">priority</span>&nbsp;<span class="ident" id="6069581">Priority</span><span class="op" id="6069589">,</span>&nbsp;<span class="ident" id="6069591">tag</span>&nbsp;<span class="builtintype" id="6069595">string</span><span class="op" id="6069601">)</span>&nbsp;<span class="op" id="6069603">(</span><span class="op" id="6069604">*</span><span class="ident" id="6069605">Writer</span><span class="op" id="6069611">,</span>&nbsp;<span class="builtintype" id="6069613">error</span><span class="op" id="6069618">)</span>&nbsp;<span class="op" id="6069620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069623">if</span>&nbsp;<span class="ident" id="6069626">priority</span>&nbsp;<span class="op" id="6069635">&lt;</span>&nbsp;<span class="num" id="6069637">0</span>&nbsp;<span class="op" id="6069639">||</span>&nbsp;<span class="ident" id="6069642">priority</span>&nbsp;<span class="op" id="6069651">&gt;</span>&nbsp;<span class="ident" id="6069653">LOG_LOCAL7</span><span class="op" id="6069663">|</span><span class="ident" id="6069664">LOG_DEBUG</span>&nbsp;<span class="op" id="6069674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069678">return</span>&nbsp;<span class="ident" id="6069685">nil</span><span class="op" id="6069688">,</span>&nbsp;<span class="ident" id="6069690">errors</span><span class="op" id="6069696">.</span><span class="ident" id="6069697">New</span><span class="op" id="6069700">(</span><span class="string" id="6069701">&#34;log/syslog:&nbsp;invalid&nbsp;priority&#34;</span><span class="op" id="6069731">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069738">if</span>&nbsp;<span class="ident" id="6069741">tag</span>&nbsp;<span class="op" id="6069745">==</span>&nbsp;<span class="string" id="6069748">&#34;&#34;</span>&nbsp;<span class="op" id="6069751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069755">tag</span>&nbsp;<span class="op" id="6069759">=</span>&nbsp;<span class="ident" id="6069761">os</span><span class="op" id="6069763">.</span><span class="ident" id="6069764">Args</span><span class="op" id="6069768">[</span><span class="num" id="6069769">0</span><span class="op" id="6069770">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069773">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069776">hostname</span><span class="op" id="6069784">,</span>&nbsp;<span class="ident" id="6069786">_</span>&nbsp;<span class="op" id="6069788">:=</span>&nbsp;<span class="ident" id="6069791">os</span><span class="op" id="6069793">.</span><span class="ident" id="6069794">Hostname</span><span class="op" id="6069802">(</span><span class="op" id="6069803">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069807">w</span>&nbsp;<span class="op" id="6069809">:=</span>&nbsp;<span class="op" id="6069812">&amp;</span><span class="ident" id="6069813">Writer</span><span class="op" id="6069819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069823">priority</span><span class="op" id="6069831">:</span>&nbsp;<span class="ident" id="6069833">priority</span><span class="op" id="6069841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069845">tag</span><span class="op" id="6069848">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069855">tag</span><span class="op" id="6069858">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069862">hostname</span><span class="op" id="6069870">:</span>&nbsp;<span class="ident" id="6069872">hostname</span><span class="op" id="6069880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069884">network</span><span class="op" id="6069891">:</span>&nbsp;&nbsp;<span class="ident" id="6069894">network</span><span class="op" id="6069901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069905">raddr</span><span class="op" id="6069910">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069915">raddr</span><span class="op" id="6069920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069927">w</span><span class="op" id="6069928">.</span><span class="ident" id="6069929">mu</span><span class="op" id="6069931">.</span><span class="ident" id="6069932">Lock</span><span class="op" id="6069936">(</span><span class="op" id="6069937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069940">defer</span>&nbsp;<span class="ident" id="6069946">w</span><span class="op" id="6069947">.</span><span class="ident" id="6069948">mu</span><span class="op" id="6069950">.</span><span class="ident" id="6069951">Unlock</span><span class="op" id="6069957">(</span><span class="op" id="6069958">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069962">err</span>&nbsp;<span class="op" id="6069966">:=</span>&nbsp;<span class="ident" id="6069969">w</span><span class="op" id="6069970">.</span><span class="ident" id="6069971">connect</span><span class="op" id="6069978">(</span><span class="op" id="6069979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069982">if</span>&nbsp;<span class="ident" id="6069985">err</span>&nbsp;<span class="op" id="6069989">!=</span>&nbsp;<span class="ident" id="6069992">nil</span>&nbsp;<span class="op" id="6069996">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070000">return</span>&nbsp;<span class="ident" id="6070007">nil</span><span class="op" id="6070010">,</span>&nbsp;<span class="ident" id="6070012">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070020">return</span>&nbsp;<span class="ident" id="6070027">w</span><span class="op" id="6070028">,</span>&nbsp;<span class="ident" id="6070030">err</span><br>
<span class="lineno"></span><span class="op" id="6070034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6070037">//&nbsp;connect&nbsp;makes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6070089">//&nbsp;It&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;w.mu&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="6070126">func</span>&nbsp;<span class="op" id="6070131">(</span><span class="ident" id="6070132">w</span>&nbsp;<span class="op" id="6070134">*</span><span class="ident" id="6070135">Writer</span><span class="op" id="6070141">)</span>&nbsp;<span class="ident" id="6070143">connect</span><span class="op" id="6070150">(</span><span class="op" id="6070151">)</span>&nbsp;<span class="op" id="6070153">(</span><span class="ident" id="6070154">err</span>&nbsp;<span class="builtintype" id="6070158">error</span><span class="op" id="6070163">)</span>&nbsp;<span class="op" id="6070165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070168">if</span>&nbsp;<span class="ident" id="6070171">w</span><span class="op" id="6070172">.</span><span class="ident" id="6070173">conn</span>&nbsp;<span class="op" id="6070178">!=</span>&nbsp;<span class="ident" id="6070181">nil</span>&nbsp;<span class="op" id="6070185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070189">//&nbsp;ignore&nbsp;err&nbsp;from&nbsp;close,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;continue&nbsp;anyway</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070251">w</span><span class="op" id="6070252">.</span><span class="ident" id="6070253">conn</span><span class="op" id="6070257">.</span><span class="builtinfunc" id="6070258">close</span><span class="op" id="6070263">(</span><span class="op" id="6070264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070268">w</span><span class="op" id="6070269">.</span><span class="ident" id="6070270">conn</span>&nbsp;<span class="op" id="6070275">=</span>&nbsp;<span class="ident" id="6070277">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070286">if</span>&nbsp;<span class="ident" id="6070289">w</span><span class="op" id="6070290">.</span><span class="ident" id="6070291">network</span>&nbsp;<span class="op" id="6070299">==</span>&nbsp;<span class="string" id="6070302">&#34;&#34;</span>&nbsp;<span class="op" id="6070305">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070309">w</span><span class="op" id="6070310">.</span><span class="ident" id="6070311">conn</span><span class="op" id="6070315">,</span>&nbsp;<span class="ident" id="6070317">err</span>&nbsp;<span class="op" id="6070321">=</span>&nbsp;<span class="ident" id="6070323">unixSyslog</span><span class="op" id="6070333">(</span><span class="op" id="6070334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070338">if</span>&nbsp;<span class="ident" id="6070341">w</span><span class="op" id="6070342">.</span><span class="ident" id="6070343">hostname</span>&nbsp;<span class="op" id="6070352">==</span>&nbsp;<span class="string" id="6070355">&#34;&#34;</span>&nbsp;<span class="op" id="6070358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070363">w</span><span class="op" id="6070364">.</span><span class="ident" id="6070365">hostname</span>&nbsp;<span class="op" id="6070374">=</span>&nbsp;<span class="string" id="6070376">&#34;localhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070393">}</span>&nbsp;<span class="keyword" id="6070395">else</span>&nbsp;<span class="op" id="6070400">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070404">var</span>&nbsp;<span class="ident" id="6070408">c</span>&nbsp;<span class="ident" id="6070410">net</span><span class="op" id="6070413">.</span><span class="ident" id="6070414">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070421">c</span><span class="op" id="6070422">,</span>&nbsp;<span class="ident" id="6070424">err</span>&nbsp;<span class="op" id="6070428">=</span>&nbsp;<span class="ident" id="6070430">net</span><span class="op" id="6070433">.</span><span class="ident" id="6070434">Dial</span><span class="op" id="6070438">(</span><span class="ident" id="6070439">w</span><span class="op" id="6070440">.</span><span class="ident" id="6070441">network</span><span class="op" id="6070448">,</span>&nbsp;<span class="ident" id="6070450">w</span><span class="op" id="6070451">.</span><span class="ident" id="6070452">raddr</span><span class="op" id="6070457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070461">if</span>&nbsp;<span class="ident" id="6070464">err</span>&nbsp;<span class="op" id="6070468">==</span>&nbsp;<span class="ident" id="6070471">nil</span>&nbsp;<span class="op" id="6070475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070480">w</span><span class="op" id="6070481">.</span><span class="ident" id="6070482">conn</span>&nbsp;<span class="op" id="6070487">=</span>&nbsp;<span class="op" id="6070489">&amp;</span><span class="ident" id="6070490">netConn</span><span class="op" id="6070497">{</span><span class="ident" id="6070498">conn</span><span class="op" id="6070502">:</span>&nbsp;<span class="ident" id="6070504">c</span><span class="op" id="6070505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070510">if</span>&nbsp;<span class="ident" id="6070513">w</span><span class="op" id="6070514">.</span><span class="ident" id="6070515">hostname</span>&nbsp;<span class="op" id="6070524">==</span>&nbsp;<span class="string" id="6070527">&#34;&#34;</span>&nbsp;<span class="op" id="6070530">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070536">w</span><span class="op" id="6070537">.</span><span class="ident" id="6070538">hostname</span>&nbsp;<span class="op" id="6070547">=</span>&nbsp;<span class="ident" id="6070549">c</span><span class="op" id="6070550">.</span><span class="ident" id="6070551">LocalAddr</span><span class="op" id="6070560">(</span><span class="op" id="6070561">)</span><span class="op" id="6070562">.</span><span class="ident" id="6070563">String</span><span class="op" id="6070569">(</span><span class="op" id="6070570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070585">return</span><br>
<span class="lineno">175</span><span class="op" id="6070592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6070595">//&nbsp;Write&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6070646">func</span>&nbsp;<span class="op" id="6070651">(</span><span class="ident" id="6070652">w</span>&nbsp;<span class="op" id="6070654">*</span><span class="ident" id="6070655">Writer</span><span class="op" id="6070661">)</span>&nbsp;<span class="ident" id="6070663">Write</span><span class="op" id="6070668">(</span><span class="ident" id="6070669">b</span>&nbsp;<span class="op" id="6070671">[</span><span class="op" id="6070672">]</span><span class="builtintype" id="6070673">byte</span><span class="op" id="6070677">)</span>&nbsp;<span class="op" id="6070679">(</span><span class="builtintype" id="6070680">int</span><span class="op" id="6070683">,</span>&nbsp;<span class="builtintype" id="6070685">error</span><span class="op" id="6070690">)</span>&nbsp;<span class="op" id="6070692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070695">return</span>&nbsp;<span class="ident" id="6070702">w</span><span class="op" id="6070703">.</span><span class="ident" id="6070704">writeAndRetry</span><span class="op" id="6070717">(</span><span class="ident" id="6070718">w</span><span class="op" id="6070719">.</span><span class="ident" id="6070720">priority</span><span class="op" id="6070728">,</span>&nbsp;<span class="builtintype" id="6070730">string</span><span class="op" id="6070736">(</span><span class="ident" id="6070737">b</span><span class="op" id="6070738">)</span><span class="op" id="6070739">)</span><br>
<span class="lineno">180</span><span class="op" id="6070741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6070744">//&nbsp;Close&nbsp;closes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6070795">func</span>&nbsp;<span class="op" id="6070800">(</span><span class="ident" id="6070801">w</span>&nbsp;<span class="op" id="6070803">*</span><span class="ident" id="6070804">Writer</span><span class="op" id="6070810">)</span>&nbsp;<span class="ident" id="6070812">Close</span><span class="op" id="6070817">(</span><span class="op" id="6070818">)</span>&nbsp;<span class="builtintype" id="6070820">error</span>&nbsp;<span class="op" id="6070826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070829">w</span><span class="op" id="6070830">.</span><span class="ident" id="6070831">mu</span><span class="op" id="6070833">.</span><span class="ident" id="6070834">Lock</span><span class="op" id="6070838">(</span><span class="op" id="6070839">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070842">defer</span>&nbsp;<span class="ident" id="6070848">w</span><span class="op" id="6070849">.</span><span class="ident" id="6070850">mu</span><span class="op" id="6070852">.</span><span class="ident" id="6070853">Unlock</span><span class="op" id="6070859">(</span><span class="op" id="6070860">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070864">if</span>&nbsp;<span class="ident" id="6070867">w</span><span class="op" id="6070868">.</span><span class="ident" id="6070869">conn</span>&nbsp;<span class="op" id="6070874">!=</span>&nbsp;<span class="ident" id="6070877">nil</span>&nbsp;<span class="op" id="6070881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070885">err</span>&nbsp;<span class="op" id="6070889">:=</span>&nbsp;<span class="ident" id="6070892">w</span><span class="op" id="6070893">.</span><span class="ident" id="6070894">conn</span><span class="op" id="6070898">.</span><span class="builtinfunc" id="6070899">close</span><span class="op" id="6070904">(</span><span class="op" id="6070905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070909">w</span><span class="op" id="6070910">.</span><span class="ident" id="6070911">conn</span>&nbsp;<span class="op" id="6070916">=</span>&nbsp;<span class="ident" id="6070918">nil</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070924">return</span>&nbsp;<span class="ident" id="6070931">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070939">return</span>&nbsp;<span class="ident" id="6070946">nil</span><br>
<span class="lineno"></span><span class="op" id="6070950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="6070953">//&nbsp;Emerg&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_EMERG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6071024">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6071042">func</span>&nbsp;<span class="op" id="6071047">(</span><span class="ident" id="6071048">w</span>&nbsp;<span class="op" id="6071050">*</span><span class="ident" id="6071051">Writer</span><span class="op" id="6071057">)</span>&nbsp;<span class="ident" id="6071059">Emerg</span><span class="op" id="6071064">(</span><span class="ident" id="6071065">m</span>&nbsp;<span class="builtintype" id="6071067">string</span><span class="op" id="6071073">)</span>&nbsp;<span class="op" id="6071075">(</span><span class="ident" id="6071076">err</span>&nbsp;<span class="builtintype" id="6071080">error</span><span class="op" id="6071085">)</span>&nbsp;<span class="op" id="6071087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071090">_</span><span class="op" id="6071091">,</span>&nbsp;<span class="ident" id="6071093">err</span>&nbsp;<span class="op" id="6071097">=</span>&nbsp;<span class="ident" id="6071099">w</span><span class="op" id="6071100">.</span><span class="ident" id="6071101">writeAndRetry</span><span class="op" id="6071114">(</span><span class="ident" id="6071115">LOG_EMERG</span><span class="op" id="6071124">,</span>&nbsp;<span class="ident" id="6071126">m</span><span class="op" id="6071127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071130">return</span>&nbsp;<span class="ident" id="6071137">err</span><br>
<span class="lineno">200</span><span class="op" id="6071141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6071144">//&nbsp;Alert&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ALERT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6071215">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6071233">func</span>&nbsp;<span class="op" id="6071238">(</span><span class="ident" id="6071239">w</span>&nbsp;<span class="op" id="6071241">*</span><span class="ident" id="6071242">Writer</span><span class="op" id="6071248">)</span>&nbsp;<span class="ident" id="6071250">Alert</span><span class="op" id="6071255">(</span><span class="ident" id="6071256">m</span>&nbsp;<span class="builtintype" id="6071258">string</span><span class="op" id="6071264">)</span>&nbsp;<span class="op" id="6071266">(</span><span class="ident" id="6071267">err</span>&nbsp;<span class="builtintype" id="6071271">error</span><span class="op" id="6071276">)</span>&nbsp;<span class="op" id="6071278">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071281">_</span><span class="op" id="6071282">,</span>&nbsp;<span class="ident" id="6071284">err</span>&nbsp;<span class="op" id="6071288">=</span>&nbsp;<span class="ident" id="6071290">w</span><span class="op" id="6071291">.</span><span class="ident" id="6071292">writeAndRetry</span><span class="op" id="6071305">(</span><span class="ident" id="6071306">LOG_ALERT</span><span class="op" id="6071315">,</span>&nbsp;<span class="ident" id="6071317">m</span><span class="op" id="6071318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071321">return</span>&nbsp;<span class="ident" id="6071328">err</span><br>
<span class="lineno"></span><span class="op" id="6071332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6071335">//&nbsp;Crit&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_CRIT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">210</span><span class="comment" id="6071404">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6071422">func</span>&nbsp;<span class="op" id="6071427">(</span><span class="ident" id="6071428">w</span>&nbsp;<span class="op" id="6071430">*</span><span class="ident" id="6071431">Writer</span><span class="op" id="6071437">)</span>&nbsp;<span class="ident" id="6071439">Crit</span><span class="op" id="6071443">(</span><span class="ident" id="6071444">m</span>&nbsp;<span class="builtintype" id="6071446">string</span><span class="op" id="6071452">)</span>&nbsp;<span class="op" id="6071454">(</span><span class="ident" id="6071455">err</span>&nbsp;<span class="builtintype" id="6071459">error</span><span class="op" id="6071464">)</span>&nbsp;<span class="op" id="6071466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071469">_</span><span class="op" id="6071470">,</span>&nbsp;<span class="ident" id="6071472">err</span>&nbsp;<span class="op" id="6071476">=</span>&nbsp;<span class="ident" id="6071478">w</span><span class="op" id="6071479">.</span><span class="ident" id="6071480">writeAndRetry</span><span class="op" id="6071493">(</span><span class="ident" id="6071494">LOG_CRIT</span><span class="op" id="6071502">,</span>&nbsp;<span class="ident" id="6071504">m</span><span class="op" id="6071505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071508">return</span>&nbsp;<span class="ident" id="6071515">err</span><br>
<span class="lineno"></span><span class="op" id="6071519">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6071522">//&nbsp;Err&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ERR,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6071589">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6071607">func</span>&nbsp;<span class="op" id="6071612">(</span><span class="ident" id="6071613">w</span>&nbsp;<span class="op" id="6071615">*</span><span class="ident" id="6071616">Writer</span><span class="op" id="6071622">)</span>&nbsp;<span class="ident" id="6071624">Err</span><span class="op" id="6071627">(</span><span class="ident" id="6071628">m</span>&nbsp;<span class="builtintype" id="6071630">string</span><span class="op" id="6071636">)</span>&nbsp;<span class="op" id="6071638">(</span><span class="ident" id="6071639">err</span>&nbsp;<span class="builtintype" id="6071643">error</span><span class="op" id="6071648">)</span>&nbsp;<span class="op" id="6071650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071653">_</span><span class="op" id="6071654">,</span>&nbsp;<span class="ident" id="6071656">err</span>&nbsp;<span class="op" id="6071660">=</span>&nbsp;<span class="ident" id="6071662">w</span><span class="op" id="6071663">.</span><span class="ident" id="6071664">writeAndRetry</span><span class="op" id="6071677">(</span><span class="ident" id="6071678">LOG_ERR</span><span class="op" id="6071685">,</span>&nbsp;<span class="ident" id="6071687">m</span><span class="op" id="6071688">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071691">return</span>&nbsp;<span class="ident" id="6071698">err</span><br>
<span class="lineno"></span><span class="op" id="6071702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6071705">//&nbsp;Warning&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_WARNING,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6071771">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno">225</span><span class="keyword" id="6071798">func</span>&nbsp;<span class="op" id="6071803">(</span><span class="ident" id="6071804">w</span>&nbsp;<span class="op" id="6071806">*</span><span class="ident" id="6071807">Writer</span><span class="op" id="6071813">)</span>&nbsp;<span class="ident" id="6071815">Warning</span><span class="op" id="6071822">(</span><span class="ident" id="6071823">m</span>&nbsp;<span class="builtintype" id="6071825">string</span><span class="op" id="6071831">)</span>&nbsp;<span class="op" id="6071833">(</span><span class="ident" id="6071834">err</span>&nbsp;<span class="builtintype" id="6071838">error</span><span class="op" id="6071843">)</span>&nbsp;<span class="op" id="6071845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071848">_</span><span class="op" id="6071849">,</span>&nbsp;<span class="ident" id="6071851">err</span>&nbsp;<span class="op" id="6071855">=</span>&nbsp;<span class="ident" id="6071857">w</span><span class="op" id="6071858">.</span><span class="ident" id="6071859">writeAndRetry</span><span class="op" id="6071872">(</span><span class="ident" id="6071873">LOG_WARNING</span><span class="op" id="6071884">,</span>&nbsp;<span class="ident" id="6071886">m</span><span class="op" id="6071887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071890">return</span>&nbsp;<span class="ident" id="6071897">err</span><br>
<span class="lineno"></span><span class="op" id="6071901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="6071904">//&nbsp;Notice&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_NOTICE,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6071968">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6071995">func</span>&nbsp;<span class="op" id="6072000">(</span><span class="ident" id="6072001">w</span>&nbsp;<span class="op" id="6072003">*</span><span class="ident" id="6072004">Writer</span><span class="op" id="6072010">)</span>&nbsp;<span class="ident" id="6072012">Notice</span><span class="op" id="6072018">(</span><span class="ident" id="6072019">m</span>&nbsp;<span class="builtintype" id="6072021">string</span><span class="op" id="6072027">)</span>&nbsp;<span class="op" id="6072029">(</span><span class="ident" id="6072030">err</span>&nbsp;<span class="builtintype" id="6072034">error</span><span class="op" id="6072039">)</span>&nbsp;<span class="op" id="6072041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072044">_</span><span class="op" id="6072045">,</span>&nbsp;<span class="ident" id="6072047">err</span>&nbsp;<span class="op" id="6072051">=</span>&nbsp;<span class="ident" id="6072053">w</span><span class="op" id="6072054">.</span><span class="ident" id="6072055">writeAndRetry</span><span class="op" id="6072068">(</span><span class="ident" id="6072069">LOG_NOTICE</span><span class="op" id="6072079">,</span>&nbsp;<span class="ident" id="6072081">m</span><span class="op" id="6072082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072085">return</span>&nbsp;<span class="ident" id="6072092">err</span><br>
<span class="lineno">235</span><span class="op" id="6072096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6072099">//&nbsp;Info&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_INFO,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6072168">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6072186">func</span>&nbsp;<span class="op" id="6072191">(</span><span class="ident" id="6072192">w</span>&nbsp;<span class="op" id="6072194">*</span><span class="ident" id="6072195">Writer</span><span class="op" id="6072201">)</span>&nbsp;<span class="ident" id="6072203">Info</span><span class="op" id="6072207">(</span><span class="ident" id="6072208">m</span>&nbsp;<span class="builtintype" id="6072210">string</span><span class="op" id="6072216">)</span>&nbsp;<span class="op" id="6072218">(</span><span class="ident" id="6072219">err</span>&nbsp;<span class="builtintype" id="6072223">error</span><span class="op" id="6072228">)</span>&nbsp;<span class="op" id="6072230">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072233">_</span><span class="op" id="6072234">,</span>&nbsp;<span class="ident" id="6072236">err</span>&nbsp;<span class="op" id="6072240">=</span>&nbsp;<span class="ident" id="6072242">w</span><span class="op" id="6072243">.</span><span class="ident" id="6072244">writeAndRetry</span><span class="op" id="6072257">(</span><span class="ident" id="6072258">LOG_INFO</span><span class="op" id="6072266">,</span>&nbsp;<span class="ident" id="6072268">m</span><span class="op" id="6072269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072272">return</span>&nbsp;<span class="ident" id="6072279">err</span><br>
<span class="lineno"></span><span class="op" id="6072283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6072286">//&nbsp;Debug&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_DEBUG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">245</span><span class="comment" id="6072357">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6072375">func</span>&nbsp;<span class="op" id="6072380">(</span><span class="ident" id="6072381">w</span>&nbsp;<span class="op" id="6072383">*</span><span class="ident" id="6072384">Writer</span><span class="op" id="6072390">)</span>&nbsp;<span class="ident" id="6072392">Debug</span><span class="op" id="6072397">(</span><span class="ident" id="6072398">m</span>&nbsp;<span class="builtintype" id="6072400">string</span><span class="op" id="6072406">)</span>&nbsp;<span class="op" id="6072408">(</span><span class="ident" id="6072409">err</span>&nbsp;<span class="builtintype" id="6072413">error</span><span class="op" id="6072418">)</span>&nbsp;<span class="op" id="6072420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072423">_</span><span class="op" id="6072424">,</span>&nbsp;<span class="ident" id="6072426">err</span>&nbsp;<span class="op" id="6072430">=</span>&nbsp;<span class="ident" id="6072432">w</span><span class="op" id="6072433">.</span><span class="ident" id="6072434">writeAndRetry</span><span class="op" id="6072447">(</span><span class="ident" id="6072448">LOG_DEBUG</span><span class="op" id="6072457">,</span>&nbsp;<span class="ident" id="6072459">m</span><span class="op" id="6072460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072463">return</span>&nbsp;<span class="ident" id="6072470">err</span><br>
<span class="lineno"></span><span class="op" id="6072474">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6072477">func</span>&nbsp;<span class="op" id="6072482">(</span><span class="ident" id="6072483">w</span>&nbsp;<span class="op" id="6072485">*</span><span class="ident" id="6072486">Writer</span><span class="op" id="6072492">)</span>&nbsp;<span class="ident" id="6072494">writeAndRetry</span><span class="op" id="6072507">(</span><span class="ident" id="6072508">p</span>&nbsp;<span class="ident" id="6072510">Priority</span><span class="op" id="6072518">,</span>&nbsp;<span class="ident" id="6072520">s</span>&nbsp;<span class="builtintype" id="6072522">string</span><span class="op" id="6072528">)</span>&nbsp;<span class="op" id="6072530">(</span><span class="builtintype" id="6072531">int</span><span class="op" id="6072534">,</span>&nbsp;<span class="builtintype" id="6072536">error</span><span class="op" id="6072541">)</span>&nbsp;<span class="op" id="6072543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072546">pr</span>&nbsp;<span class="op" id="6072549">:=</span>&nbsp;<span class="op" id="6072552">(</span><span class="ident" id="6072553">w</span><span class="op" id="6072554">.</span><span class="ident" id="6072555">priority</span>&nbsp;<span class="op" id="6072564">&amp;</span>&nbsp;<span class="ident" id="6072566">facilityMask</span><span class="op" id="6072578">)</span>&nbsp;<span class="op" id="6072580">|</span>&nbsp;<span class="op" id="6072582">(</span><span class="ident" id="6072583">p</span>&nbsp;<span class="op" id="6072585">&amp;</span>&nbsp;<span class="ident" id="6072587">severityMask</span><span class="op" id="6072599">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072603">w</span><span class="op" id="6072604">.</span><span class="ident" id="6072605">mu</span><span class="op" id="6072607">.</span><span class="ident" id="6072608">Lock</span><span class="op" id="6072612">(</span><span class="op" id="6072613">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072616">defer</span>&nbsp;<span class="ident" id="6072622">w</span><span class="op" id="6072623">.</span><span class="ident" id="6072624">mu</span><span class="op" id="6072626">.</span><span class="ident" id="6072627">Unlock</span><span class="op" id="6072633">(</span><span class="op" id="6072634">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072638">if</span>&nbsp;<span class="ident" id="6072641">w</span><span class="op" id="6072642">.</span><span class="ident" id="6072643">conn</span>&nbsp;<span class="op" id="6072648">!=</span>&nbsp;<span class="ident" id="6072651">nil</span>&nbsp;<span class="op" id="6072655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072659">if</span>&nbsp;<span class="ident" id="6072662">n</span><span class="op" id="6072663">,</span>&nbsp;<span class="ident" id="6072665">err</span>&nbsp;<span class="op" id="6072669">:=</span>&nbsp;<span class="ident" id="6072672">w</span><span class="op" id="6072673">.</span><span class="ident" id="6072674">write</span><span class="op" id="6072679">(</span><span class="ident" id="6072680">pr</span><span class="op" id="6072682">,</span>&nbsp;<span class="ident" id="6072684">s</span><span class="op" id="6072685">)</span><span class="op" id="6072686">;</span>&nbsp;<span class="ident" id="6072688">err</span>&nbsp;<span class="op" id="6072692">==</span>&nbsp;<span class="ident" id="6072695">nil</span>&nbsp;<span class="op" id="6072699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072704">return</span>&nbsp;<span class="ident" id="6072711">n</span><span class="op" id="6072712">,</span>&nbsp;<span class="ident" id="6072714">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072726">if</span>&nbsp;<span class="ident" id="6072729">err</span>&nbsp;<span class="op" id="6072733">:=</span>&nbsp;<span class="ident" id="6072736">w</span><span class="op" id="6072737">.</span><span class="ident" id="6072738">connect</span><span class="op" id="6072745">(</span><span class="op" id="6072746">)</span><span class="op" id="6072747">;</span>&nbsp;<span class="ident" id="6072749">err</span>&nbsp;<span class="op" id="6072753">!=</span>&nbsp;<span class="ident" id="6072756">nil</span>&nbsp;<span class="op" id="6072760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072764">return</span>&nbsp;<span class="num" id="6072771">0</span><span class="op" id="6072772">,</span>&nbsp;<span class="ident" id="6072774">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072779">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072782">return</span>&nbsp;<span class="ident" id="6072789">w</span><span class="op" id="6072790">.</span><span class="ident" id="6072791">write</span><span class="op" id="6072796">(</span><span class="ident" id="6072797">pr</span><span class="op" id="6072799">,</span>&nbsp;<span class="ident" id="6072801">s</span><span class="op" id="6072802">)</span><br>
<span class="lineno"></span><span class="op" id="6072804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6072807">//&nbsp;write&nbsp;generates&nbsp;and&nbsp;writes&nbsp;a&nbsp;syslog&nbsp;formatted&nbsp;string.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6072868">//&nbsp;format&nbsp;is&nbsp;as&nbsp;follows:&nbsp;&lt;PRI&gt;TIMESTAMP&nbsp;HOSTNAME&nbsp;TAG[PID]:&nbsp;MSG</span><br>
<span class="lineno">270</span><span class="keyword" id="6072931">func</span>&nbsp;<span class="op" id="6072936">(</span><span class="ident" id="6072937">w</span>&nbsp;<span class="op" id="6072939">*</span><span class="ident" id="6072940">Writer</span><span class="op" id="6072946">)</span>&nbsp;<span class="ident" id="6072948">write</span><span class="op" id="6072953">(</span><span class="ident" id="6072954">p</span>&nbsp;<span class="ident" id="6072956">Priority</span><span class="op" id="6072964">,</span>&nbsp;<span class="ident" id="6072966">msg</span>&nbsp;<span class="builtintype" id="6072970">string</span><span class="op" id="6072976">)</span>&nbsp;<span class="op" id="6072978">(</span><span class="builtintype" id="6072979">int</span><span class="op" id="6072982">,</span>&nbsp;<span class="builtintype" id="6072984">error</span><span class="op" id="6072989">)</span>&nbsp;<span class="op" id="6072991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6072994">//&nbsp;ensure&nbsp;it&nbsp;ends&nbsp;in&nbsp;a&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073021">nl</span>&nbsp;<span class="op" id="6073024">:=</span>&nbsp;<span class="string" id="6073027">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073031">if</span>&nbsp;<span class="op" id="6073034">!</span><span class="ident" id="6073035">strings</span><span class="op" id="6073042">.</span><span class="ident" id="6073043">HasSuffix</span><span class="op" id="6073052">(</span><span class="ident" id="6073053">msg</span><span class="op" id="6073056">,</span>&nbsp;<span class="string" id="6073058">&#34;\n&#34;</span><span class="op" id="6073062">)</span>&nbsp;<span class="op" id="6073064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073068">nl</span>&nbsp;<span class="op" id="6073071">=</span>&nbsp;<span class="string" id="6073073">&#34;\n&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073083">err</span>&nbsp;<span class="op" id="6073087">:=</span>&nbsp;<span class="ident" id="6073090">w</span><span class="op" id="6073091">.</span><span class="ident" id="6073092">conn</span><span class="op" id="6073096">.</span><span class="ident" id="6073097">writeString</span><span class="op" id="6073108">(</span><span class="ident" id="6073109">p</span><span class="op" id="6073110">,</span>&nbsp;<span class="ident" id="6073112">w</span><span class="op" id="6073113">.</span><span class="ident" id="6073114">hostname</span><span class="op" id="6073122">,</span>&nbsp;<span class="ident" id="6073124">w</span><span class="op" id="6073125">.</span><span class="ident" id="6073126">tag</span><span class="op" id="6073129">,</span>&nbsp;<span class="ident" id="6073131">msg</span><span class="op" id="6073134">,</span>&nbsp;<span class="ident" id="6073136">nl</span><span class="op" id="6073138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073141">if</span>&nbsp;<span class="ident" id="6073144">err</span>&nbsp;<span class="op" id="6073148">!=</span>&nbsp;<span class="ident" id="6073151">nil</span>&nbsp;<span class="op" id="6073155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073159">return</span>&nbsp;<span class="num" id="6073166">0</span><span class="op" id="6073167">,</span>&nbsp;<span class="ident" id="6073169">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073177">//&nbsp;Note:&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input,&nbsp;not&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073237">//&nbsp;bytes&nbsp;printed&nbsp;by&nbsp;Fprintf,&nbsp;because&nbsp;this&nbsp;must&nbsp;behave&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073297">//&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073315">return</span>&nbsp;<span class="builtinfunc" id="6073322">len</span><span class="op" id="6073325">(</span><span class="ident" id="6073326">msg</span><span class="op" id="6073329">)</span><span class="op" id="6073330">,</span>&nbsp;<span class="ident" id="6073332">nil</span><br>
<span class="lineno">285</span><span class="op" id="6073336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6073339">func</span>&nbsp;<span class="op" id="6073344">(</span><span class="ident" id="6073345">n</span>&nbsp;<span class="op" id="6073347">*</span><span class="ident" id="6073348">netConn</span><span class="op" id="6073355">)</span>&nbsp;<span class="ident" id="6073357">writeString</span><span class="op" id="6073368">(</span><span class="ident" id="6073369">p</span>&nbsp;<span class="ident" id="6073371">Priority</span><span class="op" id="6073379">,</span>&nbsp;<span class="ident" id="6073381">hostname</span><span class="op" id="6073389">,</span>&nbsp;<span class="ident" id="6073391">tag</span><span class="op" id="6073394">,</span>&nbsp;<span class="ident" id="6073396">msg</span><span class="op" id="6073399">,</span>&nbsp;<span class="ident" id="6073401">nl</span>&nbsp;<span class="builtintype" id="6073404">string</span><span class="op" id="6073410">)</span>&nbsp;<span class="builtintype" id="6073412">error</span>&nbsp;<span class="op" id="6073418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073421">if</span>&nbsp;<span class="ident" id="6073424">n</span><span class="op" id="6073425">.</span><span class="ident" id="6073426">local</span>&nbsp;<span class="op" id="6073432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073436">//&nbsp;Compared&nbsp;to&nbsp;the&nbsp;network&nbsp;form&nbsp;below,&nbsp;the&nbsp;changes&nbsp;are:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073494">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Use&nbsp;time.Stamp&nbsp;instead&nbsp;of&nbsp;time.RFC3339.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073542">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Drop&nbsp;the&nbsp;hostname&nbsp;field&nbsp;from&nbsp;the&nbsp;Fprintf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073592">timestamp</span>&nbsp;<span class="op" id="6073602">:=</span>&nbsp;<span class="ident" id="6073605">time</span><span class="op" id="6073609">.</span><span class="ident" id="6073610">Now</span><span class="op" id="6073613">(</span><span class="op" id="6073614">)</span><span class="op" id="6073615">.</span><span class="ident" id="6073616">Format</span><span class="op" id="6073622">(</span><span class="ident" id="6073623">time</span><span class="op" id="6073627">.</span><span class="ident" id="6073628">Stamp</span><span class="op" id="6073633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073637">_</span><span class="op" id="6073638">,</span>&nbsp;<span class="ident" id="6073640">err</span>&nbsp;<span class="op" id="6073644">:=</span>&nbsp;<span class="ident" id="6073647">fmt</span><span class="op" id="6073650">.</span><span class="ident" id="6073651">Fprintf</span><span class="op" id="6073658">(</span><span class="ident" id="6073659">n</span><span class="op" id="6073660">.</span><span class="ident" id="6073661">conn</span><span class="op" id="6073665">,</span>&nbsp;<span class="string" id="6073667">&#34;&lt;%d&gt;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6073688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073693">p</span><span class="op" id="6073694">,</span>&nbsp;<span class="ident" id="6073696">timestamp</span><span class="op" id="6073705">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073710">tag</span><span class="op" id="6073713">,</span>&nbsp;<span class="ident" id="6073715">os</span><span class="op" id="6073717">.</span><span class="ident" id="6073718">Getpid</span><span class="op" id="6073724">(</span><span class="op" id="6073725">)</span><span class="op" id="6073726">,</span>&nbsp;<span class="ident" id="6073728">msg</span><span class="op" id="6073731">,</span>&nbsp;<span class="ident" id="6073733">nl</span><span class="op" id="6073735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073739">return</span>&nbsp;<span class="ident" id="6073746">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073754">timestamp</span>&nbsp;<span class="op" id="6073764">:=</span>&nbsp;<span class="ident" id="6073767">time</span><span class="op" id="6073771">.</span><span class="ident" id="6073772">Now</span><span class="op" id="6073775">(</span><span class="op" id="6073776">)</span><span class="op" id="6073777">.</span><span class="ident" id="6073778">Format</span><span class="op" id="6073784">(</span><span class="ident" id="6073785">time</span><span class="op" id="6073789">.</span><span class="ident" id="6073790">RFC3339</span><span class="op" id="6073797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073800">_</span><span class="op" id="6073801">,</span>&nbsp;<span class="ident" id="6073803">err</span>&nbsp;<span class="op" id="6073807">:=</span>&nbsp;<span class="ident" id="6073810">fmt</span><span class="op" id="6073813">.</span><span class="ident" id="6073814">Fprintf</span><span class="op" id="6073821">(</span><span class="ident" id="6073822">n</span><span class="op" id="6073823">.</span><span class="ident" id="6073824">conn</span><span class="op" id="6073828">,</span>&nbsp;<span class="string" id="6073830">&#34;&lt;%d&gt;%s&nbsp;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6073854">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073858">p</span><span class="op" id="6073859">,</span>&nbsp;<span class="ident" id="6073861">timestamp</span><span class="op" id="6073870">,</span>&nbsp;<span class="ident" id="6073872">hostname</span><span class="op" id="6073880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073884">tag</span><span class="op" id="6073887">,</span>&nbsp;<span class="ident" id="6073889">os</span><span class="op" id="6073891">.</span><span class="ident" id="6073892">Getpid</span><span class="op" id="6073898">(</span><span class="op" id="6073899">)</span><span class="op" id="6073900">,</span>&nbsp;<span class="ident" id="6073902">msg</span><span class="op" id="6073905">,</span>&nbsp;<span class="ident" id="6073907">nl</span><span class="op" id="6073909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073912">return</span>&nbsp;<span class="ident" id="6073919">err</span><br>
<span class="lineno"></span><span class="op" id="6073923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6073926">func</span>&nbsp;<span class="op" id="6073931">(</span><span class="ident" id="6073932">n</span>&nbsp;<span class="op" id="6073934">*</span><span class="ident" id="6073935">netConn</span><span class="op" id="6073942">)</span>&nbsp;<span class="builtinfunc" id="6073944">close</span><span class="op" id="6073949">(</span><span class="op" id="6073950">)</span>&nbsp;<span class="builtintype" id="6073952">error</span>&nbsp;<span class="op" id="6073958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073961">return</span>&nbsp;<span class="ident" id="6073968">n</span><span class="op" id="6073969">.</span><span class="ident" id="6073970">conn</span><span class="op" id="6073974">.</span><span class="ident" id="6073975">Close</span><span class="op" id="6073980">(</span><span class="op" id="6073981">)</span><br>
<span class="lineno"></span><span class="op" id="6073983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6073986">//&nbsp;NewLogger&nbsp;creates&nbsp;a&nbsp;log.Logger&nbsp;whose&nbsp;output&nbsp;is&nbsp;written&nbsp;to</span><br>
<span class="lineno">310</span><span class="comment" id="6074047">//&nbsp;the&nbsp;system&nbsp;log&nbsp;service&nbsp;with&nbsp;the&nbsp;specified&nbsp;priority.&nbsp;The&nbsp;logFlag</span><br>
<span class="lineno"></span><span class="comment" id="6074114">//&nbsp;argument&nbsp;is&nbsp;the&nbsp;flag&nbsp;set&nbsp;passed&nbsp;through&nbsp;to&nbsp;log.New&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="6074178">//&nbsp;the&nbsp;Logger.</span><br>
<span class="lineno"></span><span class="keyword" id="6074193">func</span>&nbsp;<span class="ident" id="6074198">NewLogger</span><span class="op" id="6074207">(</span><span class="ident" id="6074208">p</span>&nbsp;<span class="ident" id="6074210">Priority</span><span class="op" id="6074218">,</span>&nbsp;<span class="ident" id="6074220">logFlag</span>&nbsp;<span class="builtintype" id="6074228">int</span><span class="op" id="6074231">)</span>&nbsp;<span class="op" id="6074233">(</span><span class="op" id="6074234">*</span><span class="ident" id="6074235">log</span><span class="op" id="6074238">.</span><span class="ident" id="6074239">Logger</span><span class="op" id="6074245">,</span>&nbsp;<span class="builtintype" id="6074247">error</span><span class="op" id="6074252">)</span>&nbsp;<span class="op" id="6074254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074257">s</span><span class="op" id="6074258">,</span>&nbsp;<span class="ident" id="6074260">err</span>&nbsp;<span class="op" id="6074264">:=</span>&nbsp;<span class="ident" id="6074267">New</span><span class="op" id="6074270">(</span><span class="ident" id="6074271">p</span><span class="op" id="6074272">,</span>&nbsp;<span class="string" id="6074274">&#34;&#34;</span><span class="op" id="6074276">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074279">if</span>&nbsp;<span class="ident" id="6074282">err</span>&nbsp;<span class="op" id="6074286">!=</span>&nbsp;<span class="ident" id="6074289">nil</span>&nbsp;<span class="op" id="6074293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074297">return</span>&nbsp;<span class="ident" id="6074304">nil</span><span class="op" id="6074307">,</span>&nbsp;<span class="ident" id="6074309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074317">return</span>&nbsp;<span class="ident" id="6074324">log</span><span class="op" id="6074327">.</span><span class="ident" id="6074328">New</span><span class="op" id="6074331">(</span><span class="ident" id="6074332">s</span><span class="op" id="6074333">,</span>&nbsp;<span class="string" id="6074335">&#34;&#34;</span><span class="op" id="6074337">,</span>&nbsp;<span class="ident" id="6074339">logFlag</span><span class="op" id="6074346">)</span><span class="op" id="6074347">,</span>&nbsp;<span class="ident" id="6074349">nil</span><br>
<span class="lineno"></span><span class="op" id="6074353">}</span>
</div>
</body>
</html>
