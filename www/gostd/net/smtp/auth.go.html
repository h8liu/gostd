<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5935560">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5935615">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5935669">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5935720">package</span>&nbsp;<span class="ident" id="5935728">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5935734">import</span>&nbsp;<span class="op" id="5935741">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5935744">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5935759">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5935773">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5935783">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="5935789">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5935792">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="5935852">type</span>&nbsp;<span class="ident" id="5935857">Auth</span>&nbsp;<span class="keyword" id="5935862">interface</span>&nbsp;<span class="op" id="5935872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935875">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935925">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935980">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936043">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936105">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936152">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936210">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936268">Start</span><span class="op" id="5936273">(</span><span class="ident" id="5936274">server</span>&nbsp;<span class="op" id="5936281">*</span><span class="ident" id="5936282">ServerInfo</span><span class="op" id="5936292">)</span>&nbsp;<span class="op" id="5936294">(</span><span class="ident" id="5936295">proto</span>&nbsp;<span class="builtintype" id="5936301">string</span><span class="op" id="5936307">,</span>&nbsp;<span class="ident" id="5936309">toServer</span>&nbsp;<span class="op" id="5936318">[</span><span class="op" id="5936319">]</span><span class="builtintype" id="5936320">byte</span><span class="op" id="5936324">,</span>&nbsp;<span class="ident" id="5936326">err</span>&nbsp;<span class="builtintype" id="5936330">error</span><span class="op" id="5936335">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936339">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936403">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936466">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936528">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936568">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936628">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936686">Next</span><span class="op" id="5936690">(</span><span class="ident" id="5936691">fromServer</span>&nbsp;<span class="op" id="5936702">[</span><span class="op" id="5936703">]</span><span class="builtintype" id="5936704">byte</span><span class="op" id="5936708">,</span>&nbsp;<span class="ident" id="5936710">more</span>&nbsp;<span class="builtintype" id="5936715">bool</span><span class="op" id="5936719">)</span>&nbsp;<span class="op" id="5936721">(</span><span class="ident" id="5936722">toServer</span>&nbsp;<span class="op" id="5936731">[</span><span class="op" id="5936732">]</span><span class="builtintype" id="5936733">byte</span><span class="op" id="5936737">,</span>&nbsp;<span class="ident" id="5936739">err</span>&nbsp;<span class="builtintype" id="5936743">error</span><span class="op" id="5936748">)</span><br>
<span class="lineno"></span><span class="op" id="5936750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5936753">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="5936809">type</span>&nbsp;<span class="ident" id="5936814">ServerInfo</span>&nbsp;<span class="keyword" id="5936825">struct</span>&nbsp;<span class="op" id="5936832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936835">Name</span>&nbsp;<span class="builtintype" id="5936840">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5936849">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936870">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="5936875">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5936884">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936931">Auth</span>&nbsp;<span class="op" id="5936936">[</span><span class="op" id="5936937">]</span><span class="builtintype" id="5936938">string</span>&nbsp;<span class="comment" id="5936945">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="5936985">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5936988">type</span>&nbsp;<span class="ident" id="5936993">plainAuth</span>&nbsp;<span class="keyword" id="5937003">struct</span>&nbsp;<span class="op" id="5937010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937013">identity</span><span class="op" id="5937021">,</span>&nbsp;<span class="ident" id="5937023">username</span><span class="op" id="5937031">,</span>&nbsp;<span class="ident" id="5937033">password</span>&nbsp;<span class="builtintype" id="5937042">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937050">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5937079">string</span><br>
<span class="lineno"></span><span class="op" id="5937086">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5937089">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="5937159">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="5937196">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="5937270">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="5937346">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="5937380">func</span>&nbsp;<span class="ident" id="5937385">PlainAuth</span><span class="op" id="5937394">(</span><span class="ident" id="5937395">identity</span><span class="op" id="5937403">,</span>&nbsp;<span class="ident" id="5937405">username</span><span class="op" id="5937413">,</span>&nbsp;<span class="ident" id="5937415">password</span><span class="op" id="5937423">,</span>&nbsp;<span class="ident" id="5937425">host</span>&nbsp;<span class="builtintype" id="5937430">string</span><span class="op" id="5937436">)</span>&nbsp;<span class="ident" id="5937438">Auth</span>&nbsp;<span class="op" id="5937443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937446">return</span>&nbsp;<span class="op" id="5937453">&amp;</span><span class="ident" id="5937454">plainAuth</span><span class="op" id="5937463">{</span><span class="ident" id="5937464">identity</span><span class="op" id="5937472">,</span>&nbsp;<span class="ident" id="5937474">username</span><span class="op" id="5937482">,</span>&nbsp;<span class="ident" id="5937484">password</span><span class="op" id="5937492">,</span>&nbsp;<span class="ident" id="5937494">host</span><span class="op" id="5937498">}</span><br>
<span class="lineno"></span><span class="op" id="5937500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5937503">func</span>&nbsp;<span class="op" id="5937508">(</span><span class="ident" id="5937509">a</span>&nbsp;<span class="op" id="5937511">*</span><span class="ident" id="5937512">plainAuth</span><span class="op" id="5937521">)</span>&nbsp;<span class="ident" id="5937523">Start</span><span class="op" id="5937528">(</span><span class="ident" id="5937529">server</span>&nbsp;<span class="op" id="5937536">*</span><span class="ident" id="5937537">ServerInfo</span><span class="op" id="5937547">)</span>&nbsp;<span class="op" id="5937549">(</span><span class="builtintype" id="5937550">string</span><span class="op" id="5937556">,</span>&nbsp;<span class="op" id="5937558">[</span><span class="op" id="5937559">]</span><span class="builtintype" id="5937560">byte</span><span class="op" id="5937564">,</span>&nbsp;<span class="builtintype" id="5937566">error</span><span class="op" id="5937571">)</span>&nbsp;<span class="op" id="5937573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937576">if</span>&nbsp;<span class="op" id="5937579">!</span><span class="ident" id="5937580">server</span><span class="op" id="5937586">.</span><span class="ident" id="5937587">TLS</span>&nbsp;<span class="op" id="5937591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937595">advertised</span>&nbsp;<span class="op" id="5937606">:=</span>&nbsp;<span class="builtintype" id="5937609">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937617">for</span>&nbsp;<span class="ident" id="5937621">_</span><span class="op" id="5937622">,</span>&nbsp;<span class="ident" id="5937624">mechanism</span>&nbsp;<span class="op" id="5937634">:=</span>&nbsp;<span class="keyword" id="5937637">range</span>&nbsp;<span class="ident" id="5937643">server</span><span class="op" id="5937649">.</span><span class="ident" id="5937650">Auth</span>&nbsp;<span class="op" id="5937655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937660">if</span>&nbsp;<span class="ident" id="5937663">mechanism</span>&nbsp;<span class="op" id="5937673">==</span>&nbsp;<span class="string" id="5937676">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="5937684">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937690">advertised</span>&nbsp;<span class="op" id="5937701">=</span>&nbsp;<span class="builtintype" id="5937703">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937712">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937729">if</span>&nbsp;<span class="op" id="5937732">!</span><span class="ident" id="5937733">advertised</span>&nbsp;<span class="op" id="5937744">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937749">return</span>&nbsp;<span class="string" id="5937756">&#34;&#34;</span><span class="op" id="5937758">,</span>&nbsp;<span class="ident" id="5937760">nil</span><span class="op" id="5937763">,</span>&nbsp;<span class="ident" id="5937765">errors</span><span class="op" id="5937771">.</span><span class="ident" id="5937772">New</span><span class="op" id="5937775">(</span><span class="string" id="5937776">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="5937800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937810">if</span>&nbsp;<span class="ident" id="5937813">server</span><span class="op" id="5937819">.</span><span class="ident" id="5937820">Name</span>&nbsp;<span class="op" id="5937825">!=</span>&nbsp;<span class="ident" id="5937828">a</span><span class="op" id="5937829">.</span><span class="ident" id="5937830">host</span>&nbsp;<span class="op" id="5937835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937839">return</span>&nbsp;<span class="string" id="5937846">&#34;&#34;</span><span class="op" id="5937848">,</span>&nbsp;<span class="ident" id="5937850">nil</span><span class="op" id="5937853">,</span>&nbsp;<span class="ident" id="5937855">errors</span><span class="op" id="5937861">.</span><span class="ident" id="5937862">New</span><span class="op" id="5937865">(</span><span class="string" id="5937866">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="5937883">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937889">resp</span>&nbsp;<span class="op" id="5937894">:=</span>&nbsp;<span class="op" id="5937897">[</span><span class="op" id="5937898">]</span><span class="builtintype" id="5937899">byte</span><span class="op" id="5937903">(</span><span class="ident" id="5937904">a</span><span class="op" id="5937905">.</span><span class="ident" id="5937906">identity</span>&nbsp;<span class="op" id="5937915">+</span>&nbsp;<span class="string" id="5937917">&#34;\x00&#34;</span>&nbsp;<span class="op" id="5937924">+</span>&nbsp;<span class="ident" id="5937926">a</span><span class="op" id="5937927">.</span><span class="ident" id="5937928">username</span>&nbsp;<span class="op" id="5937937">+</span>&nbsp;<span class="string" id="5937939">&#34;\x00&#34;</span>&nbsp;<span class="op" id="5937946">+</span>&nbsp;<span class="ident" id="5937948">a</span><span class="op" id="5937949">.</span><span class="ident" id="5937950">password</span><span class="op" id="5937958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937961">return</span>&nbsp;<span class="string" id="5937968">&#34;PLAIN&#34;</span><span class="op" id="5937975">,</span>&nbsp;<span class="ident" id="5937977">resp</span><span class="op" id="5937981">,</span>&nbsp;<span class="ident" id="5937983">nil</span><br>
<span class="lineno"></span><span class="op" id="5937987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5937990">func</span>&nbsp;<span class="op" id="5937995">(</span><span class="ident" id="5937996">a</span>&nbsp;<span class="op" id="5937998">*</span><span class="ident" id="5937999">plainAuth</span><span class="op" id="5938008">)</span>&nbsp;<span class="ident" id="5938010">Next</span><span class="op" id="5938014">(</span><span class="ident" id="5938015">fromServer</span>&nbsp;<span class="op" id="5938026">[</span><span class="op" id="5938027">]</span><span class="builtintype" id="5938028">byte</span><span class="op" id="5938032">,</span>&nbsp;<span class="ident" id="5938034">more</span>&nbsp;<span class="builtintype" id="5938039">bool</span><span class="op" id="5938043">)</span>&nbsp;<span class="op" id="5938045">(</span><span class="op" id="5938046">[</span><span class="op" id="5938047">]</span><span class="builtintype" id="5938048">byte</span><span class="op" id="5938052">,</span>&nbsp;<span class="builtintype" id="5938054">error</span><span class="op" id="5938059">)</span>&nbsp;<span class="op" id="5938061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938064">if</span>&nbsp;<span class="ident" id="5938067">more</span>&nbsp;<span class="op" id="5938072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5938076">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938112">return</span>&nbsp;<span class="ident" id="5938119">nil</span><span class="op" id="5938122">,</span>&nbsp;<span class="ident" id="5938124">errors</span><span class="op" id="5938130">.</span><span class="ident" id="5938131">New</span><span class="op" id="5938134">(</span><span class="string" id="5938135">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="5938164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5938167">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938170">return</span>&nbsp;<span class="ident" id="5938177">nil</span><span class="op" id="5938180">,</span>&nbsp;<span class="ident" id="5938182">nil</span><br>
<span class="lineno"></span><span class="op" id="5938186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5938189">type</span>&nbsp;<span class="ident" id="5938194">cramMD5Auth</span>&nbsp;<span class="keyword" id="5938206">struct</span>&nbsp;<span class="op" id="5938213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938216">username</span><span class="op" id="5938224">,</span>&nbsp;<span class="ident" id="5938226">secret</span>&nbsp;<span class="builtintype" id="5938233">string</span><br>
<span class="lineno">85</span><span class="op" id="5938240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5938243">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="5938318">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="5938355">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="5938427">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="5938484">func</span>&nbsp;<span class="ident" id="5938489">CRAMMD5Auth</span><span class="op" id="5938500">(</span><span class="ident" id="5938501">username</span><span class="op" id="5938509">,</span>&nbsp;<span class="ident" id="5938511">secret</span>&nbsp;<span class="builtintype" id="5938518">string</span><span class="op" id="5938524">)</span>&nbsp;<span class="ident" id="5938526">Auth</span>&nbsp;<span class="op" id="5938531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938534">return</span>&nbsp;<span class="op" id="5938541">&amp;</span><span class="ident" id="5938542">cramMD5Auth</span><span class="op" id="5938553">{</span><span class="ident" id="5938554">username</span><span class="op" id="5938562">,</span>&nbsp;<span class="ident" id="5938564">secret</span><span class="op" id="5938570">}</span><br>
<span class="lineno"></span><span class="op" id="5938572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5938575">func</span>&nbsp;<span class="op" id="5938580">(</span><span class="ident" id="5938581">a</span>&nbsp;<span class="op" id="5938583">*</span><span class="ident" id="5938584">cramMD5Auth</span><span class="op" id="5938595">)</span>&nbsp;<span class="ident" id="5938597">Start</span><span class="op" id="5938602">(</span><span class="ident" id="5938603">server</span>&nbsp;<span class="op" id="5938610">*</span><span class="ident" id="5938611">ServerInfo</span><span class="op" id="5938621">)</span>&nbsp;<span class="op" id="5938623">(</span><span class="builtintype" id="5938624">string</span><span class="op" id="5938630">,</span>&nbsp;<span class="op" id="5938632">[</span><span class="op" id="5938633">]</span><span class="builtintype" id="5938634">byte</span><span class="op" id="5938638">,</span>&nbsp;<span class="builtintype" id="5938640">error</span><span class="op" id="5938645">)</span>&nbsp;<span class="op" id="5938647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938650">return</span>&nbsp;<span class="string" id="5938657">&#34;CRAM-MD5&#34;</span><span class="op" id="5938667">,</span>&nbsp;<span class="ident" id="5938669">nil</span><span class="op" id="5938672">,</span>&nbsp;<span class="ident" id="5938674">nil</span><br>
<span class="lineno"></span><span class="op" id="5938678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5938681">func</span>&nbsp;<span class="op" id="5938686">(</span><span class="ident" id="5938687">a</span>&nbsp;<span class="op" id="5938689">*</span><span class="ident" id="5938690">cramMD5Auth</span><span class="op" id="5938701">)</span>&nbsp;<span class="ident" id="5938703">Next</span><span class="op" id="5938707">(</span><span class="ident" id="5938708">fromServer</span>&nbsp;<span class="op" id="5938719">[</span><span class="op" id="5938720">]</span><span class="builtintype" id="5938721">byte</span><span class="op" id="5938725">,</span>&nbsp;<span class="ident" id="5938727">more</span>&nbsp;<span class="builtintype" id="5938732">bool</span><span class="op" id="5938736">)</span>&nbsp;<span class="op" id="5938738">(</span><span class="op" id="5938739">[</span><span class="op" id="5938740">]</span><span class="builtintype" id="5938741">byte</span><span class="op" id="5938745">,</span>&nbsp;<span class="builtintype" id="5938747">error</span><span class="op" id="5938752">)</span>&nbsp;<span class="op" id="5938754">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938757">if</span>&nbsp;<span class="ident" id="5938760">more</span>&nbsp;<span class="op" id="5938765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938769">d</span>&nbsp;<span class="op" id="5938771">:=</span>&nbsp;<span class="ident" id="5938774">hmac</span><span class="op" id="5938778">.</span><span class="ident" id="5938779">New</span><span class="op" id="5938782">(</span><span class="ident" id="5938783">md5</span><span class="op" id="5938786">.</span><span class="ident" id="5938787">New</span><span class="op" id="5938790">,</span>&nbsp;<span class="op" id="5938792">[</span><span class="op" id="5938793">]</span><span class="builtintype" id="5938794">byte</span><span class="op" id="5938798">(</span><span class="ident" id="5938799">a</span><span class="op" id="5938800">.</span><span class="ident" id="5938801">secret</span><span class="op" id="5938807">)</span><span class="op" id="5938808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938812">d</span><span class="op" id="5938813">.</span><span class="ident" id="5938814">Write</span><span class="op" id="5938819">(</span><span class="ident" id="5938820">fromServer</span><span class="op" id="5938830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938834">s</span>&nbsp;<span class="op" id="5938836">:=</span>&nbsp;<span class="builtinfunc" id="5938839">make</span><span class="op" id="5938843">(</span><span class="op" id="5938844">[</span><span class="op" id="5938845">]</span><span class="builtintype" id="5938846">byte</span><span class="op" id="5938850">,</span>&nbsp;<span class="num" id="5938852">0</span><span class="op" id="5938853">,</span>&nbsp;<span class="ident" id="5938855">d</span><span class="op" id="5938856">.</span><span class="ident" id="5938857">Size</span><span class="op" id="5938861">(</span><span class="op" id="5938862">)</span><span class="op" id="5938863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938867">return</span>&nbsp;<span class="op" id="5938874">[</span><span class="op" id="5938875">]</span><span class="builtintype" id="5938876">byte</span><span class="op" id="5938880">(</span><span class="ident" id="5938881">fmt</span><span class="op" id="5938884">.</span><span class="ident" id="5938885">Sprintf</span><span class="op" id="5938892">(</span><span class="string" id="5938893">&#34;%s&nbsp;%x&#34;</span><span class="op" id="5938900">,</span>&nbsp;<span class="ident" id="5938902">a</span><span class="op" id="5938903">.</span><span class="ident" id="5938904">username</span><span class="op" id="5938912">,</span>&nbsp;<span class="ident" id="5938914">d</span><span class="op" id="5938915">.</span><span class="ident" id="5938916">Sum</span><span class="op" id="5938919">(</span><span class="ident" id="5938920">s</span><span class="op" id="5938921">)</span><span class="op" id="5938922">)</span><span class="op" id="5938923">)</span><span class="op" id="5938924">,</span>&nbsp;<span class="ident" id="5938926">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5938931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938934">return</span>&nbsp;<span class="ident" id="5938941">nil</span><span class="op" id="5938944">,</span>&nbsp;<span class="ident" id="5938946">nil</span><br>
<span class="lineno"></span><span class="op" id="5938950">}</span>
</div>
</body>
</html>
