<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6256988">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6257043">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6257097">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6257148">package</span>&nbsp;<span class="ident" id="6257156">httputil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6257166">import</span>&nbsp;<span class="op" id="6257173">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6257176">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6257185">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6257195">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6257201">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6257208">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6257220">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6257237">&#34;sync&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6257244">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6257247">var</span>&nbsp;<span class="op" id="6257251">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257254">ErrPersistEOF</span>&nbsp;<span class="op" id="6257268">=</span>&nbsp;<span class="op" id="6257270">&amp;</span><span class="ident" id="6257271"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6257275">.</span><span class="ident" id="6257276">ProtocolError</span><span class="op" id="6257289">{</span><span class="ident" id="6257290">ErrorString</span><span class="op" id="6257301">:</span>&nbsp;<span class="string" id="6257303">&#34;persistent&nbsp;connection&nbsp;closed&#34;</span><span class="op" id="6257333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257336">ErrClosed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6257350">=</span>&nbsp;<span class="op" id="6257352">&amp;</span><span class="ident" id="6257353"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6257357">.</span><span class="ident" id="6257358">ProtocolError</span><span class="op" id="6257371">{</span><span class="ident" id="6257372">ErrorString</span><span class="op" id="6257383">:</span>&nbsp;<span class="string" id="6257385">&#34;connection&nbsp;closed&nbsp;by&nbsp;user&#34;</span><span class="op" id="6257412">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257415">ErrPipeline</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6257429">=</span>&nbsp;<span class="op" id="6257431">&amp;</span><span class="ident" id="6257432"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6257436">.</span><span class="ident" id="6257437">ProtocolError</span><span class="op" id="6257450">{</span><span class="ident" id="6257451">ErrorString</span><span class="op" id="6257462">:</span>&nbsp;<span class="string" id="6257464">&#34;pipeline&nbsp;error&#34;</span><span class="op" id="6257480">}</span><br>
<span class="lineno"></span><span class="op" id="6257482">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6257485">//&nbsp;This&nbsp;is&nbsp;an&nbsp;API&nbsp;usage&nbsp;error&nbsp;-&nbsp;the&nbsp;local&nbsp;side&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="6257543">//&nbsp;ErrPersistEOF&nbsp;(above)&nbsp;reports&nbsp;that&nbsp;the&nbsp;remote&nbsp;side&nbsp;is&nbsp;closed.</span><br>
<span class="lineno">25</span><span class="keyword" id="6257608">var</span>&nbsp;<span class="ident" id="6257612">errClosed</span>&nbsp;<span class="op" id="6257622">=</span>&nbsp;<span class="ident" id="6257624"><a href="/net/http/httputil/persist.go.html#6257185">errors</a></span><span class="op" id="6257630">.</span><span class="ident" id="6257631">New</span><span class="op" id="6257634">(</span><span class="string" id="6257635">&#34;i/o&nbsp;operation&nbsp;on&nbsp;closed&nbsp;connection&#34;</span><span class="op" id="6257671">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6257674">//&nbsp;A&nbsp;ServerConn&nbsp;reads&nbsp;requests&nbsp;and&nbsp;sends&nbsp;responses&nbsp;over&nbsp;an&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="6257744">//&nbsp;connection,&nbsp;until&nbsp;the&nbsp;HTTP&nbsp;keepalive&nbsp;logic&nbsp;commands&nbsp;an&nbsp;end.&nbsp;ServerConn</span><br>
<span class="lineno"></span><span class="comment" id="6257818">//&nbsp;also&nbsp;allows&nbsp;hijacking&nbsp;the&nbsp;underlying&nbsp;connection&nbsp;by&nbsp;calling&nbsp;Hijack</span><br>
<span class="lineno">30</span><span class="comment" id="6257887">//&nbsp;to&nbsp;regain&nbsp;control&nbsp;over&nbsp;the&nbsp;connection.&nbsp;ServerConn&nbsp;supports&nbsp;pipe-lining,</span><br>
<span class="lineno"></span><span class="comment" id="6257962">//&nbsp;i.e.&nbsp;requests&nbsp;can&nbsp;be&nbsp;read&nbsp;out&nbsp;of&nbsp;sync&nbsp;(but&nbsp;in&nbsp;the&nbsp;same&nbsp;order)&nbsp;while&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6258037">//&nbsp;respective&nbsp;responses&nbsp;are&nbsp;sent.</span><br>
<span class="lineno"></span><span class="comment" id="6258071">//</span><br>
<span class="lineno"></span><span class="comment" id="6258074">//&nbsp;ServerConn&nbsp;is&nbsp;low-level&nbsp;and&nbsp;old.&nbsp;Applications&nbsp;should&nbsp;instead&nbsp;use&nbsp;Server</span><br>
<span class="lineno">35</span><span class="comment" id="6258149">//&nbsp;in&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="6258177">type</span>&nbsp;<span class="ident" id="6258182">ServerConn</span>&nbsp;<span class="keyword" id="6258193">struct</span>&nbsp;<span class="op" id="6258200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258203">lk</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6258219"><a href="/net/http/httputil/persist.go.html#6257237">sync</a></span><span class="op" id="6258223">.</span><span class="ident" id="6258224">Mutex</span>&nbsp;<span class="comment" id="6258230">//&nbsp;read-write&nbsp;protects&nbsp;the&nbsp;following&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258275">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6258291"><a href="/net/http/httputil/persist.go.html#6257201">net</a></span><span class="op" id="6258294">.</span><span class="ident" id="6258295">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258301">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6258317">*</span><span class="ident" id="6258318"><a href="/net/http/httputil/persist.go.html#6257176">bufio</a></span><span class="op" id="6258323">.</span><span class="ident" id="6258324">Reader</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258332">re</span><span class="op" id="6258334">,</span>&nbsp;<span class="ident" id="6258336">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6258348">error</span>&nbsp;<span class="comment" id="6258354">//&nbsp;read/write&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258376">lastbody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6258392"><a href="/net/http/httputil/persist.go.html#6257195">io</a></span><span class="op" id="6258394">.</span><span class="ident" id="6258395">ReadCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258407">nread</span><span class="op" id="6258412">,</span>&nbsp;<span class="ident" id="6258414">nwritten</span>&nbsp;<span class="builtintype" id="6258423">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258428">pipereq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6258444">map</span><span class="op" id="6258447">[</span><span class="op" id="6258448">*</span><span class="ident" id="6258449"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6258453">.</span><span class="ident" id="6258454">Request</span><span class="op" id="6258461">]</span><span class="builtintype" id="6258462">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258469">pipe</span>&nbsp;<span class="ident" id="6258474"><a href="/net/http/httputil/persist.go.html#6257220">textproto</a></span><span class="op" id="6258483">.</span><span class="ident" id="6258484">Pipeline</span><br>
<span class="lineno"></span><span class="op" id="6258493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6258496">//&nbsp;NewServerConn&nbsp;returns&nbsp;a&nbsp;new&nbsp;ServerConn&nbsp;reading&nbsp;and&nbsp;writing&nbsp;c.&nbsp;If&nbsp;r&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6258573">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;the&nbsp;buffer&nbsp;to&nbsp;use&nbsp;when&nbsp;reading&nbsp;c.</span><br>
<span class="lineno">50</span><span class="comment" id="6258621">//</span><br>
<span class="lineno"></span><span class="comment" id="6258624">//&nbsp;ServerConn&nbsp;is&nbsp;low-level&nbsp;and&nbsp;old.&nbsp;Applications&nbsp;should&nbsp;instead&nbsp;use&nbsp;Server</span><br>
<span class="lineno"></span><span class="comment" id="6258699">//&nbsp;in&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="6258727">func</span>&nbsp;<span class="ident" id="6258732">NewServerConn</span><span class="op" id="6258745">(</span><span class="ident" id="6258746">c</span>&nbsp;<span class="ident" id="6258748"><a href="/net/http/httputil/persist.go.html#6257201">net</a></span><span class="op" id="6258751">.</span><span class="ident" id="6258752">Conn</span><span class="op" id="6258756">,</span>&nbsp;<span class="ident" id="6258758">r</span>&nbsp;<span class="op" id="6258760">*</span><span class="ident" id="6258761"><a href="/net/http/httputil/persist.go.html#6257176">bufio</a></span><span class="op" id="6258766">.</span><span class="ident" id="6258767">Reader</span><span class="op" id="6258773">)</span>&nbsp;<span class="op" id="6258775">*</span><span class="ident" id="6258776"><a href="/net/http/httputil/persist.go.html#6258182">ServerConn</a></span>&nbsp;<span class="op" id="6258787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258790">if</span>&nbsp;<span class="ident" id="6258793"><a href="/net/http/httputil/persist.go.html#6258758">r</a></span>&nbsp;<span class="op" id="6258795">==</span>&nbsp;<span class="ident" id="6258798">nil</span>&nbsp;<span class="op" id="6258802">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258806"><a href="/net/http/httputil/persist.go.html#6258758">r</a></span>&nbsp;<span class="op" id="6258808">=</span>&nbsp;<span class="ident" id="6258810"><a href="/net/http/httputil/persist.go.html#6257176">bufio</a></span><span class="op" id="6258815">.</span><span class="ident" id="6258816">NewReader</span><span class="op" id="6258825">(</span><span class="ident" id="6258826"><a href="/net/http/httputil/persist.go.html#6258746">c</a></span><span class="op" id="6258827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258833">return</span>&nbsp;<span class="op" id="6258840">&amp;</span><span class="ident" id="6258841"><a href="/net/http/httputil/persist.go.html#6258182">ServerConn</a></span><span class="op" id="6258851">{</span><span class="ident" id="6258852">c</span><span class="op" id="6258853">:</span>&nbsp;<span class="ident" id="6258855"><a href="/net/http/httputil/persist.go.html#6258746">c</a></span><span class="op" id="6258856">,</span>&nbsp;<span class="ident" id="6258858">r</span><span class="op" id="6258859">:</span>&nbsp;<span class="ident" id="6258861"><a href="/net/http/httputil/persist.go.html#6258758">r</a></span><span class="op" id="6258862">,</span>&nbsp;<span class="ident" id="6258864">pipereq</span><span class="op" id="6258871">:</span>&nbsp;<span class="builtinfunc" id="6258873">make</span><span class="op" id="6258877">(</span><span class="keyword" id="6258878">map</span><span class="op" id="6258881">[</span><span class="op" id="6258882">*</span><span class="ident" id="6258883"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6258887">.</span><span class="ident" id="6258888">Request</span><span class="op" id="6258895">]</span><span class="builtintype" id="6258896">uint</span><span class="op" id="6258900">)</span><span class="op" id="6258901">}</span><br>
<span class="lineno"></span><span class="op" id="6258903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6258906">//&nbsp;Hijack&nbsp;detaches&nbsp;the&nbsp;ServerConn&nbsp;and&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;connection&nbsp;as&nbsp;well</span><br>
<span class="lineno"></span><span class="comment" id="6258986">//&nbsp;as&nbsp;the&nbsp;read-side&nbsp;bufio&nbsp;which&nbsp;may&nbsp;have&nbsp;some&nbsp;left&nbsp;over&nbsp;data.&nbsp;Hijack&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6259062">//&nbsp;called&nbsp;before&nbsp;Read&nbsp;has&nbsp;signaled&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;keep-alive&nbsp;logic.&nbsp;The&nbsp;user</span><br>
<span class="lineno"></span><span class="comment" id="6259139">//&nbsp;should&nbsp;not&nbsp;call&nbsp;Hijack&nbsp;while&nbsp;Read&nbsp;or&nbsp;Write&nbsp;is&nbsp;in&nbsp;progress.</span><br>
<span class="lineno"></span><span class="keyword" id="6259201">func</span>&nbsp;<span class="op" id="6259206">(</span><span class="ident" id="6259207">sc</span>&nbsp;<span class="op" id="6259210">*</span><span class="ident" id="6259211"><a href="/net/http/httputil/persist.go.html#6258182">ServerConn</a></span><span class="op" id="6259221">)</span>&nbsp;<span class="ident" id="6259223">Hijack</span><span class="op" id="6259229">(</span><span class="op" id="6259230">)</span>&nbsp;<span class="op" id="6259232">(</span><span class="ident" id="6259233">c</span>&nbsp;<span class="ident" id="6259235"><a href="/net/http/httputil/persist.go.html#6257201">net</a></span><span class="op" id="6259238">.</span><span class="ident" id="6259239">Conn</span><span class="op" id="6259243">,</span>&nbsp;<span class="ident" id="6259245">r</span>&nbsp;<span class="op" id="6259247">*</span><span class="ident" id="6259248"><a href="/net/http/httputil/persist.go.html#6257176">bufio</a></span><span class="op" id="6259253">.</span><span class="ident" id="6259254">Reader</span><span class="op" id="6259260">)</span>&nbsp;<span class="op" id="6259262">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259265"><a href="/net/http/httputil/persist.go.html#6259207">sc</a></span><span class="op" id="6259267">.</span><span class="ident" id="6259268">lk</span><span class="op" id="6259270">.</span><span class="ident" id="6259271">Lock</span><span class="op" id="6259275">(</span><span class="op" id="6259276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259279">defer</span>&nbsp;<span class="ident" id="6259285"><a href="/net/http/httputil/persist.go.html#6259207">sc</a></span><span class="op" id="6259287">.</span><span class="ident" id="6259288">lk</span><span class="op" id="6259290">.</span><span class="ident" id="6259291">Unlock</span><span class="op" id="6259297">(</span><span class="op" id="6259298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259301"><a href="/net/http/httputil/persist.go.html#6259233">c</a></span>&nbsp;<span class="op" id="6259303">=</span>&nbsp;<span class="ident" id="6259305"><a href="/net/http/httputil/persist.go.html#6259207">sc</a></span><span class="op" id="6259307">.</span><span class="ident" id="6259308">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259311"><a href="/net/http/httputil/persist.go.html#6259245">r</a></span>&nbsp;<span class="op" id="6259313">=</span>&nbsp;<span class="ident" id="6259315"><a href="/net/http/httputil/persist.go.html#6259207">sc</a></span><span class="op" id="6259317">.</span><span class="ident" id="6259318">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259321"><a href="/net/http/httputil/persist.go.html#6259207">sc</a></span><span class="op" id="6259323">.</span><span class="ident" id="6259324">c</span>&nbsp;<span class="op" id="6259326">=</span>&nbsp;<span class="ident" id="6259328">nil</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259333"><a href="/net/http/httputil/persist.go.html#6259207">sc</a></span><span class="op" id="6259335">.</span><span class="ident" id="6259336">r</span>&nbsp;<span class="op" id="6259338">=</span>&nbsp;<span class="ident" id="6259340">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259345">return</span><br>
<span class="lineno"></span><span class="op" id="6259352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6259355">//&nbsp;Close&nbsp;calls&nbsp;Hijack&nbsp;and&nbsp;then&nbsp;also&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;connection</span><br>
<span class="lineno">75</span><span class="keyword" id="6259424">func</span>&nbsp;<span class="op" id="6259429">(</span><span class="ident" id="6259430">sc</span>&nbsp;<span class="op" id="6259433">*</span><span class="ident" id="6259434"><a href="/net/http/httputil/persist.go.html#6258182">ServerConn</a></span><span class="op" id="6259444">)</span>&nbsp;<span class="ident" id="6259446">Close</span><span class="op" id="6259451">(</span><span class="op" id="6259452">)</span>&nbsp;<span class="builtintype" id="6259454">error</span>&nbsp;<span class="op" id="6259460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259463">c</span><span class="op" id="6259464">,</span>&nbsp;<span class="ident" id="6259466">_</span>&nbsp;<span class="op" id="6259468">:=</span>&nbsp;<span class="ident" id="6259471"><a href="/net/http/httputil/persist.go.html#6259430">sc</a></span><span class="op" id="6259473">.</span><span class="ident" id="6259474">Hijack</span><span class="op" id="6259480">(</span><span class="op" id="6259481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259484">if</span>&nbsp;<span class="ident" id="6259487"><a href="/net/http/httputil/persist.go.html#6259463">c</a></span>&nbsp;<span class="op" id="6259489">!=</span>&nbsp;<span class="ident" id="6259492">nil</span>&nbsp;<span class="op" id="6259496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259500">return</span>&nbsp;<span class="ident" id="6259507"><a href="/net/http/httputil/persist.go.html#6259463">c</a></span><span class="op" id="6259508">.</span><span class="ident" id="6259509">Close</span><span class="op" id="6259514">(</span><span class="op" id="6259515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259518">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259521">return</span>&nbsp;<span class="ident" id="6259528">nil</span><br>
<span class="lineno"></span><span class="op" id="6259532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6259535">//&nbsp;Read&nbsp;returns&nbsp;the&nbsp;next&nbsp;request&nbsp;on&nbsp;the&nbsp;wire.&nbsp;An&nbsp;ErrPersistEOF&nbsp;is&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6259613">//&nbsp;it&nbsp;is&nbsp;gracefully&nbsp;determined&nbsp;that&nbsp;there&nbsp;are&nbsp;no&nbsp;more&nbsp;requests&nbsp;(e.g.&nbsp;after&nbsp;the</span><br>
<span class="lineno">85</span><span class="comment" id="6259692">//&nbsp;first&nbsp;request&nbsp;on&nbsp;an&nbsp;HTTP/1.0&nbsp;connection,&nbsp;or&nbsp;after&nbsp;a&nbsp;Connection:close&nbsp;on&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6259769">//&nbsp;HTTP/1.1&nbsp;connection).</span><br>
<span class="lineno"></span><span class="keyword" id="6259794">func</span>&nbsp;<span class="op" id="6259799">(</span><span class="ident" id="6259800">sc</span>&nbsp;<span class="op" id="6259803">*</span><span class="ident" id="6259804"><a href="/net/http/httputil/persist.go.html#6258182">ServerConn</a></span><span class="op" id="6259814">)</span>&nbsp;<span class="ident" id="6259816">Read</span><span class="op" id="6259820">(</span><span class="op" id="6259821">)</span>&nbsp;<span class="op" id="6259823">(</span><span class="ident" id="6259824">req</span>&nbsp;<span class="op" id="6259828">*</span><span class="ident" id="6259829"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6259833">.</span><span class="ident" id="6259834">Request</span><span class="op" id="6259841">,</span>&nbsp;<span class="ident" id="6259843">err</span>&nbsp;<span class="builtintype" id="6259847">error</span><span class="op" id="6259852">)</span>&nbsp;<span class="op" id="6259854">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6259858">//&nbsp;Ensure&nbsp;ordered&nbsp;execution&nbsp;of&nbsp;Reads&nbsp;and&nbsp;Writes</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259907">id</span>&nbsp;<span class="op" id="6259910">:=</span>&nbsp;<span class="ident" id="6259913"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6259915">.</span><span class="ident" id="6259916">pipe</span><span class="op" id="6259920">.</span><span class="ident" id="6259921">Next</span><span class="op" id="6259925">(</span><span class="op" id="6259926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259929"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6259931">.</span><span class="ident" id="6259932">pipe</span><span class="op" id="6259936">.</span><span class="ident" id="6259937">StartRequest</span><span class="op" id="6259949">(</span><span class="ident" id="6259950"><a href="/net/http/httputil/persist.go.html#6259907">id</a></span><span class="op" id="6259952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259955">defer</span>&nbsp;<span class="keyword" id="6259961">func</span><span class="op" id="6259965">(</span><span class="op" id="6259966">)</span>&nbsp;<span class="op" id="6259968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259972"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6259974">.</span><span class="ident" id="6259975">pipe</span><span class="op" id="6259979">.</span><span class="ident" id="6259980">EndRequest</span><span class="op" id="6259990">(</span><span class="ident" id="6259991"><a href="/net/http/httputil/persist.go.html#6259907">id</a></span><span class="op" id="6259993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259997">if</span>&nbsp;<span class="ident" id="6260000"><a href="/net/http/httputil/persist.go.html#6259824">req</a></span>&nbsp;<span class="op" id="6260004">==</span>&nbsp;<span class="ident" id="6260007">nil</span>&nbsp;<span class="op" id="6260011">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260016"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260018">.</span><span class="ident" id="6260019">pipe</span><span class="op" id="6260023">.</span><span class="ident" id="6260024">StartResponse</span><span class="op" id="6260037">(</span><span class="ident" id="6260038"><a href="/net/http/httputil/persist.go.html#6259907">id</a></span><span class="op" id="6260040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260045"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260047">.</span><span class="ident" id="6260048">pipe</span><span class="op" id="6260052">.</span><span class="ident" id="6260053">EndResponse</span><span class="op" id="6260064">(</span><span class="ident" id="6260065"><a href="/net/http/httputil/persist.go.html#6259907">id</a></span><span class="op" id="6260067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260071">}</span>&nbsp;<span class="keyword" id="6260073">else</span>&nbsp;<span class="op" id="6260078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6260083">//&nbsp;Remember&nbsp;the&nbsp;pipeline&nbsp;id&nbsp;of&nbsp;this&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260130"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260132">.</span><span class="ident" id="6260133">lk</span><span class="op" id="6260135">.</span><span class="ident" id="6260136">Lock</span><span class="op" id="6260140">(</span><span class="op" id="6260141">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260146"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260148">.</span><span class="ident" id="6260149">pipereq</span><span class="op" id="6260156">[</span><span class="ident" id="6260157"><a href="/net/http/httputil/persist.go.html#6259824">req</a></span><span class="op" id="6260160">]</span>&nbsp;<span class="op" id="6260162">=</span>&nbsp;<span class="ident" id="6260164"><a href="/net/http/httputil/persist.go.html#6259907">id</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260170"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260172">.</span><span class="ident" id="6260173">lk</span><span class="op" id="6260175">.</span><span class="ident" id="6260176">Unlock</span><span class="op" id="6260182">(</span><span class="op" id="6260183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260190">}</span><span class="op" id="6260191">(</span><span class="op" id="6260192">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260196"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260198">.</span><span class="ident" id="6260199">lk</span><span class="op" id="6260201">.</span><span class="ident" id="6260202">Lock</span><span class="op" id="6260206">(</span><span class="op" id="6260207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260210">if</span>&nbsp;<span class="ident" id="6260213"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260215">.</span><span class="ident" id="6260216">we</span>&nbsp;<span class="op" id="6260219">!=</span>&nbsp;<span class="ident" id="6260222">nil</span>&nbsp;<span class="op" id="6260226">{</span>&nbsp;<span class="comment" id="6260228">//&nbsp;no&nbsp;point&nbsp;receiving&nbsp;if&nbsp;write-side&nbsp;broken&nbsp;or&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260283">defer</span>&nbsp;<span class="ident" id="6260289"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260291">.</span><span class="ident" id="6260292">lk</span><span class="op" id="6260294">.</span><span class="ident" id="6260295">Unlock</span><span class="op" id="6260301">(</span><span class="op" id="6260302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260306">return</span>&nbsp;<span class="ident" id="6260313">nil</span><span class="op" id="6260316">,</span>&nbsp;<span class="ident" id="6260318"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260320">.</span><span class="ident" id="6260321">we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260325">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260328">if</span>&nbsp;<span class="ident" id="6260331"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260333">.</span><span class="ident" id="6260334">re</span>&nbsp;<span class="op" id="6260337">!=</span>&nbsp;<span class="ident" id="6260340">nil</span>&nbsp;<span class="op" id="6260344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260348">defer</span>&nbsp;<span class="ident" id="6260354"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260356">.</span><span class="ident" id="6260357">lk</span><span class="op" id="6260359">.</span><span class="ident" id="6260360">Unlock</span><span class="op" id="6260366">(</span><span class="op" id="6260367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260371">return</span>&nbsp;<span class="ident" id="6260378">nil</span><span class="op" id="6260381">,</span>&nbsp;<span class="ident" id="6260383"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260385">.</span><span class="ident" id="6260386">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260393">if</span>&nbsp;<span class="ident" id="6260396"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260398">.</span><span class="ident" id="6260399">r</span>&nbsp;<span class="op" id="6260401">==</span>&nbsp;<span class="ident" id="6260404">nil</span>&nbsp;<span class="op" id="6260408">{</span>&nbsp;<span class="comment" id="6260410">//&nbsp;connection&nbsp;closed&nbsp;by&nbsp;user&nbsp;in&nbsp;the&nbsp;meantime</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260457">defer</span>&nbsp;<span class="ident" id="6260463"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260465">.</span><span class="ident" id="6260466">lk</span><span class="op" id="6260468">.</span><span class="ident" id="6260469">Unlock</span><span class="op" id="6260475">(</span><span class="op" id="6260476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260480">return</span>&nbsp;<span class="ident" id="6260487">nil</span><span class="op" id="6260490">,</span>&nbsp;<span class="ident" id="6260492"><a href="/net/http/httputil/persist.go.html#6257612">errClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260506">r</span>&nbsp;<span class="op" id="6260508">:=</span>&nbsp;<span class="ident" id="6260511"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260513">.</span><span class="ident" id="6260514">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260517">lastbody</span>&nbsp;<span class="op" id="6260526">:=</span>&nbsp;<span class="ident" id="6260529"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260531">.</span><span class="ident" id="6260532">lastbody</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260542"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260544">.</span><span class="ident" id="6260545">lastbody</span>&nbsp;<span class="op" id="6260554">=</span>&nbsp;<span class="ident" id="6260556">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260561"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260563">.</span><span class="ident" id="6260564">lk</span><span class="op" id="6260566">.</span><span class="ident" id="6260567">Unlock</span><span class="op" id="6260573">(</span><span class="op" id="6260574">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6260578">//&nbsp;Make&nbsp;sure&nbsp;body&nbsp;is&nbsp;fully&nbsp;consumed,&nbsp;even&nbsp;if&nbsp;user&nbsp;does&nbsp;not&nbsp;call&nbsp;body.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260654">if</span>&nbsp;<span class="ident" id="6260657"><a href="/net/http/httputil/persist.go.html#6260517">lastbody</a></span>&nbsp;<span class="op" id="6260666">!=</span>&nbsp;<span class="ident" id="6260669">nil</span>&nbsp;<span class="op" id="6260673">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6260677">//&nbsp;body.Close&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;idempotent&nbsp;and&nbsp;multiple&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6260743">//&nbsp;it&nbsp;should&nbsp;return&nbsp;the&nbsp;error&nbsp;that&nbsp;its&nbsp;first&nbsp;invocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6260801">//&nbsp;returned.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260816"><a href="/net/http/httputil/persist.go.html#6259843">err</a></span>&nbsp;<span class="op" id="6260820">=</span>&nbsp;<span class="ident" id="6260822"><a href="/net/http/httputil/persist.go.html#6260517">lastbody</a></span><span class="op" id="6260830">.</span><span class="ident" id="6260831">Close</span><span class="op" id="6260836">(</span><span class="op" id="6260837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260841">if</span>&nbsp;<span class="ident" id="6260844"><a href="/net/http/httputil/persist.go.html#6259843">err</a></span>&nbsp;<span class="op" id="6260848">!=</span>&nbsp;<span class="ident" id="6260851">nil</span>&nbsp;<span class="op" id="6260855">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260860"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260862">.</span><span class="ident" id="6260863">lk</span><span class="op" id="6260865">.</span><span class="ident" id="6260866">Lock</span><span class="op" id="6260870">(</span><span class="op" id="6260871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260876">defer</span>&nbsp;<span class="ident" id="6260882"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260884">.</span><span class="ident" id="6260885">lk</span><span class="op" id="6260887">.</span><span class="ident" id="6260888">Unlock</span><span class="op" id="6260894">(</span><span class="op" id="6260895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260900"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260902">.</span><span class="ident" id="6260903">re</span>&nbsp;<span class="op" id="6260906">=</span>&nbsp;<span class="ident" id="6260908"><a href="/net/http/httputil/persist.go.html#6259843">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260915">return</span>&nbsp;<span class="ident" id="6260922">nil</span><span class="op" id="6260925">,</span>&nbsp;<span class="ident" id="6260927"><a href="/net/http/httputil/persist.go.html#6259843">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260933">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260940"><a href="/net/http/httputil/persist.go.html#6259824">req</a></span><span class="op" id="6260943">,</span>&nbsp;<span class="ident" id="6260945"><a href="/net/http/httputil/persist.go.html#6259843">err</a></span>&nbsp;<span class="op" id="6260949">=</span>&nbsp;<span class="ident" id="6260951"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6260955">.</span><span class="ident" id="6260956">ReadRequest</span><span class="op" id="6260967">(</span><span class="ident" id="6260968"><a href="/net/http/httputil/persist.go.html#6260506">r</a></span><span class="op" id="6260969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260972"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260974">.</span><span class="ident" id="6260975">lk</span><span class="op" id="6260977">.</span><span class="ident" id="6260978">Lock</span><span class="op" id="6260982">(</span><span class="op" id="6260983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260986">defer</span>&nbsp;<span class="ident" id="6260992"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6260994">.</span><span class="ident" id="6260995">lk</span><span class="op" id="6260997">.</span><span class="ident" id="6260998">Unlock</span><span class="op" id="6261004">(</span><span class="op" id="6261005">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261008">if</span>&nbsp;<span class="ident" id="6261011"><a href="/net/http/httputil/persist.go.html#6259843">err</a></span>&nbsp;<span class="op" id="6261015">!=</span>&nbsp;<span class="ident" id="6261018">nil</span>&nbsp;<span class="op" id="6261022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261026">if</span>&nbsp;<span class="ident" id="6261029"><a href="/net/http/httputil/persist.go.html#6259843">err</a></span>&nbsp;<span class="op" id="6261033">==</span>&nbsp;<span class="ident" id="6261036"><a href="/net/http/httputil/persist.go.html#6257195">io</a></span><span class="op" id="6261038">.</span><span class="ident" id="6261039">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6261056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6261061">//&nbsp;A&nbsp;close&nbsp;from&nbsp;the&nbsp;opposing&nbsp;client&nbsp;is&nbsp;treated&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6261116">//&nbsp;graceful&nbsp;close,&nbsp;even&nbsp;if&nbsp;there&nbsp;was&nbsp;some&nbsp;unparse-able</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6261174">//&nbsp;data&nbsp;before&nbsp;the&nbsp;close.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261203"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6261205">.</span><span class="ident" id="6261206">re</span>&nbsp;<span class="op" id="6261209">=</span>&nbsp;<span class="ident" id="6261211"><a href="/net/http/httputil/persist.go.html#6257254">ErrPersistEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261228">return</span>&nbsp;<span class="ident" id="6261235">nil</span><span class="op" id="6261238">,</span>&nbsp;<span class="ident" id="6261240"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6261242">.</span><span class="ident" id="6261243">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261248">}</span>&nbsp;<span class="keyword" id="6261250">else</span>&nbsp;<span class="op" id="6261255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261260"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6261262">.</span><span class="ident" id="6261263">re</span>&nbsp;<span class="op" id="6261266">=</span>&nbsp;<span class="ident" id="6261268"><a href="/net/http/httputil/persist.go.html#6259843">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261275">return</span>&nbsp;<span class="ident" id="6261282"><a href="/net/http/httputil/persist.go.html#6259824">req</a></span><span class="op" id="6261285">,</span>&nbsp;<span class="ident" id="6261287"><a href="/net/http/httputil/persist.go.html#6259843">err</a></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261299"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6261301">.</span><span class="ident" id="6261302">lastbody</span>&nbsp;<span class="op" id="6261311">=</span>&nbsp;<span class="ident" id="6261313"><a href="/net/http/httputil/persist.go.html#6259824">req</a></span><span class="op" id="6261316">.</span><span class="ident" id="6261317">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261323"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6261325">.</span><span class="ident" id="6261326">nread</span><span class="op" id="6261331">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261335">if</span>&nbsp;<span class="ident" id="6261338"><a href="/net/http/httputil/persist.go.html#6259824">req</a></span><span class="op" id="6261341">.</span><span class="ident" id="6261342">Close</span>&nbsp;<span class="op" id="6261348">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261352"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6261354">.</span><span class="ident" id="6261355">re</span>&nbsp;<span class="op" id="6261358">=</span>&nbsp;<span class="ident" id="6261360"><a href="/net/http/httputil/persist.go.html#6257254">ErrPersistEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261376">return</span>&nbsp;<span class="ident" id="6261383"><a href="/net/http/httputil/persist.go.html#6259824">req</a></span><span class="op" id="6261386">,</span>&nbsp;<span class="ident" id="6261388"><a href="/net/http/httputil/persist.go.html#6259800">sc</a></span><span class="op" id="6261390">.</span><span class="ident" id="6261391">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261398">return</span>&nbsp;<span class="ident" id="6261405"><a href="/net/http/httputil/persist.go.html#6259824">req</a></span><span class="op" id="6261408">,</span>&nbsp;<span class="ident" id="6261410"><a href="/net/http/httputil/persist.go.html#6259843">err</a></span><br>
<span class="lineno"></span><span class="op" id="6261414">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="6261417">//&nbsp;Pending&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;unanswered&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="6261470">//&nbsp;that&nbsp;have&nbsp;been&nbsp;received&nbsp;on&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6261516">func</span>&nbsp;<span class="op" id="6261521">(</span><span class="ident" id="6261522">sc</span>&nbsp;<span class="op" id="6261525">*</span><span class="ident" id="6261526"><a href="/net/http/httputil/persist.go.html#6258182">ServerConn</a></span><span class="op" id="6261536">)</span>&nbsp;<span class="ident" id="6261538">Pending</span><span class="op" id="6261545">(</span><span class="op" id="6261546">)</span>&nbsp;<span class="builtintype" id="6261548">int</span>&nbsp;<span class="op" id="6261552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261555"><a href="/net/http/httputil/persist.go.html#6261522">sc</a></span><span class="op" id="6261557">.</span><span class="ident" id="6261558">lk</span><span class="op" id="6261560">.</span><span class="ident" id="6261561">Lock</span><span class="op" id="6261565">(</span><span class="op" id="6261566">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261569">defer</span>&nbsp;<span class="ident" id="6261575"><a href="/net/http/httputil/persist.go.html#6261522">sc</a></span><span class="op" id="6261577">.</span><span class="ident" id="6261578">lk</span><span class="op" id="6261580">.</span><span class="ident" id="6261581">Unlock</span><span class="op" id="6261587">(</span><span class="op" id="6261588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261591">return</span>&nbsp;<span class="ident" id="6261598"><a href="/net/http/httputil/persist.go.html#6261522">sc</a></span><span class="op" id="6261600">.</span><span class="ident" id="6261601">nread</span>&nbsp;<span class="op" id="6261607">-</span>&nbsp;<span class="ident" id="6261609"><a href="/net/http/httputil/persist.go.html#6261522">sc</a></span><span class="op" id="6261611">.</span><span class="ident" id="6261612">nwritten</span><br>
<span class="lineno"></span><span class="op" id="6261621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6261624">//&nbsp;Write&nbsp;writes&nbsp;resp&nbsp;in&nbsp;response&nbsp;to&nbsp;req.&nbsp;To&nbsp;close&nbsp;the&nbsp;connection&nbsp;gracefully,&nbsp;set&nbsp;the</span><br>
<span class="lineno">170</span><span class="comment" id="6261709">//&nbsp;Response.Close&nbsp;field&nbsp;to&nbsp;true.&nbsp;Write&nbsp;should&nbsp;be&nbsp;considered&nbsp;operational&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="6261787">//&nbsp;it&nbsp;returns&nbsp;an&nbsp;error,&nbsp;regardless&nbsp;of&nbsp;any&nbsp;errors&nbsp;returned&nbsp;on&nbsp;the&nbsp;Read&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="6261863">func</span>&nbsp;<span class="op" id="6261868">(</span><span class="ident" id="6261869">sc</span>&nbsp;<span class="op" id="6261872">*</span><span class="ident" id="6261873"><a href="/net/http/httputil/persist.go.html#6258182">ServerConn</a></span><span class="op" id="6261883">)</span>&nbsp;<span class="ident" id="6261885">Write</span><span class="op" id="6261890">(</span><span class="ident" id="6261891">req</span>&nbsp;<span class="op" id="6261895">*</span><span class="ident" id="6261896"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6261900">.</span><span class="ident" id="6261901">Request</span><span class="op" id="6261908">,</span>&nbsp;<span class="ident" id="6261910">resp</span>&nbsp;<span class="op" id="6261915">*</span><span class="ident" id="6261916"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6261920">.</span><span class="ident" id="6261921">Response</span><span class="op" id="6261929">)</span>&nbsp;<span class="builtintype" id="6261931">error</span>&nbsp;<span class="op" id="6261937">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6261941">//&nbsp;Retrieve&nbsp;the&nbsp;pipeline&nbsp;ID&nbsp;of&nbsp;this&nbsp;request/response&nbsp;pair</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262000"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262002">.</span><span class="ident" id="6262003">lk</span><span class="op" id="6262005">.</span><span class="ident" id="6262006">Lock</span><span class="op" id="6262010">(</span><span class="op" id="6262011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262014">id</span><span class="op" id="6262016">,</span>&nbsp;<span class="ident" id="6262018">ok</span>&nbsp;<span class="op" id="6262021">:=</span>&nbsp;<span class="ident" id="6262024"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262026">.</span><span class="ident" id="6262027">pipereq</span><span class="op" id="6262034">[</span><span class="ident" id="6262035"><a href="/net/http/httputil/persist.go.html#6261891">req</a></span><span class="op" id="6262038">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6262041">delete</span><span class="op" id="6262047">(</span><span class="ident" id="6262048"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262050">.</span><span class="ident" id="6262051">pipereq</span><span class="op" id="6262058">,</span>&nbsp;<span class="ident" id="6262060"><a href="/net/http/httputil/persist.go.html#6261891">req</a></span><span class="op" id="6262063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262066">if</span>&nbsp;<span class="op" id="6262069">!</span><span class="ident" id="6262070"><a href="/net/http/httputil/persist.go.html#6262018">ok</a></span>&nbsp;<span class="op" id="6262073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262077"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262079">.</span><span class="ident" id="6262080">lk</span><span class="op" id="6262082">.</span><span class="ident" id="6262083">Unlock</span><span class="op" id="6262089">(</span><span class="op" id="6262090">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262094">return</span>&nbsp;<span class="ident" id="6262101"><a href="/net/http/httputil/persist.go.html#6257415">ErrPipeline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262117"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262119">.</span><span class="ident" id="6262120">lk</span><span class="op" id="6262122">.</span><span class="ident" id="6262123">Unlock</span><span class="op" id="6262129">(</span><span class="op" id="6262130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262134">//&nbsp;Ensure&nbsp;pipeline&nbsp;order</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262160"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262162">.</span><span class="ident" id="6262163">pipe</span><span class="op" id="6262167">.</span><span class="ident" id="6262168">StartResponse</span><span class="op" id="6262181">(</span><span class="ident" id="6262182"><a href="/net/http/httputil/persist.go.html#6262014">id</a></span><span class="op" id="6262184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262187">defer</span>&nbsp;<span class="ident" id="6262193"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262195">.</span><span class="ident" id="6262196">pipe</span><span class="op" id="6262200">.</span><span class="ident" id="6262201">EndResponse</span><span class="op" id="6262212">(</span><span class="ident" id="6262213"><a href="/net/http/httputil/persist.go.html#6262014">id</a></span><span class="op" id="6262215">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262219"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262221">.</span><span class="ident" id="6262222">lk</span><span class="op" id="6262224">.</span><span class="ident" id="6262225">Lock</span><span class="op" id="6262229">(</span><span class="op" id="6262230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262233">if</span>&nbsp;<span class="ident" id="6262236"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262238">.</span><span class="ident" id="6262239">we</span>&nbsp;<span class="op" id="6262242">!=</span>&nbsp;<span class="ident" id="6262245">nil</span>&nbsp;<span class="op" id="6262249">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262253">defer</span>&nbsp;<span class="ident" id="6262259"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262261">.</span><span class="ident" id="6262262">lk</span><span class="op" id="6262264">.</span><span class="ident" id="6262265">Unlock</span><span class="op" id="6262271">(</span><span class="op" id="6262272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262276">return</span>&nbsp;<span class="ident" id="6262283"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262285">.</span><span class="ident" id="6262286">we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262293">if</span>&nbsp;<span class="ident" id="6262296"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262298">.</span><span class="ident" id="6262299">c</span>&nbsp;<span class="op" id="6262301">==</span>&nbsp;<span class="ident" id="6262304">nil</span>&nbsp;<span class="op" id="6262308">{</span>&nbsp;<span class="comment" id="6262310">//&nbsp;connection&nbsp;closed&nbsp;by&nbsp;user&nbsp;in&nbsp;the&nbsp;meantime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262357">defer</span>&nbsp;<span class="ident" id="6262363"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262365">.</span><span class="ident" id="6262366">lk</span><span class="op" id="6262368">.</span><span class="ident" id="6262369">Unlock</span><span class="op" id="6262375">(</span><span class="op" id="6262376">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262380">return</span>&nbsp;<span class="ident" id="6262387"><a href="/net/http/httputil/persist.go.html#6257336">ErrClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262401">c</span>&nbsp;<span class="op" id="6262403">:=</span>&nbsp;<span class="ident" id="6262406"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262408">.</span><span class="ident" id="6262409">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262412">if</span>&nbsp;<span class="ident" id="6262415"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262417">.</span><span class="ident" id="6262418">nread</span>&nbsp;<span class="op" id="6262424">&lt;=</span>&nbsp;<span class="ident" id="6262427"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262429">.</span><span class="ident" id="6262430">nwritten</span>&nbsp;<span class="op" id="6262439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262443">defer</span>&nbsp;<span class="ident" id="6262449"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262451">.</span><span class="ident" id="6262452">lk</span><span class="op" id="6262454">.</span><span class="ident" id="6262455">Unlock</span><span class="op" id="6262461">(</span><span class="op" id="6262462">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262466">return</span>&nbsp;<span class="ident" id="6262473"><a href="/net/http/httputil/persist.go.html#6257185">errors</a></span><span class="op" id="6262479">.</span><span class="ident" id="6262480">New</span><span class="op" id="6262483">(</span><span class="string" id="6262484">&#34;persist&nbsp;server&nbsp;pipe&nbsp;count&#34;</span><span class="op" id="6262511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262517">if</span>&nbsp;<span class="ident" id="6262520"><a href="/net/http/httputil/persist.go.html#6261910">resp</a></span><span class="op" id="6262524">.</span><span class="ident" id="6262525">Close</span>&nbsp;<span class="op" id="6262531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262535">//&nbsp;After&nbsp;signaling&nbsp;a&nbsp;keep-alive&nbsp;close,&nbsp;any&nbsp;pipelined&nbsp;unread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262597">//&nbsp;requests&nbsp;will&nbsp;be&nbsp;lost.&nbsp;It&nbsp;is&nbsp;up&nbsp;to&nbsp;the&nbsp;user&nbsp;to&nbsp;drain&nbsp;them</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262660">//&nbsp;before&nbsp;signaling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262683"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262685">.</span><span class="ident" id="6262686">re</span>&nbsp;<span class="op" id="6262689">=</span>&nbsp;<span class="ident" id="6262691"><a href="/net/http/httputil/persist.go.html#6257254">ErrPersistEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262709"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262711">.</span><span class="ident" id="6262712">lk</span><span class="op" id="6262714">.</span><span class="ident" id="6262715">Unlock</span><span class="op" id="6262721">(</span><span class="op" id="6262722">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262726">err</span>&nbsp;<span class="op" id="6262730">:=</span>&nbsp;<span class="ident" id="6262733"><a href="/net/http/httputil/persist.go.html#6261910">resp</a></span><span class="op" id="6262737">.</span><span class="ident" id="6262738">Write</span><span class="op" id="6262743">(</span><span class="ident" id="6262744"><a href="/net/http/httputil/persist.go.html#6262401">c</a></span><span class="op" id="6262745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262748"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262750">.</span><span class="ident" id="6262751">lk</span><span class="op" id="6262753">.</span><span class="ident" id="6262754">Lock</span><span class="op" id="6262758">(</span><span class="op" id="6262759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262762">defer</span>&nbsp;<span class="ident" id="6262768"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262770">.</span><span class="ident" id="6262771">lk</span><span class="op" id="6262773">.</span><span class="ident" id="6262774">Unlock</span><span class="op" id="6262780">(</span><span class="op" id="6262781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262784">if</span>&nbsp;<span class="ident" id="6262787"><a href="/net/http/httputil/persist.go.html#6262726">err</a></span>&nbsp;<span class="op" id="6262791">!=</span>&nbsp;<span class="ident" id="6262794">nil</span>&nbsp;<span class="op" id="6262798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262802"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262804">.</span><span class="ident" id="6262805">we</span>&nbsp;<span class="op" id="6262808">=</span>&nbsp;<span class="ident" id="6262810"><a href="/net/http/httputil/persist.go.html#6262726">err</a></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262816">return</span>&nbsp;<span class="ident" id="6262823"><a href="/net/http/httputil/persist.go.html#6262726">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262831"><a href="/net/http/httputil/persist.go.html#6261869">sc</a></span><span class="op" id="6262833">.</span><span class="ident" id="6262834">nwritten</span><span class="op" id="6262842">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262847">return</span>&nbsp;<span class="ident" id="6262854">nil</span><br>
<span class="lineno">220</span><span class="op" id="6262858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6262861">//&nbsp;A&nbsp;ClientConn&nbsp;sends&nbsp;request&nbsp;and&nbsp;receives&nbsp;headers&nbsp;over&nbsp;an&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="6262931">//&nbsp;connection,&nbsp;while&nbsp;respecting&nbsp;the&nbsp;HTTP&nbsp;keepalive&nbsp;logic.&nbsp;ClientConn</span><br>
<span class="lineno"></span><span class="comment" id="6263000">//&nbsp;supports&nbsp;hijacking&nbsp;the&nbsp;connection&nbsp;calling&nbsp;Hijack&nbsp;to</span><br>
<span class="lineno">225</span><span class="comment" id="6263055">//&nbsp;regain&nbsp;control&nbsp;of&nbsp;the&nbsp;underlying&nbsp;net.Conn&nbsp;and&nbsp;deal&nbsp;with&nbsp;it&nbsp;as&nbsp;desired.</span><br>
<span class="lineno"></span><span class="comment" id="6263129">//</span><br>
<span class="lineno"></span><span class="comment" id="6263132">//&nbsp;ClientConn&nbsp;is&nbsp;low-level&nbsp;and&nbsp;old.&nbsp;Applications&nbsp;should&nbsp;instead&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="6263200">//&nbsp;Client&nbsp;or&nbsp;Transport&nbsp;in&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="6263248">type</span>&nbsp;<span class="ident" id="6263253">ClientConn</span>&nbsp;<span class="keyword" id="6263264">struct</span>&nbsp;<span class="op" id="6263271">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263274">lk</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6263290"><a href="/net/http/httputil/persist.go.html#6257237">sync</a></span><span class="op" id="6263294">.</span><span class="ident" id="6263295">Mutex</span>&nbsp;<span class="comment" id="6263301">//&nbsp;read-write&nbsp;protects&nbsp;the&nbsp;following&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263346">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6263362"><a href="/net/http/httputil/persist.go.html#6257201">net</a></span><span class="op" id="6263365">.</span><span class="ident" id="6263366">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263372">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6263388">*</span><span class="ident" id="6263389"><a href="/net/http/httputil/persist.go.html#6257176">bufio</a></span><span class="op" id="6263394">.</span><span class="ident" id="6263395">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263403">re</span><span class="op" id="6263405">,</span>&nbsp;<span class="ident" id="6263407">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6263419">error</span>&nbsp;<span class="comment" id="6263425">//&nbsp;read/write&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263447">lastbody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6263463"><a href="/net/http/httputil/persist.go.html#6257195">io</a></span><span class="op" id="6263465">.</span><span class="ident" id="6263466">ReadCloser</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263478">nread</span><span class="op" id="6263483">,</span>&nbsp;<span class="ident" id="6263485">nwritten</span>&nbsp;<span class="builtintype" id="6263494">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263499">pipereq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6263515">map</span><span class="op" id="6263518">[</span><span class="op" id="6263519">*</span><span class="ident" id="6263520"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6263524">.</span><span class="ident" id="6263525">Request</span><span class="op" id="6263532">]</span><span class="builtintype" id="6263533">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263540">pipe</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6263549"><a href="/net/http/httputil/persist.go.html#6257220">textproto</a></span><span class="op" id="6263558">.</span><span class="ident" id="6263559">Pipeline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263569">writeReq</span>&nbsp;<span class="keyword" id="6263578">func</span><span class="op" id="6263582">(</span><span class="op" id="6263583">*</span><span class="ident" id="6263584"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6263588">.</span><span class="ident" id="6263589">Request</span><span class="op" id="6263596">,</span>&nbsp;<span class="ident" id="6263598"><a href="/net/http/httputil/persist.go.html#6257195">io</a></span><span class="op" id="6263600">.</span><span class="ident" id="6263601">Writer</span><span class="op" id="6263607">)</span>&nbsp;<span class="builtintype" id="6263609">error</span><br>
<span class="lineno">240</span><span class="op" id="6263615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6263618">//&nbsp;NewClientConn&nbsp;returns&nbsp;a&nbsp;new&nbsp;ClientConn&nbsp;reading&nbsp;and&nbsp;writing&nbsp;c.&nbsp;&nbsp;If&nbsp;r&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6263696">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;the&nbsp;buffer&nbsp;to&nbsp;use&nbsp;when&nbsp;reading&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6263744">//</span><br>
<span class="lineno">245</span><span class="comment" id="6263747">//&nbsp;ClientConn&nbsp;is&nbsp;low-level&nbsp;and&nbsp;old.&nbsp;Applications&nbsp;should&nbsp;use&nbsp;Client&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6263817">//&nbsp;Transport&nbsp;in&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="6263855">func</span>&nbsp;<span class="ident" id="6263860">NewClientConn</span><span class="op" id="6263873">(</span><span class="ident" id="6263874">c</span>&nbsp;<span class="ident" id="6263876"><a href="/net/http/httputil/persist.go.html#6257201">net</a></span><span class="op" id="6263879">.</span><span class="ident" id="6263880">Conn</span><span class="op" id="6263884">,</span>&nbsp;<span class="ident" id="6263886">r</span>&nbsp;<span class="op" id="6263888">*</span><span class="ident" id="6263889"><a href="/net/http/httputil/persist.go.html#6257176">bufio</a></span><span class="op" id="6263894">.</span><span class="ident" id="6263895">Reader</span><span class="op" id="6263901">)</span>&nbsp;<span class="op" id="6263903">*</span><span class="ident" id="6263904"><a href="/net/http/httputil/persist.go.html#6263253">ClientConn</a></span>&nbsp;<span class="op" id="6263915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263918">if</span>&nbsp;<span class="ident" id="6263921"><a href="/net/http/httputil/persist.go.html#6263886">r</a></span>&nbsp;<span class="op" id="6263923">==</span>&nbsp;<span class="ident" id="6263926">nil</span>&nbsp;<span class="op" id="6263930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263934"><a href="/net/http/httputil/persist.go.html#6263886">r</a></span>&nbsp;<span class="op" id="6263936">=</span>&nbsp;<span class="ident" id="6263938"><a href="/net/http/httputil/persist.go.html#6257176">bufio</a></span><span class="op" id="6263943">.</span><span class="ident" id="6263944">NewReader</span><span class="op" id="6263953">(</span><span class="ident" id="6263954"><a href="/net/http/httputil/persist.go.html#6263874">c</a></span><span class="op" id="6263955">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263961">return</span>&nbsp;<span class="op" id="6263968">&amp;</span><span class="ident" id="6263969"><a href="/net/http/httputil/persist.go.html#6263253">ClientConn</a></span><span class="op" id="6263979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263983">c</span><span class="op" id="6263984">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6263993"><a href="/net/http/httputil/persist.go.html#6263874">c</a></span><span class="op" id="6263994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263998">r</span><span class="op" id="6263999">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6264008"><a href="/net/http/httputil/persist.go.html#6263886">r</a></span><span class="op" id="6264009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264013">pipereq</span><span class="op" id="6264020">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="6264023">make</span><span class="op" id="6264027">(</span><span class="keyword" id="6264028">map</span><span class="op" id="6264031">[</span><span class="op" id="6264032">*</span><span class="ident" id="6264033"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6264037">.</span><span class="ident" id="6264038">Request</span><span class="op" id="6264045">]</span><span class="builtintype" id="6264046">uint</span><span class="op" id="6264050">)</span><span class="op" id="6264051">,</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264055">writeReq</span><span class="op" id="6264063">:</span>&nbsp;<span class="op" id="6264065">(</span><span class="op" id="6264066">*</span><span class="ident" id="6264067"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6264071">.</span><span class="ident" id="6264072">Request</span><span class="op" id="6264079">)</span><span class="op" id="6264080">.</span><span class="ident" id="6264081">Write</span><span class="op" id="6264086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264089">}</span><br>
<span class="lineno"></span><span class="op" id="6264091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6264094">//&nbsp;NewProxyClientConn&nbsp;works&nbsp;like&nbsp;NewClientConn&nbsp;but&nbsp;writes&nbsp;Requests</span><br>
<span class="lineno">260</span><span class="comment" id="6264161">//&nbsp;using&nbsp;Request&#39;s&nbsp;WriteProxy&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="6264199">//</span><br>
<span class="lineno"></span><span class="comment" id="6264202">//&nbsp;New&nbsp;code&nbsp;should&nbsp;not&nbsp;use&nbsp;NewProxyClientConn.&nbsp;See&nbsp;Client&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6264263">//&nbsp;Transport&nbsp;in&nbsp;the&nbsp;net/http&nbsp;package&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="6264309">func</span>&nbsp;<span class="ident" id="6264314">NewProxyClientConn</span><span class="op" id="6264332">(</span><span class="ident" id="6264333">c</span>&nbsp;<span class="ident" id="6264335"><a href="/net/http/httputil/persist.go.html#6257201">net</a></span><span class="op" id="6264338">.</span><span class="ident" id="6264339">Conn</span><span class="op" id="6264343">,</span>&nbsp;<span class="ident" id="6264345">r</span>&nbsp;<span class="op" id="6264347">*</span><span class="ident" id="6264348"><a href="/net/http/httputil/persist.go.html#6257176">bufio</a></span><span class="op" id="6264353">.</span><span class="ident" id="6264354">Reader</span><span class="op" id="6264360">)</span>&nbsp;<span class="op" id="6264362">*</span><span class="ident" id="6264363"><a href="/net/http/httputil/persist.go.html#6263253">ClientConn</a></span>&nbsp;<span class="op" id="6264374">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264377">cc</span>&nbsp;<span class="op" id="6264380">:=</span>&nbsp;<span class="ident" id="6264383"><a href="/net/http/httputil/persist.go.html#6263860">NewClientConn</a></span><span class="op" id="6264396">(</span><span class="ident" id="6264397"><a href="/net/http/httputil/persist.go.html#6264333">c</a></span><span class="op" id="6264398">,</span>&nbsp;<span class="ident" id="6264400"><a href="/net/http/httputil/persist.go.html#6264345">r</a></span><span class="op" id="6264401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264404"><a href="/net/http/httputil/persist.go.html#6264377">cc</a></span><span class="op" id="6264406">.</span><span class="ident" id="6264407">writeReq</span>&nbsp;<span class="op" id="6264416">=</span>&nbsp;<span class="op" id="6264418">(</span><span class="op" id="6264419">*</span><span class="ident" id="6264420"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6264424">.</span><span class="ident" id="6264425">Request</span><span class="op" id="6264432">)</span><span class="op" id="6264433">.</span><span class="ident" id="6264434">WriteProxy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264446">return</span>&nbsp;<span class="ident" id="6264453"><a href="/net/http/httputil/persist.go.html#6264377">cc</a></span><br>
<span class="lineno"></span><span class="op" id="6264456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="6264459">//&nbsp;Hijack&nbsp;detaches&nbsp;the&nbsp;ClientConn&nbsp;and&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;connection&nbsp;as&nbsp;well</span><br>
<span class="lineno"></span><span class="comment" id="6264539">//&nbsp;as&nbsp;the&nbsp;read-side&nbsp;bufio&nbsp;which&nbsp;may&nbsp;have&nbsp;some&nbsp;left&nbsp;over&nbsp;data.&nbsp;Hijack&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6264615">//&nbsp;called&nbsp;before&nbsp;the&nbsp;user&nbsp;or&nbsp;Read&nbsp;have&nbsp;signaled&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;keep-alive</span><br>
<span class="lineno"></span><span class="comment" id="6264689">//&nbsp;logic.&nbsp;The&nbsp;user&nbsp;should&nbsp;not&nbsp;call&nbsp;Hijack&nbsp;while&nbsp;Read&nbsp;or&nbsp;Write&nbsp;is&nbsp;in&nbsp;progress.</span><br>
<span class="lineno"></span><span class="keyword" id="6264767">func</span>&nbsp;<span class="op" id="6264772">(</span><span class="ident" id="6264773">cc</span>&nbsp;<span class="op" id="6264776">*</span><span class="ident" id="6264777"><a href="/net/http/httputil/persist.go.html#6263253">ClientConn</a></span><span class="op" id="6264787">)</span>&nbsp;<span class="ident" id="6264789">Hijack</span><span class="op" id="6264795">(</span><span class="op" id="6264796">)</span>&nbsp;<span class="op" id="6264798">(</span><span class="ident" id="6264799">c</span>&nbsp;<span class="ident" id="6264801"><a href="/net/http/httputil/persist.go.html#6257201">net</a></span><span class="op" id="6264804">.</span><span class="ident" id="6264805">Conn</span><span class="op" id="6264809">,</span>&nbsp;<span class="ident" id="6264811">r</span>&nbsp;<span class="op" id="6264813">*</span><span class="ident" id="6264814"><a href="/net/http/httputil/persist.go.html#6257176">bufio</a></span><span class="op" id="6264819">.</span><span class="ident" id="6264820">Reader</span><span class="op" id="6264826">)</span>&nbsp;<span class="op" id="6264828">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264831"><a href="/net/http/httputil/persist.go.html#6264773">cc</a></span><span class="op" id="6264833">.</span><span class="ident" id="6264834">lk</span><span class="op" id="6264836">.</span><span class="ident" id="6264837">Lock</span><span class="op" id="6264841">(</span><span class="op" id="6264842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264845">defer</span>&nbsp;<span class="ident" id="6264851"><a href="/net/http/httputil/persist.go.html#6264773">cc</a></span><span class="op" id="6264853">.</span><span class="ident" id="6264854">lk</span><span class="op" id="6264856">.</span><span class="ident" id="6264857">Unlock</span><span class="op" id="6264863">(</span><span class="op" id="6264864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264867"><a href="/net/http/httputil/persist.go.html#6264799">c</a></span>&nbsp;<span class="op" id="6264869">=</span>&nbsp;<span class="ident" id="6264871"><a href="/net/http/httputil/persist.go.html#6264773">cc</a></span><span class="op" id="6264873">.</span><span class="ident" id="6264874">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264877"><a href="/net/http/httputil/persist.go.html#6264811">r</a></span>&nbsp;<span class="op" id="6264879">=</span>&nbsp;<span class="ident" id="6264881"><a href="/net/http/httputil/persist.go.html#6264773">cc</a></span><span class="op" id="6264883">.</span><span class="ident" id="6264884">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264887"><a href="/net/http/httputil/persist.go.html#6264773">cc</a></span><span class="op" id="6264889">.</span><span class="ident" id="6264890">c</span>&nbsp;<span class="op" id="6264892">=</span>&nbsp;<span class="ident" id="6264894">nil</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264899"><a href="/net/http/httputil/persist.go.html#6264773">cc</a></span><span class="op" id="6264901">.</span><span class="ident" id="6264902">r</span>&nbsp;<span class="op" id="6264904">=</span>&nbsp;<span class="ident" id="6264906">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264911">return</span><br>
<span class="lineno"></span><span class="op" id="6264918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6264921">//&nbsp;Close&nbsp;calls&nbsp;Hijack&nbsp;and&nbsp;then&nbsp;also&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;connection</span><br>
<span class="lineno">285</span><span class="keyword" id="6264990">func</span>&nbsp;<span class="op" id="6264995">(</span><span class="ident" id="6264996">cc</span>&nbsp;<span class="op" id="6264999">*</span><span class="ident" id="6265000"><a href="/net/http/httputil/persist.go.html#6263253">ClientConn</a></span><span class="op" id="6265010">)</span>&nbsp;<span class="ident" id="6265012">Close</span><span class="op" id="6265017">(</span><span class="op" id="6265018">)</span>&nbsp;<span class="builtintype" id="6265020">error</span>&nbsp;<span class="op" id="6265026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265029">c</span><span class="op" id="6265030">,</span>&nbsp;<span class="ident" id="6265032">_</span>&nbsp;<span class="op" id="6265034">:=</span>&nbsp;<span class="ident" id="6265037"><a href="/net/http/httputil/persist.go.html#6264996">cc</a></span><span class="op" id="6265039">.</span><span class="ident" id="6265040">Hijack</span><span class="op" id="6265046">(</span><span class="op" id="6265047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265050">if</span>&nbsp;<span class="ident" id="6265053"><a href="/net/http/httputil/persist.go.html#6265029">c</a></span>&nbsp;<span class="op" id="6265055">!=</span>&nbsp;<span class="ident" id="6265058">nil</span>&nbsp;<span class="op" id="6265062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265066">return</span>&nbsp;<span class="ident" id="6265073"><a href="/net/http/httputil/persist.go.html#6265029">c</a></span><span class="op" id="6265074">.</span><span class="ident" id="6265075">Close</span><span class="op" id="6265080">(</span><span class="op" id="6265081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265084">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265087">return</span>&nbsp;<span class="ident" id="6265094">nil</span><br>
<span class="lineno"></span><span class="op" id="6265098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6265101">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;request.&nbsp;An&nbsp;ErrPersistEOF&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="6265181">//&nbsp;has&nbsp;been&nbsp;closed&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;keepalive&nbsp;sense.&nbsp;If&nbsp;req.Close&nbsp;equals&nbsp;true,&nbsp;the</span><br>
<span class="lineno">295</span><span class="comment" id="6265258">//&nbsp;keepalive&nbsp;connection&nbsp;is&nbsp;logically&nbsp;closed&nbsp;after&nbsp;this&nbsp;request&nbsp;and&nbsp;the&nbsp;opposing</span><br>
<span class="lineno"></span><span class="comment" id="6265338">//&nbsp;server&nbsp;is&nbsp;informed.&nbsp;An&nbsp;ErrUnexpectedEOF&nbsp;indicates&nbsp;the&nbsp;remote&nbsp;closed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6265413">//&nbsp;underlying&nbsp;TCP&nbsp;connection,&nbsp;which&nbsp;is&nbsp;usually&nbsp;considered&nbsp;as&nbsp;graceful&nbsp;close.</span><br>
<span class="lineno"></span><span class="keyword" id="6265490">func</span>&nbsp;<span class="op" id="6265495">(</span><span class="ident" id="6265496">cc</span>&nbsp;<span class="op" id="6265499">*</span><span class="ident" id="6265500"><a href="/net/http/httputil/persist.go.html#6263253">ClientConn</a></span><span class="op" id="6265510">)</span>&nbsp;<span class="ident" id="6265512">Write</span><span class="op" id="6265517">(</span><span class="ident" id="6265518">req</span>&nbsp;<span class="op" id="6265522">*</span><span class="ident" id="6265523"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6265527">.</span><span class="ident" id="6265528">Request</span><span class="op" id="6265535">)</span>&nbsp;<span class="op" id="6265537">(</span><span class="ident" id="6265538">err</span>&nbsp;<span class="builtintype" id="6265542">error</span><span class="op" id="6265547">)</span>&nbsp;<span class="op" id="6265549">{</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6265553">//&nbsp;Ensure&nbsp;ordered&nbsp;execution&nbsp;of&nbsp;Writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265592">id</span>&nbsp;<span class="op" id="6265595">:=</span>&nbsp;<span class="ident" id="6265598"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6265600">.</span><span class="ident" id="6265601">pipe</span><span class="op" id="6265605">.</span><span class="ident" id="6265606">Next</span><span class="op" id="6265610">(</span><span class="op" id="6265611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265614"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6265616">.</span><span class="ident" id="6265617">pipe</span><span class="op" id="6265621">.</span><span class="ident" id="6265622">StartRequest</span><span class="op" id="6265634">(</span><span class="ident" id="6265635"><a href="/net/http/httputil/persist.go.html#6265592">id</a></span><span class="op" id="6265637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265640">defer</span>&nbsp;<span class="keyword" id="6265646">func</span><span class="op" id="6265650">(</span><span class="op" id="6265651">)</span>&nbsp;<span class="op" id="6265653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265657"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6265659">.</span><span class="ident" id="6265660">pipe</span><span class="op" id="6265664">.</span><span class="ident" id="6265665">EndRequest</span><span class="op" id="6265675">(</span><span class="ident" id="6265676"><a href="/net/http/httputil/persist.go.html#6265592">id</a></span><span class="op" id="6265678">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265682">if</span>&nbsp;<span class="ident" id="6265685"><a href="/net/http/httputil/persist.go.html#6265538">err</a></span>&nbsp;<span class="op" id="6265689">!=</span>&nbsp;<span class="ident" id="6265692">nil</span>&nbsp;<span class="op" id="6265696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265701"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6265703">.</span><span class="ident" id="6265704">pipe</span><span class="op" id="6265708">.</span><span class="ident" id="6265709">StartResponse</span><span class="op" id="6265722">(</span><span class="ident" id="6265723"><a href="/net/http/httputil/persist.go.html#6265592">id</a></span><span class="op" id="6265725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265730"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6265732">.</span><span class="ident" id="6265733">pipe</span><span class="op" id="6265737">.</span><span class="ident" id="6265738">EndResponse</span><span class="op" id="6265749">(</span><span class="ident" id="6265750"><a href="/net/http/httputil/persist.go.html#6265592">id</a></span><span class="op" id="6265752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265756">}</span>&nbsp;<span class="keyword" id="6265758">else</span>&nbsp;<span class="op" id="6265763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6265768">//&nbsp;Remember&nbsp;the&nbsp;pipeline&nbsp;id&nbsp;of&nbsp;this&nbsp;request</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265815"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6265817">.</span><span class="ident" id="6265818">lk</span><span class="op" id="6265820">.</span><span class="ident" id="6265821">Lock</span><span class="op" id="6265825">(</span><span class="op" id="6265826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265831"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6265833">.</span><span class="ident" id="6265834">pipereq</span><span class="op" id="6265841">[</span><span class="ident" id="6265842"><a href="/net/http/httputil/persist.go.html#6265518">req</a></span><span class="op" id="6265845">]</span>&nbsp;<span class="op" id="6265847">=</span>&nbsp;<span class="ident" id="6265849"><a href="/net/http/httputil/persist.go.html#6265592">id</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265855"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6265857">.</span><span class="ident" id="6265858">lk</span><span class="op" id="6265860">.</span><span class="ident" id="6265861">Unlock</span><span class="op" id="6265867">(</span><span class="op" id="6265868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265875">}</span><span class="op" id="6265876">(</span><span class="op" id="6265877">)</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265881"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6265883">.</span><span class="ident" id="6265884">lk</span><span class="op" id="6265886">.</span><span class="ident" id="6265887">Lock</span><span class="op" id="6265891">(</span><span class="op" id="6265892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265895">if</span>&nbsp;<span class="ident" id="6265898"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6265900">.</span><span class="ident" id="6265901">re</span>&nbsp;<span class="op" id="6265904">!=</span>&nbsp;<span class="ident" id="6265907">nil</span>&nbsp;<span class="op" id="6265911">{</span>&nbsp;<span class="comment" id="6265913">//&nbsp;no&nbsp;point&nbsp;sending&nbsp;if&nbsp;read-side&nbsp;closed&nbsp;or&nbsp;broken</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265965">defer</span>&nbsp;<span class="ident" id="6265971"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6265973">.</span><span class="ident" id="6265974">lk</span><span class="op" id="6265976">.</span><span class="ident" id="6265977">Unlock</span><span class="op" id="6265983">(</span><span class="op" id="6265984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265988">return</span>&nbsp;<span class="ident" id="6265995"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6265997">.</span><span class="ident" id="6265998">re</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266005">if</span>&nbsp;<span class="ident" id="6266008"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6266010">.</span><span class="ident" id="6266011">we</span>&nbsp;<span class="op" id="6266014">!=</span>&nbsp;<span class="ident" id="6266017">nil</span>&nbsp;<span class="op" id="6266021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266025">defer</span>&nbsp;<span class="ident" id="6266031"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6266033">.</span><span class="ident" id="6266034">lk</span><span class="op" id="6266036">.</span><span class="ident" id="6266037">Unlock</span><span class="op" id="6266043">(</span><span class="op" id="6266044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266048">return</span>&nbsp;<span class="ident" id="6266055"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6266057">.</span><span class="ident" id="6266058">we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266062">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266065">if</span>&nbsp;<span class="ident" id="6266068"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6266070">.</span><span class="ident" id="6266071">c</span>&nbsp;<span class="op" id="6266073">==</span>&nbsp;<span class="ident" id="6266076">nil</span>&nbsp;<span class="op" id="6266080">{</span>&nbsp;<span class="comment" id="6266082">//&nbsp;connection&nbsp;closed&nbsp;by&nbsp;user&nbsp;in&nbsp;the&nbsp;meantime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266129">defer</span>&nbsp;<span class="ident" id="6266135"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6266137">.</span><span class="ident" id="6266138">lk</span><span class="op" id="6266140">.</span><span class="ident" id="6266141">Unlock</span><span class="op" id="6266147">(</span><span class="op" id="6266148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266152">return</span>&nbsp;<span class="ident" id="6266159"><a href="/net/http/httputil/persist.go.html#6257612">errClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266173">c</span>&nbsp;<span class="op" id="6266175">:=</span>&nbsp;<span class="ident" id="6266178"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6266180">.</span><span class="ident" id="6266181">c</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266184">if</span>&nbsp;<span class="ident" id="6266187"><a href="/net/http/httputil/persist.go.html#6265518">req</a></span><span class="op" id="6266190">.</span><span class="ident" id="6266191">Close</span>&nbsp;<span class="op" id="6266197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6266201">//&nbsp;We&nbsp;write&nbsp;the&nbsp;EOF&nbsp;to&nbsp;the&nbsp;write-side&nbsp;error,&nbsp;because&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6266262">//&nbsp;still&nbsp;might&nbsp;be&nbsp;some&nbsp;pipelined&nbsp;reads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266303"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6266305">.</span><span class="ident" id="6266306">we</span>&nbsp;<span class="op" id="6266309">=</span>&nbsp;<span class="ident" id="6266311"><a href="/net/http/httputil/persist.go.html#6257254">ErrPersistEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266326">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266329"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6266331">.</span><span class="ident" id="6266332">lk</span><span class="op" id="6266334">.</span><span class="ident" id="6266335">Unlock</span><span class="op" id="6266341">(</span><span class="op" id="6266342">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266346"><a href="/net/http/httputil/persist.go.html#6265538">err</a></span>&nbsp;<span class="op" id="6266350">=</span>&nbsp;<span class="ident" id="6266352"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6266354">.</span><span class="ident" id="6266355">writeReq</span><span class="op" id="6266363">(</span><span class="ident" id="6266364"><a href="/net/http/httputil/persist.go.html#6265518">req</a></span><span class="op" id="6266367">,</span>&nbsp;<span class="ident" id="6266369"><a href="/net/http/httputil/persist.go.html#6266173">c</a></span><span class="op" id="6266370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266373"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6266375">.</span><span class="ident" id="6266376">lk</span><span class="op" id="6266378">.</span><span class="ident" id="6266379">Lock</span><span class="op" id="6266383">(</span><span class="op" id="6266384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266387">defer</span>&nbsp;<span class="ident" id="6266393"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6266395">.</span><span class="ident" id="6266396">lk</span><span class="op" id="6266398">.</span><span class="ident" id="6266399">Unlock</span><span class="op" id="6266405">(</span><span class="op" id="6266406">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266409">if</span>&nbsp;<span class="ident" id="6266412"><a href="/net/http/httputil/persist.go.html#6265538">err</a></span>&nbsp;<span class="op" id="6266416">!=</span>&nbsp;<span class="ident" id="6266419">nil</span>&nbsp;<span class="op" id="6266423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266427"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6266429">.</span><span class="ident" id="6266430">we</span>&nbsp;<span class="op" id="6266433">=</span>&nbsp;<span class="ident" id="6266435"><a href="/net/http/httputil/persist.go.html#6265538">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266441">return</span>&nbsp;<span class="ident" id="6266448"><a href="/net/http/httputil/persist.go.html#6265538">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266456"><a href="/net/http/httputil/persist.go.html#6265496">cc</a></span><span class="op" id="6266458">.</span><span class="ident" id="6266459">nwritten</span><span class="op" id="6266467">++</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266472">return</span>&nbsp;<span class="ident" id="6266479">nil</span><br>
<span class="lineno"></span><span class="op" id="6266483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6266486">//&nbsp;Pending&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;unanswered&nbsp;requests</span><br>
<span class="lineno">350</span><span class="comment" id="6266539">//&nbsp;that&nbsp;have&nbsp;been&nbsp;sent&nbsp;on&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6266581">func</span>&nbsp;<span class="op" id="6266586">(</span><span class="ident" id="6266587">cc</span>&nbsp;<span class="op" id="6266590">*</span><span class="ident" id="6266591"><a href="/net/http/httputil/persist.go.html#6263253">ClientConn</a></span><span class="op" id="6266601">)</span>&nbsp;<span class="ident" id="6266603">Pending</span><span class="op" id="6266610">(</span><span class="op" id="6266611">)</span>&nbsp;<span class="builtintype" id="6266613">int</span>&nbsp;<span class="op" id="6266617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266620"><a href="/net/http/httputil/persist.go.html#6266587">cc</a></span><span class="op" id="6266622">.</span><span class="ident" id="6266623">lk</span><span class="op" id="6266625">.</span><span class="ident" id="6266626">Lock</span><span class="op" id="6266630">(</span><span class="op" id="6266631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266634">defer</span>&nbsp;<span class="ident" id="6266640"><a href="/net/http/httputil/persist.go.html#6266587">cc</a></span><span class="op" id="6266642">.</span><span class="ident" id="6266643">lk</span><span class="op" id="6266645">.</span><span class="ident" id="6266646">Unlock</span><span class="op" id="6266652">(</span><span class="op" id="6266653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266656">return</span>&nbsp;<span class="ident" id="6266663"><a href="/net/http/httputil/persist.go.html#6266587">cc</a></span><span class="op" id="6266665">.</span><span class="ident" id="6266666">nwritten</span>&nbsp;<span class="op" id="6266675">-</span>&nbsp;<span class="ident" id="6266677"><a href="/net/http/httputil/persist.go.html#6266587">cc</a></span><span class="op" id="6266679">.</span><span class="ident" id="6266680">nread</span><br>
<span class="lineno">355</span><span class="op" id="6266686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6266689">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;response&nbsp;from&nbsp;the&nbsp;wire.&nbsp;A&nbsp;valid&nbsp;response&nbsp;might&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6266762">//&nbsp;returned&nbsp;together&nbsp;with&nbsp;an&nbsp;ErrPersistEOF,&nbsp;which&nbsp;means&nbsp;that&nbsp;the&nbsp;remote</span><br>
<span class="lineno"></span><span class="comment" id="6266834">//&nbsp;requested&nbsp;that&nbsp;this&nbsp;be&nbsp;the&nbsp;last&nbsp;request&nbsp;serviced.&nbsp;Read&nbsp;can&nbsp;be&nbsp;called</span><br>
<span class="lineno">360</span><span class="comment" id="6266906">//&nbsp;concurrently&nbsp;with&nbsp;Write,&nbsp;but&nbsp;not&nbsp;with&nbsp;another&nbsp;Read.</span><br>
<span class="lineno"></span><span class="keyword" id="6266961">func</span>&nbsp;<span class="op" id="6266966">(</span><span class="ident" id="6266967">cc</span>&nbsp;<span class="op" id="6266970">*</span><span class="ident" id="6266971"><a href="/net/http/httputil/persist.go.html#6263253">ClientConn</a></span><span class="op" id="6266981">)</span>&nbsp;<span class="ident" id="6266983">Read</span><span class="op" id="6266987">(</span><span class="ident" id="6266988">req</span>&nbsp;<span class="op" id="6266992">*</span><span class="ident" id="6266993"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6266997">.</span><span class="ident" id="6266998">Request</span><span class="op" id="6267005">)</span>&nbsp;<span class="op" id="6267007">(</span><span class="ident" id="6267008">resp</span>&nbsp;<span class="op" id="6267013">*</span><span class="ident" id="6267014"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6267018">.</span><span class="ident" id="6267019">Response</span><span class="op" id="6267027">,</span>&nbsp;<span class="ident" id="6267029">err</span>&nbsp;<span class="builtintype" id="6267033">error</span><span class="op" id="6267038">)</span>&nbsp;<span class="op" id="6267040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267043">//&nbsp;Retrieve&nbsp;the&nbsp;pipeline&nbsp;ID&nbsp;of&nbsp;this&nbsp;request/response&nbsp;pair</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267102"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267104">.</span><span class="ident" id="6267105">lk</span><span class="op" id="6267107">.</span><span class="ident" id="6267108">Lock</span><span class="op" id="6267112">(</span><span class="op" id="6267113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267116">id</span><span class="op" id="6267118">,</span>&nbsp;<span class="ident" id="6267120">ok</span>&nbsp;<span class="op" id="6267123">:=</span>&nbsp;<span class="ident" id="6267126"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267128">.</span><span class="ident" id="6267129">pipereq</span><span class="op" id="6267136">[</span><span class="ident" id="6267137"><a href="/net/http/httputil/persist.go.html#6266988">req</a></span><span class="op" id="6267140">]</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6267143">delete</span><span class="op" id="6267149">(</span><span class="ident" id="6267150"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267152">.</span><span class="ident" id="6267153">pipereq</span><span class="op" id="6267160">,</span>&nbsp;<span class="ident" id="6267162"><a href="/net/http/httputil/persist.go.html#6266988">req</a></span><span class="op" id="6267165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267168">if</span>&nbsp;<span class="op" id="6267171">!</span><span class="ident" id="6267172"><a href="/net/http/httputil/persist.go.html#6267120">ok</a></span>&nbsp;<span class="op" id="6267175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267179"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267181">.</span><span class="ident" id="6267182">lk</span><span class="op" id="6267184">.</span><span class="ident" id="6267185">Unlock</span><span class="op" id="6267191">(</span><span class="op" id="6267192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267196">return</span>&nbsp;<span class="ident" id="6267203">nil</span><span class="op" id="6267206">,</span>&nbsp;<span class="ident" id="6267208"><a href="/net/http/httputil/persist.go.html#6257415">ErrPipeline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267221">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267224"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267226">.</span><span class="ident" id="6267227">lk</span><span class="op" id="6267229">.</span><span class="ident" id="6267230">Unlock</span><span class="op" id="6267236">(</span><span class="op" id="6267237">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267241">//&nbsp;Ensure&nbsp;pipeline&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267267"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267269">.</span><span class="ident" id="6267270">pipe</span><span class="op" id="6267274">.</span><span class="ident" id="6267275">StartResponse</span><span class="op" id="6267288">(</span><span class="ident" id="6267289"><a href="/net/http/httputil/persist.go.html#6267116">id</a></span><span class="op" id="6267291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267294">defer</span>&nbsp;<span class="ident" id="6267300"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267302">.</span><span class="ident" id="6267303">pipe</span><span class="op" id="6267307">.</span><span class="ident" id="6267308">EndResponse</span><span class="op" id="6267319">(</span><span class="ident" id="6267320"><a href="/net/http/httputil/persist.go.html#6267116">id</a></span><span class="op" id="6267322">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267326"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267328">.</span><span class="ident" id="6267329">lk</span><span class="op" id="6267331">.</span><span class="ident" id="6267332">Lock</span><span class="op" id="6267336">(</span><span class="op" id="6267337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267340">if</span>&nbsp;<span class="ident" id="6267343"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267345">.</span><span class="ident" id="6267346">re</span>&nbsp;<span class="op" id="6267349">!=</span>&nbsp;<span class="ident" id="6267352">nil</span>&nbsp;<span class="op" id="6267356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267360">defer</span>&nbsp;<span class="ident" id="6267366"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267368">.</span><span class="ident" id="6267369">lk</span><span class="op" id="6267371">.</span><span class="ident" id="6267372">Unlock</span><span class="op" id="6267378">(</span><span class="op" id="6267379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267383">return</span>&nbsp;<span class="ident" id="6267390">nil</span><span class="op" id="6267393">,</span>&nbsp;<span class="ident" id="6267395"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267397">.</span><span class="ident" id="6267398">re</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267405">if</span>&nbsp;<span class="ident" id="6267408"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267410">.</span><span class="ident" id="6267411">r</span>&nbsp;<span class="op" id="6267413">==</span>&nbsp;<span class="ident" id="6267416">nil</span>&nbsp;<span class="op" id="6267420">{</span>&nbsp;<span class="comment" id="6267422">//&nbsp;connection&nbsp;closed&nbsp;by&nbsp;user&nbsp;in&nbsp;the&nbsp;meantime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267469">defer</span>&nbsp;<span class="ident" id="6267475"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267477">.</span><span class="ident" id="6267478">lk</span><span class="op" id="6267480">.</span><span class="ident" id="6267481">Unlock</span><span class="op" id="6267487">(</span><span class="op" id="6267488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267492">return</span>&nbsp;<span class="ident" id="6267499">nil</span><span class="op" id="6267502">,</span>&nbsp;<span class="ident" id="6267504"><a href="/net/http/httputil/persist.go.html#6257612">errClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267515">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267518">r</span>&nbsp;<span class="op" id="6267520">:=</span>&nbsp;<span class="ident" id="6267523"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267525">.</span><span class="ident" id="6267526">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267529">lastbody</span>&nbsp;<span class="op" id="6267538">:=</span>&nbsp;<span class="ident" id="6267541"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267543">.</span><span class="ident" id="6267544">lastbody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267554"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267556">.</span><span class="ident" id="6267557">lastbody</span>&nbsp;<span class="op" id="6267566">=</span>&nbsp;<span class="ident" id="6267568">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267573"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267575">.</span><span class="ident" id="6267576">lk</span><span class="op" id="6267578">.</span><span class="ident" id="6267579">Unlock</span><span class="op" id="6267585">(</span><span class="op" id="6267586">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267590">//&nbsp;Make&nbsp;sure&nbsp;body&nbsp;is&nbsp;fully&nbsp;consumed,&nbsp;even&nbsp;if&nbsp;user&nbsp;does&nbsp;not&nbsp;call&nbsp;body.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267666">if</span>&nbsp;<span class="ident" id="6267669"><a href="/net/http/httputil/persist.go.html#6267529">lastbody</a></span>&nbsp;<span class="op" id="6267678">!=</span>&nbsp;<span class="ident" id="6267681">nil</span>&nbsp;<span class="op" id="6267685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267689">//&nbsp;body.Close&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;idempotent&nbsp;and&nbsp;multiple&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267755">//&nbsp;it&nbsp;should&nbsp;return&nbsp;the&nbsp;error&nbsp;that&nbsp;its&nbsp;first&nbsp;invocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267813">//&nbsp;returned.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267828"><a href="/net/http/httputil/persist.go.html#6267029">err</a></span>&nbsp;<span class="op" id="6267832">=</span>&nbsp;<span class="ident" id="6267834"><a href="/net/http/httputil/persist.go.html#6267529">lastbody</a></span><span class="op" id="6267842">.</span><span class="ident" id="6267843">Close</span><span class="op" id="6267848">(</span><span class="op" id="6267849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267853">if</span>&nbsp;<span class="ident" id="6267856"><a href="/net/http/httputil/persist.go.html#6267029">err</a></span>&nbsp;<span class="op" id="6267860">!=</span>&nbsp;<span class="ident" id="6267863">nil</span>&nbsp;<span class="op" id="6267867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267872"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267874">.</span><span class="ident" id="6267875">lk</span><span class="op" id="6267877">.</span><span class="ident" id="6267878">Lock</span><span class="op" id="6267882">(</span><span class="op" id="6267883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267888">defer</span>&nbsp;<span class="ident" id="6267894"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267896">.</span><span class="ident" id="6267897">lk</span><span class="op" id="6267899">.</span><span class="ident" id="6267900">Unlock</span><span class="op" id="6267906">(</span><span class="op" id="6267907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267912"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267914">.</span><span class="ident" id="6267915">re</span>&nbsp;<span class="op" id="6267918">=</span>&nbsp;<span class="ident" id="6267920"><a href="/net/http/httputil/persist.go.html#6267029">err</a></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267927">return</span>&nbsp;<span class="ident" id="6267934">nil</span><span class="op" id="6267937">,</span>&nbsp;<span class="ident" id="6267939"><a href="/net/http/httputil/persist.go.html#6267029">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267952"><a href="/net/http/httputil/persist.go.html#6267008">resp</a></span><span class="op" id="6267956">,</span>&nbsp;<span class="ident" id="6267958"><a href="/net/http/httputil/persist.go.html#6267029">err</a></span>&nbsp;<span class="op" id="6267962">=</span>&nbsp;<span class="ident" id="6267964"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6267968">.</span><span class="ident" id="6267969">ReadResponse</span><span class="op" id="6267981">(</span><span class="ident" id="6267982"><a href="/net/http/httputil/persist.go.html#6267518">r</a></span><span class="op" id="6267983">,</span>&nbsp;<span class="ident" id="6267985"><a href="/net/http/httputil/persist.go.html#6266988">req</a></span><span class="op" id="6267988">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267991"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6267993">.</span><span class="ident" id="6267994">lk</span><span class="op" id="6267996">.</span><span class="ident" id="6267997">Lock</span><span class="op" id="6268001">(</span><span class="op" id="6268002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268005">defer</span>&nbsp;<span class="ident" id="6268011"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6268013">.</span><span class="ident" id="6268014">lk</span><span class="op" id="6268016">.</span><span class="ident" id="6268017">Unlock</span><span class="op" id="6268023">(</span><span class="op" id="6268024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268027">if</span>&nbsp;<span class="ident" id="6268030"><a href="/net/http/httputil/persist.go.html#6267029">err</a></span>&nbsp;<span class="op" id="6268034">!=</span>&nbsp;<span class="ident" id="6268037">nil</span>&nbsp;<span class="op" id="6268041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268045"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6268047">.</span><span class="ident" id="6268048">re</span>&nbsp;<span class="op" id="6268051">=</span>&nbsp;<span class="ident" id="6268053"><a href="/net/http/httputil/persist.go.html#6267029">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268059">return</span>&nbsp;<span class="ident" id="6268066"><a href="/net/http/httputil/persist.go.html#6267008">resp</a></span><span class="op" id="6268070">,</span>&nbsp;<span class="ident" id="6268072"><a href="/net/http/httputil/persist.go.html#6267029">err</a></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268080"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6268082">.</span><span class="ident" id="6268083">lastbody</span>&nbsp;<span class="op" id="6268092">=</span>&nbsp;<span class="ident" id="6268094"><a href="/net/http/httputil/persist.go.html#6267008">resp</a></span><span class="op" id="6268098">.</span><span class="ident" id="6268099">Body</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268106"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6268108">.</span><span class="ident" id="6268109">nread</span><span class="op" id="6268114">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268119">if</span>&nbsp;<span class="ident" id="6268122"><a href="/net/http/httputil/persist.go.html#6267008">resp</a></span><span class="op" id="6268126">.</span><span class="ident" id="6268127">Close</span>&nbsp;<span class="op" id="6268133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268137"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6268139">.</span><span class="ident" id="6268140">re</span>&nbsp;<span class="op" id="6268143">=</span>&nbsp;<span class="ident" id="6268145"><a href="/net/http/httputil/persist.go.html#6257254">ErrPersistEOF</a></span>&nbsp;<span class="comment" id="6268159">//&nbsp;don&#39;t&nbsp;send&nbsp;any&nbsp;more&nbsp;requests</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268193">return</span>&nbsp;<span class="ident" id="6268200"><a href="/net/http/httputil/persist.go.html#6267008">resp</a></span><span class="op" id="6268204">,</span>&nbsp;<span class="ident" id="6268206"><a href="/net/http/httputil/persist.go.html#6266967">cc</a></span><span class="op" id="6268208">.</span><span class="ident" id="6268209">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268216">return</span>&nbsp;<span class="ident" id="6268223"><a href="/net/http/httputil/persist.go.html#6267008">resp</a></span><span class="op" id="6268227">,</span>&nbsp;<span class="ident" id="6268229"><a href="/net/http/httputil/persist.go.html#6267029">err</a></span><br>
<span class="lineno">420</span><span class="op" id="6268233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6268236">//&nbsp;Do&nbsp;is&nbsp;convenience&nbsp;method&nbsp;that&nbsp;writes&nbsp;a&nbsp;request&nbsp;and&nbsp;reads&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="6268308">func</span>&nbsp;<span class="op" id="6268313">(</span><span class="ident" id="6268314">cc</span>&nbsp;<span class="op" id="6268317">*</span><span class="ident" id="6268318"><a href="/net/http/httputil/persist.go.html#6263253">ClientConn</a></span><span class="op" id="6268328">)</span>&nbsp;<span class="ident" id="6268330">Do</span><span class="op" id="6268332">(</span><span class="ident" id="6268333">req</span>&nbsp;<span class="op" id="6268337">*</span><span class="ident" id="6268338"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6268342">.</span><span class="ident" id="6268343">Request</span><span class="op" id="6268350">)</span>&nbsp;<span class="op" id="6268352">(</span><span class="ident" id="6268353">resp</span>&nbsp;<span class="op" id="6268358">*</span><span class="ident" id="6268359"><a href="/net/http/httputil/persist.go.html#6257208">http</a></span><span class="op" id="6268363">.</span><span class="ident" id="6268364">Response</span><span class="op" id="6268372">,</span>&nbsp;<span class="ident" id="6268374">err</span>&nbsp;<span class="builtintype" id="6268378">error</span><span class="op" id="6268383">)</span>&nbsp;<span class="op" id="6268385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268388"><a href="/net/http/httputil/persist.go.html#6268374">err</a></span>&nbsp;<span class="op" id="6268392">=</span>&nbsp;<span class="ident" id="6268394"><a href="/net/http/httputil/persist.go.html#6268314">cc</a></span><span class="op" id="6268396">.</span><span class="ident" id="6268397">Write</span><span class="op" id="6268402">(</span><span class="ident" id="6268403"><a href="/net/http/httputil/persist.go.html#6268333">req</a></span><span class="op" id="6268406">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268409">if</span>&nbsp;<span class="ident" id="6268412"><a href="/net/http/httputil/persist.go.html#6268374">err</a></span>&nbsp;<span class="op" id="6268416">!=</span>&nbsp;<span class="ident" id="6268419">nil</span>&nbsp;<span class="op" id="6268423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268427">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268438">return</span>&nbsp;<span class="ident" id="6268445"><a href="/net/http/httputil/persist.go.html#6268314">cc</a></span><span class="op" id="6268447">.</span><span class="ident" id="6268448">Read</span><span class="op" id="6268452">(</span><span class="ident" id="6268453"><a href="/net/http/httputil/persist.go.html#6268333">req</a></span><span class="op" id="6268456">)</span><br>
<span class="lineno"></span><span class="op" id="6268458">}</span>
</div>
</body>
</html>
