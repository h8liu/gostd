<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/csv</h2>
<ul>
<li><a href="/gostd/encoding/csv/reader.go.html">reader.go</a></li>
<li><a href="/gostd/encoding/csv/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/encoding/csv/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/encoding/csv/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6311818">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6311873">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6311927">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6311978">package</span>&nbsp;<span class="ident" id="6311986">csv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6311991">import</span>&nbsp;<span class="op" id="6311998">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6312001">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6312010">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6312016">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6312027">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6312038">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="6312053">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6312056">//&nbsp;A&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;to&nbsp;a&nbsp;CSV&nbsp;encoded&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6312106">//</span><br>
<span class="lineno"></span><span class="comment" id="6312109">//&nbsp;As&nbsp;returned&nbsp;by&nbsp;NewWriter,&nbsp;a&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;terminated&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6312178">//&nbsp;newline&nbsp;and&nbsp;uses&nbsp;&#39;,&#39;&nbsp;as&nbsp;the&nbsp;field&nbsp;delimiter.&nbsp;&nbsp;The&nbsp;exported&nbsp;fields&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6312254">//&nbsp;changed&nbsp;to&nbsp;customize&nbsp;the&nbsp;details&nbsp;before&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;WriteAll.</span><br>
<span class="lineno">20</span><span class="comment" id="6312334">//</span><br>
<span class="lineno"></span><span class="comment" id="6312337">//&nbsp;Comma&nbsp;is&nbsp;the&nbsp;field&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="6312370">//</span><br>
<span class="lineno"></span><span class="comment" id="6312373">//&nbsp;If&nbsp;UseCRLF&nbsp;is&nbsp;true,&nbsp;the&nbsp;Writer&nbsp;ends&nbsp;each&nbsp;record&nbsp;with&nbsp;\r\n&nbsp;instead&nbsp;of&nbsp;\n.</span><br>
<span class="lineno"></span><span class="keyword" id="6312449">type</span>&nbsp;<span class="ident" id="6312454">Writer</span>&nbsp;<span class="keyword" id="6312461">struct</span>&nbsp;<span class="op" id="6312468">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312471">Comma</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6312479">rune</span>&nbsp;<span class="comment" id="6312484">//&nbsp;Field&nbsp;delimiter&nbsp;(set&nbsp;to&nbsp;&#39;,&#39;&nbsp;by&nbsp;NewWriter)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312530">UseCRLF</span>&nbsp;<span class="builtintype" id="6312538">bool</span>&nbsp;<span class="comment" id="6312543">//&nbsp;True&nbsp;to&nbsp;use&nbsp;\r\n&nbsp;as&nbsp;the&nbsp;line&nbsp;terminator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312587">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6312595">*</span><span class="ident" id="6312596">bufio</span><span class="op" id="6312601">.</span><span class="ident" id="6312602">Writer</span><br>
<span class="lineno"></span><span class="op" id="6312609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6312612">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6312664">func</span>&nbsp;<span class="ident" id="6312669">NewWriter</span><span class="op" id="6312678">(</span><span class="ident" id="6312679">w</span>&nbsp;<span class="ident" id="6312681">io</span><span class="op" id="6312683">.</span><span class="ident" id="6312684">Writer</span><span class="op" id="6312690">)</span>&nbsp;<span class="op" id="6312692">*</span><span class="ident" id="6312693">Writer</span>&nbsp;<span class="op" id="6312700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312703">return</span>&nbsp;<span class="op" id="6312710">&amp;</span><span class="ident" id="6312711">Writer</span><span class="op" id="6312717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312721">Comma</span><span class="op" id="6312726">:</span>&nbsp;<span class="string" id="6312728">&#39;,&#39;</span><span class="op" id="6312731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312735">w</span><span class="op" id="6312736">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312742">bufio</span><span class="op" id="6312747">.</span><span class="ident" id="6312748">NewWriter</span><span class="op" id="6312757">(</span><span class="ident" id="6312758">w</span><span class="op" id="6312759">)</span><span class="op" id="6312760">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6312763">}</span><br>
<span class="lineno"></span><span class="op" id="6312765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6312768">//&nbsp;Writer&nbsp;writes&nbsp;a&nbsp;single&nbsp;CSV&nbsp;record&nbsp;to&nbsp;w&nbsp;along&nbsp;with&nbsp;any&nbsp;necessary&nbsp;quoting.</span><br>
<span class="lineno"></span><span class="comment" id="6312844">//&nbsp;A&nbsp;record&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;with&nbsp;each&nbsp;string&nbsp;being&nbsp;one&nbsp;field.</span><br>
<span class="lineno">40</span><span class="keyword" id="6312912">func</span>&nbsp;<span class="op" id="6312917">(</span><span class="ident" id="6312918">w</span>&nbsp;<span class="op" id="6312920">*</span><span class="ident" id="6312921">Writer</span><span class="op" id="6312927">)</span>&nbsp;<span class="ident" id="6312929">Write</span><span class="op" id="6312934">(</span><span class="ident" id="6312935">record</span>&nbsp;<span class="op" id="6312942">[</span><span class="op" id="6312943">]</span><span class="builtintype" id="6312944">string</span><span class="op" id="6312950">)</span>&nbsp;<span class="op" id="6312952">(</span><span class="ident" id="6312953">err</span>&nbsp;<span class="builtintype" id="6312957">error</span><span class="op" id="6312962">)</span>&nbsp;<span class="op" id="6312964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312967">for</span>&nbsp;<span class="ident" id="6312971">n</span><span class="op" id="6312972">,</span>&nbsp;<span class="ident" id="6312974">field</span>&nbsp;<span class="op" id="6312980">:=</span>&nbsp;<span class="keyword" id="6312983">range</span>&nbsp;<span class="ident" id="6312989">record</span>&nbsp;<span class="op" id="6312996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313000">if</span>&nbsp;<span class="ident" id="6313003">n</span>&nbsp;<span class="op" id="6313005">&gt;</span>&nbsp;<span class="num" id="6313007">0</span>&nbsp;<span class="op" id="6313009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313014">if</span>&nbsp;<span class="ident" id="6313017">_</span><span class="op" id="6313018">,</span>&nbsp;<span class="ident" id="6313020">err</span>&nbsp;<span class="op" id="6313024">=</span>&nbsp;<span class="ident" id="6313026">w</span><span class="op" id="6313027">.</span><span class="ident" id="6313028">w</span><span class="op" id="6313029">.</span><span class="ident" id="6313030">WriteRune</span><span class="op" id="6313039">(</span><span class="ident" id="6313040">w</span><span class="op" id="6313041">.</span><span class="ident" id="6313042">Comma</span><span class="op" id="6313047">)</span><span class="op" id="6313048">;</span>&nbsp;<span class="ident" id="6313050">err</span>&nbsp;<span class="op" id="6313054">!=</span>&nbsp;<span class="builtintype" id="6313057">nil</span>&nbsp;<span class="op" id="6313061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313067">return</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6313086">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;have&nbsp;a&nbsp;quoted&nbsp;field&nbsp;then&nbsp;just</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6313141">//&nbsp;write&nbsp;out&nbsp;the&nbsp;field&nbsp;and&nbsp;continue&nbsp;to&nbsp;the&nbsp;next&nbsp;field.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313198">if</span>&nbsp;<span class="op" id="6313201">!</span><span class="ident" id="6313202">w</span><span class="op" id="6313203">.</span><span class="ident" id="6313204">fieldNeedsQuotes</span><span class="op" id="6313220">(</span><span class="ident" id="6313221">field</span><span class="op" id="6313226">)</span>&nbsp;<span class="op" id="6313228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313233">if</span>&nbsp;<span class="ident" id="6313236">_</span><span class="op" id="6313237">,</span>&nbsp;<span class="ident" id="6313239">err</span>&nbsp;<span class="op" id="6313243">=</span>&nbsp;<span class="ident" id="6313245">w</span><span class="op" id="6313246">.</span><span class="ident" id="6313247">w</span><span class="op" id="6313248">.</span><span class="ident" id="6313249">WriteString</span><span class="op" id="6313260">(</span><span class="ident" id="6313261">field</span><span class="op" id="6313266">)</span><span class="op" id="6313267">;</span>&nbsp;<span class="ident" id="6313269">err</span>&nbsp;<span class="op" id="6313273">!=</span>&nbsp;<span class="builtintype" id="6313276">nil</span>&nbsp;<span class="op" id="6313280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313286">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313301">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313316">if</span>&nbsp;<span class="ident" id="6313319">err</span>&nbsp;<span class="op" id="6313323">=</span>&nbsp;<span class="ident" id="6313325">w</span><span class="op" id="6313326">.</span><span class="ident" id="6313327">w</span><span class="op" id="6313328">.</span><span class="ident" id="6313329">WriteByte</span><span class="op" id="6313338">(</span><span class="string" id="6313339">&#39;&#34;&#39;</span><span class="op" id="6313342">)</span><span class="op" id="6313343">;</span>&nbsp;<span class="ident" id="6313345">err</span>&nbsp;<span class="op" id="6313349">!=</span>&nbsp;<span class="builtintype" id="6313352">nil</span>&nbsp;<span class="op" id="6313356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313361">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313375">for</span>&nbsp;<span class="ident" id="6313379">_</span><span class="op" id="6313380">,</span>&nbsp;<span class="ident" id="6313382">r1</span>&nbsp;<span class="op" id="6313385">:=</span>&nbsp;<span class="keyword" id="6313388">range</span>&nbsp;<span class="ident" id="6313394">field</span>&nbsp;<span class="op" id="6313400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313405">switch</span>&nbsp;<span class="ident" id="6313412">r1</span>&nbsp;<span class="op" id="6313415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313420">case</span>&nbsp;<span class="string" id="6313425">&#39;&#34;&#39;</span><span class="op" id="6313428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313434">_</span><span class="op" id="6313435">,</span>&nbsp;<span class="ident" id="6313437">err</span>&nbsp;<span class="op" id="6313441">=</span>&nbsp;<span class="ident" id="6313443">w</span><span class="op" id="6313444">.</span><span class="ident" id="6313445">w</span><span class="op" id="6313446">.</span><span class="ident" id="6313447">WriteString</span><span class="op" id="6313458">(</span><span class="string" id="6313459">`&#34;&#34;`</span><span class="op" id="6313463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313468">case</span>&nbsp;<span class="string" id="6313473">&#39;\r&#39;</span><span class="op" id="6313477">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313483">if</span>&nbsp;<span class="op" id="6313486">!</span><span class="ident" id="6313487">w</span><span class="op" id="6313488">.</span><span class="ident" id="6313489">UseCRLF</span>&nbsp;<span class="op" id="6313497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313504">err</span>&nbsp;<span class="op" id="6313508">=</span>&nbsp;<span class="ident" id="6313510">w</span><span class="op" id="6313511">.</span><span class="ident" id="6313512">w</span><span class="op" id="6313513">.</span><span class="ident" id="6313514">WriteByte</span><span class="op" id="6313523">(</span><span class="string" id="6313524">&#39;\r&#39;</span><span class="op" id="6313528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313539">case</span>&nbsp;<span class="string" id="6313544">&#39;\n&#39;</span><span class="op" id="6313548">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313554">if</span>&nbsp;<span class="ident" id="6313557">w</span><span class="op" id="6313558">.</span><span class="ident" id="6313559">UseCRLF</span>&nbsp;<span class="op" id="6313567">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313574">_</span><span class="op" id="6313575">,</span>&nbsp;<span class="ident" id="6313577">err</span>&nbsp;<span class="op" id="6313581">=</span>&nbsp;<span class="ident" id="6313583">w</span><span class="op" id="6313584">.</span><span class="ident" id="6313585">w</span><span class="op" id="6313586">.</span><span class="ident" id="6313587">WriteString</span><span class="op" id="6313598">(</span><span class="string" id="6313599">&#34;\r\n&#34;</span><span class="op" id="6313605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313611">}</span>&nbsp;<span class="keyword" id="6313613">else</span>&nbsp;<span class="op" id="6313618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313625">err</span>&nbsp;<span class="op" id="6313629">=</span>&nbsp;<span class="ident" id="6313631">w</span><span class="op" id="6313632">.</span><span class="ident" id="6313633">w</span><span class="op" id="6313634">.</span><span class="ident" id="6313635">WriteByte</span><span class="op" id="6313644">(</span><span class="string" id="6313645">&#39;\n&#39;</span><span class="op" id="6313649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313660">default</span><span class="op" id="6313667">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313673">_</span><span class="op" id="6313674">,</span>&nbsp;<span class="ident" id="6313676">err</span>&nbsp;<span class="op" id="6313680">=</span>&nbsp;<span class="ident" id="6313682">w</span><span class="op" id="6313683">.</span><span class="ident" id="6313684">w</span><span class="op" id="6313685">.</span><span class="ident" id="6313686">WriteRune</span><span class="op" id="6313695">(</span><span class="ident" id="6313696">r1</span><span class="op" id="6313698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313708">if</span>&nbsp;<span class="ident" id="6313711">err</span>&nbsp;<span class="op" id="6313715">!=</span>&nbsp;<span class="builtintype" id="6313718">nil</span>&nbsp;<span class="op" id="6313722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313728">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313738">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313747">if</span>&nbsp;<span class="ident" id="6313750">err</span>&nbsp;<span class="op" id="6313754">=</span>&nbsp;<span class="ident" id="6313756">w</span><span class="op" id="6313757">.</span><span class="ident" id="6313758">w</span><span class="op" id="6313759">.</span><span class="ident" id="6313760">WriteByte</span><span class="op" id="6313769">(</span><span class="string" id="6313770">&#39;&#34;&#39;</span><span class="op" id="6313773">)</span><span class="op" id="6313774">;</span>&nbsp;<span class="ident" id="6313776">err</span>&nbsp;<span class="op" id="6313780">!=</span>&nbsp;<span class="builtintype" id="6313783">nil</span>&nbsp;<span class="op" id="6313787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313792">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313801">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313807">if</span>&nbsp;<span class="ident" id="6313810">w</span><span class="op" id="6313811">.</span><span class="ident" id="6313812">UseCRLF</span>&nbsp;<span class="op" id="6313820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313824">_</span><span class="op" id="6313825">,</span>&nbsp;<span class="ident" id="6313827">err</span>&nbsp;<span class="op" id="6313831">=</span>&nbsp;<span class="ident" id="6313833">w</span><span class="op" id="6313834">.</span><span class="ident" id="6313835">w</span><span class="op" id="6313836">.</span><span class="ident" id="6313837">WriteString</span><span class="op" id="6313848">(</span><span class="string" id="6313849">&#34;\r\n&#34;</span><span class="op" id="6313855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313858">}</span>&nbsp;<span class="keyword" id="6313860">else</span>&nbsp;<span class="op" id="6313865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313869">err</span>&nbsp;<span class="op" id="6313873">=</span>&nbsp;<span class="ident" id="6313875">w</span><span class="op" id="6313876">.</span><span class="ident" id="6313877">w</span><span class="op" id="6313878">.</span><span class="ident" id="6313879">WriteByte</span><span class="op" id="6313888">(</span><span class="string" id="6313889">&#39;\n&#39;</span><span class="op" id="6313893">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313899">return</span><br>
<span class="lineno"></span><span class="op" id="6313906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6313909">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">95</span><span class="comment" id="6313972">//&nbsp;To&nbsp;check&nbsp;if&nbsp;an&nbsp;error&nbsp;occurred&nbsp;during&nbsp;the&nbsp;Flush,&nbsp;call&nbsp;Error.</span><br>
<span class="lineno"></span><span class="keyword" id="6314035">func</span>&nbsp;<span class="op" id="6314040">(</span><span class="ident" id="6314041">w</span>&nbsp;<span class="op" id="6314043">*</span><span class="ident" id="6314044">Writer</span><span class="op" id="6314050">)</span>&nbsp;<span class="ident" id="6314052">Flush</span><span class="op" id="6314057">(</span><span class="op" id="6314058">)</span>&nbsp;<span class="op" id="6314060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314063">w</span><span class="op" id="6314064">.</span><span class="ident" id="6314065">w</span><span class="op" id="6314066">.</span><span class="ident" id="6314067">Flush</span><span class="op" id="6314072">(</span><span class="op" id="6314073">)</span><br>
<span class="lineno"></span><span class="op" id="6314075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="6314078">//&nbsp;Error&nbsp;reports&nbsp;any&nbsp;error&nbsp;that&nbsp;has&nbsp;occurred&nbsp;during&nbsp;a&nbsp;previous&nbsp;Write&nbsp;or&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6314157">func</span>&nbsp;<span class="op" id="6314162">(</span><span class="ident" id="6314163">w</span>&nbsp;<span class="op" id="6314165">*</span><span class="ident" id="6314166">Writer</span><span class="op" id="6314172">)</span>&nbsp;<span class="ident" id="6314174">Error</span><span class="op" id="6314179">(</span><span class="op" id="6314180">)</span>&nbsp;<span class="builtintype" id="6314182">error</span>&nbsp;<span class="op" id="6314188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314191">_</span><span class="op" id="6314192">,</span>&nbsp;<span class="ident" id="6314194">err</span>&nbsp;<span class="op" id="6314198">:=</span>&nbsp;<span class="ident" id="6314201">w</span><span class="op" id="6314202">.</span><span class="ident" id="6314203">w</span><span class="op" id="6314204">.</span><span class="ident" id="6314205">Write</span><span class="op" id="6314210">(</span><span class="builtintype" id="6314211">nil</span><span class="op" id="6314214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314217">return</span>&nbsp;<span class="ident" id="6314224">err</span><br>
<span class="lineno"></span><span class="op" id="6314228">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="6314231">//&nbsp;WriteAll&nbsp;writes&nbsp;multiple&nbsp;CSV&nbsp;records&nbsp;to&nbsp;w&nbsp;using&nbsp;Write&nbsp;and&nbsp;then&nbsp;calls&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6314310">func</span>&nbsp;<span class="op" id="6314315">(</span><span class="ident" id="6314316">w</span>&nbsp;<span class="op" id="6314318">*</span><span class="ident" id="6314319">Writer</span><span class="op" id="6314325">)</span>&nbsp;<span class="ident" id="6314327">WriteAll</span><span class="op" id="6314335">(</span><span class="ident" id="6314336">records</span>&nbsp;<span class="op" id="6314344">[</span><span class="op" id="6314345">]</span><span class="op" id="6314346">[</span><span class="op" id="6314347">]</span><span class="builtintype" id="6314348">string</span><span class="op" id="6314354">)</span>&nbsp;<span class="op" id="6314356">(</span><span class="ident" id="6314357">err</span>&nbsp;<span class="builtintype" id="6314361">error</span><span class="op" id="6314366">)</span>&nbsp;<span class="op" id="6314368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314371">for</span>&nbsp;<span class="ident" id="6314375">_</span><span class="op" id="6314376">,</span>&nbsp;<span class="ident" id="6314378">record</span>&nbsp;<span class="op" id="6314385">:=</span>&nbsp;<span class="keyword" id="6314388">range</span>&nbsp;<span class="ident" id="6314394">records</span>&nbsp;<span class="op" id="6314402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314406">err</span>&nbsp;<span class="op" id="6314410">=</span>&nbsp;<span class="ident" id="6314412">w</span><span class="op" id="6314413">.</span><span class="ident" id="6314414">Write</span><span class="op" id="6314419">(</span><span class="ident" id="6314420">record</span><span class="op" id="6314426">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314430">if</span>&nbsp;<span class="ident" id="6314433">err</span>&nbsp;<span class="op" id="6314437">!=</span>&nbsp;<span class="builtintype" id="6314440">nil</span>&nbsp;<span class="op" id="6314444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314449">return</span>&nbsp;<span class="ident" id="6314456">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314468">return</span>&nbsp;<span class="ident" id="6314475">w</span><span class="op" id="6314476">.</span><span class="ident" id="6314477">w</span><span class="op" id="6314478">.</span><span class="ident" id="6314479">Flush</span><span class="op" id="6314484">(</span><span class="op" id="6314485">)</span><br>
<span class="lineno">115</span><span class="op" id="6314487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6314490">//&nbsp;fieldNeedsQuotes&nbsp;returns&nbsp;true&nbsp;if&nbsp;our&nbsp;field&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno"></span><span class="comment" id="6314564">//&nbsp;Fields&nbsp;with&nbsp;a&nbsp;Comma,&nbsp;fields&nbsp;with&nbsp;a&nbsp;quote&nbsp;or&nbsp;newline,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6314624">//&nbsp;fields&nbsp;which&nbsp;start&nbsp;with&nbsp;a&nbsp;space&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno">120</span><span class="comment" id="6314687">//&nbsp;We&nbsp;used&nbsp;to&nbsp;quote&nbsp;empty&nbsp;strings,&nbsp;but&nbsp;we&nbsp;do&nbsp;not&nbsp;anymore&nbsp;(as&nbsp;of&nbsp;Go&nbsp;1.4).</span><br>
<span class="lineno"></span><span class="comment" id="6314760">//&nbsp;The&nbsp;two&nbsp;representations&nbsp;should&nbsp;be&nbsp;equivalent,&nbsp;but&nbsp;Postgres&nbsp;distinguishes</span><br>
<span class="lineno"></span><span class="comment" id="6314836">//&nbsp;quoted&nbsp;vs&nbsp;non-quoted&nbsp;empty&nbsp;string&nbsp;during&nbsp;database&nbsp;imports,&nbsp;and&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6314909">//&nbsp;an&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;quoted&nbsp;behavior&nbsp;for&nbsp;non-quoted&nbsp;CSV&nbsp;but&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6314981">//&nbsp;no&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;non-quoted&nbsp;behavior&nbsp;for&nbsp;quoted&nbsp;CSV,&nbsp;making</span><br>
<span class="lineno">125</span><span class="comment" id="6315050">//&nbsp;CSV&nbsp;with&nbsp;quoted&nbsp;empty&nbsp;strings&nbsp;strictly&nbsp;less&nbsp;useful.</span><br>
<span class="lineno"></span><span class="comment" id="6315105">//&nbsp;Not&nbsp;quoting&nbsp;the&nbsp;empty&nbsp;string&nbsp;also&nbsp;makes&nbsp;this&nbsp;package&nbsp;match&nbsp;the&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="6315180">//&nbsp;of&nbsp;Microsoft&nbsp;Excel&nbsp;and&nbsp;Google&nbsp;Drive.</span><br>
<span class="lineno"></span><span class="comment" id="6315220">//&nbsp;For&nbsp;Postgres,&nbsp;quote&nbsp;the&nbsp;data&nbsp;termating&nbsp;string&nbsp;`\.`.</span><br>
<span class="lineno"></span><span class="keyword" id="6315275">func</span>&nbsp;<span class="op" id="6315280">(</span><span class="ident" id="6315281">w</span>&nbsp;<span class="op" id="6315283">*</span><span class="ident" id="6315284">Writer</span><span class="op" id="6315290">)</span>&nbsp;<span class="ident" id="6315292">fieldNeedsQuotes</span><span class="op" id="6315308">(</span><span class="ident" id="6315309">field</span>&nbsp;<span class="builtintype" id="6315315">string</span><span class="op" id="6315321">)</span>&nbsp;<span class="builtintype" id="6315323">bool</span>&nbsp;<span class="op" id="6315328">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315331">if</span>&nbsp;<span class="ident" id="6315334">field</span>&nbsp;<span class="op" id="6315340">==</span>&nbsp;<span class="string" id="6315343">&#34;&#34;</span>&nbsp;<span class="op" id="6315346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315350">return</span>&nbsp;<span class="builtintype" id="6315357">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6315364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315367">if</span>&nbsp;<span class="ident" id="6315370">field</span>&nbsp;<span class="op" id="6315376">==</span>&nbsp;<span class="string" id="6315379">`\.`</span>&nbsp;<span class="op" id="6315384">||</span>&nbsp;<span class="ident" id="6315387">strings</span><span class="op" id="6315394">.</span><span class="ident" id="6315395">IndexRune</span><span class="op" id="6315404">(</span><span class="ident" id="6315405">field</span><span class="op" id="6315410">,</span>&nbsp;<span class="ident" id="6315412">w</span><span class="op" id="6315413">.</span><span class="ident" id="6315414">Comma</span><span class="op" id="6315419">)</span>&nbsp;<span class="op" id="6315421">&gt;=</span>&nbsp;<span class="num" id="6315424">0</span>&nbsp;<span class="op" id="6315426">||</span>&nbsp;<span class="ident" id="6315429">strings</span><span class="op" id="6315436">.</span><span class="ident" id="6315437">IndexAny</span><span class="op" id="6315445">(</span><span class="ident" id="6315446">field</span><span class="op" id="6315451">,</span>&nbsp;<span class="string" id="6315453">&#34;\&#34;\r\n&#34;</span><span class="op" id="6315461">)</span>&nbsp;<span class="op" id="6315463">&gt;=</span>&nbsp;<span class="num" id="6315466">0</span>&nbsp;<span class="op" id="6315468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315472">return</span>&nbsp;<span class="builtintype" id="6315479">true</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6315485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315489">r1</span><span class="op" id="6315491">,</span>&nbsp;<span class="ident" id="6315493">_</span>&nbsp;<span class="op" id="6315495">:=</span>&nbsp;<span class="ident" id="6315498">utf8</span><span class="op" id="6315502">.</span><span class="ident" id="6315503">DecodeRuneInString</span><span class="op" id="6315521">(</span><span class="ident" id="6315522">field</span><span class="op" id="6315527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315530">return</span>&nbsp;<span class="ident" id="6315537">unicode</span><span class="op" id="6315544">.</span><span class="ident" id="6315545">IsSpace</span><span class="op" id="6315552">(</span><span class="ident" id="6315553">r1</span><span class="op" id="6315555">)</span><br>
<span class="lineno"></span><span class="op" id="6315557">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
