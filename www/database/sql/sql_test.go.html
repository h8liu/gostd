<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7368715">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7368770">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7368824">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7368875">package</span>&nbsp;<span class="ident" id="7368883">sql</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7368888">import</span>&nbsp;<span class="op" id="7368895">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7368898">&#34;database/sql/driver&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7368921">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7368931">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7368938">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7368951">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7368962">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7368973">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7368984">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7368992">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7369003">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7369010">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7369013">func</span>&nbsp;<span class="ident" id="7369018">init</span><span class="op" id="7369022">(</span><span class="op" id="7369023">)</span>&nbsp;<span class="op" id="7369025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369028">type</span>&nbsp;<span class="ident" id="7369033">dbConn</span>&nbsp;<span class="keyword" id="7369040">struct</span>&nbsp;<span class="op" id="7369047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369051">db</span>&nbsp;<span class="op" id="7369054">*</span><span class="ident" id="7369055"><a href="/database/sql/sql.go.html#6354182">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369060">c</span>&nbsp;&nbsp;<span class="op" id="7369063">*</span><span class="ident" id="7369064"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369076">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369079">freedFrom</span>&nbsp;<span class="op" id="7369089">:=</span>&nbsp;<span class="builtinfunc" id="7369092">make</span><span class="op" id="7369096">(</span><span class="keyword" id="7369097">map</span><span class="op" id="7369100">[</span><span class="ident" id="7369101"><a href="/database/sql/sql_test.go.html#7369033">dbConn</a></span><span class="op" id="7369107">]</span><span class="builtintype" id="7369108">string</span><span class="op" id="7369114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369117"><a href="/database/sql/sql.go.html#6367843">putConnHook</a></span>&nbsp;<span class="op" id="7369129">=</span>&nbsp;<span class="keyword" id="7369131">func</span><span class="op" id="7369135">(</span><span class="ident" id="7369136">db</span>&nbsp;<span class="op" id="7369139">*</span><span class="ident" id="7369140"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7369142">,</span>&nbsp;<span class="ident" id="7369144">c</span>&nbsp;<span class="op" id="7369146">*</span><span class="ident" id="7369147"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="7369157">)</span>&nbsp;<span class="op" id="7369159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369163">idx</span>&nbsp;<span class="op" id="7369167">:=</span>&nbsp;<span class="op" id="7369170">-</span><span class="num" id="7369171">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369175">for</span>&nbsp;<span class="ident" id="7369179">i</span><span class="op" id="7369180">,</span>&nbsp;<span class="ident" id="7369182">v</span>&nbsp;<span class="op" id="7369184">:=</span>&nbsp;<span class="keyword" id="7369187">range</span>&nbsp;<span class="ident" id="7369193"><a href="/database/sql/sql_test.go.html#7369136">db</a></span><span class="op" id="7369195">.</span><span class="ident" id="7369196">freeConn</span>&nbsp;<span class="op" id="7369205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369210">if</span>&nbsp;<span class="ident" id="7369213"><a href="/database/sql/sql_test.go.html#7369182">v</a></span>&nbsp;<span class="op" id="7369215">==</span>&nbsp;<span class="ident" id="7369218"><a href="/database/sql/sql_test.go.html#7369144">c</a></span>&nbsp;<span class="op" id="7369220">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369226"><a href="/database/sql/sql_test.go.html#7369163">idx</a></span>&nbsp;<span class="op" id="7369230">=</span>&nbsp;<span class="ident" id="7369232"><a href="/database/sql/sql_test.go.html#7369179">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369238">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369255">if</span>&nbsp;<span class="ident" id="7369258"><a href="/database/sql/sql_test.go.html#7369163">idx</a></span>&nbsp;<span class="op" id="7369262">&gt;=</span>&nbsp;<span class="num" id="7369265">0</span>&nbsp;<span class="op" id="7369267">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7369272">//&nbsp;print&nbsp;before&nbsp;panic,&nbsp;as&nbsp;panic&nbsp;may&nbsp;get&nbsp;lost&nbsp;due&nbsp;to&nbsp;conflicting&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7369345">//&nbsp;(all&nbsp;goroutines&nbsp;asleep)&nbsp;elsewhere,&nbsp;since&nbsp;we&nbsp;might&nbsp;not&nbsp;unlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7369412">//&nbsp;the&nbsp;mutex&nbsp;in&nbsp;freeConn&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7369446">println</span><span class="op" id="7369453">(</span><span class="string" id="7369454">&#34;double&nbsp;free&nbsp;of&nbsp;conn.&nbsp;conflicts&nbsp;are:\nA)&nbsp;&#34;</span>&nbsp;<span class="op" id="7369497">+</span>&nbsp;<span class="ident" id="7369499"><a href="/database/sql/sql_test.go.html#7369079">freedFrom</a></span><span class="op" id="7369508">[</span><span class="ident" id="7369509"><a href="/database/sql/sql_test.go.html#7369033">dbConn</a></span><span class="op" id="7369515">{</span><span class="ident" id="7369516"><a href="/database/sql/sql_test.go.html#7369136">db</a></span><span class="op" id="7369518">,</span>&nbsp;<span class="ident" id="7369520"><a href="/database/sql/sql_test.go.html#7369144">c</a></span><span class="op" id="7369521">}</span><span class="op" id="7369522">]</span>&nbsp;<span class="op" id="7369524">+</span>&nbsp;<span class="string" id="7369526">&#34;\n\nand\nB)&nbsp;&#34;</span>&nbsp;<span class="op" id="7369541">+</span>&nbsp;<span class="ident" id="7369543"><a href="/database/sql/sql.go.html#6394298">stack</a></span><span class="op" id="7369548">(</span><span class="op" id="7369549">)</span><span class="op" id="7369550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7369555">panic</span><span class="op" id="7369560">(</span><span class="string" id="7369561">&#34;double&nbsp;free&nbsp;of&nbsp;conn.&#34;</span><span class="op" id="7369583">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369591"><a href="/database/sql/sql_test.go.html#7369079">freedFrom</a></span><span class="op" id="7369600">[</span><span class="ident" id="7369601"><a href="/database/sql/sql_test.go.html#7369033">dbConn</a></span><span class="op" id="7369607">{</span><span class="ident" id="7369608"><a href="/database/sql/sql_test.go.html#7369136">db</a></span><span class="op" id="7369610">,</span>&nbsp;<span class="ident" id="7369612"><a href="/database/sql/sql_test.go.html#7369144">c</a></span><span class="op" id="7369613">}</span><span class="op" id="7369614">]</span>&nbsp;<span class="op" id="7369616">=</span>&nbsp;<span class="ident" id="7369618"><a href="/database/sql/sql.go.html#6394298">stack</a></span><span class="op" id="7369623">(</span><span class="op" id="7369624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369627">}</span><br>
<span class="lineno"></span><span class="op" id="7369629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="7369632">const</span>&nbsp;<span class="ident" id="7369638">fakeDBName</span>&nbsp;<span class="op" id="7369649">=</span>&nbsp;<span class="string" id="7369651">&#34;foo&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7369658">var</span>&nbsp;<span class="ident" id="7369662">chrisBirthday</span>&nbsp;<span class="op" id="7369676">=</span>&nbsp;<span class="ident" id="7369678"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7369682">.</span><span class="ident" id="7369683">Unix</span><span class="op" id="7369687">(</span><span class="num" id="7369688">123456789</span><span class="op" id="7369697">,</span>&nbsp;<span class="num" id="7369699">0</span><span class="op" id="7369700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7369703">func</span>&nbsp;<span class="ident" id="7369708">newTestDB</span><span class="op" id="7369717">(</span><span class="ident" id="7369718">t</span>&nbsp;<span class="ident" id="7369720"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7369727">.</span><span class="ident" id="7369728">TB</span><span class="op" id="7369730">,</span>&nbsp;<span class="ident" id="7369732">name</span>&nbsp;<span class="builtintype" id="7369737">string</span><span class="op" id="7369743">)</span>&nbsp;<span class="op" id="7369745">*</span><span class="ident" id="7369746"><a href="/database/sql/sql.go.html#6354182">DB</a></span>&nbsp;<span class="op" id="7369749">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369752">db</span><span class="op" id="7369754">,</span>&nbsp;<span class="ident" id="7369756">err</span>&nbsp;<span class="op" id="7369760">:=</span>&nbsp;<span class="ident" id="7369763"><a href="/database/sql/sql.go.html#6360900">Open</a></span><span class="op" id="7369767">(</span><span class="string" id="7369768">&#34;test&#34;</span><span class="op" id="7369774">,</span>&nbsp;<span class="ident" id="7369776"><a href="/database/sql/sql_test.go.html#7369638">fakeDBName</a></span><span class="op" id="7369786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369789">if</span>&nbsp;<span class="ident" id="7369792"><a href="/database/sql/sql_test.go.html#7369756">err</a></span>&nbsp;<span class="op" id="7369796">!=</span>&nbsp;<span class="ident" id="7369799">nil</span>&nbsp;<span class="op" id="7369803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369807"><a href="/database/sql/sql_test.go.html#7369718">t</a></span><span class="op" id="7369808">.</span><span class="ident" id="7369809">Fatalf</span><span class="op" id="7369815">(</span><span class="string" id="7369816">&#34;Open:&nbsp;%v&#34;</span><span class="op" id="7369826">,</span>&nbsp;<span class="ident" id="7369828"><a href="/database/sql/sql_test.go.html#7369756">err</a></span><span class="op" id="7369831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369837">if</span>&nbsp;<span class="ident" id="7369840">_</span><span class="op" id="7369841">,</span>&nbsp;<span class="ident" id="7369843">err</span>&nbsp;<span class="op" id="7369847">:=</span>&nbsp;<span class="ident" id="7369850"><a href="/database/sql/sql_test.go.html#7369752">db</a></span><span class="op" id="7369852">.</span><span class="ident" id="7369853">Exec</span><span class="op" id="7369857">(</span><span class="string" id="7369858">&#34;WIPE&#34;</span><span class="op" id="7369864">)</span><span class="op" id="7369865">;</span>&nbsp;<span class="ident" id="7369867"><a href="/database/sql/sql_test.go.html#7369843">err</a></span>&nbsp;<span class="op" id="7369871">!=</span>&nbsp;<span class="ident" id="7369874">nil</span>&nbsp;<span class="op" id="7369878">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369882"><a href="/database/sql/sql_test.go.html#7369718">t</a></span><span class="op" id="7369883">.</span><span class="ident" id="7369884">Fatalf</span><span class="op" id="7369890">(</span><span class="string" id="7369891">&#34;exec&nbsp;wipe:&nbsp;%v&#34;</span><span class="op" id="7369906">,</span>&nbsp;<span class="ident" id="7369908"><a href="/database/sql/sql_test.go.html#7369843">err</a></span><span class="op" id="7369911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369917">if</span>&nbsp;<span class="ident" id="7369920"><a href="/database/sql/sql_test.go.html#7369732">name</a></span>&nbsp;<span class="op" id="7369925">==</span>&nbsp;<span class="string" id="7369928">&#34;people&#34;</span>&nbsp;<span class="op" id="7369937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369941"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7369945">(</span><span class="ident" id="7369946"><a href="/database/sql/sql_test.go.html#7369718">t</a></span><span class="op" id="7369947">,</span>&nbsp;<span class="ident" id="7369949"><a href="/database/sql/sql_test.go.html#7369752">db</a></span><span class="op" id="7369951">,</span>&nbsp;<span class="string" id="7369953">&#34;CREATE|people|name=string,age=int32,photo=blob,dead=bool,bdate=datetime&#34;</span><span class="op" id="7370026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370030"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7370034">(</span><span class="ident" id="7370035"><a href="/database/sql/sql_test.go.html#7369718">t</a></span><span class="op" id="7370036">,</span>&nbsp;<span class="ident" id="7370038"><a href="/database/sql/sql_test.go.html#7369752">db</a></span><span class="op" id="7370040">,</span>&nbsp;<span class="string" id="7370042">&#34;INSERT|people|name=Alice,age=?,photo=APHOTO&#34;</span><span class="op" id="7370087">,</span>&nbsp;<span class="num" id="7370089">1</span><span class="op" id="7370090">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370094"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7370098">(</span><span class="ident" id="7370099"><a href="/database/sql/sql_test.go.html#7369718">t</a></span><span class="op" id="7370100">,</span>&nbsp;<span class="ident" id="7370102"><a href="/database/sql/sql_test.go.html#7369752">db</a></span><span class="op" id="7370104">,</span>&nbsp;<span class="string" id="7370106">&#34;INSERT|people|name=Bob,age=?,photo=BPHOTO&#34;</span><span class="op" id="7370149">,</span>&nbsp;<span class="num" id="7370151">2</span><span class="op" id="7370152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370156"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7370160">(</span><span class="ident" id="7370161"><a href="/database/sql/sql_test.go.html#7369718">t</a></span><span class="op" id="7370162">,</span>&nbsp;<span class="ident" id="7370164"><a href="/database/sql/sql_test.go.html#7369752">db</a></span><span class="op" id="7370166">,</span>&nbsp;<span class="string" id="7370168">&#34;INSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7370221">,</span>&nbsp;<span class="num" id="7370223">3</span><span class="op" id="7370224">,</span>&nbsp;<span class="ident" id="7370226"><a href="/database/sql/sql_test.go.html#7369662">chrisBirthday</a></span><span class="op" id="7370239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370245">if</span>&nbsp;<span class="ident" id="7370248"><a href="/database/sql/sql_test.go.html#7369732">name</a></span>&nbsp;<span class="op" id="7370253">==</span>&nbsp;<span class="string" id="7370256">&#34;magicquery&#34;</span>&nbsp;<span class="op" id="7370269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7370273">//&nbsp;Magic&nbsp;table&nbsp;name&nbsp;and&nbsp;column,&nbsp;known&nbsp;by&nbsp;fakedb_test.go.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370332"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7370336">(</span><span class="ident" id="7370337"><a href="/database/sql/sql_test.go.html#7369718">t</a></span><span class="op" id="7370338">,</span>&nbsp;<span class="ident" id="7370340"><a href="/database/sql/sql_test.go.html#7369752">db</a></span><span class="op" id="7370342">,</span>&nbsp;<span class="string" id="7370344">&#34;CREATE|magicquery|op=string,millis=int32&#34;</span><span class="op" id="7370386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370390"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7370394">(</span><span class="ident" id="7370395"><a href="/database/sql/sql_test.go.html#7369718">t</a></span><span class="op" id="7370396">,</span>&nbsp;<span class="ident" id="7370398"><a href="/database/sql/sql_test.go.html#7369752">db</a></span><span class="op" id="7370400">,</span>&nbsp;<span class="string" id="7370402">&#34;INSERT|magicquery|op=sleep,millis=10&#34;</span><span class="op" id="7370440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370446">return</span>&nbsp;<span class="ident" id="7370453"><a href="/database/sql/sql_test.go.html#7369752">db</a></span><br>
<span class="lineno"></span><span class="op" id="7370456">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7370459">func</span>&nbsp;<span class="ident" id="7370464">exec</span><span class="op" id="7370468">(</span><span class="ident" id="7370469">t</span>&nbsp;<span class="ident" id="7370471"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7370478">.</span><span class="ident" id="7370479">TB</span><span class="op" id="7370481">,</span>&nbsp;<span class="ident" id="7370483">db</span>&nbsp;<span class="op" id="7370486">*</span><span class="ident" id="7370487"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7370489">,</span>&nbsp;<span class="ident" id="7370491">query</span>&nbsp;<span class="builtintype" id="7370497">string</span><span class="op" id="7370503">,</span>&nbsp;<span class="ident" id="7370505">args</span>&nbsp;<span class="op" id="7370510">...</span><span class="keyword" id="7370513">interface</span><span class="op" id="7370522">{</span><span class="op" id="7370523">}</span><span class="op" id="7370524">)</span>&nbsp;<span class="op" id="7370526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370529">_</span><span class="op" id="7370530">,</span>&nbsp;<span class="ident" id="7370532">err</span>&nbsp;<span class="op" id="7370536">:=</span>&nbsp;<span class="ident" id="7370539"><a href="/database/sql/sql_test.go.html#7370483">db</a></span><span class="op" id="7370541">.</span><span class="ident" id="7370542">Exec</span><span class="op" id="7370546">(</span><span class="ident" id="7370547"><a href="/database/sql/sql_test.go.html#7370491">query</a></span><span class="op" id="7370552">,</span>&nbsp;<span class="ident" id="7370554"><a href="/database/sql/sql_test.go.html#7370505">args</a></span><span class="op" id="7370558">...</span><span class="op" id="7370561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370564">if</span>&nbsp;<span class="ident" id="7370567"><a href="/database/sql/sql_test.go.html#7370532">err</a></span>&nbsp;<span class="op" id="7370571">!=</span>&nbsp;<span class="ident" id="7370574">nil</span>&nbsp;<span class="op" id="7370578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370582"><a href="/database/sql/sql_test.go.html#7370469">t</a></span><span class="op" id="7370583">.</span><span class="ident" id="7370584">Fatalf</span><span class="op" id="7370590">(</span><span class="string" id="7370591">&#34;Exec&nbsp;of&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="7370607">,</span>&nbsp;<span class="ident" id="7370609"><a href="/database/sql/sql_test.go.html#7370491">query</a></span><span class="op" id="7370614">,</span>&nbsp;<span class="ident" id="7370616"><a href="/database/sql/sql_test.go.html#7370532">err</a></span><span class="op" id="7370619">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370622">}</span><br>
<span class="lineno"></span><span class="op" id="7370624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7370627">func</span>&nbsp;<span class="ident" id="7370632">closeDB</span><span class="op" id="7370639">(</span><span class="ident" id="7370640">t</span>&nbsp;<span class="ident" id="7370642"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7370649">.</span><span class="ident" id="7370650">TB</span><span class="op" id="7370652">,</span>&nbsp;<span class="ident" id="7370654">db</span>&nbsp;<span class="op" id="7370657">*</span><span class="ident" id="7370658"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7370660">)</span>&nbsp;<span class="op" id="7370662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370665">if</span>&nbsp;<span class="ident" id="7370668">e</span>&nbsp;<span class="op" id="7370670">:=</span>&nbsp;<span class="builtinfunc" id="7370673">recover</span><span class="op" id="7370680">(</span><span class="op" id="7370681">)</span><span class="op" id="7370682">;</span>&nbsp;<span class="ident" id="7370684"><a href="/database/sql/sql_test.go.html#7370668">e</a></span>&nbsp;<span class="op" id="7370686">!=</span>&nbsp;<span class="ident" id="7370689">nil</span>&nbsp;<span class="op" id="7370693">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370697"><a href="/database/sql/sql_test.go.html#7368931">fmt</a></span><span class="op" id="7370700">.</span><span class="ident" id="7370701">Printf</span><span class="op" id="7370707">(</span><span class="string" id="7370708">&#34;Panic:&nbsp;%v\n&#34;</span><span class="op" id="7370721">,</span>&nbsp;<span class="ident" id="7370723"><a href="/database/sql/sql_test.go.html#7370668">e</a></span><span class="op" id="7370724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7370728">panic</span><span class="op" id="7370733">(</span><span class="ident" id="7370734"><a href="/database/sql/sql_test.go.html#7370668">e</a></span><span class="op" id="7370735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370741">defer</span>&nbsp;<span class="ident" id="7370747"><a href="/database/sql/fakedb_test.go.html#7353989">setHookpostCloseConn</a></span><span class="op" id="7370767">(</span><span class="ident" id="7370768">nil</span><span class="op" id="7370771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370774"><a href="/database/sql/fakedb_test.go.html#7353989">setHookpostCloseConn</a></span><span class="op" id="7370794">(</span><span class="keyword" id="7370795">func</span><span class="op" id="7370799">(</span><span class="ident" id="7370800">_</span>&nbsp;<span class="op" id="7370802">*</span><span class="ident" id="7370803"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7370811">,</span>&nbsp;<span class="ident" id="7370813">err</span>&nbsp;<span class="builtintype" id="7370817">error</span><span class="op" id="7370822">)</span>&nbsp;<span class="op" id="7370824">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370828">if</span>&nbsp;<span class="ident" id="7370831"><a href="/database/sql/sql_test.go.html#7370813">err</a></span>&nbsp;<span class="op" id="7370835">!=</span>&nbsp;<span class="ident" id="7370838">nil</span>&nbsp;<span class="op" id="7370842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370847"><a href="/database/sql/sql_test.go.html#7370640">t</a></span><span class="op" id="7370848">.</span><span class="ident" id="7370849">Errorf</span><span class="op" id="7370855">(</span><span class="string" id="7370856">&#34;Error&nbsp;closing&nbsp;fakeConn:&nbsp;%v&#34;</span><span class="op" id="7370884">,</span>&nbsp;<span class="ident" id="7370886"><a href="/database/sql/sql_test.go.html#7370813">err</a></span><span class="op" id="7370889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370896">}</span><span class="op" id="7370897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370900">for</span>&nbsp;<span class="ident" id="7370904">i</span><span class="op" id="7370905">,</span>&nbsp;<span class="ident" id="7370907">dc</span>&nbsp;<span class="op" id="7370910">:=</span>&nbsp;<span class="keyword" id="7370913">range</span>&nbsp;<span class="ident" id="7370919"><a href="/database/sql/sql_test.go.html#7370654">db</a></span><span class="op" id="7370921">.</span><span class="ident" id="7370922">freeConn</span>&nbsp;<span class="op" id="7370931">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370935">if</span>&nbsp;<span class="ident" id="7370938">n</span>&nbsp;<span class="op" id="7370940">:=</span>&nbsp;<span class="builtinfunc" id="7370943">len</span><span class="op" id="7370946">(</span><span class="ident" id="7370947"><a href="/database/sql/sql_test.go.html#7370907">dc</a></span><span class="op" id="7370949">.</span><span class="ident" id="7370950">openStmt</span><span class="op" id="7370958">)</span><span class="op" id="7370959">;</span>&nbsp;<span class="ident" id="7370961"><a href="/database/sql/sql_test.go.html#7370938">n</a></span>&nbsp;<span class="op" id="7370963">&gt;</span>&nbsp;<span class="num" id="7370965">0</span>&nbsp;<span class="op" id="7370967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7370972">//&nbsp;Just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;This&nbsp;is&nbsp;legal&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7371016">//&nbsp;general,&nbsp;but&nbsp;if&nbsp;we&nbsp;make&nbsp;the&nbsp;tests&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7371065">//&nbsp;their&nbsp;statements&nbsp;first,&nbsp;then&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7371114">//&nbsp;verify&nbsp;this&nbsp;is&nbsp;always&nbsp;zero&nbsp;here,&nbsp;and&nbsp;any</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7371161">//&nbsp;other&nbsp;value&nbsp;is&nbsp;a&nbsp;leak.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371190"><a href="/database/sql/sql_test.go.html#7370640">t</a></span><span class="op" id="7371191">.</span><span class="ident" id="7371192">Errorf</span><span class="op" id="7371198">(</span><span class="string" id="7371199">&#34;while&nbsp;closing&nbsp;db,&nbsp;freeConn&nbsp;%d/%d&nbsp;had&nbsp;%d&nbsp;open&nbsp;stmts;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7371259">,</span>&nbsp;<span class="ident" id="7371261"><a href="/database/sql/sql_test.go.html#7370904">i</a></span><span class="op" id="7371262">,</span>&nbsp;<span class="builtinfunc" id="7371264">len</span><span class="op" id="7371267">(</span><span class="ident" id="7371268"><a href="/database/sql/sql_test.go.html#7370654">db</a></span><span class="op" id="7371270">.</span><span class="ident" id="7371271">freeConn</span><span class="op" id="7371279">)</span><span class="op" id="7371280">,</span>&nbsp;<span class="ident" id="7371282"><a href="/database/sql/sql_test.go.html#7370938">n</a></span><span class="op" id="7371283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371293">err</span>&nbsp;<span class="op" id="7371297">:=</span>&nbsp;<span class="ident" id="7371300"><a href="/database/sql/sql_test.go.html#7370654">db</a></span><span class="op" id="7371302">.</span><span class="ident" id="7371303">Close</span><span class="op" id="7371308">(</span><span class="op" id="7371309">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371312">if</span>&nbsp;<span class="ident" id="7371315"><a href="/database/sql/sql_test.go.html#7371293">err</a></span>&nbsp;<span class="op" id="7371319">!=</span>&nbsp;<span class="ident" id="7371322">nil</span>&nbsp;<span class="op" id="7371326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371330"><a href="/database/sql/sql_test.go.html#7370640">t</a></span><span class="op" id="7371331">.</span><span class="ident" id="7371332">Fatalf</span><span class="op" id="7371338">(</span><span class="string" id="7371339">&#34;error&nbsp;closing&nbsp;DB:&nbsp;%v&#34;</span><span class="op" id="7371361">,</span>&nbsp;<span class="ident" id="7371363"><a href="/database/sql/sql_test.go.html#7371293">err</a></span><span class="op" id="7371366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371372"><a href="/database/sql/sql_test.go.html#7370654">db</a></span><span class="op" id="7371374">.</span><span class="ident" id="7371375">mu</span><span class="op" id="7371377">.</span><span class="ident" id="7371378">Lock</span><span class="op" id="7371382">(</span><span class="op" id="7371383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371386">count</span>&nbsp;<span class="op" id="7371392">:=</span>&nbsp;<span class="ident" id="7371395"><a href="/database/sql/sql_test.go.html#7370654">db</a></span><span class="op" id="7371397">.</span><span class="ident" id="7371398">numOpen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371407"><a href="/database/sql/sql_test.go.html#7370654">db</a></span><span class="op" id="7371409">.</span><span class="ident" id="7371410">mu</span><span class="op" id="7371412">.</span><span class="ident" id="7371413">Unlock</span><span class="op" id="7371419">(</span><span class="op" id="7371420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371423">if</span>&nbsp;<span class="ident" id="7371426"><a href="/database/sql/sql_test.go.html#7371386">count</a></span>&nbsp;<span class="op" id="7371432">!=</span>&nbsp;<span class="num" id="7371435">0</span>&nbsp;<span class="op" id="7371437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371441"><a href="/database/sql/sql_test.go.html#7370640">t</a></span><span class="op" id="7371442">.</span><span class="ident" id="7371443">Fatalf</span><span class="op" id="7371449">(</span><span class="string" id="7371450">&#34;%d&nbsp;connections&nbsp;still&nbsp;open&nbsp;after&nbsp;closing&nbsp;DB&#34;</span><span class="op" id="7371494">,</span>&nbsp;<span class="ident" id="7371496"><a href="/database/sql/sql_test.go.html#7370654">db</a></span><span class="op" id="7371498">.</span><span class="ident" id="7371499">numOpen</span><span class="op" id="7371506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371509">}</span><br>
<span class="lineno"></span><span class="op" id="7371511">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="7371514">//&nbsp;numPrepares&nbsp;assumes&nbsp;that&nbsp;db&nbsp;has&nbsp;exactly&nbsp;1&nbsp;idle&nbsp;conn&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="7371581">//&nbsp;its&nbsp;count&nbsp;of&nbsp;calls&nbsp;to&nbsp;Prepare</span><br>
<span class="lineno"></span><span class="keyword" id="7371614">func</span>&nbsp;<span class="ident" id="7371619">numPrepares</span><span class="op" id="7371630">(</span><span class="ident" id="7371631">t</span>&nbsp;<span class="op" id="7371633">*</span><span class="ident" id="7371634"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7371641">.</span><span class="ident" id="7371642">T</span><span class="op" id="7371643">,</span>&nbsp;<span class="ident" id="7371645">db</span>&nbsp;<span class="op" id="7371648">*</span><span class="ident" id="7371649"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7371651">)</span>&nbsp;<span class="builtintype" id="7371653">int</span>&nbsp;<span class="op" id="7371657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371660">if</span>&nbsp;<span class="ident" id="7371663">n</span>&nbsp;<span class="op" id="7371665">:=</span>&nbsp;<span class="builtinfunc" id="7371668">len</span><span class="op" id="7371671">(</span><span class="ident" id="7371672"><a href="/database/sql/sql_test.go.html#7371645">db</a></span><span class="op" id="7371674">.</span><span class="ident" id="7371675">freeConn</span><span class="op" id="7371683">)</span><span class="op" id="7371684">;</span>&nbsp;<span class="ident" id="7371686"><a href="/database/sql/sql_test.go.html#7371663">n</a></span>&nbsp;<span class="op" id="7371688">!=</span>&nbsp;<span class="num" id="7371691">1</span>&nbsp;<span class="op" id="7371693">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371697"><a href="/database/sql/sql_test.go.html#7371631">t</a></span><span class="op" id="7371698">.</span><span class="ident" id="7371699">Fatalf</span><span class="op" id="7371705">(</span><span class="string" id="7371706">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7371731">,</span>&nbsp;<span class="ident" id="7371733"><a href="/database/sql/sql_test.go.html#7371663">n</a></span><span class="op" id="7371734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371740">return</span>&nbsp;<span class="ident" id="7371747"><a href="/database/sql/sql_test.go.html#7371645">db</a></span><span class="op" id="7371749">.</span><span class="ident" id="7371750">freeConn</span><span class="op" id="7371758">[</span><span class="num" id="7371759">0</span><span class="op" id="7371760">]</span><span class="op" id="7371761">.</span><span class="ident" id="7371762">ci</span><span class="op" id="7371764">.</span><span class="op" id="7371765">(</span><span class="op" id="7371766">*</span><span class="ident" id="7371767"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7371775">)</span><span class="op" id="7371776">.</span><span class="ident" id="7371777">numPrepare</span><br>
<span class="lineno"></span><span class="op" id="7371788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7371791">func</span>&nbsp;<span class="op" id="7371796">(</span><span class="ident" id="7371797">db</span>&nbsp;<span class="op" id="7371800">*</span><span class="ident" id="7371801"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7371803">)</span>&nbsp;<span class="ident" id="7371805">numDeps</span><span class="op" id="7371812">(</span><span class="op" id="7371813">)</span>&nbsp;<span class="builtintype" id="7371815">int</span>&nbsp;<span class="op" id="7371819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371822"><a href="/database/sql/sql_test.go.html#7371797">db</a></span><span class="op" id="7371824">.</span><span class="ident" id="7371825">mu</span><span class="op" id="7371827">.</span><span class="ident" id="7371828">Lock</span><span class="op" id="7371832">(</span><span class="op" id="7371833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371836">defer</span>&nbsp;<span class="ident" id="7371842"><a href="/database/sql/sql_test.go.html#7371797">db</a></span><span class="op" id="7371844">.</span><span class="ident" id="7371845">mu</span><span class="op" id="7371847">.</span><span class="ident" id="7371848">Unlock</span><span class="op" id="7371854">(</span><span class="op" id="7371855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371858">return</span>&nbsp;<span class="builtinfunc" id="7371865">len</span><span class="op" id="7371868">(</span><span class="ident" id="7371869"><a href="/database/sql/sql_test.go.html#7371797">db</a></span><span class="op" id="7371871">.</span><span class="ident" id="7371872">dep</span><span class="op" id="7371875">)</span><br>
<span class="lineno"></span><span class="op" id="7371877">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment" id="7371880">//&nbsp;Dependencies&nbsp;are&nbsp;closed&nbsp;via&nbsp;a&nbsp;goroutine,&nbsp;so&nbsp;this&nbsp;polls&nbsp;waiting&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="7371950">//&nbsp;numDeps&nbsp;to&nbsp;fall&nbsp;to&nbsp;want,&nbsp;waiting&nbsp;up&nbsp;to&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="7371995">func</span>&nbsp;<span class="op" id="7372000">(</span><span class="ident" id="7372001">db</span>&nbsp;<span class="op" id="7372004">*</span><span class="ident" id="7372005"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7372007">)</span>&nbsp;<span class="ident" id="7372009">numDepsPollUntil</span><span class="op" id="7372025">(</span><span class="ident" id="7372026">want</span>&nbsp;<span class="builtintype" id="7372031">int</span><span class="op" id="7372034">,</span>&nbsp;<span class="ident" id="7372036">d</span>&nbsp;<span class="ident" id="7372038"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7372042">.</span><span class="ident" id="7372043">Duration</span><span class="op" id="7372051">)</span>&nbsp;<span class="builtintype" id="7372053">int</span>&nbsp;<span class="op" id="7372057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372060">deadline</span>&nbsp;<span class="op" id="7372069">:=</span>&nbsp;<span class="ident" id="7372072"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7372076">.</span><span class="ident" id="7372077">Now</span><span class="op" id="7372080">(</span><span class="op" id="7372081">)</span><span class="op" id="7372082">.</span><span class="ident" id="7372083">Add</span><span class="op" id="7372086">(</span><span class="ident" id="7372087"><a href="/database/sql/sql_test.go.html#7372036">d</a></span><span class="op" id="7372088">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372091">for</span>&nbsp;<span class="op" id="7372095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372099">n</span>&nbsp;<span class="op" id="7372101">:=</span>&nbsp;<span class="ident" id="7372104"><a href="/database/sql/sql_test.go.html#7372001">db</a></span><span class="op" id="7372106">.</span><span class="ident" id="7372107">numDeps</span><span class="op" id="7372114">(</span><span class="op" id="7372115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372119">if</span>&nbsp;<span class="ident" id="7372122"><a href="/database/sql/sql_test.go.html#7372099">n</a></span>&nbsp;<span class="op" id="7372124">&lt;=</span>&nbsp;<span class="ident" id="7372127"><a href="/database/sql/sql_test.go.html#7372026">want</a></span>&nbsp;<span class="op" id="7372132">||</span>&nbsp;<span class="ident" id="7372135"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7372139">.</span><span class="ident" id="7372140">Now</span><span class="op" id="7372143">(</span><span class="op" id="7372144">)</span><span class="op" id="7372145">.</span><span class="ident" id="7372146">After</span><span class="op" id="7372151">(</span><span class="ident" id="7372152"><a href="/database/sql/sql_test.go.html#7372060">deadline</a></span><span class="op" id="7372160">)</span>&nbsp;<span class="op" id="7372162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372167">return</span>&nbsp;<span class="ident" id="7372174"><a href="/database/sql/sql_test.go.html#7372099">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372178">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372182"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7372186">.</span><span class="ident" id="7372187">Sleep</span><span class="op" id="7372192">(</span><span class="num" id="7372193">50</span>&nbsp;<span class="op" id="7372196">*</span>&nbsp;<span class="ident" id="7372198"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7372202">.</span><span class="ident" id="7372203">Millisecond</span><span class="op" id="7372214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372217">}</span><br>
<span class="lineno"></span><span class="op" id="7372219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7372222">func</span>&nbsp;<span class="op" id="7372227">(</span><span class="ident" id="7372228">db</span>&nbsp;<span class="op" id="7372231">*</span><span class="ident" id="7372232"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7372234">)</span>&nbsp;<span class="ident" id="7372236">numFreeConns</span><span class="op" id="7372248">(</span><span class="op" id="7372249">)</span>&nbsp;<span class="builtintype" id="7372251">int</span>&nbsp;<span class="op" id="7372255">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372258"><a href="/database/sql/sql_test.go.html#7372228">db</a></span><span class="op" id="7372260">.</span><span class="ident" id="7372261">mu</span><span class="op" id="7372263">.</span><span class="ident" id="7372264">Lock</span><span class="op" id="7372268">(</span><span class="op" id="7372269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372272">defer</span>&nbsp;<span class="ident" id="7372278"><a href="/database/sql/sql_test.go.html#7372228">db</a></span><span class="op" id="7372280">.</span><span class="ident" id="7372281">mu</span><span class="op" id="7372283">.</span><span class="ident" id="7372284">Unlock</span><span class="op" id="7372290">(</span><span class="op" id="7372291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372294">return</span>&nbsp;<span class="builtinfunc" id="7372301">len</span><span class="op" id="7372304">(</span><span class="ident" id="7372305"><a href="/database/sql/sql_test.go.html#7372228">db</a></span><span class="op" id="7372307">.</span><span class="ident" id="7372308">freeConn</span><span class="op" id="7372316">)</span><br>
<span class="lineno"></span><span class="op" id="7372318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="7372321">func</span>&nbsp;<span class="op" id="7372326">(</span><span class="ident" id="7372327">db</span>&nbsp;<span class="op" id="7372330">*</span><span class="ident" id="7372331"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7372333">)</span>&nbsp;<span class="ident" id="7372335">dumpDeps</span><span class="op" id="7372343">(</span><span class="ident" id="7372344">t</span>&nbsp;<span class="op" id="7372346">*</span><span class="ident" id="7372347"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7372354">.</span><span class="ident" id="7372355">T</span><span class="op" id="7372356">)</span>&nbsp;<span class="op" id="7372358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372361">for</span>&nbsp;<span class="ident" id="7372365">fc</span>&nbsp;<span class="op" id="7372368">:=</span>&nbsp;<span class="keyword" id="7372371">range</span>&nbsp;<span class="ident" id="7372377"><a href="/database/sql/sql_test.go.html#7372327">db</a></span><span class="op" id="7372379">.</span><span class="ident" id="7372380">dep</span>&nbsp;<span class="op" id="7372384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372388"><a href="/database/sql/sql_test.go.html#7372327">db</a></span><span class="op" id="7372390">.</span><span class="ident" id="7372391">dumpDep</span><span class="op" id="7372398">(</span><span class="ident" id="7372399"><a href="/database/sql/sql_test.go.html#7372344">t</a></span><span class="op" id="7372400">,</span>&nbsp;<span class="num" id="7372402">0</span><span class="op" id="7372403">,</span>&nbsp;<span class="ident" id="7372405"><a href="/database/sql/sql_test.go.html#7372365">fc</a></span><span class="op" id="7372407">,</span>&nbsp;<span class="keyword" id="7372409">map</span><span class="op" id="7372412">[</span><span class="ident" id="7372413"><a href="/database/sql/sql.go.html#6358045">finalCloser</a></span><span class="op" id="7372424">]</span><span class="builtintype" id="7372425">bool</span><span class="op" id="7372429">{</span><span class="op" id="7372430">}</span><span class="op" id="7372431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372434">}</span><br>
<span class="lineno"></span><span class="op" id="7372436">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="7372439">func</span>&nbsp;<span class="op" id="7372444">(</span><span class="ident" id="7372445">db</span>&nbsp;<span class="op" id="7372448">*</span><span class="ident" id="7372449"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7372451">)</span>&nbsp;<span class="ident" id="7372453">dumpDep</span><span class="op" id="7372460">(</span><span class="ident" id="7372461">t</span>&nbsp;<span class="op" id="7372463">*</span><span class="ident" id="7372464"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7372471">.</span><span class="ident" id="7372472">T</span><span class="op" id="7372473">,</span>&nbsp;<span class="ident" id="7372475">depth</span>&nbsp;<span class="builtintype" id="7372481">int</span><span class="op" id="7372484">,</span>&nbsp;<span class="ident" id="7372486">dep</span>&nbsp;<span class="ident" id="7372490"><a href="/database/sql/sql.go.html#6358045">finalCloser</a></span><span class="op" id="7372501">,</span>&nbsp;<span class="ident" id="7372503">seen</span>&nbsp;<span class="keyword" id="7372508">map</span><span class="op" id="7372511">[</span><span class="ident" id="7372512"><a href="/database/sql/sql.go.html#6358045">finalCloser</a></span><span class="op" id="7372523">]</span><span class="builtintype" id="7372524">bool</span><span class="op" id="7372528">)</span>&nbsp;<span class="op" id="7372530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372533"><a href="/database/sql/sql_test.go.html#7372503">seen</a></span><span class="op" id="7372537">[</span><span class="ident" id="7372538"><a href="/database/sql/sql_test.go.html#7372486">dep</a></span><span class="op" id="7372541">]</span>&nbsp;<span class="op" id="7372543">=</span>&nbsp;<span class="builtintype" id="7372545">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372551">indent</span>&nbsp;<span class="op" id="7372558">:=</span>&nbsp;<span class="ident" id="7372561"><a href="/database/sql/sql_test.go.html#7368973">strings</a></span><span class="op" id="7372568">.</span><span class="ident" id="7372569">Repeat</span><span class="op" id="7372575">(</span><span class="string" id="7372576">&#34;&nbsp;&nbsp;&#34;</span><span class="op" id="7372580">,</span>&nbsp;<span class="ident" id="7372582"><a href="/database/sql/sql_test.go.html#7372475">depth</a></span><span class="op" id="7372587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372590">ds</span>&nbsp;<span class="op" id="7372593">:=</span>&nbsp;<span class="ident" id="7372596"><a href="/database/sql/sql_test.go.html#7372445">db</a></span><span class="op" id="7372598">.</span><span class="ident" id="7372599">dep</span><span class="op" id="7372602">[</span><span class="ident" id="7372603"><a href="/database/sql/sql_test.go.html#7372486">dep</a></span><span class="op" id="7372606">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372609">for</span>&nbsp;<span class="ident" id="7372613">k</span>&nbsp;<span class="op" id="7372615">:=</span>&nbsp;<span class="keyword" id="7372618">range</span>&nbsp;<span class="ident" id="7372624"><a href="/database/sql/sql_test.go.html#7372590">ds</a></span>&nbsp;<span class="op" id="7372627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372631"><a href="/database/sql/sql_test.go.html#7372461">t</a></span><span class="op" id="7372632">.</span><span class="ident" id="7372633">Logf</span><span class="op" id="7372637">(</span><span class="string" id="7372638">&#34;%s%T&nbsp;(%p)&nbsp;waiting&nbsp;for&nbsp;-&gt;&nbsp;%T&nbsp;(%p)&#34;</span><span class="op" id="7372672">,</span>&nbsp;<span class="ident" id="7372674"><a href="/database/sql/sql_test.go.html#7372551">indent</a></span><span class="op" id="7372680">,</span>&nbsp;<span class="ident" id="7372682"><a href="/database/sql/sql_test.go.html#7372486">dep</a></span><span class="op" id="7372685">,</span>&nbsp;<span class="ident" id="7372687"><a href="/database/sql/sql_test.go.html#7372486">dep</a></span><span class="op" id="7372690">,</span>&nbsp;<span class="ident" id="7372692"><a href="/database/sql/sql_test.go.html#7372613">k</a></span><span class="op" id="7372693">,</span>&nbsp;<span class="ident" id="7372695"><a href="/database/sql/sql_test.go.html#7372613">k</a></span><span class="op" id="7372696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372700">if</span>&nbsp;<span class="ident" id="7372703">fc</span><span class="op" id="7372705">,</span>&nbsp;<span class="ident" id="7372707">ok</span>&nbsp;<span class="op" id="7372710">:=</span>&nbsp;<span class="ident" id="7372713"><a href="/database/sql/sql_test.go.html#7372613">k</a></span><span class="op" id="7372714">.</span><span class="op" id="7372715">(</span><span class="ident" id="7372716"><a href="/database/sql/sql.go.html#6358045">finalCloser</a></span><span class="op" id="7372727">)</span><span class="op" id="7372728">;</span>&nbsp;<span class="ident" id="7372730"><a href="/database/sql/sql_test.go.html#7372707">ok</a></span>&nbsp;<span class="op" id="7372733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372738">if</span>&nbsp;<span class="op" id="7372741">!</span><span class="ident" id="7372742"><a href="/database/sql/sql_test.go.html#7372503">seen</a></span><span class="op" id="7372746">[</span><span class="ident" id="7372747"><a href="/database/sql/sql_test.go.html#7372703">fc</a></span><span class="op" id="7372749">]</span>&nbsp;<span class="op" id="7372751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372757"><a href="/database/sql/sql_test.go.html#7372445">db</a></span><span class="op" id="7372759">.</span><span class="ident" id="7372760">dumpDep</span><span class="op" id="7372767">(</span><span class="ident" id="7372768"><a href="/database/sql/sql_test.go.html#7372461">t</a></span><span class="op" id="7372769">,</span>&nbsp;<span class="ident" id="7372771"><a href="/database/sql/sql_test.go.html#7372475">depth</a></span><span class="op" id="7372776">+</span><span class="num" id="7372777">1</span><span class="op" id="7372778">,</span>&nbsp;<span class="ident" id="7372780"><a href="/database/sql/sql_test.go.html#7372703">fc</a></span><span class="op" id="7372782">,</span>&nbsp;<span class="ident" id="7372784"><a href="/database/sql/sql_test.go.html#7372503">seen</a></span><span class="op" id="7372788">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372800">}</span><br>
<span class="lineno"></span><span class="op" id="7372802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="7372805">func</span>&nbsp;<span class="ident" id="7372810">TestQuery</span><span class="op" id="7372819">(</span><span class="ident" id="7372820">t</span>&nbsp;<span class="op" id="7372822">*</span><span class="ident" id="7372823"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7372830">.</span><span class="ident" id="7372831">T</span><span class="op" id="7372832">)</span>&nbsp;<span class="op" id="7372834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372837">db</span>&nbsp;<span class="op" id="7372840">:=</span>&nbsp;<span class="ident" id="7372843"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7372852">(</span><span class="ident" id="7372853"><a href="/database/sql/sql_test.go.html#7372820">t</a></span><span class="op" id="7372854">,</span>&nbsp;<span class="string" id="7372856">&#34;people&#34;</span><span class="op" id="7372864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372867">defer</span>&nbsp;<span class="ident" id="7372873"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7372880">(</span><span class="ident" id="7372881"><a href="/database/sql/sql_test.go.html#7372820">t</a></span><span class="op" id="7372882">,</span>&nbsp;<span class="ident" id="7372884"><a href="/database/sql/sql_test.go.html#7372837">db</a></span><span class="op" id="7372886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372889">prepares0</span>&nbsp;<span class="op" id="7372899">:=</span>&nbsp;<span class="ident" id="7372902"><a href="/database/sql/sql_test.go.html#7371619">numPrepares</a></span><span class="op" id="7372913">(</span><span class="ident" id="7372914"><a href="/database/sql/sql_test.go.html#7372820">t</a></span><span class="op" id="7372915">,</span>&nbsp;<span class="ident" id="7372917"><a href="/database/sql/sql_test.go.html#7372837">db</a></span><span class="op" id="7372919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372922">rows</span><span class="op" id="7372926">,</span>&nbsp;<span class="ident" id="7372928">err</span>&nbsp;<span class="op" id="7372932">:=</span>&nbsp;<span class="ident" id="7372935"><a href="/database/sql/sql_test.go.html#7372837">db</a></span><span class="op" id="7372937">.</span><span class="ident" id="7372938">Query</span><span class="op" id="7372943">(</span><span class="string" id="7372944">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7372969">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372972">if</span>&nbsp;<span class="ident" id="7372975"><a href="/database/sql/sql_test.go.html#7372928">err</a></span>&nbsp;<span class="op" id="7372979">!=</span>&nbsp;<span class="ident" id="7372982">nil</span>&nbsp;<span class="op" id="7372986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372990"><a href="/database/sql/sql_test.go.html#7372820">t</a></span><span class="op" id="7372991">.</span><span class="ident" id="7372992">Fatalf</span><span class="op" id="7372998">(</span><span class="string" id="7372999">&#34;Query:&nbsp;%v&#34;</span><span class="op" id="7373010">,</span>&nbsp;<span class="ident" id="7373012"><a href="/database/sql/sql_test.go.html#7372928">err</a></span><span class="op" id="7373015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373021">type</span>&nbsp;<span class="ident" id="7373026">row</span>&nbsp;<span class="keyword" id="7373030">struct</span>&nbsp;<span class="op" id="7373037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373041">age</span>&nbsp;&nbsp;<span class="builtintype" id="7373046">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373052">name</span>&nbsp;<span class="builtintype" id="7373057">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373068">got</span>&nbsp;<span class="op" id="7373072">:=</span>&nbsp;<span class="op" id="7373075">[</span><span class="op" id="7373076">]</span><span class="ident" id="7373077"><a href="/database/sql/sql_test.go.html#7373026">row</a></span><span class="op" id="7373080">{</span><span class="op" id="7373081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373084">for</span>&nbsp;<span class="ident" id="7373088"><a href="/database/sql/sql_test.go.html#7372922">rows</a></span><span class="op" id="7373092">.</span><span class="ident" id="7373093">Next</span><span class="op" id="7373097">(</span><span class="op" id="7373098">)</span>&nbsp;<span class="op" id="7373100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373104">var</span>&nbsp;<span class="ident" id="7373108">r</span>&nbsp;<span class="ident" id="7373110"><a href="/database/sql/sql_test.go.html#7373026">row</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373116"><a href="/database/sql/sql_test.go.html#7372928">err</a></span>&nbsp;<span class="op" id="7373120">=</span>&nbsp;<span class="ident" id="7373122"><a href="/database/sql/sql_test.go.html#7372922">rows</a></span><span class="op" id="7373126">.</span><span class="ident" id="7373127">Scan</span><span class="op" id="7373131">(</span><span class="op" id="7373132">&amp;</span><span class="ident" id="7373133"><a href="/database/sql/sql_test.go.html#7373108">r</a></span><span class="op" id="7373134">.</span><span class="ident" id="7373135">age</span><span class="op" id="7373138">,</span>&nbsp;<span class="op" id="7373140">&amp;</span><span class="ident" id="7373141"><a href="/database/sql/sql_test.go.html#7373108">r</a></span><span class="op" id="7373142">.</span><span class="ident" id="7373143">name</span><span class="op" id="7373147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373151">if</span>&nbsp;<span class="ident" id="7373154"><a href="/database/sql/sql_test.go.html#7372928">err</a></span>&nbsp;<span class="op" id="7373158">!=</span>&nbsp;<span class="ident" id="7373161">nil</span>&nbsp;<span class="op" id="7373165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373170"><a href="/database/sql/sql_test.go.html#7372820">t</a></span><span class="op" id="7373171">.</span><span class="ident" id="7373172">Fatalf</span><span class="op" id="7373178">(</span><span class="string" id="7373179">&#34;Scan:&nbsp;%v&#34;</span><span class="op" id="7373189">,</span>&nbsp;<span class="ident" id="7373191"><a href="/database/sql/sql_test.go.html#7372928">err</a></span><span class="op" id="7373194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373202"><a href="/database/sql/sql_test.go.html#7373068">got</a></span>&nbsp;<span class="op" id="7373206">=</span>&nbsp;<span class="builtinfunc" id="7373208">append</span><span class="op" id="7373214">(</span><span class="ident" id="7373215"><a href="/database/sql/sql_test.go.html#7373068">got</a></span><span class="op" id="7373218">,</span>&nbsp;<span class="ident" id="7373220"><a href="/database/sql/sql_test.go.html#7373108">r</a></span><span class="op" id="7373221">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373227"><a href="/database/sql/sql_test.go.html#7372928">err</a></span>&nbsp;<span class="op" id="7373231">=</span>&nbsp;<span class="ident" id="7373233"><a href="/database/sql/sql_test.go.html#7372922">rows</a></span><span class="op" id="7373237">.</span><span class="ident" id="7373238">Err</span><span class="op" id="7373241">(</span><span class="op" id="7373242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373245">if</span>&nbsp;<span class="ident" id="7373248"><a href="/database/sql/sql_test.go.html#7372928">err</a></span>&nbsp;<span class="op" id="7373252">!=</span>&nbsp;<span class="ident" id="7373255">nil</span>&nbsp;<span class="op" id="7373259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373263"><a href="/database/sql/sql_test.go.html#7372820">t</a></span><span class="op" id="7373264">.</span><span class="ident" id="7373265">Fatalf</span><span class="op" id="7373271">(</span><span class="string" id="7373272">&#34;Err:&nbsp;%v&#34;</span><span class="op" id="7373281">,</span>&nbsp;<span class="ident" id="7373283"><a href="/database/sql/sql_test.go.html#7372928">err</a></span><span class="op" id="7373286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373289">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373292">want</span>&nbsp;<span class="op" id="7373297">:=</span>&nbsp;<span class="op" id="7373300">[</span><span class="op" id="7373301">]</span><span class="ident" id="7373302"><a href="/database/sql/sql_test.go.html#7373026">row</a></span><span class="op" id="7373305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373309">{</span><span class="ident" id="7373310">age</span><span class="op" id="7373313">:</span>&nbsp;<span class="num" id="7373315">1</span><span class="op" id="7373316">,</span>&nbsp;<span class="ident" id="7373318">name</span><span class="op" id="7373322">:</span>&nbsp;<span class="string" id="7373324">&#34;Alice&#34;</span><span class="op" id="7373331">}</span><span class="op" id="7373332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373336">{</span><span class="ident" id="7373337">age</span><span class="op" id="7373340">:</span>&nbsp;<span class="num" id="7373342">2</span><span class="op" id="7373343">,</span>&nbsp;<span class="ident" id="7373345">name</span><span class="op" id="7373349">:</span>&nbsp;<span class="string" id="7373351">&#34;Bob&#34;</span><span class="op" id="7373356">}</span><span class="op" id="7373357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373361">{</span><span class="ident" id="7373362">age</span><span class="op" id="7373365">:</span>&nbsp;<span class="num" id="7373367">3</span><span class="op" id="7373368">,</span>&nbsp;<span class="ident" id="7373370">name</span><span class="op" id="7373374">:</span>&nbsp;<span class="string" id="7373376">&#34;Chris&#34;</span><span class="op" id="7373383">}</span><span class="op" id="7373384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373387">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373390">if</span>&nbsp;<span class="op" id="7373393">!</span><span class="ident" id="7373394"><a href="/database/sql/sql_test.go.html#7368951">reflect</a></span><span class="op" id="7373401">.</span><span class="ident" id="7373402">DeepEqual</span><span class="op" id="7373411">(</span><span class="ident" id="7373412"><a href="/database/sql/sql_test.go.html#7373068">got</a></span><span class="op" id="7373415">,</span>&nbsp;<span class="ident" id="7373417"><a href="/database/sql/sql_test.go.html#7373292">want</a></span><span class="op" id="7373421">)</span>&nbsp;<span class="op" id="7373423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373427"><a href="/database/sql/sql_test.go.html#7372820">t</a></span><span class="op" id="7373428">.</span><span class="ident" id="7373429">Errorf</span><span class="op" id="7373435">(</span><span class="string" id="7373436">&#34;mismatch.\n&nbsp;got:&nbsp;%#v\nwant:&nbsp;%#v&#34;</span><span class="op" id="7373469">,</span>&nbsp;<span class="ident" id="7373471"><a href="/database/sql/sql_test.go.html#7373068">got</a></span><span class="op" id="7373474">,</span>&nbsp;<span class="ident" id="7373476"><a href="/database/sql/sql_test.go.html#7373292">want</a></span><span class="op" id="7373480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7373487">//&nbsp;And&nbsp;verify&nbsp;that&nbsp;the&nbsp;final&nbsp;rows.Next()&nbsp;call,&nbsp;which&nbsp;hit&nbsp;EOF,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7373550">//&nbsp;also&nbsp;closed&nbsp;the&nbsp;rows&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373587">if</span>&nbsp;<span class="ident" id="7373590">n</span>&nbsp;<span class="op" id="7373592">:=</span>&nbsp;<span class="ident" id="7373595"><a href="/database/sql/sql_test.go.html#7372837">db</a></span><span class="op" id="7373597">.</span><span class="ident" id="7373598">numFreeConns</span><span class="op" id="7373610">(</span><span class="op" id="7373611">)</span><span class="op" id="7373612">;</span>&nbsp;<span class="ident" id="7373614"><a href="/database/sql/sql_test.go.html#7373590">n</a></span>&nbsp;<span class="op" id="7373616">!=</span>&nbsp;<span class="num" id="7373619">1</span>&nbsp;<span class="op" id="7373621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373625"><a href="/database/sql/sql_test.go.html#7372820">t</a></span><span class="op" id="7373626">.</span><span class="ident" id="7373627">Fatalf</span><span class="op" id="7373633">(</span><span class="string" id="7373634">&#34;free&nbsp;conns&nbsp;after&nbsp;query&nbsp;hitting&nbsp;EOF&nbsp;=&nbsp;%d;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7373683">,</span>&nbsp;<span class="ident" id="7373685"><a href="/database/sql/sql_test.go.html#7373590">n</a></span><span class="op" id="7373686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373692">if</span>&nbsp;<span class="ident" id="7373695">prepares</span>&nbsp;<span class="op" id="7373704">:=</span>&nbsp;<span class="ident" id="7373707"><a href="/database/sql/sql_test.go.html#7371619">numPrepares</a></span><span class="op" id="7373718">(</span><span class="ident" id="7373719"><a href="/database/sql/sql_test.go.html#7372820">t</a></span><span class="op" id="7373720">,</span>&nbsp;<span class="ident" id="7373722"><a href="/database/sql/sql_test.go.html#7372837">db</a></span><span class="op" id="7373724">)</span>&nbsp;<span class="op" id="7373726">-</span>&nbsp;<span class="ident" id="7373728"><a href="/database/sql/sql_test.go.html#7372889">prepares0</a></span><span class="op" id="7373737">;</span>&nbsp;<span class="ident" id="7373739"><a href="/database/sql/sql_test.go.html#7373695">prepares</a></span>&nbsp;<span class="op" id="7373748">!=</span>&nbsp;<span class="num" id="7373751">1</span>&nbsp;<span class="op" id="7373753">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373757"><a href="/database/sql/sql_test.go.html#7372820">t</a></span><span class="op" id="7373758">.</span><span class="ident" id="7373759">Errorf</span><span class="op" id="7373765">(</span><span class="string" id="7373766">&#34;executed&nbsp;%d&nbsp;Prepare&nbsp;statements;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7373806">,</span>&nbsp;<span class="ident" id="7373808"><a href="/database/sql/sql_test.go.html#7373695">prepares</a></span><span class="op" id="7373816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373819">}</span><br>
<span class="lineno"></span><span class="op" id="7373821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7373824">func</span>&nbsp;<span class="ident" id="7373829">TestByteOwnership</span><span class="op" id="7373846">(</span><span class="ident" id="7373847">t</span>&nbsp;<span class="op" id="7373849">*</span><span class="ident" id="7373850"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7373857">.</span><span class="ident" id="7373858">T</span><span class="op" id="7373859">)</span>&nbsp;<span class="op" id="7373861">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373864">db</span>&nbsp;<span class="op" id="7373867">:=</span>&nbsp;<span class="ident" id="7373870"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7373879">(</span><span class="ident" id="7373880"><a href="/database/sql/sql_test.go.html#7373847">t</a></span><span class="op" id="7373881">,</span>&nbsp;<span class="string" id="7373883">&#34;people&#34;</span><span class="op" id="7373891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373894">defer</span>&nbsp;<span class="ident" id="7373900"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7373907">(</span><span class="ident" id="7373908"><a href="/database/sql/sql_test.go.html#7373847">t</a></span><span class="op" id="7373909">,</span>&nbsp;<span class="ident" id="7373911"><a href="/database/sql/sql_test.go.html#7373864">db</a></span><span class="op" id="7373913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373916">rows</span><span class="op" id="7373920">,</span>&nbsp;<span class="ident" id="7373922">err</span>&nbsp;<span class="op" id="7373926">:=</span>&nbsp;<span class="ident" id="7373929"><a href="/database/sql/sql_test.go.html#7373864">db</a></span><span class="op" id="7373931">.</span><span class="ident" id="7373932">Query</span><span class="op" id="7373937">(</span><span class="string" id="7373938">&#34;SELECT|people|name,photo|&#34;</span><span class="op" id="7373965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373968">if</span>&nbsp;<span class="ident" id="7373971"><a href="/database/sql/sql_test.go.html#7373922">err</a></span>&nbsp;<span class="op" id="7373975">!=</span>&nbsp;<span class="ident" id="7373978">nil</span>&nbsp;<span class="op" id="7373982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373986"><a href="/database/sql/sql_test.go.html#7373847">t</a></span><span class="op" id="7373987">.</span><span class="ident" id="7373988">Fatalf</span><span class="op" id="7373994">(</span><span class="string" id="7373995">&#34;Query:&nbsp;%v&#34;</span><span class="op" id="7374006">,</span>&nbsp;<span class="ident" id="7374008"><a href="/database/sql/sql_test.go.html#7373922">err</a></span><span class="op" id="7374011">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374017">type</span>&nbsp;<span class="ident" id="7374022">row</span>&nbsp;<span class="keyword" id="7374026">struct</span>&nbsp;<span class="op" id="7374033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374037">name</span>&nbsp;&nbsp;<span class="op" id="7374043">[</span><span class="op" id="7374044">]</span><span class="builtintype" id="7374045">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374052">photo</span>&nbsp;<span class="ident" id="7374058"><a href="/database/sql/sql.go.html#6350102">RawBytes</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374068">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374071">got</span>&nbsp;<span class="op" id="7374075">:=</span>&nbsp;<span class="op" id="7374078">[</span><span class="op" id="7374079">]</span><span class="ident" id="7374080"><a href="/database/sql/sql_test.go.html#7374022">row</a></span><span class="op" id="7374083">{</span><span class="op" id="7374084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374087">for</span>&nbsp;<span class="ident" id="7374091"><a href="/database/sql/sql_test.go.html#7373916">rows</a></span><span class="op" id="7374095">.</span><span class="ident" id="7374096">Next</span><span class="op" id="7374100">(</span><span class="op" id="7374101">)</span>&nbsp;<span class="op" id="7374103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374107">var</span>&nbsp;<span class="ident" id="7374111">r</span>&nbsp;<span class="ident" id="7374113"><a href="/database/sql/sql_test.go.html#7374022">row</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374119"><a href="/database/sql/sql_test.go.html#7373922">err</a></span>&nbsp;<span class="op" id="7374123">=</span>&nbsp;<span class="ident" id="7374125"><a href="/database/sql/sql_test.go.html#7373916">rows</a></span><span class="op" id="7374129">.</span><span class="ident" id="7374130">Scan</span><span class="op" id="7374134">(</span><span class="op" id="7374135">&amp;</span><span class="ident" id="7374136"><a href="/database/sql/sql_test.go.html#7374111">r</a></span><span class="op" id="7374137">.</span><span class="ident" id="7374138">name</span><span class="op" id="7374142">,</span>&nbsp;<span class="op" id="7374144">&amp;</span><span class="ident" id="7374145"><a href="/database/sql/sql_test.go.html#7374111">r</a></span><span class="op" id="7374146">.</span><span class="ident" id="7374147">photo</span><span class="op" id="7374152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374156">if</span>&nbsp;<span class="ident" id="7374159"><a href="/database/sql/sql_test.go.html#7373922">err</a></span>&nbsp;<span class="op" id="7374163">!=</span>&nbsp;<span class="ident" id="7374166">nil</span>&nbsp;<span class="op" id="7374170">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374175"><a href="/database/sql/sql_test.go.html#7373847">t</a></span><span class="op" id="7374176">.</span><span class="ident" id="7374177">Fatalf</span><span class="op" id="7374183">(</span><span class="string" id="7374184">&#34;Scan:&nbsp;%v&#34;</span><span class="op" id="7374194">,</span>&nbsp;<span class="ident" id="7374196"><a href="/database/sql/sql_test.go.html#7373922">err</a></span><span class="op" id="7374199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374207"><a href="/database/sql/sql_test.go.html#7374071">got</a></span>&nbsp;<span class="op" id="7374211">=</span>&nbsp;<span class="builtinfunc" id="7374213">append</span><span class="op" id="7374219">(</span><span class="ident" id="7374220"><a href="/database/sql/sql_test.go.html#7374071">got</a></span><span class="op" id="7374223">,</span>&nbsp;<span class="ident" id="7374225"><a href="/database/sql/sql_test.go.html#7374111">r</a></span><span class="op" id="7374226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374232">corruptMemory</span>&nbsp;<span class="op" id="7374246">:=</span>&nbsp;<span class="op" id="7374249">[</span><span class="op" id="7374250">]</span><span class="builtintype" id="7374251">byte</span><span class="op" id="7374255">(</span><span class="string" id="7374256">&#34;\xffPHOTO&#34;</span><span class="op" id="7374267">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374270">want</span>&nbsp;<span class="op" id="7374275">:=</span>&nbsp;<span class="op" id="7374278">[</span><span class="op" id="7374279">]</span><span class="ident" id="7374280"><a href="/database/sql/sql_test.go.html#7374022">row</a></span><span class="op" id="7374283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374287">{</span><span class="ident" id="7374288">name</span><span class="op" id="7374292">:</span>&nbsp;<span class="op" id="7374294">[</span><span class="op" id="7374295">]</span><span class="builtintype" id="7374296">byte</span><span class="op" id="7374300">(</span><span class="string" id="7374301">&#34;Alice&#34;</span><span class="op" id="7374308">)</span><span class="op" id="7374309">,</span>&nbsp;<span class="ident" id="7374311">photo</span><span class="op" id="7374316">:</span>&nbsp;<span class="ident" id="7374318"><a href="/database/sql/sql_test.go.html#7374232">corruptMemory</a></span><span class="op" id="7374331">}</span><span class="op" id="7374332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374336">{</span><span class="ident" id="7374337">name</span><span class="op" id="7374341">:</span>&nbsp;<span class="op" id="7374343">[</span><span class="op" id="7374344">]</span><span class="builtintype" id="7374345">byte</span><span class="op" id="7374349">(</span><span class="string" id="7374350">&#34;Bob&#34;</span><span class="op" id="7374355">)</span><span class="op" id="7374356">,</span>&nbsp;<span class="ident" id="7374358">photo</span><span class="op" id="7374363">:</span>&nbsp;<span class="ident" id="7374365"><a href="/database/sql/sql_test.go.html#7374232">corruptMemory</a></span><span class="op" id="7374378">}</span><span class="op" id="7374379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374383">{</span><span class="ident" id="7374384">name</span><span class="op" id="7374388">:</span>&nbsp;<span class="op" id="7374390">[</span><span class="op" id="7374391">]</span><span class="builtintype" id="7374392">byte</span><span class="op" id="7374396">(</span><span class="string" id="7374397">&#34;Chris&#34;</span><span class="op" id="7374404">)</span><span class="op" id="7374405">,</span>&nbsp;<span class="ident" id="7374407">photo</span><span class="op" id="7374412">:</span>&nbsp;<span class="ident" id="7374414"><a href="/database/sql/sql_test.go.html#7374232">corruptMemory</a></span><span class="op" id="7374427">}</span><span class="op" id="7374428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374431">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374434">if</span>&nbsp;<span class="op" id="7374437">!</span><span class="ident" id="7374438"><a href="/database/sql/sql_test.go.html#7368951">reflect</a></span><span class="op" id="7374445">.</span><span class="ident" id="7374446">DeepEqual</span><span class="op" id="7374455">(</span><span class="ident" id="7374456"><a href="/database/sql/sql_test.go.html#7374071">got</a></span><span class="op" id="7374459">,</span>&nbsp;<span class="ident" id="7374461"><a href="/database/sql/sql_test.go.html#7374270">want</a></span><span class="op" id="7374465">)</span>&nbsp;<span class="op" id="7374467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374471"><a href="/database/sql/sql_test.go.html#7373847">t</a></span><span class="op" id="7374472">.</span><span class="ident" id="7374473">Errorf</span><span class="op" id="7374479">(</span><span class="string" id="7374480">&#34;mismatch.\n&nbsp;got:&nbsp;%#v\nwant:&nbsp;%#v&#34;</span><span class="op" id="7374513">,</span>&nbsp;<span class="ident" id="7374515"><a href="/database/sql/sql_test.go.html#7374071">got</a></span><span class="op" id="7374518">,</span>&nbsp;<span class="ident" id="7374520"><a href="/database/sql/sql_test.go.html#7374270">want</a></span><span class="op" id="7374524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374531">var</span>&nbsp;<span class="ident" id="7374535">photo</span>&nbsp;<span class="ident" id="7374541"><a href="/database/sql/sql.go.html#6350102">RawBytes</a></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374551"><a href="/database/sql/sql_test.go.html#7373922">err</a></span>&nbsp;<span class="op" id="7374555">=</span>&nbsp;<span class="ident" id="7374557"><a href="/database/sql/sql_test.go.html#7373864">db</a></span><span class="op" id="7374559">.</span><span class="ident" id="7374560">QueryRow</span><span class="op" id="7374568">(</span><span class="string" id="7374569">&#34;SELECT|people|photo|name=?&#34;</span><span class="op" id="7374597">,</span>&nbsp;<span class="string" id="7374599">&#34;Alice&#34;</span><span class="op" id="7374606">)</span><span class="op" id="7374607">.</span><span class="ident" id="7374608">Scan</span><span class="op" id="7374612">(</span><span class="op" id="7374613">&amp;</span><span class="ident" id="7374614"><a href="/database/sql/sql_test.go.html#7374535">photo</a></span><span class="op" id="7374619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374622">if</span>&nbsp;<span class="ident" id="7374625"><a href="/database/sql/sql_test.go.html#7373922">err</a></span>&nbsp;<span class="op" id="7374629">==</span>&nbsp;<span class="ident" id="7374632">nil</span>&nbsp;<span class="op" id="7374636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374640"><a href="/database/sql/sql_test.go.html#7373847">t</a></span><span class="op" id="7374641">.</span><span class="ident" id="7374642">Error</span><span class="op" id="7374647">(</span><span class="string" id="7374648">&#34;want&nbsp;error&nbsp;scanning&nbsp;into&nbsp;RawBytes&nbsp;from&nbsp;QueryRow&#34;</span><span class="op" id="7374697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374700">}</span><br>
<span class="lineno"></span><span class="op" id="7374702">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="7374705">func</span>&nbsp;<span class="ident" id="7374710">TestRowsColumns</span><span class="op" id="7374725">(</span><span class="ident" id="7374726">t</span>&nbsp;<span class="op" id="7374728">*</span><span class="ident" id="7374729"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7374736">.</span><span class="ident" id="7374737">T</span><span class="op" id="7374738">)</span>&nbsp;<span class="op" id="7374740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374743">db</span>&nbsp;<span class="op" id="7374746">:=</span>&nbsp;<span class="ident" id="7374749"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7374758">(</span><span class="ident" id="7374759"><a href="/database/sql/sql_test.go.html#7374726">t</a></span><span class="op" id="7374760">,</span>&nbsp;<span class="string" id="7374762">&#34;people&#34;</span><span class="op" id="7374770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374773">defer</span>&nbsp;<span class="ident" id="7374779"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7374786">(</span><span class="ident" id="7374787"><a href="/database/sql/sql_test.go.html#7374726">t</a></span><span class="op" id="7374788">,</span>&nbsp;<span class="ident" id="7374790"><a href="/database/sql/sql_test.go.html#7374743">db</a></span><span class="op" id="7374792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374795">rows</span><span class="op" id="7374799">,</span>&nbsp;<span class="ident" id="7374801">err</span>&nbsp;<span class="op" id="7374805">:=</span>&nbsp;<span class="ident" id="7374808"><a href="/database/sql/sql_test.go.html#7374743">db</a></span><span class="op" id="7374810">.</span><span class="ident" id="7374811">Query</span><span class="op" id="7374816">(</span><span class="string" id="7374817">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7374842">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374845">if</span>&nbsp;<span class="ident" id="7374848"><a href="/database/sql/sql_test.go.html#7374801">err</a></span>&nbsp;<span class="op" id="7374852">!=</span>&nbsp;<span class="ident" id="7374855">nil</span>&nbsp;<span class="op" id="7374859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374863"><a href="/database/sql/sql_test.go.html#7374726">t</a></span><span class="op" id="7374864">.</span><span class="ident" id="7374865">Fatalf</span><span class="op" id="7374871">(</span><span class="string" id="7374872">&#34;Query:&nbsp;%v&#34;</span><span class="op" id="7374883">,</span>&nbsp;<span class="ident" id="7374885"><a href="/database/sql/sql_test.go.html#7374801">err</a></span><span class="op" id="7374888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374894">cols</span><span class="op" id="7374898">,</span>&nbsp;<span class="ident" id="7374900"><a href="/database/sql/sql_test.go.html#7374801">err</a></span>&nbsp;<span class="op" id="7374904">:=</span>&nbsp;<span class="ident" id="7374907"><a href="/database/sql/sql_test.go.html#7374795">rows</a></span><span class="op" id="7374911">.</span><span class="ident" id="7374912">Columns</span><span class="op" id="7374919">(</span><span class="op" id="7374920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374923">if</span>&nbsp;<span class="ident" id="7374926"><a href="/database/sql/sql_test.go.html#7374801">err</a></span>&nbsp;<span class="op" id="7374930">!=</span>&nbsp;<span class="ident" id="7374933">nil</span>&nbsp;<span class="op" id="7374937">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374941"><a href="/database/sql/sql_test.go.html#7374726">t</a></span><span class="op" id="7374942">.</span><span class="ident" id="7374943">Fatalf</span><span class="op" id="7374949">(</span><span class="string" id="7374950">&#34;Columns:&nbsp;%v&#34;</span><span class="op" id="7374963">,</span>&nbsp;<span class="ident" id="7374965"><a href="/database/sql/sql_test.go.html#7374801">err</a></span><span class="op" id="7374968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374974">want</span>&nbsp;<span class="op" id="7374979">:=</span>&nbsp;<span class="op" id="7374982">[</span><span class="op" id="7374983">]</span><span class="builtintype" id="7374984">string</span><span class="op" id="7374990">{</span><span class="string" id="7374991">&#34;age&#34;</span><span class="op" id="7374996">,</span>&nbsp;<span class="string" id="7374998">&#34;name&#34;</span><span class="op" id="7375004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375007">if</span>&nbsp;<span class="op" id="7375010">!</span><span class="ident" id="7375011"><a href="/database/sql/sql_test.go.html#7368951">reflect</a></span><span class="op" id="7375018">.</span><span class="ident" id="7375019">DeepEqual</span><span class="op" id="7375028">(</span><span class="ident" id="7375029"><a href="/database/sql/sql_test.go.html#7374894">cols</a></span><span class="op" id="7375033">,</span>&nbsp;<span class="ident" id="7375035"><a href="/database/sql/sql_test.go.html#7374974">want</a></span><span class="op" id="7375039">)</span>&nbsp;<span class="op" id="7375041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375045"><a href="/database/sql/sql_test.go.html#7374726">t</a></span><span class="op" id="7375046">.</span><span class="ident" id="7375047">Errorf</span><span class="op" id="7375053">(</span><span class="string" id="7375054">&#34;got&nbsp;%#v;&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="7375073">,</span>&nbsp;<span class="ident" id="7375075"><a href="/database/sql/sql_test.go.html#7374894">cols</a></span><span class="op" id="7375079">,</span>&nbsp;<span class="ident" id="7375081"><a href="/database/sql/sql_test.go.html#7374974">want</a></span><span class="op" id="7375085">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7375088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375091">if</span>&nbsp;<span class="ident" id="7375094">err</span>&nbsp;<span class="op" id="7375098">:=</span>&nbsp;<span class="ident" id="7375101"><a href="/database/sql/sql_test.go.html#7374795">rows</a></span><span class="op" id="7375105">.</span><span class="ident" id="7375106">Close</span><span class="op" id="7375111">(</span><span class="op" id="7375112">)</span><span class="op" id="7375113">;</span>&nbsp;<span class="ident" id="7375115"><a href="/database/sql/sql_test.go.html#7375094">err</a></span>&nbsp;<span class="op" id="7375119">!=</span>&nbsp;<span class="ident" id="7375122">nil</span>&nbsp;<span class="op" id="7375126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375130"><a href="/database/sql/sql_test.go.html#7374726">t</a></span><span class="op" id="7375131">.</span><span class="ident" id="7375132">Errorf</span><span class="op" id="7375138">(</span><span class="string" id="7375139">&#34;error&nbsp;closing&nbsp;rows:&nbsp;%s&#34;</span><span class="op" id="7375163">,</span>&nbsp;<span class="ident" id="7375165"><a href="/database/sql/sql_test.go.html#7375094">err</a></span><span class="op" id="7375168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7375171">}</span><br>
<span class="lineno"></span><span class="op" id="7375173">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="7375176">func</span>&nbsp;<span class="ident" id="7375181">TestQueryRow</span><span class="op" id="7375193">(</span><span class="ident" id="7375194">t</span>&nbsp;<span class="op" id="7375196">*</span><span class="ident" id="7375197"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7375204">.</span><span class="ident" id="7375205">T</span><span class="op" id="7375206">)</span>&nbsp;<span class="op" id="7375208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375211">db</span>&nbsp;<span class="op" id="7375214">:=</span>&nbsp;<span class="ident" id="7375217"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7375226">(</span><span class="ident" id="7375227"><a href="/database/sql/sql_test.go.html#7375194">t</a></span><span class="op" id="7375228">,</span>&nbsp;<span class="string" id="7375230">&#34;people&#34;</span><span class="op" id="7375238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375241">defer</span>&nbsp;<span class="ident" id="7375247"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7375254">(</span><span class="ident" id="7375255"><a href="/database/sql/sql_test.go.html#7375194">t</a></span><span class="op" id="7375256">,</span>&nbsp;<span class="ident" id="7375258"><a href="/database/sql/sql_test.go.html#7375211">db</a></span><span class="op" id="7375260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375263">var</span>&nbsp;<span class="ident" id="7375267">name</span>&nbsp;<span class="builtintype" id="7375272">string</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375280">var</span>&nbsp;<span class="ident" id="7375284">age</span>&nbsp;<span class="builtintype" id="7375288">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375293">var</span>&nbsp;<span class="ident" id="7375297">birthday</span>&nbsp;<span class="ident" id="7375306"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7375310">.</span><span class="ident" id="7375311">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375318">err</span>&nbsp;<span class="op" id="7375322">:=</span>&nbsp;<span class="ident" id="7375325"><a href="/database/sql/sql_test.go.html#7375211">db</a></span><span class="op" id="7375327">.</span><span class="ident" id="7375328">QueryRow</span><span class="op" id="7375336">(</span><span class="string" id="7375337">&#34;SELECT|people|age,name|age=?&#34;</span><span class="op" id="7375367">,</span>&nbsp;<span class="num" id="7375369">3</span><span class="op" id="7375370">)</span><span class="op" id="7375371">.</span><span class="ident" id="7375372">Scan</span><span class="op" id="7375376">(</span><span class="op" id="7375377">&amp;</span><span class="ident" id="7375378"><a href="/database/sql/sql_test.go.html#7375284">age</a></span><span class="op" id="7375381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375384">if</span>&nbsp;<span class="ident" id="7375387"><a href="/database/sql/sql_test.go.html#7375318">err</a></span>&nbsp;<span class="op" id="7375391">==</span>&nbsp;<span class="ident" id="7375394">nil</span>&nbsp;<span class="op" id="7375398">||</span>&nbsp;<span class="op" id="7375401">!</span><span class="ident" id="7375402"><a href="/database/sql/sql_test.go.html#7368973">strings</a></span><span class="op" id="7375409">.</span><span class="ident" id="7375410">Contains</span><span class="op" id="7375418">(</span><span class="ident" id="7375419"><a href="/database/sql/sql_test.go.html#7375318">err</a></span><span class="op" id="7375422">.</span><span class="ident" id="7375423">Error</span><span class="op" id="7375428">(</span><span class="op" id="7375429">)</span><span class="op" id="7375430">,</span>&nbsp;<span class="string" id="7375432">&#34;expected&nbsp;2&nbsp;destination&nbsp;arguments&#34;</span><span class="op" id="7375466">)</span>&nbsp;<span class="op" id="7375468">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375472"><a href="/database/sql/sql_test.go.html#7375194">t</a></span><span class="op" id="7375473">.</span><span class="ident" id="7375474">Errorf</span><span class="op" id="7375480">(</span><span class="string" id="7375481">&#34;expected&nbsp;error&nbsp;from&nbsp;wrong&nbsp;number&nbsp;of&nbsp;arguments;&nbsp;actually&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="7375546">,</span>&nbsp;<span class="ident" id="7375548"><a href="/database/sql/sql_test.go.html#7375318">err</a></span><span class="op" id="7375551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7375554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375558"><a href="/database/sql/sql_test.go.html#7375318">err</a></span>&nbsp;<span class="op" id="7375562">=</span>&nbsp;<span class="ident" id="7375564"><a href="/database/sql/sql_test.go.html#7375211">db</a></span><span class="op" id="7375566">.</span><span class="ident" id="7375567">QueryRow</span><span class="op" id="7375575">(</span><span class="string" id="7375576">&#34;SELECT|people|bdate|age=?&#34;</span><span class="op" id="7375603">,</span>&nbsp;<span class="num" id="7375605">3</span><span class="op" id="7375606">)</span><span class="op" id="7375607">.</span><span class="ident" id="7375608">Scan</span><span class="op" id="7375612">(</span><span class="op" id="7375613">&amp;</span><span class="ident" id="7375614"><a href="/database/sql/sql_test.go.html#7375297">birthday</a></span><span class="op" id="7375622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375625">if</span>&nbsp;<span class="ident" id="7375628"><a href="/database/sql/sql_test.go.html#7375318">err</a></span>&nbsp;<span class="op" id="7375632">!=</span>&nbsp;<span class="ident" id="7375635">nil</span>&nbsp;<span class="op" id="7375639">||</span>&nbsp;<span class="op" id="7375642">!</span><span class="ident" id="7375643"><a href="/database/sql/sql_test.go.html#7375297">birthday</a></span><span class="op" id="7375651">.</span><span class="ident" id="7375652">Equal</span><span class="op" id="7375657">(</span><span class="ident" id="7375658"><a href="/database/sql/sql_test.go.html#7369662">chrisBirthday</a></span><span class="op" id="7375671">)</span>&nbsp;<span class="op" id="7375673">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375677"><a href="/database/sql/sql_test.go.html#7375194">t</a></span><span class="op" id="7375678">.</span><span class="ident" id="7375679">Errorf</span><span class="op" id="7375685">(</span><span class="string" id="7375686">&#34;chris&nbsp;birthday&nbsp;=&nbsp;%v,&nbsp;err&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7375726">,</span>&nbsp;<span class="ident" id="7375728"><a href="/database/sql/sql_test.go.html#7375297">birthday</a></span><span class="op" id="7375736">,</span>&nbsp;<span class="ident" id="7375738"><a href="/database/sql/sql_test.go.html#7375318">err</a></span><span class="op" id="7375741">,</span>&nbsp;<span class="ident" id="7375743"><a href="/database/sql/sql_test.go.html#7369662">chrisBirthday</a></span><span class="op" id="7375756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7375759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375763"><a href="/database/sql/sql_test.go.html#7375318">err</a></span>&nbsp;<span class="op" id="7375767">=</span>&nbsp;<span class="ident" id="7375769"><a href="/database/sql/sql_test.go.html#7375211">db</a></span><span class="op" id="7375771">.</span><span class="ident" id="7375772">QueryRow</span><span class="op" id="7375780">(</span><span class="string" id="7375781">&#34;SELECT|people|age,name|age=?&#34;</span><span class="op" id="7375811">,</span>&nbsp;<span class="num" id="7375813">2</span><span class="op" id="7375814">)</span><span class="op" id="7375815">.</span><span class="ident" id="7375816">Scan</span><span class="op" id="7375820">(</span><span class="op" id="7375821">&amp;</span><span class="ident" id="7375822"><a href="/database/sql/sql_test.go.html#7375284">age</a></span><span class="op" id="7375825">,</span>&nbsp;<span class="op" id="7375827">&amp;</span><span class="ident" id="7375828"><a href="/database/sql/sql_test.go.html#7375267">name</a></span><span class="op" id="7375832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375835">if</span>&nbsp;<span class="ident" id="7375838"><a href="/database/sql/sql_test.go.html#7375318">err</a></span>&nbsp;<span class="op" id="7375842">!=</span>&nbsp;<span class="ident" id="7375845">nil</span>&nbsp;<span class="op" id="7375849">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375853"><a href="/database/sql/sql_test.go.html#7375194">t</a></span><span class="op" id="7375854">.</span><span class="ident" id="7375855">Fatalf</span><span class="op" id="7375861">(</span><span class="string" id="7375862">&#34;age&nbsp;QueryRow+Scan:&nbsp;%v&#34;</span><span class="op" id="7375885">,</span>&nbsp;<span class="ident" id="7375887"><a href="/database/sql/sql_test.go.html#7375318">err</a></span><span class="op" id="7375890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7375893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375896">if</span>&nbsp;<span class="ident" id="7375899"><a href="/database/sql/sql_test.go.html#7375267">name</a></span>&nbsp;<span class="op" id="7375904">!=</span>&nbsp;<span class="string" id="7375907">&#34;Bob&#34;</span>&nbsp;<span class="op" id="7375913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375917"><a href="/database/sql/sql_test.go.html#7375194">t</a></span><span class="op" id="7375918">.</span><span class="ident" id="7375919">Errorf</span><span class="op" id="7375925">(</span><span class="string" id="7375926">&#34;expected&nbsp;name&nbsp;Bob,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7375953">,</span>&nbsp;<span class="ident" id="7375955"><a href="/database/sql/sql_test.go.html#7375267">name</a></span><span class="op" id="7375959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7375962">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375965">if</span>&nbsp;<span class="ident" id="7375968"><a href="/database/sql/sql_test.go.html#7375284">age</a></span>&nbsp;<span class="op" id="7375972">!=</span>&nbsp;<span class="num" id="7375975">2</span>&nbsp;<span class="op" id="7375977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375981"><a href="/database/sql/sql_test.go.html#7375194">t</a></span><span class="op" id="7375982">.</span><span class="ident" id="7375983">Errorf</span><span class="op" id="7375989">(</span><span class="string" id="7375990">&#34;expected&nbsp;age&nbsp;2,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7376014">,</span>&nbsp;<span class="ident" id="7376016"><a href="/database/sql/sql_test.go.html#7375284">age</a></span><span class="op" id="7376019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376026"><a href="/database/sql/sql_test.go.html#7375318">err</a></span>&nbsp;<span class="op" id="7376030">=</span>&nbsp;<span class="ident" id="7376032"><a href="/database/sql/sql_test.go.html#7375211">db</a></span><span class="op" id="7376034">.</span><span class="ident" id="7376035">QueryRow</span><span class="op" id="7376043">(</span><span class="string" id="7376044">&#34;SELECT|people|age,name|name=?&#34;</span><span class="op" id="7376075">,</span>&nbsp;<span class="string" id="7376077">&#34;Alice&#34;</span><span class="op" id="7376084">)</span><span class="op" id="7376085">.</span><span class="ident" id="7376086">Scan</span><span class="op" id="7376090">(</span><span class="op" id="7376091">&amp;</span><span class="ident" id="7376092"><a href="/database/sql/sql_test.go.html#7375284">age</a></span><span class="op" id="7376095">,</span>&nbsp;<span class="op" id="7376097">&amp;</span><span class="ident" id="7376098"><a href="/database/sql/sql_test.go.html#7375267">name</a></span><span class="op" id="7376102">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376105">if</span>&nbsp;<span class="ident" id="7376108"><a href="/database/sql/sql_test.go.html#7375318">err</a></span>&nbsp;<span class="op" id="7376112">!=</span>&nbsp;<span class="ident" id="7376115">nil</span>&nbsp;<span class="op" id="7376119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376123"><a href="/database/sql/sql_test.go.html#7375194">t</a></span><span class="op" id="7376124">.</span><span class="ident" id="7376125">Fatalf</span><span class="op" id="7376131">(</span><span class="string" id="7376132">&#34;name&nbsp;QueryRow+Scan:&nbsp;%v&#34;</span><span class="op" id="7376156">,</span>&nbsp;<span class="ident" id="7376158"><a href="/database/sql/sql_test.go.html#7375318">err</a></span><span class="op" id="7376161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376167">if</span>&nbsp;<span class="ident" id="7376170"><a href="/database/sql/sql_test.go.html#7375267">name</a></span>&nbsp;<span class="op" id="7376175">!=</span>&nbsp;<span class="string" id="7376178">&#34;Alice&#34;</span>&nbsp;<span class="op" id="7376186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376190"><a href="/database/sql/sql_test.go.html#7375194">t</a></span><span class="op" id="7376191">.</span><span class="ident" id="7376192">Errorf</span><span class="op" id="7376198">(</span><span class="string" id="7376199">&#34;expected&nbsp;name&nbsp;Alice,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7376228">,</span>&nbsp;<span class="ident" id="7376230"><a href="/database/sql/sql_test.go.html#7375267">name</a></span><span class="op" id="7376234">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376240">if</span>&nbsp;<span class="ident" id="7376243"><a href="/database/sql/sql_test.go.html#7375284">age</a></span>&nbsp;<span class="op" id="7376247">!=</span>&nbsp;<span class="num" id="7376250">1</span>&nbsp;<span class="op" id="7376252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376256"><a href="/database/sql/sql_test.go.html#7375194">t</a></span><span class="op" id="7376257">.</span><span class="ident" id="7376258">Errorf</span><span class="op" id="7376264">(</span><span class="string" id="7376265">&#34;expected&nbsp;age&nbsp;1,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7376289">,</span>&nbsp;<span class="ident" id="7376291"><a href="/database/sql/sql_test.go.html#7375284">age</a></span><span class="op" id="7376294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376301">var</span>&nbsp;<span class="ident" id="7376305">photo</span>&nbsp;<span class="op" id="7376311">[</span><span class="op" id="7376312">]</span><span class="builtintype" id="7376313">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376319"><a href="/database/sql/sql_test.go.html#7375318">err</a></span>&nbsp;<span class="op" id="7376323">=</span>&nbsp;<span class="ident" id="7376325"><a href="/database/sql/sql_test.go.html#7375211">db</a></span><span class="op" id="7376327">.</span><span class="ident" id="7376328">QueryRow</span><span class="op" id="7376336">(</span><span class="string" id="7376337">&#34;SELECT|people|photo|name=?&#34;</span><span class="op" id="7376365">,</span>&nbsp;<span class="string" id="7376367">&#34;Alice&#34;</span><span class="op" id="7376374">)</span><span class="op" id="7376375">.</span><span class="ident" id="7376376">Scan</span><span class="op" id="7376380">(</span><span class="op" id="7376381">&amp;</span><span class="ident" id="7376382"><a href="/database/sql/sql_test.go.html#7376305">photo</a></span><span class="op" id="7376387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376390">if</span>&nbsp;<span class="ident" id="7376393"><a href="/database/sql/sql_test.go.html#7375318">err</a></span>&nbsp;<span class="op" id="7376397">!=</span>&nbsp;<span class="ident" id="7376400">nil</span>&nbsp;<span class="op" id="7376404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376408"><a href="/database/sql/sql_test.go.html#7375194">t</a></span><span class="op" id="7376409">.</span><span class="ident" id="7376410">Fatalf</span><span class="op" id="7376416">(</span><span class="string" id="7376417">&#34;photo&nbsp;QueryRow+Scan:&nbsp;%v&#34;</span><span class="op" id="7376442">,</span>&nbsp;<span class="ident" id="7376444"><a href="/database/sql/sql_test.go.html#7375318">err</a></span><span class="op" id="7376447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376450">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376453">want</span>&nbsp;<span class="op" id="7376458">:=</span>&nbsp;<span class="op" id="7376461">[</span><span class="op" id="7376462">]</span><span class="builtintype" id="7376463">byte</span><span class="op" id="7376467">(</span><span class="string" id="7376468">&#34;APHOTO&#34;</span><span class="op" id="7376476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376479">if</span>&nbsp;<span class="op" id="7376482">!</span><span class="ident" id="7376483"><a href="/database/sql/sql_test.go.html#7368951">reflect</a></span><span class="op" id="7376490">.</span><span class="ident" id="7376491">DeepEqual</span><span class="op" id="7376500">(</span><span class="ident" id="7376501"><a href="/database/sql/sql_test.go.html#7376305">photo</a></span><span class="op" id="7376506">,</span>&nbsp;<span class="ident" id="7376508"><a href="/database/sql/sql_test.go.html#7376453">want</a></span><span class="op" id="7376512">)</span>&nbsp;<span class="op" id="7376514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376518"><a href="/database/sql/sql_test.go.html#7375194">t</a></span><span class="op" id="7376519">.</span><span class="ident" id="7376520">Errorf</span><span class="op" id="7376526">(</span><span class="string" id="7376527">&#34;photo&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7376548">,</span>&nbsp;<span class="ident" id="7376550"><a href="/database/sql/sql_test.go.html#7376305">photo</a></span><span class="op" id="7376555">,</span>&nbsp;<span class="ident" id="7376557"><a href="/database/sql/sql_test.go.html#7376453">want</a></span><span class="op" id="7376561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376564">}</span><br>
<span class="lineno"></span><span class="op" id="7376566">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="7376569">func</span>&nbsp;<span class="ident" id="7376574">TestStatementErrorAfterClose</span><span class="op" id="7376602">(</span><span class="ident" id="7376603">t</span>&nbsp;<span class="op" id="7376605">*</span><span class="ident" id="7376606"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7376613">.</span><span class="ident" id="7376614">T</span><span class="op" id="7376615">)</span>&nbsp;<span class="op" id="7376617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376620">db</span>&nbsp;<span class="op" id="7376623">:=</span>&nbsp;<span class="ident" id="7376626"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7376635">(</span><span class="ident" id="7376636"><a href="/database/sql/sql_test.go.html#7376603">t</a></span><span class="op" id="7376637">,</span>&nbsp;<span class="string" id="7376639">&#34;people&#34;</span><span class="op" id="7376647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376650">defer</span>&nbsp;<span class="ident" id="7376656"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7376663">(</span><span class="ident" id="7376664"><a href="/database/sql/sql_test.go.html#7376603">t</a></span><span class="op" id="7376665">,</span>&nbsp;<span class="ident" id="7376667"><a href="/database/sql/sql_test.go.html#7376620">db</a></span><span class="op" id="7376669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376672">stmt</span><span class="op" id="7376676">,</span>&nbsp;<span class="ident" id="7376678">err</span>&nbsp;<span class="op" id="7376682">:=</span>&nbsp;<span class="ident" id="7376685"><a href="/database/sql/sql_test.go.html#7376620">db</a></span><span class="op" id="7376687">.</span><span class="ident" id="7376688">Prepare</span><span class="op" id="7376695">(</span><span class="string" id="7376696">&#34;SELECT|people|age|name=?&#34;</span><span class="op" id="7376722">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376725">if</span>&nbsp;<span class="ident" id="7376728"><a href="/database/sql/sql_test.go.html#7376678">err</a></span>&nbsp;<span class="op" id="7376732">!=</span>&nbsp;<span class="ident" id="7376735">nil</span>&nbsp;<span class="op" id="7376739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376743"><a href="/database/sql/sql_test.go.html#7376603">t</a></span><span class="op" id="7376744">.</span><span class="ident" id="7376745">Fatalf</span><span class="op" id="7376751">(</span><span class="string" id="7376752">&#34;Prepare:&nbsp;%v&#34;</span><span class="op" id="7376765">,</span>&nbsp;<span class="ident" id="7376767"><a href="/database/sql/sql_test.go.html#7376678">err</a></span><span class="op" id="7376770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376776"><a href="/database/sql/sql_test.go.html#7376678">err</a></span>&nbsp;<span class="op" id="7376780">=</span>&nbsp;<span class="ident" id="7376782"><a href="/database/sql/sql_test.go.html#7376672">stmt</a></span><span class="op" id="7376786">.</span><span class="ident" id="7376787">Close</span><span class="op" id="7376792">(</span><span class="op" id="7376793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376796">if</span>&nbsp;<span class="ident" id="7376799"><a href="/database/sql/sql_test.go.html#7376678">err</a></span>&nbsp;<span class="op" id="7376803">!=</span>&nbsp;<span class="ident" id="7376806">nil</span>&nbsp;<span class="op" id="7376810">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376814"><a href="/database/sql/sql_test.go.html#7376603">t</a></span><span class="op" id="7376815">.</span><span class="ident" id="7376816">Fatalf</span><span class="op" id="7376822">(</span><span class="string" id="7376823">&#34;Close:&nbsp;%v&#34;</span><span class="op" id="7376834">,</span>&nbsp;<span class="ident" id="7376836"><a href="/database/sql/sql_test.go.html#7376678">err</a></span><span class="op" id="7376839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376845">var</span>&nbsp;<span class="ident" id="7376849">name</span>&nbsp;<span class="builtintype" id="7376854">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376862"><a href="/database/sql/sql_test.go.html#7376678">err</a></span>&nbsp;<span class="op" id="7376866">=</span>&nbsp;<span class="ident" id="7376868"><a href="/database/sql/sql_test.go.html#7376672">stmt</a></span><span class="op" id="7376872">.</span><span class="ident" id="7376873">QueryRow</span><span class="op" id="7376881">(</span><span class="string" id="7376882">&#34;foo&#34;</span><span class="op" id="7376887">)</span><span class="op" id="7376888">.</span><span class="ident" id="7376889">Scan</span><span class="op" id="7376893">(</span><span class="op" id="7376894">&amp;</span><span class="ident" id="7376895"><a href="/database/sql/sql_test.go.html#7376849">name</a></span><span class="op" id="7376899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376902">if</span>&nbsp;<span class="ident" id="7376905"><a href="/database/sql/sql_test.go.html#7376678">err</a></span>&nbsp;<span class="op" id="7376909">==</span>&nbsp;<span class="ident" id="7376912">nil</span>&nbsp;<span class="op" id="7376916">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376920"><a href="/database/sql/sql_test.go.html#7376603">t</a></span><span class="op" id="7376921">.</span><span class="ident" id="7376922">Errorf</span><span class="op" id="7376928">(</span><span class="string" id="7376929">&#34;expected&nbsp;error&nbsp;from&nbsp;QueryRow.Scan&nbsp;after&nbsp;Stmt.Close&#34;</span><span class="op" id="7376981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376984">}</span><br>
<span class="lineno"></span><span class="op" id="7376986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7376989">func</span>&nbsp;<span class="ident" id="7376994">TestStatementQueryRow</span><span class="op" id="7377015">(</span><span class="ident" id="7377016">t</span>&nbsp;<span class="op" id="7377018">*</span><span class="ident" id="7377019"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7377026">.</span><span class="ident" id="7377027">T</span><span class="op" id="7377028">)</span>&nbsp;<span class="op" id="7377030">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377033">db</span>&nbsp;<span class="op" id="7377036">:=</span>&nbsp;<span class="ident" id="7377039"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7377048">(</span><span class="ident" id="7377049"><a href="/database/sql/sql_test.go.html#7377016">t</a></span><span class="op" id="7377050">,</span>&nbsp;<span class="string" id="7377052">&#34;people&#34;</span><span class="op" id="7377060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377063">defer</span>&nbsp;<span class="ident" id="7377069"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7377076">(</span><span class="ident" id="7377077"><a href="/database/sql/sql_test.go.html#7377016">t</a></span><span class="op" id="7377078">,</span>&nbsp;<span class="ident" id="7377080"><a href="/database/sql/sql_test.go.html#7377033">db</a></span><span class="op" id="7377082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377085">stmt</span><span class="op" id="7377089">,</span>&nbsp;<span class="ident" id="7377091">err</span>&nbsp;<span class="op" id="7377095">:=</span>&nbsp;<span class="ident" id="7377098"><a href="/database/sql/sql_test.go.html#7377033">db</a></span><span class="op" id="7377100">.</span><span class="ident" id="7377101">Prepare</span><span class="op" id="7377108">(</span><span class="string" id="7377109">&#34;SELECT|people|age|name=?&#34;</span><span class="op" id="7377135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377138">if</span>&nbsp;<span class="ident" id="7377141"><a href="/database/sql/sql_test.go.html#7377091">err</a></span>&nbsp;<span class="op" id="7377145">!=</span>&nbsp;<span class="ident" id="7377148">nil</span>&nbsp;<span class="op" id="7377152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377156"><a href="/database/sql/sql_test.go.html#7377016">t</a></span><span class="op" id="7377157">.</span><span class="ident" id="7377158">Fatalf</span><span class="op" id="7377164">(</span><span class="string" id="7377165">&#34;Prepare:&nbsp;%v&#34;</span><span class="op" id="7377178">,</span>&nbsp;<span class="ident" id="7377180"><a href="/database/sql/sql_test.go.html#7377091">err</a></span><span class="op" id="7377183">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377189">defer</span>&nbsp;<span class="ident" id="7377195"><a href="/database/sql/sql_test.go.html#7377085">stmt</a></span><span class="op" id="7377199">.</span><span class="ident" id="7377200">Close</span><span class="op" id="7377205">(</span><span class="op" id="7377206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377209">var</span>&nbsp;<span class="ident" id="7377213">age</span>&nbsp;<span class="builtintype" id="7377217">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377222">for</span>&nbsp;<span class="ident" id="7377226">n</span><span class="op" id="7377227">,</span>&nbsp;<span class="ident" id="7377229">tt</span>&nbsp;<span class="op" id="7377232">:=</span>&nbsp;<span class="keyword" id="7377235">range</span>&nbsp;<span class="op" id="7377241">[</span><span class="op" id="7377242">]</span><span class="keyword" id="7377243">struct</span>&nbsp;<span class="op" id="7377250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377254">name</span>&nbsp;<span class="builtintype" id="7377259">string</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377268">want</span>&nbsp;<span class="builtintype" id="7377273">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377278">}</span><span class="op" id="7377279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377283">{</span><span class="string" id="7377284">&#34;Alice&#34;</span><span class="op" id="7377291">,</span>&nbsp;<span class="num" id="7377293">1</span><span class="op" id="7377294">}</span><span class="op" id="7377295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377299">{</span><span class="string" id="7377300">&#34;Bob&#34;</span><span class="op" id="7377305">,</span>&nbsp;<span class="num" id="7377307">2</span><span class="op" id="7377308">}</span><span class="op" id="7377309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377313">{</span><span class="string" id="7377314">&#34;Chris&#34;</span><span class="op" id="7377321">,</span>&nbsp;<span class="num" id="7377323">3</span><span class="op" id="7377324">}</span><span class="op" id="7377325">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377328">}</span>&nbsp;<span class="op" id="7377330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377334">if</span>&nbsp;<span class="ident" id="7377337">err</span>&nbsp;<span class="op" id="7377341">:=</span>&nbsp;<span class="ident" id="7377344"><a href="/database/sql/sql_test.go.html#7377085">stmt</a></span><span class="op" id="7377348">.</span><span class="ident" id="7377349">QueryRow</span><span class="op" id="7377357">(</span><span class="ident" id="7377358"><a href="/database/sql/sql_test.go.html#7377229">tt</a></span><span class="op" id="7377360">.</span><span class="ident" id="7377361">name</span><span class="op" id="7377365">)</span><span class="op" id="7377366">.</span><span class="ident" id="7377367">Scan</span><span class="op" id="7377371">(</span><span class="op" id="7377372">&amp;</span><span class="ident" id="7377373"><a href="/database/sql/sql_test.go.html#7377213">age</a></span><span class="op" id="7377376">)</span><span class="op" id="7377377">;</span>&nbsp;<span class="ident" id="7377379"><a href="/database/sql/sql_test.go.html#7377337">err</a></span>&nbsp;<span class="op" id="7377383">!=</span>&nbsp;<span class="ident" id="7377386">nil</span>&nbsp;<span class="op" id="7377390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377395"><a href="/database/sql/sql_test.go.html#7377016">t</a></span><span class="op" id="7377396">.</span><span class="ident" id="7377397">Errorf</span><span class="op" id="7377403">(</span><span class="string" id="7377404">&#34;%d:&nbsp;on&nbsp;%q,&nbsp;QueryRow/Scan:&nbsp;%v&#34;</span><span class="op" id="7377434">,</span>&nbsp;<span class="ident" id="7377436"><a href="/database/sql/sql_test.go.html#7377226">n</a></span><span class="op" id="7377437">,</span>&nbsp;<span class="ident" id="7377439"><a href="/database/sql/sql_test.go.html#7377229">tt</a></span><span class="op" id="7377441">.</span><span class="ident" id="7377442">name</span><span class="op" id="7377446">,</span>&nbsp;<span class="ident" id="7377448"><a href="/database/sql/sql_test.go.html#7377337">err</a></span><span class="op" id="7377451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377455">}</span>&nbsp;<span class="keyword" id="7377457">else</span>&nbsp;<span class="keyword" id="7377462">if</span>&nbsp;<span class="ident" id="7377465"><a href="/database/sql/sql_test.go.html#7377213">age</a></span>&nbsp;<span class="op" id="7377469">!=</span>&nbsp;<span class="ident" id="7377472"><a href="/database/sql/sql_test.go.html#7377229">tt</a></span><span class="op" id="7377474">.</span><span class="ident" id="7377475">want</span>&nbsp;<span class="op" id="7377480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377485"><a href="/database/sql/sql_test.go.html#7377016">t</a></span><span class="op" id="7377486">.</span><span class="ident" id="7377487">Errorf</span><span class="op" id="7377493">(</span><span class="string" id="7377494">&#34;%d:&nbsp;age=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7377515">,</span>&nbsp;<span class="ident" id="7377517"><a href="/database/sql/sql_test.go.html#7377226">n</a></span><span class="op" id="7377518">,</span>&nbsp;<span class="ident" id="7377520"><a href="/database/sql/sql_test.go.html#7377213">age</a></span><span class="op" id="7377523">,</span>&nbsp;<span class="ident" id="7377525"><a href="/database/sql/sql_test.go.html#7377229">tt</a></span><span class="op" id="7377527">.</span><span class="ident" id="7377528">want</span><span class="op" id="7377532">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377539">}</span><br>
<span class="lineno"></span><span class="op" id="7377541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7377544">//&nbsp;golang.org/issue/3734</span><br>
<span class="lineno">360</span><span class="keyword" id="7377569">func</span>&nbsp;<span class="ident" id="7377574">TestStatementQueryRowConcurrent</span><span class="op" id="7377605">(</span><span class="ident" id="7377606">t</span>&nbsp;<span class="op" id="7377608">*</span><span class="ident" id="7377609"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7377616">.</span><span class="ident" id="7377617">T</span><span class="op" id="7377618">)</span>&nbsp;<span class="op" id="7377620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377623">db</span>&nbsp;<span class="op" id="7377626">:=</span>&nbsp;<span class="ident" id="7377629"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7377638">(</span><span class="ident" id="7377639"><a href="/database/sql/sql_test.go.html#7377606">t</a></span><span class="op" id="7377640">,</span>&nbsp;<span class="string" id="7377642">&#34;people&#34;</span><span class="op" id="7377650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377653">defer</span>&nbsp;<span class="ident" id="7377659"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7377666">(</span><span class="ident" id="7377667"><a href="/database/sql/sql_test.go.html#7377606">t</a></span><span class="op" id="7377668">,</span>&nbsp;<span class="ident" id="7377670"><a href="/database/sql/sql_test.go.html#7377623">db</a></span><span class="op" id="7377672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377675">stmt</span><span class="op" id="7377679">,</span>&nbsp;<span class="ident" id="7377681">err</span>&nbsp;<span class="op" id="7377685">:=</span>&nbsp;<span class="ident" id="7377688"><a href="/database/sql/sql_test.go.html#7377623">db</a></span><span class="op" id="7377690">.</span><span class="ident" id="7377691">Prepare</span><span class="op" id="7377698">(</span><span class="string" id="7377699">&#34;SELECT|people|age|name=?&#34;</span><span class="op" id="7377725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377728">if</span>&nbsp;<span class="ident" id="7377731"><a href="/database/sql/sql_test.go.html#7377681">err</a></span>&nbsp;<span class="op" id="7377735">!=</span>&nbsp;<span class="ident" id="7377738">nil</span>&nbsp;<span class="op" id="7377742">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377746"><a href="/database/sql/sql_test.go.html#7377606">t</a></span><span class="op" id="7377747">.</span><span class="ident" id="7377748">Fatalf</span><span class="op" id="7377754">(</span><span class="string" id="7377755">&#34;Prepare:&nbsp;%v&#34;</span><span class="op" id="7377768">,</span>&nbsp;<span class="ident" id="7377770"><a href="/database/sql/sql_test.go.html#7377681">err</a></span><span class="op" id="7377773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377779">defer</span>&nbsp;<span class="ident" id="7377785"><a href="/database/sql/sql_test.go.html#7377675">stmt</a></span><span class="op" id="7377789">.</span><span class="ident" id="7377790">Close</span><span class="op" id="7377795">(</span><span class="op" id="7377796">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377800">const</span>&nbsp;<span class="ident" id="7377806">n</span>&nbsp;<span class="op" id="7377808">=</span>&nbsp;<span class="num" id="7377810">10</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377814">ch</span>&nbsp;<span class="op" id="7377817">:=</span>&nbsp;<span class="builtinfunc" id="7377820">make</span><span class="op" id="7377824">(</span><span class="keyword" id="7377825">chan</span>&nbsp;<span class="builtintype" id="7377830">error</span><span class="op" id="7377835">,</span>&nbsp;<span class="ident" id="7377837"><a href="/database/sql/sql_test.go.html#7377806">n</a></span><span class="op" id="7377838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377841">for</span>&nbsp;<span class="ident" id="7377845">i</span>&nbsp;<span class="op" id="7377847">:=</span>&nbsp;<span class="num" id="7377850">0</span><span class="op" id="7377851">;</span>&nbsp;<span class="ident" id="7377853"><a href="/database/sql/sql_test.go.html#7377845">i</a></span>&nbsp;<span class="op" id="7377855">&lt;</span>&nbsp;<span class="ident" id="7377857"><a href="/database/sql/sql_test.go.html#7377806">n</a></span><span class="op" id="7377858">;</span>&nbsp;<span class="ident" id="7377860"><a href="/database/sql/sql_test.go.html#7377845">i</a></span><span class="op" id="7377861">++</span>&nbsp;<span class="op" id="7377864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377868">go</span>&nbsp;<span class="keyword" id="7377871">func</span><span class="op" id="7377875">(</span><span class="op" id="7377876">)</span>&nbsp;<span class="op" id="7377878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377883">var</span>&nbsp;<span class="ident" id="7377887">age</span>&nbsp;<span class="builtintype" id="7377891">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377898">err</span>&nbsp;<span class="op" id="7377902">:=</span>&nbsp;<span class="ident" id="7377905"><a href="/database/sql/sql_test.go.html#7377675">stmt</a></span><span class="op" id="7377909">.</span><span class="ident" id="7377910">QueryRow</span><span class="op" id="7377918">(</span><span class="string" id="7377919">&#34;Alice&#34;</span><span class="op" id="7377926">)</span><span class="op" id="7377927">.</span><span class="ident" id="7377928">Scan</span><span class="op" id="7377932">(</span><span class="op" id="7377933">&amp;</span><span class="ident" id="7377934"><a href="/database/sql/sql_test.go.html#7377887">age</a></span><span class="op" id="7377937">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377942">if</span>&nbsp;<span class="ident" id="7377945"><a href="/database/sql/sql_test.go.html#7377898">err</a></span>&nbsp;<span class="op" id="7377949">==</span>&nbsp;<span class="ident" id="7377952">nil</span>&nbsp;<span class="op" id="7377956">&amp;&amp;</span>&nbsp;<span class="ident" id="7377959"><a href="/database/sql/sql_test.go.html#7377887">age</a></span>&nbsp;<span class="op" id="7377963">!=</span>&nbsp;<span class="num" id="7377966">1</span>&nbsp;<span class="op" id="7377968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377974"><a href="/database/sql/sql_test.go.html#7377898">err</a></span>&nbsp;<span class="op" id="7377978">=</span>&nbsp;<span class="ident" id="7377980"><a href="/database/sql/sql_test.go.html#7368931">fmt</a></span><span class="op" id="7377983">.</span><span class="ident" id="7377984">Errorf</span><span class="op" id="7377990">(</span><span class="string" id="7377991">&#34;unexpected&nbsp;age&nbsp;%d&#34;</span><span class="op" id="7378010">,</span>&nbsp;<span class="ident" id="7378012"><a href="/database/sql/sql_test.go.html#7377887">age</a></span><span class="op" id="7378015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378025"><a href="/database/sql/sql_test.go.html#7377814">ch</a></span>&nbsp;<span class="op" id="7378028">&lt;-</span>&nbsp;<span class="ident" id="7378031"><a href="/database/sql/sql_test.go.html#7377898">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378037">}</span><span class="op" id="7378038">(</span><span class="op" id="7378039">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7378045">for</span>&nbsp;<span class="ident" id="7378049">i</span>&nbsp;<span class="op" id="7378051">:=</span>&nbsp;<span class="num" id="7378054">0</span><span class="op" id="7378055">;</span>&nbsp;<span class="ident" id="7378057"><a href="/database/sql/sql_test.go.html#7378049">i</a></span>&nbsp;<span class="op" id="7378059">&lt;</span>&nbsp;<span class="ident" id="7378061"><a href="/database/sql/sql_test.go.html#7377806">n</a></span><span class="op" id="7378062">;</span>&nbsp;<span class="ident" id="7378064"><a href="/database/sql/sql_test.go.html#7378049">i</a></span><span class="op" id="7378065">++</span>&nbsp;<span class="op" id="7378068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7378072">if</span>&nbsp;<span class="ident" id="7378075">err</span>&nbsp;<span class="op" id="7378079">:=</span>&nbsp;<span class="op" id="7378082">&lt;-</span><span class="ident" id="7378084"><a href="/database/sql/sql_test.go.html#7377814">ch</a></span><span class="op" id="7378086">;</span>&nbsp;<span class="ident" id="7378088"><a href="/database/sql/sql_test.go.html#7378075">err</a></span>&nbsp;<span class="op" id="7378092">!=</span>&nbsp;<span class="ident" id="7378095">nil</span>&nbsp;<span class="op" id="7378099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378104"><a href="/database/sql/sql_test.go.html#7377606">t</a></span><span class="op" id="7378105">.</span><span class="ident" id="7378106">Error</span><span class="op" id="7378111">(</span><span class="ident" id="7378112"><a href="/database/sql/sql_test.go.html#7378075">err</a></span><span class="op" id="7378115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378119">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378122">}</span><br>
<span class="lineno"></span><span class="op" id="7378124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7378127">//&nbsp;just&nbsp;a&nbsp;test&nbsp;of&nbsp;fakedb&nbsp;itself</span><br>
<span class="lineno"></span><span class="keyword" id="7378159">func</span>&nbsp;<span class="ident" id="7378164">TestBogusPreboundParameters</span><span class="op" id="7378191">(</span><span class="ident" id="7378192">t</span>&nbsp;<span class="op" id="7378194">*</span><span class="ident" id="7378195"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7378202">.</span><span class="ident" id="7378203">T</span><span class="op" id="7378204">)</span>&nbsp;<span class="op" id="7378206">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378209">db</span>&nbsp;<span class="op" id="7378212">:=</span>&nbsp;<span class="ident" id="7378215"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7378224">(</span><span class="ident" id="7378225"><a href="/database/sql/sql_test.go.html#7378192">t</a></span><span class="op" id="7378226">,</span>&nbsp;<span class="string" id="7378228">&#34;foo&#34;</span><span class="op" id="7378233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7378236">defer</span>&nbsp;<span class="ident" id="7378242"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7378249">(</span><span class="ident" id="7378250"><a href="/database/sql/sql_test.go.html#7378192">t</a></span><span class="op" id="7378251">,</span>&nbsp;<span class="ident" id="7378253"><a href="/database/sql/sql_test.go.html#7378209">db</a></span><span class="op" id="7378255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378258"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7378262">(</span><span class="ident" id="7378263"><a href="/database/sql/sql_test.go.html#7378192">t</a></span><span class="op" id="7378264">,</span>&nbsp;<span class="ident" id="7378266"><a href="/database/sql/sql_test.go.html#7378209">db</a></span><span class="op" id="7378268">,</span>&nbsp;<span class="string" id="7378270">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7378313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378316">_</span><span class="op" id="7378317">,</span>&nbsp;<span class="ident" id="7378319">err</span>&nbsp;<span class="op" id="7378323">:=</span>&nbsp;<span class="ident" id="7378326"><a href="/database/sql/sql_test.go.html#7378209">db</a></span><span class="op" id="7378328">.</span><span class="ident" id="7378329">Prepare</span><span class="op" id="7378336">(</span><span class="string" id="7378337">&#34;INSERT|t1|name=?,age=bogusconversion&#34;</span><span class="op" id="7378375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7378378">if</span>&nbsp;<span class="ident" id="7378381"><a href="/database/sql/sql_test.go.html#7378319">err</a></span>&nbsp;<span class="op" id="7378385">==</span>&nbsp;<span class="ident" id="7378388">nil</span>&nbsp;<span class="op" id="7378392">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378396"><a href="/database/sql/sql_test.go.html#7378192">t</a></span><span class="op" id="7378397">.</span><span class="ident" id="7378398">Fatalf</span><span class="op" id="7378404">(</span><span class="string" id="7378405">&#34;expected&nbsp;error&#34;</span><span class="op" id="7378421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7378427">if</span>&nbsp;<span class="ident" id="7378430"><a href="/database/sql/sql_test.go.html#7378319">err</a></span><span class="op" id="7378433">.</span><span class="ident" id="7378434">Error</span><span class="op" id="7378439">(</span><span class="op" id="7378440">)</span>&nbsp;<span class="op" id="7378442">!=</span>&nbsp;<span class="string" id="7378445">`fakedb:&nbsp;invalid&nbsp;conversion&nbsp;to&nbsp;int32&nbsp;from&nbsp;&#34;bogusconversion&#34;`</span>&nbsp;<span class="op" id="7378506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378510"><a href="/database/sql/sql_test.go.html#7378192">t</a></span><span class="op" id="7378511">.</span><span class="ident" id="7378512">Errorf</span><span class="op" id="7378518">(</span><span class="string" id="7378519">&#34;unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7378541">,</span>&nbsp;<span class="ident" id="7378543"><a href="/database/sql/sql_test.go.html#7378319">err</a></span><span class="op" id="7378546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378549">}</span><br>
<span class="lineno">400</span><span class="op" id="7378551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7378554">func</span>&nbsp;<span class="ident" id="7378559">TestExec</span><span class="op" id="7378567">(</span><span class="ident" id="7378568">t</span>&nbsp;<span class="op" id="7378570">*</span><span class="ident" id="7378571"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7378578">.</span><span class="ident" id="7378579">T</span><span class="op" id="7378580">)</span>&nbsp;<span class="op" id="7378582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378585">db</span>&nbsp;<span class="op" id="7378588">:=</span>&nbsp;<span class="ident" id="7378591"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7378600">(</span><span class="ident" id="7378601"><a href="/database/sql/sql_test.go.html#7378568">t</a></span><span class="op" id="7378602">,</span>&nbsp;<span class="string" id="7378604">&#34;foo&#34;</span><span class="op" id="7378609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7378612">defer</span>&nbsp;<span class="ident" id="7378618"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7378625">(</span><span class="ident" id="7378626"><a href="/database/sql/sql_test.go.html#7378568">t</a></span><span class="op" id="7378627">,</span>&nbsp;<span class="ident" id="7378629"><a href="/database/sql/sql_test.go.html#7378585">db</a></span><span class="op" id="7378631">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378634"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7378638">(</span><span class="ident" id="7378639"><a href="/database/sql/sql_test.go.html#7378568">t</a></span><span class="op" id="7378640">,</span>&nbsp;<span class="ident" id="7378642"><a href="/database/sql/sql_test.go.html#7378585">db</a></span><span class="op" id="7378644">,</span>&nbsp;<span class="string" id="7378646">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7378689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378692">stmt</span><span class="op" id="7378696">,</span>&nbsp;<span class="ident" id="7378698">err</span>&nbsp;<span class="op" id="7378702">:=</span>&nbsp;<span class="ident" id="7378705"><a href="/database/sql/sql_test.go.html#7378585">db</a></span><span class="op" id="7378707">.</span><span class="ident" id="7378708">Prepare</span><span class="op" id="7378715">(</span><span class="string" id="7378716">&#34;INSERT|t1|name=?,age=?&#34;</span><span class="op" id="7378740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7378743">if</span>&nbsp;<span class="ident" id="7378746"><a href="/database/sql/sql_test.go.html#7378698">err</a></span>&nbsp;<span class="op" id="7378750">!=</span>&nbsp;<span class="ident" id="7378753">nil</span>&nbsp;<span class="op" id="7378757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378761"><a href="/database/sql/sql_test.go.html#7378568">t</a></span><span class="op" id="7378762">.</span><span class="ident" id="7378763">Errorf</span><span class="op" id="7378769">(</span><span class="string" id="7378770">&#34;Stmt,&nbsp;err&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7378790">,</span>&nbsp;<span class="ident" id="7378792"><a href="/database/sql/sql_test.go.html#7378692">stmt</a></span><span class="op" id="7378796">,</span>&nbsp;<span class="ident" id="7378798"><a href="/database/sql/sql_test.go.html#7378698">err</a></span><span class="op" id="7378801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378804">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7378807">defer</span>&nbsp;<span class="ident" id="7378813"><a href="/database/sql/sql_test.go.html#7378692">stmt</a></span><span class="op" id="7378817">.</span><span class="ident" id="7378818">Close</span><span class="op" id="7378823">(</span><span class="op" id="7378824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7378828">type</span>&nbsp;<span class="ident" id="7378833">execTest</span>&nbsp;<span class="keyword" id="7378842">struct</span>&nbsp;<span class="op" id="7378849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378853">args</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7378861">[</span><span class="op" id="7378862">]</span><span class="keyword" id="7378863">interface</span><span class="op" id="7378872">{</span><span class="op" id="7378873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378877">wantErr</span>&nbsp;<span class="builtintype" id="7378885">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378896">execTests</span>&nbsp;<span class="op" id="7378906">:=</span>&nbsp;<span class="op" id="7378909">[</span><span class="op" id="7378910">]</span><span class="ident" id="7378911"><a href="/database/sql/sql_test.go.html#7378833">execTest</a></span><span class="op" id="7378919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7378923">//&nbsp;Okay:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378934">{</span><span class="op" id="7378935">[</span><span class="op" id="7378936">]</span><span class="keyword" id="7378937">interface</span><span class="op" id="7378946">{</span><span class="op" id="7378947">}</span><span class="op" id="7378948">{</span><span class="string" id="7378949">&#34;Brad&#34;</span><span class="op" id="7378955">,</span>&nbsp;<span class="num" id="7378957">31</span><span class="op" id="7378959">}</span><span class="op" id="7378960">,</span>&nbsp;<span class="string" id="7378962">&#34;&#34;</span><span class="op" id="7378964">}</span><span class="op" id="7378965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378969">{</span><span class="op" id="7378970">[</span><span class="op" id="7378971">]</span><span class="keyword" id="7378972">interface</span><span class="op" id="7378981">{</span><span class="op" id="7378982">}</span><span class="op" id="7378983">{</span><span class="string" id="7378984">&#34;Brad&#34;</span><span class="op" id="7378990">,</span>&nbsp;<span class="ident" id="7378992">int64</span><span class="op" id="7378997">(</span><span class="num" id="7378998">31</span><span class="op" id="7379000">)</span><span class="op" id="7379001">}</span><span class="op" id="7379002">,</span>&nbsp;<span class="string" id="7379004">&#34;&#34;</span><span class="op" id="7379006">}</span><span class="op" id="7379007">,</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7379011">{</span><span class="op" id="7379012">[</span><span class="op" id="7379013">]</span><span class="keyword" id="7379014">interface</span><span class="op" id="7379023">{</span><span class="op" id="7379024">}</span><span class="op" id="7379025">{</span><span class="string" id="7379026">&#34;Bob&#34;</span><span class="op" id="7379031">,</span>&nbsp;<span class="string" id="7379033">&#34;32&#34;</span><span class="op" id="7379037">}</span><span class="op" id="7379038">,</span>&nbsp;<span class="string" id="7379040">&#34;&#34;</span><span class="op" id="7379042">}</span><span class="op" id="7379043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7379047">{</span><span class="op" id="7379048">[</span><span class="op" id="7379049">]</span><span class="keyword" id="7379050">interface</span><span class="op" id="7379059">{</span><span class="op" id="7379060">}</span><span class="op" id="7379061">{</span><span class="num" id="7379062">7</span><span class="op" id="7379063">,</span>&nbsp;<span class="num" id="7379065">9</span><span class="op" id="7379066">}</span><span class="op" id="7379067">,</span>&nbsp;<span class="string" id="7379069">&#34;&#34;</span><span class="op" id="7379071">}</span><span class="op" id="7379072">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7379077">//&nbsp;Invalid&nbsp;conversions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7379103">{</span><span class="op" id="7379104">[</span><span class="op" id="7379105">]</span><span class="keyword" id="7379106">interface</span><span class="op" id="7379115">{</span><span class="op" id="7379116">}</span><span class="op" id="7379117">{</span><span class="string" id="7379118">&#34;Brad&#34;</span><span class="op" id="7379124">,</span>&nbsp;<span class="ident" id="7379126">int64</span><span class="op" id="7379131">(</span><span class="num" id="7379132">0xFFFFFFFF</span><span class="op" id="7379142">)</span><span class="op" id="7379143">}</span><span class="op" id="7379144">,</span>&nbsp;<span class="string" id="7379146">&#34;sql:&nbsp;converting&nbsp;argument&nbsp;#1&#39;s&nbsp;type:&nbsp;sql/driver:&nbsp;value&nbsp;4294967295&nbsp;overflows&nbsp;int32&#34;</span><span class="op" id="7379228">}</span><span class="op" id="7379229">,</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7379233">{</span><span class="op" id="7379234">[</span><span class="op" id="7379235">]</span><span class="keyword" id="7379236">interface</span><span class="op" id="7379245">{</span><span class="op" id="7379246">}</span><span class="op" id="7379247">{</span><span class="string" id="7379248">&#34;Brad&#34;</span><span class="op" id="7379254">,</span>&nbsp;<span class="string" id="7379256">&#34;strconv&nbsp;fail&#34;</span><span class="op" id="7379270">}</span><span class="op" id="7379271">,</span>&nbsp;<span class="string" id="7379273">&#34;sql:&nbsp;converting&nbsp;argument&nbsp;#1&#39;s&nbsp;type:&nbsp;sql/driver:&nbsp;value&nbsp;\&#34;strconv&nbsp;fail\&#34;&nbsp;can&#39;t&nbsp;be&nbsp;converted&nbsp;to&nbsp;int32&#34;</span><span class="op" id="7379373">}</span><span class="op" id="7379374">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7379379">//&nbsp;Wrong&nbsp;number&nbsp;of&nbsp;args:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7379406">{</span><span class="op" id="7379407">[</span><span class="op" id="7379408">]</span><span class="keyword" id="7379409">interface</span><span class="op" id="7379418">{</span><span class="op" id="7379419">}</span><span class="op" id="7379420">{</span><span class="op" id="7379421">}</span><span class="op" id="7379422">,</span>&nbsp;<span class="string" id="7379424">&#34;sql:&nbsp;expected&nbsp;2&nbsp;arguments,&nbsp;got&nbsp;0&#34;</span><span class="op" id="7379458">}</span><span class="op" id="7379459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7379463">{</span><span class="op" id="7379464">[</span><span class="op" id="7379465">]</span><span class="keyword" id="7379466">interface</span><span class="op" id="7379475">{</span><span class="op" id="7379476">}</span><span class="op" id="7379477">{</span><span class="num" id="7379478">1</span><span class="op" id="7379479">,</span>&nbsp;<span class="num" id="7379481">2</span><span class="op" id="7379482">,</span>&nbsp;<span class="num" id="7379484">3</span><span class="op" id="7379485">}</span><span class="op" id="7379486">,</span>&nbsp;<span class="string" id="7379488">&#34;sql:&nbsp;expected&nbsp;2&nbsp;arguments,&nbsp;got&nbsp;3&#34;</span><span class="op" id="7379522">}</span><span class="op" id="7379523">,</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7379526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7379529">for</span>&nbsp;<span class="ident" id="7379533">n</span><span class="op" id="7379534">,</span>&nbsp;<span class="ident" id="7379536">et</span>&nbsp;<span class="op" id="7379539">:=</span>&nbsp;<span class="keyword" id="7379542">range</span>&nbsp;<span class="ident" id="7379548"><a href="/database/sql/sql_test.go.html#7378896">execTests</a></span>&nbsp;<span class="op" id="7379558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379562">_</span><span class="op" id="7379563">,</span>&nbsp;<span class="ident" id="7379565">err</span>&nbsp;<span class="op" id="7379569">:=</span>&nbsp;<span class="ident" id="7379572"><a href="/database/sql/sql_test.go.html#7378692">stmt</a></span><span class="op" id="7379576">.</span><span class="ident" id="7379577">Exec</span><span class="op" id="7379581">(</span><span class="ident" id="7379582"><a href="/database/sql/sql_test.go.html#7379536">et</a></span><span class="op" id="7379584">.</span><span class="ident" id="7379585">args</span><span class="op" id="7379589">...</span><span class="op" id="7379592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379596">errStr</span>&nbsp;<span class="op" id="7379603">:=</span>&nbsp;<span class="string" id="7379606">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7379611">if</span>&nbsp;<span class="ident" id="7379614"><a href="/database/sql/sql_test.go.html#7379565">err</a></span>&nbsp;<span class="op" id="7379618">!=</span>&nbsp;<span class="ident" id="7379621">nil</span>&nbsp;<span class="op" id="7379625">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379630"><a href="/database/sql/sql_test.go.html#7379596">errStr</a></span>&nbsp;<span class="op" id="7379637">=</span>&nbsp;<span class="ident" id="7379639"><a href="/database/sql/sql_test.go.html#7379565">err</a></span><span class="op" id="7379642">.</span><span class="ident" id="7379643">Error</span><span class="op" id="7379648">(</span><span class="op" id="7379649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7379653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7379657">if</span>&nbsp;<span class="ident" id="7379660"><a href="/database/sql/sql_test.go.html#7379596">errStr</a></span>&nbsp;<span class="op" id="7379667">!=</span>&nbsp;<span class="ident" id="7379670"><a href="/database/sql/sql_test.go.html#7379536">et</a></span><span class="op" id="7379672">.</span><span class="ident" id="7379673">wantErr</span>&nbsp;<span class="op" id="7379681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379686"><a href="/database/sql/sql_test.go.html#7378568">t</a></span><span class="op" id="7379687">.</span><span class="ident" id="7379688">Errorf</span><span class="op" id="7379694">(</span><span class="string" id="7379695">&#34;stmt.Execute&nbsp;#%d:&nbsp;for&nbsp;%v,&nbsp;got&nbsp;error&nbsp;%q,&nbsp;want&nbsp;error&nbsp;%q&#34;</span><span class="op" id="7379750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379756"><a href="/database/sql/sql_test.go.html#7379533">n</a></span><span class="op" id="7379757">,</span>&nbsp;<span class="ident" id="7379759"><a href="/database/sql/sql_test.go.html#7379536">et</a></span><span class="op" id="7379761">.</span><span class="ident" id="7379762">args</span><span class="op" id="7379766">,</span>&nbsp;<span class="ident" id="7379768"><a href="/database/sql/sql_test.go.html#7379596">errStr</a></span><span class="op" id="7379774">,</span>&nbsp;<span class="ident" id="7379776"><a href="/database/sql/sql_test.go.html#7379536">et</a></span><span class="op" id="7379778">.</span><span class="ident" id="7379779">wantErr</span><span class="op" id="7379786">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7379790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7379793">}</span><br>
<span class="lineno"></span><span class="op" id="7379795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7379798">func</span>&nbsp;<span class="ident" id="7379803">TestTxPrepare</span><span class="op" id="7379816">(</span><span class="ident" id="7379817">t</span>&nbsp;<span class="op" id="7379819">*</span><span class="ident" id="7379820"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7379827">.</span><span class="ident" id="7379828">T</span><span class="op" id="7379829">)</span>&nbsp;<span class="op" id="7379831">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379834">db</span>&nbsp;<span class="op" id="7379837">:=</span>&nbsp;<span class="ident" id="7379840"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7379849">(</span><span class="ident" id="7379850"><a href="/database/sql/sql_test.go.html#7379817">t</a></span><span class="op" id="7379851">,</span>&nbsp;<span class="string" id="7379853">&#34;&#34;</span><span class="op" id="7379855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7379858">defer</span>&nbsp;<span class="ident" id="7379864"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7379871">(</span><span class="ident" id="7379872"><a href="/database/sql/sql_test.go.html#7379817">t</a></span><span class="op" id="7379873">,</span>&nbsp;<span class="ident" id="7379875"><a href="/database/sql/sql_test.go.html#7379834">db</a></span><span class="op" id="7379877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379880"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7379884">(</span><span class="ident" id="7379885"><a href="/database/sql/sql_test.go.html#7379817">t</a></span><span class="op" id="7379886">,</span>&nbsp;<span class="ident" id="7379888"><a href="/database/sql/sql_test.go.html#7379834">db</a></span><span class="op" id="7379890">,</span>&nbsp;<span class="string" id="7379892">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7379935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379938">tx</span><span class="op" id="7379940">,</span>&nbsp;<span class="ident" id="7379942">err</span>&nbsp;<span class="op" id="7379946">:=</span>&nbsp;<span class="ident" id="7379949"><a href="/database/sql/sql_test.go.html#7379834">db</a></span><span class="op" id="7379951">.</span><span class="ident" id="7379952">Begin</span><span class="op" id="7379957">(</span><span class="op" id="7379958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7379961">if</span>&nbsp;<span class="ident" id="7379964"><a href="/database/sql/sql_test.go.html#7379942">err</a></span>&nbsp;<span class="op" id="7379968">!=</span>&nbsp;<span class="ident" id="7379971">nil</span>&nbsp;<span class="op" id="7379975">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379979"><a href="/database/sql/sql_test.go.html#7379817">t</a></span><span class="op" id="7379980">.</span><span class="ident" id="7379981">Fatalf</span><span class="op" id="7379987">(</span><span class="string" id="7379988">&#34;Begin&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7380000">,</span>&nbsp;<span class="ident" id="7380002"><a href="/database/sql/sql_test.go.html#7379942">err</a></span><span class="op" id="7380005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380011">stmt</span><span class="op" id="7380015">,</span>&nbsp;<span class="ident" id="7380017"><a href="/database/sql/sql_test.go.html#7379942">err</a></span>&nbsp;<span class="op" id="7380021">:=</span>&nbsp;<span class="ident" id="7380024"><a href="/database/sql/sql_test.go.html#7379938">tx</a></span><span class="op" id="7380026">.</span><span class="ident" id="7380027">Prepare</span><span class="op" id="7380034">(</span><span class="string" id="7380035">&#34;INSERT|t1|name=?,age=?&#34;</span><span class="op" id="7380059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380062">if</span>&nbsp;<span class="ident" id="7380065"><a href="/database/sql/sql_test.go.html#7379942">err</a></span>&nbsp;<span class="op" id="7380069">!=</span>&nbsp;<span class="ident" id="7380072">nil</span>&nbsp;<span class="op" id="7380076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380080"><a href="/database/sql/sql_test.go.html#7379817">t</a></span><span class="op" id="7380081">.</span><span class="ident" id="7380082">Fatalf</span><span class="op" id="7380088">(</span><span class="string" id="7380089">&#34;Stmt,&nbsp;err&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7380109">,</span>&nbsp;<span class="ident" id="7380111"><a href="/database/sql/sql_test.go.html#7380011">stmt</a></span><span class="op" id="7380115">,</span>&nbsp;<span class="ident" id="7380117"><a href="/database/sql/sql_test.go.html#7379942">err</a></span><span class="op" id="7380120">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380126">defer</span>&nbsp;<span class="ident" id="7380132"><a href="/database/sql/sql_test.go.html#7380011">stmt</a></span><span class="op" id="7380136">.</span><span class="ident" id="7380137">Close</span><span class="op" id="7380142">(</span><span class="op" id="7380143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380146">_</span><span class="op" id="7380147">,</span>&nbsp;<span class="ident" id="7380149"><a href="/database/sql/sql_test.go.html#7379942">err</a></span>&nbsp;<span class="op" id="7380153">=</span>&nbsp;<span class="ident" id="7380155"><a href="/database/sql/sql_test.go.html#7380011">stmt</a></span><span class="op" id="7380159">.</span><span class="ident" id="7380160">Exec</span><span class="op" id="7380164">(</span><span class="string" id="7380165">&#34;Bobby&#34;</span><span class="op" id="7380172">,</span>&nbsp;<span class="num" id="7380174">7</span><span class="op" id="7380175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380178">if</span>&nbsp;<span class="ident" id="7380181"><a href="/database/sql/sql_test.go.html#7379942">err</a></span>&nbsp;<span class="op" id="7380185">!=</span>&nbsp;<span class="ident" id="7380188">nil</span>&nbsp;<span class="op" id="7380192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380196"><a href="/database/sql/sql_test.go.html#7379817">t</a></span><span class="op" id="7380197">.</span><span class="ident" id="7380198">Fatalf</span><span class="op" id="7380204">(</span><span class="string" id="7380205">&#34;Exec&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7380216">,</span>&nbsp;<span class="ident" id="7380218"><a href="/database/sql/sql_test.go.html#7379942">err</a></span><span class="op" id="7380221">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380227"><a href="/database/sql/sql_test.go.html#7379942">err</a></span>&nbsp;<span class="op" id="7380231">=</span>&nbsp;<span class="ident" id="7380233"><a href="/database/sql/sql_test.go.html#7379938">tx</a></span><span class="op" id="7380235">.</span><span class="ident" id="7380236">Commit</span><span class="op" id="7380242">(</span><span class="op" id="7380243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380246">if</span>&nbsp;<span class="ident" id="7380249"><a href="/database/sql/sql_test.go.html#7379942">err</a></span>&nbsp;<span class="op" id="7380253">!=</span>&nbsp;<span class="ident" id="7380256">nil</span>&nbsp;<span class="op" id="7380260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380264"><a href="/database/sql/sql_test.go.html#7379817">t</a></span><span class="op" id="7380265">.</span><span class="ident" id="7380266">Fatalf</span><span class="op" id="7380272">(</span><span class="string" id="7380273">&#34;Commit&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7380286">,</span>&nbsp;<span class="ident" id="7380288"><a href="/database/sql/sql_test.go.html#7379942">err</a></span><span class="op" id="7380291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380294">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7380297">//&nbsp;Commit()&nbsp;should&nbsp;have&nbsp;closed&nbsp;the&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380343">if</span>&nbsp;<span class="op" id="7380346">!</span><span class="ident" id="7380347"><a href="/database/sql/sql_test.go.html#7380011">stmt</a></span><span class="op" id="7380351">.</span><span class="ident" id="7380352">closed</span>&nbsp;<span class="op" id="7380359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380363"><a href="/database/sql/sql_test.go.html#7379817">t</a></span><span class="op" id="7380364">.</span><span class="ident" id="7380365">Fatal</span><span class="op" id="7380370">(</span><span class="string" id="7380371">&#34;Stmt&nbsp;not&nbsp;closed&nbsp;after&nbsp;Commit&#34;</span><span class="op" id="7380401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380404">}</span><br>
<span class="lineno"></span><span class="op" id="7380406">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="7380409">func</span>&nbsp;<span class="ident" id="7380414">TestTxStmt</span><span class="op" id="7380424">(</span><span class="ident" id="7380425">t</span>&nbsp;<span class="op" id="7380427">*</span><span class="ident" id="7380428"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7380435">.</span><span class="ident" id="7380436">T</span><span class="op" id="7380437">)</span>&nbsp;<span class="op" id="7380439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380442">db</span>&nbsp;<span class="op" id="7380445">:=</span>&nbsp;<span class="ident" id="7380448"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7380457">(</span><span class="ident" id="7380458"><a href="/database/sql/sql_test.go.html#7380425">t</a></span><span class="op" id="7380459">,</span>&nbsp;<span class="string" id="7380461">&#34;&#34;</span><span class="op" id="7380463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380466">defer</span>&nbsp;<span class="ident" id="7380472"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7380479">(</span><span class="ident" id="7380480"><a href="/database/sql/sql_test.go.html#7380425">t</a></span><span class="op" id="7380481">,</span>&nbsp;<span class="ident" id="7380483"><a href="/database/sql/sql_test.go.html#7380442">db</a></span><span class="op" id="7380485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380488"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7380492">(</span><span class="ident" id="7380493"><a href="/database/sql/sql_test.go.html#7380425">t</a></span><span class="op" id="7380494">,</span>&nbsp;<span class="ident" id="7380496"><a href="/database/sql/sql_test.go.html#7380442">db</a></span><span class="op" id="7380498">,</span>&nbsp;<span class="string" id="7380500">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7380543">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380546">stmt</span><span class="op" id="7380550">,</span>&nbsp;<span class="ident" id="7380552">err</span>&nbsp;<span class="op" id="7380556">:=</span>&nbsp;<span class="ident" id="7380559"><a href="/database/sql/sql_test.go.html#7380442">db</a></span><span class="op" id="7380561">.</span><span class="ident" id="7380562">Prepare</span><span class="op" id="7380569">(</span><span class="string" id="7380570">&#34;INSERT|t1|name=?,age=?&#34;</span><span class="op" id="7380594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380597">if</span>&nbsp;<span class="ident" id="7380600"><a href="/database/sql/sql_test.go.html#7380552">err</a></span>&nbsp;<span class="op" id="7380604">!=</span>&nbsp;<span class="ident" id="7380607">nil</span>&nbsp;<span class="op" id="7380611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380615"><a href="/database/sql/sql_test.go.html#7380425">t</a></span><span class="op" id="7380616">.</span><span class="ident" id="7380617">Fatalf</span><span class="op" id="7380623">(</span><span class="string" id="7380624">&#34;Stmt,&nbsp;err&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7380644">,</span>&nbsp;<span class="ident" id="7380646"><a href="/database/sql/sql_test.go.html#7380546">stmt</a></span><span class="op" id="7380650">,</span>&nbsp;<span class="ident" id="7380652"><a href="/database/sql/sql_test.go.html#7380552">err</a></span><span class="op" id="7380655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380661">defer</span>&nbsp;<span class="ident" id="7380667"><a href="/database/sql/sql_test.go.html#7380546">stmt</a></span><span class="op" id="7380671">.</span><span class="ident" id="7380672">Close</span><span class="op" id="7380677">(</span><span class="op" id="7380678">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380681">tx</span><span class="op" id="7380683">,</span>&nbsp;<span class="ident" id="7380685"><a href="/database/sql/sql_test.go.html#7380552">err</a></span>&nbsp;<span class="op" id="7380689">:=</span>&nbsp;<span class="ident" id="7380692"><a href="/database/sql/sql_test.go.html#7380442">db</a></span><span class="op" id="7380694">.</span><span class="ident" id="7380695">Begin</span><span class="op" id="7380700">(</span><span class="op" id="7380701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380704">if</span>&nbsp;<span class="ident" id="7380707"><a href="/database/sql/sql_test.go.html#7380552">err</a></span>&nbsp;<span class="op" id="7380711">!=</span>&nbsp;<span class="ident" id="7380714">nil</span>&nbsp;<span class="op" id="7380718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380722"><a href="/database/sql/sql_test.go.html#7380425">t</a></span><span class="op" id="7380723">.</span><span class="ident" id="7380724">Fatalf</span><span class="op" id="7380730">(</span><span class="string" id="7380731">&#34;Begin&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7380743">,</span>&nbsp;<span class="ident" id="7380745"><a href="/database/sql/sql_test.go.html#7380552">err</a></span><span class="op" id="7380748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380754">txs</span>&nbsp;<span class="op" id="7380758">:=</span>&nbsp;<span class="ident" id="7380761"><a href="/database/sql/sql_test.go.html#7380681">tx</a></span><span class="op" id="7380763">.</span><span class="ident" id="7380764">Stmt</span><span class="op" id="7380768">(</span><span class="ident" id="7380769"><a href="/database/sql/sql_test.go.html#7380546">stmt</a></span><span class="op" id="7380773">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380776">defer</span>&nbsp;<span class="ident" id="7380782"><a href="/database/sql/sql_test.go.html#7380754">txs</a></span><span class="op" id="7380785">.</span><span class="ident" id="7380786">Close</span><span class="op" id="7380791">(</span><span class="op" id="7380792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380795">_</span><span class="op" id="7380796">,</span>&nbsp;<span class="ident" id="7380798"><a href="/database/sql/sql_test.go.html#7380552">err</a></span>&nbsp;<span class="op" id="7380802">=</span>&nbsp;<span class="ident" id="7380804"><a href="/database/sql/sql_test.go.html#7380754">txs</a></span><span class="op" id="7380807">.</span><span class="ident" id="7380808">Exec</span><span class="op" id="7380812">(</span><span class="string" id="7380813">&#34;Bobby&#34;</span><span class="op" id="7380820">,</span>&nbsp;<span class="num" id="7380822">7</span><span class="op" id="7380823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380826">if</span>&nbsp;<span class="ident" id="7380829"><a href="/database/sql/sql_test.go.html#7380552">err</a></span>&nbsp;<span class="op" id="7380833">!=</span>&nbsp;<span class="ident" id="7380836">nil</span>&nbsp;<span class="op" id="7380840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380844"><a href="/database/sql/sql_test.go.html#7380425">t</a></span><span class="op" id="7380845">.</span><span class="ident" id="7380846">Fatalf</span><span class="op" id="7380852">(</span><span class="string" id="7380853">&#34;Exec&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7380864">,</span>&nbsp;<span class="ident" id="7380866"><a href="/database/sql/sql_test.go.html#7380552">err</a></span><span class="op" id="7380869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380872">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380875"><a href="/database/sql/sql_test.go.html#7380552">err</a></span>&nbsp;<span class="op" id="7380879">=</span>&nbsp;<span class="ident" id="7380881"><a href="/database/sql/sql_test.go.html#7380681">tx</a></span><span class="op" id="7380883">.</span><span class="ident" id="7380884">Commit</span><span class="op" id="7380890">(</span><span class="op" id="7380891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380894">if</span>&nbsp;<span class="ident" id="7380897"><a href="/database/sql/sql_test.go.html#7380552">err</a></span>&nbsp;<span class="op" id="7380901">!=</span>&nbsp;<span class="ident" id="7380904">nil</span>&nbsp;<span class="op" id="7380908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380912"><a href="/database/sql/sql_test.go.html#7380425">t</a></span><span class="op" id="7380913">.</span><span class="ident" id="7380914">Fatalf</span><span class="op" id="7380920">(</span><span class="string" id="7380921">&#34;Commit&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7380934">,</span>&nbsp;<span class="ident" id="7380936"><a href="/database/sql/sql_test.go.html#7380552">err</a></span><span class="op" id="7380939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7380945">//&nbsp;Commit()&nbsp;should&nbsp;have&nbsp;closed&nbsp;the&nbsp;statement</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380991">if</span>&nbsp;<span class="op" id="7380994">!</span><span class="ident" id="7380995"><a href="/database/sql/sql_test.go.html#7380754">txs</a></span><span class="op" id="7380998">.</span><span class="ident" id="7380999">closed</span>&nbsp;<span class="op" id="7381006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381010"><a href="/database/sql/sql_test.go.html#7380425">t</a></span><span class="op" id="7381011">.</span><span class="ident" id="7381012">Fatal</span><span class="op" id="7381017">(</span><span class="string" id="7381018">&#34;Stmt&nbsp;not&nbsp;closed&nbsp;after&nbsp;Commit&#34;</span><span class="op" id="7381048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381051">}</span><br>
<span class="lineno"></span><span class="op" id="7381053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="comment" id="7381056">//&nbsp;Issue:&nbsp;http://golang.org/issue/2784</span><br>
<span class="lineno"></span><span class="comment" id="7381095">//&nbsp;This&nbsp;test&nbsp;didn&#39;t&nbsp;fail&nbsp;before&nbsp;because&nbsp;we&nbsp;got&nbsp;lucky&nbsp;with&nbsp;the&nbsp;fakedb&nbsp;driver.</span><br>
<span class="lineno"></span><span class="comment" id="7381172">//&nbsp;It&nbsp;was&nbsp;failing,&nbsp;and&nbsp;now&nbsp;not,&nbsp;in&nbsp;github.com/bradfitz/go-sql-test</span><br>
<span class="lineno"></span><span class="keyword" id="7381239">func</span>&nbsp;<span class="ident" id="7381244">TestTxQuery</span><span class="op" id="7381255">(</span><span class="ident" id="7381256">t</span>&nbsp;<span class="op" id="7381258">*</span><span class="ident" id="7381259"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7381266">.</span><span class="ident" id="7381267">T</span><span class="op" id="7381268">)</span>&nbsp;<span class="op" id="7381270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381273">db</span>&nbsp;<span class="op" id="7381276">:=</span>&nbsp;<span class="ident" id="7381279"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7381288">(</span><span class="ident" id="7381289"><a href="/database/sql/sql_test.go.html#7381256">t</a></span><span class="op" id="7381290">,</span>&nbsp;<span class="string" id="7381292">&#34;&#34;</span><span class="op" id="7381294">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381297">defer</span>&nbsp;<span class="ident" id="7381303"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7381310">(</span><span class="ident" id="7381311"><a href="/database/sql/sql_test.go.html#7381256">t</a></span><span class="op" id="7381312">,</span>&nbsp;<span class="ident" id="7381314"><a href="/database/sql/sql_test.go.html#7381273">db</a></span><span class="op" id="7381316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381319"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7381323">(</span><span class="ident" id="7381324"><a href="/database/sql/sql_test.go.html#7381256">t</a></span><span class="op" id="7381325">,</span>&nbsp;<span class="ident" id="7381327"><a href="/database/sql/sql_test.go.html#7381273">db</a></span><span class="op" id="7381329">,</span>&nbsp;<span class="string" id="7381331">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7381374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381377"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7381381">(</span><span class="ident" id="7381382"><a href="/database/sql/sql_test.go.html#7381256">t</a></span><span class="op" id="7381383">,</span>&nbsp;<span class="ident" id="7381385"><a href="/database/sql/sql_test.go.html#7381273">db</a></span><span class="op" id="7381387">,</span>&nbsp;<span class="string" id="7381389">&#34;INSERT|t1|name=Alice&#34;</span><span class="op" id="7381411">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381415">tx</span><span class="op" id="7381417">,</span>&nbsp;<span class="ident" id="7381419">err</span>&nbsp;<span class="op" id="7381423">:=</span>&nbsp;<span class="ident" id="7381426"><a href="/database/sql/sql_test.go.html#7381273">db</a></span><span class="op" id="7381428">.</span><span class="ident" id="7381429">Begin</span><span class="op" id="7381434">(</span><span class="op" id="7381435">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381438">if</span>&nbsp;<span class="ident" id="7381441"><a href="/database/sql/sql_test.go.html#7381419">err</a></span>&nbsp;<span class="op" id="7381445">!=</span>&nbsp;<span class="ident" id="7381448">nil</span>&nbsp;<span class="op" id="7381452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381456"><a href="/database/sql/sql_test.go.html#7381256">t</a></span><span class="op" id="7381457">.</span><span class="ident" id="7381458">Fatal</span><span class="op" id="7381463">(</span><span class="ident" id="7381464"><a href="/database/sql/sql_test.go.html#7381419">err</a></span><span class="op" id="7381467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381473">defer</span>&nbsp;<span class="ident" id="7381479"><a href="/database/sql/sql_test.go.html#7381415">tx</a></span><span class="op" id="7381481">.</span><span class="ident" id="7381482">Rollback</span><span class="op" id="7381490">(</span><span class="op" id="7381491">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381495">r</span><span class="op" id="7381496">,</span>&nbsp;<span class="ident" id="7381498"><a href="/database/sql/sql_test.go.html#7381419">err</a></span>&nbsp;<span class="op" id="7381502">:=</span>&nbsp;<span class="ident" id="7381505"><a href="/database/sql/sql_test.go.html#7381415">tx</a></span><span class="op" id="7381507">.</span><span class="ident" id="7381508">Query</span><span class="op" id="7381513">(</span><span class="string" id="7381514">&#34;SELECT|t1|name|&#34;</span><span class="op" id="7381531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381534">if</span>&nbsp;<span class="ident" id="7381537"><a href="/database/sql/sql_test.go.html#7381419">err</a></span>&nbsp;<span class="op" id="7381541">!=</span>&nbsp;<span class="ident" id="7381544">nil</span>&nbsp;<span class="op" id="7381548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381552"><a href="/database/sql/sql_test.go.html#7381256">t</a></span><span class="op" id="7381553">.</span><span class="ident" id="7381554">Fatal</span><span class="op" id="7381559">(</span><span class="ident" id="7381560"><a href="/database/sql/sql_test.go.html#7381419">err</a></span><span class="op" id="7381563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381569">defer</span>&nbsp;<span class="ident" id="7381575"><a href="/database/sql/sql_test.go.html#7381495">r</a></span><span class="op" id="7381576">.</span><span class="ident" id="7381577">Close</span><span class="op" id="7381582">(</span><span class="op" id="7381583">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381587">if</span>&nbsp;<span class="op" id="7381590">!</span><span class="ident" id="7381591"><a href="/database/sql/sql_test.go.html#7381495">r</a></span><span class="op" id="7381592">.</span><span class="ident" id="7381593">Next</span><span class="op" id="7381597">(</span><span class="op" id="7381598">)</span>&nbsp;<span class="op" id="7381600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381604">if</span>&nbsp;<span class="ident" id="7381607"><a href="/database/sql/sql_test.go.html#7381495">r</a></span><span class="op" id="7381608">.</span><span class="ident" id="7381609">Err</span><span class="op" id="7381612">(</span><span class="op" id="7381613">)</span>&nbsp;<span class="op" id="7381615">!=</span>&nbsp;<span class="ident" id="7381618">nil</span>&nbsp;<span class="op" id="7381622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381627"><a href="/database/sql/sql_test.go.html#7381256">t</a></span><span class="op" id="7381628">.</span><span class="ident" id="7381629">Fatal</span><span class="op" id="7381634">(</span><span class="ident" id="7381635"><a href="/database/sql/sql_test.go.html#7381495">r</a></span><span class="op" id="7381636">.</span><span class="ident" id="7381637">Err</span><span class="op" id="7381640">(</span><span class="op" id="7381641">)</span><span class="op" id="7381642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381646">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381650"><a href="/database/sql/sql_test.go.html#7381256">t</a></span><span class="op" id="7381651">.</span><span class="ident" id="7381652">Fatal</span><span class="op" id="7381657">(</span><span class="string" id="7381658">&#34;expected&nbsp;one&nbsp;row&#34;</span><span class="op" id="7381676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381683">var</span>&nbsp;<span class="ident" id="7381687">x</span>&nbsp;<span class="builtintype" id="7381689">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381697"><a href="/database/sql/sql_test.go.html#7381419">err</a></span>&nbsp;<span class="op" id="7381701">=</span>&nbsp;<span class="ident" id="7381703"><a href="/database/sql/sql_test.go.html#7381495">r</a></span><span class="op" id="7381704">.</span><span class="ident" id="7381705">Scan</span><span class="op" id="7381709">(</span><span class="op" id="7381710">&amp;</span><span class="ident" id="7381711"><a href="/database/sql/sql_test.go.html#7381687">x</a></span><span class="op" id="7381712">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381715">if</span>&nbsp;<span class="ident" id="7381718"><a href="/database/sql/sql_test.go.html#7381419">err</a></span>&nbsp;<span class="op" id="7381722">!=</span>&nbsp;<span class="ident" id="7381725">nil</span>&nbsp;<span class="op" id="7381729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381733"><a href="/database/sql/sql_test.go.html#7381256">t</a></span><span class="op" id="7381734">.</span><span class="ident" id="7381735">Fatal</span><span class="op" id="7381740">(</span><span class="ident" id="7381741"><a href="/database/sql/sql_test.go.html#7381419">err</a></span><span class="op" id="7381744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381747">}</span><br>
<span class="lineno"></span><span class="op" id="7381749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="7381752">func</span>&nbsp;<span class="ident" id="7381757">TestTxQueryInvalid</span><span class="op" id="7381775">(</span><span class="ident" id="7381776">t</span>&nbsp;<span class="op" id="7381778">*</span><span class="ident" id="7381779"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7381786">.</span><span class="ident" id="7381787">T</span><span class="op" id="7381788">)</span>&nbsp;<span class="op" id="7381790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381793">db</span>&nbsp;<span class="op" id="7381796">:=</span>&nbsp;<span class="ident" id="7381799"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7381808">(</span><span class="ident" id="7381809"><a href="/database/sql/sql_test.go.html#7381776">t</a></span><span class="op" id="7381810">,</span>&nbsp;<span class="string" id="7381812">&#34;&#34;</span><span class="op" id="7381814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381817">defer</span>&nbsp;<span class="ident" id="7381823"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7381830">(</span><span class="ident" id="7381831"><a href="/database/sql/sql_test.go.html#7381776">t</a></span><span class="op" id="7381832">,</span>&nbsp;<span class="ident" id="7381834"><a href="/database/sql/sql_test.go.html#7381793">db</a></span><span class="op" id="7381836">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381840">tx</span><span class="op" id="7381842">,</span>&nbsp;<span class="ident" id="7381844">err</span>&nbsp;<span class="op" id="7381848">:=</span>&nbsp;<span class="ident" id="7381851"><a href="/database/sql/sql_test.go.html#7381793">db</a></span><span class="op" id="7381853">.</span><span class="ident" id="7381854">Begin</span><span class="op" id="7381859">(</span><span class="op" id="7381860">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381863">if</span>&nbsp;<span class="ident" id="7381866"><a href="/database/sql/sql_test.go.html#7381844">err</a></span>&nbsp;<span class="op" id="7381870">!=</span>&nbsp;<span class="ident" id="7381873">nil</span>&nbsp;<span class="op" id="7381877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381881"><a href="/database/sql/sql_test.go.html#7381776">t</a></span><span class="op" id="7381882">.</span><span class="ident" id="7381883">Fatal</span><span class="op" id="7381888">(</span><span class="ident" id="7381889"><a href="/database/sql/sql_test.go.html#7381844">err</a></span><span class="op" id="7381892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381898">defer</span>&nbsp;<span class="ident" id="7381904"><a href="/database/sql/sql_test.go.html#7381840">tx</a></span><span class="op" id="7381906">.</span><span class="ident" id="7381907">Rollback</span><span class="op" id="7381915">(</span><span class="op" id="7381916">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381920">_</span><span class="op" id="7381921">,</span>&nbsp;<span class="ident" id="7381923"><a href="/database/sql/sql_test.go.html#7381844">err</a></span>&nbsp;<span class="op" id="7381927">=</span>&nbsp;<span class="ident" id="7381929"><a href="/database/sql/sql_test.go.html#7381840">tx</a></span><span class="op" id="7381931">.</span><span class="ident" id="7381932">Query</span><span class="op" id="7381937">(</span><span class="string" id="7381938">&#34;SELECT|t1|name|&#34;</span><span class="op" id="7381955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381958">if</span>&nbsp;<span class="ident" id="7381961"><a href="/database/sql/sql_test.go.html#7381844">err</a></span>&nbsp;<span class="op" id="7381965">==</span>&nbsp;<span class="ident" id="7381968">nil</span>&nbsp;<span class="op" id="7381972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381976"><a href="/database/sql/sql_test.go.html#7381776">t</a></span><span class="op" id="7381977">.</span><span class="ident" id="7381978">Fatal</span><span class="op" id="7381983">(</span><span class="string" id="7381984">&#34;Error&nbsp;expected&#34;</span><span class="op" id="7382000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382003">}</span><br>
<span class="lineno"></span><span class="op" id="7382005">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="7382008">//&nbsp;Tests&nbsp;fix&nbsp;for&nbsp;issue&nbsp;4433,&nbsp;that&nbsp;retries&nbsp;in&nbsp;Begin&nbsp;happen&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="7382071">//&nbsp;conn.Begin()&nbsp;returns&nbsp;ErrBadConn</span><br>
<span class="lineno"></span><span class="keyword" id="7382106">func</span>&nbsp;<span class="ident" id="7382111">TestTxErrBadConn</span><span class="op" id="7382127">(</span><span class="ident" id="7382128">t</span>&nbsp;<span class="op" id="7382130">*</span><span class="ident" id="7382131"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7382138">.</span><span class="ident" id="7382139">T</span><span class="op" id="7382140">)</span>&nbsp;<span class="op" id="7382142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382145">db</span><span class="op" id="7382147">,</span>&nbsp;<span class="ident" id="7382149">err</span>&nbsp;<span class="op" id="7382153">:=</span>&nbsp;<span class="ident" id="7382156"><a href="/database/sql/sql.go.html#6360900">Open</a></span><span class="op" id="7382160">(</span><span class="string" id="7382161">&#34;test&#34;</span><span class="op" id="7382167">,</span>&nbsp;<span class="ident" id="7382169"><a href="/database/sql/sql_test.go.html#7369638">fakeDBName</a></span><span class="op" id="7382179">+</span><span class="string" id="7382180">&#34;;badConn&#34;</span><span class="op" id="7382190">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382193">if</span>&nbsp;<span class="ident" id="7382196"><a href="/database/sql/sql_test.go.html#7382149">err</a></span>&nbsp;<span class="op" id="7382200">!=</span>&nbsp;<span class="ident" id="7382203">nil</span>&nbsp;<span class="op" id="7382207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382211"><a href="/database/sql/sql_test.go.html#7382128">t</a></span><span class="op" id="7382212">.</span><span class="ident" id="7382213">Fatalf</span><span class="op" id="7382219">(</span><span class="string" id="7382220">&#34;Open:&nbsp;%v&#34;</span><span class="op" id="7382230">,</span>&nbsp;<span class="ident" id="7382232"><a href="/database/sql/sql_test.go.html#7382149">err</a></span><span class="op" id="7382235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382241">if</span>&nbsp;<span class="ident" id="7382244">_</span><span class="op" id="7382245">,</span>&nbsp;<span class="ident" id="7382247">err</span>&nbsp;<span class="op" id="7382251">:=</span>&nbsp;<span class="ident" id="7382254"><a href="/database/sql/sql_test.go.html#7382145">db</a></span><span class="op" id="7382256">.</span><span class="ident" id="7382257">Exec</span><span class="op" id="7382261">(</span><span class="string" id="7382262">&#34;WIPE&#34;</span><span class="op" id="7382268">)</span><span class="op" id="7382269">;</span>&nbsp;<span class="ident" id="7382271"><a href="/database/sql/sql_test.go.html#7382247">err</a></span>&nbsp;<span class="op" id="7382275">!=</span>&nbsp;<span class="ident" id="7382278">nil</span>&nbsp;<span class="op" id="7382282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382286"><a href="/database/sql/sql_test.go.html#7382128">t</a></span><span class="op" id="7382287">.</span><span class="ident" id="7382288">Fatalf</span><span class="op" id="7382294">(</span><span class="string" id="7382295">&#34;exec&nbsp;wipe:&nbsp;%v&#34;</span><span class="op" id="7382310">,</span>&nbsp;<span class="ident" id="7382312"><a href="/database/sql/sql_test.go.html#7382247">err</a></span><span class="op" id="7382315">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382321">defer</span>&nbsp;<span class="ident" id="7382327"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7382334">(</span><span class="ident" id="7382335"><a href="/database/sql/sql_test.go.html#7382128">t</a></span><span class="op" id="7382336">,</span>&nbsp;<span class="ident" id="7382338"><a href="/database/sql/sql_test.go.html#7382145">db</a></span><span class="op" id="7382340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382343"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7382347">(</span><span class="ident" id="7382348"><a href="/database/sql/sql_test.go.html#7382128">t</a></span><span class="op" id="7382349">,</span>&nbsp;<span class="ident" id="7382351"><a href="/database/sql/sql_test.go.html#7382145">db</a></span><span class="op" id="7382353">,</span>&nbsp;<span class="string" id="7382355">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7382398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382401">stmt</span><span class="op" id="7382405">,</span>&nbsp;<span class="ident" id="7382407"><a href="/database/sql/sql_test.go.html#7382149">err</a></span>&nbsp;<span class="op" id="7382411">:=</span>&nbsp;<span class="ident" id="7382414"><a href="/database/sql/sql_test.go.html#7382145">db</a></span><span class="op" id="7382416">.</span><span class="ident" id="7382417">Prepare</span><span class="op" id="7382424">(</span><span class="string" id="7382425">&#34;INSERT|t1|name=?,age=?&#34;</span><span class="op" id="7382449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382452">if</span>&nbsp;<span class="ident" id="7382455"><a href="/database/sql/sql_test.go.html#7382149">err</a></span>&nbsp;<span class="op" id="7382459">!=</span>&nbsp;<span class="ident" id="7382462">nil</span>&nbsp;<span class="op" id="7382466">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382470"><a href="/database/sql/sql_test.go.html#7382128">t</a></span><span class="op" id="7382471">.</span><span class="ident" id="7382472">Fatalf</span><span class="op" id="7382478">(</span><span class="string" id="7382479">&#34;Stmt,&nbsp;err&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7382499">,</span>&nbsp;<span class="ident" id="7382501"><a href="/database/sql/sql_test.go.html#7382401">stmt</a></span><span class="op" id="7382505">,</span>&nbsp;<span class="ident" id="7382507"><a href="/database/sql/sql_test.go.html#7382149">err</a></span><span class="op" id="7382510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382516">defer</span>&nbsp;<span class="ident" id="7382522"><a href="/database/sql/sql_test.go.html#7382401">stmt</a></span><span class="op" id="7382526">.</span><span class="ident" id="7382527">Close</span><span class="op" id="7382532">(</span><span class="op" id="7382533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382536">tx</span><span class="op" id="7382538">,</span>&nbsp;<span class="ident" id="7382540"><a href="/database/sql/sql_test.go.html#7382149">err</a></span>&nbsp;<span class="op" id="7382544">:=</span>&nbsp;<span class="ident" id="7382547"><a href="/database/sql/sql_test.go.html#7382145">db</a></span><span class="op" id="7382549">.</span><span class="ident" id="7382550">Begin</span><span class="op" id="7382555">(</span><span class="op" id="7382556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382559">if</span>&nbsp;<span class="ident" id="7382562"><a href="/database/sql/sql_test.go.html#7382149">err</a></span>&nbsp;<span class="op" id="7382566">!=</span>&nbsp;<span class="ident" id="7382569">nil</span>&nbsp;<span class="op" id="7382573">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382577"><a href="/database/sql/sql_test.go.html#7382128">t</a></span><span class="op" id="7382578">.</span><span class="ident" id="7382579">Fatalf</span><span class="op" id="7382585">(</span><span class="string" id="7382586">&#34;Begin&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7382598">,</span>&nbsp;<span class="ident" id="7382600"><a href="/database/sql/sql_test.go.html#7382149">err</a></span><span class="op" id="7382603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382609">txs</span>&nbsp;<span class="op" id="7382613">:=</span>&nbsp;<span class="ident" id="7382616"><a href="/database/sql/sql_test.go.html#7382536">tx</a></span><span class="op" id="7382618">.</span><span class="ident" id="7382619">Stmt</span><span class="op" id="7382623">(</span><span class="ident" id="7382624"><a href="/database/sql/sql_test.go.html#7382401">stmt</a></span><span class="op" id="7382628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382631">defer</span>&nbsp;<span class="ident" id="7382637"><a href="/database/sql/sql_test.go.html#7382609">txs</a></span><span class="op" id="7382640">.</span><span class="ident" id="7382641">Close</span><span class="op" id="7382646">(</span><span class="op" id="7382647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382650">_</span><span class="op" id="7382651">,</span>&nbsp;<span class="ident" id="7382653"><a href="/database/sql/sql_test.go.html#7382149">err</a></span>&nbsp;<span class="op" id="7382657">=</span>&nbsp;<span class="ident" id="7382659"><a href="/database/sql/sql_test.go.html#7382609">txs</a></span><span class="op" id="7382662">.</span><span class="ident" id="7382663">Exec</span><span class="op" id="7382667">(</span><span class="string" id="7382668">&#34;Bobby&#34;</span><span class="op" id="7382675">,</span>&nbsp;<span class="num" id="7382677">7</span><span class="op" id="7382678">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382681">if</span>&nbsp;<span class="ident" id="7382684"><a href="/database/sql/sql_test.go.html#7382149">err</a></span>&nbsp;<span class="op" id="7382688">!=</span>&nbsp;<span class="ident" id="7382691">nil</span>&nbsp;<span class="op" id="7382695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382699"><a href="/database/sql/sql_test.go.html#7382128">t</a></span><span class="op" id="7382700">.</span><span class="ident" id="7382701">Fatalf</span><span class="op" id="7382707">(</span><span class="string" id="7382708">&#34;Exec&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7382719">,</span>&nbsp;<span class="ident" id="7382721"><a href="/database/sql/sql_test.go.html#7382149">err</a></span><span class="op" id="7382724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382730"><a href="/database/sql/sql_test.go.html#7382149">err</a></span>&nbsp;<span class="op" id="7382734">=</span>&nbsp;<span class="ident" id="7382736"><a href="/database/sql/sql_test.go.html#7382536">tx</a></span><span class="op" id="7382738">.</span><span class="ident" id="7382739">Commit</span><span class="op" id="7382745">(</span><span class="op" id="7382746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382749">if</span>&nbsp;<span class="ident" id="7382752"><a href="/database/sql/sql_test.go.html#7382149">err</a></span>&nbsp;<span class="op" id="7382756">!=</span>&nbsp;<span class="ident" id="7382759">nil</span>&nbsp;<span class="op" id="7382763">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382767"><a href="/database/sql/sql_test.go.html#7382128">t</a></span><span class="op" id="7382768">.</span><span class="ident" id="7382769">Fatalf</span><span class="op" id="7382775">(</span><span class="string" id="7382776">&#34;Commit&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7382789">,</span>&nbsp;<span class="ident" id="7382791"><a href="/database/sql/sql_test.go.html#7382149">err</a></span><span class="op" id="7382794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382797">}</span><br>
<span class="lineno"></span><span class="op" id="7382799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7382802">//&nbsp;Tests&nbsp;fix&nbsp;for&nbsp;issue&nbsp;2542,&nbsp;that&nbsp;we&nbsp;release&nbsp;a&nbsp;lock&nbsp;when&nbsp;querying&nbsp;on</span><br>
<span class="lineno">585</span><span class="comment" id="7382871">//&nbsp;a&nbsp;closed&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="7382895">func</span>&nbsp;<span class="ident" id="7382900">TestIssue2542Deadlock</span><span class="op" id="7382921">(</span><span class="ident" id="7382922">t</span>&nbsp;<span class="op" id="7382924">*</span><span class="ident" id="7382925"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7382932">.</span><span class="ident" id="7382933">T</span><span class="op" id="7382934">)</span>&nbsp;<span class="op" id="7382936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382939">db</span>&nbsp;<span class="op" id="7382942">:=</span>&nbsp;<span class="ident" id="7382945"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7382954">(</span><span class="ident" id="7382955"><a href="/database/sql/sql_test.go.html#7382922">t</a></span><span class="op" id="7382956">,</span>&nbsp;<span class="string" id="7382958">&#34;people&#34;</span><span class="op" id="7382966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382969"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7382976">(</span><span class="ident" id="7382977"><a href="/database/sql/sql_test.go.html#7382922">t</a></span><span class="op" id="7382978">,</span>&nbsp;<span class="ident" id="7382980"><a href="/database/sql/sql_test.go.html#7382939">db</a></span><span class="op" id="7382982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382985">for</span>&nbsp;<span class="ident" id="7382989">i</span>&nbsp;<span class="op" id="7382991">:=</span>&nbsp;<span class="num" id="7382994">0</span><span class="op" id="7382995">;</span>&nbsp;<span class="ident" id="7382997"><a href="/database/sql/sql_test.go.html#7382989">i</a></span>&nbsp;<span class="op" id="7382999">&lt;</span>&nbsp;<span class="num" id="7383001">2</span><span class="op" id="7383002">;</span>&nbsp;<span class="ident" id="7383004"><a href="/database/sql/sql_test.go.html#7382989">i</a></span><span class="op" id="7383005">++</span>&nbsp;<span class="op" id="7383008">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383012">_</span><span class="op" id="7383013">,</span>&nbsp;<span class="ident" id="7383015">err</span>&nbsp;<span class="op" id="7383019">:=</span>&nbsp;<span class="ident" id="7383022"><a href="/database/sql/sql_test.go.html#7382939">db</a></span><span class="op" id="7383024">.</span><span class="ident" id="7383025">Query</span><span class="op" id="7383030">(</span><span class="string" id="7383031">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7383056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383060">if</span>&nbsp;<span class="ident" id="7383063"><a href="/database/sql/sql_test.go.html#7383015">err</a></span>&nbsp;<span class="op" id="7383067">==</span>&nbsp;<span class="ident" id="7383070">nil</span>&nbsp;<span class="op" id="7383074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383079"><a href="/database/sql/sql_test.go.html#7382922">t</a></span><span class="op" id="7383080">.</span><span class="ident" id="7383081">Fatalf</span><span class="op" id="7383087">(</span><span class="string" id="7383088">&#34;expected&nbsp;error&#34;</span><span class="op" id="7383104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383111">}</span><br>
<span class="lineno">595</span><span class="op" id="7383113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7383116">//&nbsp;From&nbsp;golang.org/issue/3865</span><br>
<span class="lineno"></span><span class="keyword" id="7383146">func</span>&nbsp;<span class="ident" id="7383151">TestCloseStmtBeforeRows</span><span class="op" id="7383174">(</span><span class="ident" id="7383175">t</span>&nbsp;<span class="op" id="7383177">*</span><span class="ident" id="7383178"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7383185">.</span><span class="ident" id="7383186">T</span><span class="op" id="7383187">)</span>&nbsp;<span class="op" id="7383189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383192">db</span>&nbsp;<span class="op" id="7383195">:=</span>&nbsp;<span class="ident" id="7383198"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7383207">(</span><span class="ident" id="7383208"><a href="/database/sql/sql_test.go.html#7383175">t</a></span><span class="op" id="7383209">,</span>&nbsp;<span class="string" id="7383211">&#34;people&#34;</span><span class="op" id="7383219">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383222">defer</span>&nbsp;<span class="ident" id="7383228"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7383235">(</span><span class="ident" id="7383236"><a href="/database/sql/sql_test.go.html#7383175">t</a></span><span class="op" id="7383237">,</span>&nbsp;<span class="ident" id="7383239"><a href="/database/sql/sql_test.go.html#7383192">db</a></span><span class="op" id="7383241">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383245">s</span><span class="op" id="7383246">,</span>&nbsp;<span class="ident" id="7383248">err</span>&nbsp;<span class="op" id="7383252">:=</span>&nbsp;<span class="ident" id="7383255"><a href="/database/sql/sql_test.go.html#7383192">db</a></span><span class="op" id="7383257">.</span><span class="ident" id="7383258">Prepare</span><span class="op" id="7383265">(</span><span class="string" id="7383266">&#34;SELECT|people|name|&#34;</span><span class="op" id="7383287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383290">if</span>&nbsp;<span class="ident" id="7383293"><a href="/database/sql/sql_test.go.html#7383248">err</a></span>&nbsp;<span class="op" id="7383297">!=</span>&nbsp;<span class="ident" id="7383300">nil</span>&nbsp;<span class="op" id="7383304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383308"><a href="/database/sql/sql_test.go.html#7383175">t</a></span><span class="op" id="7383309">.</span><span class="ident" id="7383310">Fatal</span><span class="op" id="7383315">(</span><span class="ident" id="7383316"><a href="/database/sql/sql_test.go.html#7383248">err</a></span><span class="op" id="7383319">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383326">r</span><span class="op" id="7383327">,</span>&nbsp;<span class="ident" id="7383329"><a href="/database/sql/sql_test.go.html#7383248">err</a></span>&nbsp;<span class="op" id="7383333">:=</span>&nbsp;<span class="ident" id="7383336"><a href="/database/sql/sql_test.go.html#7383245">s</a></span><span class="op" id="7383337">.</span><span class="ident" id="7383338">Query</span><span class="op" id="7383343">(</span><span class="op" id="7383344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383347">if</span>&nbsp;<span class="ident" id="7383350"><a href="/database/sql/sql_test.go.html#7383248">err</a></span>&nbsp;<span class="op" id="7383354">!=</span>&nbsp;<span class="ident" id="7383357">nil</span>&nbsp;<span class="op" id="7383361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383365"><a href="/database/sql/sql_test.go.html#7383245">s</a></span><span class="op" id="7383366">.</span><span class="ident" id="7383367">Close</span><span class="op" id="7383372">(</span><span class="op" id="7383373">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383377"><a href="/database/sql/sql_test.go.html#7383175">t</a></span><span class="op" id="7383378">.</span><span class="ident" id="7383379">Fatal</span><span class="op" id="7383384">(</span><span class="ident" id="7383385"><a href="/database/sql/sql_test.go.html#7383248">err</a></span><span class="op" id="7383388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383395"><a href="/database/sql/sql_test.go.html#7383248">err</a></span>&nbsp;<span class="op" id="7383399">=</span>&nbsp;<span class="ident" id="7383401"><a href="/database/sql/sql_test.go.html#7383245">s</a></span><span class="op" id="7383402">.</span><span class="ident" id="7383403">Close</span><span class="op" id="7383408">(</span><span class="op" id="7383409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383412">if</span>&nbsp;<span class="ident" id="7383415"><a href="/database/sql/sql_test.go.html#7383248">err</a></span>&nbsp;<span class="op" id="7383419">!=</span>&nbsp;<span class="ident" id="7383422">nil</span>&nbsp;<span class="op" id="7383426">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383430"><a href="/database/sql/sql_test.go.html#7383175">t</a></span><span class="op" id="7383431">.</span><span class="ident" id="7383432">Fatal</span><span class="op" id="7383437">(</span><span class="ident" id="7383438"><a href="/database/sql/sql_test.go.html#7383248">err</a></span><span class="op" id="7383441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383448"><a href="/database/sql/sql_test.go.html#7383326">r</a></span><span class="op" id="7383449">.</span><span class="ident" id="7383450">Close</span><span class="op" id="7383455">(</span><span class="op" id="7383456">)</span><br>
<span class="lineno"></span><span class="op" id="7383458">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="comment" id="7383461">//&nbsp;Tests&nbsp;fix&nbsp;for&nbsp;issue&nbsp;2788,&nbsp;that&nbsp;we&nbsp;bind&nbsp;nil&nbsp;to&nbsp;a&nbsp;[]byte&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7383526">//&nbsp;value&nbsp;in&nbsp;the&nbsp;column&nbsp;is&nbsp;sql&nbsp;null</span><br>
<span class="lineno"></span><span class="keyword" id="7383561">func</span>&nbsp;<span class="ident" id="7383566">TestNullByteSlice</span><span class="op" id="7383583">(</span><span class="ident" id="7383584">t</span>&nbsp;<span class="op" id="7383586">*</span><span class="ident" id="7383587"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7383594">.</span><span class="ident" id="7383595">T</span><span class="op" id="7383596">)</span>&nbsp;<span class="op" id="7383598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383601">db</span>&nbsp;<span class="op" id="7383604">:=</span>&nbsp;<span class="ident" id="7383607"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7383616">(</span><span class="ident" id="7383617"><a href="/database/sql/sql_test.go.html#7383584">t</a></span><span class="op" id="7383618">,</span>&nbsp;<span class="string" id="7383620">&#34;&#34;</span><span class="op" id="7383622">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383625">defer</span>&nbsp;<span class="ident" id="7383631"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7383638">(</span><span class="ident" id="7383639"><a href="/database/sql/sql_test.go.html#7383584">t</a></span><span class="op" id="7383640">,</span>&nbsp;<span class="ident" id="7383642"><a href="/database/sql/sql_test.go.html#7383601">db</a></span><span class="op" id="7383644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383647"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7383651">(</span><span class="ident" id="7383652"><a href="/database/sql/sql_test.go.html#7383584">t</a></span><span class="op" id="7383653">,</span>&nbsp;<span class="ident" id="7383655"><a href="/database/sql/sql_test.go.html#7383601">db</a></span><span class="op" id="7383657">,</span>&nbsp;<span class="string" id="7383659">&#34;CREATE|t|id=int32,name=nullstring&#34;</span><span class="op" id="7383694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383697"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7383701">(</span><span class="ident" id="7383702"><a href="/database/sql/sql_test.go.html#7383584">t</a></span><span class="op" id="7383703">,</span>&nbsp;<span class="ident" id="7383705"><a href="/database/sql/sql_test.go.html#7383601">db</a></span><span class="op" id="7383707">,</span>&nbsp;<span class="string" id="7383709">&#34;INSERT|t|id=10,name=?&#34;</span><span class="op" id="7383732">,</span>&nbsp;<span class="ident" id="7383734">nil</span><span class="op" id="7383737">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383741">var</span>&nbsp;<span class="ident" id="7383745">name</span>&nbsp;<span class="op" id="7383750">[</span><span class="op" id="7383751">]</span><span class="builtintype" id="7383752">byte</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383759">err</span>&nbsp;<span class="op" id="7383763">:=</span>&nbsp;<span class="ident" id="7383766"><a href="/database/sql/sql_test.go.html#7383601">db</a></span><span class="op" id="7383768">.</span><span class="ident" id="7383769">QueryRow</span><span class="op" id="7383777">(</span><span class="string" id="7383778">&#34;SELECT|t|name|id=?&#34;</span><span class="op" id="7383798">,</span>&nbsp;<span class="num" id="7383800">10</span><span class="op" id="7383802">)</span><span class="op" id="7383803">.</span><span class="ident" id="7383804">Scan</span><span class="op" id="7383808">(</span><span class="op" id="7383809">&amp;</span><span class="ident" id="7383810"><a href="/database/sql/sql_test.go.html#7383745">name</a></span><span class="op" id="7383814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383817">if</span>&nbsp;<span class="ident" id="7383820"><a href="/database/sql/sql_test.go.html#7383759">err</a></span>&nbsp;<span class="op" id="7383824">!=</span>&nbsp;<span class="ident" id="7383827">nil</span>&nbsp;<span class="op" id="7383831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383835"><a href="/database/sql/sql_test.go.html#7383584">t</a></span><span class="op" id="7383836">.</span><span class="ident" id="7383837">Fatal</span><span class="op" id="7383842">(</span><span class="ident" id="7383843"><a href="/database/sql/sql_test.go.html#7383759">err</a></span><span class="op" id="7383846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383849">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383852">if</span>&nbsp;<span class="ident" id="7383855"><a href="/database/sql/sql_test.go.html#7383745">name</a></span>&nbsp;<span class="op" id="7383860">!=</span>&nbsp;<span class="ident" id="7383863">nil</span>&nbsp;<span class="op" id="7383867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383871"><a href="/database/sql/sql_test.go.html#7383584">t</a></span><span class="op" id="7383872">.</span><span class="ident" id="7383873">Fatalf</span><span class="op" id="7383879">(</span><span class="string" id="7383880">&#34;name&nbsp;[]byte&nbsp;should&nbsp;be&nbsp;nil&nbsp;for&nbsp;null&nbsp;column&nbsp;value,&nbsp;got:&nbsp;%#v&#34;</span><span class="op" id="7383939">,</span>&nbsp;<span class="ident" id="7383941"><a href="/database/sql/sql_test.go.html#7383745">name</a></span><span class="op" id="7383945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383952"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7383956">(</span><span class="ident" id="7383957"><a href="/database/sql/sql_test.go.html#7383584">t</a></span><span class="op" id="7383958">,</span>&nbsp;<span class="ident" id="7383960"><a href="/database/sql/sql_test.go.html#7383601">db</a></span><span class="op" id="7383962">,</span>&nbsp;<span class="string" id="7383964">&#34;INSERT|t|id=11,name=?&#34;</span><span class="op" id="7383987">,</span>&nbsp;<span class="string" id="7383989">&#34;bob&#34;</span><span class="op" id="7383994">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383997"><a href="/database/sql/sql_test.go.html#7383759">err</a></span>&nbsp;<span class="op" id="7384001">=</span>&nbsp;<span class="ident" id="7384003"><a href="/database/sql/sql_test.go.html#7383601">db</a></span><span class="op" id="7384005">.</span><span class="ident" id="7384006">QueryRow</span><span class="op" id="7384014">(</span><span class="string" id="7384015">&#34;SELECT|t|name|id=?&#34;</span><span class="op" id="7384035">,</span>&nbsp;<span class="num" id="7384037">11</span><span class="op" id="7384039">)</span><span class="op" id="7384040">.</span><span class="ident" id="7384041">Scan</span><span class="op" id="7384045">(</span><span class="op" id="7384046">&amp;</span><span class="ident" id="7384047"><a href="/database/sql/sql_test.go.html#7383745">name</a></span><span class="op" id="7384051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384054">if</span>&nbsp;<span class="ident" id="7384057"><a href="/database/sql/sql_test.go.html#7383759">err</a></span>&nbsp;<span class="op" id="7384061">!=</span>&nbsp;<span class="ident" id="7384064">nil</span>&nbsp;<span class="op" id="7384068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384072"><a href="/database/sql/sql_test.go.html#7383584">t</a></span><span class="op" id="7384073">.</span><span class="ident" id="7384074">Fatal</span><span class="op" id="7384079">(</span><span class="ident" id="7384080"><a href="/database/sql/sql_test.go.html#7383759">err</a></span><span class="op" id="7384083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384089">if</span>&nbsp;<span class="builtintype" id="7384092">string</span><span class="op" id="7384098">(</span><span class="ident" id="7384099"><a href="/database/sql/sql_test.go.html#7383745">name</a></span><span class="op" id="7384103">)</span>&nbsp;<span class="op" id="7384105">!=</span>&nbsp;<span class="string" id="7384108">&#34;bob&#34;</span>&nbsp;<span class="op" id="7384114">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384118"><a href="/database/sql/sql_test.go.html#7383584">t</a></span><span class="op" id="7384119">.</span><span class="ident" id="7384120">Fatalf</span><span class="op" id="7384126">(</span><span class="string" id="7384127">&#34;name&nbsp;[]byte&nbsp;should&nbsp;be&nbsp;bob,&nbsp;got:&nbsp;%q&#34;</span><span class="op" id="7384163">,</span>&nbsp;<span class="builtintype" id="7384165">string</span><span class="op" id="7384171">(</span><span class="ident" id="7384172"><a href="/database/sql/sql_test.go.html#7383745">name</a></span><span class="op" id="7384176">)</span><span class="op" id="7384177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384180">}</span><br>
<span class="lineno"></span><span class="op" id="7384182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7384185">func</span>&nbsp;<span class="ident" id="7384190">TestPointerParamsAndScans</span><span class="op" id="7384215">(</span><span class="ident" id="7384216">t</span>&nbsp;<span class="op" id="7384218">*</span><span class="ident" id="7384219"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7384226">.</span><span class="ident" id="7384227">T</span><span class="op" id="7384228">)</span>&nbsp;<span class="op" id="7384230">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384233">db</span>&nbsp;<span class="op" id="7384236">:=</span>&nbsp;<span class="ident" id="7384239"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7384248">(</span><span class="ident" id="7384249"><a href="/database/sql/sql_test.go.html#7384216">t</a></span><span class="op" id="7384250">,</span>&nbsp;<span class="string" id="7384252">&#34;&#34;</span><span class="op" id="7384254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384257">defer</span>&nbsp;<span class="ident" id="7384263"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7384270">(</span><span class="ident" id="7384271"><a href="/database/sql/sql_test.go.html#7384216">t</a></span><span class="op" id="7384272">,</span>&nbsp;<span class="ident" id="7384274"><a href="/database/sql/sql_test.go.html#7384233">db</a></span><span class="op" id="7384276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384279"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7384283">(</span><span class="ident" id="7384284"><a href="/database/sql/sql_test.go.html#7384216">t</a></span><span class="op" id="7384285">,</span>&nbsp;<span class="ident" id="7384287"><a href="/database/sql/sql_test.go.html#7384233">db</a></span><span class="op" id="7384289">,</span>&nbsp;<span class="string" id="7384291">&#34;CREATE|t|id=int32,name=nullstring&#34;</span><span class="op" id="7384326">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384330">bob</span>&nbsp;<span class="op" id="7384334">:=</span>&nbsp;<span class="string" id="7384337">&#34;bob&#34;</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384344">var</span>&nbsp;<span class="ident" id="7384348">name</span>&nbsp;<span class="op" id="7384353">*</span><span class="builtintype" id="7384354">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384363"><a href="/database/sql/sql_test.go.html#7384348">name</a></span>&nbsp;<span class="op" id="7384368">=</span>&nbsp;<span class="op" id="7384370">&amp;</span><span class="ident" id="7384371"><a href="/database/sql/sql_test.go.html#7384330">bob</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384376"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7384380">(</span><span class="ident" id="7384381"><a href="/database/sql/sql_test.go.html#7384216">t</a></span><span class="op" id="7384382">,</span>&nbsp;<span class="ident" id="7384384"><a href="/database/sql/sql_test.go.html#7384233">db</a></span><span class="op" id="7384386">,</span>&nbsp;<span class="string" id="7384388">&#34;INSERT|t|id=10,name=?&#34;</span><span class="op" id="7384411">,</span>&nbsp;<span class="ident" id="7384413"><a href="/database/sql/sql_test.go.html#7384348">name</a></span><span class="op" id="7384417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384420"><a href="/database/sql/sql_test.go.html#7384348">name</a></span>&nbsp;<span class="op" id="7384425">=</span>&nbsp;<span class="ident" id="7384427">nil</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384432"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7384436">(</span><span class="ident" id="7384437"><a href="/database/sql/sql_test.go.html#7384216">t</a></span><span class="op" id="7384438">,</span>&nbsp;<span class="ident" id="7384440"><a href="/database/sql/sql_test.go.html#7384233">db</a></span><span class="op" id="7384442">,</span>&nbsp;<span class="string" id="7384444">&#34;INSERT|t|id=20,name=?&#34;</span><span class="op" id="7384467">,</span>&nbsp;<span class="ident" id="7384469"><a href="/database/sql/sql_test.go.html#7384348">name</a></span><span class="op" id="7384473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384477">err</span>&nbsp;<span class="op" id="7384481">:=</span>&nbsp;<span class="ident" id="7384484"><a href="/database/sql/sql_test.go.html#7384233">db</a></span><span class="op" id="7384486">.</span><span class="ident" id="7384487">QueryRow</span><span class="op" id="7384495">(</span><span class="string" id="7384496">&#34;SELECT|t|name|id=?&#34;</span><span class="op" id="7384516">,</span>&nbsp;<span class="num" id="7384518">10</span><span class="op" id="7384520">)</span><span class="op" id="7384521">.</span><span class="ident" id="7384522">Scan</span><span class="op" id="7384526">(</span><span class="op" id="7384527">&amp;</span><span class="ident" id="7384528"><a href="/database/sql/sql_test.go.html#7384348">name</a></span><span class="op" id="7384532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384535">if</span>&nbsp;<span class="ident" id="7384538"><a href="/database/sql/sql_test.go.html#7384477">err</a></span>&nbsp;<span class="op" id="7384542">!=</span>&nbsp;<span class="ident" id="7384545">nil</span>&nbsp;<span class="op" id="7384549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384553"><a href="/database/sql/sql_test.go.html#7384216">t</a></span><span class="op" id="7384554">.</span><span class="ident" id="7384555">Fatalf</span><span class="op" id="7384561">(</span><span class="string" id="7384562">&#34;querying&nbsp;id&nbsp;10:&nbsp;%v&#34;</span><span class="op" id="7384582">,</span>&nbsp;<span class="ident" id="7384584"><a href="/database/sql/sql_test.go.html#7384477">err</a></span><span class="op" id="7384587">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384593">if</span>&nbsp;<span class="ident" id="7384596"><a href="/database/sql/sql_test.go.html#7384348">name</a></span>&nbsp;<span class="op" id="7384601">==</span>&nbsp;<span class="ident" id="7384604">nil</span>&nbsp;<span class="op" id="7384608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384612"><a href="/database/sql/sql_test.go.html#7384216">t</a></span><span class="op" id="7384613">.</span><span class="ident" id="7384614">Errorf</span><span class="op" id="7384620">(</span><span class="string" id="7384621">&#34;id&nbsp;10&#39;s&nbsp;name&nbsp;=&nbsp;nil;&nbsp;want&nbsp;bob&#34;</span><span class="op" id="7384651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384654">}</span>&nbsp;<span class="keyword" id="7384656">else</span>&nbsp;<span class="keyword" id="7384661">if</span>&nbsp;<span class="op" id="7384664">*</span><span class="ident" id="7384665"><a href="/database/sql/sql_test.go.html#7384348">name</a></span>&nbsp;<span class="op" id="7384670">!=</span>&nbsp;<span class="string" id="7384673">&#34;bob&#34;</span>&nbsp;<span class="op" id="7384679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384683"><a href="/database/sql/sql_test.go.html#7384216">t</a></span><span class="op" id="7384684">.</span><span class="ident" id="7384685">Errorf</span><span class="op" id="7384691">(</span><span class="string" id="7384692">&#34;id&nbsp;10&#39;s&nbsp;name&nbsp;=&nbsp;%q;&nbsp;want&nbsp;bob&#34;</span><span class="op" id="7384721">,</span>&nbsp;<span class="op" id="7384723">*</span><span class="ident" id="7384724"><a href="/database/sql/sql_test.go.html#7384348">name</a></span><span class="op" id="7384728">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384735"><a href="/database/sql/sql_test.go.html#7384477">err</a></span>&nbsp;<span class="op" id="7384739">=</span>&nbsp;<span class="ident" id="7384741"><a href="/database/sql/sql_test.go.html#7384233">db</a></span><span class="op" id="7384743">.</span><span class="ident" id="7384744">QueryRow</span><span class="op" id="7384752">(</span><span class="string" id="7384753">&#34;SELECT|t|name|id=?&#34;</span><span class="op" id="7384773">,</span>&nbsp;<span class="num" id="7384775">20</span><span class="op" id="7384777">)</span><span class="op" id="7384778">.</span><span class="ident" id="7384779">Scan</span><span class="op" id="7384783">(</span><span class="op" id="7384784">&amp;</span><span class="ident" id="7384785"><a href="/database/sql/sql_test.go.html#7384348">name</a></span><span class="op" id="7384789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384792">if</span>&nbsp;<span class="ident" id="7384795"><a href="/database/sql/sql_test.go.html#7384477">err</a></span>&nbsp;<span class="op" id="7384799">!=</span>&nbsp;<span class="ident" id="7384802">nil</span>&nbsp;<span class="op" id="7384806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384810"><a href="/database/sql/sql_test.go.html#7384216">t</a></span><span class="op" id="7384811">.</span><span class="ident" id="7384812">Fatalf</span><span class="op" id="7384818">(</span><span class="string" id="7384819">&#34;querying&nbsp;id&nbsp;20:&nbsp;%v&#34;</span><span class="op" id="7384839">,</span>&nbsp;<span class="ident" id="7384841"><a href="/database/sql/sql_test.go.html#7384477">err</a></span><span class="op" id="7384844">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384850">if</span>&nbsp;<span class="ident" id="7384853"><a href="/database/sql/sql_test.go.html#7384348">name</a></span>&nbsp;<span class="op" id="7384858">!=</span>&nbsp;<span class="ident" id="7384861">nil</span>&nbsp;<span class="op" id="7384865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384869"><a href="/database/sql/sql_test.go.html#7384216">t</a></span><span class="op" id="7384870">.</span><span class="ident" id="7384871">Errorf</span><span class="op" id="7384877">(</span><span class="string" id="7384878">&#34;id&nbsp;20&nbsp;=&nbsp;%q;&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7384900">,</span>&nbsp;<span class="op" id="7384902">*</span><span class="ident" id="7384903"><a href="/database/sql/sql_test.go.html#7384348">name</a></span><span class="op" id="7384907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384910">}</span><br>
<span class="lineno"></span><span class="op" id="7384912">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="7384915">func</span>&nbsp;<span class="ident" id="7384920">TestQueryRowClosingStmt</span><span class="op" id="7384943">(</span><span class="ident" id="7384944">t</span>&nbsp;<span class="op" id="7384946">*</span><span class="ident" id="7384947"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7384954">.</span><span class="ident" id="7384955">T</span><span class="op" id="7384956">)</span>&nbsp;<span class="op" id="7384958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384961">db</span>&nbsp;<span class="op" id="7384964">:=</span>&nbsp;<span class="ident" id="7384967"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7384976">(</span><span class="ident" id="7384977"><a href="/database/sql/sql_test.go.html#7384944">t</a></span><span class="op" id="7384978">,</span>&nbsp;<span class="string" id="7384980">&#34;people&#34;</span><span class="op" id="7384988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384991">defer</span>&nbsp;<span class="ident" id="7384997"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7385004">(</span><span class="ident" id="7385005"><a href="/database/sql/sql_test.go.html#7384944">t</a></span><span class="op" id="7385006">,</span>&nbsp;<span class="ident" id="7385008"><a href="/database/sql/sql_test.go.html#7384961">db</a></span><span class="op" id="7385010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385013">var</span>&nbsp;<span class="ident" id="7385017">name</span>&nbsp;<span class="builtintype" id="7385022">string</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385030">var</span>&nbsp;<span class="ident" id="7385034">age</span>&nbsp;<span class="builtintype" id="7385038">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385043">err</span>&nbsp;<span class="op" id="7385047">:=</span>&nbsp;<span class="ident" id="7385050"><a href="/database/sql/sql_test.go.html#7384961">db</a></span><span class="op" id="7385052">.</span><span class="ident" id="7385053">QueryRow</span><span class="op" id="7385061">(</span><span class="string" id="7385062">&#34;SELECT|people|age,name|age=?&#34;</span><span class="op" id="7385092">,</span>&nbsp;<span class="num" id="7385094">3</span><span class="op" id="7385095">)</span><span class="op" id="7385096">.</span><span class="ident" id="7385097">Scan</span><span class="op" id="7385101">(</span><span class="op" id="7385102">&amp;</span><span class="ident" id="7385103"><a href="/database/sql/sql_test.go.html#7385034">age</a></span><span class="op" id="7385106">,</span>&nbsp;<span class="op" id="7385108">&amp;</span><span class="ident" id="7385109"><a href="/database/sql/sql_test.go.html#7385017">name</a></span><span class="op" id="7385113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385116">if</span>&nbsp;<span class="ident" id="7385119"><a href="/database/sql/sql_test.go.html#7385043">err</a></span>&nbsp;<span class="op" id="7385123">!=</span>&nbsp;<span class="ident" id="7385126">nil</span>&nbsp;<span class="op" id="7385130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385134"><a href="/database/sql/sql_test.go.html#7384944">t</a></span><span class="op" id="7385135">.</span><span class="ident" id="7385136">Fatal</span><span class="op" id="7385141">(</span><span class="ident" id="7385142"><a href="/database/sql/sql_test.go.html#7385043">err</a></span><span class="op" id="7385145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385148">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385151">if</span>&nbsp;<span class="builtinfunc" id="7385154">len</span><span class="op" id="7385157">(</span><span class="ident" id="7385158"><a href="/database/sql/sql_test.go.html#7384961">db</a></span><span class="op" id="7385160">.</span><span class="ident" id="7385161">freeConn</span><span class="op" id="7385169">)</span>&nbsp;<span class="op" id="7385171">!=</span>&nbsp;<span class="num" id="7385174">1</span>&nbsp;<span class="op" id="7385176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385180"><a href="/database/sql/sql_test.go.html#7384944">t</a></span><span class="op" id="7385181">.</span><span class="ident" id="7385182">Fatalf</span><span class="op" id="7385188">(</span><span class="string" id="7385189">&#34;expected&nbsp;1&nbsp;free&nbsp;conn&#34;</span><span class="op" id="7385211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385217">fakeConn</span>&nbsp;<span class="op" id="7385226">:=</span>&nbsp;<span class="ident" id="7385229"><a href="/database/sql/sql_test.go.html#7384961">db</a></span><span class="op" id="7385231">.</span><span class="ident" id="7385232">freeConn</span><span class="op" id="7385240">[</span><span class="num" id="7385241">0</span><span class="op" id="7385242">]</span><span class="op" id="7385243">.</span><span class="ident" id="7385244">ci</span><span class="op" id="7385246">.</span><span class="op" id="7385247">(</span><span class="op" id="7385248">*</span><span class="ident" id="7385249"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7385257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385260">if</span>&nbsp;<span class="ident" id="7385263">made</span><span class="op" id="7385267">,</span>&nbsp;<span class="ident" id="7385269">closed</span>&nbsp;<span class="op" id="7385276">:=</span>&nbsp;<span class="ident" id="7385279"><a href="/database/sql/sql_test.go.html#7385217">fakeConn</a></span><span class="op" id="7385287">.</span><span class="ident" id="7385288">stmtsMade</span><span class="op" id="7385297">,</span>&nbsp;<span class="ident" id="7385299"><a href="/database/sql/sql_test.go.html#7385217">fakeConn</a></span><span class="op" id="7385307">.</span><span class="ident" id="7385308">stmtsClosed</span><span class="op" id="7385319">;</span>&nbsp;<span class="ident" id="7385321"><a href="/database/sql/sql_test.go.html#7385263">made</a></span>&nbsp;<span class="op" id="7385326">!=</span>&nbsp;<span class="ident" id="7385329"><a href="/database/sql/sql_test.go.html#7385269">closed</a></span>&nbsp;<span class="op" id="7385336">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385340"><a href="/database/sql/sql_test.go.html#7384944">t</a></span><span class="op" id="7385341">.</span><span class="ident" id="7385342">Errorf</span><span class="op" id="7385348">(</span><span class="string" id="7385349">&#34;statement&nbsp;close&nbsp;mismatch:&nbsp;made&nbsp;%d,&nbsp;closed&nbsp;%d&#34;</span><span class="op" id="7385395">,</span>&nbsp;<span class="ident" id="7385397"><a href="/database/sql/sql_test.go.html#7385263">made</a></span><span class="op" id="7385401">,</span>&nbsp;<span class="ident" id="7385403"><a href="/database/sql/sql_test.go.html#7385269">closed</a></span><span class="op" id="7385409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385412">}</span><br>
<span class="lineno"></span><span class="op" id="7385414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7385417">//&nbsp;Test&nbsp;issue&nbsp;6651</span><br>
<span class="lineno">700</span><span class="keyword" id="7385436">func</span>&nbsp;<span class="ident" id="7385441">TestIssue6651</span><span class="op" id="7385454">(</span><span class="ident" id="7385455">t</span>&nbsp;<span class="op" id="7385457">*</span><span class="ident" id="7385458"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7385465">.</span><span class="ident" id="7385466">T</span><span class="op" id="7385467">)</span>&nbsp;<span class="op" id="7385469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385472">db</span>&nbsp;<span class="op" id="7385475">:=</span>&nbsp;<span class="ident" id="7385478"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7385487">(</span><span class="ident" id="7385488"><a href="/database/sql/sql_test.go.html#7385455">t</a></span><span class="op" id="7385489">,</span>&nbsp;<span class="string" id="7385491">&#34;people&#34;</span><span class="op" id="7385499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385502">defer</span>&nbsp;<span class="ident" id="7385508"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7385515">(</span><span class="ident" id="7385516"><a href="/database/sql/sql_test.go.html#7385455">t</a></span><span class="op" id="7385517">,</span>&nbsp;<span class="ident" id="7385519"><a href="/database/sql/sql_test.go.html#7385472">db</a></span><span class="op" id="7385521">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385525">var</span>&nbsp;<span class="ident" id="7385529">v</span>&nbsp;<span class="builtintype" id="7385531">string</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385540">want</span>&nbsp;<span class="op" id="7385545">:=</span>&nbsp;<span class="string" id="7385548">&#34;error&nbsp;in&nbsp;rows.Next&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385570"><a href="/database/sql/fakedb_test.go.html#7366108">rowsCursorNextHook</a></span>&nbsp;<span class="op" id="7385589">=</span>&nbsp;<span class="keyword" id="7385591">func</span><span class="op" id="7385595">(</span><span class="ident" id="7385596">dest</span>&nbsp;<span class="op" id="7385601">[</span><span class="op" id="7385602">]</span><span class="ident" id="7385603"><a href="/database/sql/sql_test.go.html#7368898">driver</a></span><span class="op" id="7385609">.</span><span class="ident" id="7385610">Value</span><span class="op" id="7385615">)</span>&nbsp;<span class="builtintype" id="7385617">error</span>&nbsp;<span class="op" id="7385623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385627">return</span>&nbsp;<span class="ident" id="7385634"><a href="/database/sql/sql_test.go.html#7368931">fmt</a></span><span class="op" id="7385637">.</span><span class="ident" id="7385638">Errorf</span><span class="op" id="7385644">(</span><span class="ident" id="7385645"><a href="/database/sql/sql_test.go.html#7385540">want</a></span><span class="op" id="7385649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385652">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385655">defer</span>&nbsp;<span class="keyword" id="7385661">func</span><span class="op" id="7385665">(</span><span class="op" id="7385666">)</span>&nbsp;<span class="op" id="7385668">{</span>&nbsp;<span class="ident" id="7385670"><a href="/database/sql/fakedb_test.go.html#7366108">rowsCursorNextHook</a></span>&nbsp;<span class="op" id="7385689">=</span>&nbsp;<span class="ident" id="7385691">nil</span>&nbsp;<span class="op" id="7385695">}</span><span class="op" id="7385696">(</span><span class="op" id="7385697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385700">err</span>&nbsp;<span class="op" id="7385704">:=</span>&nbsp;<span class="ident" id="7385707"><a href="/database/sql/sql_test.go.html#7385472">db</a></span><span class="op" id="7385709">.</span><span class="ident" id="7385710">QueryRow</span><span class="op" id="7385718">(</span><span class="string" id="7385719">&#34;SELECT|people|name|&#34;</span><span class="op" id="7385740">)</span><span class="op" id="7385741">.</span><span class="ident" id="7385742">Scan</span><span class="op" id="7385746">(</span><span class="op" id="7385747">&amp;</span><span class="ident" id="7385748"><a href="/database/sql/sql_test.go.html#7385529">v</a></span><span class="op" id="7385749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385752">if</span>&nbsp;<span class="ident" id="7385755"><a href="/database/sql/sql_test.go.html#7385700">err</a></span>&nbsp;<span class="op" id="7385759">==</span>&nbsp;<span class="ident" id="7385762">nil</span>&nbsp;<span class="op" id="7385766">||</span>&nbsp;<span class="ident" id="7385769"><a href="/database/sql/sql_test.go.html#7385700">err</a></span><span class="op" id="7385772">.</span><span class="ident" id="7385773">Error</span><span class="op" id="7385778">(</span><span class="op" id="7385779">)</span>&nbsp;<span class="op" id="7385781">!=</span>&nbsp;<span class="ident" id="7385784"><a href="/database/sql/sql_test.go.html#7385540">want</a></span>&nbsp;<span class="op" id="7385789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385793"><a href="/database/sql/sql_test.go.html#7385455">t</a></span><span class="op" id="7385794">.</span><span class="ident" id="7385795">Errorf</span><span class="op" id="7385801">(</span><span class="string" id="7385802">&#34;error&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7385823">,</span>&nbsp;<span class="ident" id="7385825"><a href="/database/sql/sql_test.go.html#7385700">err</a></span><span class="op" id="7385828">,</span>&nbsp;<span class="ident" id="7385830"><a href="/database/sql/sql_test.go.html#7385540">want</a></span><span class="op" id="7385834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385837">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385840"><a href="/database/sql/fakedb_test.go.html#7366108">rowsCursorNextHook</a></span>&nbsp;<span class="op" id="7385859">=</span>&nbsp;<span class="ident" id="7385861">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385867"><a href="/database/sql/sql_test.go.html#7385540">want</a></span>&nbsp;<span class="op" id="7385872">=</span>&nbsp;<span class="string" id="7385874">&#34;error&nbsp;in&nbsp;rows.Close&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385897"><a href="/database/sql/sql.go.html#6391192">rowsCloseHook</a></span>&nbsp;<span class="op" id="7385911">=</span>&nbsp;<span class="keyword" id="7385913">func</span><span class="op" id="7385917">(</span><span class="ident" id="7385918">rows</span>&nbsp;<span class="op" id="7385923">*</span><span class="ident" id="7385924"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="7385928">,</span>&nbsp;<span class="ident" id="7385930">err</span>&nbsp;<span class="op" id="7385934">*</span><span class="builtintype" id="7385935">error</span><span class="op" id="7385940">)</span>&nbsp;<span class="op" id="7385942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385946">*</span><span class="ident" id="7385947"><a href="/database/sql/sql_test.go.html#7385930">err</a></span>&nbsp;<span class="op" id="7385951">=</span>&nbsp;<span class="ident" id="7385953"><a href="/database/sql/sql_test.go.html#7368931">fmt</a></span><span class="op" id="7385956">.</span><span class="ident" id="7385957">Errorf</span><span class="op" id="7385963">(</span><span class="ident" id="7385964"><a href="/database/sql/sql_test.go.html#7385540">want</a></span><span class="op" id="7385968">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385974">defer</span>&nbsp;<span class="keyword" id="7385980">func</span><span class="op" id="7385984">(</span><span class="op" id="7385985">)</span>&nbsp;<span class="op" id="7385987">{</span>&nbsp;<span class="ident" id="7385989"><a href="/database/sql/sql.go.html#6391192">rowsCloseHook</a></span>&nbsp;<span class="op" id="7386003">=</span>&nbsp;<span class="ident" id="7386005">nil</span>&nbsp;<span class="op" id="7386009">}</span><span class="op" id="7386010">(</span><span class="op" id="7386011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386014"><a href="/database/sql/sql_test.go.html#7385700">err</a></span>&nbsp;<span class="op" id="7386018">=</span>&nbsp;<span class="ident" id="7386020"><a href="/database/sql/sql_test.go.html#7385472">db</a></span><span class="op" id="7386022">.</span><span class="ident" id="7386023">QueryRow</span><span class="op" id="7386031">(</span><span class="string" id="7386032">&#34;SELECT|people|name|&#34;</span><span class="op" id="7386053">)</span><span class="op" id="7386054">.</span><span class="ident" id="7386055">Scan</span><span class="op" id="7386059">(</span><span class="op" id="7386060">&amp;</span><span class="ident" id="7386061"><a href="/database/sql/sql_test.go.html#7385529">v</a></span><span class="op" id="7386062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7386065">if</span>&nbsp;<span class="ident" id="7386068"><a href="/database/sql/sql_test.go.html#7385700">err</a></span>&nbsp;<span class="op" id="7386072">==</span>&nbsp;<span class="ident" id="7386075">nil</span>&nbsp;<span class="op" id="7386079">||</span>&nbsp;<span class="ident" id="7386082"><a href="/database/sql/sql_test.go.html#7385700">err</a></span><span class="op" id="7386085">.</span><span class="ident" id="7386086">Error</span><span class="op" id="7386091">(</span><span class="op" id="7386092">)</span>&nbsp;<span class="op" id="7386094">!=</span>&nbsp;<span class="ident" id="7386097"><a href="/database/sql/sql_test.go.html#7385540">want</a></span>&nbsp;<span class="op" id="7386102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386106"><a href="/database/sql/sql_test.go.html#7385455">t</a></span><span class="op" id="7386107">.</span><span class="ident" id="7386108">Errorf</span><span class="op" id="7386114">(</span><span class="string" id="7386115">&#34;error&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7386136">,</span>&nbsp;<span class="ident" id="7386138"><a href="/database/sql/sql_test.go.html#7385700">err</a></span><span class="op" id="7386141">,</span>&nbsp;<span class="ident" id="7386143"><a href="/database/sql/sql_test.go.html#7385540">want</a></span><span class="op" id="7386147">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386150">}</span><br>
<span class="lineno"></span><span class="op" id="7386152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7386155">type</span>&nbsp;<span class="ident" id="7386160">nullTestRow</span>&nbsp;<span class="keyword" id="7386172">struct</span>&nbsp;<span class="op" id="7386179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386182">nullParam</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7386195">interface</span><span class="op" id="7386204">{</span><span class="op" id="7386205">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386208">notNullParam</span>&nbsp;<span class="keyword" id="7386221">interface</span><span class="op" id="7386230">{</span><span class="op" id="7386231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386234">scanNullVal</span>&nbsp;&nbsp;<span class="keyword" id="7386247">interface</span><span class="op" id="7386256">{</span><span class="op" id="7386257">}</span><br>
<span class="lineno"></span><span class="op" id="7386259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7386262">type</span>&nbsp;<span class="ident" id="7386267">nullTestSpec</span>&nbsp;<span class="keyword" id="7386280">struct</span>&nbsp;<span class="op" id="7386287">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386290">nullType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7386302">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386310">notNullType</span>&nbsp;<span class="builtintype" id="7386322">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386330">rows</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7386342">[</span><span class="num" id="7386343">6</span><span class="op" id="7386344">]</span><span class="ident" id="7386345"><a href="/database/sql/sql_test.go.html#7386160">nullTestRow</a></span><br>
<span class="lineno"></span><span class="op" id="7386357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="7386360">func</span>&nbsp;<span class="ident" id="7386365">TestNullStringParam</span><span class="op" id="7386384">(</span><span class="ident" id="7386385">t</span>&nbsp;<span class="op" id="7386387">*</span><span class="ident" id="7386388"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7386395">.</span><span class="ident" id="7386396">T</span><span class="op" id="7386397">)</span>&nbsp;<span class="op" id="7386399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386402">spec</span>&nbsp;<span class="op" id="7386407">:=</span>&nbsp;<span class="ident" id="7386410"><a href="/database/sql/sql_test.go.html#7386267">nullTestSpec</a></span><span class="op" id="7386422">{</span><span class="string" id="7386423">&#34;nullstring&#34;</span><span class="op" id="7386435">,</span>&nbsp;<span class="string" id="7386437">&#34;string&#34;</span><span class="op" id="7386445">,</span>&nbsp;<span class="op" id="7386447">[</span><span class="num" id="7386448">6</span><span class="op" id="7386449">]</span><span class="ident" id="7386450"><a href="/database/sql/sql_test.go.html#7386160">nullTestRow</a></span><span class="op" id="7386461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386465">{</span><span class="ident" id="7386466"><a href="/database/sql/sql.go.html#6350453">NullString</a></span><span class="op" id="7386476">{</span><span class="string" id="7386477">&#34;aqua&#34;</span><span class="op" id="7386483">,</span>&nbsp;<span class="builtintype" id="7386485">true</span><span class="op" id="7386489">}</span><span class="op" id="7386490">,</span>&nbsp;<span class="string" id="7386492">&#34;&#34;</span><span class="op" id="7386494">,</span>&nbsp;<span class="ident" id="7386496"><a href="/database/sql/sql.go.html#6350453">NullString</a></span><span class="op" id="7386506">{</span><span class="string" id="7386507">&#34;aqua&#34;</span><span class="op" id="7386513">,</span>&nbsp;<span class="builtintype" id="7386515">true</span><span class="op" id="7386519">}</span><span class="op" id="7386520">}</span><span class="op" id="7386521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386525">{</span><span class="ident" id="7386526"><a href="/database/sql/sql.go.html#6350453">NullString</a></span><span class="op" id="7386536">{</span><span class="string" id="7386537">&#34;brown&#34;</span><span class="op" id="7386544">,</span>&nbsp;<span class="builtintype" id="7386546">false</span><span class="op" id="7386551">}</span><span class="op" id="7386552">,</span>&nbsp;<span class="string" id="7386554">&#34;&#34;</span><span class="op" id="7386556">,</span>&nbsp;<span class="ident" id="7386558"><a href="/database/sql/sql.go.html#6350453">NullString</a></span><span class="op" id="7386568">{</span><span class="string" id="7386569">&#34;&#34;</span><span class="op" id="7386571">,</span>&nbsp;<span class="builtintype" id="7386573">false</span><span class="op" id="7386578">}</span><span class="op" id="7386579">}</span><span class="op" id="7386580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386584">{</span><span class="string" id="7386585">&#34;chartreuse&#34;</span><span class="op" id="7386597">,</span>&nbsp;<span class="string" id="7386599">&#34;&#34;</span><span class="op" id="7386601">,</span>&nbsp;<span class="ident" id="7386603"><a href="/database/sql/sql.go.html#6350453">NullString</a></span><span class="op" id="7386613">{</span><span class="string" id="7386614">&#34;chartreuse&#34;</span><span class="op" id="7386626">,</span>&nbsp;<span class="builtintype" id="7386628">true</span><span class="op" id="7386632">}</span><span class="op" id="7386633">}</span><span class="op" id="7386634">,</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386638">{</span><span class="ident" id="7386639"><a href="/database/sql/sql.go.html#6350453">NullString</a></span><span class="op" id="7386649">{</span><span class="string" id="7386650">&#34;darkred&#34;</span><span class="op" id="7386659">,</span>&nbsp;<span class="builtintype" id="7386661">true</span><span class="op" id="7386665">}</span><span class="op" id="7386666">,</span>&nbsp;<span class="string" id="7386668">&#34;&#34;</span><span class="op" id="7386670">,</span>&nbsp;<span class="ident" id="7386672"><a href="/database/sql/sql.go.html#6350453">NullString</a></span><span class="op" id="7386682">{</span><span class="string" id="7386683">&#34;darkred&#34;</span><span class="op" id="7386692">,</span>&nbsp;<span class="builtintype" id="7386694">true</span><span class="op" id="7386698">}</span><span class="op" id="7386699">}</span><span class="op" id="7386700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386704">{</span><span class="ident" id="7386705"><a href="/database/sql/sql.go.html#6350453">NullString</a></span><span class="op" id="7386715">{</span><span class="string" id="7386716">&#34;eel&#34;</span><span class="op" id="7386721">,</span>&nbsp;<span class="builtintype" id="7386723">false</span><span class="op" id="7386728">}</span><span class="op" id="7386729">,</span>&nbsp;<span class="string" id="7386731">&#34;&#34;</span><span class="op" id="7386733">,</span>&nbsp;<span class="ident" id="7386735"><a href="/database/sql/sql.go.html#6350453">NullString</a></span><span class="op" id="7386745">{</span><span class="string" id="7386746">&#34;&#34;</span><span class="op" id="7386748">,</span>&nbsp;<span class="builtintype" id="7386750">false</span><span class="op" id="7386755">}</span><span class="op" id="7386756">}</span><span class="op" id="7386757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386761">{</span><span class="string" id="7386762">&#34;foo&#34;</span><span class="op" id="7386767">,</span>&nbsp;<span class="ident" id="7386769"><a href="/database/sql/sql.go.html#6350453">NullString</a></span><span class="op" id="7386779">{</span><span class="string" id="7386780">&#34;black&#34;</span><span class="op" id="7386787">,</span>&nbsp;<span class="builtintype" id="7386789">false</span><span class="op" id="7386794">}</span><span class="op" id="7386795">,</span>&nbsp;<span class="ident" id="7386797">nil</span><span class="op" id="7386800">}</span><span class="op" id="7386801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386804">}</span><span class="op" id="7386805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386808"><a href="/database/sql/sql_test.go.html#7388101">nullTestRun</a></span><span class="op" id="7386819">(</span><span class="ident" id="7386820"><a href="/database/sql/sql_test.go.html#7386385">t</a></span><span class="op" id="7386821">,</span>&nbsp;<span class="ident" id="7386823"><a href="/database/sql/sql_test.go.html#7386402">spec</a></span><span class="op" id="7386827">)</span><br>
<span class="lineno">750</span><span class="op" id="7386829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7386832">func</span>&nbsp;<span class="ident" id="7386837">TestNullInt64Param</span><span class="op" id="7386855">(</span><span class="ident" id="7386856">t</span>&nbsp;<span class="op" id="7386858">*</span><span class="ident" id="7386859"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7386866">.</span><span class="ident" id="7386867">T</span><span class="op" id="7386868">)</span>&nbsp;<span class="op" id="7386870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7386873">spec</span>&nbsp;<span class="op" id="7386878">:=</span>&nbsp;<span class="ident" id="7386881"><a href="/database/sql/sql_test.go.html#7386267">nullTestSpec</a></span><span class="op" id="7386893">{</span><span class="string" id="7386894">&#34;nullint64&#34;</span><span class="op" id="7386905">,</span>&nbsp;<span class="string" id="7386907">&#34;int64&#34;</span><span class="op" id="7386914">,</span>&nbsp;<span class="op" id="7386916">[</span><span class="num" id="7386917">6</span><span class="op" id="7386918">]</span><span class="ident" id="7386919"><a href="/database/sql/sql_test.go.html#7386160">nullTestRow</a></span><span class="op" id="7386930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386934">{</span><span class="ident" id="7386935"><a href="/database/sql/sql.go.html#6351103">NullInt64</a></span><span class="op" id="7386944">{</span><span class="num" id="7386945">31</span><span class="op" id="7386947">,</span>&nbsp;<span class="builtintype" id="7386949">true</span><span class="op" id="7386953">}</span><span class="op" id="7386954">,</span>&nbsp;<span class="num" id="7386956">1</span><span class="op" id="7386957">,</span>&nbsp;<span class="ident" id="7386959"><a href="/database/sql/sql.go.html#6351103">NullInt64</a></span><span class="op" id="7386968">{</span><span class="num" id="7386969">31</span><span class="op" id="7386971">,</span>&nbsp;<span class="builtintype" id="7386973">true</span><span class="op" id="7386977">}</span><span class="op" id="7386978">}</span><span class="op" id="7386979">,</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7386983">{</span><span class="ident" id="7386984"><a href="/database/sql/sql.go.html#6351103">NullInt64</a></span><span class="op" id="7386993">{</span><span class="op" id="7386994">-</span><span class="num" id="7386995">22</span><span class="op" id="7386997">,</span>&nbsp;<span class="builtintype" id="7386999">false</span><span class="op" id="7387004">}</span><span class="op" id="7387005">,</span>&nbsp;<span class="num" id="7387007">1</span><span class="op" id="7387008">,</span>&nbsp;<span class="ident" id="7387010"><a href="/database/sql/sql.go.html#6351103">NullInt64</a></span><span class="op" id="7387019">{</span><span class="num" id="7387020">0</span><span class="op" id="7387021">,</span>&nbsp;<span class="builtintype" id="7387023">false</span><span class="op" id="7387028">}</span><span class="op" id="7387029">}</span><span class="op" id="7387030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387034">{</span><span class="num" id="7387035">22</span><span class="op" id="7387037">,</span>&nbsp;<span class="num" id="7387039">1</span><span class="op" id="7387040">,</span>&nbsp;<span class="ident" id="7387042"><a href="/database/sql/sql.go.html#6351103">NullInt64</a></span><span class="op" id="7387051">{</span><span class="num" id="7387052">22</span><span class="op" id="7387054">,</span>&nbsp;<span class="builtintype" id="7387056">true</span><span class="op" id="7387060">}</span><span class="op" id="7387061">}</span><span class="op" id="7387062">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387066">{</span><span class="ident" id="7387067"><a href="/database/sql/sql.go.html#6351103">NullInt64</a></span><span class="op" id="7387076">{</span><span class="num" id="7387077">33</span><span class="op" id="7387079">,</span>&nbsp;<span class="builtintype" id="7387081">true</span><span class="op" id="7387085">}</span><span class="op" id="7387086">,</span>&nbsp;<span class="num" id="7387088">1</span><span class="op" id="7387089">,</span>&nbsp;<span class="ident" id="7387091"><a href="/database/sql/sql.go.html#6351103">NullInt64</a></span><span class="op" id="7387100">{</span><span class="num" id="7387101">33</span><span class="op" id="7387103">,</span>&nbsp;<span class="builtintype" id="7387105">true</span><span class="op" id="7387109">}</span><span class="op" id="7387110">}</span><span class="op" id="7387111">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387115">{</span><span class="ident" id="7387116"><a href="/database/sql/sql.go.html#6351103">NullInt64</a></span><span class="op" id="7387125">{</span><span class="num" id="7387126">222</span><span class="op" id="7387129">,</span>&nbsp;<span class="builtintype" id="7387131">false</span><span class="op" id="7387136">}</span><span class="op" id="7387137">,</span>&nbsp;<span class="num" id="7387139">1</span><span class="op" id="7387140">,</span>&nbsp;<span class="ident" id="7387142"><a href="/database/sql/sql.go.html#6351103">NullInt64</a></span><span class="op" id="7387151">{</span><span class="num" id="7387152">0</span><span class="op" id="7387153">,</span>&nbsp;<span class="builtintype" id="7387155">false</span><span class="op" id="7387160">}</span><span class="op" id="7387161">}</span><span class="op" id="7387162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387166">{</span><span class="num" id="7387167">0</span><span class="op" id="7387168">,</span>&nbsp;<span class="ident" id="7387170"><a href="/database/sql/sql.go.html#6351103">NullInt64</a></span><span class="op" id="7387179">{</span><span class="num" id="7387180">31</span><span class="op" id="7387182">,</span>&nbsp;<span class="builtintype" id="7387184">false</span><span class="op" id="7387189">}</span><span class="op" id="7387190">,</span>&nbsp;<span class="ident" id="7387192">nil</span><span class="op" id="7387195">}</span><span class="op" id="7387196">,</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387199">}</span><span class="op" id="7387200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387203"><a href="/database/sql/sql_test.go.html#7388101">nullTestRun</a></span><span class="op" id="7387214">(</span><span class="ident" id="7387215"><a href="/database/sql/sql_test.go.html#7386856">t</a></span><span class="op" id="7387216">,</span>&nbsp;<span class="ident" id="7387218"><a href="/database/sql/sql_test.go.html#7386873">spec</a></span><span class="op" id="7387222">)</span><br>
<span class="lineno"></span><span class="op" id="7387224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7387227">func</span>&nbsp;<span class="ident" id="7387232">TestNullFloat64Param</span><span class="op" id="7387252">(</span><span class="ident" id="7387253">t</span>&nbsp;<span class="op" id="7387255">*</span><span class="ident" id="7387256"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7387263">.</span><span class="ident" id="7387264">T</span><span class="op" id="7387265">)</span>&nbsp;<span class="op" id="7387267">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387270">spec</span>&nbsp;<span class="op" id="7387275">:=</span>&nbsp;<span class="ident" id="7387278"><a href="/database/sql/sql_test.go.html#7386267">nullTestSpec</a></span><span class="op" id="7387290">{</span><span class="string" id="7387291">&#34;nullfloat64&#34;</span><span class="op" id="7387304">,</span>&nbsp;<span class="string" id="7387306">&#34;float64&#34;</span><span class="op" id="7387315">,</span>&nbsp;<span class="op" id="7387317">[</span><span class="num" id="7387318">6</span><span class="op" id="7387319">]</span><span class="ident" id="7387320"><a href="/database/sql/sql_test.go.html#7386160">nullTestRow</a></span><span class="op" id="7387331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387335">{</span><span class="ident" id="7387336"><a href="/database/sql/sql.go.html#6351739">NullFloat64</a></span><span class="op" id="7387347">{</span><span class="num" id="7387348">31.2</span><span class="op" id="7387352">,</span>&nbsp;<span class="builtintype" id="7387354">true</span><span class="op" id="7387358">}</span><span class="op" id="7387359">,</span>&nbsp;<span class="num" id="7387361">1</span><span class="op" id="7387362">,</span>&nbsp;<span class="ident" id="7387364"><a href="/database/sql/sql.go.html#6351739">NullFloat64</a></span><span class="op" id="7387375">{</span><span class="num" id="7387376">31.2</span><span class="op" id="7387380">,</span>&nbsp;<span class="builtintype" id="7387382">true</span><span class="op" id="7387386">}</span><span class="op" id="7387387">}</span><span class="op" id="7387388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387392">{</span><span class="ident" id="7387393"><a href="/database/sql/sql.go.html#6351739">NullFloat64</a></span><span class="op" id="7387404">{</span><span class="num" id="7387405">13.1</span><span class="op" id="7387409">,</span>&nbsp;<span class="builtintype" id="7387411">false</span><span class="op" id="7387416">}</span><span class="op" id="7387417">,</span>&nbsp;<span class="num" id="7387419">1</span><span class="op" id="7387420">,</span>&nbsp;<span class="ident" id="7387422"><a href="/database/sql/sql.go.html#6351739">NullFloat64</a></span><span class="op" id="7387433">{</span><span class="num" id="7387434">0</span><span class="op" id="7387435">,</span>&nbsp;<span class="builtintype" id="7387437">false</span><span class="op" id="7387442">}</span><span class="op" id="7387443">}</span><span class="op" id="7387444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387448">{</span><span class="op" id="7387449">-</span><span class="num" id="7387450">22.9</span><span class="op" id="7387454">,</span>&nbsp;<span class="num" id="7387456">1</span><span class="op" id="7387457">,</span>&nbsp;<span class="ident" id="7387459"><a href="/database/sql/sql.go.html#6351739">NullFloat64</a></span><span class="op" id="7387470">{</span><span class="op" id="7387471">-</span><span class="num" id="7387472">22.9</span><span class="op" id="7387476">,</span>&nbsp;<span class="builtintype" id="7387478">true</span><span class="op" id="7387482">}</span><span class="op" id="7387483">}</span><span class="op" id="7387484">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387488">{</span><span class="ident" id="7387489"><a href="/database/sql/sql.go.html#6351739">NullFloat64</a></span><span class="op" id="7387500">{</span><span class="num" id="7387501">33.81</span><span class="op" id="7387506">,</span>&nbsp;<span class="builtintype" id="7387508">true</span><span class="op" id="7387512">}</span><span class="op" id="7387513">,</span>&nbsp;<span class="num" id="7387515">1</span><span class="op" id="7387516">,</span>&nbsp;<span class="ident" id="7387518"><a href="/database/sql/sql.go.html#6351739">NullFloat64</a></span><span class="op" id="7387529">{</span><span class="num" id="7387530">33.81</span><span class="op" id="7387535">,</span>&nbsp;<span class="builtintype" id="7387537">true</span><span class="op" id="7387541">}</span><span class="op" id="7387542">}</span><span class="op" id="7387543">,</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387547">{</span><span class="ident" id="7387548"><a href="/database/sql/sql.go.html#6351739">NullFloat64</a></span><span class="op" id="7387559">{</span><span class="num" id="7387560">222</span><span class="op" id="7387563">,</span>&nbsp;<span class="builtintype" id="7387565">false</span><span class="op" id="7387570">}</span><span class="op" id="7387571">,</span>&nbsp;<span class="num" id="7387573">1</span><span class="op" id="7387574">,</span>&nbsp;<span class="ident" id="7387576"><a href="/database/sql/sql.go.html#6351739">NullFloat64</a></span><span class="op" id="7387587">{</span><span class="num" id="7387588">0</span><span class="op" id="7387589">,</span>&nbsp;<span class="builtintype" id="7387591">false</span><span class="op" id="7387596">}</span><span class="op" id="7387597">}</span><span class="op" id="7387598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387602">{</span><span class="num" id="7387603">10</span><span class="op" id="7387605">,</span>&nbsp;<span class="ident" id="7387607"><a href="/database/sql/sql.go.html#6351739">NullFloat64</a></span><span class="op" id="7387618">{</span><span class="num" id="7387619">31.2</span><span class="op" id="7387623">,</span>&nbsp;<span class="builtintype" id="7387625">false</span><span class="op" id="7387630">}</span><span class="op" id="7387631">,</span>&nbsp;<span class="ident" id="7387633">nil</span><span class="op" id="7387636">}</span><span class="op" id="7387637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387640">}</span><span class="op" id="7387641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387644"><a href="/database/sql/sql_test.go.html#7388101">nullTestRun</a></span><span class="op" id="7387655">(</span><span class="ident" id="7387656"><a href="/database/sql/sql_test.go.html#7387253">t</a></span><span class="op" id="7387657">,</span>&nbsp;<span class="ident" id="7387659"><a href="/database/sql/sql_test.go.html#7387270">spec</a></span><span class="op" id="7387663">)</span><br>
<span class="lineno"></span><span class="op" id="7387665">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="keyword" id="7387668">func</span>&nbsp;<span class="ident" id="7387673">TestNullBoolParam</span><span class="op" id="7387690">(</span><span class="ident" id="7387691">t</span>&nbsp;<span class="op" id="7387693">*</span><span class="ident" id="7387694"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7387701">.</span><span class="ident" id="7387702">T</span><span class="op" id="7387703">)</span>&nbsp;<span class="op" id="7387705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7387708">spec</span>&nbsp;<span class="op" id="7387713">:=</span>&nbsp;<span class="ident" id="7387716"><a href="/database/sql/sql_test.go.html#7386267">nullTestSpec</a></span><span class="op" id="7387728">{</span><span class="string" id="7387729">&#34;nullbool&#34;</span><span class="op" id="7387739">,</span>&nbsp;<span class="string" id="7387741">&#34;bool&#34;</span><span class="op" id="7387747">,</span>&nbsp;<span class="op" id="7387749">[</span><span class="num" id="7387750">6</span><span class="op" id="7387751">]</span><span class="ident" id="7387752"><a href="/database/sql/sql_test.go.html#7386160">nullTestRow</a></span><span class="op" id="7387763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387767">{</span><span class="ident" id="7387768"><a href="/database/sql/sql.go.html#6352386">NullBool</a></span><span class="op" id="7387776">{</span><span class="builtintype" id="7387777">false</span><span class="op" id="7387782">,</span>&nbsp;<span class="builtintype" id="7387784">true</span><span class="op" id="7387788">}</span><span class="op" id="7387789">,</span>&nbsp;<span class="builtintype" id="7387791">true</span><span class="op" id="7387795">,</span>&nbsp;<span class="ident" id="7387797"><a href="/database/sql/sql.go.html#6352386">NullBool</a></span><span class="op" id="7387805">{</span><span class="builtintype" id="7387806">false</span><span class="op" id="7387811">,</span>&nbsp;<span class="builtintype" id="7387813">true</span><span class="op" id="7387817">}</span><span class="op" id="7387818">}</span><span class="op" id="7387819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387823">{</span><span class="ident" id="7387824"><a href="/database/sql/sql.go.html#6352386">NullBool</a></span><span class="op" id="7387832">{</span><span class="builtintype" id="7387833">true</span><span class="op" id="7387837">,</span>&nbsp;<span class="builtintype" id="7387839">false</span><span class="op" id="7387844">}</span><span class="op" id="7387845">,</span>&nbsp;<span class="builtintype" id="7387847">false</span><span class="op" id="7387852">,</span>&nbsp;<span class="ident" id="7387854"><a href="/database/sql/sql.go.html#6352386">NullBool</a></span><span class="op" id="7387862">{</span><span class="builtintype" id="7387863">false</span><span class="op" id="7387868">,</span>&nbsp;<span class="builtintype" id="7387870">false</span><span class="op" id="7387875">}</span><span class="op" id="7387876">}</span><span class="op" id="7387877">,</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387881">{</span><span class="builtintype" id="7387882">true</span><span class="op" id="7387886">,</span>&nbsp;<span class="builtintype" id="7387888">true</span><span class="op" id="7387892">,</span>&nbsp;<span class="ident" id="7387894"><a href="/database/sql/sql.go.html#6352386">NullBool</a></span><span class="op" id="7387902">{</span><span class="builtintype" id="7387903">true</span><span class="op" id="7387907">,</span>&nbsp;<span class="builtintype" id="7387909">true</span><span class="op" id="7387913">}</span><span class="op" id="7387914">}</span><span class="op" id="7387915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387919">{</span><span class="ident" id="7387920"><a href="/database/sql/sql.go.html#6352386">NullBool</a></span><span class="op" id="7387928">{</span><span class="builtintype" id="7387929">true</span><span class="op" id="7387933">,</span>&nbsp;<span class="builtintype" id="7387935">true</span><span class="op" id="7387939">}</span><span class="op" id="7387940">,</span>&nbsp;<span class="builtintype" id="7387942">false</span><span class="op" id="7387947">,</span>&nbsp;<span class="ident" id="7387949"><a href="/database/sql/sql.go.html#6352386">NullBool</a></span><span class="op" id="7387957">{</span><span class="builtintype" id="7387958">true</span><span class="op" id="7387962">,</span>&nbsp;<span class="builtintype" id="7387964">true</span><span class="op" id="7387968">}</span><span class="op" id="7387969">}</span><span class="op" id="7387970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7387974">{</span><span class="ident" id="7387975"><a href="/database/sql/sql.go.html#6352386">NullBool</a></span><span class="op" id="7387983">{</span><span class="builtintype" id="7387984">true</span><span class="op" id="7387988">,</span>&nbsp;<span class="builtintype" id="7387990">false</span><span class="op" id="7387995">}</span><span class="op" id="7387996">,</span>&nbsp;<span class="builtintype" id="7387998">true</span><span class="op" id="7388002">,</span>&nbsp;<span class="ident" id="7388004"><a href="/database/sql/sql.go.html#6352386">NullBool</a></span><span class="op" id="7388012">{</span><span class="builtintype" id="7388013">false</span><span class="op" id="7388018">,</span>&nbsp;<span class="builtintype" id="7388020">false</span><span class="op" id="7388025">}</span><span class="op" id="7388026">}</span><span class="op" id="7388027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7388031">{</span><span class="builtintype" id="7388032">true</span><span class="op" id="7388036">,</span>&nbsp;<span class="ident" id="7388038"><a href="/database/sql/sql.go.html#6352386">NullBool</a></span><span class="op" id="7388046">{</span><span class="builtintype" id="7388047">true</span><span class="op" id="7388051">,</span>&nbsp;<span class="builtintype" id="7388053">false</span><span class="op" id="7388058">}</span><span class="op" id="7388059">,</span>&nbsp;<span class="ident" id="7388061">nil</span><span class="op" id="7388064">}</span><span class="op" id="7388065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7388068">}</span><span class="op" id="7388069">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7388072"><a href="/database/sql/sql_test.go.html#7388101">nullTestRun</a></span><span class="op" id="7388083">(</span><span class="ident" id="7388084"><a href="/database/sql/sql_test.go.html#7387691">t</a></span><span class="op" id="7388085">,</span>&nbsp;<span class="ident" id="7388087"><a href="/database/sql/sql_test.go.html#7387708">spec</a></span><span class="op" id="7388091">)</span><br>
<span class="lineno"></span><span class="op" id="7388093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7388096">func</span>&nbsp;<span class="ident" id="7388101">nullTestRun</span><span class="op" id="7388112">(</span><span class="ident" id="7388113">t</span>&nbsp;<span class="op" id="7388115">*</span><span class="ident" id="7388116"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7388123">.</span><span class="ident" id="7388124">T</span><span class="op" id="7388125">,</span>&nbsp;<span class="ident" id="7388127">spec</span>&nbsp;<span class="ident" id="7388132"><a href="/database/sql/sql_test.go.html#7386267">nullTestSpec</a></span><span class="op" id="7388144">)</span>&nbsp;<span class="op" id="7388146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7388149">db</span>&nbsp;<span class="op" id="7388152">:=</span>&nbsp;<span class="ident" id="7388155"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7388164">(</span><span class="ident" id="7388165"><a href="/database/sql/sql_test.go.html#7388113">t</a></span><span class="op" id="7388166">,</span>&nbsp;<span class="string" id="7388168">&#34;&#34;</span><span class="op" id="7388170">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7388173">defer</span>&nbsp;<span class="ident" id="7388179"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7388186">(</span><span class="ident" id="7388187"><a href="/database/sql/sql_test.go.html#7388113">t</a></span><span class="op" id="7388188">,</span>&nbsp;<span class="ident" id="7388190"><a href="/database/sql/sql_test.go.html#7388149">db</a></span><span class="op" id="7388192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7388195"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7388199">(</span><span class="ident" id="7388200"><a href="/database/sql/sql_test.go.html#7388113">t</a></span><span class="op" id="7388201">,</span>&nbsp;<span class="ident" id="7388203"><a href="/database/sql/sql_test.go.html#7388149">db</a></span><span class="op" id="7388205">,</span>&nbsp;<span class="ident" id="7388207"><a href="/database/sql/sql_test.go.html#7368931">fmt</a></span><span class="op" id="7388210">.</span><span class="ident" id="7388211">Sprintf</span><span class="op" id="7388218">(</span><span class="string" id="7388219">&#34;CREATE|t|id=int32,name=string,nullf=%s,notnullf=%s&#34;</span><span class="op" id="7388271">,</span>&nbsp;<span class="ident" id="7388273"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7388277">.</span><span class="ident" id="7388278">nullType</span><span class="op" id="7388286">,</span>&nbsp;<span class="ident" id="7388288"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7388292">.</span><span class="ident" id="7388293">notNullType</span><span class="op" id="7388304">)</span><span class="op" id="7388305">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7388309">//&nbsp;Inserts&nbsp;with&nbsp;db.Exec:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7388335"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7388339">(</span><span class="ident" id="7388340"><a href="/database/sql/sql_test.go.html#7388113">t</a></span><span class="op" id="7388341">,</span>&nbsp;<span class="ident" id="7388343"><a href="/database/sql/sql_test.go.html#7388149">db</a></span><span class="op" id="7388345">,</span>&nbsp;<span class="string" id="7388347">&#34;INSERT|t|id=?,name=?,nullf=?,notnullf=?&#34;</span><span class="op" id="7388388">,</span>&nbsp;<span class="num" id="7388390">1</span><span class="op" id="7388391">,</span>&nbsp;<span class="string" id="7388393">&#34;alice&#34;</span><span class="op" id="7388400">,</span>&nbsp;<span class="ident" id="7388402"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7388406">.</span><span class="ident" id="7388407">rows</span><span class="op" id="7388411">[</span><span class="num" id="7388412">0</span><span class="op" id="7388413">]</span><span class="op" id="7388414">.</span><span class="ident" id="7388415">nullParam</span><span class="op" id="7388424">,</span>&nbsp;<span class="ident" id="7388426"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7388430">.</span><span class="ident" id="7388431">rows</span><span class="op" id="7388435">[</span><span class="num" id="7388436">0</span><span class="op" id="7388437">]</span><span class="op" id="7388438">.</span><span class="ident" id="7388439">notNullParam</span><span class="op" id="7388451">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7388454"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7388458">(</span><span class="ident" id="7388459"><a href="/database/sql/sql_test.go.html#7388113">t</a></span><span class="op" id="7388460">,</span>&nbsp;<span class="ident" id="7388462"><a href="/database/sql/sql_test.go.html#7388149">db</a></span><span class="op" id="7388464">,</span>&nbsp;<span class="string" id="7388466">&#34;INSERT|t|id=?,name=?,nullf=?,notnullf=?&#34;</span><span class="op" id="7388507">,</span>&nbsp;<span class="num" id="7388509">2</span><span class="op" id="7388510">,</span>&nbsp;<span class="string" id="7388512">&#34;bob&#34;</span><span class="op" id="7388517">,</span>&nbsp;<span class="ident" id="7388519"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7388523">.</span><span class="ident" id="7388524">rows</span><span class="op" id="7388528">[</span><span class="num" id="7388529">1</span><span class="op" id="7388530">]</span><span class="op" id="7388531">.</span><span class="ident" id="7388532">nullParam</span><span class="op" id="7388541">,</span>&nbsp;<span class="ident" id="7388543"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7388547">.</span><span class="ident" id="7388548">rows</span><span class="op" id="7388552">[</span><span class="num" id="7388553">1</span><span class="op" id="7388554">]</span><span class="op" id="7388555">.</span><span class="ident" id="7388556">notNullParam</span><span class="op" id="7388568">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7388572">//&nbsp;Inserts&nbsp;with&nbsp;a&nbsp;prepared&nbsp;statement:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7388611">stmt</span><span class="op" id="7388615">,</span>&nbsp;<span class="ident" id="7388617">err</span>&nbsp;<span class="op" id="7388621">:=</span>&nbsp;<span class="ident" id="7388624"><a href="/database/sql/sql_test.go.html#7388149">db</a></span><span class="op" id="7388626">.</span><span class="ident" id="7388627">Prepare</span><span class="op" id="7388634">(</span><span class="string" id="7388635">&#34;INSERT|t|id=?,name=?,nullf=?,notnullf=?&#34;</span><span class="op" id="7388676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7388679">if</span>&nbsp;<span class="ident" id="7388682"><a href="/database/sql/sql_test.go.html#7388617">err</a></span>&nbsp;<span class="op" id="7388686">!=</span>&nbsp;<span class="ident" id="7388689">nil</span>&nbsp;<span class="op" id="7388693">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7388697"><a href="/database/sql/sql_test.go.html#7388113">t</a></span><span class="op" id="7388698">.</span><span class="ident" id="7388699">Fatalf</span><span class="op" id="7388705">(</span><span class="string" id="7388706">&#34;prepare:&nbsp;%v&#34;</span><span class="op" id="7388719">,</span>&nbsp;<span class="ident" id="7388721"><a href="/database/sql/sql_test.go.html#7388617">err</a></span><span class="op" id="7388724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7388727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7388730">defer</span>&nbsp;<span class="ident" id="7388736"><a href="/database/sql/sql_test.go.html#7388611">stmt</a></span><span class="op" id="7388740">.</span><span class="ident" id="7388741">Close</span><span class="op" id="7388746">(</span><span class="op" id="7388747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7388750">if</span>&nbsp;<span class="ident" id="7388753">_</span><span class="op" id="7388754">,</span>&nbsp;<span class="ident" id="7388756">err</span>&nbsp;<span class="op" id="7388760">:=</span>&nbsp;<span class="ident" id="7388763"><a href="/database/sql/sql_test.go.html#7388611">stmt</a></span><span class="op" id="7388767">.</span><span class="ident" id="7388768">Exec</span><span class="op" id="7388772">(</span><span class="num" id="7388773">3</span><span class="op" id="7388774">,</span>&nbsp;<span class="string" id="7388776">&#34;chris&#34;</span><span class="op" id="7388783">,</span>&nbsp;<span class="ident" id="7388785"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7388789">.</span><span class="ident" id="7388790">rows</span><span class="op" id="7388794">[</span><span class="num" id="7388795">2</span><span class="op" id="7388796">]</span><span class="op" id="7388797">.</span><span class="ident" id="7388798">nullParam</span><span class="op" id="7388807">,</span>&nbsp;<span class="ident" id="7388809"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7388813">.</span><span class="ident" id="7388814">rows</span><span class="op" id="7388818">[</span><span class="num" id="7388819">2</span><span class="op" id="7388820">]</span><span class="op" id="7388821">.</span><span class="ident" id="7388822">notNullParam</span><span class="op" id="7388834">)</span><span class="op" id="7388835">;</span>&nbsp;<span class="ident" id="7388837"><a href="/database/sql/sql_test.go.html#7388756">err</a></span>&nbsp;<span class="op" id="7388841">!=</span>&nbsp;<span class="ident" id="7388844">nil</span>&nbsp;<span class="op" id="7388848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7388852"><a href="/database/sql/sql_test.go.html#7388113">t</a></span><span class="op" id="7388853">.</span><span class="ident" id="7388854">Errorf</span><span class="op" id="7388860">(</span><span class="string" id="7388861">&#34;exec&nbsp;insert&nbsp;chris:&nbsp;%v&#34;</span><span class="op" id="7388884">,</span>&nbsp;<span class="ident" id="7388886"><a href="/database/sql/sql_test.go.html#7388756">err</a></span><span class="op" id="7388889">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7388892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7388895">if</span>&nbsp;<span class="ident" id="7388898">_</span><span class="op" id="7388899">,</span>&nbsp;<span class="ident" id="7388901">err</span>&nbsp;<span class="op" id="7388905">:=</span>&nbsp;<span class="ident" id="7388908"><a href="/database/sql/sql_test.go.html#7388611">stmt</a></span><span class="op" id="7388912">.</span><span class="ident" id="7388913">Exec</span><span class="op" id="7388917">(</span><span class="num" id="7388918">4</span><span class="op" id="7388919">,</span>&nbsp;<span class="string" id="7388921">&#34;dave&#34;</span><span class="op" id="7388927">,</span>&nbsp;<span class="ident" id="7388929"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7388933">.</span><span class="ident" id="7388934">rows</span><span class="op" id="7388938">[</span><span class="num" id="7388939">3</span><span class="op" id="7388940">]</span><span class="op" id="7388941">.</span><span class="ident" id="7388942">nullParam</span><span class="op" id="7388951">,</span>&nbsp;<span class="ident" id="7388953"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7388957">.</span><span class="ident" id="7388958">rows</span><span class="op" id="7388962">[</span><span class="num" id="7388963">3</span><span class="op" id="7388964">]</span><span class="op" id="7388965">.</span><span class="ident" id="7388966">notNullParam</span><span class="op" id="7388978">)</span><span class="op" id="7388979">;</span>&nbsp;<span class="ident" id="7388981"><a href="/database/sql/sql_test.go.html#7388901">err</a></span>&nbsp;<span class="op" id="7388985">!=</span>&nbsp;<span class="ident" id="7388988">nil</span>&nbsp;<span class="op" id="7388992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7388996"><a href="/database/sql/sql_test.go.html#7388113">t</a></span><span class="op" id="7388997">.</span><span class="ident" id="7388998">Errorf</span><span class="op" id="7389004">(</span><span class="string" id="7389005">&#34;exec&nbsp;insert&nbsp;dave:&nbsp;%v&#34;</span><span class="op" id="7389027">,</span>&nbsp;<span class="ident" id="7389029"><a href="/database/sql/sql_test.go.html#7388901">err</a></span><span class="op" id="7389032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7389035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7389038">if</span>&nbsp;<span class="ident" id="7389041">_</span><span class="op" id="7389042">,</span>&nbsp;<span class="ident" id="7389044">err</span>&nbsp;<span class="op" id="7389048">:=</span>&nbsp;<span class="ident" id="7389051"><a href="/database/sql/sql_test.go.html#7388611">stmt</a></span><span class="op" id="7389055">.</span><span class="ident" id="7389056">Exec</span><span class="op" id="7389060">(</span><span class="num" id="7389061">5</span><span class="op" id="7389062">,</span>&nbsp;<span class="string" id="7389064">&#34;eleanor&#34;</span><span class="op" id="7389073">,</span>&nbsp;<span class="ident" id="7389075"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7389079">.</span><span class="ident" id="7389080">rows</span><span class="op" id="7389084">[</span><span class="num" id="7389085">4</span><span class="op" id="7389086">]</span><span class="op" id="7389087">.</span><span class="ident" id="7389088">nullParam</span><span class="op" id="7389097">,</span>&nbsp;<span class="ident" id="7389099"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7389103">.</span><span class="ident" id="7389104">rows</span><span class="op" id="7389108">[</span><span class="num" id="7389109">4</span><span class="op" id="7389110">]</span><span class="op" id="7389111">.</span><span class="ident" id="7389112">notNullParam</span><span class="op" id="7389124">)</span><span class="op" id="7389125">;</span>&nbsp;<span class="ident" id="7389127"><a href="/database/sql/sql_test.go.html#7389044">err</a></span>&nbsp;<span class="op" id="7389131">!=</span>&nbsp;<span class="ident" id="7389134">nil</span>&nbsp;<span class="op" id="7389138">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7389142"><a href="/database/sql/sql_test.go.html#7388113">t</a></span><span class="op" id="7389143">.</span><span class="ident" id="7389144">Errorf</span><span class="op" id="7389150">(</span><span class="string" id="7389151">&#34;exec&nbsp;insert&nbsp;eleanor:&nbsp;%v&#34;</span><span class="op" id="7389176">,</span>&nbsp;<span class="ident" id="7389178"><a href="/database/sql/sql_test.go.html#7389044">err</a></span><span class="op" id="7389181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7389184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7389188">//&nbsp;Can&#39;t&nbsp;put&nbsp;null&nbsp;val&nbsp;into&nbsp;non-null&nbsp;col</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7389229">if</span>&nbsp;<span class="ident" id="7389232">_</span><span class="op" id="7389233">,</span>&nbsp;<span class="ident" id="7389235">err</span>&nbsp;<span class="op" id="7389239">:=</span>&nbsp;<span class="ident" id="7389242"><a href="/database/sql/sql_test.go.html#7388611">stmt</a></span><span class="op" id="7389246">.</span><span class="ident" id="7389247">Exec</span><span class="op" id="7389251">(</span><span class="num" id="7389252">6</span><span class="op" id="7389253">,</span>&nbsp;<span class="string" id="7389255">&#34;bob&#34;</span><span class="op" id="7389260">,</span>&nbsp;<span class="ident" id="7389262"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7389266">.</span><span class="ident" id="7389267">rows</span><span class="op" id="7389271">[</span><span class="num" id="7389272">5</span><span class="op" id="7389273">]</span><span class="op" id="7389274">.</span><span class="ident" id="7389275">nullParam</span><span class="op" id="7389284">,</span>&nbsp;<span class="ident" id="7389286"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7389290">.</span><span class="ident" id="7389291">rows</span><span class="op" id="7389295">[</span><span class="num" id="7389296">5</span><span class="op" id="7389297">]</span><span class="op" id="7389298">.</span><span class="ident" id="7389299">notNullParam</span><span class="op" id="7389311">)</span><span class="op" id="7389312">;</span>&nbsp;<span class="ident" id="7389314"><a href="/database/sql/sql_test.go.html#7389235">err</a></span>&nbsp;<span class="op" id="7389318">==</span>&nbsp;<span class="ident" id="7389321">nil</span>&nbsp;<span class="op" id="7389325">{</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7389329"><a href="/database/sql/sql_test.go.html#7388113">t</a></span><span class="op" id="7389330">.</span><span class="ident" id="7389331">Errorf</span><span class="op" id="7389337">(</span><span class="string" id="7389338">&#34;expected&nbsp;error&nbsp;inserting&nbsp;nil&nbsp;val&nbsp;with&nbsp;prepared&nbsp;statement&nbsp;Exec&#34;</span><span class="op" id="7389401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7389404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7389408">_</span><span class="op" id="7389409">,</span>&nbsp;<span class="ident" id="7389411"><a href="/database/sql/sql_test.go.html#7388617">err</a></span>&nbsp;<span class="op" id="7389415">=</span>&nbsp;<span class="ident" id="7389417"><a href="/database/sql/sql_test.go.html#7388149">db</a></span><span class="op" id="7389419">.</span><span class="ident" id="7389420">Exec</span><span class="op" id="7389424">(</span><span class="string" id="7389425">&#34;INSERT|t|id=?,name=?,nullf=?&#34;</span><span class="op" id="7389455">,</span>&nbsp;<span class="num" id="7389457">999</span><span class="op" id="7389460">,</span>&nbsp;<span class="ident" id="7389462">nil</span><span class="op" id="7389465">,</span>&nbsp;<span class="ident" id="7389467">nil</span><span class="op" id="7389470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7389473">if</span>&nbsp;<span class="ident" id="7389476"><a href="/database/sql/sql_test.go.html#7388617">err</a></span>&nbsp;<span class="op" id="7389480">==</span>&nbsp;<span class="ident" id="7389483">nil</span>&nbsp;<span class="op" id="7389487">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7389491">//&nbsp;TODO:&nbsp;this&nbsp;test&nbsp;fails,&nbsp;but&nbsp;it&#39;s&nbsp;just&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7389541">//&nbsp;fakeConn&nbsp;implements&nbsp;the&nbsp;optional&nbsp;Execer&nbsp;interface,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7389597">//&nbsp;so&nbsp;arguably&nbsp;this&nbsp;is&nbsp;the&nbsp;correct&nbsp;behavior.&nbsp;&nbsp;But</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7389649">//&nbsp;maybe&nbsp;I&nbsp;should&nbsp;flesh&nbsp;out&nbsp;the&nbsp;fakeConn.Exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7389697">//&nbsp;implementation&nbsp;so&nbsp;this&nbsp;properly&nbsp;fails.</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7389741">//&nbsp;t.Errorf(&#34;expected&nbsp;error&nbsp;inserting&nbsp;nil&nbsp;name&nbsp;with&nbsp;Exec&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7389801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7389805">paramtype</span>&nbsp;<span class="op" id="7389815">:=</span>&nbsp;<span class="ident" id="7389818"><a href="/database/sql/sql_test.go.html#7368951">reflect</a></span><span class="op" id="7389825">.</span><span class="ident" id="7389826">TypeOf</span><span class="op" id="7389832">(</span><span class="ident" id="7389833"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7389837">.</span><span class="ident" id="7389838">rows</span><span class="op" id="7389842">[</span><span class="num" id="7389843">0</span><span class="op" id="7389844">]</span><span class="op" id="7389845">.</span><span class="ident" id="7389846">nullParam</span><span class="op" id="7389855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7389858">bindVal</span>&nbsp;<span class="op" id="7389866">:=</span>&nbsp;<span class="ident" id="7389869"><a href="/database/sql/sql_test.go.html#7368951">reflect</a></span><span class="op" id="7389876">.</span><span class="ident" id="7389877">New</span><span class="op" id="7389880">(</span><span class="ident" id="7389881"><a href="/database/sql/sql_test.go.html#7389805">paramtype</a></span><span class="op" id="7389890">)</span><span class="op" id="7389891">.</span><span class="ident" id="7389892">Interface</span><span class="op" id="7389901">(</span><span class="op" id="7389902">)</span><br>
<span class="lineno">830</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7389906">for</span>&nbsp;<span class="ident" id="7389910">i</span>&nbsp;<span class="op" id="7389912">:=</span>&nbsp;<span class="num" id="7389915">0</span><span class="op" id="7389916">;</span>&nbsp;<span class="ident" id="7389918"><a href="/database/sql/sql_test.go.html#7389910">i</a></span>&nbsp;<span class="op" id="7389920">&lt;</span>&nbsp;<span class="num" id="7389922">5</span><span class="op" id="7389923">;</span>&nbsp;<span class="ident" id="7389925"><a href="/database/sql/sql_test.go.html#7389910">i</a></span><span class="op" id="7389926">++</span>&nbsp;<span class="op" id="7389929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7389933">id</span>&nbsp;<span class="op" id="7389936">:=</span>&nbsp;<span class="ident" id="7389939"><a href="/database/sql/sql_test.go.html#7389910">i</a></span>&nbsp;<span class="op" id="7389941">+</span>&nbsp;<span class="num" id="7389943">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7389947">if</span>&nbsp;<span class="ident" id="7389950">err</span>&nbsp;<span class="op" id="7389954">:=</span>&nbsp;<span class="ident" id="7389957"><a href="/database/sql/sql_test.go.html#7388149">db</a></span><span class="op" id="7389959">.</span><span class="ident" id="7389960">QueryRow</span><span class="op" id="7389968">(</span><span class="string" id="7389969">&#34;SELECT|t|nullf|id=?&#34;</span><span class="op" id="7389990">,</span>&nbsp;<span class="ident" id="7389992"><a href="/database/sql/sql_test.go.html#7389933">id</a></span><span class="op" id="7389994">)</span><span class="op" id="7389995">.</span><span class="ident" id="7389996">Scan</span><span class="op" id="7390000">(</span><span class="ident" id="7390001"><a href="/database/sql/sql_test.go.html#7389858">bindVal</a></span><span class="op" id="7390008">)</span><span class="op" id="7390009">;</span>&nbsp;<span class="ident" id="7390011"><a href="/database/sql/sql_test.go.html#7389950">err</a></span>&nbsp;<span class="op" id="7390015">!=</span>&nbsp;<span class="ident" id="7390018">nil</span>&nbsp;<span class="op" id="7390022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7390027"><a href="/database/sql/sql_test.go.html#7388113">t</a></span><span class="op" id="7390028">.</span><span class="ident" id="7390029">Errorf</span><span class="op" id="7390035">(</span><span class="string" id="7390036">&#34;id=%d&nbsp;Scan:&nbsp;%v&#34;</span><span class="op" id="7390052">,</span>&nbsp;<span class="ident" id="7390054"><a href="/database/sql/sql_test.go.html#7389933">id</a></span><span class="op" id="7390056">,</span>&nbsp;<span class="ident" id="7390058"><a href="/database/sql/sql_test.go.html#7389950">err</a></span><span class="op" id="7390061">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7390065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7390069">bindValDeref</span>&nbsp;<span class="op" id="7390082">:=</span>&nbsp;<span class="ident" id="7390085"><a href="/database/sql/sql_test.go.html#7368951">reflect</a></span><span class="op" id="7390092">.</span><span class="ident" id="7390093">ValueOf</span><span class="op" id="7390100">(</span><span class="ident" id="7390101"><a href="/database/sql/sql_test.go.html#7389858">bindVal</a></span><span class="op" id="7390108">)</span><span class="op" id="7390109">.</span><span class="ident" id="7390110">Elem</span><span class="op" id="7390114">(</span><span class="op" id="7390115">)</span><span class="op" id="7390116">.</span><span class="ident" id="7390117">Interface</span><span class="op" id="7390126">(</span><span class="op" id="7390127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7390131">if</span>&nbsp;<span class="op" id="7390134">!</span><span class="ident" id="7390135"><a href="/database/sql/sql_test.go.html#7368951">reflect</a></span><span class="op" id="7390142">.</span><span class="ident" id="7390143">DeepEqual</span><span class="op" id="7390152">(</span><span class="ident" id="7390153"><a href="/database/sql/sql_test.go.html#7390069">bindValDeref</a></span><span class="op" id="7390165">,</span>&nbsp;<span class="ident" id="7390167"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7390171">.</span><span class="ident" id="7390172">rows</span><span class="op" id="7390176">[</span><span class="ident" id="7390177"><a href="/database/sql/sql_test.go.html#7389910">i</a></span><span class="op" id="7390178">]</span><span class="op" id="7390179">.</span><span class="ident" id="7390180">scanNullVal</span><span class="op" id="7390191">)</span>&nbsp;<span class="op" id="7390193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7390198"><a href="/database/sql/sql_test.go.html#7388113">t</a></span><span class="op" id="7390199">.</span><span class="ident" id="7390200">Errorf</span><span class="op" id="7390206">(</span><span class="string" id="7390207">&#34;id=%d&nbsp;got&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="7390232">,</span>&nbsp;<span class="ident" id="7390234"><a href="/database/sql/sql_test.go.html#7389933">id</a></span><span class="op" id="7390236">,</span>&nbsp;<span class="ident" id="7390238"><a href="/database/sql/sql_test.go.html#7390069">bindValDeref</a></span><span class="op" id="7390250">,</span>&nbsp;<span class="ident" id="7390252"><a href="/database/sql/sql_test.go.html#7388127">spec</a></span><span class="op" id="7390256">.</span><span class="ident" id="7390257">rows</span><span class="op" id="7390261">[</span><span class="ident" id="7390262"><a href="/database/sql/sql_test.go.html#7389910">i</a></span><span class="op" id="7390263">]</span><span class="op" id="7390264">.</span><span class="ident" id="7390265">scanNullVal</span><span class="op" id="7390276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7390280">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7390283">}</span><br>
<span class="lineno"></span><span class="op" id="7390285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7390288">//&nbsp;golang.org/issue/4859</span><br>
<span class="lineno"></span><span class="keyword" id="7390313">func</span>&nbsp;<span class="ident" id="7390318">TestQueryRowNilScanDest</span><span class="op" id="7390341">(</span><span class="ident" id="7390342">t</span>&nbsp;<span class="op" id="7390344">*</span><span class="ident" id="7390345"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7390352">.</span><span class="ident" id="7390353">T</span><span class="op" id="7390354">)</span>&nbsp;<span class="op" id="7390356">{</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7390359">db</span>&nbsp;<span class="op" id="7390362">:=</span>&nbsp;<span class="ident" id="7390365"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7390374">(</span><span class="ident" id="7390375"><a href="/database/sql/sql_test.go.html#7390342">t</a></span><span class="op" id="7390376">,</span>&nbsp;<span class="string" id="7390378">&#34;people&#34;</span><span class="op" id="7390386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7390389">defer</span>&nbsp;<span class="ident" id="7390395"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7390402">(</span><span class="ident" id="7390403"><a href="/database/sql/sql_test.go.html#7390342">t</a></span><span class="op" id="7390404">,</span>&nbsp;<span class="ident" id="7390406"><a href="/database/sql/sql_test.go.html#7390359">db</a></span><span class="op" id="7390408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7390411">var</span>&nbsp;<span class="ident" id="7390415">name</span>&nbsp;<span class="op" id="7390420">*</span><span class="builtintype" id="7390421">string</span>&nbsp;<span class="comment" id="7390428">//&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7390444">err</span>&nbsp;<span class="op" id="7390448">:=</span>&nbsp;<span class="ident" id="7390451"><a href="/database/sql/sql_test.go.html#7390359">db</a></span><span class="op" id="7390453">.</span><span class="ident" id="7390454">QueryRow</span><span class="op" id="7390462">(</span><span class="string" id="7390463">&#34;SELECT|people|name|&#34;</span><span class="op" id="7390484">)</span><span class="op" id="7390485">.</span><span class="ident" id="7390486">Scan</span><span class="op" id="7390490">(</span><span class="ident" id="7390491"><a href="/database/sql/sql_test.go.html#7390415">name</a></span><span class="op" id="7390495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7390498">want</span>&nbsp;<span class="op" id="7390503">:=</span>&nbsp;<span class="string" id="7390506">&#34;sql:&nbsp;Scan&nbsp;error&nbsp;on&nbsp;column&nbsp;index&nbsp;0:&nbsp;destination&nbsp;pointer&nbsp;is&nbsp;nil&#34;</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7390571">if</span>&nbsp;<span class="ident" id="7390574"><a href="/database/sql/sql_test.go.html#7390444">err</a></span>&nbsp;<span class="op" id="7390578">==</span>&nbsp;<span class="ident" id="7390581">nil</span>&nbsp;<span class="op" id="7390585">||</span>&nbsp;<span class="ident" id="7390588"><a href="/database/sql/sql_test.go.html#7390444">err</a></span><span class="op" id="7390591">.</span><span class="ident" id="7390592">Error</span><span class="op" id="7390597">(</span><span class="op" id="7390598">)</span>&nbsp;<span class="op" id="7390600">!=</span>&nbsp;<span class="ident" id="7390603"><a href="/database/sql/sql_test.go.html#7390498">want</a></span>&nbsp;<span class="op" id="7390608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7390612"><a href="/database/sql/sql_test.go.html#7390342">t</a></span><span class="op" id="7390613">.</span><span class="ident" id="7390614">Errorf</span><span class="op" id="7390620">(</span><span class="string" id="7390621">&#34;error&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7390642">,</span>&nbsp;<span class="ident" id="7390644"><a href="/database/sql/sql_test.go.html#7390444">err</a></span><span class="op" id="7390647">.</span><span class="ident" id="7390648">Error</span><span class="op" id="7390653">(</span><span class="op" id="7390654">)</span><span class="op" id="7390655">,</span>&nbsp;<span class="ident" id="7390657"><a href="/database/sql/sql_test.go.html#7390498">want</a></span><span class="op" id="7390661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7390664">}</span><br>
<span class="lineno"></span><span class="op" id="7390666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">855</span><span class="keyword" id="7390669">func</span>&nbsp;<span class="ident" id="7390674">TestIssue4902</span><span class="op" id="7390687">(</span><span class="ident" id="7390688">t</span>&nbsp;<span class="op" id="7390690">*</span><span class="ident" id="7390691"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7390698">.</span><span class="ident" id="7390699">T</span><span class="op" id="7390700">)</span>&nbsp;<span class="op" id="7390702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7390705">db</span>&nbsp;<span class="op" id="7390708">:=</span>&nbsp;<span class="ident" id="7390711"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7390720">(</span><span class="ident" id="7390721"><a href="/database/sql/sql_test.go.html#7390688">t</a></span><span class="op" id="7390722">,</span>&nbsp;<span class="string" id="7390724">&#34;people&#34;</span><span class="op" id="7390732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7390735">defer</span>&nbsp;<span class="ident" id="7390741"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7390748">(</span><span class="ident" id="7390749"><a href="/database/sql/sql_test.go.html#7390688">t</a></span><span class="op" id="7390750">,</span>&nbsp;<span class="ident" id="7390752"><a href="/database/sql/sql_test.go.html#7390705">db</a></span><span class="op" id="7390754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7390758">driver</span>&nbsp;<span class="op" id="7390765">:=</span>&nbsp;<span class="ident" id="7390768"><a href="/database/sql/sql_test.go.html#7390705">db</a></span><span class="op" id="7390770">.</span><span class="ident" id="7390771">driver</span><span class="op" id="7390777">.</span><span class="op" id="7390778">(</span><span class="op" id="7390779">*</span><span class="ident" id="7390780"><a href="/database/sql/fakedb_test.go.html#7349239">fakeDriver</a></span><span class="op" id="7390790">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7390793">opens0</span>&nbsp;<span class="op" id="7390800">:=</span>&nbsp;<span class="ident" id="7390803"><a href="/database/sql/sql_test.go.html#7390758">driver</a></span><span class="op" id="7390809">.</span><span class="ident" id="7390810">openCount</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7390822">var</span>&nbsp;<span class="ident" id="7390826">stmt</span>&nbsp;<span class="op" id="7390831">*</span><span class="ident" id="7390832"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7390838">var</span>&nbsp;<span class="ident" id="7390842">err</span>&nbsp;<span class="builtintype" id="7390846">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7390853">for</span>&nbsp;<span class="ident" id="7390857">i</span>&nbsp;<span class="op" id="7390859">:=</span>&nbsp;<span class="num" id="7390862">0</span><span class="op" id="7390863">;</span>&nbsp;<span class="ident" id="7390865"><a href="/database/sql/sql_test.go.html#7390857">i</a></span>&nbsp;<span class="op" id="7390867">&lt;</span>&nbsp;<span class="num" id="7390869">10</span><span class="op" id="7390871">;</span>&nbsp;<span class="ident" id="7390873"><a href="/database/sql/sql_test.go.html#7390857">i</a></span><span class="op" id="7390874">++</span>&nbsp;<span class="op" id="7390877">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7390881"><a href="/database/sql/sql_test.go.html#7390826">stmt</a></span><span class="op" id="7390885">,</span>&nbsp;<span class="ident" id="7390887"><a href="/database/sql/sql_test.go.html#7390842">err</a></span>&nbsp;<span class="op" id="7390891">=</span>&nbsp;<span class="ident" id="7390893"><a href="/database/sql/sql_test.go.html#7390705">db</a></span><span class="op" id="7390895">.</span><span class="ident" id="7390896">Prepare</span><span class="op" id="7390903">(</span><span class="string" id="7390904">&#34;SELECT|people|name|&#34;</span><span class="op" id="7390925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7390929">if</span>&nbsp;<span class="ident" id="7390932"><a href="/database/sql/sql_test.go.html#7390842">err</a></span>&nbsp;<span class="op" id="7390936">!=</span>&nbsp;<span class="ident" id="7390939">nil</span>&nbsp;<span class="op" id="7390943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7390948"><a href="/database/sql/sql_test.go.html#7390688">t</a></span><span class="op" id="7390949">.</span><span class="ident" id="7390950">Fatal</span><span class="op" id="7390955">(</span><span class="ident" id="7390956"><a href="/database/sql/sql_test.go.html#7390842">err</a></span><span class="op" id="7390959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7390963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7390967"><a href="/database/sql/sql_test.go.html#7390842">err</a></span>&nbsp;<span class="op" id="7390971">=</span>&nbsp;<span class="ident" id="7390973"><a href="/database/sql/sql_test.go.html#7390826">stmt</a></span><span class="op" id="7390977">.</span><span class="ident" id="7390978">Close</span><span class="op" id="7390983">(</span><span class="op" id="7390984">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7390988">if</span>&nbsp;<span class="ident" id="7390991"><a href="/database/sql/sql_test.go.html#7390842">err</a></span>&nbsp;<span class="op" id="7390995">!=</span>&nbsp;<span class="ident" id="7390998">nil</span>&nbsp;<span class="op" id="7391002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391007"><a href="/database/sql/sql_test.go.html#7390688">t</a></span><span class="op" id="7391008">.</span><span class="ident" id="7391009">Fatal</span><span class="op" id="7391014">(</span><span class="ident" id="7391015"><a href="/database/sql/sql_test.go.html#7390842">err</a></span><span class="op" id="7391018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7391022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7391025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391029">opens</span>&nbsp;<span class="op" id="7391035">:=</span>&nbsp;<span class="ident" id="7391038"><a href="/database/sql/sql_test.go.html#7390758">driver</a></span><span class="op" id="7391044">.</span><span class="ident" id="7391045">openCount</span>&nbsp;<span class="op" id="7391055">-</span>&nbsp;<span class="ident" id="7391057"><a href="/database/sql/sql_test.go.html#7390793">opens0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7391065">if</span>&nbsp;<span class="ident" id="7391068"><a href="/database/sql/sql_test.go.html#7391029">opens</a></span>&nbsp;<span class="op" id="7391074">&gt;</span>&nbsp;<span class="num" id="7391076">1</span>&nbsp;<span class="op" id="7391078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391082"><a href="/database/sql/sql_test.go.html#7390688">t</a></span><span class="op" id="7391083">.</span><span class="ident" id="7391084">Errorf</span><span class="op" id="7391090">(</span><span class="string" id="7391091">&#34;opens&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;1&#34;</span><span class="op" id="7391114">,</span>&nbsp;<span class="ident" id="7391116"><a href="/database/sql/sql_test.go.html#7391029">opens</a></span><span class="op" id="7391121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391125"><a href="/database/sql/sql_test.go.html#7390688">t</a></span><span class="op" id="7391126">.</span><span class="ident" id="7391127">Logf</span><span class="op" id="7391131">(</span><span class="string" id="7391132">&#34;db&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7391142">,</span>&nbsp;<span class="ident" id="7391144"><a href="/database/sql/sql_test.go.html#7390705">db</a></span><span class="op" id="7391146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391150"><a href="/database/sql/sql_test.go.html#7390688">t</a></span><span class="op" id="7391151">.</span><span class="ident" id="7391152">Logf</span><span class="op" id="7391156">(</span><span class="string" id="7391157">&#34;driver&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7391171">,</span>&nbsp;<span class="ident" id="7391173"><a href="/database/sql/sql_test.go.html#7390758">driver</a></span><span class="op" id="7391179">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391183"><a href="/database/sql/sql_test.go.html#7390688">t</a></span><span class="op" id="7391184">.</span><span class="ident" id="7391185">Logf</span><span class="op" id="7391189">(</span><span class="string" id="7391190">&#34;stmt&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7391202">,</span>&nbsp;<span class="ident" id="7391204"><a href="/database/sql/sql_test.go.html#7390826">stmt</a></span><span class="op" id="7391208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7391211">}</span><br>
<span class="lineno"></span><span class="op" id="7391213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7391216">//&nbsp;Issue&nbsp;3857</span><br>
<span class="lineno">885</span><span class="comment" id="7391230">//&nbsp;This&nbsp;used&nbsp;to&nbsp;deadlock.</span><br>
<span class="lineno"></span><span class="keyword" id="7391256">func</span>&nbsp;<span class="ident" id="7391261">TestSimultaneousQueries</span><span class="op" id="7391284">(</span><span class="ident" id="7391285">t</span>&nbsp;<span class="op" id="7391287">*</span><span class="ident" id="7391288"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7391295">.</span><span class="ident" id="7391296">T</span><span class="op" id="7391297">)</span>&nbsp;<span class="op" id="7391299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391302">db</span>&nbsp;<span class="op" id="7391305">:=</span>&nbsp;<span class="ident" id="7391308"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7391317">(</span><span class="ident" id="7391318"><a href="/database/sql/sql_test.go.html#7391285">t</a></span><span class="op" id="7391319">,</span>&nbsp;<span class="string" id="7391321">&#34;people&#34;</span><span class="op" id="7391329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7391332">defer</span>&nbsp;<span class="ident" id="7391338"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7391345">(</span><span class="ident" id="7391346"><a href="/database/sql/sql_test.go.html#7391285">t</a></span><span class="op" id="7391347">,</span>&nbsp;<span class="ident" id="7391349"><a href="/database/sql/sql_test.go.html#7391302">db</a></span><span class="op" id="7391351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391355">tx</span><span class="op" id="7391357">,</span>&nbsp;<span class="ident" id="7391359">err</span>&nbsp;<span class="op" id="7391363">:=</span>&nbsp;<span class="ident" id="7391366"><a href="/database/sql/sql_test.go.html#7391302">db</a></span><span class="op" id="7391368">.</span><span class="ident" id="7391369">Begin</span><span class="op" id="7391374">(</span><span class="op" id="7391375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7391378">if</span>&nbsp;<span class="ident" id="7391381"><a href="/database/sql/sql_test.go.html#7391359">err</a></span>&nbsp;<span class="op" id="7391385">!=</span>&nbsp;<span class="ident" id="7391388">nil</span>&nbsp;<span class="op" id="7391392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391396"><a href="/database/sql/sql_test.go.html#7391285">t</a></span><span class="op" id="7391397">.</span><span class="ident" id="7391398">Fatal</span><span class="op" id="7391403">(</span><span class="ident" id="7391404"><a href="/database/sql/sql_test.go.html#7391359">err</a></span><span class="op" id="7391407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7391410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7391413">defer</span>&nbsp;<span class="ident" id="7391419"><a href="/database/sql/sql_test.go.html#7391355">tx</a></span><span class="op" id="7391421">.</span><span class="ident" id="7391422">Rollback</span><span class="op" id="7391430">(</span><span class="op" id="7391431">)</span><br>
<span class="lineno">895</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391435">r1</span><span class="op" id="7391437">,</span>&nbsp;<span class="ident" id="7391439"><a href="/database/sql/sql_test.go.html#7391359">err</a></span>&nbsp;<span class="op" id="7391443">:=</span>&nbsp;<span class="ident" id="7391446"><a href="/database/sql/sql_test.go.html#7391355">tx</a></span><span class="op" id="7391448">.</span><span class="ident" id="7391449">Query</span><span class="op" id="7391454">(</span><span class="string" id="7391455">&#34;SELECT|people|name|&#34;</span><span class="op" id="7391476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7391479">if</span>&nbsp;<span class="ident" id="7391482"><a href="/database/sql/sql_test.go.html#7391359">err</a></span>&nbsp;<span class="op" id="7391486">!=</span>&nbsp;<span class="ident" id="7391489">nil</span>&nbsp;<span class="op" id="7391493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391497"><a href="/database/sql/sql_test.go.html#7391285">t</a></span><span class="op" id="7391498">.</span><span class="ident" id="7391499">Fatal</span><span class="op" id="7391504">(</span><span class="ident" id="7391505"><a href="/database/sql/sql_test.go.html#7391359">err</a></span><span class="op" id="7391508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7391511">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7391514">defer</span>&nbsp;<span class="ident" id="7391520"><a href="/database/sql/sql_test.go.html#7391435">r1</a></span><span class="op" id="7391522">.</span><span class="ident" id="7391523">Close</span><span class="op" id="7391528">(</span><span class="op" id="7391529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391533">r2</span><span class="op" id="7391535">,</span>&nbsp;<span class="ident" id="7391537"><a href="/database/sql/sql_test.go.html#7391359">err</a></span>&nbsp;<span class="op" id="7391541">:=</span>&nbsp;<span class="ident" id="7391544"><a href="/database/sql/sql_test.go.html#7391355">tx</a></span><span class="op" id="7391546">.</span><span class="ident" id="7391547">Query</span><span class="op" id="7391552">(</span><span class="string" id="7391553">&#34;SELECT|people|name|&#34;</span><span class="op" id="7391574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7391577">if</span>&nbsp;<span class="ident" id="7391580"><a href="/database/sql/sql_test.go.html#7391359">err</a></span>&nbsp;<span class="op" id="7391584">!=</span>&nbsp;<span class="ident" id="7391587">nil</span>&nbsp;<span class="op" id="7391591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391595"><a href="/database/sql/sql_test.go.html#7391285">t</a></span><span class="op" id="7391596">.</span><span class="ident" id="7391597">Fatal</span><span class="op" id="7391602">(</span><span class="ident" id="7391603"><a href="/database/sql/sql_test.go.html#7391359">err</a></span><span class="op" id="7391606">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7391609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7391612">defer</span>&nbsp;<span class="ident" id="7391618"><a href="/database/sql/sql_test.go.html#7391533">r2</a></span><span class="op" id="7391620">.</span><span class="ident" id="7391621">Close</span><span class="op" id="7391626">(</span><span class="op" id="7391627">)</span><br>
<span class="lineno"></span><span class="op" id="7391629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7391632">func</span>&nbsp;<span class="ident" id="7391637">TestMaxIdleConns</span><span class="op" id="7391653">(</span><span class="ident" id="7391654">t</span>&nbsp;<span class="op" id="7391656">*</span><span class="ident" id="7391657"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7391664">.</span><span class="ident" id="7391665">T</span><span class="op" id="7391666">)</span>&nbsp;<span class="op" id="7391668">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391671">db</span>&nbsp;<span class="op" id="7391674">:=</span>&nbsp;<span class="ident" id="7391677"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7391686">(</span><span class="ident" id="7391687"><a href="/database/sql/sql_test.go.html#7391654">t</a></span><span class="op" id="7391688">,</span>&nbsp;<span class="string" id="7391690">&#34;people&#34;</span><span class="op" id="7391698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7391701">defer</span>&nbsp;<span class="ident" id="7391707"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7391714">(</span><span class="ident" id="7391715"><a href="/database/sql/sql_test.go.html#7391654">t</a></span><span class="op" id="7391716">,</span>&nbsp;<span class="ident" id="7391718"><a href="/database/sql/sql_test.go.html#7391671">db</a></span><span class="op" id="7391720">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391724">tx</span><span class="op" id="7391726">,</span>&nbsp;<span class="ident" id="7391728">err</span>&nbsp;<span class="op" id="7391732">:=</span>&nbsp;<span class="ident" id="7391735"><a href="/database/sql/sql_test.go.html#7391671">db</a></span><span class="op" id="7391737">.</span><span class="ident" id="7391738">Begin</span><span class="op" id="7391743">(</span><span class="op" id="7391744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7391747">if</span>&nbsp;<span class="ident" id="7391750"><a href="/database/sql/sql_test.go.html#7391728">err</a></span>&nbsp;<span class="op" id="7391754">!=</span>&nbsp;<span class="ident" id="7391757">nil</span>&nbsp;<span class="op" id="7391761">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391765"><a href="/database/sql/sql_test.go.html#7391654">t</a></span><span class="op" id="7391766">.</span><span class="ident" id="7391767">Fatal</span><span class="op" id="7391772">(</span><span class="ident" id="7391773"><a href="/database/sql/sql_test.go.html#7391728">err</a></span><span class="op" id="7391776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7391779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391782"><a href="/database/sql/sql_test.go.html#7391724">tx</a></span><span class="op" id="7391784">.</span><span class="ident" id="7391785">Commit</span><span class="op" id="7391791">(</span><span class="op" id="7391792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7391795">if</span>&nbsp;<span class="ident" id="7391798">got</span>&nbsp;<span class="op" id="7391802">:=</span>&nbsp;<span class="builtinfunc" id="7391805">len</span><span class="op" id="7391808">(</span><span class="ident" id="7391809"><a href="/database/sql/sql_test.go.html#7391671">db</a></span><span class="op" id="7391811">.</span><span class="ident" id="7391812">freeConn</span><span class="op" id="7391820">)</span><span class="op" id="7391821">;</span>&nbsp;<span class="ident" id="7391823"><a href="/database/sql/sql_test.go.html#7391798">got</a></span>&nbsp;<span class="op" id="7391827">!=</span>&nbsp;<span class="num" id="7391830">1</span>&nbsp;<span class="op" id="7391832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391836"><a href="/database/sql/sql_test.go.html#7391654">t</a></span><span class="op" id="7391837">.</span><span class="ident" id="7391838">Errorf</span><span class="op" id="7391844">(</span><span class="string" id="7391845">&#34;freeConns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7391869">,</span>&nbsp;<span class="ident" id="7391871"><a href="/database/sql/sql_test.go.html#7391798">got</a></span><span class="op" id="7391874">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7391877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391881"><a href="/database/sql/sql_test.go.html#7391671">db</a></span><span class="op" id="7391883">.</span><span class="ident" id="7391884">SetMaxIdleConns</span><span class="op" id="7391899">(</span><span class="num" id="7391900">0</span><span class="op" id="7391901">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7391905">if</span>&nbsp;<span class="ident" id="7391908">got</span>&nbsp;<span class="op" id="7391912">:=</span>&nbsp;<span class="builtinfunc" id="7391915">len</span><span class="op" id="7391918">(</span><span class="ident" id="7391919"><a href="/database/sql/sql_test.go.html#7391671">db</a></span><span class="op" id="7391921">.</span><span class="ident" id="7391922">freeConn</span><span class="op" id="7391930">)</span><span class="op" id="7391931">;</span>&nbsp;<span class="ident" id="7391933"><a href="/database/sql/sql_test.go.html#7391908">got</a></span>&nbsp;<span class="op" id="7391937">!=</span>&nbsp;<span class="num" id="7391940">0</span>&nbsp;<span class="op" id="7391942">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7391946"><a href="/database/sql/sql_test.go.html#7391654">t</a></span><span class="op" id="7391947">.</span><span class="ident" id="7391948">Errorf</span><span class="op" id="7391954">(</span><span class="string" id="7391955">&#34;freeConns&nbsp;after&nbsp;set&nbsp;to&nbsp;zero&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7391997">,</span>&nbsp;<span class="ident" id="7391999"><a href="/database/sql/sql_test.go.html#7391908">got</a></span><span class="op" id="7392002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7392005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392009"><a href="/database/sql/sql_test.go.html#7391724">tx</a></span><span class="op" id="7392011">,</span>&nbsp;<span class="ident" id="7392013"><a href="/database/sql/sql_test.go.html#7391728">err</a></span>&nbsp;<span class="op" id="7392017">=</span>&nbsp;<span class="ident" id="7392019"><a href="/database/sql/sql_test.go.html#7391671">db</a></span><span class="op" id="7392021">.</span><span class="ident" id="7392022">Begin</span><span class="op" id="7392027">(</span><span class="op" id="7392028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7392031">if</span>&nbsp;<span class="ident" id="7392034"><a href="/database/sql/sql_test.go.html#7391728">err</a></span>&nbsp;<span class="op" id="7392038">!=</span>&nbsp;<span class="ident" id="7392041">nil</span>&nbsp;<span class="op" id="7392045">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392049"><a href="/database/sql/sql_test.go.html#7391654">t</a></span><span class="op" id="7392050">.</span><span class="ident" id="7392051">Fatal</span><span class="op" id="7392056">(</span><span class="ident" id="7392057"><a href="/database/sql/sql_test.go.html#7391728">err</a></span><span class="op" id="7392060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7392063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392066"><a href="/database/sql/sql_test.go.html#7391724">tx</a></span><span class="op" id="7392068">.</span><span class="ident" id="7392069">Commit</span><span class="op" id="7392075">(</span><span class="op" id="7392076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7392079">if</span>&nbsp;<span class="ident" id="7392082">got</span>&nbsp;<span class="op" id="7392086">:=</span>&nbsp;<span class="builtinfunc" id="7392089">len</span><span class="op" id="7392092">(</span><span class="ident" id="7392093"><a href="/database/sql/sql_test.go.html#7391671">db</a></span><span class="op" id="7392095">.</span><span class="ident" id="7392096">freeConn</span><span class="op" id="7392104">)</span><span class="op" id="7392105">;</span>&nbsp;<span class="ident" id="7392107"><a href="/database/sql/sql_test.go.html#7392082">got</a></span>&nbsp;<span class="op" id="7392111">!=</span>&nbsp;<span class="num" id="7392114">0</span>&nbsp;<span class="op" id="7392116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392120"><a href="/database/sql/sql_test.go.html#7391654">t</a></span><span class="op" id="7392121">.</span><span class="ident" id="7392122">Errorf</span><span class="op" id="7392128">(</span><span class="string" id="7392129">&#34;freeConns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7392153">,</span>&nbsp;<span class="ident" id="7392155"><a href="/database/sql/sql_test.go.html#7392082">got</a></span><span class="op" id="7392158">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7392161">}</span><br>
<span class="lineno"></span><span class="op" id="7392163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7392166">func</span>&nbsp;<span class="ident" id="7392171">TestMaxOpenConns</span><span class="op" id="7392187">(</span><span class="ident" id="7392188">t</span>&nbsp;<span class="op" id="7392190">*</span><span class="ident" id="7392191"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7392198">.</span><span class="ident" id="7392199">T</span><span class="op" id="7392200">)</span>&nbsp;<span class="op" id="7392202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7392205">if</span>&nbsp;<span class="ident" id="7392208"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7392215">.</span><span class="ident" id="7392216">Short</span><span class="op" id="7392221">(</span><span class="op" id="7392222">)</span>&nbsp;<span class="op" id="7392224">{</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392228"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7392229">.</span><span class="ident" id="7392230">Skip</span><span class="op" id="7392234">(</span><span class="string" id="7392235">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7392259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7392262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7392265">defer</span>&nbsp;<span class="ident" id="7392271"><a href="/database/sql/fakedb_test.go.html#7353989">setHookpostCloseConn</a></span><span class="op" id="7392291">(</span><span class="ident" id="7392292">nil</span><span class="op" id="7392295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392298"><a href="/database/sql/fakedb_test.go.html#7353989">setHookpostCloseConn</a></span><span class="op" id="7392318">(</span><span class="keyword" id="7392319">func</span><span class="op" id="7392323">(</span><span class="ident" id="7392324">_</span>&nbsp;<span class="op" id="7392326">*</span><span class="ident" id="7392327"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7392335">,</span>&nbsp;<span class="ident" id="7392337">err</span>&nbsp;<span class="builtintype" id="7392341">error</span><span class="op" id="7392346">)</span>&nbsp;<span class="op" id="7392348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7392352">if</span>&nbsp;<span class="ident" id="7392355"><a href="/database/sql/sql_test.go.html#7392337">err</a></span>&nbsp;<span class="op" id="7392359">!=</span>&nbsp;<span class="ident" id="7392362">nil</span>&nbsp;<span class="op" id="7392366">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392371"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7392372">.</span><span class="ident" id="7392373">Errorf</span><span class="op" id="7392379">(</span><span class="string" id="7392380">&#34;Error&nbsp;closing&nbsp;fakeConn:&nbsp;%v&#34;</span><span class="op" id="7392408">,</span>&nbsp;<span class="ident" id="7392410"><a href="/database/sql/sql_test.go.html#7392337">err</a></span><span class="op" id="7392413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7392417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7392420">}</span><span class="op" id="7392421">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392425">db</span>&nbsp;<span class="op" id="7392428">:=</span>&nbsp;<span class="ident" id="7392431"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7392440">(</span><span class="ident" id="7392441"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7392442">,</span>&nbsp;<span class="string" id="7392444">&#34;magicquery&#34;</span><span class="op" id="7392456">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7392459">defer</span>&nbsp;<span class="ident" id="7392465"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7392472">(</span><span class="ident" id="7392473"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7392474">,</span>&nbsp;<span class="ident" id="7392476"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7392478">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392482">driver</span>&nbsp;<span class="op" id="7392489">:=</span>&nbsp;<span class="ident" id="7392492"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7392494">.</span><span class="ident" id="7392495">driver</span><span class="op" id="7392501">.</span><span class="op" id="7392502">(</span><span class="op" id="7392503">*</span><span class="ident" id="7392504"><a href="/database/sql/fakedb_test.go.html#7349239">fakeDriver</a></span><span class="op" id="7392514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7392518">//&nbsp;Force&nbsp;the&nbsp;number&nbsp;of&nbsp;open&nbsp;connections&nbsp;to&nbsp;0&nbsp;so&nbsp;we&nbsp;can&nbsp;get&nbsp;an&nbsp;accurate</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7392590">//&nbsp;count&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392613"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7392615">.</span><span class="ident" id="7392616">SetMaxIdleConns</span><span class="op" id="7392631">(</span><span class="num" id="7392632">0</span><span class="op" id="7392633">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7392637">if</span>&nbsp;<span class="ident" id="7392640">g</span><span class="op" id="7392641">,</span>&nbsp;<span class="ident" id="7392643">w</span>&nbsp;<span class="op" id="7392645">:=</span>&nbsp;<span class="ident" id="7392648"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7392650">.</span><span class="ident" id="7392651">numFreeConns</span><span class="op" id="7392663">(</span><span class="op" id="7392664">)</span><span class="op" id="7392665">,</span>&nbsp;<span class="num" id="7392667">0</span><span class="op" id="7392668">;</span>&nbsp;<span class="ident" id="7392670"><a href="/database/sql/sql_test.go.html#7392640">g</a></span>&nbsp;<span class="op" id="7392672">!=</span>&nbsp;<span class="ident" id="7392675"><a href="/database/sql/sql_test.go.html#7392643">w</a></span>&nbsp;<span class="op" id="7392677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392681"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7392682">.</span><span class="ident" id="7392683">Errorf</span><span class="op" id="7392689">(</span><span class="string" id="7392690">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7392716">,</span>&nbsp;<span class="ident" id="7392718"><a href="/database/sql/sql_test.go.html#7392640">g</a></span><span class="op" id="7392719">,</span>&nbsp;<span class="ident" id="7392721"><a href="/database/sql/sql_test.go.html#7392643">w</a></span><span class="op" id="7392722">)</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7392725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7392729">if</span>&nbsp;<span class="ident" id="7392732">n</span>&nbsp;<span class="op" id="7392734">:=</span>&nbsp;<span class="ident" id="7392737"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7392739">.</span><span class="ident" id="7392740">numDepsPollUntil</span><span class="op" id="7392756">(</span><span class="num" id="7392757">0</span><span class="op" id="7392758">,</span>&nbsp;<span class="ident" id="7392760"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7392764">.</span><span class="ident" id="7392765">Second</span><span class="op" id="7392771">)</span><span class="op" id="7392772">;</span>&nbsp;<span class="ident" id="7392774"><a href="/database/sql/sql_test.go.html#7392732">n</a></span>&nbsp;<span class="op" id="7392776">&gt;</span>&nbsp;<span class="num" id="7392778">0</span>&nbsp;<span class="op" id="7392780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392784"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7392785">.</span><span class="ident" id="7392786">Errorf</span><span class="op" id="7392792">(</span><span class="string" id="7392793">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7392834">,</span>&nbsp;<span class="ident" id="7392836"><a href="/database/sql/sql_test.go.html#7392732">n</a></span><span class="op" id="7392837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392841"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7392843">.</span><span class="ident" id="7392844">dumpDeps</span><span class="op" id="7392852">(</span><span class="ident" id="7392853"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7392854">)</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7392857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392861"><a href="/database/sql/sql_test.go.html#7392482">driver</a></span><span class="op" id="7392867">.</span><span class="ident" id="7392868">mu</span><span class="op" id="7392870">.</span><span class="ident" id="7392871">Lock</span><span class="op" id="7392875">(</span><span class="op" id="7392876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392879">opens0</span>&nbsp;<span class="op" id="7392886">:=</span>&nbsp;<span class="ident" id="7392889"><a href="/database/sql/sql_test.go.html#7392482">driver</a></span><span class="op" id="7392895">.</span><span class="ident" id="7392896">openCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392907">closes0</span>&nbsp;<span class="op" id="7392915">:=</span>&nbsp;<span class="ident" id="7392918"><a href="/database/sql/sql_test.go.html#7392482">driver</a></span><span class="op" id="7392924">.</span><span class="ident" id="7392925">closeCount</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392937"><a href="/database/sql/sql_test.go.html#7392482">driver</a></span><span class="op" id="7392943">.</span><span class="ident" id="7392944">mu</span><span class="op" id="7392946">.</span><span class="ident" id="7392947">Unlock</span><span class="op" id="7392953">(</span><span class="op" id="7392954">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392958"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7392960">.</span><span class="ident" id="7392961">SetMaxIdleConns</span><span class="op" id="7392976">(</span><span class="num" id="7392977">10</span><span class="op" id="7392979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7392982"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7392984">.</span><span class="ident" id="7392985">SetMaxOpenConns</span><span class="op" id="7393000">(</span><span class="num" id="7393001">10</span><span class="op" id="7393003">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393007">stmt</span><span class="op" id="7393011">,</span>&nbsp;<span class="ident" id="7393013">err</span>&nbsp;<span class="op" id="7393017">:=</span>&nbsp;<span class="ident" id="7393020"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7393022">.</span><span class="ident" id="7393023">Prepare</span><span class="op" id="7393030">(</span><span class="string" id="7393031">&#34;SELECT|magicquery|op|op=?,millis=?&#34;</span><span class="op" id="7393067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7393070">if</span>&nbsp;<span class="ident" id="7393073"><a href="/database/sql/sql_test.go.html#7393013">err</a></span>&nbsp;<span class="op" id="7393077">!=</span>&nbsp;<span class="ident" id="7393080">nil</span>&nbsp;<span class="op" id="7393084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393088"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7393089">.</span><span class="ident" id="7393090">Fatal</span><span class="op" id="7393095">(</span><span class="ident" id="7393096"><a href="/database/sql/sql_test.go.html#7393013">err</a></span><span class="op" id="7393099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7393106">//&nbsp;Start&nbsp;50&nbsp;parallel&nbsp;slow&nbsp;queries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7393142">const</span>&nbsp;<span class="op" id="7393148">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393152">nquery</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7393164">=</span>&nbsp;<span class="num" id="7393166">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393171">sleepMillis</span>&nbsp;<span class="op" id="7393183">=</span>&nbsp;<span class="num" id="7393185">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393190">nbatch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7393202">=</span>&nbsp;<span class="num" id="7393204">2</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7393210">var</span>&nbsp;<span class="ident" id="7393214">wg</span>&nbsp;<span class="ident" id="7393217"><a href="/database/sql/sql_test.go.html#7368984">sync</a></span><span class="op" id="7393221">.</span><span class="ident" id="7393222">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7393233">for</span>&nbsp;<span class="ident" id="7393237">batch</span>&nbsp;<span class="op" id="7393243">:=</span>&nbsp;<span class="num" id="7393246">0</span><span class="op" id="7393247">;</span>&nbsp;<span class="ident" id="7393249"><a href="/database/sql/sql_test.go.html#7393237">batch</a></span>&nbsp;<span class="op" id="7393255">&lt;</span>&nbsp;<span class="ident" id="7393257"><a href="/database/sql/sql_test.go.html#7393190">nbatch</a></span><span class="op" id="7393263">;</span>&nbsp;<span class="ident" id="7393265"><a href="/database/sql/sql_test.go.html#7393237">batch</a></span><span class="op" id="7393270">++</span>&nbsp;<span class="op" id="7393273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7393277">for</span>&nbsp;<span class="ident" id="7393281">i</span>&nbsp;<span class="op" id="7393283">:=</span>&nbsp;<span class="num" id="7393286">0</span><span class="op" id="7393287">;</span>&nbsp;<span class="ident" id="7393289"><a href="/database/sql/sql_test.go.html#7393281">i</a></span>&nbsp;<span class="op" id="7393291">&lt;</span>&nbsp;<span class="ident" id="7393293"><a href="/database/sql/sql_test.go.html#7393152">nquery</a></span><span class="op" id="7393299">;</span>&nbsp;<span class="ident" id="7393301"><a href="/database/sql/sql_test.go.html#7393281">i</a></span><span class="op" id="7393302">++</span>&nbsp;<span class="op" id="7393305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393310"><a href="/database/sql/sql_test.go.html#7393214">wg</a></span><span class="op" id="7393312">.</span><span class="ident" id="7393313">Add</span><span class="op" id="7393316">(</span><span class="num" id="7393317">1</span><span class="op" id="7393318">)</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7393323">go</span>&nbsp;<span class="keyword" id="7393326">func</span><span class="op" id="7393330">(</span><span class="op" id="7393331">)</span>&nbsp;<span class="op" id="7393333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7393339">defer</span>&nbsp;<span class="ident" id="7393345"><a href="/database/sql/sql_test.go.html#7393214">wg</a></span><span class="op" id="7393347">.</span><span class="ident" id="7393348">Done</span><span class="op" id="7393352">(</span><span class="op" id="7393353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7393359">var</span>&nbsp;<span class="ident" id="7393363">op</span>&nbsp;<span class="builtintype" id="7393366">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7393377">if</span>&nbsp;<span class="ident" id="7393380">err</span>&nbsp;<span class="op" id="7393384">:=</span>&nbsp;<span class="ident" id="7393387"><a href="/database/sql/sql_test.go.html#7393007">stmt</a></span><span class="op" id="7393391">.</span><span class="ident" id="7393392">QueryRow</span><span class="op" id="7393400">(</span><span class="string" id="7393401">&#34;sleep&#34;</span><span class="op" id="7393408">,</span>&nbsp;<span class="ident" id="7393410"><a href="/database/sql/sql_test.go.html#7393171">sleepMillis</a></span><span class="op" id="7393421">)</span><span class="op" id="7393422">.</span><span class="ident" id="7393423">Scan</span><span class="op" id="7393427">(</span><span class="op" id="7393428">&amp;</span><span class="ident" id="7393429"><a href="/database/sql/sql_test.go.html#7393363">op</a></span><span class="op" id="7393431">)</span><span class="op" id="7393432">;</span>&nbsp;<span class="ident" id="7393434"><a href="/database/sql/sql_test.go.html#7393380">err</a></span>&nbsp;<span class="op" id="7393438">!=</span>&nbsp;<span class="ident" id="7393441">nil</span>&nbsp;<span class="op" id="7393445">&amp;&amp;</span>&nbsp;<span class="ident" id="7393448"><a href="/database/sql/sql_test.go.html#7393380">err</a></span>&nbsp;<span class="op" id="7393452">!=</span>&nbsp;<span class="ident" id="7393455"><a href="/database/sql/sql.go.html#6353466">ErrNoRows</a></span>&nbsp;<span class="op" id="7393465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393472"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7393473">.</span><span class="ident" id="7393474">Error</span><span class="op" id="7393479">(</span><span class="ident" id="7393480"><a href="/database/sql/sql_test.go.html#7393380">err</a></span><span class="op" id="7393483">)</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393494">}</span><span class="op" id="7393495">(</span><span class="op" id="7393496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7393504">//&nbsp;Sleep&nbsp;for&nbsp;twice&nbsp;the&nbsp;expected&nbsp;length&nbsp;of&nbsp;time&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7393561">//&nbsp;batch&nbsp;of&nbsp;50&nbsp;queries&nbsp;above&nbsp;to&nbsp;finish&nbsp;before&nbsp;starting</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7393618">//&nbsp;the&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393639"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7393643">.</span><span class="ident" id="7393644">Sleep</span><span class="op" id="7393649">(</span><span class="num" id="7393650">2</span>&nbsp;<span class="op" id="7393652">*</span>&nbsp;<span class="ident" id="7393654"><a href="/database/sql/sql_test.go.html#7393171">sleepMillis</a></span>&nbsp;<span class="op" id="7393666">*</span>&nbsp;<span class="ident" id="7393668"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7393672">.</span><span class="ident" id="7393673">Millisecond</span><span class="op" id="7393684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393690"><a href="/database/sql/sql_test.go.html#7393214">wg</a></span><span class="op" id="7393692">.</span><span class="ident" id="7393693">Wait</span><span class="op" id="7393697">(</span><span class="op" id="7393698">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7393702">if</span>&nbsp;<span class="ident" id="7393705">g</span><span class="op" id="7393706">,</span>&nbsp;<span class="ident" id="7393708">w</span>&nbsp;<span class="op" id="7393710">:=</span>&nbsp;<span class="ident" id="7393713"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7393715">.</span><span class="ident" id="7393716">numFreeConns</span><span class="op" id="7393728">(</span><span class="op" id="7393729">)</span><span class="op" id="7393730">,</span>&nbsp;<span class="num" id="7393732">10</span><span class="op" id="7393734">;</span>&nbsp;<span class="ident" id="7393736"><a href="/database/sql/sql_test.go.html#7393705">g</a></span>&nbsp;<span class="op" id="7393738">!=</span>&nbsp;<span class="ident" id="7393741"><a href="/database/sql/sql_test.go.html#7393708">w</a></span>&nbsp;<span class="op" id="7393743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393747"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7393748">.</span><span class="ident" id="7393749">Errorf</span><span class="op" id="7393755">(</span><span class="string" id="7393756">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7393782">,</span>&nbsp;<span class="ident" id="7393784"><a href="/database/sql/sql_test.go.html#7393705">g</a></span><span class="op" id="7393785">,</span>&nbsp;<span class="ident" id="7393787"><a href="/database/sql/sql_test.go.html#7393708">w</a></span><span class="op" id="7393788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7393795">if</span>&nbsp;<span class="ident" id="7393798">n</span>&nbsp;<span class="op" id="7393800">:=</span>&nbsp;<span class="ident" id="7393803"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7393805">.</span><span class="ident" id="7393806">numDepsPollUntil</span><span class="op" id="7393822">(</span><span class="num" id="7393823">20</span><span class="op" id="7393825">,</span>&nbsp;<span class="ident" id="7393827"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7393831">.</span><span class="ident" id="7393832">Second</span><span class="op" id="7393838">)</span><span class="op" id="7393839">;</span>&nbsp;<span class="ident" id="7393841"><a href="/database/sql/sql_test.go.html#7393798">n</a></span>&nbsp;<span class="op" id="7393843">&gt;</span>&nbsp;<span class="num" id="7393845">20</span>&nbsp;<span class="op" id="7393848">{</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393852"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7393853">.</span><span class="ident" id="7393854">Errorf</span><span class="op" id="7393860">(</span><span class="string" id="7393861">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;&lt;=&nbsp;20&#34;</span><span class="op" id="7393906">,</span>&nbsp;<span class="ident" id="7393908"><a href="/database/sql/sql_test.go.html#7393798">n</a></span><span class="op" id="7393909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393913"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7393915">.</span><span class="ident" id="7393916">dumpDeps</span><span class="op" id="7393924">(</span><span class="ident" id="7393925"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7393926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393933"><a href="/database/sql/sql_test.go.html#7392482">driver</a></span><span class="op" id="7393939">.</span><span class="ident" id="7393940">mu</span><span class="op" id="7393942">.</span><span class="ident" id="7393943">Lock</span><span class="op" id="7393947">(</span><span class="op" id="7393948">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393951">opens</span>&nbsp;<span class="op" id="7393957">:=</span>&nbsp;<span class="ident" id="7393960"><a href="/database/sql/sql_test.go.html#7392482">driver</a></span><span class="op" id="7393966">.</span><span class="ident" id="7393967">openCount</span>&nbsp;<span class="op" id="7393977">-</span>&nbsp;<span class="ident" id="7393979"><a href="/database/sql/sql_test.go.html#7392879">opens0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393987">closes</span>&nbsp;<span class="op" id="7393994">:=</span>&nbsp;<span class="ident" id="7393997"><a href="/database/sql/sql_test.go.html#7392482">driver</a></span><span class="op" id="7394003">.</span><span class="ident" id="7394004">closeCount</span>&nbsp;<span class="op" id="7394015">-</span>&nbsp;<span class="ident" id="7394017"><a href="/database/sql/sql_test.go.html#7392907">closes0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394026"><a href="/database/sql/sql_test.go.html#7392482">driver</a></span><span class="op" id="7394032">.</span><span class="ident" id="7394033">mu</span><span class="op" id="7394035">.</span><span class="ident" id="7394036">Unlock</span><span class="op" id="7394042">(</span><span class="op" id="7394043">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7394047">if</span>&nbsp;<span class="ident" id="7394050"><a href="/database/sql/sql_test.go.html#7393951">opens</a></span>&nbsp;<span class="op" id="7394056">&gt;</span>&nbsp;<span class="num" id="7394058">10</span>&nbsp;<span class="op" id="7394061">{</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394065"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394066">.</span><span class="ident" id="7394067">Logf</span><span class="op" id="7394071">(</span><span class="string" id="7394072">&#34;open&nbsp;calls&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7394089">,</span>&nbsp;<span class="ident" id="7394091"><a href="/database/sql/sql_test.go.html#7393951">opens</a></span><span class="op" id="7394096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394100"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394101">.</span><span class="ident" id="7394102">Logf</span><span class="op" id="7394106">(</span><span class="string" id="7394107">&#34;close&nbsp;calls&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7394125">,</span>&nbsp;<span class="ident" id="7394127"><a href="/database/sql/sql_test.go.html#7393987">closes</a></span><span class="op" id="7394133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394137"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394138">.</span><span class="ident" id="7394139">Errorf</span><span class="op" id="7394145">(</span><span class="string" id="7394146">&#34;db&nbsp;connections&nbsp;opened&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;10&#34;</span><span class="op" id="7394186">,</span>&nbsp;<span class="ident" id="7394188"><a href="/database/sql/sql_test.go.html#7393951">opens</a></span><span class="op" id="7394193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394197"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7394199">.</span><span class="ident" id="7394200">dumpDeps</span><span class="op" id="7394208">(</span><span class="ident" id="7394209"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394213">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7394217">if</span>&nbsp;<span class="ident" id="7394220">err</span>&nbsp;<span class="op" id="7394224">:=</span>&nbsp;<span class="ident" id="7394227"><a href="/database/sql/sql_test.go.html#7393007">stmt</a></span><span class="op" id="7394231">.</span><span class="ident" id="7394232">Close</span><span class="op" id="7394237">(</span><span class="op" id="7394238">)</span><span class="op" id="7394239">;</span>&nbsp;<span class="ident" id="7394241"><a href="/database/sql/sql_test.go.html#7394220">err</a></span>&nbsp;<span class="op" id="7394245">!=</span>&nbsp;<span class="ident" id="7394248">nil</span>&nbsp;<span class="op" id="7394252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394256"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394257">.</span><span class="ident" id="7394258">Fatal</span><span class="op" id="7394263">(</span><span class="ident" id="7394264"><a href="/database/sql/sql_test.go.html#7394220">err</a></span><span class="op" id="7394267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7394274">if</span>&nbsp;<span class="ident" id="7394277">g</span><span class="op" id="7394278">,</span>&nbsp;<span class="ident" id="7394280">w</span>&nbsp;<span class="op" id="7394282">:=</span>&nbsp;<span class="ident" id="7394285"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7394287">.</span><span class="ident" id="7394288">numFreeConns</span><span class="op" id="7394300">(</span><span class="op" id="7394301">)</span><span class="op" id="7394302">,</span>&nbsp;<span class="num" id="7394304">10</span><span class="op" id="7394306">;</span>&nbsp;<span class="ident" id="7394308"><a href="/database/sql/sql_test.go.html#7394277">g</a></span>&nbsp;<span class="op" id="7394310">!=</span>&nbsp;<span class="ident" id="7394313"><a href="/database/sql/sql_test.go.html#7394280">w</a></span>&nbsp;<span class="op" id="7394315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394319"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394320">.</span><span class="ident" id="7394321">Errorf</span><span class="op" id="7394327">(</span><span class="string" id="7394328">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7394354">,</span>&nbsp;<span class="ident" id="7394356"><a href="/database/sql/sql_test.go.html#7394277">g</a></span><span class="op" id="7394357">,</span>&nbsp;<span class="ident" id="7394359"><a href="/database/sql/sql_test.go.html#7394280">w</a></span><span class="op" id="7394360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7394367">if</span>&nbsp;<span class="ident" id="7394370">n</span>&nbsp;<span class="op" id="7394372">:=</span>&nbsp;<span class="ident" id="7394375"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7394377">.</span><span class="ident" id="7394378">numDepsPollUntil</span><span class="op" id="7394394">(</span><span class="num" id="7394395">10</span><span class="op" id="7394397">,</span>&nbsp;<span class="ident" id="7394399"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7394403">.</span><span class="ident" id="7394404">Second</span><span class="op" id="7394410">)</span><span class="op" id="7394411">;</span>&nbsp;<span class="ident" id="7394413"><a href="/database/sql/sql_test.go.html#7394370">n</a></span>&nbsp;<span class="op" id="7394415">&gt;</span>&nbsp;<span class="num" id="7394417">10</span>&nbsp;<span class="op" id="7394420">{</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394424"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394425">.</span><span class="ident" id="7394426">Errorf</span><span class="op" id="7394432">(</span><span class="string" id="7394433">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;&lt;=&nbsp;10&#34;</span><span class="op" id="7394478">,</span>&nbsp;<span class="ident" id="7394480"><a href="/database/sql/sql_test.go.html#7394370">n</a></span><span class="op" id="7394481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394485"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7394487">.</span><span class="ident" id="7394488">dumpDeps</span><span class="op" id="7394496">(</span><span class="ident" id="7394497"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394505"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7394507">.</span><span class="ident" id="7394508">SetMaxOpenConns</span><span class="op" id="7394523">(</span><span class="num" id="7394524">5</span><span class="op" id="7394525">)</span><br>
<span class="lineno">1040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7394529">if</span>&nbsp;<span class="ident" id="7394532">g</span><span class="op" id="7394533">,</span>&nbsp;<span class="ident" id="7394535">w</span>&nbsp;<span class="op" id="7394537">:=</span>&nbsp;<span class="ident" id="7394540"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7394542">.</span><span class="ident" id="7394543">numFreeConns</span><span class="op" id="7394555">(</span><span class="op" id="7394556">)</span><span class="op" id="7394557">,</span>&nbsp;<span class="num" id="7394559">5</span><span class="op" id="7394560">;</span>&nbsp;<span class="ident" id="7394562"><a href="/database/sql/sql_test.go.html#7394532">g</a></span>&nbsp;<span class="op" id="7394564">!=</span>&nbsp;<span class="ident" id="7394567"><a href="/database/sql/sql_test.go.html#7394535">w</a></span>&nbsp;<span class="op" id="7394569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394573"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394574">.</span><span class="ident" id="7394575">Errorf</span><span class="op" id="7394581">(</span><span class="string" id="7394582">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7394608">,</span>&nbsp;<span class="ident" id="7394610"><a href="/database/sql/sql_test.go.html#7394532">g</a></span><span class="op" id="7394611">,</span>&nbsp;<span class="ident" id="7394613"><a href="/database/sql/sql_test.go.html#7394535">w</a></span><span class="op" id="7394614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7394621">if</span>&nbsp;<span class="ident" id="7394624">n</span>&nbsp;<span class="op" id="7394626">:=</span>&nbsp;<span class="ident" id="7394629"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7394631">.</span><span class="ident" id="7394632">numDepsPollUntil</span><span class="op" id="7394648">(</span><span class="num" id="7394649">5</span><span class="op" id="7394650">,</span>&nbsp;<span class="ident" id="7394652"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7394656">.</span><span class="ident" id="7394657">Second</span><span class="op" id="7394663">)</span><span class="op" id="7394664">;</span>&nbsp;<span class="ident" id="7394666"><a href="/database/sql/sql_test.go.html#7394624">n</a></span>&nbsp;<span class="op" id="7394668">&gt;</span>&nbsp;<span class="num" id="7394670">5</span>&nbsp;<span class="op" id="7394672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394676"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394677">.</span><span class="ident" id="7394678">Errorf</span><span class="op" id="7394684">(</span><span class="string" id="7394685">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7394726">,</span>&nbsp;<span class="ident" id="7394728"><a href="/database/sql/sql_test.go.html#7394624">n</a></span><span class="op" id="7394729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394733"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7394735">.</span><span class="ident" id="7394736">dumpDeps</span><span class="op" id="7394744">(</span><span class="ident" id="7394745"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394753"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7394755">.</span><span class="ident" id="7394756">SetMaxOpenConns</span><span class="op" id="7394771">(</span><span class="num" id="7394772">0</span><span class="op" id="7394773">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7394777">if</span>&nbsp;<span class="ident" id="7394780">g</span><span class="op" id="7394781">,</span>&nbsp;<span class="ident" id="7394783">w</span>&nbsp;<span class="op" id="7394785">:=</span>&nbsp;<span class="ident" id="7394788"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7394790">.</span><span class="ident" id="7394791">numFreeConns</span><span class="op" id="7394803">(</span><span class="op" id="7394804">)</span><span class="op" id="7394805">,</span>&nbsp;<span class="num" id="7394807">5</span><span class="op" id="7394808">;</span>&nbsp;<span class="ident" id="7394810"><a href="/database/sql/sql_test.go.html#7394780">g</a></span>&nbsp;<span class="op" id="7394812">!=</span>&nbsp;<span class="ident" id="7394815"><a href="/database/sql/sql_test.go.html#7394783">w</a></span>&nbsp;<span class="op" id="7394817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394821"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394822">.</span><span class="ident" id="7394823">Errorf</span><span class="op" id="7394829">(</span><span class="string" id="7394830">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7394856">,</span>&nbsp;<span class="ident" id="7394858"><a href="/database/sql/sql_test.go.html#7394780">g</a></span><span class="op" id="7394859">,</span>&nbsp;<span class="ident" id="7394861"><a href="/database/sql/sql_test.go.html#7394783">w</a></span><span class="op" id="7394862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394865">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7394869">if</span>&nbsp;<span class="ident" id="7394872">n</span>&nbsp;<span class="op" id="7394874">:=</span>&nbsp;<span class="ident" id="7394877"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7394879">.</span><span class="ident" id="7394880">numDepsPollUntil</span><span class="op" id="7394896">(</span><span class="num" id="7394897">5</span><span class="op" id="7394898">,</span>&nbsp;<span class="ident" id="7394900"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7394904">.</span><span class="ident" id="7394905">Second</span><span class="op" id="7394911">)</span><span class="op" id="7394912">;</span>&nbsp;<span class="ident" id="7394914"><a href="/database/sql/sql_test.go.html#7394872">n</a></span>&nbsp;<span class="op" id="7394916">&gt;</span>&nbsp;<span class="num" id="7394918">5</span>&nbsp;<span class="op" id="7394920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394924"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394925">.</span><span class="ident" id="7394926">Errorf</span><span class="op" id="7394932">(</span><span class="string" id="7394933">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7394974">,</span>&nbsp;<span class="ident" id="7394976"><a href="/database/sql/sql_test.go.html#7394872">n</a></span><span class="op" id="7394977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394981"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7394983">.</span><span class="ident" id="7394984">dumpDeps</span><span class="op" id="7394992">(</span><span class="ident" id="7394993"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7394994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394997">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395001"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7395003">.</span><span class="ident" id="7395004">SetMaxIdleConns</span><span class="op" id="7395019">(</span><span class="num" id="7395020">0</span><span class="op" id="7395021">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395025">if</span>&nbsp;<span class="ident" id="7395028">g</span><span class="op" id="7395029">,</span>&nbsp;<span class="ident" id="7395031">w</span>&nbsp;<span class="op" id="7395033">:=</span>&nbsp;<span class="ident" id="7395036"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7395038">.</span><span class="ident" id="7395039">numFreeConns</span><span class="op" id="7395051">(</span><span class="op" id="7395052">)</span><span class="op" id="7395053">,</span>&nbsp;<span class="num" id="7395055">0</span><span class="op" id="7395056">;</span>&nbsp;<span class="ident" id="7395058"><a href="/database/sql/sql_test.go.html#7395028">g</a></span>&nbsp;<span class="op" id="7395060">!=</span>&nbsp;<span class="ident" id="7395063"><a href="/database/sql/sql_test.go.html#7395031">w</a></span>&nbsp;<span class="op" id="7395065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395069"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7395070">.</span><span class="ident" id="7395071">Errorf</span><span class="op" id="7395077">(</span><span class="string" id="7395078">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7395104">,</span>&nbsp;<span class="ident" id="7395106"><a href="/database/sql/sql_test.go.html#7395028">g</a></span><span class="op" id="7395107">,</span>&nbsp;<span class="ident" id="7395109"><a href="/database/sql/sql_test.go.html#7395031">w</a></span><span class="op" id="7395110">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395117">if</span>&nbsp;<span class="ident" id="7395120">n</span>&nbsp;<span class="op" id="7395122">:=</span>&nbsp;<span class="ident" id="7395125"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7395127">.</span><span class="ident" id="7395128">numDepsPollUntil</span><span class="op" id="7395144">(</span><span class="num" id="7395145">0</span><span class="op" id="7395146">,</span>&nbsp;<span class="ident" id="7395148"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7395152">.</span><span class="ident" id="7395153">Second</span><span class="op" id="7395159">)</span><span class="op" id="7395160">;</span>&nbsp;<span class="ident" id="7395162"><a href="/database/sql/sql_test.go.html#7395120">n</a></span>&nbsp;<span class="op" id="7395164">&gt;</span>&nbsp;<span class="num" id="7395166">0</span>&nbsp;<span class="op" id="7395168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395172"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7395173">.</span><span class="ident" id="7395174">Errorf</span><span class="op" id="7395180">(</span><span class="string" id="7395181">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7395222">,</span>&nbsp;<span class="ident" id="7395224"><a href="/database/sql/sql_test.go.html#7395120">n</a></span><span class="op" id="7395225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395229"><a href="/database/sql/sql_test.go.html#7392425">db</a></span><span class="op" id="7395231">.</span><span class="ident" id="7395232">dumpDeps</span><span class="op" id="7395240">(</span><span class="ident" id="7395241"><a href="/database/sql/sql_test.go.html#7392188">t</a></span><span class="op" id="7395242">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395245">}</span><br>
<span class="lineno"></span><span class="op" id="7395247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7395250">func</span>&nbsp;<span class="ident" id="7395255">TestSingleOpenConn</span><span class="op" id="7395273">(</span><span class="ident" id="7395274">t</span>&nbsp;<span class="op" id="7395276">*</span><span class="ident" id="7395277"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7395284">.</span><span class="ident" id="7395285">T</span><span class="op" id="7395286">)</span>&nbsp;<span class="op" id="7395288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395291">db</span>&nbsp;<span class="op" id="7395294">:=</span>&nbsp;<span class="ident" id="7395297"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7395306">(</span><span class="ident" id="7395307"><a href="/database/sql/sql_test.go.html#7395274">t</a></span><span class="op" id="7395308">,</span>&nbsp;<span class="string" id="7395310">&#34;people&#34;</span><span class="op" id="7395318">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395321">defer</span>&nbsp;<span class="ident" id="7395327"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7395334">(</span><span class="ident" id="7395335"><a href="/database/sql/sql_test.go.html#7395274">t</a></span><span class="op" id="7395336">,</span>&nbsp;<span class="ident" id="7395338"><a href="/database/sql/sql_test.go.html#7395291">db</a></span><span class="op" id="7395340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395344"><a href="/database/sql/sql_test.go.html#7395291">db</a></span><span class="op" id="7395346">.</span><span class="ident" id="7395347">SetMaxOpenConns</span><span class="op" id="7395362">(</span><span class="num" id="7395363">1</span><span class="op" id="7395364">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395368">rows</span><span class="op" id="7395372">,</span>&nbsp;<span class="ident" id="7395374">err</span>&nbsp;<span class="op" id="7395378">:=</span>&nbsp;<span class="ident" id="7395381"><a href="/database/sql/sql_test.go.html#7395291">db</a></span><span class="op" id="7395383">.</span><span class="ident" id="7395384">Query</span><span class="op" id="7395389">(</span><span class="string" id="7395390">&#34;SELECT|people|name|&#34;</span><span class="op" id="7395411">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395414">if</span>&nbsp;<span class="ident" id="7395417"><a href="/database/sql/sql_test.go.html#7395374">err</a></span>&nbsp;<span class="op" id="7395421">!=</span>&nbsp;<span class="ident" id="7395424">nil</span>&nbsp;<span class="op" id="7395428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395432"><a href="/database/sql/sql_test.go.html#7395274">t</a></span><span class="op" id="7395433">.</span><span class="ident" id="7395434">Fatal</span><span class="op" id="7395439">(</span><span class="ident" id="7395440"><a href="/database/sql/sql_test.go.html#7395374">err</a></span><span class="op" id="7395443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395449">if</span>&nbsp;<span class="ident" id="7395452"><a href="/database/sql/sql_test.go.html#7395374">err</a></span>&nbsp;<span class="op" id="7395456">=</span>&nbsp;<span class="ident" id="7395458"><a href="/database/sql/sql_test.go.html#7395368">rows</a></span><span class="op" id="7395462">.</span><span class="ident" id="7395463">Close</span><span class="op" id="7395468">(</span><span class="op" id="7395469">)</span><span class="op" id="7395470">;</span>&nbsp;<span class="ident" id="7395472"><a href="/database/sql/sql_test.go.html#7395374">err</a></span>&nbsp;<span class="op" id="7395476">!=</span>&nbsp;<span class="ident" id="7395479">nil</span>&nbsp;<span class="op" id="7395483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395487"><a href="/database/sql/sql_test.go.html#7395274">t</a></span><span class="op" id="7395488">.</span><span class="ident" id="7395489">Fatal</span><span class="op" id="7395494">(</span><span class="ident" id="7395495"><a href="/database/sql/sql_test.go.html#7395374">err</a></span><span class="op" id="7395498">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7395504">//&nbsp;shouldn&#39;t&nbsp;deadlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395527"><a href="/database/sql/sql_test.go.html#7395368">rows</a></span><span class="op" id="7395531">,</span>&nbsp;<span class="ident" id="7395533"><a href="/database/sql/sql_test.go.html#7395374">err</a></span>&nbsp;<span class="op" id="7395537">=</span>&nbsp;<span class="ident" id="7395539"><a href="/database/sql/sql_test.go.html#7395291">db</a></span><span class="op" id="7395541">.</span><span class="ident" id="7395542">Query</span><span class="op" id="7395547">(</span><span class="string" id="7395548">&#34;SELECT|people|name|&#34;</span><span class="op" id="7395569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395572">if</span>&nbsp;<span class="ident" id="7395575"><a href="/database/sql/sql_test.go.html#7395374">err</a></span>&nbsp;<span class="op" id="7395579">!=</span>&nbsp;<span class="ident" id="7395582">nil</span>&nbsp;<span class="op" id="7395586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395590"><a href="/database/sql/sql_test.go.html#7395274">t</a></span><span class="op" id="7395591">.</span><span class="ident" id="7395592">Fatal</span><span class="op" id="7395597">(</span><span class="ident" id="7395598"><a href="/database/sql/sql_test.go.html#7395374">err</a></span><span class="op" id="7395601">)</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395607">if</span>&nbsp;<span class="ident" id="7395610"><a href="/database/sql/sql_test.go.html#7395374">err</a></span>&nbsp;<span class="op" id="7395614">=</span>&nbsp;<span class="ident" id="7395616"><a href="/database/sql/sql_test.go.html#7395368">rows</a></span><span class="op" id="7395620">.</span><span class="ident" id="7395621">Close</span><span class="op" id="7395626">(</span><span class="op" id="7395627">)</span><span class="op" id="7395628">;</span>&nbsp;<span class="ident" id="7395630"><a href="/database/sql/sql_test.go.html#7395374">err</a></span>&nbsp;<span class="op" id="7395634">!=</span>&nbsp;<span class="ident" id="7395637">nil</span>&nbsp;<span class="op" id="7395641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395645"><a href="/database/sql/sql_test.go.html#7395274">t</a></span><span class="op" id="7395646">.</span><span class="ident" id="7395647">Fatal</span><span class="op" id="7395652">(</span><span class="ident" id="7395653"><a href="/database/sql/sql_test.go.html#7395374">err</a></span><span class="op" id="7395656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395659">}</span><br>
<span class="lineno"></span><span class="op" id="7395661">}</span><br>
<span class="lineno">1095</span><br>
<span class="lineno"></span><span class="comment" id="7395664">//&nbsp;golang.org/issue/5323</span><br>
<span class="lineno"></span><span class="keyword" id="7395689">func</span>&nbsp;<span class="ident" id="7395694">TestStmtCloseDeps</span><span class="op" id="7395711">(</span><span class="ident" id="7395712">t</span>&nbsp;<span class="op" id="7395714">*</span><span class="ident" id="7395715"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7395722">.</span><span class="ident" id="7395723">T</span><span class="op" id="7395724">)</span>&nbsp;<span class="op" id="7395726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395729">if</span>&nbsp;<span class="ident" id="7395732"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7395739">.</span><span class="ident" id="7395740">Short</span><span class="op" id="7395745">(</span><span class="op" id="7395746">)</span>&nbsp;<span class="op" id="7395748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395752"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7395753">.</span><span class="ident" id="7395754">Skip</span><span class="op" id="7395758">(</span><span class="string" id="7395759">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7395783">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395789">defer</span>&nbsp;<span class="ident" id="7395795"><a href="/database/sql/fakedb_test.go.html#7353989">setHookpostCloseConn</a></span><span class="op" id="7395815">(</span><span class="ident" id="7395816">nil</span><span class="op" id="7395819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395822"><a href="/database/sql/fakedb_test.go.html#7353989">setHookpostCloseConn</a></span><span class="op" id="7395842">(</span><span class="keyword" id="7395843">func</span><span class="op" id="7395847">(</span><span class="ident" id="7395848">_</span>&nbsp;<span class="op" id="7395850">*</span><span class="ident" id="7395851"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7395859">,</span>&nbsp;<span class="ident" id="7395861">err</span>&nbsp;<span class="builtintype" id="7395865">error</span><span class="op" id="7395870">)</span>&nbsp;<span class="op" id="7395872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395876">if</span>&nbsp;<span class="ident" id="7395879"><a href="/database/sql/sql_test.go.html#7395861">err</a></span>&nbsp;<span class="op" id="7395883">!=</span>&nbsp;<span class="ident" id="7395886">nil</span>&nbsp;<span class="op" id="7395890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395895"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7395896">.</span><span class="ident" id="7395897">Errorf</span><span class="op" id="7395903">(</span><span class="string" id="7395904">&#34;Error&nbsp;closing&nbsp;fakeConn:&nbsp;%v&#34;</span><span class="op" id="7395932">,</span>&nbsp;<span class="ident" id="7395934"><a href="/database/sql/sql_test.go.html#7395861">err</a></span><span class="op" id="7395937">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395944">}</span><span class="op" id="7395945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395949">db</span>&nbsp;<span class="op" id="7395952">:=</span>&nbsp;<span class="ident" id="7395955"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7395964">(</span><span class="ident" id="7395965"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7395966">,</span>&nbsp;<span class="string" id="7395968">&#34;magicquery&#34;</span><span class="op" id="7395980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395983">defer</span>&nbsp;<span class="ident" id="7395989"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7395996">(</span><span class="ident" id="7395997"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7395998">,</span>&nbsp;<span class="ident" id="7396000"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7396002">)</span><br>
<span class="lineno">1110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396006">driver</span>&nbsp;<span class="op" id="7396013">:=</span>&nbsp;<span class="ident" id="7396016"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7396018">.</span><span class="ident" id="7396019">driver</span><span class="op" id="7396025">.</span><span class="op" id="7396026">(</span><span class="op" id="7396027">*</span><span class="ident" id="7396028"><a href="/database/sql/fakedb_test.go.html#7349239">fakeDriver</a></span><span class="op" id="7396038">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396042"><a href="/database/sql/sql_test.go.html#7396006">driver</a></span><span class="op" id="7396048">.</span><span class="ident" id="7396049">mu</span><span class="op" id="7396051">.</span><span class="ident" id="7396052">Lock</span><span class="op" id="7396056">(</span><span class="op" id="7396057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396060">opens0</span>&nbsp;<span class="op" id="7396067">:=</span>&nbsp;<span class="ident" id="7396070"><a href="/database/sql/sql_test.go.html#7396006">driver</a></span><span class="op" id="7396076">.</span><span class="ident" id="7396077">openCount</span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396088">closes0</span>&nbsp;<span class="op" id="7396096">:=</span>&nbsp;<span class="ident" id="7396099"><a href="/database/sql/sql_test.go.html#7396006">driver</a></span><span class="op" id="7396105">.</span><span class="ident" id="7396106">closeCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396118"><a href="/database/sql/sql_test.go.html#7396006">driver</a></span><span class="op" id="7396124">.</span><span class="ident" id="7396125">mu</span><span class="op" id="7396127">.</span><span class="ident" id="7396128">Unlock</span><span class="op" id="7396134">(</span><span class="op" id="7396135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396138">openDelta0</span>&nbsp;<span class="op" id="7396149">:=</span>&nbsp;<span class="ident" id="7396152"><a href="/database/sql/sql_test.go.html#7396060">opens0</a></span>&nbsp;<span class="op" id="7396159">-</span>&nbsp;<span class="ident" id="7396161"><a href="/database/sql/sql_test.go.html#7396088">closes0</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396171">stmt</span><span class="op" id="7396175">,</span>&nbsp;<span class="ident" id="7396177">err</span>&nbsp;<span class="op" id="7396181">:=</span>&nbsp;<span class="ident" id="7396184"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7396186">.</span><span class="ident" id="7396187">Prepare</span><span class="op" id="7396194">(</span><span class="string" id="7396195">&#34;SELECT|magicquery|op|op=?,millis=?&#34;</span><span class="op" id="7396231">)</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396234">if</span>&nbsp;<span class="ident" id="7396237"><a href="/database/sql/sql_test.go.html#7396177">err</a></span>&nbsp;<span class="op" id="7396241">!=</span>&nbsp;<span class="ident" id="7396244">nil</span>&nbsp;<span class="op" id="7396248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396252"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7396253">.</span><span class="ident" id="7396254">Fatal</span><span class="op" id="7396259">(</span><span class="ident" id="7396260"><a href="/database/sql/sql_test.go.html#7396177">err</a></span><span class="op" id="7396263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7396266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7396270">//&nbsp;Start&nbsp;50&nbsp;parallel&nbsp;slow&nbsp;queries.</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396306">const</span>&nbsp;<span class="op" id="7396312">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396316">nquery</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7396328">=</span>&nbsp;<span class="num" id="7396330">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396335">sleepMillis</span>&nbsp;<span class="op" id="7396347">=</span>&nbsp;<span class="num" id="7396349">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396354">nbatch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7396366">=</span>&nbsp;<span class="num" id="7396368">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7396371">)</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396374">var</span>&nbsp;<span class="ident" id="7396378">wg</span>&nbsp;<span class="ident" id="7396381"><a href="/database/sql/sql_test.go.html#7368984">sync</a></span><span class="op" id="7396385">.</span><span class="ident" id="7396386">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396397">for</span>&nbsp;<span class="ident" id="7396401">batch</span>&nbsp;<span class="op" id="7396407">:=</span>&nbsp;<span class="num" id="7396410">0</span><span class="op" id="7396411">;</span>&nbsp;<span class="ident" id="7396413"><a href="/database/sql/sql_test.go.html#7396401">batch</a></span>&nbsp;<span class="op" id="7396419">&lt;</span>&nbsp;<span class="ident" id="7396421"><a href="/database/sql/sql_test.go.html#7396354">nbatch</a></span><span class="op" id="7396427">;</span>&nbsp;<span class="ident" id="7396429"><a href="/database/sql/sql_test.go.html#7396401">batch</a></span><span class="op" id="7396434">++</span>&nbsp;<span class="op" id="7396437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396441">for</span>&nbsp;<span class="ident" id="7396445">i</span>&nbsp;<span class="op" id="7396447">:=</span>&nbsp;<span class="num" id="7396450">0</span><span class="op" id="7396451">;</span>&nbsp;<span class="ident" id="7396453"><a href="/database/sql/sql_test.go.html#7396445">i</a></span>&nbsp;<span class="op" id="7396455">&lt;</span>&nbsp;<span class="ident" id="7396457"><a href="/database/sql/sql_test.go.html#7396316">nquery</a></span><span class="op" id="7396463">;</span>&nbsp;<span class="ident" id="7396465"><a href="/database/sql/sql_test.go.html#7396445">i</a></span><span class="op" id="7396466">++</span>&nbsp;<span class="op" id="7396469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396474"><a href="/database/sql/sql_test.go.html#7396378">wg</a></span><span class="op" id="7396476">.</span><span class="ident" id="7396477">Add</span><span class="op" id="7396480">(</span><span class="num" id="7396481">1</span><span class="op" id="7396482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396487">go</span>&nbsp;<span class="keyword" id="7396490">func</span><span class="op" id="7396494">(</span><span class="op" id="7396495">)</span>&nbsp;<span class="op" id="7396497">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396503">defer</span>&nbsp;<span class="ident" id="7396509"><a href="/database/sql/sql_test.go.html#7396378">wg</a></span><span class="op" id="7396511">.</span><span class="ident" id="7396512">Done</span><span class="op" id="7396516">(</span><span class="op" id="7396517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396523">var</span>&nbsp;<span class="ident" id="7396527">op</span>&nbsp;<span class="builtintype" id="7396530">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396541">if</span>&nbsp;<span class="ident" id="7396544">err</span>&nbsp;<span class="op" id="7396548">:=</span>&nbsp;<span class="ident" id="7396551"><a href="/database/sql/sql_test.go.html#7396171">stmt</a></span><span class="op" id="7396555">.</span><span class="ident" id="7396556">QueryRow</span><span class="op" id="7396564">(</span><span class="string" id="7396565">&#34;sleep&#34;</span><span class="op" id="7396572">,</span>&nbsp;<span class="ident" id="7396574"><a href="/database/sql/sql_test.go.html#7396335">sleepMillis</a></span><span class="op" id="7396585">)</span><span class="op" id="7396586">.</span><span class="ident" id="7396587">Scan</span><span class="op" id="7396591">(</span><span class="op" id="7396592">&amp;</span><span class="ident" id="7396593"><a href="/database/sql/sql_test.go.html#7396527">op</a></span><span class="op" id="7396595">)</span><span class="op" id="7396596">;</span>&nbsp;<span class="ident" id="7396598"><a href="/database/sql/sql_test.go.html#7396544">err</a></span>&nbsp;<span class="op" id="7396602">!=</span>&nbsp;<span class="ident" id="7396605">nil</span>&nbsp;<span class="op" id="7396609">&amp;&amp;</span>&nbsp;<span class="ident" id="7396612"><a href="/database/sql/sql_test.go.html#7396544">err</a></span>&nbsp;<span class="op" id="7396616">!=</span>&nbsp;<span class="ident" id="7396619"><a href="/database/sql/sql.go.html#6353466">ErrNoRows</a></span>&nbsp;<span class="op" id="7396629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396636"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7396637">.</span><span class="ident" id="7396638">Error</span><span class="op" id="7396643">(</span><span class="ident" id="7396644"><a href="/database/sql/sql_test.go.html#7396544">err</a></span><span class="op" id="7396647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7396653">}</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7396658">}</span><span class="op" id="7396659">(</span><span class="op" id="7396660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7396664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7396668">//&nbsp;Sleep&nbsp;for&nbsp;twice&nbsp;the&nbsp;expected&nbsp;length&nbsp;of&nbsp;time&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7396725">//&nbsp;batch&nbsp;of&nbsp;50&nbsp;queries&nbsp;above&nbsp;to&nbsp;finish&nbsp;before&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7396782">//&nbsp;the&nbsp;next&nbsp;round.</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396803"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7396807">.</span><span class="ident" id="7396808">Sleep</span><span class="op" id="7396813">(</span><span class="num" id="7396814">2</span>&nbsp;<span class="op" id="7396816">*</span>&nbsp;<span class="ident" id="7396818"><a href="/database/sql/sql_test.go.html#7396335">sleepMillis</a></span>&nbsp;<span class="op" id="7396830">*</span>&nbsp;<span class="ident" id="7396832"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7396836">.</span><span class="ident" id="7396837">Millisecond</span><span class="op" id="7396848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7396851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396854"><a href="/database/sql/sql_test.go.html#7396378">wg</a></span><span class="op" id="7396856">.</span><span class="ident" id="7396857">Wait</span><span class="op" id="7396861">(</span><span class="op" id="7396862">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396866">if</span>&nbsp;<span class="ident" id="7396869">g</span><span class="op" id="7396870">,</span>&nbsp;<span class="ident" id="7396872">w</span>&nbsp;<span class="op" id="7396874">:=</span>&nbsp;<span class="ident" id="7396877"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7396879">.</span><span class="ident" id="7396880">numFreeConns</span><span class="op" id="7396892">(</span><span class="op" id="7396893">)</span><span class="op" id="7396894">,</span>&nbsp;<span class="num" id="7396896">2</span><span class="op" id="7396897">;</span>&nbsp;<span class="ident" id="7396899"><a href="/database/sql/sql_test.go.html#7396869">g</a></span>&nbsp;<span class="op" id="7396901">!=</span>&nbsp;<span class="ident" id="7396904"><a href="/database/sql/sql_test.go.html#7396872">w</a></span>&nbsp;<span class="op" id="7396906">{</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396910"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7396911">.</span><span class="ident" id="7396912">Errorf</span><span class="op" id="7396918">(</span><span class="string" id="7396919">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7396945">,</span>&nbsp;<span class="ident" id="7396947"><a href="/database/sql/sql_test.go.html#7396869">g</a></span><span class="op" id="7396948">,</span>&nbsp;<span class="ident" id="7396950"><a href="/database/sql/sql_test.go.html#7396872">w</a></span><span class="op" id="7396951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7396954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396958">if</span>&nbsp;<span class="ident" id="7396961">n</span>&nbsp;<span class="op" id="7396963">:=</span>&nbsp;<span class="ident" id="7396966"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7396968">.</span><span class="ident" id="7396969">numDepsPollUntil</span><span class="op" id="7396985">(</span><span class="num" id="7396986">4</span><span class="op" id="7396987">,</span>&nbsp;<span class="ident" id="7396989"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7396993">.</span><span class="ident" id="7396994">Second</span><span class="op" id="7397000">)</span><span class="op" id="7397001">;</span>&nbsp;<span class="ident" id="7397003"><a href="/database/sql/sql_test.go.html#7396961">n</a></span>&nbsp;<span class="op" id="7397005">&gt;</span>&nbsp;<span class="num" id="7397007">4</span>&nbsp;<span class="op" id="7397009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397013"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7397014">.</span><span class="ident" id="7397015">Errorf</span><span class="op" id="7397021">(</span><span class="string" id="7397022">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;&lt;=&nbsp;4&#34;</span><span class="op" id="7397066">,</span>&nbsp;<span class="ident" id="7397068"><a href="/database/sql/sql_test.go.html#7396961">n</a></span><span class="op" id="7397069">)</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397073"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7397075">.</span><span class="ident" id="7397076">dumpDeps</span><span class="op" id="7397084">(</span><span class="ident" id="7397085"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7397086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397093"><a href="/database/sql/sql_test.go.html#7396006">driver</a></span><span class="op" id="7397099">.</span><span class="ident" id="7397100">mu</span><span class="op" id="7397102">.</span><span class="ident" id="7397103">Lock</span><span class="op" id="7397107">(</span><span class="op" id="7397108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397111">opens</span>&nbsp;<span class="op" id="7397117">:=</span>&nbsp;<span class="ident" id="7397120"><a href="/database/sql/sql_test.go.html#7396006">driver</a></span><span class="op" id="7397126">.</span><span class="ident" id="7397127">openCount</span>&nbsp;<span class="op" id="7397137">-</span>&nbsp;<span class="ident" id="7397139"><a href="/database/sql/sql_test.go.html#7396060">opens0</a></span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397147">closes</span>&nbsp;<span class="op" id="7397154">:=</span>&nbsp;<span class="ident" id="7397157"><a href="/database/sql/sql_test.go.html#7396006">driver</a></span><span class="op" id="7397163">.</span><span class="ident" id="7397164">closeCount</span>&nbsp;<span class="op" id="7397175">-</span>&nbsp;<span class="ident" id="7397177"><a href="/database/sql/sql_test.go.html#7396088">closes0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397186">openDelta</span>&nbsp;<span class="op" id="7397196">:=</span>&nbsp;<span class="op" id="7397199">(</span><span class="ident" id="7397200"><a href="/database/sql/sql_test.go.html#7396006">driver</a></span><span class="op" id="7397206">.</span><span class="ident" id="7397207">openCount</span>&nbsp;<span class="op" id="7397217">-</span>&nbsp;<span class="ident" id="7397219"><a href="/database/sql/sql_test.go.html#7396006">driver</a></span><span class="op" id="7397225">.</span><span class="ident" id="7397226">closeCount</span><span class="op" id="7397236">)</span>&nbsp;<span class="op" id="7397238">-</span>&nbsp;<span class="ident" id="7397240"><a href="/database/sql/sql_test.go.html#7396138">openDelta0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397252"><a href="/database/sql/sql_test.go.html#7396006">driver</a></span><span class="op" id="7397258">.</span><span class="ident" id="7397259">mu</span><span class="op" id="7397261">.</span><span class="ident" id="7397262">Unlock</span><span class="op" id="7397268">(</span><span class="op" id="7397269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397273">if</span>&nbsp;<span class="ident" id="7397276"><a href="/database/sql/sql_test.go.html#7397186">openDelta</a></span>&nbsp;<span class="op" id="7397286">&gt;</span>&nbsp;<span class="num" id="7397288">2</span>&nbsp;<span class="op" id="7397290">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397294"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7397295">.</span><span class="ident" id="7397296">Logf</span><span class="op" id="7397300">(</span><span class="string" id="7397301">&#34;open&nbsp;calls&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7397318">,</span>&nbsp;<span class="ident" id="7397320"><a href="/database/sql/sql_test.go.html#7397111">opens</a></span><span class="op" id="7397325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397329"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7397330">.</span><span class="ident" id="7397331">Logf</span><span class="op" id="7397335">(</span><span class="string" id="7397336">&#34;close&nbsp;calls&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7397354">,</span>&nbsp;<span class="ident" id="7397356"><a href="/database/sql/sql_test.go.html#7397147">closes</a></span><span class="op" id="7397362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397366"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7397367">.</span><span class="ident" id="7397368">Logf</span><span class="op" id="7397372">(</span><span class="string" id="7397373">&#34;open&nbsp;delta&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7397390">,</span>&nbsp;<span class="ident" id="7397392"><a href="/database/sql/sql_test.go.html#7397186">openDelta</a></span><span class="op" id="7397401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397405"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7397406">.</span><span class="ident" id="7397407">Errorf</span><span class="op" id="7397413">(</span><span class="string" id="7397414">&#34;db&nbsp;connections&nbsp;opened&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;2&#34;</span><span class="op" id="7397453">,</span>&nbsp;<span class="ident" id="7397455"><a href="/database/sql/sql_test.go.html#7397186">openDelta</a></span><span class="op" id="7397464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397468"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7397470">.</span><span class="ident" id="7397471">dumpDeps</span><span class="op" id="7397479">(</span><span class="ident" id="7397480"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7397481">)</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397488">if</span>&nbsp;<span class="builtinfunc" id="7397491">len</span><span class="op" id="7397494">(</span><span class="ident" id="7397495"><a href="/database/sql/sql_test.go.html#7396171">stmt</a></span><span class="op" id="7397499">.</span><span class="ident" id="7397500">css</span><span class="op" id="7397503">)</span>&nbsp;<span class="op" id="7397505">&gt;</span>&nbsp;<span class="ident" id="7397507"><a href="/database/sql/sql_test.go.html#7396316">nquery</a></span>&nbsp;<span class="op" id="7397514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397518"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7397519">.</span><span class="ident" id="7397520">Errorf</span><span class="op" id="7397526">(</span><span class="string" id="7397527">&#34;len(stmt.css)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;%d&#34;</span><span class="op" id="7397559">,</span>&nbsp;<span class="builtinfunc" id="7397561">len</span><span class="op" id="7397564">(</span><span class="ident" id="7397565"><a href="/database/sql/sql_test.go.html#7396171">stmt</a></span><span class="op" id="7397569">.</span><span class="ident" id="7397570">css</span><span class="op" id="7397573">)</span><span class="op" id="7397574">,</span>&nbsp;<span class="ident" id="7397576"><a href="/database/sql/sql_test.go.html#7396316">nquery</a></span><span class="op" id="7397582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397585">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397589">if</span>&nbsp;<span class="ident" id="7397592">err</span>&nbsp;<span class="op" id="7397596">:=</span>&nbsp;<span class="ident" id="7397599"><a href="/database/sql/sql_test.go.html#7396171">stmt</a></span><span class="op" id="7397603">.</span><span class="ident" id="7397604">Close</span><span class="op" id="7397609">(</span><span class="op" id="7397610">)</span><span class="op" id="7397611">;</span>&nbsp;<span class="ident" id="7397613"><a href="/database/sql/sql_test.go.html#7397592">err</a></span>&nbsp;<span class="op" id="7397617">!=</span>&nbsp;<span class="ident" id="7397620">nil</span>&nbsp;<span class="op" id="7397624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397628"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7397629">.</span><span class="ident" id="7397630">Fatal</span><span class="op" id="7397635">(</span><span class="ident" id="7397636"><a href="/database/sql/sql_test.go.html#7397592">err</a></span><span class="op" id="7397639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397646">if</span>&nbsp;<span class="ident" id="7397649">g</span><span class="op" id="7397650">,</span>&nbsp;<span class="ident" id="7397652">w</span>&nbsp;<span class="op" id="7397654">:=</span>&nbsp;<span class="ident" id="7397657"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7397659">.</span><span class="ident" id="7397660">numFreeConns</span><span class="op" id="7397672">(</span><span class="op" id="7397673">)</span><span class="op" id="7397674">,</span>&nbsp;<span class="num" id="7397676">2</span><span class="op" id="7397677">;</span>&nbsp;<span class="ident" id="7397679"><a href="/database/sql/sql_test.go.html#7397649">g</a></span>&nbsp;<span class="op" id="7397681">!=</span>&nbsp;<span class="ident" id="7397684"><a href="/database/sql/sql_test.go.html#7397652">w</a></span>&nbsp;<span class="op" id="7397686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397690"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7397691">.</span><span class="ident" id="7397692">Errorf</span><span class="op" id="7397698">(</span><span class="string" id="7397699">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7397725">,</span>&nbsp;<span class="ident" id="7397727"><a href="/database/sql/sql_test.go.html#7397649">g</a></span><span class="op" id="7397728">,</span>&nbsp;<span class="ident" id="7397730"><a href="/database/sql/sql_test.go.html#7397652">w</a></span><span class="op" id="7397731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397738">if</span>&nbsp;<span class="ident" id="7397741">n</span>&nbsp;<span class="op" id="7397743">:=</span>&nbsp;<span class="ident" id="7397746"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7397748">.</span><span class="ident" id="7397749">numDepsPollUntil</span><span class="op" id="7397765">(</span><span class="num" id="7397766">2</span><span class="op" id="7397767">,</span>&nbsp;<span class="ident" id="7397769"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7397773">.</span><span class="ident" id="7397774">Second</span><span class="op" id="7397780">)</span><span class="op" id="7397781">;</span>&nbsp;<span class="ident" id="7397783"><a href="/database/sql/sql_test.go.html#7397741">n</a></span>&nbsp;<span class="op" id="7397785">&gt;</span>&nbsp;<span class="num" id="7397787">2</span>&nbsp;<span class="op" id="7397789">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397793"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7397794">.</span><span class="ident" id="7397795">Errorf</span><span class="op" id="7397801">(</span><span class="string" id="7397802">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;&lt;=&nbsp;2&#34;</span><span class="op" id="7397846">,</span>&nbsp;<span class="ident" id="7397848"><a href="/database/sql/sql_test.go.html#7397741">n</a></span><span class="op" id="7397849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397853"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7397855">.</span><span class="ident" id="7397856">dumpDeps</span><span class="op" id="7397864">(</span><span class="ident" id="7397865"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7397866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397873"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7397875">.</span><span class="ident" id="7397876">SetMaxIdleConns</span><span class="op" id="7397891">(</span><span class="num" id="7397892">0</span><span class="op" id="7397893">)</span><br>
<span class="lineno">1190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397897">if</span>&nbsp;<span class="ident" id="7397900">g</span><span class="op" id="7397901">,</span>&nbsp;<span class="ident" id="7397903">w</span>&nbsp;<span class="op" id="7397905">:=</span>&nbsp;<span class="ident" id="7397908"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7397910">.</span><span class="ident" id="7397911">numFreeConns</span><span class="op" id="7397923">(</span><span class="op" id="7397924">)</span><span class="op" id="7397925">,</span>&nbsp;<span class="num" id="7397927">0</span><span class="op" id="7397928">;</span>&nbsp;<span class="ident" id="7397930"><a href="/database/sql/sql_test.go.html#7397900">g</a></span>&nbsp;<span class="op" id="7397932">!=</span>&nbsp;<span class="ident" id="7397935"><a href="/database/sql/sql_test.go.html#7397903">w</a></span>&nbsp;<span class="op" id="7397937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397941"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7397942">.</span><span class="ident" id="7397943">Errorf</span><span class="op" id="7397949">(</span><span class="string" id="7397950">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7397976">,</span>&nbsp;<span class="ident" id="7397978"><a href="/database/sql/sql_test.go.html#7397900">g</a></span><span class="op" id="7397979">,</span>&nbsp;<span class="ident" id="7397981"><a href="/database/sql/sql_test.go.html#7397903">w</a></span><span class="op" id="7397982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397989">if</span>&nbsp;<span class="ident" id="7397992">n</span>&nbsp;<span class="op" id="7397994">:=</span>&nbsp;<span class="ident" id="7397997"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7397999">.</span><span class="ident" id="7398000">numDepsPollUntil</span><span class="op" id="7398016">(</span><span class="num" id="7398017">0</span><span class="op" id="7398018">,</span>&nbsp;<span class="ident" id="7398020"><a href="/database/sql/sql_test.go.html#7369003">time</a></span><span class="op" id="7398024">.</span><span class="ident" id="7398025">Second</span><span class="op" id="7398031">)</span><span class="op" id="7398032">;</span>&nbsp;<span class="ident" id="7398034"><a href="/database/sql/sql_test.go.html#7397992">n</a></span>&nbsp;<span class="op" id="7398036">&gt;</span>&nbsp;<span class="num" id="7398038">0</span>&nbsp;<span class="op" id="7398040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398044"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7398045">.</span><span class="ident" id="7398046">Errorf</span><span class="op" id="7398052">(</span><span class="string" id="7398053">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7398094">,</span>&nbsp;<span class="ident" id="7398096"><a href="/database/sql/sql_test.go.html#7397992">n</a></span><span class="op" id="7398097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398101"><a href="/database/sql/sql_test.go.html#7395949">db</a></span><span class="op" id="7398103">.</span><span class="ident" id="7398104">dumpDeps</span><span class="op" id="7398112">(</span><span class="ident" id="7398113"><a href="/database/sql/sql_test.go.html#7395712">t</a></span><span class="op" id="7398114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7398117">}</span><br>
<span class="lineno"></span><span class="op" id="7398119">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="7398122">//&nbsp;golang.org/issue/5046</span><br>
<span class="lineno"></span><span class="keyword" id="7398147">func</span>&nbsp;<span class="ident" id="7398152">TestCloseConnBeforeStmts</span><span class="op" id="7398176">(</span><span class="ident" id="7398177">t</span>&nbsp;<span class="op" id="7398179">*</span><span class="ident" id="7398180"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7398187">.</span><span class="ident" id="7398188">T</span><span class="op" id="7398189">)</span>&nbsp;<span class="op" id="7398191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398194">db</span>&nbsp;<span class="op" id="7398197">:=</span>&nbsp;<span class="ident" id="7398200"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7398209">(</span><span class="ident" id="7398210"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7398211">,</span>&nbsp;<span class="string" id="7398213">&#34;people&#34;</span><span class="op" id="7398221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398224">defer</span>&nbsp;<span class="ident" id="7398230"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7398237">(</span><span class="ident" id="7398238"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7398239">,</span>&nbsp;<span class="ident" id="7398241"><a href="/database/sql/sql_test.go.html#7398194">db</a></span><span class="op" id="7398243">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398247">defer</span>&nbsp;<span class="ident" id="7398253"><a href="/database/sql/fakedb_test.go.html#7353989">setHookpostCloseConn</a></span><span class="op" id="7398273">(</span><span class="ident" id="7398274">nil</span><span class="op" id="7398277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398280"><a href="/database/sql/fakedb_test.go.html#7353989">setHookpostCloseConn</a></span><span class="op" id="7398300">(</span><span class="keyword" id="7398301">func</span><span class="op" id="7398305">(</span><span class="ident" id="7398306">_</span>&nbsp;<span class="op" id="7398308">*</span><span class="ident" id="7398309"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7398317">,</span>&nbsp;<span class="ident" id="7398319">err</span>&nbsp;<span class="builtintype" id="7398323">error</span><span class="op" id="7398328">)</span>&nbsp;<span class="op" id="7398330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398334">if</span>&nbsp;<span class="ident" id="7398337"><a href="/database/sql/sql_test.go.html#7398319">err</a></span>&nbsp;<span class="op" id="7398341">!=</span>&nbsp;<span class="ident" id="7398344">nil</span>&nbsp;<span class="op" id="7398348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398353"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7398354">.</span><span class="ident" id="7398355">Errorf</span><span class="op" id="7398361">(</span><span class="string" id="7398362">&#34;Error&nbsp;closing&nbsp;fakeConn:&nbsp;%v;&nbsp;from&nbsp;%s&#34;</span><span class="op" id="7398399">,</span>&nbsp;<span class="ident" id="7398401"><a href="/database/sql/sql_test.go.html#7398319">err</a></span><span class="op" id="7398404">,</span>&nbsp;<span class="ident" id="7398406"><a href="/database/sql/sql.go.html#6394298">stack</a></span><span class="op" id="7398411">(</span><span class="op" id="7398412">)</span><span class="op" id="7398413">)</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398418"><a href="/database/sql/sql_test.go.html#7398194">db</a></span><span class="op" id="7398420">.</span><span class="ident" id="7398421">dumpDeps</span><span class="op" id="7398429">(</span><span class="ident" id="7398430"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7398431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398436"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7398437">.</span><span class="ident" id="7398438">Errorf</span><span class="op" id="7398444">(</span><span class="string" id="7398445">&#34;DB&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7398455">,</span>&nbsp;<span class="ident" id="7398457"><a href="/database/sql/sql_test.go.html#7398194">db</a></span><span class="op" id="7398459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7398463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7398466">}</span><span class="op" id="7398467">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398471">stmt</span><span class="op" id="7398475">,</span>&nbsp;<span class="ident" id="7398477">err</span>&nbsp;<span class="op" id="7398481">:=</span>&nbsp;<span class="ident" id="7398484"><a href="/database/sql/sql_test.go.html#7398194">db</a></span><span class="op" id="7398486">.</span><span class="ident" id="7398487">Prepare</span><span class="op" id="7398494">(</span><span class="string" id="7398495">&#34;SELECT|people|name|&#34;</span><span class="op" id="7398516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398519">if</span>&nbsp;<span class="ident" id="7398522"><a href="/database/sql/sql_test.go.html#7398477">err</a></span>&nbsp;<span class="op" id="7398526">!=</span>&nbsp;<span class="ident" id="7398529">nil</span>&nbsp;<span class="op" id="7398533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398537"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7398538">.</span><span class="ident" id="7398539">Fatal</span><span class="op" id="7398544">(</span><span class="ident" id="7398545"><a href="/database/sql/sql_test.go.html#7398477">err</a></span><span class="op" id="7398548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7398551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398555">if</span>&nbsp;<span class="builtinfunc" id="7398558">len</span><span class="op" id="7398561">(</span><span class="ident" id="7398562"><a href="/database/sql/sql_test.go.html#7398194">db</a></span><span class="op" id="7398564">.</span><span class="ident" id="7398565">freeConn</span><span class="op" id="7398573">)</span>&nbsp;<span class="op" id="7398575">!=</span>&nbsp;<span class="num" id="7398578">1</span>&nbsp;<span class="op" id="7398580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398584"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7398585">.</span><span class="ident" id="7398586">Fatalf</span><span class="op" id="7398592">(</span><span class="string" id="7398593">&#34;expected&nbsp;1&nbsp;freeConn;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7398622">,</span>&nbsp;<span class="builtinfunc" id="7398624">len</span><span class="op" id="7398627">(</span><span class="ident" id="7398628"><a href="/database/sql/sql_test.go.html#7398194">db</a></span><span class="op" id="7398630">.</span><span class="ident" id="7398631">freeConn</span><span class="op" id="7398639">)</span><span class="op" id="7398640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7398643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398646">dc</span>&nbsp;<span class="op" id="7398649">:=</span>&nbsp;<span class="ident" id="7398652"><a href="/database/sql/sql_test.go.html#7398194">db</a></span><span class="op" id="7398654">.</span><span class="ident" id="7398655">freeConn</span><span class="op" id="7398663">[</span><span class="num" id="7398664">0</span><span class="op" id="7398665">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398668">if</span>&nbsp;<span class="ident" id="7398671"><a href="/database/sql/sql_test.go.html#7398646">dc</a></span><span class="op" id="7398673">.</span><span class="ident" id="7398674">closed</span>&nbsp;<span class="op" id="7398681">{</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398685"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7398686">.</span><span class="ident" id="7398687">Errorf</span><span class="op" id="7398693">(</span><span class="string" id="7398694">&#34;conn&nbsp;shouldn&#39;t&nbsp;be&nbsp;closed&#34;</span><span class="op" id="7398720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7398723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398727">if</span>&nbsp;<span class="ident" id="7398730">n</span>&nbsp;<span class="op" id="7398732">:=</span>&nbsp;<span class="builtinfunc" id="7398735">len</span><span class="op" id="7398738">(</span><span class="ident" id="7398739"><a href="/database/sql/sql_test.go.html#7398646">dc</a></span><span class="op" id="7398741">.</span><span class="ident" id="7398742">openStmt</span><span class="op" id="7398750">)</span><span class="op" id="7398751">;</span>&nbsp;<span class="ident" id="7398753"><a href="/database/sql/sql_test.go.html#7398730">n</a></span>&nbsp;<span class="op" id="7398755">!=</span>&nbsp;<span class="num" id="7398758">1</span>&nbsp;<span class="op" id="7398760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398764"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7398765">.</span><span class="ident" id="7398766">Errorf</span><span class="op" id="7398772">(</span><span class="string" id="7398773">&#34;driverConn&nbsp;num&nbsp;openStmt&nbsp;=&nbsp;%d;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7398811">,</span>&nbsp;<span class="ident" id="7398813"><a href="/database/sql/sql_test.go.html#7398730">n</a></span><span class="op" id="7398814">)</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7398817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398820"><a href="/database/sql/sql_test.go.html#7398477">err</a></span>&nbsp;<span class="op" id="7398824">=</span>&nbsp;<span class="ident" id="7398826"><a href="/database/sql/sql_test.go.html#7398194">db</a></span><span class="op" id="7398828">.</span><span class="ident" id="7398829">Close</span><span class="op" id="7398834">(</span><span class="op" id="7398835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398838">if</span>&nbsp;<span class="ident" id="7398841"><a href="/database/sql/sql_test.go.html#7398477">err</a></span>&nbsp;<span class="op" id="7398845">!=</span>&nbsp;<span class="ident" id="7398848">nil</span>&nbsp;<span class="op" id="7398852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398856"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7398857">.</span><span class="ident" id="7398858">Errorf</span><span class="op" id="7398864">(</span><span class="string" id="7398865">&#34;db&nbsp;Close&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7398880">,</span>&nbsp;<span class="ident" id="7398882"><a href="/database/sql/sql_test.go.html#7398477">err</a></span><span class="op" id="7398885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7398888">}</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398891">if</span>&nbsp;<span class="op" id="7398894">!</span><span class="ident" id="7398895"><a href="/database/sql/sql_test.go.html#7398646">dc</a></span><span class="op" id="7398897">.</span><span class="ident" id="7398898">closed</span>&nbsp;<span class="op" id="7398905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398909"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7398910">.</span><span class="ident" id="7398911">Errorf</span><span class="op" id="7398917">(</span><span class="string" id="7398918">&#34;after&nbsp;db.Close,&nbsp;driverConn&nbsp;should&nbsp;be&nbsp;closed&#34;</span><span class="op" id="7398963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7398966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398969">if</span>&nbsp;<span class="ident" id="7398972">n</span>&nbsp;<span class="op" id="7398974">:=</span>&nbsp;<span class="builtinfunc" id="7398977">len</span><span class="op" id="7398980">(</span><span class="ident" id="7398981"><a href="/database/sql/sql_test.go.html#7398646">dc</a></span><span class="op" id="7398983">.</span><span class="ident" id="7398984">openStmt</span><span class="op" id="7398992">)</span><span class="op" id="7398993">;</span>&nbsp;<span class="ident" id="7398995"><a href="/database/sql/sql_test.go.html#7398972">n</a></span>&nbsp;<span class="op" id="7398997">!=</span>&nbsp;<span class="num" id="7399000">0</span>&nbsp;<span class="op" id="7399002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399006"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7399007">.</span><span class="ident" id="7399008">Errorf</span><span class="op" id="7399014">(</span><span class="string" id="7399015">&#34;driverConn&nbsp;num&nbsp;openStmt&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7399053">,</span>&nbsp;<span class="ident" id="7399055"><a href="/database/sql/sql_test.go.html#7398972">n</a></span><span class="op" id="7399056">)</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399063"><a href="/database/sql/sql_test.go.html#7398477">err</a></span>&nbsp;<span class="op" id="7399067">=</span>&nbsp;<span class="ident" id="7399069"><a href="/database/sql/sql_test.go.html#7398471">stmt</a></span><span class="op" id="7399073">.</span><span class="ident" id="7399074">Close</span><span class="op" id="7399079">(</span><span class="op" id="7399080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399083">if</span>&nbsp;<span class="ident" id="7399086"><a href="/database/sql/sql_test.go.html#7398477">err</a></span>&nbsp;<span class="op" id="7399090">!=</span>&nbsp;<span class="ident" id="7399093">nil</span>&nbsp;<span class="op" id="7399097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399101"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7399102">.</span><span class="ident" id="7399103">Errorf</span><span class="op" id="7399109">(</span><span class="string" id="7399110">&#34;Stmt&nbsp;close&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7399127">,</span>&nbsp;<span class="ident" id="7399129"><a href="/database/sql/sql_test.go.html#7398477">err</a></span><span class="op" id="7399132">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399139">if</span>&nbsp;<span class="op" id="7399142">!</span><span class="ident" id="7399143"><a href="/database/sql/sql_test.go.html#7398646">dc</a></span><span class="op" id="7399145">.</span><span class="ident" id="7399146">closed</span>&nbsp;<span class="op" id="7399153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399157"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7399158">.</span><span class="ident" id="7399159">Errorf</span><span class="op" id="7399165">(</span><span class="string" id="7399166">&#34;conn&nbsp;should&nbsp;be&nbsp;closed&#34;</span><span class="op" id="7399189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399192">}</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399195">if</span>&nbsp;<span class="ident" id="7399198"><a href="/database/sql/sql_test.go.html#7398646">dc</a></span><span class="op" id="7399200">.</span><span class="ident" id="7399201">ci</span>&nbsp;<span class="op" id="7399204">!=</span>&nbsp;<span class="ident" id="7399207">nil</span>&nbsp;<span class="op" id="7399211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399215"><a href="/database/sql/sql_test.go.html#7398177">t</a></span><span class="op" id="7399216">.</span><span class="ident" id="7399217">Errorf</span><span class="op" id="7399223">(</span><span class="string" id="7399224">&#34;after&nbsp;Stmt&nbsp;Close,&nbsp;driverConn&#39;s&nbsp;Conn&nbsp;interface&nbsp;should&nbsp;be&nbsp;nil&#34;</span><span class="op" id="7399285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399288">}</span><br>
<span class="lineno"></span><span class="op" id="7399290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1255</span><span class="comment" id="7399293">//&nbsp;golang.org/issue/5283:&nbsp;don&#39;t&nbsp;release&nbsp;the&nbsp;Rows&#39;&nbsp;connection&nbsp;in&nbsp;Close</span><br>
<span class="lineno"></span><span class="comment" id="7399363">//&nbsp;before&nbsp;calling&nbsp;Stmt.Close.</span><br>
<span class="lineno"></span><span class="keyword" id="7399393">func</span>&nbsp;<span class="ident" id="7399398">TestRowsCloseOrder</span><span class="op" id="7399416">(</span><span class="ident" id="7399417">t</span>&nbsp;<span class="op" id="7399419">*</span><span class="ident" id="7399420"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7399427">.</span><span class="ident" id="7399428">T</span><span class="op" id="7399429">)</span>&nbsp;<span class="op" id="7399431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399434">db</span>&nbsp;<span class="op" id="7399437">:=</span>&nbsp;<span class="ident" id="7399440"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7399449">(</span><span class="ident" id="7399450"><a href="/database/sql/sql_test.go.html#7399417">t</a></span><span class="op" id="7399451">,</span>&nbsp;<span class="string" id="7399453">&#34;people&#34;</span><span class="op" id="7399461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399464">defer</span>&nbsp;<span class="ident" id="7399470"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7399477">(</span><span class="ident" id="7399478"><a href="/database/sql/sql_test.go.html#7399417">t</a></span><span class="op" id="7399479">,</span>&nbsp;<span class="ident" id="7399481"><a href="/database/sql/sql_test.go.html#7399434">db</a></span><span class="op" id="7399483">)</span><br>
<span class="lineno">1260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399487"><a href="/database/sql/sql_test.go.html#7399434">db</a></span><span class="op" id="7399489">.</span><span class="ident" id="7399490">SetMaxIdleConns</span><span class="op" id="7399505">(</span><span class="num" id="7399506">0</span><span class="op" id="7399507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399510"><a href="/database/sql/fakedb_test.go.html#7354286">setStrictFakeConnClose</a></span><span class="op" id="7399532">(</span><span class="ident" id="7399533"><a href="/database/sql/sql_test.go.html#7399417">t</a></span><span class="op" id="7399534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399537">defer</span>&nbsp;<span class="ident" id="7399543"><a href="/database/sql/fakedb_test.go.html#7354286">setStrictFakeConnClose</a></span><span class="op" id="7399565">(</span><span class="ident" id="7399566">nil</span><span class="op" id="7399569">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399573">rows</span><span class="op" id="7399577">,</span>&nbsp;<span class="ident" id="7399579">err</span>&nbsp;<span class="op" id="7399583">:=</span>&nbsp;<span class="ident" id="7399586"><a href="/database/sql/sql_test.go.html#7399434">db</a></span><span class="op" id="7399588">.</span><span class="ident" id="7399589">Query</span><span class="op" id="7399594">(</span><span class="string" id="7399595">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7399620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399623">if</span>&nbsp;<span class="ident" id="7399626"><a href="/database/sql/sql_test.go.html#7399579">err</a></span>&nbsp;<span class="op" id="7399630">!=</span>&nbsp;<span class="ident" id="7399633">nil</span>&nbsp;<span class="op" id="7399637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399641"><a href="/database/sql/sql_test.go.html#7399417">t</a></span><span class="op" id="7399642">.</span><span class="ident" id="7399643">Fatal</span><span class="op" id="7399648">(</span><span class="ident" id="7399649"><a href="/database/sql/sql_test.go.html#7399579">err</a></span><span class="op" id="7399652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399658"><a href="/database/sql/sql_test.go.html#7399579">err</a></span>&nbsp;<span class="op" id="7399662">=</span>&nbsp;<span class="ident" id="7399664"><a href="/database/sql/sql_test.go.html#7399573">rows</a></span><span class="op" id="7399668">.</span><span class="ident" id="7399669">Close</span><span class="op" id="7399674">(</span><span class="op" id="7399675">)</span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399678">if</span>&nbsp;<span class="ident" id="7399681"><a href="/database/sql/sql_test.go.html#7399579">err</a></span>&nbsp;<span class="op" id="7399685">!=</span>&nbsp;<span class="ident" id="7399688">nil</span>&nbsp;<span class="op" id="7399692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399696"><a href="/database/sql/sql_test.go.html#7399417">t</a></span><span class="op" id="7399697">.</span><span class="ident" id="7399698">Fatal</span><span class="op" id="7399703">(</span><span class="ident" id="7399704"><a href="/database/sql/sql_test.go.html#7399579">err</a></span><span class="op" id="7399707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399710">}</span><br>
<span class="lineno"></span><span class="op" id="7399712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1275</span><span class="keyword" id="7399715">func</span>&nbsp;<span class="ident" id="7399720">TestRowsImplicitClose</span><span class="op" id="7399741">(</span><span class="ident" id="7399742">t</span>&nbsp;<span class="op" id="7399744">*</span><span class="ident" id="7399745"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7399752">.</span><span class="ident" id="7399753">T</span><span class="op" id="7399754">)</span>&nbsp;<span class="op" id="7399756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399759">db</span>&nbsp;<span class="op" id="7399762">:=</span>&nbsp;<span class="ident" id="7399765"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7399774">(</span><span class="ident" id="7399775"><a href="/database/sql/sql_test.go.html#7399742">t</a></span><span class="op" id="7399776">,</span>&nbsp;<span class="string" id="7399778">&#34;people&#34;</span><span class="op" id="7399786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399789">defer</span>&nbsp;<span class="ident" id="7399795"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7399802">(</span><span class="ident" id="7399803"><a href="/database/sql/sql_test.go.html#7399742">t</a></span><span class="op" id="7399804">,</span>&nbsp;<span class="ident" id="7399806"><a href="/database/sql/sql_test.go.html#7399759">db</a></span><span class="op" id="7399808">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399812">rows</span><span class="op" id="7399816">,</span>&nbsp;<span class="ident" id="7399818">err</span>&nbsp;<span class="op" id="7399822">:=</span>&nbsp;<span class="ident" id="7399825"><a href="/database/sql/sql_test.go.html#7399759">db</a></span><span class="op" id="7399827">.</span><span class="ident" id="7399828">Query</span><span class="op" id="7399833">(</span><span class="string" id="7399834">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7399859">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399862">if</span>&nbsp;<span class="ident" id="7399865"><a href="/database/sql/sql_test.go.html#7399818">err</a></span>&nbsp;<span class="op" id="7399869">!=</span>&nbsp;<span class="ident" id="7399872">nil</span>&nbsp;<span class="op" id="7399876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399880"><a href="/database/sql/sql_test.go.html#7399742">t</a></span><span class="op" id="7399881">.</span><span class="ident" id="7399882">Fatal</span><span class="op" id="7399887">(</span><span class="ident" id="7399888"><a href="/database/sql/sql_test.go.html#7399818">err</a></span><span class="op" id="7399891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399898">want</span><span class="op" id="7399902">,</span>&nbsp;<span class="ident" id="7399904">fail</span>&nbsp;<span class="op" id="7399909">:=</span>&nbsp;<span class="num" id="7399912">2</span><span class="op" id="7399913">,</span>&nbsp;<span class="ident" id="7399915"><a href="/database/sql/sql_test.go.html#7368921">errors</a></span><span class="op" id="7399921">.</span><span class="ident" id="7399922">New</span><span class="op" id="7399925">(</span><span class="string" id="7399926">&#34;fail&#34;</span><span class="op" id="7399932">)</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399935">r</span>&nbsp;<span class="op" id="7399937">:=</span>&nbsp;<span class="ident" id="7399940"><a href="/database/sql/sql_test.go.html#7399812">rows</a></span><span class="op" id="7399944">.</span><span class="ident" id="7399945">rowsi</span><span class="op" id="7399950">.</span><span class="op" id="7399951">(</span><span class="op" id="7399952">*</span><span class="ident" id="7399953"><a href="/database/sql/fakedb_test.go.html#7365500">rowsCursor</a></span><span class="op" id="7399963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399966"><a href="/database/sql/sql_test.go.html#7399935">r</a></span><span class="op" id="7399967">.</span><span class="ident" id="7399968">errPos</span><span class="op" id="7399974">,</span>&nbsp;<span class="ident" id="7399976"><a href="/database/sql/sql_test.go.html#7399935">r</a></span><span class="op" id="7399977">.</span><span class="ident" id="7399978">err</span>&nbsp;<span class="op" id="7399982">=</span>&nbsp;<span class="ident" id="7399984"><a href="/database/sql/sql_test.go.html#7399898">want</a></span><span class="op" id="7399988">,</span>&nbsp;<span class="ident" id="7399990"><a href="/database/sql/sql_test.go.html#7399904">fail</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399997">got</span>&nbsp;<span class="op" id="7400001">:=</span>&nbsp;<span class="num" id="7400004">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400007">for</span>&nbsp;<span class="ident" id="7400011"><a href="/database/sql/sql_test.go.html#7399812">rows</a></span><span class="op" id="7400015">.</span><span class="ident" id="7400016">Next</span><span class="op" id="7400020">(</span><span class="op" id="7400021">)</span>&nbsp;<span class="op" id="7400023">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400027"><a href="/database/sql/sql_test.go.html#7399997">got</a></span><span class="op" id="7400030">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400037">if</span>&nbsp;<span class="ident" id="7400040"><a href="/database/sql/sql_test.go.html#7399997">got</a></span>&nbsp;<span class="op" id="7400044">!=</span>&nbsp;<span class="ident" id="7400047"><a href="/database/sql/sql_test.go.html#7399898">want</a></span>&nbsp;<span class="op" id="7400052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400056"><a href="/database/sql/sql_test.go.html#7399742">t</a></span><span class="op" id="7400057">.</span><span class="ident" id="7400058">Errorf</span><span class="op" id="7400064">(</span><span class="string" id="7400065">&#34;got&nbsp;%d&nbsp;rows,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7400087">,</span>&nbsp;<span class="ident" id="7400089"><a href="/database/sql/sql_test.go.html#7399997">got</a></span><span class="op" id="7400092">,</span>&nbsp;<span class="ident" id="7400094"><a href="/database/sql/sql_test.go.html#7399898">want</a></span><span class="op" id="7400098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400101">}</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400104">if</span>&nbsp;<span class="ident" id="7400107">err</span>&nbsp;<span class="op" id="7400111">:=</span>&nbsp;<span class="ident" id="7400114"><a href="/database/sql/sql_test.go.html#7399812">rows</a></span><span class="op" id="7400118">.</span><span class="ident" id="7400119">Err</span><span class="op" id="7400122">(</span><span class="op" id="7400123">)</span><span class="op" id="7400124">;</span>&nbsp;<span class="ident" id="7400126"><a href="/database/sql/sql_test.go.html#7400107">err</a></span>&nbsp;<span class="op" id="7400130">!=</span>&nbsp;<span class="ident" id="7400133"><a href="/database/sql/sql_test.go.html#7399904">fail</a></span>&nbsp;<span class="op" id="7400138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400142"><a href="/database/sql/sql_test.go.html#7399742">t</a></span><span class="op" id="7400143">.</span><span class="ident" id="7400144">Errorf</span><span class="op" id="7400150">(</span><span class="string" id="7400151">&#34;got&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7400174">,</span>&nbsp;<span class="ident" id="7400176"><a href="/database/sql/sql_test.go.html#7400107">err</a></span><span class="op" id="7400179">,</span>&nbsp;<span class="ident" id="7400181"><a href="/database/sql/sql_test.go.html#7399904">fail</a></span><span class="op" id="7400185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400191">if</span>&nbsp;<span class="op" id="7400194">!</span><span class="ident" id="7400195"><a href="/database/sql/sql_test.go.html#7399935">r</a></span><span class="op" id="7400196">.</span><span class="ident" id="7400197">closed</span>&nbsp;<span class="op" id="7400204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400208"><a href="/database/sql/sql_test.go.html#7399742">t</a></span><span class="op" id="7400209">.</span><span class="ident" id="7400210">Errorf</span><span class="op" id="7400216">(</span><span class="string" id="7400217">&#34;r.closed&nbsp;is&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="7400247">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400250">}</span><br>
<span class="lineno"></span><span class="op" id="7400252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7400255">func</span>&nbsp;<span class="ident" id="7400260">TestStmtCloseOrder</span><span class="op" id="7400278">(</span><span class="ident" id="7400279">t</span>&nbsp;<span class="op" id="7400281">*</span><span class="ident" id="7400282"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7400289">.</span><span class="ident" id="7400290">T</span><span class="op" id="7400291">)</span>&nbsp;<span class="op" id="7400293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400296">db</span>&nbsp;<span class="op" id="7400299">:=</span>&nbsp;<span class="ident" id="7400302"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7400311">(</span><span class="ident" id="7400312"><a href="/database/sql/sql_test.go.html#7400279">t</a></span><span class="op" id="7400313">,</span>&nbsp;<span class="string" id="7400315">&#34;people&#34;</span><span class="op" id="7400323">)</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400326">defer</span>&nbsp;<span class="ident" id="7400332"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7400339">(</span><span class="ident" id="7400340"><a href="/database/sql/sql_test.go.html#7400279">t</a></span><span class="op" id="7400341">,</span>&nbsp;<span class="ident" id="7400343"><a href="/database/sql/sql_test.go.html#7400296">db</a></span><span class="op" id="7400345">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400349"><a href="/database/sql/sql_test.go.html#7400296">db</a></span><span class="op" id="7400351">.</span><span class="ident" id="7400352">SetMaxIdleConns</span><span class="op" id="7400367">(</span><span class="num" id="7400368">0</span><span class="op" id="7400369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400372"><a href="/database/sql/fakedb_test.go.html#7354286">setStrictFakeConnClose</a></span><span class="op" id="7400394">(</span><span class="ident" id="7400395"><a href="/database/sql/sql_test.go.html#7400279">t</a></span><span class="op" id="7400396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400399">defer</span>&nbsp;<span class="ident" id="7400405"><a href="/database/sql/fakedb_test.go.html#7354286">setStrictFakeConnClose</a></span><span class="op" id="7400427">(</span><span class="ident" id="7400428">nil</span><span class="op" id="7400431">)</span><br>
<span class="lineno">1310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400435">_</span><span class="op" id="7400436">,</span>&nbsp;<span class="ident" id="7400438">err</span>&nbsp;<span class="op" id="7400442">:=</span>&nbsp;<span class="ident" id="7400445"><a href="/database/sql/sql_test.go.html#7400296">db</a></span><span class="op" id="7400447">.</span><span class="ident" id="7400448">Query</span><span class="op" id="7400453">(</span><span class="string" id="7400454">&#34;SELECT|non_existent|name|&#34;</span><span class="op" id="7400481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400484">if</span>&nbsp;<span class="ident" id="7400487"><a href="/database/sql/sql_test.go.html#7400438">err</a></span>&nbsp;<span class="op" id="7400491">==</span>&nbsp;<span class="ident" id="7400494">nil</span>&nbsp;<span class="op" id="7400498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400502"><a href="/database/sql/sql_test.go.html#7400279">t</a></span><span class="op" id="7400503">.</span><span class="ident" id="7400504">Fatal</span><span class="op" id="7400509">(</span><span class="string" id="7400510">&#34;Quering&nbsp;non-existent&nbsp;table&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7400550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400553">}</span><br>
<span class="lineno">1315</span><span class="op" id="7400555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7400558">//&nbsp;golang.org/issue/5781</span><br>
<span class="lineno"></span><span class="keyword" id="7400583">func</span>&nbsp;<span class="ident" id="7400588">TestErrBadConnReconnect</span><span class="op" id="7400611">(</span><span class="ident" id="7400612">t</span>&nbsp;<span class="op" id="7400614">*</span><span class="ident" id="7400615"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7400622">.</span><span class="ident" id="7400623">T</span><span class="op" id="7400624">)</span>&nbsp;<span class="op" id="7400626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400629">db</span>&nbsp;<span class="op" id="7400632">:=</span>&nbsp;<span class="ident" id="7400635"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7400644">(</span><span class="ident" id="7400645"><a href="/database/sql/sql_test.go.html#7400612">t</a></span><span class="op" id="7400646">,</span>&nbsp;<span class="string" id="7400648">&#34;foo&#34;</span><span class="op" id="7400653">)</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400656">defer</span>&nbsp;<span class="ident" id="7400662"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7400669">(</span><span class="ident" id="7400670"><a href="/database/sql/sql_test.go.html#7400612">t</a></span><span class="op" id="7400671">,</span>&nbsp;<span class="ident" id="7400673"><a href="/database/sql/sql_test.go.html#7400629">db</a></span><span class="op" id="7400675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400678"><a href="/database/sql/sql_test.go.html#7370464">exec</a></span><span class="op" id="7400682">(</span><span class="ident" id="7400683"><a href="/database/sql/sql_test.go.html#7400612">t</a></span><span class="op" id="7400684">,</span>&nbsp;<span class="ident" id="7400686"><a href="/database/sql/sql_test.go.html#7400629">db</a></span><span class="op" id="7400688">,</span>&nbsp;<span class="string" id="7400690">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7400733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400737">simulateBadConn</span>&nbsp;<span class="op" id="7400753">:=</span>&nbsp;<span class="keyword" id="7400756">func</span><span class="op" id="7400760">(</span><span class="ident" id="7400761">name</span>&nbsp;<span class="builtintype" id="7400766">string</span><span class="op" id="7400772">,</span>&nbsp;<span class="ident" id="7400774">hook</span>&nbsp;<span class="op" id="7400779">*</span><span class="keyword" id="7400780">func</span><span class="op" id="7400784">(</span><span class="op" id="7400785">)</span>&nbsp;<span class="builtintype" id="7400787">bool</span><span class="op" id="7400791">,</span>&nbsp;<span class="ident" id="7400793">op</span>&nbsp;<span class="keyword" id="7400796">func</span><span class="op" id="7400800">(</span><span class="op" id="7400801">)</span>&nbsp;<span class="builtintype" id="7400803">error</span><span class="op" id="7400808">)</span>&nbsp;<span class="op" id="7400810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400814">broken</span><span class="op" id="7400820">,</span>&nbsp;<span class="ident" id="7400822">retried</span>&nbsp;<span class="op" id="7400830">:=</span>&nbsp;<span class="builtintype" id="7400833">false</span><span class="op" id="7400838">,</span>&nbsp;<span class="builtintype" id="7400840">false</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400848">numOpen</span>&nbsp;<span class="op" id="7400856">:=</span>&nbsp;<span class="ident" id="7400859"><a href="/database/sql/sql_test.go.html#7400629">db</a></span><span class="op" id="7400861">.</span><span class="ident" id="7400862">numOpen</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7400873">//&nbsp;simulate&nbsp;a&nbsp;broken&nbsp;connection&nbsp;on&nbsp;the&nbsp;first&nbsp;try</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400924">*</span><span class="ident" id="7400925"><a href="/database/sql/sql_test.go.html#7400774">hook</a></span>&nbsp;<span class="op" id="7400930">=</span>&nbsp;<span class="keyword" id="7400932">func</span><span class="op" id="7400936">(</span><span class="op" id="7400937">)</span>&nbsp;<span class="builtintype" id="7400939">bool</span>&nbsp;<span class="op" id="7400944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400949">if</span>&nbsp;<span class="op" id="7400952">!</span><span class="ident" id="7400953"><a href="/database/sql/sql_test.go.html#7400814">broken</a></span>&nbsp;<span class="op" id="7400960">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400966"><a href="/database/sql/sql_test.go.html#7400814">broken</a></span>&nbsp;<span class="op" id="7400973">=</span>&nbsp;<span class="builtintype" id="7400975">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400984">return</span>&nbsp;<span class="builtintype" id="7400991">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401004"><a href="/database/sql/sql_test.go.html#7400822">retried</a></span>&nbsp;<span class="op" id="7401012">=</span>&nbsp;<span class="builtintype" id="7401014">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401022">return</span>&nbsp;<span class="builtintype" id="7401029">false</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401042">if</span>&nbsp;<span class="ident" id="7401045">err</span>&nbsp;<span class="op" id="7401049">:=</span>&nbsp;<span class="ident" id="7401052"><a href="/database/sql/sql_test.go.html#7400793">op</a></span><span class="op" id="7401054">(</span><span class="op" id="7401055">)</span><span class="op" id="7401056">;</span>&nbsp;<span class="ident" id="7401058"><a href="/database/sql/sql_test.go.html#7401045">err</a></span>&nbsp;<span class="op" id="7401062">!=</span>&nbsp;<span class="ident" id="7401065">nil</span>&nbsp;<span class="op" id="7401069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401074"><a href="/database/sql/sql_test.go.html#7400612">t</a></span><span class="op" id="7401075">.</span><span class="ident" id="7401076">Errorf</span><span class="op" id="7401082">(</span><span class="ident" id="7401083"><a href="/database/sql/sql_test.go.html#7400761">name</a></span><span class="op" id="7401087">+</span><span class="string" id="7401088">&#34;:&nbsp;%v&#34;</span><span class="op" id="7401094">,</span>&nbsp;<span class="ident" id="7401096"><a href="/database/sql/sql_test.go.html#7401045">err</a></span><span class="op" id="7401099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401104">return</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401118">if</span>&nbsp;<span class="op" id="7401121">!</span><span class="ident" id="7401122"><a href="/database/sql/sql_test.go.html#7400814">broken</a></span>&nbsp;<span class="op" id="7401129">||</span>&nbsp;<span class="op" id="7401132">!</span><span class="ident" id="7401133"><a href="/database/sql/sql_test.go.html#7400822">retried</a></span>&nbsp;<span class="op" id="7401141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401146"><a href="/database/sql/sql_test.go.html#7400612">t</a></span><span class="op" id="7401147">.</span><span class="ident" id="7401148">Error</span><span class="op" id="7401153">(</span><span class="ident" id="7401154"><a href="/database/sql/sql_test.go.html#7400761">name</a></span>&nbsp;<span class="op" id="7401159">+</span>&nbsp;<span class="string" id="7401161">&#34;:&nbsp;Failed&nbsp;to&nbsp;simulate&nbsp;broken&nbsp;connection&#34;</span><span class="op" id="7401201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401205">}</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401209">*</span><span class="ident" id="7401210"><a href="/database/sql/sql_test.go.html#7400774">hook</a></span>&nbsp;<span class="op" id="7401215">=</span>&nbsp;<span class="ident" id="7401217">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401224">if</span>&nbsp;<span class="ident" id="7401227"><a href="/database/sql/sql_test.go.html#7400848">numOpen</a></span>&nbsp;<span class="op" id="7401235">!=</span>&nbsp;<span class="ident" id="7401238"><a href="/database/sql/sql_test.go.html#7400629">db</a></span><span class="op" id="7401240">.</span><span class="ident" id="7401241">numOpen</span>&nbsp;<span class="op" id="7401249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401254"><a href="/database/sql/sql_test.go.html#7400612">t</a></span><span class="op" id="7401255">.</span><span class="ident" id="7401256">Errorf</span><span class="op" id="7401262">(</span><span class="ident" id="7401263"><a href="/database/sql/sql_test.go.html#7400761">name</a></span><span class="op" id="7401267">+</span><span class="string" id="7401268">&#34;:&nbsp;leaked&nbsp;%d&nbsp;connection(s)!&#34;</span><span class="op" id="7401296">,</span>&nbsp;<span class="ident" id="7401298"><a href="/database/sql/sql_test.go.html#7400629">db</a></span><span class="op" id="7401300">.</span><span class="ident" id="7401301">numOpen</span><span class="op" id="7401308">-</span><span class="ident" id="7401309"><a href="/database/sql/sql_test.go.html#7400848">numOpen</a></span><span class="op" id="7401316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401321"><a href="/database/sql/sql_test.go.html#7400848">numOpen</a></span>&nbsp;<span class="op" id="7401329">=</span>&nbsp;<span class="ident" id="7401331"><a href="/database/sql/sql_test.go.html#7400629">db</a></span><span class="op" id="7401333">.</span><span class="ident" id="7401334">numOpen</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7401351">//&nbsp;db.Exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401363">dbExec</span>&nbsp;<span class="op" id="7401370">:=</span>&nbsp;<span class="keyword" id="7401373">func</span><span class="op" id="7401377">(</span><span class="op" id="7401378">)</span>&nbsp;<span class="builtintype" id="7401380">error</span>&nbsp;<span class="op" id="7401386">{</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401390">_</span><span class="op" id="7401391">,</span>&nbsp;<span class="ident" id="7401393">err</span>&nbsp;<span class="op" id="7401397">:=</span>&nbsp;<span class="ident" id="7401400"><a href="/database/sql/sql_test.go.html#7400629">db</a></span><span class="op" id="7401402">.</span><span class="ident" id="7401403">Exec</span><span class="op" id="7401407">(</span><span class="string" id="7401408">&#34;INSERT|t1|name=?,age=?,dead=?&#34;</span><span class="op" id="7401439">,</span>&nbsp;<span class="string" id="7401441">&#34;Gordon&#34;</span><span class="op" id="7401449">,</span>&nbsp;<span class="num" id="7401451">3</span><span class="op" id="7401452">,</span>&nbsp;<span class="builtintype" id="7401454">true</span><span class="op" id="7401458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401462">return</span>&nbsp;<span class="ident" id="7401469"><a href="/database/sql/sql_test.go.html#7401393">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401477"><a href="/database/sql/sql_test.go.html#7400737">simulateBadConn</a></span><span class="op" id="7401492">(</span><span class="string" id="7401493">&#34;db.Exec&nbsp;prepare&#34;</span><span class="op" id="7401510">,</span>&nbsp;<span class="op" id="7401512">&amp;</span><span class="ident" id="7401513"><a href="/database/sql/fakedb_test.go.html#7359684">hookPrepareBadConn</a></span><span class="op" id="7401531">,</span>&nbsp;<span class="ident" id="7401533"><a href="/database/sql/sql_test.go.html#7401363">dbExec</a></span><span class="op" id="7401539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401542"><a href="/database/sql/sql_test.go.html#7400737">simulateBadConn</a></span><span class="op" id="7401557">(</span><span class="string" id="7401558">&#34;db.Exec&nbsp;exec&#34;</span><span class="op" id="7401572">,</span>&nbsp;<span class="op" id="7401574">&amp;</span><span class="ident" id="7401575"><a href="/database/sql/fakedb_test.go.html#7361213">hookExecBadConn</a></span><span class="op" id="7401590">,</span>&nbsp;<span class="ident" id="7401592"><a href="/database/sql/sql_test.go.html#7401363">dbExec</a></span><span class="op" id="7401598">)</span><br>
<span class="lineno">1360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7401602">//&nbsp;db.Query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401615">dbQuery</span>&nbsp;<span class="op" id="7401623">:=</span>&nbsp;<span class="keyword" id="7401626">func</span><span class="op" id="7401630">(</span><span class="op" id="7401631">)</span>&nbsp;<span class="builtintype" id="7401633">error</span>&nbsp;<span class="op" id="7401639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401643">rows</span><span class="op" id="7401647">,</span>&nbsp;<span class="ident" id="7401649">err</span>&nbsp;<span class="op" id="7401653">:=</span>&nbsp;<span class="ident" id="7401656"><a href="/database/sql/sql_test.go.html#7400629">db</a></span><span class="op" id="7401658">.</span><span class="ident" id="7401659">Query</span><span class="op" id="7401664">(</span><span class="string" id="7401665">&#34;SELECT|t1|age,name|&#34;</span><span class="op" id="7401686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401690">if</span>&nbsp;<span class="ident" id="7401693"><a href="/database/sql/sql_test.go.html#7401649">err</a></span>&nbsp;<span class="op" id="7401697">==</span>&nbsp;<span class="ident" id="7401700">nil</span>&nbsp;<span class="op" id="7401704">{</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401709"><a href="/database/sql/sql_test.go.html#7401649">err</a></span>&nbsp;<span class="op" id="7401713">=</span>&nbsp;<span class="ident" id="7401715"><a href="/database/sql/sql_test.go.html#7401643">rows</a></span><span class="op" id="7401719">.</span><span class="ident" id="7401720">Close</span><span class="op" id="7401725">(</span><span class="op" id="7401726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401734">return</span>&nbsp;<span class="ident" id="7401741"><a href="/database/sql/sql_test.go.html#7401649">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401749"><a href="/database/sql/sql_test.go.html#7400737">simulateBadConn</a></span><span class="op" id="7401764">(</span><span class="string" id="7401765">&#34;db.Query&nbsp;prepare&#34;</span><span class="op" id="7401783">,</span>&nbsp;<span class="op" id="7401785">&amp;</span><span class="ident" id="7401786"><a href="/database/sql/fakedb_test.go.html#7359684">hookPrepareBadConn</a></span><span class="op" id="7401804">,</span>&nbsp;<span class="ident" id="7401806"><a href="/database/sql/sql_test.go.html#7401615">dbQuery</a></span><span class="op" id="7401813">)</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401816"><a href="/database/sql/sql_test.go.html#7400737">simulateBadConn</a></span><span class="op" id="7401831">(</span><span class="string" id="7401832">&#34;db.Query&nbsp;query&#34;</span><span class="op" id="7401848">,</span>&nbsp;<span class="op" id="7401850">&amp;</span><span class="ident" id="7401851"><a href="/database/sql/fakedb_test.go.html#7363325">hookQueryBadConn</a></span><span class="op" id="7401867">,</span>&nbsp;<span class="ident" id="7401869"><a href="/database/sql/sql_test.go.html#7401615">dbQuery</a></span><span class="op" id="7401876">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7401880">//&nbsp;db.Prepare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401895"><a href="/database/sql/sql_test.go.html#7400737">simulateBadConn</a></span><span class="op" id="7401910">(</span><span class="string" id="7401911">&#34;db.Prepare&#34;</span><span class="op" id="7401923">,</span>&nbsp;<span class="op" id="7401925">&amp;</span><span class="ident" id="7401926"><a href="/database/sql/fakedb_test.go.html#7359684">hookPrepareBadConn</a></span><span class="op" id="7401944">,</span>&nbsp;<span class="keyword" id="7401946">func</span><span class="op" id="7401950">(</span><span class="op" id="7401951">)</span>&nbsp;<span class="builtintype" id="7401953">error</span>&nbsp;<span class="op" id="7401959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401963">stmt</span><span class="op" id="7401967">,</span>&nbsp;<span class="ident" id="7401969">err</span>&nbsp;<span class="op" id="7401973">:=</span>&nbsp;<span class="ident" id="7401976"><a href="/database/sql/sql_test.go.html#7400629">db</a></span><span class="op" id="7401978">.</span><span class="ident" id="7401979">Prepare</span><span class="op" id="7401986">(</span><span class="string" id="7401987">&#34;INSERT|t1|name=?,age=?,dead=?&#34;</span><span class="op" id="7402018">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402022">if</span>&nbsp;<span class="ident" id="7402025"><a href="/database/sql/sql_test.go.html#7401969">err</a></span>&nbsp;<span class="op" id="7402029">!=</span>&nbsp;<span class="ident" id="7402032">nil</span>&nbsp;<span class="op" id="7402036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402041">return</span>&nbsp;<span class="ident" id="7402048"><a href="/database/sql/sql_test.go.html#7401969">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402058"><a href="/database/sql/sql_test.go.html#7401963">stmt</a></span><span class="op" id="7402062">.</span><span class="ident" id="7402063">Close</span><span class="op" id="7402068">(</span><span class="op" id="7402069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402073">return</span>&nbsp;<span class="ident" id="7402080">nil</span><br>
<span class="lineno">1380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402085">}</span><span class="op" id="7402086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7402090">//&nbsp;Provide&nbsp;a&nbsp;way&nbsp;to&nbsp;force&nbsp;a&nbsp;re-prepare&nbsp;of&nbsp;a&nbsp;statement&nbsp;on&nbsp;next&nbsp;execution</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402163">forcePrepare</span>&nbsp;<span class="op" id="7402176">:=</span>&nbsp;<span class="keyword" id="7402179">func</span><span class="op" id="7402183">(</span><span class="ident" id="7402184">stmt</span>&nbsp;<span class="op" id="7402189">*</span><span class="ident" id="7402190"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="7402194">)</span>&nbsp;<span class="op" id="7402196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402200"><a href="/database/sql/sql_test.go.html#7402184">stmt</a></span><span class="op" id="7402204">.</span><span class="ident" id="7402205">css</span>&nbsp;<span class="op" id="7402209">=</span>&nbsp;<span class="ident" id="7402211">nil</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7402220">//&nbsp;stmt.Exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402234">stmt1</span><span class="op" id="7402239">,</span>&nbsp;<span class="ident" id="7402241">err</span>&nbsp;<span class="op" id="7402245">:=</span>&nbsp;<span class="ident" id="7402248"><a href="/database/sql/sql_test.go.html#7400629">db</a></span><span class="op" id="7402250">.</span><span class="ident" id="7402251">Prepare</span><span class="op" id="7402258">(</span><span class="string" id="7402259">&#34;INSERT|t1|name=?,age=?,dead=?&#34;</span><span class="op" id="7402290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402293">if</span>&nbsp;<span class="ident" id="7402296"><a href="/database/sql/sql_test.go.html#7402241">err</a></span>&nbsp;<span class="op" id="7402300">!=</span>&nbsp;<span class="ident" id="7402303">nil</span>&nbsp;<span class="op" id="7402307">{</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402311"><a href="/database/sql/sql_test.go.html#7400612">t</a></span><span class="op" id="7402312">.</span><span class="ident" id="7402313">Fatalf</span><span class="op" id="7402319">(</span><span class="string" id="7402320">&#34;prepare:&nbsp;%v&#34;</span><span class="op" id="7402333">,</span>&nbsp;<span class="ident" id="7402335"><a href="/database/sql/sql_test.go.html#7402241">err</a></span><span class="op" id="7402338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402344">defer</span>&nbsp;<span class="ident" id="7402350"><a href="/database/sql/sql_test.go.html#7402234">stmt1</a></span><span class="op" id="7402355">.</span><span class="ident" id="7402356">Close</span><span class="op" id="7402361">(</span><span class="op" id="7402362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7402365">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;must&nbsp;prepare&nbsp;the&nbsp;stmt&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402410"><a href="/database/sql/sql_test.go.html#7402163">forcePrepare</a></span><span class="op" id="7402422">(</span><span class="ident" id="7402423"><a href="/database/sql/sql_test.go.html#7402234">stmt1</a></span><span class="op" id="7402428">)</span><br>
<span class="lineno">1395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402432">stmtExec</span>&nbsp;<span class="op" id="7402441">:=</span>&nbsp;<span class="keyword" id="7402444">func</span><span class="op" id="7402448">(</span><span class="op" id="7402449">)</span>&nbsp;<span class="builtintype" id="7402451">error</span>&nbsp;<span class="op" id="7402457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402461">_</span><span class="op" id="7402462">,</span>&nbsp;<span class="ident" id="7402464">err</span>&nbsp;<span class="op" id="7402468">:=</span>&nbsp;<span class="ident" id="7402471"><a href="/database/sql/sql_test.go.html#7402234">stmt1</a></span><span class="op" id="7402476">.</span><span class="ident" id="7402477">Exec</span><span class="op" id="7402481">(</span><span class="string" id="7402482">&#34;Gopher&#34;</span><span class="op" id="7402490">,</span>&nbsp;<span class="num" id="7402492">3</span><span class="op" id="7402493">,</span>&nbsp;<span class="builtintype" id="7402495">false</span><span class="op" id="7402500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402504">return</span>&nbsp;<span class="ident" id="7402511"><a href="/database/sql/sql_test.go.html#7402464">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402516">}</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402519"><a href="/database/sql/sql_test.go.html#7400737">simulateBadConn</a></span><span class="op" id="7402534">(</span><span class="string" id="7402535">&#34;stmt.Exec&nbsp;prepare&#34;</span><span class="op" id="7402554">,</span>&nbsp;<span class="op" id="7402556">&amp;</span><span class="ident" id="7402557"><a href="/database/sql/fakedb_test.go.html#7359684">hookPrepareBadConn</a></span><span class="op" id="7402575">,</span>&nbsp;<span class="ident" id="7402577"><a href="/database/sql/sql_test.go.html#7402432">stmtExec</a></span><span class="op" id="7402585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402588"><a href="/database/sql/sql_test.go.html#7400737">simulateBadConn</a></span><span class="op" id="7402603">(</span><span class="string" id="7402604">&#34;stmt.Exec&nbsp;exec&#34;</span><span class="op" id="7402620">,</span>&nbsp;<span class="op" id="7402622">&amp;</span><span class="ident" id="7402623"><a href="/database/sql/fakedb_test.go.html#7361213">hookExecBadConn</a></span><span class="op" id="7402638">,</span>&nbsp;<span class="ident" id="7402640"><a href="/database/sql/sql_test.go.html#7402432">stmtExec</a></span><span class="op" id="7402648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7402652">//&nbsp;stmt.Query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402667">stmt2</span><span class="op" id="7402672">,</span>&nbsp;<span class="ident" id="7402674"><a href="/database/sql/sql_test.go.html#7402241">err</a></span>&nbsp;<span class="op" id="7402678">:=</span>&nbsp;<span class="ident" id="7402681"><a href="/database/sql/sql_test.go.html#7400629">db</a></span><span class="op" id="7402683">.</span><span class="ident" id="7402684">Prepare</span><span class="op" id="7402691">(</span><span class="string" id="7402692">&#34;SELECT|t1|age,name|&#34;</span><span class="op" id="7402713">)</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402716">if</span>&nbsp;<span class="ident" id="7402719"><a href="/database/sql/sql_test.go.html#7402241">err</a></span>&nbsp;<span class="op" id="7402723">!=</span>&nbsp;<span class="ident" id="7402726">nil</span>&nbsp;<span class="op" id="7402730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402734"><a href="/database/sql/sql_test.go.html#7400612">t</a></span><span class="op" id="7402735">.</span><span class="ident" id="7402736">Fatalf</span><span class="op" id="7402742">(</span><span class="string" id="7402743">&#34;prepare:&nbsp;%v&#34;</span><span class="op" id="7402756">,</span>&nbsp;<span class="ident" id="7402758"><a href="/database/sql/sql_test.go.html#7402241">err</a></span><span class="op" id="7402761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402767">defer</span>&nbsp;<span class="ident" id="7402773"><a href="/database/sql/sql_test.go.html#7402667">stmt2</a></span><span class="op" id="7402778">.</span><span class="ident" id="7402779">Close</span><span class="op" id="7402784">(</span><span class="op" id="7402785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7402788">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;must&nbsp;prepare&nbsp;the&nbsp;stmt&nbsp;first</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402833"><a href="/database/sql/sql_test.go.html#7402163">forcePrepare</a></span><span class="op" id="7402845">(</span><span class="ident" id="7402846"><a href="/database/sql/sql_test.go.html#7402667">stmt2</a></span><span class="op" id="7402851">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402855">stmtQuery</span>&nbsp;<span class="op" id="7402865">:=</span>&nbsp;<span class="keyword" id="7402868">func</span><span class="op" id="7402872">(</span><span class="op" id="7402873">)</span>&nbsp;<span class="builtintype" id="7402875">error</span>&nbsp;<span class="op" id="7402881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402885">rows</span><span class="op" id="7402889">,</span>&nbsp;<span class="ident" id="7402891">err</span>&nbsp;<span class="op" id="7402895">:=</span>&nbsp;<span class="ident" id="7402898"><a href="/database/sql/sql_test.go.html#7402667">stmt2</a></span><span class="op" id="7402903">.</span><span class="ident" id="7402904">Query</span><span class="op" id="7402909">(</span><span class="op" id="7402910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402914">if</span>&nbsp;<span class="ident" id="7402917"><a href="/database/sql/sql_test.go.html#7402891">err</a></span>&nbsp;<span class="op" id="7402921">==</span>&nbsp;<span class="ident" id="7402924">nil</span>&nbsp;<span class="op" id="7402928">{</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402933"><a href="/database/sql/sql_test.go.html#7402891">err</a></span>&nbsp;<span class="op" id="7402937">=</span>&nbsp;<span class="ident" id="7402939"><a href="/database/sql/sql_test.go.html#7402885">rows</a></span><span class="op" id="7402943">.</span><span class="ident" id="7402944">Close</span><span class="op" id="7402949">(</span><span class="op" id="7402950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402958">return</span>&nbsp;<span class="ident" id="7402965"><a href="/database/sql/sql_test.go.html#7402891">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402973"><a href="/database/sql/sql_test.go.html#7400737">simulateBadConn</a></span><span class="op" id="7402988">(</span><span class="string" id="7402989">&#34;stmt.Query&nbsp;prepare&#34;</span><span class="op" id="7403009">,</span>&nbsp;<span class="op" id="7403011">&amp;</span><span class="ident" id="7403012"><a href="/database/sql/fakedb_test.go.html#7359684">hookPrepareBadConn</a></span><span class="op" id="7403030">,</span>&nbsp;<span class="ident" id="7403032"><a href="/database/sql/sql_test.go.html#7402855">stmtQuery</a></span><span class="op" id="7403041">)</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403044"><a href="/database/sql/sql_test.go.html#7400737">simulateBadConn</a></span><span class="op" id="7403059">(</span><span class="string" id="7403060">&#34;stmt.Query&nbsp;exec&#34;</span><span class="op" id="7403077">,</span>&nbsp;<span class="op" id="7403079">&amp;</span><span class="ident" id="7403080"><a href="/database/sql/fakedb_test.go.html#7363325">hookQueryBadConn</a></span><span class="op" id="7403096">,</span>&nbsp;<span class="ident" id="7403098"><a href="/database/sql/sql_test.go.html#7402855">stmtQuery</a></span><span class="op" id="7403107">)</span><br>
<span class="lineno"></span><span class="op" id="7403109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7403112">type</span>&nbsp;<span class="ident" id="7403117">concurrentTest</span>&nbsp;<span class="keyword" id="7403132">interface</span>&nbsp;<span class="op" id="7403142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403145">init</span><span class="op" id="7403149">(</span><span class="ident" id="7403150">t</span>&nbsp;<span class="ident" id="7403152"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7403159">.</span><span class="ident" id="7403160">TB</span><span class="op" id="7403162">,</span>&nbsp;<span class="ident" id="7403164">db</span>&nbsp;<span class="op" id="7403167">*</span><span class="ident" id="7403168"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7403170">)</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403173">finish</span><span class="op" id="7403179">(</span><span class="ident" id="7403180">t</span>&nbsp;<span class="ident" id="7403182"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7403189">.</span><span class="ident" id="7403190">TB</span><span class="op" id="7403192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403195">test</span><span class="op" id="7403199">(</span><span class="ident" id="7403200">t</span>&nbsp;<span class="ident" id="7403202"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7403209">.</span><span class="ident" id="7403210">TB</span><span class="op" id="7403212">)</span>&nbsp;<span class="builtintype" id="7403214">error</span><br>
<span class="lineno"></span><span class="op" id="7403220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7403223">type</span>&nbsp;<span class="ident" id="7403228">concurrentDBQueryTest</span>&nbsp;<span class="keyword" id="7403250">struct</span>&nbsp;<span class="op" id="7403257">{</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403260">db</span>&nbsp;<span class="op" id="7403263">*</span><span class="ident" id="7403264"><a href="/database/sql/sql.go.html#6354182">DB</a></span><br>
<span class="lineno"></span><span class="op" id="7403267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7403270">func</span>&nbsp;<span class="op" id="7403275">(</span><span class="ident" id="7403276">c</span>&nbsp;<span class="op" id="7403278">*</span><span class="ident" id="7403279"><a href="/database/sql/sql_test.go.html#7403228">concurrentDBQueryTest</a></span><span class="op" id="7403300">)</span>&nbsp;<span class="ident" id="7403302">init</span><span class="op" id="7403306">(</span><span class="ident" id="7403307">t</span>&nbsp;<span class="ident" id="7403309"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7403316">.</span><span class="ident" id="7403317">TB</span><span class="op" id="7403319">,</span>&nbsp;<span class="ident" id="7403321">db</span>&nbsp;<span class="op" id="7403324">*</span><span class="ident" id="7403325"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7403327">)</span>&nbsp;<span class="op" id="7403329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403332"><a href="/database/sql/sql_test.go.html#7403276">c</a></span><span class="op" id="7403333">.</span><span class="ident" id="7403334">db</span>&nbsp;<span class="op" id="7403337">=</span>&nbsp;<span class="ident" id="7403339"><a href="/database/sql/sql_test.go.html#7403321">db</a></span><br>
<span class="lineno">1435</span><span class="op" id="7403342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7403345">func</span>&nbsp;<span class="op" id="7403350">(</span><span class="ident" id="7403351">c</span>&nbsp;<span class="op" id="7403353">*</span><span class="ident" id="7403354"><a href="/database/sql/sql_test.go.html#7403228">concurrentDBQueryTest</a></span><span class="op" id="7403375">)</span>&nbsp;<span class="ident" id="7403377">finish</span><span class="op" id="7403383">(</span><span class="ident" id="7403384">t</span>&nbsp;<span class="ident" id="7403386"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7403393">.</span><span class="ident" id="7403394">TB</span><span class="op" id="7403396">)</span>&nbsp;<span class="op" id="7403398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403401"><a href="/database/sql/sql_test.go.html#7403351">c</a></span><span class="op" id="7403402">.</span><span class="ident" id="7403403">db</span>&nbsp;<span class="op" id="7403406">=</span>&nbsp;<span class="ident" id="7403408">nil</span><br>
<span class="lineno"></span><span class="op" id="7403412">}</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="keyword" id="7403415">func</span>&nbsp;<span class="op" id="7403420">(</span><span class="ident" id="7403421">c</span>&nbsp;<span class="op" id="7403423">*</span><span class="ident" id="7403424"><a href="/database/sql/sql_test.go.html#7403228">concurrentDBQueryTest</a></span><span class="op" id="7403445">)</span>&nbsp;<span class="ident" id="7403447">test</span><span class="op" id="7403451">(</span><span class="ident" id="7403452">t</span>&nbsp;<span class="ident" id="7403454"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7403461">.</span><span class="ident" id="7403462">TB</span><span class="op" id="7403464">)</span>&nbsp;<span class="builtintype" id="7403466">error</span>&nbsp;<span class="op" id="7403472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403475">rows</span><span class="op" id="7403479">,</span>&nbsp;<span class="ident" id="7403481">err</span>&nbsp;<span class="op" id="7403485">:=</span>&nbsp;<span class="ident" id="7403488"><a href="/database/sql/sql_test.go.html#7403421">c</a></span><span class="op" id="7403489">.</span><span class="ident" id="7403490">db</span><span class="op" id="7403492">.</span><span class="ident" id="7403493">Query</span><span class="op" id="7403498">(</span><span class="string" id="7403499">&#34;SELECT|people|name|&#34;</span><span class="op" id="7403520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7403523">if</span>&nbsp;<span class="ident" id="7403526"><a href="/database/sql/sql_test.go.html#7403481">err</a></span>&nbsp;<span class="op" id="7403530">!=</span>&nbsp;<span class="ident" id="7403533">nil</span>&nbsp;<span class="op" id="7403537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403541"><a href="/database/sql/sql_test.go.html#7403452">t</a></span><span class="op" id="7403542">.</span><span class="ident" id="7403543">Error</span><span class="op" id="7403548">(</span><span class="ident" id="7403549"><a href="/database/sql/sql_test.go.html#7403481">err</a></span><span class="op" id="7403552">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7403556">return</span>&nbsp;<span class="ident" id="7403563"><a href="/database/sql/sql_test.go.html#7403481">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7403568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7403571">var</span>&nbsp;<span class="ident" id="7403575">name</span>&nbsp;<span class="builtintype" id="7403580">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7403588">for</span>&nbsp;<span class="ident" id="7403592"><a href="/database/sql/sql_test.go.html#7403475">rows</a></span><span class="op" id="7403596">.</span><span class="ident" id="7403597">Next</span><span class="op" id="7403601">(</span><span class="op" id="7403602">)</span>&nbsp;<span class="op" id="7403604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403608"><a href="/database/sql/sql_test.go.html#7403475">rows</a></span><span class="op" id="7403612">.</span><span class="ident" id="7403613">Scan</span><span class="op" id="7403617">(</span><span class="op" id="7403618">&amp;</span><span class="ident" id="7403619"><a href="/database/sql/sql_test.go.html#7403575">name</a></span><span class="op" id="7403623">)</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7403626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403629"><a href="/database/sql/sql_test.go.html#7403475">rows</a></span><span class="op" id="7403633">.</span><span class="ident" id="7403634">Close</span><span class="op" id="7403639">(</span><span class="op" id="7403640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7403643">return</span>&nbsp;<span class="ident" id="7403650">nil</span><br>
<span class="lineno"></span><span class="op" id="7403654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1455</span><span class="keyword" id="7403657">type</span>&nbsp;<span class="ident" id="7403662">concurrentDBExecTest</span>&nbsp;<span class="keyword" id="7403683">struct</span>&nbsp;<span class="op" id="7403690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403693">db</span>&nbsp;<span class="op" id="7403696">*</span><span class="ident" id="7403697"><a href="/database/sql/sql.go.html#6354182">DB</a></span><br>
<span class="lineno"></span><span class="op" id="7403700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7403703">func</span>&nbsp;<span class="op" id="7403708">(</span><span class="ident" id="7403709">c</span>&nbsp;<span class="op" id="7403711">*</span><span class="ident" id="7403712"><a href="/database/sql/sql_test.go.html#7403662">concurrentDBExecTest</a></span><span class="op" id="7403732">)</span>&nbsp;<span class="ident" id="7403734">init</span><span class="op" id="7403738">(</span><span class="ident" id="7403739">t</span>&nbsp;<span class="ident" id="7403741"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7403748">.</span><span class="ident" id="7403749">TB</span><span class="op" id="7403751">,</span>&nbsp;<span class="ident" id="7403753">db</span>&nbsp;<span class="op" id="7403756">*</span><span class="ident" id="7403757"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7403759">)</span>&nbsp;<span class="op" id="7403761">{</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403764"><a href="/database/sql/sql_test.go.html#7403709">c</a></span><span class="op" id="7403765">.</span><span class="ident" id="7403766">db</span>&nbsp;<span class="op" id="7403769">=</span>&nbsp;<span class="ident" id="7403771"><a href="/database/sql/sql_test.go.html#7403753">db</a></span><br>
<span class="lineno"></span><span class="op" id="7403774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7403777">func</span>&nbsp;<span class="op" id="7403782">(</span><span class="ident" id="7403783">c</span>&nbsp;<span class="op" id="7403785">*</span><span class="ident" id="7403786"><a href="/database/sql/sql_test.go.html#7403662">concurrentDBExecTest</a></span><span class="op" id="7403806">)</span>&nbsp;<span class="ident" id="7403808">finish</span><span class="op" id="7403814">(</span><span class="ident" id="7403815">t</span>&nbsp;<span class="ident" id="7403817"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7403824">.</span><span class="ident" id="7403825">TB</span><span class="op" id="7403827">)</span>&nbsp;<span class="op" id="7403829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403832"><a href="/database/sql/sql_test.go.html#7403783">c</a></span><span class="op" id="7403833">.</span><span class="ident" id="7403834">db</span>&nbsp;<span class="op" id="7403837">=</span>&nbsp;<span class="ident" id="7403839">nil</span><br>
<span class="lineno">1465</span><span class="op" id="7403843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7403846">func</span>&nbsp;<span class="op" id="7403851">(</span><span class="ident" id="7403852">c</span>&nbsp;<span class="op" id="7403854">*</span><span class="ident" id="7403855"><a href="/database/sql/sql_test.go.html#7403662">concurrentDBExecTest</a></span><span class="op" id="7403875">)</span>&nbsp;<span class="ident" id="7403877">test</span><span class="op" id="7403881">(</span><span class="ident" id="7403882">t</span>&nbsp;<span class="ident" id="7403884"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7403891">.</span><span class="ident" id="7403892">TB</span><span class="op" id="7403894">)</span>&nbsp;<span class="builtintype" id="7403896">error</span>&nbsp;<span class="op" id="7403902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403905">_</span><span class="op" id="7403906">,</span>&nbsp;<span class="ident" id="7403908">err</span>&nbsp;<span class="op" id="7403912">:=</span>&nbsp;<span class="ident" id="7403915"><a href="/database/sql/sql_test.go.html#7403852">c</a></span><span class="op" id="7403916">.</span><span class="ident" id="7403917">db</span><span class="op" id="7403919">.</span><span class="ident" id="7403920">Exec</span><span class="op" id="7403924">(</span><span class="string" id="7403925">&#34;NOSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7403978">,</span>&nbsp;<span class="num" id="7403980">3</span><span class="op" id="7403981">,</span>&nbsp;<span class="ident" id="7403983"><a href="/database/sql/sql_test.go.html#7369662">chrisBirthday</a></span><span class="op" id="7403996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7403999">if</span>&nbsp;<span class="ident" id="7404002"><a href="/database/sql/sql_test.go.html#7403908">err</a></span>&nbsp;<span class="op" id="7404006">!=</span>&nbsp;<span class="ident" id="7404009">nil</span>&nbsp;<span class="op" id="7404013">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404017"><a href="/database/sql/sql_test.go.html#7403882">t</a></span><span class="op" id="7404018">.</span><span class="ident" id="7404019">Error</span><span class="op" id="7404024">(</span><span class="ident" id="7404025"><a href="/database/sql/sql_test.go.html#7403908">err</a></span><span class="op" id="7404028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404032">return</span>&nbsp;<span class="ident" id="7404039"><a href="/database/sql/sql_test.go.html#7403908">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7404044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404047">return</span>&nbsp;<span class="ident" id="7404054">nil</span><br>
<span class="lineno"></span><span class="op" id="7404058">}</span><br>
<span class="lineno">1475</span><br>
<span class="lineno"></span><span class="keyword" id="7404061">type</span>&nbsp;<span class="ident" id="7404066">concurrentStmtQueryTest</span>&nbsp;<span class="keyword" id="7404090">struct</span>&nbsp;<span class="op" id="7404097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404100">db</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7404105">*</span><span class="ident" id="7404106"><a href="/database/sql/sql.go.html#6354182">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404110">stmt</span>&nbsp;<span class="op" id="7404115">*</span><span class="ident" id="7404116"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><br>
<span class="lineno"></span><span class="op" id="7404121">}</span><br>
<span class="lineno">1480</span><br>
<span class="lineno"></span><span class="keyword" id="7404124">func</span>&nbsp;<span class="op" id="7404129">(</span><span class="ident" id="7404130">c</span>&nbsp;<span class="op" id="7404132">*</span><span class="ident" id="7404133"><a href="/database/sql/sql_test.go.html#7404066">concurrentStmtQueryTest</a></span><span class="op" id="7404156">)</span>&nbsp;<span class="ident" id="7404158">init</span><span class="op" id="7404162">(</span><span class="ident" id="7404163">t</span>&nbsp;<span class="ident" id="7404165"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7404172">.</span><span class="ident" id="7404173">TB</span><span class="op" id="7404175">,</span>&nbsp;<span class="ident" id="7404177">db</span>&nbsp;<span class="op" id="7404180">*</span><span class="ident" id="7404181"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7404183">)</span>&nbsp;<span class="op" id="7404185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404188"><a href="/database/sql/sql_test.go.html#7404130">c</a></span><span class="op" id="7404189">.</span><span class="ident" id="7404190">db</span>&nbsp;<span class="op" id="7404193">=</span>&nbsp;<span class="ident" id="7404195"><a href="/database/sql/sql_test.go.html#7404177">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404199">var</span>&nbsp;<span class="ident" id="7404203">err</span>&nbsp;<span class="builtintype" id="7404207">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404214"><a href="/database/sql/sql_test.go.html#7404130">c</a></span><span class="op" id="7404215">.</span><span class="ident" id="7404216">stmt</span><span class="op" id="7404220">,</span>&nbsp;<span class="ident" id="7404222"><a href="/database/sql/sql_test.go.html#7404203">err</a></span>&nbsp;<span class="op" id="7404226">=</span>&nbsp;<span class="ident" id="7404228"><a href="/database/sql/sql_test.go.html#7404177">db</a></span><span class="op" id="7404230">.</span><span class="ident" id="7404231">Prepare</span><span class="op" id="7404238">(</span><span class="string" id="7404239">&#34;SELECT|people|name|&#34;</span><span class="op" id="7404260">)</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404263">if</span>&nbsp;<span class="ident" id="7404266"><a href="/database/sql/sql_test.go.html#7404203">err</a></span>&nbsp;<span class="op" id="7404270">!=</span>&nbsp;<span class="ident" id="7404273">nil</span>&nbsp;<span class="op" id="7404277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404281"><a href="/database/sql/sql_test.go.html#7404163">t</a></span><span class="op" id="7404282">.</span><span class="ident" id="7404283">Fatal</span><span class="op" id="7404288">(</span><span class="ident" id="7404289"><a href="/database/sql/sql_test.go.html#7404203">err</a></span><span class="op" id="7404292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7404295">}</span><br>
<span class="lineno"></span><span class="op" id="7404297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1490</span><span class="keyword" id="7404300">func</span>&nbsp;<span class="op" id="7404305">(</span><span class="ident" id="7404306">c</span>&nbsp;<span class="op" id="7404308">*</span><span class="ident" id="7404309"><a href="/database/sql/sql_test.go.html#7404066">concurrentStmtQueryTest</a></span><span class="op" id="7404332">)</span>&nbsp;<span class="ident" id="7404334">finish</span><span class="op" id="7404340">(</span><span class="ident" id="7404341">t</span>&nbsp;<span class="ident" id="7404343"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7404350">.</span><span class="ident" id="7404351">TB</span><span class="op" id="7404353">)</span>&nbsp;<span class="op" id="7404355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404358">if</span>&nbsp;<span class="ident" id="7404361"><a href="/database/sql/sql_test.go.html#7404306">c</a></span><span class="op" id="7404362">.</span><span class="ident" id="7404363">stmt</span>&nbsp;<span class="op" id="7404368">!=</span>&nbsp;<span class="ident" id="7404371">nil</span>&nbsp;<span class="op" id="7404375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404379"><a href="/database/sql/sql_test.go.html#7404306">c</a></span><span class="op" id="7404380">.</span><span class="ident" id="7404381">stmt</span><span class="op" id="7404385">.</span><span class="ident" id="7404386">Close</span><span class="op" id="7404391">(</span><span class="op" id="7404392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404396"><a href="/database/sql/sql_test.go.html#7404306">c</a></span><span class="op" id="7404397">.</span><span class="ident" id="7404398">stmt</span>&nbsp;<span class="op" id="7404403">=</span>&nbsp;<span class="ident" id="7404405">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7404410">}</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404413"><a href="/database/sql/sql_test.go.html#7404306">c</a></span><span class="op" id="7404414">.</span><span class="ident" id="7404415">db</span>&nbsp;<span class="op" id="7404418">=</span>&nbsp;<span class="ident" id="7404420">nil</span><br>
<span class="lineno"></span><span class="op" id="7404424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7404427">func</span>&nbsp;<span class="op" id="7404432">(</span><span class="ident" id="7404433">c</span>&nbsp;<span class="op" id="7404435">*</span><span class="ident" id="7404436"><a href="/database/sql/sql_test.go.html#7404066">concurrentStmtQueryTest</a></span><span class="op" id="7404459">)</span>&nbsp;<span class="ident" id="7404461">test</span><span class="op" id="7404465">(</span><span class="ident" id="7404466">t</span>&nbsp;<span class="ident" id="7404468"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7404475">.</span><span class="ident" id="7404476">TB</span><span class="op" id="7404478">)</span>&nbsp;<span class="builtintype" id="7404480">error</span>&nbsp;<span class="op" id="7404486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404489">rows</span><span class="op" id="7404493">,</span>&nbsp;<span class="ident" id="7404495">err</span>&nbsp;<span class="op" id="7404499">:=</span>&nbsp;<span class="ident" id="7404502"><a href="/database/sql/sql_test.go.html#7404433">c</a></span><span class="op" id="7404503">.</span><span class="ident" id="7404504">stmt</span><span class="op" id="7404508">.</span><span class="ident" id="7404509">Query</span><span class="op" id="7404514">(</span><span class="op" id="7404515">)</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404518">if</span>&nbsp;<span class="ident" id="7404521"><a href="/database/sql/sql_test.go.html#7404495">err</a></span>&nbsp;<span class="op" id="7404525">!=</span>&nbsp;<span class="ident" id="7404528">nil</span>&nbsp;<span class="op" id="7404532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404536"><a href="/database/sql/sql_test.go.html#7404466">t</a></span><span class="op" id="7404537">.</span><span class="ident" id="7404538">Errorf</span><span class="op" id="7404544">(</span><span class="string" id="7404545">&#34;error&nbsp;on&nbsp;query:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7404566">,</span>&nbsp;<span class="ident" id="7404568"><a href="/database/sql/sql_test.go.html#7404495">err</a></span><span class="op" id="7404571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404575">return</span>&nbsp;<span class="ident" id="7404582"><a href="/database/sql/sql_test.go.html#7404495">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7404587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404591">var</span>&nbsp;<span class="ident" id="7404595">name</span>&nbsp;<span class="builtintype" id="7404600">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404608">for</span>&nbsp;<span class="ident" id="7404612"><a href="/database/sql/sql_test.go.html#7404489">rows</a></span><span class="op" id="7404616">.</span><span class="ident" id="7404617">Next</span><span class="op" id="7404621">(</span><span class="op" id="7404622">)</span>&nbsp;<span class="op" id="7404624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404628"><a href="/database/sql/sql_test.go.html#7404489">rows</a></span><span class="op" id="7404632">.</span><span class="ident" id="7404633">Scan</span><span class="op" id="7404637">(</span><span class="op" id="7404638">&amp;</span><span class="ident" id="7404639"><a href="/database/sql/sql_test.go.html#7404595">name</a></span><span class="op" id="7404643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7404646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404649"><a href="/database/sql/sql_test.go.html#7404489">rows</a></span><span class="op" id="7404653">.</span><span class="ident" id="7404654">Close</span><span class="op" id="7404659">(</span><span class="op" id="7404660">)</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404663">return</span>&nbsp;<span class="ident" id="7404670">nil</span><br>
<span class="lineno"></span><span class="op" id="7404674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7404677">type</span>&nbsp;<span class="ident" id="7404682">concurrentStmtExecTest</span>&nbsp;<span class="keyword" id="7404705">struct</span>&nbsp;<span class="op" id="7404712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404715">db</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7404720">*</span><span class="ident" id="7404721"><a href="/database/sql/sql.go.html#6354182">DB</a></span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404725">stmt</span>&nbsp;<span class="op" id="7404730">*</span><span class="ident" id="7404731"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><br>
<span class="lineno"></span><span class="op" id="7404736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7404739">func</span>&nbsp;<span class="op" id="7404744">(</span><span class="ident" id="7404745">c</span>&nbsp;<span class="op" id="7404747">*</span><span class="ident" id="7404748"><a href="/database/sql/sql_test.go.html#7404682">concurrentStmtExecTest</a></span><span class="op" id="7404770">)</span>&nbsp;<span class="ident" id="7404772">init</span><span class="op" id="7404776">(</span><span class="ident" id="7404777">t</span>&nbsp;<span class="ident" id="7404779"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7404786">.</span><span class="ident" id="7404787">TB</span><span class="op" id="7404789">,</span>&nbsp;<span class="ident" id="7404791">db</span>&nbsp;<span class="op" id="7404794">*</span><span class="ident" id="7404795"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7404797">)</span>&nbsp;<span class="op" id="7404799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404802"><a href="/database/sql/sql_test.go.html#7404745">c</a></span><span class="op" id="7404803">.</span><span class="ident" id="7404804">db</span>&nbsp;<span class="op" id="7404807">=</span>&nbsp;<span class="ident" id="7404809"><a href="/database/sql/sql_test.go.html#7404791">db</a></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404813">var</span>&nbsp;<span class="ident" id="7404817">err</span>&nbsp;<span class="builtintype" id="7404821">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404828"><a href="/database/sql/sql_test.go.html#7404745">c</a></span><span class="op" id="7404829">.</span><span class="ident" id="7404830">stmt</span><span class="op" id="7404834">,</span>&nbsp;<span class="ident" id="7404836"><a href="/database/sql/sql_test.go.html#7404817">err</a></span>&nbsp;<span class="op" id="7404840">=</span>&nbsp;<span class="ident" id="7404842"><a href="/database/sql/sql_test.go.html#7404791">db</a></span><span class="op" id="7404844">.</span><span class="ident" id="7404845">Prepare</span><span class="op" id="7404852">(</span><span class="string" id="7404853">&#34;NOSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7404906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404909">if</span>&nbsp;<span class="ident" id="7404912"><a href="/database/sql/sql_test.go.html#7404817">err</a></span>&nbsp;<span class="op" id="7404916">!=</span>&nbsp;<span class="ident" id="7404919">nil</span>&nbsp;<span class="op" id="7404923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404927"><a href="/database/sql/sql_test.go.html#7404777">t</a></span><span class="op" id="7404928">.</span><span class="ident" id="7404929">Fatal</span><span class="op" id="7404934">(</span><span class="ident" id="7404935"><a href="/database/sql/sql_test.go.html#7404817">err</a></span><span class="op" id="7404938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7404941">}</span><br>
<span class="lineno">1525</span><span class="op" id="7404943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7404946">func</span>&nbsp;<span class="op" id="7404951">(</span><span class="ident" id="7404952">c</span>&nbsp;<span class="op" id="7404954">*</span><span class="ident" id="7404955"><a href="/database/sql/sql_test.go.html#7404682">concurrentStmtExecTest</a></span><span class="op" id="7404977">)</span>&nbsp;<span class="ident" id="7404979">finish</span><span class="op" id="7404985">(</span><span class="ident" id="7404986">t</span>&nbsp;<span class="ident" id="7404988"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7404995">.</span><span class="ident" id="7404996">TB</span><span class="op" id="7404998">)</span>&nbsp;<span class="op" id="7405000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405003">if</span>&nbsp;<span class="ident" id="7405006"><a href="/database/sql/sql_test.go.html#7404952">c</a></span><span class="op" id="7405007">.</span><span class="ident" id="7405008">stmt</span>&nbsp;<span class="op" id="7405013">!=</span>&nbsp;<span class="ident" id="7405016">nil</span>&nbsp;<span class="op" id="7405020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405024"><a href="/database/sql/sql_test.go.html#7404952">c</a></span><span class="op" id="7405025">.</span><span class="ident" id="7405026">stmt</span><span class="op" id="7405030">.</span><span class="ident" id="7405031">Close</span><span class="op" id="7405036">(</span><span class="op" id="7405037">)</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405041"><a href="/database/sql/sql_test.go.html#7404952">c</a></span><span class="op" id="7405042">.</span><span class="ident" id="7405043">stmt</span>&nbsp;<span class="op" id="7405048">=</span>&nbsp;<span class="ident" id="7405050">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7405055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405058"><a href="/database/sql/sql_test.go.html#7404952">c</a></span><span class="op" id="7405059">.</span><span class="ident" id="7405060">db</span>&nbsp;<span class="op" id="7405063">=</span>&nbsp;<span class="ident" id="7405065">nil</span><br>
<span class="lineno"></span><span class="op" id="7405069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1535</span><span class="keyword" id="7405072">func</span>&nbsp;<span class="op" id="7405077">(</span><span class="ident" id="7405078">c</span>&nbsp;<span class="op" id="7405080">*</span><span class="ident" id="7405081"><a href="/database/sql/sql_test.go.html#7404682">concurrentStmtExecTest</a></span><span class="op" id="7405103">)</span>&nbsp;<span class="ident" id="7405105">test</span><span class="op" id="7405109">(</span><span class="ident" id="7405110">t</span>&nbsp;<span class="ident" id="7405112"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7405119">.</span><span class="ident" id="7405120">TB</span><span class="op" id="7405122">)</span>&nbsp;<span class="builtintype" id="7405124">error</span>&nbsp;<span class="op" id="7405130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405133">_</span><span class="op" id="7405134">,</span>&nbsp;<span class="ident" id="7405136">err</span>&nbsp;<span class="op" id="7405140">:=</span>&nbsp;<span class="ident" id="7405143"><a href="/database/sql/sql_test.go.html#7405078">c</a></span><span class="op" id="7405144">.</span><span class="ident" id="7405145">stmt</span><span class="op" id="7405149">.</span><span class="ident" id="7405150">Exec</span><span class="op" id="7405154">(</span><span class="num" id="7405155">3</span><span class="op" id="7405156">,</span>&nbsp;<span class="ident" id="7405158"><a href="/database/sql/sql_test.go.html#7369662">chrisBirthday</a></span><span class="op" id="7405171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405174">if</span>&nbsp;<span class="ident" id="7405177"><a href="/database/sql/sql_test.go.html#7405136">err</a></span>&nbsp;<span class="op" id="7405181">!=</span>&nbsp;<span class="ident" id="7405184">nil</span>&nbsp;<span class="op" id="7405188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405192"><a href="/database/sql/sql_test.go.html#7405110">t</a></span><span class="op" id="7405193">.</span><span class="ident" id="7405194">Errorf</span><span class="op" id="7405200">(</span><span class="string" id="7405201">&#34;error&nbsp;on&nbsp;exec:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7405221">,</span>&nbsp;<span class="ident" id="7405223"><a href="/database/sql/sql_test.go.html#7405136">err</a></span><span class="op" id="7405226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405230">return</span>&nbsp;<span class="ident" id="7405237"><a href="/database/sql/sql_test.go.html#7405136">err</a></span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7405242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405245">return</span>&nbsp;<span class="ident" id="7405252">nil</span><br>
<span class="lineno"></span><span class="op" id="7405256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7405259">type</span>&nbsp;<span class="ident" id="7405264">concurrentTxQueryTest</span>&nbsp;<span class="keyword" id="7405286">struct</span>&nbsp;<span class="op" id="7405293">{</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405296">db</span>&nbsp;<span class="op" id="7405299">*</span><span class="ident" id="7405300"><a href="/database/sql/sql.go.html#6354182">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405304">tx</span>&nbsp;<span class="op" id="7405307">*</span><span class="ident" id="7405308"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><br>
<span class="lineno"></span><span class="op" id="7405311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7405314">func</span>&nbsp;<span class="op" id="7405319">(</span><span class="ident" id="7405320">c</span>&nbsp;<span class="op" id="7405322">*</span><span class="ident" id="7405323"><a href="/database/sql/sql_test.go.html#7405264">concurrentTxQueryTest</a></span><span class="op" id="7405344">)</span>&nbsp;<span class="ident" id="7405346">init</span><span class="op" id="7405350">(</span><span class="ident" id="7405351">t</span>&nbsp;<span class="ident" id="7405353"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7405360">.</span><span class="ident" id="7405361">TB</span><span class="op" id="7405363">,</span>&nbsp;<span class="ident" id="7405365">db</span>&nbsp;<span class="op" id="7405368">*</span><span class="ident" id="7405369"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7405371">)</span>&nbsp;<span class="op" id="7405373">{</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405376"><a href="/database/sql/sql_test.go.html#7405320">c</a></span><span class="op" id="7405377">.</span><span class="ident" id="7405378">db</span>&nbsp;<span class="op" id="7405381">=</span>&nbsp;<span class="ident" id="7405383"><a href="/database/sql/sql_test.go.html#7405365">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405387">var</span>&nbsp;<span class="ident" id="7405391">err</span>&nbsp;<span class="builtintype" id="7405395">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405402"><a href="/database/sql/sql_test.go.html#7405320">c</a></span><span class="op" id="7405403">.</span><span class="ident" id="7405404">tx</span><span class="op" id="7405406">,</span>&nbsp;<span class="ident" id="7405408"><a href="/database/sql/sql_test.go.html#7405391">err</a></span>&nbsp;<span class="op" id="7405412">=</span>&nbsp;<span class="ident" id="7405414"><a href="/database/sql/sql_test.go.html#7405320">c</a></span><span class="op" id="7405415">.</span><span class="ident" id="7405416">db</span><span class="op" id="7405418">.</span><span class="ident" id="7405419">Begin</span><span class="op" id="7405424">(</span><span class="op" id="7405425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405428">if</span>&nbsp;<span class="ident" id="7405431"><a href="/database/sql/sql_test.go.html#7405391">err</a></span>&nbsp;<span class="op" id="7405435">!=</span>&nbsp;<span class="ident" id="7405438">nil</span>&nbsp;<span class="op" id="7405442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405446"><a href="/database/sql/sql_test.go.html#7405351">t</a></span><span class="op" id="7405447">.</span><span class="ident" id="7405448">Fatal</span><span class="op" id="7405453">(</span><span class="ident" id="7405454"><a href="/database/sql/sql_test.go.html#7405391">err</a></span><span class="op" id="7405457">)</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7405460">}</span><br>
<span class="lineno"></span><span class="op" id="7405462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7405465">func</span>&nbsp;<span class="op" id="7405470">(</span><span class="ident" id="7405471">c</span>&nbsp;<span class="op" id="7405473">*</span><span class="ident" id="7405474"><a href="/database/sql/sql_test.go.html#7405264">concurrentTxQueryTest</a></span><span class="op" id="7405495">)</span>&nbsp;<span class="ident" id="7405497">finish</span><span class="op" id="7405503">(</span><span class="ident" id="7405504">t</span>&nbsp;<span class="ident" id="7405506"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7405513">.</span><span class="ident" id="7405514">TB</span><span class="op" id="7405516">)</span>&nbsp;<span class="op" id="7405518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405521">if</span>&nbsp;<span class="ident" id="7405524"><a href="/database/sql/sql_test.go.html#7405471">c</a></span><span class="op" id="7405525">.</span><span class="ident" id="7405526">tx</span>&nbsp;<span class="op" id="7405529">!=</span>&nbsp;<span class="ident" id="7405532">nil</span>&nbsp;<span class="op" id="7405536">{</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405540"><a href="/database/sql/sql_test.go.html#7405471">c</a></span><span class="op" id="7405541">.</span><span class="ident" id="7405542">tx</span><span class="op" id="7405544">.</span><span class="ident" id="7405545">Rollback</span><span class="op" id="7405553">(</span><span class="op" id="7405554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405558"><a href="/database/sql/sql_test.go.html#7405471">c</a></span><span class="op" id="7405559">.</span><span class="ident" id="7405560">tx</span>&nbsp;<span class="op" id="7405563">=</span>&nbsp;<span class="ident" id="7405565">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7405570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405573"><a href="/database/sql/sql_test.go.html#7405471">c</a></span><span class="op" id="7405574">.</span><span class="ident" id="7405575">db</span>&nbsp;<span class="op" id="7405578">=</span>&nbsp;<span class="ident" id="7405580">nil</span><br>
<span class="lineno"></span><span class="op" id="7405584">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="keyword" id="7405587">func</span>&nbsp;<span class="op" id="7405592">(</span><span class="ident" id="7405593">c</span>&nbsp;<span class="op" id="7405595">*</span><span class="ident" id="7405596"><a href="/database/sql/sql_test.go.html#7405264">concurrentTxQueryTest</a></span><span class="op" id="7405617">)</span>&nbsp;<span class="ident" id="7405619">test</span><span class="op" id="7405623">(</span><span class="ident" id="7405624">t</span>&nbsp;<span class="ident" id="7405626"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7405633">.</span><span class="ident" id="7405634">TB</span><span class="op" id="7405636">)</span>&nbsp;<span class="builtintype" id="7405638">error</span>&nbsp;<span class="op" id="7405644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405647">rows</span><span class="op" id="7405651">,</span>&nbsp;<span class="ident" id="7405653">err</span>&nbsp;<span class="op" id="7405657">:=</span>&nbsp;<span class="ident" id="7405660"><a href="/database/sql/sql_test.go.html#7405593">c</a></span><span class="op" id="7405661">.</span><span class="ident" id="7405662">db</span><span class="op" id="7405664">.</span><span class="ident" id="7405665">Query</span><span class="op" id="7405670">(</span><span class="string" id="7405671">&#34;SELECT|people|name|&#34;</span><span class="op" id="7405692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405695">if</span>&nbsp;<span class="ident" id="7405698"><a href="/database/sql/sql_test.go.html#7405653">err</a></span>&nbsp;<span class="op" id="7405702">!=</span>&nbsp;<span class="ident" id="7405705">nil</span>&nbsp;<span class="op" id="7405709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405713"><a href="/database/sql/sql_test.go.html#7405624">t</a></span><span class="op" id="7405714">.</span><span class="ident" id="7405715">Error</span><span class="op" id="7405720">(</span><span class="ident" id="7405721"><a href="/database/sql/sql_test.go.html#7405653">err</a></span><span class="op" id="7405724">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405728">return</span>&nbsp;<span class="ident" id="7405735"><a href="/database/sql/sql_test.go.html#7405653">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7405740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405743">var</span>&nbsp;<span class="ident" id="7405747">name</span>&nbsp;<span class="builtintype" id="7405752">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405760">for</span>&nbsp;<span class="ident" id="7405764"><a href="/database/sql/sql_test.go.html#7405647">rows</a></span><span class="op" id="7405768">.</span><span class="ident" id="7405769">Next</span><span class="op" id="7405773">(</span><span class="op" id="7405774">)</span>&nbsp;<span class="op" id="7405776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405780"><a href="/database/sql/sql_test.go.html#7405647">rows</a></span><span class="op" id="7405784">.</span><span class="ident" id="7405785">Scan</span><span class="op" id="7405789">(</span><span class="op" id="7405790">&amp;</span><span class="ident" id="7405791"><a href="/database/sql/sql_test.go.html#7405747">name</a></span><span class="op" id="7405795">)</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7405798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405801"><a href="/database/sql/sql_test.go.html#7405647">rows</a></span><span class="op" id="7405805">.</span><span class="ident" id="7405806">Close</span><span class="op" id="7405811">(</span><span class="op" id="7405812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405815">return</span>&nbsp;<span class="ident" id="7405822">nil</span><br>
<span class="lineno"></span><span class="op" id="7405826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1580</span><span class="keyword" id="7405829">type</span>&nbsp;<span class="ident" id="7405834">concurrentTxExecTest</span>&nbsp;<span class="keyword" id="7405855">struct</span>&nbsp;<span class="op" id="7405862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405865">db</span>&nbsp;<span class="op" id="7405868">*</span><span class="ident" id="7405869"><a href="/database/sql/sql.go.html#6354182">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405873">tx</span>&nbsp;<span class="op" id="7405876">*</span><span class="ident" id="7405877"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><br>
<span class="lineno"></span><span class="op" id="7405880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1585</span><span class="keyword" id="7405883">func</span>&nbsp;<span class="op" id="7405888">(</span><span class="ident" id="7405889">c</span>&nbsp;<span class="op" id="7405891">*</span><span class="ident" id="7405892"><a href="/database/sql/sql_test.go.html#7405834">concurrentTxExecTest</a></span><span class="op" id="7405912">)</span>&nbsp;<span class="ident" id="7405914">init</span><span class="op" id="7405918">(</span><span class="ident" id="7405919">t</span>&nbsp;<span class="ident" id="7405921"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7405928">.</span><span class="ident" id="7405929">TB</span><span class="op" id="7405931">,</span>&nbsp;<span class="ident" id="7405933">db</span>&nbsp;<span class="op" id="7405936">*</span><span class="ident" id="7405937"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7405939">)</span>&nbsp;<span class="op" id="7405941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405944"><a href="/database/sql/sql_test.go.html#7405889">c</a></span><span class="op" id="7405945">.</span><span class="ident" id="7405946">db</span>&nbsp;<span class="op" id="7405949">=</span>&nbsp;<span class="ident" id="7405951"><a href="/database/sql/sql_test.go.html#7405933">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405955">var</span>&nbsp;<span class="ident" id="7405959">err</span>&nbsp;<span class="builtintype" id="7405963">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7405970"><a href="/database/sql/sql_test.go.html#7405889">c</a></span><span class="op" id="7405971">.</span><span class="ident" id="7405972">tx</span><span class="op" id="7405974">,</span>&nbsp;<span class="ident" id="7405976"><a href="/database/sql/sql_test.go.html#7405959">err</a></span>&nbsp;<span class="op" id="7405980">=</span>&nbsp;<span class="ident" id="7405982"><a href="/database/sql/sql_test.go.html#7405889">c</a></span><span class="op" id="7405983">.</span><span class="ident" id="7405984">db</span><span class="op" id="7405986">.</span><span class="ident" id="7405987">Begin</span><span class="op" id="7405992">(</span><span class="op" id="7405993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7405996">if</span>&nbsp;<span class="ident" id="7405999"><a href="/database/sql/sql_test.go.html#7405959">err</a></span>&nbsp;<span class="op" id="7406003">!=</span>&nbsp;<span class="ident" id="7406006">nil</span>&nbsp;<span class="op" id="7406010">{</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406014"><a href="/database/sql/sql_test.go.html#7405919">t</a></span><span class="op" id="7406015">.</span><span class="ident" id="7406016">Fatal</span><span class="op" id="7406021">(</span><span class="ident" id="7406022"><a href="/database/sql/sql_test.go.html#7405959">err</a></span><span class="op" id="7406025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7406028">}</span><br>
<span class="lineno"></span><span class="op" id="7406030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7406033">func</span>&nbsp;<span class="op" id="7406038">(</span><span class="ident" id="7406039">c</span>&nbsp;<span class="op" id="7406041">*</span><span class="ident" id="7406042"><a href="/database/sql/sql_test.go.html#7405834">concurrentTxExecTest</a></span><span class="op" id="7406062">)</span>&nbsp;<span class="ident" id="7406064">finish</span><span class="op" id="7406070">(</span><span class="ident" id="7406071">t</span>&nbsp;<span class="ident" id="7406073"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7406080">.</span><span class="ident" id="7406081">TB</span><span class="op" id="7406083">)</span>&nbsp;<span class="op" id="7406085">{</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7406088">if</span>&nbsp;<span class="ident" id="7406091"><a href="/database/sql/sql_test.go.html#7406039">c</a></span><span class="op" id="7406092">.</span><span class="ident" id="7406093">tx</span>&nbsp;<span class="op" id="7406096">!=</span>&nbsp;<span class="ident" id="7406099">nil</span>&nbsp;<span class="op" id="7406103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406107"><a href="/database/sql/sql_test.go.html#7406039">c</a></span><span class="op" id="7406108">.</span><span class="ident" id="7406109">tx</span><span class="op" id="7406111">.</span><span class="ident" id="7406112">Rollback</span><span class="op" id="7406120">(</span><span class="op" id="7406121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406125"><a href="/database/sql/sql_test.go.html#7406039">c</a></span><span class="op" id="7406126">.</span><span class="ident" id="7406127">tx</span>&nbsp;<span class="op" id="7406130">=</span>&nbsp;<span class="ident" id="7406132">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7406137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406140"><a href="/database/sql/sql_test.go.html#7406039">c</a></span><span class="op" id="7406141">.</span><span class="ident" id="7406142">db</span>&nbsp;<span class="op" id="7406145">=</span>&nbsp;<span class="ident" id="7406147">nil</span><br>
<span class="lineno">1600</span><span class="op" id="7406151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7406154">func</span>&nbsp;<span class="op" id="7406159">(</span><span class="ident" id="7406160">c</span>&nbsp;<span class="op" id="7406162">*</span><span class="ident" id="7406163"><a href="/database/sql/sql_test.go.html#7405834">concurrentTxExecTest</a></span><span class="op" id="7406183">)</span>&nbsp;<span class="ident" id="7406185">test</span><span class="op" id="7406189">(</span><span class="ident" id="7406190">t</span>&nbsp;<span class="ident" id="7406192"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7406199">.</span><span class="ident" id="7406200">TB</span><span class="op" id="7406202">)</span>&nbsp;<span class="builtintype" id="7406204">error</span>&nbsp;<span class="op" id="7406210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406213">_</span><span class="op" id="7406214">,</span>&nbsp;<span class="ident" id="7406216">err</span>&nbsp;<span class="op" id="7406220">:=</span>&nbsp;<span class="ident" id="7406223"><a href="/database/sql/sql_test.go.html#7406160">c</a></span><span class="op" id="7406224">.</span><span class="ident" id="7406225">tx</span><span class="op" id="7406227">.</span><span class="ident" id="7406228">Exec</span><span class="op" id="7406232">(</span><span class="string" id="7406233">&#34;NOSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7406286">,</span>&nbsp;<span class="num" id="7406288">3</span><span class="op" id="7406289">,</span>&nbsp;<span class="ident" id="7406291"><a href="/database/sql/sql_test.go.html#7369662">chrisBirthday</a></span><span class="op" id="7406304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7406307">if</span>&nbsp;<span class="ident" id="7406310"><a href="/database/sql/sql_test.go.html#7406216">err</a></span>&nbsp;<span class="op" id="7406314">!=</span>&nbsp;<span class="ident" id="7406317">nil</span>&nbsp;<span class="op" id="7406321">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406325"><a href="/database/sql/sql_test.go.html#7406190">t</a></span><span class="op" id="7406326">.</span><span class="ident" id="7406327">Error</span><span class="op" id="7406332">(</span><span class="ident" id="7406333"><a href="/database/sql/sql_test.go.html#7406216">err</a></span><span class="op" id="7406336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7406340">return</span>&nbsp;<span class="ident" id="7406347"><a href="/database/sql/sql_test.go.html#7406216">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7406352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7406355">return</span>&nbsp;<span class="ident" id="7406362">nil</span><br>
<span class="lineno"></span><span class="op" id="7406366">}</span><br>
<span class="lineno">1610</span><br>
<span class="lineno"></span><span class="keyword" id="7406369">type</span>&nbsp;<span class="ident" id="7406374">concurrentTxStmtQueryTest</span>&nbsp;<span class="keyword" id="7406400">struct</span>&nbsp;<span class="op" id="7406407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406410">db</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7406415">*</span><span class="ident" id="7406416"><a href="/database/sql/sql.go.html#6354182">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406420">tx</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7406425">*</span><span class="ident" id="7406426"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406430">stmt</span>&nbsp;<span class="op" id="7406435">*</span><span class="ident" id="7406436"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><br>
<span class="lineno">1615</span><span class="op" id="7406441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7406444">func</span>&nbsp;<span class="op" id="7406449">(</span><span class="ident" id="7406450">c</span>&nbsp;<span class="op" id="7406452">*</span><span class="ident" id="7406453"><a href="/database/sql/sql_test.go.html#7406374">concurrentTxStmtQueryTest</a></span><span class="op" id="7406478">)</span>&nbsp;<span class="ident" id="7406480">init</span><span class="op" id="7406484">(</span><span class="ident" id="7406485">t</span>&nbsp;<span class="ident" id="7406487"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7406494">.</span><span class="ident" id="7406495">TB</span><span class="op" id="7406497">,</span>&nbsp;<span class="ident" id="7406499">db</span>&nbsp;<span class="op" id="7406502">*</span><span class="ident" id="7406503"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7406505">)</span>&nbsp;<span class="op" id="7406507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406510"><a href="/database/sql/sql_test.go.html#7406450">c</a></span><span class="op" id="7406511">.</span><span class="ident" id="7406512">db</span>&nbsp;<span class="op" id="7406515">=</span>&nbsp;<span class="ident" id="7406517"><a href="/database/sql/sql_test.go.html#7406499">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7406521">var</span>&nbsp;<span class="ident" id="7406525">err</span>&nbsp;<span class="builtintype" id="7406529">error</span><br>
<span class="lineno">1620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406536"><a href="/database/sql/sql_test.go.html#7406450">c</a></span><span class="op" id="7406537">.</span><span class="ident" id="7406538">tx</span><span class="op" id="7406540">,</span>&nbsp;<span class="ident" id="7406542"><a href="/database/sql/sql_test.go.html#7406525">err</a></span>&nbsp;<span class="op" id="7406546">=</span>&nbsp;<span class="ident" id="7406548"><a href="/database/sql/sql_test.go.html#7406450">c</a></span><span class="op" id="7406549">.</span><span class="ident" id="7406550">db</span><span class="op" id="7406552">.</span><span class="ident" id="7406553">Begin</span><span class="op" id="7406558">(</span><span class="op" id="7406559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7406562">if</span>&nbsp;<span class="ident" id="7406565"><a href="/database/sql/sql_test.go.html#7406525">err</a></span>&nbsp;<span class="op" id="7406569">!=</span>&nbsp;<span class="ident" id="7406572">nil</span>&nbsp;<span class="op" id="7406576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406580"><a href="/database/sql/sql_test.go.html#7406485">t</a></span><span class="op" id="7406581">.</span><span class="ident" id="7406582">Fatal</span><span class="op" id="7406587">(</span><span class="ident" id="7406588"><a href="/database/sql/sql_test.go.html#7406525">err</a></span><span class="op" id="7406591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7406594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406597"><a href="/database/sql/sql_test.go.html#7406450">c</a></span><span class="op" id="7406598">.</span><span class="ident" id="7406599">stmt</span><span class="op" id="7406603">,</span>&nbsp;<span class="ident" id="7406605"><a href="/database/sql/sql_test.go.html#7406525">err</a></span>&nbsp;<span class="op" id="7406609">=</span>&nbsp;<span class="ident" id="7406611"><a href="/database/sql/sql_test.go.html#7406450">c</a></span><span class="op" id="7406612">.</span><span class="ident" id="7406613">tx</span><span class="op" id="7406615">.</span><span class="ident" id="7406616">Prepare</span><span class="op" id="7406623">(</span><span class="string" id="7406624">&#34;SELECT|people|name|&#34;</span><span class="op" id="7406645">)</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7406648">if</span>&nbsp;<span class="ident" id="7406651"><a href="/database/sql/sql_test.go.html#7406525">err</a></span>&nbsp;<span class="op" id="7406655">!=</span>&nbsp;<span class="ident" id="7406658">nil</span>&nbsp;<span class="op" id="7406662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406666"><a href="/database/sql/sql_test.go.html#7406485">t</a></span><span class="op" id="7406667">.</span><span class="ident" id="7406668">Fatal</span><span class="op" id="7406673">(</span><span class="ident" id="7406674"><a href="/database/sql/sql_test.go.html#7406525">err</a></span><span class="op" id="7406677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7406680">}</span><br>
<span class="lineno"></span><span class="op" id="7406682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="keyword" id="7406685">func</span>&nbsp;<span class="op" id="7406690">(</span><span class="ident" id="7406691">c</span>&nbsp;<span class="op" id="7406693">*</span><span class="ident" id="7406694"><a href="/database/sql/sql_test.go.html#7406374">concurrentTxStmtQueryTest</a></span><span class="op" id="7406719">)</span>&nbsp;<span class="ident" id="7406721">finish</span><span class="op" id="7406727">(</span><span class="ident" id="7406728">t</span>&nbsp;<span class="ident" id="7406730"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7406737">.</span><span class="ident" id="7406738">TB</span><span class="op" id="7406740">)</span>&nbsp;<span class="op" id="7406742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7406745">if</span>&nbsp;<span class="ident" id="7406748"><a href="/database/sql/sql_test.go.html#7406691">c</a></span><span class="op" id="7406749">.</span><span class="ident" id="7406750">stmt</span>&nbsp;<span class="op" id="7406755">!=</span>&nbsp;<span class="ident" id="7406758">nil</span>&nbsp;<span class="op" id="7406762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406766"><a href="/database/sql/sql_test.go.html#7406691">c</a></span><span class="op" id="7406767">.</span><span class="ident" id="7406768">stmt</span><span class="op" id="7406772">.</span><span class="ident" id="7406773">Close</span><span class="op" id="7406778">(</span><span class="op" id="7406779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406783"><a href="/database/sql/sql_test.go.html#7406691">c</a></span><span class="op" id="7406784">.</span><span class="ident" id="7406785">stmt</span>&nbsp;<span class="op" id="7406790">=</span>&nbsp;<span class="ident" id="7406792">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7406797">}</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7406800">if</span>&nbsp;<span class="ident" id="7406803"><a href="/database/sql/sql_test.go.html#7406691">c</a></span><span class="op" id="7406804">.</span><span class="ident" id="7406805">tx</span>&nbsp;<span class="op" id="7406808">!=</span>&nbsp;<span class="ident" id="7406811">nil</span>&nbsp;<span class="op" id="7406815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406819"><a href="/database/sql/sql_test.go.html#7406691">c</a></span><span class="op" id="7406820">.</span><span class="ident" id="7406821">tx</span><span class="op" id="7406823">.</span><span class="ident" id="7406824">Rollback</span><span class="op" id="7406832">(</span><span class="op" id="7406833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406837"><a href="/database/sql/sql_test.go.html#7406691">c</a></span><span class="op" id="7406838">.</span><span class="ident" id="7406839">tx</span>&nbsp;<span class="op" id="7406842">=</span>&nbsp;<span class="ident" id="7406844">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7406849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406852"><a href="/database/sql/sql_test.go.html#7406691">c</a></span><span class="op" id="7406853">.</span><span class="ident" id="7406854">db</span>&nbsp;<span class="op" id="7406857">=</span>&nbsp;<span class="ident" id="7406859">nil</span><br>
<span class="lineno">1640</span><span class="op" id="7406863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7406866">func</span>&nbsp;<span class="op" id="7406871">(</span><span class="ident" id="7406872">c</span>&nbsp;<span class="op" id="7406874">*</span><span class="ident" id="7406875"><a href="/database/sql/sql_test.go.html#7406374">concurrentTxStmtQueryTest</a></span><span class="op" id="7406900">)</span>&nbsp;<span class="ident" id="7406902">test</span><span class="op" id="7406906">(</span><span class="ident" id="7406907">t</span>&nbsp;<span class="ident" id="7406909"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7406916">.</span><span class="ident" id="7406917">TB</span><span class="op" id="7406919">)</span>&nbsp;<span class="builtintype" id="7406921">error</span>&nbsp;<span class="op" id="7406927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406930">rows</span><span class="op" id="7406934">,</span>&nbsp;<span class="ident" id="7406936">err</span>&nbsp;<span class="op" id="7406940">:=</span>&nbsp;<span class="ident" id="7406943"><a href="/database/sql/sql_test.go.html#7406872">c</a></span><span class="op" id="7406944">.</span><span class="ident" id="7406945">stmt</span><span class="op" id="7406949">.</span><span class="ident" id="7406950">Query</span><span class="op" id="7406955">(</span><span class="op" id="7406956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7406959">if</span>&nbsp;<span class="ident" id="7406962"><a href="/database/sql/sql_test.go.html#7406936">err</a></span>&nbsp;<span class="op" id="7406966">!=</span>&nbsp;<span class="ident" id="7406969">nil</span>&nbsp;<span class="op" id="7406973">{</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7406977"><a href="/database/sql/sql_test.go.html#7406907">t</a></span><span class="op" id="7406978">.</span><span class="ident" id="7406979">Errorf</span><span class="op" id="7406985">(</span><span class="string" id="7406986">&#34;error&nbsp;on&nbsp;query:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7407007">,</span>&nbsp;<span class="ident" id="7407009"><a href="/database/sql/sql_test.go.html#7406936">err</a></span><span class="op" id="7407012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7407016">return</span>&nbsp;<span class="ident" id="7407023"><a href="/database/sql/sql_test.go.html#7406936">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7407028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7407032">var</span>&nbsp;<span class="ident" id="7407036">name</span>&nbsp;<span class="builtintype" id="7407041">string</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7407049">for</span>&nbsp;<span class="ident" id="7407053"><a href="/database/sql/sql_test.go.html#7406930">rows</a></span><span class="op" id="7407057">.</span><span class="ident" id="7407058">Next</span><span class="op" id="7407062">(</span><span class="op" id="7407063">)</span>&nbsp;<span class="op" id="7407065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407069"><a href="/database/sql/sql_test.go.html#7406930">rows</a></span><span class="op" id="7407073">.</span><span class="ident" id="7407074">Scan</span><span class="op" id="7407078">(</span><span class="op" id="7407079">&amp;</span><span class="ident" id="7407080"><a href="/database/sql/sql_test.go.html#7407036">name</a></span><span class="op" id="7407084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7407087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407090"><a href="/database/sql/sql_test.go.html#7406930">rows</a></span><span class="op" id="7407094">.</span><span class="ident" id="7407095">Close</span><span class="op" id="7407100">(</span><span class="op" id="7407101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7407104">return</span>&nbsp;<span class="ident" id="7407111">nil</span><br>
<span class="lineno">1655</span><span class="op" id="7407115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7407118">type</span>&nbsp;<span class="ident" id="7407123">concurrentTxStmtExecTest</span>&nbsp;<span class="keyword" id="7407148">struct</span>&nbsp;<span class="op" id="7407155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407158">db</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7407163">*</span><span class="ident" id="7407164"><a href="/database/sql/sql.go.html#6354182">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407168">tx</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7407173">*</span><span class="ident" id="7407174"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407178">stmt</span>&nbsp;<span class="op" id="7407183">*</span><span class="ident" id="7407184"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><br>
<span class="lineno"></span><span class="op" id="7407189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7407192">func</span>&nbsp;<span class="op" id="7407197">(</span><span class="ident" id="7407198">c</span>&nbsp;<span class="op" id="7407200">*</span><span class="ident" id="7407201"><a href="/database/sql/sql_test.go.html#7407123">concurrentTxStmtExecTest</a></span><span class="op" id="7407225">)</span>&nbsp;<span class="ident" id="7407227">init</span><span class="op" id="7407231">(</span><span class="ident" id="7407232">t</span>&nbsp;<span class="ident" id="7407234"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7407241">.</span><span class="ident" id="7407242">TB</span><span class="op" id="7407244">,</span>&nbsp;<span class="ident" id="7407246">db</span>&nbsp;<span class="op" id="7407249">*</span><span class="ident" id="7407250"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7407252">)</span>&nbsp;<span class="op" id="7407254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407257"><a href="/database/sql/sql_test.go.html#7407198">c</a></span><span class="op" id="7407258">.</span><span class="ident" id="7407259">db</span>&nbsp;<span class="op" id="7407262">=</span>&nbsp;<span class="ident" id="7407264"><a href="/database/sql/sql_test.go.html#7407246">db</a></span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7407268">var</span>&nbsp;<span class="ident" id="7407272">err</span>&nbsp;<span class="builtintype" id="7407276">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407283"><a href="/database/sql/sql_test.go.html#7407198">c</a></span><span class="op" id="7407284">.</span><span class="ident" id="7407285">tx</span><span class="op" id="7407287">,</span>&nbsp;<span class="ident" id="7407289"><a href="/database/sql/sql_test.go.html#7407272">err</a></span>&nbsp;<span class="op" id="7407293">=</span>&nbsp;<span class="ident" id="7407295"><a href="/database/sql/sql_test.go.html#7407198">c</a></span><span class="op" id="7407296">.</span><span class="ident" id="7407297">db</span><span class="op" id="7407299">.</span><span class="ident" id="7407300">Begin</span><span class="op" id="7407305">(</span><span class="op" id="7407306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7407309">if</span>&nbsp;<span class="ident" id="7407312"><a href="/database/sql/sql_test.go.html#7407272">err</a></span>&nbsp;<span class="op" id="7407316">!=</span>&nbsp;<span class="ident" id="7407319">nil</span>&nbsp;<span class="op" id="7407323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407327"><a href="/database/sql/sql_test.go.html#7407232">t</a></span><span class="op" id="7407328">.</span><span class="ident" id="7407329">Fatal</span><span class="op" id="7407334">(</span><span class="ident" id="7407335"><a href="/database/sql/sql_test.go.html#7407272">err</a></span><span class="op" id="7407338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7407341">}</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407344"><a href="/database/sql/sql_test.go.html#7407198">c</a></span><span class="op" id="7407345">.</span><span class="ident" id="7407346">stmt</span><span class="op" id="7407350">,</span>&nbsp;<span class="ident" id="7407352"><a href="/database/sql/sql_test.go.html#7407272">err</a></span>&nbsp;<span class="op" id="7407356">=</span>&nbsp;<span class="ident" id="7407358"><a href="/database/sql/sql_test.go.html#7407198">c</a></span><span class="op" id="7407359">.</span><span class="ident" id="7407360">tx</span><span class="op" id="7407362">.</span><span class="ident" id="7407363">Prepare</span><span class="op" id="7407370">(</span><span class="string" id="7407371">&#34;NOSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7407424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7407427">if</span>&nbsp;<span class="ident" id="7407430"><a href="/database/sql/sql_test.go.html#7407272">err</a></span>&nbsp;<span class="op" id="7407434">!=</span>&nbsp;<span class="ident" id="7407437">nil</span>&nbsp;<span class="op" id="7407441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407445"><a href="/database/sql/sql_test.go.html#7407232">t</a></span><span class="op" id="7407446">.</span><span class="ident" id="7407447">Fatal</span><span class="op" id="7407452">(</span><span class="ident" id="7407453"><a href="/database/sql/sql_test.go.html#7407272">err</a></span><span class="op" id="7407456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7407459">}</span><br>
<span class="lineno"></span><span class="op" id="7407461">}</span><br>
<span class="lineno">1675</span><br>
<span class="lineno"></span><span class="keyword" id="7407464">func</span>&nbsp;<span class="op" id="7407469">(</span><span class="ident" id="7407470">c</span>&nbsp;<span class="op" id="7407472">*</span><span class="ident" id="7407473"><a href="/database/sql/sql_test.go.html#7407123">concurrentTxStmtExecTest</a></span><span class="op" id="7407497">)</span>&nbsp;<span class="ident" id="7407499">finish</span><span class="op" id="7407505">(</span><span class="ident" id="7407506">t</span>&nbsp;<span class="ident" id="7407508"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7407515">.</span><span class="ident" id="7407516">TB</span><span class="op" id="7407518">)</span>&nbsp;<span class="op" id="7407520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7407523">if</span>&nbsp;<span class="ident" id="7407526"><a href="/database/sql/sql_test.go.html#7407470">c</a></span><span class="op" id="7407527">.</span><span class="ident" id="7407528">stmt</span>&nbsp;<span class="op" id="7407533">!=</span>&nbsp;<span class="ident" id="7407536">nil</span>&nbsp;<span class="op" id="7407540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407544"><a href="/database/sql/sql_test.go.html#7407470">c</a></span><span class="op" id="7407545">.</span><span class="ident" id="7407546">stmt</span><span class="op" id="7407550">.</span><span class="ident" id="7407551">Close</span><span class="op" id="7407556">(</span><span class="op" id="7407557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407561"><a href="/database/sql/sql_test.go.html#7407470">c</a></span><span class="op" id="7407562">.</span><span class="ident" id="7407563">stmt</span>&nbsp;<span class="op" id="7407568">=</span>&nbsp;<span class="ident" id="7407570">nil</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7407575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7407578">if</span>&nbsp;<span class="ident" id="7407581"><a href="/database/sql/sql_test.go.html#7407470">c</a></span><span class="op" id="7407582">.</span><span class="ident" id="7407583">tx</span>&nbsp;<span class="op" id="7407586">!=</span>&nbsp;<span class="ident" id="7407589">nil</span>&nbsp;<span class="op" id="7407593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407597"><a href="/database/sql/sql_test.go.html#7407470">c</a></span><span class="op" id="7407598">.</span><span class="ident" id="7407599">tx</span><span class="op" id="7407601">.</span><span class="ident" id="7407602">Rollback</span><span class="op" id="7407610">(</span><span class="op" id="7407611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407615"><a href="/database/sql/sql_test.go.html#7407470">c</a></span><span class="op" id="7407616">.</span><span class="ident" id="7407617">tx</span>&nbsp;<span class="op" id="7407620">=</span>&nbsp;<span class="ident" id="7407622">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7407627">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407630"><a href="/database/sql/sql_test.go.html#7407470">c</a></span><span class="op" id="7407631">.</span><span class="ident" id="7407632">db</span>&nbsp;<span class="op" id="7407635">=</span>&nbsp;<span class="ident" id="7407637">nil</span><br>
<span class="lineno"></span><span class="op" id="7407641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7407644">func</span>&nbsp;<span class="op" id="7407649">(</span><span class="ident" id="7407650">c</span>&nbsp;<span class="op" id="7407652">*</span><span class="ident" id="7407653"><a href="/database/sql/sql_test.go.html#7407123">concurrentTxStmtExecTest</a></span><span class="op" id="7407677">)</span>&nbsp;<span class="ident" id="7407679">test</span><span class="op" id="7407683">(</span><span class="ident" id="7407684">t</span>&nbsp;<span class="ident" id="7407686"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7407693">.</span><span class="ident" id="7407694">TB</span><span class="op" id="7407696">)</span>&nbsp;<span class="builtintype" id="7407698">error</span>&nbsp;<span class="op" id="7407704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407707">_</span><span class="op" id="7407708">,</span>&nbsp;<span class="ident" id="7407710">err</span>&nbsp;<span class="op" id="7407714">:=</span>&nbsp;<span class="ident" id="7407717"><a href="/database/sql/sql_test.go.html#7407650">c</a></span><span class="op" id="7407718">.</span><span class="ident" id="7407719">stmt</span><span class="op" id="7407723">.</span><span class="ident" id="7407724">Exec</span><span class="op" id="7407728">(</span><span class="num" id="7407729">3</span><span class="op" id="7407730">,</span>&nbsp;<span class="ident" id="7407732"><a href="/database/sql/sql_test.go.html#7369662">chrisBirthday</a></span><span class="op" id="7407745">)</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7407748">if</span>&nbsp;<span class="ident" id="7407751"><a href="/database/sql/sql_test.go.html#7407710">err</a></span>&nbsp;<span class="op" id="7407755">!=</span>&nbsp;<span class="ident" id="7407758">nil</span>&nbsp;<span class="op" id="7407762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407766"><a href="/database/sql/sql_test.go.html#7407684">t</a></span><span class="op" id="7407767">.</span><span class="ident" id="7407768">Errorf</span><span class="op" id="7407774">(</span><span class="string" id="7407775">&#34;error&nbsp;on&nbsp;exec:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7407795">,</span>&nbsp;<span class="ident" id="7407797"><a href="/database/sql/sql_test.go.html#7407710">err</a></span><span class="op" id="7407800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7407804">return</span>&nbsp;<span class="ident" id="7407811"><a href="/database/sql/sql_test.go.html#7407710">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7407816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7407819">return</span>&nbsp;<span class="ident" id="7407826">nil</span><br>
<span class="lineno">1695</span><span class="op" id="7407830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7407833">type</span>&nbsp;<span class="ident" id="7407838">concurrentRandomTest</span>&nbsp;<span class="keyword" id="7407859">struct</span>&nbsp;<span class="op" id="7407866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407869">tests</span>&nbsp;<span class="op" id="7407875">[</span><span class="op" id="7407876">]</span><span class="ident" id="7407877"><a href="/database/sql/sql_test.go.html#7403117">concurrentTest</a></span><br>
<span class="lineno"></span><span class="op" id="7407892">}</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span><span class="keyword" id="7407895">func</span>&nbsp;<span class="op" id="7407900">(</span><span class="ident" id="7407901">c</span>&nbsp;<span class="op" id="7407903">*</span><span class="ident" id="7407904"><a href="/database/sql/sql_test.go.html#7407838">concurrentRandomTest</a></span><span class="op" id="7407924">)</span>&nbsp;<span class="ident" id="7407926">init</span><span class="op" id="7407930">(</span><span class="ident" id="7407931">t</span>&nbsp;<span class="ident" id="7407933"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7407940">.</span><span class="ident" id="7407941">TB</span><span class="op" id="7407943">,</span>&nbsp;<span class="ident" id="7407945">db</span>&nbsp;<span class="op" id="7407948">*</span><span class="ident" id="7407949"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="7407951">)</span>&nbsp;<span class="op" id="7407953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7407956"><a href="/database/sql/sql_test.go.html#7407901">c</a></span><span class="op" id="7407957">.</span><span class="ident" id="7407958">tests</span>&nbsp;<span class="op" id="7407964">=</span>&nbsp;<span class="op" id="7407966">[</span><span class="op" id="7407967">]</span><span class="ident" id="7407968"><a href="/database/sql/sql_test.go.html#7403117">concurrentTest</a></span><span class="op" id="7407982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7407986">new</span><span class="op" id="7407989">(</span><span class="ident" id="7407990"><a href="/database/sql/sql_test.go.html#7403228">concurrentDBQueryTest</a></span><span class="op" id="7408011">)</span><span class="op" id="7408012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7408016">new</span><span class="op" id="7408019">(</span><span class="ident" id="7408020"><a href="/database/sql/sql_test.go.html#7403662">concurrentDBExecTest</a></span><span class="op" id="7408040">)</span><span class="op" id="7408041">,</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7408045">new</span><span class="op" id="7408048">(</span><span class="ident" id="7408049"><a href="/database/sql/sql_test.go.html#7404066">concurrentStmtQueryTest</a></span><span class="op" id="7408072">)</span><span class="op" id="7408073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7408077">new</span><span class="op" id="7408080">(</span><span class="ident" id="7408081"><a href="/database/sql/sql_test.go.html#7404682">concurrentStmtExecTest</a></span><span class="op" id="7408103">)</span><span class="op" id="7408104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7408108">new</span><span class="op" id="7408111">(</span><span class="ident" id="7408112"><a href="/database/sql/sql_test.go.html#7405264">concurrentTxQueryTest</a></span><span class="op" id="7408133">)</span><span class="op" id="7408134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7408138">new</span><span class="op" id="7408141">(</span><span class="ident" id="7408142"><a href="/database/sql/sql_test.go.html#7405834">concurrentTxExecTest</a></span><span class="op" id="7408162">)</span><span class="op" id="7408163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7408167">new</span><span class="op" id="7408170">(</span><span class="ident" id="7408171"><a href="/database/sql/sql_test.go.html#7406374">concurrentTxStmtQueryTest</a></span><span class="op" id="7408196">)</span><span class="op" id="7408197">,</span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7408201">new</span><span class="op" id="7408204">(</span><span class="ident" id="7408205"><a href="/database/sql/sql_test.go.html#7407123">concurrentTxStmtExecTest</a></span><span class="op" id="7408229">)</span><span class="op" id="7408230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7408233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7408236">for</span>&nbsp;<span class="ident" id="7408240">_</span><span class="op" id="7408241">,</span>&nbsp;<span class="ident" id="7408243">ct</span>&nbsp;<span class="op" id="7408246">:=</span>&nbsp;<span class="keyword" id="7408249">range</span>&nbsp;<span class="ident" id="7408255"><a href="/database/sql/sql_test.go.html#7407901">c</a></span><span class="op" id="7408256">.</span><span class="ident" id="7408257">tests</span>&nbsp;<span class="op" id="7408263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7408267"><a href="/database/sql/sql_test.go.html#7408243">ct</a></span><span class="op" id="7408269">.</span><span class="ident" id="7408270">init</span><span class="op" id="7408274">(</span><span class="ident" id="7408275"><a href="/database/sql/sql_test.go.html#7407931">t</a></span><span class="op" id="7408276">,</span>&nbsp;<span class="ident" id="7408278"><a href="/database/sql/sql_test.go.html#7407945">db</a></span><span class="op" id="7408280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7408283">}</span><br>
<span class="lineno">1715</span><span class="op" id="7408285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7408288">func</span>&nbsp;<span class="op" id="7408293">(</span><span class="ident" id="7408294">c</span>&nbsp;<span class="op" id="7408296">*</span><span class="ident" id="7408297"><a href="/database/sql/sql_test.go.html#7407838">concurrentRandomTest</a></span><span class="op" id="7408317">)</span>&nbsp;<span class="ident" id="7408319">finish</span><span class="op" id="7408325">(</span><span class="ident" id="7408326">t</span>&nbsp;<span class="ident" id="7408328"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7408335">.</span><span class="ident" id="7408336">TB</span><span class="op" id="7408338">)</span>&nbsp;<span class="op" id="7408340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7408343">for</span>&nbsp;<span class="ident" id="7408347">_</span><span class="op" id="7408348">,</span>&nbsp;<span class="ident" id="7408350">ct</span>&nbsp;<span class="op" id="7408353">:=</span>&nbsp;<span class="keyword" id="7408356">range</span>&nbsp;<span class="ident" id="7408362"><a href="/database/sql/sql_test.go.html#7408294">c</a></span><span class="op" id="7408363">.</span><span class="ident" id="7408364">tests</span>&nbsp;<span class="op" id="7408370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7408374"><a href="/database/sql/sql_test.go.html#7408350">ct</a></span><span class="op" id="7408376">.</span><span class="ident" id="7408377">finish</span><span class="op" id="7408383">(</span><span class="ident" id="7408384"><a href="/database/sql/sql_test.go.html#7408326">t</a></span><span class="op" id="7408385">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7408388">}</span><br>
<span class="lineno"></span><span class="op" id="7408390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7408393">func</span>&nbsp;<span class="op" id="7408398">(</span><span class="ident" id="7408399">c</span>&nbsp;<span class="op" id="7408401">*</span><span class="ident" id="7408402"><a href="/database/sql/sql_test.go.html#7407838">concurrentRandomTest</a></span><span class="op" id="7408422">)</span>&nbsp;<span class="ident" id="7408424">test</span><span class="op" id="7408428">(</span><span class="ident" id="7408429">t</span>&nbsp;<span class="ident" id="7408431"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7408438">.</span><span class="ident" id="7408439">TB</span><span class="op" id="7408441">)</span>&nbsp;<span class="builtintype" id="7408443">error</span>&nbsp;<span class="op" id="7408449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7408452">ct</span>&nbsp;<span class="op" id="7408455">:=</span>&nbsp;<span class="ident" id="7408458"><a href="/database/sql/sql_test.go.html#7408399">c</a></span><span class="op" id="7408459">.</span><span class="ident" id="7408460">tests</span><span class="op" id="7408465">[</span><span class="ident" id="7408466"><a href="/database/sql/sql_test.go.html#7368938">rand</a></span><span class="op" id="7408470">.</span><span class="ident" id="7408471">Intn</span><span class="op" id="7408475">(</span><span class="builtinfunc" id="7408476">len</span><span class="op" id="7408479">(</span><span class="ident" id="7408480"><a href="/database/sql/sql_test.go.html#7408399">c</a></span><span class="op" id="7408481">.</span><span class="ident" id="7408482">tests</span><span class="op" id="7408487">)</span><span class="op" id="7408488">)</span><span class="op" id="7408489">]</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7408492">return</span>&nbsp;<span class="ident" id="7408499"><a href="/database/sql/sql_test.go.html#7408452">ct</a></span><span class="op" id="7408501">.</span><span class="ident" id="7408502">test</span><span class="op" id="7408506">(</span><span class="ident" id="7408507"><a href="/database/sql/sql_test.go.html#7408429">t</a></span><span class="op" id="7408508">)</span><br>
<span class="lineno"></span><span class="op" id="7408510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7408513">func</span>&nbsp;<span class="ident" id="7408518">doConcurrentTest</span><span class="op" id="7408534">(</span><span class="ident" id="7408535">t</span>&nbsp;<span class="ident" id="7408537"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7408544">.</span><span class="ident" id="7408545">TB</span><span class="op" id="7408547">,</span>&nbsp;<span class="ident" id="7408549">ct</span>&nbsp;<span class="ident" id="7408552"><a href="/database/sql/sql_test.go.html#7403117">concurrentTest</a></span><span class="op" id="7408566">)</span>&nbsp;<span class="op" id="7408568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7408571">maxProcs</span><span class="op" id="7408579">,</span>&nbsp;<span class="ident" id="7408581">numReqs</span>&nbsp;<span class="op" id="7408589">:=</span>&nbsp;<span class="num" id="7408592">1</span><span class="op" id="7408593">,</span>&nbsp;<span class="num" id="7408595">500</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7408600">if</span>&nbsp;<span class="ident" id="7408603"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7408610">.</span><span class="ident" id="7408611">Short</span><span class="op" id="7408616">(</span><span class="op" id="7408617">)</span>&nbsp;<span class="op" id="7408619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7408623"><a href="/database/sql/sql_test.go.html#7408571">maxProcs</a></span><span class="op" id="7408631">,</span>&nbsp;<span class="ident" id="7408633"><a href="/database/sql/sql_test.go.html#7408581">numReqs</a></span>&nbsp;<span class="op" id="7408641">=</span>&nbsp;<span class="num" id="7408643">4</span><span class="op" id="7408644">,</span>&nbsp;<span class="num" id="7408646">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7408650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7408653">defer</span>&nbsp;<span class="ident" id="7408659"><a href="/database/sql/sql_test.go.html#7368962">runtime</a></span><span class="op" id="7408666">.</span><span class="ident" id="7408667">GOMAXPROCS</span><span class="op" id="7408677">(</span><span class="ident" id="7408678"><a href="/database/sql/sql_test.go.html#7368962">runtime</a></span><span class="op" id="7408685">.</span><span class="ident" id="7408686">GOMAXPROCS</span><span class="op" id="7408696">(</span><span class="ident" id="7408697"><a href="/database/sql/sql_test.go.html#7408571">maxProcs</a></span><span class="op" id="7408705">)</span><span class="op" id="7408706">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7408710">db</span>&nbsp;<span class="op" id="7408713">:=</span>&nbsp;<span class="ident" id="7408716"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7408725">(</span><span class="ident" id="7408726"><a href="/database/sql/sql_test.go.html#7408535">t</a></span><span class="op" id="7408727">,</span>&nbsp;<span class="string" id="7408729">&#34;people&#34;</span><span class="op" id="7408737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7408740">defer</span>&nbsp;<span class="ident" id="7408746"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7408753">(</span><span class="ident" id="7408754"><a href="/database/sql/sql_test.go.html#7408535">t</a></span><span class="op" id="7408755">,</span>&nbsp;<span class="ident" id="7408757"><a href="/database/sql/sql_test.go.html#7408710">db</a></span><span class="op" id="7408759">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7408763"><a href="/database/sql/sql_test.go.html#7408549">ct</a></span><span class="op" id="7408765">.</span><span class="ident" id="7408766">init</span><span class="op" id="7408770">(</span><span class="ident" id="7408771"><a href="/database/sql/sql_test.go.html#7408535">t</a></span><span class="op" id="7408772">,</span>&nbsp;<span class="ident" id="7408774"><a href="/database/sql/sql_test.go.html#7408710">db</a></span><span class="op" id="7408776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7408779">defer</span>&nbsp;<span class="ident" id="7408785"><a href="/database/sql/sql_test.go.html#7408549">ct</a></span><span class="op" id="7408787">.</span><span class="ident" id="7408788">finish</span><span class="op" id="7408794">(</span><span class="ident" id="7408795"><a href="/database/sql/sql_test.go.html#7408535">t</a></span><span class="op" id="7408796">)</span><br>
<span class="lineno">1740</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7408800">var</span>&nbsp;<span class="ident" id="7408804">wg</span>&nbsp;<span class="ident" id="7408807"><a href="/database/sql/sql_test.go.html#7368984">sync</a></span><span class="op" id="7408811">.</span><span class="ident" id="7408812">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7408823"><a href="/database/sql/sql_test.go.html#7408804">wg</a></span><span class="op" id="7408825">.</span><span class="ident" id="7408826">Add</span><span class="op" id="7408829">(</span><span class="ident" id="7408830"><a href="/database/sql/sql_test.go.html#7408581">numReqs</a></span><span class="op" id="7408837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7408841">reqs</span>&nbsp;<span class="op" id="7408846">:=</span>&nbsp;<span class="builtinfunc" id="7408849">make</span><span class="op" id="7408853">(</span><span class="keyword" id="7408854">chan</span>&nbsp;<span class="builtintype" id="7408859">bool</span><span class="op" id="7408863">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7408866">defer</span>&nbsp;<span class="builtinfunc" id="7408872">close</span><span class="op" id="7408877">(</span><span class="ident" id="7408878"><a href="/database/sql/sql_test.go.html#7408841">reqs</a></span><span class="op" id="7408882">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7408886">for</span>&nbsp;<span class="ident" id="7408890">i</span>&nbsp;<span class="op" id="7408892">:=</span>&nbsp;<span class="num" id="7408895">0</span><span class="op" id="7408896">;</span>&nbsp;<span class="ident" id="7408898"><a href="/database/sql/sql_test.go.html#7408890">i</a></span>&nbsp;<span class="op" id="7408900">&lt;</span>&nbsp;<span class="ident" id="7408902"><a href="/database/sql/sql_test.go.html#7408571">maxProcs</a></span><span class="op" id="7408910">*</span><span class="num" id="7408911">2</span><span class="op" id="7408912">;</span>&nbsp;<span class="ident" id="7408914"><a href="/database/sql/sql_test.go.html#7408890">i</a></span><span class="op" id="7408915">++</span>&nbsp;<span class="op" id="7408918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7408922">go</span>&nbsp;<span class="keyword" id="7408925">func</span><span class="op" id="7408929">(</span><span class="op" id="7408930">)</span>&nbsp;<span class="op" id="7408932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7408937">for</span>&nbsp;<span class="keyword" id="7408941">range</span>&nbsp;<span class="ident" id="7408947"><a href="/database/sql/sql_test.go.html#7408841">reqs</a></span>&nbsp;<span class="op" id="7408952">{</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7408958">err</span>&nbsp;<span class="op" id="7408962">:=</span>&nbsp;<span class="ident" id="7408965"><a href="/database/sql/sql_test.go.html#7408549">ct</a></span><span class="op" id="7408967">.</span><span class="ident" id="7408968">test</span><span class="op" id="7408972">(</span><span class="ident" id="7408973"><a href="/database/sql/sql_test.go.html#7408535">t</a></span><span class="op" id="7408974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7408980">if</span>&nbsp;<span class="ident" id="7408983"><a href="/database/sql/sql_test.go.html#7408958">err</a></span>&nbsp;<span class="op" id="7408987">!=</span>&nbsp;<span class="ident" id="7408990">nil</span>&nbsp;<span class="op" id="7408994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409001"><a href="/database/sql/sql_test.go.html#7408804">wg</a></span><span class="op" id="7409003">.</span><span class="ident" id="7409004">Done</span><span class="op" id="7409008">(</span><span class="op" id="7409009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409016">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7409029">}</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409035"><a href="/database/sql/sql_test.go.html#7408804">wg</a></span><span class="op" id="7409037">.</span><span class="ident" id="7409038">Done</span><span class="op" id="7409042">(</span><span class="op" id="7409043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7409048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7409052">}</span><span class="op" id="7409053">(</span><span class="op" id="7409054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7409057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409061">for</span>&nbsp;<span class="ident" id="7409065">i</span>&nbsp;<span class="op" id="7409067">:=</span>&nbsp;<span class="num" id="7409070">0</span><span class="op" id="7409071">;</span>&nbsp;<span class="ident" id="7409073"><a href="/database/sql/sql_test.go.html#7409065">i</a></span>&nbsp;<span class="op" id="7409075">&lt;</span>&nbsp;<span class="ident" id="7409077"><a href="/database/sql/sql_test.go.html#7408581">numReqs</a></span><span class="op" id="7409084">;</span>&nbsp;<span class="ident" id="7409086"><a href="/database/sql/sql_test.go.html#7409065">i</a></span><span class="op" id="7409087">++</span>&nbsp;<span class="op" id="7409090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409094"><a href="/database/sql/sql_test.go.html#7408841">reqs</a></span>&nbsp;<span class="op" id="7409099">&lt;-</span>&nbsp;<span class="builtintype" id="7409102">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7409108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409112"><a href="/database/sql/sql_test.go.html#7408804">wg</a></span><span class="op" id="7409114">.</span><span class="ident" id="7409115">Wait</span><span class="op" id="7409119">(</span><span class="op" id="7409120">)</span><br>
<span class="lineno">1765</span><span class="op" id="7409122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7409125">func</span>&nbsp;<span class="ident" id="7409130">manyConcurrentQueries</span><span class="op" id="7409151">(</span><span class="ident" id="7409152">t</span>&nbsp;<span class="ident" id="7409154"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7409161">.</span><span class="ident" id="7409162">TB</span><span class="op" id="7409164">)</span>&nbsp;<span class="op" id="7409166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409169">maxProcs</span><span class="op" id="7409177">,</span>&nbsp;<span class="ident" id="7409179">numReqs</span>&nbsp;<span class="op" id="7409187">:=</span>&nbsp;<span class="num" id="7409190">16</span><span class="op" id="7409192">,</span>&nbsp;<span class="num" id="7409194">500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409199">if</span>&nbsp;<span class="ident" id="7409202"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7409209">.</span><span class="ident" id="7409210">Short</span><span class="op" id="7409215">(</span><span class="op" id="7409216">)</span>&nbsp;<span class="op" id="7409218">{</span><br>
<span class="lineno">1770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409222"><a href="/database/sql/sql_test.go.html#7409169">maxProcs</a></span><span class="op" id="7409230">,</span>&nbsp;<span class="ident" id="7409232"><a href="/database/sql/sql_test.go.html#7409179">numReqs</a></span>&nbsp;<span class="op" id="7409240">=</span>&nbsp;<span class="num" id="7409242">4</span><span class="op" id="7409243">,</span>&nbsp;<span class="num" id="7409245">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7409249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409252">defer</span>&nbsp;<span class="ident" id="7409258"><a href="/database/sql/sql_test.go.html#7368962">runtime</a></span><span class="op" id="7409265">.</span><span class="ident" id="7409266">GOMAXPROCS</span><span class="op" id="7409276">(</span><span class="ident" id="7409277"><a href="/database/sql/sql_test.go.html#7368962">runtime</a></span><span class="op" id="7409284">.</span><span class="ident" id="7409285">GOMAXPROCS</span><span class="op" id="7409295">(</span><span class="ident" id="7409296"><a href="/database/sql/sql_test.go.html#7409169">maxProcs</a></span><span class="op" id="7409304">)</span><span class="op" id="7409305">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409309">db</span>&nbsp;<span class="op" id="7409312">:=</span>&nbsp;<span class="ident" id="7409315"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7409324">(</span><span class="ident" id="7409325"><a href="/database/sql/sql_test.go.html#7409152">t</a></span><span class="op" id="7409326">,</span>&nbsp;<span class="string" id="7409328">&#34;people&#34;</span><span class="op" id="7409336">)</span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409339">defer</span>&nbsp;<span class="ident" id="7409345"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7409352">(</span><span class="ident" id="7409353"><a href="/database/sql/sql_test.go.html#7409152">t</a></span><span class="op" id="7409354">,</span>&nbsp;<span class="ident" id="7409356"><a href="/database/sql/sql_test.go.html#7409309">db</a></span><span class="op" id="7409358">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409362">stmt</span><span class="op" id="7409366">,</span>&nbsp;<span class="ident" id="7409368">err</span>&nbsp;<span class="op" id="7409372">:=</span>&nbsp;<span class="ident" id="7409375"><a href="/database/sql/sql_test.go.html#7409309">db</a></span><span class="op" id="7409377">.</span><span class="ident" id="7409378">Prepare</span><span class="op" id="7409385">(</span><span class="string" id="7409386">&#34;SELECT|people|name|&#34;</span><span class="op" id="7409407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409410">if</span>&nbsp;<span class="ident" id="7409413"><a href="/database/sql/sql_test.go.html#7409368">err</a></span>&nbsp;<span class="op" id="7409417">!=</span>&nbsp;<span class="ident" id="7409420">nil</span>&nbsp;<span class="op" id="7409424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409428"><a href="/database/sql/sql_test.go.html#7409152">t</a></span><span class="op" id="7409429">.</span><span class="ident" id="7409430">Fatal</span><span class="op" id="7409435">(</span><span class="ident" id="7409436"><a href="/database/sql/sql_test.go.html#7409368">err</a></span><span class="op" id="7409439">)</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7409442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409445">defer</span>&nbsp;<span class="ident" id="7409451"><a href="/database/sql/sql_test.go.html#7409362">stmt</a></span><span class="op" id="7409455">.</span><span class="ident" id="7409456">Close</span><span class="op" id="7409461">(</span><span class="op" id="7409462">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409466">var</span>&nbsp;<span class="ident" id="7409470">wg</span>&nbsp;<span class="ident" id="7409473"><a href="/database/sql/sql_test.go.html#7368984">sync</a></span><span class="op" id="7409477">.</span><span class="ident" id="7409478">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409489"><a href="/database/sql/sql_test.go.html#7409470">wg</a></span><span class="op" id="7409491">.</span><span class="ident" id="7409492">Add</span><span class="op" id="7409495">(</span><span class="ident" id="7409496"><a href="/database/sql/sql_test.go.html#7409179">numReqs</a></span><span class="op" id="7409503">)</span><br>
<span class="lineno">1785</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409507">reqs</span>&nbsp;<span class="op" id="7409512">:=</span>&nbsp;<span class="builtinfunc" id="7409515">make</span><span class="op" id="7409519">(</span><span class="keyword" id="7409520">chan</span>&nbsp;<span class="builtintype" id="7409525">bool</span><span class="op" id="7409529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409532">defer</span>&nbsp;<span class="builtinfunc" id="7409538">close</span><span class="op" id="7409543">(</span><span class="ident" id="7409544"><a href="/database/sql/sql_test.go.html#7409507">reqs</a></span><span class="op" id="7409548">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409552">for</span>&nbsp;<span class="ident" id="7409556">i</span>&nbsp;<span class="op" id="7409558">:=</span>&nbsp;<span class="num" id="7409561">0</span><span class="op" id="7409562">;</span>&nbsp;<span class="ident" id="7409564"><a href="/database/sql/sql_test.go.html#7409556">i</a></span>&nbsp;<span class="op" id="7409566">&lt;</span>&nbsp;<span class="ident" id="7409568"><a href="/database/sql/sql_test.go.html#7409169">maxProcs</a></span><span class="op" id="7409576">*</span><span class="num" id="7409577">2</span><span class="op" id="7409578">;</span>&nbsp;<span class="ident" id="7409580"><a href="/database/sql/sql_test.go.html#7409556">i</a></span><span class="op" id="7409581">++</span>&nbsp;<span class="op" id="7409584">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409588">go</span>&nbsp;<span class="keyword" id="7409591">func</span><span class="op" id="7409595">(</span><span class="op" id="7409596">)</span>&nbsp;<span class="op" id="7409598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409603">for</span>&nbsp;<span class="keyword" id="7409607">range</span>&nbsp;<span class="ident" id="7409613"><a href="/database/sql/sql_test.go.html#7409507">reqs</a></span>&nbsp;<span class="op" id="7409618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409624">rows</span><span class="op" id="7409628">,</span>&nbsp;<span class="ident" id="7409630">err</span>&nbsp;<span class="op" id="7409634">:=</span>&nbsp;<span class="ident" id="7409637"><a href="/database/sql/sql_test.go.html#7409362">stmt</a></span><span class="op" id="7409641">.</span><span class="ident" id="7409642">Query</span><span class="op" id="7409647">(</span><span class="op" id="7409648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409654">if</span>&nbsp;<span class="ident" id="7409657"><a href="/database/sql/sql_test.go.html#7409630">err</a></span>&nbsp;<span class="op" id="7409661">!=</span>&nbsp;<span class="ident" id="7409664">nil</span>&nbsp;<span class="op" id="7409668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409675"><a href="/database/sql/sql_test.go.html#7409152">t</a></span><span class="op" id="7409676">.</span><span class="ident" id="7409677">Errorf</span><span class="op" id="7409683">(</span><span class="string" id="7409684">&#34;error&nbsp;on&nbsp;query:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7409705">,</span>&nbsp;<span class="ident" id="7409707"><a href="/database/sql/sql_test.go.html#7409630">err</a></span><span class="op" id="7409710">)</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409717"><a href="/database/sql/sql_test.go.html#7409470">wg</a></span><span class="op" id="7409719">.</span><span class="ident" id="7409720">Done</span><span class="op" id="7409724">(</span><span class="op" id="7409725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409732">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7409745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409752">var</span>&nbsp;<span class="ident" id="7409756">name</span>&nbsp;<span class="builtintype" id="7409761">string</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409772">for</span>&nbsp;<span class="ident" id="7409776"><a href="/database/sql/sql_test.go.html#7409624">rows</a></span><span class="op" id="7409780">.</span><span class="ident" id="7409781">Next</span><span class="op" id="7409785">(</span><span class="op" id="7409786">)</span>&nbsp;<span class="op" id="7409788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409795"><a href="/database/sql/sql_test.go.html#7409624">rows</a></span><span class="op" id="7409799">.</span><span class="ident" id="7409800">Scan</span><span class="op" id="7409804">(</span><span class="op" id="7409805">&amp;</span><span class="ident" id="7409806"><a href="/database/sql/sql_test.go.html#7409756">name</a></span><span class="op" id="7409810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7409816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409822"><a href="/database/sql/sql_test.go.html#7409624">rows</a></span><span class="op" id="7409826">.</span><span class="ident" id="7409827">Close</span><span class="op" id="7409832">(</span><span class="op" id="7409833">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409840"><a href="/database/sql/sql_test.go.html#7409470">wg</a></span><span class="op" id="7409842">.</span><span class="ident" id="7409843">Done</span><span class="op" id="7409847">(</span><span class="op" id="7409848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7409853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7409857">}</span><span class="op" id="7409858">(</span><span class="op" id="7409859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7409862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409866">for</span>&nbsp;<span class="ident" id="7409870">i</span>&nbsp;<span class="op" id="7409872">:=</span>&nbsp;<span class="num" id="7409875">0</span><span class="op" id="7409876">;</span>&nbsp;<span class="ident" id="7409878"><a href="/database/sql/sql_test.go.html#7409870">i</a></span>&nbsp;<span class="op" id="7409880">&lt;</span>&nbsp;<span class="ident" id="7409882"><a href="/database/sql/sql_test.go.html#7409179">numReqs</a></span><span class="op" id="7409889">;</span>&nbsp;<span class="ident" id="7409891"><a href="/database/sql/sql_test.go.html#7409870">i</a></span><span class="op" id="7409892">++</span>&nbsp;<span class="op" id="7409895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409899"><a href="/database/sql/sql_test.go.html#7409507">reqs</a></span>&nbsp;<span class="op" id="7409904">&lt;-</span>&nbsp;<span class="builtintype" id="7409907">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7409913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409917"><a href="/database/sql/sql_test.go.html#7409470">wg</a></span><span class="op" id="7409919">.</span><span class="ident" id="7409920">Wait</span><span class="op" id="7409924">(</span><span class="op" id="7409925">)</span><br>
<span class="lineno">1815</span><span class="op" id="7409927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7409930">func</span>&nbsp;<span class="ident" id="7409935">TestIssue6081</span><span class="op" id="7409948">(</span><span class="ident" id="7409949">t</span>&nbsp;<span class="op" id="7409951">*</span><span class="ident" id="7409952"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7409959">.</span><span class="ident" id="7409960">T</span><span class="op" id="7409961">)</span>&nbsp;<span class="op" id="7409963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7409966">db</span>&nbsp;<span class="op" id="7409969">:=</span>&nbsp;<span class="ident" id="7409972"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7409981">(</span><span class="ident" id="7409982"><a href="/database/sql/sql_test.go.html#7409949">t</a></span><span class="op" id="7409983">,</span>&nbsp;<span class="string" id="7409985">&#34;people&#34;</span><span class="op" id="7409993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7409996">defer</span>&nbsp;<span class="ident" id="7410002"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7410009">(</span><span class="ident" id="7410010"><a href="/database/sql/sql_test.go.html#7409949">t</a></span><span class="op" id="7410011">,</span>&nbsp;<span class="ident" id="7410013"><a href="/database/sql/sql_test.go.html#7409966">db</a></span><span class="op" id="7410015">)</span><br>
<span class="lineno">1820</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410019">drv</span>&nbsp;<span class="op" id="7410023">:=</span>&nbsp;<span class="ident" id="7410026"><a href="/database/sql/sql_test.go.html#7409966">db</a></span><span class="op" id="7410028">.</span><span class="ident" id="7410029">driver</span><span class="op" id="7410035">.</span><span class="op" id="7410036">(</span><span class="op" id="7410037">*</span><span class="ident" id="7410038"><a href="/database/sql/fakedb_test.go.html#7349239">fakeDriver</a></span><span class="op" id="7410048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410051"><a href="/database/sql/sql_test.go.html#7410019">drv</a></span><span class="op" id="7410054">.</span><span class="ident" id="7410055">mu</span><span class="op" id="7410057">.</span><span class="ident" id="7410058">Lock</span><span class="op" id="7410062">(</span><span class="op" id="7410063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410066">opens0</span>&nbsp;<span class="op" id="7410073">:=</span>&nbsp;<span class="ident" id="7410076"><a href="/database/sql/sql_test.go.html#7410019">drv</a></span><span class="op" id="7410079">.</span><span class="ident" id="7410080">openCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410091">closes0</span>&nbsp;<span class="op" id="7410099">:=</span>&nbsp;<span class="ident" id="7410102"><a href="/database/sql/sql_test.go.html#7410019">drv</a></span><span class="op" id="7410105">.</span><span class="ident" id="7410106">closeCount</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410118"><a href="/database/sql/sql_test.go.html#7410019">drv</a></span><span class="op" id="7410121">.</span><span class="ident" id="7410122">mu</span><span class="op" id="7410124">.</span><span class="ident" id="7410125">Unlock</span><span class="op" id="7410131">(</span><span class="op" id="7410132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410136">stmt</span><span class="op" id="7410140">,</span>&nbsp;<span class="ident" id="7410142">err</span>&nbsp;<span class="op" id="7410146">:=</span>&nbsp;<span class="ident" id="7410149"><a href="/database/sql/sql_test.go.html#7409966">db</a></span><span class="op" id="7410151">.</span><span class="ident" id="7410152">Prepare</span><span class="op" id="7410159">(</span><span class="string" id="7410160">&#34;SELECT|people|name|&#34;</span><span class="op" id="7410181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7410184">if</span>&nbsp;<span class="ident" id="7410187"><a href="/database/sql/sql_test.go.html#7410142">err</a></span>&nbsp;<span class="op" id="7410191">!=</span>&nbsp;<span class="ident" id="7410194">nil</span>&nbsp;<span class="op" id="7410198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410202"><a href="/database/sql/sql_test.go.html#7409949">t</a></span><span class="op" id="7410203">.</span><span class="ident" id="7410204">Fatal</span><span class="op" id="7410209">(</span><span class="ident" id="7410210"><a href="/database/sql/sql_test.go.html#7410142">err</a></span><span class="op" id="7410213">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7410216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410219"><a href="/database/sql/sql.go.html#6391192">rowsCloseHook</a></span>&nbsp;<span class="op" id="7410233">=</span>&nbsp;<span class="keyword" id="7410235">func</span><span class="op" id="7410239">(</span><span class="ident" id="7410240">rows</span>&nbsp;<span class="op" id="7410245">*</span><span class="ident" id="7410246"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="7410250">,</span>&nbsp;<span class="ident" id="7410252">err</span>&nbsp;<span class="op" id="7410256">*</span><span class="builtintype" id="7410257">error</span><span class="op" id="7410262">)</span>&nbsp;<span class="op" id="7410264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7410268">*</span><span class="ident" id="7410269"><a href="/database/sql/sql_test.go.html#7410252">err</a></span>&nbsp;<span class="op" id="7410273">=</span>&nbsp;<span class="ident" id="7410275"><a href="/database/sql/sql_test.go.html#7368898">driver</a></span><span class="op" id="7410281">.</span><span class="ident" id="7410282">ErrBadConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7410294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7410297">defer</span>&nbsp;<span class="keyword" id="7410303">func</span><span class="op" id="7410307">(</span><span class="op" id="7410308">)</span>&nbsp;<span class="op" id="7410310">{</span>&nbsp;<span class="ident" id="7410312"><a href="/database/sql/sql.go.html#6391192">rowsCloseHook</a></span>&nbsp;<span class="op" id="7410326">=</span>&nbsp;<span class="ident" id="7410328">nil</span>&nbsp;<span class="op" id="7410332">}</span><span class="op" id="7410333">(</span><span class="op" id="7410334">)</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7410337">for</span>&nbsp;<span class="ident" id="7410341">i</span>&nbsp;<span class="op" id="7410343">:=</span>&nbsp;<span class="num" id="7410346">0</span><span class="op" id="7410347">;</span>&nbsp;<span class="ident" id="7410349"><a href="/database/sql/sql_test.go.html#7410341">i</a></span>&nbsp;<span class="op" id="7410351">&lt;</span>&nbsp;<span class="num" id="7410353">10</span><span class="op" id="7410355">;</span>&nbsp;<span class="ident" id="7410357"><a href="/database/sql/sql_test.go.html#7410341">i</a></span><span class="op" id="7410358">++</span>&nbsp;<span class="op" id="7410361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410365">rows</span><span class="op" id="7410369">,</span>&nbsp;<span class="ident" id="7410371">err</span>&nbsp;<span class="op" id="7410375">:=</span>&nbsp;<span class="ident" id="7410378"><a href="/database/sql/sql_test.go.html#7410136">stmt</a></span><span class="op" id="7410382">.</span><span class="ident" id="7410383">Query</span><span class="op" id="7410388">(</span><span class="op" id="7410389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7410393">if</span>&nbsp;<span class="ident" id="7410396"><a href="/database/sql/sql_test.go.html#7410371">err</a></span>&nbsp;<span class="op" id="7410400">!=</span>&nbsp;<span class="ident" id="7410403">nil</span>&nbsp;<span class="op" id="7410407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410412"><a href="/database/sql/sql_test.go.html#7409949">t</a></span><span class="op" id="7410413">.</span><span class="ident" id="7410414">Fatal</span><span class="op" id="7410419">(</span><span class="ident" id="7410420"><a href="/database/sql/sql_test.go.html#7410371">err</a></span><span class="op" id="7410423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7410427">}</span><br>
<span class="lineno">1840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410431"><a href="/database/sql/sql_test.go.html#7410365">rows</a></span><span class="op" id="7410435">.</span><span class="ident" id="7410436">Close</span><span class="op" id="7410441">(</span><span class="op" id="7410442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7410445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7410448">if</span>&nbsp;<span class="ident" id="7410451">n</span>&nbsp;<span class="op" id="7410453">:=</span>&nbsp;<span class="builtinfunc" id="7410456">len</span><span class="op" id="7410459">(</span><span class="ident" id="7410460"><a href="/database/sql/sql_test.go.html#7410136">stmt</a></span><span class="op" id="7410464">.</span><span class="ident" id="7410465">css</span><span class="op" id="7410468">)</span><span class="op" id="7410469">;</span>&nbsp;<span class="ident" id="7410471"><a href="/database/sql/sql_test.go.html#7410451">n</a></span>&nbsp;<span class="op" id="7410473">&gt;</span>&nbsp;<span class="num" id="7410475">1</span>&nbsp;<span class="op" id="7410477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410481"><a href="/database/sql/sql_test.go.html#7409949">t</a></span><span class="op" id="7410482">.</span><span class="ident" id="7410483">Errorf</span><span class="op" id="7410489">(</span><span class="string" id="7410490">&#34;len(css&nbsp;slice)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;1&#34;</span><span class="op" id="7410522">,</span>&nbsp;<span class="ident" id="7410524"><a href="/database/sql/sql_test.go.html#7410451">n</a></span><span class="op" id="7410525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7410528">}</span><br>
<span class="lineno">1845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410531"><a href="/database/sql/sql_test.go.html#7410136">stmt</a></span><span class="op" id="7410535">.</span><span class="ident" id="7410536">Close</span><span class="op" id="7410541">(</span><span class="op" id="7410542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7410545">if</span>&nbsp;<span class="ident" id="7410548">n</span>&nbsp;<span class="op" id="7410550">:=</span>&nbsp;<span class="builtinfunc" id="7410553">len</span><span class="op" id="7410556">(</span><span class="ident" id="7410557"><a href="/database/sql/sql_test.go.html#7410136">stmt</a></span><span class="op" id="7410561">.</span><span class="ident" id="7410562">css</span><span class="op" id="7410565">)</span><span class="op" id="7410566">;</span>&nbsp;<span class="ident" id="7410568"><a href="/database/sql/sql_test.go.html#7410548">n</a></span>&nbsp;<span class="op" id="7410570">!=</span>&nbsp;<span class="num" id="7410573">0</span>&nbsp;<span class="op" id="7410575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410579"><a href="/database/sql/sql_test.go.html#7409949">t</a></span><span class="op" id="7410580">.</span><span class="ident" id="7410581">Errorf</span><span class="op" id="7410587">(</span><span class="string" id="7410588">&#34;len(css&nbsp;slice)&nbsp;after&nbsp;Close&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7410629">,</span>&nbsp;<span class="ident" id="7410631"><a href="/database/sql/sql_test.go.html#7410548">n</a></span><span class="op" id="7410632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7410635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410639"><a href="/database/sql/sql_test.go.html#7410019">drv</a></span><span class="op" id="7410642">.</span><span class="ident" id="7410643">mu</span><span class="op" id="7410645">.</span><span class="ident" id="7410646">Lock</span><span class="op" id="7410650">(</span><span class="op" id="7410651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410654">opens</span>&nbsp;<span class="op" id="7410660">:=</span>&nbsp;<span class="ident" id="7410663"><a href="/database/sql/sql_test.go.html#7410019">drv</a></span><span class="op" id="7410666">.</span><span class="ident" id="7410667">openCount</span>&nbsp;<span class="op" id="7410677">-</span>&nbsp;<span class="ident" id="7410679"><a href="/database/sql/sql_test.go.html#7410066">opens0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410687">closes</span>&nbsp;<span class="op" id="7410694">:=</span>&nbsp;<span class="ident" id="7410697"><a href="/database/sql/sql_test.go.html#7410019">drv</a></span><span class="op" id="7410700">.</span><span class="ident" id="7410701">closeCount</span>&nbsp;<span class="op" id="7410712">-</span>&nbsp;<span class="ident" id="7410714"><a href="/database/sql/sql_test.go.html#7410091">closes0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410723"><a href="/database/sql/sql_test.go.html#7410019">drv</a></span><span class="op" id="7410726">.</span><span class="ident" id="7410727">mu</span><span class="op" id="7410729">.</span><span class="ident" id="7410730">Unlock</span><span class="op" id="7410736">(</span><span class="op" id="7410737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7410740">if</span>&nbsp;<span class="ident" id="7410743"><a href="/database/sql/sql_test.go.html#7410654">opens</a></span>&nbsp;<span class="op" id="7410749">&lt;</span>&nbsp;<span class="num" id="7410751">9</span>&nbsp;<span class="op" id="7410753">{</span><br>
<span class="lineno">1855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410757"><a href="/database/sql/sql_test.go.html#7409949">t</a></span><span class="op" id="7410758">.</span><span class="ident" id="7410759">Errorf</span><span class="op" id="7410765">(</span><span class="string" id="7410766">&#34;opens&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&gt;=&nbsp;9&#34;</span><span class="op" id="7410789">,</span>&nbsp;<span class="ident" id="7410791"><a href="/database/sql/sql_test.go.html#7410654">opens</a></span><span class="op" id="7410796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7410799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7410802">if</span>&nbsp;<span class="ident" id="7410805"><a href="/database/sql/sql_test.go.html#7410687">closes</a></span>&nbsp;<span class="op" id="7410812">&lt;</span>&nbsp;<span class="num" id="7410814">9</span>&nbsp;<span class="op" id="7410816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410820"><a href="/database/sql/sql_test.go.html#7409949">t</a></span><span class="op" id="7410821">.</span><span class="ident" id="7410822">Errorf</span><span class="op" id="7410828">(</span><span class="string" id="7410829">&#34;closes&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&gt;=&nbsp;9&#34;</span><span class="op" id="7410853">,</span>&nbsp;<span class="ident" id="7410855"><a href="/database/sql/sql_test.go.html#7410687">closes</a></span><span class="op" id="7410861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7410864">}</span><br>
<span class="lineno">1860</span><span class="op" id="7410866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7410869">func</span>&nbsp;<span class="ident" id="7410874">TestConcurrency</span><span class="op" id="7410889">(</span><span class="ident" id="7410890">t</span>&nbsp;<span class="op" id="7410892">*</span><span class="ident" id="7410893"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7410900">.</span><span class="ident" id="7410901">T</span><span class="op" id="7410902">)</span>&nbsp;<span class="op" id="7410904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410907"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7410923">(</span><span class="ident" id="7410924"><a href="/database/sql/sql_test.go.html#7410890">t</a></span><span class="op" id="7410925">,</span>&nbsp;<span class="builtinfunc" id="7410927">new</span><span class="op" id="7410930">(</span><span class="ident" id="7410931"><a href="/database/sql/sql_test.go.html#7403228">concurrentDBQueryTest</a></span><span class="op" id="7410952">)</span><span class="op" id="7410953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7410956"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7410972">(</span><span class="ident" id="7410973"><a href="/database/sql/sql_test.go.html#7410890">t</a></span><span class="op" id="7410974">,</span>&nbsp;<span class="builtinfunc" id="7410976">new</span><span class="op" id="7410979">(</span><span class="ident" id="7410980"><a href="/database/sql/sql_test.go.html#7403662">concurrentDBExecTest</a></span><span class="op" id="7411000">)</span><span class="op" id="7411001">)</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411004"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7411020">(</span><span class="ident" id="7411021"><a href="/database/sql/sql_test.go.html#7410890">t</a></span><span class="op" id="7411022">,</span>&nbsp;<span class="builtinfunc" id="7411024">new</span><span class="op" id="7411027">(</span><span class="ident" id="7411028"><a href="/database/sql/sql_test.go.html#7404066">concurrentStmtQueryTest</a></span><span class="op" id="7411051">)</span><span class="op" id="7411052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411055"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7411071">(</span><span class="ident" id="7411072"><a href="/database/sql/sql_test.go.html#7410890">t</a></span><span class="op" id="7411073">,</span>&nbsp;<span class="builtinfunc" id="7411075">new</span><span class="op" id="7411078">(</span><span class="ident" id="7411079"><a href="/database/sql/sql_test.go.html#7404682">concurrentStmtExecTest</a></span><span class="op" id="7411101">)</span><span class="op" id="7411102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411105"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7411121">(</span><span class="ident" id="7411122"><a href="/database/sql/sql_test.go.html#7410890">t</a></span><span class="op" id="7411123">,</span>&nbsp;<span class="builtinfunc" id="7411125">new</span><span class="op" id="7411128">(</span><span class="ident" id="7411129"><a href="/database/sql/sql_test.go.html#7405264">concurrentTxQueryTest</a></span><span class="op" id="7411150">)</span><span class="op" id="7411151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411154"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7411170">(</span><span class="ident" id="7411171"><a href="/database/sql/sql_test.go.html#7410890">t</a></span><span class="op" id="7411172">,</span>&nbsp;<span class="builtinfunc" id="7411174">new</span><span class="op" id="7411177">(</span><span class="ident" id="7411178"><a href="/database/sql/sql_test.go.html#7405834">concurrentTxExecTest</a></span><span class="op" id="7411198">)</span><span class="op" id="7411199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411202"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7411218">(</span><span class="ident" id="7411219"><a href="/database/sql/sql_test.go.html#7410890">t</a></span><span class="op" id="7411220">,</span>&nbsp;<span class="builtinfunc" id="7411222">new</span><span class="op" id="7411225">(</span><span class="ident" id="7411226"><a href="/database/sql/sql_test.go.html#7406374">concurrentTxStmtQueryTest</a></span><span class="op" id="7411251">)</span><span class="op" id="7411252">)</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411255"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7411271">(</span><span class="ident" id="7411272"><a href="/database/sql/sql_test.go.html#7410890">t</a></span><span class="op" id="7411273">,</span>&nbsp;<span class="builtinfunc" id="7411275">new</span><span class="op" id="7411278">(</span><span class="ident" id="7411279"><a href="/database/sql/sql_test.go.html#7407123">concurrentTxStmtExecTest</a></span><span class="op" id="7411303">)</span><span class="op" id="7411304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411307"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7411323">(</span><span class="ident" id="7411324"><a href="/database/sql/sql_test.go.html#7410890">t</a></span><span class="op" id="7411325">,</span>&nbsp;<span class="builtinfunc" id="7411327">new</span><span class="op" id="7411330">(</span><span class="ident" id="7411331"><a href="/database/sql/sql_test.go.html#7407838">concurrentRandomTest</a></span><span class="op" id="7411351">)</span><span class="op" id="7411352">)</span><br>
<span class="lineno"></span><span class="op" id="7411354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7411357">func</span>&nbsp;<span class="ident" id="7411362">TestConnectionLeak</span><span class="op" id="7411380">(</span><span class="ident" id="7411381">t</span>&nbsp;<span class="op" id="7411383">*</span><span class="ident" id="7411384"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7411391">.</span><span class="ident" id="7411392">T</span><span class="op" id="7411393">)</span>&nbsp;<span class="op" id="7411395">{</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411398">db</span>&nbsp;<span class="op" id="7411401">:=</span>&nbsp;<span class="ident" id="7411404"><a href="/database/sql/sql_test.go.html#7369708">newTestDB</a></span><span class="op" id="7411413">(</span><span class="ident" id="7411414"><a href="/database/sql/sql_test.go.html#7411381">t</a></span><span class="op" id="7411415">,</span>&nbsp;<span class="string" id="7411417">&#34;people&#34;</span><span class="op" id="7411425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7411428">defer</span>&nbsp;<span class="ident" id="7411434"><a href="/database/sql/sql_test.go.html#7370632">closeDB</a></span><span class="op" id="7411441">(</span><span class="ident" id="7411442"><a href="/database/sql/sql_test.go.html#7411381">t</a></span><span class="op" id="7411443">,</span>&nbsp;<span class="ident" id="7411445"><a href="/database/sql/sql_test.go.html#7411398">db</a></span><span class="op" id="7411447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7411450">//&nbsp;Start&nbsp;by&nbsp;opening&nbsp;defaultMaxIdleConns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411491">rows</span>&nbsp;<span class="op" id="7411496">:=</span>&nbsp;<span class="builtinfunc" id="7411499">make</span><span class="op" id="7411503">(</span><span class="op" id="7411504">[</span><span class="op" id="7411505">]</span><span class="op" id="7411506">*</span><span class="ident" id="7411507"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="7411511">,</span>&nbsp;<span class="ident" id="7411513"><a href="/database/sql/sql.go.html#6362327">defaultMaxIdleConns</a></span><span class="op" id="7411532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7411535">//&nbsp;We&nbsp;need&nbsp;to&nbsp;SetMaxOpenConns&nbsp;&gt;&nbsp;MaxIdleConns,&nbsp;so&nbsp;the&nbsp;DB&nbsp;can&nbsp;open</span><br>
<span class="lineno">1880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7411601">//&nbsp;a&nbsp;new&nbsp;connection&nbsp;and&nbsp;we&nbsp;can&nbsp;fill&nbsp;the&nbsp;idle&nbsp;queue&nbsp;with&nbsp;the&nbsp;released</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7411671">//&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411688"><a href="/database/sql/sql_test.go.html#7411398">db</a></span><span class="op" id="7411690">.</span><span class="ident" id="7411691">SetMaxOpenConns</span><span class="op" id="7411706">(</span><span class="builtinfunc" id="7411707">len</span><span class="op" id="7411710">(</span><span class="ident" id="7411711"><a href="/database/sql/sql_test.go.html#7411491">rows</a></span><span class="op" id="7411715">)</span>&nbsp;<span class="op" id="7411717">+</span>&nbsp;<span class="num" id="7411719">1</span><span class="op" id="7411720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7411723">for</span>&nbsp;<span class="ident" id="7411727">ii</span>&nbsp;<span class="op" id="7411730">:=</span>&nbsp;<span class="keyword" id="7411733">range</span>&nbsp;<span class="ident" id="7411739"><a href="/database/sql/sql_test.go.html#7411491">rows</a></span>&nbsp;<span class="op" id="7411744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411748">r</span><span class="op" id="7411749">,</span>&nbsp;<span class="ident" id="7411751">err</span>&nbsp;<span class="op" id="7411755">:=</span>&nbsp;<span class="ident" id="7411758"><a href="/database/sql/sql_test.go.html#7411398">db</a></span><span class="op" id="7411760">.</span><span class="ident" id="7411761">Query</span><span class="op" id="7411766">(</span><span class="string" id="7411767">&#34;SELECT|people|name|&#34;</span><span class="op" id="7411788">)</span><br>
<span class="lineno">1885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7411792">if</span>&nbsp;<span class="ident" id="7411795"><a href="/database/sql/sql_test.go.html#7411751">err</a></span>&nbsp;<span class="op" id="7411799">!=</span>&nbsp;<span class="ident" id="7411802">nil</span>&nbsp;<span class="op" id="7411806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411811"><a href="/database/sql/sql_test.go.html#7411381">t</a></span><span class="op" id="7411812">.</span><span class="ident" id="7411813">Fatal</span><span class="op" id="7411818">(</span><span class="ident" id="7411819"><a href="/database/sql/sql_test.go.html#7411751">err</a></span><span class="op" id="7411822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7411826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411830"><a href="/database/sql/sql_test.go.html#7411748">r</a></span><span class="op" id="7411831">.</span><span class="ident" id="7411832">Next</span><span class="op" id="7411836">(</span><span class="op" id="7411837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7411841">if</span>&nbsp;<span class="ident" id="7411844">err</span>&nbsp;<span class="op" id="7411848">:=</span>&nbsp;<span class="ident" id="7411851"><a href="/database/sql/sql_test.go.html#7411748">r</a></span><span class="op" id="7411852">.</span><span class="ident" id="7411853">Err</span><span class="op" id="7411856">(</span><span class="op" id="7411857">)</span><span class="op" id="7411858">;</span>&nbsp;<span class="ident" id="7411860"><a href="/database/sql/sql_test.go.html#7411844">err</a></span>&nbsp;<span class="op" id="7411864">!=</span>&nbsp;<span class="ident" id="7411867">nil</span>&nbsp;<span class="op" id="7411871">{</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411876"><a href="/database/sql/sql_test.go.html#7411381">t</a></span><span class="op" id="7411877">.</span><span class="ident" id="7411878">Fatal</span><span class="op" id="7411883">(</span><span class="ident" id="7411884"><a href="/database/sql/sql_test.go.html#7411844">err</a></span><span class="op" id="7411887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7411891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7411895"><a href="/database/sql/sql_test.go.html#7411491">rows</a></span><span class="op" id="7411899">[</span><span class="ident" id="7411900"><a href="/database/sql/sql_test.go.html#7411727">ii</a></span><span class="op" id="7411902">]</span>&nbsp;<span class="op" id="7411904">=</span>&nbsp;<span class="ident" id="7411906"><a href="/database/sql/sql_test.go.html#7411748">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7411909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7411912">//&nbsp;Now&nbsp;we&nbsp;have&nbsp;defaultMaxIdleConns&nbsp;busy&nbsp;connections.&nbsp;Open</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7411971">//&nbsp;a&nbsp;new&nbsp;one,&nbsp;but&nbsp;wait&nbsp;until&nbsp;the&nbsp;busy&nbsp;connections&nbsp;are&nbsp;released</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7412035">//&nbsp;before&nbsp;returning&nbsp;control&nbsp;to&nbsp;DB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412071">drv</span>&nbsp;<span class="op" id="7412075">:=</span>&nbsp;<span class="ident" id="7412078"><a href="/database/sql/sql_test.go.html#7411398">db</a></span><span class="op" id="7412080">.</span><span class="ident" id="7412081">driver</span><span class="op" id="7412087">.</span><span class="op" id="7412088">(</span><span class="op" id="7412089">*</span><span class="ident" id="7412090"><a href="/database/sql/fakedb_test.go.html#7349239">fakeDriver</a></span><span class="op" id="7412100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412103"><a href="/database/sql/sql_test.go.html#7412071">drv</a></span><span class="op" id="7412106">.</span><span class="ident" id="7412107">waitCh</span>&nbsp;<span class="op" id="7412114">=</span>&nbsp;<span class="builtinfunc" id="7412116">make</span><span class="op" id="7412120">(</span><span class="keyword" id="7412121">chan</span>&nbsp;<span class="keyword" id="7412126">struct</span><span class="op" id="7412132">{</span><span class="op" id="7412133">}</span><span class="op" id="7412134">,</span>&nbsp;<span class="num" id="7412136">1</span><span class="op" id="7412137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412140"><a href="/database/sql/sql_test.go.html#7412071">drv</a></span><span class="op" id="7412143">.</span><span class="ident" id="7412144">waitingCh</span>&nbsp;<span class="op" id="7412154">=</span>&nbsp;<span class="builtinfunc" id="7412156">make</span><span class="op" id="7412160">(</span><span class="keyword" id="7412161">chan</span>&nbsp;<span class="keyword" id="7412166">struct</span><span class="op" id="7412172">{</span><span class="op" id="7412173">}</span><span class="op" id="7412174">,</span>&nbsp;<span class="num" id="7412176">1</span><span class="op" id="7412177">)</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7412180">var</span>&nbsp;<span class="ident" id="7412184">wg</span>&nbsp;<span class="ident" id="7412187"><a href="/database/sql/sql_test.go.html#7368984">sync</a></span><span class="op" id="7412191">.</span><span class="ident" id="7412192">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412203"><a href="/database/sql/sql_test.go.html#7412184">wg</a></span><span class="op" id="7412205">.</span><span class="ident" id="7412206">Add</span><span class="op" id="7412209">(</span><span class="num" id="7412210">1</span><span class="op" id="7412211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7412214">go</span>&nbsp;<span class="keyword" id="7412217">func</span><span class="op" id="7412221">(</span><span class="op" id="7412222">)</span>&nbsp;<span class="op" id="7412224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412228">r</span><span class="op" id="7412229">,</span>&nbsp;<span class="ident" id="7412231">err</span>&nbsp;<span class="op" id="7412235">:=</span>&nbsp;<span class="ident" id="7412238"><a href="/database/sql/sql_test.go.html#7411398">db</a></span><span class="op" id="7412240">.</span><span class="ident" id="7412241">Query</span><span class="op" id="7412246">(</span><span class="string" id="7412247">&#34;SELECT|people|name|&#34;</span><span class="op" id="7412268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7412272">if</span>&nbsp;<span class="ident" id="7412275"><a href="/database/sql/sql_test.go.html#7412231">err</a></span>&nbsp;<span class="op" id="7412279">!=</span>&nbsp;<span class="ident" id="7412282">nil</span>&nbsp;<span class="op" id="7412286">{</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412291"><a href="/database/sql/sql_test.go.html#7411381">t</a></span><span class="op" id="7412292">.</span><span class="ident" id="7412293">Fatal</span><span class="op" id="7412298">(</span><span class="ident" id="7412299"><a href="/database/sql/sql_test.go.html#7412231">err</a></span><span class="op" id="7412302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7412306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412310"><a href="/database/sql/sql_test.go.html#7412228">r</a></span><span class="op" id="7412311">.</span><span class="ident" id="7412312">Close</span><span class="op" id="7412317">(</span><span class="op" id="7412318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412322"><a href="/database/sql/sql_test.go.html#7412184">wg</a></span><span class="op" id="7412324">.</span><span class="ident" id="7412325">Done</span><span class="op" id="7412329">(</span><span class="op" id="7412330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7412333">}</span><span class="op" id="7412334">(</span><span class="op" id="7412335">)</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7412338">//&nbsp;Wait&nbsp;until&nbsp;the&nbsp;goroutine&nbsp;we&#39;ve&nbsp;just&nbsp;created&nbsp;has&nbsp;started&nbsp;waiting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7412407">&lt;-</span><span class="ident" id="7412409"><a href="/database/sql/sql_test.go.html#7412071">drv</a></span><span class="op" id="7412412">.</span><span class="ident" id="7412413">waitingCh</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7412424">//&nbsp;Now&nbsp;close&nbsp;the&nbsp;busy&nbsp;connections.&nbsp;This&nbsp;provides&nbsp;a&nbsp;connection&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7412491">//&nbsp;the&nbsp;blocked&nbsp;goroutine&nbsp;and&nbsp;then&nbsp;fills&nbsp;up&nbsp;the&nbsp;idle&nbsp;queue.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7412551">for</span>&nbsp;<span class="ident" id="7412555">_</span><span class="op" id="7412556">,</span>&nbsp;<span class="ident" id="7412558">v</span>&nbsp;<span class="op" id="7412560">:=</span>&nbsp;<span class="keyword" id="7412563">range</span>&nbsp;<span class="ident" id="7412569"><a href="/database/sql/sql_test.go.html#7411491">rows</a></span>&nbsp;<span class="op" id="7412574">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412578"><a href="/database/sql/sql_test.go.html#7412558">v</a></span><span class="op" id="7412579">.</span><span class="ident" id="7412580">Close</span><span class="op" id="7412585">(</span><span class="op" id="7412586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7412589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7412592">//&nbsp;At&nbsp;this&nbsp;point&nbsp;we&nbsp;give&nbsp;the&nbsp;new&nbsp;connection&nbsp;to&nbsp;DB.&nbsp;This&nbsp;connection&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7412663">//&nbsp;now&nbsp;useless,&nbsp;since&nbsp;the&nbsp;idle&nbsp;queue&nbsp;is&nbsp;full&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7412734">//&nbsp;requests.&nbsp;DB&nbsp;should&nbsp;deal&nbsp;with&nbsp;this&nbsp;situation&nbsp;without&nbsp;leaking&nbsp;the</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7412803">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412819"><a href="/database/sql/sql_test.go.html#7412071">drv</a></span><span class="op" id="7412822">.</span><span class="ident" id="7412823">waitCh</span>&nbsp;<span class="op" id="7412830">&lt;-</span>&nbsp;<span class="keyword" id="7412833">struct</span><span class="op" id="7412839">{</span><span class="op" id="7412840">}</span><span class="op" id="7412841">{</span><span class="op" id="7412842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412845"><a href="/database/sql/sql_test.go.html#7412184">wg</a></span><span class="op" id="7412847">.</span><span class="ident" id="7412848">Wait</span><span class="op" id="7412852">(</span><span class="op" id="7412853">)</span><br>
<span class="lineno"></span><span class="op" id="7412855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1925</span><span class="keyword" id="7412858">func</span>&nbsp;<span class="ident" id="7412863">BenchmarkConcurrentDBExec</span><span class="op" id="7412888">(</span><span class="ident" id="7412889">b</span>&nbsp;<span class="op" id="7412891">*</span><span class="ident" id="7412892"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7412899">.</span><span class="ident" id="7412900">B</span><span class="op" id="7412901">)</span>&nbsp;<span class="op" id="7412903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412906"><a href="/database/sql/sql_test.go.html#7412889">b</a></span><span class="op" id="7412907">.</span><span class="ident" id="7412908">ReportAllocs</span><span class="op" id="7412920">(</span><span class="op" id="7412921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412924">ct</span>&nbsp;<span class="op" id="7412927">:=</span>&nbsp;<span class="builtinfunc" id="7412930">new</span><span class="op" id="7412933">(</span><span class="ident" id="7412934"><a href="/database/sql/sql_test.go.html#7403662">concurrentDBExecTest</a></span><span class="op" id="7412954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7412957">for</span>&nbsp;<span class="ident" id="7412961">i</span>&nbsp;<span class="op" id="7412963">:=</span>&nbsp;<span class="num" id="7412966">0</span><span class="op" id="7412967">;</span>&nbsp;<span class="ident" id="7412969"><a href="/database/sql/sql_test.go.html#7412961">i</a></span>&nbsp;<span class="op" id="7412971">&lt;</span>&nbsp;<span class="ident" id="7412973"><a href="/database/sql/sql_test.go.html#7412889">b</a></span><span class="op" id="7412974">.</span><span class="ident" id="7412975">N</span><span class="op" id="7412976">;</span>&nbsp;<span class="ident" id="7412978"><a href="/database/sql/sql_test.go.html#7412961">i</a></span><span class="op" id="7412979">++</span>&nbsp;<span class="op" id="7412982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412986"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7413002">(</span><span class="ident" id="7413003"><a href="/database/sql/sql_test.go.html#7412889">b</a></span><span class="op" id="7413004">,</span>&nbsp;<span class="ident" id="7413006"><a href="/database/sql/sql_test.go.html#7412924">ct</a></span><span class="op" id="7413008">)</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7413011">}</span><br>
<span class="lineno"></span><span class="op" id="7413013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7413016">func</span>&nbsp;<span class="ident" id="7413021">BenchmarkConcurrentStmtQuery</span><span class="op" id="7413049">(</span><span class="ident" id="7413050">b</span>&nbsp;<span class="op" id="7413052">*</span><span class="ident" id="7413053"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7413060">.</span><span class="ident" id="7413061">B</span><span class="op" id="7413062">)</span>&nbsp;<span class="op" id="7413064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413067"><a href="/database/sql/sql_test.go.html#7413050">b</a></span><span class="op" id="7413068">.</span><span class="ident" id="7413069">ReportAllocs</span><span class="op" id="7413081">(</span><span class="op" id="7413082">)</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413085">ct</span>&nbsp;<span class="op" id="7413088">:=</span>&nbsp;<span class="builtinfunc" id="7413091">new</span><span class="op" id="7413094">(</span><span class="ident" id="7413095"><a href="/database/sql/sql_test.go.html#7404066">concurrentStmtQueryTest</a></span><span class="op" id="7413118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7413121">for</span>&nbsp;<span class="ident" id="7413125">i</span>&nbsp;<span class="op" id="7413127">:=</span>&nbsp;<span class="num" id="7413130">0</span><span class="op" id="7413131">;</span>&nbsp;<span class="ident" id="7413133"><a href="/database/sql/sql_test.go.html#7413125">i</a></span>&nbsp;<span class="op" id="7413135">&lt;</span>&nbsp;<span class="ident" id="7413137"><a href="/database/sql/sql_test.go.html#7413050">b</a></span><span class="op" id="7413138">.</span><span class="ident" id="7413139">N</span><span class="op" id="7413140">;</span>&nbsp;<span class="ident" id="7413142"><a href="/database/sql/sql_test.go.html#7413125">i</a></span><span class="op" id="7413143">++</span>&nbsp;<span class="op" id="7413146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413150"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7413166">(</span><span class="ident" id="7413167"><a href="/database/sql/sql_test.go.html#7413050">b</a></span><span class="op" id="7413168">,</span>&nbsp;<span class="ident" id="7413170"><a href="/database/sql/sql_test.go.html#7413085">ct</a></span><span class="op" id="7413172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7413175">}</span><br>
<span class="lineno"></span><span class="op" id="7413177">}</span><br>
<span class="lineno">1940</span><br>
<span class="lineno"></span><span class="keyword" id="7413180">func</span>&nbsp;<span class="ident" id="7413185">BenchmarkConcurrentStmtExec</span><span class="op" id="7413212">(</span><span class="ident" id="7413213">b</span>&nbsp;<span class="op" id="7413215">*</span><span class="ident" id="7413216"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7413223">.</span><span class="ident" id="7413224">B</span><span class="op" id="7413225">)</span>&nbsp;<span class="op" id="7413227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413230"><a href="/database/sql/sql_test.go.html#7413213">b</a></span><span class="op" id="7413231">.</span><span class="ident" id="7413232">ReportAllocs</span><span class="op" id="7413244">(</span><span class="op" id="7413245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413248">ct</span>&nbsp;<span class="op" id="7413251">:=</span>&nbsp;<span class="builtinfunc" id="7413254">new</span><span class="op" id="7413257">(</span><span class="ident" id="7413258"><a href="/database/sql/sql_test.go.html#7404682">concurrentStmtExecTest</a></span><span class="op" id="7413280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7413283">for</span>&nbsp;<span class="ident" id="7413287">i</span>&nbsp;<span class="op" id="7413289">:=</span>&nbsp;<span class="num" id="7413292">0</span><span class="op" id="7413293">;</span>&nbsp;<span class="ident" id="7413295"><a href="/database/sql/sql_test.go.html#7413287">i</a></span>&nbsp;<span class="op" id="7413297">&lt;</span>&nbsp;<span class="ident" id="7413299"><a href="/database/sql/sql_test.go.html#7413213">b</a></span><span class="op" id="7413300">.</span><span class="ident" id="7413301">N</span><span class="op" id="7413302">;</span>&nbsp;<span class="ident" id="7413304"><a href="/database/sql/sql_test.go.html#7413287">i</a></span><span class="op" id="7413305">++</span>&nbsp;<span class="op" id="7413308">{</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413312"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7413328">(</span><span class="ident" id="7413329"><a href="/database/sql/sql_test.go.html#7413213">b</a></span><span class="op" id="7413330">,</span>&nbsp;<span class="ident" id="7413332"><a href="/database/sql/sql_test.go.html#7413248">ct</a></span><span class="op" id="7413334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7413337">}</span><br>
<span class="lineno"></span><span class="op" id="7413339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7413342">func</span>&nbsp;<span class="ident" id="7413347">BenchmarkConcurrentTxQuery</span><span class="op" id="7413373">(</span><span class="ident" id="7413374">b</span>&nbsp;<span class="op" id="7413376">*</span><span class="ident" id="7413377"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7413384">.</span><span class="ident" id="7413385">B</span><span class="op" id="7413386">)</span>&nbsp;<span class="op" id="7413388">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413391"><a href="/database/sql/sql_test.go.html#7413374">b</a></span><span class="op" id="7413392">.</span><span class="ident" id="7413393">ReportAllocs</span><span class="op" id="7413405">(</span><span class="op" id="7413406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413409">ct</span>&nbsp;<span class="op" id="7413412">:=</span>&nbsp;<span class="builtinfunc" id="7413415">new</span><span class="op" id="7413418">(</span><span class="ident" id="7413419"><a href="/database/sql/sql_test.go.html#7405264">concurrentTxQueryTest</a></span><span class="op" id="7413440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7413443">for</span>&nbsp;<span class="ident" id="7413447">i</span>&nbsp;<span class="op" id="7413449">:=</span>&nbsp;<span class="num" id="7413452">0</span><span class="op" id="7413453">;</span>&nbsp;<span class="ident" id="7413455"><a href="/database/sql/sql_test.go.html#7413447">i</a></span>&nbsp;<span class="op" id="7413457">&lt;</span>&nbsp;<span class="ident" id="7413459"><a href="/database/sql/sql_test.go.html#7413374">b</a></span><span class="op" id="7413460">.</span><span class="ident" id="7413461">N</span><span class="op" id="7413462">;</span>&nbsp;<span class="ident" id="7413464"><a href="/database/sql/sql_test.go.html#7413447">i</a></span><span class="op" id="7413465">++</span>&nbsp;<span class="op" id="7413468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413472"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7413488">(</span><span class="ident" id="7413489"><a href="/database/sql/sql_test.go.html#7413374">b</a></span><span class="op" id="7413490">,</span>&nbsp;<span class="ident" id="7413492"><a href="/database/sql/sql_test.go.html#7413409">ct</a></span><span class="op" id="7413494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7413497">}</span><br>
<span class="lineno">1955</span><span class="op" id="7413499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7413502">func</span>&nbsp;<span class="ident" id="7413507">BenchmarkConcurrentTxExec</span><span class="op" id="7413532">(</span><span class="ident" id="7413533">b</span>&nbsp;<span class="op" id="7413535">*</span><span class="ident" id="7413536"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7413543">.</span><span class="ident" id="7413544">B</span><span class="op" id="7413545">)</span>&nbsp;<span class="op" id="7413547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413550"><a href="/database/sql/sql_test.go.html#7413533">b</a></span><span class="op" id="7413551">.</span><span class="ident" id="7413552">ReportAllocs</span><span class="op" id="7413564">(</span><span class="op" id="7413565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413568">ct</span>&nbsp;<span class="op" id="7413571">:=</span>&nbsp;<span class="builtinfunc" id="7413574">new</span><span class="op" id="7413577">(</span><span class="ident" id="7413578"><a href="/database/sql/sql_test.go.html#7405834">concurrentTxExecTest</a></span><span class="op" id="7413598">)</span><br>
<span class="lineno">1960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7413601">for</span>&nbsp;<span class="ident" id="7413605">i</span>&nbsp;<span class="op" id="7413607">:=</span>&nbsp;<span class="num" id="7413610">0</span><span class="op" id="7413611">;</span>&nbsp;<span class="ident" id="7413613"><a href="/database/sql/sql_test.go.html#7413605">i</a></span>&nbsp;<span class="op" id="7413615">&lt;</span>&nbsp;<span class="ident" id="7413617"><a href="/database/sql/sql_test.go.html#7413533">b</a></span><span class="op" id="7413618">.</span><span class="ident" id="7413619">N</span><span class="op" id="7413620">;</span>&nbsp;<span class="ident" id="7413622"><a href="/database/sql/sql_test.go.html#7413605">i</a></span><span class="op" id="7413623">++</span>&nbsp;<span class="op" id="7413626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413630"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7413646">(</span><span class="ident" id="7413647"><a href="/database/sql/sql_test.go.html#7413533">b</a></span><span class="op" id="7413648">,</span>&nbsp;<span class="ident" id="7413650"><a href="/database/sql/sql_test.go.html#7413568">ct</a></span><span class="op" id="7413652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7413655">}</span><br>
<span class="lineno"></span><span class="op" id="7413657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1965</span><span class="keyword" id="7413660">func</span>&nbsp;<span class="ident" id="7413665">BenchmarkConcurrentTxStmtQuery</span><span class="op" id="7413695">(</span><span class="ident" id="7413696">b</span>&nbsp;<span class="op" id="7413698">*</span><span class="ident" id="7413699"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7413706">.</span><span class="ident" id="7413707">B</span><span class="op" id="7413708">)</span>&nbsp;<span class="op" id="7413710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413713"><a href="/database/sql/sql_test.go.html#7413696">b</a></span><span class="op" id="7413714">.</span><span class="ident" id="7413715">ReportAllocs</span><span class="op" id="7413727">(</span><span class="op" id="7413728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413731">ct</span>&nbsp;<span class="op" id="7413734">:=</span>&nbsp;<span class="builtinfunc" id="7413737">new</span><span class="op" id="7413740">(</span><span class="ident" id="7413741"><a href="/database/sql/sql_test.go.html#7406374">concurrentTxStmtQueryTest</a></span><span class="op" id="7413766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7413769">for</span>&nbsp;<span class="ident" id="7413773">i</span>&nbsp;<span class="op" id="7413775">:=</span>&nbsp;<span class="num" id="7413778">0</span><span class="op" id="7413779">;</span>&nbsp;<span class="ident" id="7413781"><a href="/database/sql/sql_test.go.html#7413773">i</a></span>&nbsp;<span class="op" id="7413783">&lt;</span>&nbsp;<span class="ident" id="7413785"><a href="/database/sql/sql_test.go.html#7413696">b</a></span><span class="op" id="7413786">.</span><span class="ident" id="7413787">N</span><span class="op" id="7413788">;</span>&nbsp;<span class="ident" id="7413790"><a href="/database/sql/sql_test.go.html#7413773">i</a></span><span class="op" id="7413791">++</span>&nbsp;<span class="op" id="7413794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413798"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7413814">(</span><span class="ident" id="7413815"><a href="/database/sql/sql_test.go.html#7413696">b</a></span><span class="op" id="7413816">,</span>&nbsp;<span class="ident" id="7413818"><a href="/database/sql/sql_test.go.html#7413731">ct</a></span><span class="op" id="7413820">)</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7413823">}</span><br>
<span class="lineno"></span><span class="op" id="7413825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7413828">func</span>&nbsp;<span class="ident" id="7413833">BenchmarkConcurrentTxStmtExec</span><span class="op" id="7413862">(</span><span class="ident" id="7413863">b</span>&nbsp;<span class="op" id="7413865">*</span><span class="ident" id="7413866"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7413873">.</span><span class="ident" id="7413874">B</span><span class="op" id="7413875">)</span>&nbsp;<span class="op" id="7413877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413880"><a href="/database/sql/sql_test.go.html#7413863">b</a></span><span class="op" id="7413881">.</span><span class="ident" id="7413882">ReportAllocs</span><span class="op" id="7413894">(</span><span class="op" id="7413895">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413898">ct</span>&nbsp;<span class="op" id="7413901">:=</span>&nbsp;<span class="builtinfunc" id="7413904">new</span><span class="op" id="7413907">(</span><span class="ident" id="7413908"><a href="/database/sql/sql_test.go.html#7407123">concurrentTxStmtExecTest</a></span><span class="op" id="7413932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7413935">for</span>&nbsp;<span class="ident" id="7413939">i</span>&nbsp;<span class="op" id="7413941">:=</span>&nbsp;<span class="num" id="7413944">0</span><span class="op" id="7413945">;</span>&nbsp;<span class="ident" id="7413947"><a href="/database/sql/sql_test.go.html#7413939">i</a></span>&nbsp;<span class="op" id="7413949">&lt;</span>&nbsp;<span class="ident" id="7413951"><a href="/database/sql/sql_test.go.html#7413863">b</a></span><span class="op" id="7413952">.</span><span class="ident" id="7413953">N</span><span class="op" id="7413954">;</span>&nbsp;<span class="ident" id="7413956"><a href="/database/sql/sql_test.go.html#7413939">i</a></span><span class="op" id="7413957">++</span>&nbsp;<span class="op" id="7413960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413964"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7413980">(</span><span class="ident" id="7413981"><a href="/database/sql/sql_test.go.html#7413863">b</a></span><span class="op" id="7413982">,</span>&nbsp;<span class="ident" id="7413984"><a href="/database/sql/sql_test.go.html#7413898">ct</a></span><span class="op" id="7413986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7413989">}</span><br>
<span class="lineno"></span><span class="op" id="7413991">}</span><br>
<span class="lineno">1980</span><br>
<span class="lineno"></span><span class="keyword" id="7413994">func</span>&nbsp;<span class="ident" id="7413999">BenchmarkConcurrentRandom</span><span class="op" id="7414024">(</span><span class="ident" id="7414025">b</span>&nbsp;<span class="op" id="7414027">*</span><span class="ident" id="7414028"><a href="/database/sql/sql_test.go.html#7368992">testing</a></span><span class="op" id="7414035">.</span><span class="ident" id="7414036">B</span><span class="op" id="7414037">)</span>&nbsp;<span class="op" id="7414039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7414042"><a href="/database/sql/sql_test.go.html#7414025">b</a></span><span class="op" id="7414043">.</span><span class="ident" id="7414044">ReportAllocs</span><span class="op" id="7414056">(</span><span class="op" id="7414057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7414060">ct</span>&nbsp;<span class="op" id="7414063">:=</span>&nbsp;<span class="builtinfunc" id="7414066">new</span><span class="op" id="7414069">(</span><span class="ident" id="7414070"><a href="/database/sql/sql_test.go.html#7407838">concurrentRandomTest</a></span><span class="op" id="7414090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7414093">for</span>&nbsp;<span class="ident" id="7414097">i</span>&nbsp;<span class="op" id="7414099">:=</span>&nbsp;<span class="num" id="7414102">0</span><span class="op" id="7414103">;</span>&nbsp;<span class="ident" id="7414105"><a href="/database/sql/sql_test.go.html#7414097">i</a></span>&nbsp;<span class="op" id="7414107">&lt;</span>&nbsp;<span class="ident" id="7414109"><a href="/database/sql/sql_test.go.html#7414025">b</a></span><span class="op" id="7414110">.</span><span class="ident" id="7414111">N</span><span class="op" id="7414112">;</span>&nbsp;<span class="ident" id="7414114"><a href="/database/sql/sql_test.go.html#7414097">i</a></span><span class="op" id="7414115">++</span>&nbsp;<span class="op" id="7414118">{</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7414122"><a href="/database/sql/sql_test.go.html#7408518">doConcurrentTest</a></span><span class="op" id="7414138">(</span><span class="ident" id="7414139"><a href="/database/sql/sql_test.go.html#7414025">b</a></span><span class="op" id="7414140">,</span>&nbsp;<span class="ident" id="7414142"><a href="/database/sql/sql_test.go.html#7414060">ct</a></span><span class="op" id="7414144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7414147">}</span><br>
<span class="lineno"></span><span class="op" id="7414149">}</span>
</div>
</body>
</html>
