<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6751828">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6751884">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6751938">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6751989">//&nbsp;+build&nbsp;!nacl,!plan9,!windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6752022">package</span>&nbsp;<span class="ident" id="6752030">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6752035">import</span>&nbsp;<span class="op" id="6752042">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6752045">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6752054">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6752060">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6752071">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6752082">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6752093">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6752104">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6752111">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6752114">func</span>&nbsp;<span class="ident" id="6752119">TestReadUnixgramWithUnnamedSocket</span><span class="op" id="6752152">(</span><span class="ident" id="6752153">t</span>&nbsp;<span class="op" id="6752155">*</span><span class="ident" id="6752156">testing</span><span class="op" id="6752163">.</span><span class="ident" id="6752164">T</span><span class="op" id="6752165">)</span>&nbsp;<span class="op" id="6752167">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752170">addr</span>&nbsp;<span class="op" id="6752175">:=</span>&nbsp;<span class="ident" id="6752178">testUnixAddr</span><span class="op" id="6752190">(</span><span class="op" id="6752191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752194">la</span><span class="op" id="6752196">,</span>&nbsp;<span class="ident" id="6752198">err</span>&nbsp;<span class="op" id="6752202">:=</span>&nbsp;<span class="ident" id="6752205">ResolveUnixAddr</span><span class="op" id="6752220">(</span><span class="string" id="6752221">&#34;unixgram&#34;</span><span class="op" id="6752231">,</span>&nbsp;<span class="ident" id="6752233">addr</span><span class="op" id="6752237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752240">if</span>&nbsp;<span class="ident" id="6752243">err</span>&nbsp;<span class="op" id="6752247">!=</span>&nbsp;<span class="ident" id="6752250">nil</span>&nbsp;<span class="op" id="6752254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752258">t</span><span class="op" id="6752259">.</span><span class="ident" id="6752260">Fatalf</span><span class="op" id="6752266">(</span><span class="string" id="6752267">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6752295">,</span>&nbsp;<span class="ident" id="6752297">err</span><span class="op" id="6752300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752303">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752306">c</span><span class="op" id="6752307">,</span>&nbsp;<span class="ident" id="6752309">err</span>&nbsp;<span class="op" id="6752313">:=</span>&nbsp;<span class="ident" id="6752316">ListenUnixgram</span><span class="op" id="6752330">(</span><span class="string" id="6752331">&#34;unixgram&#34;</span><span class="op" id="6752341">,</span>&nbsp;<span class="ident" id="6752343">la</span><span class="op" id="6752345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752348">if</span>&nbsp;<span class="ident" id="6752351">err</span>&nbsp;<span class="op" id="6752355">!=</span>&nbsp;<span class="ident" id="6752358">nil</span>&nbsp;<span class="op" id="6752362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752366">t</span><span class="op" id="6752367">.</span><span class="ident" id="6752368">Fatalf</span><span class="op" id="6752374">(</span><span class="string" id="6752375">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6752402">,</span>&nbsp;<span class="ident" id="6752404">err</span><span class="op" id="6752407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752413">defer</span>&nbsp;<span class="keyword" id="6752419">func</span><span class="op" id="6752423">(</span><span class="op" id="6752424">)</span>&nbsp;<span class="op" id="6752426">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752430">c</span><span class="op" id="6752431">.</span><span class="ident" id="6752432">Close</span><span class="op" id="6752437">(</span><span class="op" id="6752438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752442">os</span><span class="op" id="6752444">.</span><span class="ident" id="6752445">Remove</span><span class="op" id="6752451">(</span><span class="ident" id="6752452">addr</span><span class="op" id="6752456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752459">}</span><span class="op" id="6752460">(</span><span class="op" id="6752461">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752465">off</span>&nbsp;<span class="op" id="6752469">:=</span>&nbsp;<span class="builtinfunc" id="6752472">make</span><span class="op" id="6752476">(</span><span class="keyword" id="6752477">chan</span>&nbsp;<span class="builtintype" id="6752482">bool</span><span class="op" id="6752486">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752489">data</span>&nbsp;<span class="op" id="6752494">:=</span>&nbsp;<span class="op" id="6752497">[</span><span class="num" id="6752498">5</span><span class="op" id="6752499">]</span><span class="builtintype" id="6752500">byte</span><span class="op" id="6752504">{</span><span class="num" id="6752505">1</span><span class="op" id="6752506">,</span>&nbsp;<span class="num" id="6752508">2</span><span class="op" id="6752509">,</span>&nbsp;<span class="num" id="6752511">3</span><span class="op" id="6752512">,</span>&nbsp;<span class="num" id="6752514">4</span><span class="op" id="6752515">,</span>&nbsp;<span class="num" id="6752517">5</span><span class="op" id="6752518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752521">go</span>&nbsp;<span class="keyword" id="6752524">func</span><span class="op" id="6752528">(</span><span class="op" id="6752529">)</span>&nbsp;<span class="op" id="6752531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752535">defer</span>&nbsp;<span class="keyword" id="6752541">func</span><span class="op" id="6752545">(</span><span class="op" id="6752546">)</span>&nbsp;<span class="op" id="6752548">{</span>&nbsp;<span class="ident" id="6752550">off</span>&nbsp;<span class="op" id="6752554">&lt;-</span>&nbsp;<span class="builtintype" id="6752557">true</span>&nbsp;<span class="op" id="6752562">}</span><span class="op" id="6752563">(</span><span class="op" id="6752564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752568">s</span><span class="op" id="6752569">,</span>&nbsp;<span class="ident" id="6752571">err</span>&nbsp;<span class="op" id="6752575">:=</span>&nbsp;<span class="ident" id="6752578">syscall</span><span class="op" id="6752585">.</span><span class="ident" id="6752586">Socket</span><span class="op" id="6752592">(</span><span class="ident" id="6752593">syscall</span><span class="op" id="6752600">.</span><span class="ident" id="6752601">AF_UNIX</span><span class="op" id="6752608">,</span>&nbsp;<span class="ident" id="6752610">syscall</span><span class="op" id="6752617">.</span><span class="ident" id="6752618">SOCK_DGRAM</span><span class="op" id="6752628">,</span>&nbsp;<span class="num" id="6752630">0</span><span class="op" id="6752631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752635">if</span>&nbsp;<span class="ident" id="6752638">err</span>&nbsp;<span class="op" id="6752642">!=</span>&nbsp;<span class="ident" id="6752645">nil</span>&nbsp;<span class="op" id="6752649">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752654">t</span><span class="op" id="6752655">.</span><span class="ident" id="6752656">Errorf</span><span class="op" id="6752662">(</span><span class="string" id="6752663">&#34;syscall.Socket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6752690">,</span>&nbsp;<span class="ident" id="6752692">err</span><span class="op" id="6752695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752700">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752713">defer</span>&nbsp;<span class="ident" id="6752719">syscall</span><span class="op" id="6752726">.</span><span class="ident" id="6752727">Close</span><span class="op" id="6752732">(</span><span class="ident" id="6752733">s</span><span class="op" id="6752734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752738">rsa</span>&nbsp;<span class="op" id="6752742">:=</span>&nbsp;<span class="op" id="6752745">&amp;</span><span class="ident" id="6752746">syscall</span><span class="op" id="6752753">.</span><span class="ident" id="6752754">SockaddrUnix</span><span class="op" id="6752766">{</span><span class="ident" id="6752767">Name</span><span class="op" id="6752771">:</span>&nbsp;<span class="ident" id="6752773">addr</span><span class="op" id="6752777">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752781">if</span>&nbsp;<span class="ident" id="6752784">err</span>&nbsp;<span class="op" id="6752788">:=</span>&nbsp;<span class="ident" id="6752791">syscall</span><span class="op" id="6752798">.</span><span class="ident" id="6752799">Sendto</span><span class="op" id="6752805">(</span><span class="ident" id="6752806">s</span><span class="op" id="6752807">,</span>&nbsp;<span class="ident" id="6752809">data</span><span class="op" id="6752813">[</span><span class="op" id="6752814">:</span><span class="op" id="6752815">]</span><span class="op" id="6752816">,</span>&nbsp;<span class="num" id="6752818">0</span><span class="op" id="6752819">,</span>&nbsp;<span class="ident" id="6752821">rsa</span><span class="op" id="6752824">)</span><span class="op" id="6752825">;</span>&nbsp;<span class="ident" id="6752827">err</span>&nbsp;<span class="op" id="6752831">!=</span>&nbsp;<span class="ident" id="6752834">nil</span>&nbsp;<span class="op" id="6752838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752843">t</span><span class="op" id="6752844">.</span><span class="ident" id="6752845">Errorf</span><span class="op" id="6752851">(</span><span class="string" id="6752852">&#34;syscall.Sendto&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6752879">,</span>&nbsp;<span class="ident" id="6752881">err</span><span class="op" id="6752884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752889">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752901">}</span><span class="op" id="6752902">(</span><span class="op" id="6752903">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752907">&lt;-</span><span class="ident" id="6752909">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752914">b</span>&nbsp;<span class="op" id="6752916">:=</span>&nbsp;<span class="builtinfunc" id="6752919">make</span><span class="op" id="6752923">(</span><span class="op" id="6752924">[</span><span class="op" id="6752925">]</span><span class="builtintype" id="6752926">byte</span><span class="op" id="6752930">,</span>&nbsp;<span class="num" id="6752932">64</span><span class="op" id="6752934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752937">c</span><span class="op" id="6752938">.</span><span class="ident" id="6752939">SetReadDeadline</span><span class="op" id="6752954">(</span><span class="ident" id="6752955">time</span><span class="op" id="6752959">.</span><span class="ident" id="6752960">Now</span><span class="op" id="6752963">(</span><span class="op" id="6752964">)</span><span class="op" id="6752965">.</span><span class="ident" id="6752966">Add</span><span class="op" id="6752969">(</span><span class="num" id="6752970">100</span>&nbsp;<span class="op" id="6752974">*</span>&nbsp;<span class="ident" id="6752976">time</span><span class="op" id="6752980">.</span><span class="ident" id="6752981">Millisecond</span><span class="op" id="6752992">)</span><span class="op" id="6752993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752996">n</span><span class="op" id="6752997">,</span>&nbsp;<span class="ident" id="6752999">from</span><span class="op" id="6753003">,</span>&nbsp;<span class="ident" id="6753005">err</span>&nbsp;<span class="op" id="6753009">:=</span>&nbsp;<span class="ident" id="6753012">c</span><span class="op" id="6753013">.</span><span class="ident" id="6753014">ReadFrom</span><span class="op" id="6753022">(</span><span class="ident" id="6753023">b</span><span class="op" id="6753024">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6753027">if</span>&nbsp;<span class="ident" id="6753030">err</span>&nbsp;<span class="op" id="6753034">!=</span>&nbsp;<span class="ident" id="6753037">nil</span>&nbsp;<span class="op" id="6753041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753045">t</span><span class="op" id="6753046">.</span><span class="ident" id="6753047">Fatalf</span><span class="op" id="6753053">(</span><span class="string" id="6753054">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6753084">,</span>&nbsp;<span class="ident" id="6753086">err</span><span class="op" id="6753089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6753092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6753095">if</span>&nbsp;<span class="ident" id="6753098">from</span>&nbsp;<span class="op" id="6753103">!=</span>&nbsp;<span class="ident" id="6753106">nil</span>&nbsp;<span class="op" id="6753110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753114">t</span><span class="op" id="6753115">.</span><span class="ident" id="6753116">Fatalf</span><span class="op" id="6753122">(</span><span class="string" id="6753123">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="6753147">,</span>&nbsp;<span class="ident" id="6753149">from</span><span class="op" id="6753153">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6753156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6753159">if</span>&nbsp;<span class="op" id="6753162">!</span><span class="ident" id="6753163">bytes</span><span class="op" id="6753168">.</span><span class="ident" id="6753169">Equal</span><span class="op" id="6753174">(</span><span class="ident" id="6753175">b</span><span class="op" id="6753176">[</span><span class="op" id="6753177">:</span><span class="ident" id="6753178">n</span><span class="op" id="6753179">]</span><span class="op" id="6753180">,</span>&nbsp;<span class="ident" id="6753182">data</span><span class="op" id="6753186">[</span><span class="op" id="6753187">:</span><span class="op" id="6753188">]</span><span class="op" id="6753189">)</span>&nbsp;<span class="op" id="6753191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753195">t</span><span class="op" id="6753196">.</span><span class="ident" id="6753197">Fatalf</span><span class="op" id="6753203">(</span><span class="string" id="6753204">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6753221">,</span>&nbsp;<span class="ident" id="6753223">b</span><span class="op" id="6753224">[</span><span class="op" id="6753225">:</span><span class="ident" id="6753226">n</span><span class="op" id="6753227">]</span><span class="op" id="6753228">,</span>&nbsp;<span class="ident" id="6753230">data</span><span class="op" id="6753234">[</span><span class="op" id="6753235">:</span><span class="op" id="6753236">]</span><span class="op" id="6753237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6753240">}</span><br>
<span class="lineno"></span><span class="op" id="6753242">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="6753245">func</span>&nbsp;<span class="ident" id="6753250">TestReadUnixgramWithZeroBytesBuffer</span><span class="op" id="6753285">(</span><span class="ident" id="6753286">t</span>&nbsp;<span class="op" id="6753288">*</span><span class="ident" id="6753289">testing</span><span class="op" id="6753296">.</span><span class="ident" id="6753297">T</span><span class="op" id="6753298">)</span>&nbsp;<span class="op" id="6753300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6753303">//&nbsp;issue&nbsp;4352:&nbsp;Recvfrom&nbsp;failed&nbsp;with&nbsp;&#34;address&nbsp;family&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6753360">//&nbsp;supported&nbsp;by&nbsp;protocol&nbsp;family&#34;&nbsp;if&nbsp;zero-length&nbsp;buffer&nbsp;provided</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753426">addr</span>&nbsp;<span class="op" id="6753431">:=</span>&nbsp;<span class="ident" id="6753434">testUnixAddr</span><span class="op" id="6753446">(</span><span class="op" id="6753447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753450">la</span><span class="op" id="6753452">,</span>&nbsp;<span class="ident" id="6753454">err</span>&nbsp;<span class="op" id="6753458">:=</span>&nbsp;<span class="ident" id="6753461">ResolveUnixAddr</span><span class="op" id="6753476">(</span><span class="string" id="6753477">&#34;unixgram&#34;</span><span class="op" id="6753487">,</span>&nbsp;<span class="ident" id="6753489">addr</span><span class="op" id="6753493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6753496">if</span>&nbsp;<span class="ident" id="6753499">err</span>&nbsp;<span class="op" id="6753503">!=</span>&nbsp;<span class="ident" id="6753506">nil</span>&nbsp;<span class="op" id="6753510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753514">t</span><span class="op" id="6753515">.</span><span class="ident" id="6753516">Fatalf</span><span class="op" id="6753522">(</span><span class="string" id="6753523">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6753551">,</span>&nbsp;<span class="ident" id="6753553">err</span><span class="op" id="6753556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6753559">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753562">c</span><span class="op" id="6753563">,</span>&nbsp;<span class="ident" id="6753565">err</span>&nbsp;<span class="op" id="6753569">:=</span>&nbsp;<span class="ident" id="6753572">ListenUnixgram</span><span class="op" id="6753586">(</span><span class="string" id="6753587">&#34;unixgram&#34;</span><span class="op" id="6753597">,</span>&nbsp;<span class="ident" id="6753599">la</span><span class="op" id="6753601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6753604">if</span>&nbsp;<span class="ident" id="6753607">err</span>&nbsp;<span class="op" id="6753611">!=</span>&nbsp;<span class="ident" id="6753614">nil</span>&nbsp;<span class="op" id="6753618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753622">t</span><span class="op" id="6753623">.</span><span class="ident" id="6753624">Fatalf</span><span class="op" id="6753630">(</span><span class="string" id="6753631">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6753658">,</span>&nbsp;<span class="ident" id="6753660">err</span><span class="op" id="6753663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6753666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6753669">defer</span>&nbsp;<span class="keyword" id="6753675">func</span><span class="op" id="6753679">(</span><span class="op" id="6753680">)</span>&nbsp;<span class="op" id="6753682">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753686">c</span><span class="op" id="6753687">.</span><span class="ident" id="6753688">Close</span><span class="op" id="6753693">(</span><span class="op" id="6753694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753698">os</span><span class="op" id="6753700">.</span><span class="ident" id="6753701">Remove</span><span class="op" id="6753707">(</span><span class="ident" id="6753708">addr</span><span class="op" id="6753712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6753715">}</span><span class="op" id="6753716">(</span><span class="op" id="6753717">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753721">off</span>&nbsp;<span class="op" id="6753725">:=</span>&nbsp;<span class="builtinfunc" id="6753728">make</span><span class="op" id="6753732">(</span><span class="keyword" id="6753733">chan</span>&nbsp;<span class="builtintype" id="6753738">bool</span><span class="op" id="6753742">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6753745">go</span>&nbsp;<span class="keyword" id="6753748">func</span><span class="op" id="6753752">(</span><span class="op" id="6753753">)</span>&nbsp;<span class="op" id="6753755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6753759">defer</span>&nbsp;<span class="keyword" id="6753765">func</span><span class="op" id="6753769">(</span><span class="op" id="6753770">)</span>&nbsp;<span class="op" id="6753772">{</span>&nbsp;<span class="ident" id="6753774">off</span>&nbsp;<span class="op" id="6753778">&lt;-</span>&nbsp;<span class="builtintype" id="6753781">true</span>&nbsp;<span class="op" id="6753786">}</span><span class="op" id="6753787">(</span><span class="op" id="6753788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753792">c</span><span class="op" id="6753793">,</span>&nbsp;<span class="ident" id="6753795">err</span>&nbsp;<span class="op" id="6753799">:=</span>&nbsp;<span class="ident" id="6753802">DialUnix</span><span class="op" id="6753810">(</span><span class="string" id="6753811">&#34;unixgram&#34;</span><span class="op" id="6753821">,</span>&nbsp;<span class="ident" id="6753823">nil</span><span class="op" id="6753826">,</span>&nbsp;<span class="ident" id="6753828">la</span><span class="op" id="6753830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6753834">if</span>&nbsp;<span class="ident" id="6753837">err</span>&nbsp;<span class="op" id="6753841">!=</span>&nbsp;<span class="ident" id="6753844">nil</span>&nbsp;<span class="op" id="6753848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753853">t</span><span class="op" id="6753854">.</span><span class="ident" id="6753855">Errorf</span><span class="op" id="6753861">(</span><span class="string" id="6753862">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6753883">,</span>&nbsp;<span class="ident" id="6753885">err</span><span class="op" id="6753888">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6753893">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6753902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6753906">defer</span>&nbsp;<span class="ident" id="6753912">c</span><span class="op" id="6753913">.</span><span class="ident" id="6753914">Close</span><span class="op" id="6753919">(</span><span class="op" id="6753920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6753924">if</span>&nbsp;<span class="ident" id="6753927">_</span><span class="op" id="6753928">,</span>&nbsp;<span class="ident" id="6753930">err</span>&nbsp;<span class="op" id="6753934">:=</span>&nbsp;<span class="ident" id="6753937">c</span><span class="op" id="6753938">.</span><span class="ident" id="6753939">Write</span><span class="op" id="6753944">(</span><span class="op" id="6753945">[</span><span class="op" id="6753946">]</span><span class="builtintype" id="6753947">byte</span><span class="op" id="6753951">{</span><span class="num" id="6753952">1</span><span class="op" id="6753953">,</span>&nbsp;<span class="num" id="6753955">2</span><span class="op" id="6753956">,</span>&nbsp;<span class="num" id="6753958">3</span><span class="op" id="6753959">,</span>&nbsp;<span class="num" id="6753961">4</span><span class="op" id="6753962">,</span>&nbsp;<span class="num" id="6753964">5</span><span class="op" id="6753965">}</span><span class="op" id="6753966">)</span><span class="op" id="6753967">;</span>&nbsp;<span class="ident" id="6753969">err</span>&nbsp;<span class="op" id="6753973">!=</span>&nbsp;<span class="ident" id="6753976">nil</span>&nbsp;<span class="op" id="6753980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753985">t</span><span class="op" id="6753986">.</span><span class="ident" id="6753987">Errorf</span><span class="op" id="6753993">(</span><span class="string" id="6753994">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6754021">,</span>&nbsp;<span class="ident" id="6754023">err</span><span class="op" id="6754026">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6754031">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6754040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6754043">}</span><span class="op" id="6754044">(</span><span class="op" id="6754045">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6754049">&lt;-</span><span class="ident" id="6754051">off</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6754056">c</span><span class="op" id="6754057">.</span><span class="ident" id="6754058">SetReadDeadline</span><span class="op" id="6754073">(</span><span class="ident" id="6754074">time</span><span class="op" id="6754078">.</span><span class="ident" id="6754079">Now</span><span class="op" id="6754082">(</span><span class="op" id="6754083">)</span><span class="op" id="6754084">.</span><span class="ident" id="6754085">Add</span><span class="op" id="6754088">(</span><span class="num" id="6754089">100</span>&nbsp;<span class="op" id="6754093">*</span>&nbsp;<span class="ident" id="6754095">time</span><span class="op" id="6754099">.</span><span class="ident" id="6754100">Millisecond</span><span class="op" id="6754111">)</span><span class="op" id="6754112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6754115">_</span><span class="op" id="6754116">,</span>&nbsp;<span class="ident" id="6754118">from</span><span class="op" id="6754122">,</span>&nbsp;<span class="ident" id="6754124">err</span>&nbsp;<span class="op" id="6754128">:=</span>&nbsp;<span class="ident" id="6754131">c</span><span class="op" id="6754132">.</span><span class="ident" id="6754133">ReadFrom</span><span class="op" id="6754141">(</span><span class="ident" id="6754142">nil</span><span class="op" id="6754145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6754148">if</span>&nbsp;<span class="ident" id="6754151">err</span>&nbsp;<span class="op" id="6754155">!=</span>&nbsp;<span class="ident" id="6754158">nil</span>&nbsp;<span class="op" id="6754162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6754166">t</span><span class="op" id="6754167">.</span><span class="ident" id="6754168">Fatalf</span><span class="op" id="6754174">(</span><span class="string" id="6754175">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6754205">,</span>&nbsp;<span class="ident" id="6754207">err</span><span class="op" id="6754210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6754213">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6754216">if</span>&nbsp;<span class="ident" id="6754219">from</span>&nbsp;<span class="op" id="6754224">!=</span>&nbsp;<span class="ident" id="6754227">nil</span>&nbsp;<span class="op" id="6754231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6754235">t</span><span class="op" id="6754236">.</span><span class="ident" id="6754237">Fatalf</span><span class="op" id="6754243">(</span><span class="string" id="6754244">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="6754268">,</span>&nbsp;<span class="ident" id="6754270">from</span><span class="op" id="6754274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6754277">}</span><br>
<span class="lineno"></span><span class="op" id="6754279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6754282">func</span>&nbsp;<span class="ident" id="6754287">TestUnixgramAutobind</span><span class="op" id="6754307">(</span><span class="ident" id="6754308">t</span>&nbsp;<span class="op" id="6754310">*</span><span class="ident" id="6754311">testing</span><span class="op" id="6754318">.</span><span class="ident" id="6754319">T</span><span class="op" id="6754320">)</span>&nbsp;<span class="op" id="6754322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6754325">if</span>&nbsp;<span class="ident" id="6754328">runtime</span><span class="op" id="6754335">.</span><span class="ident" id="6754336">GOOS</span>&nbsp;<span class="op" id="6754341">!=</span>&nbsp;<span class="string" id="6754344">&#34;linux&#34;</span>&nbsp;<span class="op" id="6754352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6754356">t</span><span class="op" id="6754357">.</span><span class="ident" id="6754358">Skip</span><span class="op" id="6754362">(</span><span class="string" id="6754363">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="6754397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6754400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6754404">laddr</span>&nbsp;<span class="op" id="6754410">:=</span>&nbsp;<span class="op" id="6754413">&amp;</span><span class="ident" id="6754414">UnixAddr</span><span class="op" id="6754422">{</span><span class="ident" id="6754423">Name</span><span class="op" id="6754427">:</span>&nbsp;<span class="string" id="6754429">&#34;&#34;</span><span class="op" id="6754431">,</span>&nbsp;<span class="ident" id="6754433">Net</span><span class="op" id="6754436">:</span>&nbsp;<span class="string" id="6754438">&#34;unixgram&#34;</span><span class="op" id="6754448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6754451">c1</span><span class="op" id="6754453">,</span>&nbsp;<span class="ident" id="6754455">err</span>&nbsp;<span class="op" id="6754459">:=</span>&nbsp;<span class="ident" id="6754462">ListenUnixgram</span><span class="op" id="6754476">(</span><span class="string" id="6754477">&#34;unixgram&#34;</span><span class="op" id="6754487">,</span>&nbsp;<span class="ident" id="6754489">laddr</span><span class="op" id="6754494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6754497">if</span>&nbsp;<span class="ident" id="6754500">err</span>&nbsp;<span class="op" id="6754504">!=</span>&nbsp;<span class="ident" id="6754507">nil</span>&nbsp;<span class="op" id="6754511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6754515">t</span><span class="op" id="6754516">.</span><span class="ident" id="6754517">Fatalf</span><span class="op" id="6754523">(</span><span class="string" id="6754524">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6754551">,</span>&nbsp;<span class="ident" id="6754553">err</span><span class="op" id="6754556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6754559">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6754562">defer</span>&nbsp;<span class="ident" id="6754568">c1</span><span class="op" id="6754570">.</span><span class="ident" id="6754571">Close</span><span class="op" id="6754576">(</span><span class="op" id="6754577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6754581">//&nbsp;retrieve&nbsp;the&nbsp;autobind&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6754615">autoAddr</span>&nbsp;<span class="op" id="6754624">:=</span>&nbsp;<span class="ident" id="6754627">c1</span><span class="op" id="6754629">.</span><span class="ident" id="6754630">LocalAddr</span><span class="op" id="6754639">(</span><span class="op" id="6754640">)</span><span class="op" id="6754641">.</span><span class="op" id="6754642">(</span><span class="op" id="6754643">*</span><span class="ident" id="6754644">UnixAddr</span><span class="op" id="6754652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6754655">if</span>&nbsp;<span class="builtinfunc" id="6754658">len</span><span class="op" id="6754661">(</span><span class="ident" id="6754662">autoAddr</span><span class="op" id="6754670">.</span><span class="ident" id="6754671">Name</span><span class="op" id="6754675">)</span>&nbsp;<span class="op" id="6754677">&lt;=</span>&nbsp;<span class="num" id="6754680">1</span>&nbsp;<span class="op" id="6754682">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6754686">t</span><span class="op" id="6754687">.</span><span class="ident" id="6754688">Fatalf</span><span class="op" id="6754694">(</span><span class="string" id="6754695">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="6754725">,</span>&nbsp;<span class="ident" id="6754727">autoAddr</span><span class="op" id="6754735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6754738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6754741">if</span>&nbsp;<span class="ident" id="6754744">autoAddr</span><span class="op" id="6754752">.</span><span class="ident" id="6754753">Name</span><span class="op" id="6754757">[</span><span class="num" id="6754758">0</span><span class="op" id="6754759">]</span>&nbsp;<span class="op" id="6754761">!=</span>&nbsp;<span class="string" id="6754764">&#39;@&#39;</span>&nbsp;<span class="op" id="6754768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6754772">t</span><span class="op" id="6754773">.</span><span class="ident" id="6754774">Fatalf</span><span class="op" id="6754780">(</span><span class="string" id="6754781">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="6754811">,</span>&nbsp;<span class="ident" id="6754813">autoAddr</span><span class="op" id="6754821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6754824">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6754828">c2</span><span class="op" id="6754830">,</span>&nbsp;<span class="ident" id="6754832">err</span>&nbsp;<span class="op" id="6754836">:=</span>&nbsp;<span class="ident" id="6754839">DialUnix</span><span class="op" id="6754847">(</span><span class="string" id="6754848">&#34;unixgram&#34;</span><span class="op" id="6754858">,</span>&nbsp;<span class="ident" id="6754860">nil</span><span class="op" id="6754863">,</span>&nbsp;<span class="ident" id="6754865">autoAddr</span><span class="op" id="6754873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6754876">if</span>&nbsp;<span class="ident" id="6754879">err</span>&nbsp;<span class="op" id="6754883">!=</span>&nbsp;<span class="ident" id="6754886">nil</span>&nbsp;<span class="op" id="6754890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6754894">t</span><span class="op" id="6754895">.</span><span class="ident" id="6754896">Fatalf</span><span class="op" id="6754902">(</span><span class="string" id="6754903">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6754924">,</span>&nbsp;<span class="ident" id="6754926">err</span><span class="op" id="6754929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6754932">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6754935">defer</span>&nbsp;<span class="ident" id="6754941">c2</span><span class="op" id="6754943">.</span><span class="ident" id="6754944">Close</span><span class="op" id="6754949">(</span><span class="op" id="6754950">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6754954">if</span>&nbsp;<span class="op" id="6754957">!</span><span class="ident" id="6754958">reflect</span><span class="op" id="6754965">.</span><span class="ident" id="6754966">DeepEqual</span><span class="op" id="6754975">(</span><span class="ident" id="6754976">c1</span><span class="op" id="6754978">.</span><span class="ident" id="6754979">LocalAddr</span><span class="op" id="6754988">(</span><span class="op" id="6754989">)</span><span class="op" id="6754990">,</span>&nbsp;<span class="ident" id="6754992">c2</span><span class="op" id="6754994">.</span><span class="ident" id="6754995">RemoteAddr</span><span class="op" id="6755005">(</span><span class="op" id="6755006">)</span><span class="op" id="6755007">)</span>&nbsp;<span class="op" id="6755009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755013">t</span><span class="op" id="6755014">.</span><span class="ident" id="6755015">Fatalf</span><span class="op" id="6755021">(</span><span class="string" id="6755022">&#34;expected&nbsp;autobind&nbsp;address&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6755060">,</span>&nbsp;<span class="ident" id="6755062">c1</span><span class="op" id="6755064">.</span><span class="ident" id="6755065">LocalAddr</span><span class="op" id="6755074">(</span><span class="op" id="6755075">)</span><span class="op" id="6755076">,</span>&nbsp;<span class="ident" id="6755078">c2</span><span class="op" id="6755080">.</span><span class="ident" id="6755081">RemoteAddr</span><span class="op" id="6755091">(</span><span class="op" id="6755092">)</span><span class="op" id="6755093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6755096">}</span><br>
<span class="lineno">140</span><span class="op" id="6755098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6755101">func</span>&nbsp;<span class="ident" id="6755106">TestUnixAutobindClose</span><span class="op" id="6755127">(</span><span class="ident" id="6755128">t</span>&nbsp;<span class="op" id="6755130">*</span><span class="ident" id="6755131">testing</span><span class="op" id="6755138">.</span><span class="ident" id="6755139">T</span><span class="op" id="6755140">)</span>&nbsp;<span class="op" id="6755142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6755145">if</span>&nbsp;<span class="ident" id="6755148">runtime</span><span class="op" id="6755155">.</span><span class="ident" id="6755156">GOOS</span>&nbsp;<span class="op" id="6755161">!=</span>&nbsp;<span class="string" id="6755164">&#34;linux&#34;</span>&nbsp;<span class="op" id="6755172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755176">t</span><span class="op" id="6755177">.</span><span class="ident" id="6755178">Skip</span><span class="op" id="6755182">(</span><span class="string" id="6755183">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="6755217">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6755220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755223">laddr</span>&nbsp;<span class="op" id="6755229">:=</span>&nbsp;<span class="op" id="6755232">&amp;</span><span class="ident" id="6755233">UnixAddr</span><span class="op" id="6755241">{</span><span class="ident" id="6755242">Name</span><span class="op" id="6755246">:</span>&nbsp;<span class="string" id="6755248">&#34;&#34;</span><span class="op" id="6755250">,</span>&nbsp;<span class="ident" id="6755252">Net</span><span class="op" id="6755255">:</span>&nbsp;<span class="string" id="6755257">&#34;unix&#34;</span><span class="op" id="6755263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755266">ln</span><span class="op" id="6755268">,</span>&nbsp;<span class="ident" id="6755270">err</span>&nbsp;<span class="op" id="6755274">:=</span>&nbsp;<span class="ident" id="6755277">ListenUnix</span><span class="op" id="6755287">(</span><span class="string" id="6755288">&#34;unix&#34;</span><span class="op" id="6755294">,</span>&nbsp;<span class="ident" id="6755296">laddr</span><span class="op" id="6755301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6755304">if</span>&nbsp;<span class="ident" id="6755307">err</span>&nbsp;<span class="op" id="6755311">!=</span>&nbsp;<span class="ident" id="6755314">nil</span>&nbsp;<span class="op" id="6755318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755322">t</span><span class="op" id="6755323">.</span><span class="ident" id="6755324">Fatalf</span><span class="op" id="6755330">(</span><span class="string" id="6755331">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6755354">,</span>&nbsp;<span class="ident" id="6755356">err</span><span class="op" id="6755359">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6755362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755365">ln</span><span class="op" id="6755367">.</span><span class="ident" id="6755368">Close</span><span class="op" id="6755373">(</span><span class="op" id="6755374">)</span><br>
<span class="lineno"></span><span class="op" id="6755376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6755379">func</span>&nbsp;<span class="ident" id="6755384">TestUnixgramWrite</span><span class="op" id="6755401">(</span><span class="ident" id="6755402">t</span>&nbsp;<span class="op" id="6755404">*</span><span class="ident" id="6755405">testing</span><span class="op" id="6755412">.</span><span class="ident" id="6755413">T</span><span class="op" id="6755414">)</span>&nbsp;<span class="op" id="6755416">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755419">addr</span>&nbsp;<span class="op" id="6755424">:=</span>&nbsp;<span class="ident" id="6755427">testUnixAddr</span><span class="op" id="6755439">(</span><span class="op" id="6755440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755443">laddr</span><span class="op" id="6755448">,</span>&nbsp;<span class="ident" id="6755450">err</span>&nbsp;<span class="op" id="6755454">:=</span>&nbsp;<span class="ident" id="6755457">ResolveUnixAddr</span><span class="op" id="6755472">(</span><span class="string" id="6755473">&#34;unixgram&#34;</span><span class="op" id="6755483">,</span>&nbsp;<span class="ident" id="6755485">addr</span><span class="op" id="6755489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6755492">if</span>&nbsp;<span class="ident" id="6755495">err</span>&nbsp;<span class="op" id="6755499">!=</span>&nbsp;<span class="ident" id="6755502">nil</span>&nbsp;<span class="op" id="6755506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755510">t</span><span class="op" id="6755511">.</span><span class="ident" id="6755512">Fatalf</span><span class="op" id="6755518">(</span><span class="string" id="6755519">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6755547">,</span>&nbsp;<span class="ident" id="6755549">err</span><span class="op" id="6755552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6755555">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755558">c</span><span class="op" id="6755559">,</span>&nbsp;<span class="ident" id="6755561">err</span>&nbsp;<span class="op" id="6755565">:=</span>&nbsp;<span class="ident" id="6755568">ListenPacket</span><span class="op" id="6755580">(</span><span class="string" id="6755581">&#34;unixgram&#34;</span><span class="op" id="6755591">,</span>&nbsp;<span class="ident" id="6755593">addr</span><span class="op" id="6755597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6755600">if</span>&nbsp;<span class="ident" id="6755603">err</span>&nbsp;<span class="op" id="6755607">!=</span>&nbsp;<span class="ident" id="6755610">nil</span>&nbsp;<span class="op" id="6755614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755618">t</span><span class="op" id="6755619">.</span><span class="ident" id="6755620">Fatalf</span><span class="op" id="6755626">(</span><span class="string" id="6755627">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6755652">,</span>&nbsp;<span class="ident" id="6755654">err</span><span class="op" id="6755657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6755660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6755663">defer</span>&nbsp;<span class="ident" id="6755669">os</span><span class="op" id="6755671">.</span><span class="ident" id="6755672">Remove</span><span class="op" id="6755678">(</span><span class="ident" id="6755679">addr</span><span class="op" id="6755683">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6755686">defer</span>&nbsp;<span class="ident" id="6755692">c</span><span class="op" id="6755693">.</span><span class="ident" id="6755694">Close</span><span class="op" id="6755699">(</span><span class="op" id="6755700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755704">testUnixgramWriteConn</span><span class="op" id="6755725">(</span><span class="ident" id="6755726">t</span><span class="op" id="6755727">,</span>&nbsp;<span class="ident" id="6755729">laddr</span><span class="op" id="6755734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755737">testUnixgramWritePacketConn</span><span class="op" id="6755764">(</span><span class="ident" id="6755765">t</span><span class="op" id="6755766">,</span>&nbsp;<span class="ident" id="6755768">laddr</span><span class="op" id="6755773">)</span><br>
<span class="lineno"></span><span class="op" id="6755775">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6755778">func</span>&nbsp;<span class="ident" id="6755783">testUnixgramWriteConn</span><span class="op" id="6755804">(</span><span class="ident" id="6755805">t</span>&nbsp;<span class="op" id="6755807">*</span><span class="ident" id="6755808">testing</span><span class="op" id="6755815">.</span><span class="ident" id="6755816">T</span><span class="op" id="6755817">,</span>&nbsp;<span class="ident" id="6755819">raddr</span>&nbsp;<span class="op" id="6755825">*</span><span class="ident" id="6755826">UnixAddr</span><span class="op" id="6755834">)</span>&nbsp;<span class="op" id="6755836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755839">c</span><span class="op" id="6755840">,</span>&nbsp;<span class="ident" id="6755842">err</span>&nbsp;<span class="op" id="6755846">:=</span>&nbsp;<span class="ident" id="6755849">Dial</span><span class="op" id="6755853">(</span><span class="string" id="6755854">&#34;unixgram&#34;</span><span class="op" id="6755864">,</span>&nbsp;<span class="ident" id="6755866">raddr</span><span class="op" id="6755871">.</span><span class="ident" id="6755872">String</span><span class="op" id="6755878">(</span><span class="op" id="6755879">)</span><span class="op" id="6755880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6755883">if</span>&nbsp;<span class="ident" id="6755886">err</span>&nbsp;<span class="op" id="6755890">!=</span>&nbsp;<span class="ident" id="6755893">nil</span>&nbsp;<span class="op" id="6755897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6755901">t</span><span class="op" id="6755902">.</span><span class="ident" id="6755903">Fatalf</span><span class="op" id="6755909">(</span><span class="string" id="6755910">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6755927">,</span>&nbsp;<span class="ident" id="6755929">err</span><span class="op" id="6755932">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6755935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6755938">defer</span>&nbsp;<span class="ident" id="6755944">c</span><span class="op" id="6755945">.</span><span class="ident" id="6755946">Close</span><span class="op" id="6755951">(</span><span class="op" id="6755952">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6755956">if</span>&nbsp;<span class="ident" id="6755959">_</span><span class="op" id="6755960">,</span>&nbsp;<span class="ident" id="6755962">err</span>&nbsp;<span class="op" id="6755966">:=</span>&nbsp;<span class="ident" id="6755969">c</span><span class="op" id="6755970">.</span><span class="op" id="6755971">(</span><span class="op" id="6755972">*</span><span class="ident" id="6755973">UnixConn</span><span class="op" id="6755981">)</span><span class="op" id="6755982">.</span><span class="ident" id="6755983">WriteToUnix</span><span class="op" id="6755994">(</span><span class="op" id="6755995">[</span><span class="op" id="6755996">]</span><span class="builtintype" id="6755997">byte</span><span class="op" id="6756001">(</span><span class="string" id="6756002">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6756035">)</span><span class="op" id="6756036">,</span>&nbsp;<span class="ident" id="6756038">raddr</span><span class="op" id="6756043">)</span><span class="op" id="6756044">;</span>&nbsp;<span class="ident" id="6756046">err</span>&nbsp;<span class="op" id="6756050">==</span>&nbsp;<span class="ident" id="6756053">nil</span>&nbsp;<span class="op" id="6756057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6756061">t</span><span class="op" id="6756062">.</span><span class="ident" id="6756063">Fatal</span><span class="op" id="6756068">(</span><span class="string" id="6756069">&#34;WriteToUnix&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6756094">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756097">}</span>&nbsp;<span class="keyword" id="6756099">else</span>&nbsp;<span class="keyword" id="6756104">if</span>&nbsp;<span class="ident" id="6756107">err</span><span class="op" id="6756110">.</span><span class="op" id="6756111">(</span><span class="op" id="6756112">*</span><span class="ident" id="6756113">OpError</span><span class="op" id="6756120">)</span><span class="op" id="6756121">.</span><span class="ident" id="6756122">Err</span>&nbsp;<span class="op" id="6756126">!=</span>&nbsp;<span class="ident" id="6756129">ErrWriteToConnected</span>&nbsp;<span class="op" id="6756149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6756153">t</span><span class="op" id="6756154">.</span><span class="ident" id="6756155">Fatalf</span><span class="op" id="6756161">(</span><span class="string" id="6756162">&#34;WriteToUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6756214">,</span>&nbsp;<span class="ident" id="6756216">err</span><span class="op" id="6756219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6756225">if</span>&nbsp;<span class="ident" id="6756228">_</span><span class="op" id="6756229">,</span>&nbsp;<span class="ident" id="6756231">err</span>&nbsp;<span class="op" id="6756235">=</span>&nbsp;<span class="ident" id="6756237">c</span><span class="op" id="6756238">.</span><span class="op" id="6756239">(</span><span class="op" id="6756240">*</span><span class="ident" id="6756241">UnixConn</span><span class="op" id="6756249">)</span><span class="op" id="6756250">.</span><span class="ident" id="6756251">WriteTo</span><span class="op" id="6756258">(</span><span class="op" id="6756259">[</span><span class="op" id="6756260">]</span><span class="builtintype" id="6756261">byte</span><span class="op" id="6756265">(</span><span class="string" id="6756266">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6756299">)</span><span class="op" id="6756300">,</span>&nbsp;<span class="ident" id="6756302">raddr</span><span class="op" id="6756307">)</span><span class="op" id="6756308">;</span>&nbsp;<span class="ident" id="6756310">err</span>&nbsp;<span class="op" id="6756314">==</span>&nbsp;<span class="ident" id="6756317">nil</span>&nbsp;<span class="op" id="6756321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6756325">t</span><span class="op" id="6756326">.</span><span class="ident" id="6756327">Fatal</span><span class="op" id="6756332">(</span><span class="string" id="6756333">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6756354">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756357">}</span>&nbsp;<span class="keyword" id="6756359">else</span>&nbsp;<span class="keyword" id="6756364">if</span>&nbsp;<span class="ident" id="6756367">err</span><span class="op" id="6756370">.</span><span class="op" id="6756371">(</span><span class="op" id="6756372">*</span><span class="ident" id="6756373">OpError</span><span class="op" id="6756380">)</span><span class="op" id="6756381">.</span><span class="ident" id="6756382">Err</span>&nbsp;<span class="op" id="6756386">!=</span>&nbsp;<span class="ident" id="6756389">ErrWriteToConnected</span>&nbsp;<span class="op" id="6756409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6756413">t</span><span class="op" id="6756414">.</span><span class="ident" id="6756415">Fatalf</span><span class="op" id="6756421">(</span><span class="string" id="6756422">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6756470">,</span>&nbsp;<span class="ident" id="6756472">err</span><span class="op" id="6756475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6756481">if</span>&nbsp;<span class="ident" id="6756484">_</span><span class="op" id="6756485">,</span>&nbsp;<span class="ident" id="6756487">_</span><span class="op" id="6756488">,</span>&nbsp;<span class="ident" id="6756490">err</span>&nbsp;<span class="op" id="6756494">=</span>&nbsp;<span class="ident" id="6756496">c</span><span class="op" id="6756497">.</span><span class="op" id="6756498">(</span><span class="op" id="6756499">*</span><span class="ident" id="6756500">UnixConn</span><span class="op" id="6756508">)</span><span class="op" id="6756509">.</span><span class="ident" id="6756510">WriteMsgUnix</span><span class="op" id="6756522">(</span><span class="op" id="6756523">[</span><span class="op" id="6756524">]</span><span class="builtintype" id="6756525">byte</span><span class="op" id="6756529">(</span><span class="string" id="6756530">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6756563">)</span><span class="op" id="6756564">,</span>&nbsp;<span class="ident" id="6756566">nil</span><span class="op" id="6756569">,</span>&nbsp;<span class="ident" id="6756571">raddr</span><span class="op" id="6756576">)</span><span class="op" id="6756577">;</span>&nbsp;<span class="ident" id="6756579">err</span>&nbsp;<span class="op" id="6756583">==</span>&nbsp;<span class="ident" id="6756586">nil</span>&nbsp;<span class="op" id="6756590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6756594">t</span><span class="op" id="6756595">.</span><span class="ident" id="6756596">Fatal</span><span class="op" id="6756601">(</span><span class="string" id="6756602">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6756623">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756626">}</span>&nbsp;<span class="keyword" id="6756628">else</span>&nbsp;<span class="keyword" id="6756633">if</span>&nbsp;<span class="ident" id="6756636">err</span><span class="op" id="6756639">.</span><span class="op" id="6756640">(</span><span class="op" id="6756641">*</span><span class="ident" id="6756642">OpError</span><span class="op" id="6756649">)</span><span class="op" id="6756650">.</span><span class="ident" id="6756651">Err</span>&nbsp;<span class="op" id="6756655">!=</span>&nbsp;<span class="ident" id="6756658">ErrWriteToConnected</span>&nbsp;<span class="op" id="6756678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6756682">t</span><span class="op" id="6756683">.</span><span class="ident" id="6756684">Fatalf</span><span class="op" id="6756690">(</span><span class="string" id="6756691">&#34;WriteMsgUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6756744">,</span>&nbsp;<span class="ident" id="6756746">err</span><span class="op" id="6756749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6756755">if</span>&nbsp;<span class="ident" id="6756758">_</span><span class="op" id="6756759">,</span>&nbsp;<span class="ident" id="6756761">err</span>&nbsp;<span class="op" id="6756765">:=</span>&nbsp;<span class="ident" id="6756768">c</span><span class="op" id="6756769">.</span><span class="ident" id="6756770">Write</span><span class="op" id="6756775">(</span><span class="op" id="6756776">[</span><span class="op" id="6756777">]</span><span class="builtintype" id="6756778">byte</span><span class="op" id="6756782">(</span><span class="string" id="6756783">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6756816">)</span><span class="op" id="6756817">)</span><span class="op" id="6756818">;</span>&nbsp;<span class="ident" id="6756820">err</span>&nbsp;<span class="op" id="6756824">!=</span>&nbsp;<span class="ident" id="6756827">nil</span>&nbsp;<span class="op" id="6756831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6756835">t</span><span class="op" id="6756836">.</span><span class="ident" id="6756837">Fatalf</span><span class="op" id="6756843">(</span><span class="string" id="6756844">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6756862">,</span>&nbsp;<span class="ident" id="6756864">err</span><span class="op" id="6756867">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756870">}</span><br>
<span class="lineno"></span><span class="op" id="6756872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6756875">func</span>&nbsp;<span class="ident" id="6756880">testUnixgramWritePacketConn</span><span class="op" id="6756907">(</span><span class="ident" id="6756908">t</span>&nbsp;<span class="op" id="6756910">*</span><span class="ident" id="6756911">testing</span><span class="op" id="6756918">.</span><span class="ident" id="6756919">T</span><span class="op" id="6756920">,</span>&nbsp;<span class="ident" id="6756922">raddr</span>&nbsp;<span class="op" id="6756928">*</span><span class="ident" id="6756929">UnixAddr</span><span class="op" id="6756937">)</span>&nbsp;<span class="op" id="6756939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6756942">addr</span>&nbsp;<span class="op" id="6756947">:=</span>&nbsp;<span class="ident" id="6756950">testUnixAddr</span><span class="op" id="6756962">(</span><span class="op" id="6756963">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6756966">c</span><span class="op" id="6756967">,</span>&nbsp;<span class="ident" id="6756969">err</span>&nbsp;<span class="op" id="6756973">:=</span>&nbsp;<span class="ident" id="6756976">ListenPacket</span><span class="op" id="6756988">(</span><span class="string" id="6756989">&#34;unixgram&#34;</span><span class="op" id="6756999">,</span>&nbsp;<span class="ident" id="6757001">addr</span><span class="op" id="6757005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757008">if</span>&nbsp;<span class="ident" id="6757011">err</span>&nbsp;<span class="op" id="6757015">!=</span>&nbsp;<span class="ident" id="6757018">nil</span>&nbsp;<span class="op" id="6757022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757026">t</span><span class="op" id="6757027">.</span><span class="ident" id="6757028">Fatalf</span><span class="op" id="6757034">(</span><span class="string" id="6757035">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6757060">,</span>&nbsp;<span class="ident" id="6757062">err</span><span class="op" id="6757065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757071">defer</span>&nbsp;<span class="ident" id="6757077">os</span><span class="op" id="6757079">.</span><span class="ident" id="6757080">Remove</span><span class="op" id="6757086">(</span><span class="ident" id="6757087">addr</span><span class="op" id="6757091">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757094">defer</span>&nbsp;<span class="ident" id="6757100">c</span><span class="op" id="6757101">.</span><span class="ident" id="6757102">Close</span><span class="op" id="6757107">(</span><span class="op" id="6757108">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757112">if</span>&nbsp;<span class="ident" id="6757115">_</span><span class="op" id="6757116">,</span>&nbsp;<span class="ident" id="6757118">err</span>&nbsp;<span class="op" id="6757122">:=</span>&nbsp;<span class="ident" id="6757125">c</span><span class="op" id="6757126">.</span><span class="op" id="6757127">(</span><span class="op" id="6757128">*</span><span class="ident" id="6757129">UnixConn</span><span class="op" id="6757137">)</span><span class="op" id="6757138">.</span><span class="ident" id="6757139">WriteToUnix</span><span class="op" id="6757150">(</span><span class="op" id="6757151">[</span><span class="op" id="6757152">]</span><span class="builtintype" id="6757153">byte</span><span class="op" id="6757157">(</span><span class="string" id="6757158">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6757186">)</span><span class="op" id="6757187">,</span>&nbsp;<span class="ident" id="6757189">raddr</span><span class="op" id="6757194">)</span><span class="op" id="6757195">;</span>&nbsp;<span class="ident" id="6757197">err</span>&nbsp;<span class="op" id="6757201">!=</span>&nbsp;<span class="ident" id="6757204">nil</span>&nbsp;<span class="op" id="6757208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757212">t</span><span class="op" id="6757213">.</span><span class="ident" id="6757214">Fatalf</span><span class="op" id="6757220">(</span><span class="string" id="6757221">&#34;WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6757245">,</span>&nbsp;<span class="ident" id="6757247">err</span><span class="op" id="6757250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757253">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757256">if</span>&nbsp;<span class="ident" id="6757259">_</span><span class="op" id="6757260">,</span>&nbsp;<span class="ident" id="6757262">err</span>&nbsp;<span class="op" id="6757266">:=</span>&nbsp;<span class="ident" id="6757269">c</span><span class="op" id="6757270">.</span><span class="ident" id="6757271">WriteTo</span><span class="op" id="6757278">(</span><span class="op" id="6757279">[</span><span class="op" id="6757280">]</span><span class="builtintype" id="6757281">byte</span><span class="op" id="6757285">(</span><span class="string" id="6757286">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6757314">)</span><span class="op" id="6757315">,</span>&nbsp;<span class="ident" id="6757317">raddr</span><span class="op" id="6757322">)</span><span class="op" id="6757323">;</span>&nbsp;<span class="ident" id="6757325">err</span>&nbsp;<span class="op" id="6757329">!=</span>&nbsp;<span class="ident" id="6757332">nil</span>&nbsp;<span class="op" id="6757336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757340">t</span><span class="op" id="6757341">.</span><span class="ident" id="6757342">Fatalf</span><span class="op" id="6757348">(</span><span class="string" id="6757349">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6757369">,</span>&nbsp;<span class="ident" id="6757371">err</span><span class="op" id="6757374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757380">if</span>&nbsp;<span class="ident" id="6757383">_</span><span class="op" id="6757384">,</span>&nbsp;<span class="ident" id="6757386">_</span><span class="op" id="6757387">,</span>&nbsp;<span class="ident" id="6757389">err</span>&nbsp;<span class="op" id="6757393">:=</span>&nbsp;<span class="ident" id="6757396">c</span><span class="op" id="6757397">.</span><span class="op" id="6757398">(</span><span class="op" id="6757399">*</span><span class="ident" id="6757400">UnixConn</span><span class="op" id="6757408">)</span><span class="op" id="6757409">.</span><span class="ident" id="6757410">WriteMsgUnix</span><span class="op" id="6757422">(</span><span class="op" id="6757423">[</span><span class="op" id="6757424">]</span><span class="builtintype" id="6757425">byte</span><span class="op" id="6757429">(</span><span class="string" id="6757430">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6757458">)</span><span class="op" id="6757459">,</span>&nbsp;<span class="ident" id="6757461">nil</span><span class="op" id="6757464">,</span>&nbsp;<span class="ident" id="6757466">raddr</span><span class="op" id="6757471">)</span><span class="op" id="6757472">;</span>&nbsp;<span class="ident" id="6757474">err</span>&nbsp;<span class="op" id="6757478">!=</span>&nbsp;<span class="ident" id="6757481">nil</span>&nbsp;<span class="op" id="6757485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757489">t</span><span class="op" id="6757490">.</span><span class="ident" id="6757491">Fatalf</span><span class="op" id="6757497">(</span><span class="string" id="6757498">&#34;WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6757523">,</span>&nbsp;<span class="ident" id="6757525">err</span><span class="op" id="6757528">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757534">if</span>&nbsp;<span class="ident" id="6757537">_</span><span class="op" id="6757538">,</span>&nbsp;<span class="ident" id="6757540">err</span>&nbsp;<span class="op" id="6757544">:=</span>&nbsp;<span class="ident" id="6757547">c</span><span class="op" id="6757548">.</span><span class="op" id="6757549">(</span><span class="op" id="6757550">*</span><span class="ident" id="6757551">UnixConn</span><span class="op" id="6757559">)</span><span class="op" id="6757560">.</span><span class="ident" id="6757561">Write</span><span class="op" id="6757566">(</span><span class="op" id="6757567">[</span><span class="op" id="6757568">]</span><span class="builtintype" id="6757569">byte</span><span class="op" id="6757573">(</span><span class="string" id="6757574">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6757602">)</span><span class="op" id="6757603">)</span><span class="op" id="6757604">;</span>&nbsp;<span class="ident" id="6757606">err</span>&nbsp;<span class="op" id="6757610">==</span>&nbsp;<span class="ident" id="6757613">nil</span>&nbsp;<span class="op" id="6757617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757621">t</span><span class="op" id="6757622">.</span><span class="ident" id="6757623">Fatal</span><span class="op" id="6757628">(</span><span class="string" id="6757629">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6757648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757651">}</span><br>
<span class="lineno"></span><span class="op" id="6757653">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="6757656">func</span>&nbsp;<span class="ident" id="6757661">TestUnixConnLocalAndRemoteNames</span><span class="op" id="6757692">(</span><span class="ident" id="6757693">t</span>&nbsp;<span class="op" id="6757695">*</span><span class="ident" id="6757696">testing</span><span class="op" id="6757703">.</span><span class="ident" id="6757704">T</span><span class="op" id="6757705">)</span>&nbsp;<span class="op" id="6757707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757710">for</span>&nbsp;<span class="ident" id="6757714">_</span><span class="op" id="6757715">,</span>&nbsp;<span class="ident" id="6757717">laddr</span>&nbsp;<span class="op" id="6757723">:=</span>&nbsp;<span class="keyword" id="6757726">range</span>&nbsp;<span class="op" id="6757732">[</span><span class="op" id="6757733">]</span><span class="builtintype" id="6757734">string</span><span class="op" id="6757740">{</span><span class="string" id="6757741">&#34;&#34;</span><span class="op" id="6757743">,</span>&nbsp;<span class="ident" id="6757745">testUnixAddr</span><span class="op" id="6757757">(</span><span class="op" id="6757758">)</span><span class="op" id="6757759">}</span>&nbsp;<span class="op" id="6757761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757765">laddr</span>&nbsp;<span class="op" id="6757771">:=</span>&nbsp;<span class="ident" id="6757774">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757782">taddr</span>&nbsp;<span class="op" id="6757788">:=</span>&nbsp;<span class="ident" id="6757791">testUnixAddr</span><span class="op" id="6757803">(</span><span class="op" id="6757804">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757808">ta</span><span class="op" id="6757810">,</span>&nbsp;<span class="ident" id="6757812">err</span>&nbsp;<span class="op" id="6757816">:=</span>&nbsp;<span class="ident" id="6757819">ResolveUnixAddr</span><span class="op" id="6757834">(</span><span class="string" id="6757835">&#34;unix&#34;</span><span class="op" id="6757841">,</span>&nbsp;<span class="ident" id="6757843">taddr</span><span class="op" id="6757848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757852">if</span>&nbsp;<span class="ident" id="6757855">err</span>&nbsp;<span class="op" id="6757859">!=</span>&nbsp;<span class="ident" id="6757862">nil</span>&nbsp;<span class="op" id="6757866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757871">t</span><span class="op" id="6757872">.</span><span class="ident" id="6757873">Fatalf</span><span class="op" id="6757879">(</span><span class="string" id="6757880">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6757908">,</span>&nbsp;<span class="ident" id="6757910">err</span><span class="op" id="6757913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757921">ln</span><span class="op" id="6757923">,</span>&nbsp;<span class="ident" id="6757925">err</span>&nbsp;<span class="op" id="6757929">:=</span>&nbsp;<span class="ident" id="6757932">ListenUnix</span><span class="op" id="6757942">(</span><span class="string" id="6757943">&#34;unix&#34;</span><span class="op" id="6757949">,</span>&nbsp;<span class="ident" id="6757951">ta</span><span class="op" id="6757953">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757957">if</span>&nbsp;<span class="ident" id="6757960">err</span>&nbsp;<span class="op" id="6757964">!=</span>&nbsp;<span class="ident" id="6757967">nil</span>&nbsp;<span class="op" id="6757971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757976">t</span><span class="op" id="6757977">.</span><span class="ident" id="6757978">Fatalf</span><span class="op" id="6757984">(</span><span class="string" id="6757985">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6758008">,</span>&nbsp;<span class="ident" id="6758010">err</span><span class="op" id="6758013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758021">defer</span>&nbsp;<span class="keyword" id="6758027">func</span><span class="op" id="6758031">(</span><span class="op" id="6758032">)</span>&nbsp;<span class="op" id="6758034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758039">ln</span><span class="op" id="6758041">.</span><span class="ident" id="6758042">Close</span><span class="op" id="6758047">(</span><span class="op" id="6758048">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758053">os</span><span class="op" id="6758055">.</span><span class="ident" id="6758056">Remove</span><span class="op" id="6758062">(</span><span class="ident" id="6758063">taddr</span><span class="op" id="6758068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758072">}</span><span class="op" id="6758073">(</span><span class="op" id="6758074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758079">done</span>&nbsp;<span class="op" id="6758084">:=</span>&nbsp;<span class="builtinfunc" id="6758087">make</span><span class="op" id="6758091">(</span><span class="keyword" id="6758092">chan</span>&nbsp;<span class="builtintype" id="6758097">int</span><span class="op" id="6758100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758104">go</span>&nbsp;<span class="ident" id="6758107">transponder</span><span class="op" id="6758118">(</span><span class="ident" id="6758119">t</span><span class="op" id="6758120">,</span>&nbsp;<span class="ident" id="6758122">ln</span><span class="op" id="6758124">,</span>&nbsp;<span class="ident" id="6758126">done</span><span class="op" id="6758130">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758135">la</span><span class="op" id="6758137">,</span>&nbsp;<span class="ident" id="6758139">err</span>&nbsp;<span class="op" id="6758143">:=</span>&nbsp;<span class="ident" id="6758146">ResolveUnixAddr</span><span class="op" id="6758161">(</span><span class="string" id="6758162">&#34;unix&#34;</span><span class="op" id="6758168">,</span>&nbsp;<span class="ident" id="6758170">laddr</span><span class="op" id="6758175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758179">if</span>&nbsp;<span class="ident" id="6758182">err</span>&nbsp;<span class="op" id="6758186">!=</span>&nbsp;<span class="ident" id="6758189">nil</span>&nbsp;<span class="op" id="6758193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758198">t</span><span class="op" id="6758199">.</span><span class="ident" id="6758200">Fatalf</span><span class="op" id="6758206">(</span><span class="string" id="6758207">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6758235">,</span>&nbsp;<span class="ident" id="6758237">err</span><span class="op" id="6758240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758244">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758248">c</span><span class="op" id="6758249">,</span>&nbsp;<span class="ident" id="6758251">err</span>&nbsp;<span class="op" id="6758255">:=</span>&nbsp;<span class="ident" id="6758258">DialUnix</span><span class="op" id="6758266">(</span><span class="string" id="6758267">&#34;unix&#34;</span><span class="op" id="6758273">,</span>&nbsp;<span class="ident" id="6758275">la</span><span class="op" id="6758277">,</span>&nbsp;<span class="ident" id="6758279">ta</span><span class="op" id="6758281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758285">if</span>&nbsp;<span class="ident" id="6758288">err</span>&nbsp;<span class="op" id="6758292">!=</span>&nbsp;<span class="ident" id="6758295">nil</span>&nbsp;<span class="op" id="6758299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758304">t</span><span class="op" id="6758305">.</span><span class="ident" id="6758306">Fatalf</span><span class="op" id="6758312">(</span><span class="string" id="6758313">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6758334">,</span>&nbsp;<span class="ident" id="6758336">err</span><span class="op" id="6758339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758347">defer</span>&nbsp;<span class="keyword" id="6758353">func</span><span class="op" id="6758357">(</span><span class="op" id="6758358">)</span>&nbsp;<span class="op" id="6758360">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758365">c</span><span class="op" id="6758366">.</span><span class="ident" id="6758367">Close</span><span class="op" id="6758372">(</span><span class="op" id="6758373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758378">if</span>&nbsp;<span class="ident" id="6758381">la</span>&nbsp;<span class="op" id="6758384">!=</span>&nbsp;<span class="ident" id="6758387">nil</span>&nbsp;<span class="op" id="6758391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758397">defer</span>&nbsp;<span class="ident" id="6758403">os</span><span class="op" id="6758405">.</span><span class="ident" id="6758406">Remove</span><span class="op" id="6758412">(</span><span class="ident" id="6758413">laddr</span><span class="op" id="6758418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758427">}</span><span class="op" id="6758428">(</span><span class="op" id="6758429">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758433">if</span>&nbsp;<span class="ident" id="6758436">_</span><span class="op" id="6758437">,</span>&nbsp;<span class="ident" id="6758439">err</span>&nbsp;<span class="op" id="6758443">:=</span>&nbsp;<span class="ident" id="6758446">c</span><span class="op" id="6758447">.</span><span class="ident" id="6758448">Write</span><span class="op" id="6758453">(</span><span class="op" id="6758454">[</span><span class="op" id="6758455">]</span><span class="builtintype" id="6758456">byte</span><span class="op" id="6758460">(</span><span class="string" id="6758461">&#34;UNIXCONN&nbsp;LOCAL&nbsp;AND&nbsp;REMOTE&nbsp;NAME&nbsp;TEST&#34;</span><span class="op" id="6758498">)</span><span class="op" id="6758499">)</span><span class="op" id="6758500">;</span>&nbsp;<span class="ident" id="6758502">err</span>&nbsp;<span class="op" id="6758506">!=</span>&nbsp;<span class="ident" id="6758509">nil</span>&nbsp;<span class="op" id="6758513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758518">t</span><span class="op" id="6758519">.</span><span class="ident" id="6758520">Fatalf</span><span class="op" id="6758526">(</span><span class="string" id="6758527">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6758554">,</span>&nbsp;<span class="ident" id="6758556">err</span><span class="op" id="6758559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758568">switch</span>&nbsp;<span class="ident" id="6758575">runtime</span><span class="op" id="6758582">.</span><span class="ident" id="6758583">GOOS</span>&nbsp;<span class="op" id="6758588">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758592">case</span>&nbsp;<span class="string" id="6758597">&#34;android&#34;</span><span class="op" id="6758606">,</span>&nbsp;<span class="string" id="6758608">&#34;linux&#34;</span><span class="op" id="6758615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758620">if</span>&nbsp;<span class="ident" id="6758623">laddr</span>&nbsp;<span class="op" id="6758629">==</span>&nbsp;<span class="string" id="6758632">&#34;&#34;</span>&nbsp;<span class="op" id="6758635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758641">laddr</span>&nbsp;<span class="op" id="6758647">=</span>&nbsp;<span class="string" id="6758649">&#34;@&#34;</span>&nbsp;<span class="comment" id="6758653">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758680">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758684">var</span>&nbsp;<span class="ident" id="6758688">connAddrs</span>&nbsp;<span class="op" id="6758698">=</span>&nbsp;<span class="op" id="6758700">[</span><span class="num" id="6758701">3</span><span class="op" id="6758702">]</span><span class="keyword" id="6758703">struct</span><span class="op" id="6758709">{</span>&nbsp;<span class="ident" id="6758711">got</span><span class="op" id="6758714">,</span>&nbsp;<span class="ident" id="6758716">want</span>&nbsp;<span class="ident" id="6758721">Addr</span>&nbsp;<span class="op" id="6758726">}</span><span class="op" id="6758727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758732">{</span><span class="ident" id="6758733">ln</span><span class="op" id="6758735">.</span><span class="ident" id="6758736">Addr</span><span class="op" id="6758740">(</span><span class="op" id="6758741">)</span><span class="op" id="6758742">,</span>&nbsp;<span class="ident" id="6758744">ta</span><span class="op" id="6758746">}</span><span class="op" id="6758747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758752">{</span><span class="ident" id="6758753">c</span><span class="op" id="6758754">.</span><span class="ident" id="6758755">LocalAddr</span><span class="op" id="6758764">(</span><span class="op" id="6758765">)</span><span class="op" id="6758766">,</span>&nbsp;<span class="op" id="6758768">&amp;</span><span class="ident" id="6758769">UnixAddr</span><span class="op" id="6758777">{</span><span class="ident" id="6758778">Name</span><span class="op" id="6758782">:</span>&nbsp;<span class="ident" id="6758784">laddr</span><span class="op" id="6758789">,</span>&nbsp;<span class="ident" id="6758791">Net</span><span class="op" id="6758794">:</span>&nbsp;<span class="string" id="6758796">&#34;unix&#34;</span><span class="op" id="6758802">}</span><span class="op" id="6758803">}</span><span class="op" id="6758804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758809">{</span><span class="ident" id="6758810">c</span><span class="op" id="6758811">.</span><span class="ident" id="6758812">RemoteAddr</span><span class="op" id="6758822">(</span><span class="op" id="6758823">)</span><span class="op" id="6758824">,</span>&nbsp;<span class="ident" id="6758826">ta</span><span class="op" id="6758828">}</span><span class="op" id="6758829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758833">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758837">for</span>&nbsp;<span class="ident" id="6758841">_</span><span class="op" id="6758842">,</span>&nbsp;<span class="ident" id="6758844">ca</span>&nbsp;<span class="op" id="6758847">:=</span>&nbsp;<span class="keyword" id="6758850">range</span>&nbsp;<span class="ident" id="6758856">connAddrs</span>&nbsp;<span class="op" id="6758866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758871">if</span>&nbsp;<span class="op" id="6758874">!</span><span class="ident" id="6758875">reflect</span><span class="op" id="6758882">.</span><span class="ident" id="6758883">DeepEqual</span><span class="op" id="6758892">(</span><span class="ident" id="6758893">ca</span><span class="op" id="6758895">.</span><span class="ident" id="6758896">got</span><span class="op" id="6758899">,</span>&nbsp;<span class="ident" id="6758901">ca</span><span class="op" id="6758903">.</span><span class="ident" id="6758904">want</span><span class="op" id="6758908">)</span>&nbsp;<span class="op" id="6758910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758916">t</span><span class="op" id="6758917">.</span><span class="ident" id="6758918">Fatalf</span><span class="op" id="6758924">(</span><span class="string" id="6758925">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6758948">,</span>&nbsp;<span class="ident" id="6758950">ca</span><span class="op" id="6758952">.</span><span class="ident" id="6758953">got</span><span class="op" id="6758956">,</span>&nbsp;<span class="ident" id="6758958">ca</span><span class="op" id="6758960">.</span><span class="ident" id="6758961">want</span><span class="op" id="6758965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758974">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758979">&lt;-</span><span class="ident" id="6758981">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758987">}</span><br>
<span class="lineno"></span><span class="op" id="6758989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6758992">func</span>&nbsp;<span class="ident" id="6758997">TestUnixgramConnLocalAndRemoteNames</span><span class="op" id="6759032">(</span><span class="ident" id="6759033">t</span>&nbsp;<span class="op" id="6759035">*</span><span class="ident" id="6759036">testing</span><span class="op" id="6759043">.</span><span class="ident" id="6759044">T</span><span class="op" id="6759045">)</span>&nbsp;<span class="op" id="6759047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759050">for</span>&nbsp;<span class="ident" id="6759054">_</span><span class="op" id="6759055">,</span>&nbsp;<span class="ident" id="6759057">laddr</span>&nbsp;<span class="op" id="6759063">:=</span>&nbsp;<span class="keyword" id="6759066">range</span>&nbsp;<span class="op" id="6759072">[</span><span class="op" id="6759073">]</span><span class="builtintype" id="6759074">string</span><span class="op" id="6759080">{</span><span class="string" id="6759081">&#34;&#34;</span><span class="op" id="6759083">,</span>&nbsp;<span class="ident" id="6759085">testUnixAddr</span><span class="op" id="6759097">(</span><span class="op" id="6759098">)</span><span class="op" id="6759099">}</span>&nbsp;<span class="op" id="6759101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759105">laddr</span>&nbsp;<span class="op" id="6759111">:=</span>&nbsp;<span class="ident" id="6759114">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759122">taddr</span>&nbsp;<span class="op" id="6759128">:=</span>&nbsp;<span class="ident" id="6759131">testUnixAddr</span><span class="op" id="6759143">(</span><span class="op" id="6759144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759148">ta</span><span class="op" id="6759150">,</span>&nbsp;<span class="ident" id="6759152">err</span>&nbsp;<span class="op" id="6759156">:=</span>&nbsp;<span class="ident" id="6759159">ResolveUnixAddr</span><span class="op" id="6759174">(</span><span class="string" id="6759175">&#34;unixgram&#34;</span><span class="op" id="6759185">,</span>&nbsp;<span class="ident" id="6759187">taddr</span><span class="op" id="6759192">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759196">if</span>&nbsp;<span class="ident" id="6759199">err</span>&nbsp;<span class="op" id="6759203">!=</span>&nbsp;<span class="ident" id="6759206">nil</span>&nbsp;<span class="op" id="6759210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759215">t</span><span class="op" id="6759216">.</span><span class="ident" id="6759217">Fatalf</span><span class="op" id="6759223">(</span><span class="string" id="6759224">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6759252">,</span>&nbsp;<span class="ident" id="6759254">err</span><span class="op" id="6759257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759265">c1</span><span class="op" id="6759267">,</span>&nbsp;<span class="ident" id="6759269">err</span>&nbsp;<span class="op" id="6759273">:=</span>&nbsp;<span class="ident" id="6759276">ListenUnixgram</span><span class="op" id="6759290">(</span><span class="string" id="6759291">&#34;unixgram&#34;</span><span class="op" id="6759301">,</span>&nbsp;<span class="ident" id="6759303">ta</span><span class="op" id="6759305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759309">if</span>&nbsp;<span class="ident" id="6759312">err</span>&nbsp;<span class="op" id="6759316">!=</span>&nbsp;<span class="ident" id="6759319">nil</span>&nbsp;<span class="op" id="6759323">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759328">t</span><span class="op" id="6759329">.</span><span class="ident" id="6759330">Fatalf</span><span class="op" id="6759336">(</span><span class="string" id="6759337">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6759364">,</span>&nbsp;<span class="ident" id="6759366">err</span><span class="op" id="6759369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759377">defer</span>&nbsp;<span class="keyword" id="6759383">func</span><span class="op" id="6759387">(</span><span class="op" id="6759388">)</span>&nbsp;<span class="op" id="6759390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759395">c1</span><span class="op" id="6759397">.</span><span class="ident" id="6759398">Close</span><span class="op" id="6759403">(</span><span class="op" id="6759404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759409">os</span><span class="op" id="6759411">.</span><span class="ident" id="6759412">Remove</span><span class="op" id="6759418">(</span><span class="ident" id="6759419">taddr</span><span class="op" id="6759424">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759428">}</span><span class="op" id="6759429">(</span><span class="op" id="6759430">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759435">var</span>&nbsp;<span class="ident" id="6759439">la</span>&nbsp;<span class="op" id="6759442">*</span><span class="ident" id="6759443">UnixAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759454">if</span>&nbsp;<span class="ident" id="6759457">laddr</span>&nbsp;<span class="op" id="6759463">!=</span>&nbsp;<span class="string" id="6759466">&#34;&#34;</span>&nbsp;<span class="op" id="6759469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759474">if</span>&nbsp;<span class="ident" id="6759477">la</span><span class="op" id="6759479">,</span>&nbsp;<span class="ident" id="6759481">err</span>&nbsp;<span class="op" id="6759485">=</span>&nbsp;<span class="ident" id="6759487">ResolveUnixAddr</span><span class="op" id="6759502">(</span><span class="string" id="6759503">&#34;unixgram&#34;</span><span class="op" id="6759513">,</span>&nbsp;<span class="ident" id="6759515">laddr</span><span class="op" id="6759520">)</span><span class="op" id="6759521">;</span>&nbsp;<span class="ident" id="6759523">err</span>&nbsp;<span class="op" id="6759527">!=</span>&nbsp;<span class="ident" id="6759530">nil</span>&nbsp;<span class="op" id="6759534">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759540">t</span><span class="op" id="6759541">.</span><span class="ident" id="6759542">Fatalf</span><span class="op" id="6759548">(</span><span class="string" id="6759549">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6759577">,</span>&nbsp;<span class="ident" id="6759579">err</span><span class="op" id="6759582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759595">c2</span><span class="op" id="6759597">,</span>&nbsp;<span class="ident" id="6759599">err</span>&nbsp;<span class="op" id="6759603">:=</span>&nbsp;<span class="ident" id="6759606">DialUnix</span><span class="op" id="6759614">(</span><span class="string" id="6759615">&#34;unixgram&#34;</span><span class="op" id="6759625">,</span>&nbsp;<span class="ident" id="6759627">la</span><span class="op" id="6759629">,</span>&nbsp;<span class="ident" id="6759631">ta</span><span class="op" id="6759633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759637">if</span>&nbsp;<span class="ident" id="6759640">err</span>&nbsp;<span class="op" id="6759644">!=</span>&nbsp;<span class="ident" id="6759647">nil</span>&nbsp;<span class="op" id="6759651">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759656">t</span><span class="op" id="6759657">.</span><span class="ident" id="6759658">Fatalf</span><span class="op" id="6759664">(</span><span class="string" id="6759665">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6759686">,</span>&nbsp;<span class="ident" id="6759688">err</span><span class="op" id="6759691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759699">defer</span>&nbsp;<span class="keyword" id="6759705">func</span><span class="op" id="6759709">(</span><span class="op" id="6759710">)</span>&nbsp;<span class="op" id="6759712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759717">c2</span><span class="op" id="6759719">.</span><span class="ident" id="6759720">Close</span><span class="op" id="6759725">(</span><span class="op" id="6759726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759731">if</span>&nbsp;<span class="ident" id="6759734">la</span>&nbsp;<span class="op" id="6759737">!=</span>&nbsp;<span class="ident" id="6759740">nil</span>&nbsp;<span class="op" id="6759744">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759750">defer</span>&nbsp;<span class="ident" id="6759756">os</span><span class="op" id="6759758">.</span><span class="ident" id="6759759">Remove</span><span class="op" id="6759765">(</span><span class="ident" id="6759766">laddr</span><span class="op" id="6759771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759780">}</span><span class="op" id="6759781">(</span><span class="op" id="6759782">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759787">switch</span>&nbsp;<span class="ident" id="6759794">runtime</span><span class="op" id="6759801">.</span><span class="ident" id="6759802">GOOS</span>&nbsp;<span class="op" id="6759807">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759811">case</span>&nbsp;<span class="string" id="6759816">&#34;android&#34;</span><span class="op" id="6759825">,</span>&nbsp;<span class="string" id="6759827">&#34;linux&#34;</span><span class="op" id="6759834">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759839">if</span>&nbsp;<span class="ident" id="6759842">laddr</span>&nbsp;<span class="op" id="6759848">==</span>&nbsp;<span class="string" id="6759851">&#34;&#34;</span>&nbsp;<span class="op" id="6759854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759860">laddr</span>&nbsp;<span class="op" id="6759866">=</span>&nbsp;<span class="string" id="6759868">&#34;@&#34;</span>&nbsp;<span class="comment" id="6759872">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759899">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759904">var</span>&nbsp;<span class="ident" id="6759908">connAddrs</span>&nbsp;<span class="op" id="6759918">=</span>&nbsp;<span class="op" id="6759920">[</span><span class="num" id="6759921">4</span><span class="op" id="6759922">]</span><span class="keyword" id="6759923">struct</span><span class="op" id="6759929">{</span>&nbsp;<span class="ident" id="6759931">got</span><span class="op" id="6759934">,</span>&nbsp;<span class="ident" id="6759936">want</span>&nbsp;<span class="ident" id="6759941">Addr</span>&nbsp;<span class="op" id="6759946">}</span><span class="op" id="6759947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759952">{</span><span class="ident" id="6759953">c1</span><span class="op" id="6759955">.</span><span class="ident" id="6759956">LocalAddr</span><span class="op" id="6759965">(</span><span class="op" id="6759966">)</span><span class="op" id="6759967">,</span>&nbsp;<span class="ident" id="6759969">ta</span><span class="op" id="6759971">}</span><span class="op" id="6759972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759977">{</span><span class="ident" id="6759978">c1</span><span class="op" id="6759980">.</span><span class="ident" id="6759981">RemoteAddr</span><span class="op" id="6759991">(</span><span class="op" id="6759992">)</span><span class="op" id="6759993">,</span>&nbsp;<span class="ident" id="6759995">nil</span><span class="op" id="6759998">}</span><span class="op" id="6759999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760004">{</span><span class="ident" id="6760005">c2</span><span class="op" id="6760007">.</span><span class="ident" id="6760008">LocalAddr</span><span class="op" id="6760017">(</span><span class="op" id="6760018">)</span><span class="op" id="6760019">,</span>&nbsp;<span class="op" id="6760021">&amp;</span><span class="ident" id="6760022">UnixAddr</span><span class="op" id="6760030">{</span><span class="ident" id="6760031">Name</span><span class="op" id="6760035">:</span>&nbsp;<span class="ident" id="6760037">laddr</span><span class="op" id="6760042">,</span>&nbsp;<span class="ident" id="6760044">Net</span><span class="op" id="6760047">:</span>&nbsp;<span class="string" id="6760049">&#34;unixgram&#34;</span><span class="op" id="6760059">}</span><span class="op" id="6760060">}</span><span class="op" id="6760061">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760066">{</span><span class="ident" id="6760067">c2</span><span class="op" id="6760069">.</span><span class="ident" id="6760070">RemoteAddr</span><span class="op" id="6760080">(</span><span class="op" id="6760081">)</span><span class="op" id="6760082">,</span>&nbsp;<span class="ident" id="6760084">ta</span><span class="op" id="6760086">}</span><span class="op" id="6760087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760095">for</span>&nbsp;<span class="ident" id="6760099">_</span><span class="op" id="6760100">,</span>&nbsp;<span class="ident" id="6760102">ca</span>&nbsp;<span class="op" id="6760105">:=</span>&nbsp;<span class="keyword" id="6760108">range</span>&nbsp;<span class="ident" id="6760114">connAddrs</span>&nbsp;<span class="op" id="6760124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760129">if</span>&nbsp;<span class="op" id="6760132">!</span><span class="ident" id="6760133">reflect</span><span class="op" id="6760140">.</span><span class="ident" id="6760141">DeepEqual</span><span class="op" id="6760150">(</span><span class="ident" id="6760151">ca</span><span class="op" id="6760153">.</span><span class="ident" id="6760154">got</span><span class="op" id="6760157">,</span>&nbsp;<span class="ident" id="6760159">ca</span><span class="op" id="6760161">.</span><span class="ident" id="6760162">want</span><span class="op" id="6760166">)</span>&nbsp;<span class="op" id="6760168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760174">t</span><span class="op" id="6760175">.</span><span class="ident" id="6760176">Fatalf</span><span class="op" id="6760182">(</span><span class="string" id="6760183">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6760206">,</span>&nbsp;<span class="ident" id="6760208">ca</span><span class="op" id="6760210">.</span><span class="ident" id="6760211">got</span><span class="op" id="6760214">,</span>&nbsp;<span class="ident" id="6760216">ca</span><span class="op" id="6760218">.</span><span class="ident" id="6760219">want</span><span class="op" id="6760223">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760235">}</span><br>
<span class="lineno"></span><span class="op" id="6760237">}</span>
</div>
</body>
</html>
