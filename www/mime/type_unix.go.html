<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3736585">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3736640">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3736694">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3736745">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3736815">package</span>&nbsp;<span class="ident" id="3736823">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3736829">import</span>&nbsp;<span class="op" id="3736836">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3736839">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3736848">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3736854">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3736864">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="3736867">var</span>&nbsp;<span class="ident" id="3736871">typeFiles</span>&nbsp;<span class="op" id="3736881">=</span>&nbsp;<span class="op" id="3736883">[</span><span class="op" id="3736884">]</span><span class="builtintype" id="3736885">string</span><span class="op" id="3736891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3736894">&#34;/etc/mime.types&#34;</span><span class="op" id="3736911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3736914">&#34;/etc/apache2/mime.types&#34;</span><span class="op" id="3736939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3736942">&#34;/etc/apache/mime.types&#34;</span><span class="op" id="3736966">,</span><br>
<span class="lineno"></span><span class="op" id="3736968">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3736971">func</span>&nbsp;<span class="ident" id="3736976">loadMimeFile</span><span class="op" id="3736988">(</span><span class="ident" id="3736989">filename</span>&nbsp;<span class="builtintype" id="3736998">string</span><span class="op" id="3737004">)</span>&nbsp;<span class="op" id="3737006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737009">f</span><span class="op" id="3737010">,</span>&nbsp;<span class="ident" id="3737012">err</span>&nbsp;<span class="op" id="3737016">:=</span>&nbsp;<span class="ident" id="3737019">os</span><span class="op" id="3737021">.</span><span class="ident" id="3737022">Open</span><span class="op" id="3737026">(</span><span class="ident" id="3737027">filename</span><span class="op" id="3737035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737038">if</span>&nbsp;<span class="ident" id="3737041">err</span>&nbsp;<span class="op" id="3737045">!=</span>&nbsp;<span class="ident" id="3737048">nil</span>&nbsp;<span class="op" id="3737052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737056">return</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737067">defer</span>&nbsp;<span class="ident" id="3737073">f</span><span class="op" id="3737074">.</span><span class="ident" id="3737075">Close</span><span class="op" id="3737080">(</span><span class="op" id="3737081">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737085">scanner</span>&nbsp;<span class="op" id="3737093">:=</span>&nbsp;<span class="ident" id="3737096">bufio</span><span class="op" id="3737101">.</span><span class="ident" id="3737102">NewScanner</span><span class="op" id="3737112">(</span><span class="ident" id="3737113">f</span><span class="op" id="3737114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737117">for</span>&nbsp;<span class="ident" id="3737121">scanner</span><span class="op" id="3737128">.</span><span class="ident" id="3737129">Scan</span><span class="op" id="3737133">(</span><span class="op" id="3737134">)</span>&nbsp;<span class="op" id="3737136">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737140">fields</span>&nbsp;<span class="op" id="3737147">:=</span>&nbsp;<span class="ident" id="3737150">strings</span><span class="op" id="3737157">.</span><span class="ident" id="3737158">Fields</span><span class="op" id="3737164">(</span><span class="ident" id="3737165">scanner</span><span class="op" id="3737172">.</span><span class="ident" id="3737173">Text</span><span class="op" id="3737177">(</span><span class="op" id="3737178">)</span><span class="op" id="3737179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737183">if</span>&nbsp;<span class="builtinfunc" id="3737186">len</span><span class="op" id="3737189">(</span><span class="ident" id="3737190">fields</span><span class="op" id="3737196">)</span>&nbsp;<span class="op" id="3737198">&lt;=</span>&nbsp;<span class="num" id="3737201">1</span>&nbsp;<span class="op" id="3737203">||</span>&nbsp;<span class="ident" id="3737206">fields</span><span class="op" id="3737212">[</span><span class="num" id="3737213">0</span><span class="op" id="3737214">]</span><span class="op" id="3737215">[</span><span class="num" id="3737216">0</span><span class="op" id="3737217">]</span>&nbsp;<span class="op" id="3737219">==</span>&nbsp;<span class="string" id="3737222">&#39;#&#39;</span>&nbsp;<span class="op" id="3737226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737231">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737246">mimeType</span>&nbsp;<span class="op" id="3737255">:=</span>&nbsp;<span class="ident" id="3737258">fields</span><span class="op" id="3737264">[</span><span class="num" id="3737265">0</span><span class="op" id="3737266">]</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737270">for</span>&nbsp;<span class="ident" id="3737274">_</span><span class="op" id="3737275">,</span>&nbsp;<span class="ident" id="3737277">ext</span>&nbsp;<span class="op" id="3737281">:=</span>&nbsp;<span class="keyword" id="3737284">range</span>&nbsp;<span class="ident" id="3737290">fields</span><span class="op" id="3737296">[</span><span class="num" id="3737297">1</span><span class="op" id="3737298">:</span><span class="op" id="3737299">]</span>&nbsp;<span class="op" id="3737301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737306">if</span>&nbsp;<span class="ident" id="3737309">ext</span><span class="op" id="3737312">[</span><span class="num" id="3737313">0</span><span class="op" id="3737314">]</span>&nbsp;<span class="op" id="3737316">==</span>&nbsp;<span class="string" id="3737319">&#39;#&#39;</span>&nbsp;<span class="op" id="3737323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737329">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737343">setExtensionType</span><span class="op" id="3737359">(</span><span class="string" id="3737360">&#34;.&#34;</span><span class="op" id="3737363">+</span><span class="ident" id="3737364">ext</span><span class="op" id="3737367">,</span>&nbsp;<span class="ident" id="3737369">mimeType</span><span class="op" id="3737377">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737387">if</span>&nbsp;<span class="ident" id="3737390">err</span>&nbsp;<span class="op" id="3737394">:=</span>&nbsp;<span class="ident" id="3737397">scanner</span><span class="op" id="3737404">.</span><span class="ident" id="3737405">Err</span><span class="op" id="3737408">(</span><span class="op" id="3737409">)</span><span class="op" id="3737410">;</span>&nbsp;<span class="ident" id="3737412">err</span>&nbsp;<span class="op" id="3737416">!=</span>&nbsp;<span class="ident" id="3737419">nil</span>&nbsp;<span class="op" id="3737423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3737427">panic</span><span class="op" id="3737432">(</span><span class="ident" id="3737433">err</span><span class="op" id="3737436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737439">}</span><br>
<span class="lineno">45</span><span class="op" id="3737441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3737444">func</span>&nbsp;<span class="ident" id="3737449">initMime</span><span class="op" id="3737457">(</span><span class="op" id="3737458">)</span>&nbsp;<span class="op" id="3737460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737463">for</span>&nbsp;<span class="ident" id="3737467">_</span><span class="op" id="3737468">,</span>&nbsp;<span class="ident" id="3737470">filename</span>&nbsp;<span class="op" id="3737479">:=</span>&nbsp;<span class="keyword" id="3737482">range</span>&nbsp;<span class="ident" id="3737488">typeFiles</span>&nbsp;<span class="op" id="3737498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737502">loadMimeFile</span><span class="op" id="3737514">(</span><span class="ident" id="3737515">filename</span><span class="op" id="3737523">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737526">}</span><br>
<span class="lineno"></span><span class="op" id="3737528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3737531">func</span>&nbsp;<span class="ident" id="3737536">initMimeForTests</span><span class="op" id="3737552">(</span><span class="op" id="3737553">)</span>&nbsp;<span class="keyword" id="3737555">map</span><span class="op" id="3737558">[</span><span class="builtintype" id="3737559">string</span><span class="op" id="3737565">]</span><span class="builtintype" id="3737566">string</span>&nbsp;<span class="op" id="3737573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737576">typeFiles</span>&nbsp;<span class="op" id="3737586">=</span>&nbsp;<span class="op" id="3737588">[</span><span class="op" id="3737589">]</span><span class="builtintype" id="3737590">string</span><span class="op" id="3737596">{</span><span class="string" id="3737597">&#34;testdata/test.types&#34;</span><span class="op" id="3737618">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737621">return</span>&nbsp;<span class="keyword" id="3737628">map</span><span class="op" id="3737631">[</span><span class="builtintype" id="3737632">string</span><span class="op" id="3737638">]</span><span class="builtintype" id="3737639">string</span><span class="op" id="3737645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3737649">&#34;.T1&#34;</span><span class="op" id="3737654">:</span>&nbsp;&nbsp;<span class="string" id="3737657">&#34;application/test&#34;</span><span class="op" id="3737675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3737679">&#34;.t2&#34;</span><span class="op" id="3737684">:</span>&nbsp;&nbsp;<span class="string" id="3737687">&#34;text/test;&nbsp;charset=utf-8&#34;</span><span class="op" id="3737713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3737717">&#34;.png&#34;</span><span class="op" id="3737723">:</span>&nbsp;<span class="string" id="3737725">&#34;image/png&#34;</span><span class="op" id="3737736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737739">}</span><br>
<span class="lineno">60</span><span class="op" id="3737741">}</span>
</div>
</body>
</html>
