<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/ecdsa</h2>
<ul>
<li><a href="/gostd/crypto/ecdsa/ecdsa.go.html">ecdsa.go</a></li>
<li><a href="/gostd/crypto/ecdsa/ecdsa_test.go.html">ecdsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4430470">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4430525">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4430579">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4430630">//&nbsp;Package&nbsp;ecdsa&nbsp;implements&nbsp;the&nbsp;Elliptic&nbsp;Curve&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4430709">//&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4430735">package</span>&nbsp;<span class="ident" id="4430743">ecdsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4430750">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="4430765">//&nbsp;&nbsp;&nbsp;[NSA]:&nbsp;Suite&nbsp;B&nbsp;implementer&#39;s&nbsp;guide&nbsp;to&nbsp;FIPS&nbsp;186-3,</span><br>
<span class="lineno"></span><span class="comment" id="4430820">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.nsa.gov/ia/_files/ecdsa.pdf</span><br>
<span class="lineno"></span><span class="comment" id="4430866">//&nbsp;&nbsp;&nbsp;[SECG]:&nbsp;SECG,&nbsp;SEC1</span><br>
<span class="lineno"></span><span class="comment" id="4430890">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.secg.org/download/aid-780/sec1-v2.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4430947">import</span>&nbsp;<span class="op" id="4430954">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4430957">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4430967">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4430986">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4431003">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4431009">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4431020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4431023">//&nbsp;PublicKey&nbsp;represents&nbsp;an&nbsp;ECDSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4431068">type</span>&nbsp;<span class="ident" id="4431073">PublicKey</span>&nbsp;<span class="keyword" id="4431083">struct</span>&nbsp;<span class="op" id="4431090">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431093">elliptic</span><span class="op" id="4431101">.</span><span class="ident" id="4431102">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431109">X</span><span class="op" id="4431110">,</span>&nbsp;<span class="ident" id="4431112">Y</span>&nbsp;<span class="op" id="4431114">*</span><span class="ident" id="4431115">big</span><span class="op" id="4431118">.</span><span class="ident" id="4431119">Int</span><br>
<span class="lineno"></span><span class="op" id="4431123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4431126">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;ECDSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">30</span><span class="keyword" id="4431172">type</span>&nbsp;<span class="ident" id="4431177">PrivateKey</span>&nbsp;<span class="keyword" id="4431188">struct</span>&nbsp;<span class="op" id="4431195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431198">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431209">D</span>&nbsp;<span class="op" id="4431211">*</span><span class="ident" id="4431212">big</span><span class="op" id="4431215">.</span><span class="ident" id="4431216">Int</span><br>
<span class="lineno"></span><span class="op" id="4431220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="4431223">type</span>&nbsp;<span class="ident" id="4431228">ecdsaSignature</span>&nbsp;<span class="keyword" id="4431243">struct</span>&nbsp;<span class="op" id="4431250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431253">R</span><span class="op" id="4431254">,</span>&nbsp;<span class="ident" id="4431256">S</span>&nbsp;<span class="op" id="4431258">*</span><span class="ident" id="4431259">big</span><span class="op" id="4431262">.</span><span class="ident" id="4431263">Int</span><br>
<span class="lineno"></span><span class="op" id="4431267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4431270">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno">40</span><span class="keyword" id="4431326">func</span>&nbsp;<span class="op" id="4431331">(</span><span class="ident" id="4431332">priv</span>&nbsp;<span class="op" id="4431337">*</span><span class="ident" id="4431338">PrivateKey</span><span class="op" id="4431348">)</span>&nbsp;<span class="ident" id="4431350">Public</span><span class="op" id="4431356">(</span><span class="op" id="4431357">)</span>&nbsp;<span class="ident" id="4431359">crypto</span><span class="op" id="4431365">.</span><span class="ident" id="4431366">PublicKey</span>&nbsp;<span class="op" id="4431376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431379">return</span>&nbsp;<span class="op" id="4431386">&amp;</span><span class="ident" id="4431387">priv</span><span class="op" id="4431391">.</span><span class="ident" id="4431392">PublicKey</span><br>
<span class="lineno"></span><span class="op" id="4431402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4431405">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;This&nbsp;method&nbsp;is</span><br>
<span class="lineno">45</span><span class="comment" id="4431479">//&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4431557">//&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign&nbsp;function&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4431634">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4431647">func</span>&nbsp;<span class="op" id="4431652">(</span><span class="ident" id="4431653">priv</span>&nbsp;<span class="op" id="4431658">*</span><span class="ident" id="4431659">PrivateKey</span><span class="op" id="4431669">)</span>&nbsp;<span class="ident" id="4431671">Sign</span><span class="op" id="4431675">(</span><span class="ident" id="4431676">rand</span>&nbsp;<span class="ident" id="4431681">io</span><span class="op" id="4431683">.</span><span class="ident" id="4431684">Reader</span><span class="op" id="4431690">,</span>&nbsp;<span class="ident" id="4431692">msg</span>&nbsp;<span class="op" id="4431696">[</span><span class="op" id="4431697">]</span><span class="builtintype" id="4431698">byte</span><span class="op" id="4431702">,</span>&nbsp;<span class="ident" id="4431704">opts</span>&nbsp;<span class="ident" id="4431709">crypto</span><span class="op" id="4431715">.</span><span class="ident" id="4431716">SignerOpts</span><span class="op" id="4431726">)</span>&nbsp;<span class="op" id="4431728">(</span><span class="op" id="4431729">[</span><span class="op" id="4431730">]</span><span class="builtintype" id="4431731">byte</span><span class="op" id="4431735">,</span>&nbsp;<span class="builtintype" id="4431737">error</span><span class="op" id="4431742">)</span>&nbsp;<span class="op" id="4431744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431747">r</span><span class="op" id="4431748">,</span>&nbsp;<span class="ident" id="4431750">s</span><span class="op" id="4431751">,</span>&nbsp;<span class="ident" id="4431753">err</span>&nbsp;<span class="op" id="4431757">:=</span>&nbsp;<span class="ident" id="4431760">Sign</span><span class="op" id="4431764">(</span><span class="ident" id="4431765">rand</span><span class="op" id="4431769">,</span>&nbsp;<span class="ident" id="4431771">priv</span><span class="op" id="4431775">,</span>&nbsp;<span class="ident" id="4431777">msg</span><span class="op" id="4431780">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431783">if</span>&nbsp;<span class="ident" id="4431786">err</span>&nbsp;<span class="op" id="4431790">!=</span>&nbsp;<span class="ident" id="4431793">nil</span>&nbsp;<span class="op" id="4431797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431801">return</span>&nbsp;<span class="ident" id="4431808">nil</span><span class="op" id="4431811">,</span>&nbsp;<span class="ident" id="4431813">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431822">return</span>&nbsp;<span class="ident" id="4431829">asn1</span><span class="op" id="4431833">.</span><span class="ident" id="4431834">Marshal</span><span class="op" id="4431841">(</span><span class="ident" id="4431842">ecdsaSignature</span><span class="op" id="4431856">{</span><span class="ident" id="4431857">r</span><span class="op" id="4431858">,</span>&nbsp;<span class="ident" id="4431860">s</span><span class="op" id="4431861">}</span><span class="op" id="4431862">)</span><br>
<span class="lineno">55</span><span class="op" id="4431864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4431867">var</span>&nbsp;<span class="ident" id="4431871">one</span>&nbsp;<span class="op" id="4431875">=</span>&nbsp;<span class="builtinfunc" id="4431877">new</span><span class="op" id="4431880">(</span><span class="ident" id="4431881">big</span><span class="op" id="4431884">.</span><span class="ident" id="4431885">Int</span><span class="op" id="4431888">)</span><span class="op" id="4431889">.</span><span class="ident" id="4431890">SetInt64</span><span class="op" id="4431898">(</span><span class="num" id="4431899">1</span><span class="op" id="4431900">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4431903">//&nbsp;randFieldElement&nbsp;returns&nbsp;a&nbsp;random&nbsp;element&nbsp;of&nbsp;the&nbsp;field&nbsp;underlying&nbsp;the&nbsp;given</span><br>
<span class="lineno">60</span><span class="comment" id="4431982">//&nbsp;curve&nbsp;using&nbsp;the&nbsp;procedure&nbsp;given&nbsp;in&nbsp;[NSA]&nbsp;A.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4432033">func</span>&nbsp;<span class="ident" id="4432038">randFieldElement</span><span class="op" id="4432054">(</span><span class="ident" id="4432055">c</span>&nbsp;<span class="ident" id="4432057">elliptic</span><span class="op" id="4432065">.</span><span class="ident" id="4432066">Curve</span><span class="op" id="4432071">,</span>&nbsp;<span class="ident" id="4432073">rand</span>&nbsp;<span class="ident" id="4432078">io</span><span class="op" id="4432080">.</span><span class="ident" id="4432081">Reader</span><span class="op" id="4432087">)</span>&nbsp;<span class="op" id="4432089">(</span><span class="ident" id="4432090">k</span>&nbsp;<span class="op" id="4432092">*</span><span class="ident" id="4432093">big</span><span class="op" id="4432096">.</span><span class="ident" id="4432097">Int</span><span class="op" id="4432100">,</span>&nbsp;<span class="ident" id="4432102">err</span>&nbsp;<span class="builtintype" id="4432106">error</span><span class="op" id="4432111">)</span>&nbsp;<span class="op" id="4432113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432116">params</span>&nbsp;<span class="op" id="4432123">:=</span>&nbsp;<span class="ident" id="4432126">c</span><span class="op" id="4432127">.</span><span class="ident" id="4432128">Params</span><span class="op" id="4432134">(</span><span class="op" id="4432135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432138">b</span>&nbsp;<span class="op" id="4432140">:=</span>&nbsp;<span class="builtinfunc" id="4432143">make</span><span class="op" id="4432147">(</span><span class="op" id="4432148">[</span><span class="op" id="4432149">]</span><span class="builtintype" id="4432150">byte</span><span class="op" id="4432154">,</span>&nbsp;<span class="ident" id="4432156">params</span><span class="op" id="4432162">.</span><span class="ident" id="4432163">BitSize</span><span class="op" id="4432170">/</span><span class="num" id="4432171">8</span><span class="op" id="4432172">+</span><span class="num" id="4432173">8</span><span class="op" id="4432174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432177">_</span><span class="op" id="4432178">,</span>&nbsp;<span class="ident" id="4432180">err</span>&nbsp;<span class="op" id="4432184">=</span>&nbsp;<span class="ident" id="4432186">io</span><span class="op" id="4432188">.</span><span class="ident" id="4432189">ReadFull</span><span class="op" id="4432197">(</span><span class="ident" id="4432198">rand</span><span class="op" id="4432202">,</span>&nbsp;<span class="ident" id="4432204">b</span><span class="op" id="4432205">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432208">if</span>&nbsp;<span class="ident" id="4432211">err</span>&nbsp;<span class="op" id="4432215">!=</span>&nbsp;<span class="ident" id="4432218">nil</span>&nbsp;<span class="op" id="4432222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432226">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432238">k</span>&nbsp;<span class="op" id="4432240">=</span>&nbsp;<span class="builtinfunc" id="4432242">new</span><span class="op" id="4432245">(</span><span class="ident" id="4432246">big</span><span class="op" id="4432249">.</span><span class="ident" id="4432250">Int</span><span class="op" id="4432253">)</span><span class="op" id="4432254">.</span><span class="ident" id="4432255">SetBytes</span><span class="op" id="4432263">(</span><span class="ident" id="4432264">b</span><span class="op" id="4432265">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432268">n</span>&nbsp;<span class="op" id="4432270">:=</span>&nbsp;<span class="builtinfunc" id="4432273">new</span><span class="op" id="4432276">(</span><span class="ident" id="4432277">big</span><span class="op" id="4432280">.</span><span class="ident" id="4432281">Int</span><span class="op" id="4432284">)</span><span class="op" id="4432285">.</span><span class="ident" id="4432286">Sub</span><span class="op" id="4432289">(</span><span class="ident" id="4432290">params</span><span class="op" id="4432296">.</span><span class="ident" id="4432297">N</span><span class="op" id="4432298">,</span>&nbsp;<span class="ident" id="4432300">one</span><span class="op" id="4432303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432306">k</span><span class="op" id="4432307">.</span><span class="ident" id="4432308">Mod</span><span class="op" id="4432311">(</span><span class="ident" id="4432312">k</span><span class="op" id="4432313">,</span>&nbsp;<span class="ident" id="4432315">n</span><span class="op" id="4432316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432319">k</span><span class="op" id="4432320">.</span><span class="ident" id="4432321">Add</span><span class="op" id="4432324">(</span><span class="ident" id="4432325">k</span><span class="op" id="4432326">,</span>&nbsp;<span class="ident" id="4432328">one</span><span class="op" id="4432331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432334">return</span><br>
<span class="lineno"></span><span class="op" id="4432341">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4432344">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&nbsp;and&nbsp;private&nbsp;key&nbsp;pair.</span><br>
<span class="lineno"></span><span class="keyword" id="4432400">func</span>&nbsp;<span class="ident" id="4432405">GenerateKey</span><span class="op" id="4432416">(</span><span class="ident" id="4432417">c</span>&nbsp;<span class="ident" id="4432419">elliptic</span><span class="op" id="4432427">.</span><span class="ident" id="4432428">Curve</span><span class="op" id="4432433">,</span>&nbsp;<span class="ident" id="4432435">rand</span>&nbsp;<span class="ident" id="4432440">io</span><span class="op" id="4432442">.</span><span class="ident" id="4432443">Reader</span><span class="op" id="4432449">)</span>&nbsp;<span class="op" id="4432451">(</span><span class="ident" id="4432452">priv</span>&nbsp;<span class="op" id="4432457">*</span><span class="ident" id="4432458">PrivateKey</span><span class="op" id="4432468">,</span>&nbsp;<span class="ident" id="4432470">err</span>&nbsp;<span class="builtintype" id="4432474">error</span><span class="op" id="4432479">)</span>&nbsp;<span class="op" id="4432481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432484">k</span><span class="op" id="4432485">,</span>&nbsp;<span class="ident" id="4432487">err</span>&nbsp;<span class="op" id="4432491">:=</span>&nbsp;<span class="ident" id="4432494">randFieldElement</span><span class="op" id="4432510">(</span><span class="ident" id="4432511">c</span><span class="op" id="4432512">,</span>&nbsp;<span class="ident" id="4432514">rand</span><span class="op" id="4432518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432521">if</span>&nbsp;<span class="ident" id="4432524">err</span>&nbsp;<span class="op" id="4432528">!=</span>&nbsp;<span class="ident" id="4432531">nil</span>&nbsp;<span class="op" id="4432535">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432539">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432551">priv</span>&nbsp;<span class="op" id="4432556">=</span>&nbsp;<span class="builtinfunc" id="4432558">new</span><span class="op" id="4432561">(</span><span class="ident" id="4432562">PrivateKey</span><span class="op" id="4432572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432575">priv</span><span class="op" id="4432579">.</span><span class="ident" id="4432580">PublicKey</span><span class="op" id="4432589">.</span><span class="ident" id="4432590">Curve</span>&nbsp;<span class="op" id="4432596">=</span>&nbsp;<span class="ident" id="4432598">c</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432601">priv</span><span class="op" id="4432605">.</span><span class="ident" id="4432606">D</span>&nbsp;<span class="op" id="4432608">=</span>&nbsp;<span class="ident" id="4432610">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432613">priv</span><span class="op" id="4432617">.</span><span class="ident" id="4432618">PublicKey</span><span class="op" id="4432627">.</span><span class="ident" id="4432628">X</span><span class="op" id="4432629">,</span>&nbsp;<span class="ident" id="4432631">priv</span><span class="op" id="4432635">.</span><span class="ident" id="4432636">PublicKey</span><span class="op" id="4432645">.</span><span class="ident" id="4432646">Y</span>&nbsp;<span class="op" id="4432648">=</span>&nbsp;<span class="ident" id="4432650">c</span><span class="op" id="4432651">.</span><span class="ident" id="4432652">ScalarBaseMult</span><span class="op" id="4432666">(</span><span class="ident" id="4432667">k</span><span class="op" id="4432668">.</span><span class="ident" id="4432669">Bytes</span><span class="op" id="4432674">(</span><span class="op" id="4432675">)</span><span class="op" id="4432676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432679">return</span><br>
<span class="lineno"></span><span class="op" id="4432686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4432689">//&nbsp;hashToInt&nbsp;converts&nbsp;a&nbsp;hash&nbsp;value&nbsp;to&nbsp;an&nbsp;integer.&nbsp;There&nbsp;is&nbsp;some&nbsp;disagreement</span><br>
<span class="lineno"></span><span class="comment" id="4432766">//&nbsp;about&nbsp;how&nbsp;this&nbsp;is&nbsp;done.&nbsp;[NSA]&nbsp;suggests&nbsp;that&nbsp;this&nbsp;is&nbsp;done&nbsp;in&nbsp;the&nbsp;obvious</span><br>
<span class="lineno"></span><span class="comment" id="4432841">//&nbsp;manner,&nbsp;but&nbsp;[SECG]&nbsp;truncates&nbsp;the&nbsp;hash&nbsp;to&nbsp;the&nbsp;bit-length&nbsp;of&nbsp;the&nbsp;curve&nbsp;order</span><br>
<span class="lineno"></span><span class="comment" id="4432919">//&nbsp;first.&nbsp;We&nbsp;follow&nbsp;[SECG]&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;OpenSSL&nbsp;does.&nbsp;Additionally,</span><br>
<span class="lineno"></span><span class="comment" id="4432994">//&nbsp;OpenSSL&nbsp;right&nbsp;shifts&nbsp;excess&nbsp;bits&nbsp;from&nbsp;the&nbsp;number&nbsp;if&nbsp;the&nbsp;hash&nbsp;is&nbsp;too&nbsp;large</span><br>
<span class="lineno">95</span><span class="comment" id="4433071">//&nbsp;and&nbsp;we&nbsp;mirror&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span><span class="keyword" id="4433098">func</span>&nbsp;<span class="ident" id="4433103">hashToInt</span><span class="op" id="4433112">(</span><span class="ident" id="4433113">hash</span>&nbsp;<span class="op" id="4433118">[</span><span class="op" id="4433119">]</span><span class="builtintype" id="4433120">byte</span><span class="op" id="4433124">,</span>&nbsp;<span class="ident" id="4433126">c</span>&nbsp;<span class="ident" id="4433128">elliptic</span><span class="op" id="4433136">.</span><span class="ident" id="4433137">Curve</span><span class="op" id="4433142">)</span>&nbsp;<span class="op" id="4433144">*</span><span class="ident" id="4433145">big</span><span class="op" id="4433148">.</span><span class="ident" id="4433149">Int</span>&nbsp;<span class="op" id="4433153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433156">orderBits</span>&nbsp;<span class="op" id="4433166">:=</span>&nbsp;<span class="ident" id="4433169">c</span><span class="op" id="4433170">.</span><span class="ident" id="4433171">Params</span><span class="op" id="4433177">(</span><span class="op" id="4433178">)</span><span class="op" id="4433179">.</span><span class="ident" id="4433180">N</span><span class="op" id="4433181">.</span><span class="ident" id="4433182">BitLen</span><span class="op" id="4433188">(</span><span class="op" id="4433189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433192">orderBytes</span>&nbsp;<span class="op" id="4433203">:=</span>&nbsp;<span class="op" id="4433206">(</span><span class="ident" id="4433207">orderBits</span>&nbsp;<span class="op" id="4433217">+</span>&nbsp;<span class="num" id="4433219">7</span><span class="op" id="4433220">)</span>&nbsp;<span class="op" id="4433222">/</span>&nbsp;<span class="num" id="4433224">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433227">if</span>&nbsp;<span class="builtinfunc" id="4433230">len</span><span class="op" id="4433233">(</span><span class="ident" id="4433234">hash</span><span class="op" id="4433238">)</span>&nbsp;<span class="op" id="4433240">&gt;</span>&nbsp;<span class="ident" id="4433242">orderBytes</span>&nbsp;<span class="op" id="4433253">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433257">hash</span>&nbsp;<span class="op" id="4433262">=</span>&nbsp;<span class="ident" id="4433264">hash</span><span class="op" id="4433268">[</span><span class="op" id="4433269">:</span><span class="ident" id="4433270">orderBytes</span><span class="op" id="4433280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433287">ret</span>&nbsp;<span class="op" id="4433291">:=</span>&nbsp;<span class="builtinfunc" id="4433294">new</span><span class="op" id="4433297">(</span><span class="ident" id="4433298">big</span><span class="op" id="4433301">.</span><span class="ident" id="4433302">Int</span><span class="op" id="4433305">)</span><span class="op" id="4433306">.</span><span class="ident" id="4433307">SetBytes</span><span class="op" id="4433315">(</span><span class="ident" id="4433316">hash</span><span class="op" id="4433320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433323">excess</span>&nbsp;<span class="op" id="4433330">:=</span>&nbsp;<span class="builtinfunc" id="4433333">len</span><span class="op" id="4433336">(</span><span class="ident" id="4433337">hash</span><span class="op" id="4433341">)</span><span class="op" id="4433342">*</span><span class="num" id="4433343">8</span>&nbsp;<span class="op" id="4433345">-</span>&nbsp;<span class="ident" id="4433347">orderBits</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433358">if</span>&nbsp;<span class="ident" id="4433361">excess</span>&nbsp;<span class="op" id="4433368">&gt;</span>&nbsp;<span class="num" id="4433370">0</span>&nbsp;<span class="op" id="4433372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433376">ret</span><span class="op" id="4433379">.</span><span class="ident" id="4433380">Rsh</span><span class="op" id="4433383">(</span><span class="ident" id="4433384">ret</span><span class="op" id="4433387">,</span>&nbsp;<span class="builtintype" id="4433389">uint</span><span class="op" id="4433393">(</span><span class="ident" id="4433394">excess</span><span class="op" id="4433400">)</span><span class="op" id="4433401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433407">return</span>&nbsp;<span class="ident" id="4433414">ret</span><br>
<span class="lineno"></span><span class="op" id="4433418">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4433421">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4433498">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4433576">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4433647">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">115</span><span class="keyword" id="4433685">func</span>&nbsp;<span class="ident" id="4433690">fermatInverse</span><span class="op" id="4433703">(</span><span class="ident" id="4433704">k</span><span class="op" id="4433705">,</span>&nbsp;<span class="ident" id="4433707">N</span>&nbsp;<span class="op" id="4433709">*</span><span class="ident" id="4433710">big</span><span class="op" id="4433713">.</span><span class="ident" id="4433714">Int</span><span class="op" id="4433717">)</span>&nbsp;<span class="op" id="4433719">*</span><span class="ident" id="4433720">big</span><span class="op" id="4433723">.</span><span class="ident" id="4433724">Int</span>&nbsp;<span class="op" id="4433728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433731">two</span>&nbsp;<span class="op" id="4433735">:=</span>&nbsp;<span class="ident" id="4433738">big</span><span class="op" id="4433741">.</span><span class="ident" id="4433742">NewInt</span><span class="op" id="4433748">(</span><span class="num" id="4433749">2</span><span class="op" id="4433750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433753">nMinus2</span>&nbsp;<span class="op" id="4433761">:=</span>&nbsp;<span class="builtinfunc" id="4433764">new</span><span class="op" id="4433767">(</span><span class="ident" id="4433768">big</span><span class="op" id="4433771">.</span><span class="ident" id="4433772">Int</span><span class="op" id="4433775">)</span><span class="op" id="4433776">.</span><span class="ident" id="4433777">Sub</span><span class="op" id="4433780">(</span><span class="ident" id="4433781">N</span><span class="op" id="4433782">,</span>&nbsp;<span class="ident" id="4433784">two</span><span class="op" id="4433787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433790">return</span>&nbsp;<span class="builtinfunc" id="4433797">new</span><span class="op" id="4433800">(</span><span class="ident" id="4433801">big</span><span class="op" id="4433804">.</span><span class="ident" id="4433805">Int</span><span class="op" id="4433808">)</span><span class="op" id="4433809">.</span><span class="ident" id="4433810">Exp</span><span class="op" id="4433813">(</span><span class="ident" id="4433814">k</span><span class="op" id="4433815">,</span>&nbsp;<span class="ident" id="4433817">nMinus2</span><span class="op" id="4433824">,</span>&nbsp;<span class="ident" id="4433826">N</span><span class="op" id="4433827">)</span><br>
<span class="lineno"></span><span class="op" id="4433829">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4433832">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4433912">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4433990">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4434069">//&nbsp;rand.</span><br>
<span class="lineno">125</span><span class="keyword" id="4434078">func</span>&nbsp;<span class="ident" id="4434083">Sign</span><span class="op" id="4434087">(</span><span class="ident" id="4434088">rand</span>&nbsp;<span class="ident" id="4434093">io</span><span class="op" id="4434095">.</span><span class="ident" id="4434096">Reader</span><span class="op" id="4434102">,</span>&nbsp;<span class="ident" id="4434104">priv</span>&nbsp;<span class="op" id="4434109">*</span><span class="ident" id="4434110">PrivateKey</span><span class="op" id="4434120">,</span>&nbsp;<span class="ident" id="4434122">hash</span>&nbsp;<span class="op" id="4434127">[</span><span class="op" id="4434128">]</span><span class="builtintype" id="4434129">byte</span><span class="op" id="4434133">)</span>&nbsp;<span class="op" id="4434135">(</span><span class="ident" id="4434136">r</span><span class="op" id="4434137">,</span>&nbsp;<span class="ident" id="4434139">s</span>&nbsp;<span class="op" id="4434141">*</span><span class="ident" id="4434142">big</span><span class="op" id="4434145">.</span><span class="ident" id="4434146">Int</span><span class="op" id="4434149">,</span>&nbsp;<span class="ident" id="4434151">err</span>&nbsp;<span class="builtintype" id="4434155">error</span><span class="op" id="4434160">)</span>&nbsp;<span class="op" id="4434162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4434165">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434185">c</span>&nbsp;<span class="op" id="4434187">:=</span>&nbsp;<span class="ident" id="4434190">priv</span><span class="op" id="4434194">.</span><span class="ident" id="4434195">PublicKey</span><span class="op" id="4434204">.</span><span class="ident" id="4434205">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434212">N</span>&nbsp;<span class="op" id="4434214">:=</span>&nbsp;<span class="ident" id="4434217">c</span><span class="op" id="4434218">.</span><span class="ident" id="4434219">Params</span><span class="op" id="4434225">(</span><span class="op" id="4434226">)</span><span class="op" id="4434227">.</span><span class="ident" id="4434228">N</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434232">var</span>&nbsp;<span class="ident" id="4434236">k</span><span class="op" id="4434237">,</span>&nbsp;<span class="ident" id="4434239">kInv</span>&nbsp;<span class="op" id="4434244">*</span><span class="ident" id="4434245">big</span><span class="op" id="4434248">.</span><span class="ident" id="4434249">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434254">for</span>&nbsp;<span class="op" id="4434258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434262">for</span>&nbsp;<span class="op" id="4434266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434271">k</span><span class="op" id="4434272">,</span>&nbsp;<span class="ident" id="4434274">err</span>&nbsp;<span class="op" id="4434278">=</span>&nbsp;<span class="ident" id="4434280">randFieldElement</span><span class="op" id="4434296">(</span><span class="ident" id="4434297">c</span><span class="op" id="4434298">,</span>&nbsp;<span class="ident" id="4434300">rand</span><span class="op" id="4434304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434309">if</span>&nbsp;<span class="ident" id="4434312">err</span>&nbsp;<span class="op" id="4434316">!=</span>&nbsp;<span class="ident" id="4434319">nil</span>&nbsp;<span class="op" id="4434323">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434329">r</span>&nbsp;<span class="op" id="4434331">=</span>&nbsp;<span class="ident" id="4434333">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434341">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434357">kInv</span>&nbsp;<span class="op" id="4434362">=</span>&nbsp;<span class="ident" id="4434364">fermatInverse</span><span class="op" id="4434377">(</span><span class="ident" id="4434378">k</span><span class="op" id="4434379">,</span>&nbsp;<span class="ident" id="4434381">N</span><span class="op" id="4434382">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434387">r</span><span class="op" id="4434388">,</span>&nbsp;<span class="ident" id="4434390">_</span>&nbsp;<span class="op" id="4434392">=</span>&nbsp;<span class="ident" id="4434394">priv</span><span class="op" id="4434398">.</span><span class="ident" id="4434399">Curve</span><span class="op" id="4434404">.</span><span class="ident" id="4434405">ScalarBaseMult</span><span class="op" id="4434419">(</span><span class="ident" id="4434420">k</span><span class="op" id="4434421">.</span><span class="ident" id="4434422">Bytes</span><span class="op" id="4434427">(</span><span class="op" id="4434428">)</span><span class="op" id="4434429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434434">r</span><span class="op" id="4434435">.</span><span class="ident" id="4434436">Mod</span><span class="op" id="4434439">(</span><span class="ident" id="4434440">r</span><span class="op" id="4434441">,</span>&nbsp;<span class="ident" id="4434443">N</span><span class="op" id="4434444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434449">if</span>&nbsp;<span class="ident" id="4434452">r</span><span class="op" id="4434453">.</span><span class="ident" id="4434454">Sign</span><span class="op" id="4434458">(</span><span class="op" id="4434459">)</span>&nbsp;<span class="op" id="4434461">!=</span>&nbsp;<span class="num" id="4434464">0</span>&nbsp;<span class="op" id="4434466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434472">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434481">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434490">e</span>&nbsp;<span class="op" id="4434492">:=</span>&nbsp;<span class="ident" id="4434495">hashToInt</span><span class="op" id="4434504">(</span><span class="ident" id="4434505">hash</span><span class="op" id="4434509">,</span>&nbsp;<span class="ident" id="4434511">c</span><span class="op" id="4434512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434516">s</span>&nbsp;<span class="op" id="4434518">=</span>&nbsp;<span class="builtinfunc" id="4434520">new</span><span class="op" id="4434523">(</span><span class="ident" id="4434524">big</span><span class="op" id="4434527">.</span><span class="ident" id="4434528">Int</span><span class="op" id="4434531">)</span><span class="op" id="4434532">.</span><span class="ident" id="4434533">Mul</span><span class="op" id="4434536">(</span><span class="ident" id="4434537">priv</span><span class="op" id="4434541">.</span><span class="ident" id="4434542">D</span><span class="op" id="4434543">,</span>&nbsp;<span class="ident" id="4434545">r</span><span class="op" id="4434546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434550">s</span><span class="op" id="4434551">.</span><span class="ident" id="4434552">Add</span><span class="op" id="4434555">(</span><span class="ident" id="4434556">s</span><span class="op" id="4434557">,</span>&nbsp;<span class="ident" id="4434559">e</span><span class="op" id="4434560">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434564">s</span><span class="op" id="4434565">.</span><span class="ident" id="4434566">Mul</span><span class="op" id="4434569">(</span><span class="ident" id="4434570">s</span><span class="op" id="4434571">,</span>&nbsp;<span class="ident" id="4434573">kInv</span><span class="op" id="4434577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434581">s</span><span class="op" id="4434582">.</span><span class="ident" id="4434583">Mod</span><span class="op" id="4434586">(</span><span class="ident" id="4434587">s</span><span class="op" id="4434588">,</span>&nbsp;<span class="ident" id="4434590">N</span><span class="op" id="4434591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434595">if</span>&nbsp;<span class="ident" id="4434598">s</span><span class="op" id="4434599">.</span><span class="ident" id="4434600">Sign</span><span class="op" id="4434604">(</span><span class="op" id="4434605">)</span>&nbsp;<span class="op" id="4434607">!=</span>&nbsp;<span class="num" id="4434610">0</span>&nbsp;<span class="op" id="4434612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434617">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434625">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434632">return</span><br>
<span class="lineno"></span><span class="op" id="4434639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4434642">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;Its</span><br>
<span class="lineno"></span><span class="comment" id="4434722">//&nbsp;return&nbsp;value&nbsp;records&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4434778">func</span>&nbsp;<span class="ident" id="4434783">Verify</span><span class="op" id="4434789">(</span><span class="ident" id="4434790">pub</span>&nbsp;<span class="op" id="4434794">*</span><span class="ident" id="4434795">PublicKey</span><span class="op" id="4434804">,</span>&nbsp;<span class="ident" id="4434806">hash</span>&nbsp;<span class="op" id="4434811">[</span><span class="op" id="4434812">]</span><span class="builtintype" id="4434813">byte</span><span class="op" id="4434817">,</span>&nbsp;<span class="ident" id="4434819">r</span><span class="op" id="4434820">,</span>&nbsp;<span class="ident" id="4434822">s</span>&nbsp;<span class="op" id="4434824">*</span><span class="ident" id="4434825">big</span><span class="op" id="4434828">.</span><span class="ident" id="4434829">Int</span><span class="op" id="4434832">)</span>&nbsp;<span class="builtintype" id="4434834">bool</span>&nbsp;<span class="op" id="4434839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4434842">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434862">c</span>&nbsp;<span class="op" id="4434864">:=</span>&nbsp;<span class="ident" id="4434867">pub</span><span class="op" id="4434870">.</span><span class="ident" id="4434871">Curve</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434878">N</span>&nbsp;<span class="op" id="4434880">:=</span>&nbsp;<span class="ident" id="4434883">c</span><span class="op" id="4434884">.</span><span class="ident" id="4434885">Params</span><span class="op" id="4434891">(</span><span class="op" id="4434892">)</span><span class="op" id="4434893">.</span><span class="ident" id="4434894">N</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434898">if</span>&nbsp;<span class="ident" id="4434901">r</span><span class="op" id="4434902">.</span><span class="ident" id="4434903">Sign</span><span class="op" id="4434907">(</span><span class="op" id="4434908">)</span>&nbsp;<span class="op" id="4434910">==</span>&nbsp;<span class="num" id="4434913">0</span>&nbsp;<span class="op" id="4434915">||</span>&nbsp;<span class="ident" id="4434918">s</span><span class="op" id="4434919">.</span><span class="ident" id="4434920">Sign</span><span class="op" id="4434924">(</span><span class="op" id="4434925">)</span>&nbsp;<span class="op" id="4434927">==</span>&nbsp;<span class="num" id="4434930">0</span>&nbsp;<span class="op" id="4434932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434936">return</span>&nbsp;<span class="builtintype" id="4434943">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434950">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434953">if</span>&nbsp;<span class="ident" id="4434956">r</span><span class="op" id="4434957">.</span><span class="ident" id="4434958">Cmp</span><span class="op" id="4434961">(</span><span class="ident" id="4434962">N</span><span class="op" id="4434963">)</span>&nbsp;<span class="op" id="4434965">&gt;=</span>&nbsp;<span class="num" id="4434968">0</span>&nbsp;<span class="op" id="4434970">||</span>&nbsp;<span class="ident" id="4434973">s</span><span class="op" id="4434974">.</span><span class="ident" id="4434975">Cmp</span><span class="op" id="4434978">(</span><span class="ident" id="4434979">N</span><span class="op" id="4434980">)</span>&nbsp;<span class="op" id="4434982">&gt;=</span>&nbsp;<span class="num" id="4434985">0</span>&nbsp;<span class="op" id="4434987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434991">return</span>&nbsp;<span class="builtintype" id="4434998">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435008">e</span>&nbsp;<span class="op" id="4435010">:=</span>&nbsp;<span class="ident" id="4435013">hashToInt</span><span class="op" id="4435022">(</span><span class="ident" id="4435023">hash</span><span class="op" id="4435027">,</span>&nbsp;<span class="ident" id="4435029">c</span><span class="op" id="4435030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435033">w</span>&nbsp;<span class="op" id="4435035">:=</span>&nbsp;<span class="builtinfunc" id="4435038">new</span><span class="op" id="4435041">(</span><span class="ident" id="4435042">big</span><span class="op" id="4435045">.</span><span class="ident" id="4435046">Int</span><span class="op" id="4435049">)</span><span class="op" id="4435050">.</span><span class="ident" id="4435051">ModInverse</span><span class="op" id="4435061">(</span><span class="ident" id="4435062">s</span><span class="op" id="4435063">,</span>&nbsp;<span class="ident" id="4435065">N</span><span class="op" id="4435066">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435070">u1</span>&nbsp;<span class="op" id="4435073">:=</span>&nbsp;<span class="ident" id="4435076">e</span><span class="op" id="4435077">.</span><span class="ident" id="4435078">Mul</span><span class="op" id="4435081">(</span><span class="ident" id="4435082">e</span><span class="op" id="4435083">,</span>&nbsp;<span class="ident" id="4435085">w</span><span class="op" id="4435086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435089">u1</span><span class="op" id="4435091">.</span><span class="ident" id="4435092">Mod</span><span class="op" id="4435095">(</span><span class="ident" id="4435096">u1</span><span class="op" id="4435098">,</span>&nbsp;<span class="ident" id="4435100">N</span><span class="op" id="4435101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435104">u2</span>&nbsp;<span class="op" id="4435107">:=</span>&nbsp;<span class="ident" id="4435110">w</span><span class="op" id="4435111">.</span><span class="ident" id="4435112">Mul</span><span class="op" id="4435115">(</span><span class="ident" id="4435116">r</span><span class="op" id="4435117">,</span>&nbsp;<span class="ident" id="4435119">w</span><span class="op" id="4435120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435123">u2</span><span class="op" id="4435125">.</span><span class="ident" id="4435126">Mod</span><span class="op" id="4435129">(</span><span class="ident" id="4435130">u2</span><span class="op" id="4435132">,</span>&nbsp;<span class="ident" id="4435134">N</span><span class="op" id="4435135">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435139">x1</span><span class="op" id="4435141">,</span>&nbsp;<span class="ident" id="4435143">y1</span>&nbsp;<span class="op" id="4435146">:=</span>&nbsp;<span class="ident" id="4435149">c</span><span class="op" id="4435150">.</span><span class="ident" id="4435151">ScalarBaseMult</span><span class="op" id="4435165">(</span><span class="ident" id="4435166">u1</span><span class="op" id="4435168">.</span><span class="ident" id="4435169">Bytes</span><span class="op" id="4435174">(</span><span class="op" id="4435175">)</span><span class="op" id="4435176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435179">x2</span><span class="op" id="4435181">,</span>&nbsp;<span class="ident" id="4435183">y2</span>&nbsp;<span class="op" id="4435186">:=</span>&nbsp;<span class="ident" id="4435189">c</span><span class="op" id="4435190">.</span><span class="ident" id="4435191">ScalarMult</span><span class="op" id="4435201">(</span><span class="ident" id="4435202">pub</span><span class="op" id="4435205">.</span><span class="ident" id="4435206">X</span><span class="op" id="4435207">,</span>&nbsp;<span class="ident" id="4435209">pub</span><span class="op" id="4435212">.</span><span class="ident" id="4435213">Y</span><span class="op" id="4435214">,</span>&nbsp;<span class="ident" id="4435216">u2</span><span class="op" id="4435218">.</span><span class="ident" id="4435219">Bytes</span><span class="op" id="4435224">(</span><span class="op" id="4435225">)</span><span class="op" id="4435226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435229">x</span><span class="op" id="4435230">,</span>&nbsp;<span class="ident" id="4435232">y</span>&nbsp;<span class="op" id="4435234">:=</span>&nbsp;<span class="ident" id="4435237">c</span><span class="op" id="4435238">.</span><span class="ident" id="4435239">Add</span><span class="op" id="4435242">(</span><span class="ident" id="4435243">x1</span><span class="op" id="4435245">,</span>&nbsp;<span class="ident" id="4435247">y1</span><span class="op" id="4435249">,</span>&nbsp;<span class="ident" id="4435251">x2</span><span class="op" id="4435253">,</span>&nbsp;<span class="ident" id="4435255">y2</span><span class="op" id="4435257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435260">if</span>&nbsp;<span class="ident" id="4435263">x</span><span class="op" id="4435264">.</span><span class="ident" id="4435265">Sign</span><span class="op" id="4435269">(</span><span class="op" id="4435270">)</span>&nbsp;<span class="op" id="4435272">==</span>&nbsp;<span class="num" id="4435275">0</span>&nbsp;<span class="op" id="4435277">&amp;&amp;</span>&nbsp;<span class="ident" id="4435280">y</span><span class="op" id="4435281">.</span><span class="ident" id="4435282">Sign</span><span class="op" id="4435286">(</span><span class="op" id="4435287">)</span>&nbsp;<span class="op" id="4435289">==</span>&nbsp;<span class="num" id="4435292">0</span>&nbsp;<span class="op" id="4435294">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435298">return</span>&nbsp;<span class="builtintype" id="4435305">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435315">x</span><span class="op" id="4435316">.</span><span class="ident" id="4435317">Mod</span><span class="op" id="4435320">(</span><span class="ident" id="4435321">x</span><span class="op" id="4435322">,</span>&nbsp;<span class="ident" id="4435324">N</span><span class="op" id="4435325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435328">return</span>&nbsp;<span class="ident" id="4435335">x</span><span class="op" id="4435336">.</span><span class="ident" id="4435337">Cmp</span><span class="op" id="4435340">(</span><span class="ident" id="4435341">r</span><span class="op" id="4435342">)</span>&nbsp;<span class="op" id="4435344">==</span>&nbsp;<span class="num" id="4435347">0</span><br>
<span class="lineno"></span><span class="op" id="4435349">}</span>
</div>
</body>
</html>
