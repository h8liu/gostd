<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html" class="current">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4686377">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4686432">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4686486">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4686537">package</span>&nbsp;<span class="ident" id="4686545">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4686550">import</span>&nbsp;<span class="op" id="4686557">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4686560">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4686569">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4686576">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4686588">&#34;sort&#34;</span><br>
<span class="lineno"></span><span class="op" id="4686595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4686598">type</span>&nbsp;<span class="ident" id="4686603">byPos</span>&nbsp;<span class="op" id="4686609">[</span><span class="op" id="4686610">]</span><span class="op" id="4686611">*</span><span class="ident" id="4686612">CommentGroup</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4686626">func</span>&nbsp;<span class="op" id="4686631">(</span><span class="ident" id="4686632">a</span>&nbsp;<span class="ident" id="4686634">byPos</span><span class="op" id="4686639">)</span>&nbsp;<span class="ident" id="4686641">Len</span><span class="op" id="4686644">(</span><span class="op" id="4686645">)</span>&nbsp;<span class="builtintype" id="4686647">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4686661">{</span>&nbsp;<span class="keyword" id="4686663">return</span>&nbsp;<span class="builtinfunc" id="4686670">len</span><span class="op" id="4686673">(</span><span class="ident" id="4686674">a</span><span class="op" id="4686675">)</span>&nbsp;<span class="op" id="4686677">}</span><br>
<span class="lineno"></span><span class="keyword" id="4686679">func</span>&nbsp;<span class="op" id="4686684">(</span><span class="ident" id="4686685">a</span>&nbsp;<span class="ident" id="4686687">byPos</span><span class="op" id="4686692">)</span>&nbsp;<span class="ident" id="4686694">Less</span><span class="op" id="4686698">(</span><span class="ident" id="4686699">i</span><span class="op" id="4686700">,</span>&nbsp;<span class="ident" id="4686702">j</span>&nbsp;<span class="builtintype" id="4686704">int</span><span class="op" id="4686707">)</span>&nbsp;<span class="builtintype" id="4686709">bool</span>&nbsp;<span class="op" id="4686714">{</span>&nbsp;<span class="keyword" id="4686716">return</span>&nbsp;<span class="ident" id="4686723">a</span><span class="op" id="4686724">[</span><span class="ident" id="4686725">i</span><span class="op" id="4686726">]</span><span class="op" id="4686727">.</span><span class="ident" id="4686728">Pos</span><span class="op" id="4686731">(</span><span class="op" id="4686732">)</span>&nbsp;<span class="op" id="4686734">&lt;</span>&nbsp;<span class="ident" id="4686736">a</span><span class="op" id="4686737">[</span><span class="ident" id="4686738">j</span><span class="op" id="4686739">]</span><span class="op" id="4686740">.</span><span class="ident" id="4686741">Pos</span><span class="op" id="4686744">(</span><span class="op" id="4686745">)</span>&nbsp;<span class="op" id="4686747">}</span><br>
<span class="lineno"></span><span class="keyword" id="4686749">func</span>&nbsp;<span class="op" id="4686754">(</span><span class="ident" id="4686755">a</span>&nbsp;<span class="ident" id="4686757">byPos</span><span class="op" id="4686762">)</span>&nbsp;<span class="ident" id="4686764">Swap</span><span class="op" id="4686768">(</span><span class="ident" id="4686769">i</span><span class="op" id="4686770">,</span>&nbsp;<span class="ident" id="4686772">j</span>&nbsp;<span class="builtintype" id="4686774">int</span><span class="op" id="4686777">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4686784">{</span>&nbsp;<span class="ident" id="4686786">a</span><span class="op" id="4686787">[</span><span class="ident" id="4686788">i</span><span class="op" id="4686789">]</span><span class="op" id="4686790">,</span>&nbsp;<span class="ident" id="4686792">a</span><span class="op" id="4686793">[</span><span class="ident" id="4686794">j</span><span class="op" id="4686795">]</span>&nbsp;<span class="op" id="4686797">=</span>&nbsp;<span class="ident" id="4686799">a</span><span class="op" id="4686800">[</span><span class="ident" id="4686801">j</span><span class="op" id="4686802">]</span><span class="op" id="4686803">,</span>&nbsp;<span class="ident" id="4686805">a</span><span class="op" id="4686806">[</span><span class="ident" id="4686807">i</span><span class="op" id="4686808">]</span>&nbsp;<span class="op" id="4686810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4686813">//&nbsp;sortComments&nbsp;sorts&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="4686879">//</span><br>
<span class="lineno"></span><span class="keyword" id="4686882">func</span>&nbsp;<span class="ident" id="4686887">sortComments</span><span class="op" id="4686899">(</span><span class="ident" id="4686900">list</span>&nbsp;<span class="op" id="4686905">[</span><span class="op" id="4686906">]</span><span class="op" id="4686907">*</span><span class="ident" id="4686908">CommentGroup</span><span class="op" id="4686920">)</span>&nbsp;<span class="op" id="4686922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4686925">//&nbsp;TODO(gri):&nbsp;Does&nbsp;it&nbsp;make&nbsp;sense&nbsp;to&nbsp;check&nbsp;for&nbsp;sorted-ness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4686984">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first&nbsp;(because&nbsp;we&nbsp;know&nbsp;that&nbsp;sorted-ness&nbsp;is</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4687042">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;very&nbsp;likely)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687071">if</span>&nbsp;<span class="ident" id="4687074">orderedList</span>&nbsp;<span class="op" id="4687086">:=</span>&nbsp;<span class="ident" id="4687089">byPos</span><span class="op" id="4687094">(</span><span class="ident" id="4687095">list</span><span class="op" id="4687099">)</span><span class="op" id="4687100">;</span>&nbsp;<span class="op" id="4687102">!</span><span class="ident" id="4687103">sort</span><span class="op" id="4687107">.</span><span class="ident" id="4687108">IsSorted</span><span class="op" id="4687116">(</span><span class="ident" id="4687117">orderedList</span><span class="op" id="4687128">)</span>&nbsp;<span class="op" id="4687130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687134">sort</span><span class="op" id="4687138">.</span><span class="ident" id="4687139">Sort</span><span class="op" id="4687143">(</span><span class="ident" id="4687144">orderedList</span><span class="op" id="4687155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687158">}</span><br>
<span class="lineno"></span><span class="op" id="4687160">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4687163">//&nbsp;A&nbsp;CommentMap&nbsp;maps&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="4687224">//&nbsp;associated&nbsp;with&nbsp;it.&nbsp;See&nbsp;NewCommentMap&nbsp;for&nbsp;a&nbsp;description&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4687286">//&nbsp;the&nbsp;association.</span><br>
<span class="lineno"></span><span class="comment" id="4687306">//</span><br>
<span class="lineno">35</span><span class="keyword" id="4687309">type</span>&nbsp;<span class="ident" id="4687314">CommentMap</span>&nbsp;<span class="keyword" id="4687325">map</span><span class="op" id="4687328">[</span><span class="ident" id="4687329">Node</span><span class="op" id="4687333">]</span><span class="op" id="4687334">[</span><span class="op" id="4687335">]</span><span class="op" id="4687336">*</span><span class="ident" id="4687337">CommentGroup</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4687351">func</span>&nbsp;<span class="op" id="4687356">(</span><span class="ident" id="4687357">cmap</span>&nbsp;<span class="ident" id="4687362">CommentMap</span><span class="op" id="4687372">)</span>&nbsp;<span class="ident" id="4687374">addComment</span><span class="op" id="4687384">(</span><span class="ident" id="4687385">n</span>&nbsp;<span class="ident" id="4687387">Node</span><span class="op" id="4687391">,</span>&nbsp;<span class="ident" id="4687393">c</span>&nbsp;<span class="op" id="4687395">*</span><span class="ident" id="4687396">CommentGroup</span><span class="op" id="4687408">)</span>&nbsp;<span class="op" id="4687410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687413">list</span>&nbsp;<span class="op" id="4687418">:=</span>&nbsp;<span class="ident" id="4687421">cmap</span><span class="op" id="4687425">[</span><span class="ident" id="4687426">n</span><span class="op" id="4687427">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687430">if</span>&nbsp;<span class="builtinfunc" id="4687433">len</span><span class="op" id="4687436">(</span><span class="ident" id="4687437">list</span><span class="op" id="4687441">)</span>&nbsp;<span class="op" id="4687443">==</span>&nbsp;<span class="num" id="4687446">0</span>&nbsp;<span class="op" id="4687448">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687452">list</span>&nbsp;<span class="op" id="4687457">=</span>&nbsp;<span class="op" id="4687459">[</span><span class="op" id="4687460">]</span><span class="op" id="4687461">*</span><span class="ident" id="4687462">CommentGroup</span><span class="op" id="4687474">{</span><span class="ident" id="4687475">c</span><span class="op" id="4687476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687479">}</span>&nbsp;<span class="keyword" id="4687481">else</span>&nbsp;<span class="op" id="4687486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687490">list</span>&nbsp;<span class="op" id="4687495">=</span>&nbsp;<span class="builtinfunc" id="4687497">append</span><span class="op" id="4687503">(</span><span class="ident" id="4687504">list</span><span class="op" id="4687508">,</span>&nbsp;<span class="ident" id="4687510">c</span><span class="op" id="4687511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687517">cmap</span><span class="op" id="4687521">[</span><span class="ident" id="4687522">n</span><span class="op" id="4687523">]</span>&nbsp;<span class="op" id="4687525">=</span>&nbsp;<span class="ident" id="4687527">list</span><br>
<span class="lineno">45</span><span class="op" id="4687532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4687535">type</span>&nbsp;<span class="ident" id="4687540">byInterval</span>&nbsp;<span class="op" id="4687551">[</span><span class="op" id="4687552">]</span><span class="ident" id="4687553">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4687559">func</span>&nbsp;<span class="op" id="4687564">(</span><span class="ident" id="4687565">a</span>&nbsp;<span class="ident" id="4687567">byInterval</span><span class="op" id="4687577">)</span>&nbsp;<span class="ident" id="4687579">Len</span><span class="op" id="4687582">(</span><span class="op" id="4687583">)</span>&nbsp;<span class="builtintype" id="4687585">int</span>&nbsp;<span class="op" id="4687589">{</span>&nbsp;<span class="keyword" id="4687591">return</span>&nbsp;<span class="builtinfunc" id="4687598">len</span><span class="op" id="4687601">(</span><span class="ident" id="4687602">a</span><span class="op" id="4687603">)</span>&nbsp;<span class="op" id="4687605">}</span><br>
<span class="lineno">50</span><span class="keyword" id="4687607">func</span>&nbsp;<span class="op" id="4687612">(</span><span class="ident" id="4687613">a</span>&nbsp;<span class="ident" id="4687615">byInterval</span><span class="op" id="4687625">)</span>&nbsp;<span class="ident" id="4687627">Less</span><span class="op" id="4687631">(</span><span class="ident" id="4687632">i</span><span class="op" id="4687633">,</span>&nbsp;<span class="ident" id="4687635">j</span>&nbsp;<span class="builtintype" id="4687637">int</span><span class="op" id="4687640">)</span>&nbsp;<span class="builtintype" id="4687642">bool</span>&nbsp;<span class="op" id="4687647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687650">pi</span><span class="op" id="4687652">,</span>&nbsp;<span class="ident" id="4687654">pj</span>&nbsp;<span class="op" id="4687657">:=</span>&nbsp;<span class="ident" id="4687660">a</span><span class="op" id="4687661">[</span><span class="ident" id="4687662">i</span><span class="op" id="4687663">]</span><span class="op" id="4687664">.</span><span class="ident" id="4687665">Pos</span><span class="op" id="4687668">(</span><span class="op" id="4687669">)</span><span class="op" id="4687670">,</span>&nbsp;<span class="ident" id="4687672">a</span><span class="op" id="4687673">[</span><span class="ident" id="4687674">j</span><span class="op" id="4687675">]</span><span class="op" id="4687676">.</span><span class="ident" id="4687677">Pos</span><span class="op" id="4687680">(</span><span class="op" id="4687681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687684">return</span>&nbsp;<span class="ident" id="4687691">pi</span>&nbsp;<span class="op" id="4687694">&lt;</span>&nbsp;<span class="ident" id="4687696">pj</span>&nbsp;<span class="op" id="4687699">||</span>&nbsp;<span class="ident" id="4687702">pi</span>&nbsp;<span class="op" id="4687705">==</span>&nbsp;<span class="ident" id="4687708">pj</span>&nbsp;<span class="op" id="4687711">&amp;&amp;</span>&nbsp;<span class="ident" id="4687714">a</span><span class="op" id="4687715">[</span><span class="ident" id="4687716">i</span><span class="op" id="4687717">]</span><span class="op" id="4687718">.</span><span class="ident" id="4687719">End</span><span class="op" id="4687722">(</span><span class="op" id="4687723">)</span>&nbsp;<span class="op" id="4687725">&gt;</span>&nbsp;<span class="ident" id="4687727">a</span><span class="op" id="4687728">[</span><span class="ident" id="4687729">j</span><span class="op" id="4687730">]</span><span class="op" id="4687731">.</span><span class="ident" id="4687732">End</span><span class="op" id="4687735">(</span><span class="op" id="4687736">)</span><br>
<span class="lineno"></span><span class="op" id="4687738">}</span><br>
<span class="lineno"></span><span class="keyword" id="4687740">func</span>&nbsp;<span class="op" id="4687745">(</span><span class="ident" id="4687746">a</span>&nbsp;<span class="ident" id="4687748">byInterval</span><span class="op" id="4687758">)</span>&nbsp;<span class="ident" id="4687760">Swap</span><span class="op" id="4687764">(</span><span class="ident" id="4687765">i</span><span class="op" id="4687766">,</span>&nbsp;<span class="ident" id="4687768">j</span>&nbsp;<span class="builtintype" id="4687770">int</span><span class="op" id="4687773">)</span>&nbsp;<span class="op" id="4687775">{</span>&nbsp;<span class="ident" id="4687777">a</span><span class="op" id="4687778">[</span><span class="ident" id="4687779">i</span><span class="op" id="4687780">]</span><span class="op" id="4687781">,</span>&nbsp;<span class="ident" id="4687783">a</span><span class="op" id="4687784">[</span><span class="ident" id="4687785">j</span><span class="op" id="4687786">]</span>&nbsp;<span class="op" id="4687788">=</span>&nbsp;<span class="ident" id="4687790">a</span><span class="op" id="4687791">[</span><span class="ident" id="4687792">j</span><span class="op" id="4687793">]</span><span class="op" id="4687794">,</span>&nbsp;<span class="ident" id="4687796">a</span><span class="op" id="4687797">[</span><span class="ident" id="4687798">i</span><span class="op" id="4687799">]</span>&nbsp;<span class="op" id="4687801">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4687804">//&nbsp;nodeList&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;n&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="4687872">//</span><br>
<span class="lineno"></span><span class="keyword" id="4687875">func</span>&nbsp;<span class="ident" id="4687880">nodeList</span><span class="op" id="4687888">(</span><span class="ident" id="4687889">n</span>&nbsp;<span class="ident" id="4687891">Node</span><span class="op" id="4687895">)</span>&nbsp;<span class="op" id="4687897">[</span><span class="op" id="4687898">]</span><span class="ident" id="4687899">Node</span>&nbsp;<span class="op" id="4687904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687907">var</span>&nbsp;<span class="ident" id="4687911">list</span>&nbsp;<span class="op" id="4687916">[</span><span class="op" id="4687917">]</span><span class="ident" id="4687918">Node</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687924">Inspect</span><span class="op" id="4687931">(</span><span class="ident" id="4687932">n</span><span class="op" id="4687933">,</span>&nbsp;<span class="keyword" id="4687935">func</span><span class="op" id="4687939">(</span><span class="ident" id="4687940">n</span>&nbsp;<span class="ident" id="4687942">Node</span><span class="op" id="4687946">)</span>&nbsp;<span class="builtintype" id="4687948">bool</span>&nbsp;<span class="op" id="4687953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4687957">//&nbsp;don&#39;t&nbsp;collect&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687985">switch</span>&nbsp;<span class="ident" id="4687992">n</span><span class="op" id="4687993">.</span><span class="op" id="4687994">(</span><span class="keyword" id="4687995">type</span><span class="op" id="4687999">)</span>&nbsp;<span class="op" id="4688001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688005">case</span>&nbsp;<span class="ident" id="4688010">nil</span><span class="op" id="4688013">,</span>&nbsp;<span class="op" id="4688015">*</span><span class="ident" id="4688016">CommentGroup</span><span class="op" id="4688028">,</span>&nbsp;<span class="op" id="4688030">*</span><span class="ident" id="4688031">Comment</span><span class="op" id="4688038">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688043">return</span>&nbsp;<span class="builtintype" id="4688050">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688062">list</span>&nbsp;<span class="op" id="4688067">=</span>&nbsp;<span class="builtinfunc" id="4688069">append</span><span class="op" id="4688075">(</span><span class="ident" id="4688076">list</span><span class="op" id="4688080">,</span>&nbsp;<span class="ident" id="4688082">n</span><span class="op" id="4688083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688087">return</span>&nbsp;<span class="builtintype" id="4688094">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688100">}</span><span class="op" id="4688101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4688104">//&nbsp;Note:&nbsp;The&nbsp;current&nbsp;implementation&nbsp;assumes&nbsp;that&nbsp;Inspect&nbsp;traverses&nbsp;the</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4688176">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AST&nbsp;in&nbsp;depth-first&nbsp;and&nbsp;thus&nbsp;_source_&nbsp;order.&nbsp;If&nbsp;AST&nbsp;traversal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4688247">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;does&nbsp;not&nbsp;follow&nbsp;source&nbsp;order,&nbsp;the&nbsp;sorting&nbsp;call&nbsp;below&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4688318">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4688338">//&nbsp;sort.Sort(byInterval(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688370">return</span>&nbsp;<span class="ident" id="4688377">list</span><br>
<span class="lineno">75</span><span class="op" id="4688382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4688385">//&nbsp;A&nbsp;commentListReader&nbsp;helps&nbsp;iterating&nbsp;through&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups.</span><br>
<span class="lineno"></span><span class="comment" id="4688458">//</span><br>
<span class="lineno"></span><span class="keyword" id="4688461">type</span>&nbsp;<span class="ident" id="4688466">commentListReader</span>&nbsp;<span class="keyword" id="4688484">struct</span>&nbsp;<span class="op" id="4688491">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688494">fset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688503">*</span><span class="ident" id="4688504">token</span><span class="op" id="4688509">.</span><span class="ident" id="4688510">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688519">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688528">[</span><span class="op" id="4688529">]</span><span class="op" id="4688530">*</span><span class="ident" id="4688531">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688545">index</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4688554">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688559">comment</span>&nbsp;&nbsp;<span class="op" id="4688568">*</span><span class="ident" id="4688569">CommentGroup</span>&nbsp;&nbsp;<span class="comment" id="4688583">//&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688618">pos</span><span class="op" id="4688621">,</span>&nbsp;<span class="ident" id="4688623">end</span>&nbsp;<span class="ident" id="4688627">token</span><span class="op" id="4688632">.</span><span class="ident" id="4688633">Position</span>&nbsp;<span class="comment" id="4688642">//&nbsp;source&nbsp;interval&nbsp;of&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno">85</span><span class="op" id="4688695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4688698">func</span>&nbsp;<span class="op" id="4688703">(</span><span class="ident" id="4688704">r</span>&nbsp;<span class="op" id="4688706">*</span><span class="ident" id="4688707">commentListReader</span><span class="op" id="4688724">)</span>&nbsp;<span class="ident" id="4688726">eol</span><span class="op" id="4688729">(</span><span class="op" id="4688730">)</span>&nbsp;<span class="builtintype" id="4688732">bool</span>&nbsp;<span class="op" id="4688737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688740">return</span>&nbsp;<span class="ident" id="4688747">r</span><span class="op" id="4688748">.</span><span class="ident" id="4688749">index</span>&nbsp;<span class="op" id="4688755">&gt;=</span>&nbsp;<span class="builtinfunc" id="4688758">len</span><span class="op" id="4688761">(</span><span class="ident" id="4688762">r</span><span class="op" id="4688763">.</span><span class="ident" id="4688764">list</span><span class="op" id="4688768">)</span><br>
<span class="lineno"></span><span class="op" id="4688770">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="4688773">func</span>&nbsp;<span class="op" id="4688778">(</span><span class="ident" id="4688779">r</span>&nbsp;<span class="op" id="4688781">*</span><span class="ident" id="4688782">commentListReader</span><span class="op" id="4688799">)</span>&nbsp;<span class="ident" id="4688801">next</span><span class="op" id="4688805">(</span><span class="op" id="4688806">)</span>&nbsp;<span class="op" id="4688808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688811">if</span>&nbsp;<span class="op" id="4688814">!</span><span class="ident" id="4688815">r</span><span class="op" id="4688816">.</span><span class="ident" id="4688817">eol</span><span class="op" id="4688820">(</span><span class="op" id="4688821">)</span>&nbsp;<span class="op" id="4688823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688827">r</span><span class="op" id="4688828">.</span><span class="ident" id="4688829">comment</span>&nbsp;<span class="op" id="4688837">=</span>&nbsp;<span class="ident" id="4688839">r</span><span class="op" id="4688840">.</span><span class="ident" id="4688841">list</span><span class="op" id="4688845">[</span><span class="ident" id="4688846">r</span><span class="op" id="4688847">.</span><span class="ident" id="4688848">index</span><span class="op" id="4688853">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688857">r</span><span class="op" id="4688858">.</span><span class="ident" id="4688859">pos</span>&nbsp;<span class="op" id="4688863">=</span>&nbsp;<span class="ident" id="4688865">r</span><span class="op" id="4688866">.</span><span class="ident" id="4688867">fset</span><span class="op" id="4688871">.</span><span class="ident" id="4688872">Position</span><span class="op" id="4688880">(</span><span class="ident" id="4688881">r</span><span class="op" id="4688882">.</span><span class="ident" id="4688883">comment</span><span class="op" id="4688890">.</span><span class="ident" id="4688891">Pos</span><span class="op" id="4688894">(</span><span class="op" id="4688895">)</span><span class="op" id="4688896">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688900">r</span><span class="op" id="4688901">.</span><span class="ident" id="4688902">end</span>&nbsp;<span class="op" id="4688906">=</span>&nbsp;<span class="ident" id="4688908">r</span><span class="op" id="4688909">.</span><span class="ident" id="4688910">fset</span><span class="op" id="4688914">.</span><span class="ident" id="4688915">Position</span><span class="op" id="4688923">(</span><span class="ident" id="4688924">r</span><span class="op" id="4688925">.</span><span class="ident" id="4688926">comment</span><span class="op" id="4688933">.</span><span class="ident" id="4688934">End</span><span class="op" id="4688937">(</span><span class="op" id="4688938">)</span><span class="op" id="4688939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688943">r</span><span class="op" id="4688944">.</span><span class="ident" id="4688945">index</span><span class="op" id="4688950">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688954">}</span><br>
<span class="lineno"></span><span class="op" id="4688956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="4688959">//&nbsp;A&nbsp;nodeStack&nbsp;keeps&nbsp;track&nbsp;of&nbsp;nested&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="4689003">//&nbsp;A&nbsp;node&nbsp;lower&nbsp;on&nbsp;the&nbsp;stack&nbsp;lexically&nbsp;contains&nbsp;the&nbsp;nodes&nbsp;higher&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="4689082">//</span><br>
<span class="lineno"></span><span class="keyword" id="4689085">type</span>&nbsp;<span class="ident" id="4689090">nodeStack</span>&nbsp;<span class="op" id="4689100">[</span><span class="op" id="4689101">]</span><span class="ident" id="4689102">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4689108">//&nbsp;push&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4689162">//&nbsp;and&nbsp;then&nbsp;pushes&nbsp;n&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="4689197">//</span><br>
<span class="lineno"></span><span class="keyword" id="4689200">func</span>&nbsp;<span class="op" id="4689205">(</span><span class="ident" id="4689206">s</span>&nbsp;<span class="op" id="4689208">*</span><span class="ident" id="4689209">nodeStack</span><span class="op" id="4689218">)</span>&nbsp;<span class="ident" id="4689220">push</span><span class="op" id="4689224">(</span><span class="ident" id="4689225">n</span>&nbsp;<span class="ident" id="4689227">Node</span><span class="op" id="4689231">)</span>&nbsp;<span class="op" id="4689233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689236">s</span><span class="op" id="4689237">.</span><span class="ident" id="4689238">pop</span><span class="op" id="4689241">(</span><span class="ident" id="4689242">n</span><span class="op" id="4689243">.</span><span class="ident" id="4689244">Pos</span><span class="op" id="4689247">(</span><span class="op" id="4689248">)</span><span class="op" id="4689249">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4689252">*</span><span class="ident" id="4689253">s</span>&nbsp;<span class="op" id="4689255">=</span>&nbsp;<span class="builtinfunc" id="4689257">append</span><span class="op" id="4689263">(</span><span class="op" id="4689264">(</span><span class="op" id="4689265">*</span><span class="ident" id="4689266">s</span><span class="op" id="4689267">)</span><span class="op" id="4689268">,</span>&nbsp;<span class="ident" id="4689270">n</span><span class="op" id="4689271">)</span><br>
<span class="lineno"></span><span class="op" id="4689273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4689276">//&nbsp;pop&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="4689331">//&nbsp;(i.e.,&nbsp;whose&nbsp;lexical&nbsp;extent&nbsp;has&nbsp;ended&nbsp;before&nbsp;or&nbsp;at&nbsp;pos).</span><br>
<span class="lineno">115</span><span class="comment" id="4689391">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;last&nbsp;node&nbsp;popped.</span><br>
<span class="lineno"></span><span class="comment" id="4689427">//</span><br>
<span class="lineno"></span><span class="keyword" id="4689430">func</span>&nbsp;<span class="op" id="4689435">(</span><span class="ident" id="4689436">s</span>&nbsp;<span class="op" id="4689438">*</span><span class="ident" id="4689439">nodeStack</span><span class="op" id="4689448">)</span>&nbsp;<span class="ident" id="4689450">pop</span><span class="op" id="4689453">(</span><span class="ident" id="4689454">pos</span>&nbsp;<span class="ident" id="4689458">token</span><span class="op" id="4689463">.</span><span class="ident" id="4689464">Pos</span><span class="op" id="4689467">)</span>&nbsp;<span class="op" id="4689469">(</span><span class="ident" id="4689470">top</span>&nbsp;<span class="ident" id="4689474">Node</span><span class="op" id="4689478">)</span>&nbsp;<span class="op" id="4689480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689483">i</span>&nbsp;<span class="op" id="4689485">:=</span>&nbsp;<span class="builtinfunc" id="4689488">len</span><span class="op" id="4689491">(</span><span class="op" id="4689492">*</span><span class="ident" id="4689493">s</span><span class="op" id="4689494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689497">for</span>&nbsp;<span class="ident" id="4689501">i</span>&nbsp;<span class="op" id="4689503">&gt;</span>&nbsp;<span class="num" id="4689505">0</span>&nbsp;<span class="op" id="4689507">&amp;&amp;</span>&nbsp;<span class="op" id="4689510">(</span><span class="op" id="4689511">*</span><span class="ident" id="4689512">s</span><span class="op" id="4689513">)</span><span class="op" id="4689514">[</span><span class="ident" id="4689515">i</span><span class="op" id="4689516">-</span><span class="num" id="4689517">1</span><span class="op" id="4689518">]</span><span class="op" id="4689519">.</span><span class="ident" id="4689520">End</span><span class="op" id="4689523">(</span><span class="op" id="4689524">)</span>&nbsp;<span class="op" id="4689526">&lt;=</span>&nbsp;<span class="ident" id="4689529">pos</span>&nbsp;<span class="op" id="4689533">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689537">top</span>&nbsp;<span class="op" id="4689541">=</span>&nbsp;<span class="op" id="4689543">(</span><span class="op" id="4689544">*</span><span class="ident" id="4689545">s</span><span class="op" id="4689546">)</span><span class="op" id="4689547">[</span><span class="ident" id="4689548">i</span><span class="op" id="4689549">-</span><span class="num" id="4689550">1</span><span class="op" id="4689551">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689555">i</span><span class="op" id="4689556">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4689560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4689563">*</span><span class="ident" id="4689564">s</span>&nbsp;<span class="op" id="4689566">=</span>&nbsp;<span class="op" id="4689568">(</span><span class="op" id="4689569">*</span><span class="ident" id="4689570">s</span><span class="op" id="4689571">)</span><span class="op" id="4689572">[</span><span class="num" id="4689573">0</span><span class="op" id="4689574">:</span><span class="ident" id="4689575">i</span><span class="op" id="4689576">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689579">return</span>&nbsp;<span class="ident" id="4689586">top</span><br>
<span class="lineno">125</span><span class="op" id="4689590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4689593">//&nbsp;NewCommentMap&nbsp;creates&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;by&nbsp;associating&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="4689666">//&nbsp;of&nbsp;the&nbsp;comments&nbsp;list&nbsp;with&nbsp;the&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="4689735">//</span><br>
<span class="lineno">130</span><span class="comment" id="4689738">//&nbsp;A&nbsp;comment&nbsp;group&nbsp;g&nbsp;is&nbsp;associated&nbsp;with&nbsp;a&nbsp;node&nbsp;n&nbsp;if:</span><br>
<span class="lineno"></span><span class="comment" id="4689791">//</span><br>
<span class="lineno"></span><span class="comment" id="4689794">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;n&nbsp;ends</span><br>
<span class="lineno"></span><span class="comment" id="4689837">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;following&nbsp;n,&nbsp;and&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4689903">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;least&nbsp;one&nbsp;empty&nbsp;line&nbsp;after&nbsp;g&nbsp;and&nbsp;before&nbsp;the&nbsp;next&nbsp;node</span><br>
<span class="lineno">135</span><span class="comment" id="4689967">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;before&nbsp;n&nbsp;and&nbsp;is&nbsp;not&nbsp;associated&nbsp;to&nbsp;the&nbsp;node&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4690035">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;via&nbsp;the&nbsp;previous&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="4690065">//</span><br>
<span class="lineno"></span><span class="comment" id="4690068">//&nbsp;NewCommentMap&nbsp;tries&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;&#34;largest&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4690137">//&nbsp;node&nbsp;possible:&nbsp;For&nbsp;instance,&nbsp;if&nbsp;the&nbsp;comment&nbsp;is&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno">140</span><span class="comment" id="4690202">//&nbsp;trailing&nbsp;an&nbsp;assignment,&nbsp;the&nbsp;comment&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="4690271">//&nbsp;assignment&nbsp;rather&nbsp;than&nbsp;just&nbsp;the&nbsp;last&nbsp;operand&nbsp;in&nbsp;the&nbsp;assignment.</span><br>
<span class="lineno"></span><span class="comment" id="4690338">//</span><br>
<span class="lineno"></span><span class="keyword" id="4690341">func</span>&nbsp;<span class="ident" id="4690346">NewCommentMap</span><span class="op" id="4690359">(</span><span class="ident" id="4690360">fset</span>&nbsp;<span class="op" id="4690365">*</span><span class="ident" id="4690366">token</span><span class="op" id="4690371">.</span><span class="ident" id="4690372">FileSet</span><span class="op" id="4690379">,</span>&nbsp;<span class="ident" id="4690381">node</span>&nbsp;<span class="ident" id="4690386">Node</span><span class="op" id="4690390">,</span>&nbsp;<span class="ident" id="4690392">comments</span>&nbsp;<span class="op" id="4690401">[</span><span class="op" id="4690402">]</span><span class="op" id="4690403">*</span><span class="ident" id="4690404">CommentGroup</span><span class="op" id="4690416">)</span>&nbsp;<span class="ident" id="4690418">CommentMap</span>&nbsp;<span class="op" id="4690429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690432">if</span>&nbsp;<span class="builtinfunc" id="4690435">len</span><span class="op" id="4690438">(</span><span class="ident" id="4690439">comments</span><span class="op" id="4690447">)</span>&nbsp;<span class="op" id="4690449">==</span>&nbsp;<span class="num" id="4690452">0</span>&nbsp;<span class="op" id="4690454">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690458">return</span>&nbsp;<span class="ident" id="4690465">nil</span>&nbsp;<span class="comment" id="4690469">//&nbsp;no&nbsp;comments&nbsp;to&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4690492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690496">cmap</span>&nbsp;<span class="op" id="4690501">:=</span>&nbsp;<span class="builtinfunc" id="4690504">make</span><span class="op" id="4690508">(</span><span class="ident" id="4690509">CommentMap</span><span class="op" id="4690519">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4690523">//&nbsp;set&nbsp;up&nbsp;comment&nbsp;reader&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690551">tmp</span>&nbsp;<span class="op" id="4690555">:=</span>&nbsp;<span class="builtinfunc" id="4690558">make</span><span class="op" id="4690562">(</span><span class="op" id="4690563">[</span><span class="op" id="4690564">]</span><span class="op" id="4690565">*</span><span class="ident" id="4690566">CommentGroup</span><span class="op" id="4690578">,</span>&nbsp;<span class="builtinfunc" id="4690580">len</span><span class="op" id="4690583">(</span><span class="ident" id="4690584">comments</span><span class="op" id="4690592">)</span><span class="op" id="4690593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4690596">copy</span><span class="op" id="4690600">(</span><span class="ident" id="4690601">tmp</span><span class="op" id="4690604">,</span>&nbsp;<span class="ident" id="4690606">comments</span><span class="op" id="4690614">)</span>&nbsp;<span class="comment" id="4690616">//&nbsp;don&#39;t&nbsp;change&nbsp;incoming&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690651">sortComments</span><span class="op" id="4690663">(</span><span class="ident" id="4690664">tmp</span><span class="op" id="4690667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690670">r</span>&nbsp;<span class="op" id="4690672">:=</span>&nbsp;<span class="ident" id="4690675">commentListReader</span><span class="op" id="4690692">{</span><span class="ident" id="4690693">fset</span><span class="op" id="4690697">:</span>&nbsp;<span class="ident" id="4690699">fset</span><span class="op" id="4690703">,</span>&nbsp;<span class="ident" id="4690705">list</span><span class="op" id="4690709">:</span>&nbsp;<span class="ident" id="4690711">tmp</span><span class="op" id="4690714">}</span>&nbsp;<span class="comment" id="4690716">//&nbsp;!r.eol()&nbsp;because&nbsp;len(comments)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690755">r</span><span class="op" id="4690756">.</span><span class="ident" id="4690757">next</span><span class="op" id="4690761">(</span><span class="op" id="4690762">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4690766">//&nbsp;create&nbsp;node&nbsp;list&nbsp;in&nbsp;lexical&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690804">nodes</span>&nbsp;<span class="op" id="4690810">:=</span>&nbsp;<span class="ident" id="4690813">nodeList</span><span class="op" id="4690821">(</span><span class="ident" id="4690822">node</span><span class="op" id="4690826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690829">nodes</span>&nbsp;<span class="op" id="4690835">=</span>&nbsp;<span class="builtinfunc" id="4690837">append</span><span class="op" id="4690843">(</span><span class="ident" id="4690844">nodes</span><span class="op" id="4690849">,</span>&nbsp;<span class="ident" id="4690851">nil</span><span class="op" id="4690854">)</span>&nbsp;<span class="comment" id="4690856">//&nbsp;append&nbsp;sentinel</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4690877">//&nbsp;set&nbsp;up&nbsp;iteration&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690908">var</span>&nbsp;<span class="op" id="4690912">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690916">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690922">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4690937">//&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690956">pend</span>&nbsp;&nbsp;<span class="ident" id="4690962">token</span><span class="op" id="4690967">.</span><span class="ident" id="4690968">Position</span>&nbsp;<span class="comment" id="4690977">//&nbsp;end&nbsp;of&nbsp;p</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690991">pg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690997">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4691012">//&nbsp;previous&nbsp;node&nbsp;group&nbsp;(enclosing&nbsp;nodes&nbsp;of&nbsp;&#34;importance&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691071">pgend</span>&nbsp;<span class="ident" id="4691077">token</span><span class="op" id="4691082">.</span><span class="ident" id="4691083">Position</span>&nbsp;<span class="comment" id="4691092">//&nbsp;end&nbsp;of&nbsp;pg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691107">stack</span>&nbsp;<span class="ident" id="4691113">nodeStack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4691128">//&nbsp;stack&nbsp;of&nbsp;node&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4691153">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691157">for</span>&nbsp;<span class="ident" id="4691161">_</span><span class="op" id="4691162">,</span>&nbsp;<span class="ident" id="4691164">q</span>&nbsp;<span class="op" id="4691166">:=</span>&nbsp;<span class="keyword" id="4691169">range</span>&nbsp;<span class="ident" id="4691175">nodes</span>&nbsp;<span class="op" id="4691181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691185">var</span>&nbsp;<span class="ident" id="4691189">qpos</span>&nbsp;<span class="ident" id="4691194">token</span><span class="op" id="4691199">.</span><span class="ident" id="4691200">Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691211">if</span>&nbsp;<span class="ident" id="4691214">q</span>&nbsp;<span class="op" id="4691216">!=</span>&nbsp;<span class="ident" id="4691219">nil</span>&nbsp;<span class="op" id="4691223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691228">qpos</span>&nbsp;<span class="op" id="4691233">=</span>&nbsp;<span class="ident" id="4691235">fset</span><span class="op" id="4691239">.</span><span class="ident" id="4691240">Position</span><span class="op" id="4691248">(</span><span class="ident" id="4691249">q</span><span class="op" id="4691250">.</span><span class="ident" id="4691251">Pos</span><span class="op" id="4691254">(</span><span class="op" id="4691255">)</span><span class="op" id="4691256">)</span>&nbsp;<span class="comment" id="4691258">//&nbsp;current&nbsp;node&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4691285">}</span>&nbsp;<span class="keyword" id="4691287">else</span>&nbsp;<span class="op" id="4691292">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4691297">//&nbsp;set&nbsp;fake&nbsp;sentinel&nbsp;position&nbsp;to&nbsp;infinity&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4691350">//&nbsp;all&nbsp;comments&nbsp;get&nbsp;processed&nbsp;before&nbsp;the&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691403">const</span>&nbsp;<span class="ident" id="4691409">infinity</span>&nbsp;<span class="op" id="4691418">=</span>&nbsp;<span class="num" id="4691420">1</span>&nbsp;<span class="op" id="4691422">&lt;&lt;</span>&nbsp;<span class="num" id="4691425">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691431">qpos</span><span class="op" id="4691435">.</span><span class="ident" id="4691436">Offset</span>&nbsp;<span class="op" id="4691443">=</span>&nbsp;<span class="ident" id="4691445">infinity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691457">qpos</span><span class="op" id="4691461">.</span><span class="ident" id="4691462">Line</span>&nbsp;<span class="op" id="4691467">=</span>&nbsp;<span class="ident" id="4691469">infinity</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4691480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4691485">//&nbsp;process&nbsp;comments&nbsp;before&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691527">for</span>&nbsp;<span class="ident" id="4691531">r</span><span class="op" id="4691532">.</span><span class="ident" id="4691533">end</span><span class="op" id="4691536">.</span><span class="ident" id="4691537">Offset</span>&nbsp;<span class="op" id="4691544">&lt;=</span>&nbsp;<span class="ident" id="4691547">qpos</span><span class="op" id="4691551">.</span><span class="ident" id="4691552">Offset</span>&nbsp;<span class="op" id="4691559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4691564">//&nbsp;determine&nbsp;recent&nbsp;node&nbsp;group</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691598">if</span>&nbsp;<span class="ident" id="4691601">top</span>&nbsp;<span class="op" id="4691605">:=</span>&nbsp;<span class="ident" id="4691608">stack</span><span class="op" id="4691613">.</span><span class="ident" id="4691614">pop</span><span class="op" id="4691617">(</span><span class="ident" id="4691618">r</span><span class="op" id="4691619">.</span><span class="ident" id="4691620">comment</span><span class="op" id="4691627">.</span><span class="ident" id="4691628">Pos</span><span class="op" id="4691631">(</span><span class="op" id="4691632">)</span><span class="op" id="4691633">)</span><span class="op" id="4691634">;</span>&nbsp;<span class="ident" id="4691636">top</span>&nbsp;<span class="op" id="4691640">!=</span>&nbsp;<span class="ident" id="4691643">nil</span>&nbsp;<span class="op" id="4691647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691653">pg</span>&nbsp;<span class="op" id="4691656">=</span>&nbsp;<span class="ident" id="4691658">top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691666">pgend</span>&nbsp;<span class="op" id="4691672">=</span>&nbsp;<span class="ident" id="4691674">fset</span><span class="op" id="4691678">.</span><span class="ident" id="4691679">Position</span><span class="op" id="4691687">(</span><span class="ident" id="4691688">pg</span><span class="op" id="4691690">.</span><span class="ident" id="4691691">End</span><span class="op" id="4691694">(</span><span class="op" id="4691695">)</span><span class="op" id="4691696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4691701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4691706">//&nbsp;Try&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;first&nbsp;with&nbsp;a&nbsp;node&nbsp;group</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4691763">//&nbsp;(i.e.,&nbsp;a&nbsp;node&nbsp;of&nbsp;&#34;importance&#34;&nbsp;such&nbsp;as&nbsp;a&nbsp;declaration);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4691823">//&nbsp;if&nbsp;that&nbsp;fails,&nbsp;try&nbsp;to&nbsp;associate&nbsp;it&nbsp;with&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4691885">//&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4691897">//&nbsp;TODO(gri)&nbsp;try&nbsp;to&nbsp;simplify&nbsp;the&nbsp;logic&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691945">var</span>&nbsp;<span class="ident" id="4691949">assoc</span>&nbsp;<span class="ident" id="4691955">Node</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691963">switch</span>&nbsp;<span class="op" id="4691970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691975">case</span>&nbsp;<span class="ident" id="4691980">pg</span>&nbsp;<span class="op" id="4691983">!=</span>&nbsp;<span class="ident" id="4691986">nil</span>&nbsp;<span class="op" id="4691990">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4691997">(</span><span class="ident" id="4691998">pgend</span><span class="op" id="4692003">.</span><span class="ident" id="4692004">Line</span>&nbsp;<span class="op" id="4692009">==</span>&nbsp;<span class="ident" id="4692012">r</span><span class="op" id="4692013">.</span><span class="ident" id="4692014">pos</span><span class="op" id="4692017">.</span><span class="ident" id="4692018">Line</span>&nbsp;<span class="op" id="4692023">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692031">pgend</span><span class="op" id="4692036">.</span><span class="ident" id="4692037">Line</span><span class="op" id="4692041">+</span><span class="num" id="4692042">1</span>&nbsp;<span class="op" id="4692044">==</span>&nbsp;<span class="ident" id="4692047">r</span><span class="op" id="4692048">.</span><span class="ident" id="4692049">pos</span><span class="op" id="4692052">.</span><span class="ident" id="4692053">Line</span>&nbsp;<span class="op" id="4692058">&amp;&amp;</span>&nbsp;<span class="ident" id="4692061">r</span><span class="op" id="4692062">.</span><span class="ident" id="4692063">end</span><span class="op" id="4692066">.</span><span class="ident" id="4692067">Line</span><span class="op" id="4692071">+</span><span class="num" id="4692072">1</span>&nbsp;<span class="op" id="4692074">&lt;</span>&nbsp;<span class="ident" id="4692076">qpos</span><span class="op" id="4692080">.</span><span class="ident" id="4692081">Line</span><span class="op" id="4692085">)</span><span class="op" id="4692086">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4692092">//&nbsp;1)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;previous&nbsp;node&nbsp;group&nbsp;ends,&nbsp;or</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4692162">//&nbsp;2)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4692221">//&nbsp;&nbsp;&nbsp;&nbsp;previous&nbsp;node&nbsp;group&nbsp;and&nbsp;there&nbsp;is&nbsp;an&nbsp;empty&nbsp;line&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4692285">//&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4692312">//&nbsp;=&gt;&nbsp;associate&nbsp;comment&nbsp;with&nbsp;previous&nbsp;node&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692365">assoc</span>&nbsp;<span class="op" id="4692371">=</span>&nbsp;<span class="ident" id="4692373">pg</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692379">case</span>&nbsp;<span class="ident" id="4692384">p</span>&nbsp;<span class="op" id="4692386">!=</span>&nbsp;<span class="ident" id="4692389">nil</span>&nbsp;<span class="op" id="4692393">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4692400">(</span><span class="ident" id="4692401">pend</span><span class="op" id="4692405">.</span><span class="ident" id="4692406">Line</span>&nbsp;<span class="op" id="4692411">==</span>&nbsp;<span class="ident" id="4692414">r</span><span class="op" id="4692415">.</span><span class="ident" id="4692416">pos</span><span class="op" id="4692419">.</span><span class="ident" id="4692420">Line</span>&nbsp;<span class="op" id="4692425">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692433">pend</span><span class="op" id="4692437">.</span><span class="ident" id="4692438">Line</span><span class="op" id="4692442">+</span><span class="num" id="4692443">1</span>&nbsp;<span class="op" id="4692445">==</span>&nbsp;<span class="ident" id="4692448">r</span><span class="op" id="4692449">.</span><span class="ident" id="4692450">pos</span><span class="op" id="4692453">.</span><span class="ident" id="4692454">Line</span>&nbsp;<span class="op" id="4692459">&amp;&amp;</span>&nbsp;<span class="ident" id="4692462">r</span><span class="op" id="4692463">.</span><span class="ident" id="4692464">end</span><span class="op" id="4692467">.</span><span class="ident" id="4692468">Line</span><span class="op" id="4692472">+</span><span class="num" id="4692473">1</span>&nbsp;<span class="op" id="4692475">&lt;</span>&nbsp;<span class="ident" id="4692477">qpos</span><span class="op" id="4692481">.</span><span class="ident" id="4692482">Line</span>&nbsp;<span class="op" id="4692487">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692495">q</span>&nbsp;<span class="op" id="4692497">==</span>&nbsp;<span class="ident" id="4692500">nil</span><span class="op" id="4692503">)</span><span class="op" id="4692504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4692510">//&nbsp;same&nbsp;rules&nbsp;apply&nbsp;as&nbsp;above&nbsp;for&nbsp;p&nbsp;rather&nbsp;than&nbsp;pg,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4692565">//&nbsp;but&nbsp;also&nbsp;associate&nbsp;with&nbsp;p&nbsp;if&nbsp;we&nbsp;are&nbsp;at&nbsp;the&nbsp;end&nbsp;(q&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692630">assoc</span>&nbsp;<span class="op" id="4692636">=</span>&nbsp;<span class="ident" id="4692638">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692643">default</span><span class="op" id="4692650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4692656">//&nbsp;otherwise,&nbsp;associate&nbsp;comment&nbsp;with&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692710">if</span>&nbsp;<span class="ident" id="4692713">q</span>&nbsp;<span class="op" id="4692715">==</span>&nbsp;<span class="ident" id="4692718">nil</span>&nbsp;<span class="op" id="4692722">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4692729">//&nbsp;we&nbsp;can&nbsp;only&nbsp;reach&nbsp;here&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4692778">//&nbsp;which&nbsp;would&nbsp;imply&nbsp;that&nbsp;there&nbsp;were&nbsp;no&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4692829">panic</span><span class="op" id="4692834">(</span><span class="string" id="4692835">&#34;internal&nbsp;error:&nbsp;no&nbsp;comments&nbsp;should&nbsp;be&nbsp;associated&nbsp;with&nbsp;sentinel&#34;</span><span class="op" id="4692899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4692905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692911">assoc</span>&nbsp;<span class="op" id="4692917">=</span>&nbsp;<span class="ident" id="4692919">q</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4692924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692929">cmap</span><span class="op" id="4692933">.</span><span class="ident" id="4692934">addComment</span><span class="op" id="4692944">(</span><span class="ident" id="4692945">assoc</span><span class="op" id="4692950">,</span>&nbsp;<span class="ident" id="4692952">r</span><span class="op" id="4692953">.</span><span class="ident" id="4692954">comment</span><span class="op" id="4692961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692966">if</span>&nbsp;<span class="ident" id="4692969">r</span><span class="op" id="4692970">.</span><span class="ident" id="4692971">eol</span><span class="op" id="4692974">(</span><span class="op" id="4692975">)</span>&nbsp;<span class="op" id="4692977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692983">return</span>&nbsp;<span class="ident" id="4692990">cmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4692998">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693003">r</span><span class="op" id="4693004">.</span><span class="ident" id="4693005">next</span><span class="op" id="4693009">(</span><span class="op" id="4693010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4693019">//&nbsp;update&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693045">p</span>&nbsp;<span class="op" id="4693047">=</span>&nbsp;<span class="ident" id="4693049">q</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693053">pend</span>&nbsp;<span class="op" id="4693058">=</span>&nbsp;<span class="ident" id="4693060">fset</span><span class="op" id="4693064">.</span><span class="ident" id="4693065">Position</span><span class="op" id="4693073">(</span><span class="ident" id="4693074">p</span><span class="op" id="4693075">.</span><span class="ident" id="4693076">End</span><span class="op" id="4693079">(</span><span class="op" id="4693080">)</span><span class="op" id="4693081">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4693086">//&nbsp;update&nbsp;previous&nbsp;node&nbsp;group&nbsp;if&nbsp;we&nbsp;see&nbsp;an&nbsp;&#34;important&#34;&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693148">switch</span>&nbsp;<span class="ident" id="4693155">q</span><span class="op" id="4693156">.</span><span class="op" id="4693157">(</span><span class="keyword" id="4693158">type</span><span class="op" id="4693162">)</span>&nbsp;<span class="op" id="4693164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693168">case</span>&nbsp;<span class="op" id="4693173">*</span><span class="ident" id="4693174">File</span><span class="op" id="4693178">,</span>&nbsp;<span class="op" id="4693180">*</span><span class="ident" id="4693181">Field</span><span class="op" id="4693186">,</span>&nbsp;<span class="ident" id="4693188">Decl</span><span class="op" id="4693192">,</span>&nbsp;<span class="ident" id="4693194">Spec</span><span class="op" id="4693198">,</span>&nbsp;<span class="ident" id="4693200">Stmt</span><span class="op" id="4693204">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693209">stack</span><span class="op" id="4693214">.</span><span class="ident" id="4693215">push</span><span class="op" id="4693219">(</span><span class="ident" id="4693220">q</span><span class="op" id="4693221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693232">return</span>&nbsp;<span class="ident" id="4693239">cmap</span><br>
<span class="lineno">240</span><span class="op" id="4693244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4693247">//&nbsp;Update&nbsp;replaces&nbsp;an&nbsp;old&nbsp;node&nbsp;in&nbsp;the&nbsp;comment&nbsp;map&nbsp;with&nbsp;the&nbsp;new&nbsp;node</span><br>
<span class="lineno"></span><span class="comment" id="4693315">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;node.&nbsp;Comments&nbsp;that&nbsp;were&nbsp;associated&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4693383">//&nbsp;old&nbsp;node&nbsp;are&nbsp;associated&nbsp;with&nbsp;the&nbsp;new&nbsp;node.</span><br>
<span class="lineno">245</span><span class="comment" id="4693429">//</span><br>
<span class="lineno"></span><span class="keyword" id="4693432">func</span>&nbsp;<span class="op" id="4693437">(</span><span class="ident" id="4693438">cmap</span>&nbsp;<span class="ident" id="4693443">CommentMap</span><span class="op" id="4693453">)</span>&nbsp;<span class="ident" id="4693455">Update</span><span class="op" id="4693461">(</span><span class="ident" id="4693462">old</span><span class="op" id="4693465">,</span>&nbsp;<span class="builtinfunc" id="4693467">new</span>&nbsp;<span class="ident" id="4693471">Node</span><span class="op" id="4693475">)</span>&nbsp;<span class="ident" id="4693477">Node</span>&nbsp;<span class="op" id="4693482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693485">if</span>&nbsp;<span class="ident" id="4693488">list</span>&nbsp;<span class="op" id="4693493">:=</span>&nbsp;<span class="ident" id="4693496">cmap</span><span class="op" id="4693500">[</span><span class="ident" id="4693501">old</span><span class="op" id="4693504">]</span><span class="op" id="4693505">;</span>&nbsp;<span class="builtinfunc" id="4693507">len</span><span class="op" id="4693510">(</span><span class="ident" id="4693511">list</span><span class="op" id="4693515">)</span>&nbsp;<span class="op" id="4693517">&gt;</span>&nbsp;<span class="num" id="4693519">0</span>&nbsp;<span class="op" id="4693521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4693525">delete</span><span class="op" id="4693531">(</span><span class="ident" id="4693532">cmap</span><span class="op" id="4693536">,</span>&nbsp;<span class="ident" id="4693538">old</span><span class="op" id="4693541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693545">cmap</span><span class="op" id="4693549">[</span><span class="builtinfunc" id="4693550">new</span><span class="op" id="4693553">]</span>&nbsp;<span class="op" id="4693555">=</span>&nbsp;<span class="builtinfunc" id="4693557">append</span><span class="op" id="4693563">(</span><span class="ident" id="4693564">cmap</span><span class="op" id="4693568">[</span><span class="builtinfunc" id="4693569">new</span><span class="op" id="4693572">]</span><span class="op" id="4693573">,</span>&nbsp;<span class="ident" id="4693575">list</span><span class="op" id="4693579">...</span><span class="op" id="4693582">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693588">return</span>&nbsp;<span class="builtinfunc" id="4693595">new</span><br>
<span class="lineno"></span><span class="op" id="4693599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4693602">//&nbsp;Filter&nbsp;returns&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;consisting&nbsp;of&nbsp;only&nbsp;those</span><br>
<span class="lineno">255</span><span class="comment" id="4693663">//&nbsp;entries&nbsp;of&nbsp;cmap&nbsp;for&nbsp;which&nbsp;a&nbsp;corresponding&nbsp;node&nbsp;exists&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4693723">//&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="4693753">//</span><br>
<span class="lineno"></span><span class="keyword" id="4693756">func</span>&nbsp;<span class="op" id="4693761">(</span><span class="ident" id="4693762">cmap</span>&nbsp;<span class="ident" id="4693767">CommentMap</span><span class="op" id="4693777">)</span>&nbsp;<span class="ident" id="4693779">Filter</span><span class="op" id="4693785">(</span><span class="ident" id="4693786">node</span>&nbsp;<span class="ident" id="4693791">Node</span><span class="op" id="4693795">)</span>&nbsp;<span class="ident" id="4693797">CommentMap</span>&nbsp;<span class="op" id="4693808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693811">umap</span>&nbsp;<span class="op" id="4693816">:=</span>&nbsp;<span class="builtinfunc" id="4693819">make</span><span class="op" id="4693823">(</span><span class="ident" id="4693824">CommentMap</span><span class="op" id="4693834">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693837">Inspect</span><span class="op" id="4693844">(</span><span class="ident" id="4693845">node</span><span class="op" id="4693849">,</span>&nbsp;<span class="keyword" id="4693851">func</span><span class="op" id="4693855">(</span><span class="ident" id="4693856">n</span>&nbsp;<span class="ident" id="4693858">Node</span><span class="op" id="4693862">)</span>&nbsp;<span class="builtintype" id="4693864">bool</span>&nbsp;<span class="op" id="4693869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693873">if</span>&nbsp;<span class="ident" id="4693876">g</span>&nbsp;<span class="op" id="4693878">:=</span>&nbsp;<span class="ident" id="4693881">cmap</span><span class="op" id="4693885">[</span><span class="ident" id="4693886">n</span><span class="op" id="4693887">]</span><span class="op" id="4693888">;</span>&nbsp;<span class="builtinfunc" id="4693890">len</span><span class="op" id="4693893">(</span><span class="ident" id="4693894">g</span><span class="op" id="4693895">)</span>&nbsp;<span class="op" id="4693897">&gt;</span>&nbsp;<span class="num" id="4693899">0</span>&nbsp;<span class="op" id="4693901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693906">umap</span><span class="op" id="4693910">[</span><span class="ident" id="4693911">n</span><span class="op" id="4693912">]</span>&nbsp;<span class="op" id="4693914">=</span>&nbsp;<span class="ident" id="4693916">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693924">return</span>&nbsp;<span class="builtintype" id="4693931">true</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693937">}</span><span class="op" id="4693938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693941">return</span>&nbsp;<span class="ident" id="4693948">umap</span><br>
<span class="lineno"></span><span class="op" id="4693953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4693956">//&nbsp;Comments&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;the&nbsp;comment&nbsp;map.</span><br>
<span class="lineno">270</span><span class="comment" id="4694023">//&nbsp;The&nbsp;result&nbsp;is&nbsp;sorted&nbsp;is&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="4694064">//</span><br>
<span class="lineno"></span><span class="keyword" id="4694067">func</span>&nbsp;<span class="op" id="4694072">(</span><span class="ident" id="4694073">cmap</span>&nbsp;<span class="ident" id="4694078">CommentMap</span><span class="op" id="4694088">)</span>&nbsp;<span class="ident" id="4694090">Comments</span><span class="op" id="4694098">(</span><span class="op" id="4694099">)</span>&nbsp;<span class="op" id="4694101">[</span><span class="op" id="4694102">]</span><span class="op" id="4694103">*</span><span class="ident" id="4694104">CommentGroup</span>&nbsp;<span class="op" id="4694117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694120">list</span>&nbsp;<span class="op" id="4694125">:=</span>&nbsp;<span class="builtinfunc" id="4694128">make</span><span class="op" id="4694132">(</span><span class="op" id="4694133">[</span><span class="op" id="4694134">]</span><span class="op" id="4694135">*</span><span class="ident" id="4694136">CommentGroup</span><span class="op" id="4694148">,</span>&nbsp;<span class="num" id="4694150">0</span><span class="op" id="4694151">,</span>&nbsp;<span class="builtinfunc" id="4694153">len</span><span class="op" id="4694156">(</span><span class="ident" id="4694157">cmap</span><span class="op" id="4694161">)</span><span class="op" id="4694162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694165">for</span>&nbsp;<span class="ident" id="4694169">_</span><span class="op" id="4694170">,</span>&nbsp;<span class="ident" id="4694172">e</span>&nbsp;<span class="op" id="4694174">:=</span>&nbsp;<span class="keyword" id="4694177">range</span>&nbsp;<span class="ident" id="4694183">cmap</span>&nbsp;<span class="op" id="4694188">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694192">list</span>&nbsp;<span class="op" id="4694197">=</span>&nbsp;<span class="builtinfunc" id="4694199">append</span><span class="op" id="4694205">(</span><span class="ident" id="4694206">list</span><span class="op" id="4694210">,</span>&nbsp;<span class="ident" id="4694212">e</span><span class="op" id="4694213">...</span><span class="op" id="4694216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694222">sortComments</span><span class="op" id="4694234">(</span><span class="ident" id="4694235">list</span><span class="op" id="4694239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694242">return</span>&nbsp;<span class="ident" id="4694249">list</span><br>
<span class="lineno"></span><span class="op" id="4694254">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="4694257">func</span>&nbsp;<span class="ident" id="4694262">summary</span><span class="op" id="4694269">(</span><span class="ident" id="4694270">list</span>&nbsp;<span class="op" id="4694275">[</span><span class="op" id="4694276">]</span><span class="op" id="4694277">*</span><span class="ident" id="4694278">CommentGroup</span><span class="op" id="4694290">)</span>&nbsp;<span class="builtintype" id="4694292">string</span>&nbsp;<span class="op" id="4694299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694302">const</span>&nbsp;<span class="ident" id="4694308">maxLen</span>&nbsp;<span class="op" id="4694315">=</span>&nbsp;<span class="num" id="4694317">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694321">var</span>&nbsp;<span class="ident" id="4694325">buf</span>&nbsp;<span class="ident" id="4694329">bytes</span><span class="op" id="4694334">.</span><span class="ident" id="4694335">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4694344">//&nbsp;collect&nbsp;comments&nbsp;text</span><br>
<span class="lineno"></span><span class="ident" id="4694369">loop</span><span class="op" id="4694373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694376">for</span>&nbsp;<span class="ident" id="4694380">_</span><span class="op" id="4694381">,</span>&nbsp;<span class="ident" id="4694383">group</span>&nbsp;<span class="op" id="4694389">:=</span>&nbsp;<span class="keyword" id="4694392">range</span>&nbsp;<span class="ident" id="4694398">list</span>&nbsp;<span class="op" id="4694403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4694407">//&nbsp;Note:&nbsp;CommentGroup.Text()&nbsp;does&nbsp;too&nbsp;much&nbsp;work&nbsp;for&nbsp;what&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4694469">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;need&nbsp;and&nbsp;would&nbsp;only&nbsp;replace&nbsp;this&nbsp;innermost&nbsp;loop.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4694529">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;do&nbsp;it&nbsp;explicitly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694563">for</span>&nbsp;<span class="ident" id="4694567">_</span><span class="op" id="4694568">,</span>&nbsp;<span class="ident" id="4694570">comment</span>&nbsp;<span class="op" id="4694578">:=</span>&nbsp;<span class="keyword" id="4694581">range</span>&nbsp;<span class="ident" id="4694587">group</span><span class="op" id="4694592">.</span><span class="ident" id="4694593">List</span>&nbsp;<span class="op" id="4694598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694603">if</span>&nbsp;<span class="ident" id="4694606">buf</span><span class="op" id="4694609">.</span><span class="ident" id="4694610">Len</span><span class="op" id="4694613">(</span><span class="op" id="4694614">)</span>&nbsp;<span class="op" id="4694616">&gt;=</span>&nbsp;<span class="ident" id="4694619">maxLen</span>&nbsp;<span class="op" id="4694626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694632">break</span>&nbsp;<span class="ident" id="4694638">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694646">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694651">buf</span><span class="op" id="4694654">.</span><span class="ident" id="4694655">WriteString</span><span class="op" id="4694666">(</span><span class="ident" id="4694667">comment</span><span class="op" id="4694674">.</span><span class="ident" id="4694675">Text</span><span class="op" id="4694679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4694690">//&nbsp;truncate&nbsp;if&nbsp;too&nbsp;long</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694715">if</span>&nbsp;<span class="ident" id="4694718">buf</span><span class="op" id="4694721">.</span><span class="ident" id="4694722">Len</span><span class="op" id="4694725">(</span><span class="op" id="4694726">)</span>&nbsp;<span class="op" id="4694728">&gt;</span>&nbsp;<span class="ident" id="4694730">maxLen</span>&nbsp;<span class="op" id="4694737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694741">buf</span><span class="op" id="4694744">.</span><span class="ident" id="4694745">Truncate</span><span class="op" id="4694753">(</span><span class="ident" id="4694754">maxLen</span>&nbsp;<span class="op" id="4694761">-</span>&nbsp;<span class="num" id="4694763">3</span><span class="op" id="4694764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694768">buf</span><span class="op" id="4694771">.</span><span class="ident" id="4694772">WriteString</span><span class="op" id="4694783">(</span><span class="string" id="4694784">&#34;...&#34;</span><span class="op" id="4694789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4694796">//&nbsp;replace&nbsp;any&nbsp;invisibles&nbsp;with&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694835">bytes</span>&nbsp;<span class="op" id="4694841">:=</span>&nbsp;<span class="ident" id="4694844">buf</span><span class="op" id="4694847">.</span><span class="ident" id="4694848">Bytes</span><span class="op" id="4694853">(</span><span class="op" id="4694854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694857">for</span>&nbsp;<span class="ident" id="4694861">i</span><span class="op" id="4694862">,</span>&nbsp;<span class="ident" id="4694864">b</span>&nbsp;<span class="op" id="4694866">:=</span>&nbsp;<span class="keyword" id="4694869">range</span>&nbsp;<span class="ident" id="4694875">bytes</span>&nbsp;<span class="op" id="4694881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694885">switch</span>&nbsp;<span class="ident" id="4694892">b</span>&nbsp;<span class="op" id="4694894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694898">case</span>&nbsp;<span class="string" id="4694903">&#39;\t&#39;</span><span class="op" id="4694907">,</span>&nbsp;<span class="string" id="4694909">&#39;\n&#39;</span><span class="op" id="4694913">,</span>&nbsp;<span class="string" id="4694915">&#39;\r&#39;</span><span class="op" id="4694919">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694924">bytes</span><span class="op" id="4694929">[</span><span class="ident" id="4694930">i</span><span class="op" id="4694931">]</span>&nbsp;<span class="op" id="4694933">=</span>&nbsp;<span class="string" id="4694935">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694948">return</span>&nbsp;<span class="builtintype" id="4694955">string</span><span class="op" id="4694961">(</span><span class="ident" id="4694962">bytes</span><span class="op" id="4694967">)</span><br>
<span class="lineno">315</span><span class="op" id="4694969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4694972">func</span>&nbsp;<span class="op" id="4694977">(</span><span class="ident" id="4694978">cmap</span>&nbsp;<span class="ident" id="4694983">CommentMap</span><span class="op" id="4694993">)</span>&nbsp;<span class="ident" id="4694995">String</span><span class="op" id="4695001">(</span><span class="op" id="4695002">)</span>&nbsp;<span class="builtintype" id="4695004">string</span>&nbsp;<span class="op" id="4695011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695014">var</span>&nbsp;<span class="ident" id="4695018">buf</span>&nbsp;<span class="ident" id="4695022">bytes</span><span class="op" id="4695027">.</span><span class="ident" id="4695028">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4695036">fmt</span><span class="op" id="4695039">.</span><span class="ident" id="4695040">Fprintln</span><span class="op" id="4695048">(</span><span class="op" id="4695049">&amp;</span><span class="ident" id="4695050">buf</span><span class="op" id="4695053">,</span>&nbsp;<span class="string" id="4695055">&#34;CommentMap&nbsp;{&#34;</span><span class="op" id="4695069">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695072">for</span>&nbsp;<span class="ident" id="4695076">node</span><span class="op" id="4695080">,</span>&nbsp;<span class="ident" id="4695082">comment</span>&nbsp;<span class="op" id="4695090">:=</span>&nbsp;<span class="keyword" id="4695093">range</span>&nbsp;<span class="ident" id="4695099">cmap</span>&nbsp;<span class="op" id="4695104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4695108">//&nbsp;print&nbsp;name&nbsp;of&nbsp;identifiers;&nbsp;print&nbsp;node&nbsp;type&nbsp;for&nbsp;other&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695172">var</span>&nbsp;<span class="ident" id="4695176">s</span>&nbsp;<span class="builtintype" id="4695178">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695187">if</span>&nbsp;<span class="ident" id="4695190">ident</span><span class="op" id="4695195">,</span>&nbsp;<span class="ident" id="4695197">ok</span>&nbsp;<span class="op" id="4695200">:=</span>&nbsp;<span class="ident" id="4695203">node</span><span class="op" id="4695207">.</span><span class="op" id="4695208">(</span><span class="op" id="4695209">*</span><span class="ident" id="4695210">Ident</span><span class="op" id="4695215">)</span><span class="op" id="4695216">;</span>&nbsp;<span class="ident" id="4695218">ok</span>&nbsp;<span class="op" id="4695221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4695226">s</span>&nbsp;<span class="op" id="4695228">=</span>&nbsp;<span class="ident" id="4695230">ident</span><span class="op" id="4695235">.</span><span class="ident" id="4695236">Name</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4695243">}</span>&nbsp;<span class="keyword" id="4695245">else</span>&nbsp;<span class="op" id="4695250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4695255">s</span>&nbsp;<span class="op" id="4695257">=</span>&nbsp;<span class="ident" id="4695259">fmt</span><span class="op" id="4695262">.</span><span class="ident" id="4695263">Sprintf</span><span class="op" id="4695270">(</span><span class="string" id="4695271">&#34;%T&#34;</span><span class="op" id="4695275">,</span>&nbsp;<span class="ident" id="4695277">node</span><span class="op" id="4695281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4695285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4695289">fmt</span><span class="op" id="4695292">.</span><span class="ident" id="4695293">Fprintf</span><span class="op" id="4695300">(</span><span class="op" id="4695301">&amp;</span><span class="ident" id="4695302">buf</span><span class="op" id="4695305">,</span>&nbsp;<span class="string" id="4695307">&#34;\t%p&nbsp;&nbsp;%20s:&nbsp;&nbsp;%s\n&#34;</span><span class="op" id="4695326">,</span>&nbsp;<span class="ident" id="4695328">node</span><span class="op" id="4695332">,</span>&nbsp;<span class="ident" id="4695334">s</span><span class="op" id="4695335">,</span>&nbsp;<span class="ident" id="4695337">summary</span><span class="op" id="4695344">(</span><span class="ident" id="4695345">comment</span><span class="op" id="4695352">)</span><span class="op" id="4695353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4695356">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4695359">fmt</span><span class="op" id="4695362">.</span><span class="ident" id="4695363">Fprintln</span><span class="op" id="4695371">(</span><span class="op" id="4695372">&amp;</span><span class="ident" id="4695373">buf</span><span class="op" id="4695376">,</span>&nbsp;<span class="string" id="4695378">&#34;}&#34;</span><span class="op" id="4695381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695384">return</span>&nbsp;<span class="ident" id="4695391">buf</span><span class="op" id="4695394">.</span><span class="ident" id="4695395">String</span><span class="op" id="4695401">(</span><span class="op" id="4695402">)</span><br>
<span class="lineno"></span><span class="op" id="4695404">}</span>
</div>
</body>
</html>
