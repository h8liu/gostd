<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>path/filepath</h2>
<ul>
<li><a href="/gostd/path/filepath/example_unix_test.go.html">example_unix_test.go</a></li>
<li><a href="/gostd/path/filepath/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/path/filepath/match.go.html">match.go</a></li>
<li><a href="/gostd/path/filepath/match_test.go.html">match_test.go</a></li>
<li><a href="/gostd/path/filepath/path.go.html">path.go</a></li>
<li><a href="/gostd/path/filepath/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/path/filepath/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/path/filepath/symlink.go.html">symlink.go</a></li>
<li><a href="/gostd/path/filepath/symlink_unix.go.html">symlink_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3544049">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3544104">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3544158">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3544209">//&nbsp;Package&nbsp;filepath&nbsp;implements&nbsp;utility&nbsp;routines&nbsp;for&nbsp;manipulating&nbsp;filename&nbsp;paths</span><br>
<span class="lineno"></span><span class="comment" id="3544289">//&nbsp;in&nbsp;a&nbsp;way&nbsp;compatible&nbsp;with&nbsp;the&nbsp;target&nbsp;operating&nbsp;system-defined&nbsp;file&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="3544365">package</span>&nbsp;<span class="ident" id="3544373">filepath</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3544383">import</span>&nbsp;<span class="op" id="3544390">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3544393">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3544403">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3544409">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3544417">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3544427">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3544430">//&nbsp;A&nbsp;lazybuf&nbsp;is&nbsp;a&nbsp;lazily&nbsp;constructed&nbsp;path&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3544480">//&nbsp;It&nbsp;supports&nbsp;append,&nbsp;reading&nbsp;previously&nbsp;appended&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="3544538">//&nbsp;and&nbsp;retrieving&nbsp;the&nbsp;final&nbsp;string.&nbsp;It&nbsp;does&nbsp;not&nbsp;allocate&nbsp;a&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="3544604">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;output&nbsp;until&nbsp;that&nbsp;output&nbsp;diverges&nbsp;from&nbsp;s.</span><br>
<span class="lineno">20</span><span class="keyword" id="3544661">type</span>&nbsp;<span class="ident" id="3544666">lazybuf</span>&nbsp;<span class="keyword" id="3544674">struct</span>&nbsp;<span class="op" id="3544681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544684">path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3544695">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544703">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3544714">[</span><span class="op" id="3544715">]</span><span class="builtintype" id="3544716">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544722">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3544733">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544738">volAndPath</span>&nbsp;<span class="builtintype" id="3544749">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544757">volLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3544768">int</span><br>
<span class="lineno"></span><span class="op" id="3544772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3544775">func</span>&nbsp;<span class="op" id="3544780">(</span><span class="ident" id="3544781">b</span>&nbsp;<span class="op" id="3544783">*</span><span class="ident" id="3544784">lazybuf</span><span class="op" id="3544791">)</span>&nbsp;<span class="ident" id="3544793">index</span><span class="op" id="3544798">(</span><span class="ident" id="3544799">i</span>&nbsp;<span class="builtintype" id="3544801">int</span><span class="op" id="3544804">)</span>&nbsp;<span class="builtintype" id="3544806">byte</span>&nbsp;<span class="op" id="3544811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544814">if</span>&nbsp;<span class="ident" id="3544817">b</span><span class="op" id="3544818">.</span><span class="ident" id="3544819">buf</span>&nbsp;<span class="op" id="3544823">!=</span>&nbsp;<span class="ident" id="3544826">nil</span>&nbsp;<span class="op" id="3544830">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544834">return</span>&nbsp;<span class="ident" id="3544841">b</span><span class="op" id="3544842">.</span><span class="ident" id="3544843">buf</span><span class="op" id="3544846">[</span><span class="ident" id="3544847">i</span><span class="op" id="3544848">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3544851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544854">return</span>&nbsp;<span class="ident" id="3544861">b</span><span class="op" id="3544862">.</span><span class="ident" id="3544863">path</span><span class="op" id="3544867">[</span><span class="ident" id="3544868">i</span><span class="op" id="3544869">]</span><br>
<span class="lineno"></span><span class="op" id="3544871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="3544874">func</span>&nbsp;<span class="op" id="3544879">(</span><span class="ident" id="3544880">b</span>&nbsp;<span class="op" id="3544882">*</span><span class="ident" id="3544883">lazybuf</span><span class="op" id="3544890">)</span>&nbsp;<span class="builtinfunc" id="3544892">append</span><span class="op" id="3544898">(</span><span class="ident" id="3544899">c</span>&nbsp;<span class="builtintype" id="3544901">byte</span><span class="op" id="3544905">)</span>&nbsp;<span class="op" id="3544907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544910">if</span>&nbsp;<span class="ident" id="3544913">b</span><span class="op" id="3544914">.</span><span class="ident" id="3544915">buf</span>&nbsp;<span class="op" id="3544919">==</span>&nbsp;<span class="ident" id="3544922">nil</span>&nbsp;<span class="op" id="3544926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544930">if</span>&nbsp;<span class="ident" id="3544933">b</span><span class="op" id="3544934">.</span><span class="ident" id="3544935">w</span>&nbsp;<span class="op" id="3544937">&lt;</span>&nbsp;<span class="builtinfunc" id="3544939">len</span><span class="op" id="3544942">(</span><span class="ident" id="3544943">b</span><span class="op" id="3544944">.</span><span class="ident" id="3544945">path</span><span class="op" id="3544949">)</span>&nbsp;<span class="op" id="3544951">&amp;&amp;</span>&nbsp;<span class="ident" id="3544954">b</span><span class="op" id="3544955">.</span><span class="ident" id="3544956">path</span><span class="op" id="3544960">[</span><span class="ident" id="3544961">b</span><span class="op" id="3544962">.</span><span class="ident" id="3544963">w</span><span class="op" id="3544964">]</span>&nbsp;<span class="op" id="3544966">==</span>&nbsp;<span class="ident" id="3544969">c</span>&nbsp;<span class="op" id="3544971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544976">b</span><span class="op" id="3544977">.</span><span class="ident" id="3544978">w</span><span class="op" id="3544979">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544985">return</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3544994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544998">b</span><span class="op" id="3544999">.</span><span class="ident" id="3545000">buf</span>&nbsp;<span class="op" id="3545004">=</span>&nbsp;<span class="builtinfunc" id="3545006">make</span><span class="op" id="3545010">(</span><span class="op" id="3545011">[</span><span class="op" id="3545012">]</span><span class="builtintype" id="3545013">byte</span><span class="op" id="3545017">,</span>&nbsp;<span class="builtinfunc" id="3545019">len</span><span class="op" id="3545022">(</span><span class="ident" id="3545023">b</span><span class="op" id="3545024">.</span><span class="ident" id="3545025">path</span><span class="op" id="3545029">)</span><span class="op" id="3545030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3545034">copy</span><span class="op" id="3545038">(</span><span class="ident" id="3545039">b</span><span class="op" id="3545040">.</span><span class="ident" id="3545041">buf</span><span class="op" id="3545044">,</span>&nbsp;<span class="ident" id="3545046">b</span><span class="op" id="3545047">.</span><span class="ident" id="3545048">path</span><span class="op" id="3545052">[</span><span class="op" id="3545053">:</span><span class="ident" id="3545054">b</span><span class="op" id="3545055">.</span><span class="ident" id="3545056">w</span><span class="op" id="3545057">]</span><span class="op" id="3545058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545064">b</span><span class="op" id="3545065">.</span><span class="ident" id="3545066">buf</span><span class="op" id="3545069">[</span><span class="ident" id="3545070">b</span><span class="op" id="3545071">.</span><span class="ident" id="3545072">w</span><span class="op" id="3545073">]</span>&nbsp;<span class="op" id="3545075">=</span>&nbsp;<span class="ident" id="3545077">c</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545080">b</span><span class="op" id="3545081">.</span><span class="ident" id="3545082">w</span><span class="op" id="3545083">++</span><br>
<span class="lineno"></span><span class="op" id="3545086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3545089">func</span>&nbsp;<span class="op" id="3545094">(</span><span class="ident" id="3545095">b</span>&nbsp;<span class="op" id="3545097">*</span><span class="ident" id="3545098">lazybuf</span><span class="op" id="3545105">)</span>&nbsp;<span class="builtintype" id="3545107">string</span><span class="op" id="3545113">(</span><span class="op" id="3545114">)</span>&nbsp;<span class="builtintype" id="3545116">string</span>&nbsp;<span class="op" id="3545123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545126">if</span>&nbsp;<span class="ident" id="3545129">b</span><span class="op" id="3545130">.</span><span class="ident" id="3545131">buf</span>&nbsp;<span class="op" id="3545135">==</span>&nbsp;<span class="ident" id="3545138">nil</span>&nbsp;<span class="op" id="3545142">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545146">return</span>&nbsp;<span class="ident" id="3545153">b</span><span class="op" id="3545154">.</span><span class="ident" id="3545155">volAndPath</span><span class="op" id="3545165">[</span><span class="op" id="3545166">:</span><span class="ident" id="3545167">b</span><span class="op" id="3545168">.</span><span class="ident" id="3545169">volLen</span><span class="op" id="3545175">+</span><span class="ident" id="3545176">b</span><span class="op" id="3545177">.</span><span class="ident" id="3545178">w</span><span class="op" id="3545179">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545185">return</span>&nbsp;<span class="ident" id="3545192">b</span><span class="op" id="3545193">.</span><span class="ident" id="3545194">volAndPath</span><span class="op" id="3545204">[</span><span class="op" id="3545205">:</span><span class="ident" id="3545206">b</span><span class="op" id="3545207">.</span><span class="ident" id="3545208">volLen</span><span class="op" id="3545214">]</span>&nbsp;<span class="op" id="3545216">+</span>&nbsp;<span class="builtintype" id="3545218">string</span><span class="op" id="3545224">(</span><span class="ident" id="3545225">b</span><span class="op" id="3545226">.</span><span class="ident" id="3545227">buf</span><span class="op" id="3545230">[</span><span class="op" id="3545231">:</span><span class="ident" id="3545232">b</span><span class="op" id="3545233">.</span><span class="ident" id="3545234">w</span><span class="op" id="3545235">]</span><span class="op" id="3545236">)</span><br>
<span class="lineno"></span><span class="op" id="3545238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3545241">const</span>&nbsp;<span class="op" id="3545247">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545250">Separator</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3545264">=</span>&nbsp;<span class="ident" id="3545266">os</span><span class="op" id="3545268">.</span><span class="ident" id="3545269">PathSeparator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545284">ListSeparator</span>&nbsp;<span class="op" id="3545298">=</span>&nbsp;<span class="ident" id="3545300">os</span><span class="op" id="3545302">.</span><span class="ident" id="3545303">PathListSeparator</span><br>
<span class="lineno"></span><span class="op" id="3545321">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3545324">//&nbsp;Clean&nbsp;returns&nbsp;the&nbsp;shortest&nbsp;path&nbsp;name&nbsp;equivalent&nbsp;to&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="3545383">//&nbsp;by&nbsp;purely&nbsp;lexical&nbsp;processing.&nbsp;&nbsp;It&nbsp;applies&nbsp;the&nbsp;following&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="3545448">//&nbsp;iteratively&nbsp;until&nbsp;no&nbsp;further&nbsp;processing&nbsp;can&nbsp;be&nbsp;done:</span><br>
<span class="lineno"></span><span class="comment" id="3545504">//</span><br>
<span class="lineno"></span><span class="comment" id="3545507">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Replace&nbsp;multiple&nbsp;Separator&nbsp;elements&nbsp;with&nbsp;a&nbsp;single&nbsp;one.</span><br>
<span class="lineno">65</span><span class="comment" id="3545568">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Eliminate&nbsp;each&nbsp;.&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;current&nbsp;directory).</span><br>
<span class="lineno"></span><span class="comment" id="3545634">//&nbsp;&nbsp;&nbsp;&nbsp3.&nbsp;Eliminate&nbsp;each&nbsp;inner&nbsp;..&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;parent&nbsp;directory)</span><br>
<span class="lineno"></span><span class="comment" id="3545705">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;along&nbsp;with&nbsp;the&nbsp;non-..&nbsp;element&nbsp;that&nbsp;precedes&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3545759">//&nbsp;&nbsp;&nbsp;&nbsp4.&nbsp;Eliminate&nbsp;..&nbsp;elements&nbsp;that&nbsp;begin&nbsp;a&nbsp;rooted&nbsp;path:</span><br>
<span class="lineno"></span><span class="comment" id="3545813">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;that&nbsp;is,&nbsp;replace&nbsp;&#34;/..&#34;&nbsp;by&nbsp;&#34;/&#34;&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;a&nbsp;path,</span><br>
<span class="lineno">70</span><span class="comment" id="3545877">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;assuming&nbsp;Separator&nbsp;is&nbsp;&#39;/&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="3545910">//</span><br>
<span class="lineno"></span><span class="comment" id="3545913">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;ends&nbsp;in&nbsp;a&nbsp;slash&nbsp;only&nbsp;if&nbsp;it&nbsp;represents&nbsp;a&nbsp;root&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="3545990">//&nbsp;such&nbsp;as&nbsp;&#34;/&#34;&nbsp;on&nbsp;Unix&nbsp;or&nbsp;`C:\`&nbsp;on&nbsp;Windows.</span><br>
<span class="lineno"></span><span class="comment" id="3546034">//</span><br>
<span class="lineno">75</span><span class="comment" id="3546037">//&nbsp;If&nbsp;the&nbsp;result&nbsp;of&nbsp;this&nbsp;process&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,&nbsp;Clean</span><br>
<span class="lineno"></span><span class="comment" id="3546096">//&nbsp;returns&nbsp;the&nbsp;string&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3546123">//</span><br>
<span class="lineno"></span><span class="comment" id="3546126">//&nbsp;See&nbsp;also&nbsp;Rob&nbsp;Pike,&nbsp;``Lexical&nbsp;File&nbsp;Names&nbsp;in&nbsp;Plan&nbsp;9&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3546182">//&nbsp;Getting&nbsp;Dot-Dot&nbsp;Right,&#39;&#39;</span><br>
<span class="lineno">80</span><span class="comment" id="3546210">//&nbsp;http://plan9.bell-labs.com/sys/doc/lexnames.html</span><br>
<span class="lineno"></span><span class="keyword" id="3546262">func</span>&nbsp;<span class="ident" id="3546267">Clean</span><span class="op" id="3546272">(</span><span class="ident" id="3546273">path</span>&nbsp;<span class="builtintype" id="3546278">string</span><span class="op" id="3546284">)</span>&nbsp;<span class="builtintype" id="3546286">string</span>&nbsp;<span class="op" id="3546293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546296">originalPath</span>&nbsp;<span class="op" id="3546309">:=</span>&nbsp;<span class="ident" id="3546312">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546318">volLen</span>&nbsp;<span class="op" id="3546325">:=</span>&nbsp;<span class="ident" id="3546328">volumeNameLen</span><span class="op" id="3546341">(</span><span class="ident" id="3546342">path</span><span class="op" id="3546346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546349">path</span>&nbsp;<span class="op" id="3546354">=</span>&nbsp;<span class="ident" id="3546356">path</span><span class="op" id="3546360">[</span><span class="ident" id="3546361">volLen</span><span class="op" id="3546367">:</span><span class="op" id="3546368">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3546371">if</span>&nbsp;<span class="ident" id="3546374">path</span>&nbsp;<span class="op" id="3546379">==</span>&nbsp;<span class="string" id="3546382">&#34;&#34;</span>&nbsp;<span class="op" id="3546385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3546389">if</span>&nbsp;<span class="ident" id="3546392">volLen</span>&nbsp;<span class="op" id="3546399">&gt;</span>&nbsp;<span class="num" id="3546401">1</span>&nbsp;<span class="op" id="3546403">&amp;&amp;</span>&nbsp;<span class="ident" id="3546406">originalPath</span><span class="op" id="3546418">[</span><span class="num" id="3546419">1</span><span class="op" id="3546420">]</span>&nbsp;<span class="op" id="3546422">!=</span>&nbsp;<span class="string" id="3546425">&#39;:&#39;</span>&nbsp;<span class="op" id="3546429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3546434">//&nbsp;should&nbsp;be&nbsp;UNC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3546454">return</span>&nbsp;<span class="ident" id="3546461">FromSlash</span><span class="op" id="3546470">(</span><span class="ident" id="3546471">originalPath</span><span class="op" id="3546483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3546487">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3546491">return</span>&nbsp;<span class="ident" id="3546498">originalPath</span>&nbsp;<span class="op" id="3546511">+</span>&nbsp;<span class="string" id="3546513">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3546518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546521">rooted</span>&nbsp;<span class="op" id="3546528">:=</span>&nbsp;<span class="ident" id="3546531">os</span><span class="op" id="3546533">.</span><span class="ident" id="3546534">IsPathSeparator</span><span class="op" id="3546549">(</span><span class="ident" id="3546550">path</span><span class="op" id="3546554">[</span><span class="num" id="3546555">0</span><span class="op" id="3546556">]</span><span class="op" id="3546557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3546561">//&nbsp;Invariants:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3546577">//&nbsp;&nbsp;&nbsp;&nbspreading&nbsp;from&nbsp;path;&nbsp;r&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;process.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3546636">//&nbsp;&nbsp;&nbsp;&nbspwriting&nbsp;to&nbsp;buf;&nbsp;w&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3546690">//&nbsp;&nbsp;&nbsp;&nbspdotdot&nbsp;is&nbsp;index&nbsp;in&nbsp;buf&nbsp;where&nbsp;..&nbsp;must&nbsp;stop,&nbsp;either&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3546752">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspit&nbsp;is&nbsp;the&nbsp;leading&nbsp;slash&nbsp;or&nbsp;it&nbsp;is&nbsp;a&nbsp;leading&nbsp;../../..&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546817">n</span>&nbsp;<span class="op" id="3546819">:=</span>&nbsp;<span class="builtinfunc" id="3546822">len</span><span class="op" id="3546825">(</span><span class="ident" id="3546826">path</span><span class="op" id="3546830">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546833">out</span>&nbsp;<span class="op" id="3546837">:=</span>&nbsp;<span class="ident" id="3546840">lazybuf</span><span class="op" id="3546847">{</span><span class="ident" id="3546848">path</span><span class="op" id="3546852">:</span>&nbsp;<span class="ident" id="3546854">path</span><span class="op" id="3546858">,</span>&nbsp;<span class="ident" id="3546860">volAndPath</span><span class="op" id="3546870">:</span>&nbsp;<span class="ident" id="3546872">originalPath</span><span class="op" id="3546884">,</span>&nbsp;<span class="ident" id="3546886">volLen</span><span class="op" id="3546892">:</span>&nbsp;<span class="ident" id="3546894">volLen</span><span class="op" id="3546900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546903">r</span><span class="op" id="3546904">,</span>&nbsp;<span class="ident" id="3546906">dotdot</span>&nbsp;<span class="op" id="3546913">:=</span>&nbsp;<span class="num" id="3546916">0</span><span class="op" id="3546917">,</span>&nbsp;<span class="num" id="3546919">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3546922">if</span>&nbsp;<span class="ident" id="3546925">rooted</span>&nbsp;<span class="op" id="3546932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546936">out</span><span class="op" id="3546939">.</span><span class="builtinfunc" id="3546940">append</span><span class="op" id="3546946">(</span><span class="ident" id="3546947">Separator</span><span class="op" id="3546956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546960">r</span><span class="op" id="3546961">,</span>&nbsp;<span class="ident" id="3546963">dotdot</span>&nbsp;<span class="op" id="3546970">=</span>&nbsp;<span class="num" id="3546972">1</span><span class="op" id="3546973">,</span>&nbsp;<span class="num" id="3546975">1</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3546978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3546982">for</span>&nbsp;<span class="ident" id="3546986">r</span>&nbsp;<span class="op" id="3546988">&lt;</span>&nbsp;<span class="ident" id="3546990">n</span>&nbsp;<span class="op" id="3546992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3546996">switch</span>&nbsp;<span class="op" id="3547003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547007">case</span>&nbsp;<span class="ident" id="3547012">os</span><span class="op" id="3547014">.</span><span class="ident" id="3547015">IsPathSeparator</span><span class="op" id="3547030">(</span><span class="ident" id="3547031">path</span><span class="op" id="3547035">[</span><span class="ident" id="3547036">r</span><span class="op" id="3547037">]</span><span class="op" id="3547038">)</span><span class="op" id="3547039">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3547044">//&nbsp;empty&nbsp;path&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547069">r</span><span class="op" id="3547070">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547075">case</span>&nbsp;<span class="ident" id="3547080">path</span><span class="op" id="3547084">[</span><span class="ident" id="3547085">r</span><span class="op" id="3547086">]</span>&nbsp;<span class="op" id="3547088">==</span>&nbsp;<span class="string" id="3547091">&#39;.&#39;</span>&nbsp;<span class="op" id="3547095">&amp;&amp;</span>&nbsp;<span class="op" id="3547098">(</span><span class="ident" id="3547099">r</span><span class="op" id="3547100">+</span><span class="num" id="3547101">1</span>&nbsp;<span class="op" id="3547103">==</span>&nbsp;<span class="ident" id="3547106">n</span>&nbsp;<span class="op" id="3547108">||</span>&nbsp;<span class="ident" id="3547111">os</span><span class="op" id="3547113">.</span><span class="ident" id="3547114">IsPathSeparator</span><span class="op" id="3547129">(</span><span class="ident" id="3547130">path</span><span class="op" id="3547134">[</span><span class="ident" id="3547135">r</span><span class="op" id="3547136">+</span><span class="num" id="3547137">1</span><span class="op" id="3547138">]</span><span class="op" id="3547139">)</span><span class="op" id="3547140">)</span><span class="op" id="3547141">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3547146">//&nbsp;.&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547162">r</span><span class="op" id="3547163">++</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547168">case</span>&nbsp;<span class="ident" id="3547173">path</span><span class="op" id="3547177">[</span><span class="ident" id="3547178">r</span><span class="op" id="3547179">]</span>&nbsp;<span class="op" id="3547181">==</span>&nbsp;<span class="string" id="3547184">&#39;.&#39;</span>&nbsp;<span class="op" id="3547188">&amp;&amp;</span>&nbsp;<span class="ident" id="3547191">path</span><span class="op" id="3547195">[</span><span class="ident" id="3547196">r</span><span class="op" id="3547197">+</span><span class="num" id="3547198">1</span><span class="op" id="3547199">]</span>&nbsp;<span class="op" id="3547201">==</span>&nbsp;<span class="string" id="3547204">&#39;.&#39;</span>&nbsp;<span class="op" id="3547208">&amp;&amp;</span>&nbsp;<span class="op" id="3547211">(</span><span class="ident" id="3547212">r</span><span class="op" id="3547213">+</span><span class="num" id="3547214">2</span>&nbsp;<span class="op" id="3547216">==</span>&nbsp;<span class="ident" id="3547219">n</span>&nbsp;<span class="op" id="3547221">||</span>&nbsp;<span class="ident" id="3547224">os</span><span class="op" id="3547226">.</span><span class="ident" id="3547227">IsPathSeparator</span><span class="op" id="3547242">(</span><span class="ident" id="3547243">path</span><span class="op" id="3547247">[</span><span class="ident" id="3547248">r</span><span class="op" id="3547249">+</span><span class="num" id="3547250">2</span><span class="op" id="3547251">]</span><span class="op" id="3547252">)</span><span class="op" id="3547253">)</span><span class="op" id="3547254">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3547259">//&nbsp;..&nbsp;element:&nbsp;remove&nbsp;to&nbsp;last&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547302">r</span>&nbsp;<span class="op" id="3547304">+=</span>&nbsp;<span class="num" id="3547307">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547312">switch</span>&nbsp;<span class="op" id="3547319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547324">case</span>&nbsp;<span class="ident" id="3547329">out</span><span class="op" id="3547332">.</span><span class="ident" id="3547333">w</span>&nbsp;<span class="op" id="3547335">&gt;</span>&nbsp;<span class="ident" id="3547337">dotdot</span><span class="op" id="3547343">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3547349">//&nbsp;can&nbsp;backtrack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547370">out</span><span class="op" id="3547373">.</span><span class="ident" id="3547374">w</span><span class="op" id="3547375">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547382">for</span>&nbsp;<span class="ident" id="3547386">out</span><span class="op" id="3547389">.</span><span class="ident" id="3547390">w</span>&nbsp;<span class="op" id="3547392">&gt;</span>&nbsp;<span class="ident" id="3547394">dotdot</span>&nbsp;<span class="op" id="3547401">&amp;&amp;</span>&nbsp;<span class="op" id="3547404">!</span><span class="ident" id="3547405">os</span><span class="op" id="3547407">.</span><span class="ident" id="3547408">IsPathSeparator</span><span class="op" id="3547423">(</span><span class="ident" id="3547424">out</span><span class="op" id="3547427">.</span><span class="ident" id="3547428">index</span><span class="op" id="3547433">(</span><span class="ident" id="3547434">out</span><span class="op" id="3547437">.</span><span class="ident" id="3547438">w</span><span class="op" id="3547439">)</span><span class="op" id="3547440">)</span>&nbsp;<span class="op" id="3547442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547449">out</span><span class="op" id="3547452">.</span><span class="ident" id="3547453">w</span><span class="op" id="3547454">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547461">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547466">case</span>&nbsp;<span class="op" id="3547471">!</span><span class="ident" id="3547472">rooted</span><span class="op" id="3547478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3547484">//&nbsp;cannot&nbsp;backtrack,&nbsp;but&nbsp;not&nbsp;rooted,&nbsp;so&nbsp;append&nbsp;..&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547547">if</span>&nbsp;<span class="ident" id="3547550">out</span><span class="op" id="3547553">.</span><span class="ident" id="3547554">w</span>&nbsp;<span class="op" id="3547556">&gt;</span>&nbsp;<span class="num" id="3547558">0</span>&nbsp;<span class="op" id="3547560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547567">out</span><span class="op" id="3547570">.</span><span class="builtinfunc" id="3547571">append</span><span class="op" id="3547577">(</span><span class="ident" id="3547578">Separator</span><span class="op" id="3547587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547593">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547599">out</span><span class="op" id="3547602">.</span><span class="builtinfunc" id="3547603">append</span><span class="op" id="3547609">(</span><span class="string" id="3547610">&#39;.&#39;</span><span class="op" id="3547613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547619">out</span><span class="op" id="3547622">.</span><span class="builtinfunc" id="3547623">append</span><span class="op" id="3547629">(</span><span class="string" id="3547630">&#39;.&#39;</span><span class="op" id="3547633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547639">dotdot</span>&nbsp;<span class="op" id="3547646">=</span>&nbsp;<span class="ident" id="3547648">out</span><span class="op" id="3547651">.</span><span class="ident" id="3547652">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547661">default</span><span class="op" id="3547668">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3547673">//&nbsp;real&nbsp;path&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3547698">//&nbsp;add&nbsp;slash&nbsp;if&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547724">if</span>&nbsp;<span class="ident" id="3547727">rooted</span>&nbsp;<span class="op" id="3547734">&amp;&amp;</span>&nbsp;<span class="ident" id="3547737">out</span><span class="op" id="3547740">.</span><span class="ident" id="3547741">w</span>&nbsp;<span class="op" id="3547743">!=</span>&nbsp;<span class="num" id="3547746">1</span>&nbsp;<span class="op" id="3547748">||</span>&nbsp;<span class="op" id="3547751">!</span><span class="ident" id="3547752">rooted</span>&nbsp;<span class="op" id="3547759">&amp;&amp;</span>&nbsp;<span class="ident" id="3547762">out</span><span class="op" id="3547765">.</span><span class="ident" id="3547766">w</span>&nbsp;<span class="op" id="3547768">!=</span>&nbsp;<span class="num" id="3547771">0</span>&nbsp;<span class="op" id="3547773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547779">out</span><span class="op" id="3547782">.</span><span class="builtinfunc" id="3547783">append</span><span class="op" id="3547789">(</span><span class="ident" id="3547790">Separator</span><span class="op" id="3547799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547804">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3547809">//&nbsp;copy&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547828">for</span>&nbsp;<span class="op" id="3547832">;</span>&nbsp;<span class="ident" id="3547834">r</span>&nbsp;<span class="op" id="3547836">&lt;</span>&nbsp;<span class="ident" id="3547838">n</span>&nbsp;<span class="op" id="3547840">&amp;&amp;</span>&nbsp;<span class="op" id="3547843">!</span><span class="ident" id="3547844">os</span><span class="op" id="3547846">.</span><span class="ident" id="3547847">IsPathSeparator</span><span class="op" id="3547862">(</span><span class="ident" id="3547863">path</span><span class="op" id="3547867">[</span><span class="ident" id="3547868">r</span><span class="op" id="3547869">]</span><span class="op" id="3547870">)</span><span class="op" id="3547871">;</span>&nbsp;<span class="ident" id="3547873">r</span><span class="op" id="3547874">++</span>&nbsp;<span class="op" id="3547877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547883">out</span><span class="op" id="3547886">.</span><span class="builtinfunc" id="3547887">append</span><span class="op" id="3547893">(</span><span class="ident" id="3547894">path</span><span class="op" id="3547898">[</span><span class="ident" id="3547899">r</span><span class="op" id="3547900">]</span><span class="op" id="3547901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547910">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3547917">//&nbsp;Turn&nbsp;empty&nbsp;string&nbsp;into&nbsp;&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547948">if</span>&nbsp;<span class="ident" id="3547951">out</span><span class="op" id="3547954">.</span><span class="ident" id="3547955">w</span>&nbsp;<span class="op" id="3547957">==</span>&nbsp;<span class="num" id="3547960">0</span>&nbsp;<span class="op" id="3547962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547966">out</span><span class="op" id="3547969">.</span><span class="builtinfunc" id="3547970">append</span><span class="op" id="3547976">(</span><span class="string" id="3547977">&#39;.&#39;</span><span class="op" id="3547980">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547987">return</span>&nbsp;<span class="ident" id="3547994">FromSlash</span><span class="op" id="3548003">(</span><span class="ident" id="3548004">out</span><span class="op" id="3548007">.</span><span class="builtintype" id="3548008">string</span><span class="op" id="3548014">(</span><span class="op" id="3548015">)</span><span class="op" id="3548016">)</span><br>
<span class="lineno"></span><span class="op" id="3548018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="3548021">//&nbsp;ToSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;separator&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="3548089">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character.&nbsp;Multiple&nbsp;separators&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3548154">//&nbsp;replaced&nbsp;by&nbsp;multiple&nbsp;slashes.</span><br>
<span class="lineno"></span><span class="keyword" id="3548187">func</span>&nbsp;<span class="ident" id="3548192">ToSlash</span><span class="op" id="3548199">(</span><span class="ident" id="3548200">path</span>&nbsp;<span class="builtintype" id="3548205">string</span><span class="op" id="3548211">)</span>&nbsp;<span class="builtintype" id="3548213">string</span>&nbsp;<span class="op" id="3548220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548223">if</span>&nbsp;<span class="ident" id="3548226">Separator</span>&nbsp;<span class="op" id="3548236">==</span>&nbsp;<span class="string" id="3548239">&#39;/&#39;</span>&nbsp;<span class="op" id="3548243">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548247">return</span>&nbsp;<span class="ident" id="3548254">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3548260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548263">return</span>&nbsp;<span class="ident" id="3548270">strings</span><span class="op" id="3548277">.</span><span class="ident" id="3548278">Replace</span><span class="op" id="3548285">(</span><span class="ident" id="3548286">path</span><span class="op" id="3548290">,</span>&nbsp;<span class="builtintype" id="3548292">string</span><span class="op" id="3548298">(</span><span class="ident" id="3548299">Separator</span><span class="op" id="3548308">)</span><span class="op" id="3548309">,</span>&nbsp;<span class="string" id="3548311">&#34;/&#34;</span><span class="op" id="3548314">,</span>&nbsp;<span class="op" id="3548316">-</span><span class="num" id="3548317">1</span><span class="op" id="3548318">)</span><br>
<span class="lineno"></span><span class="op" id="3548320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3548323">//&nbsp;FromSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="3548395">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;separator&nbsp;character.&nbsp;Multiple&nbsp;slashes&nbsp;are&nbsp;replaced</span><br>
<span class="lineno"></span><span class="comment" id="3548464">//&nbsp;by&nbsp;multiple&nbsp;separators.</span><br>
<span class="lineno"></span><span class="keyword" id="3548491">func</span>&nbsp;<span class="ident" id="3548496">FromSlash</span><span class="op" id="3548505">(</span><span class="ident" id="3548506">path</span>&nbsp;<span class="builtintype" id="3548511">string</span><span class="op" id="3548517">)</span>&nbsp;<span class="builtintype" id="3548519">string</span>&nbsp;<span class="op" id="3548526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548529">if</span>&nbsp;<span class="ident" id="3548532">Separator</span>&nbsp;<span class="op" id="3548542">==</span>&nbsp;<span class="string" id="3548545">&#39;/&#39;</span>&nbsp;<span class="op" id="3548549">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548553">return</span>&nbsp;<span class="ident" id="3548560">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3548566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548569">return</span>&nbsp;<span class="ident" id="3548576">strings</span><span class="op" id="3548583">.</span><span class="ident" id="3548584">Replace</span><span class="op" id="3548591">(</span><span class="ident" id="3548592">path</span><span class="op" id="3548596">,</span>&nbsp;<span class="string" id="3548598">&#34;/&#34;</span><span class="op" id="3548601">,</span>&nbsp;<span class="builtintype" id="3548603">string</span><span class="op" id="3548609">(</span><span class="ident" id="3548610">Separator</span><span class="op" id="3548619">)</span><span class="op" id="3548620">,</span>&nbsp;<span class="op" id="3548622">-</span><span class="num" id="3548623">1</span><span class="op" id="3548624">)</span><br>
<span class="lineno"></span><span class="op" id="3548626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="3548629">//&nbsp;SplitList&nbsp;splits&nbsp;a&nbsp;list&nbsp;of&nbsp;paths&nbsp;joined&nbsp;by&nbsp;the&nbsp;OS-specific&nbsp;ListSeparator,</span><br>
<span class="lineno"></span><span class="comment" id="3548706">//&nbsp;usually&nbsp;found&nbsp;in&nbsp;PATH&nbsp;or&nbsp;GOPATH&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><span class="comment" id="3548764">//&nbsp;Unlike&nbsp;strings.Split,&nbsp;SplitList&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;when&nbsp;passed&nbsp;an&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3548851">func</span>&nbsp;<span class="ident" id="3548856">SplitList</span><span class="op" id="3548865">(</span><span class="ident" id="3548866">path</span>&nbsp;<span class="builtintype" id="3548871">string</span><span class="op" id="3548877">)</span>&nbsp;<span class="op" id="3548879">[</span><span class="op" id="3548880">]</span><span class="builtintype" id="3548881">string</span>&nbsp;<span class="op" id="3548888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548891">return</span>&nbsp;<span class="ident" id="3548898">splitList</span><span class="op" id="3548907">(</span><span class="ident" id="3548908">path</span><span class="op" id="3548912">)</span><br>
<span class="lineno">180</span><span class="op" id="3548914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3548917">//&nbsp;Split&nbsp;splits&nbsp;path&nbsp;immediately&nbsp;following&nbsp;the&nbsp;final&nbsp;Separator,</span><br>
<span class="lineno"></span><span class="comment" id="3548981">//&nbsp;separating&nbsp;it&nbsp;into&nbsp;a&nbsp;directory&nbsp;and&nbsp;file&nbsp;name&nbsp;component.</span><br>
<span class="lineno"></span><span class="comment" id="3549040">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;Separator&nbsp;in&nbsp;path,&nbsp;Split&nbsp;returns&nbsp;an&nbsp;empty&nbsp;dir</span><br>
<span class="lineno">185</span><span class="comment" id="3549104">//&nbsp;and&nbsp;file&nbsp;set&nbsp;to&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3549129">//&nbsp;The&nbsp;returned&nbsp;values&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;path&nbsp;=&nbsp;dir+file.</span><br>
<span class="lineno"></span><span class="keyword" id="3549192">func</span>&nbsp;<span class="ident" id="3549197">Split</span><span class="op" id="3549202">(</span><span class="ident" id="3549203">path</span>&nbsp;<span class="builtintype" id="3549208">string</span><span class="op" id="3549214">)</span>&nbsp;<span class="op" id="3549216">(</span><span class="ident" id="3549217">dir</span><span class="op" id="3549220">,</span>&nbsp;<span class="ident" id="3549222">file</span>&nbsp;<span class="builtintype" id="3549227">string</span><span class="op" id="3549233">)</span>&nbsp;<span class="op" id="3549235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549238">vol</span>&nbsp;<span class="op" id="3549242">:=</span>&nbsp;<span class="ident" id="3549245">VolumeName</span><span class="op" id="3549255">(</span><span class="ident" id="3549256">path</span><span class="op" id="3549260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549263">i</span>&nbsp;<span class="op" id="3549265">:=</span>&nbsp;<span class="builtinfunc" id="3549268">len</span><span class="op" id="3549271">(</span><span class="ident" id="3549272">path</span><span class="op" id="3549276">)</span>&nbsp;<span class="op" id="3549278">-</span>&nbsp;<span class="num" id="3549280">1</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549283">for</span>&nbsp;<span class="ident" id="3549287">i</span>&nbsp;<span class="op" id="3549289">&gt;=</span>&nbsp;<span class="builtinfunc" id="3549292">len</span><span class="op" id="3549295">(</span><span class="ident" id="3549296">vol</span><span class="op" id="3549299">)</span>&nbsp;<span class="op" id="3549301">&amp;&amp;</span>&nbsp;<span class="op" id="3549304">!</span><span class="ident" id="3549305">os</span><span class="op" id="3549307">.</span><span class="ident" id="3549308">IsPathSeparator</span><span class="op" id="3549323">(</span><span class="ident" id="3549324">path</span><span class="op" id="3549328">[</span><span class="ident" id="3549329">i</span><span class="op" id="3549330">]</span><span class="op" id="3549331">)</span>&nbsp;<span class="op" id="3549333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549337">i</span><span class="op" id="3549338">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549345">return</span>&nbsp;<span class="ident" id="3549352">path</span><span class="op" id="3549356">[</span><span class="op" id="3549357">:</span><span class="ident" id="3549358">i</span><span class="op" id="3549359">+</span><span class="num" id="3549360">1</span><span class="op" id="3549361">]</span><span class="op" id="3549362">,</span>&nbsp;<span class="ident" id="3549364">path</span><span class="op" id="3549368">[</span><span class="ident" id="3549369">i</span><span class="op" id="3549370">+</span><span class="num" id="3549371">1</span><span class="op" id="3549372">:</span><span class="op" id="3549373">]</span><br>
<span class="lineno"></span><span class="op" id="3549375">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="3549378">//&nbsp;Join&nbsp;joins&nbsp;any&nbsp;number&nbsp;of&nbsp;path&nbsp;elements&nbsp;into&nbsp;a&nbsp;single&nbsp;path,&nbsp;adding</span><br>
<span class="lineno"></span><span class="comment" id="3549447">//&nbsp;a&nbsp;Separator&nbsp;if&nbsp;necessary.&nbsp;The&nbsp;result&nbsp;is&nbsp;Cleaned,&nbsp;in&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="3549513">//&nbsp;all&nbsp;empty&nbsp;strings&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="3549547">func</span>&nbsp;<span class="ident" id="3549552">Join</span><span class="op" id="3549556">(</span><span class="ident" id="3549557">elem</span>&nbsp;<span class="op" id="3549562">...</span><span class="builtintype" id="3549565">string</span><span class="op" id="3549571">)</span>&nbsp;<span class="builtintype" id="3549573">string</span>&nbsp;<span class="op" id="3549580">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549583">for</span>&nbsp;<span class="ident" id="3549587">i</span><span class="op" id="3549588">,</span>&nbsp;<span class="ident" id="3549590">e</span>&nbsp;<span class="op" id="3549592">:=</span>&nbsp;<span class="keyword" id="3549595">range</span>&nbsp;<span class="ident" id="3549601">elem</span>&nbsp;<span class="op" id="3549606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549610">if</span>&nbsp;<span class="ident" id="3549613">e</span>&nbsp;<span class="op" id="3549615">!=</span>&nbsp;<span class="string" id="3549618">&#34;&#34;</span>&nbsp;<span class="op" id="3549621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549626">return</span>&nbsp;<span class="ident" id="3549633">Clean</span><span class="op" id="3549638">(</span><span class="ident" id="3549639">strings</span><span class="op" id="3549646">.</span><span class="ident" id="3549647">Join</span><span class="op" id="3549651">(</span><span class="ident" id="3549652">elem</span><span class="op" id="3549656">[</span><span class="ident" id="3549657">i</span><span class="op" id="3549658">:</span><span class="op" id="3549659">]</span><span class="op" id="3549660">,</span>&nbsp;<span class="builtintype" id="3549662">string</span><span class="op" id="3549668">(</span><span class="ident" id="3549669">Separator</span><span class="op" id="3549678">)</span><span class="op" id="3549679">)</span><span class="op" id="3549680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549687">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549690">return</span>&nbsp;<span class="string" id="3549697">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3549700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3549703">//&nbsp;Ext&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;extension&nbsp;used&nbsp;by&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3549756">//&nbsp;The&nbsp;extension&nbsp;is&nbsp;the&nbsp;suffix&nbsp;beginning&nbsp;at&nbsp;the&nbsp;final&nbsp;dot</span><br>
<span class="lineno">210</span><span class="comment" id="3549814">//&nbsp;in&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;path;&nbsp;it&nbsp;is&nbsp;empty&nbsp;if&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3549871">//&nbsp;no&nbsp;dot.</span><br>
<span class="lineno"></span><span class="keyword" id="3549882">func</span>&nbsp;<span class="ident" id="3549887">Ext</span><span class="op" id="3549890">(</span><span class="ident" id="3549891">path</span>&nbsp;<span class="builtintype" id="3549896">string</span><span class="op" id="3549902">)</span>&nbsp;<span class="builtintype" id="3549904">string</span>&nbsp;<span class="op" id="3549911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549914">for</span>&nbsp;<span class="ident" id="3549918">i</span>&nbsp;<span class="op" id="3549920">:=</span>&nbsp;<span class="builtinfunc" id="3549923">len</span><span class="op" id="3549926">(</span><span class="ident" id="3549927">path</span><span class="op" id="3549931">)</span>&nbsp;<span class="op" id="3549933">-</span>&nbsp;<span class="num" id="3549935">1</span><span class="op" id="3549936">;</span>&nbsp;<span class="ident" id="3549938">i</span>&nbsp;<span class="op" id="3549940">&gt;=</span>&nbsp;<span class="num" id="3549943">0</span>&nbsp;<span class="op" id="3549945">&amp;&amp;</span>&nbsp;<span class="op" id="3549948">!</span><span class="ident" id="3549949">os</span><span class="op" id="3549951">.</span><span class="ident" id="3549952">IsPathSeparator</span><span class="op" id="3549967">(</span><span class="ident" id="3549968">path</span><span class="op" id="3549972">[</span><span class="ident" id="3549973">i</span><span class="op" id="3549974">]</span><span class="op" id="3549975">)</span><span class="op" id="3549976">;</span>&nbsp;<span class="ident" id="3549978">i</span><span class="op" id="3549979">--</span>&nbsp;<span class="op" id="3549982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549986">if</span>&nbsp;<span class="ident" id="3549989">path</span><span class="op" id="3549993">[</span><span class="ident" id="3549994">i</span><span class="op" id="3549995">]</span>&nbsp;<span class="op" id="3549997">==</span>&nbsp;<span class="string" id="3550000">&#39;.&#39;</span>&nbsp;<span class="op" id="3550004">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550009">return</span>&nbsp;<span class="ident" id="3550016">path</span><span class="op" id="3550020">[</span><span class="ident" id="3550021">i</span><span class="op" id="3550022">:</span><span class="op" id="3550023">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550033">return</span>&nbsp;<span class="string" id="3550040">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3550043">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3550046">//&nbsp;EvalSymlinks&nbsp;returns&nbsp;the&nbsp;path&nbsp;name&nbsp;after&nbsp;the&nbsp;evaluation&nbsp;of&nbsp;any&nbsp;symbolic</span><br>
<span class="lineno"></span><span class="comment" id="3550121">//&nbsp;links.</span><br>
<span class="lineno"></span><span class="comment" id="3550131">//&nbsp;If&nbsp;path&nbsp;is&nbsp;relative&nbsp;the&nbsp;result&nbsp;will&nbsp;be&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="3550208">//&nbsp;unless&nbsp;one&nbsp;of&nbsp;the&nbsp;components&nbsp;is&nbsp;an&nbsp;absolute&nbsp;symbolic&nbsp;link.</span><br>
<span class="lineno">225</span><span class="keyword" id="3550270">func</span>&nbsp;<span class="ident" id="3550275">EvalSymlinks</span><span class="op" id="3550287">(</span><span class="ident" id="3550288">path</span>&nbsp;<span class="builtintype" id="3550293">string</span><span class="op" id="3550299">)</span>&nbsp;<span class="op" id="3550301">(</span><span class="builtintype" id="3550302">string</span><span class="op" id="3550308">,</span>&nbsp;<span class="builtintype" id="3550310">error</span><span class="op" id="3550315">)</span>&nbsp;<span class="op" id="3550317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550320">return</span>&nbsp;<span class="ident" id="3550327">evalSymlinks</span><span class="op" id="3550339">(</span><span class="ident" id="3550340">path</span><span class="op" id="3550344">)</span><br>
<span class="lineno"></span><span class="op" id="3550346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3550349">//&nbsp;Abs&nbsp;returns&nbsp;an&nbsp;absolute&nbsp;representation&nbsp;of&nbsp;path.</span><br>
<span class="lineno">230</span><span class="comment" id="3550400">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;not&nbsp;absolute&nbsp;it&nbsp;will&nbsp;be&nbsp;joined&nbsp;with&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="3550466">//&nbsp;working&nbsp;directory&nbsp;to&nbsp;turn&nbsp;it&nbsp;into&nbsp;an&nbsp;absolute&nbsp;path.&nbsp;&nbsp;The&nbsp;absolute</span><br>
<span class="lineno"></span><span class="comment" id="3550535">//&nbsp;path&nbsp;name&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span><span class="keyword" id="3550597">func</span>&nbsp;<span class="ident" id="3550602">Abs</span><span class="op" id="3550605">(</span><span class="ident" id="3550606">path</span>&nbsp;<span class="builtintype" id="3550611">string</span><span class="op" id="3550617">)</span>&nbsp;<span class="op" id="3550619">(</span><span class="builtintype" id="3550620">string</span><span class="op" id="3550626">,</span>&nbsp;<span class="builtintype" id="3550628">error</span><span class="op" id="3550633">)</span>&nbsp;<span class="op" id="3550635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550638">return</span>&nbsp;<span class="ident" id="3550645">abs</span><span class="op" id="3550648">(</span><span class="ident" id="3550649">path</span><span class="op" id="3550653">)</span><br>
<span class="lineno">235</span><span class="op" id="3550655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3550658">func</span>&nbsp;<span class="ident" id="3550663">unixAbs</span><span class="op" id="3550670">(</span><span class="ident" id="3550671">path</span>&nbsp;<span class="builtintype" id="3550676">string</span><span class="op" id="3550682">)</span>&nbsp;<span class="op" id="3550684">(</span><span class="builtintype" id="3550685">string</span><span class="op" id="3550691">,</span>&nbsp;<span class="builtintype" id="3550693">error</span><span class="op" id="3550698">)</span>&nbsp;<span class="op" id="3550700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550703">if</span>&nbsp;<span class="ident" id="3550706">IsAbs</span><span class="op" id="3550711">(</span><span class="ident" id="3550712">path</span><span class="op" id="3550716">)</span>&nbsp;<span class="op" id="3550718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550722">return</span>&nbsp;<span class="ident" id="3550729">Clean</span><span class="op" id="3550734">(</span><span class="ident" id="3550735">path</span><span class="op" id="3550739">)</span><span class="op" id="3550740">,</span>&nbsp;<span class="ident" id="3550742">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550750">wd</span><span class="op" id="3550752">,</span>&nbsp;<span class="ident" id="3550754">err</span>&nbsp;<span class="op" id="3550758">:=</span>&nbsp;<span class="ident" id="3550761">os</span><span class="op" id="3550763">.</span><span class="ident" id="3550764">Getwd</span><span class="op" id="3550769">(</span><span class="op" id="3550770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550773">if</span>&nbsp;<span class="ident" id="3550776">err</span>&nbsp;<span class="op" id="3550780">!=</span>&nbsp;<span class="ident" id="3550783">nil</span>&nbsp;<span class="op" id="3550787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550791">return</span>&nbsp;<span class="string" id="3550798">&#34;&#34;</span><span class="op" id="3550800">,</span>&nbsp;<span class="ident" id="3550802">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550807">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550810">return</span>&nbsp;<span class="ident" id="3550817">Join</span><span class="op" id="3550821">(</span><span class="ident" id="3550822">wd</span><span class="op" id="3550824">,</span>&nbsp;<span class="ident" id="3550826">path</span><span class="op" id="3550830">)</span><span class="op" id="3550831">,</span>&nbsp;<span class="ident" id="3550833">nil</span><br>
<span class="lineno"></span><span class="op" id="3550837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3550840">//&nbsp;Rel&nbsp;returns&nbsp;a&nbsp;relative&nbsp;path&nbsp;that&nbsp;is&nbsp;lexically&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3550917">//&nbsp;joined&nbsp;to&nbsp;basepath&nbsp;with&nbsp;an&nbsp;intervening&nbsp;separator.&nbsp;That&nbsp;is,</span><br>
<span class="lineno">250</span><span class="comment" id="3550979">//&nbsp;Join(basepath,&nbsp;Rel(basepath,&nbsp;targpath))&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="3551056">//&nbsp;On&nbsp;success,&nbsp;the&nbsp;returned&nbsp;path&nbsp;will&nbsp;always&nbsp;be&nbsp;relative&nbsp;to&nbsp;basepath,</span><br>
<span class="lineno"></span><span class="comment" id="3551126">//&nbsp;even&nbsp;if&nbsp;basepath&nbsp;and&nbsp;targpath&nbsp;share&nbsp;no&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="3551178">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;targpath&nbsp;can&#39;t&nbsp;be&nbsp;made&nbsp;relative&nbsp;to&nbsp;basepath&nbsp;or&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3551255">//&nbsp;knowing&nbsp;the&nbsp;current&nbsp;working&nbsp;directory&nbsp;would&nbsp;be&nbsp;necessary&nbsp;to&nbsp;compute&nbsp;it.</span><br>
<span class="lineno">255</span><span class="keyword" id="3551330">func</span>&nbsp;<span class="ident" id="3551335">Rel</span><span class="op" id="3551338">(</span><span class="ident" id="3551339">basepath</span><span class="op" id="3551347">,</span>&nbsp;<span class="ident" id="3551349">targpath</span>&nbsp;<span class="builtintype" id="3551358">string</span><span class="op" id="3551364">)</span>&nbsp;<span class="op" id="3551366">(</span><span class="builtintype" id="3551367">string</span><span class="op" id="3551373">,</span>&nbsp;<span class="builtintype" id="3551375">error</span><span class="op" id="3551380">)</span>&nbsp;<span class="op" id="3551382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551385">baseVol</span>&nbsp;<span class="op" id="3551393">:=</span>&nbsp;<span class="ident" id="3551396">VolumeName</span><span class="op" id="3551406">(</span><span class="ident" id="3551407">basepath</span><span class="op" id="3551415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551418">targVol</span>&nbsp;<span class="op" id="3551426">:=</span>&nbsp;<span class="ident" id="3551429">VolumeName</span><span class="op" id="3551439">(</span><span class="ident" id="3551440">targpath</span><span class="op" id="3551448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551451">base</span>&nbsp;<span class="op" id="3551456">:=</span>&nbsp;<span class="ident" id="3551459">Clean</span><span class="op" id="3551464">(</span><span class="ident" id="3551465">basepath</span><span class="op" id="3551473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551476">targ</span>&nbsp;<span class="op" id="3551481">:=</span>&nbsp;<span class="ident" id="3551484">Clean</span><span class="op" id="3551489">(</span><span class="ident" id="3551490">targpath</span><span class="op" id="3551498">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551501">if</span>&nbsp;<span class="ident" id="3551504">targ</span>&nbsp;<span class="op" id="3551509">==</span>&nbsp;<span class="ident" id="3551512">base</span>&nbsp;<span class="op" id="3551517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551521">return</span>&nbsp;<span class="string" id="3551528">&#34;.&#34;</span><span class="op" id="3551531">,</span>&nbsp;<span class="ident" id="3551533">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551541">base</span>&nbsp;<span class="op" id="3551546">=</span>&nbsp;<span class="ident" id="3551548">base</span><span class="op" id="3551552">[</span><span class="builtinfunc" id="3551553">len</span><span class="op" id="3551556">(</span><span class="ident" id="3551557">baseVol</span><span class="op" id="3551564">)</span><span class="op" id="3551565">:</span><span class="op" id="3551566">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551569">targ</span>&nbsp;<span class="op" id="3551574">=</span>&nbsp;<span class="ident" id="3551576">targ</span><span class="op" id="3551580">[</span><span class="builtinfunc" id="3551581">len</span><span class="op" id="3551584">(</span><span class="ident" id="3551585">targVol</span><span class="op" id="3551592">)</span><span class="op" id="3551593">:</span><span class="op" id="3551594">]</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551597">if</span>&nbsp;<span class="ident" id="3551600">base</span>&nbsp;<span class="op" id="3551605">==</span>&nbsp;<span class="string" id="3551608">&#34;.&#34;</span>&nbsp;<span class="op" id="3551612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551616">base</span>&nbsp;<span class="op" id="3551621">=</span>&nbsp;<span class="string" id="3551623">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3551630">//&nbsp;Can&#39;t&nbsp;use&nbsp;IsAbs&nbsp;-&nbsp;`\a`&nbsp;and&nbsp;`a`&nbsp;are&nbsp;both&nbsp;relative&nbsp;in&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551695">baseSlashed</span>&nbsp;<span class="op" id="3551707">:=</span>&nbsp;<span class="builtinfunc" id="3551710">len</span><span class="op" id="3551713">(</span><span class="ident" id="3551714">base</span><span class="op" id="3551718">)</span>&nbsp;<span class="op" id="3551720">&gt;</span>&nbsp;<span class="num" id="3551722">0</span>&nbsp;<span class="op" id="3551724">&amp;&amp;</span>&nbsp;<span class="ident" id="3551727">base</span><span class="op" id="3551731">[</span><span class="num" id="3551732">0</span><span class="op" id="3551733">]</span>&nbsp;<span class="op" id="3551735">==</span>&nbsp;<span class="ident" id="3551738">Separator</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551749">targSlashed</span>&nbsp;<span class="op" id="3551761">:=</span>&nbsp;<span class="builtinfunc" id="3551764">len</span><span class="op" id="3551767">(</span><span class="ident" id="3551768">targ</span><span class="op" id="3551772">)</span>&nbsp;<span class="op" id="3551774">&gt;</span>&nbsp;<span class="num" id="3551776">0</span>&nbsp;<span class="op" id="3551778">&amp;&amp;</span>&nbsp;<span class="ident" id="3551781">targ</span><span class="op" id="3551785">[</span><span class="num" id="3551786">0</span><span class="op" id="3551787">]</span>&nbsp;<span class="op" id="3551789">==</span>&nbsp;<span class="ident" id="3551792">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551803">if</span>&nbsp;<span class="ident" id="3551806">baseSlashed</span>&nbsp;<span class="op" id="3551818">!=</span>&nbsp;<span class="ident" id="3551821">targSlashed</span>&nbsp;<span class="op" id="3551833">||</span>&nbsp;<span class="ident" id="3551836">baseVol</span>&nbsp;<span class="op" id="3551844">!=</span>&nbsp;<span class="ident" id="3551847">targVol</span>&nbsp;<span class="op" id="3551855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551859">return</span>&nbsp;<span class="string" id="3551866">&#34;&#34;</span><span class="op" id="3551868">,</span>&nbsp;<span class="ident" id="3551870">errors</span><span class="op" id="3551876">.</span><span class="ident" id="3551877">New</span><span class="op" id="3551880">(</span><span class="string" id="3551881">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="3551900">+</span>&nbsp;<span class="ident" id="3551902">targ</span>&nbsp;<span class="op" id="3551907">+</span>&nbsp;<span class="string" id="3551909">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="3551925">+</span>&nbsp;<span class="ident" id="3551927">base</span><span class="op" id="3551931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3551937">//&nbsp;Position&nbsp;base[b0:bi]&nbsp;and&nbsp;targ[t0:ti]&nbsp;at&nbsp;the&nbsp;first&nbsp;differing&nbsp;elements.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552011">bl</span>&nbsp;<span class="op" id="3552014">:=</span>&nbsp;<span class="builtinfunc" id="3552017">len</span><span class="op" id="3552020">(</span><span class="ident" id="3552021">base</span><span class="op" id="3552025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552028">tl</span>&nbsp;<span class="op" id="3552031">:=</span>&nbsp;<span class="builtinfunc" id="3552034">len</span><span class="op" id="3552037">(</span><span class="ident" id="3552038">targ</span><span class="op" id="3552042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552045">var</span>&nbsp;<span class="ident" id="3552049">b0</span><span class="op" id="3552051">,</span>&nbsp;<span class="ident" id="3552053">bi</span><span class="op" id="3552055">,</span>&nbsp;<span class="ident" id="3552057">t0</span><span class="op" id="3552059">,</span>&nbsp;<span class="ident" id="3552061">ti</span>&nbsp;<span class="builtintype" id="3552064">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552069">for</span>&nbsp;<span class="op" id="3552073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552077">for</span>&nbsp;<span class="ident" id="3552081">bi</span>&nbsp;<span class="op" id="3552084">&lt;</span>&nbsp;<span class="ident" id="3552086">bl</span>&nbsp;<span class="op" id="3552089">&amp;&amp;</span>&nbsp;<span class="ident" id="3552092">base</span><span class="op" id="3552096">[</span><span class="ident" id="3552097">bi</span><span class="op" id="3552099">]</span>&nbsp;<span class="op" id="3552101">!=</span>&nbsp;<span class="ident" id="3552104">Separator</span>&nbsp;<span class="op" id="3552114">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552119">bi</span><span class="op" id="3552121">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552130">for</span>&nbsp;<span class="ident" id="3552134">ti</span>&nbsp;<span class="op" id="3552137">&lt;</span>&nbsp;<span class="ident" id="3552139">tl</span>&nbsp;<span class="op" id="3552142">&amp;&amp;</span>&nbsp;<span class="ident" id="3552145">targ</span><span class="op" id="3552149">[</span><span class="ident" id="3552150">ti</span><span class="op" id="3552152">]</span>&nbsp;<span class="op" id="3552154">!=</span>&nbsp;<span class="ident" id="3552157">Separator</span>&nbsp;<span class="op" id="3552167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552172">ti</span><span class="op" id="3552174">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552179">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552183">if</span>&nbsp;<span class="ident" id="3552186">targ</span><span class="op" id="3552190">[</span><span class="ident" id="3552191">t0</span><span class="op" id="3552193">:</span><span class="ident" id="3552194">ti</span><span class="op" id="3552196">]</span>&nbsp;<span class="op" id="3552198">!=</span>&nbsp;<span class="ident" id="3552201">base</span><span class="op" id="3552205">[</span><span class="ident" id="3552206">b0</span><span class="op" id="3552208">:</span><span class="ident" id="3552209">bi</span><span class="op" id="3552211">]</span>&nbsp;<span class="op" id="3552213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552218">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552230">if</span>&nbsp;<span class="ident" id="3552233">bi</span>&nbsp;<span class="op" id="3552236">&lt;</span>&nbsp;<span class="ident" id="3552238">bl</span>&nbsp;<span class="op" id="3552241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552246">bi</span><span class="op" id="3552248">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552257">if</span>&nbsp;<span class="ident" id="3552260">ti</span>&nbsp;<span class="op" id="3552263">&lt;</span>&nbsp;<span class="ident" id="3552265">tl</span>&nbsp;<span class="op" id="3552268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552273">ti</span><span class="op" id="3552275">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552284">b0</span>&nbsp;<span class="op" id="3552287">=</span>&nbsp;<span class="ident" id="3552289">bi</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552294">t0</span>&nbsp;<span class="op" id="3552297">=</span>&nbsp;<span class="ident" id="3552299">ti</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552306">if</span>&nbsp;<span class="ident" id="3552309">base</span><span class="op" id="3552313">[</span><span class="ident" id="3552314">b0</span><span class="op" id="3552316">:</span><span class="ident" id="3552317">bi</span><span class="op" id="3552319">]</span>&nbsp;<span class="op" id="3552321">==</span>&nbsp;<span class="string" id="3552324">&#34;..&#34;</span>&nbsp;<span class="op" id="3552329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552333">return</span>&nbsp;<span class="string" id="3552340">&#34;&#34;</span><span class="op" id="3552342">,</span>&nbsp;<span class="ident" id="3552344">errors</span><span class="op" id="3552350">.</span><span class="ident" id="3552351">New</span><span class="op" id="3552354">(</span><span class="string" id="3552355">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="3552374">+</span>&nbsp;<span class="ident" id="3552376">targ</span>&nbsp;<span class="op" id="3552381">+</span>&nbsp;<span class="string" id="3552383">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="3552399">+</span>&nbsp;<span class="ident" id="3552401">base</span><span class="op" id="3552405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552408">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552411">if</span>&nbsp;<span class="ident" id="3552414">b0</span>&nbsp;<span class="op" id="3552417">!=</span>&nbsp;<span class="ident" id="3552420">bl</span>&nbsp;<span class="op" id="3552423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3552427">//&nbsp;Base&nbsp;elements&nbsp;left.&nbsp;Must&nbsp;go&nbsp;up&nbsp;before&nbsp;going&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552482">seps</span>&nbsp;<span class="op" id="3552487">:=</span>&nbsp;<span class="ident" id="3552490">strings</span><span class="op" id="3552497">.</span><span class="ident" id="3552498">Count</span><span class="op" id="3552503">(</span><span class="ident" id="3552504">base</span><span class="op" id="3552508">[</span><span class="ident" id="3552509">b0</span><span class="op" id="3552511">:</span><span class="ident" id="3552512">bl</span><span class="op" id="3552514">]</span><span class="op" id="3552515">,</span>&nbsp;<span class="builtintype" id="3552517">string</span><span class="op" id="3552523">(</span><span class="ident" id="3552524">Separator</span><span class="op" id="3552533">)</span><span class="op" id="3552534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552538">size</span>&nbsp;<span class="op" id="3552543">:=</span>&nbsp;<span class="num" id="3552546">2</span>&nbsp;<span class="op" id="3552548">+</span>&nbsp;<span class="ident" id="3552550">seps</span><span class="op" id="3552554">*</span><span class="num" id="3552555">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552559">if</span>&nbsp;<span class="ident" id="3552562">tl</span>&nbsp;<span class="op" id="3552565">!=</span>&nbsp;<span class="ident" id="3552568">t0</span>&nbsp;<span class="op" id="3552571">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552576">size</span>&nbsp;<span class="op" id="3552581">+=</span>&nbsp;<span class="num" id="3552584">1</span>&nbsp;<span class="op" id="3552586">+</span>&nbsp;<span class="ident" id="3552588">tl</span>&nbsp;<span class="op" id="3552591">-</span>&nbsp;<span class="ident" id="3552593">t0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552602">buf</span>&nbsp;<span class="op" id="3552606">:=</span>&nbsp;<span class="builtinfunc" id="3552609">make</span><span class="op" id="3552613">(</span><span class="op" id="3552614">[</span><span class="op" id="3552615">]</span><span class="builtintype" id="3552616">byte</span><span class="op" id="3552620">,</span>&nbsp;<span class="ident" id="3552622">size</span><span class="op" id="3552626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552630">n</span>&nbsp;<span class="op" id="3552632">:=</span>&nbsp;<span class="builtinfunc" id="3552635">copy</span><span class="op" id="3552639">(</span><span class="ident" id="3552640">buf</span><span class="op" id="3552643">,</span>&nbsp;<span class="string" id="3552645">&#34;..&#34;</span><span class="op" id="3552649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552653">for</span>&nbsp;<span class="ident" id="3552657">i</span>&nbsp;<span class="op" id="3552659">:=</span>&nbsp;<span class="num" id="3552662">0</span><span class="op" id="3552663">;</span>&nbsp;<span class="ident" id="3552665">i</span>&nbsp;<span class="op" id="3552667">&lt;</span>&nbsp;<span class="ident" id="3552669">seps</span><span class="op" id="3552673">;</span>&nbsp;<span class="ident" id="3552675">i</span><span class="op" id="3552676">++</span>&nbsp;<span class="op" id="3552679">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552684">buf</span><span class="op" id="3552687">[</span><span class="ident" id="3552688">n</span><span class="op" id="3552689">]</span>&nbsp;<span class="op" id="3552691">=</span>&nbsp;<span class="ident" id="3552693">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3552706">copy</span><span class="op" id="3552710">(</span><span class="ident" id="3552711">buf</span><span class="op" id="3552714">[</span><span class="ident" id="3552715">n</span><span class="op" id="3552716">+</span><span class="num" id="3552717">1</span><span class="op" id="3552718">:</span><span class="op" id="3552719">]</span><span class="op" id="3552720">,</span>&nbsp;<span class="string" id="3552722">&#34;..&#34;</span><span class="op" id="3552726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552731">n</span>&nbsp;<span class="op" id="3552733">+=</span>&nbsp;<span class="num" id="3552736">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552744">if</span>&nbsp;<span class="ident" id="3552747">t0</span>&nbsp;<span class="op" id="3552750">!=</span>&nbsp;<span class="ident" id="3552753">tl</span>&nbsp;<span class="op" id="3552756">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552761">buf</span><span class="op" id="3552764">[</span><span class="ident" id="3552765">n</span><span class="op" id="3552766">]</span>&nbsp;<span class="op" id="3552768">=</span>&nbsp;<span class="ident" id="3552770">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3552783">copy</span><span class="op" id="3552787">(</span><span class="ident" id="3552788">buf</span><span class="op" id="3552791">[</span><span class="ident" id="3552792">n</span><span class="op" id="3552793">+</span><span class="num" id="3552794">1</span><span class="op" id="3552795">:</span><span class="op" id="3552796">]</span><span class="op" id="3552797">,</span>&nbsp;<span class="ident" id="3552799">targ</span><span class="op" id="3552803">[</span><span class="ident" id="3552804">t0</span><span class="op" id="3552806">:</span><span class="op" id="3552807">]</span><span class="op" id="3552808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552816">return</span>&nbsp;<span class="builtintype" id="3552823">string</span><span class="op" id="3552829">(</span><span class="ident" id="3552830">buf</span><span class="op" id="3552833">)</span><span class="op" id="3552834">,</span>&nbsp;<span class="ident" id="3552836">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552841">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552844">return</span>&nbsp;<span class="ident" id="3552851">targ</span><span class="op" id="3552855">[</span><span class="ident" id="3552856">t0</span><span class="op" id="3552858">:</span><span class="op" id="3552859">]</span><span class="op" id="3552860">,</span>&nbsp;<span class="ident" id="3552862">nil</span><br>
<span class="lineno"></span><span class="op" id="3552866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3552869">//&nbsp;SkipDir&nbsp;is&nbsp;used&nbsp;as&nbsp;a&nbsp;return&nbsp;value&nbsp;from&nbsp;WalkFuncs&nbsp;to&nbsp;indicate&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3552938">//&nbsp;the&nbsp;directory&nbsp;named&nbsp;in&nbsp;the&nbsp;call&nbsp;is&nbsp;to&nbsp;be&nbsp;skipped.&nbsp;It&nbsp;is&nbsp;not&nbsp;returned</span><br>
<span class="lineno">325</span><span class="comment" id="3553010">//&nbsp;as&nbsp;an&nbsp;error&nbsp;by&nbsp;any&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3553042">var</span>&nbsp;<span class="ident" id="3553046">SkipDir</span>&nbsp;<span class="op" id="3553054">=</span>&nbsp;<span class="ident" id="3553056">errors</span><span class="op" id="3553062">.</span><span class="ident" id="3553063">New</span><span class="op" id="3553066">(</span><span class="string" id="3553067">&#34;skip&nbsp;this&nbsp;directory&#34;</span><span class="op" id="3553088">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3553091">//&nbsp;WalkFunc&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;function&nbsp;called&nbsp;for&nbsp;each&nbsp;file&nbsp;or&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="3553165">//&nbsp;visited&nbsp;by&nbsp;Walk.&nbsp;The&nbsp;path&nbsp;argument&nbsp;contains&nbsp;the&nbsp;argument&nbsp;to&nbsp;Walk&nbsp;as&nbsp;a</span><br>
<span class="lineno">330</span><span class="comment" id="3553238">//&nbsp;prefix;&nbsp;that&nbsp;is,&nbsp;if&nbsp;Walk&nbsp;is&nbsp;called&nbsp;with&nbsp;&#34;dir&#34;,&nbsp;which&nbsp;is&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="3553309">//&nbsp;containing&nbsp;the&nbsp;file&nbsp;&#34;a&#34;,&nbsp;the&nbsp;walk&nbsp;function&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="3553384">//&nbsp;&#34;dir/a&#34;.&nbsp;The&nbsp;info&nbsp;argument&nbsp;is&nbsp;the&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;named&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3553453">//</span><br>
<span class="lineno"></span><span class="comment" id="3553456">//&nbsp;If&nbsp;there&nbsp;was&nbsp;a&nbsp;problem&nbsp;walking&nbsp;to&nbsp;the&nbsp;file&nbsp;or&nbsp;directory&nbsp;named&nbsp;by&nbsp;path,&nbsp;the</span><br>
<span class="lineno">335</span><span class="comment" id="3553534">//&nbsp;incoming&nbsp;error&nbsp;will&nbsp;describe&nbsp;the&nbsp;problem&nbsp;and&nbsp;the&nbsp;function&nbsp;can&nbsp;decide&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="3553610">//&nbsp;to&nbsp;handle&nbsp;that&nbsp;error&nbsp;(and&nbsp;Walk&nbsp;will&nbsp;not&nbsp;descend&nbsp;into&nbsp;that&nbsp;directory).&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3553686">//&nbsp;an&nbsp;error&nbsp;is&nbsp;returned,&nbsp;processing&nbsp;stops.&nbsp;The&nbsp;sole&nbsp;exception&nbsp;is&nbsp;that&nbsp;if&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="3553764">//&nbsp;is&nbsp;a&nbsp;directory&nbsp;and&nbsp;the&nbsp;function&nbsp;returns&nbsp;the&nbsp;special&nbsp;value&nbsp;SkipDir,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3553838">//&nbsp;contents&nbsp;of&nbsp;the&nbsp;directory&nbsp;are&nbsp;skipped&nbsp;and&nbsp;processing&nbsp;continues&nbsp;as&nbsp;usual&nbsp;on</span><br>
<span class="lineno">340</span><span class="comment" id="3553916">//&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="3553934">type</span>&nbsp;<span class="ident" id="3553939">WalkFunc</span>&nbsp;<span class="keyword" id="3553948">func</span><span class="op" id="3553952">(</span><span class="ident" id="3553953">path</span>&nbsp;<span class="builtintype" id="3553958">string</span><span class="op" id="3553964">,</span>&nbsp;<span class="ident" id="3553966">info</span>&nbsp;<span class="ident" id="3553971">os</span><span class="op" id="3553973">.</span><span class="ident" id="3553974">FileInfo</span><span class="op" id="3553982">,</span>&nbsp;<span class="ident" id="3553984">err</span>&nbsp;<span class="builtintype" id="3553988">error</span><span class="op" id="3553993">)</span>&nbsp;<span class="builtintype" id="3553995">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3554002">var</span>&nbsp;<span class="ident" id="3554006">lstat</span>&nbsp;<span class="op" id="3554012">=</span>&nbsp;<span class="ident" id="3554014">os</span><span class="op" id="3554016">.</span><span class="ident" id="3554017">Lstat</span>&nbsp;<span class="comment" id="3554023">//&nbsp;for&nbsp;testing</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3554039">//&nbsp;walk&nbsp;recursively&nbsp;descends&nbsp;path,&nbsp;calling&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3554085">func</span>&nbsp;<span class="ident" id="3554090">walk</span><span class="op" id="3554094">(</span><span class="ident" id="3554095">path</span>&nbsp;<span class="builtintype" id="3554100">string</span><span class="op" id="3554106">,</span>&nbsp;<span class="ident" id="3554108">info</span>&nbsp;<span class="ident" id="3554113">os</span><span class="op" id="3554115">.</span><span class="ident" id="3554116">FileInfo</span><span class="op" id="3554124">,</span>&nbsp;<span class="ident" id="3554126">walkFn</span>&nbsp;<span class="ident" id="3554133">WalkFunc</span><span class="op" id="3554141">)</span>&nbsp;<span class="builtintype" id="3554143">error</span>&nbsp;<span class="op" id="3554149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554152">err</span>&nbsp;<span class="op" id="3554156">:=</span>&nbsp;<span class="ident" id="3554159">walkFn</span><span class="op" id="3554165">(</span><span class="ident" id="3554166">path</span><span class="op" id="3554170">,</span>&nbsp;<span class="ident" id="3554172">info</span><span class="op" id="3554176">,</span>&nbsp;<span class="ident" id="3554178">nil</span><span class="op" id="3554181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554184">if</span>&nbsp;<span class="ident" id="3554187">err</span>&nbsp;<span class="op" id="3554191">!=</span>&nbsp;<span class="ident" id="3554194">nil</span>&nbsp;<span class="op" id="3554198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554202">if</span>&nbsp;<span class="ident" id="3554205">info</span><span class="op" id="3554209">.</span><span class="ident" id="3554210">IsDir</span><span class="op" id="3554215">(</span><span class="op" id="3554216">)</span>&nbsp;<span class="op" id="3554218">&amp;&amp;</span>&nbsp;<span class="ident" id="3554221">err</span>&nbsp;<span class="op" id="3554225">==</span>&nbsp;<span class="ident" id="3554228">SkipDir</span>&nbsp;<span class="op" id="3554236">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554241">return</span>&nbsp;<span class="ident" id="3554248">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554258">return</span>&nbsp;<span class="ident" id="3554265">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554274">if</span>&nbsp;<span class="op" id="3554277">!</span><span class="ident" id="3554278">info</span><span class="op" id="3554282">.</span><span class="ident" id="3554283">IsDir</span><span class="op" id="3554288">(</span><span class="op" id="3554289">)</span>&nbsp;<span class="op" id="3554291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554295">return</span>&nbsp;<span class="ident" id="3554302">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554311">names</span><span class="op" id="3554316">,</span>&nbsp;<span class="ident" id="3554318">err</span>&nbsp;<span class="op" id="3554322">:=</span>&nbsp;<span class="ident" id="3554325">readDirNames</span><span class="op" id="3554337">(</span><span class="ident" id="3554338">path</span><span class="op" id="3554342">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554345">if</span>&nbsp;<span class="ident" id="3554348">err</span>&nbsp;<span class="op" id="3554352">!=</span>&nbsp;<span class="ident" id="3554355">nil</span>&nbsp;<span class="op" id="3554359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554363">return</span>&nbsp;<span class="ident" id="3554370">walkFn</span><span class="op" id="3554376">(</span><span class="ident" id="3554377">path</span><span class="op" id="3554381">,</span>&nbsp;<span class="ident" id="3554383">info</span><span class="op" id="3554387">,</span>&nbsp;<span class="ident" id="3554389">err</span><span class="op" id="3554392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554399">for</span>&nbsp;<span class="ident" id="3554403">_</span><span class="op" id="3554404">,</span>&nbsp;<span class="ident" id="3554406">name</span>&nbsp;<span class="op" id="3554411">:=</span>&nbsp;<span class="keyword" id="3554414">range</span>&nbsp;<span class="ident" id="3554420">names</span>&nbsp;<span class="op" id="3554426">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554430">filename</span>&nbsp;<span class="op" id="3554439">:=</span>&nbsp;<span class="ident" id="3554442">Join</span><span class="op" id="3554446">(</span><span class="ident" id="3554447">path</span><span class="op" id="3554451">,</span>&nbsp;<span class="ident" id="3554453">name</span><span class="op" id="3554457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554461">fileInfo</span><span class="op" id="3554469">,</span>&nbsp;<span class="ident" id="3554471">err</span>&nbsp;<span class="op" id="3554475">:=</span>&nbsp;<span class="ident" id="3554478">lstat</span><span class="op" id="3554483">(</span><span class="ident" id="3554484">filename</span><span class="op" id="3554492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554496">if</span>&nbsp;<span class="ident" id="3554499">err</span>&nbsp;<span class="op" id="3554503">!=</span>&nbsp;<span class="ident" id="3554506">nil</span>&nbsp;<span class="op" id="3554510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554515">if</span>&nbsp;<span class="ident" id="3554518">err</span>&nbsp;<span class="op" id="3554522">:=</span>&nbsp;<span class="ident" id="3554525">walkFn</span><span class="op" id="3554531">(</span><span class="ident" id="3554532">filename</span><span class="op" id="3554540">,</span>&nbsp;<span class="ident" id="3554542">fileInfo</span><span class="op" id="3554550">,</span>&nbsp;<span class="ident" id="3554552">err</span><span class="op" id="3554555">)</span><span class="op" id="3554556">;</span>&nbsp;<span class="ident" id="3554558">err</span>&nbsp;<span class="op" id="3554562">!=</span>&nbsp;<span class="ident" id="3554565">nil</span>&nbsp;<span class="op" id="3554569">&amp;&amp;</span>&nbsp;<span class="ident" id="3554572">err</span>&nbsp;<span class="op" id="3554576">!=</span>&nbsp;<span class="ident" id="3554579">SkipDir</span>&nbsp;<span class="op" id="3554587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554593">return</span>&nbsp;<span class="ident" id="3554600">err</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554611">}</span>&nbsp;<span class="keyword" id="3554613">else</span>&nbsp;<span class="op" id="3554618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554623">err</span>&nbsp;<span class="op" id="3554627">=</span>&nbsp;<span class="ident" id="3554629">walk</span><span class="op" id="3554633">(</span><span class="ident" id="3554634">filename</span><span class="op" id="3554642">,</span>&nbsp;<span class="ident" id="3554644">fileInfo</span><span class="op" id="3554652">,</span>&nbsp;<span class="ident" id="3554654">walkFn</span><span class="op" id="3554660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554665">if</span>&nbsp;<span class="ident" id="3554668">err</span>&nbsp;<span class="op" id="3554672">!=</span>&nbsp;<span class="ident" id="3554675">nil</span>&nbsp;<span class="op" id="3554679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554685">if</span>&nbsp;<span class="op" id="3554688">!</span><span class="ident" id="3554689">fileInfo</span><span class="op" id="3554697">.</span><span class="ident" id="3554698">IsDir</span><span class="op" id="3554703">(</span><span class="op" id="3554704">)</span>&nbsp;<span class="op" id="3554706">||</span>&nbsp;<span class="ident" id="3554709">err</span>&nbsp;<span class="op" id="3554713">!=</span>&nbsp;<span class="ident" id="3554716">SkipDir</span>&nbsp;<span class="op" id="3554724">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554731">return</span>&nbsp;<span class="ident" id="3554738">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554758">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554761">return</span>&nbsp;<span class="ident" id="3554768">nil</span><br>
<span class="lineno"></span><span class="op" id="3554772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3554775">//&nbsp;Walk&nbsp;walks&nbsp;the&nbsp;file&nbsp;tree&nbsp;rooted&nbsp;at&nbsp;root,&nbsp;calling&nbsp;walkFn&nbsp;for&nbsp;each&nbsp;file&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3554851">//&nbsp;directory&nbsp;in&nbsp;the&nbsp;tree,&nbsp;including&nbsp;root.&nbsp;All&nbsp;errors&nbsp;that&nbsp;arise&nbsp;visiting&nbsp;files</span><br>
<span class="lineno">385</span><span class="comment" id="3554930">//&nbsp;and&nbsp;directories&nbsp;are&nbsp;filtered&nbsp;by&nbsp;walkFn.&nbsp;The&nbsp;files&nbsp;are&nbsp;walked&nbsp;in&nbsp;lexical</span><br>
<span class="lineno"></span><span class="comment" id="3555005">//&nbsp;order,&nbsp;which&nbsp;makes&nbsp;the&nbsp;output&nbsp;deterministic&nbsp;but&nbsp;means&nbsp;that&nbsp;for&nbsp;very</span><br>
<span class="lineno"></span><span class="comment" id="3555076">//&nbsp;large&nbsp;directories&nbsp;Walk&nbsp;can&nbsp;be&nbsp;inefficient.</span><br>
<span class="lineno"></span><span class="comment" id="3555122">//&nbsp;Walk&nbsp;does&nbsp;not&nbsp;follow&nbsp;symbolic&nbsp;links.</span><br>
<span class="lineno"></span><span class="keyword" id="3555162">func</span>&nbsp;<span class="ident" id="3555167">Walk</span><span class="op" id="3555171">(</span><span class="ident" id="3555172">root</span>&nbsp;<span class="builtintype" id="3555177">string</span><span class="op" id="3555183">,</span>&nbsp;<span class="ident" id="3555185">walkFn</span>&nbsp;<span class="ident" id="3555192">WalkFunc</span><span class="op" id="3555200">)</span>&nbsp;<span class="builtintype" id="3555202">error</span>&nbsp;<span class="op" id="3555208">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555211">info</span><span class="op" id="3555215">,</span>&nbsp;<span class="ident" id="3555217">err</span>&nbsp;<span class="op" id="3555221">:=</span>&nbsp;<span class="ident" id="3555224">os</span><span class="op" id="3555226">.</span><span class="ident" id="3555227">Lstat</span><span class="op" id="3555232">(</span><span class="ident" id="3555233">root</span><span class="op" id="3555237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555240">if</span>&nbsp;<span class="ident" id="3555243">err</span>&nbsp;<span class="op" id="3555247">!=</span>&nbsp;<span class="ident" id="3555250">nil</span>&nbsp;<span class="op" id="3555254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555258">return</span>&nbsp;<span class="ident" id="3555265">walkFn</span><span class="op" id="3555271">(</span><span class="ident" id="3555272">root</span><span class="op" id="3555276">,</span>&nbsp;<span class="ident" id="3555278">nil</span><span class="op" id="3555281">,</span>&nbsp;<span class="ident" id="3555283">err</span><span class="op" id="3555286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555292">return</span>&nbsp;<span class="ident" id="3555299">walk</span><span class="op" id="3555303">(</span><span class="ident" id="3555304">root</span><span class="op" id="3555308">,</span>&nbsp;<span class="ident" id="3555310">info</span><span class="op" id="3555314">,</span>&nbsp;<span class="ident" id="3555316">walkFn</span><span class="op" id="3555322">)</span><br>
<span class="lineno">395</span><span class="op" id="3555324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3555327">//&nbsp;readDirNames&nbsp;reads&nbsp;the&nbsp;directory&nbsp;named&nbsp;by&nbsp;dirname&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3555392">//&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3555431">func</span>&nbsp;<span class="ident" id="3555436">readDirNames</span><span class="op" id="3555448">(</span><span class="ident" id="3555449">dirname</span>&nbsp;<span class="builtintype" id="3555457">string</span><span class="op" id="3555463">)</span>&nbsp;<span class="op" id="3555465">(</span><span class="op" id="3555466">[</span><span class="op" id="3555467">]</span><span class="builtintype" id="3555468">string</span><span class="op" id="3555474">,</span>&nbsp;<span class="builtintype" id="3555476">error</span><span class="op" id="3555481">)</span>&nbsp;<span class="op" id="3555483">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555486">f</span><span class="op" id="3555487">,</span>&nbsp;<span class="ident" id="3555489">err</span>&nbsp;<span class="op" id="3555493">:=</span>&nbsp;<span class="ident" id="3555496">os</span><span class="op" id="3555498">.</span><span class="ident" id="3555499">Open</span><span class="op" id="3555503">(</span><span class="ident" id="3555504">dirname</span><span class="op" id="3555511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555514">if</span>&nbsp;<span class="ident" id="3555517">err</span>&nbsp;<span class="op" id="3555521">!=</span>&nbsp;<span class="ident" id="3555524">nil</span>&nbsp;<span class="op" id="3555528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555532">return</span>&nbsp;<span class="ident" id="3555539">nil</span><span class="op" id="3555542">,</span>&nbsp;<span class="ident" id="3555544">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555552">names</span><span class="op" id="3555557">,</span>&nbsp;<span class="ident" id="3555559">err</span>&nbsp;<span class="op" id="3555563">:=</span>&nbsp;<span class="ident" id="3555566">f</span><span class="op" id="3555567">.</span><span class="ident" id="3555568">Readdirnames</span><span class="op" id="3555580">(</span><span class="op" id="3555581">-</span><span class="num" id="3555582">1</span><span class="op" id="3555583">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555586">f</span><span class="op" id="3555587">.</span><span class="ident" id="3555588">Close</span><span class="op" id="3555593">(</span><span class="op" id="3555594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555597">if</span>&nbsp;<span class="ident" id="3555600">err</span>&nbsp;<span class="op" id="3555604">!=</span>&nbsp;<span class="ident" id="3555607">nil</span>&nbsp;<span class="op" id="3555611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555615">return</span>&nbsp;<span class="ident" id="3555622">nil</span><span class="op" id="3555625">,</span>&nbsp;<span class="ident" id="3555627">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555635">sort</span><span class="op" id="3555639">.</span><span class="ident" id="3555640">Strings</span><span class="op" id="3555647">(</span><span class="ident" id="3555648">names</span><span class="op" id="3555653">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555656">return</span>&nbsp;<span class="ident" id="3555663">names</span><span class="op" id="3555668">,</span>&nbsp;<span class="ident" id="3555670">nil</span><br>
<span class="lineno"></span><span class="op" id="3555674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3555677">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3555719">//&nbsp;Trailing&nbsp;path&nbsp;separators&nbsp;are&nbsp;removed&nbsp;before&nbsp;extracting&nbsp;the&nbsp;last&nbsp;element.</span><br>
<span class="lineno">415</span><span class="comment" id="3555795">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Base&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3555838">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Base&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="keyword" id="3555919">func</span>&nbsp;<span class="ident" id="3555924">Base</span><span class="op" id="3555928">(</span><span class="ident" id="3555929">path</span>&nbsp;<span class="builtintype" id="3555934">string</span><span class="op" id="3555940">)</span>&nbsp;<span class="builtintype" id="3555942">string</span>&nbsp;<span class="op" id="3555949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555952">if</span>&nbsp;<span class="ident" id="3555955">path</span>&nbsp;<span class="op" id="3555960">==</span>&nbsp;<span class="string" id="3555963">&#34;&#34;</span>&nbsp;<span class="op" id="3555966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555970">return</span>&nbsp;<span class="string" id="3555977">&#34;.&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555985">//&nbsp;Strip&nbsp;trailing&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556013">for</span>&nbsp;<span class="builtinfunc" id="3556017">len</span><span class="op" id="3556020">(</span><span class="ident" id="3556021">path</span><span class="op" id="3556025">)</span>&nbsp;<span class="op" id="3556027">&gt;</span>&nbsp;<span class="num" id="3556029">0</span>&nbsp;<span class="op" id="3556031">&amp;&amp;</span>&nbsp;<span class="ident" id="3556034">os</span><span class="op" id="3556036">.</span><span class="ident" id="3556037">IsPathSeparator</span><span class="op" id="3556052">(</span><span class="ident" id="3556053">path</span><span class="op" id="3556057">[</span><span class="builtinfunc" id="3556058">len</span><span class="op" id="3556061">(</span><span class="ident" id="3556062">path</span><span class="op" id="3556066">)</span><span class="op" id="3556067">-</span><span class="num" id="3556068">1</span><span class="op" id="3556069">]</span><span class="op" id="3556070">)</span>&nbsp;<span class="op" id="3556072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556076">path</span>&nbsp;<span class="op" id="3556081">=</span>&nbsp;<span class="ident" id="3556083">path</span><span class="op" id="3556087">[</span><span class="num" id="3556088">0</span>&nbsp;<span class="op" id="3556090">:</span>&nbsp;<span class="builtinfunc" id="3556092">len</span><span class="op" id="3556095">(</span><span class="ident" id="3556096">path</span><span class="op" id="3556100">)</span><span class="op" id="3556101">-</span><span class="num" id="3556102">1</span><span class="op" id="3556103">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556106">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556109">//&nbsp;Throw&nbsp;away&nbsp;volume&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556136">path</span>&nbsp;<span class="op" id="3556141">=</span>&nbsp;<span class="ident" id="3556143">path</span><span class="op" id="3556147">[</span><span class="builtinfunc" id="3556148">len</span><span class="op" id="3556151">(</span><span class="ident" id="3556152">VolumeName</span><span class="op" id="3556162">(</span><span class="ident" id="3556163">path</span><span class="op" id="3556167">)</span><span class="op" id="3556168">)</span><span class="op" id="3556169">:</span><span class="op" id="3556170">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556173">//&nbsp;Find&nbsp;the&nbsp;last&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556199">i</span>&nbsp;<span class="op" id="3556201">:=</span>&nbsp;<span class="builtinfunc" id="3556204">len</span><span class="op" id="3556207">(</span><span class="ident" id="3556208">path</span><span class="op" id="3556212">)</span>&nbsp;<span class="op" id="3556214">-</span>&nbsp;<span class="num" id="3556216">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556219">for</span>&nbsp;<span class="ident" id="3556223">i</span>&nbsp;<span class="op" id="3556225">&gt;=</span>&nbsp;<span class="num" id="3556228">0</span>&nbsp;<span class="op" id="3556230">&amp;&amp;</span>&nbsp;<span class="op" id="3556233">!</span><span class="ident" id="3556234">os</span><span class="op" id="3556236">.</span><span class="ident" id="3556237">IsPathSeparator</span><span class="op" id="3556252">(</span><span class="ident" id="3556253">path</span><span class="op" id="3556257">[</span><span class="ident" id="3556258">i</span><span class="op" id="3556259">]</span><span class="op" id="3556260">)</span>&nbsp;<span class="op" id="3556262">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556266">i</span><span class="op" id="3556267">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556274">if</span>&nbsp;<span class="ident" id="3556277">i</span>&nbsp;<span class="op" id="3556279">&gt;=</span>&nbsp;<span class="num" id="3556282">0</span>&nbsp;<span class="op" id="3556284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556288">path</span>&nbsp;<span class="op" id="3556293">=</span>&nbsp;<span class="ident" id="3556295">path</span><span class="op" id="3556299">[</span><span class="ident" id="3556300">i</span><span class="op" id="3556301">+</span><span class="num" id="3556302">1</span><span class="op" id="3556303">:</span><span class="op" id="3556304">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556307">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556310">//&nbsp;If&nbsp;empty&nbsp;now,&nbsp;it&nbsp;had&nbsp;only&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556349">if</span>&nbsp;<span class="ident" id="3556352">path</span>&nbsp;<span class="op" id="3556357">==</span>&nbsp;<span class="string" id="3556360">&#34;&#34;</span>&nbsp;<span class="op" id="3556363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556367">return</span>&nbsp;<span class="builtintype" id="3556374">string</span><span class="op" id="3556380">(</span><span class="ident" id="3556381">Separator</span><span class="op" id="3556390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556396">return</span>&nbsp;<span class="ident" id="3556403">path</span><br>
<span class="lineno">440</span><span class="op" id="3556408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3556411">//&nbsp;Dir&nbsp;returns&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path,&nbsp;typically&nbsp;the&nbsp;path&#39;s&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="3556492">//&nbsp;After&nbsp;dropping&nbsp;the&nbsp;final&nbsp;element,&nbsp;the&nbsp;path&nbsp;is&nbsp;Cleaned&nbsp;and&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3556562">//&nbsp;slashes&nbsp;are&nbsp;removed.</span><br>
<span class="lineno">445</span><span class="comment" id="3556586">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Dir&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3556628">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Dir&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="comment" id="3556708">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;a&nbsp;separator&nbsp;unless&nbsp;it&nbsp;is&nbsp;the&nbsp;root&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="3556790">func</span>&nbsp;<span class="ident" id="3556795">Dir</span><span class="op" id="3556798">(</span><span class="ident" id="3556799">path</span>&nbsp;<span class="builtintype" id="3556804">string</span><span class="op" id="3556810">)</span>&nbsp;<span class="builtintype" id="3556812">string</span>&nbsp;<span class="op" id="3556819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556822">vol</span>&nbsp;<span class="op" id="3556826">:=</span>&nbsp;<span class="ident" id="3556829">VolumeName</span><span class="op" id="3556839">(</span><span class="ident" id="3556840">path</span><span class="op" id="3556844">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556847">i</span>&nbsp;<span class="op" id="3556849">:=</span>&nbsp;<span class="builtinfunc" id="3556852">len</span><span class="op" id="3556855">(</span><span class="ident" id="3556856">path</span><span class="op" id="3556860">)</span>&nbsp;<span class="op" id="3556862">-</span>&nbsp;<span class="num" id="3556864">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556867">for</span>&nbsp;<span class="ident" id="3556871">i</span>&nbsp;<span class="op" id="3556873">&gt;=</span>&nbsp;<span class="builtinfunc" id="3556876">len</span><span class="op" id="3556879">(</span><span class="ident" id="3556880">vol</span><span class="op" id="3556883">)</span>&nbsp;<span class="op" id="3556885">&amp;&amp;</span>&nbsp;<span class="op" id="3556888">!</span><span class="ident" id="3556889">os</span><span class="op" id="3556891">.</span><span class="ident" id="3556892">IsPathSeparator</span><span class="op" id="3556907">(</span><span class="ident" id="3556908">path</span><span class="op" id="3556912">[</span><span class="ident" id="3556913">i</span><span class="op" id="3556914">]</span><span class="op" id="3556915">)</span>&nbsp;<span class="op" id="3556917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556921">i</span><span class="op" id="3556922">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556929">dir</span>&nbsp;<span class="op" id="3556933">:=</span>&nbsp;<span class="ident" id="3556936">Clean</span><span class="op" id="3556941">(</span><span class="ident" id="3556942">path</span><span class="op" id="3556946">[</span><span class="builtinfunc" id="3556947">len</span><span class="op" id="3556950">(</span><span class="ident" id="3556951">vol</span><span class="op" id="3556954">)</span>&nbsp;<span class="op" id="3556956">:</span>&nbsp;<span class="ident" id="3556958">i</span><span class="op" id="3556959">+</span><span class="num" id="3556960">1</span><span class="op" id="3556961">]</span><span class="op" id="3556962">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556965">return</span>&nbsp;<span class="ident" id="3556972">vol</span>&nbsp;<span class="op" id="3556976">+</span>&nbsp;<span class="ident" id="3556978">dir</span><br>
<span class="lineno"></span><span class="op" id="3556982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3556985">//&nbsp;VolumeName&nbsp;returns&nbsp;leading&nbsp;volume&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3557028">//&nbsp;Given&nbsp;&#34;C:\foo\bar&#34;&nbsp;it&nbsp;returns&nbsp;&#34;C:&#34;&nbsp;under&nbsp;windows.</span><br>
<span class="lineno">460</span><span class="comment" id="3557081">//&nbsp;Given&nbsp;&#34;\\host\share\foo&#34;&nbsp;it&nbsp;returns&nbsp;&#34;\\host\share&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3557136">//&nbsp;On&nbsp;other&nbsp;platforms&nbsp;it&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3557173">func</span>&nbsp;<span class="ident" id="3557178">VolumeName</span><span class="op" id="3557188">(</span><span class="ident" id="3557189">path</span>&nbsp;<span class="builtintype" id="3557194">string</span><span class="op" id="3557200">)</span>&nbsp;<span class="op" id="3557202">(</span><span class="ident" id="3557203">v</span>&nbsp;<span class="builtintype" id="3557205">string</span><span class="op" id="3557211">)</span>&nbsp;<span class="op" id="3557213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557216">return</span>&nbsp;<span class="ident" id="3557223">path</span><span class="op" id="3557227">[</span><span class="op" id="3557228">:</span><span class="ident" id="3557229">volumeNameLen</span><span class="op" id="3557242">(</span><span class="ident" id="3557243">path</span><span class="op" id="3557247">)</span><span class="op" id="3557248">]</span><br>
<span class="lineno"></span><span class="op" id="3557250">}</span>
</div>
</body>
</html>
