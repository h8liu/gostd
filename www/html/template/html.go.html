<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3313133">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3313188">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3313242">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3313293">package</span>&nbsp;<span class="ident" id="3313301">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3313311">import</span>&nbsp;<span class="op" id="3313318">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3313321">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3313330">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3313337">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3313348">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3313363">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3313366">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="3313440">func</span>&nbsp;<span class="ident" id="3313445">htmlNospaceEscaper</span><span class="op" id="3313463">(</span><span class="ident" id="3313464">args</span>&nbsp;<span class="op" id="3313469">...</span><span class="keyword" id="3313472">interface</span><span class="op" id="3313481">{</span><span class="op" id="3313482">}</span><span class="op" id="3313483">)</span>&nbsp;<span class="builtintype" id="3313485">string</span>&nbsp;<span class="op" id="3313492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313495">s</span><span class="op" id="3313496">,</span>&nbsp;<span class="ident" id="3313498">t</span>&nbsp;<span class="op" id="3313500">:=</span>&nbsp;<span class="ident" id="3313503"><a href="/html/template/content.go.html#3256165">stringify</a></span><span class="op" id="3313512">(</span><span class="ident" id="3313513"><a href="/html/template/html.go.html#3313464">args</a></span><span class="op" id="3313517">...</span><span class="op" id="3313520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313523">if</span>&nbsp;<span class="ident" id="3313526"><a href="/html/template/html.go.html#3313498">t</a></span>&nbsp;<span class="op" id="3313528">==</span>&nbsp;<span class="ident" id="3313531"><a href="/html/template/content.go.html#3254697">contentTypeHTML</a></span>&nbsp;<span class="op" id="3313547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313551">return</span>&nbsp;<span class="ident" id="3313558"><a href="/html/template/html.go.html#3317063">htmlReplacer</a></span><span class="op" id="3313570">(</span><span class="ident" id="3313571"><a href="/html/template/html.go.html#3317951">stripTags</a></span><span class="op" id="3313580">(</span><span class="ident" id="3313581"><a href="/html/template/html.go.html#3313495">s</a></span><span class="op" id="3313582">)</span><span class="op" id="3313583">,</span>&nbsp;<span class="ident" id="3313585"><a href="/html/template/html.go.html#3316500">htmlNospaceNormReplacementTable</a></span><span class="op" id="3313616">,</span>&nbsp;<span class="ident" id="3313618">false</span><span class="op" id="3313623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313626">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313629">return</span>&nbsp;<span class="ident" id="3313636"><a href="/html/template/html.go.html#3317063">htmlReplacer</a></span><span class="op" id="3313648">(</span><span class="ident" id="3313649"><a href="/html/template/html.go.html#3313495">s</a></span><span class="op" id="3313650">,</span>&nbsp;<span class="ident" id="3313652"><a href="/html/template/html.go.html#3315949">htmlNospaceReplacementTable</a></span><span class="op" id="3313679">,</span>&nbsp;<span class="ident" id="3313681">false</span><span class="op" id="3313686">)</span><br>
<span class="lineno"></span><span class="op" id="3313688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3313691">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3313756">func</span>&nbsp;<span class="ident" id="3313761">attrEscaper</span><span class="op" id="3313772">(</span><span class="ident" id="3313773">args</span>&nbsp;<span class="op" id="3313778">...</span><span class="keyword" id="3313781">interface</span><span class="op" id="3313790">{</span><span class="op" id="3313791">}</span><span class="op" id="3313792">)</span>&nbsp;<span class="builtintype" id="3313794">string</span>&nbsp;<span class="op" id="3313801">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313804">s</span><span class="op" id="3313805">,</span>&nbsp;<span class="ident" id="3313807">t</span>&nbsp;<span class="op" id="3313809">:=</span>&nbsp;<span class="ident" id="3313812"><a href="/html/template/content.go.html#3256165">stringify</a></span><span class="op" id="3313821">(</span><span class="ident" id="3313822"><a href="/html/template/html.go.html#3313773">args</a></span><span class="op" id="3313826">...</span><span class="op" id="3313829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313832">if</span>&nbsp;<span class="ident" id="3313835"><a href="/html/template/html.go.html#3313807">t</a></span>&nbsp;<span class="op" id="3313837">==</span>&nbsp;<span class="ident" id="3313840"><a href="/html/template/content.go.html#3254697">contentTypeHTML</a></span>&nbsp;<span class="op" id="3313856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313860">return</span>&nbsp;<span class="ident" id="3313867"><a href="/html/template/html.go.html#3317063">htmlReplacer</a></span><span class="op" id="3313879">(</span><span class="ident" id="3313880"><a href="/html/template/html.go.html#3317951">stripTags</a></span><span class="op" id="3313889">(</span><span class="ident" id="3313890"><a href="/html/template/html.go.html#3313804">s</a></span><span class="op" id="3313891">)</span><span class="op" id="3313892">,</span>&nbsp;<span class="ident" id="3313894"><a href="/html/template/html.go.html#3315172">htmlNormReplacementTable</a></span><span class="op" id="3313918">,</span>&nbsp;<span class="ident" id="3313920">true</span><span class="op" id="3313924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313930">return</span>&nbsp;<span class="ident" id="3313937"><a href="/html/template/html.go.html#3317063">htmlReplacer</a></span><span class="op" id="3313949">(</span><span class="ident" id="3313950"><a href="/html/template/html.go.html#3313804">s</a></span><span class="op" id="3313951">,</span>&nbsp;<span class="ident" id="3313953"><a href="/html/template/html.go.html#3314616">htmlReplacementTable</a></span><span class="op" id="3313973">,</span>&nbsp;<span class="ident" id="3313975">true</span><span class="op" id="3313979">)</span><br>
<span class="lineno">30</span><span class="op" id="3313981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3313984">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="3314050">func</span>&nbsp;<span class="ident" id="3314055">rcdataEscaper</span><span class="op" id="3314068">(</span><span class="ident" id="3314069">args</span>&nbsp;<span class="op" id="3314074">...</span><span class="keyword" id="3314077">interface</span><span class="op" id="3314086">{</span><span class="op" id="3314087">}</span><span class="op" id="3314088">)</span>&nbsp;<span class="builtintype" id="3314090">string</span>&nbsp;<span class="op" id="3314097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3314100">s</span><span class="op" id="3314101">,</span>&nbsp;<span class="ident" id="3314103">t</span>&nbsp;<span class="op" id="3314105">:=</span>&nbsp;<span class="ident" id="3314108"><a href="/html/template/content.go.html#3256165">stringify</a></span><span class="op" id="3314117">(</span><span class="ident" id="3314118"><a href="/html/template/html.go.html#3314069">args</a></span><span class="op" id="3314122">...</span><span class="op" id="3314125">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314128">if</span>&nbsp;<span class="ident" id="3314131"><a href="/html/template/html.go.html#3314103">t</a></span>&nbsp;<span class="op" id="3314133">==</span>&nbsp;<span class="ident" id="3314136"><a href="/html/template/content.go.html#3254697">contentTypeHTML</a></span>&nbsp;<span class="op" id="3314152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314156">return</span>&nbsp;<span class="ident" id="3314163"><a href="/html/template/html.go.html#3317063">htmlReplacer</a></span><span class="op" id="3314175">(</span><span class="ident" id="3314176"><a href="/html/template/html.go.html#3314100">s</a></span><span class="op" id="3314177">,</span>&nbsp;<span class="ident" id="3314179"><a href="/html/template/html.go.html#3315172">htmlNormReplacementTable</a></span><span class="op" id="3314203">,</span>&nbsp;<span class="ident" id="3314205">true</span><span class="op" id="3314209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314215">return</span>&nbsp;<span class="ident" id="3314222"><a href="/html/template/html.go.html#3317063">htmlReplacer</a></span><span class="op" id="3314234">(</span><span class="ident" id="3314235"><a href="/html/template/html.go.html#3314100">s</a></span><span class="op" id="3314236">,</span>&nbsp;<span class="ident" id="3314238"><a href="/html/template/html.go.html#3314616">htmlReplacementTable</a></span><span class="op" id="3314258">,</span>&nbsp;<span class="ident" id="3314260">true</span><span class="op" id="3314264">)</span><br>
<span class="lineno"></span><span class="op" id="3314266">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3314269">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="3314320">func</span>&nbsp;<span class="ident" id="3314325">htmlEscaper</span><span class="op" id="3314336">(</span><span class="ident" id="3314337">args</span>&nbsp;<span class="op" id="3314342">...</span><span class="keyword" id="3314345">interface</span><span class="op" id="3314354">{</span><span class="op" id="3314355">}</span><span class="op" id="3314356">)</span>&nbsp;<span class="builtintype" id="3314358">string</span>&nbsp;<span class="op" id="3314365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3314368">s</span><span class="op" id="3314369">,</span>&nbsp;<span class="ident" id="3314371">t</span>&nbsp;<span class="op" id="3314373">:=</span>&nbsp;<span class="ident" id="3314376"><a href="/html/template/content.go.html#3256165">stringify</a></span><span class="op" id="3314385">(</span><span class="ident" id="3314386"><a href="/html/template/html.go.html#3314337">args</a></span><span class="op" id="3314390">...</span><span class="op" id="3314393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314396">if</span>&nbsp;<span class="ident" id="3314399"><a href="/html/template/html.go.html#3314371">t</a></span>&nbsp;<span class="op" id="3314401">==</span>&nbsp;<span class="ident" id="3314404"><a href="/html/template/content.go.html#3254697">contentTypeHTML</a></span>&nbsp;<span class="op" id="3314420">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314424">return</span>&nbsp;<span class="ident" id="3314431"><a href="/html/template/html.go.html#3314368">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314437">return</span>&nbsp;<span class="ident" id="3314444"><a href="/html/template/html.go.html#3317063">htmlReplacer</a></span><span class="op" id="3314456">(</span><span class="ident" id="3314457"><a href="/html/template/html.go.html#3314368">s</a></span><span class="op" id="3314458">,</span>&nbsp;<span class="ident" id="3314460"><a href="/html/template/html.go.html#3314616">htmlReplacementTable</a></span><span class="op" id="3314480">,</span>&nbsp;<span class="ident" id="3314482">true</span><span class="op" id="3314486">)</span><br>
<span class="lineno"></span><span class="op" id="3314488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3314491">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="3314558">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="3314612">var</span>&nbsp;<span class="ident" id="3314616">htmlReplacementTable</span>&nbsp;<span class="op" id="3314637">=</span>&nbsp;<span class="op" id="3314639">[</span><span class="op" id="3314640">]</span><span class="builtintype" id="3314641">string</span><span class="op" id="3314647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3314650">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3314726">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3314783">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3314841">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3314847">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3314865">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3314937">0</span><span class="op" id="3314938">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3314943">&#34;\uFFFD&#34;</span><span class="op" id="3314951">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3314954">&#39;&#34;&#39;</span><span class="op" id="3314957">:</span>&nbsp;&nbsp;<span class="string" id="3314960">&#34;&amp;#34;&#34;</span><span class="op" id="3314967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3314970">&#39;&amp;&#39;</span><span class="op" id="3314973">:</span>&nbsp;&nbsp;<span class="string" id="3314976">&#34;&amp;amp;&#34;</span><span class="op" id="3314983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3314986">&#39;\&#39;&#39;</span><span class="op" id="3314990">:</span>&nbsp;<span class="string" id="3314992">&#34;&amp;#39;&#34;</span><span class="op" id="3314999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3315002">&#39;+&#39;</span><span class="op" id="3315005">:</span>&nbsp;&nbsp;<span class="string" id="3315008">&#34;&amp;#43;&#34;</span><span class="op" id="3315015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3315018">&#39;&lt;&#39;</span><span class="op" id="3315021">:</span>&nbsp;&nbsp;<span class="string" id="3315024">&#34;&amp;lt;&#34;</span><span class="op" id="3315030">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3315033">&#39;&gt;&#39;</span><span class="op" id="3315036">:</span>&nbsp;&nbsp;<span class="string" id="3315039">&#34;&amp;gt;&#34;</span><span class="op" id="3315045">,</span><br>
<span class="lineno"></span><span class="op" id="3315047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3315050">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3315126">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="3315168">var</span>&nbsp;<span class="ident" id="3315172">htmlNormReplacementTable</span>&nbsp;<span class="op" id="3315197">=</span>&nbsp;<span class="op" id="3315199">[</span><span class="op" id="3315200">]</span><span class="builtintype" id="3315201">string</span><span class="op" id="3315207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3315210">0</span><span class="op" id="3315211">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3315216">&#34;\uFFFD&#34;</span><span class="op" id="3315224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3315227">&#39;&#34;&#39;</span><span class="op" id="3315230">:</span>&nbsp;&nbsp;<span class="string" id="3315233">&#34;&amp;#34;&#34;</span><span class="op" id="3315240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3315243">&#39;\&#39;&#39;</span><span class="op" id="3315247">:</span>&nbsp;<span class="string" id="3315249">&#34;&amp;#39;&#34;</span><span class="op" id="3315256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3315259">&#39;+&#39;</span><span class="op" id="3315262">:</span>&nbsp;&nbsp;<span class="string" id="3315265">&#34;&amp;#43;&#34;</span><span class="op" id="3315272">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3315275">&#39;&lt;&#39;</span><span class="op" id="3315278">:</span>&nbsp;&nbsp;<span class="string" id="3315281">&#34;&amp;lt;&#34;</span><span class="op" id="3315287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3315290">&#39;&gt;&#39;</span><span class="op" id="3315293">:</span>&nbsp;&nbsp;<span class="string" id="3315296">&#34;&amp;gt;&#34;</span><span class="op" id="3315302">,</span><br>
<span class="lineno"></span><span class="op" id="3315304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3315307">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="3315381">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3315420">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3315486">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="3315543">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3315563">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="3315589">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="3315647">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="3315682">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="3315715">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3315777">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="3315821">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="3315890">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="3315895">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="3315928">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="3315945">var</span>&nbsp;<span class="ident" id="3315949">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="3315977">=</span>&nbsp;<span class="op" id="3315979">[</span><span class="op" id="3315980">]</span><span class="builtintype" id="3315981">string</span><span class="op" id="3315987">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3315990">0</span><span class="op" id="3315991">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3315996">&#34;&amp;#xfffd;&#34;</span><span class="op" id="3316006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316009">&#39;\t&#39;</span><span class="op" id="3316013">:</span>&nbsp;<span class="string" id="3316015">&#34;&amp;#9;&#34;</span><span class="op" id="3316021">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316024">&#39;\n&#39;</span><span class="op" id="3316028">:</span>&nbsp;<span class="string" id="3316030">&#34;&amp;#10;&#34;</span><span class="op" id="3316037">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316040">&#39;\v&#39;</span><span class="op" id="3316044">:</span>&nbsp;<span class="string" id="3316046">&#34;&amp;#11;&#34;</span><span class="op" id="3316053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316056">&#39;\f&#39;</span><span class="op" id="3316060">:</span>&nbsp;<span class="string" id="3316062">&#34;&amp;#12;&#34;</span><span class="op" id="3316069">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316072">&#39;\r&#39;</span><span class="op" id="3316076">:</span>&nbsp;<span class="string" id="3316078">&#34;&amp;#13;&#34;</span><span class="op" id="3316085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316088">&#39;&nbsp;&#39;</span><span class="op" id="3316091">:</span>&nbsp;&nbsp;<span class="string" id="3316094">&#34;&amp;#32;&#34;</span><span class="op" id="3316101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316104">&#39;&#34;&#39;</span><span class="op" id="3316107">:</span>&nbsp;&nbsp;<span class="string" id="3316110">&#34;&amp;#34;&#34;</span><span class="op" id="3316117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316120">&#39;&amp;&#39;</span><span class="op" id="3316123">:</span>&nbsp;&nbsp;<span class="string" id="3316126">&#34;&amp;amp;&#34;</span><span class="op" id="3316133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316136">&#39;\&#39;&#39;</span><span class="op" id="3316140">:</span>&nbsp;<span class="string" id="3316142">&#34;&amp;#39;&#34;</span><span class="op" id="3316149">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316152">&#39;+&#39;</span><span class="op" id="3316155">:</span>&nbsp;&nbsp;<span class="string" id="3316158">&#34;&amp;#43;&#34;</span><span class="op" id="3316165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316168">&#39;&lt;&#39;</span><span class="op" id="3316171">:</span>&nbsp;&nbsp;<span class="string" id="3316174">&#34;&amp;lt;&#34;</span><span class="op" id="3316180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316183">&#39;=&#39;</span><span class="op" id="3316186">:</span>&nbsp;&nbsp;<span class="string" id="3316189">&#34;&amp;#61;&#34;</span><span class="op" id="3316196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316199">&#39;&gt;&#39;</span><span class="op" id="3316202">:</span>&nbsp;&nbsp;<span class="string" id="3316205">&#34;&amp;gt;&#34;</span><span class="op" id="3316211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316214">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316270">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316305">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316347">&#39;`&#39;</span><span class="op" id="3316350">:</span>&nbsp;<span class="string" id="3316352">&#34;&amp;#96;&#34;</span><span class="op" id="3316359">,</span><br>
<span class="lineno"></span><span class="op" id="3316361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="3316364">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="3316439">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="3316496">var</span>&nbsp;<span class="ident" id="3316500">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="3316532">=</span>&nbsp;<span class="op" id="3316534">[</span><span class="op" id="3316535">]</span><span class="builtintype" id="3316536">string</span><span class="op" id="3316542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3316545">0</span><span class="op" id="3316546">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3316551">&#34;&amp;#xfffd;&#34;</span><span class="op" id="3316561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316564">&#39;\t&#39;</span><span class="op" id="3316568">:</span>&nbsp;<span class="string" id="3316570">&#34;&amp;#9;&#34;</span><span class="op" id="3316576">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316579">&#39;\n&#39;</span><span class="op" id="3316583">:</span>&nbsp;<span class="string" id="3316585">&#34;&amp;#10;&#34;</span><span class="op" id="3316592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316595">&#39;\v&#39;</span><span class="op" id="3316599">:</span>&nbsp;<span class="string" id="3316601">&#34;&amp;#11;&#34;</span><span class="op" id="3316608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316611">&#39;\f&#39;</span><span class="op" id="3316615">:</span>&nbsp;<span class="string" id="3316617">&#34;&amp;#12;&#34;</span><span class="op" id="3316624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316627">&#39;\r&#39;</span><span class="op" id="3316631">:</span>&nbsp;<span class="string" id="3316633">&#34;&amp;#13;&#34;</span><span class="op" id="3316640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316643">&#39;&nbsp;&#39;</span><span class="op" id="3316646">:</span>&nbsp;&nbsp;<span class="string" id="3316649">&#34;&amp;#32;&#34;</span><span class="op" id="3316656">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316659">&#39;&#34;&#39;</span><span class="op" id="3316662">:</span>&nbsp;&nbsp;<span class="string" id="3316665">&#34;&amp;#34;&#34;</span><span class="op" id="3316672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316675">&#39;\&#39;&#39;</span><span class="op" id="3316679">:</span>&nbsp;<span class="string" id="3316681">&#34;&amp;#39;&#34;</span><span class="op" id="3316688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316691">&#39;+&#39;</span><span class="op" id="3316694">:</span>&nbsp;&nbsp;<span class="string" id="3316697">&#34;&amp;#43;&#34;</span><span class="op" id="3316704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316707">&#39;&lt;&#39;</span><span class="op" id="3316710">:</span>&nbsp;&nbsp;<span class="string" id="3316713">&#34;&amp;lt;&#34;</span><span class="op" id="3316719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316722">&#39;=&#39;</span><span class="op" id="3316725">:</span>&nbsp;&nbsp;<span class="string" id="3316728">&#34;&amp;#61;&#34;</span><span class="op" id="3316735">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316738">&#39;&gt;&#39;</span><span class="op" id="3316741">:</span>&nbsp;&nbsp;<span class="string" id="3316744">&#34;&amp;gt;&#34;</span><span class="op" id="3316750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316753">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316809">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316844">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3316886">&#39;`&#39;</span><span class="op" id="3316889">:</span>&nbsp;<span class="string" id="3316891">&#34;&amp;#96;&#34;</span><span class="op" id="3316898">,</span><br>
<span class="lineno">135</span><span class="op" id="3316900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3316903">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="3316979">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3317058">func</span>&nbsp;<span class="ident" id="3317063">htmlReplacer</span><span class="op" id="3317075">(</span><span class="ident" id="3317076">s</span>&nbsp;<span class="builtintype" id="3317078">string</span><span class="op" id="3317084">,</span>&nbsp;<span class="ident" id="3317086">replacementTable</span>&nbsp;<span class="op" id="3317103">[</span><span class="op" id="3317104">]</span><span class="builtintype" id="3317105">string</span><span class="op" id="3317111">,</span>&nbsp;<span class="ident" id="3317113">badRunes</span>&nbsp;<span class="builtintype" id="3317122">bool</span><span class="op" id="3317126">)</span>&nbsp;<span class="builtintype" id="3317128">string</span>&nbsp;<span class="op" id="3317135">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317138">written</span><span class="op" id="3317145">,</span>&nbsp;<span class="ident" id="3317147">b</span>&nbsp;<span class="op" id="3317149">:=</span>&nbsp;<span class="num" id="3317152">0</span><span class="op" id="3317153">,</span>&nbsp;<span class="builtinfunc" id="3317155">new</span><span class="op" id="3317158">(</span><span class="ident" id="3317159"><a href="/html/template/html.go.html#3313321">bytes</a></span><span class="op" id="3317164">.</span><span class="ident" id="3317165">Buffer</span><span class="op" id="3317171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317174">for</span>&nbsp;<span class="ident" id="3317178">i</span><span class="op" id="3317179">,</span>&nbsp;<span class="ident" id="3317181">r</span>&nbsp;<span class="op" id="3317183">:=</span>&nbsp;<span class="keyword" id="3317186">range</span>&nbsp;<span class="ident" id="3317192"><a href="/html/template/html.go.html#3317076">s</a></span>&nbsp;<span class="op" id="3317194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317198">if</span>&nbsp;<span class="builtintype" id="3317201">int</span><span class="op" id="3317204">(</span><span class="ident" id="3317205"><a href="/html/template/html.go.html#3317181">r</a></span><span class="op" id="3317206">)</span>&nbsp;<span class="op" id="3317208">&lt;</span>&nbsp;<span class="builtinfunc" id="3317210">len</span><span class="op" id="3317213">(</span><span class="ident" id="3317214"><a href="/html/template/html.go.html#3317086">replacementTable</a></span><span class="op" id="3317230">)</span>&nbsp;<span class="op" id="3317232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317237">if</span>&nbsp;<span class="ident" id="3317240">repl</span>&nbsp;<span class="op" id="3317245">:=</span>&nbsp;<span class="ident" id="3317248"><a href="/html/template/html.go.html#3317086">replacementTable</a></span><span class="op" id="3317264">[</span><span class="ident" id="3317265"><a href="/html/template/html.go.html#3317181">r</a></span><span class="op" id="3317266">]</span><span class="op" id="3317267">;</span>&nbsp;<span class="builtinfunc" id="3317269">len</span><span class="op" id="3317272">(</span><span class="ident" id="3317273"><a href="/html/template/html.go.html#3317240">repl</a></span><span class="op" id="3317277">)</span>&nbsp;<span class="op" id="3317279">!=</span>&nbsp;<span class="num" id="3317282">0</span>&nbsp;<span class="op" id="3317284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317290"><a href="/html/template/html.go.html#3317147">b</a></span><span class="op" id="3317291">.</span><span class="ident" id="3317292">WriteString</span><span class="op" id="3317303">(</span><span class="ident" id="3317304"><a href="/html/template/html.go.html#3317076">s</a></span><span class="op" id="3317305">[</span><span class="ident" id="3317306"><a href="/html/template/html.go.html#3317138">written</a></span><span class="op" id="3317313">:</span><span class="ident" id="3317314"><a href="/html/template/html.go.html#3317178">i</a></span><span class="op" id="3317315">]</span><span class="op" id="3317316">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317322"><a href="/html/template/html.go.html#3317147">b</a></span><span class="op" id="3317323">.</span><span class="ident" id="3317324">WriteString</span><span class="op" id="3317335">(</span><span class="ident" id="3317336"><a href="/html/template/html.go.html#3317240">repl</a></span><span class="op" id="3317340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317346">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317395">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317431"><a href="/html/template/html.go.html#3317138">written</a></span>&nbsp;<span class="op" id="3317439">=</span>&nbsp;<span class="ident" id="3317441"><a href="/html/template/html.go.html#3317178">i</a></span>&nbsp;<span class="op" id="3317443">+</span>&nbsp;<span class="ident" id="3317445"><a href="/html/template/html.go.html#3313348">utf8</a></span><span class="op" id="3317449">.</span><span class="ident" id="3317450">RuneLen</span><span class="op" id="3317457">(</span><span class="ident" id="3317458"><a href="/html/template/html.go.html#3317181">r</a></span><span class="op" id="3317459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317464">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317468">}</span>&nbsp;<span class="keyword" id="3317470">else</span>&nbsp;<span class="keyword" id="3317475">if</span>&nbsp;<span class="ident" id="3317478"><a href="/html/template/html.go.html#3317113">badRunes</a></span>&nbsp;<span class="op" id="3317487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317492">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317505">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317560">}</span>&nbsp;<span class="keyword" id="3317562">else</span>&nbsp;<span class="keyword" id="3317567">if</span>&nbsp;<span class="num" id="3317570">0xfdd0</span>&nbsp;<span class="op" id="3317577">&lt;=</span>&nbsp;<span class="ident" id="3317580"><a href="/html/template/html.go.html#3317181">r</a></span>&nbsp;<span class="op" id="3317582">&amp;&amp;</span>&nbsp;<span class="ident" id="3317585"><a href="/html/template/html.go.html#3317181">r</a></span>&nbsp;<span class="op" id="3317587">&lt;=</span>&nbsp;<span class="num" id="3317590">0xfdef</span>&nbsp;<span class="op" id="3317597">||</span>&nbsp;<span class="num" id="3317600">0xfff0</span>&nbsp;<span class="op" id="3317607">&lt;=</span>&nbsp;<span class="ident" id="3317610"><a href="/html/template/html.go.html#3317181">r</a></span>&nbsp;<span class="op" id="3317612">&amp;&amp;</span>&nbsp;<span class="ident" id="3317615"><a href="/html/template/html.go.html#3317181">r</a></span>&nbsp;<span class="op" id="3317617">&lt;=</span>&nbsp;<span class="num" id="3317620">0xffff</span>&nbsp;<span class="op" id="3317627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317632"><a href="/html/template/html.go.html#3313330">fmt</a></span><span class="op" id="3317635">.</span><span class="ident" id="3317636">Fprintf</span><span class="op" id="3317643">(</span><span class="ident" id="3317644"><a href="/html/template/html.go.html#3317147">b</a></span><span class="op" id="3317645">,</span>&nbsp;<span class="string" id="3317647">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="3317657">,</span>&nbsp;<span class="ident" id="3317659"><a href="/html/template/html.go.html#3317076">s</a></span><span class="op" id="3317660">[</span><span class="ident" id="3317661"><a href="/html/template/html.go.html#3317138">written</a></span><span class="op" id="3317668">:</span><span class="ident" id="3317669"><a href="/html/template/html.go.html#3317178">i</a></span><span class="op" id="3317670">]</span><span class="op" id="3317671">,</span>&nbsp;<span class="ident" id="3317673"><a href="/html/template/html.go.html#3317181">r</a></span><span class="op" id="3317674">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317679"><a href="/html/template/html.go.html#3317138">written</a></span>&nbsp;<span class="op" id="3317687">=</span>&nbsp;<span class="ident" id="3317689"><a href="/html/template/html.go.html#3317178">i</a></span>&nbsp;<span class="op" id="3317691">+</span>&nbsp;<span class="ident" id="3317693"><a href="/html/template/html.go.html#3313348">utf8</a></span><span class="op" id="3317697">.</span><span class="ident" id="3317698">RuneLen</span><span class="op" id="3317705">(</span><span class="ident" id="3317706"><a href="/html/template/html.go.html#3317181">r</a></span><span class="op" id="3317707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317717">if</span>&nbsp;<span class="ident" id="3317720"><a href="/html/template/html.go.html#3317138">written</a></span>&nbsp;<span class="op" id="3317728">==</span>&nbsp;<span class="num" id="3317731">0</span>&nbsp;<span class="op" id="3317733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317737">return</span>&nbsp;<span class="ident" id="3317744"><a href="/html/template/html.go.html#3317076">s</a></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317750"><a href="/html/template/html.go.html#3317147">b</a></span><span class="op" id="3317751">.</span><span class="ident" id="3317752">WriteString</span><span class="op" id="3317763">(</span><span class="ident" id="3317764"><a href="/html/template/html.go.html#3317076">s</a></span><span class="op" id="3317765">[</span><span class="ident" id="3317766"><a href="/html/template/html.go.html#3317138">written</a></span><span class="op" id="3317773">:</span><span class="op" id="3317774">]</span><span class="op" id="3317775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317778">return</span>&nbsp;<span class="ident" id="3317785"><a href="/html/template/html.go.html#3317147">b</a></span><span class="op" id="3317786">.</span><span class="ident" id="3317787">String</span><span class="op" id="3317793">(</span><span class="op" id="3317794">)</span><br>
<span class="lineno"></span><span class="op" id="3317796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3317799">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="3317871">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="3317946">func</span>&nbsp;<span class="ident" id="3317951">stripTags</span><span class="op" id="3317960">(</span><span class="ident" id="3317961">html</span>&nbsp;<span class="builtintype" id="3317966">string</span><span class="op" id="3317972">)</span>&nbsp;<span class="builtintype" id="3317974">string</span>&nbsp;<span class="op" id="3317981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317984">var</span>&nbsp;<span class="ident" id="3317988">b</span>&nbsp;<span class="ident" id="3317990"><a href="/html/template/html.go.html#3313321">bytes</a></span><span class="op" id="3317995">.</span><span class="ident" id="3317996">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318004">s</span><span class="op" id="3318005">,</span>&nbsp;<span class="ident" id="3318007">c</span><span class="op" id="3318008">,</span>&nbsp;<span class="ident" id="3318010">i</span><span class="op" id="3318011">,</span>&nbsp;<span class="ident" id="3318013">allText</span>&nbsp;<span class="op" id="3318021">:=</span>&nbsp;<span class="op" id="3318024">[</span><span class="op" id="3318025">]</span><span class="builtintype" id="3318026">byte</span><span class="op" id="3318030">(</span><span class="ident" id="3318031"><a href="/html/template/html.go.html#3317961">html</a></span><span class="op" id="3318035">)</span><span class="op" id="3318036">,</span>&nbsp;<span class="ident" id="3318038"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3318045">{</span><span class="op" id="3318046">}</span><span class="op" id="3318047">,</span>&nbsp;<span class="num" id="3318049">0</span><span class="op" id="3318050">,</span>&nbsp;<span class="ident" id="3318052">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3318058">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3318113">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318156">for</span>&nbsp;<span class="ident" id="3318160"><a href="/html/template/html.go.html#3318010">i</a></span>&nbsp;<span class="op" id="3318162">!=</span>&nbsp;<span class="builtinfunc" id="3318165">len</span><span class="op" id="3318168">(</span><span class="ident" id="3318169"><a href="/html/template/html.go.html#3318004">s</a></span><span class="op" id="3318170">)</span>&nbsp;<span class="op" id="3318172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318176">if</span>&nbsp;<span class="ident" id="3318179"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3318180">.</span><span class="ident" id="3318181">delim</span>&nbsp;<span class="op" id="3318187">==</span>&nbsp;<span class="ident" id="3318190"><a href="/html/template/context.go.html#3262948">delimNone</a></span>&nbsp;<span class="op" id="3318200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318205">st</span>&nbsp;<span class="op" id="3318208">:=</span>&nbsp;<span class="ident" id="3318211"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3318212">.</span><span class="ident" id="3318213">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3318222">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318281">if</span>&nbsp;<span class="ident" id="3318284"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3318285">.</span><span class="ident" id="3318286">element</span>&nbsp;<span class="op" id="3318294">!=</span>&nbsp;<span class="ident" id="3318297"><a href="/html/template/context.go.html#3265642">elementNone</a></span>&nbsp;<span class="op" id="3318309">&amp;&amp;</span>&nbsp;<span class="op" id="3318312">!</span><span class="ident" id="3318313"><a href="/html/template/context.go.html#3262663">isInTag</a></span><span class="op" id="3318320">(</span><span class="ident" id="3318321"><a href="/html/template/html.go.html#3318205">st</a></span><span class="op" id="3318323">)</span>&nbsp;<span class="op" id="3318325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318331"><a href="/html/template/html.go.html#3318205">st</a></span>&nbsp;<span class="op" id="3318334">=</span>&nbsp;<span class="ident" id="3318336"><a href="/html/template/context.go.html#3259936">stateRCDATA</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318356">d</span><span class="op" id="3318357">,</span>&nbsp;<span class="ident" id="3318359">nread</span>&nbsp;<span class="op" id="3318365">:=</span>&nbsp;<span class="ident" id="3318368"><a href="/html/template/transition.go.html#3343607">transitionFunc</a></span><span class="op" id="3318382">[</span><span class="ident" id="3318383"><a href="/html/template/html.go.html#3318205">st</a></span><span class="op" id="3318385">]</span><span class="op" id="3318386">(</span><span class="ident" id="3318387"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3318388">,</span>&nbsp;<span class="ident" id="3318390"><a href="/html/template/html.go.html#3318004">s</a></span><span class="op" id="3318391">[</span><span class="ident" id="3318392"><a href="/html/template/html.go.html#3318010">i</a></span><span class="op" id="3318393">:</span><span class="op" id="3318394">]</span><span class="op" id="3318395">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318400">i1</span>&nbsp;<span class="op" id="3318403">:=</span>&nbsp;<span class="ident" id="3318406"><a href="/html/template/html.go.html#3318010">i</a></span>&nbsp;<span class="op" id="3318408">+</span>&nbsp;<span class="ident" id="3318410"><a href="/html/template/html.go.html#3318359">nread</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318419">if</span>&nbsp;<span class="ident" id="3318422"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3318423">.</span><span class="ident" id="3318424">state</span>&nbsp;<span class="op" id="3318430">==</span>&nbsp;<span class="ident" id="3318433"><a href="/html/template/context.go.html#3259212">stateText</a></span>&nbsp;<span class="op" id="3318443">||</span>&nbsp;<span class="ident" id="3318446"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3318447">.</span><span class="ident" id="3318448">state</span>&nbsp;<span class="op" id="3318454">==</span>&nbsp;<span class="ident" id="3318457"><a href="/html/template/context.go.html#3259936">stateRCDATA</a></span>&nbsp;<span class="op" id="3318469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3318475">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318531">j</span>&nbsp;<span class="op" id="3318533">:=</span>&nbsp;<span class="ident" id="3318536"><a href="/html/template/html.go.html#3318400">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318543">if</span>&nbsp;<span class="ident" id="3318546"><a href="/html/template/html.go.html#3318356">d</a></span><span class="op" id="3318547">.</span><span class="ident" id="3318548">state</span>&nbsp;<span class="op" id="3318554">!=</span>&nbsp;<span class="ident" id="3318557"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3318558">.</span><span class="ident" id="3318559">state</span>&nbsp;<span class="op" id="3318565">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318572">for</span>&nbsp;<span class="ident" id="3318576">j1</span>&nbsp;<span class="op" id="3318579">:=</span>&nbsp;<span class="ident" id="3318582"><a href="/html/template/html.go.html#3318531">j</a></span>&nbsp;<span class="op" id="3318584">-</span>&nbsp;<span class="num" id="3318586">1</span><span class="op" id="3318587">;</span>&nbsp;<span class="ident" id="3318589"><a href="/html/template/html.go.html#3318576">j1</a></span>&nbsp;<span class="op" id="3318592">&gt;=</span>&nbsp;<span class="ident" id="3318595"><a href="/html/template/html.go.html#3318010">i</a></span><span class="op" id="3318596">;</span>&nbsp;<span class="ident" id="3318598"><a href="/html/template/html.go.html#3318576">j1</a></span><span class="op" id="3318600">--</span>&nbsp;<span class="op" id="3318603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318611">if</span>&nbsp;<span class="ident" id="3318614"><a href="/html/template/html.go.html#3318004">s</a></span><span class="op" id="3318615">[</span><span class="ident" id="3318616"><a href="/html/template/html.go.html#3318576">j1</a></span><span class="op" id="3318618">]</span>&nbsp;<span class="op" id="3318620">==</span>&nbsp;<span class="string" id="3318623">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="3318627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318636"><a href="/html/template/html.go.html#3318531">j</a></span>&nbsp;<span class="op" id="3318638">=</span>&nbsp;<span class="ident" id="3318640"><a href="/html/template/html.go.html#3318576">j1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318650">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318662">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318681"><a href="/html/template/html.go.html#3317988">b</a></span><span class="op" id="3318682">.</span><span class="ident" id="3318683">Write</span><span class="op" id="3318688">(</span><span class="ident" id="3318689"><a href="/html/template/html.go.html#3318004">s</a></span><span class="op" id="3318690">[</span><span class="ident" id="3318691"><a href="/html/template/html.go.html#3318010">i</a></span><span class="op" id="3318692">:</span><span class="ident" id="3318693"><a href="/html/template/html.go.html#3318531">j</a></span><span class="op" id="3318694">]</span><span class="op" id="3318695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318700">}</span>&nbsp;<span class="keyword" id="3318702">else</span>&nbsp;<span class="op" id="3318707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318713"><a href="/html/template/html.go.html#3318013">allText</a></span>&nbsp;<span class="op" id="3318721">=</span>&nbsp;<span class="ident" id="3318723">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318737"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3318738">,</span>&nbsp;<span class="ident" id="3318740"><a href="/html/template/html.go.html#3318010">i</a></span>&nbsp;<span class="op" id="3318742">=</span>&nbsp;<span class="ident" id="3318744"><a href="/html/template/html.go.html#3318356">d</a></span><span class="op" id="3318745">,</span>&nbsp;<span class="ident" id="3318747"><a href="/html/template/html.go.html#3318400">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318753">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318768">i1</span>&nbsp;<span class="op" id="3318771">:=</span>&nbsp;<span class="ident" id="3318774"><a href="/html/template/html.go.html#3318010">i</a></span>&nbsp;<span class="op" id="3318776">+</span>&nbsp;<span class="ident" id="3318778"><a href="/html/template/html.go.html#3313321">bytes</a></span><span class="op" id="3318783">.</span><span class="ident" id="3318784">IndexAny</span><span class="op" id="3318792">(</span><span class="ident" id="3318793"><a href="/html/template/html.go.html#3318004">s</a></span><span class="op" id="3318794">[</span><span class="ident" id="3318795"><a href="/html/template/html.go.html#3318010">i</a></span><span class="op" id="3318796">:</span><span class="op" id="3318797">]</span><span class="op" id="3318798">,</span>&nbsp;<span class="ident" id="3318800"><a href="/html/template/escape.go.html#3305929">delimEnds</a></span><span class="op" id="3318809">[</span><span class="ident" id="3318810"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3318811">.</span><span class="ident" id="3318812">delim</span><span class="op" id="3318817">]</span><span class="op" id="3318818">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318822">if</span>&nbsp;<span class="ident" id="3318825"><a href="/html/template/html.go.html#3318768">i1</a></span>&nbsp;<span class="op" id="3318828">&lt;</span>&nbsp;<span class="ident" id="3318830"><a href="/html/template/html.go.html#3318010">i</a></span>&nbsp;<span class="op" id="3318832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318837">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318849">if</span>&nbsp;<span class="ident" id="3318852"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3318853">.</span><span class="ident" id="3318854">delim</span>&nbsp;<span class="op" id="3318860">!=</span>&nbsp;<span class="ident" id="3318863"><a href="/html/template/context.go.html#3263252">delimSpaceOrTagEnd</a></span>&nbsp;<span class="op" id="3318882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3318887">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318912"><a href="/html/template/html.go.html#3318768">i1</a></span><span class="op" id="3318914">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318923"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3318924">,</span>&nbsp;<span class="ident" id="3318926"><a href="/html/template/html.go.html#3318010">i</a></span>&nbsp;<span class="op" id="3318928">=</span>&nbsp;<span class="ident" id="3318930"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3318937">{</span><span class="ident" id="3318938">state</span><span class="op" id="3318943">:</span>&nbsp;<span class="ident" id="3318945"><a href="/html/template/context.go.html#3259302">stateTag</a></span><span class="op" id="3318953">,</span>&nbsp;<span class="ident" id="3318955">element</span><span class="op" id="3318962">:</span>&nbsp;<span class="ident" id="3318964"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3318965">.</span><span class="ident" id="3318966">element</span><span class="op" id="3318973">}</span><span class="op" id="3318974">,</span>&nbsp;<span class="ident" id="3318976"><a href="/html/template/html.go.html#3318768">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318983">if</span>&nbsp;<span class="ident" id="3318986"><a href="/html/template/html.go.html#3318013">allText</a></span>&nbsp;<span class="op" id="3318994">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318998">return</span>&nbsp;<span class="ident" id="3319005"><a href="/html/template/html.go.html#3317961">html</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319011">}</span>&nbsp;<span class="keyword" id="3319013">else</span>&nbsp;<span class="keyword" id="3319018">if</span>&nbsp;<span class="ident" id="3319021"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3319022">.</span><span class="ident" id="3319023">state</span>&nbsp;<span class="op" id="3319029">==</span>&nbsp;<span class="ident" id="3319032"><a href="/html/template/context.go.html#3259212">stateText</a></span>&nbsp;<span class="op" id="3319042">||</span>&nbsp;<span class="ident" id="3319045"><a href="/html/template/html.go.html#3318007">c</a></span><span class="op" id="3319046">.</span><span class="ident" id="3319047">state</span>&nbsp;<span class="op" id="3319053">==</span>&nbsp;<span class="ident" id="3319056"><a href="/html/template/context.go.html#3259936">stateRCDATA</a></span>&nbsp;<span class="op" id="3319068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319072"><a href="/html/template/html.go.html#3317988">b</a></span><span class="op" id="3319073">.</span><span class="ident" id="3319074">Write</span><span class="op" id="3319079">(</span><span class="ident" id="3319080"><a href="/html/template/html.go.html#3318004">s</a></span><span class="op" id="3319081">[</span><span class="ident" id="3319082"><a href="/html/template/html.go.html#3318010">i</a></span><span class="op" id="3319083">:</span><span class="op" id="3319084">]</span><span class="op" id="3319085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319091">return</span>&nbsp;<span class="ident" id="3319098"><a href="/html/template/html.go.html#3317988">b</a></span><span class="op" id="3319099">.</span><span class="ident" id="3319100">String</span><span class="op" id="3319106">(</span><span class="op" id="3319107">)</span><br>
<span class="lineno">215</span><span class="op" id="3319109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3319112">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3319186">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="3319218">func</span>&nbsp;<span class="ident" id="3319223">htmlNameFilter</span><span class="op" id="3319237">(</span><span class="ident" id="3319238">args</span>&nbsp;<span class="op" id="3319243">...</span><span class="keyword" id="3319246">interface</span><span class="op" id="3319255">{</span><span class="op" id="3319256">}</span><span class="op" id="3319257">)</span>&nbsp;<span class="builtintype" id="3319259">string</span>&nbsp;<span class="op" id="3319266">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319269">s</span><span class="op" id="3319270">,</span>&nbsp;<span class="ident" id="3319272">t</span>&nbsp;<span class="op" id="3319274">:=</span>&nbsp;<span class="ident" id="3319277"><a href="/html/template/content.go.html#3256165">stringify</a></span><span class="op" id="3319286">(</span><span class="ident" id="3319287"><a href="/html/template/html.go.html#3319238">args</a></span><span class="op" id="3319291">...</span><span class="op" id="3319294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319297">if</span>&nbsp;<span class="ident" id="3319300"><a href="/html/template/html.go.html#3319272">t</a></span>&nbsp;<span class="op" id="3319302">==</span>&nbsp;<span class="ident" id="3319305"><a href="/html/template/content.go.html#3254714">contentTypeHTMLAttr</a></span>&nbsp;<span class="op" id="3319325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319329">return</span>&nbsp;<span class="ident" id="3319336"><a href="/html/template/html.go.html#3319269">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319342">if</span>&nbsp;<span class="builtinfunc" id="3319345">len</span><span class="op" id="3319348">(</span><span class="ident" id="3319349"><a href="/html/template/html.go.html#3319269">s</a></span><span class="op" id="3319350">)</span>&nbsp;<span class="op" id="3319352">==</span>&nbsp;<span class="num" id="3319355">0</span>&nbsp;<span class="op" id="3319357">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319361">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319409">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319445">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319503">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319564">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319579">return</span>&nbsp;<span class="ident" id="3319586"><a href="/html/template/escape.go.html#3291940">filterFailsafe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319605"><a href="/html/template/html.go.html#3319269">s</a></span>&nbsp;<span class="op" id="3319607">=</span>&nbsp;<span class="ident" id="3319609"><a href="/html/template/html.go.html#3313337">strings</a></span><span class="op" id="3319616">.</span><span class="ident" id="3319617">ToLower</span><span class="op" id="3319624">(</span><span class="ident" id="3319625"><a href="/html/template/html.go.html#3319269">s</a></span><span class="op" id="3319626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319629">if</span>&nbsp;<span class="ident" id="3319632">t</span>&nbsp;<span class="op" id="3319634">:=</span>&nbsp;<span class="ident" id="3319637"><a href="/html/template/attr.go.html#3251028">attrType</a></span><span class="op" id="3319645">(</span><span class="ident" id="3319646"><a href="/html/template/html.go.html#3319269">s</a></span><span class="op" id="3319647">)</span><span class="op" id="3319648">;</span>&nbsp;<span class="ident" id="3319650"><a href="/html/template/html.go.html#3319632">t</a></span>&nbsp;<span class="op" id="3319652">!=</span>&nbsp;<span class="ident" id="3319655"><a href="/html/template/content.go.html#3254644">contentTypePlain</a></span>&nbsp;<span class="op" id="3319672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319676">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319748">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319765">return</span>&nbsp;<span class="ident" id="3319772"><a href="/html/template/escape.go.html#3291940">filterFailsafe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319791">for</span>&nbsp;<span class="ident" id="3319795">_</span><span class="op" id="3319796">,</span>&nbsp;<span class="ident" id="3319798">r</span>&nbsp;<span class="op" id="3319800">:=</span>&nbsp;<span class="keyword" id="3319803">range</span>&nbsp;<span class="ident" id="3319809"><a href="/html/template/html.go.html#3319269">s</a></span>&nbsp;<span class="op" id="3319811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319815">switch</span>&nbsp;<span class="op" id="3319822">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319826">case</span>&nbsp;<span class="string" id="3319831">&#39;0&#39;</span>&nbsp;<span class="op" id="3319835">&lt;=</span>&nbsp;<span class="ident" id="3319838"><a href="/html/template/html.go.html#3319798">r</a></span>&nbsp;<span class="op" id="3319840">&amp;&amp;</span>&nbsp;<span class="ident" id="3319843"><a href="/html/template/html.go.html#3319798">r</a></span>&nbsp;<span class="op" id="3319845">&lt;=</span>&nbsp;<span class="string" id="3319848">&#39;9&#39;</span><span class="op" id="3319851">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319855">case</span>&nbsp;<span class="string" id="3319860">&#39;a&#39;</span>&nbsp;<span class="op" id="3319864">&lt;=</span>&nbsp;<span class="ident" id="3319867"><a href="/html/template/html.go.html#3319798">r</a></span>&nbsp;<span class="op" id="3319869">&amp;&amp;</span>&nbsp;<span class="ident" id="3319872"><a href="/html/template/html.go.html#3319798">r</a></span>&nbsp;<span class="op" id="3319874">&lt;=</span>&nbsp;<span class="string" id="3319877">&#39;z&#39;</span><span class="op" id="3319880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319884">default</span><span class="op" id="3319891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319896">return</span>&nbsp;<span class="ident" id="3319903"><a href="/html/template/escape.go.html#3291940">filterFailsafe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319920">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319926">return</span>&nbsp;<span class="ident" id="3319933"><a href="/html/template/html.go.html#3319269">s</a></span><br>
<span class="lineno"></span><span class="op" id="3319935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3319938">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="3320002">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3320068">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="3320145">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="3320184">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3320259">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="3320289">func</span>&nbsp;<span class="ident" id="3320294">commentEscaper</span><span class="op" id="3320308">(</span><span class="ident" id="3320309">args</span>&nbsp;<span class="op" id="3320314">...</span><span class="keyword" id="3320317">interface</span><span class="op" id="3320326">{</span><span class="op" id="3320327">}</span><span class="op" id="3320328">)</span>&nbsp;<span class="builtintype" id="3320330">string</span>&nbsp;<span class="op" id="3320337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320340">return</span>&nbsp;<span class="string" id="3320347">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3320350">}</span>
</div>
</body>
</html>
