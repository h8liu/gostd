<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2518887">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2518943">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2518997">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2519048">//&nbsp;Linux&nbsp;socket&nbsp;filter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2519072">package</span>&nbsp;<span class="ident" id="2519080">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2519089">import</span>&nbsp;<span class="op" id="2519096">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2519099">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2519108">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2519111">func</span>&nbsp;<span class="ident" id="2519116">LsfStmt</span><span class="op" id="2519123">(</span><span class="ident" id="2519124">code</span><span class="op" id="2519128">,</span>&nbsp;<span class="ident" id="2519130">k</span>&nbsp;<span class="builtintype" id="2519132">int</span><span class="op" id="2519135">)</span>&nbsp;<span class="op" id="2519137">*</span><span class="ident" id="2519138">SockFilter</span>&nbsp;<span class="op" id="2519149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519152">return</span>&nbsp;<span class="op" id="2519159">&amp;</span><span class="ident" id="2519160">SockFilter</span><span class="op" id="2519170">{</span><span class="ident" id="2519171">Code</span><span class="op" id="2519175">:</span>&nbsp;<span class="builtintype" id="2519177">uint16</span><span class="op" id="2519183">(</span><span class="ident" id="2519184">code</span><span class="op" id="2519188">)</span><span class="op" id="2519189">,</span>&nbsp;<span class="ident" id="2519191">K</span><span class="op" id="2519192">:</span>&nbsp;<span class="builtintype" id="2519194">uint32</span><span class="op" id="2519200">(</span><span class="ident" id="2519201">k</span><span class="op" id="2519202">)</span><span class="op" id="2519203">}</span><br>
<span class="lineno">15</span><span class="op" id="2519205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2519208">func</span>&nbsp;<span class="ident" id="2519213">LsfJump</span><span class="op" id="2519220">(</span><span class="ident" id="2519221">code</span><span class="op" id="2519225">,</span>&nbsp;<span class="ident" id="2519227">k</span><span class="op" id="2519228">,</span>&nbsp;<span class="ident" id="2519230">jt</span><span class="op" id="2519232">,</span>&nbsp;<span class="ident" id="2519234">jf</span>&nbsp;<span class="builtintype" id="2519237">int</span><span class="op" id="2519240">)</span>&nbsp;<span class="op" id="2519242">*</span><span class="ident" id="2519243">SockFilter</span>&nbsp;<span class="op" id="2519254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519257">return</span>&nbsp;<span class="op" id="2519264">&amp;</span><span class="ident" id="2519265">SockFilter</span><span class="op" id="2519275">{</span><span class="ident" id="2519276">Code</span><span class="op" id="2519280">:</span>&nbsp;<span class="builtintype" id="2519282">uint16</span><span class="op" id="2519288">(</span><span class="ident" id="2519289">code</span><span class="op" id="2519293">)</span><span class="op" id="2519294">,</span>&nbsp;<span class="ident" id="2519296">Jt</span><span class="op" id="2519298">:</span>&nbsp;<span class="builtintype" id="2519300">uint8</span><span class="op" id="2519305">(</span><span class="ident" id="2519306">jt</span><span class="op" id="2519308">)</span><span class="op" id="2519309">,</span>&nbsp;<span class="ident" id="2519311">Jf</span><span class="op" id="2519313">:</span>&nbsp;<span class="builtintype" id="2519315">uint8</span><span class="op" id="2519320">(</span><span class="ident" id="2519321">jf</span><span class="op" id="2519323">)</span><span class="op" id="2519324">,</span>&nbsp;<span class="ident" id="2519326">K</span><span class="op" id="2519327">:</span>&nbsp;<span class="builtintype" id="2519329">uint32</span><span class="op" id="2519335">(</span><span class="ident" id="2519336">k</span><span class="op" id="2519337">)</span><span class="op" id="2519338">}</span><br>
<span class="lineno"></span><span class="op" id="2519340">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2519343">func</span>&nbsp;<span class="ident" id="2519348">LsfSocket</span><span class="op" id="2519357">(</span><span class="ident" id="2519358">ifindex</span><span class="op" id="2519365">,</span>&nbsp;<span class="ident" id="2519367">proto</span>&nbsp;<span class="builtintype" id="2519373">int</span><span class="op" id="2519376">)</span>&nbsp;<span class="op" id="2519378">(</span><span class="builtintype" id="2519379">int</span><span class="op" id="2519382">,</span>&nbsp;<span class="builtintype" id="2519384">error</span><span class="op" id="2519389">)</span>&nbsp;<span class="op" id="2519391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519394">var</span>&nbsp;<span class="ident" id="2519398">lsall</span>&nbsp;<span class="ident" id="2519404">SockaddrLinklayer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519423">s</span><span class="op" id="2519424">,</span>&nbsp;<span class="ident" id="2519426">e</span>&nbsp;<span class="op" id="2519428">:=</span>&nbsp;<span class="ident" id="2519431">Socket</span><span class="op" id="2519437">(</span><span class="ident" id="2519438">AF_PACKET</span><span class="op" id="2519447">,</span>&nbsp;<span class="ident" id="2519449">SOCK_RAW</span><span class="op" id="2519457">,</span>&nbsp;<span class="ident" id="2519459">proto</span><span class="op" id="2519464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519467">if</span>&nbsp;<span class="ident" id="2519470">e</span>&nbsp;<span class="op" id="2519472">!=</span>&nbsp;<span class="ident" id="2519475">nil</span>&nbsp;<span class="op" id="2519479">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519483">return</span>&nbsp;<span class="num" id="2519490">0</span><span class="op" id="2519491">,</span>&nbsp;<span class="ident" id="2519493">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2519496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519499">p</span>&nbsp;<span class="op" id="2519501">:=</span>&nbsp;<span class="op" id="2519504">(</span><span class="op" id="2519505">*</span><span class="op" id="2519506">[</span><span class="num" id="2519507">2</span><span class="op" id="2519508">]</span><span class="builtintype" id="2519509">byte</span><span class="op" id="2519513">)</span><span class="op" id="2519514">(</span><span class="ident" id="2519515">unsafe</span><span class="op" id="2519521">.</span><span class="ident" id="2519522">Pointer</span><span class="op" id="2519529">(</span><span class="op" id="2519530">&amp;</span><span class="ident" id="2519531">lsall</span><span class="op" id="2519536">.</span><span class="ident" id="2519537">Protocol</span><span class="op" id="2519545">)</span><span class="op" id="2519546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519549">p</span><span class="op" id="2519550">[</span><span class="num" id="2519551">0</span><span class="op" id="2519552">]</span>&nbsp;<span class="op" id="2519554">=</span>&nbsp;<span class="builtintype" id="2519556">byte</span><span class="op" id="2519560">(</span><span class="ident" id="2519561">proto</span>&nbsp;<span class="op" id="2519567">&gt;&gt;</span>&nbsp;<span class="num" id="2519570">8</span><span class="op" id="2519571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519574">p</span><span class="op" id="2519575">[</span><span class="num" id="2519576">1</span><span class="op" id="2519577">]</span>&nbsp;<span class="op" id="2519579">=</span>&nbsp;<span class="builtintype" id="2519581">byte</span><span class="op" id="2519585">(</span><span class="ident" id="2519586">proto</span><span class="op" id="2519591">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519594">lsall</span><span class="op" id="2519599">.</span><span class="ident" id="2519600">Ifindex</span>&nbsp;<span class="op" id="2519608">=</span>&nbsp;<span class="ident" id="2519610">ifindex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519619">e</span>&nbsp;<span class="op" id="2519621">=</span>&nbsp;<span class="ident" id="2519623">Bind</span><span class="op" id="2519627">(</span><span class="ident" id="2519628">s</span><span class="op" id="2519629">,</span>&nbsp;<span class="op" id="2519631">&amp;</span><span class="ident" id="2519632">lsall</span><span class="op" id="2519637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519640">if</span>&nbsp;<span class="ident" id="2519643">e</span>&nbsp;<span class="op" id="2519645">!=</span>&nbsp;<span class="ident" id="2519648">nil</span>&nbsp;<span class="op" id="2519652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519656">Close</span><span class="op" id="2519661">(</span><span class="ident" id="2519662">s</span><span class="op" id="2519663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519667">return</span>&nbsp;<span class="num" id="2519674">0</span><span class="op" id="2519675">,</span>&nbsp;<span class="ident" id="2519677">e</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2519680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519683">return</span>&nbsp;<span class="ident" id="2519690">s</span><span class="op" id="2519691">,</span>&nbsp;<span class="ident" id="2519693">nil</span><br>
<span class="lineno"></span><span class="op" id="2519697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2519700">type</span>&nbsp;<span class="ident" id="2519705">iflags</span>&nbsp;<span class="keyword" id="2519712">struct</span>&nbsp;<span class="op" id="2519719">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519722">name</span>&nbsp;&nbsp;<span class="op" id="2519728">[</span><span class="ident" id="2519729">IFNAMSIZ</span><span class="op" id="2519737">]</span><span class="builtintype" id="2519738">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519744">flags</span>&nbsp;<span class="builtintype" id="2519750">uint16</span><br>
<span class="lineno"></span><span class="op" id="2519757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2519760">func</span>&nbsp;<span class="ident" id="2519765">SetLsfPromisc</span><span class="op" id="2519778">(</span><span class="ident" id="2519779">name</span>&nbsp;<span class="builtintype" id="2519784">string</span><span class="op" id="2519790">,</span>&nbsp;<span class="ident" id="2519792">m</span>&nbsp;<span class="builtintype" id="2519794">bool</span><span class="op" id="2519798">)</span>&nbsp;<span class="builtintype" id="2519800">error</span>&nbsp;<span class="op" id="2519806">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519809">s</span><span class="op" id="2519810">,</span>&nbsp;<span class="ident" id="2519812">e</span>&nbsp;<span class="op" id="2519814">:=</span>&nbsp;<span class="ident" id="2519817">Socket</span><span class="op" id="2519823">(</span><span class="ident" id="2519824">AF_INET</span><span class="op" id="2519831">,</span>&nbsp;<span class="ident" id="2519833">SOCK_DGRAM</span><span class="op" id="2519843">,</span>&nbsp;<span class="num" id="2519845">0</span><span class="op" id="2519846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519849">if</span>&nbsp;<span class="ident" id="2519852">e</span>&nbsp;<span class="op" id="2519854">!=</span>&nbsp;<span class="ident" id="2519857">nil</span>&nbsp;<span class="op" id="2519861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519865">return</span>&nbsp;<span class="ident" id="2519872">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2519875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519878">defer</span>&nbsp;<span class="ident" id="2519884">Close</span><span class="op" id="2519889">(</span><span class="ident" id="2519890">s</span><span class="op" id="2519891">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519894">var</span>&nbsp;<span class="ident" id="2519898">ifl</span>&nbsp;<span class="ident" id="2519902">iflags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2519910">copy</span><span class="op" id="2519914">(</span><span class="ident" id="2519915">ifl</span><span class="op" id="2519918">.</span><span class="ident" id="2519919">name</span><span class="op" id="2519923">[</span><span class="op" id="2519924">:</span><span class="op" id="2519925">]</span><span class="op" id="2519926">,</span>&nbsp;<span class="op" id="2519928">[</span><span class="op" id="2519929">]</span><span class="builtintype" id="2519930">byte</span><span class="op" id="2519934">(</span><span class="ident" id="2519935">name</span><span class="op" id="2519939">)</span><span class="op" id="2519940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519943">_</span><span class="op" id="2519944">,</span>&nbsp;<span class="ident" id="2519946">_</span><span class="op" id="2519947">,</span>&nbsp;<span class="ident" id="2519949">ep</span>&nbsp;<span class="op" id="2519952">:=</span>&nbsp;<span class="ident" id="2519955">Syscall</span><span class="op" id="2519962">(</span><span class="ident" id="2519963">SYS_IOCTL</span><span class="op" id="2519972">,</span>&nbsp;<span class="builtintype" id="2519974">uintptr</span><span class="op" id="2519981">(</span><span class="ident" id="2519982">s</span><span class="op" id="2519983">)</span><span class="op" id="2519984">,</span>&nbsp;<span class="ident" id="2519986">SIOCGIFFLAGS</span><span class="op" id="2519998">,</span>&nbsp;<span class="builtintype" id="2520000">uintptr</span><span class="op" id="2520007">(</span><span class="ident" id="2520008">unsafe</span><span class="op" id="2520014">.</span><span class="ident" id="2520015">Pointer</span><span class="op" id="2520022">(</span><span class="op" id="2520023">&amp;</span><span class="ident" id="2520024">ifl</span><span class="op" id="2520027">)</span><span class="op" id="2520028">)</span><span class="op" id="2520029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520032">if</span>&nbsp;<span class="ident" id="2520035">ep</span>&nbsp;<span class="op" id="2520038">!=</span>&nbsp;<span class="num" id="2520041">0</span>&nbsp;<span class="op" id="2520043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520047">return</span>&nbsp;<span class="ident" id="2520054">Errno</span><span class="op" id="2520059">(</span><span class="ident" id="2520060">ep</span><span class="op" id="2520062">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2520065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520068">if</span>&nbsp;<span class="ident" id="2520071">m</span>&nbsp;<span class="op" id="2520073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2520077">ifl</span><span class="op" id="2520080">.</span><span class="ident" id="2520081">flags</span>&nbsp;<span class="op" id="2520087">|=</span>&nbsp;<span class="builtintype" id="2520090">uint16</span><span class="op" id="2520096">(</span><span class="ident" id="2520097">IFF_PROMISC</span><span class="op" id="2520108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2520111">}</span>&nbsp;<span class="keyword" id="2520113">else</span>&nbsp;<span class="op" id="2520118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2520122">ifl</span><span class="op" id="2520125">.</span><span class="ident" id="2520126">flags</span>&nbsp;<span class="op" id="2520132">&amp;=</span>&nbsp;<span class="op" id="2520135">^</span><span class="builtintype" id="2520136">uint16</span><span class="op" id="2520142">(</span><span class="ident" id="2520143">IFF_PROMISC</span><span class="op" id="2520154">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2520157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2520160">_</span><span class="op" id="2520161">,</span>&nbsp;<span class="ident" id="2520163">_</span><span class="op" id="2520164">,</span>&nbsp;<span class="ident" id="2520166">ep</span>&nbsp;<span class="op" id="2520169">=</span>&nbsp;<span class="ident" id="2520171">Syscall</span><span class="op" id="2520178">(</span><span class="ident" id="2520179">SYS_IOCTL</span><span class="op" id="2520188">,</span>&nbsp;<span class="builtintype" id="2520190">uintptr</span><span class="op" id="2520197">(</span><span class="ident" id="2520198">s</span><span class="op" id="2520199">)</span><span class="op" id="2520200">,</span>&nbsp;<span class="ident" id="2520202">SIOCSIFFLAGS</span><span class="op" id="2520214">,</span>&nbsp;<span class="builtintype" id="2520216">uintptr</span><span class="op" id="2520223">(</span><span class="ident" id="2520224">unsafe</span><span class="op" id="2520230">.</span><span class="ident" id="2520231">Pointer</span><span class="op" id="2520238">(</span><span class="op" id="2520239">&amp;</span><span class="ident" id="2520240">ifl</span><span class="op" id="2520243">)</span><span class="op" id="2520244">)</span><span class="op" id="2520245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520248">if</span>&nbsp;<span class="ident" id="2520251">ep</span>&nbsp;<span class="op" id="2520254">!=</span>&nbsp;<span class="num" id="2520257">0</span>&nbsp;<span class="op" id="2520259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520263">return</span>&nbsp;<span class="ident" id="2520270">Errno</span><span class="op" id="2520275">(</span><span class="ident" id="2520276">ep</span><span class="op" id="2520278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2520281">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520284">return</span>&nbsp;<span class="ident" id="2520291">nil</span><br>
<span class="lineno"></span><span class="op" id="2520295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2520298">func</span>&nbsp;<span class="ident" id="2520303">AttachLsf</span><span class="op" id="2520312">(</span><span class="ident" id="2520313">fd</span>&nbsp;<span class="builtintype" id="2520316">int</span><span class="op" id="2520319">,</span>&nbsp;<span class="ident" id="2520321">i</span>&nbsp;<span class="op" id="2520323">[</span><span class="op" id="2520324">]</span><span class="ident" id="2520325">SockFilter</span><span class="op" id="2520335">)</span>&nbsp;<span class="builtintype" id="2520337">error</span>&nbsp;<span class="op" id="2520343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520346">var</span>&nbsp;<span class="ident" id="2520350">p</span>&nbsp;<span class="ident" id="2520352">SockFprog</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2520363">p</span><span class="op" id="2520364">.</span><span class="ident" id="2520365">Len</span>&nbsp;<span class="op" id="2520369">=</span>&nbsp;<span class="builtintype" id="2520371">uint16</span><span class="op" id="2520377">(</span><span class="builtinfunc" id="2520378">len</span><span class="op" id="2520381">(</span><span class="ident" id="2520382">i</span><span class="op" id="2520383">)</span><span class="op" id="2520384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2520387">p</span><span class="op" id="2520388">.</span><span class="ident" id="2520389">Filter</span>&nbsp;<span class="op" id="2520396">=</span>&nbsp;<span class="op" id="2520398">(</span><span class="op" id="2520399">*</span><span class="ident" id="2520400">SockFilter</span><span class="op" id="2520410">)</span><span class="op" id="2520411">(</span><span class="ident" id="2520412">unsafe</span><span class="op" id="2520418">.</span><span class="ident" id="2520419">Pointer</span><span class="op" id="2520426">(</span><span class="op" id="2520427">&amp;</span><span class="ident" id="2520428">i</span><span class="op" id="2520429">[</span><span class="num" id="2520430">0</span><span class="op" id="2520431">]</span><span class="op" id="2520432">)</span><span class="op" id="2520433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520436">return</span>&nbsp;<span class="ident" id="2520443">setsockopt</span><span class="op" id="2520453">(</span><span class="ident" id="2520454">fd</span><span class="op" id="2520456">,</span>&nbsp;<span class="ident" id="2520458">SOL_SOCKET</span><span class="op" id="2520468">,</span>&nbsp;<span class="ident" id="2520470">SO_ATTACH_FILTER</span><span class="op" id="2520486">,</span>&nbsp;<span class="ident" id="2520488">unsafe</span><span class="op" id="2520494">.</span><span class="ident" id="2520495">Pointer</span><span class="op" id="2520502">(</span><span class="op" id="2520503">&amp;</span><span class="ident" id="2520504">p</span><span class="op" id="2520505">)</span><span class="op" id="2520506">,</span>&nbsp;<span class="ident" id="2520508">unsafe</span><span class="op" id="2520514">.</span><span class="ident" id="2520515">Sizeof</span><span class="op" id="2520521">(</span><span class="ident" id="2520522">p</span><span class="op" id="2520523">)</span><span class="op" id="2520524">)</span><br>
<span class="lineno"></span><span class="op" id="2520526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="2520529">func</span>&nbsp;<span class="ident" id="2520534">DetachLsf</span><span class="op" id="2520543">(</span><span class="ident" id="2520544">fd</span>&nbsp;<span class="builtintype" id="2520547">int</span><span class="op" id="2520550">)</span>&nbsp;<span class="builtintype" id="2520552">error</span>&nbsp;<span class="op" id="2520558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520561">var</span>&nbsp;<span class="ident" id="2520565">dummy</span>&nbsp;<span class="builtintype" id="2520571">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520576">return</span>&nbsp;<span class="ident" id="2520583">setsockopt</span><span class="op" id="2520593">(</span><span class="ident" id="2520594">fd</span><span class="op" id="2520596">,</span>&nbsp;<span class="ident" id="2520598">SOL_SOCKET</span><span class="op" id="2520608">,</span>&nbsp;<span class="ident" id="2520610">SO_DETACH_FILTER</span><span class="op" id="2520626">,</span>&nbsp;<span class="ident" id="2520628">unsafe</span><span class="op" id="2520634">.</span><span class="ident" id="2520635">Pointer</span><span class="op" id="2520642">(</span><span class="op" id="2520643">&amp;</span><span class="ident" id="2520644">dummy</span><span class="op" id="2520649">)</span><span class="op" id="2520650">,</span>&nbsp;<span class="ident" id="2520652">unsafe</span><span class="op" id="2520658">.</span><span class="ident" id="2520659">Sizeof</span><span class="op" id="2520665">(</span><span class="ident" id="2520666">dummy</span><span class="op" id="2520671">)</span><span class="op" id="2520672">)</span><br>
<span class="lineno"></span><span class="op" id="2520674">}</span>
</div>
</body>
</html>
