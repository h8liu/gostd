<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html" class="current">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3833779">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3833834">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3833888">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3833939">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;sysSocket&nbsp;and&nbsp;accept&nbsp;for&nbsp;platforms&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3834003">//&nbsp;provide&nbsp;a&nbsp;fast&nbsp;path&nbsp;for&nbsp;setting&nbsp;SetNonblock&nbsp;and&nbsp;CloseOnExec.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3834068">//&nbsp;+build&nbsp;freebsd&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3834093">package</span>&nbsp;<span class="ident" id="3834101">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3834106">import</span>&nbsp;<span class="string" id="3834113">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3834124">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;socket&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">15</span><span class="comment" id="3834194">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3834242">func</span>&nbsp;<span class="ident" id="3834247">sysSocket</span><span class="op" id="3834256">(</span><span class="ident" id="3834257">family</span><span class="op" id="3834263">,</span>&nbsp;<span class="ident" id="3834265">sotype</span><span class="op" id="3834271">,</span>&nbsp;<span class="ident" id="3834273">proto</span>&nbsp;<span class="builtintype" id="3834279">int</span><span class="op" id="3834282">)</span>&nbsp;<span class="op" id="3834284">(</span><span class="builtintype" id="3834285">int</span><span class="op" id="3834288">,</span>&nbsp;<span class="builtintype" id="3834290">error</span><span class="op" id="3834295">)</span>&nbsp;<span class="op" id="3834297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834300">s</span><span class="op" id="3834301">,</span>&nbsp;<span class="ident" id="3834303">err</span>&nbsp;<span class="op" id="3834307">:=</span>&nbsp;<span class="ident" id="3834310">syscall</span><span class="op" id="3834317">.</span><span class="ident" id="3834318">Socket</span><span class="op" id="3834324">(</span><span class="ident" id="3834325">family</span><span class="op" id="3834331">,</span>&nbsp;<span class="ident" id="3834333">sotype</span><span class="op" id="3834339">|</span><span class="ident" id="3834340">syscall</span><span class="op" id="3834347">.</span><span class="ident" id="3834348">SOCK_NONBLOCK</span><span class="op" id="3834361">|</span><span class="ident" id="3834362">syscall</span><span class="op" id="3834369">.</span><span class="ident" id="3834370">SOCK_CLOEXEC</span><span class="op" id="3834382">,</span>&nbsp;<span class="ident" id="3834384">proto</span><span class="op" id="3834389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834392">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;SOCK_NONBLOCK&nbsp;and&nbsp;SOCK_CLOEXEC&nbsp;flags&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834451">//&nbsp;introduced&nbsp;in&nbsp;2.6.27&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;both&nbsp;flags&nbsp;were</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834514">//&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we&nbsp;get&nbsp;an&nbsp;EINVAL&nbsp;error&nbsp;on&nbsp;Linux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834578">//&nbsp;or&nbsp;EPROTONOSUPPORT&nbsp;error&nbsp;on&nbsp;FreeBSD,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834638">//&nbsp;socket&nbsp;without&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3834663">if</span>&nbsp;<span class="ident" id="3834666">err</span>&nbsp;<span class="op" id="3834670">==</span>&nbsp;<span class="builtintype" id="3834673">nil</span>&nbsp;<span class="op" id="3834677">||</span>&nbsp;<span class="op" id="3834680">(</span><span class="ident" id="3834681">err</span>&nbsp;<span class="op" id="3834685">!=</span>&nbsp;<span class="ident" id="3834688">syscall</span><span class="op" id="3834695">.</span><span class="ident" id="3834696">EPROTONOSUPPORT</span>&nbsp;<span class="op" id="3834712">&amp;&amp;</span>&nbsp;<span class="ident" id="3834715">err</span>&nbsp;<span class="op" id="3834719">!=</span>&nbsp;<span class="ident" id="3834722">syscall</span><span class="op" id="3834729">.</span><span class="ident" id="3834730">EINVAL</span><span class="op" id="3834736">)</span>&nbsp;<span class="op" id="3834738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3834742">return</span>&nbsp;<span class="ident" id="3834749">s</span><span class="op" id="3834750">,</span>&nbsp;<span class="ident" id="3834752">err</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3834757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834761">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834822">syscall</span><span class="op" id="3834829">.</span><span class="ident" id="3834830">ForkLock</span><span class="op" id="3834838">.</span><span class="ident" id="3834839">RLock</span><span class="op" id="3834844">(</span><span class="op" id="3834845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834848">s</span><span class="op" id="3834849">,</span>&nbsp;<span class="ident" id="3834851">err</span>&nbsp;<span class="op" id="3834855">=</span>&nbsp;<span class="ident" id="3834857">syscall</span><span class="op" id="3834864">.</span><span class="ident" id="3834865">Socket</span><span class="op" id="3834871">(</span><span class="ident" id="3834872">family</span><span class="op" id="3834878">,</span>&nbsp;<span class="ident" id="3834880">sotype</span><span class="op" id="3834886">,</span>&nbsp;<span class="ident" id="3834888">proto</span><span class="op" id="3834893">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3834896">if</span>&nbsp;<span class="ident" id="3834899">err</span>&nbsp;<span class="op" id="3834903">==</span>&nbsp;<span class="builtintype" id="3834906">nil</span>&nbsp;<span class="op" id="3834910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834914">syscall</span><span class="op" id="3834921">.</span><span class="ident" id="3834922">CloseOnExec</span><span class="op" id="3834933">(</span><span class="ident" id="3834934">s</span><span class="op" id="3834935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3834938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834941">syscall</span><span class="op" id="3834948">.</span><span class="ident" id="3834949">ForkLock</span><span class="op" id="3834957">.</span><span class="ident" id="3834958">RUnlock</span><span class="op" id="3834965">(</span><span class="op" id="3834966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3834969">if</span>&nbsp;<span class="ident" id="3834972">err</span>&nbsp;<span class="op" id="3834976">!=</span>&nbsp;<span class="builtintype" id="3834979">nil</span>&nbsp;<span class="op" id="3834983">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3834987">return</span>&nbsp;<span class="op" id="3834994">-</span><span class="num" id="3834995">1</span><span class="op" id="3834996">,</span>&nbsp;<span class="ident" id="3834998">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3835003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835006">if</span>&nbsp;<span class="ident" id="3835009">err</span>&nbsp;<span class="op" id="3835013">=</span>&nbsp;<span class="ident" id="3835015">syscall</span><span class="op" id="3835022">.</span><span class="ident" id="3835023">SetNonblock</span><span class="op" id="3835034">(</span><span class="ident" id="3835035">s</span><span class="op" id="3835036">,</span>&nbsp;<span class="builtintype" id="3835038">true</span><span class="op" id="3835042">)</span><span class="op" id="3835043">;</span>&nbsp;<span class="ident" id="3835045">err</span>&nbsp;<span class="op" id="3835049">!=</span>&nbsp;<span class="builtintype" id="3835052">nil</span>&nbsp;<span class="op" id="3835056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3835060">syscall</span><span class="op" id="3835067">.</span><span class="ident" id="3835068">Close</span><span class="op" id="3835073">(</span><span class="ident" id="3835074">s</span><span class="op" id="3835075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835079">return</span>&nbsp;<span class="op" id="3835086">-</span><span class="num" id="3835087">1</span><span class="op" id="3835088">,</span>&nbsp;<span class="ident" id="3835090">err</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3835095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835098">return</span>&nbsp;<span class="ident" id="3835105">s</span><span class="op" id="3835106">,</span>&nbsp;<span class="builtintype" id="3835108">nil</span><br>
<span class="lineno"></span><span class="op" id="3835112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3835115">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;accept&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">45</span><span class="comment" id="3835185">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3835233">func</span>&nbsp;<span class="ident" id="3835238">accept</span><span class="op" id="3835244">(</span><span class="ident" id="3835245">s</span>&nbsp;<span class="builtintype" id="3835247">int</span><span class="op" id="3835250">)</span>&nbsp;<span class="op" id="3835252">(</span><span class="builtintype" id="3835253">int</span><span class="op" id="3835256">,</span>&nbsp;<span class="ident" id="3835258">syscall</span><span class="op" id="3835265">.</span><span class="ident" id="3835266">Sockaddr</span><span class="op" id="3835274">,</span>&nbsp;<span class="builtintype" id="3835276">error</span><span class="op" id="3835281">)</span>&nbsp;<span class="op" id="3835283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3835286">ns</span><span class="op" id="3835288">,</span>&nbsp;<span class="ident" id="3835290">sa</span><span class="op" id="3835292">,</span>&nbsp;<span class="ident" id="3835294">err</span>&nbsp;<span class="op" id="3835298">:=</span>&nbsp;<span class="ident" id="3835301">syscall</span><span class="op" id="3835308">.</span><span class="ident" id="3835309">Accept4</span><span class="op" id="3835316">(</span><span class="ident" id="3835317">s</span><span class="op" id="3835318">,</span>&nbsp;<span class="ident" id="3835320">syscall</span><span class="op" id="3835327">.</span><span class="ident" id="3835328">SOCK_NONBLOCK</span><span class="op" id="3835341">|</span><span class="ident" id="3835342">syscall</span><span class="op" id="3835349">.</span><span class="ident" id="3835350">SOCK_CLOEXEC</span><span class="op" id="3835362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835365">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;accept4&nbsp;system&nbsp;call&nbsp;was&nbsp;introduced&nbsp;in&nbsp;2.6.28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835427">//&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;it&nbsp;was&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835491">//&nbsp;get&nbsp;an&nbsp;ENOSYS&nbsp;error&nbsp;on&nbsp;both&nbsp;Linux&nbsp;and&nbsp;FreeBSD,&nbsp;or&nbsp;EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835552">//&nbsp;error&nbsp;on&nbsp;Linux,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using&nbsp;accept.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835599">switch</span>&nbsp;<span class="ident" id="3835606">err</span>&nbsp;<span class="op" id="3835610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835613">default</span><span class="op" id="3835620">:</span>&nbsp;<span class="comment" id="3835622">//&nbsp;nil&nbsp;and&nbsp;errors&nbsp;other&nbsp;than&nbsp;the&nbsp;ones&nbsp;listed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835669">return</span>&nbsp;<span class="ident" id="3835676">ns</span><span class="op" id="3835678">,</span>&nbsp;<span class="ident" id="3835680">sa</span><span class="op" id="3835682">,</span>&nbsp;<span class="ident" id="3835684">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835689">case</span>&nbsp;<span class="ident" id="3835694">syscall</span><span class="op" id="3835701">.</span><span class="ident" id="3835702">ENOSYS</span><span class="op" id="3835708">:</span>&nbsp;<span class="comment" id="3835710">//&nbsp;syscall&nbsp;missing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835730">case</span>&nbsp;<span class="ident" id="3835735">syscall</span><span class="op" id="3835742">.</span><span class="ident" id="3835743">EINVAL</span><span class="op" id="3835749">:</span>&nbsp;<span class="comment" id="3835751">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835793">case</span>&nbsp;<span class="ident" id="3835798">syscall</span><span class="op" id="3835805">.</span><span class="ident" id="3835806">EACCES</span><span class="op" id="3835812">:</span>&nbsp;<span class="comment" id="3835814">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835856">case</span>&nbsp;<span class="ident" id="3835861">syscall</span><span class="op" id="3835868">.</span><span class="ident" id="3835869">EFAULT</span><span class="op" id="3835875">:</span>&nbsp;<span class="comment" id="3835877">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3835919">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835923">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835984">//&nbsp;It&nbsp;is&nbsp;probably&nbsp;okay&nbsp;to&nbsp;hold&nbsp;the&nbsp;lock&nbsp;across&nbsp;syscall.Accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3836047">//&nbsp;because&nbsp;we&nbsp;have&nbsp;put&nbsp;fd.sysfd&nbsp;into&nbsp;non-blocking&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3836104">//&nbsp;However,&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;File&nbsp;method&nbsp;will&nbsp;put&nbsp;it&nbsp;back&nbsp;into</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3836165">//&nbsp;blocking&nbsp;mode.&nbsp;We&nbsp;can&#39;t&nbsp;take&nbsp;that&nbsp;risk,&nbsp;so&nbsp;no&nbsp;use&nbsp;of&nbsp;ForkLock&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836237">ns</span><span class="op" id="3836239">,</span>&nbsp;<span class="ident" id="3836241">sa</span><span class="op" id="3836243">,</span>&nbsp;<span class="ident" id="3836245">err</span>&nbsp;<span class="op" id="3836249">=</span>&nbsp;<span class="ident" id="3836251">syscall</span><span class="op" id="3836258">.</span><span class="ident" id="3836259">Accept</span><span class="op" id="3836265">(</span><span class="ident" id="3836266">s</span><span class="op" id="3836267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836270">if</span>&nbsp;<span class="ident" id="3836273">err</span>&nbsp;<span class="op" id="3836277">==</span>&nbsp;<span class="builtintype" id="3836280">nil</span>&nbsp;<span class="op" id="3836284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836288">syscall</span><span class="op" id="3836295">.</span><span class="ident" id="3836296">CloseOnExec</span><span class="op" id="3836307">(</span><span class="ident" id="3836308">ns</span><span class="op" id="3836310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836313">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836316">if</span>&nbsp;<span class="ident" id="3836319">err</span>&nbsp;<span class="op" id="3836323">!=</span>&nbsp;<span class="builtintype" id="3836326">nil</span>&nbsp;<span class="op" id="3836330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836334">return</span>&nbsp;<span class="op" id="3836341">-</span><span class="num" id="3836342">1</span><span class="op" id="3836343">,</span>&nbsp;<span class="builtintype" id="3836345">nil</span><span class="op" id="3836348">,</span>&nbsp;<span class="ident" id="3836350">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836358">if</span>&nbsp;<span class="ident" id="3836361">err</span>&nbsp;<span class="op" id="3836365">=</span>&nbsp;<span class="ident" id="3836367">syscall</span><span class="op" id="3836374">.</span><span class="ident" id="3836375">SetNonblock</span><span class="op" id="3836386">(</span><span class="ident" id="3836387">ns</span><span class="op" id="3836389">,</span>&nbsp;<span class="builtintype" id="3836391">true</span><span class="op" id="3836395">)</span><span class="op" id="3836396">;</span>&nbsp;<span class="ident" id="3836398">err</span>&nbsp;<span class="op" id="3836402">!=</span>&nbsp;<span class="builtintype" id="3836405">nil</span>&nbsp;<span class="op" id="3836409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836413">syscall</span><span class="op" id="3836420">.</span><span class="ident" id="3836421">Close</span><span class="op" id="3836426">(</span><span class="ident" id="3836427">ns</span><span class="op" id="3836429">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836433">return</span>&nbsp;<span class="op" id="3836440">-</span><span class="num" id="3836441">1</span><span class="op" id="3836442">,</span>&nbsp;<span class="builtintype" id="3836444">nil</span><span class="op" id="3836447">,</span>&nbsp;<span class="ident" id="3836449">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836457">return</span>&nbsp;<span class="ident" id="3836464">ns</span><span class="op" id="3836466">,</span>&nbsp;<span class="ident" id="3836468">sa</span><span class="op" id="3836470">,</span>&nbsp;<span class="builtintype" id="3836472">nil</span><br>
<span class="lineno"></span><span class="op" id="3836476">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
