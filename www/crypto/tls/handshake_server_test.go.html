<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7443810">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7443865">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7443919">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7443970">package</span>&nbsp;<span class="ident" id="7443978">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7443983">import</span>&nbsp;<span class="op" id="7443990">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7443993">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444002">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444018">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444037">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444051">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444067">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444083">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444093">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444100">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444106">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444118">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444125">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444131">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444142">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444159">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444170">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7444181">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="7444188">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7444191">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7444269">type</span>&nbsp;<span class="ident" id="7444274">zeroSource</span>&nbsp;<span class="keyword" id="7444285">struct</span><span class="op" id="7444291">{</span><span class="op" id="7444292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7444295">func</span>&nbsp;<span class="op" id="7444300">(</span><span class="ident" id="7444301"><a href="/crypto/tls/handshake_server_test.go.html#7444274">zeroSource</a></span><span class="op" id="7444311">)</span>&nbsp;<span class="ident" id="7444313">Read</span><span class="op" id="7444317">(</span><span class="ident" id="7444318">b</span>&nbsp;<span class="op" id="7444320">[</span><span class="op" id="7444321">]</span><span class="builtintype" id="7444322">byte</span><span class="op" id="7444326">)</span>&nbsp;<span class="op" id="7444328">(</span><span class="ident" id="7444329">n</span>&nbsp;<span class="builtintype" id="7444331">int</span><span class="op" id="7444334">,</span>&nbsp;<span class="ident" id="7444336">err</span>&nbsp;<span class="builtintype" id="7444340">error</span><span class="op" id="7444345">)</span>&nbsp;<span class="op" id="7444347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444350">for</span>&nbsp;<span class="ident" id="7444354">i</span>&nbsp;<span class="op" id="7444356">:=</span>&nbsp;<span class="keyword" id="7444359">range</span>&nbsp;<span class="ident" id="7444365"><a href="/crypto/tls/handshake_server_test.go.html#7444318">b</a></span>&nbsp;<span class="op" id="7444367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444371"><a href="/crypto/tls/handshake_server_test.go.html#7444318">b</a></span><span class="op" id="7444372">[</span><span class="ident" id="7444373"><a href="/crypto/tls/handshake_server_test.go.html#7444354">i</a></span><span class="op" id="7444374">]</span>&nbsp;<span class="op" id="7444376">=</span>&nbsp;<span class="num" id="7444378">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7444381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444385">return</span>&nbsp;<span class="builtinfunc" id="7444392">len</span><span class="op" id="7444395">(</span><span class="ident" id="7444396"><a href="/crypto/tls/handshake_server_test.go.html#7444318">b</a></span><span class="op" id="7444397">)</span><span class="op" id="7444398">,</span>&nbsp;<span class="ident" id="7444400">nil</span><br>
<span class="lineno"></span><span class="op" id="7444404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7444407">var</span>&nbsp;<span class="ident" id="7444411">testConfig</span>&nbsp;<span class="op" id="7444422">*</span><span class="ident" id="7444423"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="7444431">func</span>&nbsp;<span class="ident" id="7444436">init</span><span class="op" id="7444440">(</span><span class="op" id="7444441">)</span>&nbsp;<span class="op" id="7444443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444446"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span>&nbsp;<span class="op" id="7444457">=</span>&nbsp;<span class="op" id="7444459">&amp;</span><span class="ident" id="7444460"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="7444466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444470">Time</span><span class="op" id="7444474">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7444490">func</span><span class="op" id="7444494">(</span><span class="op" id="7444495">)</span>&nbsp;<span class="ident" id="7444497"><a href="/crypto/tls/handshake_server_test.go.html#7444181">time</a></span><span class="op" id="7444501">.</span><span class="ident" id="7444502">Time</span>&nbsp;<span class="op" id="7444507">{</span>&nbsp;<span class="keyword" id="7444509">return</span>&nbsp;<span class="ident" id="7444516"><a href="/crypto/tls/handshake_server_test.go.html#7444181">time</a></span><span class="op" id="7444520">.</span><span class="ident" id="7444521">Unix</span><span class="op" id="7444525">(</span><span class="num" id="7444526">0</span><span class="op" id="7444527">,</span>&nbsp;<span class="num" id="7444529">0</span><span class="op" id="7444530">)</span>&nbsp;<span class="op" id="7444532">}</span><span class="op" id="7444533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444537">Rand</span><span class="op" id="7444541">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444557"><a href="/crypto/tls/handshake_server_test.go.html#7444274">zeroSource</a></span><span class="op" id="7444567">{</span><span class="op" id="7444568">}</span><span class="op" id="7444569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444573">Certificates</span><span class="op" id="7444585">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7444593">make</span><span class="op" id="7444597">(</span><span class="op" id="7444598">[</span><span class="op" id="7444599">]</span><span class="ident" id="7444600"><a href="/crypto/tls/common.go.html#3838319">Certificate</a></span><span class="op" id="7444611">,</span>&nbsp;<span class="num" id="7444613">2</span><span class="op" id="7444614">)</span><span class="op" id="7444615">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444619">InsecureSkipVerify</span><span class="op" id="7444637">:</span>&nbsp;<span class="builtintype" id="7444639">true</span><span class="op" id="7444643">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444647">MinVersion</span><span class="op" id="7444657">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444667"><a href="/crypto/tls/common.go.html#3822772">VersionSSL30</a></span><span class="op" id="7444679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444683">MaxVersion</span><span class="op" id="7444693">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444703"><a href="/crypto/tls/common.go.html#3822841">VersionTLS12</a></span><span class="op" id="7444715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7444718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444721"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7444731">.</span><span class="ident" id="7444732">Certificates</span><span class="op" id="7444744">[</span><span class="num" id="7444745">0</span><span class="op" id="7444746">]</span><span class="op" id="7444747">.</span><span class="ident" id="7444748">Certificate</span>&nbsp;<span class="op" id="7444760">=</span>&nbsp;<span class="op" id="7444762">[</span><span class="op" id="7444763">]</span><span class="op" id="7444764">[</span><span class="op" id="7444765">]</span><span class="builtintype" id="7444766">byte</span><span class="op" id="7444770">{</span><span class="ident" id="7444771"><a href="/crypto/tls/handshake_server_test.go.html#7469490">testRSACertificate</a></span><span class="op" id="7444789">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444792"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7444802">.</span><span class="ident" id="7444803">Certificates</span><span class="op" id="7444815">[</span><span class="num" id="7444816">0</span><span class="op" id="7444817">]</span><span class="op" id="7444818">.</span><span class="ident" id="7444819">PrivateKey</span>&nbsp;<span class="op" id="7444830">=</span>&nbsp;<span class="ident" id="7444832"><a href="/crypto/tls/handshake_server_test.go.html#7473026">testRSAPrivateKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444851"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7444861">.</span><span class="ident" id="7444862">Certificates</span><span class="op" id="7444874">[</span><span class="num" id="7444875">1</span><span class="op" id="7444876">]</span><span class="op" id="7444877">.</span><span class="ident" id="7444878">Certificate</span>&nbsp;<span class="op" id="7444890">=</span>&nbsp;<span class="op" id="7444892">[</span><span class="op" id="7444893">]</span><span class="op" id="7444894">[</span><span class="op" id="7444895">]</span><span class="builtintype" id="7444896">byte</span><span class="op" id="7444900">{</span><span class="ident" id="7444901"><a href="/crypto/tls/handshake_server_test.go.html#7471984">testSNICertificate</a></span><span class="op" id="7444919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444922"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7444932">.</span><span class="ident" id="7444933">Certificates</span><span class="op" id="7444945">[</span><span class="num" id="7444946">1</span><span class="op" id="7444947">]</span><span class="op" id="7444948">.</span><span class="ident" id="7444949">PrivateKey</span>&nbsp;<span class="op" id="7444960">=</span>&nbsp;<span class="ident" id="7444962"><a href="/crypto/tls/handshake_server_test.go.html#7473026">testRSAPrivateKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444981"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7444991">.</span><span class="ident" id="7444992">BuildNameToCertificate</span><span class="op" id="7445014">(</span><span class="op" id="7445015">)</span><br>
<span class="lineno"></span><span class="op" id="7445017">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7445020">func</span>&nbsp;<span class="ident" id="7445025">testClientHelloFailure</span><span class="op" id="7445047">(</span><span class="ident" id="7445048">t</span>&nbsp;<span class="op" id="7445050">*</span><span class="ident" id="7445051"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7445058">.</span><span class="ident" id="7445059">T</span><span class="op" id="7445060">,</span>&nbsp;<span class="ident" id="7445062">m</span>&nbsp;<span class="ident" id="7445064"><a href="/crypto/tls/common.go.html#3839208">handshakeMessage</a></span><span class="op" id="7445080">,</span>&nbsp;<span class="ident" id="7445082">expectedSubStr</span>&nbsp;<span class="builtintype" id="7445097">string</span><span class="op" id="7445103">)</span>&nbsp;<span class="op" id="7445105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7445108">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7445149">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7445192">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445212">c</span><span class="op" id="7445213">,</span>&nbsp;<span class="ident" id="7445215">s</span>&nbsp;<span class="op" id="7445217">:=</span>&nbsp;<span class="ident" id="7445220"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7445223">.</span><span class="ident" id="7445224">Pipe</span><span class="op" id="7445228">(</span><span class="op" id="7445229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445232">go</span>&nbsp;<span class="keyword" id="7445235">func</span><span class="op" id="7445239">(</span><span class="op" id="7445240">)</span>&nbsp;<span class="op" id="7445242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445246">cli</span>&nbsp;<span class="op" id="7445250">:=</span>&nbsp;<span class="ident" id="7445253"><a href="/crypto/tls/tls.go.html#3964368">Client</a></span><span class="op" id="7445259">(</span><span class="ident" id="7445260"><a href="/crypto/tls/handshake_server_test.go.html#7445212">c</a></span><span class="op" id="7445261">,</span>&nbsp;<span class="ident" id="7445263"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7445273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445277">if</span>&nbsp;<span class="ident" id="7445280">ch</span><span class="op" id="7445282">,</span>&nbsp;<span class="ident" id="7445284">ok</span>&nbsp;<span class="op" id="7445287">:=</span>&nbsp;<span class="ident" id="7445290"><a href="/crypto/tls/handshake_server_test.go.html#7445062">m</a></span><span class="op" id="7445291">.</span><span class="op" id="7445292">(</span><span class="op" id="7445293">*</span><span class="ident" id="7445294"><a href="/crypto/tls/handshake_messages.go.html#3888598">clientHelloMsg</a></span><span class="op" id="7445308">)</span><span class="op" id="7445309">;</span>&nbsp;<span class="ident" id="7445311"><a href="/crypto/tls/handshake_server_test.go.html#7445284">ok</a></span>&nbsp;<span class="op" id="7445314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445319"><a href="/crypto/tls/handshake_server_test.go.html#7445246">cli</a></span><span class="op" id="7445322">.</span><span class="ident" id="7445323">vers</span>&nbsp;<span class="op" id="7445328">=</span>&nbsp;<span class="ident" id="7445330"><a href="/crypto/tls/handshake_server_test.go.html#7445280">ch</a></span><span class="op" id="7445332">.</span><span class="ident" id="7445333">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445344"><a href="/crypto/tls/handshake_server_test.go.html#7445246">cli</a></span><span class="op" id="7445347">.</span><span class="ident" id="7445348">writeRecord</span><span class="op" id="7445359">(</span><span class="ident" id="7445360"><a href="/crypto/tls/common.go.html#3823354">recordTypeHandshake</a></span><span class="op" id="7445379">,</span>&nbsp;<span class="ident" id="7445381"><a href="/crypto/tls/handshake_server_test.go.html#7445062">m</a></span><span class="op" id="7445382">.</span><span class="ident" id="7445383">marshal</span><span class="op" id="7445390">(</span><span class="op" id="7445391">)</span><span class="op" id="7445392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445396"><a href="/crypto/tls/handshake_server_test.go.html#7445212">c</a></span><span class="op" id="7445397">.</span><span class="ident" id="7445398">Close</span><span class="op" id="7445403">(</span><span class="op" id="7445404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445407">}</span><span class="op" id="7445408">(</span><span class="op" id="7445409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445412">err</span>&nbsp;<span class="op" id="7445416">:=</span>&nbsp;<span class="ident" id="7445419"><a href="/crypto/tls/tls.go.html#3964076">Server</a></span><span class="op" id="7445425">(</span><span class="ident" id="7445426"><a href="/crypto/tls/handshake_server_test.go.html#7445215">s</a></span><span class="op" id="7445427">,</span>&nbsp;<span class="ident" id="7445429"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7445439">)</span><span class="op" id="7445440">.</span><span class="ident" id="7445441">Handshake</span><span class="op" id="7445450">(</span><span class="op" id="7445451">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445454"><a href="/crypto/tls/handshake_server_test.go.html#7445215">s</a></span><span class="op" id="7445455">.</span><span class="ident" id="7445456">Close</span><span class="op" id="7445461">(</span><span class="op" id="7445462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445465">if</span>&nbsp;<span class="ident" id="7445468"><a href="/crypto/tls/handshake_server_test.go.html#7445412">err</a></span>&nbsp;<span class="op" id="7445472">==</span>&nbsp;<span class="ident" id="7445475">nil</span>&nbsp;<span class="op" id="7445479">||</span>&nbsp;<span class="op" id="7445482">!</span><span class="ident" id="7445483"><a href="/crypto/tls/handshake_server_test.go.html#7444159">strings</a></span><span class="op" id="7445490">.</span><span class="ident" id="7445491">Contains</span><span class="op" id="7445499">(</span><span class="ident" id="7445500"><a href="/crypto/tls/handshake_server_test.go.html#7445412">err</a></span><span class="op" id="7445503">.</span><span class="ident" id="7445504">Error</span><span class="op" id="7445509">(</span><span class="op" id="7445510">)</span><span class="op" id="7445511">,</span>&nbsp;<span class="ident" id="7445513"><a href="/crypto/tls/handshake_server_test.go.html#7445082">expectedSubStr</a></span><span class="op" id="7445527">)</span>&nbsp;<span class="op" id="7445529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445533"><a href="/crypto/tls/handshake_server_test.go.html#7445048">t</a></span><span class="op" id="7445534">.</span><span class="ident" id="7445535">Errorf</span><span class="op" id="7445541">(</span><span class="string" id="7445542">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7445591">,</span>&nbsp;<span class="ident" id="7445593"><a href="/crypto/tls/handshake_server_test.go.html#7445412">err</a></span><span class="op" id="7445596">,</span>&nbsp;<span class="ident" id="7445598"><a href="/crypto/tls/handshake_server_test.go.html#7445082">expectedSubStr</a></span><span class="op" id="7445612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445615">}</span><br>
<span class="lineno"></span><span class="op" id="7445617">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7445620">func</span>&nbsp;<span class="ident" id="7445625">TestSimpleError</span><span class="op" id="7445640">(</span><span class="ident" id="7445641">t</span>&nbsp;<span class="op" id="7445643">*</span><span class="ident" id="7445644"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7445651">.</span><span class="ident" id="7445652">T</span><span class="op" id="7445653">)</span>&nbsp;<span class="op" id="7445655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445658"><a href="/crypto/tls/handshake_server_test.go.html#7445025">testClientHelloFailure</a></span><span class="op" id="7445680">(</span><span class="ident" id="7445681"><a href="/crypto/tls/handshake_server_test.go.html#7445641">t</a></span><span class="op" id="7445682">,</span>&nbsp;<span class="op" id="7445684">&amp;</span><span class="ident" id="7445685"><a href="/crypto/tls/handshake_messages.go.html#3908750">serverHelloDoneMsg</a></span><span class="op" id="7445703">{</span><span class="op" id="7445704">}</span><span class="op" id="7445705">,</span>&nbsp;<span class="string" id="7445707">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="7445737">)</span><br>
<span class="lineno"></span><span class="op" id="7445739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7445742">var</span>&nbsp;<span class="ident" id="7445746">badProtocolVersions</span>&nbsp;<span class="op" id="7445766">=</span>&nbsp;<span class="op" id="7445768">[</span><span class="op" id="7445769">]</span><span class="builtintype" id="7445770">uint16</span><span class="op" id="7445776">{</span><span class="num" id="7445777">0x0000</span><span class="op" id="7445783">,</span>&nbsp;<span class="num" id="7445785">0x0005</span><span class="op" id="7445791">,</span>&nbsp;<span class="num" id="7445793">0x0100</span><span class="op" id="7445799">,</span>&nbsp;<span class="num" id="7445801">0x0105</span><span class="op" id="7445807">,</span>&nbsp;<span class="num" id="7445809">0x0200</span><span class="op" id="7445815">,</span>&nbsp;<span class="num" id="7445817">0x0205</span><span class="op" id="7445823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7445826">func</span>&nbsp;<span class="ident" id="7445831">TestRejectBadProtocolVersion</span><span class="op" id="7445859">(</span><span class="ident" id="7445860">t</span>&nbsp;<span class="op" id="7445862">*</span><span class="ident" id="7445863"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7445870">.</span><span class="ident" id="7445871">T</span><span class="op" id="7445872">)</span>&nbsp;<span class="op" id="7445874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445877">for</span>&nbsp;<span class="ident" id="7445881">_</span><span class="op" id="7445882">,</span>&nbsp;<span class="ident" id="7445884">v</span>&nbsp;<span class="op" id="7445886">:=</span>&nbsp;<span class="keyword" id="7445889">range</span>&nbsp;<span class="ident" id="7445895"><a href="/crypto/tls/handshake_server_test.go.html#7445746">badProtocolVersions</a></span>&nbsp;<span class="op" id="7445915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445919"><a href="/crypto/tls/handshake_server_test.go.html#7445025">testClientHelloFailure</a></span><span class="op" id="7445941">(</span><span class="ident" id="7445942"><a href="/crypto/tls/handshake_server_test.go.html#7445860">t</a></span><span class="op" id="7445943">,</span>&nbsp;<span class="op" id="7445945">&amp;</span><span class="ident" id="7445946"><a href="/crypto/tls/handshake_messages.go.html#3888598">clientHelloMsg</a></span><span class="op" id="7445960">{</span><span class="ident" id="7445961">vers</span><span class="op" id="7445965">:</span>&nbsp;<span class="ident" id="7445967"><a href="/crypto/tls/handshake_server_test.go.html#7445884">v</a></span><span class="op" id="7445968">}</span><span class="op" id="7445969">,</span>&nbsp;<span class="string" id="7445971">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="7446010">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7446013">}</span><br>
<span class="lineno"></span><span class="op" id="7446015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7446018">func</span>&nbsp;<span class="ident" id="7446023">TestNoSuiteOverlap</span><span class="op" id="7446041">(</span><span class="ident" id="7446042">t</span>&nbsp;<span class="op" id="7446044">*</span><span class="ident" id="7446045"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7446052">.</span><span class="ident" id="7446053">T</span><span class="op" id="7446054">)</span>&nbsp;<span class="op" id="7446056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446059">clientHello</span>&nbsp;<span class="op" id="7446071">:=</span>&nbsp;<span class="op" id="7446074">&amp;</span><span class="ident" id="7446075"><a href="/crypto/tls/handshake_messages.go.html#3888598">clientHelloMsg</a></span><span class="op" id="7446089">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446093">vers</span><span class="op" id="7446097">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7446113">0x0301</span><span class="op" id="7446119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446123">cipherSuites</span><span class="op" id="7446135">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7446143">[</span><span class="op" id="7446144">]</span><span class="builtintype" id="7446145">uint16</span><span class="op" id="7446151">{</span><span class="num" id="7446152">0xff00</span><span class="op" id="7446158">}</span><span class="op" id="7446159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446163">compressionMethods</span><span class="op" id="7446181">:</span>&nbsp;<span class="op" id="7446183">[</span><span class="op" id="7446184">]</span><span class="builtintype" id="7446185">uint8</span><span class="op" id="7446190">{</span><span class="num" id="7446191">0</span><span class="op" id="7446192">}</span><span class="op" id="7446193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7446196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446199"><a href="/crypto/tls/handshake_server_test.go.html#7445025">testClientHelloFailure</a></span><span class="op" id="7446221">(</span><span class="ident" id="7446222"><a href="/crypto/tls/handshake_server_test.go.html#7446042">t</a></span><span class="op" id="7446223">,</span>&nbsp;<span class="ident" id="7446225"><a href="/crypto/tls/handshake_server_test.go.html#7446059">clientHello</a></span><span class="op" id="7446236">,</span>&nbsp;<span class="string" id="7446238">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="7446291">)</span><br>
<span class="lineno">95</span><span class="op" id="7446293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7446296">func</span>&nbsp;<span class="ident" id="7446301">TestNoCompressionOverlap</span><span class="op" id="7446325">(</span><span class="ident" id="7446326">t</span>&nbsp;<span class="op" id="7446328">*</span><span class="ident" id="7446329"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7446336">.</span><span class="ident" id="7446337">T</span><span class="op" id="7446338">)</span>&nbsp;<span class="op" id="7446340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446343">clientHello</span>&nbsp;<span class="op" id="7446355">:=</span>&nbsp;<span class="op" id="7446358">&amp;</span><span class="ident" id="7446359"><a href="/crypto/tls/handshake_messages.go.html#3888598">clientHelloMsg</a></span><span class="op" id="7446373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446377">vers</span><span class="op" id="7446381">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7446397">0x0301</span><span class="op" id="7446403">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446407">cipherSuites</span><span class="op" id="7446419">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7446427">[</span><span class="op" id="7446428">]</span><span class="builtintype" id="7446429">uint16</span><span class="op" id="7446435">{</span><span class="ident" id="7446436"><a href="/crypto/tls/cipher_suites.go.html#3821503">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7446460">}</span><span class="op" id="7446461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446465">compressionMethods</span><span class="op" id="7446483">:</span>&nbsp;<span class="op" id="7446485">[</span><span class="op" id="7446486">]</span><span class="builtintype" id="7446487">uint8</span><span class="op" id="7446492">{</span><span class="num" id="7446493">0xff</span><span class="op" id="7446497">}</span><span class="op" id="7446498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7446501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446504"><a href="/crypto/tls/handshake_server_test.go.html#7445025">testClientHelloFailure</a></span><span class="op" id="7446526">(</span><span class="ident" id="7446527"><a href="/crypto/tls/handshake_server_test.go.html#7446326">t</a></span><span class="op" id="7446528">,</span>&nbsp;<span class="ident" id="7446530"><a href="/crypto/tls/handshake_server_test.go.html#7446343">clientHello</a></span><span class="op" id="7446541">,</span>&nbsp;<span class="string" id="7446543">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="7446593">)</span><br>
<span class="lineno"></span><span class="op" id="7446595">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7446598">func</span>&nbsp;<span class="ident" id="7446603">TestTLS12OnlyCipherSuites</span><span class="op" id="7446628">(</span><span class="ident" id="7446629">t</span>&nbsp;<span class="op" id="7446631">*</span><span class="ident" id="7446632"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7446639">.</span><span class="ident" id="7446640">T</span><span class="op" id="7446641">)</span>&nbsp;<span class="op" id="7446643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446646">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446717">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7446752">var</span>&nbsp;<span class="ident" id="7446756">zeros</span>&nbsp;<span class="op" id="7446762">[</span><span class="num" id="7446763">32</span><span class="op" id="7446765">]</span><span class="builtintype" id="7446766">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446773">clientHello</span>&nbsp;<span class="op" id="7446785">:=</span>&nbsp;<span class="op" id="7446788">&amp;</span><span class="ident" id="7446789"><a href="/crypto/tls/handshake_messages.go.html#3888598">clientHelloMsg</a></span><span class="op" id="7446803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446807">vers</span><span class="op" id="7446811">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7446815"><a href="/crypto/tls/common.go.html#3822818">VersionTLS11</a></span><span class="op" id="7446827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446831">random</span><span class="op" id="7446837">:</span>&nbsp;<span class="ident" id="7446839"><a href="/crypto/tls/handshake_server_test.go.html#7446756">zeros</a></span><span class="op" id="7446844">[</span><span class="op" id="7446845">:</span><span class="op" id="7446846">]</span><span class="op" id="7446847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446851">cipherSuites</span><span class="op" id="7446863">:</span>&nbsp;<span class="op" id="7446865">[</span><span class="op" id="7446866">]</span><span class="builtintype" id="7446867">uint16</span><span class="op" id="7446873">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446878">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446930">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446978">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7447030">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447072"><a href="/crypto/tls/cipher_suites.go.html#3822130">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</a></span><span class="op" id="7447109">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447114"><a href="/crypto/tls/cipher_suites.go.html#3821503">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7447138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447142">}</span><span class="op" id="7447143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447147">compressionMethods</span><span class="op" id="7447165">:</span>&nbsp;<span class="op" id="7447167">[</span><span class="op" id="7447168">]</span><span class="builtintype" id="7447169">uint8</span><span class="op" id="7447174">{</span><span class="ident" id="7447175"><a href="/crypto/tls/common.go.html#3823960">compressionNone</a></span><span class="op" id="7447190">}</span><span class="op" id="7447191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447195">supportedCurves</span><span class="op" id="7447210">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7447215">[</span><span class="op" id="7447216">]</span><span class="ident" id="7447217"><a href="/crypto/tls/common.go.html#3824673">CurveID</a></span><span class="op" id="7447224">{</span><span class="ident" id="7447225"><a href="/crypto/tls/common.go.html#3824698">CurveP256</a></span><span class="op" id="7447234">,</span>&nbsp;<span class="ident" id="7447236"><a href="/crypto/tls/common.go.html#3824722">CurveP384</a></span><span class="op" id="7447245">,</span>&nbsp;<span class="ident" id="7447247"><a href="/crypto/tls/common.go.html#3824746">CurveP521</a></span><span class="op" id="7447256">}</span><span class="op" id="7447257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447261">supportedPoints</span><span class="op" id="7447276">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7447281">[</span><span class="op" id="7447282">]</span><span class="builtintype" id="7447283">uint8</span><span class="op" id="7447288">{</span><span class="ident" id="7447289"><a href="/crypto/tls/common.go.html#3824903">pointFormatUncompressed</a></span><span class="op" id="7447312">}</span><span class="op" id="7447313">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447320">c</span><span class="op" id="7447321">,</span>&nbsp;<span class="ident" id="7447323">s</span>&nbsp;<span class="op" id="7447325">:=</span>&nbsp;<span class="ident" id="7447328"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7447331">.</span><span class="ident" id="7447332">Pipe</span><span class="op" id="7447336">(</span><span class="op" id="7447337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7447340">var</span>&nbsp;<span class="ident" id="7447344">reply</span>&nbsp;<span class="keyword" id="7447350">interface</span><span class="op" id="7447359">{</span><span class="op" id="7447360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7447363">var</span>&nbsp;<span class="ident" id="7447367">clientErr</span>&nbsp;<span class="builtintype" id="7447377">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7447384">go</span>&nbsp;<span class="keyword" id="7447387">func</span><span class="op" id="7447391">(</span><span class="op" id="7447392">)</span>&nbsp;<span class="op" id="7447394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447398">cli</span>&nbsp;<span class="op" id="7447402">:=</span>&nbsp;<span class="ident" id="7447405"><a href="/crypto/tls/tls.go.html#3964368">Client</a></span><span class="op" id="7447411">(</span><span class="ident" id="7447412"><a href="/crypto/tls/handshake_server_test.go.html#7447320">c</a></span><span class="op" id="7447413">,</span>&nbsp;<span class="ident" id="7447415"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7447425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447429"><a href="/crypto/tls/handshake_server_test.go.html#7447398">cli</a></span><span class="op" id="7447432">.</span><span class="ident" id="7447433">vers</span>&nbsp;<span class="op" id="7447438">=</span>&nbsp;<span class="ident" id="7447440"><a href="/crypto/tls/handshake_server_test.go.html#7446773">clientHello</a></span><span class="op" id="7447451">.</span><span class="ident" id="7447452">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447459"><a href="/crypto/tls/handshake_server_test.go.html#7447398">cli</a></span><span class="op" id="7447462">.</span><span class="ident" id="7447463">writeRecord</span><span class="op" id="7447474">(</span><span class="ident" id="7447475"><a href="/crypto/tls/common.go.html#3823354">recordTypeHandshake</a></span><span class="op" id="7447494">,</span>&nbsp;<span class="ident" id="7447496"><a href="/crypto/tls/handshake_server_test.go.html#7446773">clientHello</a></span><span class="op" id="7447507">.</span><span class="ident" id="7447508">marshal</span><span class="op" id="7447515">(</span><span class="op" id="7447516">)</span><span class="op" id="7447517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447521"><a href="/crypto/tls/handshake_server_test.go.html#7447344">reply</a></span><span class="op" id="7447526">,</span>&nbsp;<span class="ident" id="7447528"><a href="/crypto/tls/handshake_server_test.go.html#7447367">clientErr</a></span>&nbsp;<span class="op" id="7447538">=</span>&nbsp;<span class="ident" id="7447540"><a href="/crypto/tls/handshake_server_test.go.html#7447398">cli</a></span><span class="op" id="7447543">.</span><span class="ident" id="7447544">readHandshake</span><span class="op" id="7447557">(</span><span class="op" id="7447558">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447562"><a href="/crypto/tls/handshake_server_test.go.html#7447320">c</a></span><span class="op" id="7447563">.</span><span class="ident" id="7447564">Close</span><span class="op" id="7447569">(</span><span class="op" id="7447570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447573">}</span><span class="op" id="7447574">(</span><span class="op" id="7447575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447578">config</span>&nbsp;<span class="op" id="7447585">:=</span>&nbsp;<span class="op" id="7447588">*</span><span class="ident" id="7447589"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447601"><a href="/crypto/tls/handshake_server_test.go.html#7447578">config</a></span><span class="op" id="7447607">.</span><span class="ident" id="7447608">CipherSuites</span>&nbsp;<span class="op" id="7447621">=</span>&nbsp;<span class="ident" id="7447623"><a href="/crypto/tls/handshake_server_test.go.html#7446773">clientHello</a></span><span class="op" id="7447634">.</span><span class="ident" id="7447635">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447649"><a href="/crypto/tls/tls.go.html#3964076">Server</a></span><span class="op" id="7447655">(</span><span class="ident" id="7447656"><a href="/crypto/tls/handshake_server_test.go.html#7447323">s</a></span><span class="op" id="7447657">,</span>&nbsp;<span class="op" id="7447659">&amp;</span><span class="ident" id="7447660"><a href="/crypto/tls/handshake_server_test.go.html#7447578">config</a></span><span class="op" id="7447666">)</span><span class="op" id="7447667">.</span><span class="ident" id="7447668">Handshake</span><span class="op" id="7447677">(</span><span class="op" id="7447678">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447681"><a href="/crypto/tls/handshake_server_test.go.html#7447323">s</a></span><span class="op" id="7447682">.</span><span class="ident" id="7447683">Close</span><span class="op" id="7447688">(</span><span class="op" id="7447689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7447692">if</span>&nbsp;<span class="ident" id="7447695"><a href="/crypto/tls/handshake_server_test.go.html#7447367">clientErr</a></span>&nbsp;<span class="op" id="7447705">!=</span>&nbsp;<span class="ident" id="7447708">nil</span>&nbsp;<span class="op" id="7447712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447716"><a href="/crypto/tls/handshake_server_test.go.html#7446629">t</a></span><span class="op" id="7447717">.</span><span class="ident" id="7447718">Fatal</span><span class="op" id="7447723">(</span><span class="ident" id="7447724"><a href="/crypto/tls/handshake_server_test.go.html#7447367">clientErr</a></span><span class="op" id="7447733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447739">serverHello</span><span class="op" id="7447750">,</span>&nbsp;<span class="ident" id="7447752">ok</span>&nbsp;<span class="op" id="7447755">:=</span>&nbsp;<span class="ident" id="7447758"><a href="/crypto/tls/handshake_server_test.go.html#7447344">reply</a></span><span class="op" id="7447763">.</span><span class="op" id="7447764">(</span><span class="op" id="7447765">*</span><span class="ident" id="7447766"><a href="/crypto/tls/handshake_messages.go.html#3899714">serverHelloMsg</a></span><span class="op" id="7447780">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7447783">if</span>&nbsp;<span class="op" id="7447786">!</span><span class="ident" id="7447787"><a href="/crypto/tls/handshake_server_test.go.html#7447752">ok</a></span>&nbsp;<span class="op" id="7447790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447794"><a href="/crypto/tls/handshake_server_test.go.html#7446629">t</a></span><span class="op" id="7447795">.</span><span class="ident" id="7447796">Fatalf</span><span class="op" id="7447802">(</span><span class="string" id="7447803">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="7447854">,</span>&nbsp;<span class="ident" id="7447856"><a href="/crypto/tls/handshake_server_test.go.html#7447344">reply</a></span><span class="op" id="7447861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7447867">if</span>&nbsp;<span class="ident" id="7447870">s</span>&nbsp;<span class="op" id="7447872">:=</span>&nbsp;<span class="ident" id="7447875"><a href="/crypto/tls/handshake_server_test.go.html#7447739">serverHello</a></span><span class="op" id="7447886">.</span><span class="ident" id="7447887">cipherSuite</span><span class="op" id="7447898">;</span>&nbsp;<span class="ident" id="7447900"><a href="/crypto/tls/handshake_server_test.go.html#7447870">s</a></span>&nbsp;<span class="op" id="7447902">!=</span>&nbsp;<span class="ident" id="7447905"><a href="/crypto/tls/cipher_suites.go.html#3821503">TLS_RSA_WITH_RC4_128_SHA</a></span>&nbsp;<span class="op" id="7447930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447934"><a href="/crypto/tls/handshake_server_test.go.html#7446629">t</a></span><span class="op" id="7447935">.</span><span class="ident" id="7447936">Fatalf</span><span class="op" id="7447942">(</span><span class="string" id="7447943">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="7447977">,</span>&nbsp;<span class="ident" id="7447979"><a href="/crypto/tls/handshake_server_test.go.html#7447870">s</a></span><span class="op" id="7447980">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447983">}</span><br>
<span class="lineno"></span><span class="op" id="7447985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7447988">func</span>&nbsp;<span class="ident" id="7447993">TestAlertForwarding</span><span class="op" id="7448012">(</span><span class="ident" id="7448013">t</span>&nbsp;<span class="op" id="7448015">*</span><span class="ident" id="7448016"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7448023">.</span><span class="ident" id="7448024">T</span><span class="op" id="7448025">)</span>&nbsp;<span class="op" id="7448027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448030">c</span><span class="op" id="7448031">,</span>&nbsp;<span class="ident" id="7448033">s</span>&nbsp;<span class="op" id="7448035">:=</span>&nbsp;<span class="ident" id="7448038"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7448041">.</span><span class="ident" id="7448042">Pipe</span><span class="op" id="7448046">(</span><span class="op" id="7448047">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448050">go</span>&nbsp;<span class="keyword" id="7448053">func</span><span class="op" id="7448057">(</span><span class="op" id="7448058">)</span>&nbsp;<span class="op" id="7448060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448064"><a href="/crypto/tls/tls.go.html#3964368">Client</a></span><span class="op" id="7448070">(</span><span class="ident" id="7448071"><a href="/crypto/tls/handshake_server_test.go.html#7448030">c</a></span><span class="op" id="7448072">,</span>&nbsp;<span class="ident" id="7448074"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7448084">)</span><span class="op" id="7448085">.</span><span class="ident" id="7448086">sendAlert</span><span class="op" id="7448095">(</span><span class="ident" id="7448096"><a href="/crypto/tls/alert.go.html#3811108">alertUnknownCA</a></span><span class="op" id="7448110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448114"><a href="/crypto/tls/handshake_server_test.go.html#7448030">c</a></span><span class="op" id="7448115">.</span><span class="ident" id="7448116">Close</span><span class="op" id="7448121">(</span><span class="op" id="7448122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7448125">}</span><span class="op" id="7448126">(</span><span class="op" id="7448127">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448131">err</span>&nbsp;<span class="op" id="7448135">:=</span>&nbsp;<span class="ident" id="7448138"><a href="/crypto/tls/tls.go.html#3964076">Server</a></span><span class="op" id="7448144">(</span><span class="ident" id="7448145"><a href="/crypto/tls/handshake_server_test.go.html#7448033">s</a></span><span class="op" id="7448146">,</span>&nbsp;<span class="ident" id="7448148"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7448158">)</span><span class="op" id="7448159">.</span><span class="ident" id="7448160">Handshake</span><span class="op" id="7448169">(</span><span class="op" id="7448170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448173"><a href="/crypto/tls/handshake_server_test.go.html#7448033">s</a></span><span class="op" id="7448174">.</span><span class="ident" id="7448175">Close</span><span class="op" id="7448180">(</span><span class="op" id="7448181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448184">if</span>&nbsp;<span class="ident" id="7448187">e</span><span class="op" id="7448188">,</span>&nbsp;<span class="ident" id="7448190">ok</span>&nbsp;<span class="op" id="7448193">:=</span>&nbsp;<span class="ident" id="7448196"><a href="/crypto/tls/handshake_server_test.go.html#7448131">err</a></span><span class="op" id="7448199">.</span><span class="op" id="7448200">(</span><span class="op" id="7448201">*</span><span class="ident" id="7448202"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7448205">.</span><span class="ident" id="7448206">OpError</span><span class="op" id="7448213">)</span><span class="op" id="7448214">;</span>&nbsp;<span class="op" id="7448216">!</span><span class="ident" id="7448217"><a href="/crypto/tls/handshake_server_test.go.html#7448190">ok</a></span>&nbsp;<span class="op" id="7448220">||</span>&nbsp;<span class="ident" id="7448223"><a href="/crypto/tls/handshake_server_test.go.html#7448187">e</a></span><span class="op" id="7448224">.</span><span class="ident" id="7448225">Err</span>&nbsp;<span class="op" id="7448229">!=</span>&nbsp;<span class="builtintype" id="7448232">error</span><span class="op" id="7448237">(</span><span class="ident" id="7448238"><a href="/crypto/tls/alert.go.html#3811108">alertUnknownCA</a></span><span class="op" id="7448252">)</span>&nbsp;<span class="op" id="7448254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448258"><a href="/crypto/tls/handshake_server_test.go.html#7448013">t</a></span><span class="op" id="7448259">.</span><span class="ident" id="7448260">Errorf</span><span class="op" id="7448266">(</span><span class="string" id="7448267">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7448296">,</span>&nbsp;<span class="ident" id="7448298"><a href="/crypto/tls/handshake_server_test.go.html#7448131">err</a></span><span class="op" id="7448301">,</span>&nbsp;<span class="builtintype" id="7448303">error</span><span class="op" id="7448308">(</span><span class="ident" id="7448309"><a href="/crypto/tls/alert.go.html#3811108">alertUnknownCA</a></span><span class="op" id="7448323">)</span><span class="op" id="7448324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7448327">}</span><br>
<span class="lineno">165</span><span class="op" id="7448329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7448332">func</span>&nbsp;<span class="ident" id="7448337">TestClose</span><span class="op" id="7448346">(</span><span class="ident" id="7448347">t</span>&nbsp;<span class="op" id="7448349">*</span><span class="ident" id="7448350"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7448357">.</span><span class="ident" id="7448358">T</span><span class="op" id="7448359">)</span>&nbsp;<span class="op" id="7448361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448364">c</span><span class="op" id="7448365">,</span>&nbsp;<span class="ident" id="7448367">s</span>&nbsp;<span class="op" id="7448369">:=</span>&nbsp;<span class="ident" id="7448372"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7448375">.</span><span class="ident" id="7448376">Pipe</span><span class="op" id="7448380">(</span><span class="op" id="7448381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448384">go</span>&nbsp;<span class="ident" id="7448387"><a href="/crypto/tls/handshake_server_test.go.html#7448364">c</a></span><span class="op" id="7448388">.</span><span class="ident" id="7448389">Close</span><span class="op" id="7448394">(</span><span class="op" id="7448395">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448399">err</span>&nbsp;<span class="op" id="7448403">:=</span>&nbsp;<span class="ident" id="7448406"><a href="/crypto/tls/tls.go.html#3964076">Server</a></span><span class="op" id="7448412">(</span><span class="ident" id="7448413"><a href="/crypto/tls/handshake_server_test.go.html#7448367">s</a></span><span class="op" id="7448414">,</span>&nbsp;<span class="ident" id="7448416"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7448426">)</span><span class="op" id="7448427">.</span><span class="ident" id="7448428">Handshake</span><span class="op" id="7448437">(</span><span class="op" id="7448438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448441"><a href="/crypto/tls/handshake_server_test.go.html#7448367">s</a></span><span class="op" id="7448442">.</span><span class="ident" id="7448443">Close</span><span class="op" id="7448448">(</span><span class="op" id="7448449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448452">if</span>&nbsp;<span class="ident" id="7448455"><a href="/crypto/tls/handshake_server_test.go.html#7448399">err</a></span>&nbsp;<span class="op" id="7448459">!=</span>&nbsp;<span class="ident" id="7448462"><a href="/crypto/tls/handshake_server_test.go.html#7444100">io</a></span><span class="op" id="7448464">.</span><span class="ident" id="7448465">EOF</span>&nbsp;<span class="op" id="7448469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448473"><a href="/crypto/tls/handshake_server_test.go.html#7448347">t</a></span><span class="op" id="7448474">.</span><span class="ident" id="7448475">Errorf</span><span class="op" id="7448481">(</span><span class="string" id="7448482">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7448511">,</span>&nbsp;<span class="ident" id="7448513"><a href="/crypto/tls/handshake_server_test.go.html#7448399">err</a></span><span class="op" id="7448516">,</span>&nbsp;<span class="ident" id="7448518"><a href="/crypto/tls/handshake_server_test.go.html#7444100">io</a></span><span class="op" id="7448520">.</span><span class="ident" id="7448521">EOF</span><span class="op" id="7448524">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7448527">}</span><br>
<span class="lineno"></span><span class="op" id="7448529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7448532">func</span>&nbsp;<span class="ident" id="7448537">testHandshake</span><span class="op" id="7448550">(</span><span class="ident" id="7448551">clientConfig</span><span class="op" id="7448563">,</span>&nbsp;<span class="ident" id="7448565">serverConfig</span>&nbsp;<span class="op" id="7448578">*</span><span class="ident" id="7448579"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="7448585">)</span>&nbsp;<span class="op" id="7448587">(</span><span class="ident" id="7448588">state</span>&nbsp;<span class="ident" id="7448594"><a href="/crypto/tls/common.go.html#3826826">ConnectionState</a></span><span class="op" id="7448609">,</span>&nbsp;<span class="ident" id="7448611">err</span>&nbsp;<span class="builtintype" id="7448615">error</span><span class="op" id="7448620">)</span>&nbsp;<span class="op" id="7448622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448625">c</span><span class="op" id="7448626">,</span>&nbsp;<span class="ident" id="7448628">s</span>&nbsp;<span class="op" id="7448630">:=</span>&nbsp;<span class="ident" id="7448633"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7448636">.</span><span class="ident" id="7448637">Pipe</span><span class="op" id="7448641">(</span><span class="op" id="7448642">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448645">done</span>&nbsp;<span class="op" id="7448650">:=</span>&nbsp;<span class="builtinfunc" id="7448653">make</span><span class="op" id="7448657">(</span><span class="keyword" id="7448658">chan</span>&nbsp;<span class="builtintype" id="7448663">bool</span><span class="op" id="7448667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448670">go</span>&nbsp;<span class="keyword" id="7448673">func</span><span class="op" id="7448677">(</span><span class="op" id="7448678">)</span>&nbsp;<span class="op" id="7448680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448684">cli</span>&nbsp;<span class="op" id="7448688">:=</span>&nbsp;<span class="ident" id="7448691"><a href="/crypto/tls/tls.go.html#3964368">Client</a></span><span class="op" id="7448697">(</span><span class="ident" id="7448698"><a href="/crypto/tls/handshake_server_test.go.html#7448625">c</a></span><span class="op" id="7448699">,</span>&nbsp;<span class="ident" id="7448701"><a href="/crypto/tls/handshake_server_test.go.html#7448551">clientConfig</a></span><span class="op" id="7448713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448717"><a href="/crypto/tls/handshake_server_test.go.html#7448684">cli</a></span><span class="op" id="7448720">.</span><span class="ident" id="7448721">Handshake</span><span class="op" id="7448730">(</span><span class="op" id="7448731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448735"><a href="/crypto/tls/handshake_server_test.go.html#7448625">c</a></span><span class="op" id="7448736">.</span><span class="ident" id="7448737">Close</span><span class="op" id="7448742">(</span><span class="op" id="7448743">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448747"><a href="/crypto/tls/handshake_server_test.go.html#7448645">done</a></span>&nbsp;<span class="op" id="7448752">&lt;-</span>&nbsp;<span class="builtintype" id="7448755">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7448761">}</span><span class="op" id="7448762">(</span><span class="op" id="7448763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448766">server</span>&nbsp;<span class="op" id="7448773">:=</span>&nbsp;<span class="ident" id="7448776"><a href="/crypto/tls/tls.go.html#3964076">Server</a></span><span class="op" id="7448782">(</span><span class="ident" id="7448783"><a href="/crypto/tls/handshake_server_test.go.html#7448628">s</a></span><span class="op" id="7448784">,</span>&nbsp;<span class="ident" id="7448786"><a href="/crypto/tls/handshake_server_test.go.html#7448565">serverConfig</a></span><span class="op" id="7448798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448801"><a href="/crypto/tls/handshake_server_test.go.html#7448611">err</a></span>&nbsp;<span class="op" id="7448805">=</span>&nbsp;<span class="ident" id="7448807"><a href="/crypto/tls/handshake_server_test.go.html#7448766">server</a></span><span class="op" id="7448813">.</span><span class="ident" id="7448814">Handshake</span><span class="op" id="7448823">(</span><span class="op" id="7448824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448827">if</span>&nbsp;<span class="ident" id="7448830"><a href="/crypto/tls/handshake_server_test.go.html#7448611">err</a></span>&nbsp;<span class="op" id="7448834">==</span>&nbsp;<span class="ident" id="7448837">nil</span>&nbsp;<span class="op" id="7448841">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448845"><a href="/crypto/tls/handshake_server_test.go.html#7448588">state</a></span>&nbsp;<span class="op" id="7448851">=</span>&nbsp;<span class="ident" id="7448853"><a href="/crypto/tls/handshake_server_test.go.html#7448766">server</a></span><span class="op" id="7448859">.</span><span class="ident" id="7448860">ConnectionState</span><span class="op" id="7448875">(</span><span class="op" id="7448876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7448879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448882"><a href="/crypto/tls/handshake_server_test.go.html#7448628">s</a></span><span class="op" id="7448883">.</span><span class="ident" id="7448884">Close</span><span class="op" id="7448889">(</span><span class="op" id="7448890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7448893">&lt;-</span><span class="ident" id="7448895"><a href="/crypto/tls/handshake_server_test.go.html#7448645">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448901">return</span><br>
<span class="lineno">195</span><span class="op" id="7448908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7448911">func</span>&nbsp;<span class="ident" id="7448916">TestVersion</span><span class="op" id="7448927">(</span><span class="ident" id="7448928">t</span>&nbsp;<span class="op" id="7448930">*</span><span class="ident" id="7448931"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7448938">.</span><span class="ident" id="7448939">T</span><span class="op" id="7448940">)</span>&nbsp;<span class="op" id="7448942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448945">serverConfig</span>&nbsp;<span class="op" id="7448958">:=</span>&nbsp;<span class="op" id="7448961">&amp;</span><span class="ident" id="7448962"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="7448968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448972">Certificates</span><span class="op" id="7448984">:</span>&nbsp;<span class="ident" id="7448986"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7448996">.</span><span class="ident" id="7448997">Certificates</span><span class="op" id="7449009">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449013">MaxVersion</span><span class="op" id="7449023">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7449027"><a href="/crypto/tls/common.go.html#3822818">VersionTLS11</a></span><span class="op" id="7449039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449045">clientConfig</span>&nbsp;<span class="op" id="7449058">:=</span>&nbsp;<span class="op" id="7449061">&amp;</span><span class="ident" id="7449062"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="7449068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449072">InsecureSkipVerify</span><span class="op" id="7449090">:</span>&nbsp;<span class="builtintype" id="7449092">true</span><span class="op" id="7449096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449099">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449102">state</span><span class="op" id="7449107">,</span>&nbsp;<span class="ident" id="7449109">err</span>&nbsp;<span class="op" id="7449113">:=</span>&nbsp;<span class="ident" id="7449116"><a href="/crypto/tls/handshake_server_test.go.html#7448537">testHandshake</a></span><span class="op" id="7449129">(</span><span class="ident" id="7449130"><a href="/crypto/tls/handshake_server_test.go.html#7449045">clientConfig</a></span><span class="op" id="7449142">,</span>&nbsp;<span class="ident" id="7449144"><a href="/crypto/tls/handshake_server_test.go.html#7448945">serverConfig</a></span><span class="op" id="7449156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7449159">if</span>&nbsp;<span class="ident" id="7449162"><a href="/crypto/tls/handshake_server_test.go.html#7449109">err</a></span>&nbsp;<span class="op" id="7449166">!=</span>&nbsp;<span class="ident" id="7449169">nil</span>&nbsp;<span class="op" id="7449173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449177"><a href="/crypto/tls/handshake_server_test.go.html#7448928">t</a></span><span class="op" id="7449178">.</span><span class="ident" id="7449179">Fatalf</span><span class="op" id="7449185">(</span><span class="string" id="7449186">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7449208">,</span>&nbsp;<span class="ident" id="7449210"><a href="/crypto/tls/handshake_server_test.go.html#7449109">err</a></span><span class="op" id="7449213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7449219">if</span>&nbsp;<span class="ident" id="7449222"><a href="/crypto/tls/handshake_server_test.go.html#7449102">state</a></span><span class="op" id="7449227">.</span><span class="ident" id="7449228">Version</span>&nbsp;<span class="op" id="7449236">!=</span>&nbsp;<span class="ident" id="7449239"><a href="/crypto/tls/common.go.html#3822818">VersionTLS11</a></span>&nbsp;<span class="op" id="7449252">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449256"><a href="/crypto/tls/handshake_server_test.go.html#7448928">t</a></span><span class="op" id="7449257">.</span><span class="ident" id="7449258">Fatalf</span><span class="op" id="7449264">(</span><span class="string" id="7449265">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="7449301">,</span>&nbsp;<span class="ident" id="7449303"><a href="/crypto/tls/handshake_server_test.go.html#7449102">state</a></span><span class="op" id="7449308">.</span><span class="ident" id="7449309">Version</span><span class="op" id="7449316">,</span>&nbsp;<span class="ident" id="7449318"><a href="/crypto/tls/common.go.html#3822818">VersionTLS11</a></span><span class="op" id="7449330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449333">}</span><br>
<span class="lineno"></span><span class="op" id="7449335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7449338">func</span>&nbsp;<span class="ident" id="7449343">TestCipherSuitePreference</span><span class="op" id="7449368">(</span><span class="ident" id="7449369">t</span>&nbsp;<span class="op" id="7449371">*</span><span class="ident" id="7449372"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7449379">.</span><span class="ident" id="7449380">T</span><span class="op" id="7449381">)</span>&nbsp;<span class="op" id="7449383">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449386">serverConfig</span>&nbsp;<span class="op" id="7449399">:=</span>&nbsp;<span class="op" id="7449402">&amp;</span><span class="ident" id="7449403"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="7449409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449413">CipherSuites</span><span class="op" id="7449425">:</span>&nbsp;<span class="op" id="7449427">[</span><span class="op" id="7449428">]</span><span class="builtintype" id="7449429">uint16</span><span class="op" id="7449435">{</span><span class="ident" id="7449436"><a href="/crypto/tls/cipher_suites.go.html#3821503">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7449460">,</span>&nbsp;<span class="ident" id="7449462"><a href="/crypto/tls/cipher_suites.go.html#3821617">TLS_RSA_WITH_AES_128_CBC_SHA</a></span><span class="op" id="7449490">,</span>&nbsp;<span class="ident" id="7449492"><a href="/crypto/tls/cipher_suites.go.html#3821902">TLS_ECDHE_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7449522">}</span><span class="op" id="7449523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449527">Certificates</span><span class="op" id="7449539">:</span>&nbsp;<span class="ident" id="7449541"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7449551">.</span><span class="ident" id="7449552">Certificates</span><span class="op" id="7449564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449568">MaxVersion</span><span class="op" id="7449578">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7449582"><a href="/crypto/tls/common.go.html#3822818">VersionTLS11</a></span><span class="op" id="7449594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449597">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449600">clientConfig</span>&nbsp;<span class="op" id="7449613">:=</span>&nbsp;<span class="op" id="7449616">&amp;</span><span class="ident" id="7449617"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="7449623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449627">CipherSuites</span><span class="op" id="7449639">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7449647">[</span><span class="op" id="7449648">]</span><span class="builtintype" id="7449649">uint16</span><span class="op" id="7449655">{</span><span class="ident" id="7449656"><a href="/crypto/tls/cipher_suites.go.html#3821617">TLS_RSA_WITH_AES_128_CBC_SHA</a></span><span class="op" id="7449684">,</span>&nbsp;<span class="ident" id="7449686"><a href="/crypto/tls/cipher_suites.go.html#3821503">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7449710">}</span><span class="op" id="7449711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449715">InsecureSkipVerify</span><span class="op" id="7449733">:</span>&nbsp;<span class="builtintype" id="7449735">true</span><span class="op" id="7449739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449745">state</span><span class="op" id="7449750">,</span>&nbsp;<span class="ident" id="7449752">err</span>&nbsp;<span class="op" id="7449756">:=</span>&nbsp;<span class="ident" id="7449759"><a href="/crypto/tls/handshake_server_test.go.html#7448537">testHandshake</a></span><span class="op" id="7449772">(</span><span class="ident" id="7449773"><a href="/crypto/tls/handshake_server_test.go.html#7449600">clientConfig</a></span><span class="op" id="7449785">,</span>&nbsp;<span class="ident" id="7449787"><a href="/crypto/tls/handshake_server_test.go.html#7449386">serverConfig</a></span><span class="op" id="7449799">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7449802">if</span>&nbsp;<span class="ident" id="7449805"><a href="/crypto/tls/handshake_server_test.go.html#7449752">err</a></span>&nbsp;<span class="op" id="7449809">!=</span>&nbsp;<span class="ident" id="7449812">nil</span>&nbsp;<span class="op" id="7449816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449820"><a href="/crypto/tls/handshake_server_test.go.html#7449369">t</a></span><span class="op" id="7449821">.</span><span class="ident" id="7449822">Fatalf</span><span class="op" id="7449828">(</span><span class="string" id="7449829">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7449851">,</span>&nbsp;<span class="ident" id="7449853"><a href="/crypto/tls/handshake_server_test.go.html#7449752">err</a></span><span class="op" id="7449856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7449862">if</span>&nbsp;<span class="ident" id="7449865"><a href="/crypto/tls/handshake_server_test.go.html#7449745">state</a></span><span class="op" id="7449870">.</span><span class="ident" id="7449871">CipherSuite</span>&nbsp;<span class="op" id="7449883">!=</span>&nbsp;<span class="ident" id="7449886"><a href="/crypto/tls/cipher_suites.go.html#3821617">TLS_RSA_WITH_AES_128_CBC_SHA</a></span>&nbsp;<span class="op" id="7449915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7449919">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449982"><a href="/crypto/tls/handshake_server_test.go.html#7449369">t</a></span><span class="op" id="7449983">.</span><span class="ident" id="7449984">Fatalf</span><span class="op" id="7449990">(</span><span class="string" id="7449991">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7450033">,</span>&nbsp;<span class="ident" id="7450035"><a href="/crypto/tls/handshake_server_test.go.html#7449745">state</a></span><span class="op" id="7450040">.</span><span class="ident" id="7450041">CipherSuite</span><span class="op" id="7450052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450059"><a href="/crypto/tls/handshake_server_test.go.html#7449386">serverConfig</a></span><span class="op" id="7450071">.</span><span class="ident" id="7450072">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7450097">=</span>&nbsp;<span class="builtintype" id="7450099">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450105"><a href="/crypto/tls/handshake_server_test.go.html#7449745">state</a></span><span class="op" id="7450110">,</span>&nbsp;<span class="ident" id="7450112"><a href="/crypto/tls/handshake_server_test.go.html#7449752">err</a></span>&nbsp;<span class="op" id="7450116">=</span>&nbsp;<span class="ident" id="7450118"><a href="/crypto/tls/handshake_server_test.go.html#7448537">testHandshake</a></span><span class="op" id="7450131">(</span><span class="ident" id="7450132"><a href="/crypto/tls/handshake_server_test.go.html#7449600">clientConfig</a></span><span class="op" id="7450144">,</span>&nbsp;<span class="ident" id="7450146"><a href="/crypto/tls/handshake_server_test.go.html#7449386">serverConfig</a></span><span class="op" id="7450158">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7450161">if</span>&nbsp;<span class="ident" id="7450164"><a href="/crypto/tls/handshake_server_test.go.html#7449752">err</a></span>&nbsp;<span class="op" id="7450168">!=</span>&nbsp;<span class="ident" id="7450171">nil</span>&nbsp;<span class="op" id="7450175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450179"><a href="/crypto/tls/handshake_server_test.go.html#7449369">t</a></span><span class="op" id="7450180">.</span><span class="ident" id="7450181">Fatalf</span><span class="op" id="7450187">(</span><span class="string" id="7450188">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7450210">,</span>&nbsp;<span class="ident" id="7450212"><a href="/crypto/tls/handshake_server_test.go.html#7449752">err</a></span><span class="op" id="7450215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7450221">if</span>&nbsp;<span class="ident" id="7450224"><a href="/crypto/tls/handshake_server_test.go.html#7449745">state</a></span><span class="op" id="7450229">.</span><span class="ident" id="7450230">CipherSuite</span>&nbsp;<span class="op" id="7450242">!=</span>&nbsp;<span class="ident" id="7450245"><a href="/crypto/tls/cipher_suites.go.html#3821503">TLS_RSA_WITH_RC4_128_SHA</a></span>&nbsp;<span class="op" id="7450270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450274"><a href="/crypto/tls/handshake_server_test.go.html#7449369">t</a></span><span class="op" id="7450275">.</span><span class="ident" id="7450276">Fatalf</span><span class="op" id="7450282">(</span><span class="string" id="7450283">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7450325">,</span>&nbsp;<span class="ident" id="7450327"><a href="/crypto/tls/handshake_server_test.go.html#7449745">state</a></span><span class="op" id="7450332">.</span><span class="ident" id="7450333">CipherSuite</span><span class="op" id="7450344">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450347">}</span><br>
<span class="lineno"></span><span class="op" id="7450349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7450352">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7450427">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="7450443">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7450523">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7450542">type</span>&nbsp;<span class="ident" id="7450547">serverTest</span>&nbsp;<span class="keyword" id="7450558">struct</span>&nbsp;<span class="op" id="7450565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7450568">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7450641">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450682">name</span>&nbsp;<span class="builtintype" id="7450687">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7450695">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7450761">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450806">command</span>&nbsp;<span class="op" id="7450814">[</span><span class="op" id="7450815">]</span><span class="builtintype" id="7450816">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7450824">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7450888">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450922">expectedPeerCerts</span>&nbsp;<span class="op" id="7450940">[</span><span class="op" id="7450941">]</span><span class="builtintype" id="7450942">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7450950">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451021">config</span>&nbsp;<span class="op" id="7451028">*</span><span class="ident" id="7451029"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7451037">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7451111">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451149">expectAlert</span>&nbsp;<span class="builtintype" id="7451161">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7451167">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7451236">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451308">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="7451338">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7451346">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7451415">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7451488">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451525">validate</span>&nbsp;<span class="keyword" id="7451534">func</span><span class="op" id="7451538">(</span><span class="ident" id="7451539"><a href="/crypto/tls/common.go.html#3826826">ConnectionState</a></span><span class="op" id="7451554">)</span>&nbsp;<span class="builtintype" id="7451556">error</span><br>
<span class="lineno">270</span><span class="op" id="7451562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7451565">var</span>&nbsp;<span class="ident" id="7451569">defaultClientCommand</span>&nbsp;<span class="op" id="7451590">=</span>&nbsp;<span class="op" id="7451592">[</span><span class="op" id="7451593">]</span><span class="builtintype" id="7451594">string</span><span class="op" id="7451600">{</span><span class="string" id="7451601">&#34;openssl&#34;</span><span class="op" id="7451610">,</span>&nbsp;<span class="string" id="7451612">&#34;s_client&#34;</span><span class="op" id="7451622">,</span>&nbsp;<span class="string" id="7451624">&#34;-no_ticket&#34;</span><span class="op" id="7451636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7451639">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="7451715">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7451795">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="7451810">func</span>&nbsp;<span class="op" id="7451815">(</span><span class="ident" id="7451816">test</span>&nbsp;<span class="op" id="7451821">*</span><span class="ident" id="7451822"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7451832">)</span>&nbsp;<span class="ident" id="7451834">connFromCommand</span><span class="op" id="7451849">(</span><span class="op" id="7451850">)</span>&nbsp;<span class="op" id="7451852">(</span><span class="ident" id="7451853">conn</span>&nbsp;<span class="op" id="7451858">*</span><span class="ident" id="7451859"><a href="/crypto/tls/handshake_test.go.html#7476292">recordingConn</a></span><span class="op" id="7451872">,</span>&nbsp;<span class="ident" id="7451874">child</span>&nbsp;<span class="op" id="7451880">*</span><span class="ident" id="7451881"><a href="/crypto/tls/handshake_server_test.go.html#7444131">exec</a></span><span class="op" id="7451885">.</span><span class="ident" id="7451886">Cmd</span><span class="op" id="7451889">,</span>&nbsp;<span class="ident" id="7451891">err</span>&nbsp;<span class="builtintype" id="7451895">error</span><span class="op" id="7451900">)</span>&nbsp;<span class="op" id="7451902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451905">l</span><span class="op" id="7451906">,</span>&nbsp;<span class="ident" id="7451908"><a href="/crypto/tls/handshake_server_test.go.html#7451891">err</a></span>&nbsp;<span class="op" id="7451912">:=</span>&nbsp;<span class="ident" id="7451915"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7451918">.</span><span class="ident" id="7451919">ListenTCP</span><span class="op" id="7451928">(</span><span class="string" id="7451929">&#34;tcp&#34;</span><span class="op" id="7451934">,</span>&nbsp;<span class="op" id="7451936">&amp;</span><span class="ident" id="7451937"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7451940">.</span><span class="ident" id="7451941">TCPAddr</span><span class="op" id="7451948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451952">IP</span><span class="op" id="7451954">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7451958"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7451961">.</span><span class="ident" id="7451962">IPv4</span><span class="op" id="7451966">(</span><span class="num" id="7451967">127</span><span class="op" id="7451970">,</span>&nbsp;<span class="num" id="7451972">0</span><span class="op" id="7451973">,</span>&nbsp;<span class="num" id="7451975">0</span><span class="op" id="7451976">,</span>&nbsp;<span class="num" id="7451978">1</span><span class="op" id="7451979">)</span><span class="op" id="7451980">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451984">Port</span><span class="op" id="7451988">:</span>&nbsp;<span class="num" id="7451990">0</span><span class="op" id="7451991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451994">}</span><span class="op" id="7451995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7451998">if</span>&nbsp;<span class="ident" id="7452001"><a href="/crypto/tls/handshake_server_test.go.html#7451891">err</a></span>&nbsp;<span class="op" id="7452005">!=</span>&nbsp;<span class="ident" id="7452008">nil</span>&nbsp;<span class="op" id="7452012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452016">return</span>&nbsp;<span class="ident" id="7452023">nil</span><span class="op" id="7452026">,</span>&nbsp;<span class="ident" id="7452028">nil</span><span class="op" id="7452031">,</span>&nbsp;<span class="ident" id="7452033"><a href="/crypto/tls/handshake_server_test.go.html#7451891">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452038">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452041">defer</span>&nbsp;<span class="ident" id="7452047"><a href="/crypto/tls/handshake_server_test.go.html#7451905">l</a></span><span class="op" id="7452048">.</span><span class="ident" id="7452049">Close</span><span class="op" id="7452054">(</span><span class="op" id="7452055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452059">port</span>&nbsp;<span class="op" id="7452064">:=</span>&nbsp;<span class="ident" id="7452067"><a href="/crypto/tls/handshake_server_test.go.html#7451905">l</a></span><span class="op" id="7452068">.</span><span class="ident" id="7452069">Addr</span><span class="op" id="7452073">(</span><span class="op" id="7452074">)</span><span class="op" id="7452075">.</span><span class="op" id="7452076">(</span><span class="op" id="7452077">*</span><span class="ident" id="7452078"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7452081">.</span><span class="ident" id="7452082">TCPAddr</span><span class="op" id="7452089">)</span><span class="op" id="7452090">.</span><span class="ident" id="7452091">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452098">var</span>&nbsp;<span class="ident" id="7452102">command</span>&nbsp;<span class="op" id="7452110">[</span><span class="op" id="7452111">]</span><span class="builtintype" id="7452112">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452120"><a href="/crypto/tls/handshake_server_test.go.html#7452102">command</a></span>&nbsp;<span class="op" id="7452128">=</span>&nbsp;<span class="builtinfunc" id="7452130">append</span><span class="op" id="7452136">(</span><span class="ident" id="7452137"><a href="/crypto/tls/handshake_server_test.go.html#7452102">command</a></span><span class="op" id="7452144">,</span>&nbsp;<span class="ident" id="7452146"><a href="/crypto/tls/handshake_server_test.go.html#7451816">test</a></span><span class="op" id="7452150">.</span><span class="ident" id="7452151">command</span><span class="op" id="7452158">...</span><span class="op" id="7452161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452164">if</span>&nbsp;<span class="builtinfunc" id="7452167">len</span><span class="op" id="7452170">(</span><span class="ident" id="7452171"><a href="/crypto/tls/handshake_server_test.go.html#7452102">command</a></span><span class="op" id="7452178">)</span>&nbsp;<span class="op" id="7452180">==</span>&nbsp;<span class="num" id="7452183">0</span>&nbsp;<span class="op" id="7452185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452189"><a href="/crypto/tls/handshake_server_test.go.html#7452102">command</a></span>&nbsp;<span class="op" id="7452197">=</span>&nbsp;<span class="ident" id="7452199"><a href="/crypto/tls/handshake_server_test.go.html#7451569">defaultClientCommand</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452224"><a href="/crypto/tls/handshake_server_test.go.html#7452102">command</a></span>&nbsp;<span class="op" id="7452232">=</span>&nbsp;<span class="builtinfunc" id="7452234">append</span><span class="op" id="7452240">(</span><span class="ident" id="7452241"><a href="/crypto/tls/handshake_server_test.go.html#7452102">command</a></span><span class="op" id="7452248">,</span>&nbsp;<span class="string" id="7452250">&#34;-connect&#34;</span><span class="op" id="7452260">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452263"><a href="/crypto/tls/handshake_server_test.go.html#7452102">command</a></span>&nbsp;<span class="op" id="7452271">=</span>&nbsp;<span class="builtinfunc" id="7452273">append</span><span class="op" id="7452279">(</span><span class="ident" id="7452280"><a href="/crypto/tls/handshake_server_test.go.html#7452102">command</a></span><span class="op" id="7452287">,</span>&nbsp;<span class="ident" id="7452289"><a href="/crypto/tls/handshake_server_test.go.html#7444093">fmt</a></span><span class="op" id="7452292">.</span><span class="ident" id="7452293">Sprintf</span><span class="op" id="7452300">(</span><span class="string" id="7452301">&#34;127.0.0.1:%d&#34;</span><span class="op" id="7452315">,</span>&nbsp;<span class="ident" id="7452317"><a href="/crypto/tls/handshake_server_test.go.html#7452059">port</a></span><span class="op" id="7452321">)</span><span class="op" id="7452322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452325">cmd</span>&nbsp;<span class="op" id="7452329">:=</span>&nbsp;<span class="ident" id="7452332"><a href="/crypto/tls/handshake_server_test.go.html#7444131">exec</a></span><span class="op" id="7452336">.</span><span class="ident" id="7452337">Command</span><span class="op" id="7452344">(</span><span class="ident" id="7452345"><a href="/crypto/tls/handshake_server_test.go.html#7452102">command</a></span><span class="op" id="7452352">[</span><span class="num" id="7452353">0</span><span class="op" id="7452354">]</span><span class="op" id="7452355">,</span>&nbsp;<span class="ident" id="7452357"><a href="/crypto/tls/handshake_server_test.go.html#7452102">command</a></span><span class="op" id="7452364">[</span><span class="num" id="7452365">1</span><span class="op" id="7452366">:</span><span class="op" id="7452367">]</span><span class="op" id="7452368">...</span><span class="op" id="7452371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452374"><a href="/crypto/tls/handshake_server_test.go.html#7452325">cmd</a></span><span class="op" id="7452377">.</span><span class="ident" id="7452378">Stdin</span>&nbsp;<span class="op" id="7452384">=</span>&nbsp;<span class="ident" id="7452386">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452391">var</span>&nbsp;<span class="ident" id="7452395">output</span>&nbsp;<span class="ident" id="7452402"><a href="/crypto/tls/handshake_server_test.go.html#7443993">bytes</a></span><span class="op" id="7452407">.</span><span class="ident" id="7452408">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452416"><a href="/crypto/tls/handshake_server_test.go.html#7452325">cmd</a></span><span class="op" id="7452419">.</span><span class="ident" id="7452420">Stdout</span>&nbsp;<span class="op" id="7452427">=</span>&nbsp;<span class="op" id="7452429">&amp;</span><span class="ident" id="7452430"><a href="/crypto/tls/handshake_server_test.go.html#7452395">output</a></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452438"><a href="/crypto/tls/handshake_server_test.go.html#7452325">cmd</a></span><span class="op" id="7452441">.</span><span class="ident" id="7452442">Stderr</span>&nbsp;<span class="op" id="7452449">=</span>&nbsp;<span class="op" id="7452451">&amp;</span><span class="ident" id="7452452"><a href="/crypto/tls/handshake_server_test.go.html#7452395">output</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452460">if</span>&nbsp;<span class="ident" id="7452463">err</span>&nbsp;<span class="op" id="7452467">:=</span>&nbsp;<span class="ident" id="7452470"><a href="/crypto/tls/handshake_server_test.go.html#7452325">cmd</a></span><span class="op" id="7452473">.</span><span class="ident" id="7452474">Start</span><span class="op" id="7452479">(</span><span class="op" id="7452480">)</span><span class="op" id="7452481">;</span>&nbsp;<span class="ident" id="7452483"><a href="/crypto/tls/handshake_server_test.go.html#7452463">err</a></span>&nbsp;<span class="op" id="7452487">!=</span>&nbsp;<span class="ident" id="7452490">nil</span>&nbsp;<span class="op" id="7452494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452498">return</span>&nbsp;<span class="ident" id="7452505">nil</span><span class="op" id="7452508">,</span>&nbsp;<span class="ident" id="7452510">nil</span><span class="op" id="7452513">,</span>&nbsp;<span class="ident" id="7452515"><a href="/crypto/tls/handshake_server_test.go.html#7452463">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452524">connChan</span>&nbsp;<span class="op" id="7452533">:=</span>&nbsp;<span class="builtinfunc" id="7452536">make</span><span class="op" id="7452540">(</span><span class="keyword" id="7452541">chan</span>&nbsp;<span class="keyword" id="7452546">interface</span><span class="op" id="7452555">{</span><span class="op" id="7452556">}</span><span class="op" id="7452557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452560">go</span>&nbsp;<span class="keyword" id="7452563">func</span><span class="op" id="7452567">(</span><span class="op" id="7452568">)</span>&nbsp;<span class="op" id="7452570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452574">tcpConn</span><span class="op" id="7452581">,</span>&nbsp;<span class="ident" id="7452583">err</span>&nbsp;<span class="op" id="7452587">:=</span>&nbsp;<span class="ident" id="7452590"><a href="/crypto/tls/handshake_server_test.go.html#7451905">l</a></span><span class="op" id="7452591">.</span><span class="ident" id="7452592">Accept</span><span class="op" id="7452598">(</span><span class="op" id="7452599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452603">if</span>&nbsp;<span class="ident" id="7452606"><a href="/crypto/tls/handshake_server_test.go.html#7452583">err</a></span>&nbsp;<span class="op" id="7452610">!=</span>&nbsp;<span class="ident" id="7452613">nil</span>&nbsp;<span class="op" id="7452617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452622"><a href="/crypto/tls/handshake_server_test.go.html#7452524">connChan</a></span>&nbsp;<span class="op" id="7452631">&lt;-</span>&nbsp;<span class="ident" id="7452634"><a href="/crypto/tls/handshake_server_test.go.html#7452583">err</a></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452644"><a href="/crypto/tls/handshake_server_test.go.html#7452524">connChan</a></span>&nbsp;<span class="op" id="7452653">&lt;-</span>&nbsp;<span class="ident" id="7452656"><a href="/crypto/tls/handshake_server_test.go.html#7452574">tcpConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452665">}</span><span class="op" id="7452666">(</span><span class="op" id="7452667">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452671">var</span>&nbsp;<span class="ident" id="7452675">tcpConn</span>&nbsp;<span class="ident" id="7452683"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7452686">.</span><span class="ident" id="7452687">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452693">select</span>&nbsp;<span class="op" id="7452700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452703">case</span>&nbsp;<span class="ident" id="7452708">connOrError</span>&nbsp;<span class="op" id="7452720">:=</span>&nbsp;<span class="op" id="7452723">&lt;-</span><span class="ident" id="7452725"><a href="/crypto/tls/handshake_server_test.go.html#7452524">connChan</a></span><span class="op" id="7452733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452737">if</span>&nbsp;<span class="ident" id="7452740">err</span><span class="op" id="7452743">,</span>&nbsp;<span class="ident" id="7452745">ok</span>&nbsp;<span class="op" id="7452748">:=</span>&nbsp;<span class="ident" id="7452751"><a href="/crypto/tls/handshake_server_test.go.html#7452708">connOrError</a></span><span class="op" id="7452762">.</span><span class="op" id="7452763">(</span><span class="builtintype" id="7452764">error</span><span class="op" id="7452769">)</span><span class="op" id="7452770">;</span>&nbsp;<span class="ident" id="7452772"><a href="/crypto/tls/handshake_server_test.go.html#7452745">ok</a></span>&nbsp;<span class="op" id="7452775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452780">return</span>&nbsp;<span class="ident" id="7452787">nil</span><span class="op" id="7452790">,</span>&nbsp;<span class="ident" id="7452792">nil</span><span class="op" id="7452795">,</span>&nbsp;<span class="ident" id="7452797"><a href="/crypto/tls/handshake_server_test.go.html#7452740">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452803">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452807"><a href="/crypto/tls/handshake_server_test.go.html#7452675">tcpConn</a></span>&nbsp;<span class="op" id="7452815">=</span>&nbsp;<span class="ident" id="7452817"><a href="/crypto/tls/handshake_server_test.go.html#7452708">connOrError</a></span><span class="op" id="7452828">.</span><span class="op" id="7452829">(</span><span class="ident" id="7452830"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7452833">.</span><span class="ident" id="7452834">Conn</span><span class="op" id="7452838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452841">case</span>&nbsp;<span class="op" id="7452846">&lt;-</span><span class="ident" id="7452848"><a href="/crypto/tls/handshake_server_test.go.html#7444181">time</a></span><span class="op" id="7452852">.</span><span class="ident" id="7452853">After</span><span class="op" id="7452858">(</span><span class="num" id="7452859">2</span>&nbsp;<span class="op" id="7452861">*</span>&nbsp;<span class="ident" id="7452863"><a href="/crypto/tls/handshake_server_test.go.html#7444181">time</a></span><span class="op" id="7452867">.</span><span class="ident" id="7452868">Second</span><span class="op" id="7452874">)</span><span class="op" id="7452875">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452879"><a href="/crypto/tls/handshake_server_test.go.html#7452395">output</a></span><span class="op" id="7452885">.</span><span class="ident" id="7452886">WriteTo</span><span class="op" id="7452893">(</span><span class="ident" id="7452894"><a href="/crypto/tls/handshake_server_test.go.html#7444125">os</a></span><span class="op" id="7452896">.</span><span class="ident" id="7452897">Stdout</span><span class="op" id="7452903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452907">return</span>&nbsp;<span class="ident" id="7452914">nil</span><span class="op" id="7452917">,</span>&nbsp;<span class="ident" id="7452919">nil</span><span class="op" id="7452922">,</span>&nbsp;<span class="ident" id="7452924"><a href="/crypto/tls/handshake_server_test.go.html#7444083">errors</a></span><span class="op" id="7452930">.</span><span class="ident" id="7452931">New</span><span class="op" id="7452934">(</span><span class="string" id="7452935">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="7452988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452991">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452995">record</span>&nbsp;<span class="op" id="7453002">:=</span>&nbsp;<span class="op" id="7453005">&amp;</span><span class="ident" id="7453006"><a href="/crypto/tls/handshake_test.go.html#7476292">recordingConn</a></span><span class="op" id="7453019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453023">Conn</span><span class="op" id="7453027">:</span>&nbsp;<span class="ident" id="7453029"><a href="/crypto/tls/handshake_server_test.go.html#7452675">tcpConn</a></span><span class="op" id="7453036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453043">return</span>&nbsp;<span class="ident" id="7453050"><a href="/crypto/tls/handshake_server_test.go.html#7452995">record</a></span><span class="op" id="7453056">,</span>&nbsp;<span class="ident" id="7453058"><a href="/crypto/tls/handshake_server_test.go.html#7452325">cmd</a></span><span class="op" id="7453061">,</span>&nbsp;<span class="ident" id="7453063">nil</span><br>
<span class="lineno"></span><span class="op" id="7453067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7453070">func</span>&nbsp;<span class="op" id="7453075">(</span><span class="ident" id="7453076">test</span>&nbsp;<span class="op" id="7453081">*</span><span class="ident" id="7453082"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7453092">)</span>&nbsp;<span class="ident" id="7453094">dataPath</span><span class="op" id="7453102">(</span><span class="op" id="7453103">)</span>&nbsp;<span class="builtintype" id="7453105">string</span>&nbsp;<span class="op" id="7453112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453115">return</span>&nbsp;<span class="ident" id="7453122"><a href="/crypto/tls/handshake_server_test.go.html#7444142">filepath</a></span><span class="op" id="7453130">.</span><span class="ident" id="7453131">Join</span><span class="op" id="7453135">(</span><span class="string" id="7453136">&#34;testdata&#34;</span><span class="op" id="7453146">,</span>&nbsp;<span class="string" id="7453148">&#34;Server-&#34;</span><span class="op" id="7453157">+</span><span class="ident" id="7453158"><a href="/crypto/tls/handshake_server_test.go.html#7453076">test</a></span><span class="op" id="7453162">.</span><span class="ident" id="7453163">name</span><span class="op" id="7453167">)</span><br>
<span class="lineno">335</span><span class="op" id="7453169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7453172">func</span>&nbsp;<span class="op" id="7453177">(</span><span class="ident" id="7453178">test</span>&nbsp;<span class="op" id="7453183">*</span><span class="ident" id="7453184"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7453194">)</span>&nbsp;<span class="ident" id="7453196">loadData</span><span class="op" id="7453204">(</span><span class="op" id="7453205">)</span>&nbsp;<span class="op" id="7453207">(</span><span class="ident" id="7453208">flows</span>&nbsp;<span class="op" id="7453214">[</span><span class="op" id="7453215">]</span><span class="op" id="7453216">[</span><span class="op" id="7453217">]</span><span class="builtintype" id="7453218">byte</span><span class="op" id="7453222">,</span>&nbsp;<span class="ident" id="7453224">err</span>&nbsp;<span class="builtintype" id="7453228">error</span><span class="op" id="7453233">)</span>&nbsp;<span class="op" id="7453235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453238">in</span><span class="op" id="7453240">,</span>&nbsp;<span class="ident" id="7453242"><a href="/crypto/tls/handshake_server_test.go.html#7453224">err</a></span>&nbsp;<span class="op" id="7453246">:=</span>&nbsp;<span class="ident" id="7453249"><a href="/crypto/tls/handshake_server_test.go.html#7444125">os</a></span><span class="op" id="7453251">.</span><span class="ident" id="7453252">Open</span><span class="op" id="7453256">(</span><span class="ident" id="7453257"><a href="/crypto/tls/handshake_server_test.go.html#7453178">test</a></span><span class="op" id="7453261">.</span><span class="ident" id="7453262">dataPath</span><span class="op" id="7453270">(</span><span class="op" id="7453271">)</span><span class="op" id="7453272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453275">if</span>&nbsp;<span class="ident" id="7453278"><a href="/crypto/tls/handshake_server_test.go.html#7453224">err</a></span>&nbsp;<span class="op" id="7453282">!=</span>&nbsp;<span class="ident" id="7453285">nil</span>&nbsp;<span class="op" id="7453289">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453293">return</span>&nbsp;<span class="ident" id="7453300">nil</span><span class="op" id="7453303">,</span>&nbsp;<span class="ident" id="7453305"><a href="/crypto/tls/handshake_server_test.go.html#7453224">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453313">defer</span>&nbsp;<span class="ident" id="7453319"><a href="/crypto/tls/handshake_server_test.go.html#7453238">in</a></span><span class="op" id="7453321">.</span><span class="ident" id="7453322">Close</span><span class="op" id="7453327">(</span><span class="op" id="7453328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453331">return</span>&nbsp;<span class="ident" id="7453338"><a href="/crypto/tls/handshake_test.go.html#7477603">parseTestData</a></span><span class="op" id="7453351">(</span><span class="ident" id="7453352"><a href="/crypto/tls/handshake_server_test.go.html#7453238">in</a></span><span class="op" id="7453354">)</span><br>
<span class="lineno"></span><span class="op" id="7453356">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7453359">func</span>&nbsp;<span class="op" id="7453364">(</span><span class="ident" id="7453365">test</span>&nbsp;<span class="op" id="7453370">*</span><span class="ident" id="7453371"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7453381">)</span>&nbsp;<span class="ident" id="7453383">run</span><span class="op" id="7453386">(</span><span class="ident" id="7453387">t</span>&nbsp;<span class="op" id="7453389">*</span><span class="ident" id="7453390"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7453397">.</span><span class="ident" id="7453398">T</span><span class="op" id="7453399">,</span>&nbsp;<span class="ident" id="7453401">write</span>&nbsp;<span class="builtintype" id="7453407">bool</span><span class="op" id="7453411">)</span>&nbsp;<span class="op" id="7453413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453416">var</span>&nbsp;<span class="ident" id="7453420">clientConn</span><span class="op" id="7453430">,</span>&nbsp;<span class="ident" id="7453432">serverConn</span>&nbsp;<span class="ident" id="7453443"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7453446">.</span><span class="ident" id="7453447">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453453">var</span>&nbsp;<span class="ident" id="7453457">recordingConn</span>&nbsp;<span class="op" id="7453471">*</span><span class="ident" id="7453472"><a href="/crypto/tls/handshake_test.go.html#7476292">recordingConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453487">var</span>&nbsp;<span class="ident" id="7453491">childProcess</span>&nbsp;<span class="op" id="7453504">*</span><span class="ident" id="7453505"><a href="/crypto/tls/handshake_server_test.go.html#7444131">exec</a></span><span class="op" id="7453509">.</span><span class="ident" id="7453510">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453516">if</span>&nbsp;<span class="ident" id="7453519"><a href="/crypto/tls/handshake_server_test.go.html#7453401">write</a></span>&nbsp;<span class="op" id="7453525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453529">var</span>&nbsp;<span class="ident" id="7453533">err</span>&nbsp;<span class="builtintype" id="7453537">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453545"><a href="/crypto/tls/handshake_server_test.go.html#7453457">recordingConn</a></span><span class="op" id="7453558">,</span>&nbsp;<span class="ident" id="7453560"><a href="/crypto/tls/handshake_server_test.go.html#7453491">childProcess</a></span><span class="op" id="7453572">,</span>&nbsp;<span class="ident" id="7453574"><a href="/crypto/tls/handshake_server_test.go.html#7453533">err</a></span>&nbsp;<span class="op" id="7453578">=</span>&nbsp;<span class="ident" id="7453580"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7453584">.</span><span class="ident" id="7453585">connFromCommand</span><span class="op" id="7453600">(</span><span class="op" id="7453601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453605">if</span>&nbsp;<span class="ident" id="7453608"><a href="/crypto/tls/handshake_server_test.go.html#7453533">err</a></span>&nbsp;<span class="op" id="7453612">!=</span>&nbsp;<span class="ident" id="7453615">nil</span>&nbsp;<span class="op" id="7453619">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453624"><a href="/crypto/tls/handshake_server_test.go.html#7453387">t</a></span><span class="op" id="7453625">.</span><span class="ident" id="7453626">Fatalf</span><span class="op" id="7453632">(</span><span class="string" id="7453633">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7453665">,</span>&nbsp;<span class="ident" id="7453667"><a href="/crypto/tls/handshake_server_test.go.html#7453533">err</a></span><span class="op" id="7453670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453678"><a href="/crypto/tls/handshake_server_test.go.html#7453432">serverConn</a></span>&nbsp;<span class="op" id="7453689">=</span>&nbsp;<span class="ident" id="7453691"><a href="/crypto/tls/handshake_server_test.go.html#7453457">recordingConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453706">}</span>&nbsp;<span class="keyword" id="7453708">else</span>&nbsp;<span class="op" id="7453713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453717"><a href="/crypto/tls/handshake_server_test.go.html#7453420">clientConn</a></span><span class="op" id="7453727">,</span>&nbsp;<span class="ident" id="7453729"><a href="/crypto/tls/handshake_server_test.go.html#7453432">serverConn</a></span>&nbsp;<span class="op" id="7453740">=</span>&nbsp;<span class="ident" id="7453742"><a href="/crypto/tls/handshake_server_test.go.html#7444118">net</a></span><span class="op" id="7453745">.</span><span class="ident" id="7453746">Pipe</span><span class="op" id="7453750">(</span><span class="op" id="7453751">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453757">config</span>&nbsp;<span class="op" id="7453764">:=</span>&nbsp;<span class="ident" id="7453767"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7453771">.</span><span class="ident" id="7453772">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453780">if</span>&nbsp;<span class="ident" id="7453783"><a href="/crypto/tls/handshake_server_test.go.html#7453757">config</a></span>&nbsp;<span class="op" id="7453790">==</span>&nbsp;<span class="ident" id="7453793">nil</span>&nbsp;<span class="op" id="7453797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453801"><a href="/crypto/tls/handshake_server_test.go.html#7453757">config</a></span>&nbsp;<span class="op" id="7453808">=</span>&nbsp;<span class="ident" id="7453810"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453822">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453825">server</span>&nbsp;<span class="op" id="7453832">:=</span>&nbsp;<span class="ident" id="7453835"><a href="/crypto/tls/tls.go.html#3964076">Server</a></span><span class="op" id="7453841">(</span><span class="ident" id="7453842"><a href="/crypto/tls/handshake_server_test.go.html#7453432">serverConn</a></span><span class="op" id="7453852">,</span>&nbsp;<span class="ident" id="7453854"><a href="/crypto/tls/handshake_server_test.go.html#7453757">config</a></span><span class="op" id="7453860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453863">connStateChan</span>&nbsp;<span class="op" id="7453877">:=</span>&nbsp;<span class="builtinfunc" id="7453880">make</span><span class="op" id="7453884">(</span><span class="keyword" id="7453885">chan</span>&nbsp;<span class="ident" id="7453890"><a href="/crypto/tls/common.go.html#3826826">ConnectionState</a></span><span class="op" id="7453905">,</span>&nbsp;<span class="num" id="7453907">1</span><span class="op" id="7453908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453911">go</span>&nbsp;<span class="keyword" id="7453914">func</span><span class="op" id="7453918">(</span><span class="op" id="7453919">)</span>&nbsp;<span class="op" id="7453921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453925">var</span>&nbsp;<span class="ident" id="7453929">err</span>&nbsp;<span class="builtintype" id="7453933">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453941">if</span>&nbsp;<span class="ident" id="7453944">_</span><span class="op" id="7453945">,</span>&nbsp;<span class="ident" id="7453947"><a href="/crypto/tls/handshake_server_test.go.html#7453929">err</a></span>&nbsp;<span class="op" id="7453951">=</span>&nbsp;<span class="ident" id="7453953"><a href="/crypto/tls/handshake_server_test.go.html#7453825">server</a></span><span class="op" id="7453959">.</span><span class="ident" id="7453960">Write</span><span class="op" id="7453965">(</span><span class="op" id="7453966">[</span><span class="op" id="7453967">]</span><span class="builtintype" id="7453968">byte</span><span class="op" id="7453972">(</span><span class="string" id="7453973">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="7453989">)</span><span class="op" id="7453990">)</span><span class="op" id="7453991">;</span>&nbsp;<span class="ident" id="7453993"><a href="/crypto/tls/handshake_server_test.go.html#7453929">err</a></span>&nbsp;<span class="op" id="7453997">!=</span>&nbsp;<span class="ident" id="7454000">nil</span>&nbsp;<span class="op" id="7454004">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454009"><a href="/crypto/tls/handshake_server_test.go.html#7453387">t</a></span><span class="op" id="7454010">.</span><span class="ident" id="7454011">Logf</span><span class="op" id="7454015">(</span><span class="string" id="7454016">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="7454045">,</span>&nbsp;<span class="ident" id="7454047"><a href="/crypto/tls/handshake_server_test.go.html#7453929">err</a></span><span class="op" id="7454050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454058">if</span>&nbsp;<span class="builtinfunc" id="7454061">len</span><span class="op" id="7454064">(</span><span class="ident" id="7454065"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7454069">.</span><span class="ident" id="7454070">expectHandshakeErrorIncluding</span><span class="op" id="7454099">)</span>&nbsp;<span class="op" id="7454101">&gt;</span>&nbsp;<span class="num" id="7454103">0</span>&nbsp;<span class="op" id="7454105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454110">if</span>&nbsp;<span class="ident" id="7454113"><a href="/crypto/tls/handshake_server_test.go.html#7453929">err</a></span>&nbsp;<span class="op" id="7454117">==</span>&nbsp;<span class="ident" id="7454120">nil</span>&nbsp;<span class="op" id="7454124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454130"><a href="/crypto/tls/handshake_server_test.go.html#7453387">t</a></span><span class="op" id="7454131">.</span><span class="ident" id="7454132">Errorf</span><span class="op" id="7454138">(</span><span class="string" id="7454139">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="7454178">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454183">}</span>&nbsp;<span class="keyword" id="7454185">else</span>&nbsp;<span class="keyword" id="7454190">if</span>&nbsp;<span class="ident" id="7454193">s</span>&nbsp;<span class="op" id="7454195">:=</span>&nbsp;<span class="ident" id="7454198"><a href="/crypto/tls/handshake_server_test.go.html#7453929">err</a></span><span class="op" id="7454201">.</span><span class="ident" id="7454202">Error</span><span class="op" id="7454207">(</span><span class="op" id="7454208">)</span><span class="op" id="7454209">;</span>&nbsp;<span class="op" id="7454211">!</span><span class="ident" id="7454212"><a href="/crypto/tls/handshake_server_test.go.html#7444159">strings</a></span><span class="op" id="7454219">.</span><span class="ident" id="7454220">Contains</span><span class="op" id="7454228">(</span><span class="ident" id="7454229"><a href="/crypto/tls/handshake_server_test.go.html#7454193">s</a></span><span class="op" id="7454230">,</span>&nbsp;<span class="ident" id="7454232"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7454236">.</span><span class="ident" id="7454237">expectHandshakeErrorIncluding</span><span class="op" id="7454266">)</span>&nbsp;<span class="op" id="7454268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454274"><a href="/crypto/tls/handshake_server_test.go.html#7453387">t</a></span><span class="op" id="7454275">.</span><span class="ident" id="7454276">Errorf</span><span class="op" id="7454282">(</span><span class="string" id="7454283">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7454328">,</span>&nbsp;<span class="ident" id="7454330"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7454334">.</span><span class="ident" id="7454335">expectHandshakeErrorIncluding</span><span class="op" id="7454364">,</span>&nbsp;<span class="ident" id="7454366"><a href="/crypto/tls/handshake_server_test.go.html#7454193">s</a></span><span class="op" id="7454367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454380"><a href="/crypto/tls/handshake_server_test.go.html#7453825">server</a></span><span class="op" id="7454386">.</span><span class="ident" id="7454387">Close</span><span class="op" id="7454392">(</span><span class="op" id="7454393">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454397"><a href="/crypto/tls/handshake_server_test.go.html#7453432">serverConn</a></span><span class="op" id="7454407">.</span><span class="ident" id="7454408">Close</span><span class="op" id="7454413">(</span><span class="op" id="7454414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454418"><a href="/crypto/tls/handshake_server_test.go.html#7453863">connStateChan</a></span>&nbsp;<span class="op" id="7454432">&lt;-</span>&nbsp;<span class="ident" id="7454435"><a href="/crypto/tls/handshake_server_test.go.html#7453825">server</a></span><span class="op" id="7454441">.</span><span class="ident" id="7454442">ConnectionState</span><span class="op" id="7454457">(</span><span class="op" id="7454458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454461">}</span><span class="op" id="7454462">(</span><span class="op" id="7454463">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454467">if</span>&nbsp;<span class="op" id="7454470">!</span><span class="ident" id="7454471"><a href="/crypto/tls/handshake_server_test.go.html#7453401">write</a></span>&nbsp;<span class="op" id="7454477">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454481">flows</span><span class="op" id="7454486">,</span>&nbsp;<span class="ident" id="7454488">err</span>&nbsp;<span class="op" id="7454492">:=</span>&nbsp;<span class="ident" id="7454495"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7454499">.</span><span class="ident" id="7454500">loadData</span><span class="op" id="7454508">(</span><span class="op" id="7454509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454513">if</span>&nbsp;<span class="ident" id="7454516"><a href="/crypto/tls/handshake_server_test.go.html#7454488">err</a></span>&nbsp;<span class="op" id="7454520">!=</span>&nbsp;<span class="ident" id="7454523">nil</span>&nbsp;<span class="op" id="7454527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454532">if</span>&nbsp;<span class="op" id="7454535">!</span><span class="ident" id="7454536"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7454540">.</span><span class="ident" id="7454541">expectAlert</span>&nbsp;<span class="op" id="7454553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454559"><a href="/crypto/tls/handshake_server_test.go.html#7453387">t</a></span><span class="op" id="7454560">.</span><span class="ident" id="7454561">Fatalf</span><span class="op" id="7454567">(</span><span class="string" id="7454568">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="7454601">,</span>&nbsp;<span class="ident" id="7454603"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7454607">.</span><span class="ident" id="7454608">name</span><span class="op" id="7454612">,</span>&nbsp;<span class="ident" id="7454614"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7454618">.</span><span class="ident" id="7454619">dataPath</span><span class="op" id="7454627">(</span><span class="op" id="7454628">)</span><span class="op" id="7454629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454634">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454642">for</span>&nbsp;<span class="ident" id="7454646">i</span><span class="op" id="7454647">,</span>&nbsp;<span class="ident" id="7454649">b</span>&nbsp;<span class="op" id="7454651">:=</span>&nbsp;<span class="keyword" id="7454654">range</span>&nbsp;<span class="ident" id="7454660"><a href="/crypto/tls/handshake_server_test.go.html#7454481">flows</a></span>&nbsp;<span class="op" id="7454666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454671">if</span>&nbsp;<span class="ident" id="7454674"><a href="/crypto/tls/handshake_server_test.go.html#7454646">i</a></span><span class="op" id="7454675">%</span><span class="num" id="7454676">2</span>&nbsp;<span class="op" id="7454678">==</span>&nbsp;<span class="num" id="7454681">0</span>&nbsp;<span class="op" id="7454683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454689"><a href="/crypto/tls/handshake_server_test.go.html#7453420">clientConn</a></span><span class="op" id="7454699">.</span><span class="ident" id="7454700">Write</span><span class="op" id="7454705">(</span><span class="ident" id="7454706"><a href="/crypto/tls/handshake_server_test.go.html#7454649">b</a></span><span class="op" id="7454707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454713">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454730">bb</span>&nbsp;<span class="op" id="7454733">:=</span>&nbsp;<span class="builtinfunc" id="7454736">make</span><span class="op" id="7454740">(</span><span class="op" id="7454741">[</span><span class="op" id="7454742">]</span><span class="builtintype" id="7454743">byte</span><span class="op" id="7454747">,</span>&nbsp;<span class="builtinfunc" id="7454749">len</span><span class="op" id="7454752">(</span><span class="ident" id="7454753"><a href="/crypto/tls/handshake_server_test.go.html#7454649">b</a></span><span class="op" id="7454754">)</span><span class="op" id="7454755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454760">n</span><span class="op" id="7454761">,</span>&nbsp;<span class="ident" id="7454763">err</span>&nbsp;<span class="op" id="7454767">:=</span>&nbsp;<span class="ident" id="7454770"><a href="/crypto/tls/handshake_server_test.go.html#7444100">io</a></span><span class="op" id="7454772">.</span><span class="ident" id="7454773">ReadFull</span><span class="op" id="7454781">(</span><span class="ident" id="7454782"><a href="/crypto/tls/handshake_server_test.go.html#7453420">clientConn</a></span><span class="op" id="7454792">,</span>&nbsp;<span class="ident" id="7454794"><a href="/crypto/tls/handshake_server_test.go.html#7454730">bb</a></span><span class="op" id="7454796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454801">if</span>&nbsp;<span class="ident" id="7454804"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7454808">.</span><span class="ident" id="7454809">expectAlert</span>&nbsp;<span class="op" id="7454821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454827">if</span>&nbsp;<span class="ident" id="7454830"><a href="/crypto/tls/handshake_server_test.go.html#7454763">err</a></span>&nbsp;<span class="op" id="7454834">==</span>&nbsp;<span class="ident" id="7454837">nil</span>&nbsp;<span class="op" id="7454841">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454848"><a href="/crypto/tls/handshake_server_test.go.html#7453387">t</a></span><span class="op" id="7454849">.</span><span class="ident" id="7454850">Fatal</span><span class="op" id="7454855">(</span><span class="string" id="7454856">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="7454898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454909">}</span>&nbsp;<span class="keyword" id="7454911">else</span>&nbsp;<span class="op" id="7454916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454922">if</span>&nbsp;<span class="ident" id="7454925"><a href="/crypto/tls/handshake_server_test.go.html#7454763">err</a></span>&nbsp;<span class="op" id="7454929">!=</span>&nbsp;<span class="ident" id="7454932">nil</span>&nbsp;<span class="op" id="7454936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454943"><a href="/crypto/tls/handshake_server_test.go.html#7453387">t</a></span><span class="op" id="7454944">.</span><span class="ident" id="7454945">Fatalf</span><span class="op" id="7454951">(</span><span class="string" id="7454952">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="7455005">,</span>&nbsp;<span class="ident" id="7455007"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7455011">.</span><span class="ident" id="7455012">name</span><span class="op" id="7455016">,</span>&nbsp;<span class="ident" id="7455018"><a href="/crypto/tls/handshake_server_test.go.html#7454646">i</a></span><span class="op" id="7455019">+</span><span class="num" id="7455020">1</span><span class="op" id="7455021">,</span>&nbsp;<span class="ident" id="7455023"><a href="/crypto/tls/handshake_server_test.go.html#7454763">err</a></span><span class="op" id="7455026">,</span>&nbsp;<span class="ident" id="7455028"><a href="/crypto/tls/handshake_server_test.go.html#7454760">n</a></span><span class="op" id="7455029">,</span>&nbsp;<span class="builtinfunc" id="7455031">len</span><span class="op" id="7455034">(</span><span class="ident" id="7455035"><a href="/crypto/tls/handshake_server_test.go.html#7454730">bb</a></span><span class="op" id="7455037">)</span><span class="op" id="7455038">,</span>&nbsp;<span class="ident" id="7455040"><a href="/crypto/tls/handshake_server_test.go.html#7454730">bb</a></span><span class="op" id="7455042">[</span><span class="op" id="7455043">:</span><span class="ident" id="7455044"><a href="/crypto/tls/handshake_server_test.go.html#7454760">n</a></span><span class="op" id="7455045">]</span><span class="op" id="7455046">,</span>&nbsp;<span class="ident" id="7455048"><a href="/crypto/tls/handshake_server_test.go.html#7454649">b</a></span><span class="op" id="7455049">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455061">if</span>&nbsp;<span class="op" id="7455064">!</span><span class="ident" id="7455065"><a href="/crypto/tls/handshake_server_test.go.html#7443993">bytes</a></span><span class="op" id="7455070">.</span><span class="ident" id="7455071">Equal</span><span class="op" id="7455076">(</span><span class="ident" id="7455077"><a href="/crypto/tls/handshake_server_test.go.html#7454649">b</a></span><span class="op" id="7455078">,</span>&nbsp;<span class="ident" id="7455080"><a href="/crypto/tls/handshake_server_test.go.html#7454730">bb</a></span><span class="op" id="7455082">)</span>&nbsp;<span class="op" id="7455084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455091"><a href="/crypto/tls/handshake_server_test.go.html#7453387">t</a></span><span class="op" id="7455092">.</span><span class="ident" id="7455093">Fatalf</span><span class="op" id="7455099">(</span><span class="string" id="7455100">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7455142">,</span>&nbsp;<span class="ident" id="7455144"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7455148">.</span><span class="ident" id="7455149">name</span><span class="op" id="7455153">,</span>&nbsp;<span class="ident" id="7455155"><a href="/crypto/tls/handshake_server_test.go.html#7454646">i</a></span><span class="op" id="7455156">+</span><span class="num" id="7455157">1</span><span class="op" id="7455158">,</span>&nbsp;<span class="ident" id="7455160"><a href="/crypto/tls/handshake_server_test.go.html#7454730">bb</a></span><span class="op" id="7455162">,</span>&nbsp;<span class="ident" id="7455164"><a href="/crypto/tls/handshake_server_test.go.html#7454649">b</a></span><span class="op" id="7455165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455176">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455184"><a href="/crypto/tls/handshake_server_test.go.html#7453420">clientConn</a></span><span class="op" id="7455194">.</span><span class="ident" id="7455195">Close</span><span class="op" id="7455200">(</span><span class="op" id="7455201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455208">connState</span>&nbsp;<span class="op" id="7455218">:=</span>&nbsp;<span class="op" id="7455221">&lt;-</span><span class="ident" id="7455223"><a href="/crypto/tls/handshake_server_test.go.html#7453863">connStateChan</a></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455238">peerCerts</span>&nbsp;<span class="op" id="7455248">:=</span>&nbsp;<span class="ident" id="7455251"><a href="/crypto/tls/handshake_server_test.go.html#7455208">connState</a></span><span class="op" id="7455260">.</span><span class="ident" id="7455261">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455279">if</span>&nbsp;<span class="builtinfunc" id="7455282">len</span><span class="op" id="7455285">(</span><span class="ident" id="7455286"><a href="/crypto/tls/handshake_server_test.go.html#7455238">peerCerts</a></span><span class="op" id="7455295">)</span>&nbsp;<span class="op" id="7455297">==</span>&nbsp;<span class="builtinfunc" id="7455300">len</span><span class="op" id="7455303">(</span><span class="ident" id="7455304"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7455308">.</span><span class="ident" id="7455309">expectedPeerCerts</span><span class="op" id="7455326">)</span>&nbsp;<span class="op" id="7455328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455332">for</span>&nbsp;<span class="ident" id="7455336">i</span><span class="op" id="7455337">,</span>&nbsp;<span class="ident" id="7455339">peerCert</span>&nbsp;<span class="op" id="7455348">:=</span>&nbsp;<span class="keyword" id="7455351">range</span>&nbsp;<span class="ident" id="7455357"><a href="/crypto/tls/handshake_server_test.go.html#7455238">peerCerts</a></span>&nbsp;<span class="op" id="7455367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455372">block</span><span class="op" id="7455377">,</span>&nbsp;<span class="ident" id="7455379">_</span>&nbsp;<span class="op" id="7455381">:=</span>&nbsp;<span class="ident" id="7455384"><a href="/crypto/tls/handshake_server_test.go.html#7444067">pem</a></span><span class="op" id="7455387">.</span><span class="ident" id="7455388">Decode</span><span class="op" id="7455394">(</span><span class="op" id="7455395">[</span><span class="op" id="7455396">]</span><span class="builtintype" id="7455397">byte</span><span class="op" id="7455401">(</span><span class="ident" id="7455402"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7455406">.</span><span class="ident" id="7455407">expectedPeerCerts</span><span class="op" id="7455424">[</span><span class="ident" id="7455425"><a href="/crypto/tls/handshake_server_test.go.html#7455336">i</a></span><span class="op" id="7455426">]</span><span class="op" id="7455427">)</span><span class="op" id="7455428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455433">if</span>&nbsp;<span class="op" id="7455436">!</span><span class="ident" id="7455437"><a href="/crypto/tls/handshake_server_test.go.html#7443993">bytes</a></span><span class="op" id="7455442">.</span><span class="ident" id="7455443">Equal</span><span class="op" id="7455448">(</span><span class="ident" id="7455449"><a href="/crypto/tls/handshake_server_test.go.html#7455372">block</a></span><span class="op" id="7455454">.</span><span class="ident" id="7455455">Bytes</span><span class="op" id="7455460">,</span>&nbsp;<span class="ident" id="7455462"><a href="/crypto/tls/handshake_server_test.go.html#7455339">peerCert</a></span><span class="op" id="7455470">.</span><span class="ident" id="7455471">Raw</span><span class="op" id="7455474">)</span>&nbsp;<span class="op" id="7455476">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455482"><a href="/crypto/tls/handshake_server_test.go.html#7453387">t</a></span><span class="op" id="7455483">.</span><span class="ident" id="7455484">Fatalf</span><span class="op" id="7455490">(</span><span class="string" id="7455491">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="7455521">,</span>&nbsp;<span class="ident" id="7455523"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7455527">.</span><span class="ident" id="7455528">name</span><span class="op" id="7455532">,</span>&nbsp;<span class="ident" id="7455534"><a href="/crypto/tls/handshake_server_test.go.html#7455336">i</a></span><span class="op" id="7455535">+</span><span class="num" id="7455536">1</span><span class="op" id="7455537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455549">}</span>&nbsp;<span class="keyword" id="7455551">else</span>&nbsp;<span class="op" id="7455556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455560"><a href="/crypto/tls/handshake_server_test.go.html#7453387">t</a></span><span class="op" id="7455561">.</span><span class="ident" id="7455562">Fatalf</span><span class="op" id="7455568">(</span><span class="string" id="7455569">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="7455628">,</span>&nbsp;<span class="ident" id="7455630"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7455634">.</span><span class="ident" id="7455635">name</span><span class="op" id="7455639">,</span>&nbsp;<span class="builtinfunc" id="7455641">len</span><span class="op" id="7455644">(</span><span class="ident" id="7455645"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7455649">.</span><span class="ident" id="7455650">expectedPeerCerts</span><span class="op" id="7455667">)</span><span class="op" id="7455668">,</span>&nbsp;<span class="builtinfunc" id="7455670">len</span><span class="op" id="7455673">(</span><span class="ident" id="7455674"><a href="/crypto/tls/handshake_server_test.go.html#7455238">peerCerts</a></span><span class="op" id="7455683">)</span><span class="op" id="7455684">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455691">if</span>&nbsp;<span class="ident" id="7455694"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7455698">.</span><span class="ident" id="7455699">validate</span>&nbsp;<span class="op" id="7455708">!=</span>&nbsp;<span class="ident" id="7455711">nil</span>&nbsp;<span class="op" id="7455715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455719">if</span>&nbsp;<span class="ident" id="7455722">err</span>&nbsp;<span class="op" id="7455726">:=</span>&nbsp;<span class="ident" id="7455729"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7455733">.</span><span class="ident" id="7455734">validate</span><span class="op" id="7455742">(</span><span class="ident" id="7455743"><a href="/crypto/tls/handshake_server_test.go.html#7455208">connState</a></span><span class="op" id="7455752">)</span><span class="op" id="7455753">;</span>&nbsp;<span class="ident" id="7455755"><a href="/crypto/tls/handshake_server_test.go.html#7455722">err</a></span>&nbsp;<span class="op" id="7455759">!=</span>&nbsp;<span class="ident" id="7455762">nil</span>&nbsp;<span class="op" id="7455766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455771"><a href="/crypto/tls/handshake_server_test.go.html#7453387">t</a></span><span class="op" id="7455772">.</span><span class="ident" id="7455773">Fatalf</span><span class="op" id="7455779">(</span><span class="string" id="7455780">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7455818">,</span>&nbsp;<span class="ident" id="7455820"><a href="/crypto/tls/handshake_server_test.go.html#7455722">err</a></span><span class="op" id="7455823">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455834">if</span>&nbsp;<span class="ident" id="7455837"><a href="/crypto/tls/handshake_server_test.go.html#7453401">write</a></span>&nbsp;<span class="op" id="7455843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455847">path</span>&nbsp;<span class="op" id="7455852">:=</span>&nbsp;<span class="ident" id="7455855"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7455859">.</span><span class="ident" id="7455860">dataPath</span><span class="op" id="7455868">(</span><span class="op" id="7455869">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455873">out</span><span class="op" id="7455876">,</span>&nbsp;<span class="ident" id="7455878">err</span>&nbsp;<span class="op" id="7455882">:=</span>&nbsp;<span class="ident" id="7455885"><a href="/crypto/tls/handshake_server_test.go.html#7444125">os</a></span><span class="op" id="7455887">.</span><span class="ident" id="7455888">OpenFile</span><span class="op" id="7455896">(</span><span class="ident" id="7455897"><a href="/crypto/tls/handshake_server_test.go.html#7455847">path</a></span><span class="op" id="7455901">,</span>&nbsp;<span class="ident" id="7455903"><a href="/crypto/tls/handshake_server_test.go.html#7444125">os</a></span><span class="op" id="7455905">.</span><span class="ident" id="7455906">O_WRONLY</span><span class="op" id="7455914">|</span><span class="ident" id="7455915"><a href="/crypto/tls/handshake_server_test.go.html#7444125">os</a></span><span class="op" id="7455917">.</span><span class="ident" id="7455918">O_CREATE</span><span class="op" id="7455926">|</span><span class="ident" id="7455927"><a href="/crypto/tls/handshake_server_test.go.html#7444125">os</a></span><span class="op" id="7455929">.</span><span class="ident" id="7455930">O_TRUNC</span><span class="op" id="7455937">,</span>&nbsp;<span class="num" id="7455939">0644</span><span class="op" id="7455943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455947">if</span>&nbsp;<span class="ident" id="7455950"><a href="/crypto/tls/handshake_server_test.go.html#7455878">err</a></span>&nbsp;<span class="op" id="7455954">!=</span>&nbsp;<span class="ident" id="7455957">nil</span>&nbsp;<span class="op" id="7455961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455966"><a href="/crypto/tls/handshake_server_test.go.html#7453387">t</a></span><span class="op" id="7455967">.</span><span class="ident" id="7455968">Fatalf</span><span class="op" id="7455974">(</span><span class="string" id="7455975">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7456009">,</span>&nbsp;<span class="ident" id="7456011"><a href="/crypto/tls/handshake_server_test.go.html#7455878">err</a></span><span class="op" id="7456014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456022">defer</span>&nbsp;<span class="ident" id="7456028"><a href="/crypto/tls/handshake_server_test.go.html#7455873">out</a></span><span class="op" id="7456031">.</span><span class="ident" id="7456032">Close</span><span class="op" id="7456037">(</span><span class="op" id="7456038">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456042"><a href="/crypto/tls/handshake_server_test.go.html#7453457">recordingConn</a></span><span class="op" id="7456055">.</span><span class="ident" id="7456056">Close</span><span class="op" id="7456061">(</span><span class="op" id="7456062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456066">if</span>&nbsp;<span class="builtinfunc" id="7456069">len</span><span class="op" id="7456072">(</span><span class="ident" id="7456073"><a href="/crypto/tls/handshake_server_test.go.html#7453457">recordingConn</a></span><span class="op" id="7456086">.</span><span class="ident" id="7456087">flows</span><span class="op" id="7456092">)</span>&nbsp;<span class="op" id="7456094">&lt;</span>&nbsp;<span class="num" id="7456096">3</span>&nbsp;<span class="op" id="7456098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456103"><a href="/crypto/tls/handshake_server_test.go.html#7453491">childProcess</a></span><span class="op" id="7456115">.</span><span class="ident" id="7456116">Stdout</span><span class="op" id="7456122">.</span><span class="op" id="7456123">(</span><span class="op" id="7456124">*</span><span class="ident" id="7456125"><a href="/crypto/tls/handshake_server_test.go.html#7443993">bytes</a></span><span class="op" id="7456130">.</span><span class="ident" id="7456131">Buffer</span><span class="op" id="7456137">)</span><span class="op" id="7456138">.</span><span class="ident" id="7456139">WriteTo</span><span class="op" id="7456146">(</span><span class="ident" id="7456147"><a href="/crypto/tls/handshake_server_test.go.html#7444125">os</a></span><span class="op" id="7456149">.</span><span class="ident" id="7456150">Stdout</span><span class="op" id="7456156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456161">if</span>&nbsp;<span class="builtinfunc" id="7456164">len</span><span class="op" id="7456167">(</span><span class="ident" id="7456168"><a href="/crypto/tls/handshake_server_test.go.html#7453365">test</a></span><span class="op" id="7456172">.</span><span class="ident" id="7456173">expectHandshakeErrorIncluding</span><span class="op" id="7456202">)</span>&nbsp;<span class="op" id="7456204">==</span>&nbsp;<span class="num" id="7456207">0</span>&nbsp;<span class="op" id="7456209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456215"><a href="/crypto/tls/handshake_server_test.go.html#7453387">t</a></span><span class="op" id="7456216">.</span><span class="ident" id="7456217">Fatalf</span><span class="op" id="7456223">(</span><span class="string" id="7456224">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="7456242">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456255"><a href="/crypto/tls/handshake_server_test.go.html#7453457">recordingConn</a></span><span class="op" id="7456268">.</span><span class="ident" id="7456269">WriteTo</span><span class="op" id="7456276">(</span><span class="ident" id="7456277"><a href="/crypto/tls/handshake_server_test.go.html#7455873">out</a></span><span class="op" id="7456280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456284"><a href="/crypto/tls/handshake_server_test.go.html#7444093">fmt</a></span><span class="op" id="7456287">.</span><span class="ident" id="7456288">Printf</span><span class="op" id="7456294">(</span><span class="string" id="7456295">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7456307">,</span>&nbsp;<span class="ident" id="7456309"><a href="/crypto/tls/handshake_server_test.go.html#7455847">path</a></span><span class="op" id="7456313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456317"><a href="/crypto/tls/handshake_server_test.go.html#7453491">childProcess</a></span><span class="op" id="7456329">.</span><span class="ident" id="7456330">Wait</span><span class="op" id="7456334">(</span><span class="op" id="7456335">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456338">}</span><br>
<span class="lineno"></span><span class="op" id="7456340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7456343">func</span>&nbsp;<span class="ident" id="7456348">runServerTestForVersion</span><span class="op" id="7456371">(</span><span class="ident" id="7456372">t</span>&nbsp;<span class="op" id="7456374">*</span><span class="ident" id="7456375"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7456382">.</span><span class="ident" id="7456383">T</span><span class="op" id="7456384">,</span>&nbsp;<span class="ident" id="7456386">template</span>&nbsp;<span class="op" id="7456395">*</span><span class="ident" id="7456396"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7456406">,</span>&nbsp;<span class="ident" id="7456408">prefix</span><span class="op" id="7456414">,</span>&nbsp;<span class="ident" id="7456416">option</span>&nbsp;<span class="builtintype" id="7456423">string</span><span class="op" id="7456429">)</span>&nbsp;<span class="op" id="7456431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456434">test</span>&nbsp;<span class="op" id="7456439">:=</span>&nbsp;<span class="op" id="7456442">*</span><span class="ident" id="7456443"><a href="/crypto/tls/handshake_server_test.go.html#7456386">template</a></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456453"><a href="/crypto/tls/handshake_server_test.go.html#7456434">test</a></span><span class="op" id="7456457">.</span><span class="ident" id="7456458">name</span>&nbsp;<span class="op" id="7456463">=</span>&nbsp;<span class="ident" id="7456465"><a href="/crypto/tls/handshake_server_test.go.html#7456408">prefix</a></span>&nbsp;<span class="op" id="7456472">+</span>&nbsp;<span class="ident" id="7456474"><a href="/crypto/tls/handshake_server_test.go.html#7456434">test</a></span><span class="op" id="7456478">.</span><span class="ident" id="7456479">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456485">if</span>&nbsp;<span class="builtinfunc" id="7456488">len</span><span class="op" id="7456491">(</span><span class="ident" id="7456492"><a href="/crypto/tls/handshake_server_test.go.html#7456434">test</a></span><span class="op" id="7456496">.</span><span class="ident" id="7456497">command</span><span class="op" id="7456504">)</span>&nbsp;<span class="op" id="7456506">==</span>&nbsp;<span class="num" id="7456509">0</span>&nbsp;<span class="op" id="7456511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456515"><a href="/crypto/tls/handshake_server_test.go.html#7456434">test</a></span><span class="op" id="7456519">.</span><span class="ident" id="7456520">command</span>&nbsp;<span class="op" id="7456528">=</span>&nbsp;<span class="ident" id="7456530"><a href="/crypto/tls/handshake_server_test.go.html#7451569">defaultClientCommand</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456555"><a href="/crypto/tls/handshake_server_test.go.html#7456434">test</a></span><span class="op" id="7456559">.</span><span class="ident" id="7456560">command</span>&nbsp;<span class="op" id="7456568">=</span>&nbsp;<span class="builtinfunc" id="7456570">append</span><span class="op" id="7456576">(</span><span class="op" id="7456577">[</span><span class="op" id="7456578">]</span><span class="builtintype" id="7456579">string</span><span class="op" id="7456585">(</span><span class="ident" id="7456586">nil</span><span class="op" id="7456589">)</span><span class="op" id="7456590">,</span>&nbsp;<span class="ident" id="7456592"><a href="/crypto/tls/handshake_server_test.go.html#7456434">test</a></span><span class="op" id="7456596">.</span><span class="ident" id="7456597">command</span><span class="op" id="7456604">...</span><span class="op" id="7456607">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456610"><a href="/crypto/tls/handshake_server_test.go.html#7456434">test</a></span><span class="op" id="7456614">.</span><span class="ident" id="7456615">command</span>&nbsp;<span class="op" id="7456623">=</span>&nbsp;<span class="builtinfunc" id="7456625">append</span><span class="op" id="7456631">(</span><span class="ident" id="7456632"><a href="/crypto/tls/handshake_server_test.go.html#7456434">test</a></span><span class="op" id="7456636">.</span><span class="ident" id="7456637">command</span><span class="op" id="7456644">,</span>&nbsp;<span class="ident" id="7456646"><a href="/crypto/tls/handshake_server_test.go.html#7456416">option</a></span><span class="op" id="7456652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456655"><a href="/crypto/tls/handshake_server_test.go.html#7456434">test</a></span><span class="op" id="7456659">.</span><span class="ident" id="7456660">run</span><span class="op" id="7456663">(</span><span class="ident" id="7456664"><a href="/crypto/tls/handshake_server_test.go.html#7456372">t</a></span><span class="op" id="7456665">,</span>&nbsp;<span class="op" id="7456667">*</span><span class="ident" id="7456668"><a href="/crypto/tls/handshake_test.go.html#7476047">update</a></span><span class="op" id="7456674">)</span><br>
<span class="lineno"></span><span class="op" id="7456676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7456679">func</span>&nbsp;<span class="ident" id="7456684">runServerTestSSLv3</span><span class="op" id="7456702">(</span><span class="ident" id="7456703">t</span>&nbsp;<span class="op" id="7456705">*</span><span class="ident" id="7456706"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7456713">.</span><span class="ident" id="7456714">T</span><span class="op" id="7456715">,</span>&nbsp;<span class="ident" id="7456717">template</span>&nbsp;<span class="op" id="7456726">*</span><span class="ident" id="7456727"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7456737">)</span>&nbsp;<span class="op" id="7456739">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456742"><a href="/crypto/tls/handshake_server_test.go.html#7456348">runServerTestForVersion</a></span><span class="op" id="7456765">(</span><span class="ident" id="7456766"><a href="/crypto/tls/handshake_server_test.go.html#7456703">t</a></span><span class="op" id="7456767">,</span>&nbsp;<span class="ident" id="7456769"><a href="/crypto/tls/handshake_server_test.go.html#7456717">template</a></span><span class="op" id="7456777">,</span>&nbsp;<span class="string" id="7456779">&#34;SSLv3-&#34;</span><span class="op" id="7456787">,</span>&nbsp;<span class="string" id="7456789">&#34;-ssl3&#34;</span><span class="op" id="7456796">)</span><br>
<span class="lineno"></span><span class="op" id="7456798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7456801">func</span>&nbsp;<span class="ident" id="7456806">runServerTestTLS10</span><span class="op" id="7456824">(</span><span class="ident" id="7456825">t</span>&nbsp;<span class="op" id="7456827">*</span><span class="ident" id="7456828"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7456835">.</span><span class="ident" id="7456836">T</span><span class="op" id="7456837">,</span>&nbsp;<span class="ident" id="7456839">template</span>&nbsp;<span class="op" id="7456848">*</span><span class="ident" id="7456849"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7456859">)</span>&nbsp;<span class="op" id="7456861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456864"><a href="/crypto/tls/handshake_server_test.go.html#7456348">runServerTestForVersion</a></span><span class="op" id="7456887">(</span><span class="ident" id="7456888"><a href="/crypto/tls/handshake_server_test.go.html#7456825">t</a></span><span class="op" id="7456889">,</span>&nbsp;<span class="ident" id="7456891"><a href="/crypto/tls/handshake_server_test.go.html#7456839">template</a></span><span class="op" id="7456899">,</span>&nbsp;<span class="string" id="7456901">&#34;TLSv10-&#34;</span><span class="op" id="7456910">,</span>&nbsp;<span class="string" id="7456912">&#34;-tls1&#34;</span><span class="op" id="7456919">)</span><br>
<span class="lineno">470</span><span class="op" id="7456921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7456924">func</span>&nbsp;<span class="ident" id="7456929">runServerTestTLS11</span><span class="op" id="7456947">(</span><span class="ident" id="7456948">t</span>&nbsp;<span class="op" id="7456950">*</span><span class="ident" id="7456951"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7456958">.</span><span class="ident" id="7456959">T</span><span class="op" id="7456960">,</span>&nbsp;<span class="ident" id="7456962">template</span>&nbsp;<span class="op" id="7456971">*</span><span class="ident" id="7456972"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7456982">)</span>&nbsp;<span class="op" id="7456984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456987"><a href="/crypto/tls/handshake_server_test.go.html#7456348">runServerTestForVersion</a></span><span class="op" id="7457010">(</span><span class="ident" id="7457011"><a href="/crypto/tls/handshake_server_test.go.html#7456948">t</a></span><span class="op" id="7457012">,</span>&nbsp;<span class="ident" id="7457014"><a href="/crypto/tls/handshake_server_test.go.html#7456962">template</a></span><span class="op" id="7457022">,</span>&nbsp;<span class="string" id="7457024">&#34;TLSv11-&#34;</span><span class="op" id="7457033">,</span>&nbsp;<span class="string" id="7457035">&#34;-tls1_1&#34;</span><span class="op" id="7457044">)</span><br>
<span class="lineno"></span><span class="op" id="7457046">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="7457049">func</span>&nbsp;<span class="ident" id="7457054">runServerTestTLS12</span><span class="op" id="7457072">(</span><span class="ident" id="7457073">t</span>&nbsp;<span class="op" id="7457075">*</span><span class="ident" id="7457076"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7457083">.</span><span class="ident" id="7457084">T</span><span class="op" id="7457085">,</span>&nbsp;<span class="ident" id="7457087">template</span>&nbsp;<span class="op" id="7457096">*</span><span class="ident" id="7457097"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7457107">)</span>&nbsp;<span class="op" id="7457109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457112"><a href="/crypto/tls/handshake_server_test.go.html#7456348">runServerTestForVersion</a></span><span class="op" id="7457135">(</span><span class="ident" id="7457136"><a href="/crypto/tls/handshake_server_test.go.html#7457073">t</a></span><span class="op" id="7457137">,</span>&nbsp;<span class="ident" id="7457139"><a href="/crypto/tls/handshake_server_test.go.html#7457087">template</a></span><span class="op" id="7457147">,</span>&nbsp;<span class="string" id="7457149">&#34;TLSv12-&#34;</span><span class="op" id="7457158">,</span>&nbsp;<span class="string" id="7457160">&#34;-tls1_2&#34;</span><span class="op" id="7457169">)</span><br>
<span class="lineno"></span><span class="op" id="7457171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="7457174">func</span>&nbsp;<span class="ident" id="7457179">TestHandshakeServerRSARC4</span><span class="op" id="7457204">(</span><span class="ident" id="7457205">t</span>&nbsp;<span class="op" id="7457207">*</span><span class="ident" id="7457208"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7457215">.</span><span class="ident" id="7457216">T</span><span class="op" id="7457217">)</span>&nbsp;<span class="op" id="7457219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457222">test</span>&nbsp;<span class="op" id="7457227">:=</span>&nbsp;<span class="op" id="7457230">&amp;</span><span class="ident" id="7457231"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7457241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457245">name</span><span class="op" id="7457249">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7457254">&#34;RSA-RC4&#34;</span><span class="op" id="7457263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457267">command</span><span class="op" id="7457274">:</span>&nbsp;<span class="op" id="7457276">[</span><span class="op" id="7457277">]</span><span class="builtintype" id="7457278">string</span><span class="op" id="7457284">{</span><span class="string" id="7457285">&#34;openssl&#34;</span><span class="op" id="7457294">,</span>&nbsp;<span class="string" id="7457296">&#34;s_client&#34;</span><span class="op" id="7457306">,</span>&nbsp;<span class="string" id="7457308">&#34;-no_ticket&#34;</span><span class="op" id="7457320">,</span>&nbsp;<span class="string" id="7457322">&#34;-cipher&#34;</span><span class="op" id="7457331">,</span>&nbsp;<span class="string" id="7457333">&#34;RC4-SHA&#34;</span><span class="op" id="7457342">}</span><span class="op" id="7457343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457346">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457349"><a href="/crypto/tls/handshake_server_test.go.html#7456684">runServerTestSSLv3</a></span><span class="op" id="7457367">(</span><span class="ident" id="7457368"><a href="/crypto/tls/handshake_server_test.go.html#7457205">t</a></span><span class="op" id="7457369">,</span>&nbsp;<span class="ident" id="7457371"><a href="/crypto/tls/handshake_server_test.go.html#7457222">test</a></span><span class="op" id="7457375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457378"><a href="/crypto/tls/handshake_server_test.go.html#7456806">runServerTestTLS10</a></span><span class="op" id="7457396">(</span><span class="ident" id="7457397"><a href="/crypto/tls/handshake_server_test.go.html#7457205">t</a></span><span class="op" id="7457398">,</span>&nbsp;<span class="ident" id="7457400"><a href="/crypto/tls/handshake_server_test.go.html#7457222">test</a></span><span class="op" id="7457404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457407"><a href="/crypto/tls/handshake_server_test.go.html#7456929">runServerTestTLS11</a></span><span class="op" id="7457425">(</span><span class="ident" id="7457426"><a href="/crypto/tls/handshake_server_test.go.html#7457205">t</a></span><span class="op" id="7457427">,</span>&nbsp;<span class="ident" id="7457429"><a href="/crypto/tls/handshake_server_test.go.html#7457222">test</a></span><span class="op" id="7457433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457436"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7457454">(</span><span class="ident" id="7457455"><a href="/crypto/tls/handshake_server_test.go.html#7457205">t</a></span><span class="op" id="7457456">,</span>&nbsp;<span class="ident" id="7457458"><a href="/crypto/tls/handshake_server_test.go.html#7457222">test</a></span><span class="op" id="7457462">)</span><br>
<span class="lineno"></span><span class="op" id="7457464">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="7457467">func</span>&nbsp;<span class="ident" id="7457472">TestHandshakeServerRSA3DES</span><span class="op" id="7457498">(</span><span class="ident" id="7457499">t</span>&nbsp;<span class="op" id="7457501">*</span><span class="ident" id="7457502"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7457509">.</span><span class="ident" id="7457510">T</span><span class="op" id="7457511">)</span>&nbsp;<span class="op" id="7457513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457516">test</span>&nbsp;<span class="op" id="7457521">:=</span>&nbsp;<span class="op" id="7457524">&amp;</span><span class="ident" id="7457525"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7457535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457539">name</span><span class="op" id="7457543">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7457548">&#34;RSA-3DES&#34;</span><span class="op" id="7457558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457562">command</span><span class="op" id="7457569">:</span>&nbsp;<span class="op" id="7457571">[</span><span class="op" id="7457572">]</span><span class="builtintype" id="7457573">string</span><span class="op" id="7457579">{</span><span class="string" id="7457580">&#34;openssl&#34;</span><span class="op" id="7457589">,</span>&nbsp;<span class="string" id="7457591">&#34;s_client&#34;</span><span class="op" id="7457601">,</span>&nbsp;<span class="string" id="7457603">&#34;-no_ticket&#34;</span><span class="op" id="7457615">,</span>&nbsp;<span class="string" id="7457617">&#34;-cipher&#34;</span><span class="op" id="7457626">,</span>&nbsp;<span class="string" id="7457628">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="7457642">}</span><span class="op" id="7457643">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457649"><a href="/crypto/tls/handshake_server_test.go.html#7456684">runServerTestSSLv3</a></span><span class="op" id="7457667">(</span><span class="ident" id="7457668"><a href="/crypto/tls/handshake_server_test.go.html#7457499">t</a></span><span class="op" id="7457669">,</span>&nbsp;<span class="ident" id="7457671"><a href="/crypto/tls/handshake_server_test.go.html#7457516">test</a></span><span class="op" id="7457675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457678"><a href="/crypto/tls/handshake_server_test.go.html#7456806">runServerTestTLS10</a></span><span class="op" id="7457696">(</span><span class="ident" id="7457697"><a href="/crypto/tls/handshake_server_test.go.html#7457499">t</a></span><span class="op" id="7457698">,</span>&nbsp;<span class="ident" id="7457700"><a href="/crypto/tls/handshake_server_test.go.html#7457516">test</a></span><span class="op" id="7457704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457707"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7457725">(</span><span class="ident" id="7457726"><a href="/crypto/tls/handshake_server_test.go.html#7457499">t</a></span><span class="op" id="7457727">,</span>&nbsp;<span class="ident" id="7457729"><a href="/crypto/tls/handshake_server_test.go.html#7457516">test</a></span><span class="op" id="7457733">)</span><br>
<span class="lineno"></span><span class="op" id="7457735">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="7457738">func</span>&nbsp;<span class="ident" id="7457743">TestHandshakeServerRSAAES</span><span class="op" id="7457768">(</span><span class="ident" id="7457769">t</span>&nbsp;<span class="op" id="7457771">*</span><span class="ident" id="7457772"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7457779">.</span><span class="ident" id="7457780">T</span><span class="op" id="7457781">)</span>&nbsp;<span class="op" id="7457783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457786">test</span>&nbsp;<span class="op" id="7457791">:=</span>&nbsp;<span class="op" id="7457794">&amp;</span><span class="ident" id="7457795"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7457805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457809">name</span><span class="op" id="7457813">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7457818">&#34;RSA-AES&#34;</span><span class="op" id="7457827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457831">command</span><span class="op" id="7457838">:</span>&nbsp;<span class="op" id="7457840">[</span><span class="op" id="7457841">]</span><span class="builtintype" id="7457842">string</span><span class="op" id="7457848">{</span><span class="string" id="7457849">&#34;openssl&#34;</span><span class="op" id="7457858">,</span>&nbsp;<span class="string" id="7457860">&#34;s_client&#34;</span><span class="op" id="7457870">,</span>&nbsp;<span class="string" id="7457872">&#34;-no_ticket&#34;</span><span class="op" id="7457884">,</span>&nbsp;<span class="string" id="7457886">&#34;-cipher&#34;</span><span class="op" id="7457895">,</span>&nbsp;<span class="string" id="7457897">&#34;AES128-SHA&#34;</span><span class="op" id="7457909">}</span><span class="op" id="7457910">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457916"><a href="/crypto/tls/handshake_server_test.go.html#7456684">runServerTestSSLv3</a></span><span class="op" id="7457934">(</span><span class="ident" id="7457935"><a href="/crypto/tls/handshake_server_test.go.html#7457769">t</a></span><span class="op" id="7457936">,</span>&nbsp;<span class="ident" id="7457938"><a href="/crypto/tls/handshake_server_test.go.html#7457786">test</a></span><span class="op" id="7457942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457945"><a href="/crypto/tls/handshake_server_test.go.html#7456806">runServerTestTLS10</a></span><span class="op" id="7457963">(</span><span class="ident" id="7457964"><a href="/crypto/tls/handshake_server_test.go.html#7457769">t</a></span><span class="op" id="7457965">,</span>&nbsp;<span class="ident" id="7457967"><a href="/crypto/tls/handshake_server_test.go.html#7457786">test</a></span><span class="op" id="7457971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457974"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7457992">(</span><span class="ident" id="7457993"><a href="/crypto/tls/handshake_server_test.go.html#7457769">t</a></span><span class="op" id="7457994">,</span>&nbsp;<span class="ident" id="7457996"><a href="/crypto/tls/handshake_server_test.go.html#7457786">test</a></span><span class="op" id="7458000">)</span><br>
<span class="lineno"></span><span class="op" id="7458002">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="7458005">func</span>&nbsp;<span class="ident" id="7458010">TestHandshakeServerAESGCM</span><span class="op" id="7458035">(</span><span class="ident" id="7458036">t</span>&nbsp;<span class="op" id="7458038">*</span><span class="ident" id="7458039"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7458046">.</span><span class="ident" id="7458047">T</span><span class="op" id="7458048">)</span>&nbsp;<span class="op" id="7458050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458053">test</span>&nbsp;<span class="op" id="7458058">:=</span>&nbsp;<span class="op" id="7458061">&amp;</span><span class="ident" id="7458062"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7458072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458076">name</span><span class="op" id="7458080">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7458085">&#34;RSA-AES-GCM&#34;</span><span class="op" id="7458098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458102">command</span><span class="op" id="7458109">:</span>&nbsp;<span class="op" id="7458111">[</span><span class="op" id="7458112">]</span><span class="builtintype" id="7458113">string</span><span class="op" id="7458119">{</span><span class="string" id="7458120">&#34;openssl&#34;</span><span class="op" id="7458129">,</span>&nbsp;<span class="string" id="7458131">&#34;s_client&#34;</span><span class="op" id="7458141">,</span>&nbsp;<span class="string" id="7458143">&#34;-no_ticket&#34;</span><span class="op" id="7458155">,</span>&nbsp;<span class="string" id="7458157">&#34;-cipher&#34;</span><span class="op" id="7458166">,</span>&nbsp;<span class="string" id="7458168">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7458197">}</span><span class="op" id="7458198">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7458201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458204"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7458222">(</span><span class="ident" id="7458223"><a href="/crypto/tls/handshake_server_test.go.html#7458036">t</a></span><span class="op" id="7458224">,</span>&nbsp;<span class="ident" id="7458226"><a href="/crypto/tls/handshake_server_test.go.html#7458053">test</a></span><span class="op" id="7458230">)</span><br>
<span class="lineno"></span><span class="op" id="7458232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7458235">func</span>&nbsp;<span class="ident" id="7458240">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="7458272">(</span><span class="ident" id="7458273">t</span>&nbsp;<span class="op" id="7458275">*</span><span class="ident" id="7458276"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7458283">.</span><span class="ident" id="7458284">T</span><span class="op" id="7458285">)</span>&nbsp;<span class="op" id="7458287">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458290">config</span>&nbsp;<span class="op" id="7458297">:=</span>&nbsp;<span class="op" id="7458300">*</span><span class="ident" id="7458301"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458313"><a href="/crypto/tls/handshake_server_test.go.html#7458290">config</a></span><span class="op" id="7458319">.</span><span class="ident" id="7458320">Certificates</span>&nbsp;<span class="op" id="7458333">=</span>&nbsp;<span class="builtinfunc" id="7458335">make</span><span class="op" id="7458339">(</span><span class="op" id="7458340">[</span><span class="op" id="7458341">]</span><span class="ident" id="7458342"><a href="/crypto/tls/common.go.html#3838319">Certificate</a></span><span class="op" id="7458353">,</span>&nbsp;<span class="num" id="7458355">1</span><span class="op" id="7458356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458359"><a href="/crypto/tls/handshake_server_test.go.html#7458290">config</a></span><span class="op" id="7458365">.</span><span class="ident" id="7458366">Certificates</span><span class="op" id="7458378">[</span><span class="num" id="7458379">0</span><span class="op" id="7458380">]</span><span class="op" id="7458381">.</span><span class="ident" id="7458382">Certificate</span>&nbsp;<span class="op" id="7458394">=</span>&nbsp;<span class="op" id="7458396">[</span><span class="op" id="7458397">]</span><span class="op" id="7458398">[</span><span class="op" id="7458399">]</span><span class="builtintype" id="7458400">byte</span><span class="op" id="7458404">{</span><span class="ident" id="7458405"><a href="/crypto/tls/handshake_server_test.go.html#7470912">testECDSACertificate</a></span><span class="op" id="7458425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458428"><a href="/crypto/tls/handshake_server_test.go.html#7458290">config</a></span><span class="op" id="7458434">.</span><span class="ident" id="7458435">Certificates</span><span class="op" id="7458447">[</span><span class="num" id="7458448">0</span><span class="op" id="7458449">]</span><span class="op" id="7458450">.</span><span class="ident" id="7458451">PrivateKey</span>&nbsp;<span class="op" id="7458462">=</span>&nbsp;<span class="ident" id="7458464"><a href="/crypto/tls/handshake_server_test.go.html#7474154">testECDSAPrivateKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458485"><a href="/crypto/tls/handshake_server_test.go.html#7458290">config</a></span><span class="op" id="7458491">.</span><span class="ident" id="7458492">BuildNameToCertificate</span><span class="op" id="7458514">(</span><span class="op" id="7458515">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458519">test</span>&nbsp;<span class="op" id="7458524">:=</span>&nbsp;<span class="op" id="7458527">&amp;</span><span class="ident" id="7458528"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7458538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458542">name</span><span class="op" id="7458546">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7458551">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7458568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458572">command</span><span class="op" id="7458579">:</span>&nbsp;<span class="op" id="7458581">[</span><span class="op" id="7458582">]</span><span class="builtintype" id="7458583">string</span><span class="op" id="7458589">{</span><span class="string" id="7458590">&#34;openssl&#34;</span><span class="op" id="7458599">,</span>&nbsp;<span class="string" id="7458601">&#34;s_client&#34;</span><span class="op" id="7458611">,</span>&nbsp;<span class="string" id="7458613">&#34;-no_ticket&#34;</span><span class="op" id="7458625">,</span>&nbsp;<span class="string" id="7458627">&#34;-cipher&#34;</span><span class="op" id="7458636">,</span>&nbsp;<span class="string" id="7458638">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="7458662">}</span><span class="op" id="7458663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458667">config</span><span class="op" id="7458673">:</span>&nbsp;&nbsp;<span class="op" id="7458676">&amp;</span><span class="ident" id="7458677"><a href="/crypto/tls/handshake_server_test.go.html#7458290">config</a></span><span class="op" id="7458683">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7458686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458689"><a href="/crypto/tls/handshake_server_test.go.html#7456806">runServerTestTLS10</a></span><span class="op" id="7458707">(</span><span class="ident" id="7458708"><a href="/crypto/tls/handshake_server_test.go.html#7458273">t</a></span><span class="op" id="7458709">,</span>&nbsp;<span class="ident" id="7458711"><a href="/crypto/tls/handshake_server_test.go.html#7458519">test</a></span><span class="op" id="7458715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458718"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7458736">(</span><span class="ident" id="7458737"><a href="/crypto/tls/handshake_server_test.go.html#7458273">t</a></span><span class="op" id="7458738">,</span>&nbsp;<span class="ident" id="7458740"><a href="/crypto/tls/handshake_server_test.go.html#7458519">test</a></span><span class="op" id="7458744">)</span><br>
<span class="lineno"></span><span class="op" id="7458746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="7458749">func</span>&nbsp;<span class="ident" id="7458754">TestHandshakeServerALPN</span><span class="op" id="7458777">(</span><span class="ident" id="7458778">t</span>&nbsp;<span class="op" id="7458780">*</span><span class="ident" id="7458781"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7458788">.</span><span class="ident" id="7458789">T</span><span class="op" id="7458790">)</span>&nbsp;<span class="op" id="7458792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458795">config</span>&nbsp;<span class="op" id="7458802">:=</span>&nbsp;<span class="op" id="7458805">*</span><span class="ident" id="7458806"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458818"><a href="/crypto/tls/handshake_server_test.go.html#7458795">config</a></span><span class="op" id="7458824">.</span><span class="ident" id="7458825">NextProtos</span>&nbsp;<span class="op" id="7458836">=</span>&nbsp;<span class="op" id="7458838">[</span><span class="op" id="7458839">]</span><span class="builtintype" id="7458840">string</span><span class="op" id="7458846">{</span><span class="string" id="7458847">&#34;proto1&#34;</span><span class="op" id="7458855">,</span>&nbsp;<span class="string" id="7458857">&#34;proto2&#34;</span><span class="op" id="7458865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458869">test</span>&nbsp;<span class="op" id="7458874">:=</span>&nbsp;<span class="op" id="7458877">&amp;</span><span class="ident" id="7458878"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7458888">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458892">name</span><span class="op" id="7458896">:</span>&nbsp;<span class="string" id="7458898">&#34;ALPN&#34;</span><span class="op" id="7458904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7458908">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7458974">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459017">command</span><span class="op" id="7459024">:</span>&nbsp;<span class="op" id="7459026">[</span><span class="op" id="7459027">]</span><span class="builtintype" id="7459028">string</span><span class="op" id="7459034">{</span><span class="string" id="7459035">&#34;openssl&#34;</span><span class="op" id="7459044">,</span>&nbsp;<span class="string" id="7459046">&#34;s_client&#34;</span><span class="op" id="7459056">,</span>&nbsp;<span class="string" id="7459058">&#34;-alpn&#34;</span><span class="op" id="7459065">,</span>&nbsp;<span class="string" id="7459067">&#34;proto2,proto1&#34;</span><span class="op" id="7459082">}</span><span class="op" id="7459083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459087">config</span><span class="op" id="7459093">:</span>&nbsp;&nbsp;<span class="op" id="7459096">&amp;</span><span class="ident" id="7459097"><a href="/crypto/tls/handshake_server_test.go.html#7458795">config</a></span><span class="op" id="7459103">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459107">validate</span><span class="op" id="7459115">:</span>&nbsp;<span class="keyword" id="7459117">func</span><span class="op" id="7459121">(</span><span class="ident" id="7459122">state</span>&nbsp;<span class="ident" id="7459128"><a href="/crypto/tls/common.go.html#3826826">ConnectionState</a></span><span class="op" id="7459143">)</span>&nbsp;<span class="builtintype" id="7459145">error</span>&nbsp;<span class="op" id="7459151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7459156">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7459215">if</span>&nbsp;<span class="ident" id="7459218"><a href="/crypto/tls/handshake_server_test.go.html#7459122">state</a></span><span class="op" id="7459223">.</span><span class="ident" id="7459224">NegotiatedProtocol</span>&nbsp;<span class="op" id="7459243">!=</span>&nbsp;<span class="string" id="7459246">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7459255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7459261">return</span>&nbsp;<span class="ident" id="7459268"><a href="/crypto/tls/handshake_server_test.go.html#7444093">fmt</a></span><span class="op" id="7459271">.</span><span class="ident" id="7459272">Errorf</span><span class="op" id="7459278">(</span><span class="string" id="7459279">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7459311">,</span>&nbsp;<span class="ident" id="7459313"><a href="/crypto/tls/handshake_server_test.go.html#7459122">state</a></span><span class="op" id="7459318">.</span><span class="ident" id="7459319">NegotiatedProtocol</span><span class="op" id="7459337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7459342">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7459347">return</span>&nbsp;<span class="ident" id="7459354">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7459360">}</span><span class="op" id="7459361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7459364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459367"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7459385">(</span><span class="ident" id="7459386"><a href="/crypto/tls/handshake_server_test.go.html#7458778">t</a></span><span class="op" id="7459387">,</span>&nbsp;<span class="ident" id="7459389"><a href="/crypto/tls/handshake_server_test.go.html#7458869">test</a></span><span class="op" id="7459393">)</span><br>
<span class="lineno"></span><span class="op" id="7459395">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="7459398">func</span>&nbsp;<span class="ident" id="7459403">TestHandshakeServerALPNNoMatch</span><span class="op" id="7459433">(</span><span class="ident" id="7459434">t</span>&nbsp;<span class="op" id="7459436">*</span><span class="ident" id="7459437"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7459444">.</span><span class="ident" id="7459445">T</span><span class="op" id="7459446">)</span>&nbsp;<span class="op" id="7459448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459451">config</span>&nbsp;<span class="op" id="7459458">:=</span>&nbsp;<span class="op" id="7459461">*</span><span class="ident" id="7459462"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459474"><a href="/crypto/tls/handshake_server_test.go.html#7459451">config</a></span><span class="op" id="7459480">.</span><span class="ident" id="7459481">NextProtos</span>&nbsp;<span class="op" id="7459492">=</span>&nbsp;<span class="op" id="7459494">[</span><span class="op" id="7459495">]</span><span class="builtintype" id="7459496">string</span><span class="op" id="7459502">{</span><span class="string" id="7459503">&#34;proto3&#34;</span><span class="op" id="7459511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459515">test</span>&nbsp;<span class="op" id="7459520">:=</span>&nbsp;<span class="op" id="7459523">&amp;</span><span class="ident" id="7459524"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7459534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459538">name</span><span class="op" id="7459542">:</span>&nbsp;<span class="string" id="7459544">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7459558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7459562">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7459628">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459671">command</span><span class="op" id="7459678">:</span>&nbsp;<span class="op" id="7459680">[</span><span class="op" id="7459681">]</span><span class="builtintype" id="7459682">string</span><span class="op" id="7459688">{</span><span class="string" id="7459689">&#34;openssl&#34;</span><span class="op" id="7459698">,</span>&nbsp;<span class="string" id="7459700">&#34;s_client&#34;</span><span class="op" id="7459710">,</span>&nbsp;<span class="string" id="7459712">&#34;-alpn&#34;</span><span class="op" id="7459719">,</span>&nbsp;<span class="string" id="7459721">&#34;proto2,proto1&#34;</span><span class="op" id="7459736">}</span><span class="op" id="7459737">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459741">config</span><span class="op" id="7459747">:</span>&nbsp;&nbsp;<span class="op" id="7459750">&amp;</span><span class="ident" id="7459751"><a href="/crypto/tls/handshake_server_test.go.html#7459451">config</a></span><span class="op" id="7459757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459761">validate</span><span class="op" id="7459769">:</span>&nbsp;<span class="keyword" id="7459771">func</span><span class="op" id="7459775">(</span><span class="ident" id="7459776">state</span>&nbsp;<span class="ident" id="7459782"><a href="/crypto/tls/common.go.html#3826826">ConnectionState</a></span><span class="op" id="7459797">)</span>&nbsp;<span class="builtintype" id="7459799">error</span>&nbsp;<span class="op" id="7459805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7459810">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7459869">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7459912">if</span>&nbsp;<span class="ident" id="7459915"><a href="/crypto/tls/handshake_server_test.go.html#7459776">state</a></span><span class="op" id="7459920">.</span><span class="ident" id="7459921">NegotiatedProtocol</span>&nbsp;<span class="op" id="7459940">!=</span>&nbsp;<span class="string" id="7459943">&#34;&#34;</span>&nbsp;<span class="op" id="7459946">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7459952">return</span>&nbsp;<span class="ident" id="7459959"><a href="/crypto/tls/handshake_server_test.go.html#7444093">fmt</a></span><span class="op" id="7459962">.</span><span class="ident" id="7459963">Errorf</span><span class="op" id="7459969">(</span><span class="string" id="7459970">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7459998">,</span>&nbsp;<span class="ident" id="7460000"><a href="/crypto/tls/handshake_server_test.go.html#7459776">state</a></span><span class="op" id="7460005">.</span><span class="ident" id="7460006">NegotiatedProtocol</span><span class="op" id="7460024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7460029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7460034">return</span>&nbsp;<span class="ident" id="7460041">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7460047">}</span><span class="op" id="7460048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7460051">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460054"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7460072">(</span><span class="ident" id="7460073"><a href="/crypto/tls/handshake_server_test.go.html#7459434">t</a></span><span class="op" id="7460074">,</span>&nbsp;<span class="ident" id="7460076"><a href="/crypto/tls/handshake_server_test.go.html#7459515">test</a></span><span class="op" id="7460080">)</span><br>
<span class="lineno"></span><span class="op" id="7460082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7460085">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7460157">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="7460237">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7460301">func</span>&nbsp;<span class="ident" id="7460306">TestHandshakeServerSNI</span><span class="op" id="7460328">(</span><span class="ident" id="7460329">t</span>&nbsp;<span class="op" id="7460331">*</span><span class="ident" id="7460332"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7460339">.</span><span class="ident" id="7460340">T</span><span class="op" id="7460341">)</span>&nbsp;<span class="op" id="7460343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460346">test</span>&nbsp;<span class="op" id="7460351">:=</span>&nbsp;<span class="op" id="7460354">&amp;</span><span class="ident" id="7460355"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7460365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460369">name</span><span class="op" id="7460373">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7460378">&#34;SNI&#34;</span><span class="op" id="7460383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460387">command</span><span class="op" id="7460394">:</span>&nbsp;<span class="op" id="7460396">[</span><span class="op" id="7460397">]</span><span class="builtintype" id="7460398">string</span><span class="op" id="7460404">{</span><span class="string" id="7460405">&#34;openssl&#34;</span><span class="op" id="7460414">,</span>&nbsp;<span class="string" id="7460416">&#34;s_client&#34;</span><span class="op" id="7460426">,</span>&nbsp;<span class="string" id="7460428">&#34;-no_ticket&#34;</span><span class="op" id="7460440">,</span>&nbsp;<span class="string" id="7460442">&#34;-cipher&#34;</span><span class="op" id="7460451">,</span>&nbsp;<span class="string" id="7460453">&#34;AES128-SHA&#34;</span><span class="op" id="7460465">,</span>&nbsp;<span class="string" id="7460467">&#34;-servername&#34;</span><span class="op" id="7460480">,</span>&nbsp;<span class="string" id="7460482">&#34;snitest.com&#34;</span><span class="op" id="7460495">}</span><span class="op" id="7460496">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7460499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460502"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7460520">(</span><span class="ident" id="7460521"><a href="/crypto/tls/handshake_server_test.go.html#7460329">t</a></span><span class="op" id="7460522">,</span>&nbsp;<span class="ident" id="7460524"><a href="/crypto/tls/handshake_server_test.go.html#7460346">test</a></span><span class="op" id="7460528">)</span><br>
<span class="lineno"></span><span class="op" id="7460530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7460533">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="7460612">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="7460655">func</span>&nbsp;<span class="ident" id="7460660">TestHandshakeServerSNIGetCertificate</span><span class="op" id="7460696">(</span><span class="ident" id="7460697">t</span>&nbsp;<span class="op" id="7460699">*</span><span class="ident" id="7460700"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7460707">.</span><span class="ident" id="7460708">T</span><span class="op" id="7460709">)</span>&nbsp;<span class="op" id="7460711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460714">config</span>&nbsp;<span class="op" id="7460721">:=</span>&nbsp;<span class="op" id="7460724">*</span><span class="ident" id="7460725"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7460738">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460807">nameToCert</span>&nbsp;<span class="op" id="7460818">:=</span>&nbsp;<span class="ident" id="7460821"><a href="/crypto/tls/handshake_server_test.go.html#7460714">config</a></span><span class="op" id="7460827">.</span><span class="ident" id="7460828">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460847"><a href="/crypto/tls/handshake_server_test.go.html#7460714">config</a></span><span class="op" id="7460853">.</span><span class="ident" id="7460854">NameToCertificate</span>&nbsp;<span class="op" id="7460872">=</span>&nbsp;<span class="ident" id="7460874">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460879"><a href="/crypto/tls/handshake_server_test.go.html#7460714">config</a></span><span class="op" id="7460885">.</span><span class="ident" id="7460886">GetCertificate</span>&nbsp;<span class="op" id="7460901">=</span>&nbsp;<span class="keyword" id="7460903">func</span><span class="op" id="7460907">(</span><span class="ident" id="7460908">clientHello</span>&nbsp;<span class="op" id="7460920">*</span><span class="ident" id="7460921"><a href="/crypto/tls/common.go.html#3829703">ClientHelloInfo</a></span><span class="op" id="7460936">)</span>&nbsp;<span class="op" id="7460938">(</span><span class="op" id="7460939">*</span><span class="ident" id="7460940"><a href="/crypto/tls/common.go.html#3838319">Certificate</a></span><span class="op" id="7460951">,</span>&nbsp;<span class="builtintype" id="7460953">error</span><span class="op" id="7460958">)</span>&nbsp;<span class="op" id="7460960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460964">cert</span><span class="op" id="7460968">,</span>&nbsp;<span class="ident" id="7460970">_</span>&nbsp;<span class="op" id="7460972">:=</span>&nbsp;<span class="ident" id="7460975"><a href="/crypto/tls/handshake_server_test.go.html#7460807">nameToCert</a></span><span class="op" id="7460985">[</span><span class="ident" id="7460986"><a href="/crypto/tls/handshake_server_test.go.html#7460908">clientHello</a></span><span class="op" id="7460997">.</span><span class="ident" id="7460998">ServerName</span><span class="op" id="7461008">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7461012">return</span>&nbsp;<span class="ident" id="7461019"><a href="/crypto/tls/handshake_server_test.go.html#7460964">cert</a></span><span class="op" id="7461023">,</span>&nbsp;<span class="ident" id="7461025">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7461030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461033">test</span>&nbsp;<span class="op" id="7461038">:=</span>&nbsp;<span class="op" id="7461041">&amp;</span><span class="ident" id="7461042"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7461052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461056">name</span><span class="op" id="7461060">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7461065">&#34;SNI&#34;</span><span class="op" id="7461070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461074">command</span><span class="op" id="7461081">:</span>&nbsp;<span class="op" id="7461083">[</span><span class="op" id="7461084">]</span><span class="builtintype" id="7461085">string</span><span class="op" id="7461091">{</span><span class="string" id="7461092">&#34;openssl&#34;</span><span class="op" id="7461101">,</span>&nbsp;<span class="string" id="7461103">&#34;s_client&#34;</span><span class="op" id="7461113">,</span>&nbsp;<span class="string" id="7461115">&#34;-no_ticket&#34;</span><span class="op" id="7461127">,</span>&nbsp;<span class="string" id="7461129">&#34;-cipher&#34;</span><span class="op" id="7461138">,</span>&nbsp;<span class="string" id="7461140">&#34;AES128-SHA&#34;</span><span class="op" id="7461152">,</span>&nbsp;<span class="string" id="7461154">&#34;-servername&#34;</span><span class="op" id="7461167">,</span>&nbsp;<span class="string" id="7461169">&#34;snitest.com&#34;</span><span class="op" id="7461182">}</span><span class="op" id="7461183">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461187">config</span><span class="op" id="7461193">:</span>&nbsp;&nbsp;<span class="op" id="7461196">&amp;</span><span class="ident" id="7461197"><a href="/crypto/tls/handshake_server_test.go.html#7460714">config</a></span><span class="op" id="7461203">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7461206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461209"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7461227">(</span><span class="ident" id="7461228"><a href="/crypto/tls/handshake_server_test.go.html#7460697">t</a></span><span class="op" id="7461229">,</span>&nbsp;<span class="ident" id="7461231"><a href="/crypto/tls/handshake_server_test.go.html#7461033">test</a></span><span class="op" id="7461235">)</span><br>
<span class="lineno"></span><span class="op" id="7461237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7461240">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="7461299">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7461374">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7461448">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="7461478">func</span>&nbsp;<span class="ident" id="7461483">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="7461527">(</span><span class="ident" id="7461528">t</span>&nbsp;<span class="op" id="7461530">*</span><span class="ident" id="7461531"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7461538">.</span><span class="ident" id="7461539">T</span><span class="op" id="7461540">)</span>&nbsp;<span class="op" id="7461542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461545">config</span>&nbsp;<span class="op" id="7461552">:=</span>&nbsp;<span class="op" id="7461555">*</span><span class="ident" id="7461556"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461569"><a href="/crypto/tls/handshake_server_test.go.html#7461545">config</a></span><span class="op" id="7461575">.</span><span class="ident" id="7461576">GetCertificate</span>&nbsp;<span class="op" id="7461591">=</span>&nbsp;<span class="keyword" id="7461593">func</span><span class="op" id="7461597">(</span><span class="ident" id="7461598">clientHello</span>&nbsp;<span class="op" id="7461610">*</span><span class="ident" id="7461611"><a href="/crypto/tls/common.go.html#3829703">ClientHelloInfo</a></span><span class="op" id="7461626">)</span>&nbsp;<span class="op" id="7461628">(</span><span class="op" id="7461629">*</span><span class="ident" id="7461630"><a href="/crypto/tls/common.go.html#3838319">Certificate</a></span><span class="op" id="7461641">,</span>&nbsp;<span class="builtintype" id="7461643">error</span><span class="op" id="7461648">)</span>&nbsp;<span class="op" id="7461650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7461654">return</span>&nbsp;<span class="ident" id="7461661">nil</span><span class="op" id="7461664">,</span>&nbsp;<span class="ident" id="7461666">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7461671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461674">test</span>&nbsp;<span class="op" id="7461679">:=</span>&nbsp;<span class="op" id="7461682">&amp;</span><span class="ident" id="7461683"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7461693">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461697">name</span><span class="op" id="7461701">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7461706">&#34;SNI&#34;</span><span class="op" id="7461711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461715">command</span><span class="op" id="7461722">:</span>&nbsp;<span class="op" id="7461724">[</span><span class="op" id="7461725">]</span><span class="builtintype" id="7461726">string</span><span class="op" id="7461732">{</span><span class="string" id="7461733">&#34;openssl&#34;</span><span class="op" id="7461742">,</span>&nbsp;<span class="string" id="7461744">&#34;s_client&#34;</span><span class="op" id="7461754">,</span>&nbsp;<span class="string" id="7461756">&#34;-no_ticket&#34;</span><span class="op" id="7461768">,</span>&nbsp;<span class="string" id="7461770">&#34;-cipher&#34;</span><span class="op" id="7461779">,</span>&nbsp;<span class="string" id="7461781">&#34;AES128-SHA&#34;</span><span class="op" id="7461793">,</span>&nbsp;<span class="string" id="7461795">&#34;-servername&#34;</span><span class="op" id="7461808">,</span>&nbsp;<span class="string" id="7461810">&#34;snitest.com&#34;</span><span class="op" id="7461823">}</span><span class="op" id="7461824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461828">config</span><span class="op" id="7461834">:</span>&nbsp;&nbsp;<span class="op" id="7461837">&amp;</span><span class="ident" id="7461838"><a href="/crypto/tls/handshake_server_test.go.html#7461545">config</a></span><span class="op" id="7461844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7461847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461850"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7461868">(</span><span class="ident" id="7461869"><a href="/crypto/tls/handshake_server_test.go.html#7461528">t</a></span><span class="op" id="7461870">,</span>&nbsp;<span class="ident" id="7461872"><a href="/crypto/tls/handshake_server_test.go.html#7461674">test</a></span><span class="op" id="7461876">)</span><br>
<span class="lineno">625</span><span class="op" id="7461878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7461881">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7461957">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="7461998">func</span>&nbsp;<span class="ident" id="7462003">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="7462044">(</span><span class="ident" id="7462045">t</span>&nbsp;<span class="op" id="7462047">*</span><span class="ident" id="7462048"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7462055">.</span><span class="ident" id="7462056">T</span><span class="op" id="7462057">)</span>&nbsp;<span class="op" id="7462059">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462062">config</span>&nbsp;<span class="op" id="7462069">:=</span>&nbsp;<span class="op" id="7462072">*</span><span class="ident" id="7462073"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462086"><a href="/crypto/tls/handshake_server_test.go.html#7462062">config</a></span><span class="op" id="7462092">.</span><span class="ident" id="7462093">GetCertificate</span>&nbsp;<span class="op" id="7462108">=</span>&nbsp;<span class="keyword" id="7462110">func</span><span class="op" id="7462114">(</span><span class="ident" id="7462115">clientHello</span>&nbsp;<span class="op" id="7462127">*</span><span class="ident" id="7462128"><a href="/crypto/tls/common.go.html#3829703">ClientHelloInfo</a></span><span class="op" id="7462143">)</span>&nbsp;<span class="op" id="7462145">(</span><span class="op" id="7462146">*</span><span class="ident" id="7462147"><a href="/crypto/tls/common.go.html#3838319">Certificate</a></span><span class="op" id="7462158">,</span>&nbsp;<span class="builtintype" id="7462160">error</span><span class="op" id="7462165">)</span>&nbsp;<span class="op" id="7462167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7462171">return</span>&nbsp;<span class="ident" id="7462178">nil</span><span class="op" id="7462181">,</span>&nbsp;<span class="ident" id="7462183"><a href="/crypto/tls/handshake_server_test.go.html#7444093">fmt</a></span><span class="op" id="7462186">.</span><span class="ident" id="7462187">Errorf</span><span class="op" id="7462193">(</span><span class="string" id="7462194">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="7462224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7462227">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462230">test</span>&nbsp;<span class="op" id="7462235">:=</span>&nbsp;<span class="op" id="7462238">&amp;</span><span class="ident" id="7462239"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7462249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462253">name</span><span class="op" id="7462257">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7462266">&#34;SNI&#34;</span><span class="op" id="7462271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462275">command</span><span class="op" id="7462282">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7462288">[</span><span class="op" id="7462289">]</span><span class="builtintype" id="7462290">string</span><span class="op" id="7462296">{</span><span class="string" id="7462297">&#34;openssl&#34;</span><span class="op" id="7462306">,</span>&nbsp;<span class="string" id="7462308">&#34;s_client&#34;</span><span class="op" id="7462318">,</span>&nbsp;<span class="string" id="7462320">&#34;-no_ticket&#34;</span><span class="op" id="7462332">,</span>&nbsp;<span class="string" id="7462334">&#34;-cipher&#34;</span><span class="op" id="7462343">,</span>&nbsp;<span class="string" id="7462345">&#34;AES128-SHA&#34;</span><span class="op" id="7462357">,</span>&nbsp;<span class="string" id="7462359">&#34;-servername&#34;</span><span class="op" id="7462372">,</span>&nbsp;<span class="string" id="7462374">&#34;snitest.com&#34;</span><span class="op" id="7462387">}</span><span class="op" id="7462388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462392">config</span><span class="op" id="7462398">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7462405">&amp;</span><span class="ident" id="7462406"><a href="/crypto/tls/handshake_server_test.go.html#7462062">config</a></span><span class="op" id="7462412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462416">expectAlert</span><span class="op" id="7462427">:</span>&nbsp;<span class="builtintype" id="7462429">true</span><span class="op" id="7462433">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7462436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462439"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7462457">(</span><span class="ident" id="7462458"><a href="/crypto/tls/handshake_server_test.go.html#7462045">t</a></span><span class="op" id="7462459">,</span>&nbsp;<span class="ident" id="7462461"><a href="/crypto/tls/handshake_server_test.go.html#7462230">test</a></span><span class="op" id="7462465">)</span><br>
<span class="lineno"></span><span class="op" id="7462467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7462470">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="7462550">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7462624">func</span>&nbsp;<span class="ident" id="7462629">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="7462663">(</span><span class="ident" id="7462664">t</span>&nbsp;<span class="op" id="7462666">*</span><span class="ident" id="7462667"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7462674">.</span><span class="ident" id="7462675">T</span><span class="op" id="7462676">)</span>&nbsp;<span class="op" id="7462678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462681">config</span>&nbsp;<span class="op" id="7462688">:=</span>&nbsp;<span class="op" id="7462691">*</span><span class="ident" id="7462692"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462704"><a href="/crypto/tls/handshake_server_test.go.html#7462681">config</a></span><span class="op" id="7462710">.</span><span class="ident" id="7462711">CipherSuites</span>&nbsp;<span class="op" id="7462724">=</span>&nbsp;<span class="op" id="7462726">[</span><span class="op" id="7462727">]</span><span class="builtintype" id="7462728">uint16</span><span class="op" id="7462734">{</span><span class="ident" id="7462735"><a href="/crypto/tls/cipher_suites.go.html#3821845">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</a></span><span class="op" id="7462771">,</span>&nbsp;<span class="ident" id="7462773"><a href="/crypto/tls/cipher_suites.go.html#3822073">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</a></span><span class="op" id="7462807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462810"><a href="/crypto/tls/handshake_server_test.go.html#7462681">config</a></span><span class="op" id="7462816">.</span><span class="ident" id="7462817">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7462842">=</span>&nbsp;<span class="builtintype" id="7462844">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462851">test</span>&nbsp;<span class="op" id="7462856">:=</span>&nbsp;<span class="op" id="7462859">&amp;</span><span class="ident" id="7462860"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7462870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462874">name</span><span class="op" id="7462878">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7462882">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="7462912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462916">config</span><span class="op" id="7462922">:</span>&nbsp;<span class="op" id="7462924">&amp;</span><span class="ident" id="7462925"><a href="/crypto/tls/handshake_server_test.go.html#7462681">config</a></span><span class="op" id="7462931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7462934">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462937"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7462955">(</span><span class="ident" id="7462956"><a href="/crypto/tls/handshake_server_test.go.html#7462664">t</a></span><span class="op" id="7462957">,</span>&nbsp;<span class="ident" id="7462959"><a href="/crypto/tls/handshake_server_test.go.html#7462851">test</a></span><span class="op" id="7462963">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462967"><a href="/crypto/tls/handshake_server_test.go.html#7462681">config</a></span>&nbsp;<span class="op" id="7462974">=</span>&nbsp;<span class="op" id="7462976">*</span><span class="ident" id="7462977"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462989"><a href="/crypto/tls/handshake_server_test.go.html#7462681">config</a></span><span class="op" id="7462995">.</span><span class="ident" id="7462996">CipherSuites</span>&nbsp;<span class="op" id="7463009">=</span>&nbsp;<span class="op" id="7463011">[</span><span class="op" id="7463012">]</span><span class="builtintype" id="7463013">uint16</span><span class="op" id="7463019">{</span><span class="ident" id="7463020"><a href="/crypto/tls/cipher_suites.go.html#3822073">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</a></span><span class="op" id="7463054">,</span>&nbsp;<span class="ident" id="7463056"><a href="/crypto/tls/cipher_suites.go.html#3821845">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</a></span><span class="op" id="7463092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463095"><a href="/crypto/tls/handshake_server_test.go.html#7462681">config</a></span><span class="op" id="7463101">.</span><span class="ident" id="7463102">Certificates</span>&nbsp;<span class="op" id="7463115">=</span>&nbsp;<span class="op" id="7463117">[</span><span class="op" id="7463118">]</span><span class="ident" id="7463119"><a href="/crypto/tls/common.go.html#3838319">Certificate</a></span><span class="op" id="7463130">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463139">Certificate</span><span class="op" id="7463150">:</span>&nbsp;<span class="op" id="7463152">[</span><span class="op" id="7463153">]</span><span class="op" id="7463154">[</span><span class="op" id="7463155">]</span><span class="builtintype" id="7463156">byte</span><span class="op" id="7463160">{</span><span class="ident" id="7463161"><a href="/crypto/tls/handshake_server_test.go.html#7470912">testECDSACertificate</a></span><span class="op" id="7463181">}</span><span class="op" id="7463182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463187">PrivateKey</span><span class="op" id="7463197">:</span>&nbsp;&nbsp;<span class="ident" id="7463200"><a href="/crypto/tls/handshake_server_test.go.html#7474154">testECDSAPrivateKey</a></span><span class="op" id="7463219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463223">}</span><span class="op" id="7463224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463227">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463230"><a href="/crypto/tls/handshake_server_test.go.html#7462681">config</a></span><span class="op" id="7463236">.</span><span class="ident" id="7463237">BuildNameToCertificate</span><span class="op" id="7463259">(</span><span class="op" id="7463260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463263"><a href="/crypto/tls/handshake_server_test.go.html#7462681">config</a></span><span class="op" id="7463269">.</span><span class="ident" id="7463270">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7463295">=</span>&nbsp;<span class="builtintype" id="7463297">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463304"><a href="/crypto/tls/handshake_server_test.go.html#7462851">test</a></span>&nbsp;<span class="op" id="7463309">=</span>&nbsp;<span class="op" id="7463311">&amp;</span><span class="ident" id="7463312"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7463322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463326">name</span><span class="op" id="7463330">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7463334">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="7463366">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463370">config</span><span class="op" id="7463376">:</span>&nbsp;<span class="op" id="7463378">&amp;</span><span class="ident" id="7463379"><a href="/crypto/tls/handshake_server_test.go.html#7462681">config</a></span><span class="op" id="7463385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463391"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7463409">(</span><span class="ident" id="7463410"><a href="/crypto/tls/handshake_server_test.go.html#7462664">t</a></span><span class="op" id="7463411">,</span>&nbsp;<span class="ident" id="7463413"><a href="/crypto/tls/handshake_server_test.go.html#7462851">test</a></span><span class="op" id="7463417">)</span><br>
<span class="lineno"></span><span class="op" id="7463419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="7463422">func</span>&nbsp;<span class="ident" id="7463427">TestResumption</span><span class="op" id="7463441">(</span><span class="ident" id="7463442">t</span>&nbsp;<span class="op" id="7463444">*</span><span class="ident" id="7463445"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7463452">.</span><span class="ident" id="7463453">T</span><span class="op" id="7463454">)</span>&nbsp;<span class="op" id="7463456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463459">sessionFilePath</span>&nbsp;<span class="op" id="7463475">:=</span>&nbsp;<span class="ident" id="7463478"><a href="/crypto/tls/handshake_test.go.html#7478903">tempFile</a></span><span class="op" id="7463486">(</span><span class="string" id="7463487">&#34;&#34;</span><span class="op" id="7463489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7463492">defer</span>&nbsp;<span class="ident" id="7463498"><a href="/crypto/tls/handshake_server_test.go.html#7444125">os</a></span><span class="op" id="7463500">.</span><span class="ident" id="7463501">Remove</span><span class="op" id="7463507">(</span><span class="ident" id="7463508"><a href="/crypto/tls/handshake_server_test.go.html#7463459">sessionFilePath</a></span><span class="op" id="7463523">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463527">test</span>&nbsp;<span class="op" id="7463532">:=</span>&nbsp;<span class="op" id="7463535">&amp;</span><span class="ident" id="7463536"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7463546">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463550">name</span><span class="op" id="7463554">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7463559">&#34;IssueTicket&#34;</span><span class="op" id="7463572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463576">command</span><span class="op" id="7463583">:</span>&nbsp;<span class="op" id="7463585">[</span><span class="op" id="7463586">]</span><span class="builtintype" id="7463587">string</span><span class="op" id="7463593">{</span><span class="string" id="7463594">&#34;openssl&#34;</span><span class="op" id="7463603">,</span>&nbsp;<span class="string" id="7463605">&#34;s_client&#34;</span><span class="op" id="7463615">,</span>&nbsp;<span class="string" id="7463617">&#34;-cipher&#34;</span><span class="op" id="7463626">,</span>&nbsp;<span class="string" id="7463628">&#34;RC4-SHA&#34;</span><span class="op" id="7463637">,</span>&nbsp;<span class="string" id="7463639">&#34;-sess_out&#34;</span><span class="op" id="7463650">,</span>&nbsp;<span class="ident" id="7463652"><a href="/crypto/tls/handshake_server_test.go.html#7463459">sessionFilePath</a></span><span class="op" id="7463667">}</span><span class="op" id="7463668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463674"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7463692">(</span><span class="ident" id="7463693"><a href="/crypto/tls/handshake_server_test.go.html#7463442">t</a></span><span class="op" id="7463694">,</span>&nbsp;<span class="ident" id="7463696"><a href="/crypto/tls/handshake_server_test.go.html#7463527">test</a></span><span class="op" id="7463700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463704"><a href="/crypto/tls/handshake_server_test.go.html#7463527">test</a></span>&nbsp;<span class="op" id="7463709">=</span>&nbsp;<span class="op" id="7463711">&amp;</span><span class="ident" id="7463712"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7463722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463726">name</span><span class="op" id="7463730">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7463735">&#34;Resume&#34;</span><span class="op" id="7463743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463747">command</span><span class="op" id="7463754">:</span>&nbsp;<span class="op" id="7463756">[</span><span class="op" id="7463757">]</span><span class="builtintype" id="7463758">string</span><span class="op" id="7463764">{</span><span class="string" id="7463765">&#34;openssl&#34;</span><span class="op" id="7463774">,</span>&nbsp;<span class="string" id="7463776">&#34;s_client&#34;</span><span class="op" id="7463786">,</span>&nbsp;<span class="string" id="7463788">&#34;-cipher&#34;</span><span class="op" id="7463797">,</span>&nbsp;<span class="string" id="7463799">&#34;RC4-SHA&#34;</span><span class="op" id="7463808">,</span>&nbsp;<span class="string" id="7463810">&#34;-sess_in&#34;</span><span class="op" id="7463820">,</span>&nbsp;<span class="ident" id="7463822"><a href="/crypto/tls/handshake_server_test.go.html#7463459">sessionFilePath</a></span><span class="op" id="7463837">}</span><span class="op" id="7463838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463844"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7463862">(</span><span class="ident" id="7463863"><a href="/crypto/tls/handshake_server_test.go.html#7463442">t</a></span><span class="op" id="7463864">,</span>&nbsp;<span class="ident" id="7463866"><a href="/crypto/tls/handshake_server_test.go.html#7463527">test</a></span><span class="op" id="7463870">)</span><br>
<span class="lineno">690</span><span class="op" id="7463872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7463875">func</span>&nbsp;<span class="ident" id="7463880">TestResumptionDisabled</span><span class="op" id="7463902">(</span><span class="ident" id="7463903">t</span>&nbsp;<span class="op" id="7463905">*</span><span class="ident" id="7463906"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7463913">.</span><span class="ident" id="7463914">T</span><span class="op" id="7463915">)</span>&nbsp;<span class="op" id="7463917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463920">sessionFilePath</span>&nbsp;<span class="op" id="7463936">:=</span>&nbsp;<span class="ident" id="7463939"><a href="/crypto/tls/handshake_test.go.html#7478903">tempFile</a></span><span class="op" id="7463947">(</span><span class="string" id="7463948">&#34;&#34;</span><span class="op" id="7463950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7463953">defer</span>&nbsp;<span class="ident" id="7463959"><a href="/crypto/tls/handshake_server_test.go.html#7444125">os</a></span><span class="op" id="7463961">.</span><span class="ident" id="7463962">Remove</span><span class="op" id="7463968">(</span><span class="ident" id="7463969"><a href="/crypto/tls/handshake_server_test.go.html#7463920">sessionFilePath</a></span><span class="op" id="7463984">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463988">config</span>&nbsp;<span class="op" id="7463995">:=</span>&nbsp;<span class="op" id="7463998">*</span><span class="ident" id="7463999"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464012">test</span>&nbsp;<span class="op" id="7464017">:=</span>&nbsp;<span class="op" id="7464020">&amp;</span><span class="ident" id="7464021"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7464031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464035">name</span><span class="op" id="7464039">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7464044">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="7464067">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464071">command</span><span class="op" id="7464078">:</span>&nbsp;<span class="op" id="7464080">[</span><span class="op" id="7464081">]</span><span class="builtintype" id="7464082">string</span><span class="op" id="7464088">{</span><span class="string" id="7464089">&#34;openssl&#34;</span><span class="op" id="7464098">,</span>&nbsp;<span class="string" id="7464100">&#34;s_client&#34;</span><span class="op" id="7464110">,</span>&nbsp;<span class="string" id="7464112">&#34;-cipher&#34;</span><span class="op" id="7464121">,</span>&nbsp;<span class="string" id="7464123">&#34;RC4-SHA&#34;</span><span class="op" id="7464132">,</span>&nbsp;<span class="string" id="7464134">&#34;-sess_out&#34;</span><span class="op" id="7464145">,</span>&nbsp;<span class="ident" id="7464147"><a href="/crypto/tls/handshake_server_test.go.html#7463920">sessionFilePath</a></span><span class="op" id="7464162">}</span><span class="op" id="7464163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464167">config</span><span class="op" id="7464173">:</span>&nbsp;&nbsp;<span class="op" id="7464176">&amp;</span><span class="ident" id="7464177"><a href="/crypto/tls/handshake_server_test.go.html#7463988">config</a></span><span class="op" id="7464183">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7464186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464189"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7464207">(</span><span class="ident" id="7464208"><a href="/crypto/tls/handshake_server_test.go.html#7463903">t</a></span><span class="op" id="7464209">,</span>&nbsp;<span class="ident" id="7464211"><a href="/crypto/tls/handshake_server_test.go.html#7464012">test</a></span><span class="op" id="7464215">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464219"><a href="/crypto/tls/handshake_server_test.go.html#7463988">config</a></span><span class="op" id="7464225">.</span><span class="ident" id="7464226">SessionTicketsDisabled</span>&nbsp;<span class="op" id="7464249">=</span>&nbsp;<span class="builtintype" id="7464251">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464258"><a href="/crypto/tls/handshake_server_test.go.html#7464012">test</a></span>&nbsp;<span class="op" id="7464263">=</span>&nbsp;<span class="op" id="7464265">&amp;</span><span class="ident" id="7464266"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7464276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464280">name</span><span class="op" id="7464284">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7464289">&#34;ResumeDisabled&#34;</span><span class="op" id="7464305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464309">command</span><span class="op" id="7464316">:</span>&nbsp;<span class="op" id="7464318">[</span><span class="op" id="7464319">]</span><span class="builtintype" id="7464320">string</span><span class="op" id="7464326">{</span><span class="string" id="7464327">&#34;openssl&#34;</span><span class="op" id="7464336">,</span>&nbsp;<span class="string" id="7464338">&#34;s_client&#34;</span><span class="op" id="7464348">,</span>&nbsp;<span class="string" id="7464350">&#34;-cipher&#34;</span><span class="op" id="7464359">,</span>&nbsp;<span class="string" id="7464361">&#34;RC4-SHA&#34;</span><span class="op" id="7464370">,</span>&nbsp;<span class="string" id="7464372">&#34;-sess_in&#34;</span><span class="op" id="7464382">,</span>&nbsp;<span class="ident" id="7464384"><a href="/crypto/tls/handshake_server_test.go.html#7463920">sessionFilePath</a></span><span class="op" id="7464399">}</span><span class="op" id="7464400">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464404">config</span><span class="op" id="7464410">:</span>&nbsp;&nbsp;<span class="op" id="7464413">&amp;</span><span class="ident" id="7464414"><a href="/crypto/tls/handshake_server_test.go.html#7463988">config</a></span><span class="op" id="7464420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7464423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464426"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7464444">(</span><span class="ident" id="7464445"><a href="/crypto/tls/handshake_server_test.go.html#7463903">t</a></span><span class="op" id="7464446">,</span>&nbsp;<span class="ident" id="7464448"><a href="/crypto/tls/handshake_server_test.go.html#7464012">test</a></span><span class="op" id="7464452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7464456">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7464528">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="7464596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7464599">func</span>&nbsp;<span class="ident" id="7464604">TestFallbackSCSV</span><span class="op" id="7464620">(</span><span class="ident" id="7464621">t</span>&nbsp;<span class="op" id="7464623">*</span><span class="ident" id="7464624"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7464631">.</span><span class="ident" id="7464632">T</span><span class="op" id="7464633">)</span>&nbsp;<span class="op" id="7464635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464638">test</span>&nbsp;<span class="op" id="7464643">:=</span>&nbsp;<span class="op" id="7464646">&amp;</span><span class="ident" id="7464647"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7464657">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464661">name</span><span class="op" id="7464665">:</span>&nbsp;<span class="string" id="7464667">&#34;FallbackSCSV&#34;</span><span class="op" id="7464681">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7464685">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464746">command</span><span class="op" id="7464753">:</span>&nbsp;<span class="op" id="7464755">[</span><span class="op" id="7464756">]</span><span class="builtintype" id="7464757">string</span><span class="op" id="7464763">{</span><span class="string" id="7464764">&#34;openssl&#34;</span><span class="op" id="7464773">,</span>&nbsp;<span class="string" id="7464775">&#34;s_client&#34;</span><span class="op" id="7464785">,</span>&nbsp;<span class="string" id="7464787">&#34;-fallback_scsv&#34;</span><span class="op" id="7464803">}</span><span class="op" id="7464804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464808">expectHandshakeErrorIncluding</span><span class="op" id="7464837">:</span>&nbsp;<span class="string" id="7464839">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="7464871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7464874">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464877"><a href="/crypto/tls/handshake_server_test.go.html#7456929">runServerTestTLS11</a></span><span class="op" id="7464895">(</span><span class="ident" id="7464896"><a href="/crypto/tls/handshake_server_test.go.html#7464621">t</a></span><span class="op" id="7464897">,</span>&nbsp;<span class="ident" id="7464899"><a href="/crypto/tls/handshake_server_test.go.html#7464638">test</a></span><span class="op" id="7464903">)</span><br>
<span class="lineno"></span><span class="op" id="7464905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7464908">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="7464969">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="7465031">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7465067">const</span>&nbsp;<span class="ident" id="7465073">clientCertificatePEM</span>&nbsp;<span class="op" id="7465094">=</span>&nbsp;<span class="string" id="7465096">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7465829">const</span>&nbsp;<span class="ident" id="7465835">clientKeyPEM</span>&nbsp;<span class="op" id="7465848">=</span>&nbsp;<span class="string" id="7465850">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7466737">const</span>&nbsp;<span class="ident" id="7466743">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="7466769">=</span>&nbsp;<span class="string" id="7466771">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7467524">const</span>&nbsp;<span class="ident" id="7467530">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="7467548">=</span>&nbsp;<span class="string" id="7467550">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="7467990">func</span>&nbsp;<span class="ident" id="7467995">TestClientAuth</span><span class="op" id="7468009">(</span><span class="ident" id="7468010">t</span>&nbsp;<span class="op" id="7468012">*</span><span class="ident" id="7468013"><a href="/crypto/tls/handshake_server_test.go.html#7444170">testing</a></span><span class="op" id="7468020">.</span><span class="ident" id="7468021">T</span><span class="op" id="7468022">)</span>&nbsp;<span class="op" id="7468024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7468027">var</span>&nbsp;<span class="ident" id="7468031">certPath</span><span class="op" id="7468039">,</span>&nbsp;<span class="ident" id="7468041">keyPath</span><span class="op" id="7468048">,</span>&nbsp;<span class="ident" id="7468050">ecdsaCertPath</span><span class="op" id="7468063">,</span>&nbsp;<span class="ident" id="7468065">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="7468078">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7468087">if</span>&nbsp;<span class="op" id="7468090">*</span><span class="ident" id="7468091"><a href="/crypto/tls/handshake_test.go.html#7476047">update</a></span>&nbsp;<span class="op" id="7468098">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468102"><a href="/crypto/tls/handshake_server_test.go.html#7468031">certPath</a></span>&nbsp;<span class="op" id="7468111">=</span>&nbsp;<span class="ident" id="7468113"><a href="/crypto/tls/handshake_test.go.html#7478903">tempFile</a></span><span class="op" id="7468121">(</span><span class="ident" id="7468122"><a href="/crypto/tls/handshake_server_test.go.html#7465073">clientCertificatePEM</a></span><span class="op" id="7468142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7468146">defer</span>&nbsp;<span class="ident" id="7468152"><a href="/crypto/tls/handshake_server_test.go.html#7444125">os</a></span><span class="op" id="7468154">.</span><span class="ident" id="7468155">Remove</span><span class="op" id="7468161">(</span><span class="ident" id="7468162"><a href="/crypto/tls/handshake_server_test.go.html#7468031">certPath</a></span><span class="op" id="7468170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468174"><a href="/crypto/tls/handshake_server_test.go.html#7468041">keyPath</a></span>&nbsp;<span class="op" id="7468182">=</span>&nbsp;<span class="ident" id="7468184"><a href="/crypto/tls/handshake_test.go.html#7478903">tempFile</a></span><span class="op" id="7468192">(</span><span class="ident" id="7468193"><a href="/crypto/tls/handshake_server_test.go.html#7465835">clientKeyPEM</a></span><span class="op" id="7468205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7468209">defer</span>&nbsp;<span class="ident" id="7468215"><a href="/crypto/tls/handshake_server_test.go.html#7444125">os</a></span><span class="op" id="7468217">.</span><span class="ident" id="7468218">Remove</span><span class="op" id="7468224">(</span><span class="ident" id="7468225"><a href="/crypto/tls/handshake_server_test.go.html#7468041">keyPath</a></span><span class="op" id="7468232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468236"><a href="/crypto/tls/handshake_server_test.go.html#7468050">ecdsaCertPath</a></span>&nbsp;<span class="op" id="7468250">=</span>&nbsp;<span class="ident" id="7468252"><a href="/crypto/tls/handshake_test.go.html#7478903">tempFile</a></span><span class="op" id="7468260">(</span><span class="ident" id="7468261"><a href="/crypto/tls/handshake_server_test.go.html#7466743">clientECDSACertificatePEM</a></span><span class="op" id="7468286">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7468290">defer</span>&nbsp;<span class="ident" id="7468296"><a href="/crypto/tls/handshake_server_test.go.html#7444125">os</a></span><span class="op" id="7468298">.</span><span class="ident" id="7468299">Remove</span><span class="op" id="7468305">(</span><span class="ident" id="7468306"><a href="/crypto/tls/handshake_server_test.go.html#7468050">ecdsaCertPath</a></span><span class="op" id="7468319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468323"><a href="/crypto/tls/handshake_server_test.go.html#7468065">ecdsaKeyPath</a></span>&nbsp;<span class="op" id="7468336">=</span>&nbsp;<span class="ident" id="7468338"><a href="/crypto/tls/handshake_test.go.html#7478903">tempFile</a></span><span class="op" id="7468346">(</span><span class="ident" id="7468347"><a href="/crypto/tls/handshake_server_test.go.html#7467530">clientECDSAKeyPEM</a></span><span class="op" id="7468364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7468368">defer</span>&nbsp;<span class="ident" id="7468374"><a href="/crypto/tls/handshake_server_test.go.html#7444125">os</a></span><span class="op" id="7468376">.</span><span class="ident" id="7468377">Remove</span><span class="op" id="7468383">(</span><span class="ident" id="7468384"><a href="/crypto/tls/handshake_server_test.go.html#7468065">ecdsaKeyPath</a></span><span class="op" id="7468396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468403">config</span>&nbsp;<span class="op" id="7468410">:=</span>&nbsp;<span class="op" id="7468413">*</span><span class="ident" id="7468414"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468426"><a href="/crypto/tls/handshake_server_test.go.html#7468403">config</a></span><span class="op" id="7468432">.</span><span class="ident" id="7468433">ClientAuth</span>&nbsp;<span class="op" id="7468444">=</span>&nbsp;<span class="ident" id="7468446"><a href="/crypto/tls/common.go.html#3828304">RequestClientCert</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468466">test</span>&nbsp;<span class="op" id="7468471">:=</span>&nbsp;<span class="op" id="7468474">&amp;</span><span class="ident" id="7468475"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7468485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468489">name</span><span class="op" id="7468493">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7468498">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="7468527">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468531">command</span><span class="op" id="7468538">:</span>&nbsp;<span class="op" id="7468540">[</span><span class="op" id="7468541">]</span><span class="builtintype" id="7468542">string</span><span class="op" id="7468548">{</span><span class="string" id="7468549">&#34;openssl&#34;</span><span class="op" id="7468558">,</span>&nbsp;<span class="string" id="7468560">&#34;s_client&#34;</span><span class="op" id="7468570">,</span>&nbsp;<span class="string" id="7468572">&#34;-no_ticket&#34;</span><span class="op" id="7468584">,</span>&nbsp;<span class="string" id="7468586">&#34;-cipher&#34;</span><span class="op" id="7468595">,</span>&nbsp;<span class="string" id="7468597">&#34;RC4-SHA&#34;</span><span class="op" id="7468606">}</span><span class="op" id="7468607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468611">config</span><span class="op" id="7468617">:</span>&nbsp;&nbsp;<span class="op" id="7468620">&amp;</span><span class="ident" id="7468621"><a href="/crypto/tls/handshake_server_test.go.html#7468403">config</a></span><span class="op" id="7468627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468633"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7468651">(</span><span class="ident" id="7468652"><a href="/crypto/tls/handshake_server_test.go.html#7468010">t</a></span><span class="op" id="7468653">,</span>&nbsp;<span class="ident" id="7468655"><a href="/crypto/tls/handshake_server_test.go.html#7468466">test</a></span><span class="op" id="7468659">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468663"><a href="/crypto/tls/handshake_server_test.go.html#7468466">test</a></span>&nbsp;<span class="op" id="7468668">=</span>&nbsp;<span class="op" id="7468670">&amp;</span><span class="ident" id="7468671"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7468681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468685">name</span><span class="op" id="7468689">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7468704">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="7468733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468737">command</span><span class="op" id="7468744">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7468756">[</span><span class="op" id="7468757">]</span><span class="builtintype" id="7468758">string</span><span class="op" id="7468764">{</span><span class="string" id="7468765">&#34;openssl&#34;</span><span class="op" id="7468774">,</span>&nbsp;<span class="string" id="7468776">&#34;s_client&#34;</span><span class="op" id="7468786">,</span>&nbsp;<span class="string" id="7468788">&#34;-no_ticket&#34;</span><span class="op" id="7468800">,</span>&nbsp;<span class="string" id="7468802">&#34;-cipher&#34;</span><span class="op" id="7468811">,</span>&nbsp;<span class="string" id="7468813">&#34;RC4-SHA&#34;</span><span class="op" id="7468822">,</span>&nbsp;<span class="string" id="7468824">&#34;-cert&#34;</span><span class="op" id="7468831">,</span>&nbsp;<span class="ident" id="7468833"><a href="/crypto/tls/handshake_server_test.go.html#7468031">certPath</a></span><span class="op" id="7468841">,</span>&nbsp;<span class="string" id="7468843">&#34;-key&#34;</span><span class="op" id="7468849">,</span>&nbsp;<span class="ident" id="7468851"><a href="/crypto/tls/handshake_server_test.go.html#7468041">keyPath</a></span><span class="op" id="7468858">}</span><span class="op" id="7468859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468863">config</span><span class="op" id="7468869">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7468882">&amp;</span><span class="ident" id="7468883"><a href="/crypto/tls/handshake_server_test.go.html#7468403">config</a></span><span class="op" id="7468889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468893">expectedPeerCerts</span><span class="op" id="7468910">:</span>&nbsp;<span class="op" id="7468912">[</span><span class="op" id="7468913">]</span><span class="builtintype" id="7468914">string</span><span class="op" id="7468920">{</span><span class="ident" id="7468921"><a href="/crypto/tls/handshake_server_test.go.html#7465073">clientCertificatePEM</a></span><span class="op" id="7468941">}</span><span class="op" id="7468942">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468948"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7468966">(</span><span class="ident" id="7468967"><a href="/crypto/tls/handshake_server_test.go.html#7468010">t</a></span><span class="op" id="7468968">,</span>&nbsp;<span class="ident" id="7468970"><a href="/crypto/tls/handshake_server_test.go.html#7468466">test</a></span><span class="op" id="7468974">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468978"><a href="/crypto/tls/handshake_server_test.go.html#7468466">test</a></span>&nbsp;<span class="op" id="7468983">=</span>&nbsp;<span class="op" id="7468985">&amp;</span><span class="ident" id="7468986"><a href="/crypto/tls/handshake_server_test.go.html#7450547">serverTest</a></span><span class="op" id="7468996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469000">name</span><span class="op" id="7469004">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7469019">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="7469053">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469057">command</span><span class="op" id="7469064">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7469076">[</span><span class="op" id="7469077">]</span><span class="builtintype" id="7469078">string</span><span class="op" id="7469084">{</span><span class="string" id="7469085">&#34;openssl&#34;</span><span class="op" id="7469094">,</span>&nbsp;<span class="string" id="7469096">&#34;s_client&#34;</span><span class="op" id="7469106">,</span>&nbsp;<span class="string" id="7469108">&#34;-no_ticket&#34;</span><span class="op" id="7469120">,</span>&nbsp;<span class="string" id="7469122">&#34;-cipher&#34;</span><span class="op" id="7469131">,</span>&nbsp;<span class="string" id="7469133">&#34;RC4-SHA&#34;</span><span class="op" id="7469142">,</span>&nbsp;<span class="string" id="7469144">&#34;-cert&#34;</span><span class="op" id="7469151">,</span>&nbsp;<span class="ident" id="7469153"><a href="/crypto/tls/handshake_server_test.go.html#7468050">ecdsaCertPath</a></span><span class="op" id="7469166">,</span>&nbsp;<span class="string" id="7469168">&#34;-key&#34;</span><span class="op" id="7469174">,</span>&nbsp;<span class="ident" id="7469176"><a href="/crypto/tls/handshake_server_test.go.html#7468065">ecdsaKeyPath</a></span><span class="op" id="7469188">}</span><span class="op" id="7469189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469193">config</span><span class="op" id="7469199">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7469212">&amp;</span><span class="ident" id="7469213"><a href="/crypto/tls/handshake_server_test.go.html#7468403">config</a></span><span class="op" id="7469219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469223">expectedPeerCerts</span><span class="op" id="7469240">:</span>&nbsp;<span class="op" id="7469242">[</span><span class="op" id="7469243">]</span><span class="builtintype" id="7469244">string</span><span class="op" id="7469250">{</span><span class="ident" id="7469251"><a href="/crypto/tls/handshake_server_test.go.html#7466743">clientECDSACertificatePEM</a></span><span class="op" id="7469276">}</span><span class="op" id="7469277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469283"><a href="/crypto/tls/handshake_server_test.go.html#7457054">runServerTestTLS12</a></span><span class="op" id="7469301">(</span><span class="ident" id="7469302"><a href="/crypto/tls/handshake_server_test.go.html#7468010">t</a></span><span class="op" id="7469303">,</span>&nbsp;<span class="ident" id="7469305"><a href="/crypto/tls/handshake_server_test.go.html#7468466">test</a></span><span class="op" id="7469309">)</span><br>
<span class="lineno">830</span><span class="op" id="7469311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7469314">func</span>&nbsp;<span class="ident" id="7469319">bigFromString</span><span class="op" id="7469332">(</span><span class="ident" id="7469333">s</span>&nbsp;<span class="builtintype" id="7469335">string</span><span class="op" id="7469341">)</span>&nbsp;<span class="op" id="7469343">*</span><span class="ident" id="7469344"><a href="/crypto/tls/handshake_server_test.go.html#7444106">big</a></span><span class="op" id="7469347">.</span><span class="ident" id="7469348">Int</span>&nbsp;<span class="op" id="7469352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469355">ret</span>&nbsp;<span class="op" id="7469359">:=</span>&nbsp;<span class="builtinfunc" id="7469362">new</span><span class="op" id="7469365">(</span><span class="ident" id="7469366"><a href="/crypto/tls/handshake_server_test.go.html#7444106">big</a></span><span class="op" id="7469369">.</span><span class="ident" id="7469370">Int</span><span class="op" id="7469373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469376"><a href="/crypto/tls/handshake_server_test.go.html#7469355">ret</a></span><span class="op" id="7469379">.</span><span class="ident" id="7469380">SetString</span><span class="op" id="7469389">(</span><span class="ident" id="7469390"><a href="/crypto/tls/handshake_server_test.go.html#7469333">s</a></span><span class="op" id="7469391">,</span>&nbsp;<span class="num" id="7469393">10</span><span class="op" id="7469395">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469398">return</span>&nbsp;<span class="ident" id="7469405"><a href="/crypto/tls/handshake_server_test.go.html#7469355">ret</a></span><br>
<span class="lineno"></span><span class="op" id="7469409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7469412">func</span>&nbsp;<span class="ident" id="7469417">fromHex</span><span class="op" id="7469424">(</span><span class="ident" id="7469425">s</span>&nbsp;<span class="builtintype" id="7469427">string</span><span class="op" id="7469433">)</span>&nbsp;<span class="op" id="7469435">[</span><span class="op" id="7469436">]</span><span class="builtintype" id="7469437">byte</span>&nbsp;<span class="op" id="7469442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469445">b</span><span class="op" id="7469446">,</span>&nbsp;<span class="ident" id="7469448">_</span>&nbsp;<span class="op" id="7469450">:=</span>&nbsp;<span class="ident" id="7469453"><a href="/crypto/tls/handshake_server_test.go.html#7444051">hex</a></span><span class="op" id="7469456">.</span><span class="ident" id="7469457">DecodeString</span><span class="op" id="7469469">(</span><span class="ident" id="7469470"><a href="/crypto/tls/handshake_server_test.go.html#7469425">s</a></span><span class="op" id="7469471">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469474">return</span>&nbsp;<span class="ident" id="7469481"><a href="/crypto/tls/handshake_server_test.go.html#7469445">b</a></span><br>
<span class="lineno"></span><span class="op" id="7469483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7469486">var</span>&nbsp;<span class="ident" id="7469490">testRSACertificate</span>&nbsp;<span class="op" id="7469509">=</span>&nbsp;<span class="ident" id="7469511"><a href="/crypto/tls/handshake_server_test.go.html#7469417">fromHex</a></span><span class="op" id="7469518">(</span><span class="string" id="7469519">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="7470905">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="7470908">var</span>&nbsp;<span class="ident" id="7470912">testECDSACertificate</span>&nbsp;<span class="op" id="7470933">=</span>&nbsp;<span class="ident" id="7470935"><a href="/crypto/tls/handshake_server_test.go.html#7469417">fromHex</a></span><span class="op" id="7470942">(</span><span class="string" id="7470943">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="7471977">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7471980">var</span>&nbsp;<span class="ident" id="7471984">testSNICertificate</span>&nbsp;<span class="op" id="7472003">=</span>&nbsp;<span class="ident" id="7472005"><a href="/crypto/tls/handshake_server_test.go.html#7469417">fromHex</a></span><span class="op" id="7472012">(</span><span class="string" id="7472013">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="7473019">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7473022">var</span>&nbsp;<span class="ident" id="7473026">testRSAPrivateKey</span>&nbsp;<span class="op" id="7473044">=</span>&nbsp;<span class="op" id="7473046">&amp;</span><span class="ident" id="7473047"><a href="/crypto/tls/handshake_server_test.go.html#7444037">rsa</a></span><span class="op" id="7473050">.</span><span class="ident" id="7473051">PrivateKey</span><span class="op" id="7473061">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473064">PublicKey</span><span class="op" id="7473073">:</span>&nbsp;<span class="ident" id="7473075"><a href="/crypto/tls/handshake_server_test.go.html#7444037">rsa</a></span><span class="op" id="7473078">.</span><span class="ident" id="7473079">PublicKey</span><span class="op" id="7473088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473092">N</span><span class="op" id="7473093">:</span>&nbsp;<span class="ident" id="7473095"><a href="/crypto/tls/handshake_server_test.go.html#7469319">bigFromString</a></span><span class="op" id="7473108">(</span><span class="string" id="7473109">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="7473420">)</span><span class="op" id="7473421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473425">E</span><span class="op" id="7473426">:</span>&nbsp;<span class="num" id="7473428">65537</span><span class="op" id="7473433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473436">}</span><span class="op" id="7473437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473440">D</span><span class="op" id="7473441">:</span>&nbsp;<span class="ident" id="7473443"><a href="/crypto/tls/handshake_server_test.go.html#7469319">bigFromString</a></span><span class="op" id="7473456">(</span><span class="string" id="7473457">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="7473767">)</span><span class="op" id="7473768">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473771">Primes</span><span class="op" id="7473777">:</span>&nbsp;<span class="op" id="7473779">[</span><span class="op" id="7473780">]</span><span class="op" id="7473781">*</span><span class="ident" id="7473782"><a href="/crypto/tls/handshake_server_test.go.html#7444106">big</a></span><span class="op" id="7473785">.</span><span class="ident" id="7473786">Int</span><span class="op" id="7473789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473793"><a href="/crypto/tls/handshake_server_test.go.html#7469319">bigFromString</a></span><span class="op" id="7473806">(</span><span class="string" id="7473807">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="7473964">)</span><span class="op" id="7473965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473969"><a href="/crypto/tls/handshake_server_test.go.html#7469319">bigFromString</a></span><span class="op" id="7473982">(</span><span class="string" id="7473983">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="7474140">)</span><span class="op" id="7474141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474144">}</span><span class="op" id="7474145">,</span><br>
<span class="lineno"></span><span class="op" id="7474147">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="7474150">var</span>&nbsp;<span class="ident" id="7474154">testECDSAPrivateKey</span>&nbsp;<span class="op" id="7474174">=</span>&nbsp;<span class="op" id="7474176">&amp;</span><span class="ident" id="7474177"><a href="/crypto/tls/handshake_server_test.go.html#7444002">ecdsa</a></span><span class="op" id="7474182">.</span><span class="ident" id="7474183">PrivateKey</span><span class="op" id="7474193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474196">PublicKey</span><span class="op" id="7474205">:</span>&nbsp;<span class="ident" id="7474207"><a href="/crypto/tls/handshake_server_test.go.html#7444002">ecdsa</a></span><span class="op" id="7474212">.</span><span class="ident" id="7474213">PublicKey</span><span class="op" id="7474222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474226">Curve</span><span class="op" id="7474231">:</span>&nbsp;<span class="ident" id="7474233"><a href="/crypto/tls/handshake_server_test.go.html#7444018">elliptic</a></span><span class="op" id="7474241">.</span><span class="ident" id="7474242">P521</span><span class="op" id="7474246">(</span><span class="op" id="7474247">)</span><span class="op" id="7474248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474252">X</span><span class="op" id="7474253">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7474259"><a href="/crypto/tls/handshake_server_test.go.html#7469319">bigFromString</a></span><span class="op" id="7474272">(</span><span class="string" id="7474273">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="7474432">)</span><span class="op" id="7474433">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474437">Y</span><span class="op" id="7474438">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7474444"><a href="/crypto/tls/handshake_server_test.go.html#7469319">bigFromString</a></span><span class="op" id="7474457">(</span><span class="string" id="7474458">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="7474617">)</span><span class="op" id="7474618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474621">}</span><span class="op" id="7474622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474625">D</span><span class="op" id="7474626">:</span>&nbsp;<span class="ident" id="7474628"><a href="/crypto/tls/handshake_server_test.go.html#7469319">bigFromString</a></span><span class="op" id="7474641">(</span><span class="string" id="7474642">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="7474801">)</span><span class="op" id="7474802">,</span><br>
<span class="lineno"></span><span class="op" id="7474804">}</span>
</div>
</body>
</html>
