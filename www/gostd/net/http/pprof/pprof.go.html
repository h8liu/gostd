<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/pprof</h2>
<ul>
<li><a href="/gostd/net/http/pprof/pprof.go.html" class="current">pprof.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5754440">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5754496">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5754550">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5754601">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5754668">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="5754727">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="5754768">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="5754815">//</span><br>
<span class="lineno">10</span><span class="comment" id="5754818">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5754883">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="5754917">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="5754968">//</span><br>
<span class="lineno"></span><span class="comment" id="5754971">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="5755025">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5755054">//</span><br>
<span class="lineno"></span><span class="comment" id="5755057">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="5755123">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5755191">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="5755236">//</span><br>
<span class="lineno"></span><span class="comment" id="5755239">//&nbsp;&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5755255">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="5755316">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp}()</span><br>
<span class="lineno"></span><span class="comment" id="5755324">//</span><br>
<span class="lineno">25</span><span class="comment" id="5755327">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="5755383">//</span><br>
<span class="lineno"></span><span class="comment" id="5755386">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="5755442">//</span><br>
<span class="lineno"></span><span class="comment" id="5755445">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="5755487">//</span><br>
<span class="lineno"></span><span class="comment" id="5755490">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="5755549">//</span><br>
<span class="lineno"></span><span class="comment" id="5755552">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="5755601">//</span><br>
<span class="lineno">35</span><span class="comment" id="5755604">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="5755661">//</span><br>
<span class="lineno"></span><span class="comment" id="5755664">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="5755739">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="5755759">//</span><br>
<span class="lineno">40</span><span class="comment" id="5755762">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="5755810">//</span><br>
<span class="lineno"></span><span class="comment" id="5755813">//&nbsp;&nbsp;&nbsp;&nbsphttp://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="5755874">//</span><br>
<span class="lineno"></span><span class="keyword" id="5755877">package</span>&nbsp;<span class="ident" id="5755885">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5755892">import</span>&nbsp;<span class="op" id="5755899">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755902">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755911">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755920">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755927">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755944">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755950">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755957">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755969">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755975">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755986">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5756003">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5756014">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5756025">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="5756032">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5756035">func</span>&nbsp;<span class="ident" id="5756040">init</span><span class="op" id="5756044">(</span><span class="op" id="5756045">)</span>&nbsp;<span class="op" id="5756047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756050">http</span><span class="op" id="5756054">.</span><span class="ident" id="5756055">Handle</span><span class="op" id="5756061">(</span><span class="string" id="5756062">&#34;/debug/pprof/&#34;</span><span class="op" id="5756077">,</span>&nbsp;<span class="ident" id="5756079">http</span><span class="op" id="5756083">.</span><span class="ident" id="5756084">HandlerFunc</span><span class="op" id="5756095">(</span><span class="ident" id="5756096">Index</span><span class="op" id="5756101">)</span><span class="op" id="5756102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756105">http</span><span class="op" id="5756109">.</span><span class="ident" id="5756110">Handle</span><span class="op" id="5756116">(</span><span class="string" id="5756117">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="5756139">,</span>&nbsp;<span class="ident" id="5756141">http</span><span class="op" id="5756145">.</span><span class="ident" id="5756146">HandlerFunc</span><span class="op" id="5756157">(</span><span class="ident" id="5756158">Cmdline</span><span class="op" id="5756165">)</span><span class="op" id="5756166">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756169">http</span><span class="op" id="5756173">.</span><span class="ident" id="5756174">Handle</span><span class="op" id="5756180">(</span><span class="string" id="5756181">&#34;/debug/pprof/profile&#34;</span><span class="op" id="5756203">,</span>&nbsp;<span class="ident" id="5756205">http</span><span class="op" id="5756209">.</span><span class="ident" id="5756210">HandlerFunc</span><span class="op" id="5756221">(</span><span class="ident" id="5756222">Profile</span><span class="op" id="5756229">)</span><span class="op" id="5756230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756233">http</span><span class="op" id="5756237">.</span><span class="ident" id="5756238">Handle</span><span class="op" id="5756244">(</span><span class="string" id="5756245">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="5756266">,</span>&nbsp;<span class="ident" id="5756268">http</span><span class="op" id="5756272">.</span><span class="ident" id="5756273">HandlerFunc</span><span class="op" id="5756284">(</span><span class="ident" id="5756285">Symbol</span><span class="op" id="5756291">)</span><span class="op" id="5756292">)</span><br>
<span class="lineno"></span><span class="op" id="5756294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5756297">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="5756344">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="5756400">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="5756468">func</span>&nbsp;<span class="ident" id="5756473">Cmdline</span><span class="op" id="5756480">(</span><span class="ident" id="5756481">w</span>&nbsp;<span class="ident" id="5756483">http</span><span class="op" id="5756487">.</span><span class="ident" id="5756488">ResponseWriter</span><span class="op" id="5756502">,</span>&nbsp;<span class="ident" id="5756504">r</span>&nbsp;<span class="op" id="5756506">*</span><span class="ident" id="5756507">http</span><span class="op" id="5756511">.</span><span class="ident" id="5756512">Request</span><span class="op" id="5756519">)</span>&nbsp;<span class="op" id="5756521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756524">w</span><span class="op" id="5756525">.</span><span class="ident" id="5756526">Header</span><span class="op" id="5756532">(</span><span class="op" id="5756533">)</span><span class="op" id="5756534">.</span><span class="ident" id="5756535">Set</span><span class="op" id="5756538">(</span><span class="string" id="5756539">&#34;Content-Type&#34;</span><span class="op" id="5756553">,</span>&nbsp;<span class="string" id="5756555">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5756582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756585">fmt</span><span class="op" id="5756588">.</span><span class="ident" id="5756589">Fprintf</span><span class="op" id="5756596">(</span><span class="ident" id="5756597">w</span><span class="op" id="5756598">,</span>&nbsp;<span class="ident" id="5756600">strings</span><span class="op" id="5756607">.</span><span class="ident" id="5756608">Join</span><span class="op" id="5756612">(</span><span class="ident" id="5756613">os</span><span class="op" id="5756615">.</span><span class="ident" id="5756616">Args</span><span class="op" id="5756620">,</span>&nbsp;<span class="string" id="5756622">&#34;\x00&#34;</span><span class="op" id="5756628">)</span><span class="op" id="5756629">)</span><br>
<span class="lineno">75</span><span class="op" id="5756631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5756634">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="5756692">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="5756760">func</span>&nbsp;<span class="ident" id="5756765">Profile</span><span class="op" id="5756772">(</span><span class="ident" id="5756773">w</span>&nbsp;<span class="ident" id="5756775">http</span><span class="op" id="5756779">.</span><span class="ident" id="5756780">ResponseWriter</span><span class="op" id="5756794">,</span>&nbsp;<span class="ident" id="5756796">r</span>&nbsp;<span class="op" id="5756798">*</span><span class="ident" id="5756799">http</span><span class="op" id="5756803">.</span><span class="ident" id="5756804">Request</span><span class="op" id="5756811">)</span>&nbsp;<span class="op" id="5756813">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756816">sec</span><span class="op" id="5756819">,</span>&nbsp;<span class="ident" id="5756821">_</span>&nbsp;<span class="op" id="5756823">:=</span>&nbsp;<span class="ident" id="5756826">strconv</span><span class="op" id="5756833">.</span><span class="ident" id="5756834">ParseInt</span><span class="op" id="5756842">(</span><span class="ident" id="5756843">r</span><span class="op" id="5756844">.</span><span class="ident" id="5756845">FormValue</span><span class="op" id="5756854">(</span><span class="string" id="5756855">&#34;seconds&#34;</span><span class="op" id="5756864">)</span><span class="op" id="5756865">,</span>&nbsp;<span class="num" id="5756867">10</span><span class="op" id="5756869">,</span>&nbsp;<span class="num" id="5756871">64</span><span class="op" id="5756873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756876">if</span>&nbsp;<span class="ident" id="5756879">sec</span>&nbsp;<span class="op" id="5756883">==</span>&nbsp;<span class="num" id="5756886">0</span>&nbsp;<span class="op" id="5756888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756892">sec</span>&nbsp;<span class="op" id="5756896">=</span>&nbsp;<span class="num" id="5756898">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756906">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756963">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757005">w</span><span class="op" id="5757006">.</span><span class="ident" id="5757007">Header</span><span class="op" id="5757013">(</span><span class="op" id="5757014">)</span><span class="op" id="5757015">.</span><span class="ident" id="5757016">Set</span><span class="op" id="5757019">(</span><span class="string" id="5757020">&#34;Content-Type&#34;</span><span class="op" id="5757034">,</span>&nbsp;<span class="string" id="5757036">&#34;application/octet-stream&#34;</span><span class="op" id="5757062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757065">if</span>&nbsp;<span class="ident" id="5757068">err</span>&nbsp;<span class="op" id="5757072">:=</span>&nbsp;<span class="ident" id="5757075">pprof</span><span class="op" id="5757080">.</span><span class="ident" id="5757081">StartCPUProfile</span><span class="op" id="5757096">(</span><span class="ident" id="5757097">w</span><span class="op" id="5757098">)</span><span class="op" id="5757099">;</span>&nbsp;<span class="ident" id="5757101">err</span>&nbsp;<span class="op" id="5757105">!=</span>&nbsp;<span class="ident" id="5757108">nil</span>&nbsp;<span class="op" id="5757112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757116">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757163">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757207">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757233">w</span><span class="op" id="5757234">.</span><span class="ident" id="5757235">Header</span><span class="op" id="5757241">(</span><span class="op" id="5757242">)</span><span class="op" id="5757243">.</span><span class="ident" id="5757244">Set</span><span class="op" id="5757247">(</span><span class="string" id="5757248">&#34;Content-Type&#34;</span><span class="op" id="5757262">,</span>&nbsp;<span class="string" id="5757264">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5757291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757295">w</span><span class="op" id="5757296">.</span><span class="ident" id="5757297">WriteHeader</span><span class="op" id="5757308">(</span><span class="ident" id="5757309">http</span><span class="op" id="5757313">.</span><span class="ident" id="5757314">StatusInternalServerError</span><span class="op" id="5757339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757343">fmt</span><span class="op" id="5757346">.</span><span class="ident" id="5757347">Fprintf</span><span class="op" id="5757354">(</span><span class="ident" id="5757355">w</span><span class="op" id="5757356">,</span>&nbsp;<span class="string" id="5757358">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="5757396">,</span>&nbsp;<span class="ident" id="5757398">err</span><span class="op" id="5757401">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757405">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757416">time</span><span class="op" id="5757420">.</span><span class="ident" id="5757421">Sleep</span><span class="op" id="5757426">(</span><span class="ident" id="5757427">time</span><span class="op" id="5757431">.</span><span class="ident" id="5757432">Duration</span><span class="op" id="5757440">(</span><span class="ident" id="5757441">sec</span><span class="op" id="5757444">)</span>&nbsp;<span class="op" id="5757446">*</span>&nbsp;<span class="ident" id="5757448">time</span><span class="op" id="5757452">.</span><span class="ident" id="5757453">Second</span><span class="op" id="5757459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757462">pprof</span><span class="op" id="5757467">.</span><span class="ident" id="5757468">StopCPUProfile</span><span class="op" id="5757482">(</span><span class="op" id="5757483">)</span><br>
<span class="lineno"></span><span class="op" id="5757485">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="5757488">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="5757551">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="5757622">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="5757689">func</span>&nbsp;<span class="ident" id="5757694">Symbol</span><span class="op" id="5757700">(</span><span class="ident" id="5757701">w</span>&nbsp;<span class="ident" id="5757703">http</span><span class="op" id="5757707">.</span><span class="ident" id="5757708">ResponseWriter</span><span class="op" id="5757722">,</span>&nbsp;<span class="ident" id="5757724">r</span>&nbsp;<span class="op" id="5757726">*</span><span class="ident" id="5757727">http</span><span class="op" id="5757731">.</span><span class="ident" id="5757732">Request</span><span class="op" id="5757739">)</span>&nbsp;<span class="op" id="5757741">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757744">w</span><span class="op" id="5757745">.</span><span class="ident" id="5757746">Header</span><span class="op" id="5757752">(</span><span class="op" id="5757753">)</span><span class="op" id="5757754">.</span><span class="ident" id="5757755">Set</span><span class="op" id="5757758">(</span><span class="string" id="5757759">&#34;Content-Type&#34;</span><span class="op" id="5757773">,</span>&nbsp;<span class="string" id="5757775">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5757802">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757806">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757853">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757902">var</span>&nbsp;<span class="ident" id="5757906">buf</span>&nbsp;<span class="ident" id="5757910">bytes</span><span class="op" id="5757915">.</span><span class="ident" id="5757916">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757925">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757976">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758034">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758086">fmt</span><span class="op" id="5758089">.</span><span class="ident" id="5758090">Fprintf</span><span class="op" id="5758097">(</span><span class="op" id="5758098">&amp;</span><span class="ident" id="5758099">buf</span><span class="op" id="5758102">,</span>&nbsp;<span class="string" id="5758104">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="5758122">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758126">var</span>&nbsp;<span class="ident" id="5758130">b</span>&nbsp;<span class="op" id="5758132">*</span><span class="ident" id="5758133">bufio</span><span class="op" id="5758138">.</span><span class="ident" id="5758139">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758147">if</span>&nbsp;<span class="ident" id="5758150">r</span><span class="op" id="5758151">.</span><span class="ident" id="5758152">Method</span>&nbsp;<span class="op" id="5758159">==</span>&nbsp;<span class="string" id="5758162">&#34;POST&#34;</span>&nbsp;<span class="op" id="5758169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758173">b</span>&nbsp;<span class="op" id="5758175">=</span>&nbsp;<span class="ident" id="5758177">bufio</span><span class="op" id="5758182">.</span><span class="ident" id="5758183">NewReader</span><span class="op" id="5758192">(</span><span class="ident" id="5758193">r</span><span class="op" id="5758194">.</span><span class="ident" id="5758195">Body</span><span class="op" id="5758199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758202">}</span>&nbsp;<span class="keyword" id="5758204">else</span>&nbsp;<span class="op" id="5758209">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758213">b</span>&nbsp;<span class="op" id="5758215">=</span>&nbsp;<span class="ident" id="5758217">bufio</span><span class="op" id="5758222">.</span><span class="ident" id="5758223">NewReader</span><span class="op" id="5758232">(</span><span class="ident" id="5758233">strings</span><span class="op" id="5758240">.</span><span class="ident" id="5758241">NewReader</span><span class="op" id="5758250">(</span><span class="ident" id="5758251">r</span><span class="op" id="5758252">.</span><span class="ident" id="5758253">URL</span><span class="op" id="5758256">.</span><span class="ident" id="5758257">RawQuery</span><span class="op" id="5758265">)</span><span class="op" id="5758266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758273">for</span>&nbsp;<span class="op" id="5758277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758281">word</span><span class="op" id="5758285">,</span>&nbsp;<span class="ident" id="5758287">err</span>&nbsp;<span class="op" id="5758291">:=</span>&nbsp;<span class="ident" id="5758294">b</span><span class="op" id="5758295">.</span><span class="ident" id="5758296">ReadSlice</span><span class="op" id="5758305">(</span><span class="string" id="5758306">&#39;+&#39;</span><span class="op" id="5758309">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758313">if</span>&nbsp;<span class="ident" id="5758316">err</span>&nbsp;<span class="op" id="5758320">==</span>&nbsp;<span class="ident" id="5758323">nil</span>&nbsp;<span class="op" id="5758327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758332">word</span>&nbsp;<span class="op" id="5758337">=</span>&nbsp;<span class="ident" id="5758339">word</span><span class="op" id="5758343">[</span><span class="num" id="5758344">0</span>&nbsp;<span class="op" id="5758346">:</span>&nbsp;<span class="builtinfunc" id="5758348">len</span><span class="op" id="5758351">(</span><span class="ident" id="5758352">word</span><span class="op" id="5758356">)</span><span class="op" id="5758357">-</span><span class="num" id="5758358">1</span><span class="op" id="5758359">]</span>&nbsp;<span class="comment" id="5758361">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758377">pc</span><span class="op" id="5758379">,</span>&nbsp;<span class="ident" id="5758381">_</span>&nbsp;<span class="op" id="5758383">:=</span>&nbsp;<span class="ident" id="5758386">strconv</span><span class="op" id="5758393">.</span><span class="ident" id="5758394">ParseUint</span><span class="op" id="5758403">(</span><span class="builtintype" id="5758404">string</span><span class="op" id="5758410">(</span><span class="ident" id="5758411">word</span><span class="op" id="5758415">)</span><span class="op" id="5758416">,</span>&nbsp;<span class="num" id="5758418">0</span><span class="op" id="5758419">,</span>&nbsp;<span class="num" id="5758421">64</span><span class="op" id="5758423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758427">if</span>&nbsp;<span class="ident" id="5758430">pc</span>&nbsp;<span class="op" id="5758433">!=</span>&nbsp;<span class="num" id="5758436">0</span>&nbsp;<span class="op" id="5758438">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758443">f</span>&nbsp;<span class="op" id="5758445">:=</span>&nbsp;<span class="ident" id="5758448">runtime</span><span class="op" id="5758455">.</span><span class="ident" id="5758456">FuncForPC</span><span class="op" id="5758465">(</span><span class="builtintype" id="5758466">uintptr</span><span class="op" id="5758473">(</span><span class="ident" id="5758474">pc</span><span class="op" id="5758476">)</span><span class="op" id="5758477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758482">if</span>&nbsp;<span class="ident" id="5758485">f</span>&nbsp;<span class="op" id="5758487">!=</span>&nbsp;<span class="ident" id="5758490">nil</span>&nbsp;<span class="op" id="5758494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758500">fmt</span><span class="op" id="5758503">.</span><span class="ident" id="5758504">Fprintf</span><span class="op" id="5758511">(</span><span class="op" id="5758512">&amp;</span><span class="ident" id="5758513">buf</span><span class="op" id="5758516">,</span>&nbsp;<span class="string" id="5758518">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="5758528">,</span>&nbsp;<span class="ident" id="5758530">pc</span><span class="op" id="5758532">,</span>&nbsp;<span class="ident" id="5758534">f</span><span class="op" id="5758535">.</span><span class="ident" id="5758536">Name</span><span class="op" id="5758540">(</span><span class="op" id="5758541">)</span><span class="op" id="5758542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758551">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758556">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758604">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758662">if</span>&nbsp;<span class="ident" id="5758665">err</span>&nbsp;<span class="op" id="5758669">!=</span>&nbsp;<span class="ident" id="5758672">nil</span>&nbsp;<span class="op" id="5758676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758681">if</span>&nbsp;<span class="ident" id="5758684">err</span>&nbsp;<span class="op" id="5758688">!=</span>&nbsp;<span class="ident" id="5758691">io</span><span class="op" id="5758693">.</span><span class="ident" id="5758694">EOF</span>&nbsp;<span class="op" id="5758698">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758704">fmt</span><span class="op" id="5758707">.</span><span class="ident" id="5758708">Fprintf</span><span class="op" id="5758715">(</span><span class="op" id="5758716">&amp;</span><span class="ident" id="5758717">buf</span><span class="op" id="5758720">,</span>&nbsp;<span class="string" id="5758722">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="5758745">,</span>&nbsp;<span class="ident" id="5758747">err</span><span class="op" id="5758750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758760">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758771">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758775">w</span><span class="op" id="5758776">.</span><span class="ident" id="5758777">Write</span><span class="op" id="5758782">(</span><span class="ident" id="5758783">buf</span><span class="op" id="5758786">.</span><span class="ident" id="5758787">Bytes</span><span class="op" id="5758792">(</span><span class="op" id="5758793">)</span><span class="op" id="5758794">)</span><br>
<span class="lineno"></span><span class="op" id="5758796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5758799">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="5758865">func</span>&nbsp;<span class="ident" id="5758870">Handler</span><span class="op" id="5758877">(</span><span class="ident" id="5758878">name</span>&nbsp;<span class="builtintype" id="5758883">string</span><span class="op" id="5758889">)</span>&nbsp;<span class="ident" id="5758891">http</span><span class="op" id="5758895">.</span><span class="ident" id="5758896">Handler</span>&nbsp;<span class="op" id="5758904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758907">return</span>&nbsp;<span class="ident" id="5758914">handler</span><span class="op" id="5758921">(</span><span class="ident" id="5758922">name</span><span class="op" id="5758926">)</span><br>
<span class="lineno"></span><span class="op" id="5758928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5758931">type</span>&nbsp;<span class="ident" id="5758936">handler</span>&nbsp;<span class="builtintype" id="5758944">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="5758952">func</span>&nbsp;<span class="op" id="5758957">(</span><span class="ident" id="5758958">name</span>&nbsp;<span class="ident" id="5758963">handler</span><span class="op" id="5758970">)</span>&nbsp;<span class="ident" id="5758972">ServeHTTP</span><span class="op" id="5758981">(</span><span class="ident" id="5758982">w</span>&nbsp;<span class="ident" id="5758984">http</span><span class="op" id="5758988">.</span><span class="ident" id="5758989">ResponseWriter</span><span class="op" id="5759003">,</span>&nbsp;<span class="ident" id="5759005">r</span>&nbsp;<span class="op" id="5759007">*</span><span class="ident" id="5759008">http</span><span class="op" id="5759012">.</span><span class="ident" id="5759013">Request</span><span class="op" id="5759020">)</span>&nbsp;<span class="op" id="5759022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759025">w</span><span class="op" id="5759026">.</span><span class="ident" id="5759027">Header</span><span class="op" id="5759033">(</span><span class="op" id="5759034">)</span><span class="op" id="5759035">.</span><span class="ident" id="5759036">Set</span><span class="op" id="5759039">(</span><span class="string" id="5759040">&#34;Content-Type&#34;</span><span class="op" id="5759054">,</span>&nbsp;<span class="string" id="5759056">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5759083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759086">debug</span><span class="op" id="5759091">,</span>&nbsp;<span class="ident" id="5759093">_</span>&nbsp;<span class="op" id="5759095">:=</span>&nbsp;<span class="ident" id="5759098">strconv</span><span class="op" id="5759105">.</span><span class="ident" id="5759106">Atoi</span><span class="op" id="5759110">(</span><span class="ident" id="5759111">r</span><span class="op" id="5759112">.</span><span class="ident" id="5759113">FormValue</span><span class="op" id="5759122">(</span><span class="string" id="5759123">&#34;debug&#34;</span><span class="op" id="5759130">)</span><span class="op" id="5759131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759134">p</span>&nbsp;<span class="op" id="5759136">:=</span>&nbsp;<span class="ident" id="5759139">pprof</span><span class="op" id="5759144">.</span><span class="ident" id="5759145">Lookup</span><span class="op" id="5759151">(</span><span class="builtintype" id="5759152">string</span><span class="op" id="5759158">(</span><span class="ident" id="5759159">name</span><span class="op" id="5759163">)</span><span class="op" id="5759164">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759167">if</span>&nbsp;<span class="ident" id="5759170">p</span>&nbsp;<span class="op" id="5759172">==</span>&nbsp;<span class="ident" id="5759175">nil</span>&nbsp;<span class="op" id="5759179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759183">w</span><span class="op" id="5759184">.</span><span class="ident" id="5759185">WriteHeader</span><span class="op" id="5759196">(</span><span class="num" id="5759197">404</span><span class="op" id="5759200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759204">fmt</span><span class="op" id="5759207">.</span><span class="ident" id="5759208">Fprintf</span><span class="op" id="5759215">(</span><span class="ident" id="5759216">w</span><span class="op" id="5759217">,</span>&nbsp;<span class="string" id="5759219">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="5759242">,</span>&nbsp;<span class="ident" id="5759244">name</span><span class="op" id="5759248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759252">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759260">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759263">gc</span><span class="op" id="5759265">,</span>&nbsp;<span class="ident" id="5759267">_</span>&nbsp;<span class="op" id="5759269">:=</span>&nbsp;<span class="ident" id="5759272">strconv</span><span class="op" id="5759279">.</span><span class="ident" id="5759280">Atoi</span><span class="op" id="5759284">(</span><span class="ident" id="5759285">r</span><span class="op" id="5759286">.</span><span class="ident" id="5759287">FormValue</span><span class="op" id="5759296">(</span><span class="string" id="5759297">&#34;gc&#34;</span><span class="op" id="5759301">)</span><span class="op" id="5759302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759305">if</span>&nbsp;<span class="ident" id="5759308">name</span>&nbsp;<span class="op" id="5759313">==</span>&nbsp;<span class="string" id="5759316">&#34;heap&#34;</span>&nbsp;<span class="op" id="5759323">&amp;&amp;</span>&nbsp;<span class="ident" id="5759326">gc</span>&nbsp;<span class="op" id="5759329">&gt;</span>&nbsp;<span class="num" id="5759331">0</span>&nbsp;<span class="op" id="5759333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759337">runtime</span><span class="op" id="5759344">.</span><span class="ident" id="5759345">GC</span><span class="op" id="5759347">(</span><span class="op" id="5759348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759354">p</span><span class="op" id="5759355">.</span><span class="ident" id="5759356">WriteTo</span><span class="op" id="5759363">(</span><span class="ident" id="5759364">w</span><span class="op" id="5759365">,</span>&nbsp;<span class="ident" id="5759367">debug</span><span class="op" id="5759372">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759375">return</span><br>
<span class="lineno"></span><span class="op" id="5759382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5759385">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5759458">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="5759521">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="5759590">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="5759625">func</span>&nbsp;<span class="ident" id="5759630">Index</span><span class="op" id="5759635">(</span><span class="ident" id="5759636">w</span>&nbsp;<span class="ident" id="5759638">http</span><span class="op" id="5759642">.</span><span class="ident" id="5759643">ResponseWriter</span><span class="op" id="5759657">,</span>&nbsp;<span class="ident" id="5759659">r</span>&nbsp;<span class="op" id="5759661">*</span><span class="ident" id="5759662">http</span><span class="op" id="5759666">.</span><span class="ident" id="5759667">Request</span><span class="op" id="5759674">)</span>&nbsp;<span class="op" id="5759676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759679">if</span>&nbsp;<span class="ident" id="5759682">strings</span><span class="op" id="5759689">.</span><span class="ident" id="5759690">HasPrefix</span><span class="op" id="5759699">(</span><span class="ident" id="5759700">r</span><span class="op" id="5759701">.</span><span class="ident" id="5759702">URL</span><span class="op" id="5759705">.</span><span class="ident" id="5759706">Path</span><span class="op" id="5759710">,</span>&nbsp;<span class="string" id="5759712">&#34;/debug/pprof/&#34;</span><span class="op" id="5759727">)</span>&nbsp;<span class="op" id="5759729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759733">name</span>&nbsp;<span class="op" id="5759738">:=</span>&nbsp;<span class="ident" id="5759741">strings</span><span class="op" id="5759748">.</span><span class="ident" id="5759749">TrimPrefix</span><span class="op" id="5759759">(</span><span class="ident" id="5759760">r</span><span class="op" id="5759761">.</span><span class="ident" id="5759762">URL</span><span class="op" id="5759765">.</span><span class="ident" id="5759766">Path</span><span class="op" id="5759770">,</span>&nbsp;<span class="string" id="5759772">&#34;/debug/pprof/&#34;</span><span class="op" id="5759787">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759791">if</span>&nbsp;<span class="ident" id="5759794">name</span>&nbsp;<span class="op" id="5759799">!=</span>&nbsp;<span class="string" id="5759802">&#34;&#34;</span>&nbsp;<span class="op" id="5759805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759810">handler</span><span class="op" id="5759817">(</span><span class="ident" id="5759818">name</span><span class="op" id="5759822">)</span><span class="op" id="5759823">.</span><span class="ident" id="5759824">ServeHTTP</span><span class="op" id="5759833">(</span><span class="ident" id="5759834">w</span><span class="op" id="5759835">,</span>&nbsp;<span class="ident" id="5759837">r</span><span class="op" id="5759838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759843">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759855">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759859">profiles</span>&nbsp;<span class="op" id="5759868">:=</span>&nbsp;<span class="ident" id="5759871">pprof</span><span class="op" id="5759876">.</span><span class="ident" id="5759877">Profiles</span><span class="op" id="5759885">(</span><span class="op" id="5759886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759889">if</span>&nbsp;<span class="ident" id="5759892">err</span>&nbsp;<span class="op" id="5759896">:=</span>&nbsp;<span class="ident" id="5759899">indexTmpl</span><span class="op" id="5759908">.</span><span class="ident" id="5759909">Execute</span><span class="op" id="5759916">(</span><span class="ident" id="5759917">w</span><span class="op" id="5759918">,</span>&nbsp;<span class="ident" id="5759920">profiles</span><span class="op" id="5759928">)</span><span class="op" id="5759929">;</span>&nbsp;<span class="ident" id="5759931">err</span>&nbsp;<span class="op" id="5759935">!=</span>&nbsp;<span class="ident" id="5759938">nil</span>&nbsp;<span class="op" id="5759942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759946">log</span><span class="op" id="5759949">.</span><span class="ident" id="5759950">Print</span><span class="op" id="5759955">(</span><span class="ident" id="5759956">err</span><span class="op" id="5759959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759962">}</span><br>
<span class="lineno">190</span><span class="op" id="5759964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5759967">var</span>&nbsp;<span class="ident" id="5759971">indexTmpl</span>&nbsp;<span class="op" id="5759981">=</span>&nbsp;<span class="ident" id="5759983">template</span><span class="op" id="5759991">.</span><span class="ident" id="5759992">Must</span><span class="op" id="5759996">(</span><span class="ident" id="5759997">template</span><span class="op" id="5760005">.</span><span class="ident" id="5760006">New</span><span class="op" id="5760009">(</span><span class="string" id="5760010">&#34;index&#34;</span><span class="op" id="5760017">)</span><span class="op" id="5760018">.</span><span class="ident" id="5760019">Parse</span><span class="op" id="5760024">(</span><span class="string" id="5760025">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="5760344">)</span><span class="op" id="5760345">)</span>
</div>
</body>
</html>
