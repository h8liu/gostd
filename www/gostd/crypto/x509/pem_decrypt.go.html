<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html" class="current">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3904686">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3904741">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3904795">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3904846">package</span>&nbsp;<span class="ident" id="3904854">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3904860">//&nbsp;RFC&nbsp;1423&nbsp;describes&nbsp;the&nbsp;encryption&nbsp;of&nbsp;PEM&nbsp;blocks.&nbsp;The&nbsp;algorithm&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3904934">//&nbsp;generate&nbsp;a&nbsp;key&nbsp;from&nbsp;the&nbsp;password&nbsp;was&nbsp;derived&nbsp;by&nbsp;looking&nbsp;at&nbsp;the&nbsp;OpenSSL</span><br>
<span class="lineno"></span><span class="comment" id="3905008">//&nbsp;implementation.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3905028">import</span>&nbsp;<span class="op" id="3905035">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3905038">&#34;crypto/aes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3905052">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3905069">&#34;crypto/des&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3905083">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3905097">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3905113">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3905129">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3905139">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3905145">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3905155">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3905158">type</span>&nbsp;<span class="ident" id="3905163">PEMCipher</span>&nbsp;<span class="builtintype" id="3905173">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3905178">//&nbsp;Possible&nbsp;values&nbsp;for&nbsp;the&nbsp;EncryptPEMBlock&nbsp;encryption&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="3905243">const</span>&nbsp;<span class="op" id="3905249">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905252">_</span>&nbsp;<span class="ident" id="3905254">PEMCipher</span>&nbsp;<span class="op" id="3905264">=</span>&nbsp;<span class="ident" id="3905266">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905272">PEMCipherDES</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905286">PEMCipher3DES</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905301">PEMCipherAES128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905318">PEMCipherAES192</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905335">PEMCipherAES256</span><br>
<span class="lineno"></span><span class="op" id="3905351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3905354">//&nbsp;rfc1423Algo&nbsp;holds&nbsp;a&nbsp;method&nbsp;for&nbsp;enciphering&nbsp;a&nbsp;PEM&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="3905413">type</span>&nbsp;<span class="ident" id="3905418">rfc1423Algo</span>&nbsp;<span class="keyword" id="3905430">struct</span>&nbsp;<span class="op" id="3905437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905440">cipher</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905451">PEMCipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905462">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3905473">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905481">cipherFunc</span>&nbsp;<span class="keyword" id="3905492">func</span><span class="op" id="3905496">(</span><span class="ident" id="3905497">key</span>&nbsp;<span class="op" id="3905501">[</span><span class="op" id="3905502">]</span><span class="builtintype" id="3905503">byte</span><span class="op" id="3905507">)</span>&nbsp;<span class="op" id="3905509">(</span><span class="ident" id="3905510">cipher</span><span class="op" id="3905516">.</span><span class="ident" id="3905517">Block</span><span class="op" id="3905522">,</span>&nbsp;<span class="builtintype" id="3905524">error</span><span class="op" id="3905529">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905532">keySize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3905543">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905548">blockSize</span>&nbsp;&nbsp;<span class="builtintype" id="3905559">int</span><br>
<span class="lineno"></span><span class="op" id="3905563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3905566">//&nbsp;rfc1423Algos&nbsp;holds&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;possible&nbsp;ways&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;PEM</span><br>
<span class="lineno">45</span><span class="comment" id="3905634">//&nbsp;block.&nbsp;&nbsp;The&nbsp;ivSize&nbsp;numbers&nbsp;were&nbsp;taken&nbsp;from&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="3905700">var</span>&nbsp;<span class="ident" id="3905704">rfc1423Algos</span>&nbsp;<span class="op" id="3905717">=</span>&nbsp;<span class="op" id="3905719">[</span><span class="op" id="3905720">]</span><span class="ident" id="3905721">rfc1423Algo</span><span class="op" id="3905732">{</span><span class="op" id="3905733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905736">cipher</span><span class="op" id="3905742">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905748">PEMCipherDES</span><span class="op" id="3905760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905763">name</span><span class="op" id="3905767">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3905775">&#34;DES-CBC&#34;</span><span class="op" id="3905784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905787">cipherFunc</span><span class="op" id="3905797">:</span>&nbsp;<span class="ident" id="3905799">des</span><span class="op" id="3905802">.</span><span class="ident" id="3905803">NewCipher</span><span class="op" id="3905812">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905815">keySize</span><span class="op" id="3905822">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3905827">8</span><span class="op" id="3905828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905831">blockSize</span><span class="op" id="3905840">:</span>&nbsp;&nbsp;<span class="ident" id="3905843">des</span><span class="op" id="3905846">.</span><span class="ident" id="3905847">BlockSize</span><span class="op" id="3905856">,</span><br>
<span class="lineno"></span><span class="op" id="3905858">}</span><span class="op" id="3905859">,</span>&nbsp;<span class="op" id="3905861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905864">cipher</span><span class="op" id="3905870">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905876">PEMCipher3DES</span><span class="op" id="3905889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905892">name</span><span class="op" id="3905896">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3905904">&#34;DES-EDE3-CBC&#34;</span><span class="op" id="3905918">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905921">cipherFunc</span><span class="op" id="3905931">:</span>&nbsp;<span class="ident" id="3905933">des</span><span class="op" id="3905936">.</span><span class="ident" id="3905937">NewTripleDESCipher</span><span class="op" id="3905955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905958">keySize</span><span class="op" id="3905965">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3905970">24</span><span class="op" id="3905972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3905975">blockSize</span><span class="op" id="3905984">:</span>&nbsp;&nbsp;<span class="ident" id="3905987">des</span><span class="op" id="3905990">.</span><span class="ident" id="3905991">BlockSize</span><span class="op" id="3906000">,</span><br>
<span class="lineno"></span><span class="op" id="3906002">}</span><span class="op" id="3906003">,</span>&nbsp;<span class="op" id="3906005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906008">cipher</span><span class="op" id="3906014">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906020">PEMCipherAES128</span><span class="op" id="3906035">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906038">name</span><span class="op" id="3906042">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3906050">&#34;AES-128-CBC&#34;</span><span class="op" id="3906063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906066">cipherFunc</span><span class="op" id="3906076">:</span>&nbsp;<span class="ident" id="3906078">aes</span><span class="op" id="3906081">.</span><span class="ident" id="3906082">NewCipher</span><span class="op" id="3906091">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906094">keySize</span><span class="op" id="3906101">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3906106">16</span><span class="op" id="3906108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906111">blockSize</span><span class="op" id="3906120">:</span>&nbsp;&nbsp;<span class="ident" id="3906123">aes</span><span class="op" id="3906126">.</span><span class="ident" id="3906127">BlockSize</span><span class="op" id="3906136">,</span><br>
<span class="lineno"></span><span class="op" id="3906138">}</span><span class="op" id="3906139">,</span>&nbsp;<span class="op" id="3906141">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906144">cipher</span><span class="op" id="3906150">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906156">PEMCipherAES192</span><span class="op" id="3906171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906174">name</span><span class="op" id="3906178">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3906186">&#34;AES-192-CBC&#34;</span><span class="op" id="3906199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906202">cipherFunc</span><span class="op" id="3906212">:</span>&nbsp;<span class="ident" id="3906214">aes</span><span class="op" id="3906217">.</span><span class="ident" id="3906218">NewCipher</span><span class="op" id="3906227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906230">keySize</span><span class="op" id="3906237">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3906242">24</span><span class="op" id="3906244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906247">blockSize</span><span class="op" id="3906256">:</span>&nbsp;&nbsp;<span class="ident" id="3906259">aes</span><span class="op" id="3906262">.</span><span class="ident" id="3906263">BlockSize</span><span class="op" id="3906272">,</span><br>
<span class="lineno">70</span><span class="op" id="3906274">}</span><span class="op" id="3906275">,</span>&nbsp;<span class="op" id="3906277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906280">cipher</span><span class="op" id="3906286">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906292">PEMCipherAES256</span><span class="op" id="3906307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906310">name</span><span class="op" id="3906314">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3906322">&#34;AES-256-CBC&#34;</span><span class="op" id="3906335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906338">cipherFunc</span><span class="op" id="3906348">:</span>&nbsp;<span class="ident" id="3906350">aes</span><span class="op" id="3906353">.</span><span class="ident" id="3906354">NewCipher</span><span class="op" id="3906363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906366">keySize</span><span class="op" id="3906373">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3906378">32</span><span class="op" id="3906380">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906383">blockSize</span><span class="op" id="3906392">:</span>&nbsp;&nbsp;<span class="ident" id="3906395">aes</span><span class="op" id="3906398">.</span><span class="ident" id="3906399">BlockSize</span><span class="op" id="3906408">,</span><br>
<span class="lineno"></span><span class="op" id="3906410">}</span><span class="op" id="3906411">,</span><br>
<span class="lineno"></span><span class="op" id="3906413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3906416">//&nbsp;deriveKey&nbsp;uses&nbsp;a&nbsp;key&nbsp;derivation&nbsp;function&nbsp;to&nbsp;stretch&nbsp;the&nbsp;password&nbsp;into&nbsp;a&nbsp;key</span><br>
<span class="lineno">80</span><span class="comment" id="3906495">//&nbsp;with&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;our&nbsp;cipher&nbsp;requires.&nbsp;This&nbsp;algorithm&nbsp;was&nbsp;derived&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3906575">//&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="3906598">func</span>&nbsp;<span class="op" id="3906603">(</span><span class="ident" id="3906604">c</span>&nbsp;<span class="ident" id="3906606">rfc1423Algo</span><span class="op" id="3906617">)</span>&nbsp;<span class="ident" id="3906619">deriveKey</span><span class="op" id="3906628">(</span><span class="ident" id="3906629">password</span><span class="op" id="3906637">,</span>&nbsp;<span class="ident" id="3906639">salt</span>&nbsp;<span class="op" id="3906644">[</span><span class="op" id="3906645">]</span><span class="builtintype" id="3906646">byte</span><span class="op" id="3906650">)</span>&nbsp;<span class="op" id="3906652">[</span><span class="op" id="3906653">]</span><span class="builtintype" id="3906654">byte</span>&nbsp;<span class="op" id="3906659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906662">hash</span>&nbsp;<span class="op" id="3906667">:=</span>&nbsp;<span class="ident" id="3906670">md5</span><span class="op" id="3906673">.</span><span class="ident" id="3906674">New</span><span class="op" id="3906677">(</span><span class="op" id="3906678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906681">out</span>&nbsp;<span class="op" id="3906685">:=</span>&nbsp;<span class="builtinfunc" id="3906688">make</span><span class="op" id="3906692">(</span><span class="op" id="3906693">[</span><span class="op" id="3906694">]</span><span class="builtintype" id="3906695">byte</span><span class="op" id="3906699">,</span>&nbsp;<span class="ident" id="3906701">c</span><span class="op" id="3906702">.</span><span class="ident" id="3906703">keySize</span><span class="op" id="3906710">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3906713">var</span>&nbsp;<span class="ident" id="3906717">digest</span>&nbsp;<span class="op" id="3906724">[</span><span class="op" id="3906725">]</span><span class="builtintype" id="3906726">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3906733">for</span>&nbsp;<span class="ident" id="3906737">i</span>&nbsp;<span class="op" id="3906739">:=</span>&nbsp;<span class="num" id="3906742">0</span><span class="op" id="3906743">;</span>&nbsp;<span class="ident" id="3906745">i</span>&nbsp;<span class="op" id="3906747">&lt;</span>&nbsp;<span class="builtinfunc" id="3906749">len</span><span class="op" id="3906752">(</span><span class="ident" id="3906753">out</span><span class="op" id="3906756">)</span><span class="op" id="3906757">;</span>&nbsp;<span class="ident" id="3906759">i</span>&nbsp;<span class="op" id="3906761">+=</span>&nbsp;<span class="builtinfunc" id="3906764">len</span><span class="op" id="3906767">(</span><span class="ident" id="3906768">digest</span><span class="op" id="3906774">)</span>&nbsp;<span class="op" id="3906776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906780">hash</span><span class="op" id="3906784">.</span><span class="ident" id="3906785">Reset</span><span class="op" id="3906790">(</span><span class="op" id="3906791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906795">hash</span><span class="op" id="3906799">.</span><span class="ident" id="3906800">Write</span><span class="op" id="3906805">(</span><span class="ident" id="3906806">digest</span><span class="op" id="3906812">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906816">hash</span><span class="op" id="3906820">.</span><span class="ident" id="3906821">Write</span><span class="op" id="3906826">(</span><span class="ident" id="3906827">password</span><span class="op" id="3906835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906839">hash</span><span class="op" id="3906843">.</span><span class="ident" id="3906844">Write</span><span class="op" id="3906849">(</span><span class="ident" id="3906850">salt</span><span class="op" id="3906854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906858">digest</span>&nbsp;<span class="op" id="3906865">=</span>&nbsp;<span class="ident" id="3906867">hash</span><span class="op" id="3906871">.</span><span class="ident" id="3906872">Sum</span><span class="op" id="3906875">(</span><span class="ident" id="3906876">digest</span><span class="op" id="3906882">[</span><span class="op" id="3906883">:</span><span class="num" id="3906884">0</span><span class="op" id="3906885">]</span><span class="op" id="3906886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3906890">copy</span><span class="op" id="3906894">(</span><span class="ident" id="3906895">out</span><span class="op" id="3906898">[</span><span class="ident" id="3906899">i</span><span class="op" id="3906900">:</span><span class="op" id="3906901">]</span><span class="op" id="3906902">,</span>&nbsp;<span class="ident" id="3906904">digest</span><span class="op" id="3906910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3906913">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3906916">return</span>&nbsp;<span class="ident" id="3906923">out</span><br>
<span class="lineno"></span><span class="op" id="3906927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3906930">//&nbsp;IsEncryptedPEMBlock&nbsp;returns&nbsp;if&nbsp;the&nbsp;PEM&nbsp;block&nbsp;is&nbsp;password&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="3907001">func</span>&nbsp;<span class="ident" id="3907006">IsEncryptedPEMBlock</span><span class="op" id="3907025">(</span><span class="ident" id="3907026">b</span>&nbsp;<span class="op" id="3907028">*</span><span class="ident" id="3907029">pem</span><span class="op" id="3907032">.</span><span class="ident" id="3907033">Block</span><span class="op" id="3907038">)</span>&nbsp;<span class="builtintype" id="3907040">bool</span>&nbsp;<span class="op" id="3907045">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3907048">_</span><span class="op" id="3907049">,</span>&nbsp;<span class="ident" id="3907051">ok</span>&nbsp;<span class="op" id="3907054">:=</span>&nbsp;<span class="ident" id="3907057">b</span><span class="op" id="3907058">.</span><span class="ident" id="3907059">Headers</span><span class="op" id="3907066">[</span><span class="string" id="3907067">&#34;DEK-Info&#34;</span><span class="op" id="3907077">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3907080">return</span>&nbsp;<span class="ident" id="3907087">ok</span><br>
<span class="lineno"></span><span class="op" id="3907090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3907093">//&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned&nbsp;when&nbsp;an&nbsp;incorrect&nbsp;password&nbsp;is&nbsp;detected.</span><br>
<span class="lineno">105</span><span class="keyword" id="3907171">var</span>&nbsp;<span class="ident" id="3907175">IncorrectPasswordError</span>&nbsp;<span class="op" id="3907198">=</span>&nbsp;<span class="ident" id="3907200">errors</span><span class="op" id="3907206">.</span><span class="ident" id="3907207">New</span><span class="op" id="3907210">(</span><span class="string" id="3907211">&#34;x509:&nbsp;decryption&nbsp;password&nbsp;incorrect&#34;</span><span class="op" id="3907248">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3907251">//&nbsp;DecryptPEMBlock&nbsp;takes&nbsp;a&nbsp;password&nbsp;encrypted&nbsp;PEM&nbsp;block&nbsp;and&nbsp;the&nbsp;password&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3907332">//&nbsp;encrypt&nbsp;it&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;decrypted&nbsp;DER&nbsp;encoded&nbsp;bytes.&nbsp;It&nbsp;inspects</span><br>
<span class="lineno"></span><span class="comment" id="3907410">//&nbsp;the&nbsp;DEK-Info&nbsp;header&nbsp;to&nbsp;determine&nbsp;the&nbsp;algorithm&nbsp;used&nbsp;for&nbsp;decryption.&nbsp;If&nbsp;no</span><br>
<span class="lineno">110</span><span class="comment" id="3907487">//&nbsp;DEK-Info&nbsp;header&nbsp;is&nbsp;present,&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;If&nbsp;an&nbsp;incorrect&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="3907565">//&nbsp;is&nbsp;detected&nbsp;an&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="3907619">func</span>&nbsp;<span class="ident" id="3907624">DecryptPEMBlock</span><span class="op" id="3907639">(</span><span class="ident" id="3907640">b</span>&nbsp;<span class="op" id="3907642">*</span><span class="ident" id="3907643">pem</span><span class="op" id="3907646">.</span><span class="ident" id="3907647">Block</span><span class="op" id="3907652">,</span>&nbsp;<span class="ident" id="3907654">password</span>&nbsp;<span class="op" id="3907663">[</span><span class="op" id="3907664">]</span><span class="builtintype" id="3907665">byte</span><span class="op" id="3907669">)</span>&nbsp;<span class="op" id="3907671">(</span><span class="op" id="3907672">[</span><span class="op" id="3907673">]</span><span class="builtintype" id="3907674">byte</span><span class="op" id="3907678">,</span>&nbsp;<span class="builtintype" id="3907680">error</span><span class="op" id="3907685">)</span>&nbsp;<span class="op" id="3907687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3907690">dek</span><span class="op" id="3907693">,</span>&nbsp;<span class="ident" id="3907695">ok</span>&nbsp;<span class="op" id="3907698">:=</span>&nbsp;<span class="ident" id="3907701">b</span><span class="op" id="3907702">.</span><span class="ident" id="3907703">Headers</span><span class="op" id="3907710">[</span><span class="string" id="3907711">&#34;DEK-Info&#34;</span><span class="op" id="3907721">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3907724">if</span>&nbsp;<span class="op" id="3907727">!</span><span class="ident" id="3907728">ok</span>&nbsp;<span class="op" id="3907731">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3907735">return</span>&nbsp;<span class="builtintype" id="3907742">nil</span><span class="op" id="3907745">,</span>&nbsp;<span class="ident" id="3907747">errors</span><span class="op" id="3907753">.</span><span class="ident" id="3907754">New</span><span class="op" id="3907757">(</span><span class="string" id="3907758">&#34;x509:&nbsp;no&nbsp;DEK-Info&nbsp;header&nbsp;in&nbsp;block&#34;</span><span class="op" id="3907793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3907796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3907800">idx</span>&nbsp;<span class="op" id="3907804">:=</span>&nbsp;<span class="ident" id="3907807">strings</span><span class="op" id="3907814">.</span><span class="ident" id="3907815">Index</span><span class="op" id="3907820">(</span><span class="ident" id="3907821">dek</span><span class="op" id="3907824">,</span>&nbsp;<span class="string" id="3907826">&#34;,&#34;</span><span class="op" id="3907829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3907832">if</span>&nbsp;<span class="ident" id="3907835">idx</span>&nbsp;<span class="op" id="3907839">==</span>&nbsp;<span class="op" id="3907842">-</span><span class="num" id="3907843">1</span>&nbsp;<span class="op" id="3907845">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3907849">return</span>&nbsp;<span class="builtintype" id="3907856">nil</span><span class="op" id="3907859">,</span>&nbsp;<span class="ident" id="3907861">errors</span><span class="op" id="3907867">.</span><span class="ident" id="3907868">New</span><span class="op" id="3907871">(</span><span class="string" id="3907872">&#34;x509:&nbsp;malformed&nbsp;DEK-Info&nbsp;header&#34;</span><span class="op" id="3907905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3907908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3907912">mode</span><span class="op" id="3907916">,</span>&nbsp;<span class="ident" id="3907918">hexIV</span>&nbsp;<span class="op" id="3907924">:=</span>&nbsp;<span class="ident" id="3907927">dek</span><span class="op" id="3907930">[</span><span class="op" id="3907931">:</span><span class="ident" id="3907932">idx</span><span class="op" id="3907935">]</span><span class="op" id="3907936">,</span>&nbsp;<span class="ident" id="3907938">dek</span><span class="op" id="3907941">[</span><span class="ident" id="3907942">idx</span><span class="op" id="3907945">+</span><span class="num" id="3907946">1</span><span class="op" id="3907947">:</span><span class="op" id="3907948">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3907951">ciph</span>&nbsp;<span class="op" id="3907956">:=</span>&nbsp;<span class="ident" id="3907959">cipherByName</span><span class="op" id="3907971">(</span><span class="ident" id="3907972">mode</span><span class="op" id="3907976">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3907979">if</span>&nbsp;<span class="ident" id="3907982">ciph</span>&nbsp;<span class="op" id="3907987">==</span>&nbsp;<span class="builtintype" id="3907990">nil</span>&nbsp;<span class="op" id="3907994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3907998">return</span>&nbsp;<span class="builtintype" id="3908005">nil</span><span class="op" id="3908008">,</span>&nbsp;<span class="ident" id="3908010">errors</span><span class="op" id="3908016">.</span><span class="ident" id="3908017">New</span><span class="op" id="3908020">(</span><span class="string" id="3908021">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="3908052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3908055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908058">iv</span><span class="op" id="3908060">,</span>&nbsp;<span class="ident" id="3908062">err</span>&nbsp;<span class="op" id="3908066">:=</span>&nbsp;<span class="ident" id="3908069">hex</span><span class="op" id="3908072">.</span><span class="ident" id="3908073">DecodeString</span><span class="op" id="3908085">(</span><span class="ident" id="3908086">hexIV</span><span class="op" id="3908091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908094">if</span>&nbsp;<span class="ident" id="3908097">err</span>&nbsp;<span class="op" id="3908101">!=</span>&nbsp;<span class="builtintype" id="3908104">nil</span>&nbsp;<span class="op" id="3908108">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908112">return</span>&nbsp;<span class="builtintype" id="3908119">nil</span><span class="op" id="3908122">,</span>&nbsp;<span class="ident" id="3908124">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3908129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908132">if</span>&nbsp;<span class="builtinfunc" id="3908135">len</span><span class="op" id="3908138">(</span><span class="ident" id="3908139">iv</span><span class="op" id="3908141">)</span>&nbsp;<span class="op" id="3908143">!=</span>&nbsp;<span class="ident" id="3908146">ciph</span><span class="op" id="3908150">.</span><span class="ident" id="3908151">blockSize</span>&nbsp;<span class="op" id="3908161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908165">return</span>&nbsp;<span class="builtintype" id="3908172">nil</span><span class="op" id="3908175">,</span>&nbsp;<span class="ident" id="3908177">errors</span><span class="op" id="3908183">.</span><span class="ident" id="3908184">New</span><span class="op" id="3908187">(</span><span class="string" id="3908188">&#34;x509:&nbsp;incorrect&nbsp;IV&nbsp;size&#34;</span><span class="op" id="3908213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3908216">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3908220">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;OpenSSL&nbsp;implementation.&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3908291">//&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908325">key</span>&nbsp;<span class="op" id="3908329">:=</span>&nbsp;<span class="ident" id="3908332">ciph</span><span class="op" id="3908336">.</span><span class="ident" id="3908337">deriveKey</span><span class="op" id="3908346">(</span><span class="ident" id="3908347">password</span><span class="op" id="3908355">,</span>&nbsp;<span class="ident" id="3908357">iv</span><span class="op" id="3908359">[</span><span class="op" id="3908360">:</span><span class="num" id="3908361">8</span><span class="op" id="3908362">]</span><span class="op" id="3908363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908366">block</span><span class="op" id="3908371">,</span>&nbsp;<span class="ident" id="3908373">err</span>&nbsp;<span class="op" id="3908377">:=</span>&nbsp;<span class="ident" id="3908380">ciph</span><span class="op" id="3908384">.</span><span class="ident" id="3908385">cipherFunc</span><span class="op" id="3908395">(</span><span class="ident" id="3908396">key</span><span class="op" id="3908399">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908402">if</span>&nbsp;<span class="ident" id="3908405">err</span>&nbsp;<span class="op" id="3908409">!=</span>&nbsp;<span class="builtintype" id="3908412">nil</span>&nbsp;<span class="op" id="3908416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908420">return</span>&nbsp;<span class="builtintype" id="3908427">nil</span><span class="op" id="3908430">,</span>&nbsp;<span class="ident" id="3908432">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3908437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908441">data</span>&nbsp;<span class="op" id="3908446">:=</span>&nbsp;<span class="builtinfunc" id="3908449">make</span><span class="op" id="3908453">(</span><span class="op" id="3908454">[</span><span class="op" id="3908455">]</span><span class="builtintype" id="3908456">byte</span><span class="op" id="3908460">,</span>&nbsp;<span class="builtinfunc" id="3908462">len</span><span class="op" id="3908465">(</span><span class="ident" id="3908466">b</span><span class="op" id="3908467">.</span><span class="ident" id="3908468">Bytes</span><span class="op" id="3908473">)</span><span class="op" id="3908474">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908477">dec</span>&nbsp;<span class="op" id="3908481">:=</span>&nbsp;<span class="ident" id="3908484">cipher</span><span class="op" id="3908490">.</span><span class="ident" id="3908491">NewCBCDecrypter</span><span class="op" id="3908506">(</span><span class="ident" id="3908507">block</span><span class="op" id="3908512">,</span>&nbsp;<span class="ident" id="3908514">iv</span><span class="op" id="3908516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908519">dec</span><span class="op" id="3908522">.</span><span class="ident" id="3908523">CryptBlocks</span><span class="op" id="3908534">(</span><span class="ident" id="3908535">data</span><span class="op" id="3908539">,</span>&nbsp;<span class="ident" id="3908541">b</span><span class="op" id="3908542">.</span><span class="ident" id="3908543">Bytes</span><span class="op" id="3908548">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3908552">//&nbsp;Blocks&nbsp;are&nbsp;padded&nbsp;using&nbsp;a&nbsp;scheme&nbsp;where&nbsp;the&nbsp;last&nbsp;n&nbsp;bytes&nbsp;of&nbsp;padding&nbsp;are&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3908631">//&nbsp;equal&nbsp;to&nbsp;n.&nbsp;It&nbsp;can&nbsp;pad&nbsp;from&nbsp;1&nbsp;to&nbsp;blocksize&nbsp;bytes&nbsp;inclusive.&nbsp;See&nbsp;RFC&nbsp;1423.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3908709">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3908726">//&nbsp;&nbsp;&nbsp;&nbsp;[x&nbsp;y&nbsp;z&nbsp;2&nbsp;2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3908742">//&nbsp;&nbsp;&nbsp;&nbsp;[x&nbsp;y&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3908766">//&nbsp;If&nbsp;we&nbsp;detect&nbsp;a&nbsp;bad&nbsp;padding,&nbsp;we&nbsp;assume&nbsp;it&nbsp;is&nbsp;an&nbsp;invalid&nbsp;password.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908835">dlen</span>&nbsp;<span class="op" id="3908840">:=</span>&nbsp;<span class="builtinfunc" id="3908843">len</span><span class="op" id="3908846">(</span><span class="ident" id="3908847">data</span><span class="op" id="3908851">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908854">if</span>&nbsp;<span class="ident" id="3908857">dlen</span>&nbsp;<span class="op" id="3908862">==</span>&nbsp;<span class="num" id="3908865">0</span>&nbsp;<span class="op" id="3908867">||</span>&nbsp;<span class="ident" id="3908870">dlen</span><span class="op" id="3908874">%</span><span class="ident" id="3908875">ciph</span><span class="op" id="3908879">.</span><span class="ident" id="3908880">blockSize</span>&nbsp;<span class="op" id="3908890">!=</span>&nbsp;<span class="num" id="3908893">0</span>&nbsp;<span class="op" id="3908895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908899">return</span>&nbsp;<span class="builtintype" id="3908906">nil</span><span class="op" id="3908909">,</span>&nbsp;<span class="ident" id="3908911">errors</span><span class="op" id="3908917">.</span><span class="ident" id="3908918">New</span><span class="op" id="3908921">(</span><span class="string" id="3908922">&#34;x509:&nbsp;invalid&nbsp;padding&#34;</span><span class="op" id="3908945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3908948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908951">last</span>&nbsp;<span class="op" id="3908956">:=</span>&nbsp;<span class="builtintype" id="3908959">int</span><span class="op" id="3908962">(</span><span class="ident" id="3908963">data</span><span class="op" id="3908967">[</span><span class="ident" id="3908968">dlen</span><span class="op" id="3908972">-</span><span class="num" id="3908973">1</span><span class="op" id="3908974">]</span><span class="op" id="3908975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908978">if</span>&nbsp;<span class="ident" id="3908981">dlen</span>&nbsp;<span class="op" id="3908986">&lt;</span>&nbsp;<span class="ident" id="3908988">last</span>&nbsp;<span class="op" id="3908993">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908997">return</span>&nbsp;<span class="builtintype" id="3909004">nil</span><span class="op" id="3909007">,</span>&nbsp;<span class="ident" id="3909009">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3909033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909036">if</span>&nbsp;<span class="ident" id="3909039">last</span>&nbsp;<span class="op" id="3909044">==</span>&nbsp;<span class="num" id="3909047">0</span>&nbsp;<span class="op" id="3909049">||</span>&nbsp;<span class="ident" id="3909052">last</span>&nbsp;<span class="op" id="3909057">&gt;</span>&nbsp;<span class="ident" id="3909059">ciph</span><span class="op" id="3909063">.</span><span class="ident" id="3909064">blockSize</span>&nbsp;<span class="op" id="3909074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909078">return</span>&nbsp;<span class="builtintype" id="3909085">nil</span><span class="op" id="3909088">,</span>&nbsp;<span class="ident" id="3909090">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3909114">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909117">for</span>&nbsp;<span class="ident" id="3909121">_</span><span class="op" id="3909122">,</span>&nbsp;<span class="ident" id="3909124">val</span>&nbsp;<span class="op" id="3909128">:=</span>&nbsp;<span class="keyword" id="3909131">range</span>&nbsp;<span class="ident" id="3909137">data</span><span class="op" id="3909141">[</span><span class="ident" id="3909142">dlen</span><span class="op" id="3909146">-</span><span class="ident" id="3909147">last</span><span class="op" id="3909151">:</span><span class="op" id="3909152">]</span>&nbsp;<span class="op" id="3909154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909158">if</span>&nbsp;<span class="builtintype" id="3909161">int</span><span class="op" id="3909164">(</span><span class="ident" id="3909165">val</span><span class="op" id="3909168">)</span>&nbsp;<span class="op" id="3909170">!=</span>&nbsp;<span class="ident" id="3909173">last</span>&nbsp;<span class="op" id="3909178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909183">return</span>&nbsp;<span class="builtintype" id="3909190">nil</span><span class="op" id="3909193">,</span>&nbsp;<span class="ident" id="3909195">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3909220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3909223">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909226">return</span>&nbsp;<span class="ident" id="3909233">data</span><span class="op" id="3909237">[</span><span class="op" id="3909238">:</span><span class="ident" id="3909239">dlen</span><span class="op" id="3909243">-</span><span class="ident" id="3909244">last</span><span class="op" id="3909248">]</span><span class="op" id="3909249">,</span>&nbsp;<span class="builtintype" id="3909251">nil</span><br>
<span class="lineno"></span><span class="op" id="3909255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3909258">//&nbsp;EncryptPEMBlock&nbsp;returns&nbsp;a&nbsp;PEM&nbsp;block&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;holding&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3909331">//&nbsp;given&nbsp;DER-encoded&nbsp;data&nbsp;encrypted&nbsp;with&nbsp;the&nbsp;specified&nbsp;algorithm&nbsp;and</span><br>
<span class="lineno">175</span><span class="comment" id="3909400">//&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3909413">func</span>&nbsp;<span class="ident" id="3909418">EncryptPEMBlock</span><span class="op" id="3909433">(</span><span class="ident" id="3909434">rand</span>&nbsp;<span class="ident" id="3909439">io</span><span class="op" id="3909441">.</span><span class="ident" id="3909442">Reader</span><span class="op" id="3909448">,</span>&nbsp;<span class="ident" id="3909450">blockType</span>&nbsp;<span class="builtintype" id="3909460">string</span><span class="op" id="3909466">,</span>&nbsp;<span class="ident" id="3909468">data</span><span class="op" id="3909472">,</span>&nbsp;<span class="ident" id="3909474">password</span>&nbsp;<span class="op" id="3909483">[</span><span class="op" id="3909484">]</span><span class="builtintype" id="3909485">byte</span><span class="op" id="3909489">,</span>&nbsp;<span class="ident" id="3909491">alg</span>&nbsp;<span class="ident" id="3909495">PEMCipher</span><span class="op" id="3909504">)</span>&nbsp;<span class="op" id="3909506">(</span><span class="op" id="3909507">*</span><span class="ident" id="3909508">pem</span><span class="op" id="3909511">.</span><span class="ident" id="3909512">Block</span><span class="op" id="3909517">,</span>&nbsp;<span class="builtintype" id="3909519">error</span><span class="op" id="3909524">)</span>&nbsp;<span class="op" id="3909526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3909529">ciph</span>&nbsp;<span class="op" id="3909534">:=</span>&nbsp;<span class="ident" id="3909537">cipherByKey</span><span class="op" id="3909548">(</span><span class="ident" id="3909549">alg</span><span class="op" id="3909552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909555">if</span>&nbsp;<span class="ident" id="3909558">ciph</span>&nbsp;<span class="op" id="3909563">==</span>&nbsp;<span class="builtintype" id="3909566">nil</span>&nbsp;<span class="op" id="3909570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909574">return</span>&nbsp;<span class="builtintype" id="3909581">nil</span><span class="op" id="3909584">,</span>&nbsp;<span class="ident" id="3909586">errors</span><span class="op" id="3909592">.</span><span class="ident" id="3909593">New</span><span class="op" id="3909596">(</span><span class="string" id="3909597">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="3909628">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3909631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3909634">iv</span>&nbsp;<span class="op" id="3909637">:=</span>&nbsp;<span class="builtinfunc" id="3909640">make</span><span class="op" id="3909644">(</span><span class="op" id="3909645">[</span><span class="op" id="3909646">]</span><span class="builtintype" id="3909647">byte</span><span class="op" id="3909651">,</span>&nbsp;<span class="ident" id="3909653">ciph</span><span class="op" id="3909657">.</span><span class="ident" id="3909658">blockSize</span><span class="op" id="3909667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909670">if</span>&nbsp;<span class="ident" id="3909673">_</span><span class="op" id="3909674">,</span>&nbsp;<span class="ident" id="3909676">err</span>&nbsp;<span class="op" id="3909680">:=</span>&nbsp;<span class="ident" id="3909683">io</span><span class="op" id="3909685">.</span><span class="ident" id="3909686">ReadFull</span><span class="op" id="3909694">(</span><span class="ident" id="3909695">rand</span><span class="op" id="3909699">,</span>&nbsp;<span class="ident" id="3909701">iv</span><span class="op" id="3909703">)</span><span class="op" id="3909704">;</span>&nbsp;<span class="ident" id="3909706">err</span>&nbsp;<span class="op" id="3909710">!=</span>&nbsp;<span class="builtintype" id="3909713">nil</span>&nbsp;<span class="op" id="3909717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909721">return</span>&nbsp;<span class="builtintype" id="3909728">nil</span><span class="op" id="3909731">,</span>&nbsp;<span class="ident" id="3909733">errors</span><span class="op" id="3909739">.</span><span class="ident" id="3909740">New</span><span class="op" id="3909743">(</span><span class="string" id="3909744">&#34;x509:&nbsp;cannot&nbsp;generate&nbsp;IV:&nbsp;&#34;</span>&nbsp;<span class="op" id="3909773">+</span>&nbsp;<span class="ident" id="3909775">err</span><span class="op" id="3909778">.</span><span class="ident" id="3909779">Error</span><span class="op" id="3909784">(</span><span class="op" id="3909785">)</span><span class="op" id="3909786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3909789">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3909792">//&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3909856">//&nbsp;matching&nbsp;the&nbsp;key&nbsp;derivation&nbsp;in&nbsp;DecryptPEMBlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3909908">key</span>&nbsp;<span class="op" id="3909912">:=</span>&nbsp;<span class="ident" id="3909915">ciph</span><span class="op" id="3909919">.</span><span class="ident" id="3909920">deriveKey</span><span class="op" id="3909929">(</span><span class="ident" id="3909930">password</span><span class="op" id="3909938">,</span>&nbsp;<span class="ident" id="3909940">iv</span><span class="op" id="3909942">[</span><span class="op" id="3909943">:</span><span class="num" id="3909944">8</span><span class="op" id="3909945">]</span><span class="op" id="3909946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3909949">block</span><span class="op" id="3909954">,</span>&nbsp;<span class="ident" id="3909956">err</span>&nbsp;<span class="op" id="3909960">:=</span>&nbsp;<span class="ident" id="3909963">ciph</span><span class="op" id="3909967">.</span><span class="ident" id="3909968">cipherFunc</span><span class="op" id="3909978">(</span><span class="ident" id="3909979">key</span><span class="op" id="3909982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909985">if</span>&nbsp;<span class="ident" id="3909988">err</span>&nbsp;<span class="op" id="3909992">!=</span>&nbsp;<span class="builtintype" id="3909995">nil</span>&nbsp;<span class="op" id="3909999">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3910003">return</span>&nbsp;<span class="builtintype" id="3910010">nil</span><span class="op" id="3910013">,</span>&nbsp;<span class="ident" id="3910015">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3910020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3910023">enc</span>&nbsp;<span class="op" id="3910027">:=</span>&nbsp;<span class="ident" id="3910030">cipher</span><span class="op" id="3910036">.</span><span class="ident" id="3910037">NewCBCEncrypter</span><span class="op" id="3910052">(</span><span class="ident" id="3910053">block</span><span class="op" id="3910058">,</span>&nbsp;<span class="ident" id="3910060">iv</span><span class="op" id="3910062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3910065">pad</span>&nbsp;<span class="op" id="3910069">:=</span>&nbsp;<span class="ident" id="3910072">ciph</span><span class="op" id="3910076">.</span><span class="ident" id="3910077">blockSize</span>&nbsp;<span class="op" id="3910087">-</span>&nbsp;<span class="builtinfunc" id="3910089">len</span><span class="op" id="3910092">(</span><span class="ident" id="3910093">data</span><span class="op" id="3910097">)</span><span class="op" id="3910098">%</span><span class="ident" id="3910099">ciph</span><span class="op" id="3910103">.</span><span class="ident" id="3910104">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3910115">encrypted</span>&nbsp;<span class="op" id="3910125">:=</span>&nbsp;<span class="builtinfunc" id="3910128">make</span><span class="op" id="3910132">(</span><span class="op" id="3910133">[</span><span class="op" id="3910134">]</span><span class="builtintype" id="3910135">byte</span><span class="op" id="3910139">,</span>&nbsp;<span class="builtinfunc" id="3910141">len</span><span class="op" id="3910144">(</span><span class="ident" id="3910145">data</span><span class="op" id="3910149">)</span><span class="op" id="3910150">,</span>&nbsp;<span class="builtinfunc" id="3910152">len</span><span class="op" id="3910155">(</span><span class="ident" id="3910156">data</span><span class="op" id="3910160">)</span><span class="op" id="3910161">+</span><span class="ident" id="3910162">pad</span><span class="op" id="3910165">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3910168">//&nbsp;We&nbsp;could&nbsp;save&nbsp;this&nbsp;copy&nbsp;by&nbsp;encrypting&nbsp;all&nbsp;the&nbsp;whole&nbsp;blocks&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3910234">//&nbsp;the&nbsp;data&nbsp;separately,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;seem&nbsp;worth&nbsp;the&nbsp;additional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3910300">//&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3910310">copy</span><span class="op" id="3910314">(</span><span class="ident" id="3910315">encrypted</span><span class="op" id="3910324">,</span>&nbsp;<span class="ident" id="3910326">data</span><span class="op" id="3910330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3910333">//&nbsp;See&nbsp;RFC&nbsp;1423,&nbsp;section&nbsp;1.1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3910363">for</span>&nbsp;<span class="ident" id="3910367">i</span>&nbsp;<span class="op" id="3910369">:=</span>&nbsp;<span class="num" id="3910372">0</span><span class="op" id="3910373">;</span>&nbsp;<span class="ident" id="3910375">i</span>&nbsp;<span class="op" id="3910377">&lt;</span>&nbsp;<span class="ident" id="3910379">pad</span><span class="op" id="3910382">;</span>&nbsp;<span class="ident" id="3910384">i</span><span class="op" id="3910385">++</span>&nbsp;<span class="op" id="3910388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3910392">encrypted</span>&nbsp;<span class="op" id="3910402">=</span>&nbsp;<span class="builtinfunc" id="3910404">append</span><span class="op" id="3910410">(</span><span class="ident" id="3910411">encrypted</span><span class="op" id="3910420">,</span>&nbsp;<span class="builtintype" id="3910422">byte</span><span class="op" id="3910426">(</span><span class="ident" id="3910427">pad</span><span class="op" id="3910430">)</span><span class="op" id="3910431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3910434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3910437">enc</span><span class="op" id="3910440">.</span><span class="ident" id="3910441">CryptBlocks</span><span class="op" id="3910452">(</span><span class="ident" id="3910453">encrypted</span><span class="op" id="3910462">,</span>&nbsp;<span class="ident" id="3910464">encrypted</span><span class="op" id="3910473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3910477">return</span>&nbsp;<span class="op" id="3910484">&amp;</span><span class="ident" id="3910485">pem</span><span class="op" id="3910488">.</span><span class="ident" id="3910489">Block</span><span class="op" id="3910494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3910498">Type</span><span class="op" id="3910502">:</span>&nbsp;<span class="ident" id="3910504">blockType</span><span class="op" id="3910513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3910517">Headers</span><span class="op" id="3910524">:</span>&nbsp;<span class="keyword" id="3910526">map</span><span class="op" id="3910529">[</span><span class="builtintype" id="3910530">string</span><span class="op" id="3910536">]</span><span class="builtintype" id="3910537">string</span><span class="op" id="3910543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3910548">&#34;Proc-Type&#34;</span><span class="op" id="3910559">:</span>&nbsp;<span class="string" id="3910561">&#34;4,ENCRYPTED&#34;</span><span class="op" id="3910574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3910579">&#34;DEK-Info&#34;</span><span class="op" id="3910589">:</span>&nbsp;&nbsp;<span class="ident" id="3910592">ciph</span><span class="op" id="3910596">.</span><span class="ident" id="3910597">name</span>&nbsp;<span class="op" id="3910602">+</span>&nbsp;<span class="string" id="3910604">&#34;,&#34;</span>&nbsp;<span class="op" id="3910608">+</span>&nbsp;<span class="ident" id="3910610">hex</span><span class="op" id="3910613">.</span><span class="ident" id="3910614">EncodeToString</span><span class="op" id="3910628">(</span><span class="ident" id="3910629">iv</span><span class="op" id="3910631">)</span><span class="op" id="3910632">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3910636">}</span><span class="op" id="3910637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3910641">Bytes</span><span class="op" id="3910646">:</span>&nbsp;<span class="ident" id="3910648">encrypted</span><span class="op" id="3910657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3910660">}</span><span class="op" id="3910661">,</span>&nbsp;<span class="builtintype" id="3910663">nil</span><br>
<span class="lineno"></span><span class="op" id="3910667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="3910670">func</span>&nbsp;<span class="ident" id="3910675">cipherByName</span><span class="op" id="3910687">(</span><span class="ident" id="3910688">name</span>&nbsp;<span class="builtintype" id="3910693">string</span><span class="op" id="3910699">)</span>&nbsp;<span class="op" id="3910701">*</span><span class="ident" id="3910702">rfc1423Algo</span>&nbsp;<span class="op" id="3910714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3910717">for</span>&nbsp;<span class="ident" id="3910721">i</span>&nbsp;<span class="op" id="3910723">:=</span>&nbsp;<span class="keyword" id="3910726">range</span>&nbsp;<span class="ident" id="3910732">rfc1423Algos</span>&nbsp;<span class="op" id="3910745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3910749">alg</span>&nbsp;<span class="op" id="3910753">:=</span>&nbsp;<span class="op" id="3910756">&amp;</span><span class="ident" id="3910757">rfc1423Algos</span><span class="op" id="3910769">[</span><span class="ident" id="3910770">i</span><span class="op" id="3910771">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3910775">if</span>&nbsp;<span class="ident" id="3910778">alg</span><span class="op" id="3910781">.</span><span class="ident" id="3910782">name</span>&nbsp;<span class="op" id="3910787">==</span>&nbsp;<span class="ident" id="3910790">name</span>&nbsp;<span class="op" id="3910795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3910800">return</span>&nbsp;<span class="ident" id="3910807">alg</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3910813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3910816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3910819">return</span>&nbsp;<span class="builtintype" id="3910826">nil</span><br>
<span class="lineno"></span><span class="op" id="3910830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="3910833">func</span>&nbsp;<span class="ident" id="3910838">cipherByKey</span><span class="op" id="3910849">(</span><span class="ident" id="3910850">key</span>&nbsp;<span class="ident" id="3910854">PEMCipher</span><span class="op" id="3910863">)</span>&nbsp;<span class="op" id="3910865">*</span><span class="ident" id="3910866">rfc1423Algo</span>&nbsp;<span class="op" id="3910878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3910881">for</span>&nbsp;<span class="ident" id="3910885">i</span>&nbsp;<span class="op" id="3910887">:=</span>&nbsp;<span class="keyword" id="3910890">range</span>&nbsp;<span class="ident" id="3910896">rfc1423Algos</span>&nbsp;<span class="op" id="3910909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3910913">alg</span>&nbsp;<span class="op" id="3910917">:=</span>&nbsp;<span class="op" id="3910920">&amp;</span><span class="ident" id="3910921">rfc1423Algos</span><span class="op" id="3910933">[</span><span class="ident" id="3910934">i</span><span class="op" id="3910935">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3910939">if</span>&nbsp;<span class="ident" id="3910942">alg</span><span class="op" id="3910945">.</span><span class="ident" id="3910946">cipher</span>&nbsp;<span class="op" id="3910953">==</span>&nbsp;<span class="ident" id="3910956">key</span>&nbsp;<span class="op" id="3910960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3910965">return</span>&nbsp;<span class="ident" id="3910972">alg</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3910978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3910981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3910984">return</span>&nbsp;<span class="builtintype" id="3910991">nil</span><br>
<span class="lineno"></span><span class="op" id="3910995">}</span>
</div>
</body>
</html>
