<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html" class="current">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5242710">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5242765">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5242819">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5242870">//&nbsp;Package&nbsp;tar&nbsp;implements&nbsp;access&nbsp;to&nbsp;tar&nbsp;archives.</span><br>
<span class="lineno"></span><span class="comment" id="5242920">//&nbsp;It&nbsp;aims&nbsp;to&nbsp;cover&nbsp;most&nbsp;of&nbsp;the&nbsp;variations,&nbsp;including&nbsp;those&nbsp;produced</span><br>
<span class="lineno"></span><span class="comment" id="5242989">//&nbsp;by&nbsp;GNU&nbsp;and&nbsp;BSD&nbsp;tars.</span><br>
<span class="lineno"></span><span class="comment" id="5243013">//</span><br>
<span class="lineno"></span><span class="comment" id="5243016">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="5243031">//&nbsp;&nbsp;&nbsp;http://www.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=5</span><br>
<span class="lineno"></span><span class="comment" id="5243091">//&nbsp;&nbsp;&nbsp;http://www.gnu.org/software/tar/manual/html_node/Standard.html</span><br>
<span class="lineno"></span><span class="comment" id="5243159">//&nbsp;&nbsp;&nbsp;http://pubs.opengroup.org/onlinepubs/9699919799/utilities/pax.html</span><br>
<span class="lineno"></span><span class="keyword" id="5243231">package</span>&nbsp;<span class="ident" id="5243239">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5243244">import</span>&nbsp;<span class="op" id="5243251">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5243254">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5243263">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5243273">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5243280">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5243286">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5243294">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5243301">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5243304">const</span>&nbsp;<span class="op" id="5243310">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243313">blockSize</span>&nbsp;<span class="op" id="5243323">=</span>&nbsp;<span class="num" id="5243325">512</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5243331">//&nbsp;Types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243341">TypeReg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243359">=</span>&nbsp;<span class="string" id="5243361">&#39;0&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243368">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243385">TypeRegA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243403">=</span>&nbsp;<span class="string" id="5243405">&#39;\x00&#39;</span>&nbsp;<span class="comment" id="5243412">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243429">TypeLink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243447">=</span>&nbsp;<span class="string" id="5243449">&#39;1&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243456">//&nbsp;hard&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243470">TypeSymlink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243488">=</span>&nbsp;<span class="string" id="5243490">&#39;2&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243497">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243515">TypeChar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243533">=</span>&nbsp;<span class="string" id="5243535">&#39;3&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243542">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243568">TypeBlock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243586">=</span>&nbsp;<span class="string" id="5243588">&#39;4&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243595">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243617">TypeDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243635">=</span>&nbsp;<span class="string" id="5243637">&#39;5&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243644">//&nbsp;directory</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243658">TypeFifo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243676">=</span>&nbsp;<span class="string" id="5243678">&#39;6&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243685">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243699">TypeCont</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243717">=</span>&nbsp;<span class="string" id="5243719">&#39;7&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243726">//&nbsp;reserved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243739">TypeXHeader</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243757">=</span>&nbsp;<span class="string" id="5243759">&#39;x&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243766">//&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243786">TypeXGlobalHeader</span>&nbsp;<span class="op" id="5243804">=</span>&nbsp;<span class="string" id="5243806">&#39;g&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243813">//&nbsp;global&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243840">TypeGNULongName</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5243858">=</span>&nbsp;<span class="string" id="5243860">&#39;L&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243867">//&nbsp;Next&nbsp;file&nbsp;has&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243897">TypeGNULongLink</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5243915">=</span>&nbsp;<span class="string" id="5243917">&#39;K&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243924">//&nbsp;Next&nbsp;file&nbsp;symlinks&nbsp;to&nbsp;a&nbsp;file&nbsp;w/&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243972">TypeGNUSparse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243990">=</span>&nbsp;<span class="string" id="5243992">&#39;S&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243999">//&nbsp;sparse&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="5244014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5244017">//&nbsp;A&nbsp;Header&nbsp;represents&nbsp;a&nbsp;single&nbsp;header&nbsp;in&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno">45</span><span class="comment" id="5244074">//&nbsp;Some&nbsp;fields&nbsp;may&nbsp;not&nbsp;be&nbsp;populated.</span><br>
<span class="lineno"></span><span class="keyword" id="5244111">type</span>&nbsp;<span class="ident" id="5244116">Header</span>&nbsp;<span class="keyword" id="5244123">struct</span>&nbsp;<span class="op" id="5244130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244133">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5244144">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244154">//&nbsp;name&nbsp;of&nbsp;header&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244184">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244195">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244205">//&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244234">Uid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5244245">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244255">//&nbsp;user&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244276">Gid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5244287">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244297">//&nbsp;group&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244319">Size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244330">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244340">//&nbsp;length&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244360">ModTime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244371">time</span><span class="op" id="5244375">.</span><span class="ident" id="5244376">Time</span>&nbsp;<span class="comment" id="5244381">//&nbsp;modified&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244399">Typeflag</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5244410">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244420">//&nbsp;type&nbsp;of&nbsp;header&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244445">Linkname</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5244456">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244466">//&nbsp;target&nbsp;name&nbsp;of&nbsp;link</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244490">Uname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5244501">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244511">//&nbsp;user&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244534">Gname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5244545">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244555">//&nbsp;group&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244579">Devmajor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5244590">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244600">//&nbsp;major&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244646">Devminor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5244657">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244667">//&nbsp;minor&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244713">AccessTime</span>&nbsp;<span class="ident" id="5244724">time</span><span class="op" id="5244728">.</span><span class="ident" id="5244729">Time</span>&nbsp;<span class="comment" id="5244734">//&nbsp;access&nbsp;time</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244750">ChangeTime</span>&nbsp;<span class="ident" id="5244761">time</span><span class="op" id="5244765">.</span><span class="ident" id="5244766">Time</span>&nbsp;<span class="comment" id="5244771">//&nbsp;status&nbsp;change&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244794">Xattrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244805">map</span><span class="op" id="5244808">[</span><span class="builtintype" id="5244809">string</span><span class="op" id="5244815">]</span><span class="builtintype" id="5244816">string</span><br>
<span class="lineno"></span><span class="op" id="5244823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5244826">//&nbsp;File&nbsp;name&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno">65</span><span class="keyword" id="5244868">const</span>&nbsp;<span class="op" id="5244874">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244877">fileNameSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244896">=</span>&nbsp;<span class="num" id="5244898">100</span>&nbsp;<span class="comment" id="5244902">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;a&nbsp;standard&nbsp;tar&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244954">fileNamePrefixSize</span>&nbsp;<span class="op" id="5244973">=</span>&nbsp;<span class="num" id="5244975">155</span>&nbsp;<span class="comment" id="5244979">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;ustar&nbsp;extension&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="op" id="5245023">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="5245026">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;Header.</span><br>
<span class="lineno"></span><span class="keyword" id="5245077">func</span>&nbsp;<span class="op" id="5245082">(</span><span class="ident" id="5245083">h</span>&nbsp;<span class="op" id="5245085">*</span><span class="ident" id="5245086">Header</span><span class="op" id="5245092">)</span>&nbsp;<span class="ident" id="5245094">FileInfo</span><span class="op" id="5245102">(</span><span class="op" id="5245103">)</span>&nbsp;<span class="ident" id="5245105">os</span><span class="op" id="5245107">.</span><span class="ident" id="5245108">FileInfo</span>&nbsp;<span class="op" id="5245117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5245120">return</span>&nbsp;<span class="ident" id="5245127">headerFileInfo</span><span class="op" id="5245141">{</span><span class="ident" id="5245142">h</span><span class="op" id="5245143">}</span><br>
<span class="lineno"></span><span class="op" id="5245145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="5245148">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5245190">type</span>&nbsp;<span class="ident" id="5245195">headerFileInfo</span>&nbsp;<span class="keyword" id="5245210">struct</span>&nbsp;<span class="op" id="5245217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5245220">h</span>&nbsp;<span class="op" id="5245222">*</span><span class="ident" id="5245223">Header</span><br>
<span class="lineno"></span><span class="op" id="5245230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="5245233">func</span>&nbsp;<span class="op" id="5245238">(</span><span class="ident" id="5245239">fi</span>&nbsp;<span class="ident" id="5245242">headerFileInfo</span><span class="op" id="5245256">)</span>&nbsp;<span class="ident" id="5245258">Size</span><span class="op" id="5245262">(</span><span class="op" id="5245263">)</span>&nbsp;<span class="ident" id="5245265">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5245278">{</span>&nbsp;<span class="keyword" id="5245280">return</span>&nbsp;<span class="ident" id="5245287">fi</span><span class="op" id="5245289">.</span><span class="ident" id="5245290">h</span><span class="op" id="5245291">.</span><span class="ident" id="5245292">Size</span>&nbsp;<span class="op" id="5245297">}</span><br>
<span class="lineno"></span><span class="keyword" id="5245299">func</span>&nbsp;<span class="op" id="5245304">(</span><span class="ident" id="5245305">fi</span>&nbsp;<span class="ident" id="5245308">headerFileInfo</span><span class="op" id="5245322">)</span>&nbsp;<span class="ident" id="5245324">IsDir</span><span class="op" id="5245329">(</span><span class="op" id="5245330">)</span>&nbsp;<span class="builtintype" id="5245332">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5245344">{</span>&nbsp;<span class="keyword" id="5245346">return</span>&nbsp;<span class="ident" id="5245353">fi</span><span class="op" id="5245355">.</span><span class="ident" id="5245356">Mode</span><span class="op" id="5245360">(</span><span class="op" id="5245361">)</span><span class="op" id="5245362">.</span><span class="ident" id="5245363">IsDir</span><span class="op" id="5245368">(</span><span class="op" id="5245369">)</span>&nbsp;<span class="op" id="5245371">}</span><br>
<span class="lineno"></span><span class="keyword" id="5245373">func</span>&nbsp;<span class="op" id="5245378">(</span><span class="ident" id="5245379">fi</span>&nbsp;<span class="ident" id="5245382">headerFileInfo</span><span class="op" id="5245396">)</span>&nbsp;<span class="ident" id="5245398">ModTime</span><span class="op" id="5245405">(</span><span class="op" id="5245406">)</span>&nbsp;<span class="ident" id="5245408">time</span><span class="op" id="5245412">.</span><span class="ident" id="5245413">Time</span>&nbsp;<span class="op" id="5245418">{</span>&nbsp;<span class="keyword" id="5245420">return</span>&nbsp;<span class="ident" id="5245427">fi</span><span class="op" id="5245429">.</span><span class="ident" id="5245430">h</span><span class="op" id="5245431">.</span><span class="ident" id="5245432">ModTime</span>&nbsp;<span class="op" id="5245440">}</span><br>
<span class="lineno"></span><span class="keyword" id="5245442">func</span>&nbsp;<span class="op" id="5245447">(</span><span class="ident" id="5245448">fi</span>&nbsp;<span class="ident" id="5245451">headerFileInfo</span><span class="op" id="5245465">)</span>&nbsp;<span class="ident" id="5245467">Sys</span><span class="op" id="5245470">(</span><span class="op" id="5245471">)</span>&nbsp;<span class="keyword" id="5245473">interface</span><span class="op" id="5245482">{</span><span class="op" id="5245483">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5245487">{</span>&nbsp;<span class="keyword" id="5245489">return</span>&nbsp;<span class="ident" id="5245496">fi</span><span class="op" id="5245498">.</span><span class="ident" id="5245499">h</span>&nbsp;<span class="op" id="5245501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5245504">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;base&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5245547">func</span>&nbsp;<span class="op" id="5245552">(</span><span class="ident" id="5245553">fi</span>&nbsp;<span class="ident" id="5245556">headerFileInfo</span><span class="op" id="5245570">)</span>&nbsp;<span class="ident" id="5245572">Name</span><span class="op" id="5245576">(</span><span class="op" id="5245577">)</span>&nbsp;<span class="builtintype" id="5245579">string</span>&nbsp;<span class="op" id="5245586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5245589">if</span>&nbsp;<span class="ident" id="5245592">fi</span><span class="op" id="5245594">.</span><span class="ident" id="5245595">IsDir</span><span class="op" id="5245600">(</span><span class="op" id="5245601">)</span>&nbsp;<span class="op" id="5245603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5245607">return</span>&nbsp;<span class="ident" id="5245614">path</span><span class="op" id="5245618">.</span><span class="ident" id="5245619">Base</span><span class="op" id="5245623">(</span><span class="ident" id="5245624">path</span><span class="op" id="5245628">.</span><span class="ident" id="5245629">Clean</span><span class="op" id="5245634">(</span><span class="ident" id="5245635">fi</span><span class="op" id="5245637">.</span><span class="ident" id="5245638">h</span><span class="op" id="5245639">.</span><span class="ident" id="5245640">Name</span><span class="op" id="5245644">)</span><span class="op" id="5245645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5245648">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5245651">return</span>&nbsp;<span class="ident" id="5245658">path</span><span class="op" id="5245662">.</span><span class="ident" id="5245663">Base</span><span class="op" id="5245667">(</span><span class="ident" id="5245668">fi</span><span class="op" id="5245670">.</span><span class="ident" id="5245671">h</span><span class="op" id="5245672">.</span><span class="ident" id="5245673">Name</span><span class="op" id="5245677">)</span><br>
<span class="lineno"></span><span class="op" id="5245679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5245682">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;headerFileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5245751">func</span>&nbsp;<span class="op" id="5245756">(</span><span class="ident" id="5245757">fi</span>&nbsp;<span class="ident" id="5245760">headerFileInfo</span><span class="op" id="5245774">)</span>&nbsp;<span class="ident" id="5245776">Mode</span><span class="op" id="5245780">(</span><span class="op" id="5245781">)</span>&nbsp;<span class="op" id="5245783">(</span><span class="ident" id="5245784">mode</span>&nbsp;<span class="ident" id="5245789">os</span><span class="op" id="5245791">.</span><span class="ident" id="5245792">FileMode</span><span class="op" id="5245800">)</span>&nbsp;<span class="op" id="5245802">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5245805">//&nbsp;Set&nbsp;file&nbsp;permission&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5245835">mode</span>&nbsp;<span class="op" id="5245840">=</span>&nbsp;<span class="ident" id="5245842">os</span><span class="op" id="5245844">.</span><span class="ident" id="5245845">FileMode</span><span class="op" id="5245853">(</span><span class="ident" id="5245854">fi</span><span class="op" id="5245856">.</span><span class="ident" id="5245857">h</span><span class="op" id="5245858">.</span><span class="ident" id="5245859">Mode</span><span class="op" id="5245863">)</span><span class="op" id="5245864">.</span><span class="ident" id="5245865">Perm</span><span class="op" id="5245869">(</span><span class="op" id="5245870">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5245874">//&nbsp;Set&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5245914">if</span>&nbsp;<span class="ident" id="5245917">fi</span><span class="op" id="5245919">.</span><span class="ident" id="5245920">h</span><span class="op" id="5245921">.</span><span class="ident" id="5245922">Mode</span><span class="op" id="5245926">&amp;</span><span class="ident" id="5245927">c_ISUID</span>&nbsp;<span class="op" id="5245935">!=</span>&nbsp;<span class="num" id="5245938">0</span>&nbsp;<span class="op" id="5245940">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5245944">//&nbsp;setuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5245956">mode</span>&nbsp;<span class="op" id="5245961">|=</span>&nbsp;<span class="ident" id="5245964">os</span><span class="op" id="5245966">.</span><span class="ident" id="5245967">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5245979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5245982">if</span>&nbsp;<span class="ident" id="5245985">fi</span><span class="op" id="5245987">.</span><span class="ident" id="5245988">h</span><span class="op" id="5245989">.</span><span class="ident" id="5245990">Mode</span><span class="op" id="5245994">&amp;</span><span class="ident" id="5245995">c_ISGID</span>&nbsp;<span class="op" id="5246003">!=</span>&nbsp;<span class="num" id="5246006">0</span>&nbsp;<span class="op" id="5246008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246012">//&nbsp;setgid</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246024">mode</span>&nbsp;<span class="op" id="5246029">|=</span>&nbsp;<span class="ident" id="5246032">os</span><span class="op" id="5246034">.</span><span class="ident" id="5246035">ModeSetgid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5246047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246050">if</span>&nbsp;<span class="ident" id="5246053">fi</span><span class="op" id="5246055">.</span><span class="ident" id="5246056">h</span><span class="op" id="5246057">.</span><span class="ident" id="5246058">Mode</span><span class="op" id="5246062">&amp;</span><span class="ident" id="5246063">c_ISVTX</span>&nbsp;<span class="op" id="5246071">!=</span>&nbsp;<span class="num" id="5246074">0</span>&nbsp;<span class="op" id="5246076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246080">//&nbsp;sticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246092">mode</span>&nbsp;<span class="op" id="5246097">|=</span>&nbsp;<span class="ident" id="5246100">os</span><span class="op" id="5246102">.</span><span class="ident" id="5246103">ModeSticky</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5246115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246119">//&nbsp;Set&nbsp;file&nbsp;mode&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246143">//&nbsp;clear&nbsp;perm,&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246191">m</span>&nbsp;<span class="op" id="5246193">:=</span>&nbsp;<span class="ident" id="5246196">os</span><span class="op" id="5246198">.</span><span class="ident" id="5246199">FileMode</span><span class="op" id="5246207">(</span><span class="ident" id="5246208">fi</span><span class="op" id="5246210">.</span><span class="ident" id="5246211">h</span><span class="op" id="5246212">.</span><span class="ident" id="5246213">Mode</span><span class="op" id="5246217">)</span>&nbsp;<span class="op" id="5246219">&amp;^</span>&nbsp;<span class="num" id="5246222">07777</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246229">if</span>&nbsp;<span class="ident" id="5246232">m</span>&nbsp;<span class="op" id="5246234">==</span>&nbsp;<span class="ident" id="5246237">c_ISDIR</span>&nbsp;<span class="op" id="5246245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246249">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246264">mode</span>&nbsp;<span class="op" id="5246269">|=</span>&nbsp;<span class="ident" id="5246272">os</span><span class="op" id="5246274">.</span><span class="ident" id="5246275">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5246284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246287">if</span>&nbsp;<span class="ident" id="5246290">m</span>&nbsp;<span class="op" id="5246292">==</span>&nbsp;<span class="ident" id="5246295">c_ISFIFO</span>&nbsp;<span class="op" id="5246304">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246308">//&nbsp;named&nbsp;pipe&nbsp;(FIFO)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246331">mode</span>&nbsp;<span class="op" id="5246336">|=</span>&nbsp;<span class="ident" id="5246339">os</span><span class="op" id="5246341">.</span><span class="ident" id="5246342">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5246357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246360">if</span>&nbsp;<span class="ident" id="5246363">m</span>&nbsp;<span class="op" id="5246365">==</span>&nbsp;<span class="ident" id="5246368">c_ISLNK</span>&nbsp;<span class="op" id="5246376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246380">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246399">mode</span>&nbsp;<span class="op" id="5246404">|=</span>&nbsp;<span class="ident" id="5246407">os</span><span class="op" id="5246409">.</span><span class="ident" id="5246410">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5246423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246426">if</span>&nbsp;<span class="ident" id="5246429">m</span>&nbsp;<span class="op" id="5246431">==</span>&nbsp;<span class="ident" id="5246434">c_ISBLK</span>&nbsp;<span class="op" id="5246442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246446">//&nbsp;device&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246463">mode</span>&nbsp;<span class="op" id="5246468">|=</span>&nbsp;<span class="ident" id="5246471">os</span><span class="op" id="5246473">.</span><span class="ident" id="5246474">ModeDevice</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5246486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246489">if</span>&nbsp;<span class="ident" id="5246492">m</span>&nbsp;<span class="op" id="5246494">==</span>&nbsp;<span class="ident" id="5246497">c_ISCHR</span>&nbsp;<span class="op" id="5246505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246509">//&nbsp;Unix&nbsp;character&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246536">mode</span>&nbsp;<span class="op" id="5246541">|=</span>&nbsp;<span class="ident" id="5246544">os</span><span class="op" id="5246546">.</span><span class="ident" id="5246547">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246560">mode</span>&nbsp;<span class="op" id="5246565">|=</span>&nbsp;<span class="ident" id="5246568">os</span><span class="op" id="5246570">.</span><span class="ident" id="5246571">ModeCharDevice</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5246587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246590">if</span>&nbsp;<span class="ident" id="5246593">m</span>&nbsp;<span class="op" id="5246595">==</span>&nbsp;<span class="ident" id="5246598">c_ISSOCK</span>&nbsp;<span class="op" id="5246607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246611">//&nbsp;Unix&nbsp;domain&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246635">mode</span>&nbsp;<span class="op" id="5246640">|=</span>&nbsp;<span class="ident" id="5246643">os</span><span class="op" id="5246645">.</span><span class="ident" id="5246646">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5246658">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246662">switch</span>&nbsp;<span class="ident" id="5246669">fi</span><span class="op" id="5246671">.</span><span class="ident" id="5246672">h</span><span class="op" id="5246673">.</span><span class="ident" id="5246674">Typeflag</span>&nbsp;<span class="op" id="5246683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246686">case</span>&nbsp;<span class="ident" id="5246691">TypeLink</span><span class="op" id="5246699">,</span>&nbsp;<span class="ident" id="5246701">TypeSymlink</span><span class="op" id="5246712">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246716">//&nbsp;hard&nbsp;link,&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246746">mode</span>&nbsp;<span class="op" id="5246751">|=</span>&nbsp;<span class="ident" id="5246754">os</span><span class="op" id="5246756">.</span><span class="ident" id="5246757">ModeSymlink</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246770">case</span>&nbsp;<span class="ident" id="5246775">TypeChar</span><span class="op" id="5246783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246787">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246814">mode</span>&nbsp;<span class="op" id="5246819">|=</span>&nbsp;<span class="ident" id="5246822">os</span><span class="op" id="5246824">.</span><span class="ident" id="5246825">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246838">mode</span>&nbsp;<span class="op" id="5246843">|=</span>&nbsp;<span class="ident" id="5246846">os</span><span class="op" id="5246848">.</span><span class="ident" id="5246849">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246865">case</span>&nbsp;<span class="ident" id="5246870">TypeBlock</span><span class="op" id="5246879">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246883">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246906">mode</span>&nbsp;<span class="op" id="5246911">|=</span>&nbsp;<span class="ident" id="5246914">os</span><span class="op" id="5246916">.</span><span class="ident" id="5246917">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246929">case</span>&nbsp;<span class="ident" id="5246934">TypeDir</span><span class="op" id="5246941">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246945">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246960">mode</span>&nbsp;<span class="op" id="5246965">|=</span>&nbsp;<span class="ident" id="5246968">os</span><span class="op" id="5246970">.</span><span class="ident" id="5246971">ModeDir</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246980">case</span>&nbsp;<span class="ident" id="5246985">TypeFifo</span><span class="op" id="5246993">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5246997">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247012">mode</span>&nbsp;<span class="op" id="5247017">|=</span>&nbsp;<span class="ident" id="5247020">os</span><span class="op" id="5247022">.</span><span class="ident" id="5247023">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5247038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247042">return</span>&nbsp;<span class="ident" id="5247049">mode</span><br>
<span class="lineno"></span><span class="op" id="5247054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5247057">//&nbsp;sysStat,&nbsp;if&nbsp;non-nil,&nbsp;populates&nbsp;h&nbsp;from&nbsp;system-dependent&nbsp;fields&nbsp;of&nbsp;fi.</span><br>
<span class="lineno"></span><span class="keyword" id="5247129">var</span>&nbsp;<span class="ident" id="5247133">sysStat</span>&nbsp;<span class="keyword" id="5247141">func</span><span class="op" id="5247145">(</span><span class="ident" id="5247146">fi</span>&nbsp;<span class="ident" id="5247149">os</span><span class="op" id="5247151">.</span><span class="ident" id="5247152">FileInfo</span><span class="op" id="5247160">,</span>&nbsp;<span class="ident" id="5247162">h</span>&nbsp;<span class="op" id="5247164">*</span><span class="ident" id="5247165">Header</span><span class="op" id="5247171">)</span>&nbsp;<span class="builtintype" id="5247173">error</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5247180">//&nbsp;Mode&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5247217">const</span>&nbsp;<span class="op" id="5247223">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247226">c_ISUID</span>&nbsp;&nbsp;<span class="op" id="5247235">=</span>&nbsp;<span class="num" id="5247237">04000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5247245">//&nbsp;Set&nbsp;uid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247257">c_ISGID</span>&nbsp;&nbsp;<span class="op" id="5247266">=</span>&nbsp;<span class="num" id="5247268">02000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5247276">//&nbsp;Set&nbsp;gid</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247288">c_ISVTX</span>&nbsp;&nbsp;<span class="op" id="5247297">=</span>&nbsp;<span class="num" id="5247299">01000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5247307">//&nbsp;Save&nbsp;text&nbsp;(sticky&nbsp;bit)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247334">c_ISDIR</span>&nbsp;&nbsp;<span class="op" id="5247343">=</span>&nbsp;<span class="num" id="5247345">040000</span>&nbsp;&nbsp;<span class="comment" id="5247353">//&nbsp;Directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247367">c_ISFIFO</span>&nbsp;<span class="op" id="5247376">=</span>&nbsp;<span class="num" id="5247378">010000</span>&nbsp;&nbsp;<span class="comment" id="5247386">//&nbsp;FIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247395">c_ISREG</span>&nbsp;&nbsp;<span class="op" id="5247404">=</span>&nbsp;<span class="num" id="5247406">0100000</span>&nbsp;<span class="comment" id="5247414">//&nbsp;Regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247431">c_ISLNK</span>&nbsp;&nbsp;<span class="op" id="5247440">=</span>&nbsp;<span class="num" id="5247442">0120000</span>&nbsp;<span class="comment" id="5247450">//&nbsp;Symbolic&nbsp;link</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247468">c_ISBLK</span>&nbsp;&nbsp;<span class="op" id="5247477">=</span>&nbsp;<span class="num" id="5247479">060000</span>&nbsp;&nbsp;<span class="comment" id="5247487">//&nbsp;Block&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247510">c_ISCHR</span>&nbsp;&nbsp;<span class="op" id="5247519">=</span>&nbsp;<span class="num" id="5247521">020000</span>&nbsp;&nbsp;<span class="comment" id="5247529">//&nbsp;Character&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247556">c_ISSOCK</span>&nbsp;<span class="op" id="5247565">=</span>&nbsp;<span class="num" id="5247567">0140000</span>&nbsp;<span class="comment" id="5247575">//&nbsp;Socket</span><br>
<span class="lineno"></span><span class="op" id="5247585">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5247588">//&nbsp;Keywords&nbsp;for&nbsp;the&nbsp;PAX&nbsp;Extended&nbsp;Header</span><br>
<span class="lineno"></span><span class="keyword" id="5247628">const</span>&nbsp;<span class="op" id="5247634">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247637">paxAtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5247649">=</span>&nbsp;<span class="string" id="5247651">&#34;atime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247660">paxCharset</span>&nbsp;&nbsp;<span class="op" id="5247672">=</span>&nbsp;<span class="string" id="5247674">&#34;charset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247685">paxComment</span>&nbsp;&nbsp;<span class="op" id="5247697">=</span>&nbsp;<span class="string" id="5247699">&#34;comment&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247710">paxCtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5247722">=</span>&nbsp;<span class="string" id="5247724">&#34;ctime&#34;</span>&nbsp;<span class="comment" id="5247732">//&nbsp;please&nbsp;note&nbsp;that&nbsp;ctime&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247786">paxGid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5247798">=</span>&nbsp;<span class="string" id="5247800">&#34;gid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247807">paxGname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5247819">=</span>&nbsp;<span class="string" id="5247821">&#34;gname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247830">paxLinkpath</span>&nbsp;<span class="op" id="5247842">=</span>&nbsp;<span class="string" id="5247844">&#34;linkpath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247856">paxMtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5247868">=</span>&nbsp;<span class="string" id="5247870">&#34;mtime&#34;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247879">paxPath</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5247891">=</span>&nbsp;<span class="string" id="5247893">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247901">paxSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5247913">=</span>&nbsp;<span class="string" id="5247915">&#34;size&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247923">paxUid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5247935">=</span>&nbsp;<span class="string" id="5247937">&#34;uid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247944">paxUname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5247956">=</span>&nbsp;<span class="string" id="5247958">&#34;uname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247967">paxXattr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5247979">=</span>&nbsp;<span class="string" id="5247981">&#34;SCHILY.xattr.&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247998">paxNone</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5248010">=</span>&nbsp;<span class="string" id="5248012">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="5248015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5248018">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;Header&nbsp;from&nbsp;fi.</span><br>
<span class="lineno"></span><span class="comment" id="5248082">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;symlink,&nbsp;FileInfoHeader&nbsp;records&nbsp;link&nbsp;as&nbsp;the&nbsp;link&nbsp;target.</span><br>
<span class="lineno">200</span><span class="comment" id="5248160">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;directory,&nbsp;a&nbsp;slash&nbsp;is&nbsp;appended&nbsp;to&nbsp;the&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="5248225">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5248292">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5248363">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5248432">func</span>&nbsp;<span class="ident" id="5248437">FileInfoHeader</span><span class="op" id="5248451">(</span><span class="ident" id="5248452">fi</span>&nbsp;<span class="ident" id="5248455">os</span><span class="op" id="5248457">.</span><span class="ident" id="5248458">FileInfo</span><span class="op" id="5248466">,</span>&nbsp;<span class="ident" id="5248468">link</span>&nbsp;<span class="builtintype" id="5248473">string</span><span class="op" id="5248479">)</span>&nbsp;<span class="op" id="5248481">(</span><span class="op" id="5248482">*</span><span class="ident" id="5248483">Header</span><span class="op" id="5248489">,</span>&nbsp;<span class="builtintype" id="5248491">error</span><span class="op" id="5248496">)</span>&nbsp;<span class="op" id="5248498">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248501">if</span>&nbsp;<span class="ident" id="5248504">fi</span>&nbsp;<span class="op" id="5248507">==</span>&nbsp;<span class="ident" id="5248510">nil</span>&nbsp;<span class="op" id="5248514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248518">return</span>&nbsp;<span class="ident" id="5248525">nil</span><span class="op" id="5248528">,</span>&nbsp;<span class="ident" id="5248530">errors</span><span class="op" id="5248536">.</span><span class="ident" id="5248537">New</span><span class="op" id="5248540">(</span><span class="string" id="5248541">&#34;tar:&nbsp;FileInfo&nbsp;is&nbsp;nil&#34;</span><span class="op" id="5248563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5248566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248569">fm</span>&nbsp;<span class="op" id="5248572">:=</span>&nbsp;<span class="ident" id="5248575">fi</span><span class="op" id="5248577">.</span><span class="ident" id="5248578">Mode</span><span class="op" id="5248582">(</span><span class="op" id="5248583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248586">h</span>&nbsp;<span class="op" id="5248588">:=</span>&nbsp;<span class="op" id="5248591">&amp;</span><span class="ident" id="5248592">Header</span><span class="op" id="5248598">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248602">Name</span><span class="op" id="5248606">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5248611">fi</span><span class="op" id="5248613">.</span><span class="ident" id="5248614">Name</span><span class="op" id="5248618">(</span><span class="op" id="5248619">)</span><span class="op" id="5248620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248624">ModTime</span><span class="op" id="5248631">:</span>&nbsp;<span class="ident" id="5248633">fi</span><span class="op" id="5248635">.</span><span class="ident" id="5248636">ModTime</span><span class="op" id="5248643">(</span><span class="op" id="5248644">)</span><span class="op" id="5248645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248649">Mode</span><span class="op" id="5248653">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5248658">int64</span><span class="op" id="5248663">(</span><span class="ident" id="5248664">fm</span><span class="op" id="5248666">.</span><span class="ident" id="5248667">Perm</span><span class="op" id="5248671">(</span><span class="op" id="5248672">)</span><span class="op" id="5248673">)</span><span class="op" id="5248674">,</span>&nbsp;<span class="comment" id="5248676">//&nbsp;or&#39;d&nbsp;with&nbsp;c_IS*&nbsp;constants&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5248712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248715">switch</span>&nbsp;<span class="op" id="5248722">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248725">case</span>&nbsp;<span class="ident" id="5248730">fm</span><span class="op" id="5248732">.</span><span class="ident" id="5248733">IsRegular</span><span class="op" id="5248742">(</span><span class="op" id="5248743">)</span><span class="op" id="5248744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248748">h</span><span class="op" id="5248749">.</span><span class="ident" id="5248750">Mode</span>&nbsp;<span class="op" id="5248755">|=</span>&nbsp;<span class="ident" id="5248758">c_ISREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248768">h</span><span class="op" id="5248769">.</span><span class="ident" id="5248770">Typeflag</span>&nbsp;<span class="op" id="5248779">=</span>&nbsp;<span class="ident" id="5248781">TypeReg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248791">h</span><span class="op" id="5248792">.</span><span class="ident" id="5248793">Size</span>&nbsp;<span class="op" id="5248798">=</span>&nbsp;<span class="ident" id="5248800">fi</span><span class="op" id="5248802">.</span><span class="ident" id="5248803">Size</span><span class="op" id="5248807">(</span><span class="op" id="5248808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248811">case</span>&nbsp;<span class="ident" id="5248816">fi</span><span class="op" id="5248818">.</span><span class="ident" id="5248819">IsDir</span><span class="op" id="5248824">(</span><span class="op" id="5248825">)</span><span class="op" id="5248826">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248830">h</span><span class="op" id="5248831">.</span><span class="ident" id="5248832">Typeflag</span>&nbsp;<span class="op" id="5248841">=</span>&nbsp;<span class="ident" id="5248843">TypeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248853">h</span><span class="op" id="5248854">.</span><span class="ident" id="5248855">Mode</span>&nbsp;<span class="op" id="5248860">|=</span>&nbsp;<span class="ident" id="5248863">c_ISDIR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248873">h</span><span class="op" id="5248874">.</span><span class="ident" id="5248875">Name</span>&nbsp;<span class="op" id="5248880">+=</span>&nbsp;<span class="string" id="5248883">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248888">case</span>&nbsp;<span class="ident" id="5248893">fm</span><span class="op" id="5248895">&amp;</span><span class="ident" id="5248896">os</span><span class="op" id="5248898">.</span><span class="ident" id="5248899">ModeSymlink</span>&nbsp;<span class="op" id="5248911">!=</span>&nbsp;<span class="num" id="5248914">0</span><span class="op" id="5248915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248919">h</span><span class="op" id="5248920">.</span><span class="ident" id="5248921">Typeflag</span>&nbsp;<span class="op" id="5248930">=</span>&nbsp;<span class="ident" id="5248932">TypeSymlink</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248946">h</span><span class="op" id="5248947">.</span><span class="ident" id="5248948">Mode</span>&nbsp;<span class="op" id="5248953">|=</span>&nbsp;<span class="ident" id="5248956">c_ISLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248966">h</span><span class="op" id="5248967">.</span><span class="ident" id="5248968">Linkname</span>&nbsp;<span class="op" id="5248977">=</span>&nbsp;<span class="ident" id="5248979">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248985">case</span>&nbsp;<span class="ident" id="5248990">fm</span><span class="op" id="5248992">&amp;</span><span class="ident" id="5248993">os</span><span class="op" id="5248995">.</span><span class="ident" id="5248996">ModeDevice</span>&nbsp;<span class="op" id="5249007">!=</span>&nbsp;<span class="num" id="5249010">0</span><span class="op" id="5249011">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249015">if</span>&nbsp;<span class="ident" id="5249018">fm</span><span class="op" id="5249020">&amp;</span><span class="ident" id="5249021">os</span><span class="op" id="5249023">.</span><span class="ident" id="5249024">ModeCharDevice</span>&nbsp;<span class="op" id="5249039">!=</span>&nbsp;<span class="num" id="5249042">0</span>&nbsp;<span class="op" id="5249044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249049">h</span><span class="op" id="5249050">.</span><span class="ident" id="5249051">Mode</span>&nbsp;<span class="op" id="5249056">|=</span>&nbsp;<span class="ident" id="5249059">c_ISCHR</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249070">h</span><span class="op" id="5249071">.</span><span class="ident" id="5249072">Typeflag</span>&nbsp;<span class="op" id="5249081">=</span>&nbsp;<span class="ident" id="5249083">TypeChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249094">}</span>&nbsp;<span class="keyword" id="5249096">else</span>&nbsp;<span class="op" id="5249101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249106">h</span><span class="op" id="5249107">.</span><span class="ident" id="5249108">Mode</span>&nbsp;<span class="op" id="5249113">|=</span>&nbsp;<span class="ident" id="5249116">c_ISBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249127">h</span><span class="op" id="5249128">.</span><span class="ident" id="5249129">Typeflag</span>&nbsp;<span class="op" id="5249138">=</span>&nbsp;<span class="ident" id="5249140">TypeBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249152">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249155">case</span>&nbsp;<span class="ident" id="5249160">fm</span><span class="op" id="5249162">&amp;</span><span class="ident" id="5249163">os</span><span class="op" id="5249165">.</span><span class="ident" id="5249166">ModeNamedPipe</span>&nbsp;<span class="op" id="5249180">!=</span>&nbsp;<span class="num" id="5249183">0</span><span class="op" id="5249184">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249188">h</span><span class="op" id="5249189">.</span><span class="ident" id="5249190">Typeflag</span>&nbsp;<span class="op" id="5249199">=</span>&nbsp;<span class="ident" id="5249201">TypeFifo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249212">h</span><span class="op" id="5249213">.</span><span class="ident" id="5249214">Mode</span>&nbsp;<span class="op" id="5249219">|=</span>&nbsp;<span class="ident" id="5249222">c_ISFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249232">case</span>&nbsp;<span class="ident" id="5249237">fm</span><span class="op" id="5249239">&amp;</span><span class="ident" id="5249240">os</span><span class="op" id="5249242">.</span><span class="ident" id="5249243">ModeSocket</span>&nbsp;<span class="op" id="5249254">!=</span>&nbsp;<span class="num" id="5249257">0</span><span class="op" id="5249258">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249262">h</span><span class="op" id="5249263">.</span><span class="ident" id="5249264">Mode</span>&nbsp;<span class="op" id="5249269">|=</span>&nbsp;<span class="ident" id="5249272">c_ISSOCK</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249282">default</span><span class="op" id="5249289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249293">return</span>&nbsp;<span class="ident" id="5249300">nil</span><span class="op" id="5249303">,</span>&nbsp;<span class="ident" id="5249305">fmt</span><span class="op" id="5249308">.</span><span class="ident" id="5249309">Errorf</span><span class="op" id="5249315">(</span><span class="string" id="5249316">&#34;archive/tar:&nbsp;unknown&nbsp;file&nbsp;mode&nbsp;%v&#34;</span><span class="op" id="5249351">,</span>&nbsp;<span class="ident" id="5249353">fm</span><span class="op" id="5249355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249361">if</span>&nbsp;<span class="ident" id="5249364">fm</span><span class="op" id="5249366">&amp;</span><span class="ident" id="5249367">os</span><span class="op" id="5249369">.</span><span class="ident" id="5249370">ModeSetuid</span>&nbsp;<span class="op" id="5249381">!=</span>&nbsp;<span class="num" id="5249384">0</span>&nbsp;<span class="op" id="5249386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249390">h</span><span class="op" id="5249391">.</span><span class="ident" id="5249392">Mode</span>&nbsp;<span class="op" id="5249397">|=</span>&nbsp;<span class="ident" id="5249400">c_ISUID</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249412">if</span>&nbsp;<span class="ident" id="5249415">fm</span><span class="op" id="5249417">&amp;</span><span class="ident" id="5249418">os</span><span class="op" id="5249420">.</span><span class="ident" id="5249421">ModeSetgid</span>&nbsp;<span class="op" id="5249432">!=</span>&nbsp;<span class="num" id="5249435">0</span>&nbsp;<span class="op" id="5249437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249441">h</span><span class="op" id="5249442">.</span><span class="ident" id="5249443">Mode</span>&nbsp;<span class="op" id="5249448">|=</span>&nbsp;<span class="ident" id="5249451">c_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249463">if</span>&nbsp;<span class="ident" id="5249466">fm</span><span class="op" id="5249468">&amp;</span><span class="ident" id="5249469">os</span><span class="op" id="5249471">.</span><span class="ident" id="5249472">ModeSticky</span>&nbsp;<span class="op" id="5249483">!=</span>&nbsp;<span class="num" id="5249486">0</span>&nbsp;<span class="op" id="5249488">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249492">h</span><span class="op" id="5249493">.</span><span class="ident" id="5249494">Mode</span>&nbsp;<span class="op" id="5249499">|=</span>&nbsp;<span class="ident" id="5249502">c_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249514">if</span>&nbsp;<span class="ident" id="5249517">sysStat</span>&nbsp;<span class="op" id="5249525">!=</span>&nbsp;<span class="ident" id="5249528">nil</span>&nbsp;<span class="op" id="5249532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249536">return</span>&nbsp;<span class="ident" id="5249543">h</span><span class="op" id="5249544">,</span>&nbsp;<span class="ident" id="5249546">sysStat</span><span class="op" id="5249553">(</span><span class="ident" id="5249554">fi</span><span class="op" id="5249556">,</span>&nbsp;<span class="ident" id="5249558">h</span><span class="op" id="5249559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249562">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249565">return</span>&nbsp;<span class="ident" id="5249572">h</span><span class="op" id="5249573">,</span>&nbsp;<span class="ident" id="5249575">nil</span><br>
<span class="lineno"></span><span class="op" id="5249579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5249582">var</span>&nbsp;<span class="ident" id="5249586">zeroBlock</span>&nbsp;<span class="op" id="5249596">=</span>&nbsp;<span class="builtinfunc" id="5249598">make</span><span class="op" id="5249602">(</span><span class="op" id="5249603">[</span><span class="op" id="5249604">]</span><span class="builtintype" id="5249605">byte</span><span class="op" id="5249609">,</span>&nbsp;<span class="ident" id="5249611">blockSize</span><span class="op" id="5249620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5249623">//&nbsp;POSIX&nbsp;specifies&nbsp;a&nbsp;sum&nbsp;of&nbsp;the&nbsp;unsigned&nbsp;byte&nbsp;values,&nbsp;but&nbsp;the&nbsp;Sun&nbsp;tar&nbsp;uses&nbsp;signed&nbsp;byte&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="5249718">//&nbsp;We&nbsp;compute&nbsp;and&nbsp;return&nbsp;both.</span><br>
<span class="lineno"></span><span class="keyword" id="5249749">func</span>&nbsp;<span class="ident" id="5249754">checksum</span><span class="op" id="5249762">(</span><span class="ident" id="5249763">header</span>&nbsp;<span class="op" id="5249770">[</span><span class="op" id="5249771">]</span><span class="builtintype" id="5249772">byte</span><span class="op" id="5249776">)</span>&nbsp;<span class="op" id="5249778">(</span><span class="ident" id="5249779">unsigned</span>&nbsp;<span class="ident" id="5249788">int64</span><span class="op" id="5249793">,</span>&nbsp;<span class="ident" id="5249795">signed</span>&nbsp;<span class="ident" id="5249802">int64</span><span class="op" id="5249807">)</span>&nbsp;<span class="op" id="5249809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249812">for</span>&nbsp;<span class="ident" id="5249816">i</span>&nbsp;<span class="op" id="5249818">:=</span>&nbsp;<span class="num" id="5249821">0</span><span class="op" id="5249822">;</span>&nbsp;<span class="ident" id="5249824">i</span>&nbsp;<span class="op" id="5249826">&lt;</span>&nbsp;<span class="builtinfunc" id="5249828">len</span><span class="op" id="5249831">(</span><span class="ident" id="5249832">header</span><span class="op" id="5249838">)</span><span class="op" id="5249839">;</span>&nbsp;<span class="ident" id="5249841">i</span><span class="op" id="5249842">++</span>&nbsp;<span class="op" id="5249845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249849">if</span>&nbsp;<span class="ident" id="5249852">i</span>&nbsp;<span class="op" id="5249854">==</span>&nbsp;<span class="num" id="5249857">148</span>&nbsp;<span class="op" id="5249861">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5249866">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;(header[148:156])&nbsp;is&nbsp;special:&nbsp;it&nbsp;should&nbsp;be&nbsp;treated&nbsp;as&nbsp;space&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249956">unsigned</span>&nbsp;<span class="op" id="5249965">+=</span>&nbsp;<span class="string" id="5249968">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5249972">*</span>&nbsp;<span class="num" id="5249974">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249979">signed</span>&nbsp;<span class="op" id="5249986">+=</span>&nbsp;<span class="string" id="5249989">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5249993">*</span>&nbsp;<span class="num" id="5249995">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250000">i</span>&nbsp;<span class="op" id="5250002">+=</span>&nbsp;<span class="num" id="5250005">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250010">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250025">unsigned</span>&nbsp;<span class="op" id="5250034">+=</span>&nbsp;<span class="ident" id="5250037">int64</span><span class="op" id="5250042">(</span><span class="ident" id="5250043">header</span><span class="op" id="5250049">[</span><span class="ident" id="5250050">i</span><span class="op" id="5250051">]</span><span class="op" id="5250052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250056">signed</span>&nbsp;<span class="op" id="5250063">+=</span>&nbsp;<span class="ident" id="5250066">int64</span><span class="op" id="5250071">(</span><span class="builtintype" id="5250072">int8</span><span class="op" id="5250076">(</span><span class="ident" id="5250077">header</span><span class="op" id="5250083">[</span><span class="ident" id="5250084">i</span><span class="op" id="5250085">]</span><span class="op" id="5250086">)</span><span class="op" id="5250087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250093">return</span><br>
<span class="lineno">275</span><span class="op" id="5250100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5250103">type</span>&nbsp;<span class="ident" id="5250108">slicer</span>&nbsp;<span class="op" id="5250115">[</span><span class="op" id="5250116">]</span><span class="builtintype" id="5250117">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5250123">func</span>&nbsp;<span class="op" id="5250128">(</span><span class="ident" id="5250129">sp</span>&nbsp;<span class="op" id="5250132">*</span><span class="ident" id="5250133">slicer</span><span class="op" id="5250139">)</span>&nbsp;<span class="ident" id="5250141">next</span><span class="op" id="5250145">(</span><span class="ident" id="5250146">n</span>&nbsp;<span class="builtintype" id="5250148">int</span><span class="op" id="5250151">)</span>&nbsp;<span class="op" id="5250153">(</span><span class="ident" id="5250154">b</span>&nbsp;<span class="op" id="5250156">[</span><span class="op" id="5250157">]</span><span class="builtintype" id="5250158">byte</span><span class="op" id="5250162">)</span>&nbsp;<span class="op" id="5250164">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250167">s</span>&nbsp;<span class="op" id="5250169">:=</span>&nbsp;<span class="op" id="5250172">*</span><span class="ident" id="5250173">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250177">b</span><span class="op" id="5250178">,</span>&nbsp;<span class="op" id="5250180">*</span><span class="ident" id="5250181">sp</span>&nbsp;<span class="op" id="5250184">=</span>&nbsp;<span class="ident" id="5250186">s</span><span class="op" id="5250187">[</span><span class="num" id="5250188">0</span><span class="op" id="5250189">:</span><span class="ident" id="5250190">n</span><span class="op" id="5250191">]</span><span class="op" id="5250192">,</span>&nbsp;<span class="ident" id="5250194">s</span><span class="op" id="5250195">[</span><span class="ident" id="5250196">n</span><span class="op" id="5250197">:</span><span class="op" id="5250198">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250201">return</span><br>
<span class="lineno"></span><span class="op" id="5250208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5250211">func</span>&nbsp;<span class="ident" id="5250216">isASCII</span><span class="op" id="5250223">(</span><span class="ident" id="5250224">s</span>&nbsp;<span class="builtintype" id="5250226">string</span><span class="op" id="5250232">)</span>&nbsp;<span class="builtintype" id="5250234">bool</span>&nbsp;<span class="op" id="5250239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250242">for</span>&nbsp;<span class="ident" id="5250246">_</span><span class="op" id="5250247">,</span>&nbsp;<span class="ident" id="5250249">c</span>&nbsp;<span class="op" id="5250251">:=</span>&nbsp;<span class="keyword" id="5250254">range</span>&nbsp;<span class="ident" id="5250260">s</span>&nbsp;<span class="op" id="5250262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250266">if</span>&nbsp;<span class="ident" id="5250269">c</span>&nbsp;<span class="op" id="5250271">&gt;=</span>&nbsp;<span class="num" id="5250274">0x80</span>&nbsp;<span class="op" id="5250279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250284">return</span>&nbsp;<span class="builtintype" id="5250291">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250299">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250305">return</span>&nbsp;<span class="builtintype" id="5250312">true</span><br>
<span class="lineno"></span><span class="op" id="5250317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5250320">func</span>&nbsp;<span class="ident" id="5250325">toASCII</span><span class="op" id="5250332">(</span><span class="ident" id="5250333">s</span>&nbsp;<span class="builtintype" id="5250335">string</span><span class="op" id="5250341">)</span>&nbsp;<span class="builtintype" id="5250343">string</span>&nbsp;<span class="op" id="5250350">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250353">if</span>&nbsp;<span class="ident" id="5250356">isASCII</span><span class="op" id="5250363">(</span><span class="ident" id="5250364">s</span><span class="op" id="5250365">)</span>&nbsp;<span class="op" id="5250367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250371">return</span>&nbsp;<span class="ident" id="5250378">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250384">var</span>&nbsp;<span class="ident" id="5250388">buf</span>&nbsp;<span class="ident" id="5250392">bytes</span><span class="op" id="5250397">.</span><span class="ident" id="5250398">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250406">for</span>&nbsp;<span class="ident" id="5250410">_</span><span class="op" id="5250411">,</span>&nbsp;<span class="ident" id="5250413">c</span>&nbsp;<span class="op" id="5250415">:=</span>&nbsp;<span class="keyword" id="5250418">range</span>&nbsp;<span class="ident" id="5250424">s</span>&nbsp;<span class="op" id="5250426">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250430">if</span>&nbsp;<span class="ident" id="5250433">c</span>&nbsp;<span class="op" id="5250435">&lt;</span>&nbsp;<span class="num" id="5250437">0x80</span>&nbsp;<span class="op" id="5250442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250447">buf</span><span class="op" id="5250450">.</span><span class="ident" id="5250451">WriteByte</span><span class="op" id="5250460">(</span><span class="builtintype" id="5250461">byte</span><span class="op" id="5250465">(</span><span class="ident" id="5250466">c</span><span class="op" id="5250467">)</span><span class="op" id="5250468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250478">return</span>&nbsp;<span class="ident" id="5250485">buf</span><span class="op" id="5250488">.</span><span class="ident" id="5250489">String</span><span class="op" id="5250495">(</span><span class="op" id="5250496">)</span><br>
<span class="lineno">305</span><span class="op" id="5250498">}</span>
</div>
</body>
</html>
