<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8004759">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8004815">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8004869">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8004920">//&nbsp;+build&nbsp;!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8004938">package</span>&nbsp;<span class="ident" id="8004946">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8004951">import</span>&nbsp;<span class="op" id="8004958">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8004961">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8004972">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8004983">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8004993">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8004996">var</span>&nbsp;<span class="ident" id="8005000">listenerTests</span>&nbsp;<span class="op" id="8005014">=</span>&nbsp;<span class="op" id="8005016">[</span><span class="op" id="8005017">]</span><span class="keyword" id="8005018">struct</span>&nbsp;<span class="op" id="8005025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005028">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8005037">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005045">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8005054">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005062">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8005071">bool</span>&nbsp;<span class="comment" id="8005076">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005117">wildcard</span>&nbsp;<span class="builtintype" id="8005126">bool</span>&nbsp;<span class="comment" id="8005131">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">20</span><span class="op" id="8005161">}</span><span class="op" id="8005162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005165">{</span><span class="ident" id="8005166">net</span><span class="op" id="8005169">:</span>&nbsp;<span class="string" id="8005171">&#34;tcp&#34;</span><span class="op" id="8005176">,</span>&nbsp;<span class="ident" id="8005178">laddr</span><span class="op" id="8005183">:</span>&nbsp;<span class="string" id="8005185">&#34;&#34;</span><span class="op" id="8005187">,</span>&nbsp;<span class="ident" id="8005189">wildcard</span><span class="op" id="8005197">:</span>&nbsp;<span class="builtintype" id="8005199">true</span><span class="op" id="8005203">}</span><span class="op" id="8005204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005207">{</span><span class="ident" id="8005208">net</span><span class="op" id="8005211">:</span>&nbsp;<span class="string" id="8005213">&#34;tcp&#34;</span><span class="op" id="8005218">,</span>&nbsp;<span class="ident" id="8005220">laddr</span><span class="op" id="8005225">:</span>&nbsp;<span class="string" id="8005227">&#34;0.0.0.0&#34;</span><span class="op" id="8005236">,</span>&nbsp;<span class="ident" id="8005238">wildcard</span><span class="op" id="8005246">:</span>&nbsp;<span class="builtintype" id="8005248">true</span><span class="op" id="8005252">}</span><span class="op" id="8005253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005256">{</span><span class="ident" id="8005257">net</span><span class="op" id="8005260">:</span>&nbsp;<span class="string" id="8005262">&#34;tcp&#34;</span><span class="op" id="8005267">,</span>&nbsp;<span class="ident" id="8005269">laddr</span><span class="op" id="8005274">:</span>&nbsp;<span class="string" id="8005276">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8005294">,</span>&nbsp;<span class="ident" id="8005296">wildcard</span><span class="op" id="8005304">:</span>&nbsp;<span class="builtintype" id="8005306">true</span><span class="op" id="8005310">}</span><span class="op" id="8005311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005314">{</span><span class="ident" id="8005315">net</span><span class="op" id="8005318">:</span>&nbsp;<span class="string" id="8005320">&#34;tcp&#34;</span><span class="op" id="8005325">,</span>&nbsp;<span class="ident" id="8005327">laddr</span><span class="op" id="8005332">:</span>&nbsp;<span class="string" id="8005334">&#34;[::]&#34;</span><span class="op" id="8005340">,</span>&nbsp;<span class="ident" id="8005342">ipv6</span><span class="op" id="8005346">:</span>&nbsp;<span class="builtintype" id="8005348">true</span><span class="op" id="8005352">,</span>&nbsp;<span class="ident" id="8005354">wildcard</span><span class="op" id="8005362">:</span>&nbsp;<span class="builtintype" id="8005364">true</span><span class="op" id="8005368">}</span><span class="op" id="8005369">,</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005373">{</span><span class="ident" id="8005374">net</span><span class="op" id="8005377">:</span>&nbsp;<span class="string" id="8005379">&#34;tcp&#34;</span><span class="op" id="8005384">,</span>&nbsp;<span class="ident" id="8005386">laddr</span><span class="op" id="8005391">:</span>&nbsp;<span class="string" id="8005393">&#34;127.0.0.1&#34;</span><span class="op" id="8005404">}</span><span class="op" id="8005405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005408">{</span><span class="ident" id="8005409">net</span><span class="op" id="8005412">:</span>&nbsp;<span class="string" id="8005414">&#34;tcp&#34;</span><span class="op" id="8005419">,</span>&nbsp;<span class="ident" id="8005421">laddr</span><span class="op" id="8005426">:</span>&nbsp;<span class="string" id="8005428">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8005448">}</span><span class="op" id="8005449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005452">{</span><span class="ident" id="8005453">net</span><span class="op" id="8005456">:</span>&nbsp;<span class="string" id="8005458">&#34;tcp&#34;</span><span class="op" id="8005463">,</span>&nbsp;<span class="ident" id="8005465">laddr</span><span class="op" id="8005470">:</span>&nbsp;<span class="string" id="8005472">&#34;[::1]&#34;</span><span class="op" id="8005479">,</span>&nbsp;<span class="ident" id="8005481">ipv6</span><span class="op" id="8005485">:</span>&nbsp;<span class="builtintype" id="8005487">true</span><span class="op" id="8005491">}</span><span class="op" id="8005492">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005496">{</span><span class="ident" id="8005497">net</span><span class="op" id="8005500">:</span>&nbsp;<span class="string" id="8005502">&#34;tcp4&#34;</span><span class="op" id="8005508">,</span>&nbsp;<span class="ident" id="8005510">laddr</span><span class="op" id="8005515">:</span>&nbsp;<span class="string" id="8005517">&#34;&#34;</span><span class="op" id="8005519">,</span>&nbsp;<span class="ident" id="8005521">wildcard</span><span class="op" id="8005529">:</span>&nbsp;<span class="builtintype" id="8005531">true</span><span class="op" id="8005535">}</span><span class="op" id="8005536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005539">{</span><span class="ident" id="8005540">net</span><span class="op" id="8005543">:</span>&nbsp;<span class="string" id="8005545">&#34;tcp4&#34;</span><span class="op" id="8005551">,</span>&nbsp;<span class="ident" id="8005553">laddr</span><span class="op" id="8005558">:</span>&nbsp;<span class="string" id="8005560">&#34;0.0.0.0&#34;</span><span class="op" id="8005569">,</span>&nbsp;<span class="ident" id="8005571">wildcard</span><span class="op" id="8005579">:</span>&nbsp;<span class="builtintype" id="8005581">true</span><span class="op" id="8005585">}</span><span class="op" id="8005586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005589">{</span><span class="ident" id="8005590">net</span><span class="op" id="8005593">:</span>&nbsp;<span class="string" id="8005595">&#34;tcp4&#34;</span><span class="op" id="8005601">,</span>&nbsp;<span class="ident" id="8005603">laddr</span><span class="op" id="8005608">:</span>&nbsp;<span class="string" id="8005610">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8005628">,</span>&nbsp;<span class="ident" id="8005630">wildcard</span><span class="op" id="8005638">:</span>&nbsp;<span class="builtintype" id="8005640">true</span><span class="op" id="8005644">}</span><span class="op" id="8005645">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005649">{</span><span class="ident" id="8005650">net</span><span class="op" id="8005653">:</span>&nbsp;<span class="string" id="8005655">&#34;tcp4&#34;</span><span class="op" id="8005661">,</span>&nbsp;<span class="ident" id="8005663">laddr</span><span class="op" id="8005668">:</span>&nbsp;<span class="string" id="8005670">&#34;127.0.0.1&#34;</span><span class="op" id="8005681">}</span><span class="op" id="8005682">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005685">{</span><span class="ident" id="8005686">net</span><span class="op" id="8005689">:</span>&nbsp;<span class="string" id="8005691">&#34;tcp4&#34;</span><span class="op" id="8005697">,</span>&nbsp;<span class="ident" id="8005699">laddr</span><span class="op" id="8005704">:</span>&nbsp;<span class="string" id="8005706">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8005726">}</span><span class="op" id="8005727">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005731">{</span><span class="ident" id="8005732">net</span><span class="op" id="8005735">:</span>&nbsp;<span class="string" id="8005737">&#34;tcp6&#34;</span><span class="op" id="8005743">,</span>&nbsp;<span class="ident" id="8005745">laddr</span><span class="op" id="8005750">:</span>&nbsp;<span class="string" id="8005752">&#34;&#34;</span><span class="op" id="8005754">,</span>&nbsp;<span class="ident" id="8005756">ipv6</span><span class="op" id="8005760">:</span>&nbsp;<span class="builtintype" id="8005762">true</span><span class="op" id="8005766">,</span>&nbsp;<span class="ident" id="8005768">wildcard</span><span class="op" id="8005776">:</span>&nbsp;<span class="builtintype" id="8005778">true</span><span class="op" id="8005782">}</span><span class="op" id="8005783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005786">{</span><span class="ident" id="8005787">net</span><span class="op" id="8005790">:</span>&nbsp;<span class="string" id="8005792">&#34;tcp6&#34;</span><span class="op" id="8005798">,</span>&nbsp;<span class="ident" id="8005800">laddr</span><span class="op" id="8005805">:</span>&nbsp;<span class="string" id="8005807">&#34;[::]&#34;</span><span class="op" id="8005813">,</span>&nbsp;<span class="ident" id="8005815">ipv6</span><span class="op" id="8005819">:</span>&nbsp;<span class="builtintype" id="8005821">true</span><span class="op" id="8005825">,</span>&nbsp;<span class="ident" id="8005827">wildcard</span><span class="op" id="8005835">:</span>&nbsp;<span class="builtintype" id="8005837">true</span><span class="op" id="8005841">}</span><span class="op" id="8005842">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005846">{</span><span class="ident" id="8005847">net</span><span class="op" id="8005850">:</span>&nbsp;<span class="string" id="8005852">&#34;tcp6&#34;</span><span class="op" id="8005858">,</span>&nbsp;<span class="ident" id="8005860">laddr</span><span class="op" id="8005865">:</span>&nbsp;<span class="string" id="8005867">&#34;[::1]&#34;</span><span class="op" id="8005874">,</span>&nbsp;<span class="ident" id="8005876">ipv6</span><span class="op" id="8005880">:</span>&nbsp;<span class="builtintype" id="8005882">true</span><span class="op" id="8005886">}</span><span class="op" id="8005887">,</span><br>
<span class="lineno"></span><span class="op" id="8005889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8005892">//&nbsp;TestTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="8005957">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno">45</span><span class="comment" id="8006022">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8006036">func</span>&nbsp;<span class="ident" id="8006041">TestTCPListener</span><span class="op" id="8006056">(</span><span class="ident" id="8006057">t</span>&nbsp;<span class="op" id="8006059">*</span><span class="ident" id="8006060">testing</span><span class="op" id="8006067">.</span><span class="ident" id="8006068">T</span><span class="op" id="8006069">)</span>&nbsp;<span class="op" id="8006071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006074">switch</span>&nbsp;<span class="ident" id="8006081">runtime</span><span class="op" id="8006088">.</span><span class="ident" id="8006089">GOOS</span>&nbsp;<span class="op" id="8006094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006097">case</span>&nbsp;<span class="string" id="8006102">&#34;plan9&#34;</span><span class="op" id="8006109">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006113">t</span><span class="op" id="8006114">.</span><span class="ident" id="8006115">Skipf</span><span class="op" id="8006120">(</span><span class="string" id="8006121">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8006142">,</span>&nbsp;<span class="ident" id="8006144">runtime</span><span class="op" id="8006151">.</span><span class="ident" id="8006152">GOOS</span><span class="op" id="8006156">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006163">for</span>&nbsp;<span class="ident" id="8006167">_</span><span class="op" id="8006168">,</span>&nbsp;<span class="ident" id="8006170">tt</span>&nbsp;<span class="op" id="8006173">:=</span>&nbsp;<span class="keyword" id="8006176">range</span>&nbsp;<span class="ident" id="8006182">listenerTests</span>&nbsp;<span class="op" id="8006196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006200">if</span>&nbsp;<span class="ident" id="8006203">tt</span><span class="op" id="8006205">.</span><span class="ident" id="8006206">wildcard</span>&nbsp;<span class="op" id="8006215">&amp;&amp;</span>&nbsp;<span class="op" id="8006218">(</span><span class="ident" id="8006219">testing</span><span class="op" id="8006226">.</span><span class="ident" id="8006227">Short</span><span class="op" id="8006232">(</span><span class="op" id="8006233">)</span>&nbsp;<span class="op" id="8006235">||</span>&nbsp;<span class="op" id="8006238">!</span><span class="op" id="8006239">*</span><span class="ident" id="8006240">testExternal</span><span class="op" id="8006252">)</span>&nbsp;<span class="op" id="8006254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006259">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006274">if</span>&nbsp;<span class="ident" id="8006277">tt</span><span class="op" id="8006279">.</span><span class="ident" id="8006280">ipv6</span>&nbsp;<span class="op" id="8006285">&amp;&amp;</span>&nbsp;<span class="op" id="8006288">!</span><span class="ident" id="8006289">supportsIPv6</span>&nbsp;<span class="op" id="8006302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006307">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006322">l1</span><span class="op" id="8006324">,</span>&nbsp;<span class="ident" id="8006326">port</span>&nbsp;<span class="op" id="8006331">:=</span>&nbsp;<span class="ident" id="8006334">usableListenPort</span><span class="op" id="8006350">(</span><span class="ident" id="8006351">t</span><span class="op" id="8006352">,</span>&nbsp;<span class="ident" id="8006354">tt</span><span class="op" id="8006356">.</span><span class="ident" id="8006357">net</span><span class="op" id="8006360">,</span>&nbsp;<span class="ident" id="8006362">tt</span><span class="op" id="8006364">.</span><span class="ident" id="8006365">laddr</span><span class="op" id="8006370">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006374">checkFirstListener</span><span class="op" id="8006392">(</span><span class="ident" id="8006393">t</span><span class="op" id="8006394">,</span>&nbsp;<span class="ident" id="8006396">tt</span><span class="op" id="8006398">.</span><span class="ident" id="8006399">net</span><span class="op" id="8006402">,</span>&nbsp;<span class="ident" id="8006404">tt</span><span class="op" id="8006406">.</span><span class="ident" id="8006407">laddr</span><span class="op" id="8006412">+</span><span class="string" id="8006413">&#34;:&#34;</span><span class="op" id="8006416">+</span><span class="ident" id="8006417">port</span><span class="op" id="8006421">,</span>&nbsp;<span class="ident" id="8006423">l1</span><span class="op" id="8006425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006429">l2</span><span class="op" id="8006431">,</span>&nbsp;<span class="ident" id="8006433">err</span>&nbsp;<span class="op" id="8006437">:=</span>&nbsp;<span class="ident" id="8006440">Listen</span><span class="op" id="8006446">(</span><span class="ident" id="8006447">tt</span><span class="op" id="8006449">.</span><span class="ident" id="8006450">net</span><span class="op" id="8006453">,</span>&nbsp;<span class="ident" id="8006455">tt</span><span class="op" id="8006457">.</span><span class="ident" id="8006458">laddr</span><span class="op" id="8006463">+</span><span class="string" id="8006464">&#34;:&#34;</span><span class="op" id="8006467">+</span><span class="ident" id="8006468">port</span><span class="op" id="8006472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006476">checkSecondListener</span><span class="op" id="8006495">(</span><span class="ident" id="8006496">t</span><span class="op" id="8006497">,</span>&nbsp;<span class="ident" id="8006499">tt</span><span class="op" id="8006501">.</span><span class="ident" id="8006502">net</span><span class="op" id="8006505">,</span>&nbsp;<span class="ident" id="8006507">tt</span><span class="op" id="8006509">.</span><span class="ident" id="8006510">laddr</span><span class="op" id="8006515">+</span><span class="string" id="8006516">&#34;:&#34;</span><span class="op" id="8006519">+</span><span class="ident" id="8006520">port</span><span class="op" id="8006524">,</span>&nbsp;<span class="ident" id="8006526">err</span><span class="op" id="8006529">,</span>&nbsp;<span class="ident" id="8006531">l2</span><span class="op" id="8006533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006537">l1</span><span class="op" id="8006539">.</span><span class="ident" id="8006540">Close</span><span class="op" id="8006545">(</span><span class="op" id="8006546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006549">}</span><br>
<span class="lineno">65</span><span class="op" id="8006551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8006554">//&nbsp;TestUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="8006619">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="8006684">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno">70</span><span class="keyword" id="8006698">func</span>&nbsp;<span class="ident" id="8006703">TestUDPListener</span><span class="op" id="8006718">(</span><span class="ident" id="8006719">t</span>&nbsp;<span class="op" id="8006721">*</span><span class="ident" id="8006722">testing</span><span class="op" id="8006729">.</span><span class="ident" id="8006730">T</span><span class="op" id="8006731">)</span>&nbsp;<span class="op" id="8006733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006736">switch</span>&nbsp;<span class="ident" id="8006743">runtime</span><span class="op" id="8006750">.</span><span class="ident" id="8006751">GOOS</span>&nbsp;<span class="op" id="8006756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006759">case</span>&nbsp;<span class="string" id="8006764">&#34;plan9&#34;</span><span class="op" id="8006771">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006775">t</span><span class="op" id="8006776">.</span><span class="ident" id="8006777">Skipf</span><span class="op" id="8006782">(</span><span class="string" id="8006783">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8006804">,</span>&nbsp;<span class="ident" id="8006806">runtime</span><span class="op" id="8006813">.</span><span class="ident" id="8006814">GOOS</span><span class="op" id="8006818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006821">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006825">toudpnet</span>&nbsp;<span class="op" id="8006834">:=</span>&nbsp;<span class="keyword" id="8006837">func</span><span class="op" id="8006841">(</span><span class="ident" id="8006842">net</span>&nbsp;<span class="builtintype" id="8006846">string</span><span class="op" id="8006852">)</span>&nbsp;<span class="builtintype" id="8006854">string</span>&nbsp;<span class="op" id="8006861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006865">switch</span>&nbsp;<span class="ident" id="8006872">net</span>&nbsp;<span class="op" id="8006876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006880">case</span>&nbsp;<span class="string" id="8006885">&#34;tcp&#34;</span><span class="op" id="8006890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006895">return</span>&nbsp;<span class="string" id="8006902">&#34;udp&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006910">case</span>&nbsp;<span class="string" id="8006915">&#34;tcp4&#34;</span><span class="op" id="8006921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006926">return</span>&nbsp;<span class="string" id="8006933">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006942">case</span>&nbsp;<span class="string" id="8006947">&#34;tcp6&#34;</span><span class="op" id="8006953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006958">return</span>&nbsp;<span class="string" id="8006965">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006974">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006978">return</span>&nbsp;<span class="string" id="8006985">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006998">for</span>&nbsp;<span class="ident" id="8007002">_</span><span class="op" id="8007003">,</span>&nbsp;<span class="ident" id="8007005">tt</span>&nbsp;<span class="op" id="8007008">:=</span>&nbsp;<span class="keyword" id="8007011">range</span>&nbsp;<span class="ident" id="8007017">listenerTests</span>&nbsp;<span class="op" id="8007031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007035">if</span>&nbsp;<span class="ident" id="8007038">tt</span><span class="op" id="8007040">.</span><span class="ident" id="8007041">wildcard</span>&nbsp;<span class="op" id="8007050">&amp;&amp;</span>&nbsp;<span class="op" id="8007053">(</span><span class="ident" id="8007054">testing</span><span class="op" id="8007061">.</span><span class="ident" id="8007062">Short</span><span class="op" id="8007067">(</span><span class="op" id="8007068">)</span>&nbsp;<span class="op" id="8007070">||</span>&nbsp;<span class="op" id="8007073">!</span><span class="op" id="8007074">*</span><span class="ident" id="8007075">testExternal</span><span class="op" id="8007087">)</span>&nbsp;<span class="op" id="8007089">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007094">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007109">if</span>&nbsp;<span class="ident" id="8007112">tt</span><span class="op" id="8007114">.</span><span class="ident" id="8007115">ipv6</span>&nbsp;<span class="op" id="8007120">&amp;&amp;</span>&nbsp;<span class="op" id="8007123">!</span><span class="ident" id="8007124">supportsIPv6</span>&nbsp;<span class="op" id="8007137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007142">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007153">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007157">tt</span><span class="op" id="8007159">.</span><span class="ident" id="8007160">net</span>&nbsp;<span class="op" id="8007164">=</span>&nbsp;<span class="ident" id="8007166">toudpnet</span><span class="op" id="8007174">(</span><span class="ident" id="8007175">tt</span><span class="op" id="8007177">.</span><span class="ident" id="8007178">net</span><span class="op" id="8007181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007185">l1</span><span class="op" id="8007187">,</span>&nbsp;<span class="ident" id="8007189">port</span>&nbsp;<span class="op" id="8007194">:=</span>&nbsp;<span class="ident" id="8007197">usableListenPacketPort</span><span class="op" id="8007219">(</span><span class="ident" id="8007220">t</span><span class="op" id="8007221">,</span>&nbsp;<span class="ident" id="8007223">tt</span><span class="op" id="8007225">.</span><span class="ident" id="8007226">net</span><span class="op" id="8007229">,</span>&nbsp;<span class="ident" id="8007231">tt</span><span class="op" id="8007233">.</span><span class="ident" id="8007234">laddr</span><span class="op" id="8007239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007243">checkFirstListener</span><span class="op" id="8007261">(</span><span class="ident" id="8007262">t</span><span class="op" id="8007263">,</span>&nbsp;<span class="ident" id="8007265">tt</span><span class="op" id="8007267">.</span><span class="ident" id="8007268">net</span><span class="op" id="8007271">,</span>&nbsp;<span class="ident" id="8007273">tt</span><span class="op" id="8007275">.</span><span class="ident" id="8007276">laddr</span><span class="op" id="8007281">+</span><span class="string" id="8007282">&#34;:&#34;</span><span class="op" id="8007285">+</span><span class="ident" id="8007286">port</span><span class="op" id="8007290">,</span>&nbsp;<span class="ident" id="8007292">l1</span><span class="op" id="8007294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007298">l2</span><span class="op" id="8007300">,</span>&nbsp;<span class="ident" id="8007302">err</span>&nbsp;<span class="op" id="8007306">:=</span>&nbsp;<span class="ident" id="8007309">ListenPacket</span><span class="op" id="8007321">(</span><span class="ident" id="8007322">tt</span><span class="op" id="8007324">.</span><span class="ident" id="8007325">net</span><span class="op" id="8007328">,</span>&nbsp;<span class="ident" id="8007330">tt</span><span class="op" id="8007332">.</span><span class="ident" id="8007333">laddr</span><span class="op" id="8007338">+</span><span class="string" id="8007339">&#34;:&#34;</span><span class="op" id="8007342">+</span><span class="ident" id="8007343">port</span><span class="op" id="8007347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007351">checkSecondListener</span><span class="op" id="8007370">(</span><span class="ident" id="8007371">t</span><span class="op" id="8007372">,</span>&nbsp;<span class="ident" id="8007374">tt</span><span class="op" id="8007376">.</span><span class="ident" id="8007377">net</span><span class="op" id="8007380">,</span>&nbsp;<span class="ident" id="8007382">tt</span><span class="op" id="8007384">.</span><span class="ident" id="8007385">laddr</span><span class="op" id="8007390">+</span><span class="string" id="8007391">&#34;:&#34;</span><span class="op" id="8007394">+</span><span class="ident" id="8007395">port</span><span class="op" id="8007399">,</span>&nbsp;<span class="ident" id="8007401">err</span><span class="op" id="8007404">,</span>&nbsp;<span class="ident" id="8007406">l2</span><span class="op" id="8007408">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007412">l1</span><span class="op" id="8007414">.</span><span class="ident" id="8007415">Close</span><span class="op" id="8007420">(</span><span class="op" id="8007421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007424">}</span><br>
<span class="lineno"></span><span class="op" id="8007426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8007429">var</span>&nbsp;<span class="ident" id="8007433">dualStackListenerTests</span>&nbsp;<span class="op" id="8007456">=</span>&nbsp;<span class="op" id="8007458">[</span><span class="op" id="8007459">]</span><span class="keyword" id="8007460">struct</span>&nbsp;<span class="op" id="8007467">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007470">net1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8007479">string</span>&nbsp;<span class="comment" id="8007486">//&nbsp;first&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007505">laddr1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8007514">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007522">net2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8007531">string</span>&nbsp;<span class="comment" id="8007538">//&nbsp;second&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007558">laddr2</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8007567">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007575">wildcard</span>&nbsp;<span class="builtintype" id="8007584">bool</span>&nbsp;&nbsp;<span class="comment" id="8007590">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007621">xerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8007630">error</span>&nbsp;<span class="comment" id="8007636">//&nbsp;expected&nbsp;error&nbsp;value,&nbsp;nil&nbsp;or&nbsp;other</span><br>
<span class="lineno"></span><span class="op" id="8007674">}</span><span class="op" id="8007675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8007678">//&nbsp;Test&nbsp;cases&nbsp;and&nbsp;expected&nbsp;results&nbsp;for&nbsp;the&nbsp;attemping&nbsp;2nd&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8007760">//&nbsp;1st&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2nd&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;darwin&nbsp;&nbsp;freebsd&nbsp;&nbsp;linux&nbsp;&nbsp;openbsd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8007849">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8007938">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008024">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008110">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008196">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008285">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008372">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008459">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008546">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008633">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008720">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008807">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008896">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008983">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009070">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009157">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009244">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009333">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009420">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009507">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009594">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009681">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009685">//&nbsp;Platform&nbsp;default&nbsp;configurations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009722">//&nbsp;darwin,&nbsp;kernel&nbsp;version&nbsp;11.3.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009756">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009829">//&nbsp;freebsd,&nbsp;kernel&nbsp;version&nbsp;8.2</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009861">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009934">//&nbsp;linux,&nbsp;kernel&nbsp;version&nbsp;3.0.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009966">//&nbsp;&nbsp;&nbsp;&nbspnet.ipv6.bindv6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8010038">//&nbsp;openbsd,&nbsp;kernel&nbsp;version&nbsp;5.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8010070">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overriding&nbsp;is&nbsp;prohibited)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010125">{</span><span class="ident" id="8010126">net1</span><span class="op" id="8010130">:</span>&nbsp;<span class="string" id="8010132">&#34;tcp&#34;</span><span class="op" id="8010137">,</span>&nbsp;<span class="ident" id="8010139">laddr1</span><span class="op" id="8010145">:</span>&nbsp;<span class="string" id="8010147">&#34;&#34;</span><span class="op" id="8010149">,</span>&nbsp;<span class="ident" id="8010151">net2</span><span class="op" id="8010155">:</span>&nbsp;<span class="string" id="8010157">&#34;tcp&#34;</span><span class="op" id="8010162">,</span>&nbsp;<span class="ident" id="8010164">laddr2</span><span class="op" id="8010170">:</span>&nbsp;<span class="string" id="8010172">&#34;&#34;</span><span class="op" id="8010174">,</span>&nbsp;<span class="ident" id="8010176">wildcard</span><span class="op" id="8010184">:</span>&nbsp;<span class="builtintype" id="8010186">true</span><span class="op" id="8010190">,</span>&nbsp;<span class="ident" id="8010192">xerr</span><span class="op" id="8010196">:</span>&nbsp;<span class="ident" id="8010198">syscall</span><span class="op" id="8010205">.</span><span class="ident" id="8010206">EADDRINUSE</span><span class="op" id="8010216">}</span><span class="op" id="8010217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010220">{</span><span class="ident" id="8010221">net1</span><span class="op" id="8010225">:</span>&nbsp;<span class="string" id="8010227">&#34;tcp&#34;</span><span class="op" id="8010232">,</span>&nbsp;<span class="ident" id="8010234">laddr1</span><span class="op" id="8010240">:</span>&nbsp;<span class="string" id="8010242">&#34;&#34;</span><span class="op" id="8010244">,</span>&nbsp;<span class="ident" id="8010246">net2</span><span class="op" id="8010250">:</span>&nbsp;<span class="string" id="8010252">&#34;tcp&#34;</span><span class="op" id="8010257">,</span>&nbsp;<span class="ident" id="8010259">laddr2</span><span class="op" id="8010265">:</span>&nbsp;<span class="string" id="8010267">&#34;0.0.0.0&#34;</span><span class="op" id="8010276">,</span>&nbsp;<span class="ident" id="8010278">wildcard</span><span class="op" id="8010286">:</span>&nbsp;<span class="builtintype" id="8010288">true</span><span class="op" id="8010292">,</span>&nbsp;<span class="ident" id="8010294">xerr</span><span class="op" id="8010298">:</span>&nbsp;<span class="ident" id="8010300">syscall</span><span class="op" id="8010307">.</span><span class="ident" id="8010308">EADDRINUSE</span><span class="op" id="8010318">}</span><span class="op" id="8010319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010322">{</span><span class="ident" id="8010323">net1</span><span class="op" id="8010327">:</span>&nbsp;<span class="string" id="8010329">&#34;tcp&#34;</span><span class="op" id="8010334">,</span>&nbsp;<span class="ident" id="8010336">laddr1</span><span class="op" id="8010342">:</span>&nbsp;<span class="string" id="8010344">&#34;0.0.0.0&#34;</span><span class="op" id="8010353">,</span>&nbsp;<span class="ident" id="8010355">net2</span><span class="op" id="8010359">:</span>&nbsp;<span class="string" id="8010361">&#34;tcp&#34;</span><span class="op" id="8010366">,</span>&nbsp;<span class="ident" id="8010368">laddr2</span><span class="op" id="8010374">:</span>&nbsp;<span class="string" id="8010376">&#34;&#34;</span><span class="op" id="8010378">,</span>&nbsp;<span class="ident" id="8010380">wildcard</span><span class="op" id="8010388">:</span>&nbsp;<span class="builtintype" id="8010390">true</span><span class="op" id="8010394">,</span>&nbsp;<span class="ident" id="8010396">xerr</span><span class="op" id="8010400">:</span>&nbsp;<span class="ident" id="8010402">syscall</span><span class="op" id="8010409">.</span><span class="ident" id="8010410">EADDRINUSE</span><span class="op" id="8010420">}</span><span class="op" id="8010421">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010425">{</span><span class="ident" id="8010426">net1</span><span class="op" id="8010430">:</span>&nbsp;<span class="string" id="8010432">&#34;tcp&#34;</span><span class="op" id="8010437">,</span>&nbsp;<span class="ident" id="8010439">laddr1</span><span class="op" id="8010445">:</span>&nbsp;<span class="string" id="8010447">&#34;&#34;</span><span class="op" id="8010449">,</span>&nbsp;<span class="ident" id="8010451">net2</span><span class="op" id="8010455">:</span>&nbsp;<span class="string" id="8010457">&#34;tcp&#34;</span><span class="op" id="8010462">,</span>&nbsp;<span class="ident" id="8010464">laddr2</span><span class="op" id="8010470">:</span>&nbsp;<span class="string" id="8010472">&#34;[::]&#34;</span><span class="op" id="8010478">,</span>&nbsp;<span class="ident" id="8010480">wildcard</span><span class="op" id="8010488">:</span>&nbsp;<span class="builtintype" id="8010490">true</span><span class="op" id="8010494">,</span>&nbsp;<span class="ident" id="8010496">xerr</span><span class="op" id="8010500">:</span>&nbsp;<span class="ident" id="8010502">syscall</span><span class="op" id="8010509">.</span><span class="ident" id="8010510">EADDRINUSE</span><span class="op" id="8010520">}</span><span class="op" id="8010521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010524">{</span><span class="ident" id="8010525">net1</span><span class="op" id="8010529">:</span>&nbsp;<span class="string" id="8010531">&#34;tcp&#34;</span><span class="op" id="8010536">,</span>&nbsp;<span class="ident" id="8010538">laddr1</span><span class="op" id="8010544">:</span>&nbsp;<span class="string" id="8010546">&#34;[::]&#34;</span><span class="op" id="8010552">,</span>&nbsp;<span class="ident" id="8010554">net2</span><span class="op" id="8010558">:</span>&nbsp;<span class="string" id="8010560">&#34;tcp&#34;</span><span class="op" id="8010565">,</span>&nbsp;<span class="ident" id="8010567">laddr2</span><span class="op" id="8010573">:</span>&nbsp;<span class="string" id="8010575">&#34;&#34;</span><span class="op" id="8010577">,</span>&nbsp;<span class="ident" id="8010579">wildcard</span><span class="op" id="8010587">:</span>&nbsp;<span class="builtintype" id="8010589">true</span><span class="op" id="8010593">,</span>&nbsp;<span class="ident" id="8010595">xerr</span><span class="op" id="8010599">:</span>&nbsp;<span class="ident" id="8010601">syscall</span><span class="op" id="8010608">.</span><span class="ident" id="8010609">EADDRINUSE</span><span class="op" id="8010619">}</span><span class="op" id="8010620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010623">{</span><span class="ident" id="8010624">net1</span><span class="op" id="8010628">:</span>&nbsp;<span class="string" id="8010630">&#34;tcp&#34;</span><span class="op" id="8010635">,</span>&nbsp;<span class="ident" id="8010637">laddr1</span><span class="op" id="8010643">:</span>&nbsp;<span class="string" id="8010645">&#34;0.0.0.0&#34;</span><span class="op" id="8010654">,</span>&nbsp;<span class="ident" id="8010656">net2</span><span class="op" id="8010660">:</span>&nbsp;<span class="string" id="8010662">&#34;tcp&#34;</span><span class="op" id="8010667">,</span>&nbsp;<span class="ident" id="8010669">laddr2</span><span class="op" id="8010675">:</span>&nbsp;<span class="string" id="8010677">&#34;[::]&#34;</span><span class="op" id="8010683">,</span>&nbsp;<span class="ident" id="8010685">wildcard</span><span class="op" id="8010693">:</span>&nbsp;<span class="builtintype" id="8010695">true</span><span class="op" id="8010699">,</span>&nbsp;<span class="ident" id="8010701">xerr</span><span class="op" id="8010705">:</span>&nbsp;<span class="ident" id="8010707">syscall</span><span class="op" id="8010714">.</span><span class="ident" id="8010715">EADDRINUSE</span><span class="op" id="8010725">}</span><span class="op" id="8010726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010729">{</span><span class="ident" id="8010730">net1</span><span class="op" id="8010734">:</span>&nbsp;<span class="string" id="8010736">&#34;tcp&#34;</span><span class="op" id="8010741">,</span>&nbsp;<span class="ident" id="8010743">laddr1</span><span class="op" id="8010749">:</span>&nbsp;<span class="string" id="8010751">&#34;[::]&#34;</span><span class="op" id="8010757">,</span>&nbsp;<span class="ident" id="8010759">net2</span><span class="op" id="8010763">:</span>&nbsp;<span class="string" id="8010765">&#34;tcp&#34;</span><span class="op" id="8010770">,</span>&nbsp;<span class="ident" id="8010772">laddr2</span><span class="op" id="8010778">:</span>&nbsp;<span class="string" id="8010780">&#34;0.0.0.0&#34;</span><span class="op" id="8010789">,</span>&nbsp;<span class="ident" id="8010791">wildcard</span><span class="op" id="8010799">:</span>&nbsp;<span class="builtintype" id="8010801">true</span><span class="op" id="8010805">,</span>&nbsp;<span class="ident" id="8010807">xerr</span><span class="op" id="8010811">:</span>&nbsp;<span class="ident" id="8010813">syscall</span><span class="op" id="8010820">.</span><span class="ident" id="8010821">EADDRINUSE</span><span class="op" id="8010831">}</span><span class="op" id="8010832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010835">{</span><span class="ident" id="8010836">net1</span><span class="op" id="8010840">:</span>&nbsp;<span class="string" id="8010842">&#34;tcp&#34;</span><span class="op" id="8010847">,</span>&nbsp;<span class="ident" id="8010849">laddr1</span><span class="op" id="8010855">:</span>&nbsp;<span class="string" id="8010857">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8010875">,</span>&nbsp;<span class="ident" id="8010877">net2</span><span class="op" id="8010881">:</span>&nbsp;<span class="string" id="8010883">&#34;tcp&#34;</span><span class="op" id="8010888">,</span>&nbsp;<span class="ident" id="8010890">laddr2</span><span class="op" id="8010896">:</span>&nbsp;<span class="string" id="8010898">&#34;[::]&#34;</span><span class="op" id="8010904">,</span>&nbsp;<span class="ident" id="8010906">wildcard</span><span class="op" id="8010914">:</span>&nbsp;<span class="builtintype" id="8010916">true</span><span class="op" id="8010920">,</span>&nbsp;<span class="ident" id="8010922">xerr</span><span class="op" id="8010926">:</span>&nbsp;<span class="ident" id="8010928">syscall</span><span class="op" id="8010935">.</span><span class="ident" id="8010936">EADDRINUSE</span><span class="op" id="8010946">}</span><span class="op" id="8010947">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010950">{</span><span class="ident" id="8010951">net1</span><span class="op" id="8010955">:</span>&nbsp;<span class="string" id="8010957">&#34;tcp&#34;</span><span class="op" id="8010962">,</span>&nbsp;<span class="ident" id="8010964">laddr1</span><span class="op" id="8010970">:</span>&nbsp;<span class="string" id="8010972">&#34;[::]&#34;</span><span class="op" id="8010978">,</span>&nbsp;<span class="ident" id="8010980">net2</span><span class="op" id="8010984">:</span>&nbsp;<span class="string" id="8010986">&#34;tcp&#34;</span><span class="op" id="8010991">,</span>&nbsp;<span class="ident" id="8010993">laddr2</span><span class="op" id="8010999">:</span>&nbsp;<span class="string" id="8011001">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8011019">,</span>&nbsp;<span class="ident" id="8011021">wildcard</span><span class="op" id="8011029">:</span>&nbsp;<span class="builtintype" id="8011031">true</span><span class="op" id="8011035">,</span>&nbsp;<span class="ident" id="8011037">xerr</span><span class="op" id="8011041">:</span>&nbsp;<span class="ident" id="8011043">syscall</span><span class="op" id="8011050">.</span><span class="ident" id="8011051">EADDRINUSE</span><span class="op" id="8011061">}</span><span class="op" id="8011062">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011066">{</span><span class="ident" id="8011067">net1</span><span class="op" id="8011071">:</span>&nbsp;<span class="string" id="8011073">&#34;tcp4&#34;</span><span class="op" id="8011079">,</span>&nbsp;<span class="ident" id="8011081">laddr1</span><span class="op" id="8011087">:</span>&nbsp;<span class="string" id="8011089">&#34;&#34;</span><span class="op" id="8011091">,</span>&nbsp;<span class="ident" id="8011093">net2</span><span class="op" id="8011097">:</span>&nbsp;<span class="string" id="8011099">&#34;tcp6&#34;</span><span class="op" id="8011105">,</span>&nbsp;<span class="ident" id="8011107">laddr2</span><span class="op" id="8011113">:</span>&nbsp;<span class="string" id="8011115">&#34;&#34;</span><span class="op" id="8011117">,</span>&nbsp;<span class="ident" id="8011119">wildcard</span><span class="op" id="8011127">:</span>&nbsp;<span class="builtintype" id="8011129">true</span><span class="op" id="8011133">}</span><span class="op" id="8011134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011137">{</span><span class="ident" id="8011138">net1</span><span class="op" id="8011142">:</span>&nbsp;<span class="string" id="8011144">&#34;tcp6&#34;</span><span class="op" id="8011150">,</span>&nbsp;<span class="ident" id="8011152">laddr1</span><span class="op" id="8011158">:</span>&nbsp;<span class="string" id="8011160">&#34;&#34;</span><span class="op" id="8011162">,</span>&nbsp;<span class="ident" id="8011164">net2</span><span class="op" id="8011168">:</span>&nbsp;<span class="string" id="8011170">&#34;tcp4&#34;</span><span class="op" id="8011176">,</span>&nbsp;<span class="ident" id="8011178">laddr2</span><span class="op" id="8011184">:</span>&nbsp;<span class="string" id="8011186">&#34;&#34;</span><span class="op" id="8011188">,</span>&nbsp;<span class="ident" id="8011190">wildcard</span><span class="op" id="8011198">:</span>&nbsp;<span class="builtintype" id="8011200">true</span><span class="op" id="8011204">}</span><span class="op" id="8011205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011208">{</span><span class="ident" id="8011209">net1</span><span class="op" id="8011213">:</span>&nbsp;<span class="string" id="8011215">&#34;tcp4&#34;</span><span class="op" id="8011221">,</span>&nbsp;<span class="ident" id="8011223">laddr1</span><span class="op" id="8011229">:</span>&nbsp;<span class="string" id="8011231">&#34;0.0.0.0&#34;</span><span class="op" id="8011240">,</span>&nbsp;<span class="ident" id="8011242">net2</span><span class="op" id="8011246">:</span>&nbsp;<span class="string" id="8011248">&#34;tcp6&#34;</span><span class="op" id="8011254">,</span>&nbsp;<span class="ident" id="8011256">laddr2</span><span class="op" id="8011262">:</span>&nbsp;<span class="string" id="8011264">&#34;[::]&#34;</span><span class="op" id="8011270">,</span>&nbsp;<span class="ident" id="8011272">wildcard</span><span class="op" id="8011280">:</span>&nbsp;<span class="builtintype" id="8011282">true</span><span class="op" id="8011286">}</span><span class="op" id="8011287">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011290">{</span><span class="ident" id="8011291">net1</span><span class="op" id="8011295">:</span>&nbsp;<span class="string" id="8011297">&#34;tcp6&#34;</span><span class="op" id="8011303">,</span>&nbsp;<span class="ident" id="8011305">laddr1</span><span class="op" id="8011311">:</span>&nbsp;<span class="string" id="8011313">&#34;[::]&#34;</span><span class="op" id="8011319">,</span>&nbsp;<span class="ident" id="8011321">net2</span><span class="op" id="8011325">:</span>&nbsp;<span class="string" id="8011327">&#34;tcp4&#34;</span><span class="op" id="8011333">,</span>&nbsp;<span class="ident" id="8011335">laddr2</span><span class="op" id="8011341">:</span>&nbsp;<span class="string" id="8011343">&#34;0.0.0.0&#34;</span><span class="op" id="8011352">,</span>&nbsp;<span class="ident" id="8011354">wildcard</span><span class="op" id="8011362">:</span>&nbsp;<span class="builtintype" id="8011364">true</span><span class="op" id="8011368">}</span><span class="op" id="8011369">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011373">{</span><span class="ident" id="8011374">net1</span><span class="op" id="8011378">:</span>&nbsp;<span class="string" id="8011380">&#34;tcp&#34;</span><span class="op" id="8011385">,</span>&nbsp;<span class="ident" id="8011387">laddr1</span><span class="op" id="8011393">:</span>&nbsp;<span class="string" id="8011395">&#34;127.0.0.1&#34;</span><span class="op" id="8011406">,</span>&nbsp;<span class="ident" id="8011408">net2</span><span class="op" id="8011412">:</span>&nbsp;<span class="string" id="8011414">&#34;tcp&#34;</span><span class="op" id="8011419">,</span>&nbsp;<span class="ident" id="8011421">laddr2</span><span class="op" id="8011427">:</span>&nbsp;<span class="string" id="8011429">&#34;[::1]&#34;</span><span class="op" id="8011436">}</span><span class="op" id="8011437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011440">{</span><span class="ident" id="8011441">net1</span><span class="op" id="8011445">:</span>&nbsp;<span class="string" id="8011447">&#34;tcp&#34;</span><span class="op" id="8011452">,</span>&nbsp;<span class="ident" id="8011454">laddr1</span><span class="op" id="8011460">:</span>&nbsp;<span class="string" id="8011462">&#34;[::1]&#34;</span><span class="op" id="8011469">,</span>&nbsp;<span class="ident" id="8011471">net2</span><span class="op" id="8011475">:</span>&nbsp;<span class="string" id="8011477">&#34;tcp&#34;</span><span class="op" id="8011482">,</span>&nbsp;<span class="ident" id="8011484">laddr2</span><span class="op" id="8011490">:</span>&nbsp;<span class="string" id="8011492">&#34;127.0.0.1&#34;</span><span class="op" id="8011503">}</span><span class="op" id="8011504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011507">{</span><span class="ident" id="8011508">net1</span><span class="op" id="8011512">:</span>&nbsp;<span class="string" id="8011514">&#34;tcp4&#34;</span><span class="op" id="8011520">,</span>&nbsp;<span class="ident" id="8011522">laddr1</span><span class="op" id="8011528">:</span>&nbsp;<span class="string" id="8011530">&#34;127.0.0.1&#34;</span><span class="op" id="8011541">,</span>&nbsp;<span class="ident" id="8011543">net2</span><span class="op" id="8011547">:</span>&nbsp;<span class="string" id="8011549">&#34;tcp6&#34;</span><span class="op" id="8011555">,</span>&nbsp;<span class="ident" id="8011557">laddr2</span><span class="op" id="8011563">:</span>&nbsp;<span class="string" id="8011565">&#34;[::1]&#34;</span><span class="op" id="8011572">}</span><span class="op" id="8011573">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011576">{</span><span class="ident" id="8011577">net1</span><span class="op" id="8011581">:</span>&nbsp;<span class="string" id="8011583">&#34;tcp6&#34;</span><span class="op" id="8011589">,</span>&nbsp;<span class="ident" id="8011591">laddr1</span><span class="op" id="8011597">:</span>&nbsp;<span class="string" id="8011599">&#34;[::1]&#34;</span><span class="op" id="8011606">,</span>&nbsp;<span class="ident" id="8011608">net2</span><span class="op" id="8011612">:</span>&nbsp;<span class="string" id="8011614">&#34;tcp4&#34;</span><span class="op" id="8011620">,</span>&nbsp;<span class="ident" id="8011622">laddr2</span><span class="op" id="8011628">:</span>&nbsp;<span class="string" id="8011630">&#34;127.0.0.1&#34;</span><span class="op" id="8011641">}</span><span class="op" id="8011642">,</span><br>
<span class="lineno"></span><span class="op" id="8011644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8011647">//&nbsp;TestDualStackTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="8011711">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;different</span><br>
<span class="lineno">170</span><span class="comment" id="8011774">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8011810">func</span>&nbsp;<span class="ident" id="8011815">TestDualStackTCPListener</span><span class="op" id="8011839">(</span><span class="ident" id="8011840">t</span>&nbsp;<span class="op" id="8011842">*</span><span class="ident" id="8011843">testing</span><span class="op" id="8011850">.</span><span class="ident" id="8011851">T</span><span class="op" id="8011852">)</span>&nbsp;<span class="op" id="8011854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8011857">if</span>&nbsp;<span class="ident" id="8011860">testing</span><span class="op" id="8011867">.</span><span class="ident" id="8011868">Short</span><span class="op" id="8011873">(</span><span class="op" id="8011874">)</span>&nbsp;<span class="op" id="8011876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011880">t</span><span class="op" id="8011881">.</span><span class="ident" id="8011882">Skip</span><span class="op" id="8011886">(</span><span class="string" id="8011887">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="8011928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011931">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8011934">switch</span>&nbsp;<span class="ident" id="8011941">runtime</span><span class="op" id="8011948">.</span><span class="ident" id="8011949">GOOS</span>&nbsp;<span class="op" id="8011954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8011957">case</span>&nbsp;<span class="string" id="8011962">&#34;plan9&#34;</span><span class="op" id="8011969">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011973">t</span><span class="op" id="8011974">.</span><span class="ident" id="8011975">Skipf</span><span class="op" id="8011980">(</span><span class="string" id="8011981">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8012002">,</span>&nbsp;<span class="ident" id="8012004">runtime</span><span class="op" id="8012011">.</span><span class="ident" id="8012012">GOOS</span><span class="op" id="8012016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012022">if</span>&nbsp;<span class="op" id="8012025">!</span><span class="ident" id="8012026">supportsIPv6</span>&nbsp;<span class="op" id="8012039">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012043">t</span><span class="op" id="8012044">.</span><span class="ident" id="8012045">Skip</span><span class="op" id="8012049">(</span><span class="string" id="8012050">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8012073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012080">for</span>&nbsp;<span class="ident" id="8012084">_</span><span class="op" id="8012085">,</span>&nbsp;<span class="ident" id="8012087">tt</span>&nbsp;<span class="op" id="8012090">:=</span>&nbsp;<span class="keyword" id="8012093">range</span>&nbsp;<span class="ident" id="8012099">dualStackListenerTests</span>&nbsp;<span class="op" id="8012122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012126">if</span>&nbsp;<span class="ident" id="8012129">tt</span><span class="op" id="8012131">.</span><span class="ident" id="8012132">wildcard</span>&nbsp;<span class="op" id="8012141">&amp;&amp;</span>&nbsp;<span class="op" id="8012144">!</span><span class="op" id="8012145">*</span><span class="ident" id="8012146">testExternal</span>&nbsp;<span class="op" id="8012159">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012164">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012179">switch</span>&nbsp;<span class="ident" id="8012186">runtime</span><span class="op" id="8012193">.</span><span class="ident" id="8012194">GOOS</span>&nbsp;<span class="op" id="8012199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012203">case</span>&nbsp;<span class="string" id="8012208">&#34;openbsd&#34;</span><span class="op" id="8012217">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012222">if</span>&nbsp;<span class="ident" id="8012225">tt</span><span class="op" id="8012227">.</span><span class="ident" id="8012228">wildcard</span>&nbsp;<span class="op" id="8012237">&amp;&amp;</span>&nbsp;<span class="ident" id="8012240">differentWildcardAddr</span><span class="op" id="8012261">(</span><span class="ident" id="8012262">tt</span><span class="op" id="8012264">.</span><span class="ident" id="8012265">laddr1</span><span class="op" id="8012271">,</span>&nbsp;<span class="ident" id="8012273">tt</span><span class="op" id="8012275">.</span><span class="ident" id="8012276">laddr2</span><span class="op" id="8012282">)</span>&nbsp;<span class="op" id="8012284">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012290">tt</span><span class="op" id="8012292">.</span><span class="ident" id="8012293">xerr</span>&nbsp;<span class="op" id="8012298">=</span>&nbsp;<span class="ident" id="8012300">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012315">l1</span><span class="op" id="8012317">,</span>&nbsp;<span class="ident" id="8012319">port</span>&nbsp;<span class="op" id="8012324">:=</span>&nbsp;<span class="ident" id="8012327">usableListenPort</span><span class="op" id="8012343">(</span><span class="ident" id="8012344">t</span><span class="op" id="8012345">,</span>&nbsp;<span class="ident" id="8012347">tt</span><span class="op" id="8012349">.</span><span class="ident" id="8012350">net1</span><span class="op" id="8012354">,</span>&nbsp;<span class="ident" id="8012356">tt</span><span class="op" id="8012358">.</span><span class="ident" id="8012359">laddr1</span><span class="op" id="8012365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012369">laddr</span>&nbsp;<span class="op" id="8012375">:=</span>&nbsp;<span class="ident" id="8012378">tt</span><span class="op" id="8012380">.</span><span class="ident" id="8012381">laddr1</span>&nbsp;<span class="op" id="8012388">+</span>&nbsp;<span class="string" id="8012390">&#34;:&#34;</span>&nbsp;<span class="op" id="8012394">+</span>&nbsp;<span class="ident" id="8012396">port</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012403">checkFirstListener</span><span class="op" id="8012421">(</span><span class="ident" id="8012422">t</span><span class="op" id="8012423">,</span>&nbsp;<span class="ident" id="8012425">tt</span><span class="op" id="8012427">.</span><span class="ident" id="8012428">net1</span><span class="op" id="8012432">,</span>&nbsp;<span class="ident" id="8012434">laddr</span><span class="op" id="8012439">,</span>&nbsp;<span class="ident" id="8012441">l1</span><span class="op" id="8012443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012447">laddr</span>&nbsp;<span class="op" id="8012453">=</span>&nbsp;<span class="ident" id="8012455">tt</span><span class="op" id="8012457">.</span><span class="ident" id="8012458">laddr2</span>&nbsp;<span class="op" id="8012465">+</span>&nbsp;<span class="string" id="8012467">&#34;:&#34;</span>&nbsp;<span class="op" id="8012471">+</span>&nbsp;<span class="ident" id="8012473">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012480">l2</span><span class="op" id="8012482">,</span>&nbsp;<span class="ident" id="8012484">err</span>&nbsp;<span class="op" id="8012488">:=</span>&nbsp;<span class="ident" id="8012491">Listen</span><span class="op" id="8012497">(</span><span class="ident" id="8012498">tt</span><span class="op" id="8012500">.</span><span class="ident" id="8012501">net2</span><span class="op" id="8012505">,</span>&nbsp;<span class="ident" id="8012507">laddr</span><span class="op" id="8012512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012516">checkDualStackSecondListener</span><span class="op" id="8012544">(</span><span class="ident" id="8012545">t</span><span class="op" id="8012546">,</span>&nbsp;<span class="ident" id="8012548">tt</span><span class="op" id="8012550">.</span><span class="ident" id="8012551">net2</span><span class="op" id="8012555">,</span>&nbsp;<span class="ident" id="8012557">laddr</span><span class="op" id="8012562">,</span>&nbsp;<span class="ident" id="8012564">tt</span><span class="op" id="8012566">.</span><span class="ident" id="8012567">xerr</span><span class="op" id="8012571">,</span>&nbsp;<span class="ident" id="8012573">err</span><span class="op" id="8012576">,</span>&nbsp;<span class="ident" id="8012578">l2</span><span class="op" id="8012580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012584">l1</span><span class="op" id="8012586">.</span><span class="ident" id="8012587">Close</span><span class="op" id="8012592">(</span><span class="op" id="8012593">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012596">}</span><br>
<span class="lineno"></span><span class="op" id="8012598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8012601">//&nbsp;TestDualStackUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="8012665">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;differnet</span><br>
<span class="lineno">205</span><span class="comment" id="8012728">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8012764">func</span>&nbsp;<span class="ident" id="8012769">TestDualStackUDPListener</span><span class="op" id="8012793">(</span><span class="ident" id="8012794">t</span>&nbsp;<span class="op" id="8012796">*</span><span class="ident" id="8012797">testing</span><span class="op" id="8012804">.</span><span class="ident" id="8012805">T</span><span class="op" id="8012806">)</span>&nbsp;<span class="op" id="8012808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012811">if</span>&nbsp;<span class="ident" id="8012814">testing</span><span class="op" id="8012821">.</span><span class="ident" id="8012822">Short</span><span class="op" id="8012827">(</span><span class="op" id="8012828">)</span>&nbsp;<span class="op" id="8012830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012834">t</span><span class="op" id="8012835">.</span><span class="ident" id="8012836">Skip</span><span class="op" id="8012840">(</span><span class="string" id="8012841">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="8012882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012885">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012888">switch</span>&nbsp;<span class="ident" id="8012895">runtime</span><span class="op" id="8012902">.</span><span class="ident" id="8012903">GOOS</span>&nbsp;<span class="op" id="8012908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012911">case</span>&nbsp;<span class="string" id="8012916">&#34;plan9&#34;</span><span class="op" id="8012923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012927">t</span><span class="op" id="8012928">.</span><span class="ident" id="8012929">Skipf</span><span class="op" id="8012934">(</span><span class="string" id="8012935">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8012956">,</span>&nbsp;<span class="ident" id="8012958">runtime</span><span class="op" id="8012965">.</span><span class="ident" id="8012966">GOOS</span><span class="op" id="8012970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012976">if</span>&nbsp;<span class="op" id="8012979">!</span><span class="ident" id="8012980">supportsIPv6</span>&nbsp;<span class="op" id="8012993">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012997">t</span><span class="op" id="8012998">.</span><span class="ident" id="8012999">Skip</span><span class="op" id="8013003">(</span><span class="string" id="8013004">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8013027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013034">toudpnet</span>&nbsp;<span class="op" id="8013043">:=</span>&nbsp;<span class="keyword" id="8013046">func</span><span class="op" id="8013050">(</span><span class="ident" id="8013051">net</span>&nbsp;<span class="builtintype" id="8013055">string</span><span class="op" id="8013061">)</span>&nbsp;<span class="builtintype" id="8013063">string</span>&nbsp;<span class="op" id="8013070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013074">switch</span>&nbsp;<span class="ident" id="8013081">net</span>&nbsp;<span class="op" id="8013085">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013089">case</span>&nbsp;<span class="string" id="8013094">&#34;tcp&#34;</span><span class="op" id="8013099">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013104">return</span>&nbsp;<span class="string" id="8013111">&#34;udp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013119">case</span>&nbsp;<span class="string" id="8013124">&#34;tcp4&#34;</span><span class="op" id="8013130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013135">return</span>&nbsp;<span class="string" id="8013142">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013151">case</span>&nbsp;<span class="string" id="8013156">&#34;tcp6&#34;</span><span class="op" id="8013162">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013167">return</span>&nbsp;<span class="string" id="8013174">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013187">return</span>&nbsp;<span class="string" id="8013194">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013207">for</span>&nbsp;<span class="ident" id="8013211">_</span><span class="op" id="8013212">,</span>&nbsp;<span class="ident" id="8013214">tt</span>&nbsp;<span class="op" id="8013217">:=</span>&nbsp;<span class="keyword" id="8013220">range</span>&nbsp;<span class="ident" id="8013226">dualStackListenerTests</span>&nbsp;<span class="op" id="8013249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013253">if</span>&nbsp;<span class="ident" id="8013256">tt</span><span class="op" id="8013258">.</span><span class="ident" id="8013259">wildcard</span>&nbsp;<span class="op" id="8013268">&amp;&amp;</span>&nbsp;<span class="op" id="8013271">(</span><span class="ident" id="8013272">testing</span><span class="op" id="8013279">.</span><span class="ident" id="8013280">Short</span><span class="op" id="8013285">(</span><span class="op" id="8013286">)</span>&nbsp;<span class="op" id="8013288">||</span>&nbsp;<span class="op" id="8013291">!</span><span class="op" id="8013292">*</span><span class="ident" id="8013293">testExternal</span><span class="op" id="8013305">)</span>&nbsp;<span class="op" id="8013307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013312">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013327">tt</span><span class="op" id="8013329">.</span><span class="ident" id="8013330">net1</span>&nbsp;<span class="op" id="8013335">=</span>&nbsp;<span class="ident" id="8013337">toudpnet</span><span class="op" id="8013345">(</span><span class="ident" id="8013346">tt</span><span class="op" id="8013348">.</span><span class="ident" id="8013349">net1</span><span class="op" id="8013353">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013357">tt</span><span class="op" id="8013359">.</span><span class="ident" id="8013360">net2</span>&nbsp;<span class="op" id="8013365">=</span>&nbsp;<span class="ident" id="8013367">toudpnet</span><span class="op" id="8013375">(</span><span class="ident" id="8013376">tt</span><span class="op" id="8013378">.</span><span class="ident" id="8013379">net2</span><span class="op" id="8013383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013387">switch</span>&nbsp;<span class="ident" id="8013394">runtime</span><span class="op" id="8013401">.</span><span class="ident" id="8013402">GOOS</span>&nbsp;<span class="op" id="8013407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013411">case</span>&nbsp;<span class="string" id="8013416">&#34;openbsd&#34;</span><span class="op" id="8013425">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013430">if</span>&nbsp;<span class="ident" id="8013433">tt</span><span class="op" id="8013435">.</span><span class="ident" id="8013436">wildcard</span>&nbsp;<span class="op" id="8013445">&amp;&amp;</span>&nbsp;<span class="ident" id="8013448">differentWildcardAddr</span><span class="op" id="8013469">(</span><span class="ident" id="8013470">tt</span><span class="op" id="8013472">.</span><span class="ident" id="8013473">laddr1</span><span class="op" id="8013479">,</span>&nbsp;<span class="ident" id="8013481">tt</span><span class="op" id="8013483">.</span><span class="ident" id="8013484">laddr2</span><span class="op" id="8013490">)</span>&nbsp;<span class="op" id="8013492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013498">tt</span><span class="op" id="8013500">.</span><span class="ident" id="8013501">xerr</span>&nbsp;<span class="op" id="8013506">=</span>&nbsp;<span class="ident" id="8013508">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013523">l1</span><span class="op" id="8013525">,</span>&nbsp;<span class="ident" id="8013527">port</span>&nbsp;<span class="op" id="8013532">:=</span>&nbsp;<span class="ident" id="8013535">usableListenPacketPort</span><span class="op" id="8013557">(</span><span class="ident" id="8013558">t</span><span class="op" id="8013559">,</span>&nbsp;<span class="ident" id="8013561">tt</span><span class="op" id="8013563">.</span><span class="ident" id="8013564">net1</span><span class="op" id="8013568">,</span>&nbsp;<span class="ident" id="8013570">tt</span><span class="op" id="8013572">.</span><span class="ident" id="8013573">laddr1</span><span class="op" id="8013579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013583">laddr</span>&nbsp;<span class="op" id="8013589">:=</span>&nbsp;<span class="ident" id="8013592">tt</span><span class="op" id="8013594">.</span><span class="ident" id="8013595">laddr1</span>&nbsp;<span class="op" id="8013602">+</span>&nbsp;<span class="string" id="8013604">&#34;:&#34;</span>&nbsp;<span class="op" id="8013608">+</span>&nbsp;<span class="ident" id="8013610">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013617">checkFirstListener</span><span class="op" id="8013635">(</span><span class="ident" id="8013636">t</span><span class="op" id="8013637">,</span>&nbsp;<span class="ident" id="8013639">tt</span><span class="op" id="8013641">.</span><span class="ident" id="8013642">net1</span><span class="op" id="8013646">,</span>&nbsp;<span class="ident" id="8013648">laddr</span><span class="op" id="8013653">,</span>&nbsp;<span class="ident" id="8013655">l1</span><span class="op" id="8013657">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013661">laddr</span>&nbsp;<span class="op" id="8013667">=</span>&nbsp;<span class="ident" id="8013669">tt</span><span class="op" id="8013671">.</span><span class="ident" id="8013672">laddr2</span>&nbsp;<span class="op" id="8013679">+</span>&nbsp;<span class="string" id="8013681">&#34;:&#34;</span>&nbsp;<span class="op" id="8013685">+</span>&nbsp;<span class="ident" id="8013687">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013694">l2</span><span class="op" id="8013696">,</span>&nbsp;<span class="ident" id="8013698">err</span>&nbsp;<span class="op" id="8013702">:=</span>&nbsp;<span class="ident" id="8013705">ListenPacket</span><span class="op" id="8013717">(</span><span class="ident" id="8013718">tt</span><span class="op" id="8013720">.</span><span class="ident" id="8013721">net2</span><span class="op" id="8013725">,</span>&nbsp;<span class="ident" id="8013727">laddr</span><span class="op" id="8013732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013736">checkDualStackSecondListener</span><span class="op" id="8013764">(</span><span class="ident" id="8013765">t</span><span class="op" id="8013766">,</span>&nbsp;<span class="ident" id="8013768">tt</span><span class="op" id="8013770">.</span><span class="ident" id="8013771">net2</span><span class="op" id="8013775">,</span>&nbsp;<span class="ident" id="8013777">laddr</span><span class="op" id="8013782">,</span>&nbsp;<span class="ident" id="8013784">tt</span><span class="op" id="8013786">.</span><span class="ident" id="8013787">xerr</span><span class="op" id="8013791">,</span>&nbsp;<span class="ident" id="8013793">err</span><span class="op" id="8013796">,</span>&nbsp;<span class="ident" id="8013798">l2</span><span class="op" id="8013800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013804">l1</span><span class="op" id="8013806">.</span><span class="ident" id="8013807">Close</span><span class="op" id="8013812">(</span><span class="op" id="8013813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013816">}</span><br>
<span class="lineno">250</span><span class="op" id="8013818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8013821">func</span>&nbsp;<span class="ident" id="8013826">usableListenPort</span><span class="op" id="8013842">(</span><span class="ident" id="8013843">t</span>&nbsp;<span class="op" id="8013845">*</span><span class="ident" id="8013846">testing</span><span class="op" id="8013853">.</span><span class="ident" id="8013854">T</span><span class="op" id="8013855">,</span>&nbsp;<span class="ident" id="8013857">net</span><span class="op" id="8013860">,</span>&nbsp;<span class="ident" id="8013862">laddr</span>&nbsp;<span class="builtintype" id="8013868">string</span><span class="op" id="8013874">)</span>&nbsp;<span class="op" id="8013876">(</span><span class="ident" id="8013877">l</span>&nbsp;<span class="ident" id="8013879">Listener</span><span class="op" id="8013887">,</span>&nbsp;<span class="ident" id="8013889">port</span>&nbsp;<span class="builtintype" id="8013894">string</span><span class="op" id="8013900">)</span>&nbsp;<span class="op" id="8013902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013905">var</span>&nbsp;<span class="ident" id="8013909">nladdr</span>&nbsp;<span class="builtintype" id="8013916">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013924">var</span>&nbsp;<span class="ident" id="8013928">err</span>&nbsp;<span class="builtintype" id="8013932">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013939">switch</span>&nbsp;<span class="ident" id="8013946">net</span>&nbsp;<span class="op" id="8013950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013953">default</span><span class="op" id="8013960">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8013964">panic</span><span class="op" id="8013969">(</span><span class="string" id="8013970">&#34;usableListenPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="8013994">+</span>&nbsp;<span class="ident" id="8013996">net</span><span class="op" id="8013999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014002">case</span>&nbsp;<span class="string" id="8014007">&#34;tcp&#34;</span><span class="op" id="8014012">,</span>&nbsp;<span class="string" id="8014014">&#34;tcp4&#34;</span><span class="op" id="8014020">,</span>&nbsp;<span class="string" id="8014022">&#34;tcp6&#34;</span><span class="op" id="8014028">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014032">l</span><span class="op" id="8014033">,</span>&nbsp;<span class="ident" id="8014035">err</span>&nbsp;<span class="op" id="8014039">=</span>&nbsp;<span class="ident" id="8014041">Listen</span><span class="op" id="8014047">(</span><span class="ident" id="8014048">net</span><span class="op" id="8014051">,</span>&nbsp;<span class="ident" id="8014053">laddr</span><span class="op" id="8014058">+</span><span class="string" id="8014059">&#34;:0&#34;</span><span class="op" id="8014063">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014067">if</span>&nbsp;<span class="ident" id="8014070">err</span>&nbsp;<span class="op" id="8014074">!=</span>&nbsp;<span class="ident" id="8014077">nil</span>&nbsp;<span class="op" id="8014081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014086">t</span><span class="op" id="8014087">.</span><span class="ident" id="8014088">Fatalf</span><span class="op" id="8014094">(</span><span class="string" id="8014095">&#34;Probe&nbsp;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8014128">,</span>&nbsp;<span class="ident" id="8014130">net</span><span class="op" id="8014133">,</span>&nbsp;<span class="ident" id="8014135">laddr</span><span class="op" id="8014140">,</span>&nbsp;<span class="ident" id="8014142">err</span><span class="op" id="8014145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014153">nladdr</span>&nbsp;<span class="op" id="8014160">=</span>&nbsp;<span class="ident" id="8014162">l</span><span class="op" id="8014163">.</span><span class="op" id="8014164">(</span><span class="op" id="8014165">*</span><span class="ident" id="8014166">TCPListener</span><span class="op" id="8014177">)</span><span class="op" id="8014178">.</span><span class="ident" id="8014179">Addr</span><span class="op" id="8014183">(</span><span class="op" id="8014184">)</span><span class="op" id="8014185">.</span><span class="ident" id="8014186">String</span><span class="op" id="8014192">(</span><span class="op" id="8014193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014196">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014199">_</span><span class="op" id="8014200">,</span>&nbsp;<span class="ident" id="8014202">port</span><span class="op" id="8014206">,</span>&nbsp;<span class="ident" id="8014208">err</span>&nbsp;<span class="op" id="8014212">=</span>&nbsp;<span class="ident" id="8014214">SplitHostPort</span><span class="op" id="8014227">(</span><span class="ident" id="8014228">nladdr</span><span class="op" id="8014234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014237">if</span>&nbsp;<span class="ident" id="8014240">err</span>&nbsp;<span class="op" id="8014244">!=</span>&nbsp;<span class="ident" id="8014247">nil</span>&nbsp;<span class="op" id="8014251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014255">t</span><span class="op" id="8014256">.</span><span class="ident" id="8014257">Fatalf</span><span class="op" id="8014263">(</span><span class="string" id="8014264">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8014290">,</span>&nbsp;<span class="ident" id="8014292">err</span><span class="op" id="8014295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014301">return</span>&nbsp;<span class="ident" id="8014308">l</span><span class="op" id="8014309">,</span>&nbsp;<span class="ident" id="8014311">port</span><br>
<span class="lineno">270</span><span class="op" id="8014316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8014319">func</span>&nbsp;<span class="ident" id="8014324">usableListenPacketPort</span><span class="op" id="8014346">(</span><span class="ident" id="8014347">t</span>&nbsp;<span class="op" id="8014349">*</span><span class="ident" id="8014350">testing</span><span class="op" id="8014357">.</span><span class="ident" id="8014358">T</span><span class="op" id="8014359">,</span>&nbsp;<span class="ident" id="8014361">net</span><span class="op" id="8014364">,</span>&nbsp;<span class="ident" id="8014366">laddr</span>&nbsp;<span class="builtintype" id="8014372">string</span><span class="op" id="8014378">)</span>&nbsp;<span class="op" id="8014380">(</span><span class="ident" id="8014381">l</span>&nbsp;<span class="ident" id="8014383">PacketConn</span><span class="op" id="8014393">,</span>&nbsp;<span class="ident" id="8014395">port</span>&nbsp;<span class="builtintype" id="8014400">string</span><span class="op" id="8014406">)</span>&nbsp;<span class="op" id="8014408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014411">var</span>&nbsp;<span class="ident" id="8014415">nladdr</span>&nbsp;<span class="builtintype" id="8014422">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014430">var</span>&nbsp;<span class="ident" id="8014434">err</span>&nbsp;<span class="builtintype" id="8014438">error</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014445">switch</span>&nbsp;<span class="ident" id="8014452">net</span>&nbsp;<span class="op" id="8014456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014459">default</span><span class="op" id="8014466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8014470">panic</span><span class="op" id="8014475">(</span><span class="string" id="8014476">&#34;usableListenPacketPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="8014506">+</span>&nbsp;<span class="ident" id="8014508">net</span><span class="op" id="8014511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014514">case</span>&nbsp;<span class="string" id="8014519">&#34;udp&#34;</span><span class="op" id="8014524">,</span>&nbsp;<span class="string" id="8014526">&#34;udp4&#34;</span><span class="op" id="8014532">,</span>&nbsp;<span class="string" id="8014534">&#34;udp6&#34;</span><span class="op" id="8014540">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014544">l</span><span class="op" id="8014545">,</span>&nbsp;<span class="ident" id="8014547">err</span>&nbsp;<span class="op" id="8014551">=</span>&nbsp;<span class="ident" id="8014553">ListenPacket</span><span class="op" id="8014565">(</span><span class="ident" id="8014566">net</span><span class="op" id="8014569">,</span>&nbsp;<span class="ident" id="8014571">laddr</span><span class="op" id="8014576">+</span><span class="string" id="8014577">&#34;:0&#34;</span><span class="op" id="8014581">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014585">if</span>&nbsp;<span class="ident" id="8014588">err</span>&nbsp;<span class="op" id="8014592">!=</span>&nbsp;<span class="ident" id="8014595">nil</span>&nbsp;<span class="op" id="8014599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014604">t</span><span class="op" id="8014605">.</span><span class="ident" id="8014606">Fatalf</span><span class="op" id="8014612">(</span><span class="string" id="8014613">&#34;Probe&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8014652">,</span>&nbsp;<span class="ident" id="8014654">net</span><span class="op" id="8014657">,</span>&nbsp;<span class="ident" id="8014659">laddr</span><span class="op" id="8014664">,</span>&nbsp;<span class="ident" id="8014666">err</span><span class="op" id="8014669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014677">nladdr</span>&nbsp;<span class="op" id="8014684">=</span>&nbsp;<span class="ident" id="8014686">l</span><span class="op" id="8014687">.</span><span class="op" id="8014688">(</span><span class="op" id="8014689">*</span><span class="ident" id="8014690">UDPConn</span><span class="op" id="8014697">)</span><span class="op" id="8014698">.</span><span class="ident" id="8014699">LocalAddr</span><span class="op" id="8014708">(</span><span class="op" id="8014709">)</span><span class="op" id="8014710">.</span><span class="ident" id="8014711">String</span><span class="op" id="8014717">(</span><span class="op" id="8014718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014721">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014724">_</span><span class="op" id="8014725">,</span>&nbsp;<span class="ident" id="8014727">port</span><span class="op" id="8014731">,</span>&nbsp;<span class="ident" id="8014733">err</span>&nbsp;<span class="op" id="8014737">=</span>&nbsp;<span class="ident" id="8014739">SplitHostPort</span><span class="op" id="8014752">(</span><span class="ident" id="8014753">nladdr</span><span class="op" id="8014759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014762">if</span>&nbsp;<span class="ident" id="8014765">err</span>&nbsp;<span class="op" id="8014769">!=</span>&nbsp;<span class="ident" id="8014772">nil</span>&nbsp;<span class="op" id="8014776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014780">t</span><span class="op" id="8014781">.</span><span class="ident" id="8014782">Fatalf</span><span class="op" id="8014788">(</span><span class="string" id="8014789">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8014815">,</span>&nbsp;<span class="ident" id="8014817">err</span><span class="op" id="8014820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014826">return</span>&nbsp;<span class="ident" id="8014833">l</span><span class="op" id="8014834">,</span>&nbsp;<span class="ident" id="8014836">port</span><br>
<span class="lineno">290</span><span class="op" id="8014841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8014844">func</span>&nbsp;<span class="ident" id="8014849">differentWildcardAddr</span><span class="op" id="8014870">(</span><span class="ident" id="8014871">i</span><span class="op" id="8014872">,</span>&nbsp;<span class="ident" id="8014874">j</span>&nbsp;<span class="builtintype" id="8014876">string</span><span class="op" id="8014882">)</span>&nbsp;<span class="builtintype" id="8014884">bool</span>&nbsp;<span class="op" id="8014889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014892">if</span>&nbsp;<span class="op" id="8014895">(</span><span class="ident" id="8014896">i</span>&nbsp;<span class="op" id="8014898">==</span>&nbsp;<span class="string" id="8014901">&#34;&#34;</span>&nbsp;<span class="op" id="8014904">||</span>&nbsp;<span class="ident" id="8014907">i</span>&nbsp;<span class="op" id="8014909">==</span>&nbsp;<span class="string" id="8014912">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="8014922">||</span>&nbsp;<span class="ident" id="8014925">i</span>&nbsp;<span class="op" id="8014927">==</span>&nbsp;<span class="string" id="8014930">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="8014946">)</span>&nbsp;<span class="op" id="8014948">&amp;&amp;</span>&nbsp;<span class="op" id="8014951">(</span><span class="ident" id="8014952">j</span>&nbsp;<span class="op" id="8014954">==</span>&nbsp;<span class="string" id="8014957">&#34;&#34;</span>&nbsp;<span class="op" id="8014960">||</span>&nbsp;<span class="ident" id="8014963">j</span>&nbsp;<span class="op" id="8014965">==</span>&nbsp;<span class="string" id="8014968">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="8014978">||</span>&nbsp;<span class="ident" id="8014981">j</span>&nbsp;<span class="op" id="8014983">==</span>&nbsp;<span class="string" id="8014986">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="8015002">)</span>&nbsp;<span class="op" id="8015004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015008">return</span>&nbsp;<span class="builtintype" id="8015015">false</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015025">if</span>&nbsp;<span class="ident" id="8015028">i</span>&nbsp;<span class="op" id="8015030">==</span>&nbsp;<span class="string" id="8015033">&#34;[::]&#34;</span>&nbsp;<span class="op" id="8015040">&amp;&amp;</span>&nbsp;<span class="ident" id="8015043">j</span>&nbsp;<span class="op" id="8015045">==</span>&nbsp;<span class="string" id="8015048">&#34;[::]&#34;</span>&nbsp;<span class="op" id="8015055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015059">return</span>&nbsp;<span class="builtintype" id="8015066">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015076">return</span>&nbsp;<span class="builtintype" id="8015083">true</span><br>
<span class="lineno">300</span><span class="op" id="8015088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8015091">func</span>&nbsp;<span class="ident" id="8015096">checkFirstListener</span><span class="op" id="8015114">(</span><span class="ident" id="8015115">t</span>&nbsp;<span class="op" id="8015117">*</span><span class="ident" id="8015118">testing</span><span class="op" id="8015125">.</span><span class="ident" id="8015126">T</span><span class="op" id="8015127">,</span>&nbsp;<span class="ident" id="8015129">net</span><span class="op" id="8015132">,</span>&nbsp;<span class="ident" id="8015134">laddr</span>&nbsp;<span class="builtintype" id="8015140">string</span><span class="op" id="8015146">,</span>&nbsp;<span class="ident" id="8015148">l</span>&nbsp;<span class="keyword" id="8015150">interface</span><span class="op" id="8015159">{</span><span class="op" id="8015160">}</span><span class="op" id="8015161">)</span>&nbsp;<span class="op" id="8015163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015166">switch</span>&nbsp;<span class="ident" id="8015173">net</span>&nbsp;<span class="op" id="8015177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015180">case</span>&nbsp;<span class="string" id="8015185">&#34;tcp&#34;</span><span class="op" id="8015190">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015194">fd</span>&nbsp;<span class="op" id="8015197">:=</span>&nbsp;<span class="ident" id="8015200">l</span><span class="op" id="8015201">.</span><span class="op" id="8015202">(</span><span class="op" id="8015203">*</span><span class="ident" id="8015204">TCPListener</span><span class="op" id="8015215">)</span><span class="op" id="8015216">.</span><span class="ident" id="8015217">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015222">checkDualStackAddrFamily</span><span class="op" id="8015246">(</span><span class="ident" id="8015247">t</span><span class="op" id="8015248">,</span>&nbsp;<span class="ident" id="8015250">net</span><span class="op" id="8015253">,</span>&nbsp;<span class="ident" id="8015255">laddr</span><span class="op" id="8015260">,</span>&nbsp;<span class="ident" id="8015262">fd</span><span class="op" id="8015264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015267">case</span>&nbsp;<span class="string" id="8015272">&#34;tcp4&#34;</span><span class="op" id="8015278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015282">fd</span>&nbsp;<span class="op" id="8015285">:=</span>&nbsp;<span class="ident" id="8015288">l</span><span class="op" id="8015289">.</span><span class="op" id="8015290">(</span><span class="op" id="8015291">*</span><span class="ident" id="8015292">TCPListener</span><span class="op" id="8015303">)</span><span class="op" id="8015304">.</span><span class="ident" id="8015305">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015310">if</span>&nbsp;<span class="ident" id="8015313">fd</span><span class="op" id="8015315">.</span><span class="ident" id="8015316">family</span>&nbsp;<span class="op" id="8015323">!=</span>&nbsp;<span class="ident" id="8015326">syscall</span><span class="op" id="8015333">.</span><span class="ident" id="8015334">AF_INET</span>&nbsp;<span class="op" id="8015342">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015347">t</span><span class="op" id="8015348">.</span><span class="ident" id="8015349">Fatalf</span><span class="op" id="8015355">(</span><span class="string" id="8015356">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8015417">,</span>&nbsp;<span class="ident" id="8015419">net</span><span class="op" id="8015422">,</span>&nbsp;<span class="ident" id="8015424">laddr</span><span class="op" id="8015429">,</span>&nbsp;<span class="ident" id="8015431">fd</span><span class="op" id="8015433">.</span><span class="ident" id="8015434">family</span><span class="op" id="8015440">,</span>&nbsp;<span class="ident" id="8015442">syscall</span><span class="op" id="8015449">.</span><span class="ident" id="8015450">AF_INET</span><span class="op" id="8015457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015464">case</span>&nbsp;<span class="string" id="8015469">&#34;tcp6&#34;</span><span class="op" id="8015475">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015479">fd</span>&nbsp;<span class="op" id="8015482">:=</span>&nbsp;<span class="ident" id="8015485">l</span><span class="op" id="8015486">.</span><span class="op" id="8015487">(</span><span class="op" id="8015488">*</span><span class="ident" id="8015489">TCPListener</span><span class="op" id="8015500">)</span><span class="op" id="8015501">.</span><span class="ident" id="8015502">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015507">if</span>&nbsp;<span class="ident" id="8015510">fd</span><span class="op" id="8015512">.</span><span class="ident" id="8015513">family</span>&nbsp;<span class="op" id="8015520">!=</span>&nbsp;<span class="ident" id="8015523">syscall</span><span class="op" id="8015530">.</span><span class="ident" id="8015531">AF_INET6</span>&nbsp;<span class="op" id="8015540">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015545">t</span><span class="op" id="8015546">.</span><span class="ident" id="8015547">Fatalf</span><span class="op" id="8015553">(</span><span class="string" id="8015554">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8015615">,</span>&nbsp;<span class="ident" id="8015617">net</span><span class="op" id="8015620">,</span>&nbsp;<span class="ident" id="8015622">laddr</span><span class="op" id="8015627">,</span>&nbsp;<span class="ident" id="8015629">fd</span><span class="op" id="8015631">.</span><span class="ident" id="8015632">family</span><span class="op" id="8015638">,</span>&nbsp;<span class="ident" id="8015640">syscall</span><span class="op" id="8015647">.</span><span class="ident" id="8015648">AF_INET6</span><span class="op" id="8015656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015663">case</span>&nbsp;<span class="string" id="8015668">&#34;udp&#34;</span><span class="op" id="8015673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015677">fd</span>&nbsp;<span class="op" id="8015680">:=</span>&nbsp;<span class="ident" id="8015683">l</span><span class="op" id="8015684">.</span><span class="op" id="8015685">(</span><span class="op" id="8015686">*</span><span class="ident" id="8015687">UDPConn</span><span class="op" id="8015694">)</span><span class="op" id="8015695">.</span><span class="ident" id="8015696">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015701">checkDualStackAddrFamily</span><span class="op" id="8015725">(</span><span class="ident" id="8015726">t</span><span class="op" id="8015727">,</span>&nbsp;<span class="ident" id="8015729">net</span><span class="op" id="8015732">,</span>&nbsp;<span class="ident" id="8015734">laddr</span><span class="op" id="8015739">,</span>&nbsp;<span class="ident" id="8015741">fd</span><span class="op" id="8015743">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015746">case</span>&nbsp;<span class="string" id="8015751">&#34;udp4&#34;</span><span class="op" id="8015757">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015761">fd</span>&nbsp;<span class="op" id="8015764">:=</span>&nbsp;<span class="ident" id="8015767">l</span><span class="op" id="8015768">.</span><span class="op" id="8015769">(</span><span class="op" id="8015770">*</span><span class="ident" id="8015771">UDPConn</span><span class="op" id="8015778">)</span><span class="op" id="8015779">.</span><span class="ident" id="8015780">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015785">if</span>&nbsp;<span class="ident" id="8015788">fd</span><span class="op" id="8015790">.</span><span class="ident" id="8015791">family</span>&nbsp;<span class="op" id="8015798">!=</span>&nbsp;<span class="ident" id="8015801">syscall</span><span class="op" id="8015808">.</span><span class="ident" id="8015809">AF_INET</span>&nbsp;<span class="op" id="8015817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015822">t</span><span class="op" id="8015823">.</span><span class="ident" id="8015824">Fatalf</span><span class="op" id="8015830">(</span><span class="string" id="8015831">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8015898">,</span>&nbsp;<span class="ident" id="8015900">net</span><span class="op" id="8015903">,</span>&nbsp;<span class="ident" id="8015905">laddr</span><span class="op" id="8015910">,</span>&nbsp;<span class="ident" id="8015912">fd</span><span class="op" id="8015914">.</span><span class="ident" id="8015915">family</span><span class="op" id="8015921">,</span>&nbsp;<span class="ident" id="8015923">syscall</span><span class="op" id="8015930">.</span><span class="ident" id="8015931">AF_INET</span><span class="op" id="8015938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015942">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015945">case</span>&nbsp;<span class="string" id="8015950">&#34;udp6&#34;</span><span class="op" id="8015956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015960">fd</span>&nbsp;<span class="op" id="8015963">:=</span>&nbsp;<span class="ident" id="8015966">l</span><span class="op" id="8015967">.</span><span class="op" id="8015968">(</span><span class="op" id="8015969">*</span><span class="ident" id="8015970">UDPConn</span><span class="op" id="8015977">)</span><span class="op" id="8015978">.</span><span class="ident" id="8015979">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015984">if</span>&nbsp;<span class="ident" id="8015987">fd</span><span class="op" id="8015989">.</span><span class="ident" id="8015990">family</span>&nbsp;<span class="op" id="8015997">!=</span>&nbsp;<span class="ident" id="8016000">syscall</span><span class="op" id="8016007">.</span><span class="ident" id="8016008">AF_INET6</span>&nbsp;<span class="op" id="8016017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016022">t</span><span class="op" id="8016023">.</span><span class="ident" id="8016024">Fatalf</span><span class="op" id="8016030">(</span><span class="string" id="8016031">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8016098">,</span>&nbsp;<span class="ident" id="8016100">net</span><span class="op" id="8016103">,</span>&nbsp;<span class="ident" id="8016105">laddr</span><span class="op" id="8016110">,</span>&nbsp;<span class="ident" id="8016112">fd</span><span class="op" id="8016114">.</span><span class="ident" id="8016115">family</span><span class="op" id="8016121">,</span>&nbsp;<span class="ident" id="8016123">syscall</span><span class="op" id="8016130">.</span><span class="ident" id="8016131">AF_INET6</span><span class="op" id="8016139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016143">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016146">default</span><span class="op" id="8016153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016157">t</span><span class="op" id="8016158">.</span><span class="ident" id="8016159">Fatalf</span><span class="op" id="8016165">(</span><span class="string" id="8016166">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8016190">,</span>&nbsp;<span class="ident" id="8016192">net</span><span class="op" id="8016195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016198">}</span><br>
<span class="lineno"></span><span class="op" id="8016200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="8016203">func</span>&nbsp;<span class="ident" id="8016208">checkSecondListener</span><span class="op" id="8016227">(</span><span class="ident" id="8016228">t</span>&nbsp;<span class="op" id="8016230">*</span><span class="ident" id="8016231">testing</span><span class="op" id="8016238">.</span><span class="ident" id="8016239">T</span><span class="op" id="8016240">,</span>&nbsp;<span class="ident" id="8016242">net</span><span class="op" id="8016245">,</span>&nbsp;<span class="ident" id="8016247">laddr</span>&nbsp;<span class="builtintype" id="8016253">string</span><span class="op" id="8016259">,</span>&nbsp;<span class="ident" id="8016261">err</span>&nbsp;<span class="builtintype" id="8016265">error</span><span class="op" id="8016270">,</span>&nbsp;<span class="ident" id="8016272">l</span>&nbsp;<span class="keyword" id="8016274">interface</span><span class="op" id="8016283">{</span><span class="op" id="8016284">}</span><span class="op" id="8016285">)</span>&nbsp;<span class="op" id="8016287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016290">switch</span>&nbsp;<span class="ident" id="8016297">net</span>&nbsp;<span class="op" id="8016301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016304">case</span>&nbsp;<span class="string" id="8016309">&#34;tcp&#34;</span><span class="op" id="8016314">,</span>&nbsp;<span class="string" id="8016316">&#34;tcp4&#34;</span><span class="op" id="8016322">,</span>&nbsp;<span class="string" id="8016324">&#34;tcp6&#34;</span><span class="op" id="8016330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016334">if</span>&nbsp;<span class="ident" id="8016337">err</span>&nbsp;<span class="op" id="8016341">==</span>&nbsp;<span class="ident" id="8016344">nil</span>&nbsp;<span class="op" id="8016348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016353">l</span><span class="op" id="8016354">.</span><span class="op" id="8016355">(</span><span class="op" id="8016356">*</span><span class="ident" id="8016357">TCPListener</span><span class="op" id="8016368">)</span><span class="op" id="8016369">.</span><span class="ident" id="8016370">Close</span><span class="op" id="8016375">(</span><span class="op" id="8016376">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016381">t</span><span class="op" id="8016382">.</span><span class="ident" id="8016383">Fatalf</span><span class="op" id="8016389">(</span><span class="string" id="8016390">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8016425">,</span>&nbsp;<span class="ident" id="8016427">net</span><span class="op" id="8016430">,</span>&nbsp;<span class="ident" id="8016432">laddr</span><span class="op" id="8016437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016444">case</span>&nbsp;<span class="string" id="8016449">&#34;udp&#34;</span><span class="op" id="8016454">,</span>&nbsp;<span class="string" id="8016456">&#34;udp4&#34;</span><span class="op" id="8016462">,</span>&nbsp;<span class="string" id="8016464">&#34;udp6&#34;</span><span class="op" id="8016470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016474">if</span>&nbsp;<span class="ident" id="8016477">err</span>&nbsp;<span class="op" id="8016481">==</span>&nbsp;<span class="ident" id="8016484">nil</span>&nbsp;<span class="op" id="8016488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016493">l</span><span class="op" id="8016494">.</span><span class="op" id="8016495">(</span><span class="op" id="8016496">*</span><span class="ident" id="8016497">UDPConn</span><span class="op" id="8016504">)</span><span class="op" id="8016505">.</span><span class="ident" id="8016506">Close</span><span class="op" id="8016511">(</span><span class="op" id="8016512">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016517">t</span><span class="op" id="8016518">.</span><span class="ident" id="8016519">Fatalf</span><span class="op" id="8016525">(</span><span class="string" id="8016526">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8016567">,</span>&nbsp;<span class="ident" id="8016569">net</span><span class="op" id="8016572">,</span>&nbsp;<span class="ident" id="8016574">laddr</span><span class="op" id="8016579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016586">default</span><span class="op" id="8016593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016597">t</span><span class="op" id="8016598">.</span><span class="ident" id="8016599">Fatalf</span><span class="op" id="8016605">(</span><span class="string" id="8016606">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8016630">,</span>&nbsp;<span class="ident" id="8016632">net</span><span class="op" id="8016635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016638">}</span><br>
<span class="lineno">350</span><span class="op" id="8016640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8016643">func</span>&nbsp;<span class="ident" id="8016648">checkDualStackSecondListener</span><span class="op" id="8016676">(</span><span class="ident" id="8016677">t</span>&nbsp;<span class="op" id="8016679">*</span><span class="ident" id="8016680">testing</span><span class="op" id="8016687">.</span><span class="ident" id="8016688">T</span><span class="op" id="8016689">,</span>&nbsp;<span class="ident" id="8016691">net</span><span class="op" id="8016694">,</span>&nbsp;<span class="ident" id="8016696">laddr</span>&nbsp;<span class="builtintype" id="8016702">string</span><span class="op" id="8016708">,</span>&nbsp;<span class="ident" id="8016710">xerr</span><span class="op" id="8016714">,</span>&nbsp;<span class="ident" id="8016716">err</span>&nbsp;<span class="builtintype" id="8016720">error</span><span class="op" id="8016725">,</span>&nbsp;<span class="ident" id="8016727">l</span>&nbsp;<span class="keyword" id="8016729">interface</span><span class="op" id="8016738">{</span><span class="op" id="8016739">}</span><span class="op" id="8016740">)</span>&nbsp;<span class="op" id="8016742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016745">switch</span>&nbsp;<span class="ident" id="8016752">net</span>&nbsp;<span class="op" id="8016756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016759">case</span>&nbsp;<span class="string" id="8016764">&#34;tcp&#34;</span><span class="op" id="8016769">,</span>&nbsp;<span class="string" id="8016771">&#34;tcp4&#34;</span><span class="op" id="8016777">,</span>&nbsp;<span class="string" id="8016779">&#34;tcp6&#34;</span><span class="op" id="8016785">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016789">if</span>&nbsp;<span class="ident" id="8016792">xerr</span>&nbsp;<span class="op" id="8016797">==</span>&nbsp;<span class="ident" id="8016800">nil</span>&nbsp;<span class="op" id="8016804">&amp;&amp;</span>&nbsp;<span class="ident" id="8016807">err</span>&nbsp;<span class="op" id="8016811">!=</span>&nbsp;<span class="ident" id="8016814">nil</span>&nbsp;<span class="op" id="8016818">||</span>&nbsp;<span class="ident" id="8016821">xerr</span>&nbsp;<span class="op" id="8016826">!=</span>&nbsp;<span class="ident" id="8016829">nil</span>&nbsp;<span class="op" id="8016833">&amp;&amp;</span>&nbsp;<span class="ident" id="8016836">err</span>&nbsp;<span class="op" id="8016840">==</span>&nbsp;<span class="ident" id="8016843">nil</span>&nbsp;<span class="op" id="8016847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016852">t</span><span class="op" id="8016853">.</span><span class="ident" id="8016854">Fatalf</span><span class="op" id="8016860">(</span><span class="string" id="8016861">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8016908">,</span>&nbsp;<span class="ident" id="8016910">net</span><span class="op" id="8016913">,</span>&nbsp;<span class="ident" id="8016915">laddr</span><span class="op" id="8016920">,</span>&nbsp;<span class="ident" id="8016922">err</span><span class="op" id="8016925">,</span>&nbsp;<span class="ident" id="8016927">xerr</span><span class="op" id="8016931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016939">if</span>&nbsp;<span class="ident" id="8016942">err</span>&nbsp;<span class="op" id="8016946">==</span>&nbsp;<span class="ident" id="8016949">nil</span>&nbsp;<span class="op" id="8016953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016958">l</span><span class="op" id="8016959">.</span><span class="op" id="8016960">(</span><span class="op" id="8016961">*</span><span class="ident" id="8016962">TCPListener</span><span class="op" id="8016973">)</span><span class="op" id="8016974">.</span><span class="ident" id="8016975">Close</span><span class="op" id="8016980">(</span><span class="op" id="8016981">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016988">case</span>&nbsp;<span class="string" id="8016993">&#34;udp&#34;</span><span class="op" id="8016998">,</span>&nbsp;<span class="string" id="8017000">&#34;udp4&#34;</span><span class="op" id="8017006">,</span>&nbsp;<span class="string" id="8017008">&#34;udp6&#34;</span><span class="op" id="8017014">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017018">if</span>&nbsp;<span class="ident" id="8017021">xerr</span>&nbsp;<span class="op" id="8017026">==</span>&nbsp;<span class="ident" id="8017029">nil</span>&nbsp;<span class="op" id="8017033">&amp;&amp;</span>&nbsp;<span class="ident" id="8017036">err</span>&nbsp;<span class="op" id="8017040">!=</span>&nbsp;<span class="ident" id="8017043">nil</span>&nbsp;<span class="op" id="8017047">||</span>&nbsp;<span class="ident" id="8017050">xerr</span>&nbsp;<span class="op" id="8017055">!=</span>&nbsp;<span class="ident" id="8017058">nil</span>&nbsp;<span class="op" id="8017062">&amp;&amp;</span>&nbsp;<span class="ident" id="8017065">err</span>&nbsp;<span class="op" id="8017069">==</span>&nbsp;<span class="ident" id="8017072">nil</span>&nbsp;<span class="op" id="8017076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017081">t</span><span class="op" id="8017082">.</span><span class="ident" id="8017083">Fatalf</span><span class="op" id="8017089">(</span><span class="string" id="8017090">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8017143">,</span>&nbsp;<span class="ident" id="8017145">net</span><span class="op" id="8017148">,</span>&nbsp;<span class="ident" id="8017150">laddr</span><span class="op" id="8017155">,</span>&nbsp;<span class="ident" id="8017157">err</span><span class="op" id="8017160">,</span>&nbsp;<span class="ident" id="8017162">xerr</span><span class="op" id="8017166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017170">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017174">if</span>&nbsp;<span class="ident" id="8017177">err</span>&nbsp;<span class="op" id="8017181">==</span>&nbsp;<span class="ident" id="8017184">nil</span>&nbsp;<span class="op" id="8017188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017193">l</span><span class="op" id="8017194">.</span><span class="op" id="8017195">(</span><span class="op" id="8017196">*</span><span class="ident" id="8017197">UDPConn</span><span class="op" id="8017204">)</span><span class="op" id="8017205">.</span><span class="ident" id="8017206">Close</span><span class="op" id="8017211">(</span><span class="op" id="8017212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017219">default</span><span class="op" id="8017226">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017230">t</span><span class="op" id="8017231">.</span><span class="ident" id="8017232">Fatalf</span><span class="op" id="8017238">(</span><span class="string" id="8017239">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8017263">,</span>&nbsp;<span class="ident" id="8017265">net</span><span class="op" id="8017268">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017271">}</span><br>
<span class="lineno"></span><span class="op" id="8017273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8017276">func</span>&nbsp;<span class="ident" id="8017281">checkDualStackAddrFamily</span><span class="op" id="8017305">(</span><span class="ident" id="8017306">t</span>&nbsp;<span class="op" id="8017308">*</span><span class="ident" id="8017309">testing</span><span class="op" id="8017316">.</span><span class="ident" id="8017317">T</span><span class="op" id="8017318">,</span>&nbsp;<span class="ident" id="8017320">net</span><span class="op" id="8017323">,</span>&nbsp;<span class="ident" id="8017325">laddr</span>&nbsp;<span class="builtintype" id="8017331">string</span><span class="op" id="8017337">,</span>&nbsp;<span class="ident" id="8017339">fd</span>&nbsp;<span class="op" id="8017342">*</span><span class="ident" id="8017343">netFD</span><span class="op" id="8017348">)</span>&nbsp;<span class="op" id="8017350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017353">switch</span>&nbsp;<span class="ident" id="8017360">a</span>&nbsp;<span class="op" id="8017362">:=</span>&nbsp;<span class="ident" id="8017365">fd</span><span class="op" id="8017367">.</span><span class="ident" id="8017368">laddr</span><span class="op" id="8017373">.</span><span class="op" id="8017374">(</span><span class="keyword" id="8017375">type</span><span class="op" id="8017379">)</span>&nbsp;<span class="op" id="8017381">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017384">case</span>&nbsp;<span class="op" id="8017389">*</span><span class="ident" id="8017390">TCPAddr</span><span class="op" id="8017397">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8017401">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8017457">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8017510">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8017567">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017589">if</span>&nbsp;<span class="ident" id="8017592">supportsIPv4map</span>&nbsp;<span class="op" id="8017608">&amp;&amp;</span>&nbsp;<span class="ident" id="8017611">fd</span><span class="op" id="8017613">.</span><span class="ident" id="8017614">laddr</span><span class="op" id="8017619">.</span><span class="op" id="8017620">(</span><span class="op" id="8017621">*</span><span class="ident" id="8017622">TCPAddr</span><span class="op" id="8017629">)</span><span class="op" id="8017630">.</span><span class="ident" id="8017631">isWildcard</span><span class="op" id="8017641">(</span><span class="op" id="8017642">)</span>&nbsp;<span class="op" id="8017644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017649">if</span>&nbsp;<span class="ident" id="8017652">fd</span><span class="op" id="8017654">.</span><span class="ident" id="8017655">family</span>&nbsp;<span class="op" id="8017662">!=</span>&nbsp;<span class="ident" id="8017665">syscall</span><span class="op" id="8017672">.</span><span class="ident" id="8017673">AF_INET6</span>&nbsp;<span class="op" id="8017682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017688">t</span><span class="op" id="8017689">.</span><span class="ident" id="8017690">Fatalf</span><span class="op" id="8017696">(</span><span class="string" id="8017697">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8017752">,</span>&nbsp;<span class="ident" id="8017754">net</span><span class="op" id="8017757">,</span>&nbsp;<span class="ident" id="8017759">laddr</span><span class="op" id="8017764">,</span>&nbsp;<span class="ident" id="8017766">fd</span><span class="op" id="8017768">.</span><span class="ident" id="8017769">family</span><span class="op" id="8017775">,</span>&nbsp;<span class="ident" id="8017777">syscall</span><span class="op" id="8017784">.</span><span class="ident" id="8017785">AF_INET6</span><span class="op" id="8017793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017802">}</span>&nbsp;<span class="keyword" id="8017804">else</span>&nbsp;<span class="op" id="8017809">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017814">if</span>&nbsp;<span class="ident" id="8017817">fd</span><span class="op" id="8017819">.</span><span class="ident" id="8017820">family</span>&nbsp;<span class="op" id="8017827">!=</span>&nbsp;<span class="ident" id="8017830">a</span><span class="op" id="8017831">.</span><span class="ident" id="8017832">family</span><span class="op" id="8017838">(</span><span class="op" id="8017839">)</span>&nbsp;<span class="op" id="8017841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017847">t</span><span class="op" id="8017848">.</span><span class="ident" id="8017849">Fatalf</span><span class="op" id="8017855">(</span><span class="string" id="8017856">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8017911">,</span>&nbsp;<span class="ident" id="8017913">net</span><span class="op" id="8017916">,</span>&nbsp;<span class="ident" id="8017918">laddr</span><span class="op" id="8017923">,</span>&nbsp;<span class="ident" id="8017925">fd</span><span class="op" id="8017927">.</span><span class="ident" id="8017928">family</span><span class="op" id="8017934">,</span>&nbsp;<span class="ident" id="8017936">a</span><span class="op" id="8017937">.</span><span class="ident" id="8017938">family</span><span class="op" id="8017944">(</span><span class="op" id="8017945">)</span><span class="op" id="8017946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017958">case</span>&nbsp;<span class="op" id="8017963">*</span><span class="ident" id="8017964">UDPAddr</span><span class="op" id="8017971">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8017975">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8018031">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8018084">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8018141">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018163">if</span>&nbsp;<span class="ident" id="8018166">supportsIPv4map</span>&nbsp;<span class="op" id="8018182">&amp;&amp;</span>&nbsp;<span class="ident" id="8018185">fd</span><span class="op" id="8018187">.</span><span class="ident" id="8018188">laddr</span><span class="op" id="8018193">.</span><span class="op" id="8018194">(</span><span class="op" id="8018195">*</span><span class="ident" id="8018196">UDPAddr</span><span class="op" id="8018203">)</span><span class="op" id="8018204">.</span><span class="ident" id="8018205">isWildcard</span><span class="op" id="8018215">(</span><span class="op" id="8018216">)</span>&nbsp;<span class="op" id="8018218">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018223">if</span>&nbsp;<span class="ident" id="8018226">fd</span><span class="op" id="8018228">.</span><span class="ident" id="8018229">family</span>&nbsp;<span class="op" id="8018236">!=</span>&nbsp;<span class="ident" id="8018239">syscall</span><span class="op" id="8018246">.</span><span class="ident" id="8018247">AF_INET6</span>&nbsp;<span class="op" id="8018256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018262">t</span><span class="op" id="8018263">.</span><span class="ident" id="8018264">Fatalf</span><span class="op" id="8018270">(</span><span class="string" id="8018271">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8018332">,</span>&nbsp;<span class="ident" id="8018334">net</span><span class="op" id="8018337">,</span>&nbsp;<span class="ident" id="8018339">laddr</span><span class="op" id="8018344">,</span>&nbsp;<span class="ident" id="8018346">fd</span><span class="op" id="8018348">.</span><span class="ident" id="8018349">family</span><span class="op" id="8018355">,</span>&nbsp;<span class="ident" id="8018357">syscall</span><span class="op" id="8018364">.</span><span class="ident" id="8018365">AF_INET6</span><span class="op" id="8018373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018382">}</span>&nbsp;<span class="keyword" id="8018384">else</span>&nbsp;<span class="op" id="8018389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018394">if</span>&nbsp;<span class="ident" id="8018397">fd</span><span class="op" id="8018399">.</span><span class="ident" id="8018400">family</span>&nbsp;<span class="op" id="8018407">!=</span>&nbsp;<span class="ident" id="8018410">a</span><span class="op" id="8018411">.</span><span class="ident" id="8018412">family</span><span class="op" id="8018418">(</span><span class="op" id="8018419">)</span>&nbsp;<span class="op" id="8018421">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018427">t</span><span class="op" id="8018428">.</span><span class="ident" id="8018429">Fatalf</span><span class="op" id="8018435">(</span><span class="string" id="8018436">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8018497">,</span>&nbsp;<span class="ident" id="8018499">net</span><span class="op" id="8018502">,</span>&nbsp;<span class="ident" id="8018504">laddr</span><span class="op" id="8018509">,</span>&nbsp;<span class="ident" id="8018511">fd</span><span class="op" id="8018513">.</span><span class="ident" id="8018514">family</span><span class="op" id="8018520">,</span>&nbsp;<span class="ident" id="8018522">a</span><span class="op" id="8018523">.</span><span class="ident" id="8018524">family</span><span class="op" id="8018530">(</span><span class="op" id="8018531">)</span><span class="op" id="8018532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018544">default</span><span class="op" id="8018551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018555">t</span><span class="op" id="8018556">.</span><span class="ident" id="8018557">Fatalf</span><span class="op" id="8018563">(</span><span class="string" id="8018564">&#34;Unexpected&nbsp;protocol&nbsp;address&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="8018602">,</span>&nbsp;<span class="ident" id="8018604">a</span><span class="op" id="8018605">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018608">}</span><br>
<span class="lineno"></span><span class="op" id="8018610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8018613">var</span>&nbsp;<span class="ident" id="8018617">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="8018644">=</span>&nbsp;<span class="op" id="8018646">[</span><span class="op" id="8018647">]</span><span class="keyword" id="8018648">struct</span>&nbsp;<span class="op" id="8018655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018658">net</span>&nbsp;&nbsp;<span class="builtintype" id="8018663">string</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018671">addr</span>&nbsp;<span class="builtintype" id="8018676">string</span><br>
<span class="lineno"></span><span class="op" id="8018683">}</span><span class="op" id="8018684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018687">{</span><span class="string" id="8018688">&#34;tcp6&#34;</span><span class="op" id="8018694">,</span>&nbsp;<span class="string" id="8018696">&#34;127.0.0.1&#34;</span><span class="op" id="8018707">}</span><span class="op" id="8018708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018711">{</span><span class="string" id="8018712">&#34;tcp6&#34;</span><span class="op" id="8018718">,</span>&nbsp;<span class="string" id="8018720">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8018740">}</span><span class="op" id="8018741">,</span><br>
<span class="lineno"></span><span class="op" id="8018743">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="8018746">func</span>&nbsp;<span class="ident" id="8018751">TestProhibitionaryDialArgs</span><span class="op" id="8018777">(</span><span class="ident" id="8018778">t</span>&nbsp;<span class="op" id="8018780">*</span><span class="ident" id="8018781">testing</span><span class="op" id="8018788">.</span><span class="ident" id="8018789">T</span><span class="op" id="8018790">)</span>&nbsp;<span class="op" id="8018792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018795">switch</span>&nbsp;<span class="ident" id="8018802">runtime</span><span class="op" id="8018809">.</span><span class="ident" id="8018810">GOOS</span>&nbsp;<span class="op" id="8018815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018818">case</span>&nbsp;<span class="string" id="8018823">&#34;plan9&#34;</span><span class="op" id="8018830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018834">t</span><span class="op" id="8018835">.</span><span class="ident" id="8018836">Skipf</span><span class="op" id="8018841">(</span><span class="string" id="8018842">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8018863">,</span>&nbsp;<span class="ident" id="8018865">runtime</span><span class="op" id="8018872">.</span><span class="ident" id="8018873">GOOS</span><span class="op" id="8018877">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8018883">//&nbsp;This&nbsp;test&nbsp;requires&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018953">if</span>&nbsp;<span class="op" id="8018956">!</span><span class="ident" id="8018957">supportsIPv4map</span>&nbsp;<span class="op" id="8018973">||</span>&nbsp;<span class="ident" id="8018976">testing</span><span class="op" id="8018983">.</span><span class="ident" id="8018984">Short</span><span class="op" id="8018989">(</span><span class="op" id="8018990">)</span>&nbsp;<span class="op" id="8018992">||</span>&nbsp;<span class="op" id="8018995">!</span><span class="op" id="8018996">*</span><span class="ident" id="8018997">testExternal</span>&nbsp;<span class="op" id="8019010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019014">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019022">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019026">l</span><span class="op" id="8019027">,</span>&nbsp;<span class="ident" id="8019029">port</span>&nbsp;<span class="op" id="8019034">:=</span>&nbsp;<span class="ident" id="8019037">usableListenPort</span><span class="op" id="8019053">(</span><span class="ident" id="8019054">t</span><span class="op" id="8019055">,</span>&nbsp;<span class="string" id="8019057">&#34;tcp&#34;</span><span class="op" id="8019062">,</span>&nbsp;<span class="string" id="8019064">&#34;[::]&#34;</span><span class="op" id="8019070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019073">defer</span>&nbsp;<span class="ident" id="8019079">l</span><span class="op" id="8019080">.</span><span class="ident" id="8019081">Close</span><span class="op" id="8019086">(</span><span class="op" id="8019087">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019091">for</span>&nbsp;<span class="ident" id="8019095">_</span><span class="op" id="8019096">,</span>&nbsp;<span class="ident" id="8019098">tt</span>&nbsp;<span class="op" id="8019101">:=</span>&nbsp;<span class="keyword" id="8019104">range</span>&nbsp;<span class="ident" id="8019110">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="8019137">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019141">c</span><span class="op" id="8019142">,</span>&nbsp;<span class="ident" id="8019144">err</span>&nbsp;<span class="op" id="8019148">:=</span>&nbsp;<span class="ident" id="8019151">Dial</span><span class="op" id="8019155">(</span><span class="ident" id="8019156">tt</span><span class="op" id="8019158">.</span><span class="ident" id="8019159">net</span><span class="op" id="8019162">,</span>&nbsp;<span class="ident" id="8019164">tt</span><span class="op" id="8019166">.</span><span class="ident" id="8019167">addr</span><span class="op" id="8019171">+</span><span class="string" id="8019172">&#34;:&#34;</span><span class="op" id="8019175">+</span><span class="ident" id="8019176">port</span><span class="op" id="8019180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019184">if</span>&nbsp;<span class="ident" id="8019187">err</span>&nbsp;<span class="op" id="8019191">==</span>&nbsp;<span class="ident" id="8019194">nil</span>&nbsp;<span class="op" id="8019198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019203">c</span><span class="op" id="8019204">.</span><span class="ident" id="8019205">Close</span><span class="op" id="8019210">(</span><span class="op" id="8019211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019216">t</span><span class="op" id="8019217">.</span><span class="ident" id="8019218">Fatalf</span><span class="op" id="8019224">(</span><span class="string" id="8019225">&#34;Dial(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8019251">,</span>&nbsp;<span class="ident" id="8019253">tt</span><span class="op" id="8019255">.</span><span class="ident" id="8019256">net</span><span class="op" id="8019259">,</span>&nbsp;<span class="ident" id="8019261">tt</span><span class="op" id="8019263">.</span><span class="ident" id="8019264">addr</span><span class="op" id="8019268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019272">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019275">}</span><br>
<span class="lineno"></span><span class="op" id="8019277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8019280">func</span>&nbsp;<span class="ident" id="8019285">TestWildWildcardListener</span><span class="op" id="8019309">(</span><span class="ident" id="8019310">t</span>&nbsp;<span class="op" id="8019312">*</span><span class="ident" id="8019313">testing</span><span class="op" id="8019320">.</span><span class="ident" id="8019321">T</span><span class="op" id="8019322">)</span>&nbsp;<span class="op" id="8019324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019327">switch</span>&nbsp;<span class="ident" id="8019334">runtime</span><span class="op" id="8019341">.</span><span class="ident" id="8019342">GOOS</span>&nbsp;<span class="op" id="8019347">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019350">case</span>&nbsp;<span class="string" id="8019355">&#34;plan9&#34;</span><span class="op" id="8019362">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019366">t</span><span class="op" id="8019367">.</span><span class="ident" id="8019368">Skipf</span><span class="op" id="8019373">(</span><span class="string" id="8019374">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8019395">,</span>&nbsp;<span class="ident" id="8019397">runtime</span><span class="op" id="8019404">.</span><span class="ident" id="8019405">GOOS</span><span class="op" id="8019409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019416">if</span>&nbsp;<span class="ident" id="8019419">testing</span><span class="op" id="8019426">.</span><span class="ident" id="8019427">Short</span><span class="op" id="8019432">(</span><span class="op" id="8019433">)</span>&nbsp;<span class="op" id="8019435">||</span>&nbsp;<span class="op" id="8019438">!</span><span class="op" id="8019439">*</span><span class="ident" id="8019440">testExternal</span>&nbsp;<span class="op" id="8019453">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019457">t</span><span class="op" id="8019458">.</span><span class="ident" id="8019459">Skip</span><span class="op" id="8019463">(</span><span class="string" id="8019464">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8019505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019512">defer</span>&nbsp;<span class="keyword" id="8019518">func</span><span class="op" id="8019522">(</span><span class="op" id="8019523">)</span>&nbsp;<span class="op" id="8019525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019529">if</span>&nbsp;<span class="ident" id="8019532">p</span>&nbsp;<span class="op" id="8019534">:=</span>&nbsp;<span class="builtinfunc" id="8019537">recover</span><span class="op" id="8019544">(</span><span class="op" id="8019545">)</span><span class="op" id="8019546">;</span>&nbsp;<span class="ident" id="8019548">p</span>&nbsp;<span class="op" id="8019550">!=</span>&nbsp;<span class="ident" id="8019553">nil</span>&nbsp;<span class="op" id="8019557">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019562">t</span><span class="op" id="8019563">.</span><span class="ident" id="8019564">Fatalf</span><span class="op" id="8019570">(</span><span class="string" id="8019571">&#34;Listen,&nbsp;ListenPacket&nbsp;or&nbsp;protocol-specific&nbsp;Listen&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8019634">,</span>&nbsp;<span class="ident" id="8019636">p</span><span class="op" id="8019637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019644">}</span><span class="op" id="8019645">(</span><span class="op" id="8019646">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019650">if</span>&nbsp;<span class="ident" id="8019653">ln</span><span class="op" id="8019655">,</span>&nbsp;<span class="ident" id="8019657">err</span>&nbsp;<span class="op" id="8019661">:=</span>&nbsp;<span class="ident" id="8019664">Listen</span><span class="op" id="8019670">(</span><span class="string" id="8019671">&#34;tcp&#34;</span><span class="op" id="8019676">,</span>&nbsp;<span class="string" id="8019678">&#34;&#34;</span><span class="op" id="8019680">)</span><span class="op" id="8019681">;</span>&nbsp;<span class="ident" id="8019683">err</span>&nbsp;<span class="op" id="8019687">==</span>&nbsp;<span class="ident" id="8019690">nil</span>&nbsp;<span class="op" id="8019694">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019698">ln</span><span class="op" id="8019700">.</span><span class="ident" id="8019701">Close</span><span class="op" id="8019706">(</span><span class="op" id="8019707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019713">if</span>&nbsp;<span class="ident" id="8019716">ln</span><span class="op" id="8019718">,</span>&nbsp;<span class="ident" id="8019720">err</span>&nbsp;<span class="op" id="8019724">:=</span>&nbsp;<span class="ident" id="8019727">ListenPacket</span><span class="op" id="8019739">(</span><span class="string" id="8019740">&#34;udp&#34;</span><span class="op" id="8019745">,</span>&nbsp;<span class="string" id="8019747">&#34;&#34;</span><span class="op" id="8019749">)</span><span class="op" id="8019750">;</span>&nbsp;<span class="ident" id="8019752">err</span>&nbsp;<span class="op" id="8019756">==</span>&nbsp;<span class="ident" id="8019759">nil</span>&nbsp;<span class="op" id="8019763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019767">ln</span><span class="op" id="8019769">.</span><span class="ident" id="8019770">Close</span><span class="op" id="8019775">(</span><span class="op" id="8019776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019779">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019782">if</span>&nbsp;<span class="ident" id="8019785">ln</span><span class="op" id="8019787">,</span>&nbsp;<span class="ident" id="8019789">err</span>&nbsp;<span class="op" id="8019793">:=</span>&nbsp;<span class="ident" id="8019796">ListenTCP</span><span class="op" id="8019805">(</span><span class="string" id="8019806">&#34;tcp&#34;</span><span class="op" id="8019811">,</span>&nbsp;<span class="ident" id="8019813">nil</span><span class="op" id="8019816">)</span><span class="op" id="8019817">;</span>&nbsp;<span class="ident" id="8019819">err</span>&nbsp;<span class="op" id="8019823">==</span>&nbsp;<span class="ident" id="8019826">nil</span>&nbsp;<span class="op" id="8019830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019834">ln</span><span class="op" id="8019836">.</span><span class="ident" id="8019837">Close</span><span class="op" id="8019842">(</span><span class="op" id="8019843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019849">if</span>&nbsp;<span class="ident" id="8019852">ln</span><span class="op" id="8019854">,</span>&nbsp;<span class="ident" id="8019856">err</span>&nbsp;<span class="op" id="8019860">:=</span>&nbsp;<span class="ident" id="8019863">ListenUDP</span><span class="op" id="8019872">(</span><span class="string" id="8019873">&#34;udp&#34;</span><span class="op" id="8019878">,</span>&nbsp;<span class="ident" id="8019880">nil</span><span class="op" id="8019883">)</span><span class="op" id="8019884">;</span>&nbsp;<span class="ident" id="8019886">err</span>&nbsp;<span class="op" id="8019890">==</span>&nbsp;<span class="ident" id="8019893">nil</span>&nbsp;<span class="op" id="8019897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019901">ln</span><span class="op" id="8019903">.</span><span class="ident" id="8019904">Close</span><span class="op" id="8019909">(</span><span class="op" id="8019910">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019916">if</span>&nbsp;<span class="ident" id="8019919">ln</span><span class="op" id="8019921">,</span>&nbsp;<span class="ident" id="8019923">err</span>&nbsp;<span class="op" id="8019927">:=</span>&nbsp;<span class="ident" id="8019930">ListenIP</span><span class="op" id="8019938">(</span><span class="string" id="8019939">&#34;ip:icmp&#34;</span><span class="op" id="8019948">,</span>&nbsp;<span class="ident" id="8019950">nil</span><span class="op" id="8019953">)</span><span class="op" id="8019954">;</span>&nbsp;<span class="ident" id="8019956">err</span>&nbsp;<span class="op" id="8019960">==</span>&nbsp;<span class="ident" id="8019963">nil</span>&nbsp;<span class="op" id="8019967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019971">ln</span><span class="op" id="8019973">.</span><span class="ident" id="8019974">Close</span><span class="op" id="8019979">(</span><span class="op" id="8019980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019983">}</span><br>
<span class="lineno"></span><span class="op" id="8019985">}</span>
</div>
</body>
</html>
