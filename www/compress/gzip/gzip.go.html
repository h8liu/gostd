<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4291372">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4291427">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4291481">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4291532">package</span>&nbsp;<span class="ident" id="4291540">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4291546">import</span>&nbsp;<span class="op" id="4291553">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4291556">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4291574">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4291584">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4291591">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4291599">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4291613">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4291618">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4291621">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="4291701">//&nbsp;&#34;compress/gzip&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4291767">const</span>&nbsp;<span class="op" id="4291773">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291776">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4291795">=</span>&nbsp;<span class="ident" id="4291797">flate</span><span class="op" id="4291802">.</span><span class="ident" id="4291803">NoCompression</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291818">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4291837">=</span>&nbsp;<span class="ident" id="4291839">flate</span><span class="op" id="4291844">.</span><span class="ident" id="4291845">BestSpeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291856">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4291875">=</span>&nbsp;<span class="ident" id="4291877">flate</span><span class="op" id="4291882">.</span><span class="ident" id="4291883">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291900">DefaultCompression</span>&nbsp;<span class="op" id="4291919">=</span>&nbsp;<span class="ident" id="4291921">flate</span><span class="op" id="4291926">.</span><span class="ident" id="4291927">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="4291946">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4291949">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;an&nbsp;io.WriteCloser.</span><br>
<span class="lineno"></span><span class="comment" id="4291983">//&nbsp;Writes&nbsp;to&nbsp;a&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4292038">type</span>&nbsp;<span class="ident" id="4292043">Writer</span>&nbsp;<span class="keyword" id="4292050">struct</span>&nbsp;<span class="op" id="4292057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292060">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292068">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292080">io</span><span class="op" id="4292082">.</span><span class="ident" id="4292083">Writer</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292091">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4292103">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292108">wroteHeader</span>&nbsp;<span class="builtintype" id="4292120">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292126">compressor</span>&nbsp;&nbsp;<span class="op" id="4292138">*</span><span class="ident" id="4292139">flate</span><span class="op" id="4292144">.</span><span class="ident" id="4292145">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292153">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292165">hash</span><span class="op" id="4292169">.</span><span class="ident" id="4292170">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292178">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4292190">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292198">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4292210">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292216">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4292228">[</span><span class="num" id="4292229">10</span><span class="op" id="4292231">]</span><span class="builtintype" id="4292232">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292238">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4292250">error</span><br>
<span class="lineno"></span><span class="op" id="4292256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4292259">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4292294">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4292360">//</span><br>
<span class="lineno"></span><span class="comment" id="4292363">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="4292444">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno">45</span><span class="comment" id="4292499">//</span><br>
<span class="lineno"></span><span class="comment" id="4292502">//&nbsp;Callers&nbsp;that&nbsp;wish&nbsp;to&nbsp;set&nbsp;the&nbsp;fields&nbsp;in&nbsp;Writer.Header&nbsp;must&nbsp;do&nbsp;so&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4292576">//&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;Close.&nbsp;The&nbsp;Comment&nbsp;and&nbsp;Name&nbsp;header&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4292652">//&nbsp;UTF-8&nbsp;strings&nbsp;in&nbsp;Go,&nbsp;but&nbsp;the&nbsp;underlying&nbsp;format&nbsp;requires&nbsp;NUL-terminated&nbsp;ISO</span><br>
<span class="lineno"></span><span class="comment" id="4292730">//&nbsp;8859-1&nbsp;(Latin-1).&nbsp;NUL&nbsp;or&nbsp;non-Latin-1&nbsp;runes&nbsp;in&nbsp;those&nbsp;strings&nbsp;will&nbsp;lead&nbsp;to&nbsp;an</span><br>
<span class="lineno">50</span><span class="comment" id="4292809">//&nbsp;error&nbsp;on&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="4292828">func</span>&nbsp;<span class="ident" id="4292833">NewWriter</span><span class="op" id="4292842">(</span><span class="ident" id="4292843">w</span>&nbsp;<span class="ident" id="4292845">io</span><span class="op" id="4292847">.</span><span class="ident" id="4292848">Writer</span><span class="op" id="4292854">)</span>&nbsp;<span class="op" id="4292856">*</span><span class="ident" id="4292857">Writer</span>&nbsp;<span class="op" id="4292864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292867">z</span><span class="op" id="4292868">,</span>&nbsp;<span class="ident" id="4292870">_</span>&nbsp;<span class="op" id="4292872">:=</span>&nbsp;<span class="ident" id="4292875">NewWriterLevel</span><span class="op" id="4292889">(</span><span class="ident" id="4292890">w</span><span class="op" id="4292891">,</span>&nbsp;<span class="ident" id="4292893">DefaultCompression</span><span class="op" id="4292911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292914">return</span>&nbsp;<span class="ident" id="4292921">z</span><br>
<span class="lineno"></span><span class="op" id="4292923">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4292926">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4293006">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="4293041">//</span><br>
<span class="lineno"></span><span class="comment" id="4293044">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno">60</span><span class="comment" id="4293118">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4293194">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4293241">func</span>&nbsp;<span class="ident" id="4293246">NewWriterLevel</span><span class="op" id="4293260">(</span><span class="ident" id="4293261">w</span>&nbsp;<span class="ident" id="4293263">io</span><span class="op" id="4293265">.</span><span class="ident" id="4293266">Writer</span><span class="op" id="4293272">,</span>&nbsp;<span class="ident" id="4293274">level</span>&nbsp;<span class="builtintype" id="4293280">int</span><span class="op" id="4293283">)</span>&nbsp;<span class="op" id="4293285">(</span><span class="op" id="4293286">*</span><span class="ident" id="4293287">Writer</span><span class="op" id="4293293">,</span>&nbsp;<span class="builtintype" id="4293295">error</span><span class="op" id="4293300">)</span>&nbsp;<span class="op" id="4293302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293305">if</span>&nbsp;<span class="ident" id="4293308">level</span>&nbsp;<span class="op" id="4293314">&lt;</span>&nbsp;<span class="ident" id="4293316">DefaultCompression</span>&nbsp;<span class="op" id="4293335">||</span>&nbsp;<span class="ident" id="4293338">level</span>&nbsp;<span class="op" id="4293344">&gt;</span>&nbsp;<span class="ident" id="4293346">BestCompression</span>&nbsp;<span class="op" id="4293362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293366">return</span>&nbsp;<span class="ident" id="4293373">nil</span><span class="op" id="4293376">,</span>&nbsp;<span class="ident" id="4293378">fmt</span><span class="op" id="4293381">.</span><span class="ident" id="4293382">Errorf</span><span class="op" id="4293388">(</span><span class="string" id="4293389">&#34;gzip:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="4293426">,</span>&nbsp;<span class="ident" id="4293428">level</span><span class="op" id="4293433">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293439">z</span>&nbsp;<span class="op" id="4293441">:=</span>&nbsp;<span class="builtinfunc" id="4293444">new</span><span class="op" id="4293447">(</span><span class="ident" id="4293448">Writer</span><span class="op" id="4293454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293457">z</span><span class="op" id="4293458">.</span><span class="ident" id="4293459">init</span><span class="op" id="4293463">(</span><span class="ident" id="4293464">w</span><span class="op" id="4293465">,</span>&nbsp;<span class="ident" id="4293467">level</span><span class="op" id="4293472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293475">return</span>&nbsp;<span class="ident" id="4293482">z</span><span class="op" id="4293483">,</span>&nbsp;<span class="ident" id="4293485">nil</span><br>
<span class="lineno"></span><span class="op" id="4293489">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4293492">func</span>&nbsp;<span class="op" id="4293497">(</span><span class="ident" id="4293498">z</span>&nbsp;<span class="op" id="4293500">*</span><span class="ident" id="4293501">Writer</span><span class="op" id="4293507">)</span>&nbsp;<span class="ident" id="4293509">init</span><span class="op" id="4293513">(</span><span class="ident" id="4293514">w</span>&nbsp;<span class="ident" id="4293516">io</span><span class="op" id="4293518">.</span><span class="ident" id="4293519">Writer</span><span class="op" id="4293525">,</span>&nbsp;<span class="ident" id="4293527">level</span>&nbsp;<span class="builtintype" id="4293533">int</span><span class="op" id="4293536">)</span>&nbsp;<span class="op" id="4293538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293541">digest</span>&nbsp;<span class="op" id="4293548">:=</span>&nbsp;<span class="ident" id="4293551">z</span><span class="op" id="4293552">.</span><span class="ident" id="4293553">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293561">if</span>&nbsp;<span class="ident" id="4293564">digest</span>&nbsp;<span class="op" id="4293571">!=</span>&nbsp;<span class="ident" id="4293574">nil</span>&nbsp;<span class="op" id="4293578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293582">digest</span><span class="op" id="4293588">.</span><span class="ident" id="4293589">Reset</span><span class="op" id="4293594">(</span><span class="op" id="4293595">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293598">}</span>&nbsp;<span class="keyword" id="4293600">else</span>&nbsp;<span class="op" id="4293605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293609">digest</span>&nbsp;<span class="op" id="4293616">=</span>&nbsp;<span class="ident" id="4293618">crc32</span><span class="op" id="4293623">.</span><span class="ident" id="4293624">NewIEEE</span><span class="op" id="4293631">(</span><span class="op" id="4293632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293638">compressor</span>&nbsp;<span class="op" id="4293649">:=</span>&nbsp;<span class="ident" id="4293652">z</span><span class="op" id="4293653">.</span><span class="ident" id="4293654">compressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293666">if</span>&nbsp;<span class="ident" id="4293669">compressor</span>&nbsp;<span class="op" id="4293680">!=</span>&nbsp;<span class="ident" id="4293683">nil</span>&nbsp;<span class="op" id="4293687">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293691">compressor</span><span class="op" id="4293701">.</span><span class="ident" id="4293702">Reset</span><span class="op" id="4293707">(</span><span class="ident" id="4293708">w</span><span class="op" id="4293709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293715">*</span><span class="ident" id="4293716">z</span>&nbsp;<span class="op" id="4293718">=</span>&nbsp;<span class="ident" id="4293720">Writer</span><span class="op" id="4293726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293730">Header</span><span class="op" id="4293736">:</span>&nbsp;<span class="ident" id="4293738">Header</span><span class="op" id="4293744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293749">OS</span><span class="op" id="4293751">:</span>&nbsp;<span class="num" id="4293753">255</span><span class="op" id="4293756">,</span>&nbsp;<span class="comment" id="4293758">//&nbsp;unknown</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293771">}</span><span class="op" id="4293772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293776">w</span><span class="op" id="4293777">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293788">w</span><span class="op" id="4293789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293793">level</span><span class="op" id="4293798">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293805">level</span><span class="op" id="4293810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293814">digest</span><span class="op" id="4293820">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293826">digest</span><span class="op" id="4293832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293836">compressor</span><span class="op" id="4293846">:</span>&nbsp;<span class="ident" id="4293848">compressor</span><span class="op" id="4293858">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293861">}</span><br>
<span class="lineno"></span><span class="op" id="4293863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4293866">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Writer&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4293936">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewWriter&nbsp;or&nbsp;NewWriterLevel,&nbsp;but</span><br>
<span class="lineno">95</span><span class="comment" id="4294006">//&nbsp;writing&nbsp;to&nbsp;w&nbsp;instead.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Writer&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="4294073">//&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4294098">func</span>&nbsp;<span class="op" id="4294103">(</span><span class="ident" id="4294104">z</span>&nbsp;<span class="op" id="4294106">*</span><span class="ident" id="4294107">Writer</span><span class="op" id="4294113">)</span>&nbsp;<span class="ident" id="4294115">Reset</span><span class="op" id="4294120">(</span><span class="ident" id="4294121">w</span>&nbsp;<span class="ident" id="4294123">io</span><span class="op" id="4294125">.</span><span class="ident" id="4294126">Writer</span><span class="op" id="4294132">)</span>&nbsp;<span class="op" id="4294134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294137">z</span><span class="op" id="4294138">.</span><span class="ident" id="4294139">init</span><span class="op" id="4294143">(</span><span class="ident" id="4294144">w</span><span class="op" id="4294145">,</span>&nbsp;<span class="ident" id="4294147">z</span><span class="op" id="4294148">.</span><span class="ident" id="4294149">level</span><span class="op" id="4294154">)</span><br>
<span class="lineno"></span><span class="op" id="4294156">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4294159">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4294220">func</span>&nbsp;<span class="ident" id="4294225">put2</span><span class="op" id="4294229">(</span><span class="ident" id="4294230">p</span>&nbsp;<span class="op" id="4294232">[</span><span class="op" id="4294233">]</span><span class="builtintype" id="4294234">byte</span><span class="op" id="4294238">,</span>&nbsp;<span class="ident" id="4294240">v</span>&nbsp;<span class="builtintype" id="4294242">uint16</span><span class="op" id="4294248">)</span>&nbsp;<span class="op" id="4294250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294253">p</span><span class="op" id="4294254">[</span><span class="num" id="4294255">0</span><span class="op" id="4294256">]</span>&nbsp;<span class="op" id="4294258">=</span>&nbsp;<span class="builtintype" id="4294260">uint8</span><span class="op" id="4294265">(</span><span class="ident" id="4294266">v</span>&nbsp;<span class="op" id="4294268">&gt;&gt;</span>&nbsp;<span class="num" id="4294271">0</span><span class="op" id="4294272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294275">p</span><span class="op" id="4294276">[</span><span class="num" id="4294277">1</span><span class="op" id="4294278">]</span>&nbsp;<span class="op" id="4294280">=</span>&nbsp;<span class="builtintype" id="4294282">uint8</span><span class="op" id="4294287">(</span><span class="ident" id="4294288">v</span>&nbsp;<span class="op" id="4294290">&gt;&gt;</span>&nbsp;<span class="num" id="4294293">8</span><span class="op" id="4294294">)</span><br>
<span class="lineno">105</span><span class="op" id="4294296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4294299">func</span>&nbsp;<span class="ident" id="4294304">put4</span><span class="op" id="4294308">(</span><span class="ident" id="4294309">p</span>&nbsp;<span class="op" id="4294311">[</span><span class="op" id="4294312">]</span><span class="builtintype" id="4294313">byte</span><span class="op" id="4294317">,</span>&nbsp;<span class="ident" id="4294319">v</span>&nbsp;<span class="builtintype" id="4294321">uint32</span><span class="op" id="4294327">)</span>&nbsp;<span class="op" id="4294329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294332">p</span><span class="op" id="4294333">[</span><span class="num" id="4294334">0</span><span class="op" id="4294335">]</span>&nbsp;<span class="op" id="4294337">=</span>&nbsp;<span class="builtintype" id="4294339">uint8</span><span class="op" id="4294344">(</span><span class="ident" id="4294345">v</span>&nbsp;<span class="op" id="4294347">&gt;&gt;</span>&nbsp;<span class="num" id="4294350">0</span><span class="op" id="4294351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294354">p</span><span class="op" id="4294355">[</span><span class="num" id="4294356">1</span><span class="op" id="4294357">]</span>&nbsp;<span class="op" id="4294359">=</span>&nbsp;<span class="builtintype" id="4294361">uint8</span><span class="op" id="4294366">(</span><span class="ident" id="4294367">v</span>&nbsp;<span class="op" id="4294369">&gt;&gt;</span>&nbsp;<span class="num" id="4294372">8</span><span class="op" id="4294373">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294376">p</span><span class="op" id="4294377">[</span><span class="num" id="4294378">2</span><span class="op" id="4294379">]</span>&nbsp;<span class="op" id="4294381">=</span>&nbsp;<span class="builtintype" id="4294383">uint8</span><span class="op" id="4294388">(</span><span class="ident" id="4294389">v</span>&nbsp;<span class="op" id="4294391">&gt;&gt;</span>&nbsp;<span class="num" id="4294394">16</span><span class="op" id="4294396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294399">p</span><span class="op" id="4294400">[</span><span class="num" id="4294401">3</span><span class="op" id="4294402">]</span>&nbsp;<span class="op" id="4294404">=</span>&nbsp;<span class="builtintype" id="4294406">uint8</span><span class="op" id="4294411">(</span><span class="ident" id="4294412">v</span>&nbsp;<span class="op" id="4294414">&gt;&gt;</span>&nbsp;<span class="num" id="4294417">24</span><span class="op" id="4294419">)</span><br>
<span class="lineno"></span><span class="op" id="4294421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4294424">//&nbsp;writeBytes&nbsp;writes&nbsp;a&nbsp;length-prefixed&nbsp;byte&nbsp;slice&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno">115</span><span class="keyword" id="4294482">func</span>&nbsp;<span class="op" id="4294487">(</span><span class="ident" id="4294488">z</span>&nbsp;<span class="op" id="4294490">*</span><span class="ident" id="4294491">Writer</span><span class="op" id="4294497">)</span>&nbsp;<span class="ident" id="4294499">writeBytes</span><span class="op" id="4294509">(</span><span class="ident" id="4294510">b</span>&nbsp;<span class="op" id="4294512">[</span><span class="op" id="4294513">]</span><span class="builtintype" id="4294514">byte</span><span class="op" id="4294518">)</span>&nbsp;<span class="builtintype" id="4294520">error</span>&nbsp;<span class="op" id="4294526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294529">if</span>&nbsp;<span class="builtinfunc" id="4294532">len</span><span class="op" id="4294535">(</span><span class="ident" id="4294536">b</span><span class="op" id="4294537">)</span>&nbsp;<span class="op" id="4294539">&gt;</span>&nbsp;<span class="num" id="4294541">0xffff</span>&nbsp;<span class="op" id="4294548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294552">return</span>&nbsp;<span class="ident" id="4294559">errors</span><span class="op" id="4294565">.</span><span class="ident" id="4294566">New</span><span class="op" id="4294569">(</span><span class="string" id="4294570">&#34;gzip.Write:&nbsp;Extra&nbsp;data&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="4294607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294613">put2</span><span class="op" id="4294617">(</span><span class="ident" id="4294618">z</span><span class="op" id="4294619">.</span><span class="ident" id="4294620">buf</span><span class="op" id="4294623">[</span><span class="num" id="4294624">0</span><span class="op" id="4294625">:</span><span class="num" id="4294626">2</span><span class="op" id="4294627">]</span><span class="op" id="4294628">,</span>&nbsp;<span class="builtintype" id="4294630">uint16</span><span class="op" id="4294636">(</span><span class="builtinfunc" id="4294637">len</span><span class="op" id="4294640">(</span><span class="ident" id="4294641">b</span><span class="op" id="4294642">)</span><span class="op" id="4294643">)</span><span class="op" id="4294644">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294647">_</span><span class="op" id="4294648">,</span>&nbsp;<span class="ident" id="4294650">err</span>&nbsp;<span class="op" id="4294654">:=</span>&nbsp;<span class="ident" id="4294657">z</span><span class="op" id="4294658">.</span><span class="ident" id="4294659">w</span><span class="op" id="4294660">.</span><span class="ident" id="4294661">Write</span><span class="op" id="4294666">(</span><span class="ident" id="4294667">z</span><span class="op" id="4294668">.</span><span class="ident" id="4294669">buf</span><span class="op" id="4294672">[</span><span class="num" id="4294673">0</span><span class="op" id="4294674">:</span><span class="num" id="4294675">2</span><span class="op" id="4294676">]</span><span class="op" id="4294677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294680">if</span>&nbsp;<span class="ident" id="4294683">err</span>&nbsp;<span class="op" id="4294687">!=</span>&nbsp;<span class="ident" id="4294690">nil</span>&nbsp;<span class="op" id="4294694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294698">return</span>&nbsp;<span class="ident" id="4294705">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294713">_</span><span class="op" id="4294714">,</span>&nbsp;<span class="ident" id="4294716">err</span>&nbsp;<span class="op" id="4294720">=</span>&nbsp;<span class="ident" id="4294722">z</span><span class="op" id="4294723">.</span><span class="ident" id="4294724">w</span><span class="op" id="4294725">.</span><span class="ident" id="4294726">Write</span><span class="op" id="4294731">(</span><span class="ident" id="4294732">b</span><span class="op" id="4294733">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294736">return</span>&nbsp;<span class="ident" id="4294743">err</span><br>
<span class="lineno"></span><span class="op" id="4294747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4294750">//&nbsp;writeString&nbsp;writes&nbsp;a&nbsp;UTF-8&nbsp;string&nbsp;s&nbsp;in&nbsp;GZIP&#39;s&nbsp;format&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno"></span><span class="comment" id="4294814">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno">130</span><span class="keyword" id="4294897">func</span>&nbsp;<span class="op" id="4294902">(</span><span class="ident" id="4294903">z</span>&nbsp;<span class="op" id="4294905">*</span><span class="ident" id="4294906">Writer</span><span class="op" id="4294912">)</span>&nbsp;<span class="ident" id="4294914">writeString</span><span class="op" id="4294925">(</span><span class="ident" id="4294926">s</span>&nbsp;<span class="builtintype" id="4294928">string</span><span class="op" id="4294934">)</span>&nbsp;<span class="op" id="4294936">(</span><span class="ident" id="4294937">err</span>&nbsp;<span class="builtintype" id="4294941">error</span><span class="op" id="4294946">)</span>&nbsp;<span class="op" id="4294948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4294951">//&nbsp;GZIP&nbsp;stores&nbsp;Latin-1&nbsp;strings;&nbsp;error&nbsp;if&nbsp;non-Latin-1;&nbsp;convert&nbsp;if&nbsp;non-ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295028">needconv</span>&nbsp;<span class="op" id="4295037">:=</span>&nbsp;<span class="ident" id="4295040">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295047">for</span>&nbsp;<span class="ident" id="4295051">_</span><span class="op" id="4295052">,</span>&nbsp;<span class="ident" id="4295054">v</span>&nbsp;<span class="op" id="4295056">:=</span>&nbsp;<span class="keyword" id="4295059">range</span>&nbsp;<span class="ident" id="4295065">s</span>&nbsp;<span class="op" id="4295067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295071">if</span>&nbsp;<span class="ident" id="4295074">v</span>&nbsp;<span class="op" id="4295076">==</span>&nbsp;<span class="num" id="4295079">0</span>&nbsp;<span class="op" id="4295081">||</span>&nbsp;<span class="ident" id="4295084">v</span>&nbsp;<span class="op" id="4295086">&gt;</span>&nbsp;<span class="num" id="4295088">0xff</span>&nbsp;<span class="op" id="4295093">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295098">return</span>&nbsp;<span class="ident" id="4295105">errors</span><span class="op" id="4295111">.</span><span class="ident" id="4295112">New</span><span class="op" id="4295115">(</span><span class="string" id="4295116">&#34;gzip.Write:&nbsp;non-Latin-1&nbsp;header&nbsp;string&#34;</span><span class="op" id="4295155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295163">if</span>&nbsp;<span class="ident" id="4295166">v</span>&nbsp;<span class="op" id="4295168">&gt;</span>&nbsp;<span class="num" id="4295170">0x7f</span>&nbsp;<span class="op" id="4295175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295180">needconv</span>&nbsp;<span class="op" id="4295189">=</span>&nbsp;<span class="ident" id="4295191">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295198">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295204">if</span>&nbsp;<span class="ident" id="4295207">needconv</span>&nbsp;<span class="op" id="4295216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295220">b</span>&nbsp;<span class="op" id="4295222">:=</span>&nbsp;<span class="builtinfunc" id="4295225">make</span><span class="op" id="4295229">(</span><span class="op" id="4295230">[</span><span class="op" id="4295231">]</span><span class="builtintype" id="4295232">byte</span><span class="op" id="4295236">,</span>&nbsp;<span class="num" id="4295238">0</span><span class="op" id="4295239">,</span>&nbsp;<span class="builtinfunc" id="4295241">len</span><span class="op" id="4295244">(</span><span class="ident" id="4295245">s</span><span class="op" id="4295246">)</span><span class="op" id="4295247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295251">for</span>&nbsp;<span class="ident" id="4295255">_</span><span class="op" id="4295256">,</span>&nbsp;<span class="ident" id="4295258">v</span>&nbsp;<span class="op" id="4295260">:=</span>&nbsp;<span class="keyword" id="4295263">range</span>&nbsp;<span class="ident" id="4295269">s</span>&nbsp;<span class="op" id="4295271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295276">b</span>&nbsp;<span class="op" id="4295278">=</span>&nbsp;<span class="builtinfunc" id="4295280">append</span><span class="op" id="4295286">(</span><span class="ident" id="4295287">b</span><span class="op" id="4295288">,</span>&nbsp;<span class="builtintype" id="4295290">byte</span><span class="op" id="4295294">(</span><span class="ident" id="4295295">v</span><span class="op" id="4295296">)</span><span class="op" id="4295297">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295305">_</span><span class="op" id="4295306">,</span>&nbsp;<span class="ident" id="4295308">err</span>&nbsp;<span class="op" id="4295312">=</span>&nbsp;<span class="ident" id="4295314">z</span><span class="op" id="4295315">.</span><span class="ident" id="4295316">w</span><span class="op" id="4295317">.</span><span class="ident" id="4295318">Write</span><span class="op" id="4295323">(</span><span class="ident" id="4295324">b</span><span class="op" id="4295325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295328">}</span>&nbsp;<span class="keyword" id="4295330">else</span>&nbsp;<span class="op" id="4295335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295339">_</span><span class="op" id="4295340">,</span>&nbsp;<span class="ident" id="4295342">err</span>&nbsp;<span class="op" id="4295346">=</span>&nbsp;<span class="ident" id="4295348">io</span><span class="op" id="4295350">.</span><span class="ident" id="4295351">WriteString</span><span class="op" id="4295362">(</span><span class="ident" id="4295363">z</span><span class="op" id="4295364">.</span><span class="ident" id="4295365">w</span><span class="op" id="4295366">,</span>&nbsp;<span class="ident" id="4295368">s</span><span class="op" id="4295369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295372">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295375">if</span>&nbsp;<span class="ident" id="4295378">err</span>&nbsp;<span class="op" id="4295382">!=</span>&nbsp;<span class="ident" id="4295385">nil</span>&nbsp;<span class="op" id="4295389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295393">return</span>&nbsp;<span class="ident" id="4295400">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4295408">//&nbsp;GZIP&nbsp;strings&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295445">z</span><span class="op" id="4295446">.</span><span class="ident" id="4295447">buf</span><span class="op" id="4295450">[</span><span class="num" id="4295451">0</span><span class="op" id="4295452">]</span>&nbsp;<span class="op" id="4295454">=</span>&nbsp;<span class="num" id="4295456">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295459">_</span><span class="op" id="4295460">,</span>&nbsp;<span class="ident" id="4295462">err</span>&nbsp;<span class="op" id="4295466">=</span>&nbsp;<span class="ident" id="4295468">z</span><span class="op" id="4295469">.</span><span class="ident" id="4295470">w</span><span class="op" id="4295471">.</span><span class="ident" id="4295472">Write</span><span class="op" id="4295477">(</span><span class="ident" id="4295478">z</span><span class="op" id="4295479">.</span><span class="ident" id="4295480">buf</span><span class="op" id="4295483">[</span><span class="num" id="4295484">0</span><span class="op" id="4295485">:</span><span class="num" id="4295486">1</span><span class="op" id="4295487">]</span><span class="op" id="4295488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295491">return</span>&nbsp;<span class="ident" id="4295498">err</span><br>
<span class="lineno"></span><span class="op" id="4295502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4295505">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno">160</span><span class="comment" id="4295577">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4295653">func</span>&nbsp;<span class="op" id="4295658">(</span><span class="ident" id="4295659">z</span>&nbsp;<span class="op" id="4295661">*</span><span class="ident" id="4295662">Writer</span><span class="op" id="4295668">)</span>&nbsp;<span class="ident" id="4295670">Write</span><span class="op" id="4295675">(</span><span class="ident" id="4295676">p</span>&nbsp;<span class="op" id="4295678">[</span><span class="op" id="4295679">]</span><span class="builtintype" id="4295680">byte</span><span class="op" id="4295684">)</span>&nbsp;<span class="op" id="4295686">(</span><span class="builtintype" id="4295687">int</span><span class="op" id="4295690">,</span>&nbsp;<span class="builtintype" id="4295692">error</span><span class="op" id="4295697">)</span>&nbsp;<span class="op" id="4295699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295702">if</span>&nbsp;<span class="ident" id="4295705">z</span><span class="op" id="4295706">.</span><span class="ident" id="4295707">err</span>&nbsp;<span class="op" id="4295711">!=</span>&nbsp;<span class="ident" id="4295714">nil</span>&nbsp;<span class="op" id="4295718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295722">return</span>&nbsp;<span class="num" id="4295729">0</span><span class="op" id="4295730">,</span>&nbsp;<span class="ident" id="4295732">z</span><span class="op" id="4295733">.</span><span class="ident" id="4295734">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295739">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295742">var</span>&nbsp;<span class="ident" id="4295746">n</span>&nbsp;<span class="builtintype" id="4295748">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4295753">//&nbsp;Write&nbsp;the&nbsp;GZIP&nbsp;header&nbsp;lazily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295787">if</span>&nbsp;<span class="op" id="4295790">!</span><span class="ident" id="4295791">z</span><span class="op" id="4295792">.</span><span class="ident" id="4295793">wroteHeader</span>&nbsp;<span class="op" id="4295805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295809">z</span><span class="op" id="4295810">.</span><span class="ident" id="4295811">wroteHeader</span>&nbsp;<span class="op" id="4295823">=</span>&nbsp;<span class="ident" id="4295825">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295832">z</span><span class="op" id="4295833">.</span><span class="ident" id="4295834">buf</span><span class="op" id="4295837">[</span><span class="num" id="4295838">0</span><span class="op" id="4295839">]</span>&nbsp;<span class="op" id="4295841">=</span>&nbsp;<span class="ident" id="4295843">gzipID1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295853">z</span><span class="op" id="4295854">.</span><span class="ident" id="4295855">buf</span><span class="op" id="4295858">[</span><span class="num" id="4295859">1</span><span class="op" id="4295860">]</span>&nbsp;<span class="op" id="4295862">=</span>&nbsp;<span class="ident" id="4295864">gzipID2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295874">z</span><span class="op" id="4295875">.</span><span class="ident" id="4295876">buf</span><span class="op" id="4295879">[</span><span class="num" id="4295880">2</span><span class="op" id="4295881">]</span>&nbsp;<span class="op" id="4295883">=</span>&nbsp;<span class="ident" id="4295885">gzipDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295899">z</span><span class="op" id="4295900">.</span><span class="ident" id="4295901">buf</span><span class="op" id="4295904">[</span><span class="num" id="4295905">3</span><span class="op" id="4295906">]</span>&nbsp;<span class="op" id="4295908">=</span>&nbsp;<span class="num" id="4295910">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295914">if</span>&nbsp;<span class="ident" id="4295917">z</span><span class="op" id="4295918">.</span><span class="ident" id="4295919">Extra</span>&nbsp;<span class="op" id="4295925">!=</span>&nbsp;<span class="ident" id="4295928">nil</span>&nbsp;<span class="op" id="4295932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295937">z</span><span class="op" id="4295938">.</span><span class="ident" id="4295939">buf</span><span class="op" id="4295942">[</span><span class="num" id="4295943">3</span><span class="op" id="4295944">]</span>&nbsp;<span class="op" id="4295946">|=</span>&nbsp;<span class="num" id="4295949">0x04</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295960">if</span>&nbsp;<span class="ident" id="4295963">z</span><span class="op" id="4295964">.</span><span class="ident" id="4295965">Name</span>&nbsp;<span class="op" id="4295970">!=</span>&nbsp;<span class="string" id="4295973">&#34;&#34;</span>&nbsp;<span class="op" id="4295976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295981">z</span><span class="op" id="4295982">.</span><span class="ident" id="4295983">buf</span><span class="op" id="4295986">[</span><span class="num" id="4295987">3</span><span class="op" id="4295988">]</span>&nbsp;<span class="op" id="4295990">|=</span>&nbsp;<span class="num" id="4295993">0x08</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296004">if</span>&nbsp;<span class="ident" id="4296007">z</span><span class="op" id="4296008">.</span><span class="ident" id="4296009">Comment</span>&nbsp;<span class="op" id="4296017">!=</span>&nbsp;<span class="string" id="4296020">&#34;&#34;</span>&nbsp;<span class="op" id="4296023">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296028">z</span><span class="op" id="4296029">.</span><span class="ident" id="4296030">buf</span><span class="op" id="4296033">[</span><span class="num" id="4296034">3</span><span class="op" id="4296035">]</span>&nbsp;<span class="op" id="4296037">|=</span>&nbsp;<span class="num" id="4296040">0x10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296051">put4</span><span class="op" id="4296055">(</span><span class="ident" id="4296056">z</span><span class="op" id="4296057">.</span><span class="ident" id="4296058">buf</span><span class="op" id="4296061">[</span><span class="num" id="4296062">4</span><span class="op" id="4296063">:</span><span class="num" id="4296064">8</span><span class="op" id="4296065">]</span><span class="op" id="4296066">,</span>&nbsp;<span class="builtintype" id="4296068">uint32</span><span class="op" id="4296074">(</span><span class="ident" id="4296075">z</span><span class="op" id="4296076">.</span><span class="ident" id="4296077">ModTime</span><span class="op" id="4296084">.</span><span class="ident" id="4296085">Unix</span><span class="op" id="4296089">(</span><span class="op" id="4296090">)</span><span class="op" id="4296091">)</span><span class="op" id="4296092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296096">if</span>&nbsp;<span class="ident" id="4296099">z</span><span class="op" id="4296100">.</span><span class="ident" id="4296101">level</span>&nbsp;<span class="op" id="4296107">==</span>&nbsp;<span class="ident" id="4296110">BestCompression</span>&nbsp;<span class="op" id="4296126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296131">z</span><span class="op" id="4296132">.</span><span class="ident" id="4296133">buf</span><span class="op" id="4296136">[</span><span class="num" id="4296137">8</span><span class="op" id="4296138">]</span>&nbsp;<span class="op" id="4296140">=</span>&nbsp;<span class="num" id="4296142">2</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296146">}</span>&nbsp;<span class="keyword" id="4296148">else</span>&nbsp;<span class="keyword" id="4296153">if</span>&nbsp;<span class="ident" id="4296156">z</span><span class="op" id="4296157">.</span><span class="ident" id="4296158">level</span>&nbsp;<span class="op" id="4296164">==</span>&nbsp;<span class="ident" id="4296167">BestSpeed</span>&nbsp;<span class="op" id="4296177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296182">z</span><span class="op" id="4296183">.</span><span class="ident" id="4296184">buf</span><span class="op" id="4296187">[</span><span class="num" id="4296188">8</span><span class="op" id="4296189">]</span>&nbsp;<span class="op" id="4296191">=</span>&nbsp;<span class="num" id="4296193">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296197">}</span>&nbsp;<span class="keyword" id="4296199">else</span>&nbsp;<span class="op" id="4296204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296209">z</span><span class="op" id="4296210">.</span><span class="ident" id="4296211">buf</span><span class="op" id="4296214">[</span><span class="num" id="4296215">8</span><span class="op" id="4296216">]</span>&nbsp;<span class="op" id="4296218">=</span>&nbsp;<span class="num" id="4296220">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296224">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296228">z</span><span class="op" id="4296229">.</span><span class="ident" id="4296230">buf</span><span class="op" id="4296233">[</span><span class="num" id="4296234">9</span><span class="op" id="4296235">]</span>&nbsp;<span class="op" id="4296237">=</span>&nbsp;<span class="ident" id="4296239">z</span><span class="op" id="4296240">.</span><span class="ident" id="4296241">OS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296246">n</span><span class="op" id="4296247">,</span>&nbsp;<span class="ident" id="4296249">z</span><span class="op" id="4296250">.</span><span class="ident" id="4296251">err</span>&nbsp;<span class="op" id="4296255">=</span>&nbsp;<span class="ident" id="4296257">z</span><span class="op" id="4296258">.</span><span class="ident" id="4296259">w</span><span class="op" id="4296260">.</span><span class="ident" id="4296261">Write</span><span class="op" id="4296266">(</span><span class="ident" id="4296267">z</span><span class="op" id="4296268">.</span><span class="ident" id="4296269">buf</span><span class="op" id="4296272">[</span><span class="num" id="4296273">0</span><span class="op" id="4296274">:</span><span class="num" id="4296275">10</span><span class="op" id="4296277">]</span><span class="op" id="4296278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296282">if</span>&nbsp;<span class="ident" id="4296285">z</span><span class="op" id="4296286">.</span><span class="ident" id="4296287">err</span>&nbsp;<span class="op" id="4296291">!=</span>&nbsp;<span class="ident" id="4296294">nil</span>&nbsp;<span class="op" id="4296298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296303">return</span>&nbsp;<span class="ident" id="4296310">n</span><span class="op" id="4296311">,</span>&nbsp;<span class="ident" id="4296313">z</span><span class="op" id="4296314">.</span><span class="ident" id="4296315">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296321">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296325">if</span>&nbsp;<span class="ident" id="4296328">z</span><span class="op" id="4296329">.</span><span class="ident" id="4296330">Extra</span>&nbsp;<span class="op" id="4296336">!=</span>&nbsp;<span class="ident" id="4296339">nil</span>&nbsp;<span class="op" id="4296343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296348">z</span><span class="op" id="4296349">.</span><span class="ident" id="4296350">err</span>&nbsp;<span class="op" id="4296354">=</span>&nbsp;<span class="ident" id="4296356">z</span><span class="op" id="4296357">.</span><span class="ident" id="4296358">writeBytes</span><span class="op" id="4296368">(</span><span class="ident" id="4296369">z</span><span class="op" id="4296370">.</span><span class="ident" id="4296371">Extra</span><span class="op" id="4296376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296381">if</span>&nbsp;<span class="ident" id="4296384">z</span><span class="op" id="4296385">.</span><span class="ident" id="4296386">err</span>&nbsp;<span class="op" id="4296390">!=</span>&nbsp;<span class="ident" id="4296393">nil</span>&nbsp;<span class="op" id="4296397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296403">return</span>&nbsp;<span class="ident" id="4296410">n</span><span class="op" id="4296411">,</span>&nbsp;<span class="ident" id="4296413">z</span><span class="op" id="4296414">.</span><span class="ident" id="4296415">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296422">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296430">if</span>&nbsp;<span class="ident" id="4296433">z</span><span class="op" id="4296434">.</span><span class="ident" id="4296435">Name</span>&nbsp;<span class="op" id="4296440">!=</span>&nbsp;<span class="string" id="4296443">&#34;&#34;</span>&nbsp;<span class="op" id="4296446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296451">z</span><span class="op" id="4296452">.</span><span class="ident" id="4296453">err</span>&nbsp;<span class="op" id="4296457">=</span>&nbsp;<span class="ident" id="4296459">z</span><span class="op" id="4296460">.</span><span class="ident" id="4296461">writeString</span><span class="op" id="4296472">(</span><span class="ident" id="4296473">z</span><span class="op" id="4296474">.</span><span class="ident" id="4296475">Name</span><span class="op" id="4296479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296484">if</span>&nbsp;<span class="ident" id="4296487">z</span><span class="op" id="4296488">.</span><span class="ident" id="4296489">err</span>&nbsp;<span class="op" id="4296493">!=</span>&nbsp;<span class="ident" id="4296496">nil</span>&nbsp;<span class="op" id="4296500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296506">return</span>&nbsp;<span class="ident" id="4296513">n</span><span class="op" id="4296514">,</span>&nbsp;<span class="ident" id="4296516">z</span><span class="op" id="4296517">.</span><span class="ident" id="4296518">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296533">if</span>&nbsp;<span class="ident" id="4296536">z</span><span class="op" id="4296537">.</span><span class="ident" id="4296538">Comment</span>&nbsp;<span class="op" id="4296546">!=</span>&nbsp;<span class="string" id="4296549">&#34;&#34;</span>&nbsp;<span class="op" id="4296552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296557">z</span><span class="op" id="4296558">.</span><span class="ident" id="4296559">err</span>&nbsp;<span class="op" id="4296563">=</span>&nbsp;<span class="ident" id="4296565">z</span><span class="op" id="4296566">.</span><span class="ident" id="4296567">writeString</span><span class="op" id="4296578">(</span><span class="ident" id="4296579">z</span><span class="op" id="4296580">.</span><span class="ident" id="4296581">Comment</span><span class="op" id="4296588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296593">if</span>&nbsp;<span class="ident" id="4296596">z</span><span class="op" id="4296597">.</span><span class="ident" id="4296598">err</span>&nbsp;<span class="op" id="4296602">!=</span>&nbsp;<span class="ident" id="4296605">nil</span>&nbsp;<span class="op" id="4296609">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296615">return</span>&nbsp;<span class="ident" id="4296622">n</span><span class="op" id="4296623">,</span>&nbsp;<span class="ident" id="4296625">z</span><span class="op" id="4296626">.</span><span class="ident" id="4296627">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296642">if</span>&nbsp;<span class="ident" id="4296645">z</span><span class="op" id="4296646">.</span><span class="ident" id="4296647">compressor</span>&nbsp;<span class="op" id="4296658">==</span>&nbsp;<span class="ident" id="4296661">nil</span>&nbsp;<span class="op" id="4296665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296670">z</span><span class="op" id="4296671">.</span><span class="ident" id="4296672">compressor</span><span class="op" id="4296682">,</span>&nbsp;<span class="ident" id="4296684">_</span>&nbsp;<span class="op" id="4296686">=</span>&nbsp;<span class="ident" id="4296688">flate</span><span class="op" id="4296693">.</span><span class="ident" id="4296694">NewWriter</span><span class="op" id="4296703">(</span><span class="ident" id="4296704">z</span><span class="op" id="4296705">.</span><span class="ident" id="4296706">w</span><span class="op" id="4296707">,</span>&nbsp;<span class="ident" id="4296709">z</span><span class="op" id="4296710">.</span><span class="ident" id="4296711">level</span><span class="op" id="4296716">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296726">z</span><span class="op" id="4296727">.</span><span class="ident" id="4296728">size</span>&nbsp;<span class="op" id="4296733">+=</span>&nbsp;<span class="builtintype" id="4296736">uint32</span><span class="op" id="4296742">(</span><span class="builtinfunc" id="4296743">len</span><span class="op" id="4296746">(</span><span class="ident" id="4296747">p</span><span class="op" id="4296748">)</span><span class="op" id="4296749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296752">z</span><span class="op" id="4296753">.</span><span class="ident" id="4296754">digest</span><span class="op" id="4296760">.</span><span class="ident" id="4296761">Write</span><span class="op" id="4296766">(</span><span class="ident" id="4296767">p</span><span class="op" id="4296768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296771">n</span><span class="op" id="4296772">,</span>&nbsp;<span class="ident" id="4296774">z</span><span class="op" id="4296775">.</span><span class="ident" id="4296776">err</span>&nbsp;<span class="op" id="4296780">=</span>&nbsp;<span class="ident" id="4296782">z</span><span class="op" id="4296783">.</span><span class="ident" id="4296784">compressor</span><span class="op" id="4296794">.</span><span class="ident" id="4296795">Write</span><span class="op" id="4296800">(</span><span class="ident" id="4296801">p</span><span class="op" id="4296802">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296805">return</span>&nbsp;<span class="ident" id="4296812">n</span><span class="op" id="4296813">,</span>&nbsp;<span class="ident" id="4296815">z</span><span class="op" id="4296816">.</span><span class="ident" id="4296817">err</span><br>
<span class="lineno"></span><span class="op" id="4296821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4296824">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="4296895">//</span><br>
<span class="lineno">225</span><span class="comment" id="4296898">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4296969">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.&nbsp;Flush&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="4297040">//&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.&nbsp;If&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4297105">//&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4297159">//</span><br>
<span class="lineno">230</span><span class="comment" id="4297162">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="4297242">func</span>&nbsp;<span class="op" id="4297247">(</span><span class="ident" id="4297248">z</span>&nbsp;<span class="op" id="4297250">*</span><span class="ident" id="4297251">Writer</span><span class="op" id="4297257">)</span>&nbsp;<span class="ident" id="4297259">Flush</span><span class="op" id="4297264">(</span><span class="op" id="4297265">)</span>&nbsp;<span class="builtintype" id="4297267">error</span>&nbsp;<span class="op" id="4297273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297276">if</span>&nbsp;<span class="ident" id="4297279">z</span><span class="op" id="4297280">.</span><span class="ident" id="4297281">err</span>&nbsp;<span class="op" id="4297285">!=</span>&nbsp;<span class="ident" id="4297288">nil</span>&nbsp;<span class="op" id="4297292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297296">return</span>&nbsp;<span class="ident" id="4297303">z</span><span class="op" id="4297304">.</span><span class="ident" id="4297305">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297310">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297313">if</span>&nbsp;<span class="ident" id="4297316">z</span><span class="op" id="4297317">.</span><span class="ident" id="4297318">closed</span>&nbsp;<span class="op" id="4297325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297329">return</span>&nbsp;<span class="ident" id="4297336">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297344">if</span>&nbsp;<span class="op" id="4297347">!</span><span class="ident" id="4297348">z</span><span class="op" id="4297349">.</span><span class="ident" id="4297350">wroteHeader</span>&nbsp;<span class="op" id="4297362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297366">z</span><span class="op" id="4297367">.</span><span class="ident" id="4297368">Write</span><span class="op" id="4297373">(</span><span class="ident" id="4297374">nil</span><span class="op" id="4297377">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297381">if</span>&nbsp;<span class="ident" id="4297384">z</span><span class="op" id="4297385">.</span><span class="ident" id="4297386">err</span>&nbsp;<span class="op" id="4297390">!=</span>&nbsp;<span class="ident" id="4297393">nil</span>&nbsp;<span class="op" id="4297397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297402">return</span>&nbsp;<span class="ident" id="4297409">z</span><span class="op" id="4297410">.</span><span class="ident" id="4297411">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297423">z</span><span class="op" id="4297424">.</span><span class="ident" id="4297425">err</span>&nbsp;<span class="op" id="4297429">=</span>&nbsp;<span class="ident" id="4297431">z</span><span class="op" id="4297432">.</span><span class="ident" id="4297433">compressor</span><span class="op" id="4297443">.</span><span class="ident" id="4297444">Flush</span><span class="op" id="4297449">(</span><span class="op" id="4297450">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297453">return</span>&nbsp;<span class="ident" id="4297460">z</span><span class="op" id="4297461">.</span><span class="ident" id="4297462">err</span><br>
<span class="lineno"></span><span class="op" id="4297466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4297469">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4297543">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">250</span><span class="keyword" id="4297602">func</span>&nbsp;<span class="op" id="4297607">(</span><span class="ident" id="4297608">z</span>&nbsp;<span class="op" id="4297610">*</span><span class="ident" id="4297611">Writer</span><span class="op" id="4297617">)</span>&nbsp;<span class="ident" id="4297619">Close</span><span class="op" id="4297624">(</span><span class="op" id="4297625">)</span>&nbsp;<span class="builtintype" id="4297627">error</span>&nbsp;<span class="op" id="4297633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297636">if</span>&nbsp;<span class="ident" id="4297639">z</span><span class="op" id="4297640">.</span><span class="ident" id="4297641">err</span>&nbsp;<span class="op" id="4297645">!=</span>&nbsp;<span class="ident" id="4297648">nil</span>&nbsp;<span class="op" id="4297652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297656">return</span>&nbsp;<span class="ident" id="4297663">z</span><span class="op" id="4297664">.</span><span class="ident" id="4297665">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297673">if</span>&nbsp;<span class="ident" id="4297676">z</span><span class="op" id="4297677">.</span><span class="ident" id="4297678">closed</span>&nbsp;<span class="op" id="4297685">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297689">return</span>&nbsp;<span class="ident" id="4297696">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297704">z</span><span class="op" id="4297705">.</span><span class="ident" id="4297706">closed</span>&nbsp;<span class="op" id="4297713">=</span>&nbsp;<span class="ident" id="4297715">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297721">if</span>&nbsp;<span class="op" id="4297724">!</span><span class="ident" id="4297725">z</span><span class="op" id="4297726">.</span><span class="ident" id="4297727">wroteHeader</span>&nbsp;<span class="op" id="4297739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297743">z</span><span class="op" id="4297744">.</span><span class="ident" id="4297745">Write</span><span class="op" id="4297750">(</span><span class="ident" id="4297751">nil</span><span class="op" id="4297754">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297758">if</span>&nbsp;<span class="ident" id="4297761">z</span><span class="op" id="4297762">.</span><span class="ident" id="4297763">err</span>&nbsp;<span class="op" id="4297767">!=</span>&nbsp;<span class="ident" id="4297770">nil</span>&nbsp;<span class="op" id="4297774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297779">return</span>&nbsp;<span class="ident" id="4297786">z</span><span class="op" id="4297787">.</span><span class="ident" id="4297788">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297800">z</span><span class="op" id="4297801">.</span><span class="ident" id="4297802">err</span>&nbsp;<span class="op" id="4297806">=</span>&nbsp;<span class="ident" id="4297808">z</span><span class="op" id="4297809">.</span><span class="ident" id="4297810">compressor</span><span class="op" id="4297820">.</span><span class="ident" id="4297821">Close</span><span class="op" id="4297826">(</span><span class="op" id="4297827">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297830">if</span>&nbsp;<span class="ident" id="4297833">z</span><span class="op" id="4297834">.</span><span class="ident" id="4297835">err</span>&nbsp;<span class="op" id="4297839">!=</span>&nbsp;<span class="ident" id="4297842">nil</span>&nbsp;<span class="op" id="4297846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297850">return</span>&nbsp;<span class="ident" id="4297857">z</span><span class="op" id="4297858">.</span><span class="ident" id="4297859">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297867">put4</span><span class="op" id="4297871">(</span><span class="ident" id="4297872">z</span><span class="op" id="4297873">.</span><span class="ident" id="4297874">buf</span><span class="op" id="4297877">[</span><span class="num" id="4297878">0</span><span class="op" id="4297879">:</span><span class="num" id="4297880">4</span><span class="op" id="4297881">]</span><span class="op" id="4297882">,</span>&nbsp;<span class="ident" id="4297884">z</span><span class="op" id="4297885">.</span><span class="ident" id="4297886">digest</span><span class="op" id="4297892">.</span><span class="ident" id="4297893">Sum32</span><span class="op" id="4297898">(</span><span class="op" id="4297899">)</span><span class="op" id="4297900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297903">put4</span><span class="op" id="4297907">(</span><span class="ident" id="4297908">z</span><span class="op" id="4297909">.</span><span class="ident" id="4297910">buf</span><span class="op" id="4297913">[</span><span class="num" id="4297914">4</span><span class="op" id="4297915">:</span><span class="num" id="4297916">8</span><span class="op" id="4297917">]</span><span class="op" id="4297918">,</span>&nbsp;<span class="ident" id="4297920">z</span><span class="op" id="4297921">.</span><span class="ident" id="4297922">size</span><span class="op" id="4297926">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297929">_</span><span class="op" id="4297930">,</span>&nbsp;<span class="ident" id="4297932">z</span><span class="op" id="4297933">.</span><span class="ident" id="4297934">err</span>&nbsp;<span class="op" id="4297938">=</span>&nbsp;<span class="ident" id="4297940">z</span><span class="op" id="4297941">.</span><span class="ident" id="4297942">w</span><span class="op" id="4297943">.</span><span class="ident" id="4297944">Write</span><span class="op" id="4297949">(</span><span class="ident" id="4297950">z</span><span class="op" id="4297951">.</span><span class="ident" id="4297952">buf</span><span class="op" id="4297955">[</span><span class="num" id="4297956">0</span><span class="op" id="4297957">:</span><span class="num" id="4297958">8</span><span class="op" id="4297959">]</span><span class="op" id="4297960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297963">return</span>&nbsp;<span class="ident" id="4297970">z</span><span class="op" id="4297971">.</span><span class="ident" id="4297972">err</span><br>
<span class="lineno"></span><span class="op" id="4297976">}</span>
</div>
</body>
</html>
