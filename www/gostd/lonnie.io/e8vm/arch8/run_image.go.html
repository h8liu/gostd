<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5072511">package</span>&nbsp;<span class="ident" id="5072519">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5072526">import</span>&nbsp;<span class="op" id="5072533">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5072536">&#34;os&#34;</span><br>
<span class="lineno">5</span><span class="op" id="5072541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5072544">//&nbsp;RunImage&nbsp;loads&nbsp;and&nbsp;run&nbsp;a&nbsp;raw&nbsp;image&nbsp;on&nbsp;a&nbsp;single&nbsp;core&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="5072607">//&nbsp;with&nbsp;1GB&nbsp;physical&nbsp;memory&nbsp;until&nbsp;it&nbsp;runs&nbsp;into&nbsp;an&nbsp;exception.</span><br>
<span class="lineno"></span><span class="keyword" id="5072668">func</span>&nbsp;<span class="ident" id="5072673">RunImage</span><span class="op" id="5072681">(</span><span class="ident" id="5072682">path</span>&nbsp;<span class="builtintype" id="5072687">string</span><span class="op" id="5072693">)</span>&nbsp;<span class="builtintype" id="5072695">error</span>&nbsp;<span class="op" id="5072701">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072704">f</span><span class="op" id="5072705">,</span>&nbsp;<span class="ident" id="5072707">e</span>&nbsp;<span class="op" id="5072709">:=</span>&nbsp;<span class="ident" id="5072712">os</span><span class="op" id="5072714">.</span><span class="ident" id="5072715">Open</span><span class="op" id="5072719">(</span><span class="ident" id="5072720">path</span><span class="op" id="5072724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072727">if</span>&nbsp;<span class="ident" id="5072730">e</span>&nbsp;<span class="op" id="5072732">!=</span>&nbsp;<span class="ident" id="5072735">nil</span>&nbsp;<span class="op" id="5072739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072743">return</span>&nbsp;<span class="ident" id="5072750">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072757">m</span>&nbsp;<span class="op" id="5072759">:=</span>&nbsp;<span class="ident" id="5072762">NewMachine</span><span class="op" id="5072772">(</span><span class="builtintype" id="5072773">uint32</span><span class="op" id="5072779">(</span><span class="num" id="5072780">1</span><span class="op" id="5072781">&lt;&lt;</span><span class="num" id="5072783">30</span><span class="op" id="5072785">)</span><span class="op" id="5072786">,</span>&nbsp;<span class="num" id="5072788">1</span><span class="op" id="5072789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072792">e</span>&nbsp;<span class="op" id="5072794">=</span>&nbsp;<span class="ident" id="5072796">m</span><span class="op" id="5072797">.</span><span class="ident" id="5072798">LoadImage</span><span class="op" id="5072807">(</span><span class="ident" id="5072808">f</span><span class="op" id="5072809">,</span>&nbsp;<span class="ident" id="5072811">InitPC</span><span class="op" id="5072817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072820">if</span>&nbsp;<span class="ident" id="5072823">e</span>&nbsp;<span class="op" id="5072825">!=</span>&nbsp;<span class="ident" id="5072828">nil</span>&nbsp;<span class="op" id="5072832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072836">return</span>&nbsp;<span class="ident" id="5072843">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072846">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072850">_</span><span class="op" id="5072851">,</span>&nbsp;<span class="ident" id="5072853">exp</span>&nbsp;<span class="op" id="5072857">:=</span>&nbsp;<span class="ident" id="5072860">m</span><span class="op" id="5072861">.</span><span class="ident" id="5072862">Run</span><span class="op" id="5072865">(</span><span class="num" id="5072866">0</span><span class="op" id="5072867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072870">if</span>&nbsp;<span class="ident" id="5072873">exp</span>&nbsp;<span class="op" id="5072877">!=</span>&nbsp;<span class="ident" id="5072880">nil</span>&nbsp;<span class="op" id="5072884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072888">return</span>&nbsp;<span class="ident" id="5072895">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072900">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072904">return</span>&nbsp;<span class="ident" id="5072911">nil</span><br>
<span class="lineno"></span><span class="op" id="5072915">}</span>
</div>
</body>
</html>
