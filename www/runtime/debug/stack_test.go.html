<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6750984">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6751039">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6751093">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6751144">package</span>&nbsp;<span class="ident" id="6751152">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6751159">import</span>&nbsp;<span class="op" id="6751166">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6751169">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6751180">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="6751190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6751193">type</span>&nbsp;<span class="ident" id="6751198">T</span>&nbsp;<span class="builtintype" id="6751200">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6751205">func</span>&nbsp;<span class="op" id="6751210">(</span><span class="ident" id="6751211">t</span>&nbsp;<span class="op" id="6751213">*</span><span class="ident" id="6751214"><a href="/runtime/debug/stack_test.go.html#6751198">T</a></span><span class="op" id="6751215">)</span>&nbsp;<span class="ident" id="6751217">ptrmethod</span><span class="op" id="6751226">(</span><span class="op" id="6751227">)</span>&nbsp;<span class="op" id="6751229">[</span><span class="op" id="6751230">]</span><span class="builtintype" id="6751231">byte</span>&nbsp;<span class="op" id="6751236">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751239">return</span>&nbsp;<span class="ident" id="6751246"><a href="/runtime/debug/stack.go.html#6455926">Stack</a></span><span class="op" id="6751251">(</span><span class="op" id="6751252">)</span><br>
<span class="lineno"></span><span class="op" id="6751254">}</span><br>
<span class="lineno"></span><span class="keyword" id="6751256">func</span>&nbsp;<span class="op" id="6751261">(</span><span class="ident" id="6751262">t</span>&nbsp;<span class="ident" id="6751264"><a href="/runtime/debug/stack_test.go.html#6751198">T</a></span><span class="op" id="6751265">)</span>&nbsp;<span class="ident" id="6751267">method</span><span class="op" id="6751273">(</span><span class="op" id="6751274">)</span>&nbsp;<span class="op" id="6751276">[</span><span class="op" id="6751277">]</span><span class="builtintype" id="6751278">byte</span>&nbsp;<span class="op" id="6751283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751286">return</span>&nbsp;<span class="ident" id="6751293"><a href="/runtime/debug/stack_test.go.html#6751262">t</a></span><span class="op" id="6751294">.</span><span class="ident" id="6751295">ptrmethod</span><span class="op" id="6751304">(</span><span class="op" id="6751305">)</span><br>
<span class="lineno"></span><span class="op" id="6751307">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6751310">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;traceback&nbsp;should&nbsp;look&nbsp;something&nbsp;like&nbsp;this,&nbsp;modulo&nbsp;line&nbsp;numbers&nbsp;and&nbsp;hex&nbsp;constants.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspDon&#39;t&nbsp;worry&nbsp;much&nbsp;about&nbsp;the&nbsp;base&nbsp;levels,&nbsp;but&nbsp;check&nbsp;the&nbsp;ones&nbsp;in&nbsp;our&nbsp;own&nbsp;package.<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:15&nbsp;(0x13878)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(*T).ptrmethod:&nbsp;return&nbsp;Stack()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:18&nbsp;(0x138dd)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspT.method:&nbsp;return&nbsp;t.ptrmethod()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:23&nbsp;(0x13920)<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/testing/testing.go:132&nbsp;(0x14a7a)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptRunner:&nbsp;test.F(t)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/proc.c:145&nbsp;(0xc970)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp???:&nbsp;runtime·unlock(&amp;runtime·sched);<br>
<span class="lineno">35</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="6751923">func</span>&nbsp;<span class="ident" id="6751928">TestStack</span><span class="op" id="6751937">(</span><span class="ident" id="6751938">t</span>&nbsp;<span class="op" id="6751940">*</span><span class="ident" id="6751941"><a href="/runtime/debug/stack_test.go.html#6751180">testing</a></span><span class="op" id="6751948">.</span><span class="ident" id="6751949">T</span><span class="op" id="6751950">)</span>&nbsp;<span class="op" id="6751952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751955">b</span>&nbsp;<span class="op" id="6751957">:=</span>&nbsp;<span class="ident" id="6751960"><a href="/runtime/debug/stack_test.go.html#6751198">T</a></span><span class="op" id="6751961">(</span><span class="num" id="6751962">0</span><span class="op" id="6751963">)</span><span class="op" id="6751964">.</span><span class="ident" id="6751965">method</span><span class="op" id="6751971">(</span><span class="op" id="6751972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751975">lines</span>&nbsp;<span class="op" id="6751981">:=</span>&nbsp;<span class="ident" id="6751984"><a href="/runtime/debug/stack_test.go.html#6751169">strings</a></span><span class="op" id="6751991">.</span><span class="ident" id="6751992">Split</span><span class="op" id="6751997">(</span><span class="builtintype" id="6751998">string</span><span class="op" id="6752004">(</span><span class="ident" id="6752005"><a href="/runtime/debug/stack_test.go.html#6751955">b</a></span><span class="op" id="6752006">)</span><span class="op" id="6752007">,</span>&nbsp;<span class="string" id="6752009">&#34;\n&#34;</span><span class="op" id="6752013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752016">if</span>&nbsp;<span class="builtinfunc" id="6752019">len</span><span class="op" id="6752022">(</span><span class="ident" id="6752023"><a href="/runtime/debug/stack_test.go.html#6751975">lines</a></span><span class="op" id="6752028">)</span>&nbsp;<span class="op" id="6752030">&lt;</span>&nbsp;<span class="num" id="6752032">6</span>&nbsp;<span class="op" id="6752034">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752038"><a href="/runtime/debug/stack_test.go.html#6751938">t</a></span><span class="op" id="6752039">.</span><span class="ident" id="6752040">Fatal</span><span class="op" id="6752045">(</span><span class="string" id="6752046">&#34;too&nbsp;few&nbsp;lines&#34;</span><span class="op" id="6752061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752067">n</span>&nbsp;<span class="op" id="6752069">:=</span>&nbsp;<span class="num" id="6752072">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752075">frame</span>&nbsp;<span class="op" id="6752081">:=</span>&nbsp;<span class="keyword" id="6752084">func</span><span class="op" id="6752088">(</span><span class="ident" id="6752089">line</span><span class="op" id="6752093">,</span>&nbsp;<span class="ident" id="6752095">code</span>&nbsp;<span class="builtintype" id="6752100">string</span><span class="op" id="6752106">)</span>&nbsp;<span class="op" id="6752108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752112"><a href="/runtime/debug/stack_test.go.html#6752567">check</a></span><span class="op" id="6752117">(</span><span class="ident" id="6752118"><a href="/runtime/debug/stack_test.go.html#6751938">t</a></span><span class="op" id="6752119">,</span>&nbsp;<span class="ident" id="6752121"><a href="/runtime/debug/stack_test.go.html#6751975">lines</a></span><span class="op" id="6752126">[</span><span class="ident" id="6752127"><a href="/runtime/debug/stack_test.go.html#6752067">n</a></span><span class="op" id="6752128">]</span><span class="op" id="6752129">,</span>&nbsp;<span class="ident" id="6752131"><a href="/runtime/debug/stack_test.go.html#6752089">line</a></span><span class="op" id="6752135">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752139"><a href="/runtime/debug/stack_test.go.html#6752067">n</a></span><span class="op" id="6752140">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6752145">//&nbsp;The&nbsp;source&nbsp;might&nbsp;not&nbsp;be&nbsp;available&nbsp;while&nbsp;running&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752208">if</span>&nbsp;<span class="ident" id="6752211"><a href="/runtime/debug/stack_test.go.html#6751169">strings</a></span><span class="op" id="6752218">.</span><span class="ident" id="6752219">HasPrefix</span><span class="op" id="6752228">(</span><span class="ident" id="6752229"><a href="/runtime/debug/stack_test.go.html#6751975">lines</a></span><span class="op" id="6752234">[</span><span class="ident" id="6752235"><a href="/runtime/debug/stack_test.go.html#6752067">n</a></span><span class="op" id="6752236">]</span><span class="op" id="6752237">,</span>&nbsp;<span class="string" id="6752239">&#34;\t&#34;</span><span class="op" id="6752243">)</span>&nbsp;<span class="op" id="6752245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752250"><a href="/runtime/debug/stack_test.go.html#6752567">check</a></span><span class="op" id="6752255">(</span><span class="ident" id="6752256"><a href="/runtime/debug/stack_test.go.html#6751938">t</a></span><span class="op" id="6752257">,</span>&nbsp;<span class="ident" id="6752259"><a href="/runtime/debug/stack_test.go.html#6751975">lines</a></span><span class="op" id="6752264">[</span><span class="ident" id="6752265"><a href="/runtime/debug/stack_test.go.html#6752067">n</a></span><span class="op" id="6752266">]</span><span class="op" id="6752267">,</span>&nbsp;<span class="ident" id="6752269"><a href="/runtime/debug/stack_test.go.html#6752095">code</a></span><span class="op" id="6752273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752278"><a href="/runtime/debug/stack_test.go.html#6752067">n</a></span><span class="op" id="6752279">++</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752290"><a href="/runtime/debug/stack_test.go.html#6752075">frame</a></span><span class="op" id="6752295">(</span><span class="string" id="6752296">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="6752329">,</span>&nbsp;<span class="string" id="6752331">&#34;\t(*T).ptrmethod:&nbsp;return&nbsp;Stack()&#34;</span><span class="op" id="6752365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752368"><a href="/runtime/debug/stack_test.go.html#6752075">frame</a></span><span class="op" id="6752373">(</span><span class="string" id="6752374">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="6752407">,</span>&nbsp;<span class="string" id="6752409">&#34;\tT.method:&nbsp;return&nbsp;t.ptrmethod()&#34;</span><span class="op" id="6752443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752446"><a href="/runtime/debug/stack_test.go.html#6752075">frame</a></span><span class="op" id="6752451">(</span><span class="string" id="6752452">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="6752485">,</span>&nbsp;<span class="string" id="6752487">&#34;\tTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()&#34;</span><span class="op" id="6752520">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752523"><a href="/runtime/debug/stack_test.go.html#6752075">frame</a></span><span class="op" id="6752528">(</span><span class="string" id="6752529">&#34;src/testing/testing.go&#34;</span><span class="op" id="6752553">,</span>&nbsp;<span class="string" id="6752555">&#34;&#34;</span><span class="op" id="6752557">)</span><br>
<span class="lineno"></span><span class="op" id="6752559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6752562">func</span>&nbsp;<span class="ident" id="6752567">check</span><span class="op" id="6752572">(</span><span class="ident" id="6752573">t</span>&nbsp;<span class="op" id="6752575">*</span><span class="ident" id="6752576"><a href="/runtime/debug/stack_test.go.html#6751180">testing</a></span><span class="op" id="6752583">.</span><span class="ident" id="6752584">T</span><span class="op" id="6752585">,</span>&nbsp;<span class="ident" id="6752587">line</span><span class="op" id="6752591">,</span>&nbsp;<span class="ident" id="6752593">has</span>&nbsp;<span class="builtintype" id="6752597">string</span><span class="op" id="6752603">)</span>&nbsp;<span class="op" id="6752605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752608">if</span>&nbsp;<span class="ident" id="6752611"><a href="/runtime/debug/stack_test.go.html#6751169">strings</a></span><span class="op" id="6752618">.</span><span class="ident" id="6752619">Index</span><span class="op" id="6752624">(</span><span class="ident" id="6752625"><a href="/runtime/debug/stack_test.go.html#6752587">line</a></span><span class="op" id="6752629">,</span>&nbsp;<span class="ident" id="6752631"><a href="/runtime/debug/stack_test.go.html#6752593">has</a></span><span class="op" id="6752634">)</span>&nbsp;<span class="op" id="6752636">&lt;</span>&nbsp;<span class="num" id="6752638">0</span>&nbsp;<span class="op" id="6752640">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752644"><a href="/runtime/debug/stack_test.go.html#6752573">t</a></span><span class="op" id="6752645">.</span><span class="ident" id="6752646">Errorf</span><span class="op" id="6752652">(</span><span class="string" id="6752653">&#34;expected&nbsp;%q&nbsp;in&nbsp;%q&#34;</span><span class="op" id="6752672">,</span>&nbsp;<span class="ident" id="6752674"><a href="/runtime/debug/stack_test.go.html#6752593">has</a></span><span class="op" id="6752677">,</span>&nbsp;<span class="ident" id="6752679"><a href="/runtime/debug/stack_test.go.html#6752587">line</a></span><span class="op" id="6752683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752686">}</span><br>
<span class="lineno"></span><span class="op" id="6752688">}</span>
</div>
</body>
</html>
