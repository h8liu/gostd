<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="4880905">package</span>&nbsp;<span class="ident" id="4880913">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4880920">//&nbsp;PhyMemory&nbsp;is&nbsp;a&nbsp;collection&nbsp;of&nbsp;contiguous&nbsp;pages.</span><br>
<span class="lineno"></span><span class="keyword" id="4880970">type</span>&nbsp;<span class="ident" id="4880975">phyMemory</span>&nbsp;<span class="keyword" id="4880985">struct</span>&nbsp;<span class="op" id="4880992">{</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4880995">npage</span>&nbsp;<span class="builtintype" id="4881001">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881009">pages</span>&nbsp;<span class="keyword" id="4881015">map</span><span class="op" id="4881018">[</span><span class="builtintype" id="4881019">uint32</span><span class="op" id="4881025">]</span><span class="op" id="4881026">*</span><span class="ident" id="4881027">page</span><br>
<span class="lineno"></span><span class="op" id="4881032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4881035">const</span>&nbsp;<span class="op" id="4881041">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881044">pageVoid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4881058">=</span>&nbsp;<span class="num" id="4881060">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881063">pageInterrupt</span>&nbsp;<span class="op" id="4881077">=</span>&nbsp;<span class="num" id="4881079">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881082">pageBasicIO</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4881096">=</span>&nbsp;<span class="num" id="4881098">2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881102">pageBootImage</span>&nbsp;<span class="op" id="4881116">=</span>&nbsp;<span class="num" id="4881118">8</span><br>
<span class="lineno">15</span><span class="op" id="4881120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4881123">//&nbsp;NewPhyMemory&nbsp;creates&nbsp;a&nbsp;physical&nbsp;memory&nbsp;of&nbsp;size&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4881180">func</span>&nbsp;<span class="ident" id="4881185">newPhyMemory</span><span class="op" id="4881197">(</span><span class="ident" id="4881198">size</span>&nbsp;<span class="builtintype" id="4881203">uint32</span><span class="op" id="4881209">)</span>&nbsp;<span class="op" id="4881211">*</span><span class="ident" id="4881212">phyMemory</span>&nbsp;<span class="op" id="4881222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881225">if</span>&nbsp;<span class="ident" id="4881228">size</span><span class="op" id="4881232">%</span><span class="ident" id="4881233">PageSize</span>&nbsp;<span class="op" id="4881242">!=</span>&nbsp;<span class="num" id="4881245">0</span>&nbsp;<span class="op" id="4881247">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4881251">panic</span><span class="op" id="4881256">(</span><span class="string" id="4881257">&#34;size&nbsp;misaligned&#34;</span><span class="op" id="4881274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881281">ret</span>&nbsp;<span class="op" id="4881285">:=</span>&nbsp;<span class="builtinfunc" id="4881288">new</span><span class="op" id="4881291">(</span><span class="ident" id="4881292">phyMemory</span><span class="op" id="4881301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881304">ret</span><span class="op" id="4881307">.</span><span class="ident" id="4881308">pages</span>&nbsp;<span class="op" id="4881314">=</span>&nbsp;<span class="builtinfunc" id="4881316">make</span><span class="op" id="4881320">(</span><span class="keyword" id="4881321">map</span><span class="op" id="4881324">[</span><span class="builtintype" id="4881325">uint32</span><span class="op" id="4881331">]</span><span class="op" id="4881332">*</span><span class="ident" id="4881333">page</span><span class="op" id="4881337">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881340">ret</span><span class="op" id="4881343">.</span><span class="ident" id="4881344">npage</span>&nbsp;<span class="op" id="4881350">=</span>&nbsp;<span class="ident" id="4881352">size</span>&nbsp;<span class="op" id="4881357">/</span>&nbsp;<span class="ident" id="4881359">PageSize</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881370">return</span>&nbsp;<span class="ident" id="4881377">ret</span><br>
<span class="lineno"></span><span class="op" id="4881381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4881384">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;physical&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="4881433">func</span>&nbsp;<span class="op" id="4881438">(</span><span class="ident" id="4881439">pm</span>&nbsp;<span class="op" id="4881442">*</span><span class="ident" id="4881443">phyMemory</span><span class="op" id="4881452">)</span>&nbsp;<span class="ident" id="4881454">Size</span><span class="op" id="4881458">(</span><span class="op" id="4881459">)</span>&nbsp;<span class="builtintype" id="4881461">uint32</span>&nbsp;<span class="op" id="4881468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881471">return</span>&nbsp;<span class="ident" id="4881478">pm</span><span class="op" id="4881480">.</span><span class="ident" id="4881481">npage</span>&nbsp;<span class="op" id="4881487">*</span>&nbsp;<span class="ident" id="4881489">PageSize</span><br>
<span class="lineno"></span><span class="op" id="4881498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4881501">//&nbsp;Page&nbsp;returns&nbsp;the&nbsp;page&nbsp;for&nbsp;the&nbsp;particular&nbsp;page&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="4881557">//&nbsp;Returns&nbsp;nil&nbsp;when&nbsp;the&nbsp;page&nbsp;number&nbsp;is&nbsp;out&nbsp;of&nbsp;range</span><br>
<span class="lineno"></span><span class="keyword" id="4881609">func</span>&nbsp;<span class="op" id="4881614">(</span><span class="ident" id="4881615">pm</span>&nbsp;<span class="op" id="4881618">*</span><span class="ident" id="4881619">phyMemory</span><span class="op" id="4881628">)</span>&nbsp;<span class="ident" id="4881630">Page</span><span class="op" id="4881634">(</span><span class="ident" id="4881635">pn</span>&nbsp;<span class="builtintype" id="4881638">uint32</span><span class="op" id="4881644">)</span>&nbsp;<span class="op" id="4881646">*</span><span class="ident" id="4881647">page</span>&nbsp;<span class="op" id="4881652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881655">if</span>&nbsp;<span class="ident" id="4881658">pn</span>&nbsp;<span class="op" id="4881661">&gt;=</span>&nbsp;<span class="ident" id="4881664">pm</span><span class="op" id="4881666">.</span><span class="ident" id="4881667">npage</span>&nbsp;<span class="op" id="4881673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881677">return</span>&nbsp;<span class="ident" id="4881684">nil</span>&nbsp;<span class="comment" id="4881688">//&nbsp;out&nbsp;of&nbsp;range</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881709">ret</span><span class="op" id="4881712">,</span>&nbsp;<span class="ident" id="4881714">found</span>&nbsp;<span class="op" id="4881720">:=</span>&nbsp;<span class="ident" id="4881723">pm</span><span class="op" id="4881725">.</span><span class="ident" id="4881726">pages</span><span class="op" id="4881731">[</span><span class="ident" id="4881732">pn</span><span class="op" id="4881734">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881737">if</span>&nbsp;<span class="op" id="4881740">!</span><span class="ident" id="4881741">found</span>&nbsp;<span class="op" id="4881747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881751">//&nbsp;create&nbsp;an&nbsp;empty&nbsp;page&nbsp;on&nbsp;demand</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881787">ret</span>&nbsp;<span class="op" id="4881791">=</span>&nbsp;<span class="ident" id="4881793">newPage</span><span class="op" id="4881800">(</span><span class="op" id="4881801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881805">pm</span><span class="op" id="4881807">.</span><span class="ident" id="4881808">pages</span><span class="op" id="4881813">[</span><span class="ident" id="4881814">pn</span><span class="op" id="4881816">]</span>&nbsp;<span class="op" id="4881818">=</span>&nbsp;<span class="ident" id="4881820">ret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881829">return</span>&nbsp;<span class="ident" id="4881836">ret</span><br>
<span class="lineno">50</span><span class="op" id="4881840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4881843">func</span>&nbsp;<span class="op" id="4881848">(</span><span class="ident" id="4881849">pm</span>&nbsp;<span class="op" id="4881852">*</span><span class="ident" id="4881853">phyMemory</span><span class="op" id="4881862">)</span>&nbsp;<span class="ident" id="4881864">pageForByte</span><span class="op" id="4881875">(</span><span class="ident" id="4881876">addr</span>&nbsp;<span class="builtintype" id="4881881">uint32</span><span class="op" id="4881887">)</span>&nbsp;<span class="op" id="4881889">(</span><span class="op" id="4881890">*</span><span class="ident" id="4881891">page</span><span class="op" id="4881895">,</span>&nbsp;<span class="op" id="4881897">*</span><span class="ident" id="4881898">Excep</span><span class="op" id="4881903">)</span>&nbsp;<span class="op" id="4881905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881908">p</span>&nbsp;<span class="op" id="4881910">:=</span>&nbsp;<span class="ident" id="4881913">pm</span><span class="op" id="4881915">.</span><span class="ident" id="4881916">Page</span><span class="op" id="4881920">(</span><span class="ident" id="4881921">addr</span>&nbsp;<span class="op" id="4881926">/</span>&nbsp;<span class="ident" id="4881928">PageSize</span><span class="op" id="4881936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881939">if</span>&nbsp;<span class="ident" id="4881942">p</span>&nbsp;<span class="op" id="4881944">==</span>&nbsp;<span class="ident" id="4881947">nil</span>&nbsp;<span class="op" id="4881951">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881955">return</span>&nbsp;<span class="ident" id="4881962">nil</span><span class="op" id="4881965">,</span>&nbsp;<span class="ident" id="4881967">errOutOfRange</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881985">return</span>&nbsp;<span class="ident" id="4881992">p</span><span class="op" id="4881993">,</span>&nbsp;<span class="ident" id="4881995">nil</span><br>
<span class="lineno"></span><span class="op" id="4881999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="4882002">func</span>&nbsp;<span class="op" id="4882007">(</span><span class="ident" id="4882008">pm</span>&nbsp;<span class="op" id="4882011">*</span><span class="ident" id="4882012">phyMemory</span><span class="op" id="4882021">)</span>&nbsp;<span class="ident" id="4882023">pageForWord</span><span class="op" id="4882034">(</span><span class="ident" id="4882035">addr</span>&nbsp;<span class="builtintype" id="4882040">uint32</span><span class="op" id="4882046">)</span>&nbsp;<span class="op" id="4882048">(</span><span class="op" id="4882049">*</span><span class="ident" id="4882050">page</span><span class="op" id="4882054">,</span>&nbsp;<span class="op" id="4882056">*</span><span class="ident" id="4882057">Excep</span><span class="op" id="4882062">)</span>&nbsp;<span class="op" id="4882064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882067">if</span>&nbsp;<span class="ident" id="4882070">addr</span><span class="op" id="4882074">%</span><span class="num" id="4882075">4</span>&nbsp;<span class="op" id="4882077">!=</span>&nbsp;<span class="num" id="4882080">0</span>&nbsp;<span class="op" id="4882082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882086">return</span>&nbsp;<span class="ident" id="4882093">nil</span><span class="op" id="4882096">,</span>&nbsp;<span class="ident" id="4882098">errMisalign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4882111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882114">return</span>&nbsp;<span class="ident" id="4882121">pm</span><span class="op" id="4882123">.</span><span class="ident" id="4882124">pageForByte</span><span class="op" id="4882135">(</span><span class="ident" id="4882136">addr</span><span class="op" id="4882140">)</span><br>
<span class="lineno">65</span><span class="op" id="4882142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4882145">//&nbsp;ReadByte&nbsp;reads&nbsp;the&nbsp;byte&nbsp;at&nbsp;the&nbsp;given&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="4882194">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;out&nbsp;of&nbsp;range,&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="4882250">func</span>&nbsp;<span class="op" id="4882255">(</span><span class="ident" id="4882256">pm</span>&nbsp;<span class="op" id="4882259">*</span><span class="ident" id="4882260">phyMemory</span><span class="op" id="4882269">)</span>&nbsp;<span class="ident" id="4882271">ReadByte</span><span class="op" id="4882279">(</span><span class="ident" id="4882280">addr</span>&nbsp;<span class="builtintype" id="4882285">uint32</span><span class="op" id="4882291">)</span>&nbsp;<span class="op" id="4882293">(</span><span class="builtintype" id="4882294">byte</span><span class="op" id="4882298">,</span>&nbsp;<span class="op" id="4882300">*</span><span class="ident" id="4882301">Excep</span><span class="op" id="4882306">)</span>&nbsp;<span class="op" id="4882308">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882311">p</span><span class="op" id="4882312">,</span>&nbsp;<span class="ident" id="4882314">e</span>&nbsp;<span class="op" id="4882316">:=</span>&nbsp;<span class="ident" id="4882319">pm</span><span class="op" id="4882321">.</span><span class="ident" id="4882322">pageForByte</span><span class="op" id="4882333">(</span><span class="ident" id="4882334">addr</span><span class="op" id="4882338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882341">if</span>&nbsp;<span class="ident" id="4882344">e</span>&nbsp;<span class="op" id="4882346">!=</span>&nbsp;<span class="ident" id="4882349">nil</span>&nbsp;<span class="op" id="4882353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882357">return</span>&nbsp;<span class="num" id="4882364">0</span><span class="op" id="4882365">,</span>&nbsp;<span class="ident" id="4882367">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4882370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882373">return</span>&nbsp;<span class="ident" id="4882380">p</span><span class="op" id="4882381">.</span><span class="ident" id="4882382">ReadByte</span><span class="op" id="4882390">(</span><span class="ident" id="4882391">addr</span><span class="op" id="4882395">)</span><span class="op" id="4882396">,</span>&nbsp;<span class="ident" id="4882398">nil</span><br>
<span class="lineno">75</span><span class="op" id="4882402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4882405">//&nbsp;WriteByte&nbsp;writes&nbsp;the&nbsp;byte&nbsp;at&nbsp;the&nbsp;given&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="4882456">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;out&nbsp;of&nbsp;range,&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="4882512">func</span>&nbsp;<span class="op" id="4882517">(</span><span class="ident" id="4882518">pm</span>&nbsp;<span class="op" id="4882521">*</span><span class="ident" id="4882522">phyMemory</span><span class="op" id="4882531">)</span>&nbsp;<span class="ident" id="4882533">WriteByte</span><span class="op" id="4882542">(</span><span class="ident" id="4882543">addr</span>&nbsp;<span class="builtintype" id="4882548">uint32</span><span class="op" id="4882554">,</span>&nbsp;<span class="ident" id="4882556">v</span>&nbsp;<span class="builtintype" id="4882558">byte</span><span class="op" id="4882562">)</span>&nbsp;<span class="op" id="4882564">*</span><span class="ident" id="4882565">Excep</span>&nbsp;<span class="op" id="4882571">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882574">p</span><span class="op" id="4882575">,</span>&nbsp;<span class="ident" id="4882577">e</span>&nbsp;<span class="op" id="4882579">:=</span>&nbsp;<span class="ident" id="4882582">pm</span><span class="op" id="4882584">.</span><span class="ident" id="4882585">pageForByte</span><span class="op" id="4882596">(</span><span class="ident" id="4882597">addr</span><span class="op" id="4882601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882604">if</span>&nbsp;<span class="ident" id="4882607">e</span>&nbsp;<span class="op" id="4882609">!=</span>&nbsp;<span class="ident" id="4882612">nil</span>&nbsp;<span class="op" id="4882616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882620">return</span>&nbsp;<span class="ident" id="4882627">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4882630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882633">p</span><span class="op" id="4882634">.</span><span class="ident" id="4882635">WriteByte</span><span class="op" id="4882644">(</span><span class="ident" id="4882645">addr</span><span class="op" id="4882649">,</span>&nbsp;<span class="ident" id="4882651">v</span><span class="op" id="4882652">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882655">return</span>&nbsp;<span class="ident" id="4882662">e</span><br>
<span class="lineno"></span><span class="op" id="4882664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4882667">//&nbsp;ReadWord&nbsp;reads&nbsp;the&nbsp;byte&nbsp;at&nbsp;the&nbsp;given&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="4882716">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;not&nbsp;4-byte&nbsp;aligned,&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">90</span><span class="keyword" id="4882794">func</span>&nbsp;<span class="op" id="4882799">(</span><span class="ident" id="4882800">pm</span>&nbsp;<span class="op" id="4882803">*</span><span class="ident" id="4882804">phyMemory</span><span class="op" id="4882813">)</span>&nbsp;<span class="ident" id="4882815">ReadWord</span><span class="op" id="4882823">(</span><span class="ident" id="4882824">addr</span>&nbsp;<span class="builtintype" id="4882829">uint32</span><span class="op" id="4882835">)</span>&nbsp;<span class="op" id="4882837">(</span><span class="builtintype" id="4882838">uint32</span><span class="op" id="4882844">,</span>&nbsp;<span class="op" id="4882846">*</span><span class="ident" id="4882847">Excep</span><span class="op" id="4882852">)</span>&nbsp;<span class="op" id="4882854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882857">p</span><span class="op" id="4882858">,</span>&nbsp;<span class="ident" id="4882860">e</span>&nbsp;<span class="op" id="4882862">:=</span>&nbsp;<span class="ident" id="4882865">pm</span><span class="op" id="4882867">.</span><span class="ident" id="4882868">pageForWord</span><span class="op" id="4882879">(</span><span class="ident" id="4882880">addr</span><span class="op" id="4882884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882887">if</span>&nbsp;<span class="ident" id="4882890">e</span>&nbsp;<span class="op" id="4882892">!=</span>&nbsp;<span class="ident" id="4882895">nil</span>&nbsp;<span class="op" id="4882899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882903">return</span>&nbsp;<span class="num" id="4882910">0</span><span class="op" id="4882911">,</span>&nbsp;<span class="ident" id="4882913">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4882916">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882919">return</span>&nbsp;<span class="ident" id="4882926">p</span><span class="op" id="4882927">.</span><span class="ident" id="4882928">ReadWord</span><span class="op" id="4882936">(</span><span class="ident" id="4882937">addr</span><span class="op" id="4882941">)</span><span class="op" id="4882942">,</span>&nbsp;<span class="ident" id="4882944">nil</span><br>
<span class="lineno"></span><span class="op" id="4882948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4882951">//&nbsp;WriteWord&nbsp;reads&nbsp;the&nbsp;byte&nbsp;at&nbsp;the&nbsp;given&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="4883001">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;not&nbsp;4-byte&nbsp;aligned,&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">100</span><span class="keyword" id="4883079">func</span>&nbsp;<span class="op" id="4883084">(</span><span class="ident" id="4883085">pm</span>&nbsp;<span class="op" id="4883088">*</span><span class="ident" id="4883089">phyMemory</span><span class="op" id="4883098">)</span>&nbsp;<span class="ident" id="4883100">WriteWord</span><span class="op" id="4883109">(</span><span class="ident" id="4883110">addr</span>&nbsp;<span class="builtintype" id="4883115">uint32</span><span class="op" id="4883121">,</span>&nbsp;<span class="ident" id="4883123">v</span>&nbsp;<span class="builtintype" id="4883125">uint32</span><span class="op" id="4883131">)</span>&nbsp;<span class="op" id="4883133">*</span><span class="ident" id="4883134">Excep</span>&nbsp;<span class="op" id="4883140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883143">p</span><span class="op" id="4883144">,</span>&nbsp;<span class="ident" id="4883146">e</span>&nbsp;<span class="op" id="4883148">:=</span>&nbsp;<span class="ident" id="4883151">pm</span><span class="op" id="4883153">.</span><span class="ident" id="4883154">pageForWord</span><span class="op" id="4883165">(</span><span class="ident" id="4883166">addr</span><span class="op" id="4883170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883173">if</span>&nbsp;<span class="ident" id="4883176">e</span>&nbsp;<span class="op" id="4883178">!=</span>&nbsp;<span class="ident" id="4883181">nil</span>&nbsp;<span class="op" id="4883185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883189">return</span>&nbsp;<span class="ident" id="4883196">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4883199">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883202">p</span><span class="op" id="4883203">.</span><span class="ident" id="4883204">WriteWord</span><span class="op" id="4883213">(</span><span class="ident" id="4883214">addr</span><span class="op" id="4883218">,</span>&nbsp;<span class="ident" id="4883220">v</span><span class="op" id="4883221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883224">return</span>&nbsp;<span class="ident" id="4883231">nil</span><br>
<span class="lineno"></span><span class="op" id="4883235">}</span>
</div>
</body>
</html>
