<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7021332">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7021388">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7021442">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7021493">//&nbsp;Export&nbsp;guts&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7021522">package</span>&nbsp;<span class="ident" id="7021530">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7021539">import</span>&nbsp;<span class="string" id="7021546">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="7021556">var</span>&nbsp;<span class="ident" id="7021560">Fadd64</span>&nbsp;<span class="op" id="7021567">=</span>&nbsp;<span class="ident" id="7021569">fadd64</span><br>
<span class="lineno"></span><span class="keyword" id="7021576">var</span>&nbsp;<span class="ident" id="7021580">Fsub64</span>&nbsp;<span class="op" id="7021587">=</span>&nbsp;<span class="ident" id="7021589">fsub64</span><br>
<span class="lineno"></span><span class="keyword" id="7021596">var</span>&nbsp;<span class="ident" id="7021600">Fmul64</span>&nbsp;<span class="op" id="7021607">=</span>&nbsp;<span class="ident" id="7021609">fmul64</span><br>
<span class="lineno"></span><span class="keyword" id="7021616">var</span>&nbsp;<span class="ident" id="7021620">Fdiv64</span>&nbsp;<span class="op" id="7021627">=</span>&nbsp;<span class="ident" id="7021629">fdiv64</span><br>
<span class="lineno">15</span><span class="keyword" id="7021636">var</span>&nbsp;<span class="ident" id="7021640">F64to32</span>&nbsp;<span class="op" id="7021648">=</span>&nbsp;<span class="ident" id="7021650">f64to32</span><br>
<span class="lineno"></span><span class="keyword" id="7021658">var</span>&nbsp;<span class="ident" id="7021662">F32to64</span>&nbsp;<span class="op" id="7021670">=</span>&nbsp;<span class="ident" id="7021672">f32to64</span><br>
<span class="lineno"></span><span class="keyword" id="7021680">var</span>&nbsp;<span class="ident" id="7021684">Fcmp64</span>&nbsp;<span class="op" id="7021691">=</span>&nbsp;<span class="ident" id="7021693">fcmp64</span><br>
<span class="lineno"></span><span class="keyword" id="7021700">var</span>&nbsp;<span class="ident" id="7021704">Fintto64</span>&nbsp;<span class="op" id="7021713">=</span>&nbsp;<span class="ident" id="7021715">fintto64</span><br>
<span class="lineno"></span><span class="keyword" id="7021724">var</span>&nbsp;<span class="ident" id="7021728">F64toint</span>&nbsp;<span class="op" id="7021737">=</span>&nbsp;<span class="ident" id="7021739">f64toint</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="7021749">//&nbsp;in&nbsp;asm_*.s</span><br>
<span class="lineno"></span><span class="keyword" id="7021763">func</span>&nbsp;<span class="ident" id="7021768">stackguard</span><span class="op" id="7021778">(</span><span class="op" id="7021779">)</span>&nbsp;<span class="op" id="7021781">(</span><span class="ident" id="7021782">sp</span><span class="op" id="7021784">,</span>&nbsp;<span class="ident" id="7021786">limit</span>&nbsp;<span class="builtintype" id="7021792">uintptr</span><span class="op" id="7021799">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7021802">var</span>&nbsp;<span class="ident" id="7021806">Entersyscall</span>&nbsp;<span class="op" id="7021819">=</span>&nbsp;<span class="ident" id="7021821">entersyscall</span><br>
<span class="lineno">25</span><span class="keyword" id="7021834">var</span>&nbsp;<span class="ident" id="7021838">Exitsyscall</span>&nbsp;<span class="op" id="7021850">=</span>&nbsp;<span class="ident" id="7021852">exitsyscall</span><br>
<span class="lineno"></span><span class="keyword" id="7021864">var</span>&nbsp;<span class="ident" id="7021868">LockedOSThread</span>&nbsp;<span class="op" id="7021883">=</span>&nbsp;<span class="ident" id="7021885">lockedOSThread</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7021901">type</span>&nbsp;<span class="ident" id="7021906">LFNode</span>&nbsp;<span class="keyword" id="7021913">struct</span>&nbsp;<span class="op" id="7021920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021923">Next</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7021931">*</span><span class="ident" id="7021932">LFNode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021940">Pushcnt</span>&nbsp;<span class="builtintype" id="7021948">uintptr</span><br>
<span class="lineno"></span><span class="op" id="7021956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7021959">func</span>&nbsp;<span class="ident" id="7021964">lfstackpush_m</span><span class="op" id="7021977">(</span><span class="op" id="7021978">)</span><br>
<span class="lineno"></span><span class="keyword" id="7021980">func</span>&nbsp;<span class="ident" id="7021985">lfstackpop_m</span><span class="op" id="7021997">(</span><span class="op" id="7021998">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="7022001">func</span>&nbsp;<span class="ident" id="7022006">LFStackPush</span><span class="op" id="7022017">(</span><span class="ident" id="7022018">head</span>&nbsp;<span class="op" id="7022023">*</span><span class="ident" id="7022024">uint64</span><span class="op" id="7022030">,</span>&nbsp;<span class="ident" id="7022032">node</span>&nbsp;<span class="op" id="7022037">*</span><span class="ident" id="7022038">LFNode</span><span class="op" id="7022044">)</span>&nbsp;<span class="op" id="7022046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022049">mp</span>&nbsp;<span class="op" id="7022052">:=</span>&nbsp;<span class="ident" id="7022055">acquirem</span><span class="op" id="7022063">(</span><span class="op" id="7022064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022067">mp</span><span class="op" id="7022069">.</span><span class="ident" id="7022070">ptrarg</span><span class="op" id="7022076">[</span><span class="num" id="7022077">0</span><span class="op" id="7022078">]</span>&nbsp;<span class="op" id="7022080">=</span>&nbsp;<span class="ident" id="7022082">unsafe</span><span class="op" id="7022088">.</span><span class="ident" id="7022089">Pointer</span><span class="op" id="7022096">(</span><span class="ident" id="7022097">head</span><span class="op" id="7022101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022104">mp</span><span class="op" id="7022106">.</span><span class="ident" id="7022107">ptrarg</span><span class="op" id="7022113">[</span><span class="num" id="7022114">1</span><span class="op" id="7022115">]</span>&nbsp;<span class="op" id="7022117">=</span>&nbsp;<span class="ident" id="7022119">unsafe</span><span class="op" id="7022125">.</span><span class="ident" id="7022126">Pointer</span><span class="op" id="7022133">(</span><span class="ident" id="7022134">node</span><span class="op" id="7022138">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022141">onM</span><span class="op" id="7022144">(</span><span class="ident" id="7022145">lfstackpush_m</span><span class="op" id="7022158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022161">releasem</span><span class="op" id="7022169">(</span><span class="ident" id="7022170">mp</span><span class="op" id="7022172">)</span><br>
<span class="lineno"></span><span class="op" id="7022174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7022177">func</span>&nbsp;<span class="ident" id="7022182">LFStackPop</span><span class="op" id="7022192">(</span><span class="ident" id="7022193">head</span>&nbsp;<span class="op" id="7022198">*</span><span class="ident" id="7022199">uint64</span><span class="op" id="7022205">)</span>&nbsp;<span class="op" id="7022207">*</span><span class="ident" id="7022208">LFNode</span>&nbsp;<span class="op" id="7022215">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022218">mp</span>&nbsp;<span class="op" id="7022221">:=</span>&nbsp;<span class="ident" id="7022224">acquirem</span><span class="op" id="7022232">(</span><span class="op" id="7022233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022236">mp</span><span class="op" id="7022238">.</span><span class="ident" id="7022239">ptrarg</span><span class="op" id="7022245">[</span><span class="num" id="7022246">0</span><span class="op" id="7022247">]</span>&nbsp;<span class="op" id="7022249">=</span>&nbsp;<span class="ident" id="7022251">unsafe</span><span class="op" id="7022257">.</span><span class="ident" id="7022258">Pointer</span><span class="op" id="7022265">(</span><span class="ident" id="7022266">head</span><span class="op" id="7022270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022273">onM</span><span class="op" id="7022276">(</span><span class="ident" id="7022277">lfstackpop_m</span><span class="op" id="7022289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022292">node</span>&nbsp;<span class="op" id="7022297">:=</span>&nbsp;<span class="op" id="7022300">(</span><span class="op" id="7022301">*</span><span class="ident" id="7022302">LFNode</span><span class="op" id="7022308">)</span><span class="op" id="7022309">(</span><span class="ident" id="7022310">unsafe</span><span class="op" id="7022316">.</span><span class="ident" id="7022317">Pointer</span><span class="op" id="7022324">(</span><span class="ident" id="7022325">mp</span><span class="op" id="7022327">.</span><span class="ident" id="7022328">ptrarg</span><span class="op" id="7022334">[</span><span class="num" id="7022335">0</span><span class="op" id="7022336">]</span><span class="op" id="7022337">)</span><span class="op" id="7022338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022341">mp</span><span class="op" id="7022343">.</span><span class="ident" id="7022344">ptrarg</span><span class="op" id="7022350">[</span><span class="num" id="7022351">0</span><span class="op" id="7022352">]</span>&nbsp;<span class="op" id="7022354">=</span>&nbsp;<span class="ident" id="7022356">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022361">releasem</span><span class="op" id="7022369">(</span><span class="ident" id="7022370">mp</span><span class="op" id="7022372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022375">return</span>&nbsp;<span class="ident" id="7022382">node</span><br>
<span class="lineno"></span><span class="op" id="7022387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7022390">type</span>&nbsp;<span class="ident" id="7022395">ParFor</span>&nbsp;<span class="keyword" id="7022402">struct</span>&nbsp;<span class="op" id="7022409">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022412">body</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7022420">*</span><span class="builtintype" id="7022421">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022427">done</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7022435">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022443">Nthr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7022451">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022459">nthrmax</span>&nbsp;<span class="builtintype" id="7022467">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022475">thrseq</span>&nbsp;&nbsp;<span class="builtintype" id="7022483">uint32</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022491">Cnt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7022499">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022507">Ctx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7022515">*</span><span class="builtintype" id="7022516">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022522">wait</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7022530">bool</span><br>
<span class="lineno"></span><span class="op" id="7022535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7022538">func</span>&nbsp;<span class="ident" id="7022543">newparfor_m</span><span class="op" id="7022554">(</span><span class="op" id="7022555">)</span><br>
<span class="lineno"></span><span class="keyword" id="7022557">func</span>&nbsp;<span class="ident" id="7022562">parforsetup_m</span><span class="op" id="7022575">(</span><span class="op" id="7022576">)</span><br>
<span class="lineno"></span><span class="keyword" id="7022578">func</span>&nbsp;<span class="ident" id="7022583">parfordo_m</span><span class="op" id="7022593">(</span><span class="op" id="7022594">)</span><br>
<span class="lineno"></span><span class="keyword" id="7022596">func</span>&nbsp;<span class="ident" id="7022601">parforiters_m</span><span class="op" id="7022614">(</span><span class="op" id="7022615">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7022618">func</span>&nbsp;<span class="ident" id="7022623">NewParFor</span><span class="op" id="7022632">(</span><span class="ident" id="7022633">nthrmax</span>&nbsp;<span class="builtintype" id="7022641">uint32</span><span class="op" id="7022647">)</span>&nbsp;<span class="op" id="7022649">*</span><span class="ident" id="7022650">ParFor</span>&nbsp;<span class="op" id="7022657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022660">mp</span>&nbsp;<span class="op" id="7022663">:=</span>&nbsp;<span class="ident" id="7022666">acquirem</span><span class="op" id="7022674">(</span><span class="op" id="7022675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022678">mp</span><span class="op" id="7022680">.</span><span class="ident" id="7022681">scalararg</span><span class="op" id="7022690">[</span><span class="num" id="7022691">0</span><span class="op" id="7022692">]</span>&nbsp;<span class="op" id="7022694">=</span>&nbsp;<span class="builtintype" id="7022696">uintptr</span><span class="op" id="7022703">(</span><span class="ident" id="7022704">nthrmax</span><span class="op" id="7022711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022714">onM</span><span class="op" id="7022717">(</span><span class="ident" id="7022718">newparfor_m</span><span class="op" id="7022729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022732">desc</span>&nbsp;<span class="op" id="7022737">:=</span>&nbsp;<span class="op" id="7022740">(</span><span class="op" id="7022741">*</span><span class="ident" id="7022742">ParFor</span><span class="op" id="7022748">)</span><span class="op" id="7022749">(</span><span class="ident" id="7022750">mp</span><span class="op" id="7022752">.</span><span class="ident" id="7022753">ptrarg</span><span class="op" id="7022759">[</span><span class="num" id="7022760">0</span><span class="op" id="7022761">]</span><span class="op" id="7022762">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022765">mp</span><span class="op" id="7022767">.</span><span class="ident" id="7022768">ptrarg</span><span class="op" id="7022774">[</span><span class="num" id="7022775">0</span><span class="op" id="7022776">]</span>&nbsp;<span class="op" id="7022778">=</span>&nbsp;<span class="ident" id="7022780">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022785">releasem</span><span class="op" id="7022793">(</span><span class="ident" id="7022794">mp</span><span class="op" id="7022796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022799">return</span>&nbsp;<span class="ident" id="7022806">desc</span><br>
<span class="lineno"></span><span class="op" id="7022811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7022814">func</span>&nbsp;<span class="ident" id="7022819">ParForSetup</span><span class="op" id="7022830">(</span><span class="ident" id="7022831">desc</span>&nbsp;<span class="op" id="7022836">*</span><span class="ident" id="7022837">ParFor</span><span class="op" id="7022843">,</span>&nbsp;<span class="ident" id="7022845">nthr</span><span class="op" id="7022849">,</span>&nbsp;<span class="ident" id="7022851">n</span>&nbsp;<span class="builtintype" id="7022853">uint32</span><span class="op" id="7022859">,</span>&nbsp;<span class="ident" id="7022861">ctx</span>&nbsp;<span class="op" id="7022865">*</span><span class="builtintype" id="7022866">byte</span><span class="op" id="7022870">,</span>&nbsp;<span class="ident" id="7022872">wait</span>&nbsp;<span class="builtintype" id="7022877">bool</span><span class="op" id="7022881">,</span>&nbsp;<span class="ident" id="7022883">body</span>&nbsp;<span class="keyword" id="7022888">func</span><span class="op" id="7022892">(</span><span class="op" id="7022893">*</span><span class="ident" id="7022894">ParFor</span><span class="op" id="7022900">,</span>&nbsp;<span class="builtintype" id="7022902">uint32</span><span class="op" id="7022908">)</span><span class="op" id="7022909">)</span>&nbsp;<span class="op" id="7022911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022914">mp</span>&nbsp;<span class="op" id="7022917">:=</span>&nbsp;<span class="ident" id="7022920">acquirem</span><span class="op" id="7022928">(</span><span class="op" id="7022929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022932">mp</span><span class="op" id="7022934">.</span><span class="ident" id="7022935">ptrarg</span><span class="op" id="7022941">[</span><span class="num" id="7022942">0</span><span class="op" id="7022943">]</span>&nbsp;<span class="op" id="7022945">=</span>&nbsp;<span class="ident" id="7022947">unsafe</span><span class="op" id="7022953">.</span><span class="ident" id="7022954">Pointer</span><span class="op" id="7022961">(</span><span class="ident" id="7022962">desc</span><span class="op" id="7022966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022969">mp</span><span class="op" id="7022971">.</span><span class="ident" id="7022972">ptrarg</span><span class="op" id="7022978">[</span><span class="num" id="7022979">1</span><span class="op" id="7022980">]</span>&nbsp;<span class="op" id="7022982">=</span>&nbsp;<span class="ident" id="7022984">unsafe</span><span class="op" id="7022990">.</span><span class="ident" id="7022991">Pointer</span><span class="op" id="7022998">(</span><span class="ident" id="7022999">ctx</span><span class="op" id="7023002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023005">mp</span><span class="op" id="7023007">.</span><span class="ident" id="7023008">ptrarg</span><span class="op" id="7023014">[</span><span class="num" id="7023015">2</span><span class="op" id="7023016">]</span>&nbsp;<span class="op" id="7023018">=</span>&nbsp;<span class="ident" id="7023020">unsafe</span><span class="op" id="7023026">.</span><span class="ident" id="7023027">Pointer</span><span class="op" id="7023034">(</span><span class="ident" id="7023035">funcPC</span><span class="op" id="7023041">(</span><span class="ident" id="7023042">body</span><span class="op" id="7023046">)</span><span class="op" id="7023047">)</span>&nbsp;<span class="comment" id="7023049">//&nbsp;TODO(rsc):&nbsp;Should&nbsp;be&nbsp;a&nbsp;scalar.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023084">mp</span><span class="op" id="7023086">.</span><span class="ident" id="7023087">scalararg</span><span class="op" id="7023096">[</span><span class="num" id="7023097">0</span><span class="op" id="7023098">]</span>&nbsp;<span class="op" id="7023100">=</span>&nbsp;<span class="builtintype" id="7023102">uintptr</span><span class="op" id="7023109">(</span><span class="ident" id="7023110">nthr</span><span class="op" id="7023114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023117">mp</span><span class="op" id="7023119">.</span><span class="ident" id="7023120">scalararg</span><span class="op" id="7023129">[</span><span class="num" id="7023130">1</span><span class="op" id="7023131">]</span>&nbsp;<span class="op" id="7023133">=</span>&nbsp;<span class="builtintype" id="7023135">uintptr</span><span class="op" id="7023142">(</span><span class="ident" id="7023143">n</span><span class="op" id="7023144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023147">mp</span><span class="op" id="7023149">.</span><span class="ident" id="7023150">scalararg</span><span class="op" id="7023159">[</span><span class="num" id="7023160">2</span><span class="op" id="7023161">]</span>&nbsp;<span class="op" id="7023163">=</span>&nbsp;<span class="num" id="7023165">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023168">if</span>&nbsp;<span class="ident" id="7023171">wait</span>&nbsp;<span class="op" id="7023176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023180">mp</span><span class="op" id="7023182">.</span><span class="ident" id="7023183">scalararg</span><span class="op" id="7023192">[</span><span class="num" id="7023193">2</span><span class="op" id="7023194">]</span>&nbsp;<span class="op" id="7023196">=</span>&nbsp;<span class="num" id="7023198">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7023201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023204">onM</span><span class="op" id="7023207">(</span><span class="ident" id="7023208">parforsetup_m</span><span class="op" id="7023221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023224">releasem</span><span class="op" id="7023232">(</span><span class="ident" id="7023233">mp</span><span class="op" id="7023235">)</span><br>
<span class="lineno"></span><span class="op" id="7023237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7023240">func</span>&nbsp;<span class="ident" id="7023245">ParForDo</span><span class="op" id="7023253">(</span><span class="ident" id="7023254">desc</span>&nbsp;<span class="op" id="7023259">*</span><span class="ident" id="7023260">ParFor</span><span class="op" id="7023266">)</span>&nbsp;<span class="op" id="7023268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023271">mp</span>&nbsp;<span class="op" id="7023274">:=</span>&nbsp;<span class="ident" id="7023277">acquirem</span><span class="op" id="7023285">(</span><span class="op" id="7023286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023289">mp</span><span class="op" id="7023291">.</span><span class="ident" id="7023292">ptrarg</span><span class="op" id="7023298">[</span><span class="num" id="7023299">0</span><span class="op" id="7023300">]</span>&nbsp;<span class="op" id="7023302">=</span>&nbsp;<span class="ident" id="7023304">unsafe</span><span class="op" id="7023310">.</span><span class="ident" id="7023311">Pointer</span><span class="op" id="7023318">(</span><span class="ident" id="7023319">desc</span><span class="op" id="7023323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023326">onM</span><span class="op" id="7023329">(</span><span class="ident" id="7023330">parfordo_m</span><span class="op" id="7023340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023343">releasem</span><span class="op" id="7023351">(</span><span class="ident" id="7023352">mp</span><span class="op" id="7023354">)</span><br>
<span class="lineno">100</span><span class="op" id="7023356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7023359">func</span>&nbsp;<span class="ident" id="7023364">ParForIters</span><span class="op" id="7023375">(</span><span class="ident" id="7023376">desc</span>&nbsp;<span class="op" id="7023381">*</span><span class="ident" id="7023382">ParFor</span><span class="op" id="7023388">,</span>&nbsp;<span class="ident" id="7023390">tid</span>&nbsp;<span class="builtintype" id="7023394">uint32</span><span class="op" id="7023400">)</span>&nbsp;<span class="op" id="7023402">(</span><span class="builtintype" id="7023403">uint32</span><span class="op" id="7023409">,</span>&nbsp;<span class="builtintype" id="7023411">uint32</span><span class="op" id="7023417">)</span>&nbsp;<span class="op" id="7023419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023422">mp</span>&nbsp;<span class="op" id="7023425">:=</span>&nbsp;<span class="ident" id="7023428">acquirem</span><span class="op" id="7023436">(</span><span class="op" id="7023437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023440">mp</span><span class="op" id="7023442">.</span><span class="ident" id="7023443">ptrarg</span><span class="op" id="7023449">[</span><span class="num" id="7023450">0</span><span class="op" id="7023451">]</span>&nbsp;<span class="op" id="7023453">=</span>&nbsp;<span class="ident" id="7023455">unsafe</span><span class="op" id="7023461">.</span><span class="ident" id="7023462">Pointer</span><span class="op" id="7023469">(</span><span class="ident" id="7023470">desc</span><span class="op" id="7023474">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023477">mp</span><span class="op" id="7023479">.</span><span class="ident" id="7023480">scalararg</span><span class="op" id="7023489">[</span><span class="num" id="7023490">0</span><span class="op" id="7023491">]</span>&nbsp;<span class="op" id="7023493">=</span>&nbsp;<span class="builtintype" id="7023495">uintptr</span><span class="op" id="7023502">(</span><span class="ident" id="7023503">tid</span><span class="op" id="7023506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023509">onM</span><span class="op" id="7023512">(</span><span class="ident" id="7023513">parforiters_m</span><span class="op" id="7023526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023529">begin</span>&nbsp;<span class="op" id="7023535">:=</span>&nbsp;<span class="builtintype" id="7023538">uint32</span><span class="op" id="7023544">(</span><span class="ident" id="7023545">mp</span><span class="op" id="7023547">.</span><span class="ident" id="7023548">scalararg</span><span class="op" id="7023557">[</span><span class="num" id="7023558">0</span><span class="op" id="7023559">]</span><span class="op" id="7023560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023563">end</span>&nbsp;<span class="op" id="7023567">:=</span>&nbsp;<span class="builtintype" id="7023570">uint32</span><span class="op" id="7023576">(</span><span class="ident" id="7023577">mp</span><span class="op" id="7023579">.</span><span class="ident" id="7023580">scalararg</span><span class="op" id="7023589">[</span><span class="num" id="7023590">1</span><span class="op" id="7023591">]</span><span class="op" id="7023592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023595">releasem</span><span class="op" id="7023603">(</span><span class="ident" id="7023604">mp</span><span class="op" id="7023606">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023609">return</span>&nbsp;<span class="ident" id="7023616">begin</span><span class="op" id="7023621">,</span>&nbsp;<span class="ident" id="7023623">end</span><br>
<span class="lineno"></span><span class="op" id="7023627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7023630">//&nbsp;in&nbsp;mgc0.c</span><br>
<span class="lineno"></span><span class="comment" id="7023643">//go:noescape</span><br>
<span class="lineno">115</span><span class="keyword" id="7023657">func</span>&nbsp;<span class="ident" id="7023662">getgcmask</span><span class="op" id="7023671">(</span><span class="ident" id="7023672">data</span>&nbsp;<span class="ident" id="7023677">unsafe</span><span class="op" id="7023683">.</span><span class="ident" id="7023684">Pointer</span><span class="op" id="7023691">,</span>&nbsp;<span class="ident" id="7023693">typ</span>&nbsp;<span class="op" id="7023697">*</span><span class="ident" id="7023698">_type</span><span class="op" id="7023703">,</span>&nbsp;<span class="ident" id="7023705">array</span>&nbsp;<span class="op" id="7023711">*</span><span class="op" id="7023712">*</span><span class="builtintype" id="7023713">byte</span><span class="op" id="7023717">,</span>&nbsp;<span class="builtinfunc" id="7023719">len</span>&nbsp;<span class="op" id="7023723">*</span><span class="builtintype" id="7023724">uint</span><span class="op" id="7023728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7023731">func</span>&nbsp;<span class="ident" id="7023736">GCMask</span><span class="op" id="7023742">(</span><span class="ident" id="7023743">x</span>&nbsp;<span class="keyword" id="7023745">interface</span><span class="op" id="7023754">{</span><span class="op" id="7023755">}</span><span class="op" id="7023756">)</span>&nbsp;<span class="op" id="7023758">(</span><span class="ident" id="7023759">ret</span>&nbsp;<span class="op" id="7023763">[</span><span class="op" id="7023764">]</span><span class="builtintype" id="7023765">byte</span><span class="op" id="7023769">)</span>&nbsp;<span class="op" id="7023771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023774">e</span>&nbsp;<span class="op" id="7023776">:=</span>&nbsp;<span class="op" id="7023779">(</span><span class="op" id="7023780">*</span><span class="ident" id="7023781">eface</span><span class="op" id="7023786">)</span><span class="op" id="7023787">(</span><span class="ident" id="7023788">unsafe</span><span class="op" id="7023794">.</span><span class="ident" id="7023795">Pointer</span><span class="op" id="7023802">(</span><span class="op" id="7023803">&amp;</span><span class="ident" id="7023804">x</span><span class="op" id="7023805">)</span><span class="op" id="7023806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023809">s</span>&nbsp;<span class="op" id="7023811">:=</span>&nbsp;<span class="op" id="7023814">(</span><span class="op" id="7023815">*</span><span class="ident" id="7023816">slice</span><span class="op" id="7023821">)</span><span class="op" id="7023822">(</span><span class="ident" id="7023823">unsafe</span><span class="op" id="7023829">.</span><span class="ident" id="7023830">Pointer</span><span class="op" id="7023837">(</span><span class="op" id="7023838">&amp;</span><span class="ident" id="7023839">ret</span><span class="op" id="7023842">)</span><span class="op" id="7023843">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023846">onM</span><span class="op" id="7023849">(</span><span class="keyword" id="7023850">func</span><span class="op" id="7023854">(</span><span class="op" id="7023855">)</span>&nbsp;<span class="op" id="7023857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023861">getgcmask</span><span class="op" id="7023870">(</span><span class="ident" id="7023871">e</span><span class="op" id="7023872">.</span><span class="ident" id="7023873">data</span><span class="op" id="7023877">,</span>&nbsp;<span class="ident" id="7023879">e</span><span class="op" id="7023880">.</span><span class="ident" id="7023881">_type</span><span class="op" id="7023886">,</span>&nbsp;<span class="op" id="7023888">&amp;</span><span class="ident" id="7023889">s</span><span class="op" id="7023890">.</span><span class="ident" id="7023891">array</span><span class="op" id="7023896">,</span>&nbsp;<span class="op" id="7023898">&amp;</span><span class="ident" id="7023899">s</span><span class="op" id="7023900">.</span><span class="builtinfunc" id="7023901">len</span><span class="op" id="7023904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023908">s</span><span class="op" id="7023909">.</span><span class="builtinfunc" id="7023910">cap</span>&nbsp;<span class="op" id="7023914">=</span>&nbsp;<span class="ident" id="7023916">s</span><span class="op" id="7023917">.</span><span class="builtinfunc" id="7023918">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7023923">}</span><span class="op" id="7023924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023927">return</span><br>
<span class="lineno">125</span><span class="op" id="7023934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7023937">func</span>&nbsp;<span class="ident" id="7023942">testSchedLocalQueue</span><span class="op" id="7023961">(</span><span class="op" id="7023962">)</span><br>
<span class="lineno"></span><span class="keyword" id="7023964">func</span>&nbsp;<span class="ident" id="7023969">testSchedLocalQueueSteal</span><span class="op" id="7023993">(</span><span class="op" id="7023994">)</span><br>
<span class="lineno"></span><span class="keyword" id="7023996">func</span>&nbsp;<span class="ident" id="7024001">RunSchedLocalQueueTest</span><span class="op" id="7024023">(</span><span class="op" id="7024024">)</span>&nbsp;<span class="op" id="7024026">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024029">onM</span><span class="op" id="7024032">(</span><span class="ident" id="7024033">testSchedLocalQueue</span><span class="op" id="7024052">)</span><br>
<span class="lineno"></span><span class="op" id="7024054">}</span><br>
<span class="lineno"></span><span class="keyword" id="7024056">func</span>&nbsp;<span class="ident" id="7024061">RunSchedLocalQueueStealTest</span><span class="op" id="7024088">(</span><span class="op" id="7024089">)</span>&nbsp;<span class="op" id="7024091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024094">onM</span><span class="op" id="7024097">(</span><span class="ident" id="7024098">testSchedLocalQueueSteal</span><span class="op" id="7024122">)</span><br>
<span class="lineno"></span><span class="op" id="7024124">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="7024127">var</span>&nbsp;<span class="ident" id="7024131">HaveGoodHash</span>&nbsp;<span class="op" id="7024144">=</span>&nbsp;<span class="ident" id="7024146">haveGoodHash</span><br>
<span class="lineno"></span><span class="keyword" id="7024159">var</span>&nbsp;<span class="ident" id="7024163">StringHash</span>&nbsp;<span class="op" id="7024174">=</span>&nbsp;<span class="ident" id="7024176">stringHash</span><br>
<span class="lineno"></span><span class="keyword" id="7024187">var</span>&nbsp;<span class="ident" id="7024191">BytesHash</span>&nbsp;<span class="op" id="7024201">=</span>&nbsp;<span class="ident" id="7024203">bytesHash</span><br>
<span class="lineno"></span><span class="keyword" id="7024213">var</span>&nbsp;<span class="ident" id="7024217">Int32Hash</span>&nbsp;<span class="op" id="7024227">=</span>&nbsp;<span class="ident" id="7024229">int32Hash</span><br>
<span class="lineno">140</span><span class="keyword" id="7024239">var</span>&nbsp;<span class="ident" id="7024243">Int64Hash</span>&nbsp;<span class="op" id="7024253">=</span>&nbsp;<span class="ident" id="7024255">int64Hash</span><br>
<span class="lineno"></span><span class="keyword" id="7024265">var</span>&nbsp;<span class="ident" id="7024269">EfaceHash</span>&nbsp;<span class="op" id="7024279">=</span>&nbsp;<span class="ident" id="7024281">efaceHash</span><br>
<span class="lineno"></span><span class="keyword" id="7024291">var</span>&nbsp;<span class="ident" id="7024295">IfaceHash</span>&nbsp;<span class="op" id="7024305">=</span>&nbsp;<span class="ident" id="7024307">ifaceHash</span><br>
<span class="lineno"></span><span class="keyword" id="7024317">var</span>&nbsp;<span class="ident" id="7024321">MemclrBytes</span>&nbsp;<span class="op" id="7024333">=</span>&nbsp;<span class="ident" id="7024335">memclrBytes</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="7024348">var</span>&nbsp;<span class="ident" id="7024352">HashLoad</span>&nbsp;<span class="op" id="7024361">=</span>&nbsp;<span class="op" id="7024363">&amp;</span><span class="ident" id="7024364">hashLoad</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7024374">//&nbsp;For&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="7024390">func</span>&nbsp;<span class="ident" id="7024395">GogoBytes</span><span class="op" id="7024404">(</span><span class="op" id="7024405">)</span>&nbsp;<span class="builtintype" id="7024407">int32</span>&nbsp;<span class="op" id="7024413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024416">return</span>&nbsp;<span class="ident" id="7024423">_RuntimeGogoBytes</span><br>
<span class="lineno">150</span><span class="op" id="7024441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7024444">//&nbsp;in&nbsp;string.c</span><br>
<span class="lineno"></span><span class="comment" id="7024459">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="7024473">func</span>&nbsp;<span class="ident" id="7024478">gostringw</span><span class="op" id="7024487">(</span><span class="ident" id="7024488">w</span>&nbsp;<span class="op" id="7024490">*</span><span class="builtintype" id="7024491">uint16</span><span class="op" id="7024497">)</span>&nbsp;<span class="builtintype" id="7024499">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="7024507">//&nbsp;entry&nbsp;point&nbsp;for&nbsp;testing</span><br>
<span class="lineno"></span><span class="keyword" id="7024534">func</span>&nbsp;<span class="ident" id="7024539">GostringW</span><span class="op" id="7024548">(</span><span class="ident" id="7024549">w</span>&nbsp;<span class="op" id="7024551">[</span><span class="op" id="7024552">]</span><span class="builtintype" id="7024553">uint16</span><span class="op" id="7024559">)</span>&nbsp;<span class="op" id="7024561">(</span><span class="ident" id="7024562">s</span>&nbsp;<span class="builtintype" id="7024564">string</span><span class="op" id="7024570">)</span>&nbsp;<span class="op" id="7024572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024575">onM</span><span class="op" id="7024578">(</span><span class="keyword" id="7024579">func</span><span class="op" id="7024583">(</span><span class="op" id="7024584">)</span>&nbsp;<span class="op" id="7024586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024590">s</span>&nbsp;<span class="op" id="7024592">=</span>&nbsp;<span class="ident" id="7024594">gostringw</span><span class="op" id="7024603">(</span><span class="op" id="7024604">&amp;</span><span class="ident" id="7024605">w</span><span class="op" id="7024606">[</span><span class="num" id="7024607">0</span><span class="op" id="7024608">]</span><span class="op" id="7024609">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7024612">}</span><span class="op" id="7024613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024616">return</span><br>
<span class="lineno"></span><span class="op" id="7024623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7024626">var</span>&nbsp;<span class="ident" id="7024630">Gostringnocopy</span>&nbsp;<span class="op" id="7024645">=</span>&nbsp;<span class="ident" id="7024647">gostringnocopy</span><br>
<span class="lineno">165</span><span class="keyword" id="7024662">var</span>&nbsp;<span class="ident" id="7024666">Maxstring</span>&nbsp;<span class="op" id="7024676">=</span>&nbsp;<span class="op" id="7024678">&amp;</span><span class="ident" id="7024679">maxstring</span>
</div>
</body>
</html>
