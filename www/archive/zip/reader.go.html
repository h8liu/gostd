<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6051738">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6051793">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6051847">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6051898">package</span>&nbsp;<span class="ident" id="6051906">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6051911">import</span>&nbsp;<span class="op" id="6051918">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6051921">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6051930">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6051949">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6051959">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6051967">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6051981">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6051987">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6051992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6051995">var</span>&nbsp;<span class="op" id="6051999">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052002">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6052015">=</span>&nbsp;<span class="ident" id="6052017">errors</span><span class="op" id="6052023">.</span><span class="ident" id="6052024">New</span><span class="op" id="6052027">(</span><span class="string" id="6052028">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="6052055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052058">ErrAlgorithm</span>&nbsp;<span class="op" id="6052071">=</span>&nbsp;<span class="ident" id="6052073">errors</span><span class="op" id="6052079">.</span><span class="ident" id="6052080">New</span><span class="op" id="6052083">(</span><span class="string" id="6052084">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="6052124">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052127">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="6052140">=</span>&nbsp;<span class="ident" id="6052142">errors</span><span class="op" id="6052148">.</span><span class="ident" id="6052149">New</span><span class="op" id="6052152">(</span><span class="string" id="6052153">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="6052174">)</span><br>
<span class="lineno"></span><span class="op" id="6052176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6052179">type</span>&nbsp;<span class="ident" id="6052184">Reader</span>&nbsp;<span class="keyword" id="6052191">struct</span>&nbsp;<span class="op" id="6052198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052201">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052209">io</span><span class="op" id="6052211">.</span><span class="ident" id="6052212">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052222">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6052230">[</span><span class="op" id="6052231">]</span><span class="op" id="6052232">*</span><span class="ident" id="6052233">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052239">Comment</span>&nbsp;<span class="builtintype" id="6052247">string</span><br>
<span class="lineno"></span><span class="op" id="6052254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6052257">type</span>&nbsp;<span class="ident" id="6052262">ReadCloser</span>&nbsp;<span class="keyword" id="6052273">struct</span>&nbsp;<span class="op" id="6052280">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052283">f</span>&nbsp;<span class="op" id="6052285">*</span><span class="ident" id="6052286">os</span><span class="op" id="6052288">.</span><span class="ident" id="6052289">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052295">Reader</span><br>
<span class="lineno"></span><span class="op" id="6052302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6052305">type</span>&nbsp;<span class="ident" id="6052310">File</span>&nbsp;<span class="keyword" id="6052315">struct</span>&nbsp;<span class="op" id="6052322">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052325">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052337">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052350">io</span><span class="op" id="6052352">.</span><span class="ident" id="6052353">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052363">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052376">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052383">headerOffset</span>&nbsp;<span class="ident" id="6052396">int64</span><br>
<span class="lineno"></span><span class="op" id="6052402">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6052405">func</span>&nbsp;<span class="op" id="6052410">(</span><span class="ident" id="6052411">f</span>&nbsp;<span class="op" id="6052413">*</span><span class="ident" id="6052414">File</span><span class="op" id="6052418">)</span>&nbsp;<span class="ident" id="6052420">hasDataDescriptor</span><span class="op" id="6052437">(</span><span class="op" id="6052438">)</span>&nbsp;<span class="builtintype" id="6052440">bool</span>&nbsp;<span class="op" id="6052445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052448">return</span>&nbsp;<span class="ident" id="6052455">f</span><span class="op" id="6052456">.</span><span class="ident" id="6052457">Flags</span><span class="op" id="6052462">&amp;</span><span class="num" id="6052463">0x8</span>&nbsp;<span class="op" id="6052467">!=</span>&nbsp;<span class="num" id="6052470">0</span><br>
<span class="lineno"></span><span class="op" id="6052472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6052475">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="6052555">func</span>&nbsp;<span class="ident" id="6052560">OpenReader</span><span class="op" id="6052570">(</span><span class="ident" id="6052571">name</span>&nbsp;<span class="builtintype" id="6052576">string</span><span class="op" id="6052582">)</span>&nbsp;<span class="op" id="6052584">(</span><span class="op" id="6052585">*</span><span class="ident" id="6052586">ReadCloser</span><span class="op" id="6052596">,</span>&nbsp;<span class="builtintype" id="6052598">error</span><span class="op" id="6052603">)</span>&nbsp;<span class="op" id="6052605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052608">f</span><span class="op" id="6052609">,</span>&nbsp;<span class="ident" id="6052611">err</span>&nbsp;<span class="op" id="6052615">:=</span>&nbsp;<span class="ident" id="6052618">os</span><span class="op" id="6052620">.</span><span class="ident" id="6052621">Open</span><span class="op" id="6052625">(</span><span class="ident" id="6052626">name</span><span class="op" id="6052630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052633">if</span>&nbsp;<span class="ident" id="6052636">err</span>&nbsp;<span class="op" id="6052640">!=</span>&nbsp;<span class="ident" id="6052643">nil</span>&nbsp;<span class="op" id="6052647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052651">return</span>&nbsp;<span class="ident" id="6052658">nil</span><span class="op" id="6052661">,</span>&nbsp;<span class="ident" id="6052663">err</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6052668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052671">fi</span><span class="op" id="6052673">,</span>&nbsp;<span class="ident" id="6052675">err</span>&nbsp;<span class="op" id="6052679">:=</span>&nbsp;<span class="ident" id="6052682">f</span><span class="op" id="6052683">.</span><span class="ident" id="6052684">Stat</span><span class="op" id="6052688">(</span><span class="op" id="6052689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052692">if</span>&nbsp;<span class="ident" id="6052695">err</span>&nbsp;<span class="op" id="6052699">!=</span>&nbsp;<span class="ident" id="6052702">nil</span>&nbsp;<span class="op" id="6052706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052710">f</span><span class="op" id="6052711">.</span><span class="ident" id="6052712">Close</span><span class="op" id="6052717">(</span><span class="op" id="6052718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052722">return</span>&nbsp;<span class="ident" id="6052729">nil</span><span class="op" id="6052732">,</span>&nbsp;<span class="ident" id="6052734">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6052739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052742">r</span>&nbsp;<span class="op" id="6052744">:=</span>&nbsp;<span class="builtinfunc" id="6052747">new</span><span class="op" id="6052750">(</span><span class="ident" id="6052751">ReadCloser</span><span class="op" id="6052761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052764">if</span>&nbsp;<span class="ident" id="6052767">err</span>&nbsp;<span class="op" id="6052771">:=</span>&nbsp;<span class="ident" id="6052774">r</span><span class="op" id="6052775">.</span><span class="ident" id="6052776">init</span><span class="op" id="6052780">(</span><span class="ident" id="6052781">f</span><span class="op" id="6052782">,</span>&nbsp;<span class="ident" id="6052784">fi</span><span class="op" id="6052786">.</span><span class="ident" id="6052787">Size</span><span class="op" id="6052791">(</span><span class="op" id="6052792">)</span><span class="op" id="6052793">)</span><span class="op" id="6052794">;</span>&nbsp;<span class="ident" id="6052796">err</span>&nbsp;<span class="op" id="6052800">!=</span>&nbsp;<span class="ident" id="6052803">nil</span>&nbsp;<span class="op" id="6052807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052811">f</span><span class="op" id="6052812">.</span><span class="ident" id="6052813">Close</span><span class="op" id="6052818">(</span><span class="op" id="6052819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052823">return</span>&nbsp;<span class="ident" id="6052830">nil</span><span class="op" id="6052833">,</span>&nbsp;<span class="ident" id="6052835">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6052840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052843">r</span><span class="op" id="6052844">.</span><span class="ident" id="6052845">f</span>&nbsp;<span class="op" id="6052847">=</span>&nbsp;<span class="ident" id="6052849">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052852">return</span>&nbsp;<span class="ident" id="6052859">r</span><span class="op" id="6052860">,</span>&nbsp;<span class="ident" id="6052862">nil</span><br>
<span class="lineno"></span><span class="op" id="6052866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="6052869">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6052939">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6052972">func</span>&nbsp;<span class="ident" id="6052977">NewReader</span><span class="op" id="6052986">(</span><span class="ident" id="6052987">r</span>&nbsp;<span class="ident" id="6052989">io</span><span class="op" id="6052991">.</span><span class="ident" id="6052992">ReaderAt</span><span class="op" id="6053000">,</span>&nbsp;<span class="ident" id="6053002">size</span>&nbsp;<span class="ident" id="6053007">int64</span><span class="op" id="6053012">)</span>&nbsp;<span class="op" id="6053014">(</span><span class="op" id="6053015">*</span><span class="ident" id="6053016">Reader</span><span class="op" id="6053022">,</span>&nbsp;<span class="builtintype" id="6053024">error</span><span class="op" id="6053029">)</span>&nbsp;<span class="op" id="6053031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053034">zr</span>&nbsp;<span class="op" id="6053037">:=</span>&nbsp;<span class="builtinfunc" id="6053040">new</span><span class="op" id="6053043">(</span><span class="ident" id="6053044">Reader</span><span class="op" id="6053050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053053">if</span>&nbsp;<span class="ident" id="6053056">err</span>&nbsp;<span class="op" id="6053060">:=</span>&nbsp;<span class="ident" id="6053063">zr</span><span class="op" id="6053065">.</span><span class="ident" id="6053066">init</span><span class="op" id="6053070">(</span><span class="ident" id="6053071">r</span><span class="op" id="6053072">,</span>&nbsp;<span class="ident" id="6053074">size</span><span class="op" id="6053078">)</span><span class="op" id="6053079">;</span>&nbsp;<span class="ident" id="6053081">err</span>&nbsp;<span class="op" id="6053085">!=</span>&nbsp;<span class="ident" id="6053088">nil</span>&nbsp;<span class="op" id="6053092">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053096">return</span>&nbsp;<span class="ident" id="6053103">nil</span><span class="op" id="6053106">,</span>&nbsp;<span class="ident" id="6053108">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6053113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053116">return</span>&nbsp;<span class="ident" id="6053123">zr</span><span class="op" id="6053125">,</span>&nbsp;<span class="ident" id="6053127">nil</span><br>
<span class="lineno"></span><span class="op" id="6053131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6053134">func</span>&nbsp;<span class="op" id="6053139">(</span><span class="ident" id="6053140">z</span>&nbsp;<span class="op" id="6053142">*</span><span class="ident" id="6053143">Reader</span><span class="op" id="6053149">)</span>&nbsp;<span class="ident" id="6053151">init</span><span class="op" id="6053155">(</span><span class="ident" id="6053156">r</span>&nbsp;<span class="ident" id="6053158">io</span><span class="op" id="6053160">.</span><span class="ident" id="6053161">ReaderAt</span><span class="op" id="6053169">,</span>&nbsp;<span class="ident" id="6053171">size</span>&nbsp;<span class="ident" id="6053176">int64</span><span class="op" id="6053181">)</span>&nbsp;<span class="builtintype" id="6053183">error</span>&nbsp;<span class="op" id="6053189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053192">end</span><span class="op" id="6053195">,</span>&nbsp;<span class="ident" id="6053197">err</span>&nbsp;<span class="op" id="6053201">:=</span>&nbsp;<span class="ident" id="6053204">readDirectoryEnd</span><span class="op" id="6053220">(</span><span class="ident" id="6053221">r</span><span class="op" id="6053222">,</span>&nbsp;<span class="ident" id="6053224">size</span><span class="op" id="6053228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053231">if</span>&nbsp;<span class="ident" id="6053234">err</span>&nbsp;<span class="op" id="6053238">!=</span>&nbsp;<span class="ident" id="6053241">nil</span>&nbsp;<span class="op" id="6053245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053249">return</span>&nbsp;<span class="ident" id="6053256">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6053261">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053264">z</span><span class="op" id="6053265">.</span><span class="ident" id="6053266">r</span>&nbsp;<span class="op" id="6053268">=</span>&nbsp;<span class="ident" id="6053270">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053273">z</span><span class="op" id="6053274">.</span><span class="ident" id="6053275">File</span>&nbsp;<span class="op" id="6053280">=</span>&nbsp;<span class="builtinfunc" id="6053282">make</span><span class="op" id="6053286">(</span><span class="op" id="6053287">[</span><span class="op" id="6053288">]</span><span class="op" id="6053289">*</span><span class="ident" id="6053290">File</span><span class="op" id="6053294">,</span>&nbsp;<span class="num" id="6053296">0</span><span class="op" id="6053297">,</span>&nbsp;<span class="ident" id="6053299">end</span><span class="op" id="6053302">.</span><span class="ident" id="6053303">directoryRecords</span><span class="op" id="6053319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053322">z</span><span class="op" id="6053323">.</span><span class="ident" id="6053324">Comment</span>&nbsp;<span class="op" id="6053332">=</span>&nbsp;<span class="ident" id="6053334">end</span><span class="op" id="6053337">.</span><span class="ident" id="6053338">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053347">rs</span>&nbsp;<span class="op" id="6053350">:=</span>&nbsp;<span class="ident" id="6053353">io</span><span class="op" id="6053355">.</span><span class="ident" id="6053356">NewSectionReader</span><span class="op" id="6053372">(</span><span class="ident" id="6053373">r</span><span class="op" id="6053374">,</span>&nbsp;<span class="num" id="6053376">0</span><span class="op" id="6053377">,</span>&nbsp;<span class="ident" id="6053379">size</span><span class="op" id="6053383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053386">if</span>&nbsp;<span class="ident" id="6053389">_</span><span class="op" id="6053390">,</span>&nbsp;<span class="ident" id="6053392">err</span>&nbsp;<span class="op" id="6053396">=</span>&nbsp;<span class="ident" id="6053398">rs</span><span class="op" id="6053400">.</span><span class="ident" id="6053401">Seek</span><span class="op" id="6053405">(</span><span class="ident" id="6053406">int64</span><span class="op" id="6053411">(</span><span class="ident" id="6053412">end</span><span class="op" id="6053415">.</span><span class="ident" id="6053416">directoryOffset</span><span class="op" id="6053431">)</span><span class="op" id="6053432">,</span>&nbsp;<span class="ident" id="6053434">os</span><span class="op" id="6053436">.</span><span class="ident" id="6053437">SEEK_SET</span><span class="op" id="6053445">)</span><span class="op" id="6053446">;</span>&nbsp;<span class="ident" id="6053448">err</span>&nbsp;<span class="op" id="6053452">!=</span>&nbsp;<span class="ident" id="6053455">nil</span>&nbsp;<span class="op" id="6053459">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053463">return</span>&nbsp;<span class="ident" id="6053470">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6053475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053478">buf</span>&nbsp;<span class="op" id="6053482">:=</span>&nbsp;<span class="ident" id="6053485">bufio</span><span class="op" id="6053490">.</span><span class="ident" id="6053491">NewReader</span><span class="op" id="6053500">(</span><span class="ident" id="6053501">rs</span><span class="op" id="6053503">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053507">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053576">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053634">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053702">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053748">for</span>&nbsp;<span class="op" id="6053752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053756">f</span>&nbsp;<span class="op" id="6053758">:=</span>&nbsp;<span class="op" id="6053761">&amp;</span><span class="ident" id="6053762">File</span><span class="op" id="6053766">{</span><span class="ident" id="6053767">zipr</span><span class="op" id="6053771">:</span>&nbsp;<span class="ident" id="6053773">r</span><span class="op" id="6053774">,</span>&nbsp;<span class="ident" id="6053776">zipsize</span><span class="op" id="6053783">:</span>&nbsp;<span class="ident" id="6053785">size</span><span class="op" id="6053789">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053793">err</span>&nbsp;<span class="op" id="6053797">=</span>&nbsp;<span class="ident" id="6053799">readDirectoryHeader</span><span class="op" id="6053818">(</span><span class="ident" id="6053819">f</span><span class="op" id="6053820">,</span>&nbsp;<span class="ident" id="6053822">buf</span><span class="op" id="6053825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053829">if</span>&nbsp;<span class="ident" id="6053832">err</span>&nbsp;<span class="op" id="6053836">==</span>&nbsp;<span class="ident" id="6053839">ErrFormat</span>&nbsp;<span class="op" id="6053849">||</span>&nbsp;<span class="ident" id="6053852">err</span>&nbsp;<span class="op" id="6053856">==</span>&nbsp;<span class="ident" id="6053859">io</span><span class="op" id="6053861">.</span><span class="ident" id="6053862">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6053879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053884">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6053892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053896">if</span>&nbsp;<span class="ident" id="6053899">err</span>&nbsp;<span class="op" id="6053903">!=</span>&nbsp;<span class="ident" id="6053906">nil</span>&nbsp;<span class="op" id="6053910">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053915">return</span>&nbsp;<span class="ident" id="6053922">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6053928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053932">z</span><span class="op" id="6053933">.</span><span class="ident" id="6053934">File</span>&nbsp;<span class="op" id="6053939">=</span>&nbsp;<span class="builtinfunc" id="6053941">append</span><span class="op" id="6053947">(</span><span class="ident" id="6053948">z</span><span class="op" id="6053949">.</span><span class="ident" id="6053950">File</span><span class="op" id="6053954">,</span>&nbsp;<span class="ident" id="6053956">f</span><span class="op" id="6053957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6053960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053963">if</span>&nbsp;<span class="builtintype" id="6053966">uint16</span><span class="op" id="6053972">(</span><span class="builtinfunc" id="6053973">len</span><span class="op" id="6053976">(</span><span class="ident" id="6053977">z</span><span class="op" id="6053978">.</span><span class="ident" id="6053979">File</span><span class="op" id="6053983">)</span><span class="op" id="6053984">)</span>&nbsp;<span class="op" id="6053986">!=</span>&nbsp;<span class="builtintype" id="6053989">uint16</span><span class="op" id="6053995">(</span><span class="ident" id="6053996">end</span><span class="op" id="6053999">.</span><span class="ident" id="6054000">directoryRecords</span><span class="op" id="6054016">)</span>&nbsp;<span class="op" id="6054018">{</span>&nbsp;<span class="comment" id="6054020">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6054051">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6054104">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054148">return</span>&nbsp;<span class="ident" id="6054155">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6054160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054163">return</span>&nbsp;<span class="ident" id="6054170">nil</span><br>
<span class="lineno">110</span><span class="op" id="6054174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6054177">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="6054238">func</span>&nbsp;<span class="op" id="6054243">(</span><span class="ident" id="6054244">rc</span>&nbsp;<span class="op" id="6054247">*</span><span class="ident" id="6054248">ReadCloser</span><span class="op" id="6054258">)</span>&nbsp;<span class="ident" id="6054260">Close</span><span class="op" id="6054265">(</span><span class="op" id="6054266">)</span>&nbsp;<span class="builtintype" id="6054268">error</span>&nbsp;<span class="op" id="6054274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054277">return</span>&nbsp;<span class="ident" id="6054284">rc</span><span class="op" id="6054286">.</span><span class="ident" id="6054287">f</span><span class="op" id="6054288">.</span><span class="ident" id="6054289">Close</span><span class="op" id="6054294">(</span><span class="op" id="6054295">)</span><br>
<span class="lineno">115</span><span class="op" id="6054297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6054300">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="6054367">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6054419">//</span><br>
<span class="lineno">120</span><span class="comment" id="6054422">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="6054483">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="6054528">func</span>&nbsp;<span class="op" id="6054533">(</span><span class="ident" id="6054534">f</span>&nbsp;<span class="op" id="6054536">*</span><span class="ident" id="6054537">File</span><span class="op" id="6054541">)</span>&nbsp;<span class="ident" id="6054543">DataOffset</span><span class="op" id="6054553">(</span><span class="op" id="6054554">)</span>&nbsp;<span class="op" id="6054556">(</span><span class="ident" id="6054557">offset</span>&nbsp;<span class="ident" id="6054564">int64</span><span class="op" id="6054569">,</span>&nbsp;<span class="ident" id="6054571">err</span>&nbsp;<span class="builtintype" id="6054575">error</span><span class="op" id="6054580">)</span>&nbsp;<span class="op" id="6054582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054585">bodyOffset</span><span class="op" id="6054595">,</span>&nbsp;<span class="ident" id="6054597">err</span>&nbsp;<span class="op" id="6054601">:=</span>&nbsp;<span class="ident" id="6054604">f</span><span class="op" id="6054605">.</span><span class="ident" id="6054606">findBodyOffset</span><span class="op" id="6054620">(</span><span class="op" id="6054621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054624">if</span>&nbsp;<span class="ident" id="6054627">err</span>&nbsp;<span class="op" id="6054631">!=</span>&nbsp;<span class="ident" id="6054634">nil</span>&nbsp;<span class="op" id="6054638">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054642">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6054650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054653">return</span>&nbsp;<span class="ident" id="6054660">f</span><span class="op" id="6054661">.</span><span class="ident" id="6054662">headerOffset</span>&nbsp;<span class="op" id="6054675">+</span>&nbsp;<span class="ident" id="6054677">bodyOffset</span><span class="op" id="6054687">,</span>&nbsp;<span class="ident" id="6054689">nil</span><br>
<span class="lineno"></span><span class="op" id="6054693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6054696">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="6054770">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="6054814">func</span>&nbsp;<span class="op" id="6054819">(</span><span class="ident" id="6054820">f</span>&nbsp;<span class="op" id="6054822">*</span><span class="ident" id="6054823">File</span><span class="op" id="6054827">)</span>&nbsp;<span class="ident" id="6054829">Open</span><span class="op" id="6054833">(</span><span class="op" id="6054834">)</span>&nbsp;<span class="op" id="6054836">(</span><span class="ident" id="6054837">rc</span>&nbsp;<span class="ident" id="6054840">io</span><span class="op" id="6054842">.</span><span class="ident" id="6054843">ReadCloser</span><span class="op" id="6054853">,</span>&nbsp;<span class="ident" id="6054855">err</span>&nbsp;<span class="builtintype" id="6054859">error</span><span class="op" id="6054864">)</span>&nbsp;<span class="op" id="6054866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054869">bodyOffset</span><span class="op" id="6054879">,</span>&nbsp;<span class="ident" id="6054881">err</span>&nbsp;<span class="op" id="6054885">:=</span>&nbsp;<span class="ident" id="6054888">f</span><span class="op" id="6054889">.</span><span class="ident" id="6054890">findBodyOffset</span><span class="op" id="6054904">(</span><span class="op" id="6054905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054908">if</span>&nbsp;<span class="ident" id="6054911">err</span>&nbsp;<span class="op" id="6054915">!=</span>&nbsp;<span class="ident" id="6054918">nil</span>&nbsp;<span class="op" id="6054922">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054926">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6054934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054937">size</span>&nbsp;<span class="op" id="6054942">:=</span>&nbsp;<span class="ident" id="6054945">int64</span><span class="op" id="6054950">(</span><span class="ident" id="6054951">f</span><span class="op" id="6054952">.</span><span class="ident" id="6054953">CompressedSize64</span><span class="op" id="6054969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054972">r</span>&nbsp;<span class="op" id="6054974">:=</span>&nbsp;<span class="ident" id="6054977">io</span><span class="op" id="6054979">.</span><span class="ident" id="6054980">NewSectionReader</span><span class="op" id="6054996">(</span><span class="ident" id="6054997">f</span><span class="op" id="6054998">.</span><span class="ident" id="6054999">zipr</span><span class="op" id="6055003">,</span>&nbsp;<span class="ident" id="6055005">f</span><span class="op" id="6055006">.</span><span class="ident" id="6055007">headerOffset</span><span class="op" id="6055019">+</span><span class="ident" id="6055020">bodyOffset</span><span class="op" id="6055030">,</span>&nbsp;<span class="ident" id="6055032">size</span><span class="op" id="6055036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055039">dcomp</span>&nbsp;<span class="op" id="6055045">:=</span>&nbsp;<span class="ident" id="6055048">decompressor</span><span class="op" id="6055060">(</span><span class="ident" id="6055061">f</span><span class="op" id="6055062">.</span><span class="ident" id="6055063">Method</span><span class="op" id="6055069">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055072">if</span>&nbsp;<span class="ident" id="6055075">dcomp</span>&nbsp;<span class="op" id="6055081">==</span>&nbsp;<span class="ident" id="6055084">nil</span>&nbsp;<span class="op" id="6055088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055092">err</span>&nbsp;<span class="op" id="6055096">=</span>&nbsp;<span class="ident" id="6055098">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055113">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055124">rc</span>&nbsp;<span class="op" id="6055127">=</span>&nbsp;<span class="ident" id="6055129">dcomp</span><span class="op" id="6055134">(</span><span class="ident" id="6055135">r</span><span class="op" id="6055136">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055139">var</span>&nbsp;<span class="ident" id="6055143">desr</span>&nbsp;<span class="ident" id="6055148">io</span><span class="op" id="6055150">.</span><span class="ident" id="6055151">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055159">if</span>&nbsp;<span class="ident" id="6055162">f</span><span class="op" id="6055163">.</span><span class="ident" id="6055164">hasDataDescriptor</span><span class="op" id="6055181">(</span><span class="op" id="6055182">)</span>&nbsp;<span class="op" id="6055184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055188">desr</span>&nbsp;<span class="op" id="6055193">=</span>&nbsp;<span class="ident" id="6055195">io</span><span class="op" id="6055197">.</span><span class="ident" id="6055198">NewSectionReader</span><span class="op" id="6055214">(</span><span class="ident" id="6055215">f</span><span class="op" id="6055216">.</span><span class="ident" id="6055217">zipr</span><span class="op" id="6055221">,</span>&nbsp;<span class="ident" id="6055223">f</span><span class="op" id="6055224">.</span><span class="ident" id="6055225">headerOffset</span><span class="op" id="6055237">+</span><span class="ident" id="6055238">bodyOffset</span><span class="op" id="6055248">+</span><span class="ident" id="6055249">size</span><span class="op" id="6055253">,</span>&nbsp;<span class="ident" id="6055255">dataDescriptorLen</span><span class="op" id="6055272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055278">rc</span>&nbsp;<span class="op" id="6055281">=</span>&nbsp;<span class="op" id="6055283">&amp;</span><span class="ident" id="6055284">checksumReader</span><span class="op" id="6055298">{</span><span class="ident" id="6055299">rc</span><span class="op" id="6055301">,</span>&nbsp;<span class="ident" id="6055303">crc32</span><span class="op" id="6055308">.</span><span class="ident" id="6055309">NewIEEE</span><span class="op" id="6055316">(</span><span class="op" id="6055317">)</span><span class="op" id="6055318">,</span>&nbsp;<span class="ident" id="6055320">f</span><span class="op" id="6055321">,</span>&nbsp;<span class="ident" id="6055323">desr</span><span class="op" id="6055327">,</span>&nbsp;<span class="ident" id="6055329">nil</span><span class="op" id="6055332">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055335">return</span><br>
<span class="lineno"></span><span class="op" id="6055342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6055345">type</span>&nbsp;<span class="ident" id="6055350">checksumReader</span>&nbsp;<span class="keyword" id="6055365">struct</span>&nbsp;<span class="op" id="6055372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055375">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6055380">io</span><span class="op" id="6055382">.</span><span class="ident" id="6055383">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055395">hash</span>&nbsp;<span class="ident" id="6055400">hash</span><span class="op" id="6055404">.</span><span class="ident" id="6055405">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055413">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055418">*</span><span class="ident" id="6055419">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055425">desr</span>&nbsp;<span class="ident" id="6055430">io</span><span class="op" id="6055432">.</span><span class="ident" id="6055433">Reader</span>&nbsp;<span class="comment" id="6055440">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055490">err</span>&nbsp;&nbsp;<span class="builtintype" id="6055495">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6055505">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="6055521">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6055524">func</span>&nbsp;<span class="op" id="6055529">(</span><span class="ident" id="6055530">r</span>&nbsp;<span class="op" id="6055532">*</span><span class="ident" id="6055533">checksumReader</span><span class="op" id="6055547">)</span>&nbsp;<span class="ident" id="6055549">Read</span><span class="op" id="6055553">(</span><span class="ident" id="6055554">b</span>&nbsp;<span class="op" id="6055556">[</span><span class="op" id="6055557">]</span><span class="builtintype" id="6055558">byte</span><span class="op" id="6055562">)</span>&nbsp;<span class="op" id="6055564">(</span><span class="ident" id="6055565">n</span>&nbsp;<span class="builtintype" id="6055567">int</span><span class="op" id="6055570">,</span>&nbsp;<span class="ident" id="6055572">err</span>&nbsp;<span class="builtintype" id="6055576">error</span><span class="op" id="6055581">)</span>&nbsp;<span class="op" id="6055583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055586">if</span>&nbsp;<span class="ident" id="6055589">r</span><span class="op" id="6055590">.</span><span class="ident" id="6055591">err</span>&nbsp;<span class="op" id="6055595">!=</span>&nbsp;<span class="ident" id="6055598">nil</span>&nbsp;<span class="op" id="6055602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055606">return</span>&nbsp;<span class="num" id="6055613">0</span><span class="op" id="6055614">,</span>&nbsp;<span class="ident" id="6055616">r</span><span class="op" id="6055617">.</span><span class="ident" id="6055618">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055623">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055626">n</span><span class="op" id="6055627">,</span>&nbsp;<span class="ident" id="6055629">err</span>&nbsp;<span class="op" id="6055633">=</span>&nbsp;<span class="ident" id="6055635">r</span><span class="op" id="6055636">.</span><span class="ident" id="6055637">rc</span><span class="op" id="6055639">.</span><span class="ident" id="6055640">Read</span><span class="op" id="6055644">(</span><span class="ident" id="6055645">b</span><span class="op" id="6055646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055649">r</span><span class="op" id="6055650">.</span><span class="ident" id="6055651">hash</span><span class="op" id="6055655">.</span><span class="ident" id="6055656">Write</span><span class="op" id="6055661">(</span><span class="ident" id="6055662">b</span><span class="op" id="6055663">[</span><span class="op" id="6055664">:</span><span class="ident" id="6055665">n</span><span class="op" id="6055666">]</span><span class="op" id="6055667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055670">if</span>&nbsp;<span class="ident" id="6055673">err</span>&nbsp;<span class="op" id="6055677">==</span>&nbsp;<span class="ident" id="6055680">nil</span>&nbsp;<span class="op" id="6055684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055688">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055696">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055699">if</span>&nbsp;<span class="ident" id="6055702">err</span>&nbsp;<span class="op" id="6055706">==</span>&nbsp;<span class="ident" id="6055709">io</span><span class="op" id="6055711">.</span><span class="ident" id="6055712">EOF</span>&nbsp;<span class="op" id="6055716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055720">if</span>&nbsp;<span class="ident" id="6055723">r</span><span class="op" id="6055724">.</span><span class="ident" id="6055725">desr</span>&nbsp;<span class="op" id="6055730">!=</span>&nbsp;<span class="ident" id="6055733">nil</span>&nbsp;<span class="op" id="6055737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055742">if</span>&nbsp;<span class="ident" id="6055745">err1</span>&nbsp;<span class="op" id="6055750">:=</span>&nbsp;<span class="ident" id="6055753">readDataDescriptor</span><span class="op" id="6055771">(</span><span class="ident" id="6055772">r</span><span class="op" id="6055773">.</span><span class="ident" id="6055774">desr</span><span class="op" id="6055778">,</span>&nbsp;<span class="ident" id="6055780">r</span><span class="op" id="6055781">.</span><span class="ident" id="6055782">f</span><span class="op" id="6055783">)</span><span class="op" id="6055784">;</span>&nbsp;<span class="ident" id="6055786">err1</span>&nbsp;<span class="op" id="6055791">!=</span>&nbsp;<span class="ident" id="6055794">nil</span>&nbsp;<span class="op" id="6055798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055804">err</span>&nbsp;<span class="op" id="6055808">=</span>&nbsp;<span class="ident" id="6055810">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055818">}</span>&nbsp;<span class="keyword" id="6055820">else</span>&nbsp;<span class="keyword" id="6055825">if</span>&nbsp;<span class="ident" id="6055828">r</span><span class="op" id="6055829">.</span><span class="ident" id="6055830">hash</span><span class="op" id="6055834">.</span><span class="ident" id="6055835">Sum32</span><span class="op" id="6055840">(</span><span class="op" id="6055841">)</span>&nbsp;<span class="op" id="6055843">!=</span>&nbsp;<span class="ident" id="6055846">r</span><span class="op" id="6055847">.</span><span class="ident" id="6055848">f</span><span class="op" id="6055849">.</span><span class="ident" id="6055850">CRC32</span>&nbsp;<span class="op" id="6055856">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055862">err</span>&nbsp;<span class="op" id="6055866">=</span>&nbsp;<span class="ident" id="6055868">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055887">}</span>&nbsp;<span class="keyword" id="6055889">else</span>&nbsp;<span class="op" id="6055894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6055899">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6055956">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6056015">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056066">if</span>&nbsp;<span class="ident" id="6056069">r</span><span class="op" id="6056070">.</span><span class="ident" id="6056071">f</span><span class="op" id="6056072">.</span><span class="ident" id="6056073">CRC32</span>&nbsp;<span class="op" id="6056079">!=</span>&nbsp;<span class="num" id="6056082">0</span>&nbsp;<span class="op" id="6056084">&amp;&amp;</span>&nbsp;<span class="ident" id="6056087">r</span><span class="op" id="6056088">.</span><span class="ident" id="6056089">hash</span><span class="op" id="6056093">.</span><span class="ident" id="6056094">Sum32</span><span class="op" id="6056099">(</span><span class="op" id="6056100">)</span>&nbsp;<span class="op" id="6056102">!=</span>&nbsp;<span class="ident" id="6056105">r</span><span class="op" id="6056106">.</span><span class="ident" id="6056107">f</span><span class="op" id="6056108">.</span><span class="ident" id="6056109">CRC32</span>&nbsp;<span class="op" id="6056115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056121">err</span>&nbsp;<span class="op" id="6056125">=</span>&nbsp;<span class="ident" id="6056127">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056146">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056152">r</span><span class="op" id="6056153">.</span><span class="ident" id="6056154">err</span>&nbsp;<span class="op" id="6056158">=</span>&nbsp;<span class="ident" id="6056160">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056165">return</span><br>
<span class="lineno"></span><span class="op" id="6056172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6056175">func</span>&nbsp;<span class="op" id="6056180">(</span><span class="ident" id="6056181">r</span>&nbsp;<span class="op" id="6056183">*</span><span class="ident" id="6056184">checksumReader</span><span class="op" id="6056198">)</span>&nbsp;<span class="ident" id="6056200">Close</span><span class="op" id="6056205">(</span><span class="op" id="6056206">)</span>&nbsp;<span class="builtintype" id="6056208">error</span>&nbsp;<span class="op" id="6056214">{</span>&nbsp;<span class="keyword" id="6056216">return</span>&nbsp;<span class="ident" id="6056223">r</span><span class="op" id="6056224">.</span><span class="ident" id="6056225">rc</span><span class="op" id="6056227">.</span><span class="ident" id="6056228">Close</span><span class="op" id="6056233">(</span><span class="op" id="6056234">)</span>&nbsp;<span class="op" id="6056236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6056239">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6056311">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="6056348">func</span>&nbsp;<span class="op" id="6056353">(</span><span class="ident" id="6056354">f</span>&nbsp;<span class="op" id="6056356">*</span><span class="ident" id="6056357">File</span><span class="op" id="6056361">)</span>&nbsp;<span class="ident" id="6056363">findBodyOffset</span><span class="op" id="6056377">(</span><span class="op" id="6056378">)</span>&nbsp;<span class="op" id="6056380">(</span><span class="ident" id="6056381">int64</span><span class="op" id="6056386">,</span>&nbsp;<span class="builtintype" id="6056388">error</span><span class="op" id="6056393">)</span>&nbsp;<span class="op" id="6056395">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056398">var</span>&nbsp;<span class="ident" id="6056402">buf</span>&nbsp;<span class="op" id="6056406">[</span><span class="ident" id="6056407">fileHeaderLen</span><span class="op" id="6056420">]</span><span class="builtintype" id="6056421">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056427">if</span>&nbsp;<span class="ident" id="6056430">_</span><span class="op" id="6056431">,</span>&nbsp;<span class="ident" id="6056433">err</span>&nbsp;<span class="op" id="6056437">:=</span>&nbsp;<span class="ident" id="6056440">f</span><span class="op" id="6056441">.</span><span class="ident" id="6056442">zipr</span><span class="op" id="6056446">.</span><span class="ident" id="6056447">ReadAt</span><span class="op" id="6056453">(</span><span class="ident" id="6056454">buf</span><span class="op" id="6056457">[</span><span class="op" id="6056458">:</span><span class="op" id="6056459">]</span><span class="op" id="6056460">,</span>&nbsp;<span class="ident" id="6056462">f</span><span class="op" id="6056463">.</span><span class="ident" id="6056464">headerOffset</span><span class="op" id="6056476">)</span><span class="op" id="6056477">;</span>&nbsp;<span class="ident" id="6056479">err</span>&nbsp;<span class="op" id="6056483">!=</span>&nbsp;<span class="ident" id="6056486">nil</span>&nbsp;<span class="op" id="6056490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056494">return</span>&nbsp;<span class="num" id="6056501">0</span><span class="op" id="6056502">,</span>&nbsp;<span class="ident" id="6056504">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056512">b</span>&nbsp;<span class="op" id="6056514">:=</span>&nbsp;<span class="ident" id="6056517">readBuf</span><span class="op" id="6056524">(</span><span class="ident" id="6056525">buf</span><span class="op" id="6056528">[</span><span class="op" id="6056529">:</span><span class="op" id="6056530">]</span><span class="op" id="6056531">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056534">if</span>&nbsp;<span class="ident" id="6056537">sig</span>&nbsp;<span class="op" id="6056541">:=</span>&nbsp;<span class="ident" id="6056544">b</span><span class="op" id="6056545">.</span><span class="builtintype" id="6056546">uint32</span><span class="op" id="6056552">(</span><span class="op" id="6056553">)</span><span class="op" id="6056554">;</span>&nbsp;<span class="ident" id="6056556">sig</span>&nbsp;<span class="op" id="6056560">!=</span>&nbsp;<span class="ident" id="6056563">fileHeaderSignature</span>&nbsp;<span class="op" id="6056583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056587">return</span>&nbsp;<span class="num" id="6056594">0</span><span class="op" id="6056595">,</span>&nbsp;<span class="ident" id="6056597">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056611">b</span>&nbsp;<span class="op" id="6056613">=</span>&nbsp;<span class="ident" id="6056615">b</span><span class="op" id="6056616">[</span><span class="num" id="6056617">22</span><span class="op" id="6056619">:</span><span class="op" id="6056620">]</span>&nbsp;<span class="comment" id="6056622">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056655">filenameLen</span>&nbsp;<span class="op" id="6056667">:=</span>&nbsp;<span class="builtintype" id="6056670">int</span><span class="op" id="6056673">(</span><span class="ident" id="6056674">b</span><span class="op" id="6056675">.</span><span class="builtintype" id="6056676">uint16</span><span class="op" id="6056682">(</span><span class="op" id="6056683">)</span><span class="op" id="6056684">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056687">extraLen</span>&nbsp;<span class="op" id="6056696">:=</span>&nbsp;<span class="builtintype" id="6056699">int</span><span class="op" id="6056702">(</span><span class="ident" id="6056703">b</span><span class="op" id="6056704">.</span><span class="builtintype" id="6056705">uint16</span><span class="op" id="6056711">(</span><span class="op" id="6056712">)</span><span class="op" id="6056713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056716">return</span>&nbsp;<span class="ident" id="6056723">int64</span><span class="op" id="6056728">(</span><span class="ident" id="6056729">fileHeaderLen</span>&nbsp;<span class="op" id="6056743">+</span>&nbsp;<span class="ident" id="6056745">filenameLen</span>&nbsp;<span class="op" id="6056757">+</span>&nbsp;<span class="ident" id="6056759">extraLen</span><span class="op" id="6056767">)</span><span class="op" id="6056768">,</span>&nbsp;<span class="ident" id="6056770">nil</span><br>
<span class="lineno"></span><span class="op" id="6056774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6056777">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="6056844">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="6056915">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="6056977">func</span>&nbsp;<span class="ident" id="6056982">readDirectoryHeader</span><span class="op" id="6057001">(</span><span class="ident" id="6057002">f</span>&nbsp;<span class="op" id="6057004">*</span><span class="ident" id="6057005">File</span><span class="op" id="6057009">,</span>&nbsp;<span class="ident" id="6057011">r</span>&nbsp;<span class="ident" id="6057013">io</span><span class="op" id="6057015">.</span><span class="ident" id="6057016">Reader</span><span class="op" id="6057022">)</span>&nbsp;<span class="builtintype" id="6057024">error</span>&nbsp;<span class="op" id="6057030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057033">var</span>&nbsp;<span class="ident" id="6057037">buf</span>&nbsp;<span class="op" id="6057041">[</span><span class="ident" id="6057042">directoryHeaderLen</span><span class="op" id="6057060">]</span><span class="builtintype" id="6057061">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057067">if</span>&nbsp;<span class="ident" id="6057070">_</span><span class="op" id="6057071">,</span>&nbsp;<span class="ident" id="6057073">err</span>&nbsp;<span class="op" id="6057077">:=</span>&nbsp;<span class="ident" id="6057080">io</span><span class="op" id="6057082">.</span><span class="ident" id="6057083">ReadFull</span><span class="op" id="6057091">(</span><span class="ident" id="6057092">r</span><span class="op" id="6057093">,</span>&nbsp;<span class="ident" id="6057095">buf</span><span class="op" id="6057098">[</span><span class="op" id="6057099">:</span><span class="op" id="6057100">]</span><span class="op" id="6057101">)</span><span class="op" id="6057102">;</span>&nbsp;<span class="ident" id="6057104">err</span>&nbsp;<span class="op" id="6057108">!=</span>&nbsp;<span class="ident" id="6057111">nil</span>&nbsp;<span class="op" id="6057115">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057119">return</span>&nbsp;<span class="ident" id="6057126">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057134">b</span>&nbsp;<span class="op" id="6057136">:=</span>&nbsp;<span class="ident" id="6057139">readBuf</span><span class="op" id="6057146">(</span><span class="ident" id="6057147">buf</span><span class="op" id="6057150">[</span><span class="op" id="6057151">:</span><span class="op" id="6057152">]</span><span class="op" id="6057153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057156">if</span>&nbsp;<span class="ident" id="6057159">sig</span>&nbsp;<span class="op" id="6057163">:=</span>&nbsp;<span class="ident" id="6057166">b</span><span class="op" id="6057167">.</span><span class="builtintype" id="6057168">uint32</span><span class="op" id="6057174">(</span><span class="op" id="6057175">)</span><span class="op" id="6057176">;</span>&nbsp;<span class="ident" id="6057178">sig</span>&nbsp;<span class="op" id="6057182">!=</span>&nbsp;<span class="ident" id="6057185">directoryHeaderSignature</span>&nbsp;<span class="op" id="6057210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057214">return</span>&nbsp;<span class="ident" id="6057221">ErrFormat</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057235">f</span><span class="op" id="6057236">.</span><span class="ident" id="6057237">CreatorVersion</span>&nbsp;<span class="op" id="6057252">=</span>&nbsp;<span class="ident" id="6057254">b</span><span class="op" id="6057255">.</span><span class="builtintype" id="6057256">uint16</span><span class="op" id="6057262">(</span><span class="op" id="6057263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057266">f</span><span class="op" id="6057267">.</span><span class="ident" id="6057268">ReaderVersion</span>&nbsp;<span class="op" id="6057282">=</span>&nbsp;<span class="ident" id="6057284">b</span><span class="op" id="6057285">.</span><span class="builtintype" id="6057286">uint16</span><span class="op" id="6057292">(</span><span class="op" id="6057293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057296">f</span><span class="op" id="6057297">.</span><span class="ident" id="6057298">Flags</span>&nbsp;<span class="op" id="6057304">=</span>&nbsp;<span class="ident" id="6057306">b</span><span class="op" id="6057307">.</span><span class="builtintype" id="6057308">uint16</span><span class="op" id="6057314">(</span><span class="op" id="6057315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057318">f</span><span class="op" id="6057319">.</span><span class="ident" id="6057320">Method</span>&nbsp;<span class="op" id="6057327">=</span>&nbsp;<span class="ident" id="6057329">b</span><span class="op" id="6057330">.</span><span class="builtintype" id="6057331">uint16</span><span class="op" id="6057337">(</span><span class="op" id="6057338">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057341">f</span><span class="op" id="6057342">.</span><span class="ident" id="6057343">ModifiedTime</span>&nbsp;<span class="op" id="6057356">=</span>&nbsp;<span class="ident" id="6057358">b</span><span class="op" id="6057359">.</span><span class="builtintype" id="6057360">uint16</span><span class="op" id="6057366">(</span><span class="op" id="6057367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057370">f</span><span class="op" id="6057371">.</span><span class="ident" id="6057372">ModifiedDate</span>&nbsp;<span class="op" id="6057385">=</span>&nbsp;<span class="ident" id="6057387">b</span><span class="op" id="6057388">.</span><span class="builtintype" id="6057389">uint16</span><span class="op" id="6057395">(</span><span class="op" id="6057396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057399">f</span><span class="op" id="6057400">.</span><span class="ident" id="6057401">CRC32</span>&nbsp;<span class="op" id="6057407">=</span>&nbsp;<span class="ident" id="6057409">b</span><span class="op" id="6057410">.</span><span class="builtintype" id="6057411">uint32</span><span class="op" id="6057417">(</span><span class="op" id="6057418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057421">f</span><span class="op" id="6057422">.</span><span class="ident" id="6057423">CompressedSize</span>&nbsp;<span class="op" id="6057438">=</span>&nbsp;<span class="ident" id="6057440">b</span><span class="op" id="6057441">.</span><span class="builtintype" id="6057442">uint32</span><span class="op" id="6057448">(</span><span class="op" id="6057449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057452">f</span><span class="op" id="6057453">.</span><span class="ident" id="6057454">UncompressedSize</span>&nbsp;<span class="op" id="6057471">=</span>&nbsp;<span class="ident" id="6057473">b</span><span class="op" id="6057474">.</span><span class="builtintype" id="6057475">uint32</span><span class="op" id="6057481">(</span><span class="op" id="6057482">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057485">f</span><span class="op" id="6057486">.</span><span class="ident" id="6057487">CompressedSize64</span>&nbsp;<span class="op" id="6057504">=</span>&nbsp;<span class="ident" id="6057506">uint64</span><span class="op" id="6057512">(</span><span class="ident" id="6057513">f</span><span class="op" id="6057514">.</span><span class="ident" id="6057515">CompressedSize</span><span class="op" id="6057529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057532">f</span><span class="op" id="6057533">.</span><span class="ident" id="6057534">UncompressedSize64</span>&nbsp;<span class="op" id="6057553">=</span>&nbsp;<span class="ident" id="6057555">uint64</span><span class="op" id="6057561">(</span><span class="ident" id="6057562">f</span><span class="op" id="6057563">.</span><span class="ident" id="6057564">UncompressedSize</span><span class="op" id="6057580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057583">filenameLen</span>&nbsp;<span class="op" id="6057595">:=</span>&nbsp;<span class="builtintype" id="6057598">int</span><span class="op" id="6057601">(</span><span class="ident" id="6057602">b</span><span class="op" id="6057603">.</span><span class="builtintype" id="6057604">uint16</span><span class="op" id="6057610">(</span><span class="op" id="6057611">)</span><span class="op" id="6057612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057615">extraLen</span>&nbsp;<span class="op" id="6057624">:=</span>&nbsp;<span class="builtintype" id="6057627">int</span><span class="op" id="6057630">(</span><span class="ident" id="6057631">b</span><span class="op" id="6057632">.</span><span class="builtintype" id="6057633">uint16</span><span class="op" id="6057639">(</span><span class="op" id="6057640">)</span><span class="op" id="6057641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057644">commentLen</span>&nbsp;<span class="op" id="6057655">:=</span>&nbsp;<span class="builtintype" id="6057658">int</span><span class="op" id="6057661">(</span><span class="ident" id="6057662">b</span><span class="op" id="6057663">.</span><span class="builtintype" id="6057664">uint16</span><span class="op" id="6057670">(</span><span class="op" id="6057671">)</span><span class="op" id="6057672">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057675">b</span>&nbsp;<span class="op" id="6057677">=</span>&nbsp;<span class="ident" id="6057679">b</span><span class="op" id="6057680">[</span><span class="num" id="6057681">4</span><span class="op" id="6057682">:</span><span class="op" id="6057683">]</span>&nbsp;<span class="comment" id="6057685">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057751">f</span><span class="op" id="6057752">.</span><span class="ident" id="6057753">ExternalAttrs</span>&nbsp;<span class="op" id="6057767">=</span>&nbsp;<span class="ident" id="6057769">b</span><span class="op" id="6057770">.</span><span class="builtintype" id="6057771">uint32</span><span class="op" id="6057777">(</span><span class="op" id="6057778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057781">f</span><span class="op" id="6057782">.</span><span class="ident" id="6057783">headerOffset</span>&nbsp;<span class="op" id="6057796">=</span>&nbsp;<span class="ident" id="6057798">int64</span><span class="op" id="6057803">(</span><span class="ident" id="6057804">b</span><span class="op" id="6057805">.</span><span class="builtintype" id="6057806">uint32</span><span class="op" id="6057812">(</span><span class="op" id="6057813">)</span><span class="op" id="6057814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057817">d</span>&nbsp;<span class="op" id="6057819">:=</span>&nbsp;<span class="builtinfunc" id="6057822">make</span><span class="op" id="6057826">(</span><span class="op" id="6057827">[</span><span class="op" id="6057828">]</span><span class="builtintype" id="6057829">byte</span><span class="op" id="6057833">,</span>&nbsp;<span class="ident" id="6057835">filenameLen</span><span class="op" id="6057846">+</span><span class="ident" id="6057847">extraLen</span><span class="op" id="6057855">+</span><span class="ident" id="6057856">commentLen</span><span class="op" id="6057866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057869">if</span>&nbsp;<span class="ident" id="6057872">_</span><span class="op" id="6057873">,</span>&nbsp;<span class="ident" id="6057875">err</span>&nbsp;<span class="op" id="6057879">:=</span>&nbsp;<span class="ident" id="6057882">io</span><span class="op" id="6057884">.</span><span class="ident" id="6057885">ReadFull</span><span class="op" id="6057893">(</span><span class="ident" id="6057894">r</span><span class="op" id="6057895">,</span>&nbsp;<span class="ident" id="6057897">d</span><span class="op" id="6057898">)</span><span class="op" id="6057899">;</span>&nbsp;<span class="ident" id="6057901">err</span>&nbsp;<span class="op" id="6057905">!=</span>&nbsp;<span class="ident" id="6057908">nil</span>&nbsp;<span class="op" id="6057912">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057916">return</span>&nbsp;<span class="ident" id="6057923">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057931">f</span><span class="op" id="6057932">.</span><span class="ident" id="6057933">Name</span>&nbsp;<span class="op" id="6057938">=</span>&nbsp;<span class="builtintype" id="6057940">string</span><span class="op" id="6057946">(</span><span class="ident" id="6057947">d</span><span class="op" id="6057948">[</span><span class="op" id="6057949">:</span><span class="ident" id="6057950">filenameLen</span><span class="op" id="6057961">]</span><span class="op" id="6057962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057965">f</span><span class="op" id="6057966">.</span><span class="ident" id="6057967">Extra</span>&nbsp;<span class="op" id="6057973">=</span>&nbsp;<span class="ident" id="6057975">d</span><span class="op" id="6057976">[</span><span class="ident" id="6057977">filenameLen</span>&nbsp;<span class="op" id="6057989">:</span>&nbsp;<span class="ident" id="6057991">filenameLen</span><span class="op" id="6058002">+</span><span class="ident" id="6058003">extraLen</span><span class="op" id="6058011">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058014">f</span><span class="op" id="6058015">.</span><span class="ident" id="6058016">Comment</span>&nbsp;<span class="op" id="6058024">=</span>&nbsp;<span class="builtintype" id="6058026">string</span><span class="op" id="6058032">(</span><span class="ident" id="6058033">d</span><span class="op" id="6058034">[</span><span class="ident" id="6058035">filenameLen</span><span class="op" id="6058046">+</span><span class="ident" id="6058047">extraLen</span><span class="op" id="6058055">:</span><span class="op" id="6058056">]</span><span class="op" id="6058057">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058061">if</span>&nbsp;<span class="builtinfunc" id="6058064">len</span><span class="op" id="6058067">(</span><span class="ident" id="6058068">f</span><span class="op" id="6058069">.</span><span class="ident" id="6058070">Extra</span><span class="op" id="6058075">)</span>&nbsp;<span class="op" id="6058077">&gt;</span>&nbsp;<span class="num" id="6058079">0</span>&nbsp;<span class="op" id="6058081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058085">b</span>&nbsp;<span class="op" id="6058087">:=</span>&nbsp;<span class="ident" id="6058090">readBuf</span><span class="op" id="6058097">(</span><span class="ident" id="6058098">f</span><span class="op" id="6058099">.</span><span class="ident" id="6058100">Extra</span><span class="op" id="6058105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058109">for</span>&nbsp;<span class="builtinfunc" id="6058113">len</span><span class="op" id="6058116">(</span><span class="ident" id="6058117">b</span><span class="op" id="6058118">)</span>&nbsp;<span class="op" id="6058120">&gt;=</span>&nbsp;<span class="num" id="6058123">4</span>&nbsp;<span class="op" id="6058125">{</span>&nbsp;<span class="comment" id="6058127">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058160">tag</span>&nbsp;<span class="op" id="6058164">:=</span>&nbsp;<span class="ident" id="6058167">b</span><span class="op" id="6058168">.</span><span class="builtintype" id="6058169">uint16</span><span class="op" id="6058175">(</span><span class="op" id="6058176">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058181">size</span>&nbsp;<span class="op" id="6058186">:=</span>&nbsp;<span class="ident" id="6058189">b</span><span class="op" id="6058190">.</span><span class="builtintype" id="6058191">uint16</span><span class="op" id="6058197">(</span><span class="op" id="6058198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058203">if</span>&nbsp;<span class="builtintype" id="6058206">int</span><span class="op" id="6058209">(</span><span class="ident" id="6058210">size</span><span class="op" id="6058214">)</span>&nbsp;<span class="op" id="6058216">&gt;</span>&nbsp;<span class="builtinfunc" id="6058218">len</span><span class="op" id="6058221">(</span><span class="ident" id="6058222">b</span><span class="op" id="6058223">)</span>&nbsp;<span class="op" id="6058225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058231">return</span>&nbsp;<span class="ident" id="6058238">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058256">if</span>&nbsp;<span class="ident" id="6058259">tag</span>&nbsp;<span class="op" id="6058263">==</span>&nbsp;<span class="ident" id="6058266">zip64ExtraId</span>&nbsp;<span class="op" id="6058279">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6058285">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058343">eb</span>&nbsp;<span class="op" id="6058346">:=</span>&nbsp;<span class="ident" id="6058349">readBuf</span><span class="op" id="6058356">(</span><span class="ident" id="6058357">b</span><span class="op" id="6058358">[</span><span class="op" id="6058359">:</span><span class="ident" id="6058360">size</span><span class="op" id="6058364">]</span><span class="op" id="6058365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058371">if</span>&nbsp;<span class="builtinfunc" id="6058374">len</span><span class="op" id="6058377">(</span><span class="ident" id="6058378">eb</span><span class="op" id="6058380">)</span>&nbsp;<span class="op" id="6058382">&gt;=</span>&nbsp;<span class="num" id="6058385">8</span>&nbsp;<span class="op" id="6058387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058394">f</span><span class="op" id="6058395">.</span><span class="ident" id="6058396">UncompressedSize64</span>&nbsp;<span class="op" id="6058415">=</span>&nbsp;<span class="ident" id="6058417">eb</span><span class="op" id="6058419">.</span><span class="ident" id="6058420">uint64</span><span class="op" id="6058426">(</span><span class="op" id="6058427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058433">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058439">if</span>&nbsp;<span class="builtinfunc" id="6058442">len</span><span class="op" id="6058445">(</span><span class="ident" id="6058446">eb</span><span class="op" id="6058448">)</span>&nbsp;<span class="op" id="6058450">&gt;=</span>&nbsp;<span class="num" id="6058453">8</span>&nbsp;<span class="op" id="6058455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058462">f</span><span class="op" id="6058463">.</span><span class="ident" id="6058464">CompressedSize64</span>&nbsp;<span class="op" id="6058481">=</span>&nbsp;<span class="ident" id="6058483">eb</span><span class="op" id="6058485">.</span><span class="ident" id="6058486">uint64</span><span class="op" id="6058492">(</span><span class="op" id="6058493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058505">if</span>&nbsp;<span class="builtinfunc" id="6058508">len</span><span class="op" id="6058511">(</span><span class="ident" id="6058512">eb</span><span class="op" id="6058514">)</span>&nbsp;<span class="op" id="6058516">&gt;=</span>&nbsp;<span class="num" id="6058519">8</span>&nbsp;<span class="op" id="6058521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058528">f</span><span class="op" id="6058529">.</span><span class="ident" id="6058530">headerOffset</span>&nbsp;<span class="op" id="6058543">=</span>&nbsp;<span class="ident" id="6058545">int64</span><span class="op" id="6058550">(</span><span class="ident" id="6058551">eb</span><span class="op" id="6058553">.</span><span class="ident" id="6058554">uint64</span><span class="op" id="6058560">(</span><span class="op" id="6058561">)</span><span class="op" id="6058562">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058578">b</span>&nbsp;<span class="op" id="6058580">=</span>&nbsp;<span class="ident" id="6058582">b</span><span class="op" id="6058583">[</span><span class="ident" id="6058584">size</span><span class="op" id="6058588">:</span><span class="op" id="6058589">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6058597">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6058641">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6058698">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6058751">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058788">for</span>&nbsp;<span class="ident" id="6058792">_</span><span class="op" id="6058793">,</span>&nbsp;<span class="ident" id="6058795">v</span>&nbsp;<span class="op" id="6058797">:=</span>&nbsp;<span class="keyword" id="6058800">range</span>&nbsp;<span class="ident" id="6058806">b</span>&nbsp;<span class="op" id="6058808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058813">if</span>&nbsp;<span class="ident" id="6058816">v</span>&nbsp;<span class="op" id="6058818">!=</span>&nbsp;<span class="num" id="6058821">0</span>&nbsp;<span class="op" id="6058823">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058829">return</span>&nbsp;<span class="ident" id="6058836">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058859">return</span>&nbsp;<span class="ident" id="6058866">nil</span><br>
<span class="lineno">280</span><span class="op" id="6058870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6058873">func</span>&nbsp;<span class="ident" id="6058878">readDataDescriptor</span><span class="op" id="6058896">(</span><span class="ident" id="6058897">r</span>&nbsp;<span class="ident" id="6058899">io</span><span class="op" id="6058901">.</span><span class="ident" id="6058902">Reader</span><span class="op" id="6058908">,</span>&nbsp;<span class="ident" id="6058910">f</span>&nbsp;<span class="op" id="6058912">*</span><span class="ident" id="6058913">File</span><span class="op" id="6058917">)</span>&nbsp;<span class="builtintype" id="6058919">error</span>&nbsp;<span class="op" id="6058925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058928">var</span>&nbsp;<span class="ident" id="6058932">buf</span>&nbsp;<span class="op" id="6058936">[</span><span class="ident" id="6058937">dataDescriptorLen</span><span class="op" id="6058954">]</span><span class="builtintype" id="6058955">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6058962">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059017">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059079">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059136">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059191">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059251">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059315">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059355">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059359">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059420">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059475">if</span>&nbsp;<span class="ident" id="6059478">_</span><span class="op" id="6059479">,</span>&nbsp;<span class="ident" id="6059481">err</span>&nbsp;<span class="op" id="6059485">:=</span>&nbsp;<span class="ident" id="6059488">io</span><span class="op" id="6059490">.</span><span class="ident" id="6059491">ReadFull</span><span class="op" id="6059499">(</span><span class="ident" id="6059500">r</span><span class="op" id="6059501">,</span>&nbsp;<span class="ident" id="6059503">buf</span><span class="op" id="6059506">[</span><span class="op" id="6059507">:</span><span class="num" id="6059508">4</span><span class="op" id="6059509">]</span><span class="op" id="6059510">)</span><span class="op" id="6059511">;</span>&nbsp;<span class="ident" id="6059513">err</span>&nbsp;<span class="op" id="6059517">!=</span>&nbsp;<span class="ident" id="6059520">nil</span>&nbsp;<span class="op" id="6059524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059528">return</span>&nbsp;<span class="ident" id="6059535">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059543">off</span>&nbsp;<span class="op" id="6059547">:=</span>&nbsp;<span class="num" id="6059550">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059553">maybeSig</span>&nbsp;<span class="op" id="6059562">:=</span>&nbsp;<span class="ident" id="6059565">readBuf</span><span class="op" id="6059572">(</span><span class="ident" id="6059573">buf</span><span class="op" id="6059576">[</span><span class="op" id="6059577">:</span><span class="num" id="6059578">4</span><span class="op" id="6059579">]</span><span class="op" id="6059580">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059583">if</span>&nbsp;<span class="ident" id="6059586">maybeSig</span><span class="op" id="6059594">.</span><span class="builtintype" id="6059595">uint32</span><span class="op" id="6059601">(</span><span class="op" id="6059602">)</span>&nbsp;<span class="op" id="6059604">!=</span>&nbsp;<span class="ident" id="6059607">dataDescriptorSignature</span>&nbsp;<span class="op" id="6059631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059635">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059686">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059698">off</span>&nbsp;<span class="op" id="6059702">+=</span>&nbsp;<span class="num" id="6059705">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059708">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059711">if</span>&nbsp;<span class="ident" id="6059714">_</span><span class="op" id="6059715">,</span>&nbsp;<span class="ident" id="6059717">err</span>&nbsp;<span class="op" id="6059721">:=</span>&nbsp;<span class="ident" id="6059724">io</span><span class="op" id="6059726">.</span><span class="ident" id="6059727">ReadFull</span><span class="op" id="6059735">(</span><span class="ident" id="6059736">r</span><span class="op" id="6059737">,</span>&nbsp;<span class="ident" id="6059739">buf</span><span class="op" id="6059742">[</span><span class="ident" id="6059743">off</span><span class="op" id="6059746">:</span><span class="num" id="6059747">12</span><span class="op" id="6059749">]</span><span class="op" id="6059750">)</span><span class="op" id="6059751">;</span>&nbsp;<span class="ident" id="6059753">err</span>&nbsp;<span class="op" id="6059757">!=</span>&nbsp;<span class="ident" id="6059760">nil</span>&nbsp;<span class="op" id="6059764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059768">return</span>&nbsp;<span class="ident" id="6059775">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059783">b</span>&nbsp;<span class="op" id="6059785">:=</span>&nbsp;<span class="ident" id="6059788">readBuf</span><span class="op" id="6059795">(</span><span class="ident" id="6059796">buf</span><span class="op" id="6059799">[</span><span class="op" id="6059800">:</span><span class="num" id="6059801">12</span><span class="op" id="6059803">]</span><span class="op" id="6059804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059807">if</span>&nbsp;<span class="ident" id="6059810">b</span><span class="op" id="6059811">.</span><span class="builtintype" id="6059812">uint32</span><span class="op" id="6059818">(</span><span class="op" id="6059819">)</span>&nbsp;<span class="op" id="6059821">!=</span>&nbsp;<span class="ident" id="6059824">f</span><span class="op" id="6059825">.</span><span class="ident" id="6059826">CRC32</span>&nbsp;<span class="op" id="6059832">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059836">return</span>&nbsp;<span class="ident" id="6059843">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059860">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059928">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059985">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6060049">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6060113">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060137">return</span>&nbsp;<span class="ident" id="6060144">nil</span><br>
<span class="lineno">320</span><span class="op" id="6060148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6060151">func</span>&nbsp;<span class="ident" id="6060156">readDirectoryEnd</span><span class="op" id="6060172">(</span><span class="ident" id="6060173">r</span>&nbsp;<span class="ident" id="6060175">io</span><span class="op" id="6060177">.</span><span class="ident" id="6060178">ReaderAt</span><span class="op" id="6060186">,</span>&nbsp;<span class="ident" id="6060188">size</span>&nbsp;<span class="ident" id="6060193">int64</span><span class="op" id="6060198">)</span>&nbsp;<span class="op" id="6060200">(</span><span class="ident" id="6060201">dir</span>&nbsp;<span class="op" id="6060205">*</span><span class="ident" id="6060206">directoryEnd</span><span class="op" id="6060218">,</span>&nbsp;<span class="ident" id="6060220">err</span>&nbsp;<span class="builtintype" id="6060224">error</span><span class="op" id="6060229">)</span>&nbsp;<span class="op" id="6060231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6060234">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060306">var</span>&nbsp;<span class="ident" id="6060310">buf</span>&nbsp;<span class="op" id="6060314">[</span><span class="op" id="6060315">]</span><span class="builtintype" id="6060316">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060322">var</span>&nbsp;<span class="ident" id="6060326">directoryEndOffset</span>&nbsp;<span class="ident" id="6060345">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060352">for</span>&nbsp;<span class="ident" id="6060356">i</span><span class="op" id="6060357">,</span>&nbsp;<span class="ident" id="6060359">bLen</span>&nbsp;<span class="op" id="6060364">:=</span>&nbsp;<span class="keyword" id="6060367">range</span>&nbsp;<span class="op" id="6060373">[</span><span class="op" id="6060374">]</span><span class="ident" id="6060375">int64</span><span class="op" id="6060380">{</span><span class="num" id="6060381">1024</span><span class="op" id="6060385">,</span>&nbsp;<span class="num" id="6060387">65</span>&nbsp;<span class="op" id="6060390">*</span>&nbsp;<span class="num" id="6060392">1024</span><span class="op" id="6060396">}</span>&nbsp;<span class="op" id="6060398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060402">if</span>&nbsp;<span class="ident" id="6060405">bLen</span>&nbsp;<span class="op" id="6060410">&gt;</span>&nbsp;<span class="ident" id="6060412">size</span>&nbsp;<span class="op" id="6060417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060422">bLen</span>&nbsp;<span class="op" id="6060427">=</span>&nbsp;<span class="ident" id="6060429">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060436">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060440">buf</span>&nbsp;<span class="op" id="6060444">=</span>&nbsp;<span class="builtinfunc" id="6060446">make</span><span class="op" id="6060450">(</span><span class="op" id="6060451">[</span><span class="op" id="6060452">]</span><span class="builtintype" id="6060453">byte</span><span class="op" id="6060457">,</span>&nbsp;<span class="builtintype" id="6060459">int</span><span class="op" id="6060462">(</span><span class="ident" id="6060463">bLen</span><span class="op" id="6060467">)</span><span class="op" id="6060468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060472">if</span>&nbsp;<span class="ident" id="6060475">_</span><span class="op" id="6060476">,</span>&nbsp;<span class="ident" id="6060478">err</span>&nbsp;<span class="op" id="6060482">:=</span>&nbsp;<span class="ident" id="6060485">r</span><span class="op" id="6060486">.</span><span class="ident" id="6060487">ReadAt</span><span class="op" id="6060493">(</span><span class="ident" id="6060494">buf</span><span class="op" id="6060497">,</span>&nbsp;<span class="ident" id="6060499">size</span><span class="op" id="6060503">-</span><span class="ident" id="6060504">bLen</span><span class="op" id="6060508">)</span><span class="op" id="6060509">;</span>&nbsp;<span class="ident" id="6060511">err</span>&nbsp;<span class="op" id="6060515">!=</span>&nbsp;<span class="ident" id="6060518">nil</span>&nbsp;<span class="op" id="6060522">&amp;&amp;</span>&nbsp;<span class="ident" id="6060525">err</span>&nbsp;<span class="op" id="6060529">!=</span>&nbsp;<span class="ident" id="6060532">io</span><span class="op" id="6060534">.</span><span class="ident" id="6060535">EOF</span>&nbsp;<span class="op" id="6060539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060544">return</span>&nbsp;<span class="ident" id="6060551">nil</span><span class="op" id="6060554">,</span>&nbsp;<span class="ident" id="6060556">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060566">if</span>&nbsp;<span class="ident" id="6060569">p</span>&nbsp;<span class="op" id="6060571">:=</span>&nbsp;<span class="ident" id="6060574">findSignatureInBlock</span><span class="op" id="6060594">(</span><span class="ident" id="6060595">buf</span><span class="op" id="6060598">)</span><span class="op" id="6060599">;</span>&nbsp;<span class="ident" id="6060601">p</span>&nbsp;<span class="op" id="6060603">&gt;=</span>&nbsp;<span class="num" id="6060606">0</span>&nbsp;<span class="op" id="6060608">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060613">buf</span>&nbsp;<span class="op" id="6060617">=</span>&nbsp;<span class="ident" id="6060619">buf</span><span class="op" id="6060622">[</span><span class="ident" id="6060623">p</span><span class="op" id="6060624">:</span><span class="op" id="6060625">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060630">directoryEndOffset</span>&nbsp;<span class="op" id="6060649">=</span>&nbsp;<span class="ident" id="6060651">size</span>&nbsp;<span class="op" id="6060656">-</span>&nbsp;<span class="ident" id="6060658">bLen</span>&nbsp;<span class="op" id="6060663">+</span>&nbsp;<span class="ident" id="6060665">int64</span><span class="op" id="6060670">(</span><span class="ident" id="6060671">p</span><span class="op" id="6060672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060677">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060689">if</span>&nbsp;<span class="ident" id="6060692">i</span>&nbsp;<span class="op" id="6060694">==</span>&nbsp;<span class="num" id="6060697">1</span>&nbsp;<span class="op" id="6060699">||</span>&nbsp;<span class="ident" id="6060702">bLen</span>&nbsp;<span class="op" id="6060707">==</span>&nbsp;<span class="ident" id="6060710">size</span>&nbsp;<span class="op" id="6060715">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060720">return</span>&nbsp;<span class="ident" id="6060727">nil</span><span class="op" id="6060730">,</span>&nbsp;<span class="ident" id="6060732">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6060751">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060779">b</span>&nbsp;<span class="op" id="6060781">:=</span>&nbsp;<span class="ident" id="6060784">readBuf</span><span class="op" id="6060791">(</span><span class="ident" id="6060792">buf</span><span class="op" id="6060795">[</span><span class="num" id="6060796">4</span><span class="op" id="6060797">:</span><span class="op" id="6060798">]</span><span class="op" id="6060799">)</span>&nbsp;<span class="comment" id="6060801">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060820">d</span>&nbsp;<span class="op" id="6060822">:=</span>&nbsp;<span class="op" id="6060825">&amp;</span><span class="ident" id="6060826">directoryEnd</span><span class="op" id="6060838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060842">diskNbr</span><span class="op" id="6060849">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6060862">uint32</span><span class="op" id="6060868">(</span><span class="ident" id="6060869">b</span><span class="op" id="6060870">.</span><span class="builtintype" id="6060871">uint16</span><span class="op" id="6060877">(</span><span class="op" id="6060878">)</span><span class="op" id="6060879">)</span><span class="op" id="6060880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060884">dirDiskNbr</span><span class="op" id="6060894">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6060904">uint32</span><span class="op" id="6060910">(</span><span class="ident" id="6060911">b</span><span class="op" id="6060912">.</span><span class="builtintype" id="6060913">uint16</span><span class="op" id="6060919">(</span><span class="op" id="6060920">)</span><span class="op" id="6060921">)</span><span class="op" id="6060922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060926">dirRecordsThisDisk</span><span class="op" id="6060944">:</span>&nbsp;<span class="ident" id="6060946">uint64</span><span class="op" id="6060952">(</span><span class="ident" id="6060953">b</span><span class="op" id="6060954">.</span><span class="builtintype" id="6060955">uint16</span><span class="op" id="6060961">(</span><span class="op" id="6060962">)</span><span class="op" id="6060963">)</span><span class="op" id="6060964">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060968">directoryRecords</span><span class="op" id="6060984">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6060988">uint64</span><span class="op" id="6060994">(</span><span class="ident" id="6060995">b</span><span class="op" id="6060996">.</span><span class="builtintype" id="6060997">uint16</span><span class="op" id="6061003">(</span><span class="op" id="6061004">)</span><span class="op" id="6061005">)</span><span class="op" id="6061006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061010">directorySize</span><span class="op" id="6061023">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061030">uint64</span><span class="op" id="6061036">(</span><span class="ident" id="6061037">b</span><span class="op" id="6061038">.</span><span class="builtintype" id="6061039">uint32</span><span class="op" id="6061045">(</span><span class="op" id="6061046">)</span><span class="op" id="6061047">)</span><span class="op" id="6061048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061052">directoryOffset</span><span class="op" id="6061067">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061072">uint64</span><span class="op" id="6061078">(</span><span class="ident" id="6061079">b</span><span class="op" id="6061080">.</span><span class="builtintype" id="6061081">uint32</span><span class="op" id="6061087">(</span><span class="op" id="6061088">)</span><span class="op" id="6061089">)</span><span class="op" id="6061090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061094">commentLen</span><span class="op" id="6061104">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061114">b</span><span class="op" id="6061115">.</span><span class="builtintype" id="6061116">uint16</span><span class="op" id="6061122">(</span><span class="op" id="6061123">)</span><span class="op" id="6061124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061127">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061130">l</span>&nbsp;<span class="op" id="6061132">:=</span>&nbsp;<span class="builtintype" id="6061135">int</span><span class="op" id="6061138">(</span><span class="ident" id="6061139">d</span><span class="op" id="6061140">.</span><span class="ident" id="6061141">commentLen</span><span class="op" id="6061151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061154">if</span>&nbsp;<span class="ident" id="6061157">l</span>&nbsp;<span class="op" id="6061159">&gt;</span>&nbsp;<span class="builtinfunc" id="6061161">len</span><span class="op" id="6061164">(</span><span class="ident" id="6061165">b</span><span class="op" id="6061166">)</span>&nbsp;<span class="op" id="6061168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061172">return</span>&nbsp;<span class="ident" id="6061179">nil</span><span class="op" id="6061182">,</span>&nbsp;<span class="ident" id="6061184">errors</span><span class="op" id="6061190">.</span><span class="ident" id="6061191">New</span><span class="op" id="6061194">(</span><span class="string" id="6061195">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="6061224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061230">d</span><span class="op" id="6061231">.</span><span class="ident" id="6061232">comment</span>&nbsp;<span class="op" id="6061240">=</span>&nbsp;<span class="builtintype" id="6061242">string</span><span class="op" id="6061248">(</span><span class="ident" id="6061249">b</span><span class="op" id="6061250">[</span><span class="op" id="6061251">:</span><span class="ident" id="6061252">l</span><span class="op" id="6061253">]</span><span class="op" id="6061254">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061258">p</span><span class="op" id="6061259">,</span>&nbsp;<span class="ident" id="6061261">err</span>&nbsp;<span class="op" id="6061265">:=</span>&nbsp;<span class="ident" id="6061268">findDirectory64End</span><span class="op" id="6061286">(</span><span class="ident" id="6061287">r</span><span class="op" id="6061288">,</span>&nbsp;<span class="ident" id="6061290">directoryEndOffset</span><span class="op" id="6061308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061311">if</span>&nbsp;<span class="ident" id="6061314">err</span>&nbsp;<span class="op" id="6061318">==</span>&nbsp;<span class="ident" id="6061321">nil</span>&nbsp;<span class="op" id="6061325">&amp;&amp;</span>&nbsp;<span class="ident" id="6061328">p</span>&nbsp;<span class="op" id="6061330">&gt;=</span>&nbsp;<span class="num" id="6061333">0</span>&nbsp;<span class="op" id="6061335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061339">err</span>&nbsp;<span class="op" id="6061343">=</span>&nbsp;<span class="ident" id="6061345">readDirectory64End</span><span class="op" id="6061363">(</span><span class="ident" id="6061364">r</span><span class="op" id="6061365">,</span>&nbsp;<span class="ident" id="6061367">p</span><span class="op" id="6061368">,</span>&nbsp;<span class="ident" id="6061370">d</span><span class="op" id="6061371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061374">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061377">if</span>&nbsp;<span class="ident" id="6061380">err</span>&nbsp;<span class="op" id="6061384">!=</span>&nbsp;<span class="ident" id="6061387">nil</span>&nbsp;<span class="op" id="6061391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061395">return</span>&nbsp;<span class="ident" id="6061402">nil</span><span class="op" id="6061405">,</span>&nbsp;<span class="ident" id="6061407">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6061416">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061479">if</span>&nbsp;<span class="ident" id="6061482">o</span>&nbsp;<span class="op" id="6061484">:=</span>&nbsp;<span class="ident" id="6061487">int64</span><span class="op" id="6061492">(</span><span class="ident" id="6061493">d</span><span class="op" id="6061494">.</span><span class="ident" id="6061495">directoryOffset</span><span class="op" id="6061510">)</span><span class="op" id="6061511">;</span>&nbsp;<span class="ident" id="6061513">o</span>&nbsp;<span class="op" id="6061515">&lt;</span>&nbsp;<span class="num" id="6061517">0</span>&nbsp;<span class="op" id="6061519">||</span>&nbsp;<span class="ident" id="6061522">o</span>&nbsp;<span class="op" id="6061524">&gt;=</span>&nbsp;<span class="ident" id="6061527">size</span>&nbsp;<span class="op" id="6061532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061536">return</span>&nbsp;<span class="ident" id="6061543">nil</span><span class="op" id="6061546">,</span>&nbsp;<span class="ident" id="6061548">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061562">return</span>&nbsp;<span class="ident" id="6061569">d</span><span class="op" id="6061570">,</span>&nbsp;<span class="ident" id="6061572">nil</span><br>
<span class="lineno"></span><span class="op" id="6061576">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6061579">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6061649">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6061719">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="6061729">func</span>&nbsp;<span class="ident" id="6061734">findDirectory64End</span><span class="op" id="6061752">(</span><span class="ident" id="6061753">r</span>&nbsp;<span class="ident" id="6061755">io</span><span class="op" id="6061757">.</span><span class="ident" id="6061758">ReaderAt</span><span class="op" id="6061766">,</span>&nbsp;<span class="ident" id="6061768">directoryEndOffset</span>&nbsp;<span class="ident" id="6061787">int64</span><span class="op" id="6061792">)</span>&nbsp;<span class="op" id="6061794">(</span><span class="ident" id="6061795">int64</span><span class="op" id="6061800">,</span>&nbsp;<span class="builtintype" id="6061802">error</span><span class="op" id="6061807">)</span>&nbsp;<span class="op" id="6061809">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061812">locOffset</span>&nbsp;<span class="op" id="6061822">:=</span>&nbsp;<span class="ident" id="6061825">directoryEndOffset</span>&nbsp;<span class="op" id="6061844">-</span>&nbsp;<span class="ident" id="6061846">directory64LocLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061865">if</span>&nbsp;<span class="ident" id="6061868">locOffset</span>&nbsp;<span class="op" id="6061878">&lt;</span>&nbsp;<span class="num" id="6061880">0</span>&nbsp;<span class="op" id="6061882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061886">return</span>&nbsp;<span class="op" id="6061893">-</span><span class="num" id="6061894">1</span><span class="op" id="6061895">,</span>&nbsp;<span class="ident" id="6061897">nil</span>&nbsp;<span class="comment" id="6061901">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061954">buf</span>&nbsp;<span class="op" id="6061958">:=</span>&nbsp;<span class="builtinfunc" id="6061961">make</span><span class="op" id="6061965">(</span><span class="op" id="6061966">[</span><span class="op" id="6061967">]</span><span class="builtintype" id="6061968">byte</span><span class="op" id="6061972">,</span>&nbsp;<span class="ident" id="6061974">directory64LocLen</span><span class="op" id="6061991">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061994">if</span>&nbsp;<span class="ident" id="6061997">_</span><span class="op" id="6061998">,</span>&nbsp;<span class="ident" id="6062000">err</span>&nbsp;<span class="op" id="6062004">:=</span>&nbsp;<span class="ident" id="6062007">r</span><span class="op" id="6062008">.</span><span class="ident" id="6062009">ReadAt</span><span class="op" id="6062015">(</span><span class="ident" id="6062016">buf</span><span class="op" id="6062019">,</span>&nbsp;<span class="ident" id="6062021">locOffset</span><span class="op" id="6062030">)</span><span class="op" id="6062031">;</span>&nbsp;<span class="ident" id="6062033">err</span>&nbsp;<span class="op" id="6062037">!=</span>&nbsp;<span class="ident" id="6062040">nil</span>&nbsp;<span class="op" id="6062044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062048">return</span>&nbsp;<span class="op" id="6062055">-</span><span class="num" id="6062056">1</span><span class="op" id="6062057">,</span>&nbsp;<span class="ident" id="6062059">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062067">b</span>&nbsp;<span class="op" id="6062069">:=</span>&nbsp;<span class="ident" id="6062072">readBuf</span><span class="op" id="6062079">(</span><span class="ident" id="6062080">buf</span><span class="op" id="6062083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062086">if</span>&nbsp;<span class="ident" id="6062089">sig</span>&nbsp;<span class="op" id="6062093">:=</span>&nbsp;<span class="ident" id="6062096">b</span><span class="op" id="6062097">.</span><span class="builtintype" id="6062098">uint32</span><span class="op" id="6062104">(</span><span class="op" id="6062105">)</span><span class="op" id="6062106">;</span>&nbsp;<span class="ident" id="6062108">sig</span>&nbsp;<span class="op" id="6062112">!=</span>&nbsp;<span class="ident" id="6062115">directory64LocSignature</span>&nbsp;<span class="op" id="6062139">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062143">return</span>&nbsp;<span class="op" id="6062150">-</span><span class="num" id="6062151">1</span><span class="op" id="6062152">,</span>&nbsp;<span class="ident" id="6062154">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062162">b</span>&nbsp;<span class="op" id="6062164">=</span>&nbsp;<span class="ident" id="6062166">b</span><span class="op" id="6062167">[</span><span class="num" id="6062168">4</span><span class="op" id="6062169">:</span><span class="op" id="6062170">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6062178">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062259">p</span>&nbsp;<span class="op" id="6062261">:=</span>&nbsp;<span class="ident" id="6062264">b</span><span class="op" id="6062265">.</span><span class="ident" id="6062266">uint64</span><span class="op" id="6062272">(</span><span class="op" id="6062273">)</span>&nbsp;<span class="comment" id="6062275">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062340">return</span>&nbsp;<span class="ident" id="6062347">int64</span><span class="op" id="6062352">(</span><span class="ident" id="6062353">p</span><span class="op" id="6062354">)</span><span class="op" id="6062355">,</span>&nbsp;<span class="ident" id="6062357">nil</span><br>
<span class="lineno">395</span><span class="op" id="6062361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6062364">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6062432">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="6062486">func</span>&nbsp;<span class="ident" id="6062491">readDirectory64End</span><span class="op" id="6062509">(</span><span class="ident" id="6062510">r</span>&nbsp;<span class="ident" id="6062512">io</span><span class="op" id="6062514">.</span><span class="ident" id="6062515">ReaderAt</span><span class="op" id="6062523">,</span>&nbsp;<span class="ident" id="6062525">offset</span>&nbsp;<span class="ident" id="6062532">int64</span><span class="op" id="6062537">,</span>&nbsp;<span class="ident" id="6062539">d</span>&nbsp;<span class="op" id="6062541">*</span><span class="ident" id="6062542">directoryEnd</span><span class="op" id="6062554">)</span>&nbsp;<span class="op" id="6062556">(</span><span class="ident" id="6062557">err</span>&nbsp;<span class="builtintype" id="6062561">error</span><span class="op" id="6062566">)</span>&nbsp;<span class="op" id="6062568">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062571">buf</span>&nbsp;<span class="op" id="6062575">:=</span>&nbsp;<span class="builtinfunc" id="6062578">make</span><span class="op" id="6062582">(</span><span class="op" id="6062583">[</span><span class="op" id="6062584">]</span><span class="builtintype" id="6062585">byte</span><span class="op" id="6062589">,</span>&nbsp;<span class="ident" id="6062591">directory64EndLen</span><span class="op" id="6062608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062611">if</span>&nbsp;<span class="ident" id="6062614">_</span><span class="op" id="6062615">,</span>&nbsp;<span class="ident" id="6062617">err</span>&nbsp;<span class="op" id="6062621">:=</span>&nbsp;<span class="ident" id="6062624">r</span><span class="op" id="6062625">.</span><span class="ident" id="6062626">ReadAt</span><span class="op" id="6062632">(</span><span class="ident" id="6062633">buf</span><span class="op" id="6062636">,</span>&nbsp;<span class="ident" id="6062638">offset</span><span class="op" id="6062644">)</span><span class="op" id="6062645">;</span>&nbsp;<span class="ident" id="6062647">err</span>&nbsp;<span class="op" id="6062651">!=</span>&nbsp;<span class="ident" id="6062654">nil</span>&nbsp;<span class="op" id="6062658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062662">return</span>&nbsp;<span class="ident" id="6062669">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062678">b</span>&nbsp;<span class="op" id="6062680">:=</span>&nbsp;<span class="ident" id="6062683">readBuf</span><span class="op" id="6062690">(</span><span class="ident" id="6062691">buf</span><span class="op" id="6062694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062697">if</span>&nbsp;<span class="ident" id="6062700">sig</span>&nbsp;<span class="op" id="6062704">:=</span>&nbsp;<span class="ident" id="6062707">b</span><span class="op" id="6062708">.</span><span class="builtintype" id="6062709">uint32</span><span class="op" id="6062715">(</span><span class="op" id="6062716">)</span><span class="op" id="6062717">;</span>&nbsp;<span class="ident" id="6062719">sig</span>&nbsp;<span class="op" id="6062723">!=</span>&nbsp;<span class="ident" id="6062726">directory64EndSignature</span>&nbsp;<span class="op" id="6062750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062754">return</span>&nbsp;<span class="ident" id="6062761">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062776">b</span>&nbsp;<span class="op" id="6062778">=</span>&nbsp;<span class="ident" id="6062780">b</span><span class="op" id="6062781">[</span><span class="num" id="6062782">12</span><span class="op" id="6062784">:</span><span class="op" id="6062785">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6062810">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062877">d</span><span class="op" id="6062878">.</span><span class="ident" id="6062879">diskNbr</span>&nbsp;<span class="op" id="6062887">=</span>&nbsp;<span class="ident" id="6062889">b</span><span class="op" id="6062890">.</span><span class="builtintype" id="6062891">uint32</span><span class="op" id="6062897">(</span><span class="op" id="6062898">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6062911">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062935">d</span><span class="op" id="6062936">.</span><span class="ident" id="6062937">dirDiskNbr</span>&nbsp;<span class="op" id="6062948">=</span>&nbsp;<span class="ident" id="6062950">b</span><span class="op" id="6062951">.</span><span class="builtintype" id="6062952">uint32</span><span class="op" id="6062958">(</span><span class="op" id="6062959">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6062969">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063032">d</span><span class="op" id="6063033">.</span><span class="ident" id="6063034">dirRecordsThisDisk</span>&nbsp;<span class="op" id="6063053">=</span>&nbsp;<span class="ident" id="6063055">b</span><span class="op" id="6063056">.</span><span class="ident" id="6063057">uint64</span><span class="op" id="6063063">(</span><span class="op" id="6063064">)</span>&nbsp;<span class="comment" id="6063066">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063132">d</span><span class="op" id="6063133">.</span><span class="ident" id="6063134">directoryRecords</span>&nbsp;<span class="op" id="6063151">=</span>&nbsp;<span class="ident" id="6063153">b</span><span class="op" id="6063154">.</span><span class="ident" id="6063155">uint64</span><span class="op" id="6063161">(</span><span class="op" id="6063162">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6063166">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063219">d</span><span class="op" id="6063220">.</span><span class="ident" id="6063221">directorySize</span>&nbsp;<span class="op" id="6063235">=</span>&nbsp;<span class="ident" id="6063237">b</span><span class="op" id="6063238">.</span><span class="ident" id="6063239">uint64</span><span class="op" id="6063245">(</span><span class="op" id="6063246">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6063253">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063287">d</span><span class="op" id="6063288">.</span><span class="ident" id="6063289">directoryOffset</span>&nbsp;<span class="op" id="6063305">=</span>&nbsp;<span class="ident" id="6063307">b</span><span class="op" id="6063308">.</span><span class="ident" id="6063309">uint64</span><span class="op" id="6063315">(</span><span class="op" id="6063316">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6063321">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063404">return</span>&nbsp;<span class="ident" id="6063411">nil</span><br>
<span class="lineno"></span><span class="op" id="6063415">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="6063418">func</span>&nbsp;<span class="ident" id="6063423">findSignatureInBlock</span><span class="op" id="6063443">(</span><span class="ident" id="6063444">b</span>&nbsp;<span class="op" id="6063446">[</span><span class="op" id="6063447">]</span><span class="builtintype" id="6063448">byte</span><span class="op" id="6063452">)</span>&nbsp;<span class="builtintype" id="6063454">int</span>&nbsp;<span class="op" id="6063458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063461">for</span>&nbsp;<span class="ident" id="6063465">i</span>&nbsp;<span class="op" id="6063467">:=</span>&nbsp;<span class="builtinfunc" id="6063470">len</span><span class="op" id="6063473">(</span><span class="ident" id="6063474">b</span><span class="op" id="6063475">)</span>&nbsp;<span class="op" id="6063477">-</span>&nbsp;<span class="ident" id="6063479">directoryEndLen</span><span class="op" id="6063494">;</span>&nbsp;<span class="ident" id="6063496">i</span>&nbsp;<span class="op" id="6063498">&gt;=</span>&nbsp;<span class="num" id="6063501">0</span><span class="op" id="6063502">;</span>&nbsp;<span class="ident" id="6063504">i</span><span class="op" id="6063505">--</span>&nbsp;<span class="op" id="6063508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6063512">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063565">if</span>&nbsp;<span class="ident" id="6063568">b</span><span class="op" id="6063569">[</span><span class="ident" id="6063570">i</span><span class="op" id="6063571">]</span>&nbsp;<span class="op" id="6063573">==</span>&nbsp;<span class="string" id="6063576">&#39;P&#39;</span>&nbsp;<span class="op" id="6063580">&amp;&amp;</span>&nbsp;<span class="ident" id="6063583">b</span><span class="op" id="6063584">[</span><span class="ident" id="6063585">i</span><span class="op" id="6063586">+</span><span class="num" id="6063587">1</span><span class="op" id="6063588">]</span>&nbsp;<span class="op" id="6063590">==</span>&nbsp;<span class="string" id="6063593">&#39;K&#39;</span>&nbsp;<span class="op" id="6063597">&amp;&amp;</span>&nbsp;<span class="ident" id="6063600">b</span><span class="op" id="6063601">[</span><span class="ident" id="6063602">i</span><span class="op" id="6063603">+</span><span class="num" id="6063604">2</span><span class="op" id="6063605">]</span>&nbsp;<span class="op" id="6063607">==</span>&nbsp;<span class="num" id="6063610">0x05</span>&nbsp;<span class="op" id="6063615">&amp;&amp;</span>&nbsp;<span class="ident" id="6063618">b</span><span class="op" id="6063619">[</span><span class="ident" id="6063620">i</span><span class="op" id="6063621">+</span><span class="num" id="6063622">3</span><span class="op" id="6063623">]</span>&nbsp;<span class="op" id="6063625">==</span>&nbsp;<span class="num" id="6063628">0x06</span>&nbsp;<span class="op" id="6063633">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6063638">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063667">n</span>&nbsp;<span class="op" id="6063669">:=</span>&nbsp;<span class="builtintype" id="6063672">int</span><span class="op" id="6063675">(</span><span class="ident" id="6063676">b</span><span class="op" id="6063677">[</span><span class="ident" id="6063678">i</span><span class="op" id="6063679">+</span><span class="ident" id="6063680">directoryEndLen</span><span class="op" id="6063695">-</span><span class="num" id="6063696">2</span><span class="op" id="6063697">]</span><span class="op" id="6063698">)</span>&nbsp;<span class="op" id="6063700">|</span>&nbsp;<span class="builtintype" id="6063702">int</span><span class="op" id="6063705">(</span><span class="ident" id="6063706">b</span><span class="op" id="6063707">[</span><span class="ident" id="6063708">i</span><span class="op" id="6063709">+</span><span class="ident" id="6063710">directoryEndLen</span><span class="op" id="6063725">-</span><span class="num" id="6063726">1</span><span class="op" id="6063727">]</span><span class="op" id="6063728">)</span><span class="op" id="6063729">&lt;&lt;</span><span class="num" id="6063731">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063736">if</span>&nbsp;<span class="ident" id="6063739">n</span><span class="op" id="6063740">+</span><span class="ident" id="6063741">directoryEndLen</span><span class="op" id="6063756">+</span><span class="ident" id="6063757">i</span>&nbsp;<span class="op" id="6063759">&lt;=</span>&nbsp;<span class="builtinfunc" id="6063762">len</span><span class="op" id="6063765">(</span><span class="ident" id="6063766">b</span><span class="op" id="6063767">)</span>&nbsp;<span class="op" id="6063769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063775">return</span>&nbsp;<span class="ident" id="6063782">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063787">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063797">return</span>&nbsp;<span class="op" id="6063804">-</span><span class="num" id="6063805">1</span><br>
<span class="lineno"></span><span class="op" id="6063807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="6063810">type</span>&nbsp;<span class="ident" id="6063815">readBuf</span>&nbsp;<span class="op" id="6063823">[</span><span class="op" id="6063824">]</span><span class="builtintype" id="6063825">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6063831">func</span>&nbsp;<span class="op" id="6063836">(</span><span class="ident" id="6063837">b</span>&nbsp;<span class="op" id="6063839">*</span><span class="ident" id="6063840">readBuf</span><span class="op" id="6063847">)</span>&nbsp;<span class="builtintype" id="6063849">uint16</span><span class="op" id="6063855">(</span><span class="op" id="6063856">)</span>&nbsp;<span class="builtintype" id="6063858">uint16</span>&nbsp;<span class="op" id="6063865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063868">v</span>&nbsp;<span class="op" id="6063870">:=</span>&nbsp;<span class="ident" id="6063873">binary</span><span class="op" id="6063879">.</span><span class="ident" id="6063880">LittleEndian</span><span class="op" id="6063892">.</span><span class="ident" id="6063893">Uint16</span><span class="op" id="6063899">(</span><span class="op" id="6063900">*</span><span class="ident" id="6063901">b</span><span class="op" id="6063902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063905">*</span><span class="ident" id="6063906">b</span>&nbsp;<span class="op" id="6063908">=</span>&nbsp;<span class="op" id="6063910">(</span><span class="op" id="6063911">*</span><span class="ident" id="6063912">b</span><span class="op" id="6063913">)</span><span class="op" id="6063914">[</span><span class="num" id="6063915">2</span><span class="op" id="6063916">:</span><span class="op" id="6063917">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063920">return</span>&nbsp;<span class="ident" id="6063927">v</span><br>
<span class="lineno"></span><span class="op" id="6063929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6063932">func</span>&nbsp;<span class="op" id="6063937">(</span><span class="ident" id="6063938">b</span>&nbsp;<span class="op" id="6063940">*</span><span class="ident" id="6063941">readBuf</span><span class="op" id="6063948">)</span>&nbsp;<span class="builtintype" id="6063950">uint32</span><span class="op" id="6063956">(</span><span class="op" id="6063957">)</span>&nbsp;<span class="builtintype" id="6063959">uint32</span>&nbsp;<span class="op" id="6063966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063969">v</span>&nbsp;<span class="op" id="6063971">:=</span>&nbsp;<span class="ident" id="6063974">binary</span><span class="op" id="6063980">.</span><span class="ident" id="6063981">LittleEndian</span><span class="op" id="6063993">.</span><span class="ident" id="6063994">Uint32</span><span class="op" id="6064000">(</span><span class="op" id="6064001">*</span><span class="ident" id="6064002">b</span><span class="op" id="6064003">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064006">*</span><span class="ident" id="6064007">b</span>&nbsp;<span class="op" id="6064009">=</span>&nbsp;<span class="op" id="6064011">(</span><span class="op" id="6064012">*</span><span class="ident" id="6064013">b</span><span class="op" id="6064014">)</span><span class="op" id="6064015">[</span><span class="num" id="6064016">4</span><span class="op" id="6064017">:</span><span class="op" id="6064018">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064021">return</span>&nbsp;<span class="ident" id="6064028">v</span><br>
<span class="lineno"></span><span class="op" id="6064030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6064033">func</span>&nbsp;<span class="op" id="6064038">(</span><span class="ident" id="6064039">b</span>&nbsp;<span class="op" id="6064041">*</span><span class="ident" id="6064042">readBuf</span><span class="op" id="6064049">)</span>&nbsp;<span class="ident" id="6064051">uint64</span><span class="op" id="6064057">(</span><span class="op" id="6064058">)</span>&nbsp;<span class="ident" id="6064060">uint64</span>&nbsp;<span class="op" id="6064067">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064070">v</span>&nbsp;<span class="op" id="6064072">:=</span>&nbsp;<span class="ident" id="6064075">binary</span><span class="op" id="6064081">.</span><span class="ident" id="6064082">LittleEndian</span><span class="op" id="6064094">.</span><span class="ident" id="6064095">Uint64</span><span class="op" id="6064101">(</span><span class="op" id="6064102">*</span><span class="ident" id="6064103">b</span><span class="op" id="6064104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064107">*</span><span class="ident" id="6064108">b</span>&nbsp;<span class="op" id="6064110">=</span>&nbsp;<span class="op" id="6064112">(</span><span class="op" id="6064113">*</span><span class="ident" id="6064114">b</span><span class="op" id="6064115">)</span><span class="op" id="6064116">[</span><span class="num" id="6064117">8</span><span class="op" id="6064118">:</span><span class="op" id="6064119">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064122">return</span>&nbsp;<span class="ident" id="6064129">v</span><br>
<span class="lineno"></span><span class="op" id="6064131">}</span>
</div>
</body>
</html>
