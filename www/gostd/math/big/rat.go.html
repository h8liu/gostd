<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3562096">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3562151">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3562205">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3562256">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;multi-precision&nbsp;rational&nbsp;numbers.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3562315">package</span>&nbsp;<span class="ident" id="3562323">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3562328">import</span>&nbsp;<span class="op" id="3562335">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3562338">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3562357">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3562367">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3562374">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3562382">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3562392">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3562395">//&nbsp;A&nbsp;Rat&nbsp;represents&nbsp;a&nbsp;quotient&nbsp;a/b&nbsp;of&nbsp;arbitrary&nbsp;precision.</span><br>
<span class="lineno"></span><span class="comment" id="3562454">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Rat&nbsp;represents&nbsp;the&nbsp;value&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3562506">type</span>&nbsp;<span class="ident" id="3562511">Rat</span>&nbsp;<span class="keyword" id="3562515">struct</span>&nbsp;<span class="op" id="3562522">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3562525">//&nbsp;To&nbsp;make&nbsp;zero&nbsp;values&nbsp;for&nbsp;Rat&nbsp;work&nbsp;w/o&nbsp;initialization,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3562582">//&nbsp;a&nbsp;zero&nbsp;value&nbsp;of&nbsp;b&nbsp;(len(b)&nbsp;==&nbsp;0)&nbsp;acts&nbsp;like&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3562636">//&nbsp;a.neg&nbsp;determines&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;Rat,&nbsp;b.neg&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562696">a</span><span class="op" id="3562697">,</span>&nbsp;<span class="ident" id="3562699">b</span>&nbsp;<span class="ident" id="3562701">Int</span><br>
<span class="lineno"></span><span class="op" id="3562705">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3562708">//&nbsp;NewRat&nbsp;creates&nbsp;a&nbsp;new&nbsp;Rat&nbsp;with&nbsp;numerator&nbsp;a&nbsp;and&nbsp;denominator&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3562772">func</span>&nbsp;<span class="ident" id="3562777">NewRat</span><span class="op" id="3562783">(</span><span class="ident" id="3562784">a</span><span class="op" id="3562785">,</span>&nbsp;<span class="ident" id="3562787">b</span>&nbsp;<span class="ident" id="3562789">int64</span><span class="op" id="3562794">)</span>&nbsp;<span class="op" id="3562796">*</span><span class="ident" id="3562797">Rat</span>&nbsp;<span class="op" id="3562801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562804">return</span>&nbsp;<span class="builtinfunc" id="3562811">new</span><span class="op" id="3562814">(</span><span class="ident" id="3562815">Rat</span><span class="op" id="3562818">)</span><span class="op" id="3562819">.</span><span class="ident" id="3562820">SetFrac64</span><span class="op" id="3562829">(</span><span class="ident" id="3562830">a</span><span class="op" id="3562831">,</span>&nbsp;<span class="ident" id="3562833">b</span><span class="op" id="3562834">)</span><br>
<span class="lineno"></span><span class="op" id="3562836">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3562839">//&nbsp;SetFloat64&nbsp;sets&nbsp;z&nbsp;to&nbsp;exactly&nbsp;f&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3562888">//&nbsp;If&nbsp;f&nbsp;is&nbsp;not&nbsp;finite,&nbsp;SetFloat&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3562933">func</span>&nbsp;<span class="op" id="3562938">(</span><span class="ident" id="3562939">z</span>&nbsp;<span class="op" id="3562941">*</span><span class="ident" id="3562942">Rat</span><span class="op" id="3562945">)</span>&nbsp;<span class="ident" id="3562947">SetFloat64</span><span class="op" id="3562957">(</span><span class="ident" id="3562958">f</span>&nbsp;<span class="builtintype" id="3562960">float64</span><span class="op" id="3562967">)</span>&nbsp;<span class="op" id="3562969">*</span><span class="ident" id="3562970">Rat</span>&nbsp;<span class="op" id="3562974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562977">const</span>&nbsp;<span class="ident" id="3562983">expMask</span>&nbsp;<span class="op" id="3562991">=</span>&nbsp;<span class="num" id="3562993">1</span><span class="op" id="3562994">&lt;&lt;</span><span class="num" id="3562996">11</span>&nbsp;<span class="op" id="3562999">-</span>&nbsp;<span class="num" id="3563001">1</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563004">bits</span>&nbsp;<span class="op" id="3563009">:=</span>&nbsp;<span class="ident" id="3563012">math</span><span class="op" id="3563016">.</span><span class="ident" id="3563017">Float64bits</span><span class="op" id="3563028">(</span><span class="ident" id="3563029">f</span><span class="op" id="3563030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563033">mantissa</span>&nbsp;<span class="op" id="3563042">:=</span>&nbsp;<span class="ident" id="3563045">bits</span>&nbsp;<span class="op" id="3563050">&amp;</span>&nbsp;<span class="op" id="3563052">(</span><span class="num" id="3563053">1</span><span class="op" id="3563054">&lt;&lt;</span><span class="num" id="3563056">52</span>&nbsp;<span class="op" id="3563059">-</span>&nbsp;<span class="num" id="3563061">1</span><span class="op" id="3563062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563065">exp</span>&nbsp;<span class="op" id="3563069">:=</span>&nbsp;<span class="builtintype" id="3563072">int</span><span class="op" id="3563075">(</span><span class="op" id="3563076">(</span><span class="ident" id="3563077">bits</span>&nbsp;<span class="op" id="3563082">&gt;&gt;</span>&nbsp;<span class="num" id="3563085">52</span><span class="op" id="3563087">)</span>&nbsp;<span class="op" id="3563089">&amp;</span>&nbsp;<span class="ident" id="3563091">expMask</span><span class="op" id="3563098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563101">switch</span>&nbsp;<span class="ident" id="3563108">exp</span>&nbsp;<span class="op" id="3563112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563115">case</span>&nbsp;<span class="ident" id="3563120">expMask</span><span class="op" id="3563127">:</span>&nbsp;<span class="comment" id="3563129">//&nbsp;non-finite</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563145">return</span>&nbsp;<span class="ident" id="3563152">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563157">case</span>&nbsp;<span class="num" id="3563162">0</span><span class="op" id="3563163">:</span>&nbsp;<span class="comment" id="3563165">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563179">exp</span>&nbsp;<span class="op" id="3563183">-=</span>&nbsp;<span class="num" id="3563186">1022</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563192">default</span><span class="op" id="3563199">:</span>&nbsp;<span class="comment" id="3563201">//&nbsp;normal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563213">mantissa</span>&nbsp;<span class="op" id="3563222">|=</span>&nbsp;<span class="num" id="3563225">1</span>&nbsp;<span class="op" id="3563227">&lt;&lt;</span>&nbsp;<span class="num" id="3563230">52</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563235">exp</span>&nbsp;<span class="op" id="3563239">-=</span>&nbsp;<span class="num" id="3563242">1023</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3563248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563252">shift</span>&nbsp;<span class="op" id="3563258">:=</span>&nbsp;<span class="num" id="3563261">52</span>&nbsp;<span class="op" id="3563264">-</span>&nbsp;<span class="ident" id="3563266">exp</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3563272">//&nbsp;Optimization&nbsp;(?):&nbsp;partially&nbsp;pre-normalise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563319">for</span>&nbsp;<span class="ident" id="3563323">mantissa</span><span class="op" id="3563331">&amp;</span><span class="num" id="3563332">1</span>&nbsp;<span class="op" id="3563334">==</span>&nbsp;<span class="num" id="3563337">0</span>&nbsp;<span class="op" id="3563339">&amp;&amp;</span>&nbsp;<span class="ident" id="3563342">shift</span>&nbsp;<span class="op" id="3563348">&gt;</span>&nbsp;<span class="num" id="3563350">0</span>&nbsp;<span class="op" id="3563352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563356">mantissa</span>&nbsp;<span class="op" id="3563365">&gt;&gt;=</span>&nbsp;<span class="num" id="3563369">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563373">shift</span><span class="op" id="3563378">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3563382">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563386">z</span><span class="op" id="3563387">.</span><span class="ident" id="3563388">a</span><span class="op" id="3563389">.</span><span class="ident" id="3563390">SetUint64</span><span class="op" id="3563399">(</span><span class="ident" id="3563400">mantissa</span><span class="op" id="3563408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563411">z</span><span class="op" id="3563412">.</span><span class="ident" id="3563413">a</span><span class="op" id="3563414">.</span><span class="ident" id="3563415">neg</span>&nbsp;<span class="op" id="3563419">=</span>&nbsp;<span class="ident" id="3563421">f</span>&nbsp;<span class="op" id="3563423">&lt;</span>&nbsp;<span class="num" id="3563425">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563428">z</span><span class="op" id="3563429">.</span><span class="ident" id="3563430">b</span><span class="op" id="3563431">.</span><span class="ident" id="3563432">Set</span><span class="op" id="3563435">(</span><span class="ident" id="3563436">intOne</span><span class="op" id="3563442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563445">if</span>&nbsp;<span class="ident" id="3563448">shift</span>&nbsp;<span class="op" id="3563454">&gt;</span>&nbsp;<span class="num" id="3563456">0</span>&nbsp;<span class="op" id="3563458">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563462">z</span><span class="op" id="3563463">.</span><span class="ident" id="3563464">b</span><span class="op" id="3563465">.</span><span class="ident" id="3563466">Lsh</span><span class="op" id="3563469">(</span><span class="op" id="3563470">&amp;</span><span class="ident" id="3563471">z</span><span class="op" id="3563472">.</span><span class="ident" id="3563473">b</span><span class="op" id="3563474">,</span>&nbsp;<span class="builtintype" id="3563476">uint</span><span class="op" id="3563480">(</span><span class="ident" id="3563481">shift</span><span class="op" id="3563486">)</span><span class="op" id="3563487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3563490">}</span>&nbsp;<span class="keyword" id="3563492">else</span>&nbsp;<span class="op" id="3563497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563501">z</span><span class="op" id="3563502">.</span><span class="ident" id="3563503">a</span><span class="op" id="3563504">.</span><span class="ident" id="3563505">Lsh</span><span class="op" id="3563508">(</span><span class="op" id="3563509">&amp;</span><span class="ident" id="3563510">z</span><span class="op" id="3563511">.</span><span class="ident" id="3563512">a</span><span class="op" id="3563513">,</span>&nbsp;<span class="builtintype" id="3563515">uint</span><span class="op" id="3563519">(</span><span class="op" id="3563520">-</span><span class="ident" id="3563521">shift</span><span class="op" id="3563526">)</span><span class="op" id="3563527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3563530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563533">return</span>&nbsp;<span class="ident" id="3563540">z</span><span class="op" id="3563541">.</span><span class="ident" id="3563542">norm</span><span class="op" id="3563546">(</span><span class="op" id="3563547">)</span><br>
<span class="lineno">65</span><span class="op" id="3563549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3563552">//&nbsp;quotToFloat32&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float32&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3563608">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3563663">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno">70</span><span class="comment" id="3563716">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3563781">func</span>&nbsp;<span class="ident" id="3563786">quotToFloat32</span><span class="op" id="3563799">(</span><span class="ident" id="3563800">a</span><span class="op" id="3563801">,</span>&nbsp;<span class="ident" id="3563803">b</span>&nbsp;<span class="ident" id="3563805">nat</span><span class="op" id="3563808">)</span>&nbsp;<span class="op" id="3563810">(</span><span class="ident" id="3563811">f</span>&nbsp;<span class="builtintype" id="3563813">float32</span><span class="op" id="3563820">,</span>&nbsp;<span class="ident" id="3563822">exact</span>&nbsp;<span class="builtintype" id="3563828">bool</span><span class="op" id="3563832">)</span>&nbsp;<span class="op" id="3563834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563837">const</span>&nbsp;<span class="op" id="3563843">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3563847">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563871">Fsize</span>&nbsp;<span class="op" id="3563877">=</span>&nbsp;<span class="num" id="3563879">32</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3563885">//&nbsp;mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563899">Msize</span>&nbsp;&nbsp;<span class="op" id="3563906">=</span>&nbsp;<span class="num" id="3563908">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563913">Msize1</span>&nbsp;<span class="op" id="3563920">=</span>&nbsp;<span class="ident" id="3563922">Msize</span>&nbsp;<span class="op" id="3563928">+</span>&nbsp;<span class="num" id="3563930">1</span>&nbsp;<span class="comment" id="3563932">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563954">Msize2</span>&nbsp;<span class="op" id="3563961">=</span>&nbsp;<span class="ident" id="3563963">Msize1</span>&nbsp;<span class="op" id="3563970">+</span>&nbsp;<span class="num" id="3563972">1</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3563977">//&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563991">Esize</span>&nbsp;<span class="op" id="3563997">=</span>&nbsp;<span class="ident" id="3563999">Fsize</span>&nbsp;<span class="op" id="3564005">-</span>&nbsp;<span class="ident" id="3564007">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564016">Ebias</span>&nbsp;<span class="op" id="3564022">=</span>&nbsp;<span class="num" id="3564024">1</span><span class="op" id="3564025">&lt;&lt;</span><span class="op" id="3564027">(</span><span class="ident" id="3564028">Esize</span><span class="op" id="3564033">-</span><span class="num" id="3564034">1</span><span class="op" id="3564035">)</span>&nbsp;<span class="op" id="3564037">-</span>&nbsp;<span class="num" id="3564039">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564043">Emin</span>&nbsp;&nbsp;<span class="op" id="3564049">=</span>&nbsp;<span class="num" id="3564051">1</span>&nbsp;<span class="op" id="3564053">-</span>&nbsp;<span class="ident" id="3564055">Ebias</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564063">Emax</span>&nbsp;&nbsp;<span class="op" id="3564069">=</span>&nbsp;<span class="ident" id="3564071">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3564078">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3564082">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564153">alen</span>&nbsp;<span class="op" id="3564158">:=</span>&nbsp;<span class="ident" id="3564161">a</span><span class="op" id="3564162">.</span><span class="ident" id="3564163">bitLen</span><span class="op" id="3564169">(</span><span class="op" id="3564170">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3564173">if</span>&nbsp;<span class="ident" id="3564176">alen</span>&nbsp;<span class="op" id="3564181">==</span>&nbsp;<span class="num" id="3564184">0</span>&nbsp;<span class="op" id="3564186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3564190">return</span>&nbsp;<span class="num" id="3564197">0</span><span class="op" id="3564198">,</span>&nbsp;<span class="builtintype" id="3564200">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3564206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564209">blen</span>&nbsp;<span class="op" id="3564214">:=</span>&nbsp;<span class="ident" id="3564217">b</span><span class="op" id="3564218">.</span><span class="ident" id="3564219">bitLen</span><span class="op" id="3564225">(</span><span class="op" id="3564226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3564229">if</span>&nbsp;<span class="ident" id="3564232">blen</span>&nbsp;<span class="op" id="3564237">==</span>&nbsp;<span class="num" id="3564240">0</span>&nbsp;<span class="op" id="3564242">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3564246">panic</span><span class="op" id="3564251">(</span><span class="string" id="3564252">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3564270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3564273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3564277">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3564357">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3564437">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float32&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3564509">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3564571">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3564633">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564700">exp</span>&nbsp;<span class="op" id="3564704">:=</span>&nbsp;<span class="ident" id="3564707">alen</span>&nbsp;<span class="op" id="3564712">-</span>&nbsp;<span class="ident" id="3564714">blen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3564720">var</span>&nbsp;<span class="ident" id="3564724">a2</span><span class="op" id="3564726">,</span>&nbsp;<span class="ident" id="3564728">b2</span>&nbsp;<span class="ident" id="3564731">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564736">a2</span>&nbsp;<span class="op" id="3564739">=</span>&nbsp;<span class="ident" id="3564741">a2</span><span class="op" id="3564743">.</span><span class="ident" id="3564744">set</span><span class="op" id="3564747">(</span><span class="ident" id="3564748">a</span><span class="op" id="3564749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564752">b2</span>&nbsp;<span class="op" id="3564755">=</span>&nbsp;<span class="ident" id="3564757">b2</span><span class="op" id="3564759">.</span><span class="ident" id="3564760">set</span><span class="op" id="3564763">(</span><span class="ident" id="3564764">b</span><span class="op" id="3564765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3564768">if</span>&nbsp;<span class="ident" id="3564771">shift</span>&nbsp;<span class="op" id="3564777">:=</span>&nbsp;<span class="ident" id="3564780">Msize2</span>&nbsp;<span class="op" id="3564787">-</span>&nbsp;<span class="ident" id="3564789">exp</span><span class="op" id="3564792">;</span>&nbsp;<span class="ident" id="3564794">shift</span>&nbsp;<span class="op" id="3564800">&gt;</span>&nbsp;<span class="num" id="3564802">0</span>&nbsp;<span class="op" id="3564804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564808">a2</span>&nbsp;<span class="op" id="3564811">=</span>&nbsp;<span class="ident" id="3564813">a2</span><span class="op" id="3564815">.</span><span class="ident" id="3564816">shl</span><span class="op" id="3564819">(</span><span class="ident" id="3564820">a2</span><span class="op" id="3564822">,</span>&nbsp;<span class="builtintype" id="3564824">uint</span><span class="op" id="3564828">(</span><span class="ident" id="3564829">shift</span><span class="op" id="3564834">)</span><span class="op" id="3564835">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3564838">}</span>&nbsp;<span class="keyword" id="3564840">else</span>&nbsp;<span class="keyword" id="3564845">if</span>&nbsp;<span class="ident" id="3564848">shift</span>&nbsp;<span class="op" id="3564854">&lt;</span>&nbsp;<span class="num" id="3564856">0</span>&nbsp;<span class="op" id="3564858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564862">b2</span>&nbsp;<span class="op" id="3564865">=</span>&nbsp;<span class="ident" id="3564867">b2</span><span class="op" id="3564869">.</span><span class="ident" id="3564870">shl</span><span class="op" id="3564873">(</span><span class="ident" id="3564874">b2</span><span class="op" id="3564876">,</span>&nbsp;<span class="builtintype" id="3564878">uint</span><span class="op" id="3564882">(</span><span class="op" id="3564883">-</span><span class="ident" id="3564884">shift</span><span class="op" id="3564889">)</span><span class="op" id="3564890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3564893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3564897">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3564959">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565016">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565041">var</span>&nbsp;<span class="ident" id="3565045">q</span>&nbsp;<span class="ident" id="3565047">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565052">q</span><span class="op" id="3565053">,</span>&nbsp;<span class="ident" id="3565055">r</span>&nbsp;<span class="op" id="3565057">:=</span>&nbsp;<span class="ident" id="3565060">q</span><span class="op" id="3565061">.</span><span class="ident" id="3565062">div</span><span class="op" id="3565065">(</span><span class="ident" id="3565066">a2</span><span class="op" id="3565068">,</span>&nbsp;<span class="ident" id="3565070">a2</span><span class="op" id="3565072">,</span>&nbsp;<span class="ident" id="3565074">b2</span><span class="op" id="3565076">)</span>&nbsp;<span class="comment" id="3565078">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565095">mantissa</span>&nbsp;<span class="op" id="3565104">:=</span>&nbsp;<span class="ident" id="3565107">low32</span><span class="op" id="3565112">(</span><span class="ident" id="3565113">q</span><span class="op" id="3565114">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565117">haveRem</span>&nbsp;<span class="op" id="3565125">:=</span>&nbsp;<span class="builtinfunc" id="3565128">len</span><span class="op" id="3565131">(</span><span class="ident" id="3565132">r</span><span class="op" id="3565133">)</span>&nbsp;<span class="op" id="3565135">&gt;</span>&nbsp;<span class="num" id="3565137">0</span>&nbsp;<span class="comment" id="3565139">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565196">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565265">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565317">if</span>&nbsp;<span class="ident" id="3565320">mantissa</span><span class="op" id="3565328">&gt;&gt;</span><span class="ident" id="3565330">Msize2</span>&nbsp;<span class="op" id="3565337">==</span>&nbsp;<span class="num" id="3565340">1</span>&nbsp;<span class="op" id="3565342">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565346">if</span>&nbsp;<span class="ident" id="3565349">mantissa</span><span class="op" id="3565357">&amp;</span><span class="num" id="3565358">1</span>&nbsp;<span class="op" id="3565360">==</span>&nbsp;<span class="num" id="3565363">1</span>&nbsp;<span class="op" id="3565365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565370">haveRem</span>&nbsp;<span class="op" id="3565378">=</span>&nbsp;<span class="builtintype" id="3565380">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3565387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565391">mantissa</span>&nbsp;<span class="op" id="3565400">&gt;&gt;=</span>&nbsp;<span class="num" id="3565404">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565408">exp</span><span class="op" id="3565411">++</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3565415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565418">if</span>&nbsp;<span class="ident" id="3565421">mantissa</span><span class="op" id="3565429">&gt;&gt;</span><span class="ident" id="3565431">Msize1</span>&nbsp;<span class="op" id="3565438">!=</span>&nbsp;<span class="num" id="3565441">1</span>&nbsp;<span class="op" id="3565443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3565447">panic</span><span class="op" id="3565452">(</span><span class="ident" id="3565453">fmt</span><span class="op" id="3565456">.</span><span class="ident" id="3565457">Sprintf</span><span class="op" id="3565464">(</span><span class="string" id="3565465">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3565501">,</span>&nbsp;<span class="ident" id="3565503">Msize2</span><span class="op" id="3565509">)</span><span class="op" id="3565510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3565513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565517">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565534">if</span>&nbsp;<span class="ident" id="3565537">Emin</span><span class="op" id="3565541">-</span><span class="ident" id="3565542">Msize</span>&nbsp;<span class="op" id="3565548">&lt;=</span>&nbsp;<span class="ident" id="3565551">exp</span>&nbsp;<span class="op" id="3565555">&amp;&amp;</span>&nbsp;<span class="ident" id="3565558">exp</span>&nbsp;<span class="op" id="3565562">&lt;=</span>&nbsp;<span class="ident" id="3565565">Emin</span>&nbsp;<span class="op" id="3565570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565574">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565626">shift</span>&nbsp;<span class="op" id="3565632">:=</span>&nbsp;<span class="builtintype" id="3565635">uint</span><span class="op" id="3565639">(</span><span class="ident" id="3565640">Emin</span>&nbsp;<span class="op" id="3565645">-</span>&nbsp;<span class="op" id="3565647">(</span><span class="ident" id="3565648">exp</span>&nbsp;<span class="op" id="3565652">-</span>&nbsp;<span class="num" id="3565654">1</span><span class="op" id="3565655">)</span><span class="op" id="3565656">)</span>&nbsp;<span class="comment" id="3565658">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565675">lostbits</span>&nbsp;<span class="op" id="3565684">:=</span>&nbsp;<span class="ident" id="3565687">mantissa</span>&nbsp;<span class="op" id="3565696">&amp;</span>&nbsp;<span class="op" id="3565698">(</span><span class="num" id="3565699">1</span><span class="op" id="3565700">&lt;&lt;</span><span class="ident" id="3565702">shift</span>&nbsp;<span class="op" id="3565708">-</span>&nbsp;<span class="num" id="3565710">1</span><span class="op" id="3565711">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565715">haveRem</span>&nbsp;<span class="op" id="3565723">=</span>&nbsp;<span class="ident" id="3565725">haveRem</span>&nbsp;<span class="op" id="3565733">||</span>&nbsp;<span class="ident" id="3565736">lostbits</span>&nbsp;<span class="op" id="3565745">!=</span>&nbsp;<span class="num" id="3565748">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565752">mantissa</span>&nbsp;<span class="op" id="3565761">&gt;&gt;=</span>&nbsp;<span class="ident" id="3565765">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565773">exp</span>&nbsp;<span class="op" id="3565777">=</span>&nbsp;<span class="num" id="3565779">2</span>&nbsp;<span class="op" id="3565781">-</span>&nbsp;<span class="ident" id="3565783">Ebias</span>&nbsp;<span class="comment" id="3565789">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3565808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565811">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565849">exact</span>&nbsp;<span class="op" id="3565855">=</span>&nbsp;<span class="op" id="3565857">!</span><span class="ident" id="3565858">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565867">if</span>&nbsp;<span class="ident" id="3565870">mantissa</span><span class="op" id="3565878">&amp;</span><span class="num" id="3565879">1</span>&nbsp;<span class="op" id="3565881">!=</span>&nbsp;<span class="num" id="3565884">0</span>&nbsp;<span class="op" id="3565886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565890">exact</span>&nbsp;<span class="op" id="3565896">=</span>&nbsp;<span class="builtintype" id="3565898">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565906">if</span>&nbsp;<span class="ident" id="3565909">haveRem</span>&nbsp;<span class="op" id="3565917">||</span>&nbsp;<span class="ident" id="3565920">mantissa</span><span class="op" id="3565928">&amp;</span><span class="num" id="3565929">2</span>&nbsp;<span class="op" id="3565931">!=</span>&nbsp;<span class="num" id="3565934">0</span>&nbsp;<span class="op" id="3565936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565941">if</span>&nbsp;<span class="ident" id="3565944">mantissa</span><span class="op" id="3565952">++</span><span class="op" id="3565954">;</span>&nbsp;<span class="ident" id="3565956">mantissa</span>&nbsp;<span class="op" id="3565965">&gt;=</span>&nbsp;<span class="num" id="3565968">1</span><span class="op" id="3565969">&lt;&lt;</span><span class="ident" id="3565971">Msize2</span>&nbsp;<span class="op" id="3565978">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565984">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566045">mantissa</span>&nbsp;<span class="op" id="3566054">&gt;&gt;=</span>&nbsp;<span class="num" id="3566058">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566064">exp</span><span class="op" id="3566067">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566077">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566083">mantissa</span>&nbsp;<span class="op" id="3566092">&gt;&gt;=</span>&nbsp;<span class="num" id="3566096">1</span>&nbsp;<span class="comment" id="3566098">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566160">f</span>&nbsp;<span class="op" id="3566162">=</span>&nbsp;<span class="builtintype" id="3566164">float32</span><span class="op" id="3566171">(</span><span class="ident" id="3566172">math</span><span class="op" id="3566176">.</span><span class="ident" id="3566177">Ldexp</span><span class="op" id="3566182">(</span><span class="builtintype" id="3566183">float64</span><span class="op" id="3566190">(</span><span class="ident" id="3566191">mantissa</span><span class="op" id="3566199">)</span><span class="op" id="3566200">,</span>&nbsp;<span class="ident" id="3566202">exp</span><span class="op" id="3566205">-</span><span class="ident" id="3566206">Msize1</span><span class="op" id="3566212">)</span><span class="op" id="3566213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566216">if</span>&nbsp;<span class="ident" id="3566219">math</span><span class="op" id="3566223">.</span><span class="ident" id="3566224">IsInf</span><span class="op" id="3566229">(</span><span class="builtintype" id="3566230">float64</span><span class="op" id="3566237">(</span><span class="ident" id="3566238">f</span><span class="op" id="3566239">)</span><span class="op" id="3566240">,</span>&nbsp;<span class="num" id="3566242">0</span><span class="op" id="3566243">)</span>&nbsp;<span class="op" id="3566245">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566249">exact</span>&nbsp;<span class="op" id="3566255">=</span>&nbsp;<span class="builtintype" id="3566257">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566267">return</span><br>
<span class="lineno"></span><span class="op" id="3566274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3566277">//&nbsp;quotToFloat64&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float64&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3566333">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3566388">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="3566441">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3566506">func</span>&nbsp;<span class="ident" id="3566511">quotToFloat64</span><span class="op" id="3566524">(</span><span class="ident" id="3566525">a</span><span class="op" id="3566526">,</span>&nbsp;<span class="ident" id="3566528">b</span>&nbsp;<span class="ident" id="3566530">nat</span><span class="op" id="3566533">)</span>&nbsp;<span class="op" id="3566535">(</span><span class="ident" id="3566536">f</span>&nbsp;<span class="builtintype" id="3566538">float64</span><span class="op" id="3566545">,</span>&nbsp;<span class="ident" id="3566547">exact</span>&nbsp;<span class="builtintype" id="3566553">bool</span><span class="op" id="3566557">)</span>&nbsp;<span class="op" id="3566559">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566562">const</span>&nbsp;<span class="op" id="3566568">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3566572">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566596">Fsize</span>&nbsp;<span class="op" id="3566602">=</span>&nbsp;<span class="num" id="3566604">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3566610">//&nbsp;mantissa</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566624">Msize</span>&nbsp;&nbsp;<span class="op" id="3566631">=</span>&nbsp;<span class="num" id="3566633">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566638">Msize1</span>&nbsp;<span class="op" id="3566645">=</span>&nbsp;<span class="ident" id="3566647">Msize</span>&nbsp;<span class="op" id="3566653">+</span>&nbsp;<span class="num" id="3566655">1</span>&nbsp;<span class="comment" id="3566657">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566679">Msize2</span>&nbsp;<span class="op" id="3566686">=</span>&nbsp;<span class="ident" id="3566688">Msize1</span>&nbsp;<span class="op" id="3566695">+</span>&nbsp;<span class="num" id="3566697">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3566702">//&nbsp;exponent</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566716">Esize</span>&nbsp;<span class="op" id="3566722">=</span>&nbsp;<span class="ident" id="3566724">Fsize</span>&nbsp;<span class="op" id="3566730">-</span>&nbsp;<span class="ident" id="3566732">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566741">Ebias</span>&nbsp;<span class="op" id="3566747">=</span>&nbsp;<span class="num" id="3566749">1</span><span class="op" id="3566750">&lt;&lt;</span><span class="op" id="3566752">(</span><span class="ident" id="3566753">Esize</span><span class="op" id="3566758">-</span><span class="num" id="3566759">1</span><span class="op" id="3566760">)</span>&nbsp;<span class="op" id="3566762">-</span>&nbsp;<span class="num" id="3566764">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566768">Emin</span>&nbsp;&nbsp;<span class="op" id="3566774">=</span>&nbsp;<span class="num" id="3566776">1</span>&nbsp;<span class="op" id="3566778">-</span>&nbsp;<span class="ident" id="3566780">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566788">Emax</span>&nbsp;&nbsp;<span class="op" id="3566794">=</span>&nbsp;<span class="ident" id="3566796">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566803">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3566807">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566878">alen</span>&nbsp;<span class="op" id="3566883">:=</span>&nbsp;<span class="ident" id="3566886">a</span><span class="op" id="3566887">.</span><span class="ident" id="3566888">bitLen</span><span class="op" id="3566894">(</span><span class="op" id="3566895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566898">if</span>&nbsp;<span class="ident" id="3566901">alen</span>&nbsp;<span class="op" id="3566906">==</span>&nbsp;<span class="num" id="3566909">0</span>&nbsp;<span class="op" id="3566911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566915">return</span>&nbsp;<span class="num" id="3566922">0</span><span class="op" id="3566923">,</span>&nbsp;<span class="builtintype" id="3566925">true</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566934">blen</span>&nbsp;<span class="op" id="3566939">:=</span>&nbsp;<span class="ident" id="3566942">b</span><span class="op" id="3566943">.</span><span class="ident" id="3566944">bitLen</span><span class="op" id="3566950">(</span><span class="op" id="3566951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566954">if</span>&nbsp;<span class="ident" id="3566957">blen</span>&nbsp;<span class="op" id="3566962">==</span>&nbsp;<span class="num" id="3566965">0</span>&nbsp;<span class="op" id="3566967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3566971">panic</span><span class="op" id="3566976">(</span><span class="string" id="3566977">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3566995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566998">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3567002">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3567082">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3567162">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float64&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3567234">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3567296">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3567358">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567425">exp</span>&nbsp;<span class="op" id="3567429">:=</span>&nbsp;<span class="ident" id="3567432">alen</span>&nbsp;<span class="op" id="3567437">-</span>&nbsp;<span class="ident" id="3567439">blen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567445">var</span>&nbsp;<span class="ident" id="3567449">a2</span><span class="op" id="3567451">,</span>&nbsp;<span class="ident" id="3567453">b2</span>&nbsp;<span class="ident" id="3567456">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567461">a2</span>&nbsp;<span class="op" id="3567464">=</span>&nbsp;<span class="ident" id="3567466">a2</span><span class="op" id="3567468">.</span><span class="ident" id="3567469">set</span><span class="op" id="3567472">(</span><span class="ident" id="3567473">a</span><span class="op" id="3567474">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567477">b2</span>&nbsp;<span class="op" id="3567480">=</span>&nbsp;<span class="ident" id="3567482">b2</span><span class="op" id="3567484">.</span><span class="ident" id="3567485">set</span><span class="op" id="3567488">(</span><span class="ident" id="3567489">b</span><span class="op" id="3567490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567493">if</span>&nbsp;<span class="ident" id="3567496">shift</span>&nbsp;<span class="op" id="3567502">:=</span>&nbsp;<span class="ident" id="3567505">Msize2</span>&nbsp;<span class="op" id="3567512">-</span>&nbsp;<span class="ident" id="3567514">exp</span><span class="op" id="3567517">;</span>&nbsp;<span class="ident" id="3567519">shift</span>&nbsp;<span class="op" id="3567525">&gt;</span>&nbsp;<span class="num" id="3567527">0</span>&nbsp;<span class="op" id="3567529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567533">a2</span>&nbsp;<span class="op" id="3567536">=</span>&nbsp;<span class="ident" id="3567538">a2</span><span class="op" id="3567540">.</span><span class="ident" id="3567541">shl</span><span class="op" id="3567544">(</span><span class="ident" id="3567545">a2</span><span class="op" id="3567547">,</span>&nbsp;<span class="builtintype" id="3567549">uint</span><span class="op" id="3567553">(</span><span class="ident" id="3567554">shift</span><span class="op" id="3567559">)</span><span class="op" id="3567560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567563">}</span>&nbsp;<span class="keyword" id="3567565">else</span>&nbsp;<span class="keyword" id="3567570">if</span>&nbsp;<span class="ident" id="3567573">shift</span>&nbsp;<span class="op" id="3567579">&lt;</span>&nbsp;<span class="num" id="3567581">0</span>&nbsp;<span class="op" id="3567583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567587">b2</span>&nbsp;<span class="op" id="3567590">=</span>&nbsp;<span class="ident" id="3567592">b2</span><span class="op" id="3567594">.</span><span class="ident" id="3567595">shl</span><span class="op" id="3567598">(</span><span class="ident" id="3567599">b2</span><span class="op" id="3567601">,</span>&nbsp;<span class="builtintype" id="3567603">uint</span><span class="op" id="3567607">(</span><span class="op" id="3567608">-</span><span class="ident" id="3567609">shift</span><span class="op" id="3567614">)</span><span class="op" id="3567615">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3567622">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3567684">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3567741">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567766">var</span>&nbsp;<span class="ident" id="3567770">q</span>&nbsp;<span class="ident" id="3567772">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567777">q</span><span class="op" id="3567778">,</span>&nbsp;<span class="ident" id="3567780">r</span>&nbsp;<span class="op" id="3567782">:=</span>&nbsp;<span class="ident" id="3567785">q</span><span class="op" id="3567786">.</span><span class="ident" id="3567787">div</span><span class="op" id="3567790">(</span><span class="ident" id="3567791">a2</span><span class="op" id="3567793">,</span>&nbsp;<span class="ident" id="3567795">a2</span><span class="op" id="3567797">,</span>&nbsp;<span class="ident" id="3567799">b2</span><span class="op" id="3567801">)</span>&nbsp;<span class="comment" id="3567803">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567820">mantissa</span>&nbsp;<span class="op" id="3567829">:=</span>&nbsp;<span class="ident" id="3567832">low64</span><span class="op" id="3567837">(</span><span class="ident" id="3567838">q</span><span class="op" id="3567839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567842">haveRem</span>&nbsp;<span class="op" id="3567850">:=</span>&nbsp;<span class="builtinfunc" id="3567853">len</span><span class="op" id="3567856">(</span><span class="ident" id="3567857">r</span><span class="op" id="3567858">)</span>&nbsp;<span class="op" id="3567860">&gt;</span>&nbsp;<span class="num" id="3567862">0</span>&nbsp;<span class="comment" id="3567864">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3567921">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3567990">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568042">if</span>&nbsp;<span class="ident" id="3568045">mantissa</span><span class="op" id="3568053">&gt;&gt;</span><span class="ident" id="3568055">Msize2</span>&nbsp;<span class="op" id="3568062">==</span>&nbsp;<span class="num" id="3568065">1</span>&nbsp;<span class="op" id="3568067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568071">if</span>&nbsp;<span class="ident" id="3568074">mantissa</span><span class="op" id="3568082">&amp;</span><span class="num" id="3568083">1</span>&nbsp;<span class="op" id="3568085">==</span>&nbsp;<span class="num" id="3568088">1</span>&nbsp;<span class="op" id="3568090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568095">haveRem</span>&nbsp;<span class="op" id="3568103">=</span>&nbsp;<span class="builtintype" id="3568105">true</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568116">mantissa</span>&nbsp;<span class="op" id="3568125">&gt;&gt;=</span>&nbsp;<span class="num" id="3568129">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568133">exp</span><span class="op" id="3568136">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568143">if</span>&nbsp;<span class="ident" id="3568146">mantissa</span><span class="op" id="3568154">&gt;&gt;</span><span class="ident" id="3568156">Msize1</span>&nbsp;<span class="op" id="3568163">!=</span>&nbsp;<span class="num" id="3568166">1</span>&nbsp;<span class="op" id="3568168">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3568172">panic</span><span class="op" id="3568177">(</span><span class="ident" id="3568178">fmt</span><span class="op" id="3568181">.</span><span class="ident" id="3568182">Sprintf</span><span class="op" id="3568189">(</span><span class="string" id="3568190">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3568226">,</span>&nbsp;<span class="ident" id="3568228">Msize2</span><span class="op" id="3568234">)</span><span class="op" id="3568235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3568242">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568259">if</span>&nbsp;<span class="ident" id="3568262">Emin</span><span class="op" id="3568266">-</span><span class="ident" id="3568267">Msize</span>&nbsp;<span class="op" id="3568273">&lt;=</span>&nbsp;<span class="ident" id="3568276">exp</span>&nbsp;<span class="op" id="3568280">&amp;&amp;</span>&nbsp;<span class="ident" id="3568283">exp</span>&nbsp;<span class="op" id="3568287">&lt;=</span>&nbsp;<span class="ident" id="3568290">Emin</span>&nbsp;<span class="op" id="3568295">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3568299">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568351">shift</span>&nbsp;<span class="op" id="3568357">:=</span>&nbsp;<span class="builtintype" id="3568360">uint</span><span class="op" id="3568364">(</span><span class="ident" id="3568365">Emin</span>&nbsp;<span class="op" id="3568370">-</span>&nbsp;<span class="op" id="3568372">(</span><span class="ident" id="3568373">exp</span>&nbsp;<span class="op" id="3568377">-</span>&nbsp;<span class="num" id="3568379">1</span><span class="op" id="3568380">)</span><span class="op" id="3568381">)</span>&nbsp;<span class="comment" id="3568383">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568400">lostbits</span>&nbsp;<span class="op" id="3568409">:=</span>&nbsp;<span class="ident" id="3568412">mantissa</span>&nbsp;<span class="op" id="3568421">&amp;</span>&nbsp;<span class="op" id="3568423">(</span><span class="num" id="3568424">1</span><span class="op" id="3568425">&lt;&lt;</span><span class="ident" id="3568427">shift</span>&nbsp;<span class="op" id="3568433">-</span>&nbsp;<span class="num" id="3568435">1</span><span class="op" id="3568436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568440">haveRem</span>&nbsp;<span class="op" id="3568448">=</span>&nbsp;<span class="ident" id="3568450">haveRem</span>&nbsp;<span class="op" id="3568458">||</span>&nbsp;<span class="ident" id="3568461">lostbits</span>&nbsp;<span class="op" id="3568470">!=</span>&nbsp;<span class="num" id="3568473">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568477">mantissa</span>&nbsp;<span class="op" id="3568486">&gt;&gt;=</span>&nbsp;<span class="ident" id="3568490">shift</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568498">exp</span>&nbsp;<span class="op" id="3568502">=</span>&nbsp;<span class="num" id="3568504">2</span>&nbsp;<span class="op" id="3568506">-</span>&nbsp;<span class="ident" id="3568508">Ebias</span>&nbsp;<span class="comment" id="3568514">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3568536">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568574">exact</span>&nbsp;<span class="op" id="3568580">=</span>&nbsp;<span class="op" id="3568582">!</span><span class="ident" id="3568583">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568592">if</span>&nbsp;<span class="ident" id="3568595">mantissa</span><span class="op" id="3568603">&amp;</span><span class="num" id="3568604">1</span>&nbsp;<span class="op" id="3568606">!=</span>&nbsp;<span class="num" id="3568609">0</span>&nbsp;<span class="op" id="3568611">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568615">exact</span>&nbsp;<span class="op" id="3568621">=</span>&nbsp;<span class="builtintype" id="3568623">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568631">if</span>&nbsp;<span class="ident" id="3568634">haveRem</span>&nbsp;<span class="op" id="3568642">||</span>&nbsp;<span class="ident" id="3568645">mantissa</span><span class="op" id="3568653">&amp;</span><span class="num" id="3568654">2</span>&nbsp;<span class="op" id="3568656">!=</span>&nbsp;<span class="num" id="3568659">0</span>&nbsp;<span class="op" id="3568661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568666">if</span>&nbsp;<span class="ident" id="3568669">mantissa</span><span class="op" id="3568677">++</span><span class="op" id="3568679">;</span>&nbsp;<span class="ident" id="3568681">mantissa</span>&nbsp;<span class="op" id="3568690">&gt;=</span>&nbsp;<span class="num" id="3568693">1</span><span class="op" id="3568694">&lt;&lt;</span><span class="ident" id="3568696">Msize2</span>&nbsp;<span class="op" id="3568703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3568709">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568770">mantissa</span>&nbsp;<span class="op" id="3568779">&gt;&gt;=</span>&nbsp;<span class="num" id="3568783">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568789">exp</span><span class="op" id="3568792">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568808">mantissa</span>&nbsp;<span class="op" id="3568817">&gt;&gt;=</span>&nbsp;<span class="num" id="3568821">1</span>&nbsp;<span class="comment" id="3568823">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568885">f</span>&nbsp;<span class="op" id="3568887">=</span>&nbsp;<span class="ident" id="3568889">math</span><span class="op" id="3568893">.</span><span class="ident" id="3568894">Ldexp</span><span class="op" id="3568899">(</span><span class="builtintype" id="3568900">float64</span><span class="op" id="3568907">(</span><span class="ident" id="3568908">mantissa</span><span class="op" id="3568916">)</span><span class="op" id="3568917">,</span>&nbsp;<span class="ident" id="3568919">exp</span><span class="op" id="3568922">-</span><span class="ident" id="3568923">Msize1</span><span class="op" id="3568929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568932">if</span>&nbsp;<span class="ident" id="3568935">math</span><span class="op" id="3568939">.</span><span class="ident" id="3568940">IsInf</span><span class="op" id="3568945">(</span><span class="ident" id="3568946">f</span><span class="op" id="3568947">,</span>&nbsp;<span class="num" id="3568949">0</span><span class="op" id="3568950">)</span>&nbsp;<span class="op" id="3568952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568956">exact</span>&nbsp;<span class="op" id="3568962">=</span>&nbsp;<span class="builtintype" id="3568964">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568971">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568974">return</span><br>
<span class="lineno"></span><span class="op" id="3568981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3568984">//&nbsp;Float32&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float32&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3569057">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno">265</span><span class="comment" id="3569130">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float32,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3569199">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3569262">func</span>&nbsp;<span class="op" id="3569267">(</span><span class="ident" id="3569268">x</span>&nbsp;<span class="op" id="3569270">*</span><span class="ident" id="3569271">Rat</span><span class="op" id="3569274">)</span>&nbsp;<span class="ident" id="3569276">Float32</span><span class="op" id="3569283">(</span><span class="op" id="3569284">)</span>&nbsp;<span class="op" id="3569286">(</span><span class="ident" id="3569287">f</span>&nbsp;<span class="builtintype" id="3569289">float32</span><span class="op" id="3569296">,</span>&nbsp;<span class="ident" id="3569298">exact</span>&nbsp;<span class="builtintype" id="3569304">bool</span><span class="op" id="3569308">)</span>&nbsp;<span class="op" id="3569310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569313">b</span>&nbsp;<span class="op" id="3569315">:=</span>&nbsp;<span class="ident" id="3569318">x</span><span class="op" id="3569319">.</span><span class="ident" id="3569320">b</span><span class="op" id="3569321">.</span><span class="ident" id="3569322">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569327">if</span>&nbsp;<span class="builtinfunc" id="3569330">len</span><span class="op" id="3569333">(</span><span class="ident" id="3569334">b</span><span class="op" id="3569335">)</span>&nbsp;<span class="op" id="3569337">==</span>&nbsp;<span class="num" id="3569340">0</span>&nbsp;<span class="op" id="3569342">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569346">b</span>&nbsp;<span class="op" id="3569348">=</span>&nbsp;<span class="ident" id="3569350">b</span><span class="op" id="3569351">.</span><span class="ident" id="3569352">set</span><span class="op" id="3569355">(</span><span class="ident" id="3569356">natOne</span><span class="op" id="3569362">)</span>&nbsp;<span class="comment" id="3569364">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3569392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569395">f</span><span class="op" id="3569396">,</span>&nbsp;<span class="ident" id="3569398">exact</span>&nbsp;<span class="op" id="3569404">=</span>&nbsp;<span class="ident" id="3569406">quotToFloat32</span><span class="op" id="3569419">(</span><span class="ident" id="3569420">x</span><span class="op" id="3569421">.</span><span class="ident" id="3569422">a</span><span class="op" id="3569423">.</span><span class="ident" id="3569424">abs</span><span class="op" id="3569427">,</span>&nbsp;<span class="ident" id="3569429">b</span><span class="op" id="3569430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569433">if</span>&nbsp;<span class="ident" id="3569436">x</span><span class="op" id="3569437">.</span><span class="ident" id="3569438">a</span><span class="op" id="3569439">.</span><span class="ident" id="3569440">neg</span>&nbsp;<span class="op" id="3569444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569448">f</span>&nbsp;<span class="op" id="3569450">=</span>&nbsp;<span class="op" id="3569452">-</span><span class="ident" id="3569453">f</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3569456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569459">return</span><br>
<span class="lineno"></span><span class="op" id="3569466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3569469">//&nbsp;Float64&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float64&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno">280</span><span class="comment" id="3569542">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3569615">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float64,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3569684">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3569747">func</span>&nbsp;<span class="op" id="3569752">(</span><span class="ident" id="3569753">x</span>&nbsp;<span class="op" id="3569755">*</span><span class="ident" id="3569756">Rat</span><span class="op" id="3569759">)</span>&nbsp;<span class="ident" id="3569761">Float64</span><span class="op" id="3569768">(</span><span class="op" id="3569769">)</span>&nbsp;<span class="op" id="3569771">(</span><span class="ident" id="3569772">f</span>&nbsp;<span class="builtintype" id="3569774">float64</span><span class="op" id="3569781">,</span>&nbsp;<span class="ident" id="3569783">exact</span>&nbsp;<span class="builtintype" id="3569789">bool</span><span class="op" id="3569793">)</span>&nbsp;<span class="op" id="3569795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569798">b</span>&nbsp;<span class="op" id="3569800">:=</span>&nbsp;<span class="ident" id="3569803">x</span><span class="op" id="3569804">.</span><span class="ident" id="3569805">b</span><span class="op" id="3569806">.</span><span class="ident" id="3569807">abs</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569812">if</span>&nbsp;<span class="builtinfunc" id="3569815">len</span><span class="op" id="3569818">(</span><span class="ident" id="3569819">b</span><span class="op" id="3569820">)</span>&nbsp;<span class="op" id="3569822">==</span>&nbsp;<span class="num" id="3569825">0</span>&nbsp;<span class="op" id="3569827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569831">b</span>&nbsp;<span class="op" id="3569833">=</span>&nbsp;<span class="ident" id="3569835">b</span><span class="op" id="3569836">.</span><span class="ident" id="3569837">set</span><span class="op" id="3569840">(</span><span class="ident" id="3569841">natOne</span><span class="op" id="3569847">)</span>&nbsp;<span class="comment" id="3569849">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3569877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569880">f</span><span class="op" id="3569881">,</span>&nbsp;<span class="ident" id="3569883">exact</span>&nbsp;<span class="op" id="3569889">=</span>&nbsp;<span class="ident" id="3569891">quotToFloat64</span><span class="op" id="3569904">(</span><span class="ident" id="3569905">x</span><span class="op" id="3569906">.</span><span class="ident" id="3569907">a</span><span class="op" id="3569908">.</span><span class="ident" id="3569909">abs</span><span class="op" id="3569912">,</span>&nbsp;<span class="ident" id="3569914">b</span><span class="op" id="3569915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569918">if</span>&nbsp;<span class="ident" id="3569921">x</span><span class="op" id="3569922">.</span><span class="ident" id="3569923">a</span><span class="op" id="3569924">.</span><span class="ident" id="3569925">neg</span>&nbsp;<span class="op" id="3569929">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569933">f</span>&nbsp;<span class="op" id="3569935">=</span>&nbsp;<span class="op" id="3569937">-</span><span class="ident" id="3569938">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3569941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569944">return</span><br>
<span class="lineno"></span><span class="op" id="3569951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="3569954">//&nbsp;SetFrac&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3569994">func</span>&nbsp;<span class="op" id="3569999">(</span><span class="ident" id="3570000">z</span>&nbsp;<span class="op" id="3570002">*</span><span class="ident" id="3570003">Rat</span><span class="op" id="3570006">)</span>&nbsp;<span class="ident" id="3570008">SetFrac</span><span class="op" id="3570015">(</span><span class="ident" id="3570016">a</span><span class="op" id="3570017">,</span>&nbsp;<span class="ident" id="3570019">b</span>&nbsp;<span class="op" id="3570021">*</span><span class="ident" id="3570022">Int</span><span class="op" id="3570025">)</span>&nbsp;<span class="op" id="3570027">*</span><span class="ident" id="3570028">Rat</span>&nbsp;<span class="op" id="3570032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570035">z</span><span class="op" id="3570036">.</span><span class="ident" id="3570037">a</span><span class="op" id="3570038">.</span><span class="ident" id="3570039">neg</span>&nbsp;<span class="op" id="3570043">=</span>&nbsp;<span class="ident" id="3570045">a</span><span class="op" id="3570046">.</span><span class="ident" id="3570047">neg</span>&nbsp;<span class="op" id="3570051">!=</span>&nbsp;<span class="ident" id="3570054">b</span><span class="op" id="3570055">.</span><span class="ident" id="3570056">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570061">babs</span>&nbsp;<span class="op" id="3570066">:=</span>&nbsp;<span class="ident" id="3570069">b</span><span class="op" id="3570070">.</span><span class="ident" id="3570071">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570076">if</span>&nbsp;<span class="builtinfunc" id="3570079">len</span><span class="op" id="3570082">(</span><span class="ident" id="3570083">babs</span><span class="op" id="3570087">)</span>&nbsp;<span class="op" id="3570089">==</span>&nbsp;<span class="num" id="3570092">0</span>&nbsp;<span class="op" id="3570094">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3570098">panic</span><span class="op" id="3570103">(</span><span class="string" id="3570104">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3570122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3570125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570128">if</span>&nbsp;<span class="op" id="3570131">&amp;</span><span class="ident" id="3570132">z</span><span class="op" id="3570133">.</span><span class="ident" id="3570134">a</span>&nbsp;<span class="op" id="3570136">==</span>&nbsp;<span class="ident" id="3570139">b</span>&nbsp;<span class="op" id="3570141">||</span>&nbsp;<span class="ident" id="3570144">alias</span><span class="op" id="3570149">(</span><span class="ident" id="3570150">z</span><span class="op" id="3570151">.</span><span class="ident" id="3570152">a</span><span class="op" id="3570153">.</span><span class="ident" id="3570154">abs</span><span class="op" id="3570157">,</span>&nbsp;<span class="ident" id="3570159">babs</span><span class="op" id="3570163">)</span>&nbsp;<span class="op" id="3570165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570169">babs</span>&nbsp;<span class="op" id="3570174">=</span>&nbsp;<span class="ident" id="3570176">nat</span><span class="op" id="3570179">(</span><span class="ident" id="3570180">nil</span><span class="op" id="3570183">)</span><span class="op" id="3570184">.</span><span class="ident" id="3570185">set</span><span class="op" id="3570188">(</span><span class="ident" id="3570189">babs</span><span class="op" id="3570193">)</span>&nbsp;<span class="comment" id="3570195">//&nbsp;make&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3570211">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570214">z</span><span class="op" id="3570215">.</span><span class="ident" id="3570216">a</span><span class="op" id="3570217">.</span><span class="ident" id="3570218">abs</span>&nbsp;<span class="op" id="3570222">=</span>&nbsp;<span class="ident" id="3570224">z</span><span class="op" id="3570225">.</span><span class="ident" id="3570226">a</span><span class="op" id="3570227">.</span><span class="ident" id="3570228">abs</span><span class="op" id="3570231">.</span><span class="ident" id="3570232">set</span><span class="op" id="3570235">(</span><span class="ident" id="3570236">a</span><span class="op" id="3570237">.</span><span class="ident" id="3570238">abs</span><span class="op" id="3570241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570244">z</span><span class="op" id="3570245">.</span><span class="ident" id="3570246">b</span><span class="op" id="3570247">.</span><span class="ident" id="3570248">abs</span>&nbsp;<span class="op" id="3570252">=</span>&nbsp;<span class="ident" id="3570254">z</span><span class="op" id="3570255">.</span><span class="ident" id="3570256">b</span><span class="op" id="3570257">.</span><span class="ident" id="3570258">abs</span><span class="op" id="3570261">.</span><span class="ident" id="3570262">set</span><span class="op" id="3570265">(</span><span class="ident" id="3570266">babs</span><span class="op" id="3570270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570273">return</span>&nbsp;<span class="ident" id="3570280">z</span><span class="op" id="3570281">.</span><span class="ident" id="3570282">norm</span><span class="op" id="3570286">(</span><span class="op" id="3570287">)</span><br>
<span class="lineno"></span><span class="op" id="3570289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="3570292">//&nbsp;SetFrac64&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3570334">func</span>&nbsp;<span class="op" id="3570339">(</span><span class="ident" id="3570340">z</span>&nbsp;<span class="op" id="3570342">*</span><span class="ident" id="3570343">Rat</span><span class="op" id="3570346">)</span>&nbsp;<span class="ident" id="3570348">SetFrac64</span><span class="op" id="3570357">(</span><span class="ident" id="3570358">a</span><span class="op" id="3570359">,</span>&nbsp;<span class="ident" id="3570361">b</span>&nbsp;<span class="ident" id="3570363">int64</span><span class="op" id="3570368">)</span>&nbsp;<span class="op" id="3570370">*</span><span class="ident" id="3570371">Rat</span>&nbsp;<span class="op" id="3570375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570378">z</span><span class="op" id="3570379">.</span><span class="ident" id="3570380">a</span><span class="op" id="3570381">.</span><span class="ident" id="3570382">SetInt64</span><span class="op" id="3570390">(</span><span class="ident" id="3570391">a</span><span class="op" id="3570392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570395">if</span>&nbsp;<span class="ident" id="3570398">b</span>&nbsp;<span class="op" id="3570400">==</span>&nbsp;<span class="num" id="3570403">0</span>&nbsp;<span class="op" id="3570405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3570409">panic</span><span class="op" id="3570414">(</span><span class="string" id="3570415">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3570433">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3570436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570439">if</span>&nbsp;<span class="ident" id="3570442">b</span>&nbsp;<span class="op" id="3570444">&lt;</span>&nbsp;<span class="num" id="3570446">0</span>&nbsp;<span class="op" id="3570448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570452">b</span>&nbsp;<span class="op" id="3570454">=</span>&nbsp;<span class="op" id="3570456">-</span><span class="ident" id="3570457">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570461">z</span><span class="op" id="3570462">.</span><span class="ident" id="3570463">a</span><span class="op" id="3570464">.</span><span class="ident" id="3570465">neg</span>&nbsp;<span class="op" id="3570469">=</span>&nbsp;<span class="op" id="3570471">!</span><span class="ident" id="3570472">z</span><span class="op" id="3570473">.</span><span class="ident" id="3570474">a</span><span class="op" id="3570475">.</span><span class="ident" id="3570476">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3570481">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570484">z</span><span class="op" id="3570485">.</span><span class="ident" id="3570486">b</span><span class="op" id="3570487">.</span><span class="ident" id="3570488">abs</span>&nbsp;<span class="op" id="3570492">=</span>&nbsp;<span class="ident" id="3570494">z</span><span class="op" id="3570495">.</span><span class="ident" id="3570496">b</span><span class="op" id="3570497">.</span><span class="ident" id="3570498">abs</span><span class="op" id="3570501">.</span><span class="ident" id="3570502">setUint64</span><span class="op" id="3570511">(</span><span class="ident" id="3570512">uint64</span><span class="op" id="3570518">(</span><span class="ident" id="3570519">b</span><span class="op" id="3570520">)</span><span class="op" id="3570521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570524">return</span>&nbsp;<span class="ident" id="3570531">z</span><span class="op" id="3570532">.</span><span class="ident" id="3570533">norm</span><span class="op" id="3570537">(</span><span class="op" id="3570538">)</span><br>
<span class="lineno"></span><span class="op" id="3570540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3570543">//&nbsp;SetInt&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">325</span><span class="keyword" id="3570604">func</span>&nbsp;<span class="op" id="3570609">(</span><span class="ident" id="3570610">z</span>&nbsp;<span class="op" id="3570612">*</span><span class="ident" id="3570613">Rat</span><span class="op" id="3570616">)</span>&nbsp;<span class="ident" id="3570618">SetInt</span><span class="op" id="3570624">(</span><span class="ident" id="3570625">x</span>&nbsp;<span class="op" id="3570627">*</span><span class="ident" id="3570628">Int</span><span class="op" id="3570631">)</span>&nbsp;<span class="op" id="3570633">*</span><span class="ident" id="3570634">Rat</span>&nbsp;<span class="op" id="3570638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570641">z</span><span class="op" id="3570642">.</span><span class="ident" id="3570643">a</span><span class="op" id="3570644">.</span><span class="ident" id="3570645">Set</span><span class="op" id="3570648">(</span><span class="ident" id="3570649">x</span><span class="op" id="3570650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570653">z</span><span class="op" id="3570654">.</span><span class="ident" id="3570655">b</span><span class="op" id="3570656">.</span><span class="ident" id="3570657">abs</span>&nbsp;<span class="op" id="3570661">=</span>&nbsp;<span class="ident" id="3570663">z</span><span class="op" id="3570664">.</span><span class="ident" id="3570665">b</span><span class="op" id="3570666">.</span><span class="ident" id="3570667">abs</span><span class="op" id="3570670">.</span><span class="builtinfunc" id="3570671">make</span><span class="op" id="3570675">(</span><span class="num" id="3570676">0</span><span class="op" id="3570677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570680">return</span>&nbsp;<span class="ident" id="3570687">z</span><br>
<span class="lineno"></span><span class="op" id="3570689">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3570692">//&nbsp;SetInt64&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3570731">func</span>&nbsp;<span class="op" id="3570736">(</span><span class="ident" id="3570737">z</span>&nbsp;<span class="op" id="3570739">*</span><span class="ident" id="3570740">Rat</span><span class="op" id="3570743">)</span>&nbsp;<span class="ident" id="3570745">SetInt64</span><span class="op" id="3570753">(</span><span class="ident" id="3570754">x</span>&nbsp;<span class="ident" id="3570756">int64</span><span class="op" id="3570761">)</span>&nbsp;<span class="op" id="3570763">*</span><span class="ident" id="3570764">Rat</span>&nbsp;<span class="op" id="3570768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570771">z</span><span class="op" id="3570772">.</span><span class="ident" id="3570773">a</span><span class="op" id="3570774">.</span><span class="ident" id="3570775">SetInt64</span><span class="op" id="3570783">(</span><span class="ident" id="3570784">x</span><span class="op" id="3570785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570788">z</span><span class="op" id="3570789">.</span><span class="ident" id="3570790">b</span><span class="op" id="3570791">.</span><span class="ident" id="3570792">abs</span>&nbsp;<span class="op" id="3570796">=</span>&nbsp;<span class="ident" id="3570798">z</span><span class="op" id="3570799">.</span><span class="ident" id="3570800">b</span><span class="op" id="3570801">.</span><span class="ident" id="3570802">abs</span><span class="op" id="3570805">.</span><span class="builtinfunc" id="3570806">make</span><span class="op" id="3570810">(</span><span class="num" id="3570811">0</span><span class="op" id="3570812">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570815">return</span>&nbsp;<span class="ident" id="3570822">z</span><br>
<span class="lineno"></span><span class="op" id="3570824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3570827">//&nbsp;Set&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3570885">func</span>&nbsp;<span class="op" id="3570890">(</span><span class="ident" id="3570891">z</span>&nbsp;<span class="op" id="3570893">*</span><span class="ident" id="3570894">Rat</span><span class="op" id="3570897">)</span>&nbsp;<span class="ident" id="3570899">Set</span><span class="op" id="3570902">(</span><span class="ident" id="3570903">x</span>&nbsp;<span class="op" id="3570905">*</span><span class="ident" id="3570906">Rat</span><span class="op" id="3570909">)</span>&nbsp;<span class="op" id="3570911">*</span><span class="ident" id="3570912">Rat</span>&nbsp;<span class="op" id="3570916">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570919">if</span>&nbsp;<span class="ident" id="3570922">z</span>&nbsp;<span class="op" id="3570924">!=</span>&nbsp;<span class="ident" id="3570927">x</span>&nbsp;<span class="op" id="3570929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570933">z</span><span class="op" id="3570934">.</span><span class="ident" id="3570935">a</span><span class="op" id="3570936">.</span><span class="ident" id="3570937">Set</span><span class="op" id="3570940">(</span><span class="op" id="3570941">&amp;</span><span class="ident" id="3570942">x</span><span class="op" id="3570943">.</span><span class="ident" id="3570944">a</span><span class="op" id="3570945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570949">z</span><span class="op" id="3570950">.</span><span class="ident" id="3570951">b</span><span class="op" id="3570952">.</span><span class="ident" id="3570953">Set</span><span class="op" id="3570956">(</span><span class="op" id="3570957">&amp;</span><span class="ident" id="3570958">x</span><span class="op" id="3570959">.</span><span class="ident" id="3570960">b</span><span class="op" id="3570961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3570964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570967">return</span>&nbsp;<span class="ident" id="3570974">z</span><br>
<span class="lineno">345</span><span class="op" id="3570976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3570979">//&nbsp;Abs&nbsp;sets&nbsp;z&nbsp;to&nbsp;|x|&nbsp;(the&nbsp;absolute&nbsp;value&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3571041">func</span>&nbsp;<span class="op" id="3571046">(</span><span class="ident" id="3571047">z</span>&nbsp;<span class="op" id="3571049">*</span><span class="ident" id="3571050">Rat</span><span class="op" id="3571053">)</span>&nbsp;<span class="ident" id="3571055">Abs</span><span class="op" id="3571058">(</span><span class="ident" id="3571059">x</span>&nbsp;<span class="op" id="3571061">*</span><span class="ident" id="3571062">Rat</span><span class="op" id="3571065">)</span>&nbsp;<span class="op" id="3571067">*</span><span class="ident" id="3571068">Rat</span>&nbsp;<span class="op" id="3571072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571075">z</span><span class="op" id="3571076">.</span><span class="ident" id="3571077">Set</span><span class="op" id="3571080">(</span><span class="ident" id="3571081">x</span><span class="op" id="3571082">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571085">z</span><span class="op" id="3571086">.</span><span class="ident" id="3571087">a</span><span class="op" id="3571088">.</span><span class="ident" id="3571089">neg</span>&nbsp;<span class="op" id="3571093">=</span>&nbsp;<span class="builtintype" id="3571095">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571102">return</span>&nbsp;<span class="ident" id="3571109">z</span><br>
<span class="lineno"></span><span class="op" id="3571111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3571114">//&nbsp;Neg&nbsp;sets&nbsp;z&nbsp;to&nbsp;-x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">355</span><span class="keyword" id="3571149">func</span>&nbsp;<span class="op" id="3571154">(</span><span class="ident" id="3571155">z</span>&nbsp;<span class="op" id="3571157">*</span><span class="ident" id="3571158">Rat</span><span class="op" id="3571161">)</span>&nbsp;<span class="ident" id="3571163">Neg</span><span class="op" id="3571166">(</span><span class="ident" id="3571167">x</span>&nbsp;<span class="op" id="3571169">*</span><span class="ident" id="3571170">Rat</span><span class="op" id="3571173">)</span>&nbsp;<span class="op" id="3571175">*</span><span class="ident" id="3571176">Rat</span>&nbsp;<span class="op" id="3571180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571183">z</span><span class="op" id="3571184">.</span><span class="ident" id="3571185">Set</span><span class="op" id="3571188">(</span><span class="ident" id="3571189">x</span><span class="op" id="3571190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571193">z</span><span class="op" id="3571194">.</span><span class="ident" id="3571195">a</span><span class="op" id="3571196">.</span><span class="ident" id="3571197">neg</span>&nbsp;<span class="op" id="3571201">=</span>&nbsp;<span class="builtinfunc" id="3571203">len</span><span class="op" id="3571206">(</span><span class="ident" id="3571207">z</span><span class="op" id="3571208">.</span><span class="ident" id="3571209">a</span><span class="op" id="3571210">.</span><span class="ident" id="3571211">abs</span><span class="op" id="3571214">)</span>&nbsp;<span class="op" id="3571216">&gt;</span>&nbsp;<span class="num" id="3571218">0</span>&nbsp;<span class="op" id="3571220">&amp;&amp;</span>&nbsp;<span class="op" id="3571223">!</span><span class="ident" id="3571224">z</span><span class="op" id="3571225">.</span><span class="ident" id="3571226">a</span><span class="op" id="3571227">.</span><span class="ident" id="3571228">neg</span>&nbsp;<span class="comment" id="3571232">//&nbsp;0&nbsp;has&nbsp;no&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571250">return</span>&nbsp;<span class="ident" id="3571257">z</span><br>
<span class="lineno"></span><span class="op" id="3571259">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="3571262">//&nbsp;Inv&nbsp;sets&nbsp;z&nbsp;to&nbsp;1/x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3571298">func</span>&nbsp;<span class="op" id="3571303">(</span><span class="ident" id="3571304">z</span>&nbsp;<span class="op" id="3571306">*</span><span class="ident" id="3571307">Rat</span><span class="op" id="3571310">)</span>&nbsp;<span class="ident" id="3571312">Inv</span><span class="op" id="3571315">(</span><span class="ident" id="3571316">x</span>&nbsp;<span class="op" id="3571318">*</span><span class="ident" id="3571319">Rat</span><span class="op" id="3571322">)</span>&nbsp;<span class="op" id="3571324">*</span><span class="ident" id="3571325">Rat</span>&nbsp;<span class="op" id="3571329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571332">if</span>&nbsp;<span class="builtinfunc" id="3571335">len</span><span class="op" id="3571338">(</span><span class="ident" id="3571339">x</span><span class="op" id="3571340">.</span><span class="ident" id="3571341">a</span><span class="op" id="3571342">.</span><span class="ident" id="3571343">abs</span><span class="op" id="3571346">)</span>&nbsp;<span class="op" id="3571348">==</span>&nbsp;<span class="num" id="3571351">0</span>&nbsp;<span class="op" id="3571353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3571357">panic</span><span class="op" id="3571362">(</span><span class="string" id="3571363">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3571381">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3571384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571387">z</span><span class="op" id="3571388">.</span><span class="ident" id="3571389">Set</span><span class="op" id="3571392">(</span><span class="ident" id="3571393">x</span><span class="op" id="3571394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571397">a</span>&nbsp;<span class="op" id="3571399">:=</span>&nbsp;<span class="ident" id="3571402">z</span><span class="op" id="3571403">.</span><span class="ident" id="3571404">b</span><span class="op" id="3571405">.</span><span class="ident" id="3571406">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571411">if</span>&nbsp;<span class="builtinfunc" id="3571414">len</span><span class="op" id="3571417">(</span><span class="ident" id="3571418">a</span><span class="op" id="3571419">)</span>&nbsp;<span class="op" id="3571421">==</span>&nbsp;<span class="num" id="3571424">0</span>&nbsp;<span class="op" id="3571426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571430">a</span>&nbsp;<span class="op" id="3571432">=</span>&nbsp;<span class="ident" id="3571434">a</span><span class="op" id="3571435">.</span><span class="ident" id="3571436">set</span><span class="op" id="3571439">(</span><span class="ident" id="3571440">natOne</span><span class="op" id="3571446">)</span>&nbsp;<span class="comment" id="3571448">//&nbsp;materialize&nbsp;numerator</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3571474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571477">b</span>&nbsp;<span class="op" id="3571479">:=</span>&nbsp;<span class="ident" id="3571482">z</span><span class="op" id="3571483">.</span><span class="ident" id="3571484">a</span><span class="op" id="3571485">.</span><span class="ident" id="3571486">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571491">if</span>&nbsp;<span class="ident" id="3571494">b</span><span class="op" id="3571495">.</span><span class="ident" id="3571496">cmp</span><span class="op" id="3571499">(</span><span class="ident" id="3571500">natOne</span><span class="op" id="3571506">)</span>&nbsp;<span class="op" id="3571508">==</span>&nbsp;<span class="num" id="3571511">0</span>&nbsp;<span class="op" id="3571513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571517">b</span>&nbsp;<span class="op" id="3571519">=</span>&nbsp;<span class="ident" id="3571521">b</span><span class="op" id="3571522">.</span><span class="builtinfunc" id="3571523">make</span><span class="op" id="3571527">(</span><span class="num" id="3571528">0</span><span class="op" id="3571529">)</span>&nbsp;<span class="comment" id="3571531">//&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3571557">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571560">z</span><span class="op" id="3571561">.</span><span class="ident" id="3571562">a</span><span class="op" id="3571563">.</span><span class="ident" id="3571564">abs</span><span class="op" id="3571567">,</span>&nbsp;<span class="ident" id="3571569">z</span><span class="op" id="3571570">.</span><span class="ident" id="3571571">b</span><span class="op" id="3571572">.</span><span class="ident" id="3571573">abs</span>&nbsp;<span class="op" id="3571577">=</span>&nbsp;<span class="ident" id="3571579">a</span><span class="op" id="3571580">,</span>&nbsp;<span class="ident" id="3571582">b</span>&nbsp;<span class="comment" id="3571584">//&nbsp;sign&nbsp;doesn&#39;t&nbsp;change</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571608">return</span>&nbsp;<span class="ident" id="3571615">z</span><br>
<span class="lineno"></span><span class="op" id="3571617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3571620">//&nbsp;Sign&nbsp;returns:</span><br>
<span class="lineno">380</span><span class="comment" id="3571637">//</span><br>
<span class="lineno"></span><span class="comment" id="3571640">//&nbsp;&nbsp;&nbsp;&nbsp-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3571656">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3571672">//&nbsp;&nbsp;&nbsp;&nbsp+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3571688">//</span><br>
<span class="lineno">385</span><span class="keyword" id="3571691">func</span>&nbsp;<span class="op" id="3571696">(</span><span class="ident" id="3571697">x</span>&nbsp;<span class="op" id="3571699">*</span><span class="ident" id="3571700">Rat</span><span class="op" id="3571703">)</span>&nbsp;<span class="ident" id="3571705">Sign</span><span class="op" id="3571709">(</span><span class="op" id="3571710">)</span>&nbsp;<span class="builtintype" id="3571712">int</span>&nbsp;<span class="op" id="3571716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571719">return</span>&nbsp;<span class="ident" id="3571726">x</span><span class="op" id="3571727">.</span><span class="ident" id="3571728">a</span><span class="op" id="3571729">.</span><span class="ident" id="3571730">Sign</span><span class="op" id="3571734">(</span><span class="op" id="3571735">)</span><br>
<span class="lineno"></span><span class="op" id="3571737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3571740">//&nbsp;IsInt&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x&nbsp;is&nbsp;1.</span><br>
<span class="lineno">390</span><span class="keyword" id="3571792">func</span>&nbsp;<span class="op" id="3571797">(</span><span class="ident" id="3571798">x</span>&nbsp;<span class="op" id="3571800">*</span><span class="ident" id="3571801">Rat</span><span class="op" id="3571804">)</span>&nbsp;<span class="ident" id="3571806">IsInt</span><span class="op" id="3571811">(</span><span class="op" id="3571812">)</span>&nbsp;<span class="builtintype" id="3571814">bool</span>&nbsp;<span class="op" id="3571819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571822">return</span>&nbsp;<span class="builtinfunc" id="3571829">len</span><span class="op" id="3571832">(</span><span class="ident" id="3571833">x</span><span class="op" id="3571834">.</span><span class="ident" id="3571835">b</span><span class="op" id="3571836">.</span><span class="ident" id="3571837">abs</span><span class="op" id="3571840">)</span>&nbsp;<span class="op" id="3571842">==</span>&nbsp;<span class="num" id="3571845">0</span>&nbsp;<span class="op" id="3571847">||</span>&nbsp;<span class="ident" id="3571850">x</span><span class="op" id="3571851">.</span><span class="ident" id="3571852">b</span><span class="op" id="3571853">.</span><span class="ident" id="3571854">abs</span><span class="op" id="3571857">.</span><span class="ident" id="3571858">cmp</span><span class="op" id="3571861">(</span><span class="ident" id="3571862">natOne</span><span class="op" id="3571868">)</span>&nbsp;<span class="op" id="3571870">==</span>&nbsp;<span class="num" id="3571873">0</span><br>
<span class="lineno"></span><span class="op" id="3571875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3571878">//&nbsp;Num&nbsp;returns&nbsp;the&nbsp;numerator&nbsp;of&nbsp;x;&nbsp;it&nbsp;may&nbsp;be&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno">395</span><span class="comment" id="3571929">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;numerator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3571979">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span><span class="comment" id="3572042">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;the&nbsp;numerator&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;sign&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3572101">func</span>&nbsp;<span class="op" id="3572106">(</span><span class="ident" id="3572107">x</span>&nbsp;<span class="op" id="3572109">*</span><span class="ident" id="3572110">Rat</span><span class="op" id="3572113">)</span>&nbsp;<span class="ident" id="3572115">Num</span><span class="op" id="3572118">(</span><span class="op" id="3572119">)</span>&nbsp;<span class="op" id="3572121">*</span><span class="ident" id="3572122">Int</span>&nbsp;<span class="op" id="3572126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572129">return</span>&nbsp;<span class="op" id="3572136">&amp;</span><span class="ident" id="3572137">x</span><span class="op" id="3572138">.</span><span class="ident" id="3572139">a</span><br>
<span class="lineno">400</span><span class="op" id="3572141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3572144">//&nbsp;Denom&nbsp;returns&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x;&nbsp;it&nbsp;is&nbsp;always&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3572201">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;denominator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3572253">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno">405</span><span class="keyword" id="3572316">func</span>&nbsp;<span class="op" id="3572321">(</span><span class="ident" id="3572322">x</span>&nbsp;<span class="op" id="3572324">*</span><span class="ident" id="3572325">Rat</span><span class="op" id="3572328">)</span>&nbsp;<span class="ident" id="3572330">Denom</span><span class="op" id="3572335">(</span><span class="op" id="3572336">)</span>&nbsp;<span class="op" id="3572338">*</span><span class="ident" id="3572339">Int</span>&nbsp;<span class="op" id="3572343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572346">x</span><span class="op" id="3572347">.</span><span class="ident" id="3572348">b</span><span class="op" id="3572349">.</span><span class="ident" id="3572350">neg</span>&nbsp;<span class="op" id="3572354">=</span>&nbsp;<span class="builtintype" id="3572356">false</span>&nbsp;<span class="comment" id="3572362">//&nbsp;the&nbsp;result&nbsp;is&nbsp;always&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572392">if</span>&nbsp;<span class="builtinfunc" id="3572395">len</span><span class="op" id="3572398">(</span><span class="ident" id="3572399">x</span><span class="op" id="3572400">.</span><span class="ident" id="3572401">b</span><span class="op" id="3572402">.</span><span class="ident" id="3572403">abs</span><span class="op" id="3572406">)</span>&nbsp;<span class="op" id="3572408">==</span>&nbsp;<span class="num" id="3572411">0</span>&nbsp;<span class="op" id="3572413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572417">x</span><span class="op" id="3572418">.</span><span class="ident" id="3572419">b</span><span class="op" id="3572420">.</span><span class="ident" id="3572421">abs</span>&nbsp;<span class="op" id="3572425">=</span>&nbsp;<span class="ident" id="3572427">x</span><span class="op" id="3572428">.</span><span class="ident" id="3572429">b</span><span class="op" id="3572430">.</span><span class="ident" id="3572431">abs</span><span class="op" id="3572434">.</span><span class="ident" id="3572435">set</span><span class="op" id="3572438">(</span><span class="ident" id="3572439">natOne</span><span class="op" id="3572445">)</span>&nbsp;<span class="comment" id="3572447">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3572475">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572478">return</span>&nbsp;<span class="op" id="3572485">&amp;</span><span class="ident" id="3572486">x</span><span class="op" id="3572487">.</span><span class="ident" id="3572488">b</span><br>
<span class="lineno"></span><span class="op" id="3572490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3572493">func</span>&nbsp;<span class="op" id="3572498">(</span><span class="ident" id="3572499">z</span>&nbsp;<span class="op" id="3572501">*</span><span class="ident" id="3572502">Rat</span><span class="op" id="3572505">)</span>&nbsp;<span class="ident" id="3572507">norm</span><span class="op" id="3572511">(</span><span class="op" id="3572512">)</span>&nbsp;<span class="op" id="3572514">*</span><span class="ident" id="3572515">Rat</span>&nbsp;<span class="op" id="3572519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572522">switch</span>&nbsp;<span class="op" id="3572529">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572532">case</span>&nbsp;<span class="builtinfunc" id="3572537">len</span><span class="op" id="3572540">(</span><span class="ident" id="3572541">z</span><span class="op" id="3572542">.</span><span class="ident" id="3572543">a</span><span class="op" id="3572544">.</span><span class="ident" id="3572545">abs</span><span class="op" id="3572548">)</span>&nbsp;<span class="op" id="3572550">==</span>&nbsp;<span class="num" id="3572553">0</span><span class="op" id="3572554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3572558">//&nbsp;z&nbsp;==&nbsp;0&nbsp;-&nbsp;normalize&nbsp;sign&nbsp;and&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572603">z</span><span class="op" id="3572604">.</span><span class="ident" id="3572605">a</span><span class="op" id="3572606">.</span><span class="ident" id="3572607">neg</span>&nbsp;<span class="op" id="3572611">=</span>&nbsp;<span class="builtintype" id="3572613">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572621">z</span><span class="op" id="3572622">.</span><span class="ident" id="3572623">b</span><span class="op" id="3572624">.</span><span class="ident" id="3572625">abs</span>&nbsp;<span class="op" id="3572629">=</span>&nbsp;<span class="ident" id="3572631">z</span><span class="op" id="3572632">.</span><span class="ident" id="3572633">b</span><span class="op" id="3572634">.</span><span class="ident" id="3572635">abs</span><span class="op" id="3572638">.</span><span class="builtinfunc" id="3572639">make</span><span class="op" id="3572643">(</span><span class="num" id="3572644">0</span><span class="op" id="3572645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572648">case</span>&nbsp;<span class="builtinfunc" id="3572653">len</span><span class="op" id="3572656">(</span><span class="ident" id="3572657">z</span><span class="op" id="3572658">.</span><span class="ident" id="3572659">b</span><span class="op" id="3572660">.</span><span class="ident" id="3572661">abs</span><span class="op" id="3572664">)</span>&nbsp;<span class="op" id="3572666">==</span>&nbsp;<span class="num" id="3572669">0</span><span class="op" id="3572670">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3572674">//&nbsp;z&nbsp;is&nbsp;normalized&nbsp;int&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572714">case</span>&nbsp;<span class="ident" id="3572719">z</span><span class="op" id="3572720">.</span><span class="ident" id="3572721">b</span><span class="op" id="3572722">.</span><span class="ident" id="3572723">abs</span><span class="op" id="3572726">.</span><span class="ident" id="3572727">cmp</span><span class="op" id="3572730">(</span><span class="ident" id="3572731">natOne</span><span class="op" id="3572737">)</span>&nbsp;<span class="op" id="3572739">==</span>&nbsp;<span class="num" id="3572742">0</span><span class="op" id="3572743">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3572747">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572785">z</span><span class="op" id="3572786">.</span><span class="ident" id="3572787">b</span><span class="op" id="3572788">.</span><span class="ident" id="3572789">abs</span>&nbsp;<span class="op" id="3572793">=</span>&nbsp;<span class="ident" id="3572795">z</span><span class="op" id="3572796">.</span><span class="ident" id="3572797">b</span><span class="op" id="3572798">.</span><span class="ident" id="3572799">abs</span><span class="op" id="3572802">.</span><span class="builtinfunc" id="3572803">make</span><span class="op" id="3572807">(</span><span class="num" id="3572808">0</span><span class="op" id="3572809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572812">default</span><span class="op" id="3572819">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572823">neg</span>&nbsp;<span class="op" id="3572827">:=</span>&nbsp;<span class="ident" id="3572830">z</span><span class="op" id="3572831">.</span><span class="ident" id="3572832">a</span><span class="op" id="3572833">.</span><span class="ident" id="3572834">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572840">z</span><span class="op" id="3572841">.</span><span class="ident" id="3572842">a</span><span class="op" id="3572843">.</span><span class="ident" id="3572844">neg</span>&nbsp;<span class="op" id="3572848">=</span>&nbsp;<span class="builtintype" id="3572850">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572858">z</span><span class="op" id="3572859">.</span><span class="ident" id="3572860">b</span><span class="op" id="3572861">.</span><span class="ident" id="3572862">neg</span>&nbsp;<span class="op" id="3572866">=</span>&nbsp;<span class="builtintype" id="3572868">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572876">if</span>&nbsp;<span class="ident" id="3572879">f</span>&nbsp;<span class="op" id="3572881">:=</span>&nbsp;<span class="ident" id="3572884">NewInt</span><span class="op" id="3572890">(</span><span class="num" id="3572891">0</span><span class="op" id="3572892">)</span><span class="op" id="3572893">.</span><span class="ident" id="3572894">binaryGCD</span><span class="op" id="3572903">(</span><span class="op" id="3572904">&amp;</span><span class="ident" id="3572905">z</span><span class="op" id="3572906">.</span><span class="ident" id="3572907">a</span><span class="op" id="3572908">,</span>&nbsp;<span class="op" id="3572910">&amp;</span><span class="ident" id="3572911">z</span><span class="op" id="3572912">.</span><span class="ident" id="3572913">b</span><span class="op" id="3572914">)</span><span class="op" id="3572915">;</span>&nbsp;<span class="ident" id="3572917">f</span><span class="op" id="3572918">.</span><span class="ident" id="3572919">Cmp</span><span class="op" id="3572922">(</span><span class="ident" id="3572923">intOne</span><span class="op" id="3572929">)</span>&nbsp;<span class="op" id="3572931">!=</span>&nbsp;<span class="num" id="3572934">0</span>&nbsp;<span class="op" id="3572936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572941">z</span><span class="op" id="3572942">.</span><span class="ident" id="3572943">a</span><span class="op" id="3572944">.</span><span class="ident" id="3572945">abs</span><span class="op" id="3572948">,</span>&nbsp;<span class="ident" id="3572950">_</span>&nbsp;<span class="op" id="3572952">=</span>&nbsp;<span class="ident" id="3572954">z</span><span class="op" id="3572955">.</span><span class="ident" id="3572956">a</span><span class="op" id="3572957">.</span><span class="ident" id="3572958">abs</span><span class="op" id="3572961">.</span><span class="ident" id="3572962">div</span><span class="op" id="3572965">(</span><span class="ident" id="3572966">nil</span><span class="op" id="3572969">,</span>&nbsp;<span class="ident" id="3572971">z</span><span class="op" id="3572972">.</span><span class="ident" id="3572973">a</span><span class="op" id="3572974">.</span><span class="ident" id="3572975">abs</span><span class="op" id="3572978">,</span>&nbsp;<span class="ident" id="3572980">f</span><span class="op" id="3572981">.</span><span class="ident" id="3572982">abs</span><span class="op" id="3572985">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572990">z</span><span class="op" id="3572991">.</span><span class="ident" id="3572992">b</span><span class="op" id="3572993">.</span><span class="ident" id="3572994">abs</span><span class="op" id="3572997">,</span>&nbsp;<span class="ident" id="3572999">_</span>&nbsp;<span class="op" id="3573001">=</span>&nbsp;<span class="ident" id="3573003">z</span><span class="op" id="3573004">.</span><span class="ident" id="3573005">b</span><span class="op" id="3573006">.</span><span class="ident" id="3573007">abs</span><span class="op" id="3573010">.</span><span class="ident" id="3573011">div</span><span class="op" id="3573014">(</span><span class="ident" id="3573015">nil</span><span class="op" id="3573018">,</span>&nbsp;<span class="ident" id="3573020">z</span><span class="op" id="3573021">.</span><span class="ident" id="3573022">b</span><span class="op" id="3573023">.</span><span class="ident" id="3573024">abs</span><span class="op" id="3573027">,</span>&nbsp;<span class="ident" id="3573029">f</span><span class="op" id="3573030">.</span><span class="ident" id="3573031">abs</span><span class="op" id="3573034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573039">if</span>&nbsp;<span class="ident" id="3573042">z</span><span class="op" id="3573043">.</span><span class="ident" id="3573044">b</span><span class="op" id="3573045">.</span><span class="ident" id="3573046">abs</span><span class="op" id="3573049">.</span><span class="ident" id="3573050">cmp</span><span class="op" id="3573053">(</span><span class="ident" id="3573054">natOne</span><span class="op" id="3573060">)</span>&nbsp;<span class="op" id="3573062">==</span>&nbsp;<span class="num" id="3573065">0</span>&nbsp;<span class="op" id="3573067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3573073">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573113">z</span><span class="op" id="3573114">.</span><span class="ident" id="3573115">b</span><span class="op" id="3573116">.</span><span class="ident" id="3573117">abs</span>&nbsp;<span class="op" id="3573121">=</span>&nbsp;<span class="ident" id="3573123">z</span><span class="op" id="3573124">.</span><span class="ident" id="3573125">b</span><span class="op" id="3573126">.</span><span class="ident" id="3573127">abs</span><span class="op" id="3573130">.</span><span class="builtinfunc" id="3573131">make</span><span class="op" id="3573135">(</span><span class="num" id="3573136">0</span><span class="op" id="3573137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573142">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573150">z</span><span class="op" id="3573151">.</span><span class="ident" id="3573152">a</span><span class="op" id="3573153">.</span><span class="ident" id="3573154">neg</span>&nbsp;<span class="op" id="3573158">=</span>&nbsp;<span class="ident" id="3573160">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573168">return</span>&nbsp;<span class="ident" id="3573175">z</span><br>
<span class="lineno"></span><span class="op" id="3573177">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="3573180">//&nbsp;mulDenom&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;denominator&nbsp;product&nbsp;x*y&nbsp;(by&nbsp;taking&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3573246">//&nbsp;account&nbsp;that&nbsp;0&nbsp;values&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;1)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3573312">//&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3573326">func</span>&nbsp;<span class="ident" id="3573331">mulDenom</span><span class="op" id="3573339">(</span><span class="ident" id="3573340">z</span><span class="op" id="3573341">,</span>&nbsp;<span class="ident" id="3573343">x</span><span class="op" id="3573344">,</span>&nbsp;<span class="ident" id="3573346">y</span>&nbsp;<span class="ident" id="3573348">nat</span><span class="op" id="3573351">)</span>&nbsp;<span class="ident" id="3573353">nat</span>&nbsp;<span class="op" id="3573357">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573360">switch</span>&nbsp;<span class="op" id="3573367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573370">case</span>&nbsp;<span class="builtinfunc" id="3573375">len</span><span class="op" id="3573378">(</span><span class="ident" id="3573379">x</span><span class="op" id="3573380">)</span>&nbsp;<span class="op" id="3573382">==</span>&nbsp;<span class="num" id="3573385">0</span><span class="op" id="3573386">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573390">return</span>&nbsp;<span class="ident" id="3573397">z</span><span class="op" id="3573398">.</span><span class="ident" id="3573399">set</span><span class="op" id="3573402">(</span><span class="ident" id="3573403">y</span><span class="op" id="3573404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573407">case</span>&nbsp;<span class="builtinfunc" id="3573412">len</span><span class="op" id="3573415">(</span><span class="ident" id="3573416">y</span><span class="op" id="3573417">)</span>&nbsp;<span class="op" id="3573419">==</span>&nbsp;<span class="num" id="3573422">0</span><span class="op" id="3573423">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573427">return</span>&nbsp;<span class="ident" id="3573434">z</span><span class="op" id="3573435">.</span><span class="ident" id="3573436">set</span><span class="op" id="3573439">(</span><span class="ident" id="3573440">x</span><span class="op" id="3573441">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573447">return</span>&nbsp;<span class="ident" id="3573454">z</span><span class="op" id="3573455">.</span><span class="ident" id="3573456">mul</span><span class="op" id="3573459">(</span><span class="ident" id="3573460">x</span><span class="op" id="3573461">,</span>&nbsp;<span class="ident" id="3573463">y</span><span class="op" id="3573464">)</span><br>
<span class="lineno"></span><span class="op" id="3573466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3573469">//&nbsp;scaleDenom&nbsp;computes&nbsp;x*f.</span><br>
<span class="lineno">455</span><span class="comment" id="3573497">//&nbsp;If&nbsp;f&nbsp;==&nbsp;0&nbsp;(zero&nbsp;value&nbsp;of&nbsp;denominator),&nbsp;the&nbsp;result&nbsp;is&nbsp;(a&nbsp;copy&nbsp;of)&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3573568">func</span>&nbsp;<span class="ident" id="3573573">scaleDenom</span><span class="op" id="3573583">(</span><span class="ident" id="3573584">x</span>&nbsp;<span class="op" id="3573586">*</span><span class="ident" id="3573587">Int</span><span class="op" id="3573590">,</span>&nbsp;<span class="ident" id="3573592">f</span>&nbsp;<span class="ident" id="3573594">nat</span><span class="op" id="3573597">)</span>&nbsp;<span class="op" id="3573599">*</span><span class="ident" id="3573600">Int</span>&nbsp;<span class="op" id="3573604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573607">var</span>&nbsp;<span class="ident" id="3573611">z</span>&nbsp;<span class="ident" id="3573613">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573618">if</span>&nbsp;<span class="builtinfunc" id="3573621">len</span><span class="op" id="3573624">(</span><span class="ident" id="3573625">f</span><span class="op" id="3573626">)</span>&nbsp;<span class="op" id="3573628">==</span>&nbsp;<span class="num" id="3573631">0</span>&nbsp;<span class="op" id="3573633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573637">return</span>&nbsp;<span class="ident" id="3573644">z</span><span class="op" id="3573645">.</span><span class="ident" id="3573646">Set</span><span class="op" id="3573649">(</span><span class="ident" id="3573650">x</span><span class="op" id="3573651">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573657">z</span><span class="op" id="3573658">.</span><span class="ident" id="3573659">abs</span>&nbsp;<span class="op" id="3573663">=</span>&nbsp;<span class="ident" id="3573665">z</span><span class="op" id="3573666">.</span><span class="ident" id="3573667">abs</span><span class="op" id="3573670">.</span><span class="ident" id="3573671">mul</span><span class="op" id="3573674">(</span><span class="ident" id="3573675">x</span><span class="op" id="3573676">.</span><span class="ident" id="3573677">abs</span><span class="op" id="3573680">,</span>&nbsp;<span class="ident" id="3573682">f</span><span class="op" id="3573683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573686">z</span><span class="op" id="3573687">.</span><span class="ident" id="3573688">neg</span>&nbsp;<span class="op" id="3573692">=</span>&nbsp;<span class="ident" id="3573694">x</span><span class="op" id="3573695">.</span><span class="ident" id="3573696">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573701">return</span>&nbsp;<span class="op" id="3573708">&amp;</span><span class="ident" id="3573709">z</span><br>
<span class="lineno"></span><span class="op" id="3573711">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span><span class="comment" id="3573714">//&nbsp;Cmp&nbsp;compares&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;returns:</span><br>
<span class="lineno"></span><span class="comment" id="3573751">//</span><br>
<span class="lineno"></span><span class="comment" id="3573754">//&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3573772">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;y</span><br>
<span class="lineno">470</span><span class="comment" id="3573790">//&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3573808">//</span><br>
<span class="lineno"></span><span class="keyword" id="3573811">func</span>&nbsp;<span class="op" id="3573816">(</span><span class="ident" id="3573817">x</span>&nbsp;<span class="op" id="3573819">*</span><span class="ident" id="3573820">Rat</span><span class="op" id="3573823">)</span>&nbsp;<span class="ident" id="3573825">Cmp</span><span class="op" id="3573828">(</span><span class="ident" id="3573829">y</span>&nbsp;<span class="op" id="3573831">*</span><span class="ident" id="3573832">Rat</span><span class="op" id="3573835">)</span>&nbsp;<span class="builtintype" id="3573837">int</span>&nbsp;<span class="op" id="3573841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573844">return</span>&nbsp;<span class="ident" id="3573851">scaleDenom</span><span class="op" id="3573861">(</span><span class="op" id="3573862">&amp;</span><span class="ident" id="3573863">x</span><span class="op" id="3573864">.</span><span class="ident" id="3573865">a</span><span class="op" id="3573866">,</span>&nbsp;<span class="ident" id="3573868">y</span><span class="op" id="3573869">.</span><span class="ident" id="3573870">b</span><span class="op" id="3573871">.</span><span class="ident" id="3573872">abs</span><span class="op" id="3573875">)</span><span class="op" id="3573876">.</span><span class="ident" id="3573877">Cmp</span><span class="op" id="3573880">(</span><span class="ident" id="3573881">scaleDenom</span><span class="op" id="3573891">(</span><span class="op" id="3573892">&amp;</span><span class="ident" id="3573893">y</span><span class="op" id="3573894">.</span><span class="ident" id="3573895">a</span><span class="op" id="3573896">,</span>&nbsp;<span class="ident" id="3573898">x</span><span class="op" id="3573899">.</span><span class="ident" id="3573900">b</span><span class="op" id="3573901">.</span><span class="ident" id="3573902">abs</span><span class="op" id="3573905">)</span><span class="op" id="3573906">)</span><br>
<span class="lineno"></span><span class="op" id="3573908">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="3573911">//&nbsp;Add&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;sum&nbsp;x+y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3573955">func</span>&nbsp;<span class="op" id="3573960">(</span><span class="ident" id="3573961">z</span>&nbsp;<span class="op" id="3573963">*</span><span class="ident" id="3573964">Rat</span><span class="op" id="3573967">)</span>&nbsp;<span class="ident" id="3573969">Add</span><span class="op" id="3573972">(</span><span class="ident" id="3573973">x</span><span class="op" id="3573974">,</span>&nbsp;<span class="ident" id="3573976">y</span>&nbsp;<span class="op" id="3573978">*</span><span class="ident" id="3573979">Rat</span><span class="op" id="3573982">)</span>&nbsp;<span class="op" id="3573984">*</span><span class="ident" id="3573985">Rat</span>&nbsp;<span class="op" id="3573989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573992">a1</span>&nbsp;<span class="op" id="3573995">:=</span>&nbsp;<span class="ident" id="3573998">scaleDenom</span><span class="op" id="3574008">(</span><span class="op" id="3574009">&amp;</span><span class="ident" id="3574010">x</span><span class="op" id="3574011">.</span><span class="ident" id="3574012">a</span><span class="op" id="3574013">,</span>&nbsp;<span class="ident" id="3574015">y</span><span class="op" id="3574016">.</span><span class="ident" id="3574017">b</span><span class="op" id="3574018">.</span><span class="ident" id="3574019">abs</span><span class="op" id="3574022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574025">a2</span>&nbsp;<span class="op" id="3574028">:=</span>&nbsp;<span class="ident" id="3574031">scaleDenom</span><span class="op" id="3574041">(</span><span class="op" id="3574042">&amp;</span><span class="ident" id="3574043">y</span><span class="op" id="3574044">.</span><span class="ident" id="3574045">a</span><span class="op" id="3574046">,</span>&nbsp;<span class="ident" id="3574048">x</span><span class="op" id="3574049">.</span><span class="ident" id="3574050">b</span><span class="op" id="3574051">.</span><span class="ident" id="3574052">abs</span><span class="op" id="3574055">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574058">z</span><span class="op" id="3574059">.</span><span class="ident" id="3574060">a</span><span class="op" id="3574061">.</span><span class="ident" id="3574062">Add</span><span class="op" id="3574065">(</span><span class="ident" id="3574066">a1</span><span class="op" id="3574068">,</span>&nbsp;<span class="ident" id="3574070">a2</span><span class="op" id="3574072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574075">z</span><span class="op" id="3574076">.</span><span class="ident" id="3574077">b</span><span class="op" id="3574078">.</span><span class="ident" id="3574079">abs</span>&nbsp;<span class="op" id="3574083">=</span>&nbsp;<span class="ident" id="3574085">mulDenom</span><span class="op" id="3574093">(</span><span class="ident" id="3574094">z</span><span class="op" id="3574095">.</span><span class="ident" id="3574096">b</span><span class="op" id="3574097">.</span><span class="ident" id="3574098">abs</span><span class="op" id="3574101">,</span>&nbsp;<span class="ident" id="3574103">x</span><span class="op" id="3574104">.</span><span class="ident" id="3574105">b</span><span class="op" id="3574106">.</span><span class="ident" id="3574107">abs</span><span class="op" id="3574110">,</span>&nbsp;<span class="ident" id="3574112">y</span><span class="op" id="3574113">.</span><span class="ident" id="3574114">b</span><span class="op" id="3574115">.</span><span class="ident" id="3574116">abs</span><span class="op" id="3574119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574122">return</span>&nbsp;<span class="ident" id="3574129">z</span><span class="op" id="3574130">.</span><span class="ident" id="3574131">norm</span><span class="op" id="3574135">(</span><span class="op" id="3574136">)</span><br>
<span class="lineno"></span><span class="op" id="3574138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span><span class="comment" id="3574141">//&nbsp;Sub&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;difference&nbsp;x-y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3574192">func</span>&nbsp;<span class="op" id="3574197">(</span><span class="ident" id="3574198">z</span>&nbsp;<span class="op" id="3574200">*</span><span class="ident" id="3574201">Rat</span><span class="op" id="3574204">)</span>&nbsp;<span class="ident" id="3574206">Sub</span><span class="op" id="3574209">(</span><span class="ident" id="3574210">x</span><span class="op" id="3574211">,</span>&nbsp;<span class="ident" id="3574213">y</span>&nbsp;<span class="op" id="3574215">*</span><span class="ident" id="3574216">Rat</span><span class="op" id="3574219">)</span>&nbsp;<span class="op" id="3574221">*</span><span class="ident" id="3574222">Rat</span>&nbsp;<span class="op" id="3574226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574229">a1</span>&nbsp;<span class="op" id="3574232">:=</span>&nbsp;<span class="ident" id="3574235">scaleDenom</span><span class="op" id="3574245">(</span><span class="op" id="3574246">&amp;</span><span class="ident" id="3574247">x</span><span class="op" id="3574248">.</span><span class="ident" id="3574249">a</span><span class="op" id="3574250">,</span>&nbsp;<span class="ident" id="3574252">y</span><span class="op" id="3574253">.</span><span class="ident" id="3574254">b</span><span class="op" id="3574255">.</span><span class="ident" id="3574256">abs</span><span class="op" id="3574259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574262">a2</span>&nbsp;<span class="op" id="3574265">:=</span>&nbsp;<span class="ident" id="3574268">scaleDenom</span><span class="op" id="3574278">(</span><span class="op" id="3574279">&amp;</span><span class="ident" id="3574280">y</span><span class="op" id="3574281">.</span><span class="ident" id="3574282">a</span><span class="op" id="3574283">,</span>&nbsp;<span class="ident" id="3574285">x</span><span class="op" id="3574286">.</span><span class="ident" id="3574287">b</span><span class="op" id="3574288">.</span><span class="ident" id="3574289">abs</span><span class="op" id="3574292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574295">z</span><span class="op" id="3574296">.</span><span class="ident" id="3574297">a</span><span class="op" id="3574298">.</span><span class="ident" id="3574299">Sub</span><span class="op" id="3574302">(</span><span class="ident" id="3574303">a1</span><span class="op" id="3574305">,</span>&nbsp;<span class="ident" id="3574307">a2</span><span class="op" id="3574309">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574312">z</span><span class="op" id="3574313">.</span><span class="ident" id="3574314">b</span><span class="op" id="3574315">.</span><span class="ident" id="3574316">abs</span>&nbsp;<span class="op" id="3574320">=</span>&nbsp;<span class="ident" id="3574322">mulDenom</span><span class="op" id="3574330">(</span><span class="ident" id="3574331">z</span><span class="op" id="3574332">.</span><span class="ident" id="3574333">b</span><span class="op" id="3574334">.</span><span class="ident" id="3574335">abs</span><span class="op" id="3574338">,</span>&nbsp;<span class="ident" id="3574340">x</span><span class="op" id="3574341">.</span><span class="ident" id="3574342">b</span><span class="op" id="3574343">.</span><span class="ident" id="3574344">abs</span><span class="op" id="3574347">,</span>&nbsp;<span class="ident" id="3574349">y</span><span class="op" id="3574350">.</span><span class="ident" id="3574351">b</span><span class="op" id="3574352">.</span><span class="ident" id="3574353">abs</span><span class="op" id="3574356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574359">return</span>&nbsp;<span class="ident" id="3574366">z</span><span class="op" id="3574367">.</span><span class="ident" id="3574368">norm</span><span class="op" id="3574372">(</span><span class="op" id="3574373">)</span><br>
<span class="lineno"></span><span class="op" id="3574375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3574378">//&nbsp;Mul&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;product&nbsp;x*y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">495</span><span class="keyword" id="3574426">func</span>&nbsp;<span class="op" id="3574431">(</span><span class="ident" id="3574432">z</span>&nbsp;<span class="op" id="3574434">*</span><span class="ident" id="3574435">Rat</span><span class="op" id="3574438">)</span>&nbsp;<span class="ident" id="3574440">Mul</span><span class="op" id="3574443">(</span><span class="ident" id="3574444">x</span><span class="op" id="3574445">,</span>&nbsp;<span class="ident" id="3574447">y</span>&nbsp;<span class="op" id="3574449">*</span><span class="ident" id="3574450">Rat</span><span class="op" id="3574453">)</span>&nbsp;<span class="op" id="3574455">*</span><span class="ident" id="3574456">Rat</span>&nbsp;<span class="op" id="3574460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574463">z</span><span class="op" id="3574464">.</span><span class="ident" id="3574465">a</span><span class="op" id="3574466">.</span><span class="ident" id="3574467">Mul</span><span class="op" id="3574470">(</span><span class="op" id="3574471">&amp;</span><span class="ident" id="3574472">x</span><span class="op" id="3574473">.</span><span class="ident" id="3574474">a</span><span class="op" id="3574475">,</span>&nbsp;<span class="op" id="3574477">&amp;</span><span class="ident" id="3574478">y</span><span class="op" id="3574479">.</span><span class="ident" id="3574480">a</span><span class="op" id="3574481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574484">z</span><span class="op" id="3574485">.</span><span class="ident" id="3574486">b</span><span class="op" id="3574487">.</span><span class="ident" id="3574488">abs</span>&nbsp;<span class="op" id="3574492">=</span>&nbsp;<span class="ident" id="3574494">mulDenom</span><span class="op" id="3574502">(</span><span class="ident" id="3574503">z</span><span class="op" id="3574504">.</span><span class="ident" id="3574505">b</span><span class="op" id="3574506">.</span><span class="ident" id="3574507">abs</span><span class="op" id="3574510">,</span>&nbsp;<span class="ident" id="3574512">x</span><span class="op" id="3574513">.</span><span class="ident" id="3574514">b</span><span class="op" id="3574515">.</span><span class="ident" id="3574516">abs</span><span class="op" id="3574519">,</span>&nbsp;<span class="ident" id="3574521">y</span><span class="op" id="3574522">.</span><span class="ident" id="3574523">b</span><span class="op" id="3574524">.</span><span class="ident" id="3574525">abs</span><span class="op" id="3574528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574531">return</span>&nbsp;<span class="ident" id="3574538">z</span><span class="op" id="3574539">.</span><span class="ident" id="3574540">norm</span><span class="op" id="3574544">(</span><span class="op" id="3574545">)</span><br>
<span class="lineno"></span><span class="op" id="3574547">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="3574550">//&nbsp;Quo&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;quotient&nbsp;x/y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3574599">//&nbsp;If&nbsp;y&nbsp;==&nbsp;0,&nbsp;a&nbsp;division-by-zero&nbsp;run-time&nbsp;panic&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword" id="3574655">func</span>&nbsp;<span class="op" id="3574660">(</span><span class="ident" id="3574661">z</span>&nbsp;<span class="op" id="3574663">*</span><span class="ident" id="3574664">Rat</span><span class="op" id="3574667">)</span>&nbsp;<span class="ident" id="3574669">Quo</span><span class="op" id="3574672">(</span><span class="ident" id="3574673">x</span><span class="op" id="3574674">,</span>&nbsp;<span class="ident" id="3574676">y</span>&nbsp;<span class="op" id="3574678">*</span><span class="ident" id="3574679">Rat</span><span class="op" id="3574682">)</span>&nbsp;<span class="op" id="3574684">*</span><span class="ident" id="3574685">Rat</span>&nbsp;<span class="op" id="3574689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574692">if</span>&nbsp;<span class="builtinfunc" id="3574695">len</span><span class="op" id="3574698">(</span><span class="ident" id="3574699">y</span><span class="op" id="3574700">.</span><span class="ident" id="3574701">a</span><span class="op" id="3574702">.</span><span class="ident" id="3574703">abs</span><span class="op" id="3574706">)</span>&nbsp;<span class="op" id="3574708">==</span>&nbsp;<span class="num" id="3574711">0</span>&nbsp;<span class="op" id="3574713">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3574717">panic</span><span class="op" id="3574722">(</span><span class="string" id="3574723">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3574741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3574744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574747">a</span>&nbsp;<span class="op" id="3574749">:=</span>&nbsp;<span class="ident" id="3574752">scaleDenom</span><span class="op" id="3574762">(</span><span class="op" id="3574763">&amp;</span><span class="ident" id="3574764">x</span><span class="op" id="3574765">.</span><span class="ident" id="3574766">a</span><span class="op" id="3574767">,</span>&nbsp;<span class="ident" id="3574769">y</span><span class="op" id="3574770">.</span><span class="ident" id="3574771">b</span><span class="op" id="3574772">.</span><span class="ident" id="3574773">abs</span><span class="op" id="3574776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574779">b</span>&nbsp;<span class="op" id="3574781">:=</span>&nbsp;<span class="ident" id="3574784">scaleDenom</span><span class="op" id="3574794">(</span><span class="op" id="3574795">&amp;</span><span class="ident" id="3574796">y</span><span class="op" id="3574797">.</span><span class="ident" id="3574798">a</span><span class="op" id="3574799">,</span>&nbsp;<span class="ident" id="3574801">x</span><span class="op" id="3574802">.</span><span class="ident" id="3574803">b</span><span class="op" id="3574804">.</span><span class="ident" id="3574805">abs</span><span class="op" id="3574808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574811">z</span><span class="op" id="3574812">.</span><span class="ident" id="3574813">a</span><span class="op" id="3574814">.</span><span class="ident" id="3574815">abs</span>&nbsp;<span class="op" id="3574819">=</span>&nbsp;<span class="ident" id="3574821">a</span><span class="op" id="3574822">.</span><span class="ident" id="3574823">abs</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574828">z</span><span class="op" id="3574829">.</span><span class="ident" id="3574830">b</span><span class="op" id="3574831">.</span><span class="ident" id="3574832">abs</span>&nbsp;<span class="op" id="3574836">=</span>&nbsp;<span class="ident" id="3574838">b</span><span class="op" id="3574839">.</span><span class="ident" id="3574840">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574845">z</span><span class="op" id="3574846">.</span><span class="ident" id="3574847">a</span><span class="op" id="3574848">.</span><span class="ident" id="3574849">neg</span>&nbsp;<span class="op" id="3574853">=</span>&nbsp;<span class="ident" id="3574855">a</span><span class="op" id="3574856">.</span><span class="ident" id="3574857">neg</span>&nbsp;<span class="op" id="3574861">!=</span>&nbsp;<span class="ident" id="3574864">b</span><span class="op" id="3574865">.</span><span class="ident" id="3574866">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574871">return</span>&nbsp;<span class="ident" id="3574878">z</span><span class="op" id="3574879">.</span><span class="ident" id="3574880">norm</span><span class="op" id="3574884">(</span><span class="op" id="3574885">)</span><br>
<span class="lineno"></span><span class="op" id="3574887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="3574890">func</span>&nbsp;<span class="ident" id="3574895">ratTok</span><span class="op" id="3574901">(</span><span class="ident" id="3574902">ch</span>&nbsp;<span class="builtintype" id="3574905">rune</span><span class="op" id="3574909">)</span>&nbsp;<span class="builtintype" id="3574911">bool</span>&nbsp;<span class="op" id="3574916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574919">return</span>&nbsp;<span class="ident" id="3574926">strings</span><span class="op" id="3574933">.</span><span class="ident" id="3574934">IndexRune</span><span class="op" id="3574943">(</span><span class="string" id="3574944">&#34;+-/0123456789.eE&#34;</span><span class="op" id="3574962">,</span>&nbsp;<span class="ident" id="3574964">ch</span><span class="op" id="3574966">)</span>&nbsp;<span class="op" id="3574968">&gt;=</span>&nbsp;<span class="num" id="3574971">0</span><br>
<span class="lineno"></span><span class="op" id="3574973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3574976">//&nbsp;Scan&nbsp;is&nbsp;a&nbsp;support&nbsp;routine&nbsp;for&nbsp;fmt.Scanner.&nbsp;It&nbsp;accepts&nbsp;the&nbsp;formats</span><br>
<span class="lineno">520</span><span class="comment" id="3575045">//&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;F&#39;,&nbsp;&#39;g&#39;,&nbsp;&#39;G&#39;,&nbsp;and&nbsp;&#39;v&#39;.&nbsp;All&nbsp;formats&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno"></span><span class="keyword" id="3575115">func</span>&nbsp;<span class="op" id="3575120">(</span><span class="ident" id="3575121">z</span>&nbsp;<span class="op" id="3575123">*</span><span class="ident" id="3575124">Rat</span><span class="op" id="3575127">)</span>&nbsp;<span class="ident" id="3575129">Scan</span><span class="op" id="3575133">(</span><span class="ident" id="3575134">s</span>&nbsp;<span class="ident" id="3575136">fmt</span><span class="op" id="3575139">.</span><span class="ident" id="3575140">ScanState</span><span class="op" id="3575149">,</span>&nbsp;<span class="ident" id="3575151">ch</span>&nbsp;<span class="builtintype" id="3575154">rune</span><span class="op" id="3575158">)</span>&nbsp;<span class="builtintype" id="3575160">error</span>&nbsp;<span class="op" id="3575166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575169">tok</span><span class="op" id="3575172">,</span>&nbsp;<span class="ident" id="3575174">err</span>&nbsp;<span class="op" id="3575178">:=</span>&nbsp;<span class="ident" id="3575181">s</span><span class="op" id="3575182">.</span><span class="ident" id="3575183">Token</span><span class="op" id="3575188">(</span><span class="builtintype" id="3575189">true</span><span class="op" id="3575193">,</span>&nbsp;<span class="ident" id="3575195">ratTok</span><span class="op" id="3575201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575204">if</span>&nbsp;<span class="ident" id="3575207">err</span>&nbsp;<span class="op" id="3575211">!=</span>&nbsp;<span class="ident" id="3575214">nil</span>&nbsp;<span class="op" id="3575218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575222">return</span>&nbsp;<span class="ident" id="3575229">err</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3575234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575237">if</span>&nbsp;<span class="ident" id="3575240">strings</span><span class="op" id="3575247">.</span><span class="ident" id="3575248">IndexRune</span><span class="op" id="3575257">(</span><span class="string" id="3575258">&#34;efgEFGv&#34;</span><span class="op" id="3575267">,</span>&nbsp;<span class="ident" id="3575269">ch</span><span class="op" id="3575271">)</span>&nbsp;<span class="op" id="3575273">&lt;</span>&nbsp;<span class="num" id="3575275">0</span>&nbsp;<span class="op" id="3575277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575281">return</span>&nbsp;<span class="ident" id="3575288">errors</span><span class="op" id="3575294">.</span><span class="ident" id="3575295">New</span><span class="op" id="3575298">(</span><span class="string" id="3575299">&#34;Rat.Scan:&nbsp;invalid&nbsp;verb&#34;</span><span class="op" id="3575323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3575326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575329">if</span>&nbsp;<span class="ident" id="3575332">_</span><span class="op" id="3575333">,</span>&nbsp;<span class="ident" id="3575335">ok</span>&nbsp;<span class="op" id="3575338">:=</span>&nbsp;<span class="ident" id="3575341">z</span><span class="op" id="3575342">.</span><span class="ident" id="3575343">SetString</span><span class="op" id="3575352">(</span><span class="builtintype" id="3575353">string</span><span class="op" id="3575359">(</span><span class="ident" id="3575360">tok</span><span class="op" id="3575363">)</span><span class="op" id="3575364">)</span><span class="op" id="3575365">;</span>&nbsp;<span class="op" id="3575367">!</span><span class="ident" id="3575368">ok</span>&nbsp;<span class="op" id="3575371">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575375">return</span>&nbsp;<span class="ident" id="3575382">errors</span><span class="op" id="3575388">.</span><span class="ident" id="3575389">New</span><span class="op" id="3575392">(</span><span class="string" id="3575393">&#34;Rat.Scan:&nbsp;invalid&nbsp;syntax&#34;</span><span class="op" id="3575419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3575422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575425">return</span>&nbsp;<span class="ident" id="3575432">nil</span><br>
<span class="lineno"></span><span class="op" id="3575436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3575439">//&nbsp;SetString&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;s&nbsp;and&nbsp;returns&nbsp;z&nbsp;and&nbsp;a&nbsp;boolean&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3575516">//&nbsp;success.&nbsp;s&nbsp;can&nbsp;be&nbsp;given&nbsp;as&nbsp;a&nbsp;fraction&nbsp;&#34;a/b&#34;&nbsp;or&nbsp;as&nbsp;a&nbsp;floating-point&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3575593">//&nbsp;optionally&nbsp;followed&nbsp;by&nbsp;an&nbsp;exponent.&nbsp;If&nbsp;the&nbsp;operation&nbsp;failed,&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3575670">//&nbsp;z&nbsp;is&nbsp;undefined&nbsp;but&nbsp;the&nbsp;returned&nbsp;value&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3575719">func</span>&nbsp;<span class="op" id="3575724">(</span><span class="ident" id="3575725">z</span>&nbsp;<span class="op" id="3575727">*</span><span class="ident" id="3575728">Rat</span><span class="op" id="3575731">)</span>&nbsp;<span class="ident" id="3575733">SetString</span><span class="op" id="3575742">(</span><span class="ident" id="3575743">s</span>&nbsp;<span class="builtintype" id="3575745">string</span><span class="op" id="3575751">)</span>&nbsp;<span class="op" id="3575753">(</span><span class="op" id="3575754">*</span><span class="ident" id="3575755">Rat</span><span class="op" id="3575758">,</span>&nbsp;<span class="builtintype" id="3575760">bool</span><span class="op" id="3575764">)</span>&nbsp;<span class="op" id="3575766">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575769">if</span>&nbsp;<span class="builtinfunc" id="3575772">len</span><span class="op" id="3575775">(</span><span class="ident" id="3575776">s</span><span class="op" id="3575777">)</span>&nbsp;<span class="op" id="3575779">==</span>&nbsp;<span class="num" id="3575782">0</span>&nbsp;<span class="op" id="3575784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575788">return</span>&nbsp;<span class="ident" id="3575795">nil</span><span class="op" id="3575798">,</span>&nbsp;<span class="builtintype" id="3575800">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3575807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575811">//&nbsp;check&nbsp;for&nbsp;a&nbsp;quotient</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575836">sep</span>&nbsp;<span class="op" id="3575840">:=</span>&nbsp;<span class="ident" id="3575843">strings</span><span class="op" id="3575850">.</span><span class="ident" id="3575851">Index</span><span class="op" id="3575856">(</span><span class="ident" id="3575857">s</span><span class="op" id="3575858">,</span>&nbsp;<span class="string" id="3575860">&#34;/&#34;</span><span class="op" id="3575863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575866">if</span>&nbsp;<span class="ident" id="3575869">sep</span>&nbsp;<span class="op" id="3575873">&gt;=</span>&nbsp;<span class="num" id="3575876">0</span>&nbsp;<span class="op" id="3575878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575882">if</span>&nbsp;<span class="ident" id="3575885">_</span><span class="op" id="3575886">,</span>&nbsp;<span class="ident" id="3575888">ok</span>&nbsp;<span class="op" id="3575891">:=</span>&nbsp;<span class="ident" id="3575894">z</span><span class="op" id="3575895">.</span><span class="ident" id="3575896">a</span><span class="op" id="3575897">.</span><span class="ident" id="3575898">SetString</span><span class="op" id="3575907">(</span><span class="ident" id="3575908">s</span><span class="op" id="3575909">[</span><span class="num" id="3575910">0</span><span class="op" id="3575911">:</span><span class="ident" id="3575912">sep</span><span class="op" id="3575915">]</span><span class="op" id="3575916">,</span>&nbsp;<span class="num" id="3575918">10</span><span class="op" id="3575920">)</span><span class="op" id="3575921">;</span>&nbsp;<span class="op" id="3575923">!</span><span class="ident" id="3575924">ok</span>&nbsp;<span class="op" id="3575927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575932">return</span>&nbsp;<span class="ident" id="3575939">nil</span><span class="op" id="3575942">,</span>&nbsp;<span class="builtintype" id="3575944">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3575952">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575956">s</span>&nbsp;<span class="op" id="3575958">=</span>&nbsp;<span class="ident" id="3575960">s</span><span class="op" id="3575961">[</span><span class="ident" id="3575962">sep</span><span class="op" id="3575965">+</span><span class="num" id="3575966">1</span><span class="op" id="3575967">:</span><span class="op" id="3575968">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575972">var</span>&nbsp;<span class="ident" id="3575976">err</span>&nbsp;<span class="builtintype" id="3575980">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575988">if</span>&nbsp;<span class="ident" id="3575991">z</span><span class="op" id="3575992">.</span><span class="ident" id="3575993">b</span><span class="op" id="3575994">.</span><span class="ident" id="3575995">abs</span><span class="op" id="3575998">,</span>&nbsp;<span class="ident" id="3576000">_</span><span class="op" id="3576001">,</span>&nbsp;<span class="ident" id="3576003">err</span>&nbsp;<span class="op" id="3576007">=</span>&nbsp;<span class="ident" id="3576009">z</span><span class="op" id="3576010">.</span><span class="ident" id="3576011">b</span><span class="op" id="3576012">.</span><span class="ident" id="3576013">abs</span><span class="op" id="3576016">.</span><span class="ident" id="3576017">scan</span><span class="op" id="3576021">(</span><span class="ident" id="3576022">strings</span><span class="op" id="3576029">.</span><span class="ident" id="3576030">NewReader</span><span class="op" id="3576039">(</span><span class="ident" id="3576040">s</span><span class="op" id="3576041">)</span><span class="op" id="3576042">,</span>&nbsp;<span class="num" id="3576044">10</span><span class="op" id="3576046">)</span><span class="op" id="3576047">;</span>&nbsp;<span class="ident" id="3576049">err</span>&nbsp;<span class="op" id="3576053">!=</span>&nbsp;<span class="ident" id="3576056">nil</span>&nbsp;<span class="op" id="3576060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576065">return</span>&nbsp;<span class="ident" id="3576072">nil</span><span class="op" id="3576075">,</span>&nbsp;<span class="builtintype" id="3576077">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576085">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576089">if</span>&nbsp;<span class="builtinfunc" id="3576092">len</span><span class="op" id="3576095">(</span><span class="ident" id="3576096">z</span><span class="op" id="3576097">.</span><span class="ident" id="3576098">b</span><span class="op" id="3576099">.</span><span class="ident" id="3576100">abs</span><span class="op" id="3576103">)</span>&nbsp;<span class="op" id="3576105">==</span>&nbsp;<span class="num" id="3576108">0</span>&nbsp;<span class="op" id="3576110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576115">return</span>&nbsp;<span class="ident" id="3576122">nil</span><span class="op" id="3576125">,</span>&nbsp;<span class="builtintype" id="3576127">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576139">return</span>&nbsp;<span class="ident" id="3576146">z</span><span class="op" id="3576147">.</span><span class="ident" id="3576148">norm</span><span class="op" id="3576152">(</span><span class="op" id="3576153">)</span><span class="op" id="3576154">,</span>&nbsp;<span class="builtintype" id="3576156">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576162">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3576166">//&nbsp;check&nbsp;for&nbsp;a&nbsp;decimal&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576196">sep</span>&nbsp;<span class="op" id="3576200">=</span>&nbsp;<span class="ident" id="3576202">strings</span><span class="op" id="3576209">.</span><span class="ident" id="3576210">Index</span><span class="op" id="3576215">(</span><span class="ident" id="3576216">s</span><span class="op" id="3576217">,</span>&nbsp;<span class="string" id="3576219">&#34;.&#34;</span><span class="op" id="3576222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3576225">//&nbsp;check&nbsp;for&nbsp;an&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576251">e</span>&nbsp;<span class="op" id="3576253">:=</span>&nbsp;<span class="ident" id="3576256">strings</span><span class="op" id="3576263">.</span><span class="ident" id="3576264">IndexAny</span><span class="op" id="3576272">(</span><span class="ident" id="3576273">s</span><span class="op" id="3576274">,</span>&nbsp;<span class="string" id="3576276">&#34;eE&#34;</span><span class="op" id="3576280">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576283">var</span>&nbsp;<span class="ident" id="3576287">exp</span>&nbsp;<span class="ident" id="3576291">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576296">if</span>&nbsp;<span class="ident" id="3576299">e</span>&nbsp;<span class="op" id="3576301">&gt;=</span>&nbsp;<span class="num" id="3576304">0</span>&nbsp;<span class="op" id="3576306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576310">if</span>&nbsp;<span class="ident" id="3576313">e</span>&nbsp;<span class="op" id="3576315">&lt;</span>&nbsp;<span class="ident" id="3576317">sep</span>&nbsp;<span class="op" id="3576321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3576326">//&nbsp;The&nbsp;E&nbsp;must&nbsp;come&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576373">return</span>&nbsp;<span class="ident" id="3576380">nil</span><span class="op" id="3576383">,</span>&nbsp;<span class="builtintype" id="3576385">false</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576397">if</span>&nbsp;<span class="ident" id="3576400">_</span><span class="op" id="3576401">,</span>&nbsp;<span class="ident" id="3576403">ok</span>&nbsp;<span class="op" id="3576406">:=</span>&nbsp;<span class="ident" id="3576409">exp</span><span class="op" id="3576412">.</span><span class="ident" id="3576413">SetString</span><span class="op" id="3576422">(</span><span class="ident" id="3576423">s</span><span class="op" id="3576424">[</span><span class="ident" id="3576425">e</span><span class="op" id="3576426">+</span><span class="num" id="3576427">1</span><span class="op" id="3576428">:</span><span class="op" id="3576429">]</span><span class="op" id="3576430">,</span>&nbsp;<span class="num" id="3576432">10</span><span class="op" id="3576434">)</span><span class="op" id="3576435">;</span>&nbsp;<span class="op" id="3576437">!</span><span class="ident" id="3576438">ok</span>&nbsp;<span class="op" id="3576441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576446">return</span>&nbsp;<span class="ident" id="3576453">nil</span><span class="op" id="3576456">,</span>&nbsp;<span class="builtintype" id="3576458">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576470">s</span>&nbsp;<span class="op" id="3576472">=</span>&nbsp;<span class="ident" id="3576474">s</span><span class="op" id="3576475">[</span><span class="num" id="3576476">0</span><span class="op" id="3576477">:</span><span class="ident" id="3576478">e</span><span class="op" id="3576479">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576485">if</span>&nbsp;<span class="ident" id="3576488">sep</span>&nbsp;<span class="op" id="3576492">&gt;=</span>&nbsp;<span class="num" id="3576495">0</span>&nbsp;<span class="op" id="3576497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576501">s</span>&nbsp;<span class="op" id="3576503">=</span>&nbsp;<span class="ident" id="3576505">s</span><span class="op" id="3576506">[</span><span class="num" id="3576507">0</span><span class="op" id="3576508">:</span><span class="ident" id="3576509">sep</span><span class="op" id="3576512">]</span>&nbsp;<span class="op" id="3576514">+</span>&nbsp;<span class="ident" id="3576516">s</span><span class="op" id="3576517">[</span><span class="ident" id="3576518">sep</span><span class="op" id="3576521">+</span><span class="num" id="3576522">1</span><span class="op" id="3576523">:</span><span class="op" id="3576524">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576528">exp</span><span class="op" id="3576531">.</span><span class="ident" id="3576532">Sub</span><span class="op" id="3576535">(</span><span class="op" id="3576536">&amp;</span><span class="ident" id="3576537">exp</span><span class="op" id="3576540">,</span>&nbsp;<span class="ident" id="3576542">NewInt</span><span class="op" id="3576548">(</span><span class="ident" id="3576549">int64</span><span class="op" id="3576554">(</span><span class="builtinfunc" id="3576555">len</span><span class="op" id="3576558">(</span><span class="ident" id="3576559">s</span><span class="op" id="3576560">)</span><span class="op" id="3576561">-</span><span class="ident" id="3576562">sep</span><span class="op" id="3576565">)</span><span class="op" id="3576566">)</span><span class="op" id="3576567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576570">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576574">if</span>&nbsp;<span class="ident" id="3576577">_</span><span class="op" id="3576578">,</span>&nbsp;<span class="ident" id="3576580">ok</span>&nbsp;<span class="op" id="3576583">:=</span>&nbsp;<span class="ident" id="3576586">z</span><span class="op" id="3576587">.</span><span class="ident" id="3576588">a</span><span class="op" id="3576589">.</span><span class="ident" id="3576590">SetString</span><span class="op" id="3576599">(</span><span class="ident" id="3576600">s</span><span class="op" id="3576601">,</span>&nbsp;<span class="num" id="3576603">10</span><span class="op" id="3576605">)</span><span class="op" id="3576606">;</span>&nbsp;<span class="op" id="3576608">!</span><span class="ident" id="3576609">ok</span>&nbsp;<span class="op" id="3576612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576616">return</span>&nbsp;<span class="ident" id="3576623">nil</span><span class="op" id="3576626">,</span>&nbsp;<span class="builtintype" id="3576628">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576638">powTen</span>&nbsp;<span class="op" id="3576645">:=</span>&nbsp;<span class="ident" id="3576648">nat</span><span class="op" id="3576651">(</span><span class="ident" id="3576652">nil</span><span class="op" id="3576655">)</span><span class="op" id="3576656">.</span><span class="ident" id="3576657">expNN</span><span class="op" id="3576662">(</span><span class="ident" id="3576663">natTen</span><span class="op" id="3576669">,</span>&nbsp;<span class="ident" id="3576671">exp</span><span class="op" id="3576674">.</span><span class="ident" id="3576675">abs</span><span class="op" id="3576678">,</span>&nbsp;<span class="ident" id="3576680">nil</span><span class="op" id="3576683">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576686">if</span>&nbsp;<span class="ident" id="3576689">exp</span><span class="op" id="3576692">.</span><span class="ident" id="3576693">neg</span>&nbsp;<span class="op" id="3576697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576701">z</span><span class="op" id="3576702">.</span><span class="ident" id="3576703">b</span><span class="op" id="3576704">.</span><span class="ident" id="3576705">abs</span>&nbsp;<span class="op" id="3576709">=</span>&nbsp;<span class="ident" id="3576711">powTen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576720">z</span><span class="op" id="3576721">.</span><span class="ident" id="3576722">norm</span><span class="op" id="3576726">(</span><span class="op" id="3576727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576730">}</span>&nbsp;<span class="keyword" id="3576732">else</span>&nbsp;<span class="op" id="3576737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576741">z</span><span class="op" id="3576742">.</span><span class="ident" id="3576743">a</span><span class="op" id="3576744">.</span><span class="ident" id="3576745">abs</span>&nbsp;<span class="op" id="3576749">=</span>&nbsp;<span class="ident" id="3576751">z</span><span class="op" id="3576752">.</span><span class="ident" id="3576753">a</span><span class="op" id="3576754">.</span><span class="ident" id="3576755">abs</span><span class="op" id="3576758">.</span><span class="ident" id="3576759">mul</span><span class="op" id="3576762">(</span><span class="ident" id="3576763">z</span><span class="op" id="3576764">.</span><span class="ident" id="3576765">a</span><span class="op" id="3576766">.</span><span class="ident" id="3576767">abs</span><span class="op" id="3576770">,</span>&nbsp;<span class="ident" id="3576772">powTen</span><span class="op" id="3576778">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576782">z</span><span class="op" id="3576783">.</span><span class="ident" id="3576784">b</span><span class="op" id="3576785">.</span><span class="ident" id="3576786">abs</span>&nbsp;<span class="op" id="3576790">=</span>&nbsp;<span class="ident" id="3576792">z</span><span class="op" id="3576793">.</span><span class="ident" id="3576794">b</span><span class="op" id="3576795">.</span><span class="ident" id="3576796">abs</span><span class="op" id="3576799">.</span><span class="builtinfunc" id="3576800">make</span><span class="op" id="3576804">(</span><span class="num" id="3576805">0</span><span class="op" id="3576806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576813">return</span>&nbsp;<span class="ident" id="3576820">z</span><span class="op" id="3576821">,</span>&nbsp;<span class="builtintype" id="3576823">true</span><br>
<span class="lineno"></span><span class="op" id="3576828">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="comment" id="3576831">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;(even&nbsp;if&nbsp;b&nbsp;==&nbsp;1).</span><br>
<span class="lineno"></span><span class="keyword" id="3576914">func</span>&nbsp;<span class="op" id="3576919">(</span><span class="ident" id="3576920">x</span>&nbsp;<span class="op" id="3576922">*</span><span class="ident" id="3576923">Rat</span><span class="op" id="3576926">)</span>&nbsp;<span class="ident" id="3576928">String</span><span class="op" id="3576934">(</span><span class="op" id="3576935">)</span>&nbsp;<span class="builtintype" id="3576937">string</span>&nbsp;<span class="op" id="3576944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576947">s</span>&nbsp;<span class="op" id="3576949">:=</span>&nbsp;<span class="string" id="3576952">&#34;/1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576958">if</span>&nbsp;<span class="builtinfunc" id="3576961">len</span><span class="op" id="3576964">(</span><span class="ident" id="3576965">x</span><span class="op" id="3576966">.</span><span class="ident" id="3576967">b</span><span class="op" id="3576968">.</span><span class="ident" id="3576969">abs</span><span class="op" id="3576972">)</span>&nbsp;<span class="op" id="3576974">!=</span>&nbsp;<span class="num" id="3576977">0</span>&nbsp;<span class="op" id="3576979">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576983">s</span>&nbsp;<span class="op" id="3576985">=</span>&nbsp;<span class="string" id="3576987">&#34;/&#34;</span>&nbsp;<span class="op" id="3576991">+</span>&nbsp;<span class="ident" id="3576993">x</span><span class="op" id="3576994">.</span><span class="ident" id="3576995">b</span><span class="op" id="3576996">.</span><span class="ident" id="3576997">abs</span><span class="op" id="3577000">.</span><span class="ident" id="3577001">decimalString</span><span class="op" id="3577014">(</span><span class="op" id="3577015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577021">return</span>&nbsp;<span class="ident" id="3577028">x</span><span class="op" id="3577029">.</span><span class="ident" id="3577030">a</span><span class="op" id="3577031">.</span><span class="ident" id="3577032">String</span><span class="op" id="3577038">(</span><span class="op" id="3577039">)</span>&nbsp;<span class="op" id="3577041">+</span>&nbsp;<span class="ident" id="3577043">s</span><br>
<span class="lineno"></span><span class="op" id="3577045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="comment" id="3577048">//&nbsp;RatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;if&nbsp;b&nbsp;!=&nbsp;1,</span><br>
<span class="lineno"></span><span class="comment" id="3577127">//&nbsp;and&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a&#34;&nbsp;if&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3577161">func</span>&nbsp;<span class="op" id="3577166">(</span><span class="ident" id="3577167">x</span>&nbsp;<span class="op" id="3577169">*</span><span class="ident" id="3577170">Rat</span><span class="op" id="3577173">)</span>&nbsp;<span class="ident" id="3577175">RatString</span><span class="op" id="3577184">(</span><span class="op" id="3577185">)</span>&nbsp;<span class="builtintype" id="3577187">string</span>&nbsp;<span class="op" id="3577194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577197">if</span>&nbsp;<span class="ident" id="3577200">x</span><span class="op" id="3577201">.</span><span class="ident" id="3577202">IsInt</span><span class="op" id="3577207">(</span><span class="op" id="3577208">)</span>&nbsp;<span class="op" id="3577210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577214">return</span>&nbsp;<span class="ident" id="3577221">x</span><span class="op" id="3577222">.</span><span class="ident" id="3577223">a</span><span class="op" id="3577224">.</span><span class="ident" id="3577225">String</span><span class="op" id="3577231">(</span><span class="op" id="3577232">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577238">return</span>&nbsp;<span class="ident" id="3577245">x</span><span class="op" id="3577246">.</span><span class="ident" id="3577247">String</span><span class="op" id="3577253">(</span><span class="op" id="3577254">)</span><br>
<span class="lineno"></span><span class="op" id="3577256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3577259">//&nbsp;FloatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;decimal&nbsp;form&nbsp;with&nbsp;prec</span><br>
<span class="lineno">615</span><span class="comment" id="3577337">//&nbsp;digits&nbsp;of&nbsp;precision&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point&nbsp;and&nbsp;the&nbsp;last&nbsp;digit&nbsp;rounded.</span><br>
<span class="lineno"></span><span class="keyword" id="3577412">func</span>&nbsp;<span class="op" id="3577417">(</span><span class="ident" id="3577418">x</span>&nbsp;<span class="op" id="3577420">*</span><span class="ident" id="3577421">Rat</span><span class="op" id="3577424">)</span>&nbsp;<span class="ident" id="3577426">FloatString</span><span class="op" id="3577437">(</span><span class="ident" id="3577438">prec</span>&nbsp;<span class="builtintype" id="3577443">int</span><span class="op" id="3577446">)</span>&nbsp;<span class="builtintype" id="3577448">string</span>&nbsp;<span class="op" id="3577455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577458">if</span>&nbsp;<span class="ident" id="3577461">x</span><span class="op" id="3577462">.</span><span class="ident" id="3577463">IsInt</span><span class="op" id="3577468">(</span><span class="op" id="3577469">)</span>&nbsp;<span class="op" id="3577471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577475">s</span>&nbsp;<span class="op" id="3577477">:=</span>&nbsp;<span class="ident" id="3577480">x</span><span class="op" id="3577481">.</span><span class="ident" id="3577482">a</span><span class="op" id="3577483">.</span><span class="ident" id="3577484">String</span><span class="op" id="3577490">(</span><span class="op" id="3577491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577495">if</span>&nbsp;<span class="ident" id="3577498">prec</span>&nbsp;<span class="op" id="3577503">&gt;</span>&nbsp;<span class="num" id="3577505">0</span>&nbsp;<span class="op" id="3577507">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577512">s</span>&nbsp;<span class="op" id="3577514">+=</span>&nbsp;<span class="string" id="3577517">&#34;.&#34;</span>&nbsp;<span class="op" id="3577521">+</span>&nbsp;<span class="ident" id="3577523">strings</span><span class="op" id="3577530">.</span><span class="ident" id="3577531">Repeat</span><span class="op" id="3577537">(</span><span class="string" id="3577538">&#34;0&#34;</span><span class="op" id="3577541">,</span>&nbsp;<span class="ident" id="3577543">prec</span><span class="op" id="3577547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577555">return</span>&nbsp;<span class="ident" id="3577562">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3577568">//&nbsp;x.b.abs&nbsp;!=&nbsp;0</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577586">q</span><span class="op" id="3577587">,</span>&nbsp;<span class="ident" id="3577589">r</span>&nbsp;<span class="op" id="3577591">:=</span>&nbsp;<span class="ident" id="3577594">nat</span><span class="op" id="3577597">(</span><span class="ident" id="3577598">nil</span><span class="op" id="3577601">)</span><span class="op" id="3577602">.</span><span class="ident" id="3577603">div</span><span class="op" id="3577606">(</span><span class="ident" id="3577607">nat</span><span class="op" id="3577610">(</span><span class="ident" id="3577611">nil</span><span class="op" id="3577614">)</span><span class="op" id="3577615">,</span>&nbsp;<span class="ident" id="3577617">x</span><span class="op" id="3577618">.</span><span class="ident" id="3577619">a</span><span class="op" id="3577620">.</span><span class="ident" id="3577621">abs</span><span class="op" id="3577624">,</span>&nbsp;<span class="ident" id="3577626">x</span><span class="op" id="3577627">.</span><span class="ident" id="3577628">b</span><span class="op" id="3577629">.</span><span class="ident" id="3577630">abs</span><span class="op" id="3577633">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577637">p</span>&nbsp;<span class="op" id="3577639">:=</span>&nbsp;<span class="ident" id="3577642">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577650">if</span>&nbsp;<span class="ident" id="3577653">prec</span>&nbsp;<span class="op" id="3577658">&gt;</span>&nbsp;<span class="num" id="3577660">0</span>&nbsp;<span class="op" id="3577662">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577666">p</span>&nbsp;<span class="op" id="3577668">=</span>&nbsp;<span class="ident" id="3577670">nat</span><span class="op" id="3577673">(</span><span class="ident" id="3577674">nil</span><span class="op" id="3577677">)</span><span class="op" id="3577678">.</span><span class="ident" id="3577679">expNN</span><span class="op" id="3577684">(</span><span class="ident" id="3577685">natTen</span><span class="op" id="3577691">,</span>&nbsp;<span class="ident" id="3577693">nat</span><span class="op" id="3577696">(</span><span class="ident" id="3577697">nil</span><span class="op" id="3577700">)</span><span class="op" id="3577701">.</span><span class="ident" id="3577702">setUint64</span><span class="op" id="3577711">(</span><span class="ident" id="3577712">uint64</span><span class="op" id="3577718">(</span><span class="ident" id="3577719">prec</span><span class="op" id="3577723">)</span><span class="op" id="3577724">)</span><span class="op" id="3577725">,</span>&nbsp;<span class="ident" id="3577727">nil</span><span class="op" id="3577730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577737">r</span>&nbsp;<span class="op" id="3577739">=</span>&nbsp;<span class="ident" id="3577741">r</span><span class="op" id="3577742">.</span><span class="ident" id="3577743">mul</span><span class="op" id="3577746">(</span><span class="ident" id="3577747">r</span><span class="op" id="3577748">,</span>&nbsp;<span class="ident" id="3577750">p</span><span class="op" id="3577751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577754">r</span><span class="op" id="3577755">,</span>&nbsp;<span class="ident" id="3577757">r2</span>&nbsp;<span class="op" id="3577760">:=</span>&nbsp;<span class="ident" id="3577763">r</span><span class="op" id="3577764">.</span><span class="ident" id="3577765">div</span><span class="op" id="3577768">(</span><span class="ident" id="3577769">nat</span><span class="op" id="3577772">(</span><span class="ident" id="3577773">nil</span><span class="op" id="3577776">)</span><span class="op" id="3577777">,</span>&nbsp;<span class="ident" id="3577779">r</span><span class="op" id="3577780">,</span>&nbsp;<span class="ident" id="3577782">x</span><span class="op" id="3577783">.</span><span class="ident" id="3577784">b</span><span class="op" id="3577785">.</span><span class="ident" id="3577786">abs</span><span class="op" id="3577789">)</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3577793">//&nbsp;see&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;round&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577824">r2</span>&nbsp;<span class="op" id="3577827">=</span>&nbsp;<span class="ident" id="3577829">r2</span><span class="op" id="3577831">.</span><span class="ident" id="3577832">add</span><span class="op" id="3577835">(</span><span class="ident" id="3577836">r2</span><span class="op" id="3577838">,</span>&nbsp;<span class="ident" id="3577840">r2</span><span class="op" id="3577842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577845">if</span>&nbsp;<span class="ident" id="3577848">x</span><span class="op" id="3577849">.</span><span class="ident" id="3577850">b</span><span class="op" id="3577851">.</span><span class="ident" id="3577852">abs</span><span class="op" id="3577855">.</span><span class="ident" id="3577856">cmp</span><span class="op" id="3577859">(</span><span class="ident" id="3577860">r2</span><span class="op" id="3577862">)</span>&nbsp;<span class="op" id="3577864">&lt;=</span>&nbsp;<span class="num" id="3577867">0</span>&nbsp;<span class="op" id="3577869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577873">r</span>&nbsp;<span class="op" id="3577875">=</span>&nbsp;<span class="ident" id="3577877">r</span><span class="op" id="3577878">.</span><span class="ident" id="3577879">add</span><span class="op" id="3577882">(</span><span class="ident" id="3577883">r</span><span class="op" id="3577884">,</span>&nbsp;<span class="ident" id="3577886">natOne</span><span class="op" id="3577892">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577896">if</span>&nbsp;<span class="ident" id="3577899">r</span><span class="op" id="3577900">.</span><span class="ident" id="3577901">cmp</span><span class="op" id="3577904">(</span><span class="ident" id="3577905">p</span><span class="op" id="3577906">)</span>&nbsp;<span class="op" id="3577908">&gt;=</span>&nbsp;<span class="num" id="3577911">0</span>&nbsp;<span class="op" id="3577913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577918">q</span>&nbsp;<span class="op" id="3577920">=</span>&nbsp;<span class="ident" id="3577922">nat</span><span class="op" id="3577925">(</span><span class="ident" id="3577926">nil</span><span class="op" id="3577929">)</span><span class="op" id="3577930">.</span><span class="ident" id="3577931">add</span><span class="op" id="3577934">(</span><span class="ident" id="3577935">q</span><span class="op" id="3577936">,</span>&nbsp;<span class="ident" id="3577938">natOne</span><span class="op" id="3577944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577949">r</span>&nbsp;<span class="op" id="3577951">=</span>&nbsp;<span class="ident" id="3577953">nat</span><span class="op" id="3577956">(</span><span class="ident" id="3577957">nil</span><span class="op" id="3577960">)</span><span class="op" id="3577961">.</span><span class="ident" id="3577962">sub</span><span class="op" id="3577965">(</span><span class="ident" id="3577966">r</span><span class="op" id="3577967">,</span>&nbsp;<span class="ident" id="3577969">p</span><span class="op" id="3577970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577977">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577981">s</span>&nbsp;<span class="op" id="3577983">:=</span>&nbsp;<span class="ident" id="3577986">q</span><span class="op" id="3577987">.</span><span class="ident" id="3577988">decimalString</span><span class="op" id="3578001">(</span><span class="op" id="3578002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578005">if</span>&nbsp;<span class="ident" id="3578008">x</span><span class="op" id="3578009">.</span><span class="ident" id="3578010">a</span><span class="op" id="3578011">.</span><span class="ident" id="3578012">neg</span>&nbsp;<span class="op" id="3578016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578020">s</span>&nbsp;<span class="op" id="3578022">=</span>&nbsp;<span class="string" id="3578024">&#34;-&#34;</span>&nbsp;<span class="op" id="3578028">+</span>&nbsp;<span class="ident" id="3578030">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3578033">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578037">if</span>&nbsp;<span class="ident" id="3578040">prec</span>&nbsp;<span class="op" id="3578045">&gt;</span>&nbsp;<span class="num" id="3578047">0</span>&nbsp;<span class="op" id="3578049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578053">rs</span>&nbsp;<span class="op" id="3578056">:=</span>&nbsp;<span class="ident" id="3578059">r</span><span class="op" id="3578060">.</span><span class="ident" id="3578061">decimalString</span><span class="op" id="3578074">(</span><span class="op" id="3578075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578079">leadingZeros</span>&nbsp;<span class="op" id="3578092">:=</span>&nbsp;<span class="ident" id="3578095">prec</span>&nbsp;<span class="op" id="3578100">-</span>&nbsp;<span class="builtinfunc" id="3578102">len</span><span class="op" id="3578105">(</span><span class="ident" id="3578106">rs</span><span class="op" id="3578108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578112">s</span>&nbsp;<span class="op" id="3578114">+=</span>&nbsp;<span class="string" id="3578117">&#34;.&#34;</span>&nbsp;<span class="op" id="3578121">+</span>&nbsp;<span class="ident" id="3578123">strings</span><span class="op" id="3578130">.</span><span class="ident" id="3578131">Repeat</span><span class="op" id="3578137">(</span><span class="string" id="3578138">&#34;0&#34;</span><span class="op" id="3578141">,</span>&nbsp;<span class="ident" id="3578143">leadingZeros</span><span class="op" id="3578155">)</span>&nbsp;<span class="op" id="3578157">+</span>&nbsp;<span class="ident" id="3578159">rs</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3578163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578167">return</span>&nbsp;<span class="ident" id="3578174">s</span><br>
<span class="lineno"></span><span class="op" id="3578176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="3578179">//&nbsp;Gob&nbsp;codec&nbsp;version.&nbsp;Permits&nbsp;backward-compatible&nbsp;changes&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3578254">const</span>&nbsp;<span class="ident" id="3578260">ratGobVersion</span>&nbsp;<span class="builtintype" id="3578274">byte</span>&nbsp;<span class="op" id="3578279">=</span>&nbsp;<span class="num" id="3578281">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3578284">//&nbsp;GobEncode&nbsp;implements&nbsp;the&nbsp;gob.GobEncoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3578338">func</span>&nbsp;<span class="op" id="3578343">(</span><span class="ident" id="3578344">x</span>&nbsp;<span class="op" id="3578346">*</span><span class="ident" id="3578347">Rat</span><span class="op" id="3578350">)</span>&nbsp;<span class="ident" id="3578352">GobEncode</span><span class="op" id="3578361">(</span><span class="op" id="3578362">)</span>&nbsp;<span class="op" id="3578364">(</span><span class="op" id="3578365">[</span><span class="op" id="3578366">]</span><span class="builtintype" id="3578367">byte</span><span class="op" id="3578371">,</span>&nbsp;<span class="builtintype" id="3578373">error</span><span class="op" id="3578378">)</span>&nbsp;<span class="op" id="3578380">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578383">if</span>&nbsp;<span class="ident" id="3578386">x</span>&nbsp;<span class="op" id="3578388">==</span>&nbsp;<span class="ident" id="3578391">nil</span>&nbsp;<span class="op" id="3578395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578399">return</span>&nbsp;<span class="ident" id="3578406">nil</span><span class="op" id="3578409">,</span>&nbsp;<span class="ident" id="3578411">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3578416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578419">buf</span>&nbsp;<span class="op" id="3578423">:=</span>&nbsp;<span class="builtinfunc" id="3578426">make</span><span class="op" id="3578430">(</span><span class="op" id="3578431">[</span><span class="op" id="3578432">]</span><span class="builtintype" id="3578433">byte</span><span class="op" id="3578437">,</span>&nbsp;<span class="num" id="3578439">1</span><span class="op" id="3578440">+</span><span class="num" id="3578441">4</span><span class="op" id="3578442">+</span><span class="op" id="3578443">(</span><span class="builtinfunc" id="3578444">len</span><span class="op" id="3578447">(</span><span class="ident" id="3578448">x</span><span class="op" id="3578449">.</span><span class="ident" id="3578450">a</span><span class="op" id="3578451">.</span><span class="ident" id="3578452">abs</span><span class="op" id="3578455">)</span><span class="op" id="3578456">+</span><span class="builtinfunc" id="3578457">len</span><span class="op" id="3578460">(</span><span class="ident" id="3578461">x</span><span class="op" id="3578462">.</span><span class="ident" id="3578463">b</span><span class="op" id="3578464">.</span><span class="ident" id="3578465">abs</span><span class="op" id="3578468">)</span><span class="op" id="3578469">)</span><span class="op" id="3578470">*</span><span class="ident" id="3578471">_S</span><span class="op" id="3578473">)</span>&nbsp;<span class="comment" id="3578475">//&nbsp;extra&nbsp;bytes&nbsp;for&nbsp;version&nbsp;and&nbsp;sign&nbsp;bit&nbsp;(1),&nbsp;and&nbsp;numerator&nbsp;length&nbsp;(4)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578546">i</span>&nbsp;<span class="op" id="3578548">:=</span>&nbsp;<span class="ident" id="3578551">x</span><span class="op" id="3578552">.</span><span class="ident" id="3578553">b</span><span class="op" id="3578554">.</span><span class="ident" id="3578555">abs</span><span class="op" id="3578558">.</span><span class="ident" id="3578559">bytes</span><span class="op" id="3578564">(</span><span class="ident" id="3578565">buf</span><span class="op" id="3578568">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578571">j</span>&nbsp;<span class="op" id="3578573">:=</span>&nbsp;<span class="ident" id="3578576">x</span><span class="op" id="3578577">.</span><span class="ident" id="3578578">a</span><span class="op" id="3578579">.</span><span class="ident" id="3578580">abs</span><span class="op" id="3578583">.</span><span class="ident" id="3578584">bytes</span><span class="op" id="3578589">(</span><span class="ident" id="3578590">buf</span><span class="op" id="3578593">[</span><span class="num" id="3578594">0</span><span class="op" id="3578595">:</span><span class="ident" id="3578596">i</span><span class="op" id="3578597">]</span><span class="op" id="3578598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578601">n</span>&nbsp;<span class="op" id="3578603">:=</span>&nbsp;<span class="ident" id="3578606">i</span>&nbsp;<span class="op" id="3578608">-</span>&nbsp;<span class="ident" id="3578610">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578613">if</span>&nbsp;<span class="builtintype" id="3578616">int</span><span class="op" id="3578619">(</span><span class="builtintype" id="3578620">uint32</span><span class="op" id="3578626">(</span><span class="ident" id="3578627">n</span><span class="op" id="3578628">)</span><span class="op" id="3578629">)</span>&nbsp;<span class="op" id="3578631">!=</span>&nbsp;<span class="ident" id="3578634">n</span>&nbsp;<span class="op" id="3578636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3578640">//&nbsp;this&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578670">return</span>&nbsp;<span class="ident" id="3578677">nil</span><span class="op" id="3578680">,</span>&nbsp;<span class="ident" id="3578682">errors</span><span class="op" id="3578688">.</span><span class="ident" id="3578689">New</span><span class="op" id="3578692">(</span><span class="string" id="3578693">&#34;Rat.GobEncode:&nbsp;numerator&nbsp;too&nbsp;large&#34;</span><span class="op" id="3578729">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3578732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578735">binary</span><span class="op" id="3578741">.</span><span class="ident" id="3578742">BigEndian</span><span class="op" id="3578751">.</span><span class="ident" id="3578752">PutUint32</span><span class="op" id="3578761">(</span><span class="ident" id="3578762">buf</span><span class="op" id="3578765">[</span><span class="ident" id="3578766">j</span><span class="op" id="3578767">-</span><span class="num" id="3578768">4</span><span class="op" id="3578769">:</span><span class="ident" id="3578770">j</span><span class="op" id="3578771">]</span><span class="op" id="3578772">,</span>&nbsp;<span class="builtintype" id="3578774">uint32</span><span class="op" id="3578780">(</span><span class="ident" id="3578781">n</span><span class="op" id="3578782">)</span><span class="op" id="3578783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578786">j</span>&nbsp;<span class="op" id="3578788">-=</span>&nbsp;<span class="num" id="3578791">1</span>&nbsp;<span class="op" id="3578793">+</span>&nbsp;<span class="num" id="3578795">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578798">b</span>&nbsp;<span class="op" id="3578800">:=</span>&nbsp;<span class="ident" id="3578803">ratGobVersion</span>&nbsp;<span class="op" id="3578817">&lt;&lt;</span>&nbsp;<span class="num" id="3578820">1</span>&nbsp;<span class="comment" id="3578822">//&nbsp;make&nbsp;space&nbsp;for&nbsp;sign&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578850">if</span>&nbsp;<span class="ident" id="3578853">x</span><span class="op" id="3578854">.</span><span class="ident" id="3578855">a</span><span class="op" id="3578856">.</span><span class="ident" id="3578857">neg</span>&nbsp;<span class="op" id="3578861">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578865">b</span>&nbsp;<span class="op" id="3578867">|=</span>&nbsp;<span class="num" id="3578870">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3578873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578876">buf</span><span class="op" id="3578879">[</span><span class="ident" id="3578880">j</span><span class="op" id="3578881">]</span>&nbsp;<span class="op" id="3578883">=</span>&nbsp;<span class="ident" id="3578885">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578888">return</span>&nbsp;<span class="ident" id="3578895">buf</span><span class="op" id="3578898">[</span><span class="ident" id="3578899">j</span><span class="op" id="3578900">:</span><span class="op" id="3578901">]</span><span class="op" id="3578902">,</span>&nbsp;<span class="ident" id="3578904">nil</span><br>
<span class="lineno"></span><span class="op" id="3578908">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="3578911">//&nbsp;GobDecode&nbsp;implements&nbsp;the&nbsp;gob.GobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3578965">func</span>&nbsp;<span class="op" id="3578970">(</span><span class="ident" id="3578971">z</span>&nbsp;<span class="op" id="3578973">*</span><span class="ident" id="3578974">Rat</span><span class="op" id="3578977">)</span>&nbsp;<span class="ident" id="3578979">GobDecode</span><span class="op" id="3578988">(</span><span class="ident" id="3578989">buf</span>&nbsp;<span class="op" id="3578993">[</span><span class="op" id="3578994">]</span><span class="builtintype" id="3578995">byte</span><span class="op" id="3578999">)</span>&nbsp;<span class="builtintype" id="3579001">error</span>&nbsp;<span class="op" id="3579007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579010">if</span>&nbsp;<span class="builtinfunc" id="3579013">len</span><span class="op" id="3579016">(</span><span class="ident" id="3579017">buf</span><span class="op" id="3579020">)</span>&nbsp;<span class="op" id="3579022">==</span>&nbsp;<span class="num" id="3579025">0</span>&nbsp;<span class="op" id="3579027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3579031">//&nbsp;Other&nbsp;side&nbsp;sent&nbsp;a&nbsp;nil&nbsp;or&nbsp;default&nbsp;value.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579076">*</span><span class="ident" id="3579077">z</span>&nbsp;<span class="op" id="3579079">=</span>&nbsp;<span class="ident" id="3579081">Rat</span><span class="op" id="3579084">{</span><span class="op" id="3579085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579089">return</span>&nbsp;<span class="ident" id="3579096">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579104">b</span>&nbsp;<span class="op" id="3579106">:=</span>&nbsp;<span class="ident" id="3579109">buf</span><span class="op" id="3579112">[</span><span class="num" id="3579113">0</span><span class="op" id="3579114">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579117">if</span>&nbsp;<span class="ident" id="3579120">b</span><span class="op" id="3579121">&gt;&gt;</span><span class="num" id="3579123">1</span>&nbsp;<span class="op" id="3579125">!=</span>&nbsp;<span class="ident" id="3579128">ratGobVersion</span>&nbsp;<span class="op" id="3579142">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579146">return</span>&nbsp;<span class="ident" id="3579153">errors</span><span class="op" id="3579159">.</span><span class="ident" id="3579160">New</span><span class="op" id="3579163">(</span><span class="ident" id="3579164">fmt</span><span class="op" id="3579167">.</span><span class="ident" id="3579168">Sprintf</span><span class="op" id="3579175">(</span><span class="string" id="3579176">&#34;Rat.GobDecode:&nbsp;encoding&nbsp;version&nbsp;%d&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3579226">,</span>&nbsp;<span class="ident" id="3579228">b</span><span class="op" id="3579229">&gt;&gt;</span><span class="num" id="3579231">1</span><span class="op" id="3579232">)</span><span class="op" id="3579233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579239">const</span>&nbsp;<span class="ident" id="3579245">j</span>&nbsp;<span class="op" id="3579247">=</span>&nbsp;<span class="num" id="3579249">1</span>&nbsp;<span class="op" id="3579251">+</span>&nbsp;<span class="num" id="3579253">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579256">i</span>&nbsp;<span class="op" id="3579258">:=</span>&nbsp;<span class="ident" id="3579261">j</span>&nbsp;<span class="op" id="3579263">+</span>&nbsp;<span class="ident" id="3579265">binary</span><span class="op" id="3579271">.</span><span class="ident" id="3579272">BigEndian</span><span class="op" id="3579281">.</span><span class="ident" id="3579282">Uint32</span><span class="op" id="3579288">(</span><span class="ident" id="3579289">buf</span><span class="op" id="3579292">[</span><span class="ident" id="3579293">j</span><span class="op" id="3579294">-</span><span class="num" id="3579295">4</span><span class="op" id="3579296">:</span><span class="ident" id="3579297">j</span><span class="op" id="3579298">]</span><span class="op" id="3579299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579302">z</span><span class="op" id="3579303">.</span><span class="ident" id="3579304">a</span><span class="op" id="3579305">.</span><span class="ident" id="3579306">neg</span>&nbsp;<span class="op" id="3579310">=</span>&nbsp;<span class="ident" id="3579312">b</span><span class="op" id="3579313">&amp;</span><span class="num" id="3579314">1</span>&nbsp;<span class="op" id="3579316">!=</span>&nbsp;<span class="num" id="3579319">0</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579322">z</span><span class="op" id="3579323">.</span><span class="ident" id="3579324">a</span><span class="op" id="3579325">.</span><span class="ident" id="3579326">abs</span>&nbsp;<span class="op" id="3579330">=</span>&nbsp;<span class="ident" id="3579332">z</span><span class="op" id="3579333">.</span><span class="ident" id="3579334">a</span><span class="op" id="3579335">.</span><span class="ident" id="3579336">abs</span><span class="op" id="3579339">.</span><span class="ident" id="3579340">setBytes</span><span class="op" id="3579348">(</span><span class="ident" id="3579349">buf</span><span class="op" id="3579352">[</span><span class="ident" id="3579353">j</span><span class="op" id="3579354">:</span><span class="ident" id="3579355">i</span><span class="op" id="3579356">]</span><span class="op" id="3579357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579360">z</span><span class="op" id="3579361">.</span><span class="ident" id="3579362">b</span><span class="op" id="3579363">.</span><span class="ident" id="3579364">abs</span>&nbsp;<span class="op" id="3579368">=</span>&nbsp;<span class="ident" id="3579370">z</span><span class="op" id="3579371">.</span><span class="ident" id="3579372">b</span><span class="op" id="3579373">.</span><span class="ident" id="3579374">abs</span><span class="op" id="3579377">.</span><span class="ident" id="3579378">setBytes</span><span class="op" id="3579386">(</span><span class="ident" id="3579387">buf</span><span class="op" id="3579390">[</span><span class="ident" id="3579391">i</span><span class="op" id="3579392">:</span><span class="op" id="3579393">]</span><span class="op" id="3579394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579397">return</span>&nbsp;<span class="ident" id="3579404">nil</span><br>
<span class="lineno"></span><span class="op" id="3579408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="3579411">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3579475">func</span>&nbsp;<span class="op" id="3579480">(</span><span class="ident" id="3579481">r</span>&nbsp;<span class="op" id="3579483">*</span><span class="ident" id="3579484">Rat</span><span class="op" id="3579487">)</span>&nbsp;<span class="ident" id="3579489">MarshalText</span><span class="op" id="3579500">(</span><span class="op" id="3579501">)</span>&nbsp;<span class="op" id="3579503">(</span><span class="ident" id="3579504">text</span>&nbsp;<span class="op" id="3579509">[</span><span class="op" id="3579510">]</span><span class="builtintype" id="3579511">byte</span><span class="op" id="3579515">,</span>&nbsp;<span class="ident" id="3579517">err</span>&nbsp;<span class="builtintype" id="3579521">error</span><span class="op" id="3579526">)</span>&nbsp;<span class="op" id="3579528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579531">return</span>&nbsp;<span class="op" id="3579538">[</span><span class="op" id="3579539">]</span><span class="builtintype" id="3579540">byte</span><span class="op" id="3579544">(</span><span class="ident" id="3579545">r</span><span class="op" id="3579546">.</span><span class="ident" id="3579547">RatString</span><span class="op" id="3579556">(</span><span class="op" id="3579557">)</span><span class="op" id="3579558">)</span><span class="op" id="3579559">,</span>&nbsp;<span class="ident" id="3579561">nil</span><br>
<span class="lineno"></span><span class="op" id="3579565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span><span class="comment" id="3579568">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3579636">func</span>&nbsp;<span class="op" id="3579641">(</span><span class="ident" id="3579642">r</span>&nbsp;<span class="op" id="3579644">*</span><span class="ident" id="3579645">Rat</span><span class="op" id="3579648">)</span>&nbsp;<span class="ident" id="3579650">UnmarshalText</span><span class="op" id="3579663">(</span><span class="ident" id="3579664">text</span>&nbsp;<span class="op" id="3579669">[</span><span class="op" id="3579670">]</span><span class="builtintype" id="3579671">byte</span><span class="op" id="3579675">)</span>&nbsp;<span class="builtintype" id="3579677">error</span>&nbsp;<span class="op" id="3579683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579686">if</span>&nbsp;<span class="ident" id="3579689">_</span><span class="op" id="3579690">,</span>&nbsp;<span class="ident" id="3579692">ok</span>&nbsp;<span class="op" id="3579695">:=</span>&nbsp;<span class="ident" id="3579698">r</span><span class="op" id="3579699">.</span><span class="ident" id="3579700">SetString</span><span class="op" id="3579709">(</span><span class="builtintype" id="3579710">string</span><span class="op" id="3579716">(</span><span class="ident" id="3579717">text</span><span class="op" id="3579721">)</span><span class="op" id="3579722">)</span><span class="op" id="3579723">;</span>&nbsp;<span class="op" id="3579725">!</span><span class="ident" id="3579726">ok</span>&nbsp;<span class="op" id="3579729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579733">return</span>&nbsp;<span class="ident" id="3579740">fmt</span><span class="op" id="3579743">.</span><span class="ident" id="3579744">Errorf</span><span class="op" id="3579750">(</span><span class="string" id="3579751">&#34;math/big:&nbsp;cannot&nbsp;unmarshal&nbsp;%q&nbsp;into&nbsp;a&nbsp;*big.Rat&#34;</span><span class="op" id="3579798">,</span>&nbsp;<span class="ident" id="3579800">text</span><span class="op" id="3579804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579807">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579810">return</span>&nbsp;<span class="ident" id="3579817">nil</span><br>
<span class="lineno"></span><span class="op" id="3579821">}</span>
</div>
</body>
</html>
