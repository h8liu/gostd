<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5059622">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5059677">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5059731">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5059782">//&nbsp;HTTP&nbsp;Request&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5059820">package</span>&nbsp;<span class="ident" id="5059828">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5059834">import</span>&nbsp;<span class="op" id="5059841">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059844">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059853">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059862">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059876">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059895">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059905">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059912">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059918">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059931">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059939">&#34;mime/multipart&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059957">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059974">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059985">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5059996">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5060007">&#34;sync&#34;</span><br>
<span class="lineno">25</span><span class="op" id="5060014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5060017">const</span>&nbsp;<span class="op" id="5060023">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060026">maxValueLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5060043">=</span>&nbsp;<span class="num" id="5060045">4096</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060051">maxHeaderLines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5060068">=</span>&nbsp;<span class="num" id="5060070">1024</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060076">chunkSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5060093">=</span>&nbsp;<span class="num" id="5060095">4</span>&nbsp;<span class="op" id="5060097">&lt;&lt;</span>&nbsp;<span class="num" id="5060100">10</span>&nbsp;&nbsp;<span class="comment" id="5060104">//&nbsp;4&nbsp;KB&nbsp;chunks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060120">defaultMaxMemory</span>&nbsp;<span class="op" id="5060137">=</span>&nbsp;<span class="num" id="5060139">32</span>&nbsp;<span class="op" id="5060142">&lt;&lt;</span>&nbsp;<span class="num" id="5060145">20</span>&nbsp;<span class="comment" id="5060148">//&nbsp;32&nbsp;MB</span><br>
<span class="lineno"></span><span class="op" id="5060157">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5060160">//&nbsp;ErrMissingFile&nbsp;is&nbsp;returned&nbsp;by&nbsp;FormFile&nbsp;when&nbsp;the&nbsp;provided&nbsp;file&nbsp;field&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="5060236">//&nbsp;is&nbsp;either&nbsp;not&nbsp;present&nbsp;in&nbsp;the&nbsp;request&nbsp;or&nbsp;not&nbsp;a&nbsp;file&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="5060297">var</span>&nbsp;<span class="ident" id="5060301">ErrMissingFile</span>&nbsp;<span class="op" id="5060316">=</span>&nbsp;<span class="ident" id="5060318">errors</span><span class="op" id="5060324">.</span><span class="ident" id="5060325">New</span><span class="op" id="5060328">(</span><span class="string" id="5060329">&#34;http:&nbsp;no&nbsp;such&nbsp;file&#34;</span><span class="op" id="5060349">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5060352">//&nbsp;HTTP&nbsp;request&nbsp;parsing&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="5060384">type</span>&nbsp;<span class="ident" id="5060389">ProtocolError</span>&nbsp;<span class="keyword" id="5060403">struct</span>&nbsp;<span class="op" id="5060410">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060413">ErrorString</span>&nbsp;<span class="builtintype" id="5060425">string</span><br>
<span class="lineno"></span><span class="op" id="5060432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5060435">func</span>&nbsp;<span class="op" id="5060440">(</span><span class="ident" id="5060441">err</span>&nbsp;<span class="op" id="5060445">*</span><span class="ident" id="5060446">ProtocolError</span><span class="op" id="5060459">)</span>&nbsp;<span class="ident" id="5060461">Error</span><span class="op" id="5060466">(</span><span class="op" id="5060467">)</span>&nbsp;<span class="builtintype" id="5060469">string</span>&nbsp;<span class="op" id="5060476">{</span>&nbsp;<span class="keyword" id="5060478">return</span>&nbsp;<span class="ident" id="5060485">err</span><span class="op" id="5060488">.</span><span class="ident" id="5060489">ErrorString</span>&nbsp;<span class="op" id="5060501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="5060504">var</span>&nbsp;<span class="op" id="5060508">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060511">ErrHeaderTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5060535">=</span>&nbsp;<span class="op" id="5060537">&amp;</span><span class="ident" id="5060538">ProtocolError</span><span class="op" id="5060551">{</span><span class="string" id="5060552">&#34;header&nbsp;too&nbsp;long&#34;</span><span class="op" id="5060569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060572">ErrShortBody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5060596">=</span>&nbsp;<span class="op" id="5060598">&amp;</span><span class="ident" id="5060599">ProtocolError</span><span class="op" id="5060612">{</span><span class="string" id="5060613">&#34;entity&nbsp;body&nbsp;too&nbsp;short&#34;</span><span class="op" id="5060636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060639">ErrNotSupported</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5060663">=</span>&nbsp;<span class="op" id="5060665">&amp;</span><span class="ident" id="5060666">ProtocolError</span><span class="op" id="5060679">{</span><span class="string" id="5060680">&#34;feature&nbsp;not&nbsp;supported&#34;</span><span class="op" id="5060703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060706">ErrUnexpectedTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5060730">=</span>&nbsp;<span class="op" id="5060732">&amp;</span><span class="ident" id="5060733">ProtocolError</span><span class="op" id="5060746">{</span><span class="string" id="5060747">&#34;trailer&nbsp;header&nbsp;without&nbsp;chunked&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="5060797">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060800">ErrMissingContentLength</span>&nbsp;<span class="op" id="5060824">=</span>&nbsp;<span class="op" id="5060826">&amp;</span><span class="ident" id="5060827">ProtocolError</span><span class="op" id="5060840">{</span><span class="string" id="5060841">&#34;missing&nbsp;ContentLength&nbsp;in&nbsp;HEAD&nbsp;response&#34;</span><span class="op" id="5060881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060884">ErrNotMultipart</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5060908">=</span>&nbsp;<span class="op" id="5060910">&amp;</span><span class="ident" id="5060911">ProtocolError</span><span class="op" id="5060924">{</span><span class="string" id="5060925">&#34;request&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;multipart/form-data&#34;</span><span class="op" id="5060973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060976">ErrMissingBoundary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5061000">=</span>&nbsp;<span class="op" id="5061002">&amp;</span><span class="ident" id="5061003">ProtocolError</span><span class="op" id="5061016">{</span><span class="string" id="5061017">&#34;no&nbsp;multipart&nbsp;boundary&nbsp;param&nbsp;in&nbsp;Content-Type&#34;</span><span class="op" id="5061062">}</span><br>
<span class="lineno"></span><span class="op" id="5061064">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5061067">type</span>&nbsp;<span class="ident" id="5061072">badStringError</span>&nbsp;<span class="keyword" id="5061087">struct</span>&nbsp;<span class="op" id="5061094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5061097">what</span>&nbsp;<span class="builtintype" id="5061102">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5061110">str</span>&nbsp;&nbsp;<span class="builtintype" id="5061115">string</span><br>
<span class="lineno"></span><span class="op" id="5061122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="5061125">func</span>&nbsp;<span class="op" id="5061130">(</span><span class="ident" id="5061131">e</span>&nbsp;<span class="op" id="5061133">*</span><span class="ident" id="5061134">badStringError</span><span class="op" id="5061148">)</span>&nbsp;<span class="ident" id="5061150">Error</span><span class="op" id="5061155">(</span><span class="op" id="5061156">)</span>&nbsp;<span class="builtintype" id="5061158">string</span>&nbsp;<span class="op" id="5061165">{</span>&nbsp;<span class="keyword" id="5061167">return</span>&nbsp;<span class="ident" id="5061174">fmt</span><span class="op" id="5061177">.</span><span class="ident" id="5061178">Sprintf</span><span class="op" id="5061185">(</span><span class="string" id="5061186">&#34;%s&nbsp;%q&#34;</span><span class="op" id="5061193">,</span>&nbsp;<span class="ident" id="5061195">e</span><span class="op" id="5061196">.</span><span class="ident" id="5061197">what</span><span class="op" id="5061201">,</span>&nbsp;<span class="ident" id="5061203">e</span><span class="op" id="5061204">.</span><span class="ident" id="5061205">str</span><span class="op" id="5061208">)</span>&nbsp;<span class="op" id="5061210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5061213">//&nbsp;Headers&nbsp;that&nbsp;Request.Write&nbsp;handles&nbsp;itself&nbsp;and&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="5061281">var</span>&nbsp;<span class="ident" id="5061285">reqWriteExcludeHeader</span>&nbsp;<span class="op" id="5061307">=</span>&nbsp;<span class="keyword" id="5061309">map</span><span class="op" id="5061312">[</span><span class="builtintype" id="5061313">string</span><span class="op" id="5061319">]</span><span class="builtintype" id="5061320">bool</span><span class="op" id="5061324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5061327">&#34;Host&#34;</span><span class="op" id="5061333">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5061348">true</span><span class="op" id="5061352">,</span>&nbsp;<span class="comment" id="5061354">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5061383">&#34;User-Agent&#34;</span><span class="op" id="5061395">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5061404">true</span><span class="op" id="5061408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5061411">&#34;Content-Length&#34;</span><span class="op" id="5061427">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5061432">true</span><span class="op" id="5061436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5061439">&#34;Transfer-Encoding&#34;</span><span class="op" id="5061458">:</span>&nbsp;<span class="builtintype" id="5061460">true</span><span class="op" id="5061464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5061467">&#34;Trailer&#34;</span><span class="op" id="5061476">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5061488">true</span><span class="op" id="5061492">,</span><br>
<span class="lineno"></span><span class="op" id="5061494">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5061497">//&nbsp;A&nbsp;Request&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;received&nbsp;by&nbsp;a&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="5061558">//&nbsp;or&nbsp;to&nbsp;be&nbsp;sent&nbsp;by&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="5061588">//</span><br>
<span class="lineno"></span><span class="comment" id="5061591">//&nbsp;The&nbsp;field&nbsp;semantics&nbsp;differ&nbsp;slightly&nbsp;between&nbsp;client&nbsp;and&nbsp;server</span><br>
<span class="lineno">75</span><span class="comment" id="5061656">//&nbsp;usage.&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;notes&nbsp;on&nbsp;the&nbsp;fields&nbsp;below,&nbsp;see&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5061720">//&nbsp;documentation&nbsp;for&nbsp;Request.Write&nbsp;and&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="keyword" id="5061773">type</span>&nbsp;<span class="ident" id="5061778">Request</span>&nbsp;<span class="keyword" id="5061786">struct</span>&nbsp;<span class="op" id="5061793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5061796">//&nbsp;Method&nbsp;specifies&nbsp;the&nbsp;HTTP&nbsp;method&nbsp;(GET,&nbsp;POST,&nbsp;PUT,&nbsp;etc.).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5061857">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;an&nbsp;empty&nbsp;string&nbsp;means&nbsp;GET.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5061908">Method</span>&nbsp;<span class="builtintype" id="5061915">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5061924">//&nbsp;URL&nbsp;specifies&nbsp;either&nbsp;the&nbsp;URI&nbsp;being&nbsp;requested&nbsp;(for&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5061985">//&nbsp;requests)&nbsp;or&nbsp;the&nbsp;URL&nbsp;to&nbsp;access&nbsp;(for&nbsp;client&nbsp;requests).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062043">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062047">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;URL&nbsp;is&nbsp;parsed&nbsp;from&nbsp;the&nbsp;URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062102">//&nbsp;supplied&nbsp;on&nbsp;the&nbsp;Request-Line&nbsp;as&nbsp;stored&nbsp;in&nbsp;RequestURI.&nbsp;&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062165">//&nbsp;most&nbsp;requests,&nbsp;fields&nbsp;other&nbsp;than&nbsp;Path&nbsp;and&nbsp;RawQuery&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062228">//&nbsp;empty.&nbsp;(See&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;5.1.2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062269">//</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062273">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;the&nbsp;URL&#39;s&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;server&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062337">//&nbsp;connect&nbsp;to,&nbsp;while&nbsp;the&nbsp;Request&#39;s&nbsp;Host&nbsp;field&nbsp;optionally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062395">//&nbsp;specifies&nbsp;the&nbsp;Host&nbsp;header&nbsp;value&nbsp;to&nbsp;send&nbsp;in&nbsp;the&nbsp;HTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062451">//&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5062464">URL</span>&nbsp;<span class="op" id="5062468">*</span><span class="ident" id="5062469">url</span><span class="op" id="5062472">.</span><span class="ident" id="5062473">URL</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062479">//&nbsp;The&nbsp;protocol&nbsp;version&nbsp;for&nbsp;incoming&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062527">//&nbsp;Client&nbsp;requests&nbsp;always&nbsp;use&nbsp;HTTP/1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5062568">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5062579">string</span>&nbsp;<span class="comment" id="5062586">//&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5062601">ProtoMajor</span>&nbsp;<span class="builtintype" id="5062612">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5062619">//&nbsp;1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5062625">ProtoMinor</span>&nbsp;<span class="builtintype" id="5062636">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5062643">//&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062650">//&nbsp;A&nbsp;header&nbsp;maps&nbsp;request&nbsp;lines&nbsp;to&nbsp;their&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062699">//&nbsp;If&nbsp;the&nbsp;header&nbsp;says</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062722">//</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062726">//&nbsp;&nbsp;&nbsp;&nbspaccept-encoding:&nbsp;gzip,&nbsp;deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062761">//&nbsp;&nbsp;&nbsp;&nbspAccept-Language:&nbsp;en-us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062788">//&nbsp;&nbsp;&nbsp;&nbspConnection:&nbsp;keep-alive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062815">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062819">//&nbsp;then</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062828">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062832">//&nbsp;&nbsp;&nbsp;&nbspHeader&nbsp;=&nbsp;map[string][]string{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062866">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Encoding&#34;:&nbsp;{&#34;gzip,&nbsp;deflate&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062909">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Language&#34;:&nbsp;{&#34;en-us&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062944">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Connection&#34;:&nbsp;{&#34;keep-alive&#34;},</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062979">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062985">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062989">//&nbsp;HTTP&nbsp;defines&nbsp;that&nbsp;header&nbsp;names&nbsp;are&nbsp;case-insensitive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063046">//&nbsp;The&nbsp;request&nbsp;parser&nbsp;implements&nbsp;this&nbsp;by&nbsp;canonicalizing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063107">//&nbsp;name,&nbsp;making&nbsp;the&nbsp;first&nbsp;character&nbsp;and&nbsp;any&nbsp;characters</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063163">//&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;uppercase&nbsp;and&nbsp;the&nbsp;rest&nbsp;lowercase.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063220">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063224">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;certain&nbsp;headers&nbsp;are&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063282">//&nbsp;added&nbsp;and&nbsp;may&nbsp;override&nbsp;values&nbsp;in&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063327">//</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063331">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Request.Write&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5063387">Header</span>&nbsp;<span class="ident" id="5063394">Header</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063403">//&nbsp;Body&nbsp;is&nbsp;the&nbsp;request&#39;s&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063435">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063439">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;a&nbsp;nil&nbsp;body&nbsp;means&nbsp;the&nbsp;request&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063499">//&nbsp;body,&nbsp;such&nbsp;as&nbsp;a&nbsp;GET&nbsp;request.&nbsp;The&nbsp;HTTP&nbsp;Client&#39;s&nbsp;Transport</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063560">//&nbsp;is&nbsp;responsible&nbsp;for&nbsp;calling&nbsp;the&nbsp;Close&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063609">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063613">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Request&nbsp;Body&nbsp;is&nbsp;always&nbsp;non-nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063672">//&nbsp;but&nbsp;will&nbsp;return&nbsp;EOF&nbsp;immediately&nbsp;when&nbsp;no&nbsp;body&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063733">//&nbsp;The&nbsp;Server&nbsp;will&nbsp;close&nbsp;the&nbsp;request&nbsp;body.&nbsp;The&nbsp;ServeHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063791">//&nbsp;Handler&nbsp;does&nbsp;not&nbsp;need&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5063821">Body</span>&nbsp;<span class="ident" id="5063826">io</span><span class="op" id="5063828">.</span><span class="ident" id="5063829">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063842">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063906">//&nbsp;The&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063961">//&nbsp;Values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064021">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064044">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;a&nbsp;value&nbsp;of&nbsp;0&nbsp;means&nbsp;unknown&nbsp;if&nbsp;Body&nbsp;is&nbsp;not&nbsp;nil.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5064116">ContentLength</span>&nbsp;<span class="ident" id="5064130">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064138">//&nbsp;TransferEncoding&nbsp;lists&nbsp;the&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outermost&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064206">//&nbsp;innermost.&nbsp;An&nbsp;empty&nbsp;list&nbsp;denotes&nbsp;the&nbsp;&#34;identity&#34;&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064268">//&nbsp;TransferEncoding&nbsp;can&nbsp;usually&nbsp;be&nbsp;ignored;&nbsp;chunked&nbsp;encoding&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064333">//&nbsp;automatically&nbsp;added&nbsp;and&nbsp;removed&nbsp;as&nbsp;necessary&nbsp;when&nbsp;sending&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064399">//&nbsp;receiving&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5064423">TransferEncoding</span>&nbsp;<span class="op" id="5064440">[</span><span class="op" id="5064441">]</span><span class="builtintype" id="5064442">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064451">//&nbsp;Close&nbsp;indicates&nbsp;whether&nbsp;to&nbsp;close&nbsp;the&nbsp;connection&nbsp;after</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064509">//&nbsp;replying&nbsp;to&nbsp;this&nbsp;request&nbsp;(for&nbsp;servers)&nbsp;or&nbsp;after&nbsp;sending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064569">//&nbsp;the&nbsp;request&nbsp;(for&nbsp;clients).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5064600">Close</span>&nbsp;<span class="builtintype" id="5064606">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064613">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;host&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064674">//&nbsp;URL&nbsp;is&nbsp;sought.&nbsp;Per&nbsp;RFC&nbsp;2616,&nbsp;this&nbsp;is&nbsp;either&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064735">//&nbsp;the&nbsp;&#34;Host&#34;&nbsp;header&nbsp;or&nbsp;the&nbsp;host&nbsp;name&nbsp;given&nbsp;in&nbsp;the&nbsp;URL&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064799">//&nbsp;It&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064838">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064842">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Host&nbsp;optionally&nbsp;overrides&nbsp;the&nbsp;Host</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064901">//&nbsp;header&nbsp;to&nbsp;send.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;Request.Write&nbsp;method&nbsp;uses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064961">//&nbsp;the&nbsp;value&nbsp;of&nbsp;URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5064988">Host</span>&nbsp;<span class="builtintype" id="5064993">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065002">//&nbsp;Form&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data,&nbsp;including&nbsp;both&nbsp;the&nbsp;URL</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065065">//&nbsp;field&#39;s&nbsp;query&nbsp;parameters&nbsp;and&nbsp;the&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;form&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065125">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065185">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;Form&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065241">Form</span>&nbsp;<span class="ident" id="5065246">url</span><span class="op" id="5065249">.</span><span class="ident" id="5065250">Values</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065259">//&nbsp;PostForm&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data&nbsp;from&nbsp;POST&nbsp;or&nbsp;PUT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065319">//&nbsp;body&nbsp;parameters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065340">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065400">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;PostForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065460">PostForm</span>&nbsp;<span class="ident" id="5065469">url</span><span class="op" id="5065472">.</span><span class="ident" id="5065473">Values</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065482">//&nbsp;MultipartForm&nbsp;is&nbsp;the&nbsp;parsed&nbsp;multipart&nbsp;form,&nbsp;including&nbsp;file&nbsp;uploads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065554">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseMultipartForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065623">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;MultipartForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065688">MultipartForm</span>&nbsp;<span class="op" id="5065702">*</span><span class="ident" id="5065703">multipart</span><span class="op" id="5065712">.</span><span class="ident" id="5065713">Form</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065720">//&nbsp;Trailer&nbsp;specifies&nbsp;additional&nbsp;headers&nbsp;that&nbsp;are&nbsp;sent&nbsp;after&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065793">//&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065803">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065807">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Trailer&nbsp;map&nbsp;initially&nbsp;contains&nbsp;only&nbsp;the</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065875">//&nbsp;trailer&nbsp;keys,&nbsp;with&nbsp;nil&nbsp;values.&nbsp;(The&nbsp;client&nbsp;declares&nbsp;which&nbsp;trailers&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065949">//&nbsp;will&nbsp;later&nbsp;send.)&nbsp;&nbsp;While&nbsp;the&nbsp;handler&nbsp;is&nbsp;reading&nbsp;from&nbsp;Body,&nbsp;it&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066020">//&nbsp;not&nbsp;reference&nbsp;Trailer.&nbsp;After&nbsp;reading&nbsp;from&nbsp;Body&nbsp;returns&nbsp;EOF,&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066092">//&nbsp;can&nbsp;be&nbsp;read&nbsp;again&nbsp;and&nbsp;will&nbsp;contain&nbsp;non-nil&nbsp;values,&nbsp;if&nbsp;they&nbsp;were&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066165">//&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066184">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066188">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Trailer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;to&nbsp;a&nbsp;map&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066260">//&nbsp;the&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;later&nbsp;send.&nbsp;The&nbsp;values&nbsp;may&nbsp;be&nbsp;nil&nbsp;or&nbsp;their&nbsp;final</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066333">//&nbsp;values.&nbsp;The&nbsp;ContentLength&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;-1,&nbsp;to&nbsp;send&nbsp;a&nbsp;chunked&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066407">//&nbsp;After&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;is&nbsp;sent&nbsp;the&nbsp;map&nbsp;values&nbsp;can&nbsp;be&nbsp;updated&nbsp;while</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066478">//&nbsp;the&nbsp;request&nbsp;body&nbsp;is&nbsp;read.&nbsp;Once&nbsp;the&nbsp;body&nbsp;returns&nbsp;EOF,&nbsp;the&nbsp;caller&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066551">//&nbsp;not&nbsp;mutate&nbsp;Trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066575">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066579">//&nbsp;Few&nbsp;HTTP&nbsp;clients,&nbsp;servers,&nbsp;or&nbsp;proxies&nbsp;support&nbsp;HTTP&nbsp;trailers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066644">Trailer</span>&nbsp;<span class="ident" id="5066652">Header</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066661">//&nbsp;RemoteAddr&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066725">//&nbsp;the&nbsp;network&nbsp;address&nbsp;that&nbsp;sent&nbsp;the&nbsp;request,&nbsp;usually&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066784">//&nbsp;logging.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066844">//&nbsp;has&nbsp;no&nbsp;defined&nbsp;format.&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066903">//&nbsp;sets&nbsp;RemoteAddr&nbsp;to&nbsp;an&nbsp;&#34;IP:port&#34;&nbsp;address&nbsp;before&nbsp;invoking&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066965">//&nbsp;handler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5066978">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5067024">RemoteAddr</span>&nbsp;<span class="builtintype" id="5067035">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5067044">//&nbsp;RequestURI&nbsp;is&nbsp;the&nbsp;unmodified&nbsp;Request-URI&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5067096">//&nbsp;Request-Line&nbsp;(RFC&nbsp;2616,&nbsp;Section&nbsp;5.1)&nbsp;as&nbsp;sent&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5067159">//&nbsp;to&nbsp;a&nbsp;server.&nbsp;Usually&nbsp;the&nbsp;URL&nbsp;field&nbsp;should&nbsp;be&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5067222">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;set&nbsp;this&nbsp;field&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5067286">RequestURI</span>&nbsp;<span class="builtintype" id="5067297">string</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5067306">//&nbsp;TLS&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5067363">//&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5067425">//&nbsp;was&nbsp;received.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5067487">//&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package&nbsp;sets&nbsp;the&nbsp;field&nbsp;for</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5067542">//&nbsp;TLS-enabled&nbsp;connections&nbsp;before&nbsp;invoking&nbsp;a&nbsp;handler;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5067597">//&nbsp;otherwise&nbsp;it&nbsp;leaves&nbsp;the&nbsp;field&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5067636">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5067682">TLS</span>&nbsp;<span class="op" id="5067686">*</span><span class="ident" id="5067687">tls</span><span class="op" id="5067690">.</span><span class="ident" id="5067691">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="5067707">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5067710">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="5067765">//&nbsp;in&nbsp;the&nbsp;request&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="5067808">func</span>&nbsp;<span class="op" id="5067813">(</span><span class="ident" id="5067814">r</span>&nbsp;<span class="op" id="5067816">*</span><span class="ident" id="5067817">Request</span><span class="op" id="5067824">)</span>&nbsp;<span class="ident" id="5067826">ProtoAtLeast</span><span class="op" id="5067838">(</span><span class="ident" id="5067839">major</span><span class="op" id="5067844">,</span>&nbsp;<span class="ident" id="5067846">minor</span>&nbsp;<span class="builtintype" id="5067852">int</span><span class="op" id="5067855">)</span>&nbsp;<span class="builtintype" id="5067857">bool</span>&nbsp;<span class="op" id="5067862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5067865">return</span>&nbsp;<span class="ident" id="5067872">r</span><span class="op" id="5067873">.</span><span class="ident" id="5067874">ProtoMajor</span>&nbsp;<span class="op" id="5067885">&gt;</span>&nbsp;<span class="ident" id="5067887">major</span>&nbsp;<span class="op" id="5067893">||</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5067898">r</span><span class="op" id="5067899">.</span><span class="ident" id="5067900">ProtoMajor</span>&nbsp;<span class="op" id="5067911">==</span>&nbsp;<span class="ident" id="5067914">major</span>&nbsp;<span class="op" id="5067920">&amp;&amp;</span>&nbsp;<span class="ident" id="5067923">r</span><span class="op" id="5067924">.</span><span class="ident" id="5067925">ProtoMinor</span>&nbsp;<span class="op" id="5067936">&gt;=</span>&nbsp;<span class="ident" id="5067939">minor</span><br>
<span class="lineno"></span><span class="op" id="5067945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5067948">//&nbsp;UserAgent&nbsp;returns&nbsp;the&nbsp;client&#39;s&nbsp;User-Agent,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="5068018">func</span>&nbsp;<span class="op" id="5068023">(</span><span class="ident" id="5068024">r</span>&nbsp;<span class="op" id="5068026">*</span><span class="ident" id="5068027">Request</span><span class="op" id="5068034">)</span>&nbsp;<span class="ident" id="5068036">UserAgent</span><span class="op" id="5068045">(</span><span class="op" id="5068046">)</span>&nbsp;<span class="builtintype" id="5068048">string</span>&nbsp;<span class="op" id="5068055">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5068058">return</span>&nbsp;<span class="ident" id="5068065">r</span><span class="op" id="5068066">.</span><span class="ident" id="5068067">Header</span><span class="op" id="5068073">.</span><span class="ident" id="5068074">Get</span><span class="op" id="5068077">(</span><span class="string" id="5068078">&#34;User-Agent&#34;</span><span class="op" id="5068090">)</span><br>
<span class="lineno"></span><span class="op" id="5068092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5068095">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;cookies&nbsp;sent&nbsp;with&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="5068165">func</span>&nbsp;<span class="op" id="5068170">(</span><span class="ident" id="5068171">r</span>&nbsp;<span class="op" id="5068173">*</span><span class="ident" id="5068174">Request</span><span class="op" id="5068181">)</span>&nbsp;<span class="ident" id="5068183">Cookies</span><span class="op" id="5068190">(</span><span class="op" id="5068191">)</span>&nbsp;<span class="op" id="5068193">[</span><span class="op" id="5068194">]</span><span class="op" id="5068195">*</span><span class="ident" id="5068196">Cookie</span>&nbsp;<span class="op" id="5068203">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5068206">return</span>&nbsp;<span class="ident" id="5068213">readCookies</span><span class="op" id="5068224">(</span><span class="ident" id="5068225">r</span><span class="op" id="5068226">.</span><span class="ident" id="5068227">Header</span><span class="op" id="5068233">,</span>&nbsp;<span class="string" id="5068235">&#34;&#34;</span><span class="op" id="5068237">)</span><br>
<span class="lineno"></span><span class="op" id="5068239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5068242">var</span>&nbsp;<span class="ident" id="5068246">ErrNoCookie</span>&nbsp;<span class="op" id="5068258">=</span>&nbsp;<span class="ident" id="5068260">errors</span><span class="op" id="5068266">.</span><span class="ident" id="5068267">New</span><span class="op" id="5068270">(</span><span class="string" id="5068271">&#34;http:&nbsp;named&nbsp;cookie&nbsp;not&nbsp;present&#34;</span><span class="op" id="5068303">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="5068306">//&nbsp;Cookie&nbsp;returns&nbsp;the&nbsp;named&nbsp;cookie&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5068368">//&nbsp;ErrNoCookie&nbsp;if&nbsp;not&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5068397">func</span>&nbsp;<span class="op" id="5068402">(</span><span class="ident" id="5068403">r</span>&nbsp;<span class="op" id="5068405">*</span><span class="ident" id="5068406">Request</span><span class="op" id="5068413">)</span>&nbsp;<span class="ident" id="5068415">Cookie</span><span class="op" id="5068421">(</span><span class="ident" id="5068422">name</span>&nbsp;<span class="builtintype" id="5068427">string</span><span class="op" id="5068433">)</span>&nbsp;<span class="op" id="5068435">(</span><span class="op" id="5068436">*</span><span class="ident" id="5068437">Cookie</span><span class="op" id="5068443">,</span>&nbsp;<span class="builtintype" id="5068445">error</span><span class="op" id="5068450">)</span>&nbsp;<span class="op" id="5068452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5068455">for</span>&nbsp;<span class="ident" id="5068459">_</span><span class="op" id="5068460">,</span>&nbsp;<span class="ident" id="5068462">c</span>&nbsp;<span class="op" id="5068464">:=</span>&nbsp;<span class="keyword" id="5068467">range</span>&nbsp;<span class="ident" id="5068473">readCookies</span><span class="op" id="5068484">(</span><span class="ident" id="5068485">r</span><span class="op" id="5068486">.</span><span class="ident" id="5068487">Header</span><span class="op" id="5068493">,</span>&nbsp;<span class="ident" id="5068495">name</span><span class="op" id="5068499">)</span>&nbsp;<span class="op" id="5068501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5068505">return</span>&nbsp;<span class="ident" id="5068512">c</span><span class="op" id="5068513">,</span>&nbsp;<span class="ident" id="5068515">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5068520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5068523">return</span>&nbsp;<span class="ident" id="5068530">nil</span><span class="op" id="5068533">,</span>&nbsp;<span class="ident" id="5068535">ErrNoCookie</span><br>
<span class="lineno"></span><span class="op" id="5068547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5068550">//&nbsp;AddCookie&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;to&nbsp;the&nbsp;request.&nbsp;&nbsp;Per&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.4,</span><br>
<span class="lineno">260</span><span class="comment" id="5068620">//&nbsp;AddCookie&nbsp;does&nbsp;not&nbsp;attach&nbsp;more&nbsp;than&nbsp;one&nbsp;Cookie&nbsp;header&nbsp;field.&nbsp;&nbsp;That</span><br>
<span class="lineno"></span><span class="comment" id="5068690">//&nbsp;means&nbsp;all&nbsp;cookies,&nbsp;if&nbsp;any,&nbsp;are&nbsp;written&nbsp;into&nbsp;the&nbsp;same&nbsp;line,</span><br>
<span class="lineno"></span><span class="comment" id="5068752">//&nbsp;separated&nbsp;by&nbsp;semicolon.</span><br>
<span class="lineno"></span><span class="keyword" id="5068779">func</span>&nbsp;<span class="op" id="5068784">(</span><span class="ident" id="5068785">r</span>&nbsp;<span class="op" id="5068787">*</span><span class="ident" id="5068788">Request</span><span class="op" id="5068795">)</span>&nbsp;<span class="ident" id="5068797">AddCookie</span><span class="op" id="5068806">(</span><span class="ident" id="5068807">c</span>&nbsp;<span class="op" id="5068809">*</span><span class="ident" id="5068810">Cookie</span><span class="op" id="5068816">)</span>&nbsp;<span class="op" id="5068818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5068821">s</span>&nbsp;<span class="op" id="5068823">:=</span>&nbsp;<span class="ident" id="5068826">fmt</span><span class="op" id="5068829">.</span><span class="ident" id="5068830">Sprintf</span><span class="op" id="5068837">(</span><span class="string" id="5068838">&#34;%s=%s&#34;</span><span class="op" id="5068845">,</span>&nbsp;<span class="ident" id="5068847">sanitizeCookieName</span><span class="op" id="5068865">(</span><span class="ident" id="5068866">c</span><span class="op" id="5068867">.</span><span class="ident" id="5068868">Name</span><span class="op" id="5068872">)</span><span class="op" id="5068873">,</span>&nbsp;<span class="ident" id="5068875">sanitizeCookieValue</span><span class="op" id="5068894">(</span><span class="ident" id="5068895">c</span><span class="op" id="5068896">.</span><span class="ident" id="5068897">Value</span><span class="op" id="5068902">)</span><span class="op" id="5068903">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5068906">if</span>&nbsp;<span class="ident" id="5068909">c</span>&nbsp;<span class="op" id="5068911">:=</span>&nbsp;<span class="ident" id="5068914">r</span><span class="op" id="5068915">.</span><span class="ident" id="5068916">Header</span><span class="op" id="5068922">.</span><span class="ident" id="5068923">Get</span><span class="op" id="5068926">(</span><span class="string" id="5068927">&#34;Cookie&#34;</span><span class="op" id="5068935">)</span><span class="op" id="5068936">;</span>&nbsp;<span class="ident" id="5068938">c</span>&nbsp;<span class="op" id="5068940">!=</span>&nbsp;<span class="string" id="5068943">&#34;&#34;</span>&nbsp;<span class="op" id="5068946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5068950">r</span><span class="op" id="5068951">.</span><span class="ident" id="5068952">Header</span><span class="op" id="5068958">.</span><span class="ident" id="5068959">Set</span><span class="op" id="5068962">(</span><span class="string" id="5068963">&#34;Cookie&#34;</span><span class="op" id="5068971">,</span>&nbsp;<span class="ident" id="5068973">c</span><span class="op" id="5068974">+</span><span class="string" id="5068975">&#34;;&nbsp;&#34;</span><span class="op" id="5068979">+</span><span class="ident" id="5068980">s</span><span class="op" id="5068981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5068984">}</span>&nbsp;<span class="keyword" id="5068986">else</span>&nbsp;<span class="op" id="5068991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5068995">r</span><span class="op" id="5068996">.</span><span class="ident" id="5068997">Header</span><span class="op" id="5069003">.</span><span class="ident" id="5069004">Set</span><span class="op" id="5069007">(</span><span class="string" id="5069008">&#34;Cookie&#34;</span><span class="op" id="5069016">,</span>&nbsp;<span class="ident" id="5069018">s</span><span class="op" id="5069019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5069022">}</span><br>
<span class="lineno">270</span><span class="op" id="5069024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5069027">//&nbsp;Referer&nbsp;returns&nbsp;the&nbsp;referring&nbsp;URL,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5069089">//</span><br>
<span class="lineno"></span><span class="comment" id="5069092">//&nbsp;Referer&nbsp;is&nbsp;misspelled&nbsp;as&nbsp;in&nbsp;the&nbsp;request&nbsp;itself,&nbsp;a&nbsp;mistake&nbsp;from&nbsp;the</span><br>
<span class="lineno">275</span><span class="comment" id="5069162">//&nbsp;earliest&nbsp;days&nbsp;of&nbsp;HTTP.&nbsp;&nbsp;This&nbsp;value&nbsp;can&nbsp;also&nbsp;be&nbsp;fetched&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5069229">//&nbsp;Header&nbsp;map&nbsp;as&nbsp;Header[&#34;Referer&#34;];&nbsp;the&nbsp;benefit&nbsp;of&nbsp;making&nbsp;it&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="5069300">//&nbsp;as&nbsp;a&nbsp;method&nbsp;is&nbsp;that&nbsp;the&nbsp;compiler&nbsp;can&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5069371">//&nbsp;alternate&nbsp;(correct&nbsp;English)&nbsp;spelling&nbsp;req.Referrer()&nbsp;but&nbsp;cannot</span><br>
<span class="lineno"></span><span class="comment" id="5069437">//&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;Header[&#34;Referrer&#34;].</span><br>
<span class="lineno">280</span><span class="keyword" id="5069487">func</span>&nbsp;<span class="op" id="5069492">(</span><span class="ident" id="5069493">r</span>&nbsp;<span class="op" id="5069495">*</span><span class="ident" id="5069496">Request</span><span class="op" id="5069503">)</span>&nbsp;<span class="ident" id="5069505">Referer</span><span class="op" id="5069512">(</span><span class="op" id="5069513">)</span>&nbsp;<span class="builtintype" id="5069515">string</span>&nbsp;<span class="op" id="5069522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5069525">return</span>&nbsp;<span class="ident" id="5069532">r</span><span class="op" id="5069533">.</span><span class="ident" id="5069534">Header</span><span class="op" id="5069540">.</span><span class="ident" id="5069541">Get</span><span class="op" id="5069544">(</span><span class="string" id="5069545">&#34;Referer&#34;</span><span class="op" id="5069554">)</span><br>
<span class="lineno"></span><span class="op" id="5069556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5069559">//&nbsp;multipartByReader&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno">285</span><span class="comment" id="5069601">//&nbsp;Its&nbsp;presence&nbsp;in&nbsp;Request.MultipartForm&nbsp;indicates&nbsp;that&nbsp;parsing&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="5069680">//&nbsp;body&nbsp;has&nbsp;been&nbsp;handed&nbsp;off&nbsp;to&nbsp;a&nbsp;MultipartReader&nbsp;instead&nbsp;of&nbsp;ParseMultipartFrom.</span><br>
<span class="lineno"></span><span class="keyword" id="5069760">var</span>&nbsp;<span class="ident" id="5069764">multipartByReader</span>&nbsp;<span class="op" id="5069782">=</span>&nbsp;<span class="op" id="5069784">&amp;</span><span class="ident" id="5069785">multipart</span><span class="op" id="5069794">.</span><span class="ident" id="5069795">Form</span><span class="op" id="5069799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069802">Value</span><span class="op" id="5069807">:</span>&nbsp;<span class="builtinfunc" id="5069809">make</span><span class="op" id="5069813">(</span><span class="keyword" id="5069814">map</span><span class="op" id="5069817">[</span><span class="builtintype" id="5069818">string</span><span class="op" id="5069824">]</span><span class="op" id="5069825">[</span><span class="op" id="5069826">]</span><span class="builtintype" id="5069827">string</span><span class="op" id="5069833">)</span><span class="op" id="5069834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069837">File</span><span class="op" id="5069841">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="5069844">make</span><span class="op" id="5069848">(</span><span class="keyword" id="5069849">map</span><span class="op" id="5069852">[</span><span class="builtintype" id="5069853">string</span><span class="op" id="5069859">]</span><span class="op" id="5069860">[</span><span class="op" id="5069861">]</span><span class="op" id="5069862">*</span><span class="ident" id="5069863">multipart</span><span class="op" id="5069872">.</span><span class="ident" id="5069873">FileHeader</span><span class="op" id="5069883">)</span><span class="op" id="5069884">,</span><br>
<span class="lineno">290</span><span class="op" id="5069886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5069889">//&nbsp;MultipartReader&nbsp;returns&nbsp;a&nbsp;MIME&nbsp;multipart&nbsp;reader&nbsp;if&nbsp;this&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5069953">//&nbsp;multipart/form-data&nbsp;POST&nbsp;request,&nbsp;else&nbsp;returns&nbsp;nil&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="5070021">//&nbsp;Use&nbsp;this&nbsp;function&nbsp;instead&nbsp;of&nbsp;ParseMultipartForm&nbsp;to</span><br>
<span class="lineno">295</span><span class="comment" id="5070075">//&nbsp;process&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5070116">func</span>&nbsp;<span class="op" id="5070121">(</span><span class="ident" id="5070122">r</span>&nbsp;<span class="op" id="5070124">*</span><span class="ident" id="5070125">Request</span><span class="op" id="5070132">)</span>&nbsp;<span class="ident" id="5070134">MultipartReader</span><span class="op" id="5070149">(</span><span class="op" id="5070150">)</span>&nbsp;<span class="op" id="5070152">(</span><span class="op" id="5070153">*</span><span class="ident" id="5070154">multipart</span><span class="op" id="5070163">.</span><span class="ident" id="5070164">Reader</span><span class="op" id="5070170">,</span>&nbsp;<span class="builtintype" id="5070172">error</span><span class="op" id="5070177">)</span>&nbsp;<span class="op" id="5070179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070182">if</span>&nbsp;<span class="ident" id="5070185">r</span><span class="op" id="5070186">.</span><span class="ident" id="5070187">MultipartForm</span>&nbsp;<span class="op" id="5070201">==</span>&nbsp;<span class="ident" id="5070204">multipartByReader</span>&nbsp;<span class="op" id="5070222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070226">return</span>&nbsp;<span class="ident" id="5070233">nil</span><span class="op" id="5070236">,</span>&nbsp;<span class="ident" id="5070238">errors</span><span class="op" id="5070244">.</span><span class="ident" id="5070245">New</span><span class="op" id="5070248">(</span><span class="string" id="5070249">&#34;http:&nbsp;MultipartReader&nbsp;called&nbsp;twice&#34;</span><span class="op" id="5070285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070288">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070291">if</span>&nbsp;<span class="ident" id="5070294">r</span><span class="op" id="5070295">.</span><span class="ident" id="5070296">MultipartForm</span>&nbsp;<span class="op" id="5070310">!=</span>&nbsp;<span class="ident" id="5070313">nil</span>&nbsp;<span class="op" id="5070317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070321">return</span>&nbsp;<span class="ident" id="5070328">nil</span><span class="op" id="5070331">,</span>&nbsp;<span class="ident" id="5070333">errors</span><span class="op" id="5070339">.</span><span class="ident" id="5070340">New</span><span class="op" id="5070343">(</span><span class="string" id="5070344">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&#34;</span><span class="op" id="5070391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070397">r</span><span class="op" id="5070398">.</span><span class="ident" id="5070399">MultipartForm</span>&nbsp;<span class="op" id="5070413">=</span>&nbsp;<span class="ident" id="5070415">multipartByReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070434">return</span>&nbsp;<span class="ident" id="5070441">r</span><span class="op" id="5070442">.</span><span class="ident" id="5070443">multipartReader</span><span class="op" id="5070458">(</span><span class="op" id="5070459">)</span><br>
<span class="lineno">305</span><span class="op" id="5070461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5070464">func</span>&nbsp;<span class="op" id="5070469">(</span><span class="ident" id="5070470">r</span>&nbsp;<span class="op" id="5070472">*</span><span class="ident" id="5070473">Request</span><span class="op" id="5070480">)</span>&nbsp;<span class="ident" id="5070482">multipartReader</span><span class="op" id="5070497">(</span><span class="op" id="5070498">)</span>&nbsp;<span class="op" id="5070500">(</span><span class="op" id="5070501">*</span><span class="ident" id="5070502">multipart</span><span class="op" id="5070511">.</span><span class="ident" id="5070512">Reader</span><span class="op" id="5070518">,</span>&nbsp;<span class="builtintype" id="5070520">error</span><span class="op" id="5070525">)</span>&nbsp;<span class="op" id="5070527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070530">v</span>&nbsp;<span class="op" id="5070532">:=</span>&nbsp;<span class="ident" id="5070535">r</span><span class="op" id="5070536">.</span><span class="ident" id="5070537">Header</span><span class="op" id="5070543">.</span><span class="ident" id="5070544">Get</span><span class="op" id="5070547">(</span><span class="string" id="5070548">&#34;Content-Type&#34;</span><span class="op" id="5070562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070565">if</span>&nbsp;<span class="ident" id="5070568">v</span>&nbsp;<span class="op" id="5070570">==</span>&nbsp;<span class="string" id="5070573">&#34;&#34;</span>&nbsp;<span class="op" id="5070576">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070580">return</span>&nbsp;<span class="ident" id="5070587">nil</span><span class="op" id="5070590">,</span>&nbsp;<span class="ident" id="5070592">ErrNotMultipart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070612">d</span><span class="op" id="5070613">,</span>&nbsp;<span class="ident" id="5070615">params</span><span class="op" id="5070621">,</span>&nbsp;<span class="ident" id="5070623">err</span>&nbsp;<span class="op" id="5070627">:=</span>&nbsp;<span class="ident" id="5070630">mime</span><span class="op" id="5070634">.</span><span class="ident" id="5070635">ParseMediaType</span><span class="op" id="5070649">(</span><span class="ident" id="5070650">v</span><span class="op" id="5070651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070654">if</span>&nbsp;<span class="ident" id="5070657">err</span>&nbsp;<span class="op" id="5070661">!=</span>&nbsp;<span class="ident" id="5070664">nil</span>&nbsp;<span class="op" id="5070668">||</span>&nbsp;<span class="ident" id="5070671">d</span>&nbsp;<span class="op" id="5070673">!=</span>&nbsp;<span class="string" id="5070676">&#34;multipart/form-data&#34;</span>&nbsp;<span class="op" id="5070698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070702">return</span>&nbsp;<span class="ident" id="5070709">nil</span><span class="op" id="5070712">,</span>&nbsp;<span class="ident" id="5070714">ErrNotMultipart</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070734">boundary</span><span class="op" id="5070742">,</span>&nbsp;<span class="ident" id="5070744">ok</span>&nbsp;<span class="op" id="5070747">:=</span>&nbsp;<span class="ident" id="5070750">params</span><span class="op" id="5070756">[</span><span class="string" id="5070757">&#34;boundary&#34;</span><span class="op" id="5070767">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070770">if</span>&nbsp;<span class="op" id="5070773">!</span><span class="ident" id="5070774">ok</span>&nbsp;<span class="op" id="5070777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070781">return</span>&nbsp;<span class="ident" id="5070788">nil</span><span class="op" id="5070791">,</span>&nbsp;<span class="ident" id="5070793">ErrMissingBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070813">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070816">return</span>&nbsp;<span class="ident" id="5070823">multipart</span><span class="op" id="5070832">.</span><span class="ident" id="5070833">NewReader</span><span class="op" id="5070842">(</span><span class="ident" id="5070843">r</span><span class="op" id="5070844">.</span><span class="ident" id="5070845">Body</span><span class="op" id="5070849">,</span>&nbsp;<span class="ident" id="5070851">boundary</span><span class="op" id="5070859">)</span><span class="op" id="5070860">,</span>&nbsp;<span class="ident" id="5070862">nil</span><br>
<span class="lineno"></span><span class="op" id="5070866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5070869">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="5070913">func</span>&nbsp;<span class="ident" id="5070918">valueOrDefault</span><span class="op" id="5070932">(</span><span class="ident" id="5070933">value</span><span class="op" id="5070938">,</span>&nbsp;<span class="ident" id="5070940">def</span>&nbsp;<span class="builtintype" id="5070944">string</span><span class="op" id="5070950">)</span>&nbsp;<span class="builtintype" id="5070952">string</span>&nbsp;<span class="op" id="5070959">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070962">if</span>&nbsp;<span class="ident" id="5070965">value</span>&nbsp;<span class="op" id="5070971">!=</span>&nbsp;<span class="string" id="5070974">&#34;&#34;</span>&nbsp;<span class="op" id="5070977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070981">return</span>&nbsp;<span class="ident" id="5070988">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070998">return</span>&nbsp;<span class="ident" id="5071005">def</span><br>
<span class="lineno"></span><span class="op" id="5071009">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="5071012">//&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;not&nbsp;intended&nbsp;to&nbsp;reflect&nbsp;the&nbsp;actual&nbsp;Go&nbsp;version&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="comment" id="5071087">//&nbsp;It&nbsp;was&nbsp;changed&nbsp;from&nbsp;&#34;Go&nbsp;http&nbsp;package&#34;&nbsp;to&nbsp;&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5071160">//&nbsp;time&nbsp;of&nbsp;the&nbsp;Go&nbsp;1.1&nbsp;release&nbsp;because&nbsp;the&nbsp;former&nbsp;User-Agent&nbsp;had&nbsp;ended&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="5071233">//&nbsp;on&nbsp;a&nbsp;blacklist&nbsp;for&nbsp;some&nbsp;intrusion&nbsp;detection&nbsp;systems.</span><br>
<span class="lineno">335</span><span class="comment" id="5071289">//&nbsp;See&nbsp;https://codereview.appspot.com/7532043.</span><br>
<span class="lineno"></span><span class="keyword" id="5071336">const</span>&nbsp;<span class="ident" id="5071342">defaultUserAgent</span>&nbsp;<span class="op" id="5071359">=</span>&nbsp;<span class="string" id="5071361">&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5071384">//&nbsp;Write&nbsp;writes&nbsp;an&nbsp;HTTP/1.1&nbsp;request&nbsp;--&nbsp;header&nbsp;and&nbsp;body&nbsp;--&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="5071458">//&nbsp;This&nbsp;method&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;request:</span><br>
<span class="lineno">340</span><span class="comment" id="5071519">//&nbsp;&nbsp;&nbsp;&nbspHost</span><br>
<span class="lineno"></span><span class="comment" id="5071527">//&nbsp;&nbsp;&nbsp;&nbspURL</span><br>
<span class="lineno"></span><span class="comment" id="5071534">//&nbsp;&nbsp;&nbsp;&nbspMethod&nbsp;(defaults&nbsp;to&nbsp;&#34;GET&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5071564">//&nbsp;&nbsp;&nbsp;&nbspHeader</span><br>
<span class="lineno"></span><span class="comment" id="5071574">//&nbsp;&nbsp;&nbsp;&nbspContentLength</span><br>
<span class="lineno">345</span><span class="comment" id="5071591">//&nbsp;&nbsp;&nbsp;&nbspTransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="5071611">//&nbsp;&nbsp;&nbsp;&nbspBody</span><br>
<span class="lineno"></span><span class="comment" id="5071619">//</span><br>
<span class="lineno"></span><span class="comment" id="5071622">//&nbsp;If&nbsp;Body&nbsp;is&nbsp;present,&nbsp;Content-Length&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;and&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="5071689">//&nbsp;hasn&#39;t&nbsp;been&nbsp;set&nbsp;to&nbsp;&#34;identity&#34;,&nbsp;Write&nbsp;adds&nbsp;&#34;Transfer-Encoding:</span><br>
<span class="lineno">350</span><span class="comment" id="5071754">//&nbsp;chunked&#34;&nbsp;to&nbsp;the&nbsp;header.&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="5071814">func</span>&nbsp;<span class="op" id="5071819">(</span><span class="ident" id="5071820">r</span>&nbsp;<span class="op" id="5071822">*</span><span class="ident" id="5071823">Request</span><span class="op" id="5071830">)</span>&nbsp;<span class="ident" id="5071832">Write</span><span class="op" id="5071837">(</span><span class="ident" id="5071838">w</span>&nbsp;<span class="ident" id="5071840">io</span><span class="op" id="5071842">.</span><span class="ident" id="5071843">Writer</span><span class="op" id="5071849">)</span>&nbsp;<span class="builtintype" id="5071851">error</span>&nbsp;<span class="op" id="5071857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5071860">return</span>&nbsp;<span class="ident" id="5071867">r</span><span class="op" id="5071868">.</span><span class="ident" id="5071869">write</span><span class="op" id="5071874">(</span><span class="ident" id="5071875">w</span><span class="op" id="5071876">,</span>&nbsp;<span class="builtintype" id="5071878">false</span><span class="op" id="5071883">,</span>&nbsp;<span class="ident" id="5071885">nil</span><span class="op" id="5071888">)</span><br>
<span class="lineno"></span><span class="op" id="5071890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="5071893">//&nbsp;WriteProxy&nbsp;is&nbsp;like&nbsp;Write&nbsp;but&nbsp;writes&nbsp;the&nbsp;request&nbsp;in&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5071956">//&nbsp;expected&nbsp;by&nbsp;an&nbsp;HTTP&nbsp;proxy.&nbsp;&nbsp;In&nbsp;particular,&nbsp;WriteProxy&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5072024">//&nbsp;initial&nbsp;Request-URI&nbsp;line&nbsp;of&nbsp;the&nbsp;request&nbsp;with&nbsp;an&nbsp;absolute&nbsp;URI,&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="5072093">//&nbsp;section&nbsp;5.1.2&nbsp;of&nbsp;RFC&nbsp;2616,&nbsp;including&nbsp;the&nbsp;scheme&nbsp;and&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="5072154">//&nbsp;In&nbsp;either&nbsp;case,&nbsp;WriteProxy&nbsp;also&nbsp;writes&nbsp;a&nbsp;Host&nbsp;header,&nbsp;using</span><br>
<span class="lineno">360</span><span class="comment" id="5072217">//&nbsp;either&nbsp;r.Host&nbsp;or&nbsp;r.URL.Host.</span><br>
<span class="lineno"></span><span class="keyword" id="5072249">func</span>&nbsp;<span class="op" id="5072254">(</span><span class="ident" id="5072255">r</span>&nbsp;<span class="op" id="5072257">*</span><span class="ident" id="5072258">Request</span><span class="op" id="5072265">)</span>&nbsp;<span class="ident" id="5072267">WriteProxy</span><span class="op" id="5072277">(</span><span class="ident" id="5072278">w</span>&nbsp;<span class="ident" id="5072280">io</span><span class="op" id="5072282">.</span><span class="ident" id="5072283">Writer</span><span class="op" id="5072289">)</span>&nbsp;<span class="builtintype" id="5072291">error</span>&nbsp;<span class="op" id="5072297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072300">return</span>&nbsp;<span class="ident" id="5072307">r</span><span class="op" id="5072308">.</span><span class="ident" id="5072309">write</span><span class="op" id="5072314">(</span><span class="ident" id="5072315">w</span><span class="op" id="5072316">,</span>&nbsp;<span class="builtintype" id="5072318">true</span><span class="op" id="5072322">,</span>&nbsp;<span class="ident" id="5072324">nil</span><span class="op" id="5072327">)</span><br>
<span class="lineno"></span><span class="op" id="5072329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5072332">//&nbsp;extraHeaders&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span><span class="keyword" id="5072359">func</span>&nbsp;<span class="op" id="5072364">(</span><span class="ident" id="5072365">req</span>&nbsp;<span class="op" id="5072369">*</span><span class="ident" id="5072370">Request</span><span class="op" id="5072377">)</span>&nbsp;<span class="ident" id="5072379">write</span><span class="op" id="5072384">(</span><span class="ident" id="5072385">w</span>&nbsp;<span class="ident" id="5072387">io</span><span class="op" id="5072389">.</span><span class="ident" id="5072390">Writer</span><span class="op" id="5072396">,</span>&nbsp;<span class="ident" id="5072398">usingProxy</span>&nbsp;<span class="builtintype" id="5072409">bool</span><span class="op" id="5072413">,</span>&nbsp;<span class="ident" id="5072415">extraHeaders</span>&nbsp;<span class="ident" id="5072428">Header</span><span class="op" id="5072434">)</span>&nbsp;<span class="builtintype" id="5072436">error</span>&nbsp;<span class="op" id="5072442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072445">host</span>&nbsp;<span class="op" id="5072450">:=</span>&nbsp;<span class="ident" id="5072453">req</span><span class="op" id="5072456">.</span><span class="ident" id="5072457">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072463">if</span>&nbsp;<span class="ident" id="5072466">host</span>&nbsp;<span class="op" id="5072471">==</span>&nbsp;<span class="string" id="5072474">&#34;&#34;</span>&nbsp;<span class="op" id="5072477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072481">if</span>&nbsp;<span class="ident" id="5072484">req</span><span class="op" id="5072487">.</span><span class="ident" id="5072488">URL</span>&nbsp;<span class="op" id="5072492">==</span>&nbsp;<span class="ident" id="5072495">nil</span>&nbsp;<span class="op" id="5072499">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072504">return</span>&nbsp;<span class="ident" id="5072511">errors</span><span class="op" id="5072517">.</span><span class="ident" id="5072518">New</span><span class="op" id="5072521">(</span><span class="string" id="5072522">&#34;http:&nbsp;Request.Write&nbsp;on&nbsp;Request&nbsp;with&nbsp;no&nbsp;Host&nbsp;or&nbsp;URL&nbsp;set&#34;</span><span class="op" id="5072578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072586">host</span>&nbsp;<span class="op" id="5072591">=</span>&nbsp;<span class="ident" id="5072593">req</span><span class="op" id="5072596">.</span><span class="ident" id="5072597">URL</span><span class="op" id="5072600">.</span><span class="ident" id="5072601">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072611">ruri</span>&nbsp;<span class="op" id="5072616">:=</span>&nbsp;<span class="ident" id="5072619">req</span><span class="op" id="5072622">.</span><span class="ident" id="5072623">URL</span><span class="op" id="5072626">.</span><span class="ident" id="5072627">RequestURI</span><span class="op" id="5072637">(</span><span class="op" id="5072638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072641">if</span>&nbsp;<span class="ident" id="5072644">usingProxy</span>&nbsp;<span class="op" id="5072655">&amp;&amp;</span>&nbsp;<span class="ident" id="5072658">req</span><span class="op" id="5072661">.</span><span class="ident" id="5072662">URL</span><span class="op" id="5072665">.</span><span class="ident" id="5072666">Scheme</span>&nbsp;<span class="op" id="5072673">!=</span>&nbsp;<span class="string" id="5072676">&#34;&#34;</span>&nbsp;<span class="op" id="5072679">&amp;&amp;</span>&nbsp;<span class="ident" id="5072682">req</span><span class="op" id="5072685">.</span><span class="ident" id="5072686">URL</span><span class="op" id="5072689">.</span><span class="ident" id="5072690">Opaque</span>&nbsp;<span class="op" id="5072697">==</span>&nbsp;<span class="string" id="5072700">&#34;&#34;</span>&nbsp;<span class="op" id="5072703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072707">ruri</span>&nbsp;<span class="op" id="5072712">=</span>&nbsp;<span class="ident" id="5072714">req</span><span class="op" id="5072717">.</span><span class="ident" id="5072718">URL</span><span class="op" id="5072721">.</span><span class="ident" id="5072722">Scheme</span>&nbsp;<span class="op" id="5072729">+</span>&nbsp;<span class="string" id="5072731">&#34;://&#34;</span>&nbsp;<span class="op" id="5072737">+</span>&nbsp;<span class="ident" id="5072739">host</span>&nbsp;<span class="op" id="5072744">+</span>&nbsp;<span class="ident" id="5072746">ruri</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072752">}</span>&nbsp;<span class="keyword" id="5072754">else</span>&nbsp;<span class="keyword" id="5072759">if</span>&nbsp;<span class="ident" id="5072762">req</span><span class="op" id="5072765">.</span><span class="ident" id="5072766">Method</span>&nbsp;<span class="op" id="5072773">==</span>&nbsp;<span class="string" id="5072776">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="5072786">&amp;&amp;</span>&nbsp;<span class="ident" id="5072789">req</span><span class="op" id="5072792">.</span><span class="ident" id="5072793">URL</span><span class="op" id="5072796">.</span><span class="ident" id="5072797">Path</span>&nbsp;<span class="op" id="5072802">==</span>&nbsp;<span class="string" id="5072805">&#34;&#34;</span>&nbsp;<span class="op" id="5072808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5072812">//&nbsp;CONNECT&nbsp;requests&nbsp;normally&nbsp;give&nbsp;just&nbsp;the&nbsp;host&nbsp;and&nbsp;port,&nbsp;not&nbsp;a&nbsp;full&nbsp;URL.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072888">ruri</span>&nbsp;<span class="op" id="5072893">=</span>&nbsp;<span class="ident" id="5072895">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5072904">//&nbsp;TODO(bradfitz):&nbsp;escape&nbsp;at&nbsp;least&nbsp;newlines&nbsp;in&nbsp;ruri?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5072959">//&nbsp;Wrap&nbsp;the&nbsp;writer&nbsp;in&nbsp;a&nbsp;bufio&nbsp;Writer&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;already&nbsp;buffered.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073027">//&nbsp;Don&#39;t&nbsp;always&nbsp;call&nbsp;NewWriter,&nbsp;as&nbsp;that&nbsp;forces&nbsp;a&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073090">//&nbsp;and&nbsp;other&nbsp;small&nbsp;bufio&nbsp;Writers&nbsp;to&nbsp;have&nbsp;a&nbsp;minimum&nbsp;4k&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073152">//&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073162">var</span>&nbsp;<span class="ident" id="5073166">bw</span>&nbsp;<span class="op" id="5073169">*</span><span class="ident" id="5073170">bufio</span><span class="op" id="5073175">.</span><span class="ident" id="5073176">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073184">if</span>&nbsp;<span class="ident" id="5073187">_</span><span class="op" id="5073188">,</span>&nbsp;<span class="ident" id="5073190">ok</span>&nbsp;<span class="op" id="5073193">:=</span>&nbsp;<span class="ident" id="5073196">w</span><span class="op" id="5073197">.</span><span class="op" id="5073198">(</span><span class="ident" id="5073199">io</span><span class="op" id="5073201">.</span><span class="ident" id="5073202">ByteWriter</span><span class="op" id="5073212">)</span><span class="op" id="5073213">;</span>&nbsp;<span class="op" id="5073215">!</span><span class="ident" id="5073216">ok</span>&nbsp;<span class="op" id="5073219">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073223">bw</span>&nbsp;<span class="op" id="5073226">=</span>&nbsp;<span class="ident" id="5073228">bufio</span><span class="op" id="5073233">.</span><span class="ident" id="5073234">NewWriter</span><span class="op" id="5073243">(</span><span class="ident" id="5073244">w</span><span class="op" id="5073245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073249">w</span>&nbsp;<span class="op" id="5073251">=</span>&nbsp;<span class="ident" id="5073253">bw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073261">_</span><span class="op" id="5073262">,</span>&nbsp;<span class="ident" id="5073264">err</span>&nbsp;<span class="op" id="5073268">:=</span>&nbsp;<span class="ident" id="5073271">fmt</span><span class="op" id="5073274">.</span><span class="ident" id="5073275">Fprintf</span><span class="op" id="5073282">(</span><span class="ident" id="5073283">w</span><span class="op" id="5073284">,</span>&nbsp;<span class="string" id="5073286">&#34;%s&nbsp;%s&nbsp;HTTP/1.1\r\n&#34;</span><span class="op" id="5073306">,</span>&nbsp;<span class="ident" id="5073308">valueOrDefault</span><span class="op" id="5073322">(</span><span class="ident" id="5073323">req</span><span class="op" id="5073326">.</span><span class="ident" id="5073327">Method</span><span class="op" id="5073333">,</span>&nbsp;<span class="string" id="5073335">&#34;GET&#34;</span><span class="op" id="5073340">)</span><span class="op" id="5073341">,</span>&nbsp;<span class="ident" id="5073343">ruri</span><span class="op" id="5073347">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073350">if</span>&nbsp;<span class="ident" id="5073353">err</span>&nbsp;<span class="op" id="5073357">!=</span>&nbsp;<span class="ident" id="5073360">nil</span>&nbsp;<span class="op" id="5073364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073368">return</span>&nbsp;<span class="ident" id="5073375">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073384">//&nbsp;Header&nbsp;lines</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073401">_</span><span class="op" id="5073402">,</span>&nbsp;<span class="ident" id="5073404">err</span>&nbsp;<span class="op" id="5073408">=</span>&nbsp;<span class="ident" id="5073410">fmt</span><span class="op" id="5073413">.</span><span class="ident" id="5073414">Fprintf</span><span class="op" id="5073421">(</span><span class="ident" id="5073422">w</span><span class="op" id="5073423">,</span>&nbsp;<span class="string" id="5073425">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="5073439">,</span>&nbsp;<span class="ident" id="5073441">host</span><span class="op" id="5073445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073448">if</span>&nbsp;<span class="ident" id="5073451">err</span>&nbsp;<span class="op" id="5073455">!=</span>&nbsp;<span class="ident" id="5073458">nil</span>&nbsp;<span class="op" id="5073462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073466">return</span>&nbsp;<span class="ident" id="5073473">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073482">//&nbsp;Use&nbsp;the&nbsp;defaultUserAgent&nbsp;unless&nbsp;the&nbsp;Header&nbsp;contains&nbsp;one,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073549">//&nbsp;may&nbsp;be&nbsp;blank&nbsp;to&nbsp;not&nbsp;send&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073590">userAgent</span>&nbsp;<span class="op" id="5073600">:=</span>&nbsp;<span class="ident" id="5073603">defaultUserAgent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073621">if</span>&nbsp;<span class="ident" id="5073624">req</span><span class="op" id="5073627">.</span><span class="ident" id="5073628">Header</span>&nbsp;<span class="op" id="5073635">!=</span>&nbsp;<span class="ident" id="5073638">nil</span>&nbsp;<span class="op" id="5073642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073646">if</span>&nbsp;<span class="ident" id="5073649">ua</span>&nbsp;<span class="op" id="5073652">:=</span>&nbsp;<span class="ident" id="5073655">req</span><span class="op" id="5073658">.</span><span class="ident" id="5073659">Header</span><span class="op" id="5073665">[</span><span class="string" id="5073666">&#34;User-Agent&#34;</span><span class="op" id="5073678">]</span><span class="op" id="5073679">;</span>&nbsp;<span class="builtinfunc" id="5073681">len</span><span class="op" id="5073684">(</span><span class="ident" id="5073685">ua</span><span class="op" id="5073687">)</span>&nbsp;<span class="op" id="5073689">&gt;</span>&nbsp;<span class="num" id="5073691">0</span>&nbsp;<span class="op" id="5073693">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073698">userAgent</span>&nbsp;<span class="op" id="5073708">=</span>&nbsp;<span class="ident" id="5073710">ua</span><span class="op" id="5073712">[</span><span class="num" id="5073713">0</span><span class="op" id="5073714">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073724">if</span>&nbsp;<span class="ident" id="5073727">userAgent</span>&nbsp;<span class="op" id="5073737">!=</span>&nbsp;<span class="string" id="5073740">&#34;&#34;</span>&nbsp;<span class="op" id="5073743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073747">_</span><span class="op" id="5073748">,</span>&nbsp;<span class="ident" id="5073750">err</span>&nbsp;<span class="op" id="5073754">=</span>&nbsp;<span class="ident" id="5073756">fmt</span><span class="op" id="5073759">.</span><span class="ident" id="5073760">Fprintf</span><span class="op" id="5073767">(</span><span class="ident" id="5073768">w</span><span class="op" id="5073769">,</span>&nbsp;<span class="string" id="5073771">&#34;User-Agent:&nbsp;%s\r\n&#34;</span><span class="op" id="5073791">,</span>&nbsp;<span class="ident" id="5073793">userAgent</span><span class="op" id="5073802">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073806">if</span>&nbsp;<span class="ident" id="5073809">err</span>&nbsp;<span class="op" id="5073813">!=</span>&nbsp;<span class="ident" id="5073816">nil</span>&nbsp;<span class="op" id="5073820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073825">return</span>&nbsp;<span class="ident" id="5073832">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073845">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073890">tw</span><span class="op" id="5073892">,</span>&nbsp;<span class="ident" id="5073894">err</span>&nbsp;<span class="op" id="5073898">:=</span>&nbsp;<span class="ident" id="5073901">newTransferWriter</span><span class="op" id="5073918">(</span><span class="ident" id="5073919">req</span><span class="op" id="5073922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073925">if</span>&nbsp;<span class="ident" id="5073928">err</span>&nbsp;<span class="op" id="5073932">!=</span>&nbsp;<span class="ident" id="5073935">nil</span>&nbsp;<span class="op" id="5073939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073943">return</span>&nbsp;<span class="ident" id="5073950">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073955">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073958">err</span>&nbsp;<span class="op" id="5073962">=</span>&nbsp;<span class="ident" id="5073964">tw</span><span class="op" id="5073966">.</span><span class="ident" id="5073967">WriteHeader</span><span class="op" id="5073978">(</span><span class="ident" id="5073979">w</span><span class="op" id="5073980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073983">if</span>&nbsp;<span class="ident" id="5073986">err</span>&nbsp;<span class="op" id="5073990">!=</span>&nbsp;<span class="ident" id="5073993">nil</span>&nbsp;<span class="op" id="5073997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074001">return</span>&nbsp;<span class="ident" id="5074008">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074017">err</span>&nbsp;<span class="op" id="5074021">=</span>&nbsp;<span class="ident" id="5074023">req</span><span class="op" id="5074026">.</span><span class="ident" id="5074027">Header</span><span class="op" id="5074033">.</span><span class="ident" id="5074034">WriteSubset</span><span class="op" id="5074045">(</span><span class="ident" id="5074046">w</span><span class="op" id="5074047">,</span>&nbsp;<span class="ident" id="5074049">reqWriteExcludeHeader</span><span class="op" id="5074070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074073">if</span>&nbsp;<span class="ident" id="5074076">err</span>&nbsp;<span class="op" id="5074080">!=</span>&nbsp;<span class="ident" id="5074083">nil</span>&nbsp;<span class="op" id="5074087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074091">return</span>&nbsp;<span class="ident" id="5074098">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074107">if</span>&nbsp;<span class="ident" id="5074110">extraHeaders</span>&nbsp;<span class="op" id="5074123">!=</span>&nbsp;<span class="ident" id="5074126">nil</span>&nbsp;<span class="op" id="5074130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074134">err</span>&nbsp;<span class="op" id="5074138">=</span>&nbsp;<span class="ident" id="5074140">extraHeaders</span><span class="op" id="5074152">.</span><span class="ident" id="5074153">Write</span><span class="op" id="5074158">(</span><span class="ident" id="5074159">w</span><span class="op" id="5074160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074164">if</span>&nbsp;<span class="ident" id="5074167">err</span>&nbsp;<span class="op" id="5074171">!=</span>&nbsp;<span class="ident" id="5074174">nil</span>&nbsp;<span class="op" id="5074178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074183">return</span>&nbsp;<span class="ident" id="5074190">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074196">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074203">_</span><span class="op" id="5074204">,</span>&nbsp;<span class="ident" id="5074206">err</span>&nbsp;<span class="op" id="5074210">=</span>&nbsp;<span class="ident" id="5074212">io</span><span class="op" id="5074214">.</span><span class="ident" id="5074215">WriteString</span><span class="op" id="5074226">(</span><span class="ident" id="5074227">w</span><span class="op" id="5074228">,</span>&nbsp;<span class="string" id="5074230">&#34;\r\n&#34;</span><span class="op" id="5074236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074239">if</span>&nbsp;<span class="ident" id="5074242">err</span>&nbsp;<span class="op" id="5074246">!=</span>&nbsp;<span class="ident" id="5074249">nil</span>&nbsp;<span class="op" id="5074253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074257">return</span>&nbsp;<span class="ident" id="5074264">err</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5074273">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074300">err</span>&nbsp;<span class="op" id="5074304">=</span>&nbsp;<span class="ident" id="5074306">tw</span><span class="op" id="5074308">.</span><span class="ident" id="5074309">WriteBody</span><span class="op" id="5074318">(</span><span class="ident" id="5074319">w</span><span class="op" id="5074320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074323">if</span>&nbsp;<span class="ident" id="5074326">err</span>&nbsp;<span class="op" id="5074330">!=</span>&nbsp;<span class="ident" id="5074333">nil</span>&nbsp;<span class="op" id="5074337">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074341">return</span>&nbsp;<span class="ident" id="5074348">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074357">if</span>&nbsp;<span class="ident" id="5074360">bw</span>&nbsp;<span class="op" id="5074363">!=</span>&nbsp;<span class="ident" id="5074366">nil</span>&nbsp;<span class="op" id="5074370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074374">return</span>&nbsp;<span class="ident" id="5074381">bw</span><span class="op" id="5074383">.</span><span class="ident" id="5074384">Flush</span><span class="op" id="5074389">(</span><span class="op" id="5074390">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074396">return</span>&nbsp;<span class="ident" id="5074403">nil</span><br>
<span class="lineno"></span><span class="op" id="5074407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5074410">//&nbsp;ParseHTTPVersion&nbsp;parses&nbsp;a&nbsp;HTTP&nbsp;version&nbsp;string.</span><br>
<span class="lineno">460</span><span class="comment" id="5074460">//&nbsp;&#34;HTTP/1.0&#34;&nbsp;returns&nbsp;(1,&nbsp;0,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="5074496">func</span>&nbsp;<span class="ident" id="5074501">ParseHTTPVersion</span><span class="op" id="5074517">(</span><span class="ident" id="5074518">vers</span>&nbsp;<span class="builtintype" id="5074523">string</span><span class="op" id="5074529">)</span>&nbsp;<span class="op" id="5074531">(</span><span class="ident" id="5074532">major</span><span class="op" id="5074537">,</span>&nbsp;<span class="ident" id="5074539">minor</span>&nbsp;<span class="builtintype" id="5074545">int</span><span class="op" id="5074548">,</span>&nbsp;<span class="ident" id="5074550">ok</span>&nbsp;<span class="builtintype" id="5074553">bool</span><span class="op" id="5074557">)</span>&nbsp;<span class="op" id="5074559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074562">const</span>&nbsp;<span class="ident" id="5074568">Big</span>&nbsp;<span class="op" id="5074572">=</span>&nbsp;<span class="num" id="5074574">1000000</span>&nbsp;<span class="comment" id="5074582">//&nbsp;arbitrary&nbsp;upper&nbsp;bound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074608">switch</span>&nbsp;<span class="ident" id="5074615">vers</span>&nbsp;<span class="op" id="5074620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074623">case</span>&nbsp;<span class="string" id="5074628">&#34;HTTP/1.1&#34;</span><span class="op" id="5074638">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074642">return</span>&nbsp;<span class="num" id="5074649">1</span><span class="op" id="5074650">,</span>&nbsp;<span class="num" id="5074652">1</span><span class="op" id="5074653">,</span>&nbsp;<span class="builtintype" id="5074655">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074661">case</span>&nbsp;<span class="string" id="5074666">&#34;HTTP/1.0&#34;</span><span class="op" id="5074676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074680">return</span>&nbsp;<span class="num" id="5074687">1</span><span class="op" id="5074688">,</span>&nbsp;<span class="num" id="5074690">0</span><span class="op" id="5074691">,</span>&nbsp;<span class="builtintype" id="5074693">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074702">if</span>&nbsp;<span class="op" id="5074705">!</span><span class="ident" id="5074706">strings</span><span class="op" id="5074713">.</span><span class="ident" id="5074714">HasPrefix</span><span class="op" id="5074723">(</span><span class="ident" id="5074724">vers</span><span class="op" id="5074728">,</span>&nbsp;<span class="string" id="5074730">&#34;HTTP/&#34;</span><span class="op" id="5074737">)</span>&nbsp;<span class="op" id="5074739">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074743">return</span>&nbsp;<span class="num" id="5074750">0</span><span class="op" id="5074751">,</span>&nbsp;<span class="num" id="5074753">0</span><span class="op" id="5074754">,</span>&nbsp;<span class="builtintype" id="5074756">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074766">dot</span>&nbsp;<span class="op" id="5074770">:=</span>&nbsp;<span class="ident" id="5074773">strings</span><span class="op" id="5074780">.</span><span class="ident" id="5074781">Index</span><span class="op" id="5074786">(</span><span class="ident" id="5074787">vers</span><span class="op" id="5074791">,</span>&nbsp;<span class="string" id="5074793">&#34;.&#34;</span><span class="op" id="5074796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074799">if</span>&nbsp;<span class="ident" id="5074802">dot</span>&nbsp;<span class="op" id="5074806">&lt;</span>&nbsp;<span class="num" id="5074808">0</span>&nbsp;<span class="op" id="5074810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074814">return</span>&nbsp;<span class="num" id="5074821">0</span><span class="op" id="5074822">,</span>&nbsp;<span class="num" id="5074824">0</span><span class="op" id="5074825">,</span>&nbsp;<span class="builtintype" id="5074827">false</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074837">major</span><span class="op" id="5074842">,</span>&nbsp;<span class="ident" id="5074844">err</span>&nbsp;<span class="op" id="5074848">:=</span>&nbsp;<span class="ident" id="5074851">strconv</span><span class="op" id="5074858">.</span><span class="ident" id="5074859">Atoi</span><span class="op" id="5074863">(</span><span class="ident" id="5074864">vers</span><span class="op" id="5074868">[</span><span class="num" id="5074869">5</span><span class="op" id="5074870">:</span><span class="ident" id="5074871">dot</span><span class="op" id="5074874">]</span><span class="op" id="5074875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074878">if</span>&nbsp;<span class="ident" id="5074881">err</span>&nbsp;<span class="op" id="5074885">!=</span>&nbsp;<span class="ident" id="5074888">nil</span>&nbsp;<span class="op" id="5074892">||</span>&nbsp;<span class="ident" id="5074895">major</span>&nbsp;<span class="op" id="5074901">&lt;</span>&nbsp;<span class="num" id="5074903">0</span>&nbsp;<span class="op" id="5074905">||</span>&nbsp;<span class="ident" id="5074908">major</span>&nbsp;<span class="op" id="5074914">&gt;</span>&nbsp;<span class="ident" id="5074916">Big</span>&nbsp;<span class="op" id="5074920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074924">return</span>&nbsp;<span class="num" id="5074931">0</span><span class="op" id="5074932">,</span>&nbsp;<span class="num" id="5074934">0</span><span class="op" id="5074935">,</span>&nbsp;<span class="builtintype" id="5074937">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074944">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074947">minor</span><span class="op" id="5074952">,</span>&nbsp;<span class="ident" id="5074954">err</span>&nbsp;<span class="op" id="5074958">=</span>&nbsp;<span class="ident" id="5074960">strconv</span><span class="op" id="5074967">.</span><span class="ident" id="5074968">Atoi</span><span class="op" id="5074972">(</span><span class="ident" id="5074973">vers</span><span class="op" id="5074977">[</span><span class="ident" id="5074978">dot</span><span class="op" id="5074981">+</span><span class="num" id="5074982">1</span><span class="op" id="5074983">:</span><span class="op" id="5074984">]</span><span class="op" id="5074985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074988">if</span>&nbsp;<span class="ident" id="5074991">err</span>&nbsp;<span class="op" id="5074995">!=</span>&nbsp;<span class="ident" id="5074998">nil</span>&nbsp;<span class="op" id="5075002">||</span>&nbsp;<span class="ident" id="5075005">minor</span>&nbsp;<span class="op" id="5075011">&lt;</span>&nbsp;<span class="num" id="5075013">0</span>&nbsp;<span class="op" id="5075015">||</span>&nbsp;<span class="ident" id="5075018">minor</span>&nbsp;<span class="op" id="5075024">&gt;</span>&nbsp;<span class="ident" id="5075026">Big</span>&nbsp;<span class="op" id="5075030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075034">return</span>&nbsp;<span class="num" id="5075041">0</span><span class="op" id="5075042">,</span>&nbsp;<span class="num" id="5075044">0</span><span class="op" id="5075045">,</span>&nbsp;<span class="builtintype" id="5075047">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075057">return</span>&nbsp;<span class="ident" id="5075064">major</span><span class="op" id="5075069">,</span>&nbsp;<span class="ident" id="5075071">minor</span><span class="op" id="5075076">,</span>&nbsp;<span class="builtintype" id="5075078">true</span><br>
<span class="lineno">485</span><span class="op" id="5075083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5075086">//&nbsp;NewRequest&nbsp;returns&nbsp;a&nbsp;new&nbsp;Request&nbsp;given&nbsp;a&nbsp;method,&nbsp;URL,&nbsp;and&nbsp;optional&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="5075162">//</span><br>
<span class="lineno"></span><span class="comment" id="5075165">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;the&nbsp;returned</span><br>
<span class="lineno">490</span><span class="comment" id="5075224">//&nbsp;Request.Body&nbsp;is&nbsp;set&nbsp;to&nbsp;body&nbsp;and&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;Client</span><br>
<span class="lineno"></span><span class="comment" id="5075288">//&nbsp;methods&nbsp;Do,&nbsp;Post,&nbsp;and&nbsp;PostForm,&nbsp;and&nbsp;Transport.RoundTrip.</span><br>
<span class="lineno"></span><span class="keyword" id="5075348">func</span>&nbsp;<span class="ident" id="5075353">NewRequest</span><span class="op" id="5075363">(</span><span class="ident" id="5075364">method</span><span class="op" id="5075370">,</span>&nbsp;<span class="ident" id="5075372">urlStr</span>&nbsp;<span class="builtintype" id="5075379">string</span><span class="op" id="5075385">,</span>&nbsp;<span class="ident" id="5075387">body</span>&nbsp;<span class="ident" id="5075392">io</span><span class="op" id="5075394">.</span><span class="ident" id="5075395">Reader</span><span class="op" id="5075401">)</span>&nbsp;<span class="op" id="5075403">(</span><span class="op" id="5075404">*</span><span class="ident" id="5075405">Request</span><span class="op" id="5075412">,</span>&nbsp;<span class="builtintype" id="5075414">error</span><span class="op" id="5075419">)</span>&nbsp;<span class="op" id="5075421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075424">u</span><span class="op" id="5075425">,</span>&nbsp;<span class="ident" id="5075427">err</span>&nbsp;<span class="op" id="5075431">:=</span>&nbsp;<span class="ident" id="5075434">url</span><span class="op" id="5075437">.</span><span class="ident" id="5075438">Parse</span><span class="op" id="5075443">(</span><span class="ident" id="5075444">urlStr</span><span class="op" id="5075450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075453">if</span>&nbsp;<span class="ident" id="5075456">err</span>&nbsp;<span class="op" id="5075460">!=</span>&nbsp;<span class="ident" id="5075463">nil</span>&nbsp;<span class="op" id="5075467">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075471">return</span>&nbsp;<span class="ident" id="5075478">nil</span><span class="op" id="5075481">,</span>&nbsp;<span class="ident" id="5075483">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075491">rc</span><span class="op" id="5075493">,</span>&nbsp;<span class="ident" id="5075495">ok</span>&nbsp;<span class="op" id="5075498">:=</span>&nbsp;<span class="ident" id="5075501">body</span><span class="op" id="5075505">.</span><span class="op" id="5075506">(</span><span class="ident" id="5075507">io</span><span class="op" id="5075509">.</span><span class="ident" id="5075510">ReadCloser</span><span class="op" id="5075520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075523">if</span>&nbsp;<span class="op" id="5075526">!</span><span class="ident" id="5075527">ok</span>&nbsp;<span class="op" id="5075530">&amp;&amp;</span>&nbsp;<span class="ident" id="5075533">body</span>&nbsp;<span class="op" id="5075538">!=</span>&nbsp;<span class="ident" id="5075541">nil</span>&nbsp;<span class="op" id="5075545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075549">rc</span>&nbsp;<span class="op" id="5075552">=</span>&nbsp;<span class="ident" id="5075554">ioutil</span><span class="op" id="5075560">.</span><span class="ident" id="5075561">NopCloser</span><span class="op" id="5075570">(</span><span class="ident" id="5075571">body</span><span class="op" id="5075575">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075581">req</span>&nbsp;<span class="op" id="5075585">:=</span>&nbsp;<span class="op" id="5075588">&amp;</span><span class="ident" id="5075589">Request</span><span class="op" id="5075596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075600">Method</span><span class="op" id="5075606">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5075612">method</span><span class="op" id="5075618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075622">URL</span><span class="op" id="5075625">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5075634">u</span><span class="op" id="5075635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075639">Proto</span><span class="op" id="5075644">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5075651">&#34;HTTP/1.1&#34;</span><span class="op" id="5075661">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075665">ProtoMajor</span><span class="op" id="5075675">:</span>&nbsp;<span class="num" id="5075677">1</span><span class="op" id="5075678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075682">ProtoMinor</span><span class="op" id="5075692">:</span>&nbsp;<span class="num" id="5075694">1</span><span class="op" id="5075695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075699">Header</span><span class="op" id="5075705">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5075711">make</span><span class="op" id="5075715">(</span><span class="ident" id="5075716">Header</span><span class="op" id="5075722">)</span><span class="op" id="5075723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075727">Body</span><span class="op" id="5075731">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5075739">rc</span><span class="op" id="5075741">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075745">Host</span><span class="op" id="5075749">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5075757">u</span><span class="op" id="5075758">.</span><span class="ident" id="5075759">Host</span><span class="op" id="5075763">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075769">if</span>&nbsp;<span class="ident" id="5075772">body</span>&nbsp;<span class="op" id="5075777">!=</span>&nbsp;<span class="ident" id="5075780">nil</span>&nbsp;<span class="op" id="5075784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075788">switch</span>&nbsp;<span class="ident" id="5075795">v</span>&nbsp;<span class="op" id="5075797">:=</span>&nbsp;<span class="ident" id="5075800">body</span><span class="op" id="5075804">.</span><span class="op" id="5075805">(</span><span class="keyword" id="5075806">type</span><span class="op" id="5075810">)</span>&nbsp;<span class="op" id="5075812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075816">case</span>&nbsp;<span class="op" id="5075821">*</span><span class="ident" id="5075822">bytes</span><span class="op" id="5075827">.</span><span class="ident" id="5075828">Buffer</span><span class="op" id="5075834">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075839">req</span><span class="op" id="5075842">.</span><span class="ident" id="5075843">ContentLength</span>&nbsp;<span class="op" id="5075857">=</span>&nbsp;<span class="ident" id="5075859">int64</span><span class="op" id="5075864">(</span><span class="ident" id="5075865">v</span><span class="op" id="5075866">.</span><span class="ident" id="5075867">Len</span><span class="op" id="5075870">(</span><span class="op" id="5075871">)</span><span class="op" id="5075872">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075876">case</span>&nbsp;<span class="op" id="5075881">*</span><span class="ident" id="5075882">bytes</span><span class="op" id="5075887">.</span><span class="ident" id="5075888">Reader</span><span class="op" id="5075894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075899">req</span><span class="op" id="5075902">.</span><span class="ident" id="5075903">ContentLength</span>&nbsp;<span class="op" id="5075917">=</span>&nbsp;<span class="ident" id="5075919">int64</span><span class="op" id="5075924">(</span><span class="ident" id="5075925">v</span><span class="op" id="5075926">.</span><span class="ident" id="5075927">Len</span><span class="op" id="5075930">(</span><span class="op" id="5075931">)</span><span class="op" id="5075932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075936">case</span>&nbsp;<span class="op" id="5075941">*</span><span class="ident" id="5075942">strings</span><span class="op" id="5075949">.</span><span class="ident" id="5075950">Reader</span><span class="op" id="5075956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075961">req</span><span class="op" id="5075964">.</span><span class="ident" id="5075965">ContentLength</span>&nbsp;<span class="op" id="5075979">=</span>&nbsp;<span class="ident" id="5075981">int64</span><span class="op" id="5075986">(</span><span class="ident" id="5075987">v</span><span class="op" id="5075988">.</span><span class="ident" id="5075989">Len</span><span class="op" id="5075992">(</span><span class="op" id="5075993">)</span><span class="op" id="5075994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075998">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076005">return</span>&nbsp;<span class="ident" id="5076012">req</span><span class="op" id="5076015">,</span>&nbsp;<span class="ident" id="5076017">nil</span><br>
<span class="lineno"></span><span class="op" id="5076021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="5076024">//&nbsp;BasicAuth&nbsp;returns&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5076097">//&nbsp;Authorization&nbsp;header,&nbsp;if&nbsp;the&nbsp;request&nbsp;uses&nbsp;HTTP&nbsp;Basic&nbsp;Authentication.</span><br>
<span class="lineno"></span><span class="comment" id="5076169">//&nbsp;See&nbsp;RFC&nbsp;2617,&nbsp;Section&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="5076197">func</span>&nbsp;<span class="op" id="5076202">(</span><span class="ident" id="5076203">r</span>&nbsp;<span class="op" id="5076205">*</span><span class="ident" id="5076206">Request</span><span class="op" id="5076213">)</span>&nbsp;<span class="ident" id="5076215">BasicAuth</span><span class="op" id="5076224">(</span><span class="op" id="5076225">)</span>&nbsp;<span class="op" id="5076227">(</span><span class="ident" id="5076228">username</span><span class="op" id="5076236">,</span>&nbsp;<span class="ident" id="5076238">password</span>&nbsp;<span class="builtintype" id="5076247">string</span><span class="op" id="5076253">,</span>&nbsp;<span class="ident" id="5076255">ok</span>&nbsp;<span class="builtintype" id="5076258">bool</span><span class="op" id="5076262">)</span>&nbsp;<span class="op" id="5076264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076267">auth</span>&nbsp;<span class="op" id="5076272">:=</span>&nbsp;<span class="ident" id="5076275">r</span><span class="op" id="5076276">.</span><span class="ident" id="5076277">Header</span><span class="op" id="5076283">.</span><span class="ident" id="5076284">Get</span><span class="op" id="5076287">(</span><span class="string" id="5076288">&#34;Authorization&#34;</span><span class="op" id="5076303">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076306">if</span>&nbsp;<span class="ident" id="5076309">auth</span>&nbsp;<span class="op" id="5076314">==</span>&nbsp;<span class="string" id="5076317">&#34;&#34;</span>&nbsp;<span class="op" id="5076320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076324">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076335">return</span>&nbsp;<span class="ident" id="5076342">parseBasicAuth</span><span class="op" id="5076356">(</span><span class="ident" id="5076357">auth</span><span class="op" id="5076361">)</span><br>
<span class="lineno"></span><span class="op" id="5076363">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="5076366">//&nbsp;parseBasicAuth&nbsp;parses&nbsp;an&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="5076428">//&nbsp;&#34;Basic&nbsp;QWxhZGRpbjpvcGVuIHNlc2FtZQ==&#34;&nbsp;returns&nbsp;(&#34;Aladdin&#34;,&nbsp;&#34;open&nbsp;sesame&#34;,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="5076510">func</span>&nbsp;<span class="ident" id="5076515">parseBasicAuth</span><span class="op" id="5076529">(</span><span class="ident" id="5076530">auth</span>&nbsp;<span class="builtintype" id="5076535">string</span><span class="op" id="5076541">)</span>&nbsp;<span class="op" id="5076543">(</span><span class="ident" id="5076544">username</span><span class="op" id="5076552">,</span>&nbsp;<span class="ident" id="5076554">password</span>&nbsp;<span class="builtintype" id="5076563">string</span><span class="op" id="5076569">,</span>&nbsp;<span class="ident" id="5076571">ok</span>&nbsp;<span class="builtintype" id="5076574">bool</span><span class="op" id="5076578">)</span>&nbsp;<span class="op" id="5076580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076583">if</span>&nbsp;<span class="op" id="5076586">!</span><span class="ident" id="5076587">strings</span><span class="op" id="5076594">.</span><span class="ident" id="5076595">HasPrefix</span><span class="op" id="5076604">(</span><span class="ident" id="5076605">auth</span><span class="op" id="5076609">,</span>&nbsp;<span class="string" id="5076611">&#34;Basic&nbsp;&#34;</span><span class="op" id="5076619">)</span>&nbsp;<span class="op" id="5076621">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076625">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076636">c</span><span class="op" id="5076637">,</span>&nbsp;<span class="ident" id="5076639">err</span>&nbsp;<span class="op" id="5076643">:=</span>&nbsp;<span class="ident" id="5076646">base64</span><span class="op" id="5076652">.</span><span class="ident" id="5076653">StdEncoding</span><span class="op" id="5076664">.</span><span class="ident" id="5076665">DecodeString</span><span class="op" id="5076677">(</span><span class="ident" id="5076678">strings</span><span class="op" id="5076685">.</span><span class="ident" id="5076686">TrimPrefix</span><span class="op" id="5076696">(</span><span class="ident" id="5076697">auth</span><span class="op" id="5076701">,</span>&nbsp;<span class="string" id="5076703">&#34;Basic&nbsp;&#34;</span><span class="op" id="5076711">)</span><span class="op" id="5076712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076715">if</span>&nbsp;<span class="ident" id="5076718">err</span>&nbsp;<span class="op" id="5076722">!=</span>&nbsp;<span class="ident" id="5076725">nil</span>&nbsp;<span class="op" id="5076729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076733">return</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076744">cs</span>&nbsp;<span class="op" id="5076747">:=</span>&nbsp;<span class="builtintype" id="5076750">string</span><span class="op" id="5076756">(</span><span class="ident" id="5076757">c</span><span class="op" id="5076758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076761">s</span>&nbsp;<span class="op" id="5076763">:=</span>&nbsp;<span class="ident" id="5076766">strings</span><span class="op" id="5076773">.</span><span class="ident" id="5076774">IndexByte</span><span class="op" id="5076783">(</span><span class="ident" id="5076784">cs</span><span class="op" id="5076786">,</span>&nbsp;<span class="string" id="5076788">&#39;:&#39;</span><span class="op" id="5076791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076794">if</span>&nbsp;<span class="ident" id="5076797">s</span>&nbsp;<span class="op" id="5076799">&lt;</span>&nbsp;<span class="num" id="5076801">0</span>&nbsp;<span class="op" id="5076803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076807">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076818">return</span>&nbsp;<span class="ident" id="5076825">cs</span><span class="op" id="5076827">[</span><span class="op" id="5076828">:</span><span class="ident" id="5076829">s</span><span class="op" id="5076830">]</span><span class="op" id="5076831">,</span>&nbsp;<span class="ident" id="5076833">cs</span><span class="op" id="5076835">[</span><span class="ident" id="5076836">s</span><span class="op" id="5076837">+</span><span class="num" id="5076838">1</span><span class="op" id="5076839">:</span><span class="op" id="5076840">]</span><span class="op" id="5076841">,</span>&nbsp;<span class="builtintype" id="5076843">true</span><br>
<span class="lineno"></span><span class="op" id="5076848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5076851">//&nbsp;SetBasicAuth&nbsp;sets&nbsp;the&nbsp;request&#39;s&nbsp;Authorization&nbsp;header&nbsp;to&nbsp;use&nbsp;HTTP</span><br>
<span class="lineno">555</span><span class="comment" id="5076919">//&nbsp;Basic&nbsp;Authentication&nbsp;with&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="5076984">//</span><br>
<span class="lineno"></span><span class="comment" id="5076987">//&nbsp;With&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="5077056">//&nbsp;are&nbsp;not&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="5077078">func</span>&nbsp;<span class="op" id="5077083">(</span><span class="ident" id="5077084">r</span>&nbsp;<span class="op" id="5077086">*</span><span class="ident" id="5077087">Request</span><span class="op" id="5077094">)</span>&nbsp;<span class="ident" id="5077096">SetBasicAuth</span><span class="op" id="5077108">(</span><span class="ident" id="5077109">username</span><span class="op" id="5077117">,</span>&nbsp;<span class="ident" id="5077119">password</span>&nbsp;<span class="builtintype" id="5077128">string</span><span class="op" id="5077134">)</span>&nbsp;<span class="op" id="5077136">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077139">r</span><span class="op" id="5077140">.</span><span class="ident" id="5077141">Header</span><span class="op" id="5077147">.</span><span class="ident" id="5077148">Set</span><span class="op" id="5077151">(</span><span class="string" id="5077152">&#34;Authorization&#34;</span><span class="op" id="5077167">,</span>&nbsp;<span class="string" id="5077169">&#34;Basic&nbsp;&#34;</span><span class="op" id="5077177">+</span><span class="ident" id="5077178">basicAuth</span><span class="op" id="5077187">(</span><span class="ident" id="5077188">username</span><span class="op" id="5077196">,</span>&nbsp;<span class="ident" id="5077198">password</span><span class="op" id="5077206">)</span><span class="op" id="5077207">)</span><br>
<span class="lineno"></span><span class="op" id="5077209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5077212">//&nbsp;parseRequestLine&nbsp;parses&nbsp;&#34;GET&nbsp;/foo&nbsp;HTTP/1.1&#34;&nbsp;into&nbsp;its&nbsp;three&nbsp;parts.</span><br>
<span class="lineno"></span><span class="keyword" id="5077281">func</span>&nbsp;<span class="ident" id="5077286">parseRequestLine</span><span class="op" id="5077302">(</span><span class="ident" id="5077303">line</span>&nbsp;<span class="builtintype" id="5077308">string</span><span class="op" id="5077314">)</span>&nbsp;<span class="op" id="5077316">(</span><span class="ident" id="5077317">method</span><span class="op" id="5077323">,</span>&nbsp;<span class="ident" id="5077325">requestURI</span><span class="op" id="5077335">,</span>&nbsp;<span class="ident" id="5077337">proto</span>&nbsp;<span class="builtintype" id="5077343">string</span><span class="op" id="5077349">,</span>&nbsp;<span class="ident" id="5077351">ok</span>&nbsp;<span class="builtintype" id="5077354">bool</span><span class="op" id="5077358">)</span>&nbsp;<span class="op" id="5077360">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077363">s1</span>&nbsp;<span class="op" id="5077366">:=</span>&nbsp;<span class="ident" id="5077369">strings</span><span class="op" id="5077376">.</span><span class="ident" id="5077377">Index</span><span class="op" id="5077382">(</span><span class="ident" id="5077383">line</span><span class="op" id="5077387">,</span>&nbsp;<span class="string" id="5077389">&#34;&nbsp;&#34;</span><span class="op" id="5077392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077395">s2</span>&nbsp;<span class="op" id="5077398">:=</span>&nbsp;<span class="ident" id="5077401">strings</span><span class="op" id="5077408">.</span><span class="ident" id="5077409">Index</span><span class="op" id="5077414">(</span><span class="ident" id="5077415">line</span><span class="op" id="5077419">[</span><span class="ident" id="5077420">s1</span><span class="op" id="5077422">+</span><span class="num" id="5077423">1</span><span class="op" id="5077424">:</span><span class="op" id="5077425">]</span><span class="op" id="5077426">,</span>&nbsp;<span class="string" id="5077428">&#34;&nbsp;&#34;</span><span class="op" id="5077431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077434">if</span>&nbsp;<span class="ident" id="5077437">s1</span>&nbsp;<span class="op" id="5077440">&lt;</span>&nbsp;<span class="num" id="5077442">0</span>&nbsp;<span class="op" id="5077444">||</span>&nbsp;<span class="ident" id="5077447">s2</span>&nbsp;<span class="op" id="5077450">&lt;</span>&nbsp;<span class="num" id="5077452">0</span>&nbsp;<span class="op" id="5077454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077458">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5077466">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077469">s2</span>&nbsp;<span class="op" id="5077472">+=</span>&nbsp;<span class="ident" id="5077475">s1</span>&nbsp;<span class="op" id="5077478">+</span>&nbsp;<span class="num" id="5077480">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077483">return</span>&nbsp;<span class="ident" id="5077490">line</span><span class="op" id="5077494">[</span><span class="op" id="5077495">:</span><span class="ident" id="5077496">s1</span><span class="op" id="5077498">]</span><span class="op" id="5077499">,</span>&nbsp;<span class="ident" id="5077501">line</span><span class="op" id="5077505">[</span><span class="ident" id="5077506">s1</span><span class="op" id="5077508">+</span><span class="num" id="5077509">1</span>&nbsp;<span class="op" id="5077511">:</span>&nbsp;<span class="ident" id="5077513">s2</span><span class="op" id="5077515">]</span><span class="op" id="5077516">,</span>&nbsp;<span class="ident" id="5077518">line</span><span class="op" id="5077522">[</span><span class="ident" id="5077523">s2</span><span class="op" id="5077525">+</span><span class="num" id="5077526">1</span><span class="op" id="5077527">:</span><span class="op" id="5077528">]</span><span class="op" id="5077529">,</span>&nbsp;<span class="builtintype" id="5077531">true</span><br>
<span class="lineno"></span><span class="op" id="5077536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5077539">var</span>&nbsp;<span class="ident" id="5077543">textprotoReaderPool</span>&nbsp;<span class="ident" id="5077563">sync</span><span class="op" id="5077567">.</span><span class="ident" id="5077568">Pool</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="keyword" id="5077574">func</span>&nbsp;<span class="ident" id="5077579">newTextprotoReader</span><span class="op" id="5077597">(</span><span class="ident" id="5077598">br</span>&nbsp;<span class="op" id="5077601">*</span><span class="ident" id="5077602">bufio</span><span class="op" id="5077607">.</span><span class="ident" id="5077608">Reader</span><span class="op" id="5077614">)</span>&nbsp;<span class="op" id="5077616">*</span><span class="ident" id="5077617">textproto</span><span class="op" id="5077626">.</span><span class="ident" id="5077627">Reader</span>&nbsp;<span class="op" id="5077634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077637">if</span>&nbsp;<span class="ident" id="5077640">v</span>&nbsp;<span class="op" id="5077642">:=</span>&nbsp;<span class="ident" id="5077645">textprotoReaderPool</span><span class="op" id="5077664">.</span><span class="ident" id="5077665">Get</span><span class="op" id="5077668">(</span><span class="op" id="5077669">)</span><span class="op" id="5077670">;</span>&nbsp;<span class="ident" id="5077672">v</span>&nbsp;<span class="op" id="5077674">!=</span>&nbsp;<span class="ident" id="5077677">nil</span>&nbsp;<span class="op" id="5077681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077685">tr</span>&nbsp;<span class="op" id="5077688">:=</span>&nbsp;<span class="ident" id="5077691">v</span><span class="op" id="5077692">.</span><span class="op" id="5077693">(</span><span class="op" id="5077694">*</span><span class="ident" id="5077695">textproto</span><span class="op" id="5077704">.</span><span class="ident" id="5077705">Reader</span><span class="op" id="5077711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077715">tr</span><span class="op" id="5077717">.</span><span class="ident" id="5077718">R</span>&nbsp;<span class="op" id="5077720">=</span>&nbsp;<span class="ident" id="5077722">br</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077727">return</span>&nbsp;<span class="ident" id="5077734">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5077738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077741">return</span>&nbsp;<span class="ident" id="5077748">textproto</span><span class="op" id="5077757">.</span><span class="ident" id="5077758">NewReader</span><span class="op" id="5077767">(</span><span class="ident" id="5077768">br</span><span class="op" id="5077770">)</span><br>
<span class="lineno"></span><span class="op" id="5077772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="5077775">func</span>&nbsp;<span class="ident" id="5077780">putTextprotoReader</span><span class="op" id="5077798">(</span><span class="ident" id="5077799">r</span>&nbsp;<span class="op" id="5077801">*</span><span class="ident" id="5077802">textproto</span><span class="op" id="5077811">.</span><span class="ident" id="5077812">Reader</span><span class="op" id="5077818">)</span>&nbsp;<span class="op" id="5077820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077823">r</span><span class="op" id="5077824">.</span><span class="ident" id="5077825">R</span>&nbsp;<span class="op" id="5077827">=</span>&nbsp;<span class="ident" id="5077829">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077834">textprotoReaderPool</span><span class="op" id="5077853">.</span><span class="ident" id="5077854">Put</span><span class="op" id="5077857">(</span><span class="ident" id="5077858">r</span><span class="op" id="5077859">)</span><br>
<span class="lineno"></span><span class="op" id="5077861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="5077864">//&nbsp;ReadRequest&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;request&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="5077914">func</span>&nbsp;<span class="ident" id="5077919">ReadRequest</span><span class="op" id="5077930">(</span><span class="ident" id="5077931">b</span>&nbsp;<span class="op" id="5077933">*</span><span class="ident" id="5077934">bufio</span><span class="op" id="5077939">.</span><span class="ident" id="5077940">Reader</span><span class="op" id="5077946">)</span>&nbsp;<span class="op" id="5077948">(</span><span class="ident" id="5077949">req</span>&nbsp;<span class="op" id="5077953">*</span><span class="ident" id="5077954">Request</span><span class="op" id="5077961">,</span>&nbsp;<span class="ident" id="5077963">err</span>&nbsp;<span class="builtintype" id="5077967">error</span><span class="op" id="5077972">)</span>&nbsp;<span class="op" id="5077974">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077978">tp</span>&nbsp;<span class="op" id="5077981">:=</span>&nbsp;<span class="ident" id="5077984">newTextprotoReader</span><span class="op" id="5078002">(</span><span class="ident" id="5078003">b</span><span class="op" id="5078004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078007">req</span>&nbsp;<span class="op" id="5078011">=</span>&nbsp;<span class="builtinfunc" id="5078013">new</span><span class="op" id="5078016">(</span><span class="ident" id="5078017">Request</span><span class="op" id="5078024">)</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078028">//&nbsp;First&nbsp;line:&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078069">var</span>&nbsp;<span class="ident" id="5078073">s</span>&nbsp;<span class="builtintype" id="5078075">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078083">if</span>&nbsp;<span class="ident" id="5078086">s</span><span class="op" id="5078087">,</span>&nbsp;<span class="ident" id="5078089">err</span>&nbsp;<span class="op" id="5078093">=</span>&nbsp;<span class="ident" id="5078095">tp</span><span class="op" id="5078097">.</span><span class="ident" id="5078098">ReadLine</span><span class="op" id="5078106">(</span><span class="op" id="5078107">)</span><span class="op" id="5078108">;</span>&nbsp;<span class="ident" id="5078110">err</span>&nbsp;<span class="op" id="5078114">!=</span>&nbsp;<span class="ident" id="5078117">nil</span>&nbsp;<span class="op" id="5078121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078125">return</span>&nbsp;<span class="ident" id="5078132">nil</span><span class="op" id="5078135">,</span>&nbsp;<span class="ident" id="5078137">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078145">defer</span>&nbsp;<span class="keyword" id="5078151">func</span><span class="op" id="5078155">(</span><span class="op" id="5078156">)</span>&nbsp;<span class="op" id="5078158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078162">putTextprotoReader</span><span class="op" id="5078180">(</span><span class="ident" id="5078181">tp</span><span class="op" id="5078183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078187">if</span>&nbsp;<span class="ident" id="5078190">err</span>&nbsp;<span class="op" id="5078194">==</span>&nbsp;<span class="ident" id="5078197">io</span><span class="op" id="5078199">.</span><span class="ident" id="5078200">EOF</span>&nbsp;<span class="op" id="5078204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078209">err</span>&nbsp;<span class="op" id="5078213">=</span>&nbsp;<span class="ident" id="5078215">io</span><span class="op" id="5078217">.</span><span class="ident" id="5078218">ErrUnexpectedEOF</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078240">}</span><span class="op" id="5078241">(</span><span class="op" id="5078242">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078246">var</span>&nbsp;<span class="ident" id="5078250">ok</span>&nbsp;<span class="builtintype" id="5078253">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078259">req</span><span class="op" id="5078262">.</span><span class="ident" id="5078263">Method</span><span class="op" id="5078269">,</span>&nbsp;<span class="ident" id="5078271">req</span><span class="op" id="5078274">.</span><span class="ident" id="5078275">RequestURI</span><span class="op" id="5078285">,</span>&nbsp;<span class="ident" id="5078287">req</span><span class="op" id="5078290">.</span><span class="ident" id="5078291">Proto</span><span class="op" id="5078296">,</span>&nbsp;<span class="ident" id="5078298">ok</span>&nbsp;<span class="op" id="5078301">=</span>&nbsp;<span class="ident" id="5078303">parseRequestLine</span><span class="op" id="5078319">(</span><span class="ident" id="5078320">s</span><span class="op" id="5078321">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078324">if</span>&nbsp;<span class="op" id="5078327">!</span><span class="ident" id="5078328">ok</span>&nbsp;<span class="op" id="5078331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078335">return</span>&nbsp;<span class="ident" id="5078342">nil</span><span class="op" id="5078345">,</span>&nbsp;<span class="op" id="5078347">&amp;</span><span class="ident" id="5078348">badStringError</span><span class="op" id="5078362">{</span><span class="string" id="5078363">&#34;malformed&nbsp;HTTP&nbsp;request&#34;</span><span class="op" id="5078387">,</span>&nbsp;<span class="ident" id="5078389">s</span><span class="op" id="5078390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078396">rawurl</span>&nbsp;<span class="op" id="5078403">:=</span>&nbsp;<span class="ident" id="5078406">req</span><span class="op" id="5078409">.</span><span class="ident" id="5078410">RequestURI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078422">if</span>&nbsp;<span class="ident" id="5078425">req</span><span class="op" id="5078428">.</span><span class="ident" id="5078429">ProtoMajor</span><span class="op" id="5078439">,</span>&nbsp;<span class="ident" id="5078441">req</span><span class="op" id="5078444">.</span><span class="ident" id="5078445">ProtoMinor</span><span class="op" id="5078455">,</span>&nbsp;<span class="ident" id="5078457">ok</span>&nbsp;<span class="op" id="5078460">=</span>&nbsp;<span class="ident" id="5078462">ParseHTTPVersion</span><span class="op" id="5078478">(</span><span class="ident" id="5078479">req</span><span class="op" id="5078482">.</span><span class="ident" id="5078483">Proto</span><span class="op" id="5078488">)</span><span class="op" id="5078489">;</span>&nbsp;<span class="op" id="5078491">!</span><span class="ident" id="5078492">ok</span>&nbsp;<span class="op" id="5078495">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078499">return</span>&nbsp;<span class="ident" id="5078506">nil</span><span class="op" id="5078509">,</span>&nbsp;<span class="op" id="5078511">&amp;</span><span class="ident" id="5078512">badStringError</span><span class="op" id="5078526">{</span><span class="string" id="5078527">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="5078551">,</span>&nbsp;<span class="ident" id="5078553">req</span><span class="op" id="5078556">.</span><span class="ident" id="5078557">Proto</span><span class="op" id="5078562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078569">//&nbsp;CONNECT&nbsp;requests&nbsp;are&nbsp;used&nbsp;two&nbsp;different&nbsp;ways,&nbsp;and&nbsp;neither&nbsp;uses&nbsp;a&nbsp;full&nbsp;URL:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078648">//&nbsp;The&nbsp;standard&nbsp;use&nbsp;is&nbsp;to&nbsp;tunnel&nbsp;HTTPS&nbsp;through&nbsp;an&nbsp;HTTP&nbsp;proxy.</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078711">//&nbsp;It&nbsp;looks&nbsp;like&nbsp;&#34;CONNECT&nbsp;www.google.com:443&nbsp;HTTP/1.1&#34;,&nbsp;and&nbsp;the&nbsp;parameter&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078789">//&nbsp;just&nbsp;the&nbsp;authority&nbsp;section&nbsp;of&nbsp;a&nbsp;URL.&nbsp;This&nbsp;information&nbsp;should&nbsp;go&nbsp;in&nbsp;req.URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078874">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078878">//&nbsp;The&nbsp;net/rpc&nbsp;package&nbsp;also&nbsp;uses&nbsp;CONNECT,&nbsp;but&nbsp;there&nbsp;the&nbsp;parameter&nbsp;is&nbsp;a&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078955">//&nbsp;that&nbsp;starts&nbsp;with&nbsp;a&nbsp;slash.&nbsp;It&nbsp;can&nbsp;be&nbsp;parsed&nbsp;with&nbsp;the&nbsp;regular&nbsp;URL&nbsp;parser,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079031">//&nbsp;and&nbsp;the&nbsp;path&nbsp;will&nbsp;end&nbsp;up&nbsp;in&nbsp;req.URL.Path,&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;order&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079111">//&nbsp;RPC&nbsp;to&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079128">justAuthority</span>&nbsp;<span class="op" id="5079142">:=</span>&nbsp;<span class="ident" id="5079145">req</span><span class="op" id="5079148">.</span><span class="ident" id="5079149">Method</span>&nbsp;<span class="op" id="5079156">==</span>&nbsp;<span class="string" id="5079159">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="5079169">&amp;&amp;</span>&nbsp;<span class="op" id="5079172">!</span><span class="ident" id="5079173">strings</span><span class="op" id="5079180">.</span><span class="ident" id="5079181">HasPrefix</span><span class="op" id="5079190">(</span><span class="ident" id="5079191">rawurl</span><span class="op" id="5079197">,</span>&nbsp;<span class="string" id="5079199">&#34;/&#34;</span><span class="op" id="5079202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079205">if</span>&nbsp;<span class="ident" id="5079208">justAuthority</span>&nbsp;<span class="op" id="5079222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079226">rawurl</span>&nbsp;<span class="op" id="5079233">=</span>&nbsp;<span class="string" id="5079235">&#34;http://&#34;</span>&nbsp;<span class="op" id="5079245">+</span>&nbsp;<span class="ident" id="5079247">rawurl</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079259">if</span>&nbsp;<span class="ident" id="5079262">req</span><span class="op" id="5079265">.</span><span class="ident" id="5079266">URL</span><span class="op" id="5079269">,</span>&nbsp;<span class="ident" id="5079271">err</span>&nbsp;<span class="op" id="5079275">=</span>&nbsp;<span class="ident" id="5079277">url</span><span class="op" id="5079280">.</span><span class="ident" id="5079281">ParseRequestURI</span><span class="op" id="5079296">(</span><span class="ident" id="5079297">rawurl</span><span class="op" id="5079303">)</span><span class="op" id="5079304">;</span>&nbsp;<span class="ident" id="5079306">err</span>&nbsp;<span class="op" id="5079310">!=</span>&nbsp;<span class="ident" id="5079313">nil</span>&nbsp;<span class="op" id="5079317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079321">return</span>&nbsp;<span class="ident" id="5079328">nil</span><span class="op" id="5079331">,</span>&nbsp;<span class="ident" id="5079333">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079338">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079342">if</span>&nbsp;<span class="ident" id="5079345">justAuthority</span>&nbsp;<span class="op" id="5079359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079363">//&nbsp;Strip&nbsp;the&nbsp;bogus&nbsp;&#34;http://&#34;&nbsp;back&nbsp;off.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079404">req</span><span class="op" id="5079407">.</span><span class="ident" id="5079408">URL</span><span class="op" id="5079411">.</span><span class="ident" id="5079412">Scheme</span>&nbsp;<span class="op" id="5079419">=</span>&nbsp;<span class="string" id="5079421">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079425">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079429">//&nbsp;Subsequent&nbsp;lines:&nbsp;Key:&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079463">mimeHeader</span><span class="op" id="5079473">,</span>&nbsp;<span class="ident" id="5079475">err</span>&nbsp;<span class="op" id="5079479">:=</span>&nbsp;<span class="ident" id="5079482">tp</span><span class="op" id="5079484">.</span><span class="ident" id="5079485">ReadMIMEHeader</span><span class="op" id="5079499">(</span><span class="op" id="5079500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079503">if</span>&nbsp;<span class="ident" id="5079506">err</span>&nbsp;<span class="op" id="5079510">!=</span>&nbsp;<span class="ident" id="5079513">nil</span>&nbsp;<span class="op" id="5079517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079521">return</span>&nbsp;<span class="ident" id="5079528">nil</span><span class="op" id="5079531">,</span>&nbsp;<span class="ident" id="5079533">err</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079541">req</span><span class="op" id="5079544">.</span><span class="ident" id="5079545">Header</span>&nbsp;<span class="op" id="5079552">=</span>&nbsp;<span class="ident" id="5079554">Header</span><span class="op" id="5079560">(</span><span class="ident" id="5079561">mimeHeader</span><span class="op" id="5079571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079575">//&nbsp;RFC2616:&nbsp;Must&nbsp;treat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079599">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079628">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;www.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079653">//&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079661">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;http://www.google.com/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079711">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;doesntmatter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079734">//&nbsp;the&nbsp;same.&nbsp;&nbsp;In&nbsp;the&nbsp;second&nbsp;case,&nbsp;any&nbsp;Host&nbsp;line&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079795">req</span><span class="op" id="5079798">.</span><span class="ident" id="5079799">Host</span>&nbsp;<span class="op" id="5079804">=</span>&nbsp;<span class="ident" id="5079806">req</span><span class="op" id="5079809">.</span><span class="ident" id="5079810">URL</span><span class="op" id="5079813">.</span><span class="ident" id="5079814">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079820">if</span>&nbsp;<span class="ident" id="5079823">req</span><span class="op" id="5079826">.</span><span class="ident" id="5079827">Host</span>&nbsp;<span class="op" id="5079832">==</span>&nbsp;<span class="string" id="5079835">&#34;&#34;</span>&nbsp;<span class="op" id="5079838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079842">req</span><span class="op" id="5079845">.</span><span class="ident" id="5079846">Host</span>&nbsp;<span class="op" id="5079851">=</span>&nbsp;<span class="ident" id="5079853">req</span><span class="op" id="5079856">.</span><span class="ident" id="5079857">Header</span><span class="op" id="5079863">.</span><span class="ident" id="5079864">get</span><span class="op" id="5079867">(</span><span class="string" id="5079868">&#34;Host&#34;</span><span class="op" id="5079874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5079880">delete</span><span class="op" id="5079886">(</span><span class="ident" id="5079887">req</span><span class="op" id="5079890">.</span><span class="ident" id="5079891">Header</span><span class="op" id="5079897">,</span>&nbsp;<span class="string" id="5079899">&#34;Host&#34;</span><span class="op" id="5079905">)</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079909">fixPragmaCacheControl</span><span class="op" id="5079930">(</span><span class="ident" id="5079931">req</span><span class="op" id="5079934">.</span><span class="ident" id="5079935">Header</span><span class="op" id="5079941">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079945">err</span>&nbsp;<span class="op" id="5079949">=</span>&nbsp;<span class="ident" id="5079951">readTransfer</span><span class="op" id="5079963">(</span><span class="ident" id="5079964">req</span><span class="op" id="5079967">,</span>&nbsp;<span class="ident" id="5079969">b</span><span class="op" id="5079970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079973">if</span>&nbsp;<span class="ident" id="5079976">err</span>&nbsp;<span class="op" id="5079980">!=</span>&nbsp;<span class="ident" id="5079983">nil</span>&nbsp;<span class="op" id="5079987">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079991">return</span>&nbsp;<span class="ident" id="5079998">nil</span><span class="op" id="5080001">,</span>&nbsp;<span class="ident" id="5080003">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080012">req</span><span class="op" id="5080015">.</span><span class="ident" id="5080016">Close</span>&nbsp;<span class="op" id="5080022">=</span>&nbsp;<span class="ident" id="5080024">shouldClose</span><span class="op" id="5080035">(</span><span class="ident" id="5080036">req</span><span class="op" id="5080039">.</span><span class="ident" id="5080040">ProtoMajor</span><span class="op" id="5080050">,</span>&nbsp;<span class="ident" id="5080052">req</span><span class="op" id="5080055">.</span><span class="ident" id="5080056">ProtoMinor</span><span class="op" id="5080066">,</span>&nbsp;<span class="ident" id="5080068">req</span><span class="op" id="5080071">.</span><span class="ident" id="5080072">Header</span><span class="op" id="5080078">,</span>&nbsp;<span class="builtintype" id="5080080">false</span><span class="op" id="5080085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080088">return</span>&nbsp;<span class="ident" id="5080095">req</span><span class="op" id="5080098">,</span>&nbsp;<span class="ident" id="5080100">nil</span><br>
<span class="lineno">670</span><span class="op" id="5080104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5080107">//&nbsp;MaxBytesReader&nbsp;is&nbsp;similar&nbsp;to&nbsp;io.LimitReader&nbsp;but&nbsp;is&nbsp;intended&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5080174">//&nbsp;limiting&nbsp;the&nbsp;size&nbsp;of&nbsp;incoming&nbsp;request&nbsp;bodies.&nbsp;In&nbsp;contrast&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5080238">//&nbsp;io.LimitReader,&nbsp;MaxBytesReader&#39;s&nbsp;result&nbsp;is&nbsp;a&nbsp;ReadCloser,&nbsp;returns&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="5080308">//&nbsp;non-EOF&nbsp;error&nbsp;for&nbsp;a&nbsp;Read&nbsp;beyond&nbsp;the&nbsp;limit,&nbsp;and&nbsp;Closes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5080369">//&nbsp;underlying&nbsp;reader&nbsp;when&nbsp;its&nbsp;Close&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="comment" id="5080423">//</span><br>
<span class="lineno"></span><span class="comment" id="5080426">//&nbsp;MaxBytesReader&nbsp;prevents&nbsp;clients&nbsp;from&nbsp;accidentally&nbsp;or&nbsp;maliciously</span><br>
<span class="lineno"></span><span class="comment" id="5080494">//&nbsp;sending&nbsp;a&nbsp;large&nbsp;request&nbsp;and&nbsp;wasting&nbsp;server&nbsp;resources.</span><br>
<span class="lineno">680</span><span class="keyword" id="5080551">func</span>&nbsp;<span class="ident" id="5080556">MaxBytesReader</span><span class="op" id="5080570">(</span><span class="ident" id="5080571">w</span>&nbsp;<span class="ident" id="5080573">ResponseWriter</span><span class="op" id="5080587">,</span>&nbsp;<span class="ident" id="5080589">r</span>&nbsp;<span class="ident" id="5080591">io</span><span class="op" id="5080593">.</span><span class="ident" id="5080594">ReadCloser</span><span class="op" id="5080604">,</span>&nbsp;<span class="ident" id="5080606">n</span>&nbsp;<span class="ident" id="5080608">int64</span><span class="op" id="5080613">)</span>&nbsp;<span class="ident" id="5080615">io</span><span class="op" id="5080617">.</span><span class="ident" id="5080618">ReadCloser</span>&nbsp;<span class="op" id="5080629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080632">return</span>&nbsp;<span class="op" id="5080639">&amp;</span><span class="ident" id="5080640">maxBytesReader</span><span class="op" id="5080654">{</span><span class="ident" id="5080655">w</span><span class="op" id="5080656">:</span>&nbsp;<span class="ident" id="5080658">w</span><span class="op" id="5080659">,</span>&nbsp;<span class="ident" id="5080661">r</span><span class="op" id="5080662">:</span>&nbsp;<span class="ident" id="5080664">r</span><span class="op" id="5080665">,</span>&nbsp;<span class="ident" id="5080667">n</span><span class="op" id="5080668">:</span>&nbsp;<span class="ident" id="5080670">n</span><span class="op" id="5080671">}</span><br>
<span class="lineno"></span><span class="op" id="5080673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5080676">type</span>&nbsp;<span class="ident" id="5080681">maxBytesReader</span>&nbsp;<span class="keyword" id="5080696">struct</span>&nbsp;<span class="op" id="5080703">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080706">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5080714">ResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080730">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5080738">io</span><span class="op" id="5080740">.</span><span class="ident" id="5080741">ReadCloser</span>&nbsp;<span class="comment" id="5080752">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080774">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5080782">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5080796">//&nbsp;max&nbsp;bytes&nbsp;remaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080820">stopped</span>&nbsp;<span class="builtintype" id="5080828">bool</span><br>
<span class="lineno"></span><span class="op" id="5080833">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="5080836">func</span>&nbsp;<span class="op" id="5080841">(</span><span class="ident" id="5080842">l</span>&nbsp;<span class="op" id="5080844">*</span><span class="ident" id="5080845">maxBytesReader</span><span class="op" id="5080859">)</span>&nbsp;<span class="ident" id="5080861">Read</span><span class="op" id="5080865">(</span><span class="ident" id="5080866">p</span>&nbsp;<span class="op" id="5080868">[</span><span class="op" id="5080869">]</span><span class="builtintype" id="5080870">byte</span><span class="op" id="5080874">)</span>&nbsp;<span class="op" id="5080876">(</span><span class="ident" id="5080877">n</span>&nbsp;<span class="builtintype" id="5080879">int</span><span class="op" id="5080882">,</span>&nbsp;<span class="ident" id="5080884">err</span>&nbsp;<span class="builtintype" id="5080888">error</span><span class="op" id="5080893">)</span>&nbsp;<span class="op" id="5080895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080898">if</span>&nbsp;<span class="ident" id="5080901">l</span><span class="op" id="5080902">.</span><span class="ident" id="5080903">n</span>&nbsp;<span class="op" id="5080905">&lt;=</span>&nbsp;<span class="num" id="5080908">0</span>&nbsp;<span class="op" id="5080910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080914">if</span>&nbsp;<span class="op" id="5080917">!</span><span class="ident" id="5080918">l</span><span class="op" id="5080919">.</span><span class="ident" id="5080920">stopped</span>&nbsp;<span class="op" id="5080928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080933">l</span><span class="op" id="5080934">.</span><span class="ident" id="5080935">stopped</span>&nbsp;<span class="op" id="5080943">=</span>&nbsp;<span class="builtintype" id="5080945">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080953">if</span>&nbsp;<span class="ident" id="5080956">res</span><span class="op" id="5080959">,</span>&nbsp;<span class="ident" id="5080961">ok</span>&nbsp;<span class="op" id="5080964">:=</span>&nbsp;<span class="ident" id="5080967">l</span><span class="op" id="5080968">.</span><span class="ident" id="5080969">w</span><span class="op" id="5080970">.</span><span class="op" id="5080971">(</span><span class="op" id="5080972">*</span><span class="ident" id="5080973">response</span><span class="op" id="5080981">)</span><span class="op" id="5080982">;</span>&nbsp;<span class="ident" id="5080984">ok</span>&nbsp;<span class="op" id="5080987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080993">res</span><span class="op" id="5080996">.</span><span class="ident" id="5080997">requestTooLarge</span><span class="op" id="5081012">(</span><span class="op" id="5081013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5081018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5081022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081026">return</span>&nbsp;<span class="num" id="5081033">0</span><span class="op" id="5081034">,</span>&nbsp;<span class="ident" id="5081036">errors</span><span class="op" id="5081042">.</span><span class="ident" id="5081043">New</span><span class="op" id="5081046">(</span><span class="string" id="5081047">&#34;http:&nbsp;request&nbsp;body&nbsp;too&nbsp;large&#34;</span><span class="op" id="5081077">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5081080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081083">if</span>&nbsp;<span class="ident" id="5081086">int64</span><span class="op" id="5081091">(</span><span class="builtinfunc" id="5081092">len</span><span class="op" id="5081095">(</span><span class="ident" id="5081096">p</span><span class="op" id="5081097">)</span><span class="op" id="5081098">)</span>&nbsp;<span class="op" id="5081100">&gt;</span>&nbsp;<span class="ident" id="5081102">l</span><span class="op" id="5081103">.</span><span class="ident" id="5081104">n</span>&nbsp;<span class="op" id="5081106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5081110">p</span>&nbsp;<span class="op" id="5081112">=</span>&nbsp;<span class="ident" id="5081114">p</span><span class="op" id="5081115">[</span><span class="op" id="5081116">:</span><span class="ident" id="5081117">l</span><span class="op" id="5081118">.</span><span class="ident" id="5081119">n</span><span class="op" id="5081120">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5081123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5081126">n</span><span class="op" id="5081127">,</span>&nbsp;<span class="ident" id="5081129">err</span>&nbsp;<span class="op" id="5081133">=</span>&nbsp;<span class="ident" id="5081135">l</span><span class="op" id="5081136">.</span><span class="ident" id="5081137">r</span><span class="op" id="5081138">.</span><span class="ident" id="5081139">Read</span><span class="op" id="5081143">(</span><span class="ident" id="5081144">p</span><span class="op" id="5081145">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5081148">l</span><span class="op" id="5081149">.</span><span class="ident" id="5081150">n</span>&nbsp;<span class="op" id="5081152">-=</span>&nbsp;<span class="ident" id="5081155">int64</span><span class="op" id="5081160">(</span><span class="ident" id="5081161">n</span><span class="op" id="5081162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081165">return</span><br>
<span class="lineno"></span><span class="op" id="5081172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5081175">func</span>&nbsp;<span class="op" id="5081180">(</span><span class="ident" id="5081181">l</span>&nbsp;<span class="op" id="5081183">*</span><span class="ident" id="5081184">maxBytesReader</span><span class="op" id="5081198">)</span>&nbsp;<span class="ident" id="5081200">Close</span><span class="op" id="5081205">(</span><span class="op" id="5081206">)</span>&nbsp;<span class="builtintype" id="5081208">error</span>&nbsp;<span class="op" id="5081214">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081217">return</span>&nbsp;<span class="ident" id="5081224">l</span><span class="op" id="5081225">.</span><span class="ident" id="5081226">r</span><span class="op" id="5081227">.</span><span class="ident" id="5081228">Close</span><span class="op" id="5081233">(</span><span class="op" id="5081234">)</span><br>
<span class="lineno"></span><span class="op" id="5081236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5081239">func</span>&nbsp;<span class="ident" id="5081244">copyValues</span><span class="op" id="5081254">(</span><span class="ident" id="5081255">dst</span><span class="op" id="5081258">,</span>&nbsp;<span class="ident" id="5081260">src</span>&nbsp;<span class="ident" id="5081264">url</span><span class="op" id="5081267">.</span><span class="ident" id="5081268">Values</span><span class="op" id="5081274">)</span>&nbsp;<span class="op" id="5081276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081279">for</span>&nbsp;<span class="ident" id="5081283">k</span><span class="op" id="5081284">,</span>&nbsp;<span class="ident" id="5081286">vs</span>&nbsp;<span class="op" id="5081289">:=</span>&nbsp;<span class="keyword" id="5081292">range</span>&nbsp;<span class="ident" id="5081298">src</span>&nbsp;<span class="op" id="5081302">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081306">for</span>&nbsp;<span class="ident" id="5081310">_</span><span class="op" id="5081311">,</span>&nbsp;<span class="ident" id="5081313">value</span>&nbsp;<span class="op" id="5081319">:=</span>&nbsp;<span class="keyword" id="5081322">range</span>&nbsp;<span class="ident" id="5081328">vs</span>&nbsp;<span class="op" id="5081331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5081336">dst</span><span class="op" id="5081339">.</span><span class="ident" id="5081340">Add</span><span class="op" id="5081343">(</span><span class="ident" id="5081344">k</span><span class="op" id="5081345">,</span>&nbsp;<span class="ident" id="5081347">value</span><span class="op" id="5081352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5081356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5081359">}</span><br>
<span class="lineno"></span><span class="op" id="5081361">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="keyword" id="5081364">func</span>&nbsp;<span class="ident" id="5081369">parsePostForm</span><span class="op" id="5081382">(</span><span class="ident" id="5081383">r</span>&nbsp;<span class="op" id="5081385">*</span><span class="ident" id="5081386">Request</span><span class="op" id="5081393">)</span>&nbsp;<span class="op" id="5081395">(</span><span class="ident" id="5081396">vs</span>&nbsp;<span class="ident" id="5081399">url</span><span class="op" id="5081402">.</span><span class="ident" id="5081403">Values</span><span class="op" id="5081409">,</span>&nbsp;<span class="ident" id="5081411">err</span>&nbsp;<span class="builtintype" id="5081415">error</span><span class="op" id="5081420">)</span>&nbsp;<span class="op" id="5081422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081425">if</span>&nbsp;<span class="ident" id="5081428">r</span><span class="op" id="5081429">.</span><span class="ident" id="5081430">Body</span>&nbsp;<span class="op" id="5081435">==</span>&nbsp;<span class="ident" id="5081438">nil</span>&nbsp;<span class="op" id="5081442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5081446">err</span>&nbsp;<span class="op" id="5081450">=</span>&nbsp;<span class="ident" id="5081452">errors</span><span class="op" id="5081458">.</span><span class="ident" id="5081459">New</span><span class="op" id="5081462">(</span><span class="string" id="5081463">&#34;missing&nbsp;form&nbsp;body&#34;</span><span class="op" id="5081482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081486">return</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5081494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5081497">ct</span>&nbsp;<span class="op" id="5081500">:=</span>&nbsp;<span class="ident" id="5081503">r</span><span class="op" id="5081504">.</span><span class="ident" id="5081505">Header</span><span class="op" id="5081511">.</span><span class="ident" id="5081512">Get</span><span class="op" id="5081515">(</span><span class="string" id="5081516">&#34;Content-Type&#34;</span><span class="op" id="5081530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5081533">//&nbsp;RFC&nbsp;2616,&nbsp;section&nbsp;7.2.1&nbsp;-&nbsp;empty&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5081574">//&nbsp;&nbsp;&nbsp;SHOULD&nbsp;be&nbsp;treated&nbsp;as&nbsp;application/octet-stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081626">if</span>&nbsp;<span class="ident" id="5081629">ct</span>&nbsp;<span class="op" id="5081632">==</span>&nbsp;<span class="string" id="5081635">&#34;&#34;</span>&nbsp;<span class="op" id="5081638">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5081642">ct</span>&nbsp;<span class="op" id="5081645">=</span>&nbsp;<span class="string" id="5081647">&#34;application/octet-stream&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5081675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5081678">ct</span><span class="op" id="5081680">,</span>&nbsp;<span class="ident" id="5081682">_</span><span class="op" id="5081683">,</span>&nbsp;<span class="ident" id="5081685">err</span>&nbsp;<span class="op" id="5081689">=</span>&nbsp;<span class="ident" id="5081691">mime</span><span class="op" id="5081695">.</span><span class="ident" id="5081696">ParseMediaType</span><span class="op" id="5081710">(</span><span class="ident" id="5081711">ct</span><span class="op" id="5081713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081716">switch</span>&nbsp;<span class="op" id="5081723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081726">case</span>&nbsp;<span class="ident" id="5081731">ct</span>&nbsp;<span class="op" id="5081734">==</span>&nbsp;<span class="string" id="5081737">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="5081772">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081776">var</span>&nbsp;<span class="ident" id="5081780">reader</span>&nbsp;<span class="ident" id="5081787">io</span><span class="op" id="5081789">.</span><span class="ident" id="5081790">Reader</span>&nbsp;<span class="op" id="5081797">=</span>&nbsp;<span class="ident" id="5081799">r</span><span class="op" id="5081800">.</span><span class="ident" id="5081801">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5081808">maxFormSize</span>&nbsp;<span class="op" id="5081820">:=</span>&nbsp;<span class="ident" id="5081823">int64</span><span class="op" id="5081828">(</span><span class="num" id="5081829">1</span><span class="op" id="5081830">&lt;&lt;</span><span class="num" id="5081832">63</span>&nbsp;<span class="op" id="5081835">-</span>&nbsp;<span class="num" id="5081837">1</span><span class="op" id="5081838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081842">if</span>&nbsp;<span class="ident" id="5081845">_</span><span class="op" id="5081846">,</span>&nbsp;<span class="ident" id="5081848">ok</span>&nbsp;<span class="op" id="5081851">:=</span>&nbsp;<span class="ident" id="5081854">r</span><span class="op" id="5081855">.</span><span class="ident" id="5081856">Body</span><span class="op" id="5081860">.</span><span class="op" id="5081861">(</span><span class="op" id="5081862">*</span><span class="ident" id="5081863">maxBytesReader</span><span class="op" id="5081877">)</span><span class="op" id="5081878">;</span>&nbsp;<span class="op" id="5081880">!</span><span class="ident" id="5081881">ok</span>&nbsp;<span class="op" id="5081884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5081889">maxFormSize</span>&nbsp;<span class="op" id="5081901">=</span>&nbsp;<span class="ident" id="5081903">int64</span><span class="op" id="5081908">(</span><span class="num" id="5081909">10</span>&nbsp;<span class="op" id="5081912">&lt;&lt;</span>&nbsp;<span class="num" id="5081915">20</span><span class="op" id="5081917">)</span>&nbsp;<span class="comment" id="5081919">//&nbsp;10&nbsp;MB&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5081949">reader</span>&nbsp;<span class="op" id="5081956">=</span>&nbsp;<span class="ident" id="5081958">io</span><span class="op" id="5081960">.</span><span class="ident" id="5081961">LimitReader</span><span class="op" id="5081972">(</span><span class="ident" id="5081973">r</span><span class="op" id="5081974">.</span><span class="ident" id="5081975">Body</span><span class="op" id="5081979">,</span>&nbsp;<span class="ident" id="5081981">maxFormSize</span><span class="op" id="5081992">+</span><span class="num" id="5081993">1</span><span class="op" id="5081994">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5081998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082002">b</span><span class="op" id="5082003">,</span>&nbsp;<span class="ident" id="5082005">e</span>&nbsp;<span class="op" id="5082007">:=</span>&nbsp;<span class="ident" id="5082010">ioutil</span><span class="op" id="5082016">.</span><span class="ident" id="5082017">ReadAll</span><span class="op" id="5082024">(</span><span class="ident" id="5082025">reader</span><span class="op" id="5082031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082035">if</span>&nbsp;<span class="ident" id="5082038">e</span>&nbsp;<span class="op" id="5082040">!=</span>&nbsp;<span class="ident" id="5082043">nil</span>&nbsp;<span class="op" id="5082047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082052">if</span>&nbsp;<span class="ident" id="5082055">err</span>&nbsp;<span class="op" id="5082059">==</span>&nbsp;<span class="ident" id="5082062">nil</span>&nbsp;<span class="op" id="5082066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082072">err</span>&nbsp;<span class="op" id="5082076">=</span>&nbsp;<span class="ident" id="5082078">e</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5082083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082088">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5082096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082100">if</span>&nbsp;<span class="ident" id="5082103">int64</span><span class="op" id="5082108">(</span><span class="builtinfunc" id="5082109">len</span><span class="op" id="5082112">(</span><span class="ident" id="5082113">b</span><span class="op" id="5082114">)</span><span class="op" id="5082115">)</span>&nbsp;<span class="op" id="5082117">&gt;</span>&nbsp;<span class="ident" id="5082119">maxFormSize</span>&nbsp;<span class="op" id="5082131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082136">err</span>&nbsp;<span class="op" id="5082140">=</span>&nbsp;<span class="ident" id="5082142">errors</span><span class="op" id="5082148">.</span><span class="ident" id="5082149">New</span><span class="op" id="5082152">(</span><span class="string" id="5082153">&#34;http:&nbsp;POST&nbsp;too&nbsp;large&#34;</span><span class="op" id="5082175">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082180">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5082189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082193">vs</span><span class="op" id="5082195">,</span>&nbsp;<span class="ident" id="5082197">e</span>&nbsp;<span class="op" id="5082199">=</span>&nbsp;<span class="ident" id="5082201">url</span><span class="op" id="5082204">.</span><span class="ident" id="5082205">ParseQuery</span><span class="op" id="5082215">(</span><span class="builtintype" id="5082216">string</span><span class="op" id="5082222">(</span><span class="ident" id="5082223">b</span><span class="op" id="5082224">)</span><span class="op" id="5082225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082229">if</span>&nbsp;<span class="ident" id="5082232">err</span>&nbsp;<span class="op" id="5082236">==</span>&nbsp;<span class="ident" id="5082239">nil</span>&nbsp;<span class="op" id="5082243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082248">err</span>&nbsp;<span class="op" id="5082252">=</span>&nbsp;<span class="ident" id="5082254">e</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5082258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082261">case</span>&nbsp;<span class="ident" id="5082266">ct</span>&nbsp;<span class="op" id="5082269">==</span>&nbsp;<span class="string" id="5082272">&#34;multipart/form-data&#34;</span><span class="op" id="5082293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5082297">//&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&nbsp;(which&nbsp;is&nbsp;calling&nbsp;us,&nbsp;or&nbsp;should&nbsp;be)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5082368">//&nbsp;TODO(bradfitz):&nbsp;there&nbsp;are&nbsp;too&nbsp;many&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5082417">//&nbsp;orders&nbsp;to&nbsp;call&nbsp;too&nbsp;many&nbsp;functions&nbsp;here.</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5082462">//&nbsp;Clean&nbsp;this&nbsp;up&nbsp;and&nbsp;write&nbsp;more&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5082503">//&nbsp;request_test.go&nbsp;contains&nbsp;the&nbsp;start&nbsp;of&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5082552">//&nbsp;in&nbsp;TestParseMultipartFormOrder&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5082599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082602">return</span><br>
<span class="lineno">765</span><span class="op" id="5082609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5082612">//&nbsp;ParseForm&nbsp;parses&nbsp;the&nbsp;raw&nbsp;query&nbsp;from&nbsp;the&nbsp;URL&nbsp;and&nbsp;updates&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="5082679">//</span><br>
<span class="lineno"></span><span class="comment" id="5082682">//&nbsp;For&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;requests,&nbsp;it&nbsp;also&nbsp;parses&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;form&nbsp;and</span><br>
<span class="lineno">770</span><span class="comment" id="5082757">//&nbsp;put&nbsp;the&nbsp;results&nbsp;into&nbsp;both&nbsp;r.PostForm&nbsp;and&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="5082809">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="5082886">//&nbsp;in&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="5082900">//</span><br>
<span class="lineno"></span><span class="comment" id="5082903">//&nbsp;If&nbsp;the&nbsp;request&nbsp;Body&#39;s&nbsp;size&nbsp;has&nbsp;not&nbsp;already&nbsp;been&nbsp;limited&nbsp;by&nbsp;MaxBytesReader,</span><br>
<span class="lineno">775</span><span class="comment" id="5082981">//&nbsp;the&nbsp;size&nbsp;is&nbsp;capped&nbsp;at&nbsp;10MB.</span><br>
<span class="lineno"></span><span class="comment" id="5083012">//</span><br>
<span class="lineno"></span><span class="comment" id="5083015">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="comment" id="5083068">//&nbsp;It&nbsp;is&nbsp;idempotent.</span><br>
<span class="lineno"></span><span class="keyword" id="5083089">func</span>&nbsp;<span class="op" id="5083094">(</span><span class="ident" id="5083095">r</span>&nbsp;<span class="op" id="5083097">*</span><span class="ident" id="5083098">Request</span><span class="op" id="5083105">)</span>&nbsp;<span class="ident" id="5083107">ParseForm</span><span class="op" id="5083116">(</span><span class="op" id="5083117">)</span>&nbsp;<span class="builtintype" id="5083119">error</span>&nbsp;<span class="op" id="5083125">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083128">var</span>&nbsp;<span class="ident" id="5083132">err</span>&nbsp;<span class="builtintype" id="5083136">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083143">if</span>&nbsp;<span class="ident" id="5083146">r</span><span class="op" id="5083147">.</span><span class="ident" id="5083148">PostForm</span>&nbsp;<span class="op" id="5083157">==</span>&nbsp;<span class="ident" id="5083160">nil</span>&nbsp;<span class="op" id="5083164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083168">if</span>&nbsp;<span class="ident" id="5083171">r</span><span class="op" id="5083172">.</span><span class="ident" id="5083173">Method</span>&nbsp;<span class="op" id="5083180">==</span>&nbsp;<span class="string" id="5083183">&#34;POST&#34;</span>&nbsp;<span class="op" id="5083190">||</span>&nbsp;<span class="ident" id="5083193">r</span><span class="op" id="5083194">.</span><span class="ident" id="5083195">Method</span>&nbsp;<span class="op" id="5083202">==</span>&nbsp;<span class="string" id="5083205">&#34;PUT&#34;</span>&nbsp;<span class="op" id="5083211">||</span>&nbsp;<span class="ident" id="5083214">r</span><span class="op" id="5083215">.</span><span class="ident" id="5083216">Method</span>&nbsp;<span class="op" id="5083223">==</span>&nbsp;<span class="string" id="5083226">&#34;PATCH&#34;</span>&nbsp;<span class="op" id="5083234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083239">r</span><span class="op" id="5083240">.</span><span class="ident" id="5083241">PostForm</span><span class="op" id="5083249">,</span>&nbsp;<span class="ident" id="5083251">err</span>&nbsp;<span class="op" id="5083255">=</span>&nbsp;<span class="ident" id="5083257">parsePostForm</span><span class="op" id="5083270">(</span><span class="ident" id="5083271">r</span><span class="op" id="5083272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083276">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083280">if</span>&nbsp;<span class="ident" id="5083283">r</span><span class="op" id="5083284">.</span><span class="ident" id="5083285">PostForm</span>&nbsp;<span class="op" id="5083294">==</span>&nbsp;<span class="ident" id="5083297">nil</span>&nbsp;<span class="op" id="5083301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083306">r</span><span class="op" id="5083307">.</span><span class="ident" id="5083308">PostForm</span>&nbsp;<span class="op" id="5083317">=</span>&nbsp;<span class="builtinfunc" id="5083319">make</span><span class="op" id="5083323">(</span><span class="ident" id="5083324">url</span><span class="op" id="5083327">.</span><span class="ident" id="5083328">Values</span><span class="op" id="5083334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083344">if</span>&nbsp;<span class="ident" id="5083347">r</span><span class="op" id="5083348">.</span><span class="ident" id="5083349">Form</span>&nbsp;<span class="op" id="5083354">==</span>&nbsp;<span class="ident" id="5083357">nil</span>&nbsp;<span class="op" id="5083361">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083365">if</span>&nbsp;<span class="builtinfunc" id="5083368">len</span><span class="op" id="5083371">(</span><span class="ident" id="5083372">r</span><span class="op" id="5083373">.</span><span class="ident" id="5083374">PostForm</span><span class="op" id="5083382">)</span>&nbsp;<span class="op" id="5083384">&gt;</span>&nbsp;<span class="num" id="5083386">0</span>&nbsp;<span class="op" id="5083388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083393">r</span><span class="op" id="5083394">.</span><span class="ident" id="5083395">Form</span>&nbsp;<span class="op" id="5083400">=</span>&nbsp;<span class="builtinfunc" id="5083402">make</span><span class="op" id="5083406">(</span><span class="ident" id="5083407">url</span><span class="op" id="5083410">.</span><span class="ident" id="5083411">Values</span><span class="op" id="5083417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083422">copyValues</span><span class="op" id="5083432">(</span><span class="ident" id="5083433">r</span><span class="op" id="5083434">.</span><span class="ident" id="5083435">Form</span><span class="op" id="5083439">,</span>&nbsp;<span class="ident" id="5083441">r</span><span class="op" id="5083442">.</span><span class="ident" id="5083443">PostForm</span><span class="op" id="5083451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083459">var</span>&nbsp;<span class="ident" id="5083463">newValues</span>&nbsp;<span class="ident" id="5083473">url</span><span class="op" id="5083476">.</span><span class="ident" id="5083477">Values</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083486">if</span>&nbsp;<span class="ident" id="5083489">r</span><span class="op" id="5083490">.</span><span class="ident" id="5083491">URL</span>&nbsp;<span class="op" id="5083495">!=</span>&nbsp;<span class="ident" id="5083498">nil</span>&nbsp;<span class="op" id="5083502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083507">var</span>&nbsp;<span class="ident" id="5083511">e</span>&nbsp;<span class="builtintype" id="5083513">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083522">newValues</span><span class="op" id="5083531">,</span>&nbsp;<span class="ident" id="5083533">e</span>&nbsp;<span class="op" id="5083535">=</span>&nbsp;<span class="ident" id="5083537">url</span><span class="op" id="5083540">.</span><span class="ident" id="5083541">ParseQuery</span><span class="op" id="5083551">(</span><span class="ident" id="5083552">r</span><span class="op" id="5083553">.</span><span class="ident" id="5083554">URL</span><span class="op" id="5083557">.</span><span class="ident" id="5083558">RawQuery</span><span class="op" id="5083566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083571">if</span>&nbsp;<span class="ident" id="5083574">err</span>&nbsp;<span class="op" id="5083578">==</span>&nbsp;<span class="ident" id="5083581">nil</span>&nbsp;<span class="op" id="5083585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083591">err</span>&nbsp;<span class="op" id="5083595">=</span>&nbsp;<span class="ident" id="5083597">e</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083610">if</span>&nbsp;<span class="ident" id="5083613">newValues</span>&nbsp;<span class="op" id="5083623">==</span>&nbsp;<span class="ident" id="5083626">nil</span>&nbsp;<span class="op" id="5083630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083635">newValues</span>&nbsp;<span class="op" id="5083645">=</span>&nbsp;<span class="builtinfunc" id="5083647">make</span><span class="op" id="5083651">(</span><span class="ident" id="5083652">url</span><span class="op" id="5083655">.</span><span class="ident" id="5083656">Values</span><span class="op" id="5083662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083666">}</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083670">if</span>&nbsp;<span class="ident" id="5083673">r</span><span class="op" id="5083674">.</span><span class="ident" id="5083675">Form</span>&nbsp;<span class="op" id="5083680">==</span>&nbsp;<span class="ident" id="5083683">nil</span>&nbsp;<span class="op" id="5083687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083692">r</span><span class="op" id="5083693">.</span><span class="ident" id="5083694">Form</span>&nbsp;<span class="op" id="5083699">=</span>&nbsp;<span class="ident" id="5083701">newValues</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083713">}</span>&nbsp;<span class="keyword" id="5083715">else</span>&nbsp;<span class="op" id="5083720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083725">copyValues</span><span class="op" id="5083735">(</span><span class="ident" id="5083736">r</span><span class="op" id="5083737">.</span><span class="ident" id="5083738">Form</span><span class="op" id="5083742">,</span>&nbsp;<span class="ident" id="5083744">newValues</span><span class="op" id="5083753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083757">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083763">return</span>&nbsp;<span class="ident" id="5083770">err</span><br>
<span class="lineno"></span><span class="op" id="5083774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5083777">//&nbsp;ParseMultipartForm&nbsp;parses&nbsp;a&nbsp;request&nbsp;body&nbsp;as&nbsp;multipart/form-data.</span><br>
<span class="lineno">815</span><span class="comment" id="5083845">//&nbsp;The&nbsp;whole&nbsp;request&nbsp;body&nbsp;is&nbsp;parsed&nbsp;and&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;of&nbsp;maxMemory&nbsp;bytes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5083921">//&nbsp;its&nbsp;file&nbsp;parts&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory,&nbsp;with&nbsp;the&nbsp;remainder&nbsp;stored&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="5083990">//&nbsp;disk&nbsp;in&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5084018">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="comment" id="5084070">//&nbsp;After&nbsp;one&nbsp;call&nbsp;to&nbsp;ParseMultipartForm,&nbsp;subsequent&nbsp;calls&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">820</span><span class="keyword" id="5084144">func</span>&nbsp;<span class="op" id="5084149">(</span><span class="ident" id="5084150">r</span>&nbsp;<span class="op" id="5084152">*</span><span class="ident" id="5084153">Request</span><span class="op" id="5084160">)</span>&nbsp;<span class="ident" id="5084162">ParseMultipartForm</span><span class="op" id="5084180">(</span><span class="ident" id="5084181">maxMemory</span>&nbsp;<span class="ident" id="5084191">int64</span><span class="op" id="5084196">)</span>&nbsp;<span class="builtintype" id="5084198">error</span>&nbsp;<span class="op" id="5084204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084207">if</span>&nbsp;<span class="ident" id="5084210">r</span><span class="op" id="5084211">.</span><span class="ident" id="5084212">MultipartForm</span>&nbsp;<span class="op" id="5084226">==</span>&nbsp;<span class="ident" id="5084229">multipartByReader</span>&nbsp;<span class="op" id="5084247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084251">return</span>&nbsp;<span class="ident" id="5084258">errors</span><span class="op" id="5084264">.</span><span class="ident" id="5084265">New</span><span class="op" id="5084268">(</span><span class="string" id="5084269">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="5084313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5084316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084319">if</span>&nbsp;<span class="ident" id="5084322">r</span><span class="op" id="5084323">.</span><span class="ident" id="5084324">Form</span>&nbsp;<span class="op" id="5084329">==</span>&nbsp;<span class="ident" id="5084332">nil</span>&nbsp;<span class="op" id="5084336">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084340">err</span>&nbsp;<span class="op" id="5084344">:=</span>&nbsp;<span class="ident" id="5084347">r</span><span class="op" id="5084348">.</span><span class="ident" id="5084349">ParseForm</span><span class="op" id="5084358">(</span><span class="op" id="5084359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084363">if</span>&nbsp;<span class="ident" id="5084366">err</span>&nbsp;<span class="op" id="5084370">!=</span>&nbsp;<span class="ident" id="5084373">nil</span>&nbsp;<span class="op" id="5084377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084382">return</span>&nbsp;<span class="ident" id="5084389">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5084395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5084398">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084401">if</span>&nbsp;<span class="ident" id="5084404">r</span><span class="op" id="5084405">.</span><span class="ident" id="5084406">MultipartForm</span>&nbsp;<span class="op" id="5084420">!=</span>&nbsp;<span class="ident" id="5084423">nil</span>&nbsp;<span class="op" id="5084427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084431">return</span>&nbsp;<span class="ident" id="5084438">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5084443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084447">mr</span><span class="op" id="5084449">,</span>&nbsp;<span class="ident" id="5084451">err</span>&nbsp;<span class="op" id="5084455">:=</span>&nbsp;<span class="ident" id="5084458">r</span><span class="op" id="5084459">.</span><span class="ident" id="5084460">multipartReader</span><span class="op" id="5084475">(</span><span class="op" id="5084476">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084479">if</span>&nbsp;<span class="ident" id="5084482">err</span>&nbsp;<span class="op" id="5084486">!=</span>&nbsp;<span class="ident" id="5084489">nil</span>&nbsp;<span class="op" id="5084493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084497">return</span>&nbsp;<span class="ident" id="5084504">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5084509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084513">f</span><span class="op" id="5084514">,</span>&nbsp;<span class="ident" id="5084516">err</span>&nbsp;<span class="op" id="5084520">:=</span>&nbsp;<span class="ident" id="5084523">mr</span><span class="op" id="5084525">.</span><span class="ident" id="5084526">ReadForm</span><span class="op" id="5084534">(</span><span class="ident" id="5084535">maxMemory</span><span class="op" id="5084544">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084547">if</span>&nbsp;<span class="ident" id="5084550">err</span>&nbsp;<span class="op" id="5084554">!=</span>&nbsp;<span class="ident" id="5084557">nil</span>&nbsp;<span class="op" id="5084561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084565">return</span>&nbsp;<span class="ident" id="5084572">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5084577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084580">for</span>&nbsp;<span class="ident" id="5084584">k</span><span class="op" id="5084585">,</span>&nbsp;<span class="ident" id="5084587">v</span>&nbsp;<span class="op" id="5084589">:=</span>&nbsp;<span class="keyword" id="5084592">range</span>&nbsp;<span class="ident" id="5084598">f</span><span class="op" id="5084599">.</span><span class="ident" id="5084600">Value</span>&nbsp;<span class="op" id="5084606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084610">r</span><span class="op" id="5084611">.</span><span class="ident" id="5084612">Form</span><span class="op" id="5084616">[</span><span class="ident" id="5084617">k</span><span class="op" id="5084618">]</span>&nbsp;<span class="op" id="5084620">=</span>&nbsp;<span class="builtinfunc" id="5084622">append</span><span class="op" id="5084628">(</span><span class="ident" id="5084629">r</span><span class="op" id="5084630">.</span><span class="ident" id="5084631">Form</span><span class="op" id="5084635">[</span><span class="ident" id="5084636">k</span><span class="op" id="5084637">]</span><span class="op" id="5084638">,</span>&nbsp;<span class="ident" id="5084640">v</span><span class="op" id="5084641">...</span><span class="op" id="5084644">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5084647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084650">r</span><span class="op" id="5084651">.</span><span class="ident" id="5084652">MultipartForm</span>&nbsp;<span class="op" id="5084666">=</span>&nbsp;<span class="ident" id="5084668">f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084672">return</span>&nbsp;<span class="ident" id="5084679">nil</span><br>
<span class="lineno"></span><span class="op" id="5084683">}</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span><span class="comment" id="5084686">//&nbsp;FormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="comment" id="5084761">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="5084839">//&nbsp;FormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno"></span><span class="comment" id="5084916">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno">855</span><span class="comment" id="5084959">//&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;key,&nbsp;call&nbsp;ParseForm&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5085024">//&nbsp;then&nbsp;inspect&nbsp;Request.Form&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="5085063">func</span>&nbsp;<span class="op" id="5085068">(</span><span class="ident" id="5085069">r</span>&nbsp;<span class="op" id="5085071">*</span><span class="ident" id="5085072">Request</span><span class="op" id="5085079">)</span>&nbsp;<span class="ident" id="5085081">FormValue</span><span class="op" id="5085090">(</span><span class="ident" id="5085091">key</span>&nbsp;<span class="builtintype" id="5085095">string</span><span class="op" id="5085101">)</span>&nbsp;<span class="builtintype" id="5085103">string</span>&nbsp;<span class="op" id="5085110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085113">if</span>&nbsp;<span class="ident" id="5085116">r</span><span class="op" id="5085117">.</span><span class="ident" id="5085118">Form</span>&nbsp;<span class="op" id="5085123">==</span>&nbsp;<span class="ident" id="5085126">nil</span>&nbsp;<span class="op" id="5085130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085134">r</span><span class="op" id="5085135">.</span><span class="ident" id="5085136">ParseMultipartForm</span><span class="op" id="5085154">(</span><span class="ident" id="5085155">defaultMaxMemory</span><span class="op" id="5085171">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5085174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085177">if</span>&nbsp;<span class="ident" id="5085180">vs</span>&nbsp;<span class="op" id="5085183">:=</span>&nbsp;<span class="ident" id="5085186">r</span><span class="op" id="5085187">.</span><span class="ident" id="5085188">Form</span><span class="op" id="5085192">[</span><span class="ident" id="5085193">key</span><span class="op" id="5085196">]</span><span class="op" id="5085197">;</span>&nbsp;<span class="builtinfunc" id="5085199">len</span><span class="op" id="5085202">(</span><span class="ident" id="5085203">vs</span><span class="op" id="5085205">)</span>&nbsp;<span class="op" id="5085207">&gt;</span>&nbsp;<span class="num" id="5085209">0</span>&nbsp;<span class="op" id="5085211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085215">return</span>&nbsp;<span class="ident" id="5085222">vs</span><span class="op" id="5085224">[</span><span class="num" id="5085225">0</span><span class="op" id="5085226">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5085229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085232">return</span>&nbsp;<span class="string" id="5085239">&#34;&#34;</span><br>
<span class="lineno">865</span><span class="op" id="5085242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5085245">//&nbsp;PostFormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;POST</span><br>
<span class="lineno"></span><span class="comment" id="5085322">//&nbsp;or&nbsp;PUT&nbsp;request&nbsp;body.&nbsp;URL&nbsp;query&nbsp;parameters&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5085380">//&nbsp;PostFormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno">870</span><span class="comment" id="5085461">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno"></span><span class="keyword" id="5085504">func</span>&nbsp;<span class="op" id="5085509">(</span><span class="ident" id="5085510">r</span>&nbsp;<span class="op" id="5085512">*</span><span class="ident" id="5085513">Request</span><span class="op" id="5085520">)</span>&nbsp;<span class="ident" id="5085522">PostFormValue</span><span class="op" id="5085535">(</span><span class="ident" id="5085536">key</span>&nbsp;<span class="builtintype" id="5085540">string</span><span class="op" id="5085546">)</span>&nbsp;<span class="builtintype" id="5085548">string</span>&nbsp;<span class="op" id="5085555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085558">if</span>&nbsp;<span class="ident" id="5085561">r</span><span class="op" id="5085562">.</span><span class="ident" id="5085563">PostForm</span>&nbsp;<span class="op" id="5085572">==</span>&nbsp;<span class="ident" id="5085575">nil</span>&nbsp;<span class="op" id="5085579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085583">r</span><span class="op" id="5085584">.</span><span class="ident" id="5085585">ParseMultipartForm</span><span class="op" id="5085603">(</span><span class="ident" id="5085604">defaultMaxMemory</span><span class="op" id="5085620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5085623">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085626">if</span>&nbsp;<span class="ident" id="5085629">vs</span>&nbsp;<span class="op" id="5085632">:=</span>&nbsp;<span class="ident" id="5085635">r</span><span class="op" id="5085636">.</span><span class="ident" id="5085637">PostForm</span><span class="op" id="5085645">[</span><span class="ident" id="5085646">key</span><span class="op" id="5085649">]</span><span class="op" id="5085650">;</span>&nbsp;<span class="builtinfunc" id="5085652">len</span><span class="op" id="5085655">(</span><span class="ident" id="5085656">vs</span><span class="op" id="5085658">)</span>&nbsp;<span class="op" id="5085660">&gt;</span>&nbsp;<span class="num" id="5085662">0</span>&nbsp;<span class="op" id="5085664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085668">return</span>&nbsp;<span class="ident" id="5085675">vs</span><span class="op" id="5085677">[</span><span class="num" id="5085678">0</span><span class="op" id="5085679">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5085682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085685">return</span>&nbsp;<span class="string" id="5085692">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="5085695">}</span><br>
<span class="lineno">880</span><br>
<span class="lineno"></span><span class="comment" id="5085698">//&nbsp;FormFile&nbsp;returns&nbsp;the&nbsp;first&nbsp;file&nbsp;for&nbsp;the&nbsp;provided&nbsp;form&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="5085760">//&nbsp;FormFile&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5085825">func</span>&nbsp;<span class="op" id="5085830">(</span><span class="ident" id="5085831">r</span>&nbsp;<span class="op" id="5085833">*</span><span class="ident" id="5085834">Request</span><span class="op" id="5085841">)</span>&nbsp;<span class="ident" id="5085843">FormFile</span><span class="op" id="5085851">(</span><span class="ident" id="5085852">key</span>&nbsp;<span class="builtintype" id="5085856">string</span><span class="op" id="5085862">)</span>&nbsp;<span class="op" id="5085864">(</span><span class="ident" id="5085865">multipart</span><span class="op" id="5085874">.</span><span class="ident" id="5085875">File</span><span class="op" id="5085879">,</span>&nbsp;<span class="op" id="5085881">*</span><span class="ident" id="5085882">multipart</span><span class="op" id="5085891">.</span><span class="ident" id="5085892">FileHeader</span><span class="op" id="5085902">,</span>&nbsp;<span class="builtintype" id="5085904">error</span><span class="op" id="5085909">)</span>&nbsp;<span class="op" id="5085911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085914">if</span>&nbsp;<span class="ident" id="5085917">r</span><span class="op" id="5085918">.</span><span class="ident" id="5085919">MultipartForm</span>&nbsp;<span class="op" id="5085933">==</span>&nbsp;<span class="ident" id="5085936">multipartByReader</span>&nbsp;<span class="op" id="5085954">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085958">return</span>&nbsp;<span class="ident" id="5085965">nil</span><span class="op" id="5085968">,</span>&nbsp;<span class="ident" id="5085970">nil</span><span class="op" id="5085973">,</span>&nbsp;<span class="ident" id="5085975">errors</span><span class="op" id="5085981">.</span><span class="ident" id="5085982">New</span><span class="op" id="5085985">(</span><span class="string" id="5085986">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="5086030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086036">if</span>&nbsp;<span class="ident" id="5086039">r</span><span class="op" id="5086040">.</span><span class="ident" id="5086041">MultipartForm</span>&nbsp;<span class="op" id="5086055">==</span>&nbsp;<span class="ident" id="5086058">nil</span>&nbsp;<span class="op" id="5086062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086066">err</span>&nbsp;<span class="op" id="5086070">:=</span>&nbsp;<span class="ident" id="5086073">r</span><span class="op" id="5086074">.</span><span class="ident" id="5086075">ParseMultipartForm</span><span class="op" id="5086093">(</span><span class="ident" id="5086094">defaultMaxMemory</span><span class="op" id="5086110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086114">if</span>&nbsp;<span class="ident" id="5086117">err</span>&nbsp;<span class="op" id="5086121">!=</span>&nbsp;<span class="ident" id="5086124">nil</span>&nbsp;<span class="op" id="5086128">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086133">return</span>&nbsp;<span class="ident" id="5086140">nil</span><span class="op" id="5086143">,</span>&nbsp;<span class="ident" id="5086145">nil</span><span class="op" id="5086148">,</span>&nbsp;<span class="ident" id="5086150">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086162">if</span>&nbsp;<span class="ident" id="5086165">r</span><span class="op" id="5086166">.</span><span class="ident" id="5086167">MultipartForm</span>&nbsp;<span class="op" id="5086181">!=</span>&nbsp;<span class="ident" id="5086184">nil</span>&nbsp;<span class="op" id="5086188">&amp;&amp;</span>&nbsp;<span class="ident" id="5086191">r</span><span class="op" id="5086192">.</span><span class="ident" id="5086193">MultipartForm</span><span class="op" id="5086206">.</span><span class="ident" id="5086207">File</span>&nbsp;<span class="op" id="5086212">!=</span>&nbsp;<span class="ident" id="5086215">nil</span>&nbsp;<span class="op" id="5086219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086223">if</span>&nbsp;<span class="ident" id="5086226">fhs</span>&nbsp;<span class="op" id="5086230">:=</span>&nbsp;<span class="ident" id="5086233">r</span><span class="op" id="5086234">.</span><span class="ident" id="5086235">MultipartForm</span><span class="op" id="5086248">.</span><span class="ident" id="5086249">File</span><span class="op" id="5086253">[</span><span class="ident" id="5086254">key</span><span class="op" id="5086257">]</span><span class="op" id="5086258">;</span>&nbsp;<span class="builtinfunc" id="5086260">len</span><span class="op" id="5086263">(</span><span class="ident" id="5086264">fhs</span><span class="op" id="5086267">)</span>&nbsp;<span class="op" id="5086269">&gt;</span>&nbsp;<span class="num" id="5086271">0</span>&nbsp;<span class="op" id="5086273">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086278">f</span><span class="op" id="5086279">,</span>&nbsp;<span class="ident" id="5086281">err</span>&nbsp;<span class="op" id="5086285">:=</span>&nbsp;<span class="ident" id="5086288">fhs</span><span class="op" id="5086291">[</span><span class="num" id="5086292">0</span><span class="op" id="5086293">]</span><span class="op" id="5086294">.</span><span class="ident" id="5086295">Open</span><span class="op" id="5086299">(</span><span class="op" id="5086300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086305">return</span>&nbsp;<span class="ident" id="5086312">f</span><span class="op" id="5086313">,</span>&nbsp;<span class="ident" id="5086315">fhs</span><span class="op" id="5086318">[</span><span class="num" id="5086319">0</span><span class="op" id="5086320">]</span><span class="op" id="5086321">,</span>&nbsp;<span class="ident" id="5086323">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086335">return</span>&nbsp;<span class="ident" id="5086342">nil</span><span class="op" id="5086345">,</span>&nbsp;<span class="ident" id="5086347">nil</span><span class="op" id="5086350">,</span>&nbsp;<span class="ident" id="5086352">ErrMissingFile</span><br>
<span class="lineno">900</span><span class="op" id="5086367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5086370">func</span>&nbsp;<span class="op" id="5086375">(</span><span class="ident" id="5086376">r</span>&nbsp;<span class="op" id="5086378">*</span><span class="ident" id="5086379">Request</span><span class="op" id="5086386">)</span>&nbsp;<span class="ident" id="5086388">expectsContinue</span><span class="op" id="5086403">(</span><span class="op" id="5086404">)</span>&nbsp;<span class="builtintype" id="5086406">bool</span>&nbsp;<span class="op" id="5086411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086414">return</span>&nbsp;<span class="ident" id="5086421">hasToken</span><span class="op" id="5086429">(</span><span class="ident" id="5086430">r</span><span class="op" id="5086431">.</span><span class="ident" id="5086432">Header</span><span class="op" id="5086438">.</span><span class="ident" id="5086439">get</span><span class="op" id="5086442">(</span><span class="string" id="5086443">&#34;Expect&#34;</span><span class="op" id="5086451">)</span><span class="op" id="5086452">,</span>&nbsp;<span class="string" id="5086454">&#34;100-continue&#34;</span><span class="op" id="5086468">)</span><br>
<span class="lineno"></span><span class="op" id="5086470">}</span><br>
<span class="lineno">905</span><br>
<span class="lineno"></span><span class="keyword" id="5086473">func</span>&nbsp;<span class="op" id="5086478">(</span><span class="ident" id="5086479">r</span>&nbsp;<span class="op" id="5086481">*</span><span class="ident" id="5086482">Request</span><span class="op" id="5086489">)</span>&nbsp;<span class="ident" id="5086491">wantsHttp10KeepAlive</span><span class="op" id="5086511">(</span><span class="op" id="5086512">)</span>&nbsp;<span class="builtintype" id="5086514">bool</span>&nbsp;<span class="op" id="5086519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086522">if</span>&nbsp;<span class="ident" id="5086525">r</span><span class="op" id="5086526">.</span><span class="ident" id="5086527">ProtoMajor</span>&nbsp;<span class="op" id="5086538">!=</span>&nbsp;<span class="num" id="5086541">1</span>&nbsp;<span class="op" id="5086543">||</span>&nbsp;<span class="ident" id="5086546">r</span><span class="op" id="5086547">.</span><span class="ident" id="5086548">ProtoMinor</span>&nbsp;<span class="op" id="5086559">!=</span>&nbsp;<span class="num" id="5086562">0</span>&nbsp;<span class="op" id="5086564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086568">return</span>&nbsp;<span class="builtintype" id="5086575">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086582">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086585">return</span>&nbsp;<span class="ident" id="5086592">hasToken</span><span class="op" id="5086600">(</span><span class="ident" id="5086601">r</span><span class="op" id="5086602">.</span><span class="ident" id="5086603">Header</span><span class="op" id="5086609">.</span><span class="ident" id="5086610">get</span><span class="op" id="5086613">(</span><span class="string" id="5086614">&#34;Connection&#34;</span><span class="op" id="5086626">)</span><span class="op" id="5086627">,</span>&nbsp;<span class="string" id="5086629">&#34;keep-alive&#34;</span><span class="op" id="5086641">)</span><br>
<span class="lineno"></span><span class="op" id="5086643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5086646">func</span>&nbsp;<span class="op" id="5086651">(</span><span class="ident" id="5086652">r</span>&nbsp;<span class="op" id="5086654">*</span><span class="ident" id="5086655">Request</span><span class="op" id="5086662">)</span>&nbsp;<span class="ident" id="5086664">wantsClose</span><span class="op" id="5086674">(</span><span class="op" id="5086675">)</span>&nbsp;<span class="builtintype" id="5086677">bool</span>&nbsp;<span class="op" id="5086682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086685">return</span>&nbsp;<span class="ident" id="5086692">hasToken</span><span class="op" id="5086700">(</span><span class="ident" id="5086701">r</span><span class="op" id="5086702">.</span><span class="ident" id="5086703">Header</span><span class="op" id="5086709">.</span><span class="ident" id="5086710">get</span><span class="op" id="5086713">(</span><span class="string" id="5086714">&#34;Connection&#34;</span><span class="op" id="5086726">)</span><span class="op" id="5086727">,</span>&nbsp;<span class="string" id="5086729">&#34;close&#34;</span><span class="op" id="5086736">)</span><br>
<span class="lineno">915</span><span class="op" id="5086738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5086741">func</span>&nbsp;<span class="op" id="5086746">(</span><span class="ident" id="5086747">r</span>&nbsp;<span class="op" id="5086749">*</span><span class="ident" id="5086750">Request</span><span class="op" id="5086757">)</span>&nbsp;<span class="ident" id="5086759">closeBody</span><span class="op" id="5086768">(</span><span class="op" id="5086769">)</span>&nbsp;<span class="op" id="5086771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086774">if</span>&nbsp;<span class="ident" id="5086777">r</span><span class="op" id="5086778">.</span><span class="ident" id="5086779">Body</span>&nbsp;<span class="op" id="5086784">!=</span>&nbsp;<span class="ident" id="5086787">nil</span>&nbsp;<span class="op" id="5086791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086795">r</span><span class="op" id="5086796">.</span><span class="ident" id="5086797">Body</span><span class="op" id="5086801">.</span><span class="ident" id="5086802">Close</span><span class="op" id="5086807">(</span><span class="op" id="5086808">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086811">}</span><br>
<span class="lineno"></span><span class="op" id="5086813">}</span>
</div>
</body>
</html>
