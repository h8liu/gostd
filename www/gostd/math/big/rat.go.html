<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html" class="current">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3029577">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3029632">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3029686">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3029737">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;multi-precision&nbsp;rational&nbsp;numbers.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3029796">package</span>&nbsp;<span class="ident" id="3029804">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3029809">import</span>&nbsp;<span class="op" id="3029816">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3029819">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3029838">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3029848">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3029855">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3029863">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3029873">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3029876">//&nbsp;A&nbsp;Rat&nbsp;represents&nbsp;a&nbsp;quotient&nbsp;a/b&nbsp;of&nbsp;arbitrary&nbsp;precision.</span><br>
<span class="lineno"></span><span class="comment" id="3029935">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Rat&nbsp;represents&nbsp;the&nbsp;value&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3029987">type</span>&nbsp;<span class="ident" id="3029992">Rat</span>&nbsp;<span class="keyword" id="3029996">struct</span>&nbsp;<span class="op" id="3030003">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3030006">//&nbsp;To&nbsp;make&nbsp;zero&nbsp;values&nbsp;for&nbsp;Rat&nbsp;work&nbsp;w/o&nbsp;initialization,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3030063">//&nbsp;a&nbsp;zero&nbsp;value&nbsp;of&nbsp;b&nbsp;(len(b)&nbsp;==&nbsp;0)&nbsp;acts&nbsp;like&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3030117">//&nbsp;a.neg&nbsp;determines&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;Rat,&nbsp;b.neg&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030177">a</span><span class="op" id="3030178">,</span>&nbsp;<span class="ident" id="3030180">b</span>&nbsp;<span class="ident" id="3030182">Int</span><br>
<span class="lineno"></span><span class="op" id="3030186">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3030189">//&nbsp;NewRat&nbsp;creates&nbsp;a&nbsp;new&nbsp;Rat&nbsp;with&nbsp;numerator&nbsp;a&nbsp;and&nbsp;denominator&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3030253">func</span>&nbsp;<span class="ident" id="3030258">NewRat</span><span class="op" id="3030264">(</span><span class="ident" id="3030265">a</span><span class="op" id="3030266">,</span>&nbsp;<span class="ident" id="3030268">b</span>&nbsp;<span class="ident" id="3030270">int64</span><span class="op" id="3030275">)</span>&nbsp;<span class="op" id="3030277">*</span><span class="ident" id="3030278">Rat</span>&nbsp;<span class="op" id="3030282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030285">return</span>&nbsp;<span class="builtinfunc" id="3030292">new</span><span class="op" id="3030295">(</span><span class="ident" id="3030296">Rat</span><span class="op" id="3030299">)</span><span class="op" id="3030300">.</span><span class="ident" id="3030301">SetFrac64</span><span class="op" id="3030310">(</span><span class="ident" id="3030311">a</span><span class="op" id="3030312">,</span>&nbsp;<span class="ident" id="3030314">b</span><span class="op" id="3030315">)</span><br>
<span class="lineno"></span><span class="op" id="3030317">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3030320">//&nbsp;SetFloat64&nbsp;sets&nbsp;z&nbsp;to&nbsp;exactly&nbsp;f&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3030369">//&nbsp;If&nbsp;f&nbsp;is&nbsp;not&nbsp;finite,&nbsp;SetFloat&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3030414">func</span>&nbsp;<span class="op" id="3030419">(</span><span class="ident" id="3030420">z</span>&nbsp;<span class="op" id="3030422">*</span><span class="ident" id="3030423">Rat</span><span class="op" id="3030426">)</span>&nbsp;<span class="ident" id="3030428">SetFloat64</span><span class="op" id="3030438">(</span><span class="ident" id="3030439">f</span>&nbsp;<span class="builtintype" id="3030441">float64</span><span class="op" id="3030448">)</span>&nbsp;<span class="op" id="3030450">*</span><span class="ident" id="3030451">Rat</span>&nbsp;<span class="op" id="3030455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030458">const</span>&nbsp;<span class="ident" id="3030464">expMask</span>&nbsp;<span class="op" id="3030472">=</span>&nbsp;<span class="num" id="3030474">1</span><span class="op" id="3030475">&lt;&lt;</span><span class="num" id="3030477">11</span>&nbsp;<span class="op" id="3030480">-</span>&nbsp;<span class="num" id="3030482">1</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030485">bits</span>&nbsp;<span class="op" id="3030490">:=</span>&nbsp;<span class="ident" id="3030493">math</span><span class="op" id="3030497">.</span><span class="ident" id="3030498">Float64bits</span><span class="op" id="3030509">(</span><span class="ident" id="3030510">f</span><span class="op" id="3030511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030514">mantissa</span>&nbsp;<span class="op" id="3030523">:=</span>&nbsp;<span class="ident" id="3030526">bits</span>&nbsp;<span class="op" id="3030531">&amp;</span>&nbsp;<span class="op" id="3030533">(</span><span class="num" id="3030534">1</span><span class="op" id="3030535">&lt;&lt;</span><span class="num" id="3030537">52</span>&nbsp;<span class="op" id="3030540">-</span>&nbsp;<span class="num" id="3030542">1</span><span class="op" id="3030543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030546">exp</span>&nbsp;<span class="op" id="3030550">:=</span>&nbsp;<span class="builtintype" id="3030553">int</span><span class="op" id="3030556">(</span><span class="op" id="3030557">(</span><span class="ident" id="3030558">bits</span>&nbsp;<span class="op" id="3030563">&gt;&gt;</span>&nbsp;<span class="num" id="3030566">52</span><span class="op" id="3030568">)</span>&nbsp;<span class="op" id="3030570">&amp;</span>&nbsp;<span class="ident" id="3030572">expMask</span><span class="op" id="3030579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030582">switch</span>&nbsp;<span class="ident" id="3030589">exp</span>&nbsp;<span class="op" id="3030593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030596">case</span>&nbsp;<span class="ident" id="3030601">expMask</span><span class="op" id="3030608">:</span>&nbsp;<span class="comment" id="3030610">//&nbsp;non-finite</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030626">return</span>&nbsp;<span class="builtintype" id="3030633">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030638">case</span>&nbsp;<span class="num" id="3030643">0</span><span class="op" id="3030644">:</span>&nbsp;<span class="comment" id="3030646">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030660">exp</span>&nbsp;<span class="op" id="3030664">-=</span>&nbsp;<span class="num" id="3030667">1022</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030673">default</span><span class="op" id="3030680">:</span>&nbsp;<span class="comment" id="3030682">//&nbsp;normal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030694">mantissa</span>&nbsp;<span class="op" id="3030703">|=</span>&nbsp;<span class="num" id="3030706">1</span>&nbsp;<span class="op" id="3030708">&lt;&lt;</span>&nbsp;<span class="num" id="3030711">52</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030716">exp</span>&nbsp;<span class="op" id="3030720">-=</span>&nbsp;<span class="num" id="3030723">1023</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3030729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030733">shift</span>&nbsp;<span class="op" id="3030739">:=</span>&nbsp;<span class="num" id="3030742">52</span>&nbsp;<span class="op" id="3030745">-</span>&nbsp;<span class="ident" id="3030747">exp</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3030753">//&nbsp;Optimization&nbsp;(?):&nbsp;partially&nbsp;pre-normalise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030800">for</span>&nbsp;<span class="ident" id="3030804">mantissa</span><span class="op" id="3030812">&amp;</span><span class="num" id="3030813">1</span>&nbsp;<span class="op" id="3030815">==</span>&nbsp;<span class="num" id="3030818">0</span>&nbsp;<span class="op" id="3030820">&amp;&amp;</span>&nbsp;<span class="ident" id="3030823">shift</span>&nbsp;<span class="op" id="3030829">&gt;</span>&nbsp;<span class="num" id="3030831">0</span>&nbsp;<span class="op" id="3030833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030837">mantissa</span>&nbsp;<span class="op" id="3030846">&gt;&gt;=</span>&nbsp;<span class="num" id="3030850">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030854">shift</span><span class="op" id="3030859">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3030863">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030867">z</span><span class="op" id="3030868">.</span><span class="ident" id="3030869">a</span><span class="op" id="3030870">.</span><span class="ident" id="3030871">SetUint64</span><span class="op" id="3030880">(</span><span class="ident" id="3030881">mantissa</span><span class="op" id="3030889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030892">z</span><span class="op" id="3030893">.</span><span class="ident" id="3030894">a</span><span class="op" id="3030895">.</span><span class="ident" id="3030896">neg</span>&nbsp;<span class="op" id="3030900">=</span>&nbsp;<span class="ident" id="3030902">f</span>&nbsp;<span class="op" id="3030904">&lt;</span>&nbsp;<span class="num" id="3030906">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030909">z</span><span class="op" id="3030910">.</span><span class="ident" id="3030911">b</span><span class="op" id="3030912">.</span><span class="ident" id="3030913">Set</span><span class="op" id="3030916">(</span><span class="ident" id="3030917">intOne</span><span class="op" id="3030923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030926">if</span>&nbsp;<span class="ident" id="3030929">shift</span>&nbsp;<span class="op" id="3030935">&gt;</span>&nbsp;<span class="num" id="3030937">0</span>&nbsp;<span class="op" id="3030939">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030943">z</span><span class="op" id="3030944">.</span><span class="ident" id="3030945">b</span><span class="op" id="3030946">.</span><span class="ident" id="3030947">Lsh</span><span class="op" id="3030950">(</span><span class="op" id="3030951">&amp;</span><span class="ident" id="3030952">z</span><span class="op" id="3030953">.</span><span class="ident" id="3030954">b</span><span class="op" id="3030955">,</span>&nbsp;<span class="builtintype" id="3030957">uint</span><span class="op" id="3030961">(</span><span class="ident" id="3030962">shift</span><span class="op" id="3030967">)</span><span class="op" id="3030968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3030971">}</span>&nbsp;<span class="keyword" id="3030973">else</span>&nbsp;<span class="op" id="3030978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030982">z</span><span class="op" id="3030983">.</span><span class="ident" id="3030984">a</span><span class="op" id="3030985">.</span><span class="ident" id="3030986">Lsh</span><span class="op" id="3030989">(</span><span class="op" id="3030990">&amp;</span><span class="ident" id="3030991">z</span><span class="op" id="3030992">.</span><span class="ident" id="3030993">a</span><span class="op" id="3030994">,</span>&nbsp;<span class="builtintype" id="3030996">uint</span><span class="op" id="3031000">(</span><span class="op" id="3031001">-</span><span class="ident" id="3031002">shift</span><span class="op" id="3031007">)</span><span class="op" id="3031008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3031011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3031014">return</span>&nbsp;<span class="ident" id="3031021">z</span><span class="op" id="3031022">.</span><span class="ident" id="3031023">norm</span><span class="op" id="3031027">(</span><span class="op" id="3031028">)</span><br>
<span class="lineno">65</span><span class="op" id="3031030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3031033">//&nbsp;quotToFloat32&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float32&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3031089">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3031144">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno">70</span><span class="comment" id="3031197">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3031262">func</span>&nbsp;<span class="ident" id="3031267">quotToFloat32</span><span class="op" id="3031280">(</span><span class="ident" id="3031281">a</span><span class="op" id="3031282">,</span>&nbsp;<span class="ident" id="3031284">b</span>&nbsp;<span class="ident" id="3031286">nat</span><span class="op" id="3031289">)</span>&nbsp;<span class="op" id="3031291">(</span><span class="ident" id="3031292">f</span>&nbsp;<span class="builtintype" id="3031294">float32</span><span class="op" id="3031301">,</span>&nbsp;<span class="ident" id="3031303">exact</span>&nbsp;<span class="builtintype" id="3031309">bool</span><span class="op" id="3031313">)</span>&nbsp;<span class="op" id="3031315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3031318">const</span>&nbsp;<span class="op" id="3031324">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3031328">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3031352">Fsize</span>&nbsp;<span class="op" id="3031358">=</span>&nbsp;<span class="num" id="3031360">32</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3031366">//&nbsp;mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3031380">Msize</span>&nbsp;&nbsp;<span class="op" id="3031387">=</span>&nbsp;<span class="num" id="3031389">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3031394">Msize1</span>&nbsp;<span class="op" id="3031401">=</span>&nbsp;<span class="ident" id="3031403">Msize</span>&nbsp;<span class="op" id="3031409">+</span>&nbsp;<span class="num" id="3031411">1</span>&nbsp;<span class="comment" id="3031413">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3031435">Msize2</span>&nbsp;<span class="op" id="3031442">=</span>&nbsp;<span class="ident" id="3031444">Msize1</span>&nbsp;<span class="op" id="3031451">+</span>&nbsp;<span class="num" id="3031453">1</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3031458">//&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3031472">Esize</span>&nbsp;<span class="op" id="3031478">=</span>&nbsp;<span class="ident" id="3031480">Fsize</span>&nbsp;<span class="op" id="3031486">-</span>&nbsp;<span class="ident" id="3031488">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3031497">Ebias</span>&nbsp;<span class="op" id="3031503">=</span>&nbsp;<span class="num" id="3031505">1</span><span class="op" id="3031506">&lt;&lt;</span><span class="op" id="3031508">(</span><span class="ident" id="3031509">Esize</span><span class="op" id="3031514">-</span><span class="num" id="3031515">1</span><span class="op" id="3031516">)</span>&nbsp;<span class="op" id="3031518">-</span>&nbsp;<span class="num" id="3031520">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3031524">Emin</span>&nbsp;&nbsp;<span class="op" id="3031530">=</span>&nbsp;<span class="num" id="3031532">1</span>&nbsp;<span class="op" id="3031534">-</span>&nbsp;<span class="ident" id="3031536">Ebias</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3031544">Emax</span>&nbsp;&nbsp;<span class="op" id="3031550">=</span>&nbsp;<span class="ident" id="3031552">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3031559">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3031563">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3031634">alen</span>&nbsp;<span class="op" id="3031639">:=</span>&nbsp;<span class="ident" id="3031642">a</span><span class="op" id="3031643">.</span><span class="ident" id="3031644">bitLen</span><span class="op" id="3031650">(</span><span class="op" id="3031651">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3031654">if</span>&nbsp;<span class="ident" id="3031657">alen</span>&nbsp;<span class="op" id="3031662">==</span>&nbsp;<span class="num" id="3031665">0</span>&nbsp;<span class="op" id="3031667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3031671">return</span>&nbsp;<span class="num" id="3031678">0</span><span class="op" id="3031679">,</span>&nbsp;<span class="builtintype" id="3031681">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3031687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3031690">blen</span>&nbsp;<span class="op" id="3031695">:=</span>&nbsp;<span class="ident" id="3031698">b</span><span class="op" id="3031699">.</span><span class="ident" id="3031700">bitLen</span><span class="op" id="3031706">(</span><span class="op" id="3031707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3031710">if</span>&nbsp;<span class="ident" id="3031713">blen</span>&nbsp;<span class="op" id="3031718">==</span>&nbsp;<span class="num" id="3031721">0</span>&nbsp;<span class="op" id="3031723">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3031727">panic</span><span class="op" id="3031732">(</span><span class="string" id="3031733">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3031751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3031754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3031758">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3031838">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3031918">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float32&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3031990">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3032052">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3032114">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3032181">exp</span>&nbsp;<span class="op" id="3032185">:=</span>&nbsp;<span class="ident" id="3032188">alen</span>&nbsp;<span class="op" id="3032193">-</span>&nbsp;<span class="ident" id="3032195">blen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3032201">var</span>&nbsp;<span class="ident" id="3032205">a2</span><span class="op" id="3032207">,</span>&nbsp;<span class="ident" id="3032209">b2</span>&nbsp;<span class="ident" id="3032212">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3032217">a2</span>&nbsp;<span class="op" id="3032220">=</span>&nbsp;<span class="ident" id="3032222">a2</span><span class="op" id="3032224">.</span><span class="ident" id="3032225">set</span><span class="op" id="3032228">(</span><span class="ident" id="3032229">a</span><span class="op" id="3032230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3032233">b2</span>&nbsp;<span class="op" id="3032236">=</span>&nbsp;<span class="ident" id="3032238">b2</span><span class="op" id="3032240">.</span><span class="ident" id="3032241">set</span><span class="op" id="3032244">(</span><span class="ident" id="3032245">b</span><span class="op" id="3032246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3032249">if</span>&nbsp;<span class="ident" id="3032252">shift</span>&nbsp;<span class="op" id="3032258">:=</span>&nbsp;<span class="ident" id="3032261">Msize2</span>&nbsp;<span class="op" id="3032268">-</span>&nbsp;<span class="ident" id="3032270">exp</span><span class="op" id="3032273">;</span>&nbsp;<span class="ident" id="3032275">shift</span>&nbsp;<span class="op" id="3032281">&gt;</span>&nbsp;<span class="num" id="3032283">0</span>&nbsp;<span class="op" id="3032285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3032289">a2</span>&nbsp;<span class="op" id="3032292">=</span>&nbsp;<span class="ident" id="3032294">a2</span><span class="op" id="3032296">.</span><span class="ident" id="3032297">shl</span><span class="op" id="3032300">(</span><span class="ident" id="3032301">a2</span><span class="op" id="3032303">,</span>&nbsp;<span class="builtintype" id="3032305">uint</span><span class="op" id="3032309">(</span><span class="ident" id="3032310">shift</span><span class="op" id="3032315">)</span><span class="op" id="3032316">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3032319">}</span>&nbsp;<span class="keyword" id="3032321">else</span>&nbsp;<span class="keyword" id="3032326">if</span>&nbsp;<span class="ident" id="3032329">shift</span>&nbsp;<span class="op" id="3032335">&lt;</span>&nbsp;<span class="num" id="3032337">0</span>&nbsp;<span class="op" id="3032339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3032343">b2</span>&nbsp;<span class="op" id="3032346">=</span>&nbsp;<span class="ident" id="3032348">b2</span><span class="op" id="3032350">.</span><span class="ident" id="3032351">shl</span><span class="op" id="3032354">(</span><span class="ident" id="3032355">b2</span><span class="op" id="3032357">,</span>&nbsp;<span class="builtintype" id="3032359">uint</span><span class="op" id="3032363">(</span><span class="op" id="3032364">-</span><span class="ident" id="3032365">shift</span><span class="op" id="3032370">)</span><span class="op" id="3032371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3032374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3032378">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3032440">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3032497">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3032522">var</span>&nbsp;<span class="ident" id="3032526">q</span>&nbsp;<span class="ident" id="3032528">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3032533">q</span><span class="op" id="3032534">,</span>&nbsp;<span class="ident" id="3032536">r</span>&nbsp;<span class="op" id="3032538">:=</span>&nbsp;<span class="ident" id="3032541">q</span><span class="op" id="3032542">.</span><span class="ident" id="3032543">div</span><span class="op" id="3032546">(</span><span class="ident" id="3032547">a2</span><span class="op" id="3032549">,</span>&nbsp;<span class="ident" id="3032551">a2</span><span class="op" id="3032553">,</span>&nbsp;<span class="ident" id="3032555">b2</span><span class="op" id="3032557">)</span>&nbsp;<span class="comment" id="3032559">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3032576">mantissa</span>&nbsp;<span class="op" id="3032585">:=</span>&nbsp;<span class="ident" id="3032588">low32</span><span class="op" id="3032593">(</span><span class="ident" id="3032594">q</span><span class="op" id="3032595">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3032598">haveRem</span>&nbsp;<span class="op" id="3032606">:=</span>&nbsp;<span class="builtinfunc" id="3032609">len</span><span class="op" id="3032612">(</span><span class="ident" id="3032613">r</span><span class="op" id="3032614">)</span>&nbsp;<span class="op" id="3032616">&gt;</span>&nbsp;<span class="num" id="3032618">0</span>&nbsp;<span class="comment" id="3032620">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3032677">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3032746">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3032798">if</span>&nbsp;<span class="ident" id="3032801">mantissa</span><span class="op" id="3032809">&gt;&gt;</span><span class="ident" id="3032811">Msize2</span>&nbsp;<span class="op" id="3032818">==</span>&nbsp;<span class="num" id="3032821">1</span>&nbsp;<span class="op" id="3032823">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3032827">if</span>&nbsp;<span class="ident" id="3032830">mantissa</span><span class="op" id="3032838">&amp;</span><span class="num" id="3032839">1</span>&nbsp;<span class="op" id="3032841">==</span>&nbsp;<span class="num" id="3032844">1</span>&nbsp;<span class="op" id="3032846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3032851">haveRem</span>&nbsp;<span class="op" id="3032859">=</span>&nbsp;<span class="builtintype" id="3032861">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3032868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3032872">mantissa</span>&nbsp;<span class="op" id="3032881">&gt;&gt;=</span>&nbsp;<span class="num" id="3032885">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3032889">exp</span><span class="op" id="3032892">++</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3032896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3032899">if</span>&nbsp;<span class="ident" id="3032902">mantissa</span><span class="op" id="3032910">&gt;&gt;</span><span class="ident" id="3032912">Msize1</span>&nbsp;<span class="op" id="3032919">!=</span>&nbsp;<span class="num" id="3032922">1</span>&nbsp;<span class="op" id="3032924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3032928">panic</span><span class="op" id="3032933">(</span><span class="ident" id="3032934">fmt</span><span class="op" id="3032937">.</span><span class="ident" id="3032938">Sprintf</span><span class="op" id="3032945">(</span><span class="string" id="3032946">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3032982">,</span>&nbsp;<span class="ident" id="3032984">Msize2</span><span class="op" id="3032990">)</span><span class="op" id="3032991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3032994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3032998">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3033015">if</span>&nbsp;<span class="ident" id="3033018">Emin</span><span class="op" id="3033022">-</span><span class="ident" id="3033023">Msize</span>&nbsp;<span class="op" id="3033029">&lt;=</span>&nbsp;<span class="ident" id="3033032">exp</span>&nbsp;<span class="op" id="3033036">&amp;&amp;</span>&nbsp;<span class="ident" id="3033039">exp</span>&nbsp;<span class="op" id="3033043">&lt;=</span>&nbsp;<span class="ident" id="3033046">Emin</span>&nbsp;<span class="op" id="3033051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3033055">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033107">shift</span>&nbsp;<span class="op" id="3033113">:=</span>&nbsp;<span class="builtintype" id="3033116">uint</span><span class="op" id="3033120">(</span><span class="ident" id="3033121">Emin</span>&nbsp;<span class="op" id="3033126">-</span>&nbsp;<span class="op" id="3033128">(</span><span class="ident" id="3033129">exp</span>&nbsp;<span class="op" id="3033133">-</span>&nbsp;<span class="num" id="3033135">1</span><span class="op" id="3033136">)</span><span class="op" id="3033137">)</span>&nbsp;<span class="comment" id="3033139">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033156">lostbits</span>&nbsp;<span class="op" id="3033165">:=</span>&nbsp;<span class="ident" id="3033168">mantissa</span>&nbsp;<span class="op" id="3033177">&amp;</span>&nbsp;<span class="op" id="3033179">(</span><span class="num" id="3033180">1</span><span class="op" id="3033181">&lt;&lt;</span><span class="ident" id="3033183">shift</span>&nbsp;<span class="op" id="3033189">-</span>&nbsp;<span class="num" id="3033191">1</span><span class="op" id="3033192">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033196">haveRem</span>&nbsp;<span class="op" id="3033204">=</span>&nbsp;<span class="ident" id="3033206">haveRem</span>&nbsp;<span class="op" id="3033214">||</span>&nbsp;<span class="ident" id="3033217">lostbits</span>&nbsp;<span class="op" id="3033226">!=</span>&nbsp;<span class="num" id="3033229">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033233">mantissa</span>&nbsp;<span class="op" id="3033242">&gt;&gt;=</span>&nbsp;<span class="ident" id="3033246">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033254">exp</span>&nbsp;<span class="op" id="3033258">=</span>&nbsp;<span class="num" id="3033260">2</span>&nbsp;<span class="op" id="3033262">-</span>&nbsp;<span class="ident" id="3033264">Ebias</span>&nbsp;<span class="comment" id="3033270">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3033289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3033292">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033330">exact</span>&nbsp;<span class="op" id="3033336">=</span>&nbsp;<span class="op" id="3033338">!</span><span class="ident" id="3033339">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3033348">if</span>&nbsp;<span class="ident" id="3033351">mantissa</span><span class="op" id="3033359">&amp;</span><span class="num" id="3033360">1</span>&nbsp;<span class="op" id="3033362">!=</span>&nbsp;<span class="num" id="3033365">0</span>&nbsp;<span class="op" id="3033367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033371">exact</span>&nbsp;<span class="op" id="3033377">=</span>&nbsp;<span class="builtintype" id="3033379">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3033387">if</span>&nbsp;<span class="ident" id="3033390">haveRem</span>&nbsp;<span class="op" id="3033398">||</span>&nbsp;<span class="ident" id="3033401">mantissa</span><span class="op" id="3033409">&amp;</span><span class="num" id="3033410">2</span>&nbsp;<span class="op" id="3033412">!=</span>&nbsp;<span class="num" id="3033415">0</span>&nbsp;<span class="op" id="3033417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3033422">if</span>&nbsp;<span class="ident" id="3033425">mantissa</span><span class="op" id="3033433">++</span><span class="op" id="3033435">;</span>&nbsp;<span class="ident" id="3033437">mantissa</span>&nbsp;<span class="op" id="3033446">&gt;=</span>&nbsp;<span class="num" id="3033449">1</span><span class="op" id="3033450">&lt;&lt;</span><span class="ident" id="3033452">Msize2</span>&nbsp;<span class="op" id="3033459">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3033465">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033526">mantissa</span>&nbsp;<span class="op" id="3033535">&gt;&gt;=</span>&nbsp;<span class="num" id="3033539">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033545">exp</span><span class="op" id="3033548">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3033554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3033558">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3033561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033564">mantissa</span>&nbsp;<span class="op" id="3033573">&gt;&gt;=</span>&nbsp;<span class="num" id="3033577">1</span>&nbsp;<span class="comment" id="3033579">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033641">f</span>&nbsp;<span class="op" id="3033643">=</span>&nbsp;<span class="builtintype" id="3033645">float32</span><span class="op" id="3033652">(</span><span class="ident" id="3033653">math</span><span class="op" id="3033657">.</span><span class="ident" id="3033658">Ldexp</span><span class="op" id="3033663">(</span><span class="builtintype" id="3033664">float64</span><span class="op" id="3033671">(</span><span class="ident" id="3033672">mantissa</span><span class="op" id="3033680">)</span><span class="op" id="3033681">,</span>&nbsp;<span class="ident" id="3033683">exp</span><span class="op" id="3033686">-</span><span class="ident" id="3033687">Msize1</span><span class="op" id="3033693">)</span><span class="op" id="3033694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3033697">if</span>&nbsp;<span class="ident" id="3033700">math</span><span class="op" id="3033704">.</span><span class="ident" id="3033705">IsInf</span><span class="op" id="3033710">(</span><span class="builtintype" id="3033711">float64</span><span class="op" id="3033718">(</span><span class="ident" id="3033719">f</span><span class="op" id="3033720">)</span><span class="op" id="3033721">,</span>&nbsp;<span class="num" id="3033723">0</span><span class="op" id="3033724">)</span>&nbsp;<span class="op" id="3033726">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033730">exact</span>&nbsp;<span class="op" id="3033736">=</span>&nbsp;<span class="builtintype" id="3033738">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3033745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3033748">return</span><br>
<span class="lineno"></span><span class="op" id="3033755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3033758">//&nbsp;quotToFloat64&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float64&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3033814">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3033869">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="3033922">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3033987">func</span>&nbsp;<span class="ident" id="3033992">quotToFloat64</span><span class="op" id="3034005">(</span><span class="ident" id="3034006">a</span><span class="op" id="3034007">,</span>&nbsp;<span class="ident" id="3034009">b</span>&nbsp;<span class="ident" id="3034011">nat</span><span class="op" id="3034014">)</span>&nbsp;<span class="op" id="3034016">(</span><span class="ident" id="3034017">f</span>&nbsp;<span class="builtintype" id="3034019">float64</span><span class="op" id="3034026">,</span>&nbsp;<span class="ident" id="3034028">exact</span>&nbsp;<span class="builtintype" id="3034034">bool</span><span class="op" id="3034038">)</span>&nbsp;<span class="op" id="3034040">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034043">const</span>&nbsp;<span class="op" id="3034049">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034053">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034077">Fsize</span>&nbsp;<span class="op" id="3034083">=</span>&nbsp;<span class="num" id="3034085">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034091">//&nbsp;mantissa</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034105">Msize</span>&nbsp;&nbsp;<span class="op" id="3034112">=</span>&nbsp;<span class="num" id="3034114">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034119">Msize1</span>&nbsp;<span class="op" id="3034126">=</span>&nbsp;<span class="ident" id="3034128">Msize</span>&nbsp;<span class="op" id="3034134">+</span>&nbsp;<span class="num" id="3034136">1</span>&nbsp;<span class="comment" id="3034138">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034160">Msize2</span>&nbsp;<span class="op" id="3034167">=</span>&nbsp;<span class="ident" id="3034169">Msize1</span>&nbsp;<span class="op" id="3034176">+</span>&nbsp;<span class="num" id="3034178">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034183">//&nbsp;exponent</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034197">Esize</span>&nbsp;<span class="op" id="3034203">=</span>&nbsp;<span class="ident" id="3034205">Fsize</span>&nbsp;<span class="op" id="3034211">-</span>&nbsp;<span class="ident" id="3034213">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034222">Ebias</span>&nbsp;<span class="op" id="3034228">=</span>&nbsp;<span class="num" id="3034230">1</span><span class="op" id="3034231">&lt;&lt;</span><span class="op" id="3034233">(</span><span class="ident" id="3034234">Esize</span><span class="op" id="3034239">-</span><span class="num" id="3034240">1</span><span class="op" id="3034241">)</span>&nbsp;<span class="op" id="3034243">-</span>&nbsp;<span class="num" id="3034245">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034249">Emin</span>&nbsp;&nbsp;<span class="op" id="3034255">=</span>&nbsp;<span class="num" id="3034257">1</span>&nbsp;<span class="op" id="3034259">-</span>&nbsp;<span class="ident" id="3034261">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034269">Emax</span>&nbsp;&nbsp;<span class="op" id="3034275">=</span>&nbsp;<span class="ident" id="3034277">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3034284">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034288">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034359">alen</span>&nbsp;<span class="op" id="3034364">:=</span>&nbsp;<span class="ident" id="3034367">a</span><span class="op" id="3034368">.</span><span class="ident" id="3034369">bitLen</span><span class="op" id="3034375">(</span><span class="op" id="3034376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034379">if</span>&nbsp;<span class="ident" id="3034382">alen</span>&nbsp;<span class="op" id="3034387">==</span>&nbsp;<span class="num" id="3034390">0</span>&nbsp;<span class="op" id="3034392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034396">return</span>&nbsp;<span class="num" id="3034403">0</span><span class="op" id="3034404">,</span>&nbsp;<span class="builtintype" id="3034406">true</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3034412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034415">blen</span>&nbsp;<span class="op" id="3034420">:=</span>&nbsp;<span class="ident" id="3034423">b</span><span class="op" id="3034424">.</span><span class="ident" id="3034425">bitLen</span><span class="op" id="3034431">(</span><span class="op" id="3034432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034435">if</span>&nbsp;<span class="ident" id="3034438">blen</span>&nbsp;<span class="op" id="3034443">==</span>&nbsp;<span class="num" id="3034446">0</span>&nbsp;<span class="op" id="3034448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3034452">panic</span><span class="op" id="3034457">(</span><span class="string" id="3034458">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3034476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3034479">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034483">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034563">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034643">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float64&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034715">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034777">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034839">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034906">exp</span>&nbsp;<span class="op" id="3034910">:=</span>&nbsp;<span class="ident" id="3034913">alen</span>&nbsp;<span class="op" id="3034918">-</span>&nbsp;<span class="ident" id="3034920">blen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034926">var</span>&nbsp;<span class="ident" id="3034930">a2</span><span class="op" id="3034932">,</span>&nbsp;<span class="ident" id="3034934">b2</span>&nbsp;<span class="ident" id="3034937">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034942">a2</span>&nbsp;<span class="op" id="3034945">=</span>&nbsp;<span class="ident" id="3034947">a2</span><span class="op" id="3034949">.</span><span class="ident" id="3034950">set</span><span class="op" id="3034953">(</span><span class="ident" id="3034954">a</span><span class="op" id="3034955">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034958">b2</span>&nbsp;<span class="op" id="3034961">=</span>&nbsp;<span class="ident" id="3034963">b2</span><span class="op" id="3034965">.</span><span class="ident" id="3034966">set</span><span class="op" id="3034969">(</span><span class="ident" id="3034970">b</span><span class="op" id="3034971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034974">if</span>&nbsp;<span class="ident" id="3034977">shift</span>&nbsp;<span class="op" id="3034983">:=</span>&nbsp;<span class="ident" id="3034986">Msize2</span>&nbsp;<span class="op" id="3034993">-</span>&nbsp;<span class="ident" id="3034995">exp</span><span class="op" id="3034998">;</span>&nbsp;<span class="ident" id="3035000">shift</span>&nbsp;<span class="op" id="3035006">&gt;</span>&nbsp;<span class="num" id="3035008">0</span>&nbsp;<span class="op" id="3035010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035014">a2</span>&nbsp;<span class="op" id="3035017">=</span>&nbsp;<span class="ident" id="3035019">a2</span><span class="op" id="3035021">.</span><span class="ident" id="3035022">shl</span><span class="op" id="3035025">(</span><span class="ident" id="3035026">a2</span><span class="op" id="3035028">,</span>&nbsp;<span class="builtintype" id="3035030">uint</span><span class="op" id="3035034">(</span><span class="ident" id="3035035">shift</span><span class="op" id="3035040">)</span><span class="op" id="3035041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035044">}</span>&nbsp;<span class="keyword" id="3035046">else</span>&nbsp;<span class="keyword" id="3035051">if</span>&nbsp;<span class="ident" id="3035054">shift</span>&nbsp;<span class="op" id="3035060">&lt;</span>&nbsp;<span class="num" id="3035062">0</span>&nbsp;<span class="op" id="3035064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035068">b2</span>&nbsp;<span class="op" id="3035071">=</span>&nbsp;<span class="ident" id="3035073">b2</span><span class="op" id="3035075">.</span><span class="ident" id="3035076">shl</span><span class="op" id="3035079">(</span><span class="ident" id="3035080">b2</span><span class="op" id="3035082">,</span>&nbsp;<span class="builtintype" id="3035084">uint</span><span class="op" id="3035088">(</span><span class="op" id="3035089">-</span><span class="ident" id="3035090">shift</span><span class="op" id="3035095">)</span><span class="op" id="3035096">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035103">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035165">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035222">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035247">var</span>&nbsp;<span class="ident" id="3035251">q</span>&nbsp;<span class="ident" id="3035253">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035258">q</span><span class="op" id="3035259">,</span>&nbsp;<span class="ident" id="3035261">r</span>&nbsp;<span class="op" id="3035263">:=</span>&nbsp;<span class="ident" id="3035266">q</span><span class="op" id="3035267">.</span><span class="ident" id="3035268">div</span><span class="op" id="3035271">(</span><span class="ident" id="3035272">a2</span><span class="op" id="3035274">,</span>&nbsp;<span class="ident" id="3035276">a2</span><span class="op" id="3035278">,</span>&nbsp;<span class="ident" id="3035280">b2</span><span class="op" id="3035282">)</span>&nbsp;<span class="comment" id="3035284">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035301">mantissa</span>&nbsp;<span class="op" id="3035310">:=</span>&nbsp;<span class="ident" id="3035313">low64</span><span class="op" id="3035318">(</span><span class="ident" id="3035319">q</span><span class="op" id="3035320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035323">haveRem</span>&nbsp;<span class="op" id="3035331">:=</span>&nbsp;<span class="builtinfunc" id="3035334">len</span><span class="op" id="3035337">(</span><span class="ident" id="3035338">r</span><span class="op" id="3035339">)</span>&nbsp;<span class="op" id="3035341">&gt;</span>&nbsp;<span class="num" id="3035343">0</span>&nbsp;<span class="comment" id="3035345">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035402">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035471">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035523">if</span>&nbsp;<span class="ident" id="3035526">mantissa</span><span class="op" id="3035534">&gt;&gt;</span><span class="ident" id="3035536">Msize2</span>&nbsp;<span class="op" id="3035543">==</span>&nbsp;<span class="num" id="3035546">1</span>&nbsp;<span class="op" id="3035548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035552">if</span>&nbsp;<span class="ident" id="3035555">mantissa</span><span class="op" id="3035563">&amp;</span><span class="num" id="3035564">1</span>&nbsp;<span class="op" id="3035566">==</span>&nbsp;<span class="num" id="3035569">1</span>&nbsp;<span class="op" id="3035571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035576">haveRem</span>&nbsp;<span class="op" id="3035584">=</span>&nbsp;<span class="builtintype" id="3035586">true</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035597">mantissa</span>&nbsp;<span class="op" id="3035606">&gt;&gt;=</span>&nbsp;<span class="num" id="3035610">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035614">exp</span><span class="op" id="3035617">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035624">if</span>&nbsp;<span class="ident" id="3035627">mantissa</span><span class="op" id="3035635">&gt;&gt;</span><span class="ident" id="3035637">Msize1</span>&nbsp;<span class="op" id="3035644">!=</span>&nbsp;<span class="num" id="3035647">1</span>&nbsp;<span class="op" id="3035649">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3035653">panic</span><span class="op" id="3035658">(</span><span class="ident" id="3035659">fmt</span><span class="op" id="3035662">.</span><span class="ident" id="3035663">Sprintf</span><span class="op" id="3035670">(</span><span class="string" id="3035671">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3035707">,</span>&nbsp;<span class="ident" id="3035709">Msize2</span><span class="op" id="3035715">)</span><span class="op" id="3035716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035723">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035740">if</span>&nbsp;<span class="ident" id="3035743">Emin</span><span class="op" id="3035747">-</span><span class="ident" id="3035748">Msize</span>&nbsp;<span class="op" id="3035754">&lt;=</span>&nbsp;<span class="ident" id="3035757">exp</span>&nbsp;<span class="op" id="3035761">&amp;&amp;</span>&nbsp;<span class="ident" id="3035764">exp</span>&nbsp;<span class="op" id="3035768">&lt;=</span>&nbsp;<span class="ident" id="3035771">Emin</span>&nbsp;<span class="op" id="3035776">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035780">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035832">shift</span>&nbsp;<span class="op" id="3035838">:=</span>&nbsp;<span class="builtintype" id="3035841">uint</span><span class="op" id="3035845">(</span><span class="ident" id="3035846">Emin</span>&nbsp;<span class="op" id="3035851">-</span>&nbsp;<span class="op" id="3035853">(</span><span class="ident" id="3035854">exp</span>&nbsp;<span class="op" id="3035858">-</span>&nbsp;<span class="num" id="3035860">1</span><span class="op" id="3035861">)</span><span class="op" id="3035862">)</span>&nbsp;<span class="comment" id="3035864">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035881">lostbits</span>&nbsp;<span class="op" id="3035890">:=</span>&nbsp;<span class="ident" id="3035893">mantissa</span>&nbsp;<span class="op" id="3035902">&amp;</span>&nbsp;<span class="op" id="3035904">(</span><span class="num" id="3035905">1</span><span class="op" id="3035906">&lt;&lt;</span><span class="ident" id="3035908">shift</span>&nbsp;<span class="op" id="3035914">-</span>&nbsp;<span class="num" id="3035916">1</span><span class="op" id="3035917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035921">haveRem</span>&nbsp;<span class="op" id="3035929">=</span>&nbsp;<span class="ident" id="3035931">haveRem</span>&nbsp;<span class="op" id="3035939">||</span>&nbsp;<span class="ident" id="3035942">lostbits</span>&nbsp;<span class="op" id="3035951">!=</span>&nbsp;<span class="num" id="3035954">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035958">mantissa</span>&nbsp;<span class="op" id="3035967">&gt;&gt;=</span>&nbsp;<span class="ident" id="3035971">shift</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035979">exp</span>&nbsp;<span class="op" id="3035983">=</span>&nbsp;<span class="num" id="3035985">2</span>&nbsp;<span class="op" id="3035987">-</span>&nbsp;<span class="ident" id="3035989">Ebias</span>&nbsp;<span class="comment" id="3035995">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3036014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3036017">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3036055">exact</span>&nbsp;<span class="op" id="3036061">=</span>&nbsp;<span class="op" id="3036063">!</span><span class="ident" id="3036064">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036073">if</span>&nbsp;<span class="ident" id="3036076">mantissa</span><span class="op" id="3036084">&amp;</span><span class="num" id="3036085">1</span>&nbsp;<span class="op" id="3036087">!=</span>&nbsp;<span class="num" id="3036090">0</span>&nbsp;<span class="op" id="3036092">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3036096">exact</span>&nbsp;<span class="op" id="3036102">=</span>&nbsp;<span class="builtintype" id="3036104">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036112">if</span>&nbsp;<span class="ident" id="3036115">haveRem</span>&nbsp;<span class="op" id="3036123">||</span>&nbsp;<span class="ident" id="3036126">mantissa</span><span class="op" id="3036134">&amp;</span><span class="num" id="3036135">2</span>&nbsp;<span class="op" id="3036137">!=</span>&nbsp;<span class="num" id="3036140">0</span>&nbsp;<span class="op" id="3036142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036147">if</span>&nbsp;<span class="ident" id="3036150">mantissa</span><span class="op" id="3036158">++</span><span class="op" id="3036160">;</span>&nbsp;<span class="ident" id="3036162">mantissa</span>&nbsp;<span class="op" id="3036171">&gt;=</span>&nbsp;<span class="num" id="3036174">1</span><span class="op" id="3036175">&lt;&lt;</span><span class="ident" id="3036177">Msize2</span>&nbsp;<span class="op" id="3036184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3036190">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3036251">mantissa</span>&nbsp;<span class="op" id="3036260">&gt;&gt;=</span>&nbsp;<span class="num" id="3036264">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3036270">exp</span><span class="op" id="3036273">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3036279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3036283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3036286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3036289">mantissa</span>&nbsp;<span class="op" id="3036298">&gt;&gt;=</span>&nbsp;<span class="num" id="3036302">1</span>&nbsp;<span class="comment" id="3036304">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3036366">f</span>&nbsp;<span class="op" id="3036368">=</span>&nbsp;<span class="ident" id="3036370">math</span><span class="op" id="3036374">.</span><span class="ident" id="3036375">Ldexp</span><span class="op" id="3036380">(</span><span class="builtintype" id="3036381">float64</span><span class="op" id="3036388">(</span><span class="ident" id="3036389">mantissa</span><span class="op" id="3036397">)</span><span class="op" id="3036398">,</span>&nbsp;<span class="ident" id="3036400">exp</span><span class="op" id="3036403">-</span><span class="ident" id="3036404">Msize1</span><span class="op" id="3036410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036413">if</span>&nbsp;<span class="ident" id="3036416">math</span><span class="op" id="3036420">.</span><span class="ident" id="3036421">IsInf</span><span class="op" id="3036426">(</span><span class="ident" id="3036427">f</span><span class="op" id="3036428">,</span>&nbsp;<span class="num" id="3036430">0</span><span class="op" id="3036431">)</span>&nbsp;<span class="op" id="3036433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3036437">exact</span>&nbsp;<span class="op" id="3036443">=</span>&nbsp;<span class="builtintype" id="3036445">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3036452">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036455">return</span><br>
<span class="lineno"></span><span class="op" id="3036462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3036465">//&nbsp;Float32&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float32&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3036538">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno">265</span><span class="comment" id="3036611">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float32,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3036680">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3036743">func</span>&nbsp;<span class="op" id="3036748">(</span><span class="ident" id="3036749">x</span>&nbsp;<span class="op" id="3036751">*</span><span class="ident" id="3036752">Rat</span><span class="op" id="3036755">)</span>&nbsp;<span class="ident" id="3036757">Float32</span><span class="op" id="3036764">(</span><span class="op" id="3036765">)</span>&nbsp;<span class="op" id="3036767">(</span><span class="ident" id="3036768">f</span>&nbsp;<span class="builtintype" id="3036770">float32</span><span class="op" id="3036777">,</span>&nbsp;<span class="ident" id="3036779">exact</span>&nbsp;<span class="builtintype" id="3036785">bool</span><span class="op" id="3036789">)</span>&nbsp;<span class="op" id="3036791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3036794">b</span>&nbsp;<span class="op" id="3036796">:=</span>&nbsp;<span class="ident" id="3036799">x</span><span class="op" id="3036800">.</span><span class="ident" id="3036801">b</span><span class="op" id="3036802">.</span><span class="ident" id="3036803">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036808">if</span>&nbsp;<span class="builtinfunc" id="3036811">len</span><span class="op" id="3036814">(</span><span class="ident" id="3036815">b</span><span class="op" id="3036816">)</span>&nbsp;<span class="op" id="3036818">==</span>&nbsp;<span class="num" id="3036821">0</span>&nbsp;<span class="op" id="3036823">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3036827">b</span>&nbsp;<span class="op" id="3036829">=</span>&nbsp;<span class="ident" id="3036831">b</span><span class="op" id="3036832">.</span><span class="ident" id="3036833">set</span><span class="op" id="3036836">(</span><span class="ident" id="3036837">natOne</span><span class="op" id="3036843">)</span>&nbsp;<span class="comment" id="3036845">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3036873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3036876">f</span><span class="op" id="3036877">,</span>&nbsp;<span class="ident" id="3036879">exact</span>&nbsp;<span class="op" id="3036885">=</span>&nbsp;<span class="ident" id="3036887">quotToFloat32</span><span class="op" id="3036900">(</span><span class="ident" id="3036901">x</span><span class="op" id="3036902">.</span><span class="ident" id="3036903">a</span><span class="op" id="3036904">.</span><span class="ident" id="3036905">abs</span><span class="op" id="3036908">,</span>&nbsp;<span class="ident" id="3036910">b</span><span class="op" id="3036911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036914">if</span>&nbsp;<span class="ident" id="3036917">x</span><span class="op" id="3036918">.</span><span class="ident" id="3036919">a</span><span class="op" id="3036920">.</span><span class="ident" id="3036921">neg</span>&nbsp;<span class="op" id="3036925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3036929">f</span>&nbsp;<span class="op" id="3036931">=</span>&nbsp;<span class="op" id="3036933">-</span><span class="ident" id="3036934">f</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3036937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036940">return</span><br>
<span class="lineno"></span><span class="op" id="3036947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3036950">//&nbsp;Float64&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float64&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno">280</span><span class="comment" id="3037023">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3037096">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float64,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3037165">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3037228">func</span>&nbsp;<span class="op" id="3037233">(</span><span class="ident" id="3037234">x</span>&nbsp;<span class="op" id="3037236">*</span><span class="ident" id="3037237">Rat</span><span class="op" id="3037240">)</span>&nbsp;<span class="ident" id="3037242">Float64</span><span class="op" id="3037249">(</span><span class="op" id="3037250">)</span>&nbsp;<span class="op" id="3037252">(</span><span class="ident" id="3037253">f</span>&nbsp;<span class="builtintype" id="3037255">float64</span><span class="op" id="3037262">,</span>&nbsp;<span class="ident" id="3037264">exact</span>&nbsp;<span class="builtintype" id="3037270">bool</span><span class="op" id="3037274">)</span>&nbsp;<span class="op" id="3037276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037279">b</span>&nbsp;<span class="op" id="3037281">:=</span>&nbsp;<span class="ident" id="3037284">x</span><span class="op" id="3037285">.</span><span class="ident" id="3037286">b</span><span class="op" id="3037287">.</span><span class="ident" id="3037288">abs</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3037293">if</span>&nbsp;<span class="builtinfunc" id="3037296">len</span><span class="op" id="3037299">(</span><span class="ident" id="3037300">b</span><span class="op" id="3037301">)</span>&nbsp;<span class="op" id="3037303">==</span>&nbsp;<span class="num" id="3037306">0</span>&nbsp;<span class="op" id="3037308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037312">b</span>&nbsp;<span class="op" id="3037314">=</span>&nbsp;<span class="ident" id="3037316">b</span><span class="op" id="3037317">.</span><span class="ident" id="3037318">set</span><span class="op" id="3037321">(</span><span class="ident" id="3037322">natOne</span><span class="op" id="3037328">)</span>&nbsp;<span class="comment" id="3037330">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3037358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037361">f</span><span class="op" id="3037362">,</span>&nbsp;<span class="ident" id="3037364">exact</span>&nbsp;<span class="op" id="3037370">=</span>&nbsp;<span class="ident" id="3037372">quotToFloat64</span><span class="op" id="3037385">(</span><span class="ident" id="3037386">x</span><span class="op" id="3037387">.</span><span class="ident" id="3037388">a</span><span class="op" id="3037389">.</span><span class="ident" id="3037390">abs</span><span class="op" id="3037393">,</span>&nbsp;<span class="ident" id="3037395">b</span><span class="op" id="3037396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3037399">if</span>&nbsp;<span class="ident" id="3037402">x</span><span class="op" id="3037403">.</span><span class="ident" id="3037404">a</span><span class="op" id="3037405">.</span><span class="ident" id="3037406">neg</span>&nbsp;<span class="op" id="3037410">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037414">f</span>&nbsp;<span class="op" id="3037416">=</span>&nbsp;<span class="op" id="3037418">-</span><span class="ident" id="3037419">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3037422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3037425">return</span><br>
<span class="lineno"></span><span class="op" id="3037432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="3037435">//&nbsp;SetFrac&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3037475">func</span>&nbsp;<span class="op" id="3037480">(</span><span class="ident" id="3037481">z</span>&nbsp;<span class="op" id="3037483">*</span><span class="ident" id="3037484">Rat</span><span class="op" id="3037487">)</span>&nbsp;<span class="ident" id="3037489">SetFrac</span><span class="op" id="3037496">(</span><span class="ident" id="3037497">a</span><span class="op" id="3037498">,</span>&nbsp;<span class="ident" id="3037500">b</span>&nbsp;<span class="op" id="3037502">*</span><span class="ident" id="3037503">Int</span><span class="op" id="3037506">)</span>&nbsp;<span class="op" id="3037508">*</span><span class="ident" id="3037509">Rat</span>&nbsp;<span class="op" id="3037513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037516">z</span><span class="op" id="3037517">.</span><span class="ident" id="3037518">a</span><span class="op" id="3037519">.</span><span class="ident" id="3037520">neg</span>&nbsp;<span class="op" id="3037524">=</span>&nbsp;<span class="ident" id="3037526">a</span><span class="op" id="3037527">.</span><span class="ident" id="3037528">neg</span>&nbsp;<span class="op" id="3037532">!=</span>&nbsp;<span class="ident" id="3037535">b</span><span class="op" id="3037536">.</span><span class="ident" id="3037537">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037542">babs</span>&nbsp;<span class="op" id="3037547">:=</span>&nbsp;<span class="ident" id="3037550">b</span><span class="op" id="3037551">.</span><span class="ident" id="3037552">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3037557">if</span>&nbsp;<span class="builtinfunc" id="3037560">len</span><span class="op" id="3037563">(</span><span class="ident" id="3037564">babs</span><span class="op" id="3037568">)</span>&nbsp;<span class="op" id="3037570">==</span>&nbsp;<span class="num" id="3037573">0</span>&nbsp;<span class="op" id="3037575">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3037579">panic</span><span class="op" id="3037584">(</span><span class="string" id="3037585">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3037603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3037606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3037609">if</span>&nbsp;<span class="op" id="3037612">&amp;</span><span class="ident" id="3037613">z</span><span class="op" id="3037614">.</span><span class="ident" id="3037615">a</span>&nbsp;<span class="op" id="3037617">==</span>&nbsp;<span class="ident" id="3037620">b</span>&nbsp;<span class="op" id="3037622">||</span>&nbsp;<span class="ident" id="3037625">alias</span><span class="op" id="3037630">(</span><span class="ident" id="3037631">z</span><span class="op" id="3037632">.</span><span class="ident" id="3037633">a</span><span class="op" id="3037634">.</span><span class="ident" id="3037635">abs</span><span class="op" id="3037638">,</span>&nbsp;<span class="ident" id="3037640">babs</span><span class="op" id="3037644">)</span>&nbsp;<span class="op" id="3037646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037650">babs</span>&nbsp;<span class="op" id="3037655">=</span>&nbsp;<span class="ident" id="3037657">nat</span><span class="op" id="3037660">(</span><span class="builtintype" id="3037661">nil</span><span class="op" id="3037664">)</span><span class="op" id="3037665">.</span><span class="ident" id="3037666">set</span><span class="op" id="3037669">(</span><span class="ident" id="3037670">babs</span><span class="op" id="3037674">)</span>&nbsp;<span class="comment" id="3037676">//&nbsp;make&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3037692">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037695">z</span><span class="op" id="3037696">.</span><span class="ident" id="3037697">a</span><span class="op" id="3037698">.</span><span class="ident" id="3037699">abs</span>&nbsp;<span class="op" id="3037703">=</span>&nbsp;<span class="ident" id="3037705">z</span><span class="op" id="3037706">.</span><span class="ident" id="3037707">a</span><span class="op" id="3037708">.</span><span class="ident" id="3037709">abs</span><span class="op" id="3037712">.</span><span class="ident" id="3037713">set</span><span class="op" id="3037716">(</span><span class="ident" id="3037717">a</span><span class="op" id="3037718">.</span><span class="ident" id="3037719">abs</span><span class="op" id="3037722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037725">z</span><span class="op" id="3037726">.</span><span class="ident" id="3037727">b</span><span class="op" id="3037728">.</span><span class="ident" id="3037729">abs</span>&nbsp;<span class="op" id="3037733">=</span>&nbsp;<span class="ident" id="3037735">z</span><span class="op" id="3037736">.</span><span class="ident" id="3037737">b</span><span class="op" id="3037738">.</span><span class="ident" id="3037739">abs</span><span class="op" id="3037742">.</span><span class="ident" id="3037743">set</span><span class="op" id="3037746">(</span><span class="ident" id="3037747">babs</span><span class="op" id="3037751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3037754">return</span>&nbsp;<span class="ident" id="3037761">z</span><span class="op" id="3037762">.</span><span class="ident" id="3037763">norm</span><span class="op" id="3037767">(</span><span class="op" id="3037768">)</span><br>
<span class="lineno"></span><span class="op" id="3037770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="3037773">//&nbsp;SetFrac64&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3037815">func</span>&nbsp;<span class="op" id="3037820">(</span><span class="ident" id="3037821">z</span>&nbsp;<span class="op" id="3037823">*</span><span class="ident" id="3037824">Rat</span><span class="op" id="3037827">)</span>&nbsp;<span class="ident" id="3037829">SetFrac64</span><span class="op" id="3037838">(</span><span class="ident" id="3037839">a</span><span class="op" id="3037840">,</span>&nbsp;<span class="ident" id="3037842">b</span>&nbsp;<span class="ident" id="3037844">int64</span><span class="op" id="3037849">)</span>&nbsp;<span class="op" id="3037851">*</span><span class="ident" id="3037852">Rat</span>&nbsp;<span class="op" id="3037856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037859">z</span><span class="op" id="3037860">.</span><span class="ident" id="3037861">a</span><span class="op" id="3037862">.</span><span class="ident" id="3037863">SetInt64</span><span class="op" id="3037871">(</span><span class="ident" id="3037872">a</span><span class="op" id="3037873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3037876">if</span>&nbsp;<span class="ident" id="3037879">b</span>&nbsp;<span class="op" id="3037881">==</span>&nbsp;<span class="num" id="3037884">0</span>&nbsp;<span class="op" id="3037886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3037890">panic</span><span class="op" id="3037895">(</span><span class="string" id="3037896">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3037914">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3037917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3037920">if</span>&nbsp;<span class="ident" id="3037923">b</span>&nbsp;<span class="op" id="3037925">&lt;</span>&nbsp;<span class="num" id="3037927">0</span>&nbsp;<span class="op" id="3037929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037933">b</span>&nbsp;<span class="op" id="3037935">=</span>&nbsp;<span class="op" id="3037937">-</span><span class="ident" id="3037938">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037942">z</span><span class="op" id="3037943">.</span><span class="ident" id="3037944">a</span><span class="op" id="3037945">.</span><span class="ident" id="3037946">neg</span>&nbsp;<span class="op" id="3037950">=</span>&nbsp;<span class="op" id="3037952">!</span><span class="ident" id="3037953">z</span><span class="op" id="3037954">.</span><span class="ident" id="3037955">a</span><span class="op" id="3037956">.</span><span class="ident" id="3037957">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3037962">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037965">z</span><span class="op" id="3037966">.</span><span class="ident" id="3037967">b</span><span class="op" id="3037968">.</span><span class="ident" id="3037969">abs</span>&nbsp;<span class="op" id="3037973">=</span>&nbsp;<span class="ident" id="3037975">z</span><span class="op" id="3037976">.</span><span class="ident" id="3037977">b</span><span class="op" id="3037978">.</span><span class="ident" id="3037979">abs</span><span class="op" id="3037982">.</span><span class="ident" id="3037983">setUint64</span><span class="op" id="3037992">(</span><span class="ident" id="3037993">uint64</span><span class="op" id="3037999">(</span><span class="ident" id="3038000">b</span><span class="op" id="3038001">)</span><span class="op" id="3038002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038005">return</span>&nbsp;<span class="ident" id="3038012">z</span><span class="op" id="3038013">.</span><span class="ident" id="3038014">norm</span><span class="op" id="3038018">(</span><span class="op" id="3038019">)</span><br>
<span class="lineno"></span><span class="op" id="3038021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3038024">//&nbsp;SetInt&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">325</span><span class="keyword" id="3038085">func</span>&nbsp;<span class="op" id="3038090">(</span><span class="ident" id="3038091">z</span>&nbsp;<span class="op" id="3038093">*</span><span class="ident" id="3038094">Rat</span><span class="op" id="3038097">)</span>&nbsp;<span class="ident" id="3038099">SetInt</span><span class="op" id="3038105">(</span><span class="ident" id="3038106">x</span>&nbsp;<span class="op" id="3038108">*</span><span class="ident" id="3038109">Int</span><span class="op" id="3038112">)</span>&nbsp;<span class="op" id="3038114">*</span><span class="ident" id="3038115">Rat</span>&nbsp;<span class="op" id="3038119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038122">z</span><span class="op" id="3038123">.</span><span class="ident" id="3038124">a</span><span class="op" id="3038125">.</span><span class="ident" id="3038126">Set</span><span class="op" id="3038129">(</span><span class="ident" id="3038130">x</span><span class="op" id="3038131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038134">z</span><span class="op" id="3038135">.</span><span class="ident" id="3038136">b</span><span class="op" id="3038137">.</span><span class="ident" id="3038138">abs</span>&nbsp;<span class="op" id="3038142">=</span>&nbsp;<span class="ident" id="3038144">z</span><span class="op" id="3038145">.</span><span class="ident" id="3038146">b</span><span class="op" id="3038147">.</span><span class="ident" id="3038148">abs</span><span class="op" id="3038151">.</span><span class="builtinfunc" id="3038152">make</span><span class="op" id="3038156">(</span><span class="num" id="3038157">0</span><span class="op" id="3038158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038161">return</span>&nbsp;<span class="ident" id="3038168">z</span><br>
<span class="lineno"></span><span class="op" id="3038170">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3038173">//&nbsp;SetInt64&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3038212">func</span>&nbsp;<span class="op" id="3038217">(</span><span class="ident" id="3038218">z</span>&nbsp;<span class="op" id="3038220">*</span><span class="ident" id="3038221">Rat</span><span class="op" id="3038224">)</span>&nbsp;<span class="ident" id="3038226">SetInt64</span><span class="op" id="3038234">(</span><span class="ident" id="3038235">x</span>&nbsp;<span class="ident" id="3038237">int64</span><span class="op" id="3038242">)</span>&nbsp;<span class="op" id="3038244">*</span><span class="ident" id="3038245">Rat</span>&nbsp;<span class="op" id="3038249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038252">z</span><span class="op" id="3038253">.</span><span class="ident" id="3038254">a</span><span class="op" id="3038255">.</span><span class="ident" id="3038256">SetInt64</span><span class="op" id="3038264">(</span><span class="ident" id="3038265">x</span><span class="op" id="3038266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038269">z</span><span class="op" id="3038270">.</span><span class="ident" id="3038271">b</span><span class="op" id="3038272">.</span><span class="ident" id="3038273">abs</span>&nbsp;<span class="op" id="3038277">=</span>&nbsp;<span class="ident" id="3038279">z</span><span class="op" id="3038280">.</span><span class="ident" id="3038281">b</span><span class="op" id="3038282">.</span><span class="ident" id="3038283">abs</span><span class="op" id="3038286">.</span><span class="builtinfunc" id="3038287">make</span><span class="op" id="3038291">(</span><span class="num" id="3038292">0</span><span class="op" id="3038293">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038296">return</span>&nbsp;<span class="ident" id="3038303">z</span><br>
<span class="lineno"></span><span class="op" id="3038305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3038308">//&nbsp;Set&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3038366">func</span>&nbsp;<span class="op" id="3038371">(</span><span class="ident" id="3038372">z</span>&nbsp;<span class="op" id="3038374">*</span><span class="ident" id="3038375">Rat</span><span class="op" id="3038378">)</span>&nbsp;<span class="ident" id="3038380">Set</span><span class="op" id="3038383">(</span><span class="ident" id="3038384">x</span>&nbsp;<span class="op" id="3038386">*</span><span class="ident" id="3038387">Rat</span><span class="op" id="3038390">)</span>&nbsp;<span class="op" id="3038392">*</span><span class="ident" id="3038393">Rat</span>&nbsp;<span class="op" id="3038397">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038400">if</span>&nbsp;<span class="ident" id="3038403">z</span>&nbsp;<span class="op" id="3038405">!=</span>&nbsp;<span class="ident" id="3038408">x</span>&nbsp;<span class="op" id="3038410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038414">z</span><span class="op" id="3038415">.</span><span class="ident" id="3038416">a</span><span class="op" id="3038417">.</span><span class="ident" id="3038418">Set</span><span class="op" id="3038421">(</span><span class="op" id="3038422">&amp;</span><span class="ident" id="3038423">x</span><span class="op" id="3038424">.</span><span class="ident" id="3038425">a</span><span class="op" id="3038426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038430">z</span><span class="op" id="3038431">.</span><span class="ident" id="3038432">b</span><span class="op" id="3038433">.</span><span class="ident" id="3038434">Set</span><span class="op" id="3038437">(</span><span class="op" id="3038438">&amp;</span><span class="ident" id="3038439">x</span><span class="op" id="3038440">.</span><span class="ident" id="3038441">b</span><span class="op" id="3038442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3038445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038448">return</span>&nbsp;<span class="ident" id="3038455">z</span><br>
<span class="lineno">345</span><span class="op" id="3038457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3038460">//&nbsp;Abs&nbsp;sets&nbsp;z&nbsp;to&nbsp;|x|&nbsp;(the&nbsp;absolute&nbsp;value&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3038522">func</span>&nbsp;<span class="op" id="3038527">(</span><span class="ident" id="3038528">z</span>&nbsp;<span class="op" id="3038530">*</span><span class="ident" id="3038531">Rat</span><span class="op" id="3038534">)</span>&nbsp;<span class="ident" id="3038536">Abs</span><span class="op" id="3038539">(</span><span class="ident" id="3038540">x</span>&nbsp;<span class="op" id="3038542">*</span><span class="ident" id="3038543">Rat</span><span class="op" id="3038546">)</span>&nbsp;<span class="op" id="3038548">*</span><span class="ident" id="3038549">Rat</span>&nbsp;<span class="op" id="3038553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038556">z</span><span class="op" id="3038557">.</span><span class="ident" id="3038558">Set</span><span class="op" id="3038561">(</span><span class="ident" id="3038562">x</span><span class="op" id="3038563">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038566">z</span><span class="op" id="3038567">.</span><span class="ident" id="3038568">a</span><span class="op" id="3038569">.</span><span class="ident" id="3038570">neg</span>&nbsp;<span class="op" id="3038574">=</span>&nbsp;<span class="builtintype" id="3038576">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038583">return</span>&nbsp;<span class="ident" id="3038590">z</span><br>
<span class="lineno"></span><span class="op" id="3038592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3038595">//&nbsp;Neg&nbsp;sets&nbsp;z&nbsp;to&nbsp;-x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">355</span><span class="keyword" id="3038630">func</span>&nbsp;<span class="op" id="3038635">(</span><span class="ident" id="3038636">z</span>&nbsp;<span class="op" id="3038638">*</span><span class="ident" id="3038639">Rat</span><span class="op" id="3038642">)</span>&nbsp;<span class="ident" id="3038644">Neg</span><span class="op" id="3038647">(</span><span class="ident" id="3038648">x</span>&nbsp;<span class="op" id="3038650">*</span><span class="ident" id="3038651">Rat</span><span class="op" id="3038654">)</span>&nbsp;<span class="op" id="3038656">*</span><span class="ident" id="3038657">Rat</span>&nbsp;<span class="op" id="3038661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038664">z</span><span class="op" id="3038665">.</span><span class="ident" id="3038666">Set</span><span class="op" id="3038669">(</span><span class="ident" id="3038670">x</span><span class="op" id="3038671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038674">z</span><span class="op" id="3038675">.</span><span class="ident" id="3038676">a</span><span class="op" id="3038677">.</span><span class="ident" id="3038678">neg</span>&nbsp;<span class="op" id="3038682">=</span>&nbsp;<span class="builtinfunc" id="3038684">len</span><span class="op" id="3038687">(</span><span class="ident" id="3038688">z</span><span class="op" id="3038689">.</span><span class="ident" id="3038690">a</span><span class="op" id="3038691">.</span><span class="ident" id="3038692">abs</span><span class="op" id="3038695">)</span>&nbsp;<span class="op" id="3038697">&gt;</span>&nbsp;<span class="num" id="3038699">0</span>&nbsp;<span class="op" id="3038701">&amp;&amp;</span>&nbsp;<span class="op" id="3038704">!</span><span class="ident" id="3038705">z</span><span class="op" id="3038706">.</span><span class="ident" id="3038707">a</span><span class="op" id="3038708">.</span><span class="ident" id="3038709">neg</span>&nbsp;<span class="comment" id="3038713">//&nbsp;0&nbsp;has&nbsp;no&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038731">return</span>&nbsp;<span class="ident" id="3038738">z</span><br>
<span class="lineno"></span><span class="op" id="3038740">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="3038743">//&nbsp;Inv&nbsp;sets&nbsp;z&nbsp;to&nbsp;1/x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3038779">func</span>&nbsp;<span class="op" id="3038784">(</span><span class="ident" id="3038785">z</span>&nbsp;<span class="op" id="3038787">*</span><span class="ident" id="3038788">Rat</span><span class="op" id="3038791">)</span>&nbsp;<span class="ident" id="3038793">Inv</span><span class="op" id="3038796">(</span><span class="ident" id="3038797">x</span>&nbsp;<span class="op" id="3038799">*</span><span class="ident" id="3038800">Rat</span><span class="op" id="3038803">)</span>&nbsp;<span class="op" id="3038805">*</span><span class="ident" id="3038806">Rat</span>&nbsp;<span class="op" id="3038810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038813">if</span>&nbsp;<span class="builtinfunc" id="3038816">len</span><span class="op" id="3038819">(</span><span class="ident" id="3038820">x</span><span class="op" id="3038821">.</span><span class="ident" id="3038822">a</span><span class="op" id="3038823">.</span><span class="ident" id="3038824">abs</span><span class="op" id="3038827">)</span>&nbsp;<span class="op" id="3038829">==</span>&nbsp;<span class="num" id="3038832">0</span>&nbsp;<span class="op" id="3038834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3038838">panic</span><span class="op" id="3038843">(</span><span class="string" id="3038844">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3038862">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3038865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038868">z</span><span class="op" id="3038869">.</span><span class="ident" id="3038870">Set</span><span class="op" id="3038873">(</span><span class="ident" id="3038874">x</span><span class="op" id="3038875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038878">a</span>&nbsp;<span class="op" id="3038880">:=</span>&nbsp;<span class="ident" id="3038883">z</span><span class="op" id="3038884">.</span><span class="ident" id="3038885">b</span><span class="op" id="3038886">.</span><span class="ident" id="3038887">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038892">if</span>&nbsp;<span class="builtinfunc" id="3038895">len</span><span class="op" id="3038898">(</span><span class="ident" id="3038899">a</span><span class="op" id="3038900">)</span>&nbsp;<span class="op" id="3038902">==</span>&nbsp;<span class="num" id="3038905">0</span>&nbsp;<span class="op" id="3038907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038911">a</span>&nbsp;<span class="op" id="3038913">=</span>&nbsp;<span class="ident" id="3038915">a</span><span class="op" id="3038916">.</span><span class="ident" id="3038917">set</span><span class="op" id="3038920">(</span><span class="ident" id="3038921">natOne</span><span class="op" id="3038927">)</span>&nbsp;<span class="comment" id="3038929">//&nbsp;materialize&nbsp;numerator</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3038955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038958">b</span>&nbsp;<span class="op" id="3038960">:=</span>&nbsp;<span class="ident" id="3038963">z</span><span class="op" id="3038964">.</span><span class="ident" id="3038965">a</span><span class="op" id="3038966">.</span><span class="ident" id="3038967">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038972">if</span>&nbsp;<span class="ident" id="3038975">b</span><span class="op" id="3038976">.</span><span class="ident" id="3038977">cmp</span><span class="op" id="3038980">(</span><span class="ident" id="3038981">natOne</span><span class="op" id="3038987">)</span>&nbsp;<span class="op" id="3038989">==</span>&nbsp;<span class="num" id="3038992">0</span>&nbsp;<span class="op" id="3038994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038998">b</span>&nbsp;<span class="op" id="3039000">=</span>&nbsp;<span class="ident" id="3039002">b</span><span class="op" id="3039003">.</span><span class="builtinfunc" id="3039004">make</span><span class="op" id="3039008">(</span><span class="num" id="3039009">0</span><span class="op" id="3039010">)</span>&nbsp;<span class="comment" id="3039012">//&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3039038">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3039041">z</span><span class="op" id="3039042">.</span><span class="ident" id="3039043">a</span><span class="op" id="3039044">.</span><span class="ident" id="3039045">abs</span><span class="op" id="3039048">,</span>&nbsp;<span class="ident" id="3039050">z</span><span class="op" id="3039051">.</span><span class="ident" id="3039052">b</span><span class="op" id="3039053">.</span><span class="ident" id="3039054">abs</span>&nbsp;<span class="op" id="3039058">=</span>&nbsp;<span class="ident" id="3039060">a</span><span class="op" id="3039061">,</span>&nbsp;<span class="ident" id="3039063">b</span>&nbsp;<span class="comment" id="3039065">//&nbsp;sign&nbsp;doesn&#39;t&nbsp;change</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3039089">return</span>&nbsp;<span class="ident" id="3039096">z</span><br>
<span class="lineno"></span><span class="op" id="3039098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3039101">//&nbsp;Sign&nbsp;returns:</span><br>
<span class="lineno">380</span><span class="comment" id="3039118">//</span><br>
<span class="lineno"></span><span class="comment" id="3039121">//&nbsp;&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3039137">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3039153">//&nbsp;&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3039169">//</span><br>
<span class="lineno">385</span><span class="keyword" id="3039172">func</span>&nbsp;<span class="op" id="3039177">(</span><span class="ident" id="3039178">x</span>&nbsp;<span class="op" id="3039180">*</span><span class="ident" id="3039181">Rat</span><span class="op" id="3039184">)</span>&nbsp;<span class="ident" id="3039186">Sign</span><span class="op" id="3039190">(</span><span class="op" id="3039191">)</span>&nbsp;<span class="builtintype" id="3039193">int</span>&nbsp;<span class="op" id="3039197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3039200">return</span>&nbsp;<span class="ident" id="3039207">x</span><span class="op" id="3039208">.</span><span class="ident" id="3039209">a</span><span class="op" id="3039210">.</span><span class="ident" id="3039211">Sign</span><span class="op" id="3039215">(</span><span class="op" id="3039216">)</span><br>
<span class="lineno"></span><span class="op" id="3039218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3039221">//&nbsp;IsInt&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x&nbsp;is&nbsp;1.</span><br>
<span class="lineno">390</span><span class="keyword" id="3039273">func</span>&nbsp;<span class="op" id="3039278">(</span><span class="ident" id="3039279">x</span>&nbsp;<span class="op" id="3039281">*</span><span class="ident" id="3039282">Rat</span><span class="op" id="3039285">)</span>&nbsp;<span class="ident" id="3039287">IsInt</span><span class="op" id="3039292">(</span><span class="op" id="3039293">)</span>&nbsp;<span class="builtintype" id="3039295">bool</span>&nbsp;<span class="op" id="3039300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3039303">return</span>&nbsp;<span class="builtinfunc" id="3039310">len</span><span class="op" id="3039313">(</span><span class="ident" id="3039314">x</span><span class="op" id="3039315">.</span><span class="ident" id="3039316">b</span><span class="op" id="3039317">.</span><span class="ident" id="3039318">abs</span><span class="op" id="3039321">)</span>&nbsp;<span class="op" id="3039323">==</span>&nbsp;<span class="num" id="3039326">0</span>&nbsp;<span class="op" id="3039328">||</span>&nbsp;<span class="ident" id="3039331">x</span><span class="op" id="3039332">.</span><span class="ident" id="3039333">b</span><span class="op" id="3039334">.</span><span class="ident" id="3039335">abs</span><span class="op" id="3039338">.</span><span class="ident" id="3039339">cmp</span><span class="op" id="3039342">(</span><span class="ident" id="3039343">natOne</span><span class="op" id="3039349">)</span>&nbsp;<span class="op" id="3039351">==</span>&nbsp;<span class="num" id="3039354">0</span><br>
<span class="lineno"></span><span class="op" id="3039356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3039359">//&nbsp;Num&nbsp;returns&nbsp;the&nbsp;numerator&nbsp;of&nbsp;x;&nbsp;it&nbsp;may&nbsp;be&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno">395</span><span class="comment" id="3039410">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;numerator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3039460">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span><span class="comment" id="3039523">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;the&nbsp;numerator&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;sign&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3039582">func</span>&nbsp;<span class="op" id="3039587">(</span><span class="ident" id="3039588">x</span>&nbsp;<span class="op" id="3039590">*</span><span class="ident" id="3039591">Rat</span><span class="op" id="3039594">)</span>&nbsp;<span class="ident" id="3039596">Num</span><span class="op" id="3039599">(</span><span class="op" id="3039600">)</span>&nbsp;<span class="op" id="3039602">*</span><span class="ident" id="3039603">Int</span>&nbsp;<span class="op" id="3039607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3039610">return</span>&nbsp;<span class="op" id="3039617">&amp;</span><span class="ident" id="3039618">x</span><span class="op" id="3039619">.</span><span class="ident" id="3039620">a</span><br>
<span class="lineno">400</span><span class="op" id="3039622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3039625">//&nbsp;Denom&nbsp;returns&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x;&nbsp;it&nbsp;is&nbsp;always&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3039682">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;denominator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3039734">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno">405</span><span class="keyword" id="3039797">func</span>&nbsp;<span class="op" id="3039802">(</span><span class="ident" id="3039803">x</span>&nbsp;<span class="op" id="3039805">*</span><span class="ident" id="3039806">Rat</span><span class="op" id="3039809">)</span>&nbsp;<span class="ident" id="3039811">Denom</span><span class="op" id="3039816">(</span><span class="op" id="3039817">)</span>&nbsp;<span class="op" id="3039819">*</span><span class="ident" id="3039820">Int</span>&nbsp;<span class="op" id="3039824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3039827">x</span><span class="op" id="3039828">.</span><span class="ident" id="3039829">b</span><span class="op" id="3039830">.</span><span class="ident" id="3039831">neg</span>&nbsp;<span class="op" id="3039835">=</span>&nbsp;<span class="builtintype" id="3039837">false</span>&nbsp;<span class="comment" id="3039843">//&nbsp;the&nbsp;result&nbsp;is&nbsp;always&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3039873">if</span>&nbsp;<span class="builtinfunc" id="3039876">len</span><span class="op" id="3039879">(</span><span class="ident" id="3039880">x</span><span class="op" id="3039881">.</span><span class="ident" id="3039882">b</span><span class="op" id="3039883">.</span><span class="ident" id="3039884">abs</span><span class="op" id="3039887">)</span>&nbsp;<span class="op" id="3039889">==</span>&nbsp;<span class="num" id="3039892">0</span>&nbsp;<span class="op" id="3039894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3039898">x</span><span class="op" id="3039899">.</span><span class="ident" id="3039900">b</span><span class="op" id="3039901">.</span><span class="ident" id="3039902">abs</span>&nbsp;<span class="op" id="3039906">=</span>&nbsp;<span class="ident" id="3039908">x</span><span class="op" id="3039909">.</span><span class="ident" id="3039910">b</span><span class="op" id="3039911">.</span><span class="ident" id="3039912">abs</span><span class="op" id="3039915">.</span><span class="ident" id="3039916">set</span><span class="op" id="3039919">(</span><span class="ident" id="3039920">natOne</span><span class="op" id="3039926">)</span>&nbsp;<span class="comment" id="3039928">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3039956">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3039959">return</span>&nbsp;<span class="op" id="3039966">&amp;</span><span class="ident" id="3039967">x</span><span class="op" id="3039968">.</span><span class="ident" id="3039969">b</span><br>
<span class="lineno"></span><span class="op" id="3039971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3039974">func</span>&nbsp;<span class="op" id="3039979">(</span><span class="ident" id="3039980">z</span>&nbsp;<span class="op" id="3039982">*</span><span class="ident" id="3039983">Rat</span><span class="op" id="3039986">)</span>&nbsp;<span class="ident" id="3039988">norm</span><span class="op" id="3039992">(</span><span class="op" id="3039993">)</span>&nbsp;<span class="op" id="3039995">*</span><span class="ident" id="3039996">Rat</span>&nbsp;<span class="op" id="3040000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040003">switch</span>&nbsp;<span class="op" id="3040010">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040013">case</span>&nbsp;<span class="builtinfunc" id="3040018">len</span><span class="op" id="3040021">(</span><span class="ident" id="3040022">z</span><span class="op" id="3040023">.</span><span class="ident" id="3040024">a</span><span class="op" id="3040025">.</span><span class="ident" id="3040026">abs</span><span class="op" id="3040029">)</span>&nbsp;<span class="op" id="3040031">==</span>&nbsp;<span class="num" id="3040034">0</span><span class="op" id="3040035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3040039">//&nbsp;z&nbsp;==&nbsp;0&nbsp;-&nbsp;normalize&nbsp;sign&nbsp;and&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040084">z</span><span class="op" id="3040085">.</span><span class="ident" id="3040086">a</span><span class="op" id="3040087">.</span><span class="ident" id="3040088">neg</span>&nbsp;<span class="op" id="3040092">=</span>&nbsp;<span class="builtintype" id="3040094">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040102">z</span><span class="op" id="3040103">.</span><span class="ident" id="3040104">b</span><span class="op" id="3040105">.</span><span class="ident" id="3040106">abs</span>&nbsp;<span class="op" id="3040110">=</span>&nbsp;<span class="ident" id="3040112">z</span><span class="op" id="3040113">.</span><span class="ident" id="3040114">b</span><span class="op" id="3040115">.</span><span class="ident" id="3040116">abs</span><span class="op" id="3040119">.</span><span class="builtinfunc" id="3040120">make</span><span class="op" id="3040124">(</span><span class="num" id="3040125">0</span><span class="op" id="3040126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040129">case</span>&nbsp;<span class="builtinfunc" id="3040134">len</span><span class="op" id="3040137">(</span><span class="ident" id="3040138">z</span><span class="op" id="3040139">.</span><span class="ident" id="3040140">b</span><span class="op" id="3040141">.</span><span class="ident" id="3040142">abs</span><span class="op" id="3040145">)</span>&nbsp;<span class="op" id="3040147">==</span>&nbsp;<span class="num" id="3040150">0</span><span class="op" id="3040151">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3040155">//&nbsp;z&nbsp;is&nbsp;normalized&nbsp;int&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040195">case</span>&nbsp;<span class="ident" id="3040200">z</span><span class="op" id="3040201">.</span><span class="ident" id="3040202">b</span><span class="op" id="3040203">.</span><span class="ident" id="3040204">abs</span><span class="op" id="3040207">.</span><span class="ident" id="3040208">cmp</span><span class="op" id="3040211">(</span><span class="ident" id="3040212">natOne</span><span class="op" id="3040218">)</span>&nbsp;<span class="op" id="3040220">==</span>&nbsp;<span class="num" id="3040223">0</span><span class="op" id="3040224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3040228">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040266">z</span><span class="op" id="3040267">.</span><span class="ident" id="3040268">b</span><span class="op" id="3040269">.</span><span class="ident" id="3040270">abs</span>&nbsp;<span class="op" id="3040274">=</span>&nbsp;<span class="ident" id="3040276">z</span><span class="op" id="3040277">.</span><span class="ident" id="3040278">b</span><span class="op" id="3040279">.</span><span class="ident" id="3040280">abs</span><span class="op" id="3040283">.</span><span class="builtinfunc" id="3040284">make</span><span class="op" id="3040288">(</span><span class="num" id="3040289">0</span><span class="op" id="3040290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040293">default</span><span class="op" id="3040300">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040304">neg</span>&nbsp;<span class="op" id="3040308">:=</span>&nbsp;<span class="ident" id="3040311">z</span><span class="op" id="3040312">.</span><span class="ident" id="3040313">a</span><span class="op" id="3040314">.</span><span class="ident" id="3040315">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040321">z</span><span class="op" id="3040322">.</span><span class="ident" id="3040323">a</span><span class="op" id="3040324">.</span><span class="ident" id="3040325">neg</span>&nbsp;<span class="op" id="3040329">=</span>&nbsp;<span class="builtintype" id="3040331">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040339">z</span><span class="op" id="3040340">.</span><span class="ident" id="3040341">b</span><span class="op" id="3040342">.</span><span class="ident" id="3040343">neg</span>&nbsp;<span class="op" id="3040347">=</span>&nbsp;<span class="builtintype" id="3040349">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040357">if</span>&nbsp;<span class="ident" id="3040360">f</span>&nbsp;<span class="op" id="3040362">:=</span>&nbsp;<span class="ident" id="3040365">NewInt</span><span class="op" id="3040371">(</span><span class="num" id="3040372">0</span><span class="op" id="3040373">)</span><span class="op" id="3040374">.</span><span class="ident" id="3040375">binaryGCD</span><span class="op" id="3040384">(</span><span class="op" id="3040385">&amp;</span><span class="ident" id="3040386">z</span><span class="op" id="3040387">.</span><span class="ident" id="3040388">a</span><span class="op" id="3040389">,</span>&nbsp;<span class="op" id="3040391">&amp;</span><span class="ident" id="3040392">z</span><span class="op" id="3040393">.</span><span class="ident" id="3040394">b</span><span class="op" id="3040395">)</span><span class="op" id="3040396">;</span>&nbsp;<span class="ident" id="3040398">f</span><span class="op" id="3040399">.</span><span class="ident" id="3040400">Cmp</span><span class="op" id="3040403">(</span><span class="ident" id="3040404">intOne</span><span class="op" id="3040410">)</span>&nbsp;<span class="op" id="3040412">!=</span>&nbsp;<span class="num" id="3040415">0</span>&nbsp;<span class="op" id="3040417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040422">z</span><span class="op" id="3040423">.</span><span class="ident" id="3040424">a</span><span class="op" id="3040425">.</span><span class="ident" id="3040426">abs</span><span class="op" id="3040429">,</span>&nbsp;<span class="ident" id="3040431">_</span>&nbsp;<span class="op" id="3040433">=</span>&nbsp;<span class="ident" id="3040435">z</span><span class="op" id="3040436">.</span><span class="ident" id="3040437">a</span><span class="op" id="3040438">.</span><span class="ident" id="3040439">abs</span><span class="op" id="3040442">.</span><span class="ident" id="3040443">div</span><span class="op" id="3040446">(</span><span class="builtintype" id="3040447">nil</span><span class="op" id="3040450">,</span>&nbsp;<span class="ident" id="3040452">z</span><span class="op" id="3040453">.</span><span class="ident" id="3040454">a</span><span class="op" id="3040455">.</span><span class="ident" id="3040456">abs</span><span class="op" id="3040459">,</span>&nbsp;<span class="ident" id="3040461">f</span><span class="op" id="3040462">.</span><span class="ident" id="3040463">abs</span><span class="op" id="3040466">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040471">z</span><span class="op" id="3040472">.</span><span class="ident" id="3040473">b</span><span class="op" id="3040474">.</span><span class="ident" id="3040475">abs</span><span class="op" id="3040478">,</span>&nbsp;<span class="ident" id="3040480">_</span>&nbsp;<span class="op" id="3040482">=</span>&nbsp;<span class="ident" id="3040484">z</span><span class="op" id="3040485">.</span><span class="ident" id="3040486">b</span><span class="op" id="3040487">.</span><span class="ident" id="3040488">abs</span><span class="op" id="3040491">.</span><span class="ident" id="3040492">div</span><span class="op" id="3040495">(</span><span class="builtintype" id="3040496">nil</span><span class="op" id="3040499">,</span>&nbsp;<span class="ident" id="3040501">z</span><span class="op" id="3040502">.</span><span class="ident" id="3040503">b</span><span class="op" id="3040504">.</span><span class="ident" id="3040505">abs</span><span class="op" id="3040508">,</span>&nbsp;<span class="ident" id="3040510">f</span><span class="op" id="3040511">.</span><span class="ident" id="3040512">abs</span><span class="op" id="3040515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040520">if</span>&nbsp;<span class="ident" id="3040523">z</span><span class="op" id="3040524">.</span><span class="ident" id="3040525">b</span><span class="op" id="3040526">.</span><span class="ident" id="3040527">abs</span><span class="op" id="3040530">.</span><span class="ident" id="3040531">cmp</span><span class="op" id="3040534">(</span><span class="ident" id="3040535">natOne</span><span class="op" id="3040541">)</span>&nbsp;<span class="op" id="3040543">==</span>&nbsp;<span class="num" id="3040546">0</span>&nbsp;<span class="op" id="3040548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3040554">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040594">z</span><span class="op" id="3040595">.</span><span class="ident" id="3040596">b</span><span class="op" id="3040597">.</span><span class="ident" id="3040598">abs</span>&nbsp;<span class="op" id="3040602">=</span>&nbsp;<span class="ident" id="3040604">z</span><span class="op" id="3040605">.</span><span class="ident" id="3040606">b</span><span class="op" id="3040607">.</span><span class="ident" id="3040608">abs</span><span class="op" id="3040611">.</span><span class="builtinfunc" id="3040612">make</span><span class="op" id="3040616">(</span><span class="num" id="3040617">0</span><span class="op" id="3040618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3040623">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3040627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040631">z</span><span class="op" id="3040632">.</span><span class="ident" id="3040633">a</span><span class="op" id="3040634">.</span><span class="ident" id="3040635">neg</span>&nbsp;<span class="op" id="3040639">=</span>&nbsp;<span class="ident" id="3040641">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3040646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040649">return</span>&nbsp;<span class="ident" id="3040656">z</span><br>
<span class="lineno"></span><span class="op" id="3040658">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="3040661">//&nbsp;mulDenom&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;denominator&nbsp;product&nbsp;x*y&nbsp;(by&nbsp;taking&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3040727">//&nbsp;account&nbsp;that&nbsp;0&nbsp;values&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;1)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3040793">//&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3040807">func</span>&nbsp;<span class="ident" id="3040812">mulDenom</span><span class="op" id="3040820">(</span><span class="ident" id="3040821">z</span><span class="op" id="3040822">,</span>&nbsp;<span class="ident" id="3040824">x</span><span class="op" id="3040825">,</span>&nbsp;<span class="ident" id="3040827">y</span>&nbsp;<span class="ident" id="3040829">nat</span><span class="op" id="3040832">)</span>&nbsp;<span class="ident" id="3040834">nat</span>&nbsp;<span class="op" id="3040838">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040841">switch</span>&nbsp;<span class="op" id="3040848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040851">case</span>&nbsp;<span class="builtinfunc" id="3040856">len</span><span class="op" id="3040859">(</span><span class="ident" id="3040860">x</span><span class="op" id="3040861">)</span>&nbsp;<span class="op" id="3040863">==</span>&nbsp;<span class="num" id="3040866">0</span><span class="op" id="3040867">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040871">return</span>&nbsp;<span class="ident" id="3040878">z</span><span class="op" id="3040879">.</span><span class="ident" id="3040880">set</span><span class="op" id="3040883">(</span><span class="ident" id="3040884">y</span><span class="op" id="3040885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040888">case</span>&nbsp;<span class="builtinfunc" id="3040893">len</span><span class="op" id="3040896">(</span><span class="ident" id="3040897">y</span><span class="op" id="3040898">)</span>&nbsp;<span class="op" id="3040900">==</span>&nbsp;<span class="num" id="3040903">0</span><span class="op" id="3040904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040908">return</span>&nbsp;<span class="ident" id="3040915">z</span><span class="op" id="3040916">.</span><span class="ident" id="3040917">set</span><span class="op" id="3040920">(</span><span class="ident" id="3040921">x</span><span class="op" id="3040922">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3040925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040928">return</span>&nbsp;<span class="ident" id="3040935">z</span><span class="op" id="3040936">.</span><span class="ident" id="3040937">mul</span><span class="op" id="3040940">(</span><span class="ident" id="3040941">x</span><span class="op" id="3040942">,</span>&nbsp;<span class="ident" id="3040944">y</span><span class="op" id="3040945">)</span><br>
<span class="lineno"></span><span class="op" id="3040947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3040950">//&nbsp;scaleDenom&nbsp;computes&nbsp;x*f.</span><br>
<span class="lineno">455</span><span class="comment" id="3040978">//&nbsp;If&nbsp;f&nbsp;==&nbsp;0&nbsp;(zero&nbsp;value&nbsp;of&nbsp;denominator),&nbsp;the&nbsp;result&nbsp;is&nbsp;(a&nbsp;copy&nbsp;of)&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3041049">func</span>&nbsp;<span class="ident" id="3041054">scaleDenom</span><span class="op" id="3041064">(</span><span class="ident" id="3041065">x</span>&nbsp;<span class="op" id="3041067">*</span><span class="ident" id="3041068">Int</span><span class="op" id="3041071">,</span>&nbsp;<span class="ident" id="3041073">f</span>&nbsp;<span class="ident" id="3041075">nat</span><span class="op" id="3041078">)</span>&nbsp;<span class="op" id="3041080">*</span><span class="ident" id="3041081">Int</span>&nbsp;<span class="op" id="3041085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041088">var</span>&nbsp;<span class="ident" id="3041092">z</span>&nbsp;<span class="ident" id="3041094">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041099">if</span>&nbsp;<span class="builtinfunc" id="3041102">len</span><span class="op" id="3041105">(</span><span class="ident" id="3041106">f</span><span class="op" id="3041107">)</span>&nbsp;<span class="op" id="3041109">==</span>&nbsp;<span class="num" id="3041112">0</span>&nbsp;<span class="op" id="3041114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041118">return</span>&nbsp;<span class="ident" id="3041125">z</span><span class="op" id="3041126">.</span><span class="ident" id="3041127">Set</span><span class="op" id="3041130">(</span><span class="ident" id="3041131">x</span><span class="op" id="3041132">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3041135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041138">z</span><span class="op" id="3041139">.</span><span class="ident" id="3041140">abs</span>&nbsp;<span class="op" id="3041144">=</span>&nbsp;<span class="ident" id="3041146">z</span><span class="op" id="3041147">.</span><span class="ident" id="3041148">abs</span><span class="op" id="3041151">.</span><span class="ident" id="3041152">mul</span><span class="op" id="3041155">(</span><span class="ident" id="3041156">x</span><span class="op" id="3041157">.</span><span class="ident" id="3041158">abs</span><span class="op" id="3041161">,</span>&nbsp;<span class="ident" id="3041163">f</span><span class="op" id="3041164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041167">z</span><span class="op" id="3041168">.</span><span class="ident" id="3041169">neg</span>&nbsp;<span class="op" id="3041173">=</span>&nbsp;<span class="ident" id="3041175">x</span><span class="op" id="3041176">.</span><span class="ident" id="3041177">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041182">return</span>&nbsp;<span class="op" id="3041189">&amp;</span><span class="ident" id="3041190">z</span><br>
<span class="lineno"></span><span class="op" id="3041192">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span><span class="comment" id="3041195">//&nbsp;Cmp&nbsp;compares&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;returns:</span><br>
<span class="lineno"></span><span class="comment" id="3041232">//</span><br>
<span class="lineno"></span><span class="comment" id="3041235">//&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3041253">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;y</span><br>
<span class="lineno">470</span><span class="comment" id="3041271">//&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3041289">//</span><br>
<span class="lineno"></span><span class="keyword" id="3041292">func</span>&nbsp;<span class="op" id="3041297">(</span><span class="ident" id="3041298">x</span>&nbsp;<span class="op" id="3041300">*</span><span class="ident" id="3041301">Rat</span><span class="op" id="3041304">)</span>&nbsp;<span class="ident" id="3041306">Cmp</span><span class="op" id="3041309">(</span><span class="ident" id="3041310">y</span>&nbsp;<span class="op" id="3041312">*</span><span class="ident" id="3041313">Rat</span><span class="op" id="3041316">)</span>&nbsp;<span class="builtintype" id="3041318">int</span>&nbsp;<span class="op" id="3041322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041325">return</span>&nbsp;<span class="ident" id="3041332">scaleDenom</span><span class="op" id="3041342">(</span><span class="op" id="3041343">&amp;</span><span class="ident" id="3041344">x</span><span class="op" id="3041345">.</span><span class="ident" id="3041346">a</span><span class="op" id="3041347">,</span>&nbsp;<span class="ident" id="3041349">y</span><span class="op" id="3041350">.</span><span class="ident" id="3041351">b</span><span class="op" id="3041352">.</span><span class="ident" id="3041353">abs</span><span class="op" id="3041356">)</span><span class="op" id="3041357">.</span><span class="ident" id="3041358">Cmp</span><span class="op" id="3041361">(</span><span class="ident" id="3041362">scaleDenom</span><span class="op" id="3041372">(</span><span class="op" id="3041373">&amp;</span><span class="ident" id="3041374">y</span><span class="op" id="3041375">.</span><span class="ident" id="3041376">a</span><span class="op" id="3041377">,</span>&nbsp;<span class="ident" id="3041379">x</span><span class="op" id="3041380">.</span><span class="ident" id="3041381">b</span><span class="op" id="3041382">.</span><span class="ident" id="3041383">abs</span><span class="op" id="3041386">)</span><span class="op" id="3041387">)</span><br>
<span class="lineno"></span><span class="op" id="3041389">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="3041392">//&nbsp;Add&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;sum&nbsp;x+y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3041436">func</span>&nbsp;<span class="op" id="3041441">(</span><span class="ident" id="3041442">z</span>&nbsp;<span class="op" id="3041444">*</span><span class="ident" id="3041445">Rat</span><span class="op" id="3041448">)</span>&nbsp;<span class="ident" id="3041450">Add</span><span class="op" id="3041453">(</span><span class="ident" id="3041454">x</span><span class="op" id="3041455">,</span>&nbsp;<span class="ident" id="3041457">y</span>&nbsp;<span class="op" id="3041459">*</span><span class="ident" id="3041460">Rat</span><span class="op" id="3041463">)</span>&nbsp;<span class="op" id="3041465">*</span><span class="ident" id="3041466">Rat</span>&nbsp;<span class="op" id="3041470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041473">a1</span>&nbsp;<span class="op" id="3041476">:=</span>&nbsp;<span class="ident" id="3041479">scaleDenom</span><span class="op" id="3041489">(</span><span class="op" id="3041490">&amp;</span><span class="ident" id="3041491">x</span><span class="op" id="3041492">.</span><span class="ident" id="3041493">a</span><span class="op" id="3041494">,</span>&nbsp;<span class="ident" id="3041496">y</span><span class="op" id="3041497">.</span><span class="ident" id="3041498">b</span><span class="op" id="3041499">.</span><span class="ident" id="3041500">abs</span><span class="op" id="3041503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041506">a2</span>&nbsp;<span class="op" id="3041509">:=</span>&nbsp;<span class="ident" id="3041512">scaleDenom</span><span class="op" id="3041522">(</span><span class="op" id="3041523">&amp;</span><span class="ident" id="3041524">y</span><span class="op" id="3041525">.</span><span class="ident" id="3041526">a</span><span class="op" id="3041527">,</span>&nbsp;<span class="ident" id="3041529">x</span><span class="op" id="3041530">.</span><span class="ident" id="3041531">b</span><span class="op" id="3041532">.</span><span class="ident" id="3041533">abs</span><span class="op" id="3041536">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041539">z</span><span class="op" id="3041540">.</span><span class="ident" id="3041541">a</span><span class="op" id="3041542">.</span><span class="ident" id="3041543">Add</span><span class="op" id="3041546">(</span><span class="ident" id="3041547">a1</span><span class="op" id="3041549">,</span>&nbsp;<span class="ident" id="3041551">a2</span><span class="op" id="3041553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041556">z</span><span class="op" id="3041557">.</span><span class="ident" id="3041558">b</span><span class="op" id="3041559">.</span><span class="ident" id="3041560">abs</span>&nbsp;<span class="op" id="3041564">=</span>&nbsp;<span class="ident" id="3041566">mulDenom</span><span class="op" id="3041574">(</span><span class="ident" id="3041575">z</span><span class="op" id="3041576">.</span><span class="ident" id="3041577">b</span><span class="op" id="3041578">.</span><span class="ident" id="3041579">abs</span><span class="op" id="3041582">,</span>&nbsp;<span class="ident" id="3041584">x</span><span class="op" id="3041585">.</span><span class="ident" id="3041586">b</span><span class="op" id="3041587">.</span><span class="ident" id="3041588">abs</span><span class="op" id="3041591">,</span>&nbsp;<span class="ident" id="3041593">y</span><span class="op" id="3041594">.</span><span class="ident" id="3041595">b</span><span class="op" id="3041596">.</span><span class="ident" id="3041597">abs</span><span class="op" id="3041600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041603">return</span>&nbsp;<span class="ident" id="3041610">z</span><span class="op" id="3041611">.</span><span class="ident" id="3041612">norm</span><span class="op" id="3041616">(</span><span class="op" id="3041617">)</span><br>
<span class="lineno"></span><span class="op" id="3041619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span><span class="comment" id="3041622">//&nbsp;Sub&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;difference&nbsp;x-y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3041673">func</span>&nbsp;<span class="op" id="3041678">(</span><span class="ident" id="3041679">z</span>&nbsp;<span class="op" id="3041681">*</span><span class="ident" id="3041682">Rat</span><span class="op" id="3041685">)</span>&nbsp;<span class="ident" id="3041687">Sub</span><span class="op" id="3041690">(</span><span class="ident" id="3041691">x</span><span class="op" id="3041692">,</span>&nbsp;<span class="ident" id="3041694">y</span>&nbsp;<span class="op" id="3041696">*</span><span class="ident" id="3041697">Rat</span><span class="op" id="3041700">)</span>&nbsp;<span class="op" id="3041702">*</span><span class="ident" id="3041703">Rat</span>&nbsp;<span class="op" id="3041707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041710">a1</span>&nbsp;<span class="op" id="3041713">:=</span>&nbsp;<span class="ident" id="3041716">scaleDenom</span><span class="op" id="3041726">(</span><span class="op" id="3041727">&amp;</span><span class="ident" id="3041728">x</span><span class="op" id="3041729">.</span><span class="ident" id="3041730">a</span><span class="op" id="3041731">,</span>&nbsp;<span class="ident" id="3041733">y</span><span class="op" id="3041734">.</span><span class="ident" id="3041735">b</span><span class="op" id="3041736">.</span><span class="ident" id="3041737">abs</span><span class="op" id="3041740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041743">a2</span>&nbsp;<span class="op" id="3041746">:=</span>&nbsp;<span class="ident" id="3041749">scaleDenom</span><span class="op" id="3041759">(</span><span class="op" id="3041760">&amp;</span><span class="ident" id="3041761">y</span><span class="op" id="3041762">.</span><span class="ident" id="3041763">a</span><span class="op" id="3041764">,</span>&nbsp;<span class="ident" id="3041766">x</span><span class="op" id="3041767">.</span><span class="ident" id="3041768">b</span><span class="op" id="3041769">.</span><span class="ident" id="3041770">abs</span><span class="op" id="3041773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041776">z</span><span class="op" id="3041777">.</span><span class="ident" id="3041778">a</span><span class="op" id="3041779">.</span><span class="ident" id="3041780">Sub</span><span class="op" id="3041783">(</span><span class="ident" id="3041784">a1</span><span class="op" id="3041786">,</span>&nbsp;<span class="ident" id="3041788">a2</span><span class="op" id="3041790">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041793">z</span><span class="op" id="3041794">.</span><span class="ident" id="3041795">b</span><span class="op" id="3041796">.</span><span class="ident" id="3041797">abs</span>&nbsp;<span class="op" id="3041801">=</span>&nbsp;<span class="ident" id="3041803">mulDenom</span><span class="op" id="3041811">(</span><span class="ident" id="3041812">z</span><span class="op" id="3041813">.</span><span class="ident" id="3041814">b</span><span class="op" id="3041815">.</span><span class="ident" id="3041816">abs</span><span class="op" id="3041819">,</span>&nbsp;<span class="ident" id="3041821">x</span><span class="op" id="3041822">.</span><span class="ident" id="3041823">b</span><span class="op" id="3041824">.</span><span class="ident" id="3041825">abs</span><span class="op" id="3041828">,</span>&nbsp;<span class="ident" id="3041830">y</span><span class="op" id="3041831">.</span><span class="ident" id="3041832">b</span><span class="op" id="3041833">.</span><span class="ident" id="3041834">abs</span><span class="op" id="3041837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041840">return</span>&nbsp;<span class="ident" id="3041847">z</span><span class="op" id="3041848">.</span><span class="ident" id="3041849">norm</span><span class="op" id="3041853">(</span><span class="op" id="3041854">)</span><br>
<span class="lineno"></span><span class="op" id="3041856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3041859">//&nbsp;Mul&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;product&nbsp;x*y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">495</span><span class="keyword" id="3041907">func</span>&nbsp;<span class="op" id="3041912">(</span><span class="ident" id="3041913">z</span>&nbsp;<span class="op" id="3041915">*</span><span class="ident" id="3041916">Rat</span><span class="op" id="3041919">)</span>&nbsp;<span class="ident" id="3041921">Mul</span><span class="op" id="3041924">(</span><span class="ident" id="3041925">x</span><span class="op" id="3041926">,</span>&nbsp;<span class="ident" id="3041928">y</span>&nbsp;<span class="op" id="3041930">*</span><span class="ident" id="3041931">Rat</span><span class="op" id="3041934">)</span>&nbsp;<span class="op" id="3041936">*</span><span class="ident" id="3041937">Rat</span>&nbsp;<span class="op" id="3041941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041944">z</span><span class="op" id="3041945">.</span><span class="ident" id="3041946">a</span><span class="op" id="3041947">.</span><span class="ident" id="3041948">Mul</span><span class="op" id="3041951">(</span><span class="op" id="3041952">&amp;</span><span class="ident" id="3041953">x</span><span class="op" id="3041954">.</span><span class="ident" id="3041955">a</span><span class="op" id="3041956">,</span>&nbsp;<span class="op" id="3041958">&amp;</span><span class="ident" id="3041959">y</span><span class="op" id="3041960">.</span><span class="ident" id="3041961">a</span><span class="op" id="3041962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041965">z</span><span class="op" id="3041966">.</span><span class="ident" id="3041967">b</span><span class="op" id="3041968">.</span><span class="ident" id="3041969">abs</span>&nbsp;<span class="op" id="3041973">=</span>&nbsp;<span class="ident" id="3041975">mulDenom</span><span class="op" id="3041983">(</span><span class="ident" id="3041984">z</span><span class="op" id="3041985">.</span><span class="ident" id="3041986">b</span><span class="op" id="3041987">.</span><span class="ident" id="3041988">abs</span><span class="op" id="3041991">,</span>&nbsp;<span class="ident" id="3041993">x</span><span class="op" id="3041994">.</span><span class="ident" id="3041995">b</span><span class="op" id="3041996">.</span><span class="ident" id="3041997">abs</span><span class="op" id="3042000">,</span>&nbsp;<span class="ident" id="3042002">y</span><span class="op" id="3042003">.</span><span class="ident" id="3042004">b</span><span class="op" id="3042005">.</span><span class="ident" id="3042006">abs</span><span class="op" id="3042009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042012">return</span>&nbsp;<span class="ident" id="3042019">z</span><span class="op" id="3042020">.</span><span class="ident" id="3042021">norm</span><span class="op" id="3042025">(</span><span class="op" id="3042026">)</span><br>
<span class="lineno"></span><span class="op" id="3042028">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="3042031">//&nbsp;Quo&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;quotient&nbsp;x/y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3042080">//&nbsp;If&nbsp;y&nbsp;==&nbsp;0,&nbsp;a&nbsp;division-by-zero&nbsp;run-time&nbsp;panic&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword" id="3042136">func</span>&nbsp;<span class="op" id="3042141">(</span><span class="ident" id="3042142">z</span>&nbsp;<span class="op" id="3042144">*</span><span class="ident" id="3042145">Rat</span><span class="op" id="3042148">)</span>&nbsp;<span class="ident" id="3042150">Quo</span><span class="op" id="3042153">(</span><span class="ident" id="3042154">x</span><span class="op" id="3042155">,</span>&nbsp;<span class="ident" id="3042157">y</span>&nbsp;<span class="op" id="3042159">*</span><span class="ident" id="3042160">Rat</span><span class="op" id="3042163">)</span>&nbsp;<span class="op" id="3042165">*</span><span class="ident" id="3042166">Rat</span>&nbsp;<span class="op" id="3042170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042173">if</span>&nbsp;<span class="builtinfunc" id="3042176">len</span><span class="op" id="3042179">(</span><span class="ident" id="3042180">y</span><span class="op" id="3042181">.</span><span class="ident" id="3042182">a</span><span class="op" id="3042183">.</span><span class="ident" id="3042184">abs</span><span class="op" id="3042187">)</span>&nbsp;<span class="op" id="3042189">==</span>&nbsp;<span class="num" id="3042192">0</span>&nbsp;<span class="op" id="3042194">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3042198">panic</span><span class="op" id="3042203">(</span><span class="string" id="3042204">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3042222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3042225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042228">a</span>&nbsp;<span class="op" id="3042230">:=</span>&nbsp;<span class="ident" id="3042233">scaleDenom</span><span class="op" id="3042243">(</span><span class="op" id="3042244">&amp;</span><span class="ident" id="3042245">x</span><span class="op" id="3042246">.</span><span class="ident" id="3042247">a</span><span class="op" id="3042248">,</span>&nbsp;<span class="ident" id="3042250">y</span><span class="op" id="3042251">.</span><span class="ident" id="3042252">b</span><span class="op" id="3042253">.</span><span class="ident" id="3042254">abs</span><span class="op" id="3042257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042260">b</span>&nbsp;<span class="op" id="3042262">:=</span>&nbsp;<span class="ident" id="3042265">scaleDenom</span><span class="op" id="3042275">(</span><span class="op" id="3042276">&amp;</span><span class="ident" id="3042277">y</span><span class="op" id="3042278">.</span><span class="ident" id="3042279">a</span><span class="op" id="3042280">,</span>&nbsp;<span class="ident" id="3042282">x</span><span class="op" id="3042283">.</span><span class="ident" id="3042284">b</span><span class="op" id="3042285">.</span><span class="ident" id="3042286">abs</span><span class="op" id="3042289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042292">z</span><span class="op" id="3042293">.</span><span class="ident" id="3042294">a</span><span class="op" id="3042295">.</span><span class="ident" id="3042296">abs</span>&nbsp;<span class="op" id="3042300">=</span>&nbsp;<span class="ident" id="3042302">a</span><span class="op" id="3042303">.</span><span class="ident" id="3042304">abs</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042309">z</span><span class="op" id="3042310">.</span><span class="ident" id="3042311">b</span><span class="op" id="3042312">.</span><span class="ident" id="3042313">abs</span>&nbsp;<span class="op" id="3042317">=</span>&nbsp;<span class="ident" id="3042319">b</span><span class="op" id="3042320">.</span><span class="ident" id="3042321">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042326">z</span><span class="op" id="3042327">.</span><span class="ident" id="3042328">a</span><span class="op" id="3042329">.</span><span class="ident" id="3042330">neg</span>&nbsp;<span class="op" id="3042334">=</span>&nbsp;<span class="ident" id="3042336">a</span><span class="op" id="3042337">.</span><span class="ident" id="3042338">neg</span>&nbsp;<span class="op" id="3042342">!=</span>&nbsp;<span class="ident" id="3042345">b</span><span class="op" id="3042346">.</span><span class="ident" id="3042347">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042352">return</span>&nbsp;<span class="ident" id="3042359">z</span><span class="op" id="3042360">.</span><span class="ident" id="3042361">norm</span><span class="op" id="3042365">(</span><span class="op" id="3042366">)</span><br>
<span class="lineno"></span><span class="op" id="3042368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="3042371">func</span>&nbsp;<span class="ident" id="3042376">ratTok</span><span class="op" id="3042382">(</span><span class="ident" id="3042383">ch</span>&nbsp;<span class="builtintype" id="3042386">rune</span><span class="op" id="3042390">)</span>&nbsp;<span class="builtintype" id="3042392">bool</span>&nbsp;<span class="op" id="3042397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042400">return</span>&nbsp;<span class="ident" id="3042407">strings</span><span class="op" id="3042414">.</span><span class="ident" id="3042415">IndexRune</span><span class="op" id="3042424">(</span><span class="string" id="3042425">&#34;+-/0123456789.eE&#34;</span><span class="op" id="3042443">,</span>&nbsp;<span class="ident" id="3042445">ch</span><span class="op" id="3042447">)</span>&nbsp;<span class="op" id="3042449">&gt;=</span>&nbsp;<span class="num" id="3042452">0</span><br>
<span class="lineno"></span><span class="op" id="3042454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3042457">//&nbsp;Scan&nbsp;is&nbsp;a&nbsp;support&nbsp;routine&nbsp;for&nbsp;fmt.Scanner.&nbsp;It&nbsp;accepts&nbsp;the&nbsp;formats</span><br>
<span class="lineno">520</span><span class="comment" id="3042526">//&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;F&#39;,&nbsp;&#39;g&#39;,&nbsp;&#39;G&#39;,&nbsp;and&nbsp;&#39;v&#39;.&nbsp;All&nbsp;formats&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno"></span><span class="keyword" id="3042596">func</span>&nbsp;<span class="op" id="3042601">(</span><span class="ident" id="3042602">z</span>&nbsp;<span class="op" id="3042604">*</span><span class="ident" id="3042605">Rat</span><span class="op" id="3042608">)</span>&nbsp;<span class="ident" id="3042610">Scan</span><span class="op" id="3042614">(</span><span class="ident" id="3042615">s</span>&nbsp;<span class="ident" id="3042617">fmt</span><span class="op" id="3042620">.</span><span class="ident" id="3042621">ScanState</span><span class="op" id="3042630">,</span>&nbsp;<span class="ident" id="3042632">ch</span>&nbsp;<span class="builtintype" id="3042635">rune</span><span class="op" id="3042639">)</span>&nbsp;<span class="builtintype" id="3042641">error</span>&nbsp;<span class="op" id="3042647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042650">tok</span><span class="op" id="3042653">,</span>&nbsp;<span class="ident" id="3042655">err</span>&nbsp;<span class="op" id="3042659">:=</span>&nbsp;<span class="ident" id="3042662">s</span><span class="op" id="3042663">.</span><span class="ident" id="3042664">Token</span><span class="op" id="3042669">(</span><span class="builtintype" id="3042670">true</span><span class="op" id="3042674">,</span>&nbsp;<span class="ident" id="3042676">ratTok</span><span class="op" id="3042682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042685">if</span>&nbsp;<span class="ident" id="3042688">err</span>&nbsp;<span class="op" id="3042692">!=</span>&nbsp;<span class="builtintype" id="3042695">nil</span>&nbsp;<span class="op" id="3042699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042703">return</span>&nbsp;<span class="ident" id="3042710">err</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3042715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042718">if</span>&nbsp;<span class="ident" id="3042721">strings</span><span class="op" id="3042728">.</span><span class="ident" id="3042729">IndexRune</span><span class="op" id="3042738">(</span><span class="string" id="3042739">&#34;efgEFGv&#34;</span><span class="op" id="3042748">,</span>&nbsp;<span class="ident" id="3042750">ch</span><span class="op" id="3042752">)</span>&nbsp;<span class="op" id="3042754">&lt;</span>&nbsp;<span class="num" id="3042756">0</span>&nbsp;<span class="op" id="3042758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042762">return</span>&nbsp;<span class="ident" id="3042769">errors</span><span class="op" id="3042775">.</span><span class="ident" id="3042776">New</span><span class="op" id="3042779">(</span><span class="string" id="3042780">&#34;Rat.Scan:&nbsp;invalid&nbsp;verb&#34;</span><span class="op" id="3042804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3042807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042810">if</span>&nbsp;<span class="ident" id="3042813">_</span><span class="op" id="3042814">,</span>&nbsp;<span class="ident" id="3042816">ok</span>&nbsp;<span class="op" id="3042819">:=</span>&nbsp;<span class="ident" id="3042822">z</span><span class="op" id="3042823">.</span><span class="ident" id="3042824">SetString</span><span class="op" id="3042833">(</span><span class="builtintype" id="3042834">string</span><span class="op" id="3042840">(</span><span class="ident" id="3042841">tok</span><span class="op" id="3042844">)</span><span class="op" id="3042845">)</span><span class="op" id="3042846">;</span>&nbsp;<span class="op" id="3042848">!</span><span class="ident" id="3042849">ok</span>&nbsp;<span class="op" id="3042852">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042856">return</span>&nbsp;<span class="ident" id="3042863">errors</span><span class="op" id="3042869">.</span><span class="ident" id="3042870">New</span><span class="op" id="3042873">(</span><span class="string" id="3042874">&#34;Rat.Scan:&nbsp;invalid&nbsp;syntax&#34;</span><span class="op" id="3042900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3042903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042906">return</span>&nbsp;<span class="builtintype" id="3042913">nil</span><br>
<span class="lineno"></span><span class="op" id="3042917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3042920">//&nbsp;SetString&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;s&nbsp;and&nbsp;returns&nbsp;z&nbsp;and&nbsp;a&nbsp;boolean&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3042997">//&nbsp;success.&nbsp;s&nbsp;can&nbsp;be&nbsp;given&nbsp;as&nbsp;a&nbsp;fraction&nbsp;&#34;a/b&#34;&nbsp;or&nbsp;as&nbsp;a&nbsp;floating-point&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3043074">//&nbsp;optionally&nbsp;followed&nbsp;by&nbsp;an&nbsp;exponent.&nbsp;If&nbsp;the&nbsp;operation&nbsp;failed,&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3043151">//&nbsp;z&nbsp;is&nbsp;undefined&nbsp;but&nbsp;the&nbsp;returned&nbsp;value&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3043200">func</span>&nbsp;<span class="op" id="3043205">(</span><span class="ident" id="3043206">z</span>&nbsp;<span class="op" id="3043208">*</span><span class="ident" id="3043209">Rat</span><span class="op" id="3043212">)</span>&nbsp;<span class="ident" id="3043214">SetString</span><span class="op" id="3043223">(</span><span class="ident" id="3043224">s</span>&nbsp;<span class="builtintype" id="3043226">string</span><span class="op" id="3043232">)</span>&nbsp;<span class="op" id="3043234">(</span><span class="op" id="3043235">*</span><span class="ident" id="3043236">Rat</span><span class="op" id="3043239">,</span>&nbsp;<span class="builtintype" id="3043241">bool</span><span class="op" id="3043245">)</span>&nbsp;<span class="op" id="3043247">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043250">if</span>&nbsp;<span class="builtinfunc" id="3043253">len</span><span class="op" id="3043256">(</span><span class="ident" id="3043257">s</span><span class="op" id="3043258">)</span>&nbsp;<span class="op" id="3043260">==</span>&nbsp;<span class="num" id="3043263">0</span>&nbsp;<span class="op" id="3043265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043269">return</span>&nbsp;<span class="builtintype" id="3043276">nil</span><span class="op" id="3043279">,</span>&nbsp;<span class="builtintype" id="3043281">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3043292">//&nbsp;check&nbsp;for&nbsp;a&nbsp;quotient</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043317">sep</span>&nbsp;<span class="op" id="3043321">:=</span>&nbsp;<span class="ident" id="3043324">strings</span><span class="op" id="3043331">.</span><span class="ident" id="3043332">Index</span><span class="op" id="3043337">(</span><span class="ident" id="3043338">s</span><span class="op" id="3043339">,</span>&nbsp;<span class="string" id="3043341">&#34;/&#34;</span><span class="op" id="3043344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043347">if</span>&nbsp;<span class="ident" id="3043350">sep</span>&nbsp;<span class="op" id="3043354">&gt;=</span>&nbsp;<span class="num" id="3043357">0</span>&nbsp;<span class="op" id="3043359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043363">if</span>&nbsp;<span class="ident" id="3043366">_</span><span class="op" id="3043367">,</span>&nbsp;<span class="ident" id="3043369">ok</span>&nbsp;<span class="op" id="3043372">:=</span>&nbsp;<span class="ident" id="3043375">z</span><span class="op" id="3043376">.</span><span class="ident" id="3043377">a</span><span class="op" id="3043378">.</span><span class="ident" id="3043379">SetString</span><span class="op" id="3043388">(</span><span class="ident" id="3043389">s</span><span class="op" id="3043390">[</span><span class="num" id="3043391">0</span><span class="op" id="3043392">:</span><span class="ident" id="3043393">sep</span><span class="op" id="3043396">]</span><span class="op" id="3043397">,</span>&nbsp;<span class="num" id="3043399">10</span><span class="op" id="3043401">)</span><span class="op" id="3043402">;</span>&nbsp;<span class="op" id="3043404">!</span><span class="ident" id="3043405">ok</span>&nbsp;<span class="op" id="3043408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043413">return</span>&nbsp;<span class="builtintype" id="3043420">nil</span><span class="op" id="3043423">,</span>&nbsp;<span class="builtintype" id="3043425">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043433">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043437">s</span>&nbsp;<span class="op" id="3043439">=</span>&nbsp;<span class="ident" id="3043441">s</span><span class="op" id="3043442">[</span><span class="ident" id="3043443">sep</span><span class="op" id="3043446">+</span><span class="num" id="3043447">1</span><span class="op" id="3043448">:</span><span class="op" id="3043449">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043453">var</span>&nbsp;<span class="ident" id="3043457">err</span>&nbsp;<span class="builtintype" id="3043461">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043469">if</span>&nbsp;<span class="ident" id="3043472">z</span><span class="op" id="3043473">.</span><span class="ident" id="3043474">b</span><span class="op" id="3043475">.</span><span class="ident" id="3043476">abs</span><span class="op" id="3043479">,</span>&nbsp;<span class="ident" id="3043481">_</span><span class="op" id="3043482">,</span>&nbsp;<span class="ident" id="3043484">err</span>&nbsp;<span class="op" id="3043488">=</span>&nbsp;<span class="ident" id="3043490">z</span><span class="op" id="3043491">.</span><span class="ident" id="3043492">b</span><span class="op" id="3043493">.</span><span class="ident" id="3043494">abs</span><span class="op" id="3043497">.</span><span class="ident" id="3043498">scan</span><span class="op" id="3043502">(</span><span class="ident" id="3043503">strings</span><span class="op" id="3043510">.</span><span class="ident" id="3043511">NewReader</span><span class="op" id="3043520">(</span><span class="ident" id="3043521">s</span><span class="op" id="3043522">)</span><span class="op" id="3043523">,</span>&nbsp;<span class="num" id="3043525">10</span><span class="op" id="3043527">)</span><span class="op" id="3043528">;</span>&nbsp;<span class="ident" id="3043530">err</span>&nbsp;<span class="op" id="3043534">!=</span>&nbsp;<span class="builtintype" id="3043537">nil</span>&nbsp;<span class="op" id="3043541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043546">return</span>&nbsp;<span class="builtintype" id="3043553">nil</span><span class="op" id="3043556">,</span>&nbsp;<span class="builtintype" id="3043558">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043566">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043570">if</span>&nbsp;<span class="builtinfunc" id="3043573">len</span><span class="op" id="3043576">(</span><span class="ident" id="3043577">z</span><span class="op" id="3043578">.</span><span class="ident" id="3043579">b</span><span class="op" id="3043580">.</span><span class="ident" id="3043581">abs</span><span class="op" id="3043584">)</span>&nbsp;<span class="op" id="3043586">==</span>&nbsp;<span class="num" id="3043589">0</span>&nbsp;<span class="op" id="3043591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043596">return</span>&nbsp;<span class="builtintype" id="3043603">nil</span><span class="op" id="3043606">,</span>&nbsp;<span class="builtintype" id="3043608">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043620">return</span>&nbsp;<span class="ident" id="3043627">z</span><span class="op" id="3043628">.</span><span class="ident" id="3043629">norm</span><span class="op" id="3043633">(</span><span class="op" id="3043634">)</span><span class="op" id="3043635">,</span>&nbsp;<span class="builtintype" id="3043637">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043643">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3043647">//&nbsp;check&nbsp;for&nbsp;a&nbsp;decimal&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043677">sep</span>&nbsp;<span class="op" id="3043681">=</span>&nbsp;<span class="ident" id="3043683">strings</span><span class="op" id="3043690">.</span><span class="ident" id="3043691">Index</span><span class="op" id="3043696">(</span><span class="ident" id="3043697">s</span><span class="op" id="3043698">,</span>&nbsp;<span class="string" id="3043700">&#34;.&#34;</span><span class="op" id="3043703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3043706">//&nbsp;check&nbsp;for&nbsp;an&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043732">e</span>&nbsp;<span class="op" id="3043734">:=</span>&nbsp;<span class="ident" id="3043737">strings</span><span class="op" id="3043744">.</span><span class="ident" id="3043745">IndexAny</span><span class="op" id="3043753">(</span><span class="ident" id="3043754">s</span><span class="op" id="3043755">,</span>&nbsp;<span class="string" id="3043757">&#34;eE&#34;</span><span class="op" id="3043761">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043764">var</span>&nbsp;<span class="ident" id="3043768">exp</span>&nbsp;<span class="ident" id="3043772">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043777">if</span>&nbsp;<span class="ident" id="3043780">e</span>&nbsp;<span class="op" id="3043782">&gt;=</span>&nbsp;<span class="num" id="3043785">0</span>&nbsp;<span class="op" id="3043787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043791">if</span>&nbsp;<span class="ident" id="3043794">e</span>&nbsp;<span class="op" id="3043796">&lt;</span>&nbsp;<span class="ident" id="3043798">sep</span>&nbsp;<span class="op" id="3043802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3043807">//&nbsp;The&nbsp;E&nbsp;must&nbsp;come&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043854">return</span>&nbsp;<span class="builtintype" id="3043861">nil</span><span class="op" id="3043864">,</span>&nbsp;<span class="builtintype" id="3043866">false</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043878">if</span>&nbsp;<span class="ident" id="3043881">_</span><span class="op" id="3043882">,</span>&nbsp;<span class="ident" id="3043884">ok</span>&nbsp;<span class="op" id="3043887">:=</span>&nbsp;<span class="ident" id="3043890">exp</span><span class="op" id="3043893">.</span><span class="ident" id="3043894">SetString</span><span class="op" id="3043903">(</span><span class="ident" id="3043904">s</span><span class="op" id="3043905">[</span><span class="ident" id="3043906">e</span><span class="op" id="3043907">+</span><span class="num" id="3043908">1</span><span class="op" id="3043909">:</span><span class="op" id="3043910">]</span><span class="op" id="3043911">,</span>&nbsp;<span class="num" id="3043913">10</span><span class="op" id="3043915">)</span><span class="op" id="3043916">;</span>&nbsp;<span class="op" id="3043918">!</span><span class="ident" id="3043919">ok</span>&nbsp;<span class="op" id="3043922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043927">return</span>&nbsp;<span class="builtintype" id="3043934">nil</span><span class="op" id="3043937">,</span>&nbsp;<span class="builtintype" id="3043939">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043951">s</span>&nbsp;<span class="op" id="3043953">=</span>&nbsp;<span class="ident" id="3043955">s</span><span class="op" id="3043956">[</span><span class="num" id="3043957">0</span><span class="op" id="3043958">:</span><span class="ident" id="3043959">e</span><span class="op" id="3043960">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043966">if</span>&nbsp;<span class="ident" id="3043969">sep</span>&nbsp;<span class="op" id="3043973">&gt;=</span>&nbsp;<span class="num" id="3043976">0</span>&nbsp;<span class="op" id="3043978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043982">s</span>&nbsp;<span class="op" id="3043984">=</span>&nbsp;<span class="ident" id="3043986">s</span><span class="op" id="3043987">[</span><span class="num" id="3043988">0</span><span class="op" id="3043989">:</span><span class="ident" id="3043990">sep</span><span class="op" id="3043993">]</span>&nbsp;<span class="op" id="3043995">+</span>&nbsp;<span class="ident" id="3043997">s</span><span class="op" id="3043998">[</span><span class="ident" id="3043999">sep</span><span class="op" id="3044002">+</span><span class="num" id="3044003">1</span><span class="op" id="3044004">:</span><span class="op" id="3044005">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044009">exp</span><span class="op" id="3044012">.</span><span class="ident" id="3044013">Sub</span><span class="op" id="3044016">(</span><span class="op" id="3044017">&amp;</span><span class="ident" id="3044018">exp</span><span class="op" id="3044021">,</span>&nbsp;<span class="ident" id="3044023">NewInt</span><span class="op" id="3044029">(</span><span class="ident" id="3044030">int64</span><span class="op" id="3044035">(</span><span class="builtinfunc" id="3044036">len</span><span class="op" id="3044039">(</span><span class="ident" id="3044040">s</span><span class="op" id="3044041">)</span><span class="op" id="3044042">-</span><span class="ident" id="3044043">sep</span><span class="op" id="3044046">)</span><span class="op" id="3044047">)</span><span class="op" id="3044048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3044051">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044055">if</span>&nbsp;<span class="ident" id="3044058">_</span><span class="op" id="3044059">,</span>&nbsp;<span class="ident" id="3044061">ok</span>&nbsp;<span class="op" id="3044064">:=</span>&nbsp;<span class="ident" id="3044067">z</span><span class="op" id="3044068">.</span><span class="ident" id="3044069">a</span><span class="op" id="3044070">.</span><span class="ident" id="3044071">SetString</span><span class="op" id="3044080">(</span><span class="ident" id="3044081">s</span><span class="op" id="3044082">,</span>&nbsp;<span class="num" id="3044084">10</span><span class="op" id="3044086">)</span><span class="op" id="3044087">;</span>&nbsp;<span class="op" id="3044089">!</span><span class="ident" id="3044090">ok</span>&nbsp;<span class="op" id="3044093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044097">return</span>&nbsp;<span class="builtintype" id="3044104">nil</span><span class="op" id="3044107">,</span>&nbsp;<span class="builtintype" id="3044109">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3044116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044119">powTen</span>&nbsp;<span class="op" id="3044126">:=</span>&nbsp;<span class="ident" id="3044129">nat</span><span class="op" id="3044132">(</span><span class="builtintype" id="3044133">nil</span><span class="op" id="3044136">)</span><span class="op" id="3044137">.</span><span class="ident" id="3044138">expNN</span><span class="op" id="3044143">(</span><span class="ident" id="3044144">natTen</span><span class="op" id="3044150">,</span>&nbsp;<span class="ident" id="3044152">exp</span><span class="op" id="3044155">.</span><span class="ident" id="3044156">abs</span><span class="op" id="3044159">,</span>&nbsp;<span class="builtintype" id="3044161">nil</span><span class="op" id="3044164">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044167">if</span>&nbsp;<span class="ident" id="3044170">exp</span><span class="op" id="3044173">.</span><span class="ident" id="3044174">neg</span>&nbsp;<span class="op" id="3044178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044182">z</span><span class="op" id="3044183">.</span><span class="ident" id="3044184">b</span><span class="op" id="3044185">.</span><span class="ident" id="3044186">abs</span>&nbsp;<span class="op" id="3044190">=</span>&nbsp;<span class="ident" id="3044192">powTen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044201">z</span><span class="op" id="3044202">.</span><span class="ident" id="3044203">norm</span><span class="op" id="3044207">(</span><span class="op" id="3044208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3044211">}</span>&nbsp;<span class="keyword" id="3044213">else</span>&nbsp;<span class="op" id="3044218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044222">z</span><span class="op" id="3044223">.</span><span class="ident" id="3044224">a</span><span class="op" id="3044225">.</span><span class="ident" id="3044226">abs</span>&nbsp;<span class="op" id="3044230">=</span>&nbsp;<span class="ident" id="3044232">z</span><span class="op" id="3044233">.</span><span class="ident" id="3044234">a</span><span class="op" id="3044235">.</span><span class="ident" id="3044236">abs</span><span class="op" id="3044239">.</span><span class="ident" id="3044240">mul</span><span class="op" id="3044243">(</span><span class="ident" id="3044244">z</span><span class="op" id="3044245">.</span><span class="ident" id="3044246">a</span><span class="op" id="3044247">.</span><span class="ident" id="3044248">abs</span><span class="op" id="3044251">,</span>&nbsp;<span class="ident" id="3044253">powTen</span><span class="op" id="3044259">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044263">z</span><span class="op" id="3044264">.</span><span class="ident" id="3044265">b</span><span class="op" id="3044266">.</span><span class="ident" id="3044267">abs</span>&nbsp;<span class="op" id="3044271">=</span>&nbsp;<span class="ident" id="3044273">z</span><span class="op" id="3044274">.</span><span class="ident" id="3044275">b</span><span class="op" id="3044276">.</span><span class="ident" id="3044277">abs</span><span class="op" id="3044280">.</span><span class="builtinfunc" id="3044281">make</span><span class="op" id="3044285">(</span><span class="num" id="3044286">0</span><span class="op" id="3044287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3044290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044294">return</span>&nbsp;<span class="ident" id="3044301">z</span><span class="op" id="3044302">,</span>&nbsp;<span class="builtintype" id="3044304">true</span><br>
<span class="lineno"></span><span class="op" id="3044309">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="comment" id="3044312">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;(even&nbsp;if&nbsp;b&nbsp;==&nbsp;1).</span><br>
<span class="lineno"></span><span class="keyword" id="3044395">func</span>&nbsp;<span class="op" id="3044400">(</span><span class="ident" id="3044401">x</span>&nbsp;<span class="op" id="3044403">*</span><span class="ident" id="3044404">Rat</span><span class="op" id="3044407">)</span>&nbsp;<span class="ident" id="3044409">String</span><span class="op" id="3044415">(</span><span class="op" id="3044416">)</span>&nbsp;<span class="builtintype" id="3044418">string</span>&nbsp;<span class="op" id="3044425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044428">s</span>&nbsp;<span class="op" id="3044430">:=</span>&nbsp;<span class="string" id="3044433">&#34;/1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044439">if</span>&nbsp;<span class="builtinfunc" id="3044442">len</span><span class="op" id="3044445">(</span><span class="ident" id="3044446">x</span><span class="op" id="3044447">.</span><span class="ident" id="3044448">b</span><span class="op" id="3044449">.</span><span class="ident" id="3044450">abs</span><span class="op" id="3044453">)</span>&nbsp;<span class="op" id="3044455">!=</span>&nbsp;<span class="num" id="3044458">0</span>&nbsp;<span class="op" id="3044460">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044464">s</span>&nbsp;<span class="op" id="3044466">=</span>&nbsp;<span class="string" id="3044468">&#34;/&#34;</span>&nbsp;<span class="op" id="3044472">+</span>&nbsp;<span class="ident" id="3044474">x</span><span class="op" id="3044475">.</span><span class="ident" id="3044476">b</span><span class="op" id="3044477">.</span><span class="ident" id="3044478">abs</span><span class="op" id="3044481">.</span><span class="ident" id="3044482">decimalString</span><span class="op" id="3044495">(</span><span class="op" id="3044496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3044499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044502">return</span>&nbsp;<span class="ident" id="3044509">x</span><span class="op" id="3044510">.</span><span class="ident" id="3044511">a</span><span class="op" id="3044512">.</span><span class="ident" id="3044513">String</span><span class="op" id="3044519">(</span><span class="op" id="3044520">)</span>&nbsp;<span class="op" id="3044522">+</span>&nbsp;<span class="ident" id="3044524">s</span><br>
<span class="lineno"></span><span class="op" id="3044526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="comment" id="3044529">//&nbsp;RatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;if&nbsp;b&nbsp;!=&nbsp;1,</span><br>
<span class="lineno"></span><span class="comment" id="3044608">//&nbsp;and&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a&#34;&nbsp;if&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3044642">func</span>&nbsp;<span class="op" id="3044647">(</span><span class="ident" id="3044648">x</span>&nbsp;<span class="op" id="3044650">*</span><span class="ident" id="3044651">Rat</span><span class="op" id="3044654">)</span>&nbsp;<span class="ident" id="3044656">RatString</span><span class="op" id="3044665">(</span><span class="op" id="3044666">)</span>&nbsp;<span class="builtintype" id="3044668">string</span>&nbsp;<span class="op" id="3044675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044678">if</span>&nbsp;<span class="ident" id="3044681">x</span><span class="op" id="3044682">.</span><span class="ident" id="3044683">IsInt</span><span class="op" id="3044688">(</span><span class="op" id="3044689">)</span>&nbsp;<span class="op" id="3044691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044695">return</span>&nbsp;<span class="ident" id="3044702">x</span><span class="op" id="3044703">.</span><span class="ident" id="3044704">a</span><span class="op" id="3044705">.</span><span class="ident" id="3044706">String</span><span class="op" id="3044712">(</span><span class="op" id="3044713">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3044716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044719">return</span>&nbsp;<span class="ident" id="3044726">x</span><span class="op" id="3044727">.</span><span class="ident" id="3044728">String</span><span class="op" id="3044734">(</span><span class="op" id="3044735">)</span><br>
<span class="lineno"></span><span class="op" id="3044737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3044740">//&nbsp;FloatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;decimal&nbsp;form&nbsp;with&nbsp;prec</span><br>
<span class="lineno">615</span><span class="comment" id="3044818">//&nbsp;digits&nbsp;of&nbsp;precision&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point&nbsp;and&nbsp;the&nbsp;last&nbsp;digit&nbsp;rounded.</span><br>
<span class="lineno"></span><span class="keyword" id="3044893">func</span>&nbsp;<span class="op" id="3044898">(</span><span class="ident" id="3044899">x</span>&nbsp;<span class="op" id="3044901">*</span><span class="ident" id="3044902">Rat</span><span class="op" id="3044905">)</span>&nbsp;<span class="ident" id="3044907">FloatString</span><span class="op" id="3044918">(</span><span class="ident" id="3044919">prec</span>&nbsp;<span class="builtintype" id="3044924">int</span><span class="op" id="3044927">)</span>&nbsp;<span class="builtintype" id="3044929">string</span>&nbsp;<span class="op" id="3044936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044939">if</span>&nbsp;<span class="ident" id="3044942">x</span><span class="op" id="3044943">.</span><span class="ident" id="3044944">IsInt</span><span class="op" id="3044949">(</span><span class="op" id="3044950">)</span>&nbsp;<span class="op" id="3044952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044956">s</span>&nbsp;<span class="op" id="3044958">:=</span>&nbsp;<span class="ident" id="3044961">x</span><span class="op" id="3044962">.</span><span class="ident" id="3044963">a</span><span class="op" id="3044964">.</span><span class="ident" id="3044965">String</span><span class="op" id="3044971">(</span><span class="op" id="3044972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044976">if</span>&nbsp;<span class="ident" id="3044979">prec</span>&nbsp;<span class="op" id="3044984">&gt;</span>&nbsp;<span class="num" id="3044986">0</span>&nbsp;<span class="op" id="3044988">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044993">s</span>&nbsp;<span class="op" id="3044995">+=</span>&nbsp;<span class="string" id="3044998">&#34;.&#34;</span>&nbsp;<span class="op" id="3045002">+</span>&nbsp;<span class="ident" id="3045004">strings</span><span class="op" id="3045011">.</span><span class="ident" id="3045012">Repeat</span><span class="op" id="3045018">(</span><span class="string" id="3045019">&#34;0&#34;</span><span class="op" id="3045022">,</span>&nbsp;<span class="ident" id="3045024">prec</span><span class="op" id="3045028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3045032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3045036">return</span>&nbsp;<span class="ident" id="3045043">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3045046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3045049">//&nbsp;x.b.abs&nbsp;!=&nbsp;0</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045067">q</span><span class="op" id="3045068">,</span>&nbsp;<span class="ident" id="3045070">r</span>&nbsp;<span class="op" id="3045072">:=</span>&nbsp;<span class="ident" id="3045075">nat</span><span class="op" id="3045078">(</span><span class="builtintype" id="3045079">nil</span><span class="op" id="3045082">)</span><span class="op" id="3045083">.</span><span class="ident" id="3045084">div</span><span class="op" id="3045087">(</span><span class="ident" id="3045088">nat</span><span class="op" id="3045091">(</span><span class="builtintype" id="3045092">nil</span><span class="op" id="3045095">)</span><span class="op" id="3045096">,</span>&nbsp;<span class="ident" id="3045098">x</span><span class="op" id="3045099">.</span><span class="ident" id="3045100">a</span><span class="op" id="3045101">.</span><span class="ident" id="3045102">abs</span><span class="op" id="3045105">,</span>&nbsp;<span class="ident" id="3045107">x</span><span class="op" id="3045108">.</span><span class="ident" id="3045109">b</span><span class="op" id="3045110">.</span><span class="ident" id="3045111">abs</span><span class="op" id="3045114">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045118">p</span>&nbsp;<span class="op" id="3045120">:=</span>&nbsp;<span class="ident" id="3045123">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3045131">if</span>&nbsp;<span class="ident" id="3045134">prec</span>&nbsp;<span class="op" id="3045139">&gt;</span>&nbsp;<span class="num" id="3045141">0</span>&nbsp;<span class="op" id="3045143">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045147">p</span>&nbsp;<span class="op" id="3045149">=</span>&nbsp;<span class="ident" id="3045151">nat</span><span class="op" id="3045154">(</span><span class="builtintype" id="3045155">nil</span><span class="op" id="3045158">)</span><span class="op" id="3045159">.</span><span class="ident" id="3045160">expNN</span><span class="op" id="3045165">(</span><span class="ident" id="3045166">natTen</span><span class="op" id="3045172">,</span>&nbsp;<span class="ident" id="3045174">nat</span><span class="op" id="3045177">(</span><span class="builtintype" id="3045178">nil</span><span class="op" id="3045181">)</span><span class="op" id="3045182">.</span><span class="ident" id="3045183">setUint64</span><span class="op" id="3045192">(</span><span class="ident" id="3045193">uint64</span><span class="op" id="3045199">(</span><span class="ident" id="3045200">prec</span><span class="op" id="3045204">)</span><span class="op" id="3045205">)</span><span class="op" id="3045206">,</span>&nbsp;<span class="builtintype" id="3045208">nil</span><span class="op" id="3045211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3045214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045218">r</span>&nbsp;<span class="op" id="3045220">=</span>&nbsp;<span class="ident" id="3045222">r</span><span class="op" id="3045223">.</span><span class="ident" id="3045224">mul</span><span class="op" id="3045227">(</span><span class="ident" id="3045228">r</span><span class="op" id="3045229">,</span>&nbsp;<span class="ident" id="3045231">p</span><span class="op" id="3045232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045235">r</span><span class="op" id="3045236">,</span>&nbsp;<span class="ident" id="3045238">r2</span>&nbsp;<span class="op" id="3045241">:=</span>&nbsp;<span class="ident" id="3045244">r</span><span class="op" id="3045245">.</span><span class="ident" id="3045246">div</span><span class="op" id="3045249">(</span><span class="ident" id="3045250">nat</span><span class="op" id="3045253">(</span><span class="builtintype" id="3045254">nil</span><span class="op" id="3045257">)</span><span class="op" id="3045258">,</span>&nbsp;<span class="ident" id="3045260">r</span><span class="op" id="3045261">,</span>&nbsp;<span class="ident" id="3045263">x</span><span class="op" id="3045264">.</span><span class="ident" id="3045265">b</span><span class="op" id="3045266">.</span><span class="ident" id="3045267">abs</span><span class="op" id="3045270">)</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3045274">//&nbsp;see&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;round&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045305">r2</span>&nbsp;<span class="op" id="3045308">=</span>&nbsp;<span class="ident" id="3045310">r2</span><span class="op" id="3045312">.</span><span class="ident" id="3045313">add</span><span class="op" id="3045316">(</span><span class="ident" id="3045317">r2</span><span class="op" id="3045319">,</span>&nbsp;<span class="ident" id="3045321">r2</span><span class="op" id="3045323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3045326">if</span>&nbsp;<span class="ident" id="3045329">x</span><span class="op" id="3045330">.</span><span class="ident" id="3045331">b</span><span class="op" id="3045332">.</span><span class="ident" id="3045333">abs</span><span class="op" id="3045336">.</span><span class="ident" id="3045337">cmp</span><span class="op" id="3045340">(</span><span class="ident" id="3045341">r2</span><span class="op" id="3045343">)</span>&nbsp;<span class="op" id="3045345">&lt;=</span>&nbsp;<span class="num" id="3045348">0</span>&nbsp;<span class="op" id="3045350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045354">r</span>&nbsp;<span class="op" id="3045356">=</span>&nbsp;<span class="ident" id="3045358">r</span><span class="op" id="3045359">.</span><span class="ident" id="3045360">add</span><span class="op" id="3045363">(</span><span class="ident" id="3045364">r</span><span class="op" id="3045365">,</span>&nbsp;<span class="ident" id="3045367">natOne</span><span class="op" id="3045373">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3045377">if</span>&nbsp;<span class="ident" id="3045380">r</span><span class="op" id="3045381">.</span><span class="ident" id="3045382">cmp</span><span class="op" id="3045385">(</span><span class="ident" id="3045386">p</span><span class="op" id="3045387">)</span>&nbsp;<span class="op" id="3045389">&gt;=</span>&nbsp;<span class="num" id="3045392">0</span>&nbsp;<span class="op" id="3045394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045399">q</span>&nbsp;<span class="op" id="3045401">=</span>&nbsp;<span class="ident" id="3045403">nat</span><span class="op" id="3045406">(</span><span class="builtintype" id="3045407">nil</span><span class="op" id="3045410">)</span><span class="op" id="3045411">.</span><span class="ident" id="3045412">add</span><span class="op" id="3045415">(</span><span class="ident" id="3045416">q</span><span class="op" id="3045417">,</span>&nbsp;<span class="ident" id="3045419">natOne</span><span class="op" id="3045425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045430">r</span>&nbsp;<span class="op" id="3045432">=</span>&nbsp;<span class="ident" id="3045434">nat</span><span class="op" id="3045437">(</span><span class="builtintype" id="3045438">nil</span><span class="op" id="3045441">)</span><span class="op" id="3045442">.</span><span class="ident" id="3045443">sub</span><span class="op" id="3045446">(</span><span class="ident" id="3045447">r</span><span class="op" id="3045448">,</span>&nbsp;<span class="ident" id="3045450">p</span><span class="op" id="3045451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3045455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3045458">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045462">s</span>&nbsp;<span class="op" id="3045464">:=</span>&nbsp;<span class="ident" id="3045467">q</span><span class="op" id="3045468">.</span><span class="ident" id="3045469">decimalString</span><span class="op" id="3045482">(</span><span class="op" id="3045483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3045486">if</span>&nbsp;<span class="ident" id="3045489">x</span><span class="op" id="3045490">.</span><span class="ident" id="3045491">a</span><span class="op" id="3045492">.</span><span class="ident" id="3045493">neg</span>&nbsp;<span class="op" id="3045497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045501">s</span>&nbsp;<span class="op" id="3045503">=</span>&nbsp;<span class="string" id="3045505">&#34;-&#34;</span>&nbsp;<span class="op" id="3045509">+</span>&nbsp;<span class="ident" id="3045511">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3045514">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3045518">if</span>&nbsp;<span class="ident" id="3045521">prec</span>&nbsp;<span class="op" id="3045526">&gt;</span>&nbsp;<span class="num" id="3045528">0</span>&nbsp;<span class="op" id="3045530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045534">rs</span>&nbsp;<span class="op" id="3045537">:=</span>&nbsp;<span class="ident" id="3045540">r</span><span class="op" id="3045541">.</span><span class="ident" id="3045542">decimalString</span><span class="op" id="3045555">(</span><span class="op" id="3045556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045560">leadingZeros</span>&nbsp;<span class="op" id="3045573">:=</span>&nbsp;<span class="ident" id="3045576">prec</span>&nbsp;<span class="op" id="3045581">-</span>&nbsp;<span class="builtinfunc" id="3045583">len</span><span class="op" id="3045586">(</span><span class="ident" id="3045587">rs</span><span class="op" id="3045589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045593">s</span>&nbsp;<span class="op" id="3045595">+=</span>&nbsp;<span class="string" id="3045598">&#34;.&#34;</span>&nbsp;<span class="op" id="3045602">+</span>&nbsp;<span class="ident" id="3045604">strings</span><span class="op" id="3045611">.</span><span class="ident" id="3045612">Repeat</span><span class="op" id="3045618">(</span><span class="string" id="3045619">&#34;0&#34;</span><span class="op" id="3045622">,</span>&nbsp;<span class="ident" id="3045624">leadingZeros</span><span class="op" id="3045636">)</span>&nbsp;<span class="op" id="3045638">+</span>&nbsp;<span class="ident" id="3045640">rs</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3045644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3045648">return</span>&nbsp;<span class="ident" id="3045655">s</span><br>
<span class="lineno"></span><span class="op" id="3045657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="3045660">//&nbsp;Gob&nbsp;codec&nbsp;version.&nbsp;Permits&nbsp;backward-compatible&nbsp;changes&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3045735">const</span>&nbsp;<span class="ident" id="3045741">ratGobVersion</span>&nbsp;<span class="builtintype" id="3045755">byte</span>&nbsp;<span class="op" id="3045760">=</span>&nbsp;<span class="num" id="3045762">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3045765">//&nbsp;GobEncode&nbsp;implements&nbsp;the&nbsp;gob.GobEncoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3045819">func</span>&nbsp;<span class="op" id="3045824">(</span><span class="ident" id="3045825">x</span>&nbsp;<span class="op" id="3045827">*</span><span class="ident" id="3045828">Rat</span><span class="op" id="3045831">)</span>&nbsp;<span class="ident" id="3045833">GobEncode</span><span class="op" id="3045842">(</span><span class="op" id="3045843">)</span>&nbsp;<span class="op" id="3045845">(</span><span class="op" id="3045846">[</span><span class="op" id="3045847">]</span><span class="builtintype" id="3045848">byte</span><span class="op" id="3045852">,</span>&nbsp;<span class="builtintype" id="3045854">error</span><span class="op" id="3045859">)</span>&nbsp;<span class="op" id="3045861">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3045864">if</span>&nbsp;<span class="ident" id="3045867">x</span>&nbsp;<span class="op" id="3045869">==</span>&nbsp;<span class="builtintype" id="3045872">nil</span>&nbsp;<span class="op" id="3045876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3045880">return</span>&nbsp;<span class="builtintype" id="3045887">nil</span><span class="op" id="3045890">,</span>&nbsp;<span class="builtintype" id="3045892">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3045897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3045900">buf</span>&nbsp;<span class="op" id="3045904">:=</span>&nbsp;<span class="builtinfunc" id="3045907">make</span><span class="op" id="3045911">(</span><span class="op" id="3045912">[</span><span class="op" id="3045913">]</span><span class="builtintype" id="3045914">byte</span><span class="op" id="3045918">,</span>&nbsp;<span class="num" id="3045920">1</span><span class="op" id="3045921">+</span><span class="num" id="3045922">4</span><span class="op" id="3045923">+</span><span class="op" id="3045924">(</span><span class="builtinfunc" id="3045925">len</span><span class="op" id="3045928">(</span><span class="ident" id="3045929">x</span><span class="op" id="3045930">.</span><span class="ident" id="3045931">a</span><span class="op" id="3045932">.</span><span class="ident" id="3045933">abs</span><span class="op" id="3045936">)</span><span class="op" id="3045937">+</span><span class="builtinfunc" id="3045938">len</span><span class="op" id="3045941">(</span><span class="ident" id="3045942">x</span><span class="op" id="3045943">.</span><span class="ident" id="3045944">b</span><span class="op" id="3045945">.</span><span class="ident" id="3045946">abs</span><span class="op" id="3045949">)</span><span class="op" id="3045950">)</span><span class="op" id="3045951">*</span><span class="ident" id="3045952">_S</span><span class="op" id="3045954">)</span>&nbsp;<span class="comment" id="3045956">//&nbsp;extra&nbsp;bytes&nbsp;for&nbsp;version&nbsp;and&nbsp;sign&nbsp;bit&nbsp;(1),&nbsp;and&nbsp;numerator&nbsp;length&nbsp;(4)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3046027">i</span>&nbsp;<span class="op" id="3046029">:=</span>&nbsp;<span class="ident" id="3046032">x</span><span class="op" id="3046033">.</span><span class="ident" id="3046034">b</span><span class="op" id="3046035">.</span><span class="ident" id="3046036">abs</span><span class="op" id="3046039">.</span><span class="ident" id="3046040">bytes</span><span class="op" id="3046045">(</span><span class="ident" id="3046046">buf</span><span class="op" id="3046049">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3046052">j</span>&nbsp;<span class="op" id="3046054">:=</span>&nbsp;<span class="ident" id="3046057">x</span><span class="op" id="3046058">.</span><span class="ident" id="3046059">a</span><span class="op" id="3046060">.</span><span class="ident" id="3046061">abs</span><span class="op" id="3046064">.</span><span class="ident" id="3046065">bytes</span><span class="op" id="3046070">(</span><span class="ident" id="3046071">buf</span><span class="op" id="3046074">[</span><span class="num" id="3046075">0</span><span class="op" id="3046076">:</span><span class="ident" id="3046077">i</span><span class="op" id="3046078">]</span><span class="op" id="3046079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3046082">n</span>&nbsp;<span class="op" id="3046084">:=</span>&nbsp;<span class="ident" id="3046087">i</span>&nbsp;<span class="op" id="3046089">-</span>&nbsp;<span class="ident" id="3046091">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046094">if</span>&nbsp;<span class="builtintype" id="3046097">int</span><span class="op" id="3046100">(</span><span class="builtintype" id="3046101">uint32</span><span class="op" id="3046107">(</span><span class="ident" id="3046108">n</span><span class="op" id="3046109">)</span><span class="op" id="3046110">)</span>&nbsp;<span class="op" id="3046112">!=</span>&nbsp;<span class="ident" id="3046115">n</span>&nbsp;<span class="op" id="3046117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3046121">//&nbsp;this&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046151">return</span>&nbsp;<span class="builtintype" id="3046158">nil</span><span class="op" id="3046161">,</span>&nbsp;<span class="ident" id="3046163">errors</span><span class="op" id="3046169">.</span><span class="ident" id="3046170">New</span><span class="op" id="3046173">(</span><span class="string" id="3046174">&#34;Rat.GobEncode:&nbsp;numerator&nbsp;too&nbsp;large&#34;</span><span class="op" id="3046210">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3046213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3046216">binary</span><span class="op" id="3046222">.</span><span class="ident" id="3046223">BigEndian</span><span class="op" id="3046232">.</span><span class="ident" id="3046233">PutUint32</span><span class="op" id="3046242">(</span><span class="ident" id="3046243">buf</span><span class="op" id="3046246">[</span><span class="ident" id="3046247">j</span><span class="op" id="3046248">-</span><span class="num" id="3046249">4</span><span class="op" id="3046250">:</span><span class="ident" id="3046251">j</span><span class="op" id="3046252">]</span><span class="op" id="3046253">,</span>&nbsp;<span class="builtintype" id="3046255">uint32</span><span class="op" id="3046261">(</span><span class="ident" id="3046262">n</span><span class="op" id="3046263">)</span><span class="op" id="3046264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3046267">j</span>&nbsp;<span class="op" id="3046269">-=</span>&nbsp;<span class="num" id="3046272">1</span>&nbsp;<span class="op" id="3046274">+</span>&nbsp;<span class="num" id="3046276">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3046279">b</span>&nbsp;<span class="op" id="3046281">:=</span>&nbsp;<span class="ident" id="3046284">ratGobVersion</span>&nbsp;<span class="op" id="3046298">&lt;&lt;</span>&nbsp;<span class="num" id="3046301">1</span>&nbsp;<span class="comment" id="3046303">//&nbsp;make&nbsp;space&nbsp;for&nbsp;sign&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046331">if</span>&nbsp;<span class="ident" id="3046334">x</span><span class="op" id="3046335">.</span><span class="ident" id="3046336">a</span><span class="op" id="3046337">.</span><span class="ident" id="3046338">neg</span>&nbsp;<span class="op" id="3046342">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3046346">b</span>&nbsp;<span class="op" id="3046348">|=</span>&nbsp;<span class="num" id="3046351">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3046354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3046357">buf</span><span class="op" id="3046360">[</span><span class="ident" id="3046361">j</span><span class="op" id="3046362">]</span>&nbsp;<span class="op" id="3046364">=</span>&nbsp;<span class="ident" id="3046366">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046369">return</span>&nbsp;<span class="ident" id="3046376">buf</span><span class="op" id="3046379">[</span><span class="ident" id="3046380">j</span><span class="op" id="3046381">:</span><span class="op" id="3046382">]</span><span class="op" id="3046383">,</span>&nbsp;<span class="builtintype" id="3046385">nil</span><br>
<span class="lineno"></span><span class="op" id="3046389">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="3046392">//&nbsp;GobDecode&nbsp;implements&nbsp;the&nbsp;gob.GobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3046446">func</span>&nbsp;<span class="op" id="3046451">(</span><span class="ident" id="3046452">z</span>&nbsp;<span class="op" id="3046454">*</span><span class="ident" id="3046455">Rat</span><span class="op" id="3046458">)</span>&nbsp;<span class="ident" id="3046460">GobDecode</span><span class="op" id="3046469">(</span><span class="ident" id="3046470">buf</span>&nbsp;<span class="op" id="3046474">[</span><span class="op" id="3046475">]</span><span class="builtintype" id="3046476">byte</span><span class="op" id="3046480">)</span>&nbsp;<span class="builtintype" id="3046482">error</span>&nbsp;<span class="op" id="3046488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046491">if</span>&nbsp;<span class="builtinfunc" id="3046494">len</span><span class="op" id="3046497">(</span><span class="ident" id="3046498">buf</span><span class="op" id="3046501">)</span>&nbsp;<span class="op" id="3046503">==</span>&nbsp;<span class="num" id="3046506">0</span>&nbsp;<span class="op" id="3046508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3046512">//&nbsp;Other&nbsp;side&nbsp;sent&nbsp;a&nbsp;nil&nbsp;or&nbsp;default&nbsp;value.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3046557">*</span><span class="ident" id="3046558">z</span>&nbsp;<span class="op" id="3046560">=</span>&nbsp;<span class="ident" id="3046562">Rat</span><span class="op" id="3046565">{</span><span class="op" id="3046566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046570">return</span>&nbsp;<span class="builtintype" id="3046577">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3046582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3046585">b</span>&nbsp;<span class="op" id="3046587">:=</span>&nbsp;<span class="ident" id="3046590">buf</span><span class="op" id="3046593">[</span><span class="num" id="3046594">0</span><span class="op" id="3046595">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046598">if</span>&nbsp;<span class="ident" id="3046601">b</span><span class="op" id="3046602">&gt;&gt;</span><span class="num" id="3046604">1</span>&nbsp;<span class="op" id="3046606">!=</span>&nbsp;<span class="ident" id="3046609">ratGobVersion</span>&nbsp;<span class="op" id="3046623">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046627">return</span>&nbsp;<span class="ident" id="3046634">errors</span><span class="op" id="3046640">.</span><span class="ident" id="3046641">New</span><span class="op" id="3046644">(</span><span class="ident" id="3046645">fmt</span><span class="op" id="3046648">.</span><span class="ident" id="3046649">Sprintf</span><span class="op" id="3046656">(</span><span class="string" id="3046657">&#34;Rat.GobDecode:&nbsp;encoding&nbsp;version&nbsp;%d&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3046707">,</span>&nbsp;<span class="ident" id="3046709">b</span><span class="op" id="3046710">&gt;&gt;</span><span class="num" id="3046712">1</span><span class="op" id="3046713">)</span><span class="op" id="3046714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3046717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046720">const</span>&nbsp;<span class="ident" id="3046726">j</span>&nbsp;<span class="op" id="3046728">=</span>&nbsp;<span class="num" id="3046730">1</span>&nbsp;<span class="op" id="3046732">+</span>&nbsp;<span class="num" id="3046734">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3046737">i</span>&nbsp;<span class="op" id="3046739">:=</span>&nbsp;<span class="ident" id="3046742">j</span>&nbsp;<span class="op" id="3046744">+</span>&nbsp;<span class="ident" id="3046746">binary</span><span class="op" id="3046752">.</span><span class="ident" id="3046753">BigEndian</span><span class="op" id="3046762">.</span><span class="ident" id="3046763">Uint32</span><span class="op" id="3046769">(</span><span class="ident" id="3046770">buf</span><span class="op" id="3046773">[</span><span class="ident" id="3046774">j</span><span class="op" id="3046775">-</span><span class="num" id="3046776">4</span><span class="op" id="3046777">:</span><span class="ident" id="3046778">j</span><span class="op" id="3046779">]</span><span class="op" id="3046780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3046783">z</span><span class="op" id="3046784">.</span><span class="ident" id="3046785">a</span><span class="op" id="3046786">.</span><span class="ident" id="3046787">neg</span>&nbsp;<span class="op" id="3046791">=</span>&nbsp;<span class="ident" id="3046793">b</span><span class="op" id="3046794">&amp;</span><span class="num" id="3046795">1</span>&nbsp;<span class="op" id="3046797">!=</span>&nbsp;<span class="num" id="3046800">0</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3046803">z</span><span class="op" id="3046804">.</span><span class="ident" id="3046805">a</span><span class="op" id="3046806">.</span><span class="ident" id="3046807">abs</span>&nbsp;<span class="op" id="3046811">=</span>&nbsp;<span class="ident" id="3046813">z</span><span class="op" id="3046814">.</span><span class="ident" id="3046815">a</span><span class="op" id="3046816">.</span><span class="ident" id="3046817">abs</span><span class="op" id="3046820">.</span><span class="ident" id="3046821">setBytes</span><span class="op" id="3046829">(</span><span class="ident" id="3046830">buf</span><span class="op" id="3046833">[</span><span class="ident" id="3046834">j</span><span class="op" id="3046835">:</span><span class="ident" id="3046836">i</span><span class="op" id="3046837">]</span><span class="op" id="3046838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3046841">z</span><span class="op" id="3046842">.</span><span class="ident" id="3046843">b</span><span class="op" id="3046844">.</span><span class="ident" id="3046845">abs</span>&nbsp;<span class="op" id="3046849">=</span>&nbsp;<span class="ident" id="3046851">z</span><span class="op" id="3046852">.</span><span class="ident" id="3046853">b</span><span class="op" id="3046854">.</span><span class="ident" id="3046855">abs</span><span class="op" id="3046858">.</span><span class="ident" id="3046859">setBytes</span><span class="op" id="3046867">(</span><span class="ident" id="3046868">buf</span><span class="op" id="3046871">[</span><span class="ident" id="3046872">i</span><span class="op" id="3046873">:</span><span class="op" id="3046874">]</span><span class="op" id="3046875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046878">return</span>&nbsp;<span class="builtintype" id="3046885">nil</span><br>
<span class="lineno"></span><span class="op" id="3046889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="3046892">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3046956">func</span>&nbsp;<span class="op" id="3046961">(</span><span class="ident" id="3046962">r</span>&nbsp;<span class="op" id="3046964">*</span><span class="ident" id="3046965">Rat</span><span class="op" id="3046968">)</span>&nbsp;<span class="ident" id="3046970">MarshalText</span><span class="op" id="3046981">(</span><span class="op" id="3046982">)</span>&nbsp;<span class="op" id="3046984">(</span><span class="ident" id="3046985">text</span>&nbsp;<span class="op" id="3046990">[</span><span class="op" id="3046991">]</span><span class="builtintype" id="3046992">byte</span><span class="op" id="3046996">,</span>&nbsp;<span class="ident" id="3046998">err</span>&nbsp;<span class="builtintype" id="3047002">error</span><span class="op" id="3047007">)</span>&nbsp;<span class="op" id="3047009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3047012">return</span>&nbsp;<span class="op" id="3047019">[</span><span class="op" id="3047020">]</span><span class="builtintype" id="3047021">byte</span><span class="op" id="3047025">(</span><span class="ident" id="3047026">r</span><span class="op" id="3047027">.</span><span class="ident" id="3047028">RatString</span><span class="op" id="3047037">(</span><span class="op" id="3047038">)</span><span class="op" id="3047039">)</span><span class="op" id="3047040">,</span>&nbsp;<span class="builtintype" id="3047042">nil</span><br>
<span class="lineno"></span><span class="op" id="3047046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span><span class="comment" id="3047049">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3047117">func</span>&nbsp;<span class="op" id="3047122">(</span><span class="ident" id="3047123">r</span>&nbsp;<span class="op" id="3047125">*</span><span class="ident" id="3047126">Rat</span><span class="op" id="3047129">)</span>&nbsp;<span class="ident" id="3047131">UnmarshalText</span><span class="op" id="3047144">(</span><span class="ident" id="3047145">text</span>&nbsp;<span class="op" id="3047150">[</span><span class="op" id="3047151">]</span><span class="builtintype" id="3047152">byte</span><span class="op" id="3047156">)</span>&nbsp;<span class="builtintype" id="3047158">error</span>&nbsp;<span class="op" id="3047164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3047167">if</span>&nbsp;<span class="ident" id="3047170">_</span><span class="op" id="3047171">,</span>&nbsp;<span class="ident" id="3047173">ok</span>&nbsp;<span class="op" id="3047176">:=</span>&nbsp;<span class="ident" id="3047179">r</span><span class="op" id="3047180">.</span><span class="ident" id="3047181">SetString</span><span class="op" id="3047190">(</span><span class="builtintype" id="3047191">string</span><span class="op" id="3047197">(</span><span class="ident" id="3047198">text</span><span class="op" id="3047202">)</span><span class="op" id="3047203">)</span><span class="op" id="3047204">;</span>&nbsp;<span class="op" id="3047206">!</span><span class="ident" id="3047207">ok</span>&nbsp;<span class="op" id="3047210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3047214">return</span>&nbsp;<span class="ident" id="3047221">fmt</span><span class="op" id="3047224">.</span><span class="ident" id="3047225">Errorf</span><span class="op" id="3047231">(</span><span class="string" id="3047232">&#34;math/big:&nbsp;cannot&nbsp;unmarshal&nbsp;%q&nbsp;into&nbsp;a&nbsp;*big.Rat&#34;</span><span class="op" id="3047279">,</span>&nbsp;<span class="ident" id="3047281">text</span><span class="op" id="3047285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3047288">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3047291">return</span>&nbsp;<span class="builtintype" id="3047298">nil</span><br>
<span class="lineno"></span><span class="op" id="3047302">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
