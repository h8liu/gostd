<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7086233">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7086288">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7086342">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7086393">package</span>&nbsp;<span class="ident" id="7086401">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7086406">import</span>&nbsp;<span class="op" id="7086413">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086416">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086425">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086441">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086455">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086470">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086486">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086493">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086499">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086506">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086512">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086523">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086540">&#34;strconv&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086551">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7086562">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7086569">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7086572">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno">25</span><span class="comment" id="7086647">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7086663">//&nbsp;blockingSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;blocks&nbsp;a&nbsp;Read&nbsp;call&nbsp;until&nbsp;it&#39;s&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="7086740">type</span>&nbsp;<span class="ident" id="7086745">blockingSource</span>&nbsp;<span class="keyword" id="7086760">chan</span>&nbsp;<span class="builtintype" id="7086765">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7086771">func</span>&nbsp;<span class="op" id="7086776">(</span><span class="ident" id="7086777">b</span>&nbsp;<span class="ident" id="7086779"><a href="/crypto/tls/handshake_client_test.go.html#7086745">blockingSource</a></span><span class="op" id="7086793">)</span>&nbsp;<span class="ident" id="7086795">Read</span><span class="op" id="7086799">(</span><span class="op" id="7086800">[</span><span class="op" id="7086801">]</span><span class="builtintype" id="7086802">byte</span><span class="op" id="7086806">)</span>&nbsp;<span class="op" id="7086808">(</span><span class="ident" id="7086809">n</span>&nbsp;<span class="builtintype" id="7086811">int</span><span class="op" id="7086814">,</span>&nbsp;<span class="ident" id="7086816">err</span>&nbsp;<span class="builtintype" id="7086820">error</span><span class="op" id="7086825">)</span>&nbsp;<span class="op" id="7086827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7086830">&lt;-</span><span class="ident" id="7086832"><a href="/crypto/tls/handshake_client_test.go.html#7086777">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086835">return</span>&nbsp;<span class="num" id="7086842">0</span><span class="op" id="7086843">,</span>&nbsp;<span class="ident" id="7086845"><a href="/crypto/tls/handshake_client_test.go.html#7086493">io</a></span><span class="op" id="7086847">.</span><span class="ident" id="7086848">EOF</span><br>
<span class="lineno"></span><span class="op" id="7086852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="7086855">//&nbsp;clientTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;client&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7086935">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7086954">type</span>&nbsp;<span class="ident" id="7086959">clientTest</span>&nbsp;<span class="keyword" id="7086970">struct</span>&nbsp;<span class="op" id="7086977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7086980">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7087053">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7087094">name</span>&nbsp;<span class="builtintype" id="7087099">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7087107">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7087173">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7087218">command</span>&nbsp;<span class="op" id="7087226">[</span><span class="op" id="7087227">]</span><span class="builtintype" id="7087228">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7087236">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7087307">config</span>&nbsp;<span class="op" id="7087314">*</span><span class="ident" id="7087315"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7087323">//&nbsp;cert,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;DER-encoded&nbsp;certificate&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7087390">//&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7087412">cert</span>&nbsp;<span class="op" id="7087417">[</span><span class="op" id="7087418">]</span><span class="builtintype" id="7087419">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7087425">//&nbsp;key,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;either&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7087483">//&nbsp;*ecdsa.PrivateKey&nbsp;which&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7087556">key</span>&nbsp;<span class="keyword" id="7087560">interface</span><span class="op" id="7087569">{</span><span class="op" id="7087570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7087573">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7087642">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7087712">//&nbsp;error&nbsp;if&nbsp;the&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7087762">validate</span>&nbsp;<span class="keyword" id="7087771">func</span><span class="op" id="7087775">(</span><span class="ident" id="7087776"><a href="/crypto/tls/common.go.html#4112190">ConnectionState</a></span><span class="op" id="7087791">)</span>&nbsp;<span class="builtintype" id="7087793">error</span><br>
<span class="lineno"></span><span class="op" id="7087799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7087802">var</span>&nbsp;<span class="ident" id="7087806">defaultServerCommand</span>&nbsp;<span class="op" id="7087827">=</span>&nbsp;<span class="op" id="7087829">[</span><span class="op" id="7087830">]</span><span class="builtintype" id="7087831">string</span><span class="op" id="7087837">{</span><span class="string" id="7087838">&#34;openssl&#34;</span><span class="op" id="7087847">,</span>&nbsp;<span class="string" id="7087849">&#34;s_server&#34;</span><span class="op" id="7087859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="7087862">//&nbsp;connFromCommand&nbsp;starts&nbsp;the&nbsp;reference&nbsp;server&nbsp;process,&nbsp;connects&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="7087937">//&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;for&nbsp;the&nbsp;connection.&nbsp;The&nbsp;stdin&nbsp;return&nbsp;value&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7088012">//&nbsp;blockingSource&nbsp;for&nbsp;the&nbsp;stdin&nbsp;of&nbsp;the&nbsp;child&nbsp;process.&nbsp;It&nbsp;must&nbsp;be&nbsp;closed&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="7088091">//&nbsp;Waiting&nbsp;for&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="7088113">func</span>&nbsp;<span class="op" id="7088118">(</span><span class="ident" id="7088119">test</span>&nbsp;<span class="op" id="7088124">*</span><span class="ident" id="7088125"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7088135">)</span>&nbsp;<span class="ident" id="7088137">connFromCommand</span><span class="op" id="7088152">(</span><span class="op" id="7088153">)</span>&nbsp;<span class="op" id="7088155">(</span><span class="ident" id="7088156">conn</span>&nbsp;<span class="op" id="7088161">*</span><span class="ident" id="7088162"><a href="/crypto/tls/handshake_test.go.html#7138857">recordingConn</a></span><span class="op" id="7088175">,</span>&nbsp;<span class="ident" id="7088177">child</span>&nbsp;<span class="op" id="7088183">*</span><span class="ident" id="7088184"><a href="/crypto/tls/handshake_client_test.go.html#7086512">exec</a></span><span class="op" id="7088188">.</span><span class="ident" id="7088189">Cmd</span><span class="op" id="7088192">,</span>&nbsp;<span class="ident" id="7088194">stdin</span>&nbsp;<span class="ident" id="7088200"><a href="/crypto/tls/handshake_client_test.go.html#7086745">blockingSource</a></span><span class="op" id="7088214">,</span>&nbsp;<span class="ident" id="7088216">err</span>&nbsp;<span class="builtintype" id="7088220">error</span><span class="op" id="7088225">)</span>&nbsp;<span class="op" id="7088227">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088230">cert</span>&nbsp;<span class="op" id="7088235">:=</span>&nbsp;<span class="ident" id="7088238"><a href="/crypto/tls/handshake_server_test.go.html#7132055">testRSACertificate</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088258">if</span>&nbsp;<span class="builtinfunc" id="7088261">len</span><span class="op" id="7088264">(</span><span class="ident" id="7088265"><a href="/crypto/tls/handshake_client_test.go.html#7088119">test</a></span><span class="op" id="7088269">.</span><span class="ident" id="7088270">cert</span><span class="op" id="7088274">)</span>&nbsp;<span class="op" id="7088276">&gt;</span>&nbsp;<span class="num" id="7088278">0</span>&nbsp;<span class="op" id="7088280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088284"><a href="/crypto/tls/handshake_client_test.go.html#7088230">cert</a></span>&nbsp;<span class="op" id="7088289">=</span>&nbsp;<span class="ident" id="7088291"><a href="/crypto/tls/handshake_client_test.go.html#7088119">test</a></span><span class="op" id="7088295">.</span><span class="ident" id="7088296">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7088302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088305">certPath</span>&nbsp;<span class="op" id="7088314">:=</span>&nbsp;<span class="ident" id="7088317"><a href="/crypto/tls/handshake_test.go.html#7141468">tempFile</a></span><span class="op" id="7088325">(</span><span class="builtintype" id="7088326">string</span><span class="op" id="7088332">(</span><span class="ident" id="7088333"><a href="/crypto/tls/handshake_client_test.go.html#7088230">cert</a></span><span class="op" id="7088337">)</span><span class="op" id="7088338">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088341">defer</span>&nbsp;<span class="ident" id="7088347"><a href="/crypto/tls/handshake_client_test.go.html#7086506">os</a></span><span class="op" id="7088349">.</span><span class="ident" id="7088350">Remove</span><span class="op" id="7088356">(</span><span class="ident" id="7088357"><a href="/crypto/tls/handshake_client_test.go.html#7088305">certPath</a></span><span class="op" id="7088365">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088369">var</span>&nbsp;<span class="ident" id="7088373">key</span>&nbsp;<span class="keyword" id="7088377">interface</span><span class="op" id="7088386">{</span><span class="op" id="7088387">}</span>&nbsp;<span class="op" id="7088389">=</span>&nbsp;<span class="ident" id="7088391"><a href="/crypto/tls/handshake_server_test.go.html#7135591">testRSAPrivateKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088410">if</span>&nbsp;<span class="ident" id="7088413"><a href="/crypto/tls/handshake_client_test.go.html#7088119">test</a></span><span class="op" id="7088417">.</span><span class="ident" id="7088418">key</span>&nbsp;<span class="op" id="7088422">!=</span>&nbsp;<span class="ident" id="7088425">nil</span>&nbsp;<span class="op" id="7088429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088433"><a href="/crypto/tls/handshake_client_test.go.html#7088373">key</a></span>&nbsp;<span class="op" id="7088437">=</span>&nbsp;<span class="ident" id="7088439"><a href="/crypto/tls/handshake_client_test.go.html#7088119">test</a></span><span class="op" id="7088443">.</span><span class="ident" id="7088444">key</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7088449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088452">var</span>&nbsp;<span class="ident" id="7088456">pemType</span>&nbsp;<span class="builtintype" id="7088464">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088472">var</span>&nbsp;<span class="ident" id="7088476">derBytes</span>&nbsp;<span class="op" id="7088485">[</span><span class="op" id="7088486">]</span><span class="builtintype" id="7088487">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088493">switch</span>&nbsp;<span class="ident" id="7088500">key</span>&nbsp;<span class="op" id="7088504">:=</span>&nbsp;<span class="ident" id="7088507"><a href="/crypto/tls/handshake_client_test.go.html#7088373">key</a></span><span class="op" id="7088510">.</span><span class="op" id="7088511">(</span><span class="keyword" id="7088512">type</span><span class="op" id="7088516">)</span>&nbsp;<span class="op" id="7088518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088521">case</span>&nbsp;<span class="op" id="7088526">*</span><span class="ident" id="7088527"><a href="/crypto/tls/handshake_client_test.go.html#7086441">rsa</a></span><span class="op" id="7088530">.</span><span class="ident" id="7088531">PrivateKey</span><span class="op" id="7088541">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088545"><a href="/crypto/tls/handshake_client_test.go.html#7088456">pemType</a></span>&nbsp;<span class="op" id="7088553">=</span>&nbsp;<span class="string" id="7088555">&#34;RSA&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088563"><a href="/crypto/tls/handshake_client_test.go.html#7088476">derBytes</a></span>&nbsp;<span class="op" id="7088572">=</span>&nbsp;<span class="ident" id="7088574"><a href="/crypto/tls/handshake_client_test.go.html#7086455">x509</a></span><span class="op" id="7088578">.</span><span class="ident" id="7088579">MarshalPKCS1PrivateKey</span><span class="op" id="7088601">(</span><span class="ident" id="7088602"><a href="/crypto/tls/handshake_client_test.go.html#7088500">key</a></span><span class="op" id="7088605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088608">case</span>&nbsp;<span class="op" id="7088613">*</span><span class="ident" id="7088614"><a href="/crypto/tls/handshake_client_test.go.html#7086425">ecdsa</a></span><span class="op" id="7088619">.</span><span class="ident" id="7088620">PrivateKey</span><span class="op" id="7088630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088634"><a href="/crypto/tls/handshake_client_test.go.html#7088456">pemType</a></span>&nbsp;<span class="op" id="7088642">=</span>&nbsp;<span class="string" id="7088644">&#34;EC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088651">var</span>&nbsp;<span class="ident" id="7088655">err</span>&nbsp;<span class="builtintype" id="7088659">error</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088667"><a href="/crypto/tls/handshake_client_test.go.html#7088476">derBytes</a></span><span class="op" id="7088675">,</span>&nbsp;<span class="ident" id="7088677"><a href="/crypto/tls/handshake_client_test.go.html#7088655">err</a></span>&nbsp;<span class="op" id="7088681">=</span>&nbsp;<span class="ident" id="7088683"><a href="/crypto/tls/handshake_client_test.go.html#7086455">x509</a></span><span class="op" id="7088687">.</span><span class="ident" id="7088688">MarshalECPrivateKey</span><span class="op" id="7088707">(</span><span class="ident" id="7088708"><a href="/crypto/tls/handshake_client_test.go.html#7088500">key</a></span><span class="op" id="7088711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088715">if</span>&nbsp;<span class="ident" id="7088718"><a href="/crypto/tls/handshake_client_test.go.html#7088655">err</a></span>&nbsp;<span class="op" id="7088722">!=</span>&nbsp;<span class="ident" id="7088725">nil</span>&nbsp;<span class="op" id="7088729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7088734">panic</span><span class="op" id="7088739">(</span><span class="ident" id="7088740"><a href="/crypto/tls/handshake_client_test.go.html#7088655">err</a></span><span class="op" id="7088743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7088747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088750">default</span><span class="op" id="7088757">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7088761">panic</span><span class="op" id="7088766">(</span><span class="string" id="7088767">&#34;unknown&nbsp;key&nbsp;type&#34;</span><span class="op" id="7088785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7088788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088792">var</span>&nbsp;<span class="ident" id="7088796">pemOut</span>&nbsp;<span class="ident" id="7088803"><a href="/crypto/tls/handshake_client_test.go.html#7086416">bytes</a></span><span class="op" id="7088808">.</span><span class="ident" id="7088809">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088817"><a href="/crypto/tls/handshake_client_test.go.html#7086470">pem</a></span><span class="op" id="7088820">.</span><span class="ident" id="7088821">Encode</span><span class="op" id="7088827">(</span><span class="op" id="7088828">&amp;</span><span class="ident" id="7088829"><a href="/crypto/tls/handshake_client_test.go.html#7088796">pemOut</a></span><span class="op" id="7088835">,</span>&nbsp;<span class="op" id="7088837">&amp;</span><span class="ident" id="7088838"><a href="/crypto/tls/handshake_client_test.go.html#7086470">pem</a></span><span class="op" id="7088841">.</span><span class="ident" id="7088842">Block</span><span class="op" id="7088847">{</span><span class="ident" id="7088848">Type</span><span class="op" id="7088852">:</span>&nbsp;<span class="ident" id="7088854"><a href="/crypto/tls/handshake_client_test.go.html#7088456">pemType</a></span>&nbsp;<span class="op" id="7088862">+</span>&nbsp;<span class="string" id="7088864">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="7088878">,</span>&nbsp;<span class="ident" id="7088880">Bytes</span><span class="op" id="7088885">:</span>&nbsp;<span class="ident" id="7088887"><a href="/crypto/tls/handshake_client_test.go.html#7088476">derBytes</a></span><span class="op" id="7088895">}</span><span class="op" id="7088896">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088900">keyPath</span>&nbsp;<span class="op" id="7088908">:=</span>&nbsp;<span class="ident" id="7088911"><a href="/crypto/tls/handshake_test.go.html#7141468">tempFile</a></span><span class="op" id="7088919">(</span><span class="builtintype" id="7088920">string</span><span class="op" id="7088926">(</span><span class="ident" id="7088927"><a href="/crypto/tls/handshake_client_test.go.html#7088796">pemOut</a></span><span class="op" id="7088933">.</span><span class="ident" id="7088934">Bytes</span><span class="op" id="7088939">(</span><span class="op" id="7088940">)</span><span class="op" id="7088941">)</span><span class="op" id="7088942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088945">defer</span>&nbsp;<span class="ident" id="7088951"><a href="/crypto/tls/handshake_client_test.go.html#7086506">os</a></span><span class="op" id="7088953">.</span><span class="ident" id="7088954">Remove</span><span class="op" id="7088960">(</span><span class="ident" id="7088961"><a href="/crypto/tls/handshake_client_test.go.html#7088900">keyPath</a></span><span class="op" id="7088968">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088972">var</span>&nbsp;<span class="ident" id="7088976">command</span>&nbsp;<span class="op" id="7088984">[</span><span class="op" id="7088985">]</span><span class="builtintype" id="7088986">string</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088994">if</span>&nbsp;<span class="builtinfunc" id="7088997">len</span><span class="op" id="7089000">(</span><span class="ident" id="7089001"><a href="/crypto/tls/handshake_client_test.go.html#7088119">test</a></span><span class="op" id="7089005">.</span><span class="ident" id="7089006">command</span><span class="op" id="7089013">)</span>&nbsp;<span class="op" id="7089015">&gt;</span>&nbsp;<span class="num" id="7089017">0</span>&nbsp;<span class="op" id="7089019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089023"><a href="/crypto/tls/handshake_client_test.go.html#7088976">command</a></span>&nbsp;<span class="op" id="7089031">=</span>&nbsp;<span class="builtinfunc" id="7089033">append</span><span class="op" id="7089039">(</span><span class="ident" id="7089040"><a href="/crypto/tls/handshake_client_test.go.html#7088976">command</a></span><span class="op" id="7089047">,</span>&nbsp;<span class="ident" id="7089049"><a href="/crypto/tls/handshake_client_test.go.html#7088119">test</a></span><span class="op" id="7089053">.</span><span class="ident" id="7089054">command</span><span class="op" id="7089061">...</span><span class="op" id="7089064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7089067">}</span>&nbsp;<span class="keyword" id="7089069">else</span>&nbsp;<span class="op" id="7089074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089078"><a href="/crypto/tls/handshake_client_test.go.html#7088976">command</a></span>&nbsp;<span class="op" id="7089086">=</span>&nbsp;<span class="builtinfunc" id="7089088">append</span><span class="op" id="7089094">(</span><span class="ident" id="7089095"><a href="/crypto/tls/handshake_client_test.go.html#7088976">command</a></span><span class="op" id="7089102">,</span>&nbsp;<span class="ident" id="7089104"><a href="/crypto/tls/handshake_client_test.go.html#7087806">defaultServerCommand</a></span><span class="op" id="7089124">...</span><span class="op" id="7089127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7089130">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089133"><a href="/crypto/tls/handshake_client_test.go.html#7088976">command</a></span>&nbsp;<span class="op" id="7089141">=</span>&nbsp;<span class="builtinfunc" id="7089143">append</span><span class="op" id="7089149">(</span><span class="ident" id="7089150"><a href="/crypto/tls/handshake_client_test.go.html#7088976">command</a></span><span class="op" id="7089157">,</span>&nbsp;<span class="string" id="7089159">&#34;-cert&#34;</span><span class="op" id="7089166">,</span>&nbsp;<span class="ident" id="7089168"><a href="/crypto/tls/handshake_client_test.go.html#7088305">certPath</a></span><span class="op" id="7089176">,</span>&nbsp;<span class="string" id="7089178">&#34;-certform&#34;</span><span class="op" id="7089189">,</span>&nbsp;<span class="string" id="7089191">&#34;DER&#34;</span><span class="op" id="7089196">,</span>&nbsp;<span class="string" id="7089198">&#34;-key&#34;</span><span class="op" id="7089204">,</span>&nbsp;<span class="ident" id="7089206"><a href="/crypto/tls/handshake_client_test.go.html#7088900">keyPath</a></span><span class="op" id="7089213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7089216">//&nbsp;serverPort&nbsp;contains&nbsp;the&nbsp;port&nbsp;that&nbsp;OpenSSL&nbsp;will&nbsp;listen&nbsp;on.&nbsp;OpenSSL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7089286">//&nbsp;can&#39;t&nbsp;take&nbsp;&#34;0&#34;&nbsp;as&nbsp;an&nbsp;argument&nbsp;here&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;pick&nbsp;a&nbsp;number&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7089357">//&nbsp;hope&nbsp;that&nbsp;it&#39;s&nbsp;not&nbsp;in&nbsp;use&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Since&nbsp;this&nbsp;only&nbsp;occurs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7089426">//&nbsp;when&nbsp;-update&nbsp;is&nbsp;given&nbsp;and&nbsp;thus&nbsp;when&nbsp;there&#39;s&nbsp;a&nbsp;human&nbsp;watching&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7089495">//&nbsp;test,&nbsp;this&nbsp;isn&#39;t&nbsp;too&nbsp;bad.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7089525">const</span>&nbsp;<span class="ident" id="7089531">serverPort</span>&nbsp;<span class="op" id="7089542">=</span>&nbsp;<span class="num" id="7089544">24323</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089551"><a href="/crypto/tls/handshake_client_test.go.html#7088976">command</a></span>&nbsp;<span class="op" id="7089559">=</span>&nbsp;<span class="builtinfunc" id="7089561">append</span><span class="op" id="7089567">(</span><span class="ident" id="7089568"><a href="/crypto/tls/handshake_client_test.go.html#7088976">command</a></span><span class="op" id="7089575">,</span>&nbsp;<span class="string" id="7089577">&#34;-accept&#34;</span><span class="op" id="7089586">,</span>&nbsp;<span class="ident" id="7089588"><a href="/crypto/tls/handshake_client_test.go.html#7086540">strconv</a></span><span class="op" id="7089595">.</span><span class="ident" id="7089596">Itoa</span><span class="op" id="7089600">(</span><span class="ident" id="7089601"><a href="/crypto/tls/handshake_client_test.go.html#7089531">serverPort</a></span><span class="op" id="7089611">)</span><span class="op" id="7089612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089616">cmd</span>&nbsp;<span class="op" id="7089620">:=</span>&nbsp;<span class="ident" id="7089623"><a href="/crypto/tls/handshake_client_test.go.html#7086512">exec</a></span><span class="op" id="7089627">.</span><span class="ident" id="7089628">Command</span><span class="op" id="7089635">(</span><span class="ident" id="7089636"><a href="/crypto/tls/handshake_client_test.go.html#7088976">command</a></span><span class="op" id="7089643">[</span><span class="num" id="7089644">0</span><span class="op" id="7089645">]</span><span class="op" id="7089646">,</span>&nbsp;<span class="ident" id="7089648"><a href="/crypto/tls/handshake_client_test.go.html#7088976">command</a></span><span class="op" id="7089655">[</span><span class="num" id="7089656">1</span><span class="op" id="7089657">:</span><span class="op" id="7089658">]</span><span class="op" id="7089659">...</span><span class="op" id="7089662">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089665"><a href="/crypto/tls/handshake_client_test.go.html#7088194">stdin</a></span>&nbsp;<span class="op" id="7089671">=</span>&nbsp;<span class="ident" id="7089673"><a href="/crypto/tls/handshake_client_test.go.html#7086745">blockingSource</a></span><span class="op" id="7089687">(</span><span class="builtinfunc" id="7089688">make</span><span class="op" id="7089692">(</span><span class="keyword" id="7089693">chan</span>&nbsp;<span class="builtintype" id="7089698">bool</span><span class="op" id="7089702">)</span><span class="op" id="7089703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089706"><a href="/crypto/tls/handshake_client_test.go.html#7089616">cmd</a></span><span class="op" id="7089709">.</span><span class="ident" id="7089710">Stdin</span>&nbsp;<span class="op" id="7089716">=</span>&nbsp;<span class="ident" id="7089718"><a href="/crypto/tls/handshake_client_test.go.html#7088194">stdin</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7089725">var</span>&nbsp;<span class="ident" id="7089729">out</span>&nbsp;<span class="ident" id="7089733"><a href="/crypto/tls/handshake_client_test.go.html#7086416">bytes</a></span><span class="op" id="7089738">.</span><span class="ident" id="7089739">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089747"><a href="/crypto/tls/handshake_client_test.go.html#7089616">cmd</a></span><span class="op" id="7089750">.</span><span class="ident" id="7089751">Stdout</span>&nbsp;<span class="op" id="7089758">=</span>&nbsp;<span class="op" id="7089760">&amp;</span><span class="ident" id="7089761"><a href="/crypto/tls/handshake_client_test.go.html#7089729">out</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089766"><a href="/crypto/tls/handshake_client_test.go.html#7089616">cmd</a></span><span class="op" id="7089769">.</span><span class="ident" id="7089770">Stderr</span>&nbsp;<span class="op" id="7089777">=</span>&nbsp;<span class="op" id="7089779">&amp;</span><span class="ident" id="7089780"><a href="/crypto/tls/handshake_client_test.go.html#7089729">out</a></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7089785">if</span>&nbsp;<span class="ident" id="7089788">err</span>&nbsp;<span class="op" id="7089792">:=</span>&nbsp;<span class="ident" id="7089795"><a href="/crypto/tls/handshake_client_test.go.html#7089616">cmd</a></span><span class="op" id="7089798">.</span><span class="ident" id="7089799">Start</span><span class="op" id="7089804">(</span><span class="op" id="7089805">)</span><span class="op" id="7089806">;</span>&nbsp;<span class="ident" id="7089808"><a href="/crypto/tls/handshake_client_test.go.html#7089788">err</a></span>&nbsp;<span class="op" id="7089812">!=</span>&nbsp;<span class="ident" id="7089815">nil</span>&nbsp;<span class="op" id="7089819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7089823">return</span>&nbsp;<span class="ident" id="7089830">nil</span><span class="op" id="7089833">,</span>&nbsp;<span class="ident" id="7089835">nil</span><span class="op" id="7089838">,</span>&nbsp;<span class="ident" id="7089840">nil</span><span class="op" id="7089843">,</span>&nbsp;<span class="ident" id="7089845"><a href="/crypto/tls/handshake_client_test.go.html#7089788">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7089850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7089854">//&nbsp;OpenSSL&nbsp;does&nbsp;print&nbsp;an&nbsp;&#34;ACCEPT&#34;&nbsp;banner,&nbsp;but&nbsp;it&nbsp;does&nbsp;so&nbsp;*before*</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7089921">//&nbsp;opening&nbsp;the&nbsp;listening&nbsp;socket,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;to&nbsp;wait&nbsp;until&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7089993">//&nbsp;has&nbsp;started&nbsp;listening.&nbsp;Thus&nbsp;we&nbsp;are&nbsp;forced&nbsp;to&nbsp;poll&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7090062">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090078">var</span>&nbsp;<span class="ident" id="7090082">tcpConn</span>&nbsp;<span class="ident" id="7090090"><a href="/crypto/tls/handshake_client_test.go.html#7086499">net</a></span><span class="op" id="7090093">.</span><span class="ident" id="7090094">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090100">for</span>&nbsp;<span class="ident" id="7090104">i</span>&nbsp;<span class="op" id="7090106">:=</span>&nbsp;<span class="builtintype" id="7090109">uint</span><span class="op" id="7090113">(</span><span class="num" id="7090114">0</span><span class="op" id="7090115">)</span><span class="op" id="7090116">;</span>&nbsp;<span class="ident" id="7090118"><a href="/crypto/tls/handshake_client_test.go.html#7090104">i</a></span>&nbsp;<span class="op" id="7090120">&lt;</span>&nbsp;<span class="num" id="7090122">5</span><span class="op" id="7090123">;</span>&nbsp;<span class="ident" id="7090125"><a href="/crypto/tls/handshake_client_test.go.html#7090104">i</a></span><span class="op" id="7090126">++</span>&nbsp;<span class="op" id="7090129">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090133">var</span>&nbsp;<span class="ident" id="7090137">err</span>&nbsp;<span class="builtintype" id="7090141">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090149"><a href="/crypto/tls/handshake_client_test.go.html#7090082">tcpConn</a></span><span class="op" id="7090156">,</span>&nbsp;<span class="ident" id="7090158"><a href="/crypto/tls/handshake_client_test.go.html#7090137">err</a></span>&nbsp;<span class="op" id="7090162">=</span>&nbsp;<span class="ident" id="7090164"><a href="/crypto/tls/handshake_client_test.go.html#7086499">net</a></span><span class="op" id="7090167">.</span><span class="ident" id="7090168">DialTCP</span><span class="op" id="7090175">(</span><span class="string" id="7090176">&#34;tcp&#34;</span><span class="op" id="7090181">,</span>&nbsp;<span class="ident" id="7090183">nil</span><span class="op" id="7090186">,</span>&nbsp;<span class="op" id="7090188">&amp;</span><span class="ident" id="7090189"><a href="/crypto/tls/handshake_client_test.go.html#7086499">net</a></span><span class="op" id="7090192">.</span><span class="ident" id="7090193">TCPAddr</span><span class="op" id="7090200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090205">IP</span><span class="op" id="7090207">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7090211"><a href="/crypto/tls/handshake_client_test.go.html#7086499">net</a></span><span class="op" id="7090214">.</span><span class="ident" id="7090215">IPv4</span><span class="op" id="7090219">(</span><span class="num" id="7090220">127</span><span class="op" id="7090223">,</span>&nbsp;<span class="num" id="7090225">0</span><span class="op" id="7090226">,</span>&nbsp;<span class="num" id="7090228">0</span><span class="op" id="7090229">,</span>&nbsp;<span class="num" id="7090231">1</span><span class="op" id="7090232">)</span><span class="op" id="7090233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090238">Port</span><span class="op" id="7090242">:</span>&nbsp;<span class="ident" id="7090244"><a href="/crypto/tls/handshake_client_test.go.html#7089531">serverPort</a></span><span class="op" id="7090254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090258">}</span><span class="op" id="7090259">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090263">if</span>&nbsp;<span class="ident" id="7090266"><a href="/crypto/tls/handshake_client_test.go.html#7090137">err</a></span>&nbsp;<span class="op" id="7090270">==</span>&nbsp;<span class="ident" id="7090273">nil</span>&nbsp;<span class="op" id="7090277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090282">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090294"><a href="/crypto/tls/handshake_client_test.go.html#7086562">time</a></span><span class="op" id="7090298">.</span><span class="ident" id="7090299">Sleep</span><span class="op" id="7090304">(</span><span class="op" id="7090305">(</span><span class="num" id="7090306">1</span>&nbsp;<span class="op" id="7090308">&lt;&lt;</span>&nbsp;<span class="ident" id="7090311"><a href="/crypto/tls/handshake_client_test.go.html#7090104">i</a></span><span class="op" id="7090312">)</span>&nbsp;<span class="op" id="7090314">*</span>&nbsp;<span class="num" id="7090316">5</span>&nbsp;<span class="op" id="7090318">*</span>&nbsp;<span class="ident" id="7090320"><a href="/crypto/tls/handshake_client_test.go.html#7086562">time</a></span><span class="op" id="7090324">.</span><span class="ident" id="7090325">Millisecond</span><span class="op" id="7090336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090339">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090342">if</span>&nbsp;<span class="ident" id="7090345"><a href="/crypto/tls/handshake_client_test.go.html#7090082">tcpConn</a></span>&nbsp;<span class="op" id="7090353">==</span>&nbsp;<span class="ident" id="7090356">nil</span>&nbsp;<span class="op" id="7090360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7090364">close</span><span class="op" id="7090369">(</span><span class="ident" id="7090370"><a href="/crypto/tls/handshake_client_test.go.html#7088194">stdin</a></span><span class="op" id="7090375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090379"><a href="/crypto/tls/handshake_client_test.go.html#7089729">out</a></span><span class="op" id="7090382">.</span><span class="ident" id="7090383">WriteTo</span><span class="op" id="7090390">(</span><span class="ident" id="7090391"><a href="/crypto/tls/handshake_client_test.go.html#7086506">os</a></span><span class="op" id="7090393">.</span><span class="ident" id="7090394">Stdout</span><span class="op" id="7090400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090404"><a href="/crypto/tls/handshake_client_test.go.html#7089616">cmd</a></span><span class="op" id="7090407">.</span><span class="ident" id="7090408">Process</span><span class="op" id="7090415">.</span><span class="ident" id="7090416">Kill</span><span class="op" id="7090420">(</span><span class="op" id="7090421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090425">return</span>&nbsp;<span class="ident" id="7090432">nil</span><span class="op" id="7090435">,</span>&nbsp;<span class="ident" id="7090437">nil</span><span class="op" id="7090440">,</span>&nbsp;<span class="ident" id="7090442">nil</span><span class="op" id="7090445">,</span>&nbsp;<span class="ident" id="7090447"><a href="/crypto/tls/handshake_client_test.go.html#7089616">cmd</a></span><span class="op" id="7090450">.</span><span class="ident" id="7090451">Wait</span><span class="op" id="7090455">(</span><span class="op" id="7090456">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090463">record</span>&nbsp;<span class="op" id="7090470">:=</span>&nbsp;<span class="op" id="7090473">&amp;</span><span class="ident" id="7090474"><a href="/crypto/tls/handshake_test.go.html#7138857">recordingConn</a></span><span class="op" id="7090487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090491">Conn</span><span class="op" id="7090495">:</span>&nbsp;<span class="ident" id="7090497"><a href="/crypto/tls/handshake_client_test.go.html#7090082">tcpConn</a></span><span class="op" id="7090504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090507">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090511">return</span>&nbsp;<span class="ident" id="7090518"><a href="/crypto/tls/handshake_client_test.go.html#7090463">record</a></span><span class="op" id="7090524">,</span>&nbsp;<span class="ident" id="7090526"><a href="/crypto/tls/handshake_client_test.go.html#7089616">cmd</a></span><span class="op" id="7090529">,</span>&nbsp;<span class="ident" id="7090531"><a href="/crypto/tls/handshake_client_test.go.html#7088194">stdin</a></span><span class="op" id="7090536">,</span>&nbsp;<span class="ident" id="7090538">nil</span><br>
<span class="lineno"></span><span class="op" id="7090542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7090545">func</span>&nbsp;<span class="op" id="7090550">(</span><span class="ident" id="7090551">test</span>&nbsp;<span class="op" id="7090556">*</span><span class="ident" id="7090557"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7090567">)</span>&nbsp;<span class="ident" id="7090569">dataPath</span><span class="op" id="7090577">(</span><span class="op" id="7090578">)</span>&nbsp;<span class="builtintype" id="7090580">string</span>&nbsp;<span class="op" id="7090587">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090590">return</span>&nbsp;<span class="ident" id="7090597"><a href="/crypto/tls/handshake_client_test.go.html#7086523">filepath</a></span><span class="op" id="7090605">.</span><span class="ident" id="7090606">Join</span><span class="op" id="7090610">(</span><span class="string" id="7090611">&#34;testdata&#34;</span><span class="op" id="7090621">,</span>&nbsp;<span class="string" id="7090623">&#34;Client-&#34;</span><span class="op" id="7090632">+</span><span class="ident" id="7090633"><a href="/crypto/tls/handshake_client_test.go.html#7090551">test</a></span><span class="op" id="7090637">.</span><span class="ident" id="7090638">name</span><span class="op" id="7090642">)</span><br>
<span class="lineno"></span><span class="op" id="7090644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7090647">func</span>&nbsp;<span class="op" id="7090652">(</span><span class="ident" id="7090653">test</span>&nbsp;<span class="op" id="7090658">*</span><span class="ident" id="7090659"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7090669">)</span>&nbsp;<span class="ident" id="7090671">loadData</span><span class="op" id="7090679">(</span><span class="op" id="7090680">)</span>&nbsp;<span class="op" id="7090682">(</span><span class="ident" id="7090683">flows</span>&nbsp;<span class="op" id="7090689">[</span><span class="op" id="7090690">]</span><span class="op" id="7090691">[</span><span class="op" id="7090692">]</span><span class="builtintype" id="7090693">byte</span><span class="op" id="7090697">,</span>&nbsp;<span class="ident" id="7090699">err</span>&nbsp;<span class="builtintype" id="7090703">error</span><span class="op" id="7090708">)</span>&nbsp;<span class="op" id="7090710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090713">in</span><span class="op" id="7090715">,</span>&nbsp;<span class="ident" id="7090717"><a href="/crypto/tls/handshake_client_test.go.html#7090699">err</a></span>&nbsp;<span class="op" id="7090721">:=</span>&nbsp;<span class="ident" id="7090724"><a href="/crypto/tls/handshake_client_test.go.html#7086506">os</a></span><span class="op" id="7090726">.</span><span class="ident" id="7090727">Open</span><span class="op" id="7090731">(</span><span class="ident" id="7090732"><a href="/crypto/tls/handshake_client_test.go.html#7090653">test</a></span><span class="op" id="7090736">.</span><span class="ident" id="7090737">dataPath</span><span class="op" id="7090745">(</span><span class="op" id="7090746">)</span><span class="op" id="7090747">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090750">if</span>&nbsp;<span class="ident" id="7090753"><a href="/crypto/tls/handshake_client_test.go.html#7090699">err</a></span>&nbsp;<span class="op" id="7090757">!=</span>&nbsp;<span class="ident" id="7090760">nil</span>&nbsp;<span class="op" id="7090764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090768">return</span>&nbsp;<span class="ident" id="7090775">nil</span><span class="op" id="7090778">,</span>&nbsp;<span class="ident" id="7090780"><a href="/crypto/tls/handshake_client_test.go.html#7090699">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090788">defer</span>&nbsp;<span class="ident" id="7090794"><a href="/crypto/tls/handshake_client_test.go.html#7090713">in</a></span><span class="op" id="7090796">.</span><span class="ident" id="7090797">Close</span><span class="op" id="7090802">(</span><span class="op" id="7090803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090806">return</span>&nbsp;<span class="ident" id="7090813"><a href="/crypto/tls/handshake_test.go.html#7140168">parseTestData</a></span><span class="op" id="7090826">(</span><span class="ident" id="7090827"><a href="/crypto/tls/handshake_client_test.go.html#7090713">in</a></span><span class="op" id="7090829">)</span><br>
<span class="lineno">165</span><span class="op" id="7090831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7090834">func</span>&nbsp;<span class="op" id="7090839">(</span><span class="ident" id="7090840">test</span>&nbsp;<span class="op" id="7090845">*</span><span class="ident" id="7090846"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7090856">)</span>&nbsp;<span class="ident" id="7090858">run</span><span class="op" id="7090861">(</span><span class="ident" id="7090862">t</span>&nbsp;<span class="op" id="7090864">*</span><span class="ident" id="7090865"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7090872">.</span><span class="ident" id="7090873">T</span><span class="op" id="7090874">,</span>&nbsp;<span class="ident" id="7090876">write</span>&nbsp;<span class="builtintype" id="7090882">bool</span><span class="op" id="7090886">)</span>&nbsp;<span class="op" id="7090888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090891">var</span>&nbsp;<span class="ident" id="7090895">clientConn</span><span class="op" id="7090905">,</span>&nbsp;<span class="ident" id="7090907">serverConn</span>&nbsp;<span class="ident" id="7090918"><a href="/crypto/tls/handshake_client_test.go.html#7086499">net</a></span><span class="op" id="7090921">.</span><span class="ident" id="7090922">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090928">var</span>&nbsp;<span class="ident" id="7090932">recordingConn</span>&nbsp;<span class="op" id="7090946">*</span><span class="ident" id="7090947"><a href="/crypto/tls/handshake_test.go.html#7138857">recordingConn</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090962">var</span>&nbsp;<span class="ident" id="7090966">childProcess</span>&nbsp;<span class="op" id="7090979">*</span><span class="ident" id="7090980"><a href="/crypto/tls/handshake_client_test.go.html#7086512">exec</a></span><span class="op" id="7090984">.</span><span class="ident" id="7090985">Cmd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090990">var</span>&nbsp;<span class="ident" id="7090994">stdin</span>&nbsp;<span class="ident" id="7091000"><a href="/crypto/tls/handshake_client_test.go.html#7086745">blockingSource</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091017">if</span>&nbsp;<span class="ident" id="7091020"><a href="/crypto/tls/handshake_client_test.go.html#7090876">write</a></span>&nbsp;<span class="op" id="7091026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091030">var</span>&nbsp;<span class="ident" id="7091034">err</span>&nbsp;<span class="builtintype" id="7091038">error</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091046"><a href="/crypto/tls/handshake_client_test.go.html#7090932">recordingConn</a></span><span class="op" id="7091059">,</span>&nbsp;<span class="ident" id="7091061"><a href="/crypto/tls/handshake_client_test.go.html#7090966">childProcess</a></span><span class="op" id="7091073">,</span>&nbsp;<span class="ident" id="7091075"><a href="/crypto/tls/handshake_client_test.go.html#7090994">stdin</a></span><span class="op" id="7091080">,</span>&nbsp;<span class="ident" id="7091082"><a href="/crypto/tls/handshake_client_test.go.html#7091034">err</a></span>&nbsp;<span class="op" id="7091086">=</span>&nbsp;<span class="ident" id="7091088"><a href="/crypto/tls/handshake_client_test.go.html#7090840">test</a></span><span class="op" id="7091092">.</span><span class="ident" id="7091093">connFromCommand</span><span class="op" id="7091108">(</span><span class="op" id="7091109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091113">if</span>&nbsp;<span class="ident" id="7091116"><a href="/crypto/tls/handshake_client_test.go.html#7091034">err</a></span>&nbsp;<span class="op" id="7091120">!=</span>&nbsp;<span class="ident" id="7091123">nil</span>&nbsp;<span class="op" id="7091127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091132"><a href="/crypto/tls/handshake_client_test.go.html#7090862">t</a></span><span class="op" id="7091133">.</span><span class="ident" id="7091134">Fatalf</span><span class="op" id="7091140">(</span><span class="string" id="7091141">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7091173">,</span>&nbsp;<span class="ident" id="7091175"><a href="/crypto/tls/handshake_client_test.go.html#7091034">err</a></span><span class="op" id="7091178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091186"><a href="/crypto/tls/handshake_client_test.go.html#7090895">clientConn</a></span>&nbsp;<span class="op" id="7091197">=</span>&nbsp;<span class="ident" id="7091199"><a href="/crypto/tls/handshake_client_test.go.html#7090932">recordingConn</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091214">}</span>&nbsp;<span class="keyword" id="7091216">else</span>&nbsp;<span class="op" id="7091221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091225"><a href="/crypto/tls/handshake_client_test.go.html#7090895">clientConn</a></span><span class="op" id="7091235">,</span>&nbsp;<span class="ident" id="7091237"><a href="/crypto/tls/handshake_client_test.go.html#7090907">serverConn</a></span>&nbsp;<span class="op" id="7091248">=</span>&nbsp;<span class="ident" id="7091250"><a href="/crypto/tls/handshake_client_test.go.html#7086499">net</a></span><span class="op" id="7091253">.</span><span class="ident" id="7091254">Pipe</span><span class="op" id="7091258">(</span><span class="op" id="7091259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091266">config</span>&nbsp;<span class="op" id="7091273">:=</span>&nbsp;<span class="ident" id="7091276"><a href="/crypto/tls/handshake_client_test.go.html#7090840">test</a></span><span class="op" id="7091280">.</span><span class="ident" id="7091281">config</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091289">if</span>&nbsp;<span class="ident" id="7091292"><a href="/crypto/tls/handshake_client_test.go.html#7091266">config</a></span>&nbsp;<span class="op" id="7091299">==</span>&nbsp;<span class="ident" id="7091302">nil</span>&nbsp;<span class="op" id="7091306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091310"><a href="/crypto/tls/handshake_client_test.go.html#7091266">config</a></span>&nbsp;<span class="op" id="7091317">=</span>&nbsp;<span class="ident" id="7091319"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091334">client</span>&nbsp;<span class="op" id="7091341">:=</span>&nbsp;<span class="ident" id="7091344"><a href="/crypto/tls/tls.go.html#4249732">Client</a></span><span class="op" id="7091350">(</span><span class="ident" id="7091351"><a href="/crypto/tls/handshake_client_test.go.html#7090895">clientConn</a></span><span class="op" id="7091361">,</span>&nbsp;<span class="ident" id="7091363"><a href="/crypto/tls/handshake_client_test.go.html#7091266">config</a></span><span class="op" id="7091369">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091373">doneChan</span>&nbsp;<span class="op" id="7091382">:=</span>&nbsp;<span class="builtinfunc" id="7091385">make</span><span class="op" id="7091389">(</span><span class="keyword" id="7091390">chan</span>&nbsp;<span class="builtintype" id="7091395">bool</span><span class="op" id="7091399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091402">go</span>&nbsp;<span class="keyword" id="7091405">func</span><span class="op" id="7091409">(</span><span class="op" id="7091410">)</span>&nbsp;<span class="op" id="7091412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091416">if</span>&nbsp;<span class="ident" id="7091419">_</span><span class="op" id="7091420">,</span>&nbsp;<span class="ident" id="7091422">err</span>&nbsp;<span class="op" id="7091426">:=</span>&nbsp;<span class="ident" id="7091429"><a href="/crypto/tls/handshake_client_test.go.html#7091334">client</a></span><span class="op" id="7091435">.</span><span class="ident" id="7091436">Write</span><span class="op" id="7091441">(</span><span class="op" id="7091442">[</span><span class="op" id="7091443">]</span><span class="builtintype" id="7091444">byte</span><span class="op" id="7091448">(</span><span class="string" id="7091449">&#34;hello\n&#34;</span><span class="op" id="7091458">)</span><span class="op" id="7091459">)</span><span class="op" id="7091460">;</span>&nbsp;<span class="ident" id="7091462"><a href="/crypto/tls/handshake_client_test.go.html#7091422">err</a></span>&nbsp;<span class="op" id="7091466">!=</span>&nbsp;<span class="ident" id="7091469">nil</span>&nbsp;<span class="op" id="7091473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091478"><a href="/crypto/tls/handshake_client_test.go.html#7090862">t</a></span><span class="op" id="7091479">.</span><span class="ident" id="7091480">Logf</span><span class="op" id="7091484">(</span><span class="string" id="7091485">&#34;Client.Write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7091510">,</span>&nbsp;<span class="ident" id="7091512"><a href="/crypto/tls/handshake_client_test.go.html#7091422">err</a></span><span class="op" id="7091515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091519">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091523">if</span>&nbsp;<span class="ident" id="7091526"><a href="/crypto/tls/handshake_client_test.go.html#7090840">test</a></span><span class="op" id="7091530">.</span><span class="ident" id="7091531">validate</span>&nbsp;<span class="op" id="7091540">!=</span>&nbsp;<span class="ident" id="7091543">nil</span>&nbsp;<span class="op" id="7091547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091552">if</span>&nbsp;<span class="ident" id="7091555">err</span>&nbsp;<span class="op" id="7091559">:=</span>&nbsp;<span class="ident" id="7091562"><a href="/crypto/tls/handshake_client_test.go.html#7090840">test</a></span><span class="op" id="7091566">.</span><span class="ident" id="7091567">validate</span><span class="op" id="7091575">(</span><span class="ident" id="7091576"><a href="/crypto/tls/handshake_client_test.go.html#7091334">client</a></span><span class="op" id="7091582">.</span><span class="ident" id="7091583">ConnectionState</span><span class="op" id="7091598">(</span><span class="op" id="7091599">)</span><span class="op" id="7091600">)</span><span class="op" id="7091601">;</span>&nbsp;<span class="ident" id="7091603"><a href="/crypto/tls/handshake_client_test.go.html#7091555">err</a></span>&nbsp;<span class="op" id="7091607">!=</span>&nbsp;<span class="ident" id="7091610">nil</span>&nbsp;<span class="op" id="7091614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091620"><a href="/crypto/tls/handshake_client_test.go.html#7090862">t</a></span><span class="op" id="7091621">.</span><span class="ident" id="7091622">Logf</span><span class="op" id="7091626">(</span><span class="string" id="7091627">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7091665">,</span>&nbsp;<span class="ident" id="7091667"><a href="/crypto/tls/handshake_client_test.go.html#7091555">err</a></span><span class="op" id="7091670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091679">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091683"><a href="/crypto/tls/handshake_client_test.go.html#7091334">client</a></span><span class="op" id="7091689">.</span><span class="ident" id="7091690">Close</span><span class="op" id="7091695">(</span><span class="op" id="7091696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091700"><a href="/crypto/tls/handshake_client_test.go.html#7090895">clientConn</a></span><span class="op" id="7091710">.</span><span class="ident" id="7091711">Close</span><span class="op" id="7091716">(</span><span class="op" id="7091717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091721"><a href="/crypto/tls/handshake_client_test.go.html#7091373">doneChan</a></span>&nbsp;<span class="op" id="7091730">&lt;-</span>&nbsp;<span class="ident" id="7091733">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091739">}</span><span class="op" id="7091740">(</span><span class="op" id="7091741">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091745">if</span>&nbsp;<span class="op" id="7091748">!</span><span class="ident" id="7091749"><a href="/crypto/tls/handshake_client_test.go.html#7090876">write</a></span>&nbsp;<span class="op" id="7091755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091759">flows</span><span class="op" id="7091764">,</span>&nbsp;<span class="ident" id="7091766">err</span>&nbsp;<span class="op" id="7091770">:=</span>&nbsp;<span class="ident" id="7091773"><a href="/crypto/tls/handshake_client_test.go.html#7090840">test</a></span><span class="op" id="7091777">.</span><span class="ident" id="7091778">loadData</span><span class="op" id="7091786">(</span><span class="op" id="7091787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091791">if</span>&nbsp;<span class="ident" id="7091794"><a href="/crypto/tls/handshake_client_test.go.html#7091766">err</a></span>&nbsp;<span class="op" id="7091798">!=</span>&nbsp;<span class="ident" id="7091801">nil</span>&nbsp;<span class="op" id="7091805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091810"><a href="/crypto/tls/handshake_client_test.go.html#7090862">t</a></span><span class="op" id="7091811">.</span><span class="ident" id="7091812">Fatalf</span><span class="op" id="7091818">(</span><span class="string" id="7091819">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7091856">,</span>&nbsp;<span class="ident" id="7091858"><a href="/crypto/tls/handshake_client_test.go.html#7090840">test</a></span><span class="op" id="7091862">.</span><span class="ident" id="7091863">name</span><span class="op" id="7091867">,</span>&nbsp;<span class="ident" id="7091869"><a href="/crypto/tls/handshake_client_test.go.html#7090840">test</a></span><span class="op" id="7091873">.</span><span class="ident" id="7091874">dataPath</span><span class="op" id="7091882">(</span><span class="op" id="7091883">)</span><span class="op" id="7091884">,</span>&nbsp;<span class="ident" id="7091886"><a href="/crypto/tls/handshake_client_test.go.html#7091766">err</a></span><span class="op" id="7091889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091893">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091897">for</span>&nbsp;<span class="ident" id="7091901">i</span><span class="op" id="7091902">,</span>&nbsp;<span class="ident" id="7091904">b</span>&nbsp;<span class="op" id="7091906">:=</span>&nbsp;<span class="keyword" id="7091909">range</span>&nbsp;<span class="ident" id="7091915"><a href="/crypto/tls/handshake_client_test.go.html#7091759">flows</a></span>&nbsp;<span class="op" id="7091921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091926">if</span>&nbsp;<span class="ident" id="7091929"><a href="/crypto/tls/handshake_client_test.go.html#7091901">i</a></span><span class="op" id="7091930">%</span><span class="num" id="7091931">2</span>&nbsp;<span class="op" id="7091933">==</span>&nbsp;<span class="num" id="7091936">1</span>&nbsp;<span class="op" id="7091938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091944"><a href="/crypto/tls/handshake_client_test.go.html#7090907">serverConn</a></span><span class="op" id="7091954">.</span><span class="ident" id="7091955">Write</span><span class="op" id="7091960">(</span><span class="ident" id="7091961"><a href="/crypto/tls/handshake_client_test.go.html#7091904">b</a></span><span class="op" id="7091962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091968">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091980">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091985">bb</span>&nbsp;<span class="op" id="7091988">:=</span>&nbsp;<span class="builtinfunc" id="7091991">make</span><span class="op" id="7091995">(</span><span class="op" id="7091996">[</span><span class="op" id="7091997">]</span><span class="builtintype" id="7091998">byte</span><span class="op" id="7092002">,</span>&nbsp;<span class="builtinfunc" id="7092004">len</span><span class="op" id="7092007">(</span><span class="ident" id="7092008"><a href="/crypto/tls/handshake_client_test.go.html#7091904">b</a></span><span class="op" id="7092009">)</span><span class="op" id="7092010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092015">_</span><span class="op" id="7092016">,</span>&nbsp;<span class="ident" id="7092018">err</span>&nbsp;<span class="op" id="7092022">:=</span>&nbsp;<span class="ident" id="7092025"><a href="/crypto/tls/handshake_client_test.go.html#7086493">io</a></span><span class="op" id="7092027">.</span><span class="ident" id="7092028">ReadFull</span><span class="op" id="7092036">(</span><span class="ident" id="7092037"><a href="/crypto/tls/handshake_client_test.go.html#7090907">serverConn</a></span><span class="op" id="7092047">,</span>&nbsp;<span class="ident" id="7092049"><a href="/crypto/tls/handshake_client_test.go.html#7091985">bb</a></span><span class="op" id="7092051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092056">if</span>&nbsp;<span class="ident" id="7092059"><a href="/crypto/tls/handshake_client_test.go.html#7092018">err</a></span>&nbsp;<span class="op" id="7092063">!=</span>&nbsp;<span class="ident" id="7092066">nil</span>&nbsp;<span class="op" id="7092070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092076"><a href="/crypto/tls/handshake_client_test.go.html#7090862">t</a></span><span class="op" id="7092077">.</span><span class="ident" id="7092078">Fatalf</span><span class="op" id="7092084">(</span><span class="string" id="7092085">&#34;%s&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="7092097">,</span>&nbsp;<span class="ident" id="7092099"><a href="/crypto/tls/handshake_client_test.go.html#7090840">test</a></span><span class="op" id="7092103">.</span><span class="ident" id="7092104">name</span><span class="op" id="7092108">,</span>&nbsp;<span class="ident" id="7092110"><a href="/crypto/tls/handshake_client_test.go.html#7091901">i</a></span><span class="op" id="7092111">,</span>&nbsp;<span class="ident" id="7092113"><a href="/crypto/tls/handshake_client_test.go.html#7092018">err</a></span><span class="op" id="7092116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092121">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092126">if</span>&nbsp;<span class="op" id="7092129">!</span><span class="ident" id="7092130"><a href="/crypto/tls/handshake_client_test.go.html#7086416">bytes</a></span><span class="op" id="7092135">.</span><span class="ident" id="7092136">Equal</span><span class="op" id="7092141">(</span><span class="ident" id="7092142"><a href="/crypto/tls/handshake_client_test.go.html#7091904">b</a></span><span class="op" id="7092143">,</span>&nbsp;<span class="ident" id="7092145"><a href="/crypto/tls/handshake_client_test.go.html#7091985">bb</a></span><span class="op" id="7092147">)</span>&nbsp;<span class="op" id="7092149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092155"><a href="/crypto/tls/handshake_client_test.go.html#7090862">t</a></span><span class="op" id="7092156">.</span><span class="ident" id="7092157">Fatalf</span><span class="op" id="7092163">(</span><span class="string" id="7092164">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7092206">,</span>&nbsp;<span class="ident" id="7092208"><a href="/crypto/tls/handshake_client_test.go.html#7090840">test</a></span><span class="op" id="7092212">.</span><span class="ident" id="7092213">name</span><span class="op" id="7092217">,</span>&nbsp;<span class="ident" id="7092219"><a href="/crypto/tls/handshake_client_test.go.html#7091901">i</a></span><span class="op" id="7092220">,</span>&nbsp;<span class="ident" id="7092222"><a href="/crypto/tls/handshake_client_test.go.html#7091985">bb</a></span><span class="op" id="7092224">,</span>&nbsp;<span class="ident" id="7092226"><a href="/crypto/tls/handshake_client_test.go.html#7091904">b</a></span><span class="op" id="7092227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092240"><a href="/crypto/tls/handshake_client_test.go.html#7090907">serverConn</a></span><span class="op" id="7092250">.</span><span class="ident" id="7092251">Close</span><span class="op" id="7092256">(</span><span class="op" id="7092257">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092264">&lt;-</span><span class="ident" id="7092266"><a href="/crypto/tls/handshake_client_test.go.html#7091373">doneChan</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092277">if</span>&nbsp;<span class="ident" id="7092280"><a href="/crypto/tls/handshake_client_test.go.html#7090876">write</a></span>&nbsp;<span class="op" id="7092286">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092290">path</span>&nbsp;<span class="op" id="7092295">:=</span>&nbsp;<span class="ident" id="7092298"><a href="/crypto/tls/handshake_client_test.go.html#7090840">test</a></span><span class="op" id="7092302">.</span><span class="ident" id="7092303">dataPath</span><span class="op" id="7092311">(</span><span class="op" id="7092312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092316">out</span><span class="op" id="7092319">,</span>&nbsp;<span class="ident" id="7092321">err</span>&nbsp;<span class="op" id="7092325">:=</span>&nbsp;<span class="ident" id="7092328"><a href="/crypto/tls/handshake_client_test.go.html#7086506">os</a></span><span class="op" id="7092330">.</span><span class="ident" id="7092331">OpenFile</span><span class="op" id="7092339">(</span><span class="ident" id="7092340"><a href="/crypto/tls/handshake_client_test.go.html#7092290">path</a></span><span class="op" id="7092344">,</span>&nbsp;<span class="ident" id="7092346"><a href="/crypto/tls/handshake_client_test.go.html#7086506">os</a></span><span class="op" id="7092348">.</span><span class="ident" id="7092349">O_WRONLY</span><span class="op" id="7092357">|</span><span class="ident" id="7092358"><a href="/crypto/tls/handshake_client_test.go.html#7086506">os</a></span><span class="op" id="7092360">.</span><span class="ident" id="7092361">O_CREATE</span><span class="op" id="7092369">|</span><span class="ident" id="7092370"><a href="/crypto/tls/handshake_client_test.go.html#7086506">os</a></span><span class="op" id="7092372">.</span><span class="ident" id="7092373">O_TRUNC</span><span class="op" id="7092380">,</span>&nbsp;<span class="num" id="7092382">0644</span><span class="op" id="7092386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092390">if</span>&nbsp;<span class="ident" id="7092393"><a href="/crypto/tls/handshake_client_test.go.html#7092321">err</a></span>&nbsp;<span class="op" id="7092397">!=</span>&nbsp;<span class="ident" id="7092400">nil</span>&nbsp;<span class="op" id="7092404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092409"><a href="/crypto/tls/handshake_client_test.go.html#7090862">t</a></span><span class="op" id="7092410">.</span><span class="ident" id="7092411">Fatalf</span><span class="op" id="7092417">(</span><span class="string" id="7092418">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7092452">,</span>&nbsp;<span class="ident" id="7092454"><a href="/crypto/tls/handshake_client_test.go.html#7092321">err</a></span><span class="op" id="7092457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092461">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092465">defer</span>&nbsp;<span class="ident" id="7092471"><a href="/crypto/tls/handshake_client_test.go.html#7092316">out</a></span><span class="op" id="7092474">.</span><span class="ident" id="7092475">Close</span><span class="op" id="7092480">(</span><span class="op" id="7092481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092485"><a href="/crypto/tls/handshake_client_test.go.html#7090932">recordingConn</a></span><span class="op" id="7092498">.</span><span class="ident" id="7092499">Close</span><span class="op" id="7092504">(</span><span class="op" id="7092505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7092509">close</span><span class="op" id="7092514">(</span><span class="ident" id="7092515"><a href="/crypto/tls/handshake_client_test.go.html#7090994">stdin</a></span><span class="op" id="7092520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092524"><a href="/crypto/tls/handshake_client_test.go.html#7090966">childProcess</a></span><span class="op" id="7092536">.</span><span class="ident" id="7092537">Process</span><span class="op" id="7092544">.</span><span class="ident" id="7092545">Kill</span><span class="op" id="7092549">(</span><span class="op" id="7092550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092554"><a href="/crypto/tls/handshake_client_test.go.html#7090966">childProcess</a></span><span class="op" id="7092566">.</span><span class="ident" id="7092567">Wait</span><span class="op" id="7092571">(</span><span class="op" id="7092572">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092576">if</span>&nbsp;<span class="builtinfunc" id="7092579">len</span><span class="op" id="7092582">(</span><span class="ident" id="7092583"><a href="/crypto/tls/handshake_client_test.go.html#7090932">recordingConn</a></span><span class="op" id="7092596">.</span><span class="ident" id="7092597">flows</span><span class="op" id="7092602">)</span>&nbsp;<span class="op" id="7092604">&lt;</span>&nbsp;<span class="num" id="7092606">3</span>&nbsp;<span class="op" id="7092608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092613"><a href="/crypto/tls/handshake_client_test.go.html#7090966">childProcess</a></span><span class="op" id="7092625">.</span><span class="ident" id="7092626">Stdout</span><span class="op" id="7092632">.</span><span class="op" id="7092633">(</span><span class="op" id="7092634">*</span><span class="ident" id="7092635"><a href="/crypto/tls/handshake_client_test.go.html#7086416">bytes</a></span><span class="op" id="7092640">.</span><span class="ident" id="7092641">Buffer</span><span class="op" id="7092647">)</span><span class="op" id="7092648">.</span><span class="ident" id="7092649">WriteTo</span><span class="op" id="7092656">(</span><span class="ident" id="7092657"><a href="/crypto/tls/handshake_client_test.go.html#7086506">os</a></span><span class="op" id="7092659">.</span><span class="ident" id="7092660">Stdout</span><span class="op" id="7092666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092671"><a href="/crypto/tls/handshake_client_test.go.html#7090862">t</a></span><span class="op" id="7092672">.</span><span class="ident" id="7092673">Fatalf</span><span class="op" id="7092679">(</span><span class="string" id="7092680">&#34;Client&nbsp;connection&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="7092711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092719"><a href="/crypto/tls/handshake_client_test.go.html#7090932">recordingConn</a></span><span class="op" id="7092732">.</span><span class="ident" id="7092733">WriteTo</span><span class="op" id="7092740">(</span><span class="ident" id="7092741"><a href="/crypto/tls/handshake_client_test.go.html#7092316">out</a></span><span class="op" id="7092744">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092748"><a href="/crypto/tls/handshake_client_test.go.html#7086486">fmt</a></span><span class="op" id="7092751">.</span><span class="ident" id="7092752">Printf</span><span class="op" id="7092758">(</span><span class="string" id="7092759">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7092771">,</span>&nbsp;<span class="ident" id="7092773"><a href="/crypto/tls/handshake_client_test.go.html#7092290">path</a></span><span class="op" id="7092777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092780">}</span><br>
<span class="lineno"></span><span class="op" id="7092782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7092785">func</span>&nbsp;<span class="ident" id="7092790">runClientTestForVersion</span><span class="op" id="7092813">(</span><span class="ident" id="7092814">t</span>&nbsp;<span class="op" id="7092816">*</span><span class="ident" id="7092817"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7092824">.</span><span class="ident" id="7092825">T</span><span class="op" id="7092826">,</span>&nbsp;<span class="ident" id="7092828">template</span>&nbsp;<span class="op" id="7092837">*</span><span class="ident" id="7092838"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7092848">,</span>&nbsp;<span class="ident" id="7092850">prefix</span><span class="op" id="7092856">,</span>&nbsp;<span class="ident" id="7092858">option</span>&nbsp;<span class="builtintype" id="7092865">string</span><span class="op" id="7092871">)</span>&nbsp;<span class="op" id="7092873">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092876">test</span>&nbsp;<span class="op" id="7092881">:=</span>&nbsp;<span class="op" id="7092884">*</span><span class="ident" id="7092885"><a href="/crypto/tls/handshake_client_test.go.html#7092828">template</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092895"><a href="/crypto/tls/handshake_client_test.go.html#7092876">test</a></span><span class="op" id="7092899">.</span><span class="ident" id="7092900">name</span>&nbsp;<span class="op" id="7092905">=</span>&nbsp;<span class="ident" id="7092907"><a href="/crypto/tls/handshake_client_test.go.html#7092850">prefix</a></span>&nbsp;<span class="op" id="7092914">+</span>&nbsp;<span class="ident" id="7092916"><a href="/crypto/tls/handshake_client_test.go.html#7092876">test</a></span><span class="op" id="7092920">.</span><span class="ident" id="7092921">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092927">if</span>&nbsp;<span class="builtinfunc" id="7092930">len</span><span class="op" id="7092933">(</span><span class="ident" id="7092934"><a href="/crypto/tls/handshake_client_test.go.html#7092876">test</a></span><span class="op" id="7092938">.</span><span class="ident" id="7092939">command</span><span class="op" id="7092946">)</span>&nbsp;<span class="op" id="7092948">==</span>&nbsp;<span class="num" id="7092951">0</span>&nbsp;<span class="op" id="7092953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092957"><a href="/crypto/tls/handshake_client_test.go.html#7092876">test</a></span><span class="op" id="7092961">.</span><span class="ident" id="7092962">command</span>&nbsp;<span class="op" id="7092970">=</span>&nbsp;<span class="ident" id="7092972"><a href="/crypto/tls/handshake_server_test.go.html#7114134">defaultClientCommand</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092994">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092997"><a href="/crypto/tls/handshake_client_test.go.html#7092876">test</a></span><span class="op" id="7093001">.</span><span class="ident" id="7093002">command</span>&nbsp;<span class="op" id="7093010">=</span>&nbsp;<span class="builtinfunc" id="7093012">append</span><span class="op" id="7093018">(</span><span class="op" id="7093019">[</span><span class="op" id="7093020">]</span><span class="builtintype" id="7093021">string</span><span class="op" id="7093027">(</span><span class="ident" id="7093028">nil</span><span class="op" id="7093031">)</span><span class="op" id="7093032">,</span>&nbsp;<span class="ident" id="7093034"><a href="/crypto/tls/handshake_client_test.go.html#7092876">test</a></span><span class="op" id="7093038">.</span><span class="ident" id="7093039">command</span><span class="op" id="7093046">...</span><span class="op" id="7093049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093052"><a href="/crypto/tls/handshake_client_test.go.html#7092876">test</a></span><span class="op" id="7093056">.</span><span class="ident" id="7093057">command</span>&nbsp;<span class="op" id="7093065">=</span>&nbsp;<span class="builtinfunc" id="7093067">append</span><span class="op" id="7093073">(</span><span class="ident" id="7093074"><a href="/crypto/tls/handshake_client_test.go.html#7092876">test</a></span><span class="op" id="7093078">.</span><span class="ident" id="7093079">command</span><span class="op" id="7093086">,</span>&nbsp;<span class="ident" id="7093088"><a href="/crypto/tls/handshake_client_test.go.html#7092858">option</a></span><span class="op" id="7093094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093097"><a href="/crypto/tls/handshake_client_test.go.html#7092876">test</a></span><span class="op" id="7093101">.</span><span class="ident" id="7093102">run</span><span class="op" id="7093105">(</span><span class="ident" id="7093106"><a href="/crypto/tls/handshake_client_test.go.html#7092814">t</a></span><span class="op" id="7093107">,</span>&nbsp;<span class="op" id="7093109">*</span><span class="ident" id="7093110"><a href="/crypto/tls/handshake_test.go.html#7138612">update</a></span><span class="op" id="7093116">)</span><br>
<span class="lineno"></span><span class="op" id="7093118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="7093121">func</span>&nbsp;<span class="ident" id="7093126">runClientTestTLS10</span><span class="op" id="7093144">(</span><span class="ident" id="7093145">t</span>&nbsp;<span class="op" id="7093147">*</span><span class="ident" id="7093148"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7093155">.</span><span class="ident" id="7093156">T</span><span class="op" id="7093157">,</span>&nbsp;<span class="ident" id="7093159">template</span>&nbsp;<span class="op" id="7093168">*</span><span class="ident" id="7093169"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7093179">)</span>&nbsp;<span class="op" id="7093181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093184"><a href="/crypto/tls/handshake_client_test.go.html#7092790">runClientTestForVersion</a></span><span class="op" id="7093207">(</span><span class="ident" id="7093208"><a href="/crypto/tls/handshake_client_test.go.html#7093145">t</a></span><span class="op" id="7093209">,</span>&nbsp;<span class="ident" id="7093211"><a href="/crypto/tls/handshake_client_test.go.html#7093159">template</a></span><span class="op" id="7093219">,</span>&nbsp;<span class="string" id="7093221">&#34;TLSv10-&#34;</span><span class="op" id="7093230">,</span>&nbsp;<span class="string" id="7093232">&#34;-tls1&#34;</span><span class="op" id="7093239">)</span><br>
<span class="lineno"></span><span class="op" id="7093241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7093244">func</span>&nbsp;<span class="ident" id="7093249">runClientTestTLS11</span><span class="op" id="7093267">(</span><span class="ident" id="7093268">t</span>&nbsp;<span class="op" id="7093270">*</span><span class="ident" id="7093271"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7093278">.</span><span class="ident" id="7093279">T</span><span class="op" id="7093280">,</span>&nbsp;<span class="ident" id="7093282">template</span>&nbsp;<span class="op" id="7093291">*</span><span class="ident" id="7093292"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7093302">)</span>&nbsp;<span class="op" id="7093304">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093307"><a href="/crypto/tls/handshake_client_test.go.html#7092790">runClientTestForVersion</a></span><span class="op" id="7093330">(</span><span class="ident" id="7093331"><a href="/crypto/tls/handshake_client_test.go.html#7093268">t</a></span><span class="op" id="7093332">,</span>&nbsp;<span class="ident" id="7093334"><a href="/crypto/tls/handshake_client_test.go.html#7093282">template</a></span><span class="op" id="7093342">,</span>&nbsp;<span class="string" id="7093344">&#34;TLSv11-&#34;</span><span class="op" id="7093353">,</span>&nbsp;<span class="string" id="7093355">&#34;-tls1_1&#34;</span><span class="op" id="7093364">)</span><br>
<span class="lineno"></span><span class="op" id="7093366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7093369">func</span>&nbsp;<span class="ident" id="7093374">runClientTestTLS12</span><span class="op" id="7093392">(</span><span class="ident" id="7093393">t</span>&nbsp;<span class="op" id="7093395">*</span><span class="ident" id="7093396"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7093403">.</span><span class="ident" id="7093404">T</span><span class="op" id="7093405">,</span>&nbsp;<span class="ident" id="7093407">template</span>&nbsp;<span class="op" id="7093416">*</span><span class="ident" id="7093417"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7093427">)</span>&nbsp;<span class="op" id="7093429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093432"><a href="/crypto/tls/handshake_client_test.go.html#7092790">runClientTestForVersion</a></span><span class="op" id="7093455">(</span><span class="ident" id="7093456"><a href="/crypto/tls/handshake_client_test.go.html#7093393">t</a></span><span class="op" id="7093457">,</span>&nbsp;<span class="ident" id="7093459"><a href="/crypto/tls/handshake_client_test.go.html#7093407">template</a></span><span class="op" id="7093467">,</span>&nbsp;<span class="string" id="7093469">&#34;TLSv12-&#34;</span><span class="op" id="7093478">,</span>&nbsp;<span class="string" id="7093480">&#34;-tls1_2&#34;</span><span class="op" id="7093489">)</span><br>
<span class="lineno">270</span><span class="op" id="7093491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7093494">func</span>&nbsp;<span class="ident" id="7093499">TestHandshakeClientRSARC4</span><span class="op" id="7093524">(</span><span class="ident" id="7093525">t</span>&nbsp;<span class="op" id="7093527">*</span><span class="ident" id="7093528"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7093535">.</span><span class="ident" id="7093536">T</span><span class="op" id="7093537">)</span>&nbsp;<span class="op" id="7093539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093542">test</span>&nbsp;<span class="op" id="7093547">:=</span>&nbsp;<span class="op" id="7093550">&amp;</span><span class="ident" id="7093551"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7093561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093565">name</span><span class="op" id="7093569">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7093574">&#34;RSA-RC4&#34;</span><span class="op" id="7093583">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093587">command</span><span class="op" id="7093594">:</span>&nbsp;<span class="op" id="7093596">[</span><span class="op" id="7093597">]</span><span class="builtintype" id="7093598">string</span><span class="op" id="7093604">{</span><span class="string" id="7093605">&#34;openssl&#34;</span><span class="op" id="7093614">,</span>&nbsp;<span class="string" id="7093616">&#34;s_server&#34;</span><span class="op" id="7093626">,</span>&nbsp;<span class="string" id="7093628">&#34;-cipher&#34;</span><span class="op" id="7093637">,</span>&nbsp;<span class="string" id="7093639">&#34;RC4-SHA&#34;</span><span class="op" id="7093648">}</span><span class="op" id="7093649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093655"><a href="/crypto/tls/handshake_client_test.go.html#7093126">runClientTestTLS10</a></span><span class="op" id="7093673">(</span><span class="ident" id="7093674"><a href="/crypto/tls/handshake_client_test.go.html#7093525">t</a></span><span class="op" id="7093675">,</span>&nbsp;<span class="ident" id="7093677"><a href="/crypto/tls/handshake_client_test.go.html#7093542">test</a></span><span class="op" id="7093681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093684"><a href="/crypto/tls/handshake_client_test.go.html#7093249">runClientTestTLS11</a></span><span class="op" id="7093702">(</span><span class="ident" id="7093703"><a href="/crypto/tls/handshake_client_test.go.html#7093525">t</a></span><span class="op" id="7093704">,</span>&nbsp;<span class="ident" id="7093706"><a href="/crypto/tls/handshake_client_test.go.html#7093542">test</a></span><span class="op" id="7093710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093713"><a href="/crypto/tls/handshake_client_test.go.html#7093374">runClientTestTLS12</a></span><span class="op" id="7093731">(</span><span class="ident" id="7093732"><a href="/crypto/tls/handshake_client_test.go.html#7093525">t</a></span><span class="op" id="7093733">,</span>&nbsp;<span class="ident" id="7093735"><a href="/crypto/tls/handshake_client_test.go.html#7093542">test</a></span><span class="op" id="7093739">)</span><br>
<span class="lineno">280</span><span class="op" id="7093741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7093744">func</span>&nbsp;<span class="ident" id="7093749">TestHandshakeClientECDHERSAAES</span><span class="op" id="7093779">(</span><span class="ident" id="7093780">t</span>&nbsp;<span class="op" id="7093782">*</span><span class="ident" id="7093783"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7093790">.</span><span class="ident" id="7093791">T</span><span class="op" id="7093792">)</span>&nbsp;<span class="op" id="7093794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093797">test</span>&nbsp;<span class="op" id="7093802">:=</span>&nbsp;<span class="op" id="7093805">&amp;</span><span class="ident" id="7093806"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7093816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093820">name</span><span class="op" id="7093824">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7093829">&#34;ECDHE-RSA-AES&#34;</span><span class="op" id="7093844">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093848">command</span><span class="op" id="7093855">:</span>&nbsp;<span class="op" id="7093857">[</span><span class="op" id="7093858">]</span><span class="builtintype" id="7093859">string</span><span class="op" id="7093865">{</span><span class="string" id="7093866">&#34;openssl&#34;</span><span class="op" id="7093875">,</span>&nbsp;<span class="string" id="7093877">&#34;s_server&#34;</span><span class="op" id="7093887">,</span>&nbsp;<span class="string" id="7093889">&#34;-cipher&#34;</span><span class="op" id="7093898">,</span>&nbsp;<span class="string" id="7093900">&#34;ECDHE-RSA-AES128-SHA&#34;</span><span class="op" id="7093922">}</span><span class="op" id="7093923">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093929"><a href="/crypto/tls/handshake_client_test.go.html#7093126">runClientTestTLS10</a></span><span class="op" id="7093947">(</span><span class="ident" id="7093948"><a href="/crypto/tls/handshake_client_test.go.html#7093780">t</a></span><span class="op" id="7093949">,</span>&nbsp;<span class="ident" id="7093951"><a href="/crypto/tls/handshake_client_test.go.html#7093797">test</a></span><span class="op" id="7093955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093958"><a href="/crypto/tls/handshake_client_test.go.html#7093249">runClientTestTLS11</a></span><span class="op" id="7093976">(</span><span class="ident" id="7093977"><a href="/crypto/tls/handshake_client_test.go.html#7093780">t</a></span><span class="op" id="7093978">,</span>&nbsp;<span class="ident" id="7093980"><a href="/crypto/tls/handshake_client_test.go.html#7093797">test</a></span><span class="op" id="7093984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093987"><a href="/crypto/tls/handshake_client_test.go.html#7093374">runClientTestTLS12</a></span><span class="op" id="7094005">(</span><span class="ident" id="7094006"><a href="/crypto/tls/handshake_client_test.go.html#7093780">t</a></span><span class="op" id="7094007">,</span>&nbsp;<span class="ident" id="7094009"><a href="/crypto/tls/handshake_client_test.go.html#7093797">test</a></span><span class="op" id="7094013">)</span><br>
<span class="lineno">290</span><span class="op" id="7094015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7094018">func</span>&nbsp;<span class="ident" id="7094023">TestHandshakeClientECDHEECDSAAES</span><span class="op" id="7094055">(</span><span class="ident" id="7094056">t</span>&nbsp;<span class="op" id="7094058">*</span><span class="ident" id="7094059"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7094066">.</span><span class="ident" id="7094067">T</span><span class="op" id="7094068">)</span>&nbsp;<span class="op" id="7094070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094073">test</span>&nbsp;<span class="op" id="7094078">:=</span>&nbsp;<span class="op" id="7094081">&amp;</span><span class="ident" id="7094082"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7094092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094096">name</span><span class="op" id="7094100">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7094105">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7094122">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094126">command</span><span class="op" id="7094133">:</span>&nbsp;<span class="op" id="7094135">[</span><span class="op" id="7094136">]</span><span class="builtintype" id="7094137">string</span><span class="op" id="7094143">{</span><span class="string" id="7094144">&#34;openssl&#34;</span><span class="op" id="7094153">,</span>&nbsp;<span class="string" id="7094155">&#34;s_server&#34;</span><span class="op" id="7094165">,</span>&nbsp;<span class="string" id="7094167">&#34;-cipher&#34;</span><span class="op" id="7094176">,</span>&nbsp;<span class="string" id="7094178">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7094202">}</span><span class="op" id="7094203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094207">cert</span><span class="op" id="7094211">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094216"><a href="/crypto/tls/handshake_server_test.go.html#7133477">testECDSACertificate</a></span><span class="op" id="7094236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094240">key</span><span class="op" id="7094243">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094249"><a href="/crypto/tls/handshake_server_test.go.html#7136719">testECDSAPrivateKey</a></span><span class="op" id="7094268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094274"><a href="/crypto/tls/handshake_client_test.go.html#7093126">runClientTestTLS10</a></span><span class="op" id="7094292">(</span><span class="ident" id="7094293"><a href="/crypto/tls/handshake_client_test.go.html#7094056">t</a></span><span class="op" id="7094294">,</span>&nbsp;<span class="ident" id="7094296"><a href="/crypto/tls/handshake_client_test.go.html#7094073">test</a></span><span class="op" id="7094300">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094303"><a href="/crypto/tls/handshake_client_test.go.html#7093249">runClientTestTLS11</a></span><span class="op" id="7094321">(</span><span class="ident" id="7094322"><a href="/crypto/tls/handshake_client_test.go.html#7094056">t</a></span><span class="op" id="7094323">,</span>&nbsp;<span class="ident" id="7094325"><a href="/crypto/tls/handshake_client_test.go.html#7094073">test</a></span><span class="op" id="7094329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094332"><a href="/crypto/tls/handshake_client_test.go.html#7093374">runClientTestTLS12</a></span><span class="op" id="7094350">(</span><span class="ident" id="7094351"><a href="/crypto/tls/handshake_client_test.go.html#7094056">t</a></span><span class="op" id="7094352">,</span>&nbsp;<span class="ident" id="7094354"><a href="/crypto/tls/handshake_client_test.go.html#7094073">test</a></span><span class="op" id="7094358">)</span><br>
<span class="lineno"></span><span class="op" id="7094360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7094363">func</span>&nbsp;<span class="ident" id="7094368">TestHandshakeClientECDHEECDSAAESGCM</span><span class="op" id="7094403">(</span><span class="ident" id="7094404">t</span>&nbsp;<span class="op" id="7094406">*</span><span class="ident" id="7094407"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7094414">.</span><span class="ident" id="7094415">T</span><span class="op" id="7094416">)</span>&nbsp;<span class="op" id="7094418">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094421">test</span>&nbsp;<span class="op" id="7094426">:=</span>&nbsp;<span class="op" id="7094429">&amp;</span><span class="ident" id="7094430"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7094440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094444">name</span><span class="op" id="7094448">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7094453">&#34;ECDHE-ECDSA-AES-GCM&#34;</span><span class="op" id="7094474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094478">command</span><span class="op" id="7094485">:</span>&nbsp;<span class="op" id="7094487">[</span><span class="op" id="7094488">]</span><span class="builtintype" id="7094489">string</span><span class="op" id="7094495">{</span><span class="string" id="7094496">&#34;openssl&#34;</span><span class="op" id="7094505">,</span>&nbsp;<span class="string" id="7094507">&#34;s_server&#34;</span><span class="op" id="7094517">,</span>&nbsp;<span class="string" id="7094519">&#34;-cipher&#34;</span><span class="op" id="7094528">,</span>&nbsp;<span class="string" id="7094530">&#34;ECDHE-ECDSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7094561">}</span><span class="op" id="7094562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094566">cert</span><span class="op" id="7094570">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094575"><a href="/crypto/tls/handshake_server_test.go.html#7133477">testECDSACertificate</a></span><span class="op" id="7094595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094599">key</span><span class="op" id="7094602">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094608"><a href="/crypto/tls/handshake_server_test.go.html#7136719">testECDSAPrivateKey</a></span><span class="op" id="7094627">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094633"><a href="/crypto/tls/handshake_client_test.go.html#7093374">runClientTestTLS12</a></span><span class="op" id="7094651">(</span><span class="ident" id="7094652"><a href="/crypto/tls/handshake_client_test.go.html#7094404">t</a></span><span class="op" id="7094653">,</span>&nbsp;<span class="ident" id="7094655"><a href="/crypto/tls/handshake_client_test.go.html#7094421">test</a></span><span class="op" id="7094659">)</span><br>
<span class="lineno"></span><span class="op" id="7094661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7094664">func</span>&nbsp;<span class="ident" id="7094669">TestHandshakeClientCertRSA</span><span class="op" id="7094695">(</span><span class="ident" id="7094696">t</span>&nbsp;<span class="op" id="7094698">*</span><span class="ident" id="7094699"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7094706">.</span><span class="ident" id="7094707">T</span><span class="op" id="7094708">)</span>&nbsp;<span class="op" id="7094710">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094713">config</span>&nbsp;<span class="op" id="7094720">:=</span>&nbsp;<span class="op" id="7094723">*</span><span class="ident" id="7094724"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094736">cert</span><span class="op" id="7094740">,</span>&nbsp;<span class="ident" id="7094742">_</span>&nbsp;<span class="op" id="7094744">:=</span>&nbsp;<span class="ident" id="7094747"><a href="/crypto/tls/tls.go.html#4253993">X509KeyPair</a></span><span class="op" id="7094758">(</span><span class="op" id="7094759">[</span><span class="op" id="7094760">]</span><span class="builtintype" id="7094761">byte</span><span class="op" id="7094765">(</span><span class="ident" id="7094766"><a href="/crypto/tls/handshake_server_test.go.html#7127638">clientCertificatePEM</a></span><span class="op" id="7094786">)</span><span class="op" id="7094787">,</span>&nbsp;<span class="op" id="7094789">[</span><span class="op" id="7094790">]</span><span class="builtintype" id="7094791">byte</span><span class="op" id="7094795">(</span><span class="ident" id="7094796"><a href="/crypto/tls/handshake_server_test.go.html#7128400">clientKeyPEM</a></span><span class="op" id="7094808">)</span><span class="op" id="7094809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094812"><a href="/crypto/tls/handshake_client_test.go.html#7094713">config</a></span><span class="op" id="7094818">.</span><span class="ident" id="7094819">Certificates</span>&nbsp;<span class="op" id="7094832">=</span>&nbsp;<span class="op" id="7094834">[</span><span class="op" id="7094835">]</span><span class="ident" id="7094836"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="7094847">{</span><span class="ident" id="7094848"><a href="/crypto/tls/handshake_client_test.go.html#7094736">cert</a></span><span class="op" id="7094852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094856">test</span>&nbsp;<span class="op" id="7094861">:=</span>&nbsp;<span class="op" id="7094864">&amp;</span><span class="ident" id="7094865"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7094875">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094879">name</span><span class="op" id="7094883">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7094888">&#34;ClientCert-RSA-RSA&#34;</span><span class="op" id="7094908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094912">command</span><span class="op" id="7094919">:</span>&nbsp;<span class="op" id="7094921">[</span><span class="op" id="7094922">]</span><span class="builtintype" id="7094923">string</span><span class="op" id="7094929">{</span><span class="string" id="7094930">&#34;openssl&#34;</span><span class="op" id="7094939">,</span>&nbsp;<span class="string" id="7094941">&#34;s_server&#34;</span><span class="op" id="7094951">,</span>&nbsp;<span class="string" id="7094953">&#34;-cipher&#34;</span><span class="op" id="7094962">,</span>&nbsp;<span class="string" id="7094964">&#34;RC4-SHA&#34;</span><span class="op" id="7094973">,</span>&nbsp;<span class="string" id="7094975">&#34;-verify&#34;</span><span class="op" id="7094984">,</span>&nbsp;<span class="string" id="7094986">&#34;1&#34;</span><span class="op" id="7094989">}</span><span class="op" id="7094990">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094994">config</span><span class="op" id="7095000">:</span>&nbsp;&nbsp;<span class="op" id="7095003">&amp;</span><span class="ident" id="7095004"><a href="/crypto/tls/handshake_client_test.go.html#7094713">config</a></span><span class="op" id="7095010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095017"><a href="/crypto/tls/handshake_client_test.go.html#7093126">runClientTestTLS10</a></span><span class="op" id="7095035">(</span><span class="ident" id="7095036"><a href="/crypto/tls/handshake_client_test.go.html#7094696">t</a></span><span class="op" id="7095037">,</span>&nbsp;<span class="ident" id="7095039"><a href="/crypto/tls/handshake_client_test.go.html#7094856">test</a></span><span class="op" id="7095043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095046"><a href="/crypto/tls/handshake_client_test.go.html#7093374">runClientTestTLS12</a></span><span class="op" id="7095064">(</span><span class="ident" id="7095065"><a href="/crypto/tls/handshake_client_test.go.html#7094696">t</a></span><span class="op" id="7095066">,</span>&nbsp;<span class="ident" id="7095068"><a href="/crypto/tls/handshake_client_test.go.html#7094856">test</a></span><span class="op" id="7095072">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095076"><a href="/crypto/tls/handshake_client_test.go.html#7094856">test</a></span>&nbsp;<span class="op" id="7095081">=</span>&nbsp;<span class="op" id="7095083">&amp;</span><span class="ident" id="7095084"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7095094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095098">name</span><span class="op" id="7095102">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7095107">&#34;ClientCert-RSA-ECDSA&#34;</span><span class="op" id="7095129">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095133">command</span><span class="op" id="7095140">:</span>&nbsp;<span class="op" id="7095142">[</span><span class="op" id="7095143">]</span><span class="builtintype" id="7095144">string</span><span class="op" id="7095150">{</span><span class="string" id="7095151">&#34;openssl&#34;</span><span class="op" id="7095160">,</span>&nbsp;<span class="string" id="7095162">&#34;s_server&#34;</span><span class="op" id="7095172">,</span>&nbsp;<span class="string" id="7095174">&#34;-cipher&#34;</span><span class="op" id="7095183">,</span>&nbsp;<span class="string" id="7095185">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7095209">,</span>&nbsp;<span class="string" id="7095211">&#34;-verify&#34;</span><span class="op" id="7095220">,</span>&nbsp;<span class="string" id="7095222">&#34;1&#34;</span><span class="op" id="7095225">}</span><span class="op" id="7095226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095230">config</span><span class="op" id="7095236">:</span>&nbsp;&nbsp;<span class="op" id="7095239">&amp;</span><span class="ident" id="7095240"><a href="/crypto/tls/handshake_client_test.go.html#7094713">config</a></span><span class="op" id="7095246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095250">cert</span><span class="op" id="7095254">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095259"><a href="/crypto/tls/handshake_server_test.go.html#7133477">testECDSACertificate</a></span><span class="op" id="7095279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095283">key</span><span class="op" id="7095286">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095292"><a href="/crypto/tls/handshake_server_test.go.html#7136719">testECDSAPrivateKey</a></span><span class="op" id="7095311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095314">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095318"><a href="/crypto/tls/handshake_client_test.go.html#7093126">runClientTestTLS10</a></span><span class="op" id="7095336">(</span><span class="ident" id="7095337"><a href="/crypto/tls/handshake_client_test.go.html#7094696">t</a></span><span class="op" id="7095338">,</span>&nbsp;<span class="ident" id="7095340"><a href="/crypto/tls/handshake_client_test.go.html#7094856">test</a></span><span class="op" id="7095344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095347"><a href="/crypto/tls/handshake_client_test.go.html#7093374">runClientTestTLS12</a></span><span class="op" id="7095365">(</span><span class="ident" id="7095366"><a href="/crypto/tls/handshake_client_test.go.html#7094696">t</a></span><span class="op" id="7095367">,</span>&nbsp;<span class="ident" id="7095369"><a href="/crypto/tls/handshake_client_test.go.html#7094856">test</a></span><span class="op" id="7095373">)</span><br>
<span class="lineno"></span><span class="op" id="7095375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="7095378">func</span>&nbsp;<span class="ident" id="7095383">TestHandshakeClientCertECDSA</span><span class="op" id="7095411">(</span><span class="ident" id="7095412">t</span>&nbsp;<span class="op" id="7095414">*</span><span class="ident" id="7095415"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7095422">.</span><span class="ident" id="7095423">T</span><span class="op" id="7095424">)</span>&nbsp;<span class="op" id="7095426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095429">config</span>&nbsp;<span class="op" id="7095436">:=</span>&nbsp;<span class="op" id="7095439">*</span><span class="ident" id="7095440"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095452">cert</span><span class="op" id="7095456">,</span>&nbsp;<span class="ident" id="7095458">_</span>&nbsp;<span class="op" id="7095460">:=</span>&nbsp;<span class="ident" id="7095463"><a href="/crypto/tls/tls.go.html#4253993">X509KeyPair</a></span><span class="op" id="7095474">(</span><span class="op" id="7095475">[</span><span class="op" id="7095476">]</span><span class="builtintype" id="7095477">byte</span><span class="op" id="7095481">(</span><span class="ident" id="7095482"><a href="/crypto/tls/handshake_server_test.go.html#7129308">clientECDSACertificatePEM</a></span><span class="op" id="7095507">)</span><span class="op" id="7095508">,</span>&nbsp;<span class="op" id="7095510">[</span><span class="op" id="7095511">]</span><span class="builtintype" id="7095512">byte</span><span class="op" id="7095516">(</span><span class="ident" id="7095517"><a href="/crypto/tls/handshake_server_test.go.html#7130095">clientECDSAKeyPEM</a></span><span class="op" id="7095534">)</span><span class="op" id="7095535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095538"><a href="/crypto/tls/handshake_client_test.go.html#7095429">config</a></span><span class="op" id="7095544">.</span><span class="ident" id="7095545">Certificates</span>&nbsp;<span class="op" id="7095558">=</span>&nbsp;<span class="op" id="7095560">[</span><span class="op" id="7095561">]</span><span class="ident" id="7095562"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="7095573">{</span><span class="ident" id="7095574"><a href="/crypto/tls/handshake_client_test.go.html#7095452">cert</a></span><span class="op" id="7095578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095582">test</span>&nbsp;<span class="op" id="7095587">:=</span>&nbsp;<span class="op" id="7095590">&amp;</span><span class="ident" id="7095591"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7095601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095605">name</span><span class="op" id="7095609">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7095614">&#34;ClientCert-ECDSA-RSA&#34;</span><span class="op" id="7095636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095640">command</span><span class="op" id="7095647">:</span>&nbsp;<span class="op" id="7095649">[</span><span class="op" id="7095650">]</span><span class="builtintype" id="7095651">string</span><span class="op" id="7095657">{</span><span class="string" id="7095658">&#34;openssl&#34;</span><span class="op" id="7095667">,</span>&nbsp;<span class="string" id="7095669">&#34;s_server&#34;</span><span class="op" id="7095679">,</span>&nbsp;<span class="string" id="7095681">&#34;-cipher&#34;</span><span class="op" id="7095690">,</span>&nbsp;<span class="string" id="7095692">&#34;RC4-SHA&#34;</span><span class="op" id="7095701">,</span>&nbsp;<span class="string" id="7095703">&#34;-verify&#34;</span><span class="op" id="7095712">,</span>&nbsp;<span class="string" id="7095714">&#34;1&#34;</span><span class="op" id="7095717">}</span><span class="op" id="7095718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095722">config</span><span class="op" id="7095728">:</span>&nbsp;&nbsp;<span class="op" id="7095731">&amp;</span><span class="ident" id="7095732"><a href="/crypto/tls/handshake_client_test.go.html#7095429">config</a></span><span class="op" id="7095738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095741">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095745"><a href="/crypto/tls/handshake_client_test.go.html#7093126">runClientTestTLS10</a></span><span class="op" id="7095763">(</span><span class="ident" id="7095764"><a href="/crypto/tls/handshake_client_test.go.html#7095412">t</a></span><span class="op" id="7095765">,</span>&nbsp;<span class="ident" id="7095767"><a href="/crypto/tls/handshake_client_test.go.html#7095582">test</a></span><span class="op" id="7095771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095774"><a href="/crypto/tls/handshake_client_test.go.html#7093374">runClientTestTLS12</a></span><span class="op" id="7095792">(</span><span class="ident" id="7095793"><a href="/crypto/tls/handshake_client_test.go.html#7095412">t</a></span><span class="op" id="7095794">,</span>&nbsp;<span class="ident" id="7095796"><a href="/crypto/tls/handshake_client_test.go.html#7095582">test</a></span><span class="op" id="7095800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095804"><a href="/crypto/tls/handshake_client_test.go.html#7095582">test</a></span>&nbsp;<span class="op" id="7095809">=</span>&nbsp;<span class="op" id="7095811">&amp;</span><span class="ident" id="7095812"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7095822">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095826">name</span><span class="op" id="7095830">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7095835">&#34;ClientCert-ECDSA-ECDSA&#34;</span><span class="op" id="7095859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095863">command</span><span class="op" id="7095870">:</span>&nbsp;<span class="op" id="7095872">[</span><span class="op" id="7095873">]</span><span class="builtintype" id="7095874">string</span><span class="op" id="7095880">{</span><span class="string" id="7095881">&#34;openssl&#34;</span><span class="op" id="7095890">,</span>&nbsp;<span class="string" id="7095892">&#34;s_server&#34;</span><span class="op" id="7095902">,</span>&nbsp;<span class="string" id="7095904">&#34;-cipher&#34;</span><span class="op" id="7095913">,</span>&nbsp;<span class="string" id="7095915">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7095939">,</span>&nbsp;<span class="string" id="7095941">&#34;-verify&#34;</span><span class="op" id="7095950">,</span>&nbsp;<span class="string" id="7095952">&#34;1&#34;</span><span class="op" id="7095955">}</span><span class="op" id="7095956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095960">config</span><span class="op" id="7095966">:</span>&nbsp;&nbsp;<span class="op" id="7095969">&amp;</span><span class="ident" id="7095970"><a href="/crypto/tls/handshake_client_test.go.html#7095429">config</a></span><span class="op" id="7095976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095980">cert</span><span class="op" id="7095984">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095989"><a href="/crypto/tls/handshake_server_test.go.html#7133477">testECDSACertificate</a></span><span class="op" id="7096009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096013">key</span><span class="op" id="7096016">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7096022"><a href="/crypto/tls/handshake_server_test.go.html#7136719">testECDSAPrivateKey</a></span><span class="op" id="7096041">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096048"><a href="/crypto/tls/handshake_client_test.go.html#7093126">runClientTestTLS10</a></span><span class="op" id="7096066">(</span><span class="ident" id="7096067"><a href="/crypto/tls/handshake_client_test.go.html#7095412">t</a></span><span class="op" id="7096068">,</span>&nbsp;<span class="ident" id="7096070"><a href="/crypto/tls/handshake_client_test.go.html#7095582">test</a></span><span class="op" id="7096074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096077"><a href="/crypto/tls/handshake_client_test.go.html#7093374">runClientTestTLS12</a></span><span class="op" id="7096095">(</span><span class="ident" id="7096096"><a href="/crypto/tls/handshake_client_test.go.html#7095412">t</a></span><span class="op" id="7096097">,</span>&nbsp;<span class="ident" id="7096099"><a href="/crypto/tls/handshake_client_test.go.html#7095582">test</a></span><span class="op" id="7096103">)</span><br>
<span class="lineno"></span><span class="op" id="7096105">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7096108">func</span>&nbsp;<span class="ident" id="7096113">TestClientResumption</span><span class="op" id="7096133">(</span><span class="ident" id="7096134">t</span>&nbsp;<span class="op" id="7096136">*</span><span class="ident" id="7096137"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7096144">.</span><span class="ident" id="7096145">T</span><span class="op" id="7096146">)</span>&nbsp;<span class="op" id="7096148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096151">serverConfig</span>&nbsp;<span class="op" id="7096164">:=</span>&nbsp;<span class="op" id="7096167">&amp;</span><span class="ident" id="7096168"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="7096174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096178">CipherSuites</span><span class="op" id="7096190">:</span>&nbsp;<span class="op" id="7096192">[</span><span class="op" id="7096193">]</span><span class="builtintype" id="7096194">uint16</span><span class="op" id="7096200">{</span><span class="ident" id="7096201"><a href="/crypto/tls/cipher_suites.go.html#4106867">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7096225">,</span>&nbsp;<span class="ident" id="7096227"><a href="/crypto/tls/cipher_suites.go.html#4107266">TLS_ECDHE_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7096257">}</span><span class="op" id="7096258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096262">Certificates</span><span class="op" id="7096274">:</span>&nbsp;<span class="ident" id="7096276"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7096286">.</span><span class="ident" id="7096287">Certificates</span><span class="op" id="7096299">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096305">clientConfig</span>&nbsp;<span class="op" id="7096318">:=</span>&nbsp;<span class="op" id="7096321">&amp;</span><span class="ident" id="7096322"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="7096328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096332">CipherSuites</span><span class="op" id="7096344">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7096352">[</span><span class="op" id="7096353">]</span><span class="builtintype" id="7096354">uint16</span><span class="op" id="7096360">{</span><span class="ident" id="7096361"><a href="/crypto/tls/cipher_suites.go.html#4106867">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7096385">}</span><span class="op" id="7096386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096390">InsecureSkipVerify</span><span class="op" id="7096408">:</span>&nbsp;<span class="ident" id="7096410">true</span><span class="op" id="7096414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096418">ClientSessionCache</span><span class="op" id="7096436">:</span>&nbsp;<span class="ident" id="7096438"><a href="/crypto/tls/common.go.html#4125122">NewLRUClientSessionCache</a></span><span class="op" id="7096462">(</span><span class="num" id="7096463">32</span><span class="op" id="7096465">)</span><span class="op" id="7096466">,</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096473">testResumeState</span>&nbsp;<span class="op" id="7096489">:=</span>&nbsp;<span class="keyword" id="7096492">func</span><span class="op" id="7096496">(</span><span class="ident" id="7096497">test</span>&nbsp;<span class="builtintype" id="7096502">string</span><span class="op" id="7096508">,</span>&nbsp;<span class="ident" id="7096510">didResume</span>&nbsp;<span class="builtintype" id="7096520">bool</span><span class="op" id="7096524">)</span>&nbsp;<span class="op" id="7096526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096530">hs</span><span class="op" id="7096532">,</span>&nbsp;<span class="ident" id="7096534">err</span>&nbsp;<span class="op" id="7096538">:=</span>&nbsp;<span class="ident" id="7096541"><a href="/crypto/tls/handshake_server_test.go.html#7111102">testHandshake</a></span><span class="op" id="7096554">(</span><span class="ident" id="7096555"><a href="/crypto/tls/handshake_client_test.go.html#7096305">clientConfig</a></span><span class="op" id="7096567">,</span>&nbsp;<span class="ident" id="7096569"><a href="/crypto/tls/handshake_client_test.go.html#7096151">serverConfig</a></span><span class="op" id="7096581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096585">if</span>&nbsp;<span class="ident" id="7096588"><a href="/crypto/tls/handshake_client_test.go.html#7096534">err</a></span>&nbsp;<span class="op" id="7096592">!=</span>&nbsp;<span class="ident" id="7096595">nil</span>&nbsp;<span class="op" id="7096599">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096604"><a href="/crypto/tls/handshake_client_test.go.html#7096134">t</a></span><span class="op" id="7096605">.</span><span class="ident" id="7096606">Fatalf</span><span class="op" id="7096612">(</span><span class="string" id="7096613">&#34;%s:&nbsp;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7096639">,</span>&nbsp;<span class="ident" id="7096641"><a href="/crypto/tls/handshake_client_test.go.html#7096497">test</a></span><span class="op" id="7096645">,</span>&nbsp;<span class="ident" id="7096647"><a href="/crypto/tls/handshake_client_test.go.html#7096534">err</a></span><span class="op" id="7096650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096658">if</span>&nbsp;<span class="ident" id="7096661"><a href="/crypto/tls/handshake_client_test.go.html#7096530">hs</a></span><span class="op" id="7096663">.</span><span class="ident" id="7096664">DidResume</span>&nbsp;<span class="op" id="7096674">!=</span>&nbsp;<span class="ident" id="7096677"><a href="/crypto/tls/handshake_client_test.go.html#7096510">didResume</a></span>&nbsp;<span class="op" id="7096687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096692"><a href="/crypto/tls/handshake_client_test.go.html#7096134">t</a></span><span class="op" id="7096693">.</span><span class="ident" id="7096694">Fatalf</span><span class="op" id="7096700">(</span><span class="string" id="7096701">&#34;%s&nbsp;resumed:&nbsp;%v,&nbsp;expected:&nbsp;%v&#34;</span><span class="op" id="7096731">,</span>&nbsp;<span class="ident" id="7096733"><a href="/crypto/tls/handshake_client_test.go.html#7096497">test</a></span><span class="op" id="7096737">,</span>&nbsp;<span class="ident" id="7096739"><a href="/crypto/tls/handshake_client_test.go.html#7096530">hs</a></span><span class="op" id="7096741">.</span><span class="ident" id="7096742">DidResume</span><span class="op" id="7096751">,</span>&nbsp;<span class="ident" id="7096753"><a href="/crypto/tls/handshake_client_test.go.html#7096510">didResume</a></span><span class="op" id="7096762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096766">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096773"><a href="/crypto/tls/handshake_client_test.go.html#7096473">testResumeState</a></span><span class="op" id="7096788">(</span><span class="string" id="7096789">&#34;Handshake&#34;</span><span class="op" id="7096800">,</span>&nbsp;<span class="ident" id="7096802">false</span><span class="op" id="7096807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096810"><a href="/crypto/tls/handshake_client_test.go.html#7096473">testResumeState</a></span><span class="op" id="7096825">(</span><span class="string" id="7096826">&#34;Resume&#34;</span><span class="op" id="7096834">,</span>&nbsp;<span class="ident" id="7096836">true</span><span class="op" id="7096840">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096844">if</span>&nbsp;<span class="ident" id="7096847">_</span><span class="op" id="7096848">,</span>&nbsp;<span class="ident" id="7096850">err</span>&nbsp;<span class="op" id="7096854">:=</span>&nbsp;<span class="ident" id="7096857"><a href="/crypto/tls/handshake_client_test.go.html#7086493">io</a></span><span class="op" id="7096859">.</span><span class="ident" id="7096860">ReadFull</span><span class="op" id="7096868">(</span><span class="ident" id="7096869"><a href="/crypto/tls/handshake_client_test.go.html#7096151">serverConfig</a></span><span class="op" id="7096881">.</span><span class="ident" id="7096882">rand</span><span class="op" id="7096886">(</span><span class="op" id="7096887">)</span><span class="op" id="7096888">,</span>&nbsp;<span class="ident" id="7096890"><a href="/crypto/tls/handshake_client_test.go.html#7096151">serverConfig</a></span><span class="op" id="7096902">.</span><span class="ident" id="7096903">SessionTicketKey</span><span class="op" id="7096919">[</span><span class="op" id="7096920">:</span><span class="op" id="7096921">]</span><span class="op" id="7096922">)</span><span class="op" id="7096923">;</span>&nbsp;<span class="ident" id="7096925"><a href="/crypto/tls/handshake_client_test.go.html#7096850">err</a></span>&nbsp;<span class="op" id="7096929">!=</span>&nbsp;<span class="ident" id="7096932">nil</span>&nbsp;<span class="op" id="7096936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096940"><a href="/crypto/tls/handshake_client_test.go.html#7096134">t</a></span><span class="op" id="7096941">.</span><span class="ident" id="7096942">Fatalf</span><span class="op" id="7096948">(</span><span class="string" id="7096949">&#34;Failed&nbsp;to&nbsp;invalidate&nbsp;SessionTicketKey&#34;</span><span class="op" id="7096988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096994"><a href="/crypto/tls/handshake_client_test.go.html#7096473">testResumeState</a></span><span class="op" id="7097009">(</span><span class="string" id="7097010">&#34;InvalidSessionTicketKey&#34;</span><span class="op" id="7097035">,</span>&nbsp;<span class="ident" id="7097037">false</span><span class="op" id="7097042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097045"><a href="/crypto/tls/handshake_client_test.go.html#7096473">testResumeState</a></span><span class="op" id="7097060">(</span><span class="string" id="7097061">&#34;ResumeAfterInvalidSessionTicketKey&#34;</span><span class="op" id="7097097">,</span>&nbsp;<span class="ident" id="7097099">true</span><span class="op" id="7097103">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097107"><a href="/crypto/tls/handshake_client_test.go.html#7096305">clientConfig</a></span><span class="op" id="7097119">.</span><span class="ident" id="7097120">CipherSuites</span>&nbsp;<span class="op" id="7097133">=</span>&nbsp;<span class="op" id="7097135">[</span><span class="op" id="7097136">]</span><span class="builtintype" id="7097137">uint16</span><span class="op" id="7097143">{</span><span class="ident" id="7097144"><a href="/crypto/tls/cipher_suites.go.html#4107266">TLS_ECDHE_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7097174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097177"><a href="/crypto/tls/handshake_client_test.go.html#7096473">testResumeState</a></span><span class="op" id="7097192">(</span><span class="string" id="7097193">&#34;DifferentCipherSuite&#34;</span><span class="op" id="7097215">,</span>&nbsp;<span class="ident" id="7097217">false</span><span class="op" id="7097222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097225"><a href="/crypto/tls/handshake_client_test.go.html#7096473">testResumeState</a></span><span class="op" id="7097240">(</span><span class="string" id="7097241">&#34;DifferentCipherSuiteRecovers&#34;</span><span class="op" id="7097271">,</span>&nbsp;<span class="ident" id="7097273">true</span><span class="op" id="7097277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097281"><a href="/crypto/tls/handshake_client_test.go.html#7096305">clientConfig</a></span><span class="op" id="7097293">.</span><span class="ident" id="7097294">ClientSessionCache</span>&nbsp;<span class="op" id="7097313">=</span>&nbsp;<span class="ident" id="7097315">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097320"><a href="/crypto/tls/handshake_client_test.go.html#7096473">testResumeState</a></span><span class="op" id="7097335">(</span><span class="string" id="7097336">&#34;WithoutSessionCache&#34;</span><span class="op" id="7097357">,</span>&nbsp;<span class="ident" id="7097359">false</span><span class="op" id="7097364">)</span><br>
<span class="lineno"></span><span class="op" id="7097366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7097369">func</span>&nbsp;<span class="ident" id="7097374">TestLRUClientSessionCache</span><span class="op" id="7097399">(</span><span class="ident" id="7097400">t</span>&nbsp;<span class="op" id="7097402">*</span><span class="ident" id="7097403"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7097410">.</span><span class="ident" id="7097411">T</span><span class="op" id="7097412">)</span>&nbsp;<span class="op" id="7097414">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7097417">//&nbsp;Initialize&nbsp;cache&nbsp;of&nbsp;capacity&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097453">cache</span>&nbsp;<span class="op" id="7097459">:=</span>&nbsp;<span class="ident" id="7097462"><a href="/crypto/tls/common.go.html#4125122">NewLRUClientSessionCache</a></span><span class="op" id="7097486">(</span><span class="num" id="7097487">4</span><span class="op" id="7097488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097491">cs</span>&nbsp;<span class="op" id="7097494">:=</span>&nbsp;<span class="builtinfunc" id="7097497">make</span><span class="op" id="7097501">(</span><span class="op" id="7097502">[</span><span class="op" id="7097503">]</span><span class="ident" id="7097504"><a href="/crypto/tls/common.go.html#4113855">ClientSessionState</a></span><span class="op" id="7097522">,</span>&nbsp;<span class="num" id="7097524">6</span><span class="op" id="7097525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097528">keys</span>&nbsp;<span class="op" id="7097533">:=</span>&nbsp;<span class="op" id="7097536">[</span><span class="op" id="7097537">]</span><span class="builtintype" id="7097538">string</span><span class="op" id="7097544">{</span><span class="string" id="7097545">&#34;0&#34;</span><span class="op" id="7097548">,</span>&nbsp;<span class="string" id="7097550">&#34;1&#34;</span><span class="op" id="7097553">,</span>&nbsp;<span class="string" id="7097555">&#34;2&#34;</span><span class="op" id="7097558">,</span>&nbsp;<span class="string" id="7097560">&#34;3&#34;</span><span class="op" id="7097563">,</span>&nbsp;<span class="string" id="7097565">&#34;4&#34;</span><span class="op" id="7097568">,</span>&nbsp;<span class="string" id="7097570">&#34;5&#34;</span><span class="op" id="7097573">,</span>&nbsp;<span class="string" id="7097575">&#34;6&#34;</span><span class="op" id="7097578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7097582">//&nbsp;Add&nbsp;4&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache&nbsp;and&nbsp;look&nbsp;them&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097631">for</span>&nbsp;<span class="ident" id="7097635">i</span>&nbsp;<span class="op" id="7097637">:=</span>&nbsp;<span class="num" id="7097640">0</span><span class="op" id="7097641">;</span>&nbsp;<span class="ident" id="7097643"><a href="/crypto/tls/handshake_client_test.go.html#7097635">i</a></span>&nbsp;<span class="op" id="7097645">&lt;</span>&nbsp;<span class="num" id="7097647">4</span><span class="op" id="7097648">;</span>&nbsp;<span class="ident" id="7097650"><a href="/crypto/tls/handshake_client_test.go.html#7097635">i</a></span><span class="op" id="7097651">++</span>&nbsp;<span class="op" id="7097654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097658"><a href="/crypto/tls/handshake_client_test.go.html#7097453">cache</a></span><span class="op" id="7097663">.</span><span class="ident" id="7097664">Put</span><span class="op" id="7097667">(</span><span class="ident" id="7097668"><a href="/crypto/tls/handshake_client_test.go.html#7097528">keys</a></span><span class="op" id="7097672">[</span><span class="ident" id="7097673"><a href="/crypto/tls/handshake_client_test.go.html#7097635">i</a></span><span class="op" id="7097674">]</span><span class="op" id="7097675">,</span>&nbsp;<span class="op" id="7097677">&amp;</span><span class="ident" id="7097678"><a href="/crypto/tls/handshake_client_test.go.html#7097491">cs</a></span><span class="op" id="7097680">[</span><span class="ident" id="7097681"><a href="/crypto/tls/handshake_client_test.go.html#7097635">i</a></span><span class="op" id="7097682">]</span><span class="op" id="7097683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097689">for</span>&nbsp;<span class="ident" id="7097693">i</span>&nbsp;<span class="op" id="7097695">:=</span>&nbsp;<span class="num" id="7097698">0</span><span class="op" id="7097699">;</span>&nbsp;<span class="ident" id="7097701"><a href="/crypto/tls/handshake_client_test.go.html#7097693">i</a></span>&nbsp;<span class="op" id="7097703">&lt;</span>&nbsp;<span class="num" id="7097705">4</span><span class="op" id="7097706">;</span>&nbsp;<span class="ident" id="7097708"><a href="/crypto/tls/handshake_client_test.go.html#7097693">i</a></span><span class="op" id="7097709">++</span>&nbsp;<span class="op" id="7097712">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097716">if</span>&nbsp;<span class="ident" id="7097719">s</span><span class="op" id="7097720">,</span>&nbsp;<span class="ident" id="7097722">ok</span>&nbsp;<span class="op" id="7097725">:=</span>&nbsp;<span class="ident" id="7097728"><a href="/crypto/tls/handshake_client_test.go.html#7097453">cache</a></span><span class="op" id="7097733">.</span><span class="ident" id="7097734">Get</span><span class="op" id="7097737">(</span><span class="ident" id="7097738"><a href="/crypto/tls/handshake_client_test.go.html#7097528">keys</a></span><span class="op" id="7097742">[</span><span class="ident" id="7097743"><a href="/crypto/tls/handshake_client_test.go.html#7097693">i</a></span><span class="op" id="7097744">]</span><span class="op" id="7097745">)</span><span class="op" id="7097746">;</span>&nbsp;<span class="op" id="7097748">!</span><span class="ident" id="7097749"><a href="/crypto/tls/handshake_client_test.go.html#7097722">ok</a></span>&nbsp;<span class="op" id="7097752">||</span>&nbsp;<span class="ident" id="7097755"><a href="/crypto/tls/handshake_client_test.go.html#7097719">s</a></span>&nbsp;<span class="op" id="7097757">!=</span>&nbsp;<span class="op" id="7097760">&amp;</span><span class="ident" id="7097761"><a href="/crypto/tls/handshake_client_test.go.html#7097491">cs</a></span><span class="op" id="7097763">[</span><span class="ident" id="7097764"><a href="/crypto/tls/handshake_client_test.go.html#7097693">i</a></span><span class="op" id="7097765">]</span>&nbsp;<span class="op" id="7097767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097772"><a href="/crypto/tls/handshake_client_test.go.html#7097400">t</a></span><span class="op" id="7097773">.</span><span class="ident" id="7097774">Fatalf</span><span class="op" id="7097780">(</span><span class="string" id="7097781">&#34;session&nbsp;cache&nbsp;failed&nbsp;lookup&nbsp;for&nbsp;added&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7097828">,</span>&nbsp;<span class="ident" id="7097830"><a href="/crypto/tls/handshake_client_test.go.html#7097528">keys</a></span><span class="op" id="7097834">[</span><span class="ident" id="7097835"><a href="/crypto/tls/handshake_client_test.go.html#7097693">i</a></span><span class="op" id="7097836">]</span><span class="op" id="7097837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7097848">//&nbsp;Add&nbsp;2&nbsp;more&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache.&nbsp;First&nbsp;2&nbsp;should&nbsp;be&nbsp;evicted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097912">for</span>&nbsp;<span class="ident" id="7097916">i</span>&nbsp;<span class="op" id="7097918">:=</span>&nbsp;<span class="num" id="7097921">4</span><span class="op" id="7097922">;</span>&nbsp;<span class="ident" id="7097924"><a href="/crypto/tls/handshake_client_test.go.html#7097916">i</a></span>&nbsp;<span class="op" id="7097926">&lt;</span>&nbsp;<span class="num" id="7097928">6</span><span class="op" id="7097929">;</span>&nbsp;<span class="ident" id="7097931"><a href="/crypto/tls/handshake_client_test.go.html#7097916">i</a></span><span class="op" id="7097932">++</span>&nbsp;<span class="op" id="7097935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097939"><a href="/crypto/tls/handshake_client_test.go.html#7097453">cache</a></span><span class="op" id="7097944">.</span><span class="ident" id="7097945">Put</span><span class="op" id="7097948">(</span><span class="ident" id="7097949"><a href="/crypto/tls/handshake_client_test.go.html#7097528">keys</a></span><span class="op" id="7097953">[</span><span class="ident" id="7097954"><a href="/crypto/tls/handshake_client_test.go.html#7097916">i</a></span><span class="op" id="7097955">]</span><span class="op" id="7097956">,</span>&nbsp;<span class="op" id="7097958">&amp;</span><span class="ident" id="7097959"><a href="/crypto/tls/handshake_client_test.go.html#7097491">cs</a></span><span class="op" id="7097961">[</span><span class="ident" id="7097962"><a href="/crypto/tls/handshake_client_test.go.html#7097916">i</a></span><span class="op" id="7097963">]</span><span class="op" id="7097964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097970">for</span>&nbsp;<span class="ident" id="7097974">i</span>&nbsp;<span class="op" id="7097976">:=</span>&nbsp;<span class="num" id="7097979">0</span><span class="op" id="7097980">;</span>&nbsp;<span class="ident" id="7097982"><a href="/crypto/tls/handshake_client_test.go.html#7097974">i</a></span>&nbsp;<span class="op" id="7097984">&lt;</span>&nbsp;<span class="num" id="7097986">2</span><span class="op" id="7097987">;</span>&nbsp;<span class="ident" id="7097989"><a href="/crypto/tls/handshake_client_test.go.html#7097974">i</a></span><span class="op" id="7097990">++</span>&nbsp;<span class="op" id="7097993">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097997">if</span>&nbsp;<span class="ident" id="7098000">s</span><span class="op" id="7098001">,</span>&nbsp;<span class="ident" id="7098003">ok</span>&nbsp;<span class="op" id="7098006">:=</span>&nbsp;<span class="ident" id="7098009"><a href="/crypto/tls/handshake_client_test.go.html#7097453">cache</a></span><span class="op" id="7098014">.</span><span class="ident" id="7098015">Get</span><span class="op" id="7098018">(</span><span class="ident" id="7098019"><a href="/crypto/tls/handshake_client_test.go.html#7097528">keys</a></span><span class="op" id="7098023">[</span><span class="ident" id="7098024"><a href="/crypto/tls/handshake_client_test.go.html#7097974">i</a></span><span class="op" id="7098025">]</span><span class="op" id="7098026">)</span><span class="op" id="7098027">;</span>&nbsp;<span class="ident" id="7098029"><a href="/crypto/tls/handshake_client_test.go.html#7098003">ok</a></span>&nbsp;<span class="op" id="7098032">||</span>&nbsp;<span class="ident" id="7098035"><a href="/crypto/tls/handshake_client_test.go.html#7098000">s</a></span>&nbsp;<span class="op" id="7098037">!=</span>&nbsp;<span class="ident" id="7098040">nil</span>&nbsp;<span class="op" id="7098044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098049"><a href="/crypto/tls/handshake_client_test.go.html#7097400">t</a></span><span class="op" id="7098050">.</span><span class="ident" id="7098051">Fatalf</span><span class="op" id="7098057">(</span><span class="string" id="7098058">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7098101">,</span>&nbsp;<span class="ident" id="7098103"><a href="/crypto/tls/handshake_client_test.go.html#7097528">keys</a></span><span class="op" id="7098107">[</span><span class="ident" id="7098108"><a href="/crypto/tls/handshake_client_test.go.html#7097974">i</a></span><span class="op" id="7098109">]</span><span class="op" id="7098110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7098121">//&nbsp;Touch&nbsp;entry&nbsp;2.&nbsp;LRU&nbsp;should&nbsp;evict&nbsp;3&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098165"><a href="/crypto/tls/handshake_client_test.go.html#7097453">cache</a></span><span class="op" id="7098170">.</span><span class="ident" id="7098171">Get</span><span class="op" id="7098174">(</span><span class="ident" id="7098175"><a href="/crypto/tls/handshake_client_test.go.html#7097528">keys</a></span><span class="op" id="7098179">[</span><span class="num" id="7098180">2</span><span class="op" id="7098181">]</span><span class="op" id="7098182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098185"><a href="/crypto/tls/handshake_client_test.go.html#7097453">cache</a></span><span class="op" id="7098190">.</span><span class="ident" id="7098191">Put</span><span class="op" id="7098194">(</span><span class="ident" id="7098195"><a href="/crypto/tls/handshake_client_test.go.html#7097528">keys</a></span><span class="op" id="7098199">[</span><span class="num" id="7098200">0</span><span class="op" id="7098201">]</span><span class="op" id="7098202">,</span>&nbsp;<span class="op" id="7098204">&amp;</span><span class="ident" id="7098205"><a href="/crypto/tls/handshake_client_test.go.html#7097491">cs</a></span><span class="op" id="7098207">[</span><span class="num" id="7098208">0</span><span class="op" id="7098209">]</span><span class="op" id="7098210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098213">if</span>&nbsp;<span class="ident" id="7098216">s</span><span class="op" id="7098217">,</span>&nbsp;<span class="ident" id="7098219">ok</span>&nbsp;<span class="op" id="7098222">:=</span>&nbsp;<span class="ident" id="7098225"><a href="/crypto/tls/handshake_client_test.go.html#7097453">cache</a></span><span class="op" id="7098230">.</span><span class="ident" id="7098231">Get</span><span class="op" id="7098234">(</span><span class="ident" id="7098235"><a href="/crypto/tls/handshake_client_test.go.html#7097528">keys</a></span><span class="op" id="7098239">[</span><span class="num" id="7098240">3</span><span class="op" id="7098241">]</span><span class="op" id="7098242">)</span><span class="op" id="7098243">;</span>&nbsp;<span class="ident" id="7098245"><a href="/crypto/tls/handshake_client_test.go.html#7098219">ok</a></span>&nbsp;<span class="op" id="7098248">||</span>&nbsp;<span class="ident" id="7098251"><a href="/crypto/tls/handshake_client_test.go.html#7098216">s</a></span>&nbsp;<span class="op" id="7098253">!=</span>&nbsp;<span class="ident" id="7098256">nil</span>&nbsp;<span class="op" id="7098260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098264"><a href="/crypto/tls/handshake_client_test.go.html#7097400">t</a></span><span class="op" id="7098265">.</span><span class="ident" id="7098266">Fatalf</span><span class="op" id="7098272">(</span><span class="string" id="7098273">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key&nbsp;3&#34;</span><span class="op" id="7098314">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7098321">//&nbsp;Update&nbsp;entry&nbsp;0&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098350"><a href="/crypto/tls/handshake_client_test.go.html#7097453">cache</a></span><span class="op" id="7098355">.</span><span class="ident" id="7098356">Put</span><span class="op" id="7098359">(</span><span class="ident" id="7098360"><a href="/crypto/tls/handshake_client_test.go.html#7097528">keys</a></span><span class="op" id="7098364">[</span><span class="num" id="7098365">0</span><span class="op" id="7098366">]</span><span class="op" id="7098367">,</span>&nbsp;<span class="op" id="7098369">&amp;</span><span class="ident" id="7098370"><a href="/crypto/tls/handshake_client_test.go.html#7097491">cs</a></span><span class="op" id="7098372">[</span><span class="num" id="7098373">3</span><span class="op" id="7098374">]</span><span class="op" id="7098375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098378">if</span>&nbsp;<span class="ident" id="7098381">s</span><span class="op" id="7098382">,</span>&nbsp;<span class="ident" id="7098384">ok</span>&nbsp;<span class="op" id="7098387">:=</span>&nbsp;<span class="ident" id="7098390"><a href="/crypto/tls/handshake_client_test.go.html#7097453">cache</a></span><span class="op" id="7098395">.</span><span class="ident" id="7098396">Get</span><span class="op" id="7098399">(</span><span class="ident" id="7098400"><a href="/crypto/tls/handshake_client_test.go.html#7097528">keys</a></span><span class="op" id="7098404">[</span><span class="num" id="7098405">0</span><span class="op" id="7098406">]</span><span class="op" id="7098407">)</span><span class="op" id="7098408">;</span>&nbsp;<span class="op" id="7098410">!</span><span class="ident" id="7098411"><a href="/crypto/tls/handshake_client_test.go.html#7098384">ok</a></span>&nbsp;<span class="op" id="7098414">||</span>&nbsp;<span class="ident" id="7098417"><a href="/crypto/tls/handshake_client_test.go.html#7098381">s</a></span>&nbsp;<span class="op" id="7098419">!=</span>&nbsp;<span class="op" id="7098422">&amp;</span><span class="ident" id="7098423"><a href="/crypto/tls/handshake_client_test.go.html#7097491">cs</a></span><span class="op" id="7098425">[</span><span class="num" id="7098426">3</span><span class="op" id="7098427">]</span>&nbsp;<span class="op" id="7098429">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098433"><a href="/crypto/tls/handshake_client_test.go.html#7097400">t</a></span><span class="op" id="7098434">.</span><span class="ident" id="7098435">Fatalf</span><span class="op" id="7098441">(</span><span class="string" id="7098442">&#34;session&nbsp;cache&nbsp;failed&nbsp;update&nbsp;for&nbsp;key&nbsp;0&#34;</span><span class="op" id="7098481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7098488">//&nbsp;Adding&nbsp;a&nbsp;nil&nbsp;entry&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098521"><a href="/crypto/tls/handshake_client_test.go.html#7097453">cache</a></span><span class="op" id="7098526">.</span><span class="ident" id="7098527">Put</span><span class="op" id="7098530">(</span><span class="ident" id="7098531"><a href="/crypto/tls/handshake_client_test.go.html#7097528">keys</a></span><span class="op" id="7098535">[</span><span class="num" id="7098536">0</span><span class="op" id="7098537">]</span><span class="op" id="7098538">,</span>&nbsp;<span class="ident" id="7098540">nil</span><span class="op" id="7098543">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098546">if</span>&nbsp;<span class="ident" id="7098549">s</span><span class="op" id="7098550">,</span>&nbsp;<span class="ident" id="7098552">ok</span>&nbsp;<span class="op" id="7098555">:=</span>&nbsp;<span class="ident" id="7098558"><a href="/crypto/tls/handshake_client_test.go.html#7097453">cache</a></span><span class="op" id="7098563">.</span><span class="ident" id="7098564">Get</span><span class="op" id="7098567">(</span><span class="ident" id="7098568"><a href="/crypto/tls/handshake_client_test.go.html#7097528">keys</a></span><span class="op" id="7098572">[</span><span class="num" id="7098573">0</span><span class="op" id="7098574">]</span><span class="op" id="7098575">)</span><span class="op" id="7098576">;</span>&nbsp;<span class="op" id="7098578">!</span><span class="ident" id="7098579"><a href="/crypto/tls/handshake_client_test.go.html#7098552">ok</a></span>&nbsp;<span class="op" id="7098582">||</span>&nbsp;<span class="ident" id="7098585"><a href="/crypto/tls/handshake_client_test.go.html#7098549">s</a></span>&nbsp;<span class="op" id="7098587">!=</span>&nbsp;<span class="ident" id="7098590">nil</span>&nbsp;<span class="op" id="7098594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098598"><a href="/crypto/tls/handshake_client_test.go.html#7097400">t</a></span><span class="op" id="7098599">.</span><span class="ident" id="7098600">Fatalf</span><span class="op" id="7098606">(</span><span class="string" id="7098607">&#34;failed&nbsp;to&nbsp;add&nbsp;nil&nbsp;entry&nbsp;to&nbsp;cache&#34;</span><span class="op" id="7098641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098644">}</span><br>
<span class="lineno"></span><span class="op" id="7098646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="7098649">func</span>&nbsp;<span class="ident" id="7098654">TestHandshakeClientALPNMatch</span><span class="op" id="7098682">(</span><span class="ident" id="7098683">t</span>&nbsp;<span class="op" id="7098685">*</span><span class="ident" id="7098686"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7098693">.</span><span class="ident" id="7098694">T</span><span class="op" id="7098695">)</span>&nbsp;<span class="op" id="7098697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098700">config</span>&nbsp;<span class="op" id="7098707">:=</span>&nbsp;<span class="op" id="7098710">*</span><span class="ident" id="7098711"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098723"><a href="/crypto/tls/handshake_client_test.go.html#7098700">config</a></span><span class="op" id="7098729">.</span><span class="ident" id="7098730">NextProtos</span>&nbsp;<span class="op" id="7098741">=</span>&nbsp;<span class="op" id="7098743">[</span><span class="op" id="7098744">]</span><span class="builtintype" id="7098745">string</span><span class="op" id="7098751">{</span><span class="string" id="7098752">&#34;proto2&#34;</span><span class="op" id="7098760">,</span>&nbsp;<span class="string" id="7098762">&#34;proto1&#34;</span><span class="op" id="7098770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098774">test</span>&nbsp;<span class="op" id="7098779">:=</span>&nbsp;<span class="op" id="7098782">&amp;</span><span class="ident" id="7098783"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7098793">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098797">name</span><span class="op" id="7098801">:</span>&nbsp;<span class="string" id="7098803">&#34;ALPN&#34;</span><span class="op" id="7098809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7098813">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7098879">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098922">command</span><span class="op" id="7098929">:</span>&nbsp;<span class="op" id="7098931">[</span><span class="op" id="7098932">]</span><span class="builtintype" id="7098933">string</span><span class="op" id="7098939">{</span><span class="string" id="7098940">&#34;openssl&#34;</span><span class="op" id="7098949">,</span>&nbsp;<span class="string" id="7098951">&#34;s_server&#34;</span><span class="op" id="7098961">,</span>&nbsp;<span class="string" id="7098963">&#34;-alpn&#34;</span><span class="op" id="7098970">,</span>&nbsp;<span class="string" id="7098972">&#34;proto1,proto2&#34;</span><span class="op" id="7098987">}</span><span class="op" id="7098988">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098992">config</span><span class="op" id="7098998">:</span>&nbsp;&nbsp;<span class="op" id="7099001">&amp;</span><span class="ident" id="7099002"><a href="/crypto/tls/handshake_client_test.go.html#7098700">config</a></span><span class="op" id="7099008">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099012">validate</span><span class="op" id="7099020">:</span>&nbsp;<span class="keyword" id="7099022">func</span><span class="op" id="7099026">(</span><span class="ident" id="7099027">state</span>&nbsp;<span class="ident" id="7099033"><a href="/crypto/tls/common.go.html#4112190">ConnectionState</a></span><span class="op" id="7099048">)</span>&nbsp;<span class="builtintype" id="7099050">error</span>&nbsp;<span class="op" id="7099056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7099061">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099120">if</span>&nbsp;<span class="ident" id="7099123"><a href="/crypto/tls/handshake_client_test.go.html#7099027">state</a></span><span class="op" id="7099128">.</span><span class="ident" id="7099129">NegotiatedProtocol</span>&nbsp;<span class="op" id="7099148">!=</span>&nbsp;<span class="string" id="7099151">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7099160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099166">return</span>&nbsp;<span class="ident" id="7099173"><a href="/crypto/tls/handshake_client_test.go.html#7086486">fmt</a></span><span class="op" id="7099176">.</span><span class="ident" id="7099177">Errorf</span><span class="op" id="7099183">(</span><span class="string" id="7099184">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7099216">,</span>&nbsp;<span class="ident" id="7099218"><a href="/crypto/tls/handshake_client_test.go.html#7099027">state</a></span><span class="op" id="7099223">.</span><span class="ident" id="7099224">NegotiatedProtocol</span><span class="op" id="7099242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099247">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099252">return</span>&nbsp;<span class="ident" id="7099259">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099265">}</span><span class="op" id="7099266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099272"><a href="/crypto/tls/handshake_client_test.go.html#7093374">runClientTestTLS12</a></span><span class="op" id="7099290">(</span><span class="ident" id="7099291"><a href="/crypto/tls/handshake_client_test.go.html#7098683">t</a></span><span class="op" id="7099292">,</span>&nbsp;<span class="ident" id="7099294"><a href="/crypto/tls/handshake_client_test.go.html#7098774">test</a></span><span class="op" id="7099298">)</span><br>
<span class="lineno"></span><span class="op" id="7099300">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="7099303">func</span>&nbsp;<span class="ident" id="7099308">TestHandshakeClientALPNNoMatch</span><span class="op" id="7099338">(</span><span class="ident" id="7099339">t</span>&nbsp;<span class="op" id="7099341">*</span><span class="ident" id="7099342"><a href="/crypto/tls/handshake_client_test.go.html#7086551">testing</a></span><span class="op" id="7099349">.</span><span class="ident" id="7099350">T</span><span class="op" id="7099351">)</span>&nbsp;<span class="op" id="7099353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099356">config</span>&nbsp;<span class="op" id="7099363">:=</span>&nbsp;<span class="op" id="7099366">*</span><span class="ident" id="7099367"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099379"><a href="/crypto/tls/handshake_client_test.go.html#7099356">config</a></span><span class="op" id="7099385">.</span><span class="ident" id="7099386">NextProtos</span>&nbsp;<span class="op" id="7099397">=</span>&nbsp;<span class="op" id="7099399">[</span><span class="op" id="7099400">]</span><span class="builtintype" id="7099401">string</span><span class="op" id="7099407">{</span><span class="string" id="7099408">&#34;proto3&#34;</span><span class="op" id="7099416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099420">test</span>&nbsp;<span class="op" id="7099425">:=</span>&nbsp;<span class="op" id="7099428">&amp;</span><span class="ident" id="7099429"><a href="/crypto/tls/handshake_client_test.go.html#7086959">clientTest</a></span><span class="op" id="7099439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099443">name</span><span class="op" id="7099447">:</span>&nbsp;<span class="string" id="7099449">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7099463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7099467">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7099533">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099576">command</span><span class="op" id="7099583">:</span>&nbsp;<span class="op" id="7099585">[</span><span class="op" id="7099586">]</span><span class="builtintype" id="7099587">string</span><span class="op" id="7099593">{</span><span class="string" id="7099594">&#34;openssl&#34;</span><span class="op" id="7099603">,</span>&nbsp;<span class="string" id="7099605">&#34;s_server&#34;</span><span class="op" id="7099615">,</span>&nbsp;<span class="string" id="7099617">&#34;-alpn&#34;</span><span class="op" id="7099624">,</span>&nbsp;<span class="string" id="7099626">&#34;proto1,proto2&#34;</span><span class="op" id="7099641">}</span><span class="op" id="7099642">,</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099646">config</span><span class="op" id="7099652">:</span>&nbsp;&nbsp;<span class="op" id="7099655">&amp;</span><span class="ident" id="7099656"><a href="/crypto/tls/handshake_client_test.go.html#7099356">config</a></span><span class="op" id="7099662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099666">validate</span><span class="op" id="7099674">:</span>&nbsp;<span class="keyword" id="7099676">func</span><span class="op" id="7099680">(</span><span class="ident" id="7099681">state</span>&nbsp;<span class="ident" id="7099687"><a href="/crypto/tls/common.go.html#4112190">ConnectionState</a></span><span class="op" id="7099702">)</span>&nbsp;<span class="builtintype" id="7099704">error</span>&nbsp;<span class="op" id="7099710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7099715">//&nbsp;There&#39;s&nbsp;no&nbsp;overlap&nbsp;so&nbsp;OpenSSL&nbsp;will&nbsp;not&nbsp;select&nbsp;a&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099779">if</span>&nbsp;<span class="ident" id="7099782"><a href="/crypto/tls/handshake_client_test.go.html#7099681">state</a></span><span class="op" id="7099787">.</span><span class="ident" id="7099788">NegotiatedProtocol</span>&nbsp;<span class="op" id="7099807">!=</span>&nbsp;<span class="string" id="7099810">&#34;&#34;</span>&nbsp;<span class="op" id="7099813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099819">return</span>&nbsp;<span class="ident" id="7099826"><a href="/crypto/tls/handshake_client_test.go.html#7086486">fmt</a></span><span class="op" id="7099829">.</span><span class="ident" id="7099830">Errorf</span><span class="op" id="7099836">(</span><span class="string" id="7099837">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7099865">,</span>&nbsp;<span class="ident" id="7099867"><a href="/crypto/tls/handshake_client_test.go.html#7099681">state</a></span><span class="op" id="7099872">.</span><span class="ident" id="7099873">NegotiatedProtocol</span><span class="op" id="7099891">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099901">return</span>&nbsp;<span class="ident" id="7099908">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099914">}</span><span class="op" id="7099915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099921"><a href="/crypto/tls/handshake_client_test.go.html#7093374">runClientTestTLS12</a></span><span class="op" id="7099939">(</span><span class="ident" id="7099940"><a href="/crypto/tls/handshake_client_test.go.html#7099339">t</a></span><span class="op" id="7099941">,</span>&nbsp;<span class="ident" id="7099943"><a href="/crypto/tls/handshake_client_test.go.html#7099420">test</a></span><span class="op" id="7099947">)</span><br>
<span class="lineno">490</span><span class="op" id="7099949">}</span>
</div>
</body>
</html>
