<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/fcgi</h2>
<ul>
<li><a href="/gostd/net/http/fcgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi.go.html">fcgi.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi_test.go.html" class="current">fcgi_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6702818">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6702873">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6702927">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6702978">package</span>&nbsp;<span class="ident" id="6702986">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6702992">import</span>&nbsp;<span class="op" id="6702999">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6703002">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6703011">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6703021">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6703027">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6703037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6703040">var</span>&nbsp;<span class="ident" id="6703044">sizeTests</span>&nbsp;<span class="op" id="6703054">=</span>&nbsp;<span class="op" id="6703056">[</span><span class="op" id="6703057">]</span><span class="keyword" id="6703058">struct</span>&nbsp;<span class="op" id="6703065">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703068">size</span>&nbsp;&nbsp;<span class="builtintype" id="6703074">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703082">bytes</span>&nbsp;<span class="op" id="6703088">[</span><span class="op" id="6703089">]</span><span class="builtintype" id="6703090">byte</span><br>
<span class="lineno"></span><span class="op" id="6703095">}</span><span class="op" id="6703096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703099">{</span><span class="num" id="6703100">0</span><span class="op" id="6703101">,</span>&nbsp;<span class="op" id="6703103">[</span><span class="op" id="6703104">]</span><span class="builtintype" id="6703105">byte</span><span class="op" id="6703109">{</span><span class="num" id="6703110">0x00</span><span class="op" id="6703114">}</span><span class="op" id="6703115">}</span><span class="op" id="6703116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703119">{</span><span class="num" id="6703120">127</span><span class="op" id="6703123">,</span>&nbsp;<span class="op" id="6703125">[</span><span class="op" id="6703126">]</span><span class="builtintype" id="6703127">byte</span><span class="op" id="6703131">{</span><span class="num" id="6703132">0x7F</span><span class="op" id="6703136">}</span><span class="op" id="6703137">}</span><span class="op" id="6703138">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703141">{</span><span class="num" id="6703142">128</span><span class="op" id="6703145">,</span>&nbsp;<span class="op" id="6703147">[</span><span class="op" id="6703148">]</span><span class="builtintype" id="6703149">byte</span><span class="op" id="6703153">{</span><span class="num" id="6703154">0x80</span><span class="op" id="6703158">,</span>&nbsp;<span class="num" id="6703160">0x00</span><span class="op" id="6703164">,</span>&nbsp;<span class="num" id="6703166">0x00</span><span class="op" id="6703170">,</span>&nbsp;<span class="num" id="6703172">0x80</span><span class="op" id="6703176">}</span><span class="op" id="6703177">}</span><span class="op" id="6703178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703181">{</span><span class="num" id="6703182">1000</span><span class="op" id="6703186">,</span>&nbsp;<span class="op" id="6703188">[</span><span class="op" id="6703189">]</span><span class="builtintype" id="6703190">byte</span><span class="op" id="6703194">{</span><span class="num" id="6703195">0x80</span><span class="op" id="6703199">,</span>&nbsp;<span class="num" id="6703201">0x00</span><span class="op" id="6703205">,</span>&nbsp;<span class="num" id="6703207">0x03</span><span class="op" id="6703211">,</span>&nbsp;<span class="num" id="6703213">0xE8</span><span class="op" id="6703217">}</span><span class="op" id="6703218">}</span><span class="op" id="6703219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703222">{</span><span class="num" id="6703223">33554431</span><span class="op" id="6703231">,</span>&nbsp;<span class="op" id="6703233">[</span><span class="op" id="6703234">]</span><span class="builtintype" id="6703235">byte</span><span class="op" id="6703239">{</span><span class="num" id="6703240">0x81</span><span class="op" id="6703244">,</span>&nbsp;<span class="num" id="6703246">0xFF</span><span class="op" id="6703250">,</span>&nbsp;<span class="num" id="6703252">0xFF</span><span class="op" id="6703256">,</span>&nbsp;<span class="num" id="6703258">0xFF</span><span class="op" id="6703262">}</span><span class="op" id="6703263">}</span><span class="op" id="6703264">,</span><br>
<span class="lineno"></span><span class="op" id="6703266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6703269">func</span>&nbsp;<span class="ident" id="6703274">TestSize</span><span class="op" id="6703282">(</span><span class="ident" id="6703283">t</span>&nbsp;<span class="op" id="6703285">*</span><span class="ident" id="6703286">testing</span><span class="op" id="6703293">.</span><span class="ident" id="6703294">T</span><span class="op" id="6703295">)</span>&nbsp;<span class="op" id="6703297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703300">b</span>&nbsp;<span class="op" id="6703302">:=</span>&nbsp;<span class="builtinfunc" id="6703305">make</span><span class="op" id="6703309">(</span><span class="op" id="6703310">[</span><span class="op" id="6703311">]</span><span class="builtintype" id="6703312">byte</span><span class="op" id="6703316">,</span>&nbsp;<span class="num" id="6703318">4</span><span class="op" id="6703319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6703322">for</span>&nbsp;<span class="ident" id="6703326">i</span><span class="op" id="6703327">,</span>&nbsp;<span class="ident" id="6703329">test</span>&nbsp;<span class="op" id="6703334">:=</span>&nbsp;<span class="keyword" id="6703337">range</span>&nbsp;<span class="ident" id="6703343">sizeTests</span>&nbsp;<span class="op" id="6703353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703357">n</span>&nbsp;<span class="op" id="6703359">:=</span>&nbsp;<span class="ident" id="6703362">encodeSize</span><span class="op" id="6703372">(</span><span class="ident" id="6703373">b</span><span class="op" id="6703374">,</span>&nbsp;<span class="ident" id="6703376">test</span><span class="op" id="6703380">.</span><span class="ident" id="6703381">size</span><span class="op" id="6703385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6703389">if</span>&nbsp;<span class="op" id="6703392">!</span><span class="ident" id="6703393">bytes</span><span class="op" id="6703398">.</span><span class="ident" id="6703399">Equal</span><span class="op" id="6703404">(</span><span class="ident" id="6703405">b</span><span class="op" id="6703406">[</span><span class="op" id="6703407">:</span><span class="ident" id="6703408">n</span><span class="op" id="6703409">]</span><span class="op" id="6703410">,</span>&nbsp;<span class="ident" id="6703412">test</span><span class="op" id="6703416">.</span><span class="ident" id="6703417">bytes</span><span class="op" id="6703422">)</span>&nbsp;<span class="op" id="6703424">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703429">t</span><span class="op" id="6703430">.</span><span class="ident" id="6703431">Errorf</span><span class="op" id="6703437">(</span><span class="string" id="6703438">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="6703466">,</span>&nbsp;<span class="ident" id="6703468">i</span><span class="op" id="6703469">,</span>&nbsp;<span class="ident" id="6703471">test</span><span class="op" id="6703475">.</span><span class="ident" id="6703476">bytes</span><span class="op" id="6703481">,</span>&nbsp;<span class="ident" id="6703483">b</span><span class="op" id="6703484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703492">size</span><span class="op" id="6703496">,</span>&nbsp;<span class="ident" id="6703498">n</span>&nbsp;<span class="op" id="6703500">:=</span>&nbsp;<span class="ident" id="6703503">readSize</span><span class="op" id="6703511">(</span><span class="ident" id="6703512">test</span><span class="op" id="6703516">.</span><span class="ident" id="6703517">bytes</span><span class="op" id="6703522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6703526">if</span>&nbsp;<span class="ident" id="6703529">size</span>&nbsp;<span class="op" id="6703534">!=</span>&nbsp;<span class="ident" id="6703537">test</span><span class="op" id="6703541">.</span><span class="ident" id="6703542">size</span>&nbsp;<span class="op" id="6703547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703552">t</span><span class="op" id="6703553">.</span><span class="ident" id="6703554">Errorf</span><span class="op" id="6703560">(</span><span class="string" id="6703561">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6703586">,</span>&nbsp;<span class="ident" id="6703588">i</span><span class="op" id="6703589">,</span>&nbsp;<span class="ident" id="6703591">test</span><span class="op" id="6703595">.</span><span class="ident" id="6703596">size</span><span class="op" id="6703600">,</span>&nbsp;<span class="ident" id="6703602">size</span><span class="op" id="6703606">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6703614">if</span>&nbsp;<span class="builtinfunc" id="6703617">len</span><span class="op" id="6703620">(</span><span class="ident" id="6703621">test</span><span class="op" id="6703625">.</span><span class="ident" id="6703626">bytes</span><span class="op" id="6703631">)</span>&nbsp;<span class="op" id="6703633">!=</span>&nbsp;<span class="ident" id="6703636">n</span>&nbsp;<span class="op" id="6703638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703643">t</span><span class="op" id="6703644">.</span><span class="ident" id="6703645">Errorf</span><span class="op" id="6703651">(</span><span class="string" id="6703652">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="6703686">,</span>&nbsp;<span class="ident" id="6703688">i</span><span class="op" id="6703689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703696">}</span><br>
<span class="lineno">40</span><span class="op" id="6703698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6703701">var</span>&nbsp;<span class="ident" id="6703705">streamTests</span>&nbsp;<span class="op" id="6703717">=</span>&nbsp;<span class="op" id="6703719">[</span><span class="op" id="6703720">]</span><span class="keyword" id="6703721">struct</span>&nbsp;<span class="op" id="6703728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703731">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6703739">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703747">recType</span>&nbsp;<span class="ident" id="6703755">recType</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703764">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6703772">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703780">content</span>&nbsp;<span class="op" id="6703788">[</span><span class="op" id="6703789">]</span><span class="builtintype" id="6703790">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703796">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6703804">[</span><span class="op" id="6703805">]</span><span class="builtintype" id="6703806">byte</span><br>
<span class="lineno"></span><span class="op" id="6703811">}</span><span class="op" id="6703812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703815">{</span><span class="string" id="6703816">&#34;single&nbsp;record&#34;</span><span class="op" id="6703831">,</span>&nbsp;<span class="ident" id="6703833">typeStdout</span><span class="op" id="6703843">,</span>&nbsp;<span class="num" id="6703845">1</span><span class="op" id="6703846">,</span>&nbsp;<span class="ident" id="6703848">nil</span><span class="op" id="6703851">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703855">[</span><span class="op" id="6703856">]</span><span class="builtintype" id="6703857">byte</span><span class="op" id="6703861">{</span><span class="num" id="6703862">1</span><span class="op" id="6703863">,</span>&nbsp;<span class="builtintype" id="6703865">byte</span><span class="op" id="6703869">(</span><span class="ident" id="6703870">typeStdout</span><span class="op" id="6703880">)</span><span class="op" id="6703881">,</span>&nbsp;<span class="num" id="6703883">0</span><span class="op" id="6703884">,</span>&nbsp;<span class="num" id="6703886">1</span><span class="op" id="6703887">,</span>&nbsp;<span class="num" id="6703889">0</span><span class="op" id="6703890">,</span>&nbsp;<span class="num" id="6703892">0</span><span class="op" id="6703893">,</span>&nbsp;<span class="num" id="6703895">0</span><span class="op" id="6703896">,</span>&nbsp;<span class="num" id="6703898">0</span><span class="op" id="6703899">}</span><span class="op" id="6703900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703903">}</span><span class="op" id="6703904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6703907">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703960">{</span><span class="string" id="6703961">&#34;two&nbsp;records&#34;</span><span class="op" id="6703974">,</span>&nbsp;<span class="ident" id="6703976">typeStdin</span><span class="op" id="6703985">,</span>&nbsp;<span class="num" id="6703987">300</span><span class="op" id="6703990">,</span>&nbsp;<span class="builtinfunc" id="6703992">make</span><span class="op" id="6703996">(</span><span class="op" id="6703997">[</span><span class="op" id="6703998">]</span><span class="builtintype" id="6703999">byte</span><span class="op" id="6704003">,</span>&nbsp;<span class="num" id="6704005">66000</span><span class="op" id="6704010">)</span><span class="op" id="6704011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704015">bytes</span><span class="op" id="6704020">.</span><span class="ident" id="6704021">Join</span><span class="op" id="6704025">(</span><span class="op" id="6704026">[</span><span class="op" id="6704027">]</span><span class="op" id="6704028">[</span><span class="op" id="6704029">]</span><span class="builtintype" id="6704030">byte</span><span class="op" id="6704034">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6704039">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6704073">{</span><span class="num" id="6704074">1</span><span class="op" id="6704075">,</span>&nbsp;<span class="builtintype" id="6704077">byte</span><span class="op" id="6704081">(</span><span class="ident" id="6704082">typeStdin</span><span class="op" id="6704091">)</span><span class="op" id="6704092">,</span>&nbsp;<span class="num" id="6704094">0x01</span><span class="op" id="6704098">,</span>&nbsp;<span class="num" id="6704100">0x2C</span><span class="op" id="6704104">,</span>&nbsp;<span class="num" id="6704106">0xFF</span><span class="op" id="6704110">,</span>&nbsp;<span class="num" id="6704112">0xFF</span><span class="op" id="6704116">,</span>&nbsp;<span class="num" id="6704118">1</span><span class="op" id="6704119">,</span>&nbsp;<span class="num" id="6704121">0</span><span class="op" id="6704122">}</span><span class="op" id="6704123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6704128">make</span><span class="op" id="6704132">(</span><span class="op" id="6704133">[</span><span class="op" id="6704134">]</span><span class="builtintype" id="6704135">byte</span><span class="op" id="6704139">,</span>&nbsp;<span class="num" id="6704141">65536</span><span class="op" id="6704146">)</span><span class="op" id="6704147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6704152">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6704180">{</span><span class="num" id="6704181">1</span><span class="op" id="6704182">,</span>&nbsp;<span class="builtintype" id="6704184">byte</span><span class="op" id="6704188">(</span><span class="ident" id="6704189">typeStdin</span><span class="op" id="6704198">)</span><span class="op" id="6704199">,</span>&nbsp;<span class="num" id="6704201">0x01</span><span class="op" id="6704205">,</span>&nbsp;<span class="num" id="6704207">0x2C</span><span class="op" id="6704211">,</span>&nbsp;<span class="num" id="6704213">0x01</span><span class="op" id="6704217">,</span>&nbsp;<span class="num" id="6704219">0xD1</span><span class="op" id="6704223">,</span>&nbsp;<span class="num" id="6704225">7</span><span class="op" id="6704226">,</span>&nbsp;<span class="num" id="6704228">0</span><span class="op" id="6704229">}</span><span class="op" id="6704230">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6704235">make</span><span class="op" id="6704239">(</span><span class="op" id="6704240">[</span><span class="op" id="6704241">]</span><span class="builtintype" id="6704242">byte</span><span class="op" id="6704246">,</span>&nbsp;<span class="num" id="6704248">472</span><span class="op" id="6704251">)</span><span class="op" id="6704252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6704257">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6704291">{</span><span class="num" id="6704292">1</span><span class="op" id="6704293">,</span>&nbsp;<span class="builtintype" id="6704295">byte</span><span class="op" id="6704299">(</span><span class="ident" id="6704300">typeStdin</span><span class="op" id="6704309">)</span><span class="op" id="6704310">,</span>&nbsp;<span class="num" id="6704312">0x01</span><span class="op" id="6704316">,</span>&nbsp;<span class="num" id="6704318">0x2C</span><span class="op" id="6704322">,</span>&nbsp;<span class="num" id="6704324">0</span><span class="op" id="6704325">,</span>&nbsp;<span class="num" id="6704327">0</span><span class="op" id="6704328">,</span>&nbsp;<span class="num" id="6704330">0</span><span class="op" id="6704331">,</span>&nbsp;<span class="num" id="6704333">0</span><span class="op" id="6704334">}</span><span class="op" id="6704335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6704339">}</span><span class="op" id="6704340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704345">nil</span><span class="op" id="6704348">)</span><span class="op" id="6704349">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6704352">}</span><span class="op" id="6704353">,</span><br>
<span class="lineno"></span><span class="op" id="6704355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6704358">type</span>&nbsp;<span class="ident" id="6704363">nilCloser</span>&nbsp;<span class="keyword" id="6704373">struct</span>&nbsp;<span class="op" id="6704380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704383">io</span><span class="op" id="6704385">.</span><span class="ident" id="6704386">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="6704397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6704400">func</span>&nbsp;<span class="op" id="6704405">(</span><span class="ident" id="6704406">c</span>&nbsp;<span class="op" id="6704408">*</span><span class="ident" id="6704409">nilCloser</span><span class="op" id="6704418">)</span>&nbsp;<span class="ident" id="6704420">Close</span><span class="op" id="6704425">(</span><span class="op" id="6704426">)</span>&nbsp;<span class="builtintype" id="6704428">error</span>&nbsp;<span class="op" id="6704434">{</span>&nbsp;<span class="keyword" id="6704436">return</span>&nbsp;<span class="ident" id="6704443">nil</span>&nbsp;<span class="op" id="6704447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6704450">func</span>&nbsp;<span class="ident" id="6704455">TestStreams</span><span class="op" id="6704466">(</span><span class="ident" id="6704467">t</span>&nbsp;<span class="op" id="6704469">*</span><span class="ident" id="6704470">testing</span><span class="op" id="6704477">.</span><span class="ident" id="6704478">T</span><span class="op" id="6704479">)</span>&nbsp;<span class="op" id="6704481">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6704484">var</span>&nbsp;<span class="ident" id="6704488">rec</span>&nbsp;<span class="ident" id="6704492">record</span><br>
<span class="lineno"></span><span class="ident" id="6704499">outer</span><span class="op" id="6704504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6704507">for</span>&nbsp;<span class="ident" id="6704511">_</span><span class="op" id="6704512">,</span>&nbsp;<span class="ident" id="6704514">test</span>&nbsp;<span class="op" id="6704519">:=</span>&nbsp;<span class="keyword" id="6704522">range</span>&nbsp;<span class="ident" id="6704528">streamTests</span>&nbsp;<span class="op" id="6704540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704544">buf</span>&nbsp;<span class="op" id="6704548">:=</span>&nbsp;<span class="ident" id="6704551">bytes</span><span class="op" id="6704556">.</span><span class="ident" id="6704557">NewBuffer</span><span class="op" id="6704566">(</span><span class="ident" id="6704567">test</span><span class="op" id="6704571">.</span><span class="ident" id="6704572">raw</span><span class="op" id="6704575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6704579">var</span>&nbsp;<span class="ident" id="6704583">content</span>&nbsp;<span class="op" id="6704591">[</span><span class="op" id="6704592">]</span><span class="builtintype" id="6704593">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6704600">for</span>&nbsp;<span class="ident" id="6704604">buf</span><span class="op" id="6704607">.</span><span class="ident" id="6704608">Len</span><span class="op" id="6704611">(</span><span class="op" id="6704612">)</span>&nbsp;<span class="op" id="6704614">&gt;</span>&nbsp;<span class="num" id="6704616">0</span>&nbsp;<span class="op" id="6704618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6704623">if</span>&nbsp;<span class="ident" id="6704626">err</span>&nbsp;<span class="op" id="6704630">:=</span>&nbsp;<span class="ident" id="6704633">rec</span><span class="op" id="6704636">.</span><span class="ident" id="6704637">read</span><span class="op" id="6704641">(</span><span class="ident" id="6704642">buf</span><span class="op" id="6704645">)</span><span class="op" id="6704646">;</span>&nbsp;<span class="ident" id="6704648">err</span>&nbsp;<span class="op" id="6704652">!=</span>&nbsp;<span class="ident" id="6704655">nil</span>&nbsp;<span class="op" id="6704659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704665">t</span><span class="op" id="6704666">.</span><span class="ident" id="6704667">Errorf</span><span class="op" id="6704673">(</span><span class="string" id="6704674">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="6704704">,</span>&nbsp;<span class="ident" id="6704706">test</span><span class="op" id="6704710">.</span><span class="ident" id="6704711">desc</span><span class="op" id="6704715">,</span>&nbsp;<span class="ident" id="6704717">err</span><span class="op" id="6704720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6704726">continue</span>&nbsp;<span class="ident" id="6704735">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6704744">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704749">content</span>&nbsp;<span class="op" id="6704757">=</span>&nbsp;<span class="builtinfunc" id="6704759">append</span><span class="op" id="6704765">(</span><span class="ident" id="6704766">content</span><span class="op" id="6704773">,</span>&nbsp;<span class="ident" id="6704775">rec</span><span class="op" id="6704778">.</span><span class="ident" id="6704779">content</span><span class="op" id="6704786">(</span><span class="op" id="6704787">)</span><span class="op" id="6704788">...</span><span class="op" id="6704791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6704795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6704799">if</span>&nbsp;<span class="ident" id="6704802">rec</span><span class="op" id="6704805">.</span><span class="ident" id="6704806">h</span><span class="op" id="6704807">.</span><span class="ident" id="6704808">Type</span>&nbsp;<span class="op" id="6704813">!=</span>&nbsp;<span class="ident" id="6704816">test</span><span class="op" id="6704820">.</span><span class="ident" id="6704821">recType</span>&nbsp;<span class="op" id="6704829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704834">t</span><span class="op" id="6704835">.</span><span class="ident" id="6704836">Errorf</span><span class="op" id="6704842">(</span><span class="string" id="6704843">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6704872">,</span>&nbsp;<span class="ident" id="6704874">test</span><span class="op" id="6704878">.</span><span class="ident" id="6704879">desc</span><span class="op" id="6704883">,</span>&nbsp;<span class="ident" id="6704885">rec</span><span class="op" id="6704888">.</span><span class="ident" id="6704889">h</span><span class="op" id="6704890">.</span><span class="ident" id="6704891">Type</span><span class="op" id="6704895">,</span>&nbsp;<span class="ident" id="6704897">test</span><span class="op" id="6704901">.</span><span class="ident" id="6704902">recType</span><span class="op" id="6704909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6704914">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6704925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6704929">if</span>&nbsp;<span class="ident" id="6704932">rec</span><span class="op" id="6704935">.</span><span class="ident" id="6704936">h</span><span class="op" id="6704937">.</span><span class="ident" id="6704938">Id</span>&nbsp;<span class="op" id="6704941">!=</span>&nbsp;<span class="ident" id="6704944">test</span><span class="op" id="6704948">.</span><span class="ident" id="6704949">reqId</span>&nbsp;<span class="op" id="6704955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704960">t</span><span class="op" id="6704961">.</span><span class="ident" id="6704962">Errorf</span><span class="op" id="6704968">(</span><span class="string" id="6704969">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6705004">,</span>&nbsp;<span class="ident" id="6705006">test</span><span class="op" id="6705010">.</span><span class="ident" id="6705011">desc</span><span class="op" id="6705015">,</span>&nbsp;<span class="ident" id="6705017">rec</span><span class="op" id="6705020">.</span><span class="ident" id="6705021">h</span><span class="op" id="6705022">.</span><span class="ident" id="6705023">Id</span><span class="op" id="6705025">,</span>&nbsp;<span class="ident" id="6705027">test</span><span class="op" id="6705031">.</span><span class="ident" id="6705032">reqId</span><span class="op" id="6705037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6705042">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6705053">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6705057">if</span>&nbsp;<span class="op" id="6705060">!</span><span class="ident" id="6705061">bytes</span><span class="op" id="6705066">.</span><span class="ident" id="6705067">Equal</span><span class="op" id="6705072">(</span><span class="ident" id="6705073">content</span><span class="op" id="6705080">,</span>&nbsp;<span class="ident" id="6705082">test</span><span class="op" id="6705086">.</span><span class="ident" id="6705087">content</span><span class="op" id="6705094">)</span>&nbsp;<span class="op" id="6705096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6705101">t</span><span class="op" id="6705102">.</span><span class="ident" id="6705103">Errorf</span><span class="op" id="6705109">(</span><span class="string" id="6705110">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="6705134">,</span>&nbsp;<span class="ident" id="6705136">test</span><span class="op" id="6705140">.</span><span class="ident" id="6705141">desc</span><span class="op" id="6705145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6705150">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6705161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6705165">buf</span><span class="op" id="6705168">.</span><span class="ident" id="6705169">Reset</span><span class="op" id="6705174">(</span><span class="op" id="6705175">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6705179">c</span>&nbsp;<span class="op" id="6705181">:=</span>&nbsp;<span class="ident" id="6705184">newConn</span><span class="op" id="6705191">(</span><span class="op" id="6705192">&amp;</span><span class="ident" id="6705193">nilCloser</span><span class="op" id="6705202">{</span><span class="ident" id="6705203">buf</span><span class="op" id="6705206">}</span><span class="op" id="6705207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6705211">w</span>&nbsp;<span class="op" id="6705213">:=</span>&nbsp;<span class="ident" id="6705216">newWriter</span><span class="op" id="6705225">(</span><span class="ident" id="6705226">c</span><span class="op" id="6705227">,</span>&nbsp;<span class="ident" id="6705229">test</span><span class="op" id="6705233">.</span><span class="ident" id="6705234">recType</span><span class="op" id="6705241">,</span>&nbsp;<span class="ident" id="6705243">test</span><span class="op" id="6705247">.</span><span class="ident" id="6705248">reqId</span><span class="op" id="6705253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6705257">if</span>&nbsp;<span class="ident" id="6705260">_</span><span class="op" id="6705261">,</span>&nbsp;<span class="ident" id="6705263">err</span>&nbsp;<span class="op" id="6705267">:=</span>&nbsp;<span class="ident" id="6705270">w</span><span class="op" id="6705271">.</span><span class="ident" id="6705272">Write</span><span class="op" id="6705277">(</span><span class="ident" id="6705278">test</span><span class="op" id="6705282">.</span><span class="ident" id="6705283">content</span><span class="op" id="6705290">)</span><span class="op" id="6705291">;</span>&nbsp;<span class="ident" id="6705293">err</span>&nbsp;<span class="op" id="6705297">!=</span>&nbsp;<span class="ident" id="6705300">nil</span>&nbsp;<span class="op" id="6705304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6705309">t</span><span class="op" id="6705310">.</span><span class="ident" id="6705311">Errorf</span><span class="op" id="6705317">(</span><span class="string" id="6705318">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="6705348">,</span>&nbsp;<span class="ident" id="6705350">test</span><span class="op" id="6705354">.</span><span class="ident" id="6705355">desc</span><span class="op" id="6705359">,</span>&nbsp;<span class="ident" id="6705361">err</span><span class="op" id="6705364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6705369">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6705380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6705384">if</span>&nbsp;<span class="ident" id="6705387">err</span>&nbsp;<span class="op" id="6705391">:=</span>&nbsp;<span class="ident" id="6705394">w</span><span class="op" id="6705395">.</span><span class="ident" id="6705396">Close</span><span class="op" id="6705401">(</span><span class="op" id="6705402">)</span><span class="op" id="6705403">;</span>&nbsp;<span class="ident" id="6705405">err</span>&nbsp;<span class="op" id="6705409">!=</span>&nbsp;<span class="ident" id="6705412">nil</span>&nbsp;<span class="op" id="6705416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6705421">t</span><span class="op" id="6705422">.</span><span class="ident" id="6705423">Errorf</span><span class="op" id="6705429">(</span><span class="string" id="6705430">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="6705460">,</span>&nbsp;<span class="ident" id="6705462">test</span><span class="op" id="6705466">.</span><span class="ident" id="6705467">desc</span><span class="op" id="6705471">,</span>&nbsp;<span class="ident" id="6705473">err</span><span class="op" id="6705476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6705481">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6705492">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6705496">if</span>&nbsp;<span class="op" id="6705499">!</span><span class="ident" id="6705500">bytes</span><span class="op" id="6705505">.</span><span class="ident" id="6705506">Equal</span><span class="op" id="6705511">(</span><span class="ident" id="6705512">buf</span><span class="op" id="6705515">.</span><span class="ident" id="6705516">Bytes</span><span class="op" id="6705521">(</span><span class="op" id="6705522">)</span><span class="op" id="6705523">,</span>&nbsp;<span class="ident" id="6705525">test</span><span class="op" id="6705529">.</span><span class="ident" id="6705530">raw</span><span class="op" id="6705533">)</span>&nbsp;<span class="op" id="6705535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6705540">t</span><span class="op" id="6705541">.</span><span class="ident" id="6705542">Errorf</span><span class="op" id="6705548">(</span><span class="string" id="6705549">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="6705574">,</span>&nbsp;<span class="ident" id="6705576">test</span><span class="op" id="6705580">.</span><span class="ident" id="6705581">desc</span><span class="op" id="6705585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6705589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6705592">}</span><br>
<span class="lineno"></span><span class="op" id="6705594">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="6705597">type</span>&nbsp;<span class="ident" id="6705602">writeOnlyConn</span>&nbsp;<span class="keyword" id="6705616">struct</span>&nbsp;<span class="op" id="6705623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6705626">buf</span>&nbsp;<span class="op" id="6705630">[</span><span class="op" id="6705631">]</span><span class="builtintype" id="6705632">byte</span><br>
<span class="lineno"></span><span class="op" id="6705637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6705640">func</span>&nbsp;<span class="op" id="6705645">(</span><span class="ident" id="6705646">c</span>&nbsp;<span class="op" id="6705648">*</span><span class="ident" id="6705649">writeOnlyConn</span><span class="op" id="6705662">)</span>&nbsp;<span class="ident" id="6705664">Write</span><span class="op" id="6705669">(</span><span class="ident" id="6705670">p</span>&nbsp;<span class="op" id="6705672">[</span><span class="op" id="6705673">]</span><span class="builtintype" id="6705674">byte</span><span class="op" id="6705678">)</span>&nbsp;<span class="op" id="6705680">(</span><span class="builtintype" id="6705681">int</span><span class="op" id="6705684">,</span>&nbsp;<span class="builtintype" id="6705686">error</span><span class="op" id="6705691">)</span>&nbsp;<span class="op" id="6705693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6705696">c</span><span class="op" id="6705697">.</span><span class="ident" id="6705698">buf</span>&nbsp;<span class="op" id="6705702">=</span>&nbsp;<span class="builtinfunc" id="6705704">append</span><span class="op" id="6705710">(</span><span class="ident" id="6705711">c</span><span class="op" id="6705712">.</span><span class="ident" id="6705713">buf</span><span class="op" id="6705716">,</span>&nbsp;<span class="ident" id="6705718">p</span><span class="op" id="6705719">...</span><span class="op" id="6705722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6705725">return</span>&nbsp;<span class="builtinfunc" id="6705732">len</span><span class="op" id="6705735">(</span><span class="ident" id="6705736">p</span><span class="op" id="6705737">)</span><span class="op" id="6705738">,</span>&nbsp;<span class="ident" id="6705740">nil</span><br>
<span class="lineno"></span><span class="op" id="6705744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="6705747">func</span>&nbsp;<span class="op" id="6705752">(</span><span class="ident" id="6705753">c</span>&nbsp;<span class="op" id="6705755">*</span><span class="ident" id="6705756">writeOnlyConn</span><span class="op" id="6705769">)</span>&nbsp;<span class="ident" id="6705771">Read</span><span class="op" id="6705775">(</span><span class="ident" id="6705776">p</span>&nbsp;<span class="op" id="6705778">[</span><span class="op" id="6705779">]</span><span class="builtintype" id="6705780">byte</span><span class="op" id="6705784">)</span>&nbsp;<span class="op" id="6705786">(</span><span class="builtintype" id="6705787">int</span><span class="op" id="6705790">,</span>&nbsp;<span class="builtintype" id="6705792">error</span><span class="op" id="6705797">)</span>&nbsp;<span class="op" id="6705799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6705802">return</span>&nbsp;<span class="num" id="6705809">0</span><span class="op" id="6705810">,</span>&nbsp;<span class="ident" id="6705812">errors</span><span class="op" id="6705818">.</span><span class="ident" id="6705819">New</span><span class="op" id="6705822">(</span><span class="string" id="6705823">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="6705843">)</span><br>
<span class="lineno"></span><span class="op" id="6705845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6705848">func</span>&nbsp;<span class="op" id="6705853">(</span><span class="ident" id="6705854">c</span>&nbsp;<span class="op" id="6705856">*</span><span class="ident" id="6705857">writeOnlyConn</span><span class="op" id="6705870">)</span>&nbsp;<span class="ident" id="6705872">Close</span><span class="op" id="6705877">(</span><span class="op" id="6705878">)</span>&nbsp;<span class="builtintype" id="6705880">error</span>&nbsp;<span class="op" id="6705886">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6705889">return</span>&nbsp;<span class="ident" id="6705896">nil</span><br>
<span class="lineno"></span><span class="op" id="6705900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6705903">func</span>&nbsp;<span class="ident" id="6705908">TestGetValues</span><span class="op" id="6705921">(</span><span class="ident" id="6705922">t</span>&nbsp;<span class="op" id="6705924">*</span><span class="ident" id="6705925">testing</span><span class="op" id="6705932">.</span><span class="ident" id="6705933">T</span><span class="op" id="6705934">)</span>&nbsp;<span class="op" id="6705936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6705939">var</span>&nbsp;<span class="ident" id="6705943">rec</span>&nbsp;<span class="ident" id="6705947">record</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6705955">rec</span><span class="op" id="6705958">.</span><span class="ident" id="6705959">h</span><span class="op" id="6705960">.</span><span class="ident" id="6705961">Type</span>&nbsp;<span class="op" id="6705966">=</span>&nbsp;<span class="ident" id="6705968">typeGetValues</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6705984">wc</span>&nbsp;<span class="op" id="6705987">:=</span>&nbsp;<span class="builtinfunc" id="6705990">new</span><span class="op" id="6705993">(</span><span class="ident" id="6705994">writeOnlyConn</span><span class="op" id="6706007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706010">c</span>&nbsp;<span class="op" id="6706012">:=</span>&nbsp;<span class="ident" id="6706015">newChild</span><span class="op" id="6706023">(</span><span class="ident" id="6706024">wc</span><span class="op" id="6706026">,</span>&nbsp;<span class="ident" id="6706028">nil</span><span class="op" id="6706031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706034">err</span>&nbsp;<span class="op" id="6706038">:=</span>&nbsp;<span class="ident" id="6706041">c</span><span class="op" id="6706042">.</span><span class="ident" id="6706043">handleRecord</span><span class="op" id="6706055">(</span><span class="op" id="6706056">&amp;</span><span class="ident" id="6706057">rec</span><span class="op" id="6706060">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6706063">if</span>&nbsp;<span class="ident" id="6706066">err</span>&nbsp;<span class="op" id="6706070">!=</span>&nbsp;<span class="ident" id="6706073">nil</span>&nbsp;<span class="op" id="6706077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706081">t</span><span class="op" id="6706082">.</span><span class="ident" id="6706083">Fatalf</span><span class="op" id="6706089">(</span><span class="string" id="6706090">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="6706108">,</span>&nbsp;<span class="ident" id="6706110">err</span><span class="op" id="6706113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6706120">const</span>&nbsp;<span class="ident" id="6706126">want</span>&nbsp;<span class="op" id="6706131">=</span>&nbsp;<span class="string" id="6706133">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="6706166">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706170">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="6706197">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706201">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6706259">if</span>&nbsp;<span class="ident" id="6706262">got</span>&nbsp;<span class="op" id="6706266">:=</span>&nbsp;<span class="builtintype" id="6706269">string</span><span class="op" id="6706275">(</span><span class="ident" id="6706276">wc</span><span class="op" id="6706278">.</span><span class="ident" id="6706279">buf</span><span class="op" id="6706282">)</span><span class="op" id="6706283">;</span>&nbsp;<span class="ident" id="6706285">got</span>&nbsp;<span class="op" id="6706289">!=</span>&nbsp;<span class="ident" id="6706292">want</span>&nbsp;<span class="op" id="6706297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706301">t</span><span class="op" id="6706302">.</span><span class="ident" id="6706303">Errorf</span><span class="op" id="6706309">(</span><span class="string" id="6706310">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="6706332">,</span>&nbsp;<span class="ident" id="6706334">got</span><span class="op" id="6706337">,</span>&nbsp;<span class="ident" id="6706339">want</span><span class="op" id="6706343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706346">}</span><br>
<span class="lineno">150</span><span class="op" id="6706348">}</span>
</div>
</body>
</html>
