<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html" class="current">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5665808">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5665863">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5665917">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5665968">package</span>&nbsp;<span class="ident" id="5665976">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5665981">import</span>&nbsp;<span class="op" id="5665988">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5665991">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5666003">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5666013">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5666020">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5666026">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5666037">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5666045">&#34;sync/atomic&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5666060">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5666071">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5666086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5666089">//&nbsp;userTypeInfo&nbsp;stores&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;a&nbsp;type&nbsp;the&nbsp;user&nbsp;has&nbsp;handed</span><br>
<span class="lineno">20</span><span class="comment" id="5666171">//&nbsp;to&nbsp;the&nbsp;package.&nbsp;&nbsp;It&#39;s&nbsp;computed&nbsp;once&nbsp;and&nbsp;stored&nbsp;in&nbsp;a&nbsp;map&nbsp;keyed&nbsp;by&nbsp;reflection</span><br>
<span class="lineno"></span><span class="comment" id="5666250">//&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5666259">type</span>&nbsp;<span class="ident" id="5666264">userTypeInfo</span>&nbsp;<span class="keyword" id="5666277">struct</span>&nbsp;<span class="op" id="5666284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666287">user</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666299">reflect</span><span class="op" id="5666306">.</span><span class="ident" id="5666307">Type</span>&nbsp;<span class="comment" id="5666312">//&nbsp;the&nbsp;type&nbsp;the&nbsp;user&nbsp;handed&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666344">base</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666356">reflect</span><span class="op" id="5666363">.</span><span class="ident" id="5666364">Type</span>&nbsp;<span class="comment" id="5666369">//&nbsp;the&nbsp;base&nbsp;type&nbsp;after&nbsp;all&nbsp;indirections</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666410">indir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5666422">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666435">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666485">externalEnc</span>&nbsp;<span class="builtintype" id="5666497">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666510">//&nbsp;xGob,&nbsp;xBinary,&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666538">externalDec</span>&nbsp;<span class="builtintype" id="5666550">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666563">//&nbsp;xGob,&nbsp;xBinary&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666590">encIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5666602">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666615">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666686">decIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5666698">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666711">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno">30</span><span class="op" id="5666781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5666784">//&nbsp;externalEncoding&nbsp;bits</span><br>
<span class="lineno"></span><span class="keyword" id="5666809">const</span>&nbsp;<span class="op" id="5666815">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666818">xGob</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5666826">=</span>&nbsp;<span class="num" id="5666828">1</span>&nbsp;<span class="op" id="5666830">+</span>&nbsp;<span class="ident" id="5666832">iota</span>&nbsp;<span class="comment" id="5666837">//&nbsp;GobEncoder&nbsp;or&nbsp;GobDecoder</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666866">xBinary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666885">//&nbsp;encoding.BinaryMarshaler&nbsp;or&nbsp;encoding.BinaryUnmarshaler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666944">xText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666963">//&nbsp;encoding.TextMarshaler&nbsp;or&nbsp;encoding.TextUnmarshaler</span><br>
<span class="lineno"></span><span class="op" id="5667017">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5667020">var</span>&nbsp;<span class="op" id="5667024">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5667027">//&nbsp;Protected&nbsp;by&nbsp;an&nbsp;RWMutex&nbsp;because&nbsp;we&nbsp;read&nbsp;it&nbsp;a&nbsp;lot&nbsp;and&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5667090">//&nbsp;it&nbsp;only&nbsp;when&nbsp;we&nbsp;see&nbsp;a&nbsp;new&nbsp;type,&nbsp;typically&nbsp;when&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667152">userTypeLock</span>&nbsp;&nbsp;<span class="ident" id="5667166">sync</span><span class="op" id="5667170">.</span><span class="ident" id="5667171">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667180">userTypeCache</span>&nbsp;<span class="op" id="5667194">=</span>&nbsp;<span class="builtinfunc" id="5667196">make</span><span class="op" id="5667200">(</span><span class="keyword" id="5667201">map</span><span class="op" id="5667204">[</span><span class="ident" id="5667205">reflect</span><span class="op" id="5667212">.</span><span class="ident" id="5667213">Type</span><span class="op" id="5667217">]</span><span class="op" id="5667218">*</span><span class="ident" id="5667219">userTypeInfo</span><span class="op" id="5667231">)</span><br>
<span class="lineno"></span><span class="op" id="5667233">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5667236">//&nbsp;validType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="5667324">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;err&nbsp;will&nbsp;be&nbsp;non-nil.&nbsp;&nbsp;To&nbsp;be&nbsp;used&nbsp;when&nbsp;the&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="5667414">//&nbsp;is&nbsp;not&nbsp;set&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="5667432">func</span>&nbsp;<span class="ident" id="5667437">validUserType</span><span class="op" id="5667450">(</span><span class="ident" id="5667451">rt</span>&nbsp;<span class="ident" id="5667454">reflect</span><span class="op" id="5667461">.</span><span class="ident" id="5667462">Type</span><span class="op" id="5667466">)</span>&nbsp;<span class="op" id="5667468">(</span><span class="ident" id="5667469">ut</span>&nbsp;<span class="op" id="5667472">*</span><span class="ident" id="5667473">userTypeInfo</span><span class="op" id="5667485">,</span>&nbsp;<span class="ident" id="5667487">err</span>&nbsp;<span class="builtintype" id="5667491">error</span><span class="op" id="5667496">)</span>&nbsp;<span class="op" id="5667498">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667501">userTypeLock</span><span class="op" id="5667513">.</span><span class="ident" id="5667514">RLock</span><span class="op" id="5667519">(</span><span class="op" id="5667520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667523">ut</span>&nbsp;<span class="op" id="5667526">=</span>&nbsp;<span class="ident" id="5667528">userTypeCache</span><span class="op" id="5667541">[</span><span class="ident" id="5667542">rt</span><span class="op" id="5667544">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667547">userTypeLock</span><span class="op" id="5667559">.</span><span class="ident" id="5667560">RUnlock</span><span class="op" id="5667567">(</span><span class="op" id="5667568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667571">if</span>&nbsp;<span class="ident" id="5667574">ut</span>&nbsp;<span class="op" id="5667577">!=</span>&nbsp;<span class="builtintype" id="5667580">nil</span>&nbsp;<span class="op" id="5667584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667588">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5667596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5667599">//&nbsp;Now&nbsp;set&nbsp;the&nbsp;value&nbsp;under&nbsp;the&nbsp;write&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667643">userTypeLock</span><span class="op" id="5667655">.</span><span class="ident" id="5667656">Lock</span><span class="op" id="5667660">(</span><span class="op" id="5667661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667664">defer</span>&nbsp;<span class="ident" id="5667670">userTypeLock</span><span class="op" id="5667682">.</span><span class="ident" id="5667683">Unlock</span><span class="op" id="5667689">(</span><span class="op" id="5667690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667693">if</span>&nbsp;<span class="ident" id="5667696">ut</span>&nbsp;<span class="op" id="5667699">=</span>&nbsp;<span class="ident" id="5667701">userTypeCache</span><span class="op" id="5667714">[</span><span class="ident" id="5667715">rt</span><span class="op" id="5667717">]</span><span class="op" id="5667718">;</span>&nbsp;<span class="ident" id="5667720">ut</span>&nbsp;<span class="op" id="5667723">!=</span>&nbsp;<span class="builtintype" id="5667726">nil</span>&nbsp;<span class="op" id="5667730">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5667734">//&nbsp;Lost&nbsp;the&nbsp;race;&nbsp;not&nbsp;a&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667769">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5667777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667780">ut</span>&nbsp;<span class="op" id="5667783">=</span>&nbsp;<span class="builtinfunc" id="5667785">new</span><span class="op" id="5667788">(</span><span class="ident" id="5667789">userTypeInfo</span><span class="op" id="5667801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667804">ut</span><span class="op" id="5667806">.</span><span class="ident" id="5667807">base</span>&nbsp;<span class="op" id="5667812">=</span>&nbsp;<span class="ident" id="5667814">rt</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667818">ut</span><span class="op" id="5667820">.</span><span class="ident" id="5667821">user</span>&nbsp;<span class="op" id="5667826">=</span>&nbsp;<span class="ident" id="5667828">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5667832">//&nbsp;A&nbsp;type&nbsp;that&nbsp;is&nbsp;just&nbsp;a&nbsp;cycle&nbsp;of&nbsp;pointers&nbsp;(such&nbsp;as&nbsp;type&nbsp;T&nbsp;*T)&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5667903">//&nbsp;be&nbsp;represented&nbsp;in&nbsp;gobs,&nbsp;which&nbsp;need&nbsp;some&nbsp;concrete&nbsp;data.&nbsp;&nbsp;We&nbsp;use&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5667972">//&nbsp;cycle&nbsp;detection&nbsp;algorithm&nbsp;from&nbsp;Knuth,&nbsp;Vol&nbsp;2,&nbsp;Section&nbsp;3.1,&nbsp;Ex&nbsp;6,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5668040">//&nbsp;pp&nbsp;539-540.&nbsp;&nbsp;As&nbsp;we&nbsp;step&nbsp;through&nbsp;indirections,&nbsp;run&nbsp;another&nbsp;type&nbsp;at</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5668110">//&nbsp;half&nbsp;speed.&nbsp;If&nbsp;they&nbsp;meet&nbsp;up,&nbsp;there&#39;s&nbsp;a&nbsp;cycle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668160">slowpoke</span>&nbsp;<span class="op" id="5668169">:=</span>&nbsp;<span class="ident" id="5668172">ut</span><span class="op" id="5668174">.</span><span class="ident" id="5668175">base</span>&nbsp;<span class="comment" id="5668180">//&nbsp;walks&nbsp;half&nbsp;as&nbsp;fast&nbsp;as&nbsp;ut.base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668214">for</span>&nbsp;<span class="op" id="5668218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668222">pt</span>&nbsp;<span class="op" id="5668225">:=</span>&nbsp;<span class="ident" id="5668228">ut</span><span class="op" id="5668230">.</span><span class="ident" id="5668231">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668238">if</span>&nbsp;<span class="ident" id="5668241">pt</span><span class="op" id="5668243">.</span><span class="ident" id="5668244">Kind</span><span class="op" id="5668248">(</span><span class="op" id="5668249">)</span>&nbsp;<span class="op" id="5668251">!=</span>&nbsp;<span class="ident" id="5668254">reflect</span><span class="op" id="5668261">.</span><span class="ident" id="5668262">Ptr</span>&nbsp;<span class="op" id="5668266">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668271">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5668279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668283">ut</span><span class="op" id="5668285">.</span><span class="ident" id="5668286">base</span>&nbsp;<span class="op" id="5668291">=</span>&nbsp;<span class="ident" id="5668293">pt</span><span class="op" id="5668295">.</span><span class="ident" id="5668296">Elem</span><span class="op" id="5668300">(</span><span class="op" id="5668301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668305">if</span>&nbsp;<span class="ident" id="5668308">ut</span><span class="op" id="5668310">.</span><span class="ident" id="5668311">base</span>&nbsp;<span class="op" id="5668316">==</span>&nbsp;<span class="ident" id="5668319">slowpoke</span>&nbsp;<span class="op" id="5668328">{</span>&nbsp;<span class="comment" id="5668330">//&nbsp;ut.base&nbsp;lapped&nbsp;slowpoke</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5668360">//&nbsp;recursive&nbsp;pointer&nbsp;type.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668390">return</span>&nbsp;<span class="builtintype" id="5668397">nil</span><span class="op" id="5668400">,</span>&nbsp;<span class="ident" id="5668402">errors</span><span class="op" id="5668408">.</span><span class="ident" id="5668409">New</span><span class="op" id="5668412">(</span><span class="string" id="5668413">&#34;can&#39;t&nbsp;represent&nbsp;recursive&nbsp;pointer&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5668455">+</span>&nbsp;<span class="ident" id="5668457">ut</span><span class="op" id="5668459">.</span><span class="ident" id="5668460">base</span><span class="op" id="5668464">.</span><span class="ident" id="5668465">String</span><span class="op" id="5668471">(</span><span class="op" id="5668472">)</span><span class="op" id="5668473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5668477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668481">if</span>&nbsp;<span class="ident" id="5668484">ut</span><span class="op" id="5668486">.</span><span class="ident" id="5668487">indir</span><span class="op" id="5668492">%</span><span class="num" id="5668493">2</span>&nbsp;<span class="op" id="5668495">==</span>&nbsp;<span class="num" id="5668498">0</span>&nbsp;<span class="op" id="5668500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668505">slowpoke</span>&nbsp;<span class="op" id="5668514">=</span>&nbsp;<span class="ident" id="5668516">slowpoke</span><span class="op" id="5668524">.</span><span class="ident" id="5668525">Elem</span><span class="op" id="5668529">(</span><span class="op" id="5668530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5668534">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668538">ut</span><span class="op" id="5668540">.</span><span class="ident" id="5668541">indir</span><span class="op" id="5668546">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5668550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668554">if</span>&nbsp;<span class="ident" id="5668557">ok</span><span class="op" id="5668559">,</span>&nbsp;<span class="ident" id="5668561">indir</span>&nbsp;<span class="op" id="5668567">:=</span>&nbsp;<span class="ident" id="5668570">implementsInterface</span><span class="op" id="5668589">(</span><span class="ident" id="5668590">ut</span><span class="op" id="5668592">.</span><span class="ident" id="5668593">user</span><span class="op" id="5668597">,</span>&nbsp;<span class="ident" id="5668599">gobEncoderInterfaceType</span><span class="op" id="5668622">)</span><span class="op" id="5668623">;</span>&nbsp;<span class="ident" id="5668625">ok</span>&nbsp;<span class="op" id="5668628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668632">ut</span><span class="op" id="5668634">.</span><span class="ident" id="5668635">externalEnc</span><span class="op" id="5668646">,</span>&nbsp;<span class="ident" id="5668648">ut</span><span class="op" id="5668650">.</span><span class="ident" id="5668651">encIndir</span>&nbsp;<span class="op" id="5668660">=</span>&nbsp;<span class="ident" id="5668662">xGob</span><span class="op" id="5668666">,</span>&nbsp;<span class="ident" id="5668668">indir</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5668675">}</span>&nbsp;<span class="keyword" id="5668677">else</span>&nbsp;<span class="keyword" id="5668682">if</span>&nbsp;<span class="ident" id="5668685">ok</span><span class="op" id="5668687">,</span>&nbsp;<span class="ident" id="5668689">indir</span>&nbsp;<span class="op" id="5668695">:=</span>&nbsp;<span class="ident" id="5668698">implementsInterface</span><span class="op" id="5668717">(</span><span class="ident" id="5668718">ut</span><span class="op" id="5668720">.</span><span class="ident" id="5668721">user</span><span class="op" id="5668725">,</span>&nbsp;<span class="ident" id="5668727">binaryMarshalerInterfaceType</span><span class="op" id="5668755">)</span><span class="op" id="5668756">;</span>&nbsp;<span class="ident" id="5668758">ok</span>&nbsp;<span class="op" id="5668761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668765">ut</span><span class="op" id="5668767">.</span><span class="ident" id="5668768">externalEnc</span><span class="op" id="5668779">,</span>&nbsp;<span class="ident" id="5668781">ut</span><span class="op" id="5668783">.</span><span class="ident" id="5668784">encIndir</span>&nbsp;<span class="op" id="5668793">=</span>&nbsp;<span class="ident" id="5668795">xBinary</span><span class="op" id="5668802">,</span>&nbsp;<span class="ident" id="5668804">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5668811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5668815">//&nbsp;NOTE(rsc):&nbsp;Would&nbsp;like&nbsp;to&nbsp;allow&nbsp;MarshalText&nbsp;here,&nbsp;but&nbsp;results&nbsp;in&nbsp;incompatibility</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5668899">//&nbsp;with&nbsp;older&nbsp;encodings&nbsp;for&nbsp;net.IP.&nbsp;See&nbsp;golang.org/issue/6760.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5668963">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textMarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5669053">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ut.externalEnc,&nbsp;ut.encIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5669101">//&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5669108">if</span>&nbsp;<span class="ident" id="5669111">ok</span><span class="op" id="5669113">,</span>&nbsp;<span class="ident" id="5669115">indir</span>&nbsp;<span class="op" id="5669121">:=</span>&nbsp;<span class="ident" id="5669124">implementsInterface</span><span class="op" id="5669143">(</span><span class="ident" id="5669144">ut</span><span class="op" id="5669146">.</span><span class="ident" id="5669147">user</span><span class="op" id="5669151">,</span>&nbsp;<span class="ident" id="5669153">gobDecoderInterfaceType</span><span class="op" id="5669176">)</span><span class="op" id="5669177">;</span>&nbsp;<span class="ident" id="5669179">ok</span>&nbsp;<span class="op" id="5669182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669186">ut</span><span class="op" id="5669188">.</span><span class="ident" id="5669189">externalDec</span><span class="op" id="5669200">,</span>&nbsp;<span class="ident" id="5669202">ut</span><span class="op" id="5669204">.</span><span class="ident" id="5669205">decIndir</span>&nbsp;<span class="op" id="5669214">=</span>&nbsp;<span class="ident" id="5669216">xGob</span><span class="op" id="5669220">,</span>&nbsp;<span class="ident" id="5669222">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5669229">}</span>&nbsp;<span class="keyword" id="5669231">else</span>&nbsp;<span class="keyword" id="5669236">if</span>&nbsp;<span class="ident" id="5669239">ok</span><span class="op" id="5669241">,</span>&nbsp;<span class="ident" id="5669243">indir</span>&nbsp;<span class="op" id="5669249">:=</span>&nbsp;<span class="ident" id="5669252">implementsInterface</span><span class="op" id="5669271">(</span><span class="ident" id="5669272">ut</span><span class="op" id="5669274">.</span><span class="ident" id="5669275">user</span><span class="op" id="5669279">,</span>&nbsp;<span class="ident" id="5669281">binaryUnmarshalerInterfaceType</span><span class="op" id="5669311">)</span><span class="op" id="5669312">;</span>&nbsp;<span class="ident" id="5669314">ok</span>&nbsp;<span class="op" id="5669317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669321">ut</span><span class="op" id="5669323">.</span><span class="ident" id="5669324">externalDec</span><span class="op" id="5669335">,</span>&nbsp;<span class="ident" id="5669337">ut</span><span class="op" id="5669339">.</span><span class="ident" id="5669340">decIndir</span>&nbsp;<span class="op" id="5669349">=</span>&nbsp;<span class="ident" id="5669351">xBinary</span><span class="op" id="5669358">,</span>&nbsp;<span class="ident" id="5669360">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5669367">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5669371">//&nbsp;See&nbsp;note&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5669391">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textUnmarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5669483">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ut.externalDec,&nbsp;ut.decIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5669531">//&nbsp;}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669538">userTypeCache</span><span class="op" id="5669551">[</span><span class="ident" id="5669552">rt</span><span class="op" id="5669554">]</span>&nbsp;<span class="op" id="5669556">=</span>&nbsp;<span class="ident" id="5669558">ut</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5669562">return</span><br>
<span class="lineno"></span><span class="op" id="5669569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="5669572">var</span>&nbsp;<span class="op" id="5669576">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669579">gobEncoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5669610">=</span>&nbsp;<span class="ident" id="5669612">reflect</span><span class="op" id="5669619">.</span><span class="ident" id="5669620">TypeOf</span><span class="op" id="5669626">(</span><span class="op" id="5669627">(</span><span class="op" id="5669628">*</span><span class="ident" id="5669629">GobEncoder</span><span class="op" id="5669639">)</span><span class="op" id="5669640">(</span><span class="builtintype" id="5669641">nil</span><span class="op" id="5669644">)</span><span class="op" id="5669645">)</span><span class="op" id="5669646">.</span><span class="ident" id="5669647">Elem</span><span class="op" id="5669651">(</span><span class="op" id="5669652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669655">gobDecoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5669686">=</span>&nbsp;<span class="ident" id="5669688">reflect</span><span class="op" id="5669695">.</span><span class="ident" id="5669696">TypeOf</span><span class="op" id="5669702">(</span><span class="op" id="5669703">(</span><span class="op" id="5669704">*</span><span class="ident" id="5669705">GobDecoder</span><span class="op" id="5669715">)</span><span class="op" id="5669716">(</span><span class="builtintype" id="5669717">nil</span><span class="op" id="5669720">)</span><span class="op" id="5669721">)</span><span class="op" id="5669722">.</span><span class="ident" id="5669723">Elem</span><span class="op" id="5669727">(</span><span class="op" id="5669728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669731">binaryMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5669762">=</span>&nbsp;<span class="ident" id="5669764">reflect</span><span class="op" id="5669771">.</span><span class="ident" id="5669772">TypeOf</span><span class="op" id="5669778">(</span><span class="op" id="5669779">(</span><span class="op" id="5669780">*</span><span class="ident" id="5669781">encoding</span><span class="op" id="5669789">.</span><span class="ident" id="5669790">BinaryMarshaler</span><span class="op" id="5669805">)</span><span class="op" id="5669806">(</span><span class="builtintype" id="5669807">nil</span><span class="op" id="5669810">)</span><span class="op" id="5669811">)</span><span class="op" id="5669812">.</span><span class="ident" id="5669813">Elem</span><span class="op" id="5669817">(</span><span class="op" id="5669818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669821">binaryUnmarshalerInterfaceType</span>&nbsp;<span class="op" id="5669852">=</span>&nbsp;<span class="ident" id="5669854">reflect</span><span class="op" id="5669861">.</span><span class="ident" id="5669862">TypeOf</span><span class="op" id="5669868">(</span><span class="op" id="5669869">(</span><span class="op" id="5669870">*</span><span class="ident" id="5669871">encoding</span><span class="op" id="5669879">.</span><span class="ident" id="5669880">BinaryUnmarshaler</span><span class="op" id="5669897">)</span><span class="op" id="5669898">(</span><span class="builtintype" id="5669899">nil</span><span class="op" id="5669902">)</span><span class="op" id="5669903">)</span><span class="op" id="5669904">.</span><span class="ident" id="5669905">Elem</span><span class="op" id="5669909">(</span><span class="op" id="5669910">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669913">textMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5669944">=</span>&nbsp;<span class="ident" id="5669946">reflect</span><span class="op" id="5669953">.</span><span class="ident" id="5669954">TypeOf</span><span class="op" id="5669960">(</span><span class="op" id="5669961">(</span><span class="op" id="5669962">*</span><span class="ident" id="5669963">encoding</span><span class="op" id="5669971">.</span><span class="ident" id="5669972">TextMarshaler</span><span class="op" id="5669985">)</span><span class="op" id="5669986">(</span><span class="builtintype" id="5669987">nil</span><span class="op" id="5669990">)</span><span class="op" id="5669991">)</span><span class="op" id="5669992">.</span><span class="ident" id="5669993">Elem</span><span class="op" id="5669997">(</span><span class="op" id="5669998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670001">textUnmarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5670032">=</span>&nbsp;<span class="ident" id="5670034">reflect</span><span class="op" id="5670041">.</span><span class="ident" id="5670042">TypeOf</span><span class="op" id="5670048">(</span><span class="op" id="5670049">(</span><span class="op" id="5670050">*</span><span class="ident" id="5670051">encoding</span><span class="op" id="5670059">.</span><span class="ident" id="5670060">TextUnmarshaler</span><span class="op" id="5670075">)</span><span class="op" id="5670076">(</span><span class="builtintype" id="5670077">nil</span><span class="op" id="5670080">)</span><span class="op" id="5670081">)</span><span class="op" id="5670082">.</span><span class="ident" id="5670083">Elem</span><span class="op" id="5670087">(</span><span class="op" id="5670088">)</span><br>
<span class="lineno"></span><span class="op" id="5670090">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5670093">//&nbsp;implementsInterface&nbsp;reports&nbsp;whether&nbsp;the&nbsp;type&nbsp;implements&nbsp;the</span><br>
<span class="lineno">125</span><span class="comment" id="5670156">//&nbsp;gobEncoder/gobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5670192">//&nbsp;It&nbsp;also&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;indirections&nbsp;required&nbsp;to&nbsp;get&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5670261">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="5670280">func</span>&nbsp;<span class="ident" id="5670285">implementsInterface</span><span class="op" id="5670304">(</span><span class="ident" id="5670305">typ</span><span class="op" id="5670308">,</span>&nbsp;<span class="ident" id="5670310">gobEncDecType</span>&nbsp;<span class="ident" id="5670324">reflect</span><span class="op" id="5670331">.</span><span class="ident" id="5670332">Type</span><span class="op" id="5670336">)</span>&nbsp;<span class="op" id="5670338">(</span><span class="ident" id="5670339">success</span>&nbsp;<span class="builtintype" id="5670347">bool</span><span class="op" id="5670351">,</span>&nbsp;<span class="ident" id="5670353">indir</span>&nbsp;<span class="builtintype" id="5670359">int8</span><span class="op" id="5670363">)</span>&nbsp;<span class="op" id="5670365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670368">if</span>&nbsp;<span class="ident" id="5670371">typ</span>&nbsp;<span class="op" id="5670375">==</span>&nbsp;<span class="builtintype" id="5670378">nil</span>&nbsp;<span class="op" id="5670382">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670386">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5670394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670397">rt</span>&nbsp;<span class="op" id="5670400">:=</span>&nbsp;<span class="ident" id="5670403">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5670408">//&nbsp;The&nbsp;type&nbsp;might&nbsp;be&nbsp;a&nbsp;pointer&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;keep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5670460">//&nbsp;dereferencing&nbsp;to&nbsp;the&nbsp;base&nbsp;type&nbsp;until&nbsp;we&nbsp;find&nbsp;an&nbsp;implementation.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670528">for</span>&nbsp;<span class="op" id="5670532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670536">if</span>&nbsp;<span class="ident" id="5670539">rt</span><span class="op" id="5670541">.</span><span class="ident" id="5670542">Implements</span><span class="op" id="5670552">(</span><span class="ident" id="5670553">gobEncDecType</span><span class="op" id="5670566">)</span>&nbsp;<span class="op" id="5670568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670573">return</span>&nbsp;<span class="builtintype" id="5670580">true</span><span class="op" id="5670584">,</span>&nbsp;<span class="ident" id="5670586">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5670594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670598">if</span>&nbsp;<span class="ident" id="5670601">p</span>&nbsp;<span class="op" id="5670603">:=</span>&nbsp;<span class="ident" id="5670606">rt</span><span class="op" id="5670608">;</span>&nbsp;<span class="ident" id="5670610">p</span><span class="op" id="5670611">.</span><span class="ident" id="5670612">Kind</span><span class="op" id="5670616">(</span><span class="op" id="5670617">)</span>&nbsp;<span class="op" id="5670619">==</span>&nbsp;<span class="ident" id="5670622">reflect</span><span class="op" id="5670629">.</span><span class="ident" id="5670630">Ptr</span>&nbsp;<span class="op" id="5670634">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670639">indir</span><span class="op" id="5670644">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670650">if</span>&nbsp;<span class="ident" id="5670653">indir</span>&nbsp;<span class="op" id="5670659">&gt;</span>&nbsp;<span class="num" id="5670661">100</span>&nbsp;<span class="op" id="5670665">{</span>&nbsp;<span class="comment" id="5670667">//&nbsp;insane&nbsp;number&nbsp;of&nbsp;indirections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670704">return</span>&nbsp;<span class="builtintype" id="5670711">false</span><span class="op" id="5670716">,</span>&nbsp;<span class="num" id="5670718">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5670723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670728">rt</span>&nbsp;<span class="op" id="5670731">=</span>&nbsp;<span class="ident" id="5670733">p</span><span class="op" id="5670734">.</span><span class="ident" id="5670735">Elem</span><span class="op" id="5670739">(</span><span class="op" id="5670740">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670745">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5670756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670760">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5670767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5670770">//&nbsp;No&nbsp;luck&nbsp;yet,&nbsp;but&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;base&nbsp;type&nbsp;(non-pointer),&nbsp;the&nbsp;pointer&nbsp;might&nbsp;satisfy.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670856">if</span>&nbsp;<span class="ident" id="5670859">typ</span><span class="op" id="5670862">.</span><span class="ident" id="5670863">Kind</span><span class="op" id="5670867">(</span><span class="op" id="5670868">)</span>&nbsp;<span class="op" id="5670870">!=</span>&nbsp;<span class="ident" id="5670873">reflect</span><span class="op" id="5670880">.</span><span class="ident" id="5670881">Ptr</span>&nbsp;<span class="op" id="5670885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5670889">//&nbsp;Not&nbsp;a&nbsp;pointer,&nbsp;but&nbsp;does&nbsp;the&nbsp;pointer&nbsp;work?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670936">if</span>&nbsp;<span class="ident" id="5670939">reflect</span><span class="op" id="5670946">.</span><span class="ident" id="5670947">PtrTo</span><span class="op" id="5670952">(</span><span class="ident" id="5670953">typ</span><span class="op" id="5670956">)</span><span class="op" id="5670957">.</span><span class="ident" id="5670958">Implements</span><span class="op" id="5670968">(</span><span class="ident" id="5670969">gobEncDecType</span><span class="op" id="5670982">)</span>&nbsp;<span class="op" id="5670984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670989">return</span>&nbsp;<span class="builtintype" id="5670996">true</span><span class="op" id="5671000">,</span>&nbsp;<span class="op" id="5671002">-</span><span class="num" id="5671003">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5671007">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5671010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5671013">return</span>&nbsp;<span class="builtintype" id="5671020">false</span><span class="op" id="5671025">,</span>&nbsp;<span class="num" id="5671027">0</span><br>
<span class="lineno"></span><span class="op" id="5671029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5671032">//&nbsp;userType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno">160</span><span class="comment" id="5671119">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;it&nbsp;calls&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5671169">func</span>&nbsp;<span class="ident" id="5671174">userType</span><span class="op" id="5671182">(</span><span class="ident" id="5671183">rt</span>&nbsp;<span class="ident" id="5671186">reflect</span><span class="op" id="5671193">.</span><span class="ident" id="5671194">Type</span><span class="op" id="5671198">)</span>&nbsp;<span class="op" id="5671200">*</span><span class="ident" id="5671201">userTypeInfo</span>&nbsp;<span class="op" id="5671214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5671217">ut</span><span class="op" id="5671219">,</span>&nbsp;<span class="ident" id="5671221">err</span>&nbsp;<span class="op" id="5671225">:=</span>&nbsp;<span class="ident" id="5671228">validUserType</span><span class="op" id="5671241">(</span><span class="ident" id="5671242">rt</span><span class="op" id="5671244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5671247">if</span>&nbsp;<span class="ident" id="5671250">err</span>&nbsp;<span class="op" id="5671254">!=</span>&nbsp;<span class="builtintype" id="5671257">nil</span>&nbsp;<span class="op" id="5671261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5671265">error_</span><span class="op" id="5671271">(</span><span class="ident" id="5671272">err</span><span class="op" id="5671275">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5671278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5671281">return</span>&nbsp;<span class="ident" id="5671288">ut</span><br>
<span class="lineno"></span><span class="op" id="5671291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5671294">//&nbsp;A&nbsp;typeId&nbsp;represents&nbsp;a&nbsp;gob&nbsp;Type&nbsp;as&nbsp;an&nbsp;integer&nbsp;that&nbsp;can&nbsp;be&nbsp;passed&nbsp;on&nbsp;the&nbsp;wire.</span><br>
<span class="lineno">170</span><span class="comment" id="5671374">//&nbsp;Internally,&nbsp;typeIds&nbsp;are&nbsp;used&nbsp;as&nbsp;keys&nbsp;to&nbsp;a&nbsp;map&nbsp;to&nbsp;recover&nbsp;the&nbsp;underlying&nbsp;type&nbsp;info.</span><br>
<span class="lineno"></span><span class="keyword" id="5671460">type</span>&nbsp;<span class="ident" id="5671465">typeId</span>&nbsp;<span class="builtintype" id="5671472">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5671479">var</span>&nbsp;<span class="ident" id="5671483">nextId</span>&nbsp;<span class="ident" id="5671490">typeId</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5671503">//&nbsp;incremented&nbsp;for&nbsp;each&nbsp;new&nbsp;type&nbsp;we&nbsp;build</span><br>
<span class="lineno"></span><span class="keyword" id="5671545">var</span>&nbsp;<span class="ident" id="5671549">typeLock</span>&nbsp;<span class="ident" id="5671558">sync</span><span class="op" id="5671562">.</span><span class="ident" id="5671563">Mutex</span>&nbsp;<span class="comment" id="5671569">//&nbsp;set&nbsp;while&nbsp;building&nbsp;a&nbsp;type</span><br>
<span class="lineno">175</span><span class="keyword" id="5671598">const</span>&nbsp;<span class="ident" id="5671604">firstUserId</span>&nbsp;<span class="op" id="5671616">=</span>&nbsp;<span class="num" id="5671618">64</span>&nbsp;&nbsp;<span class="comment" id="5671622">//&nbsp;lowest&nbsp;id&nbsp;number&nbsp;granted&nbsp;to&nbsp;user</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5671659">type</span>&nbsp;<span class="ident" id="5671664">gobType</span>&nbsp;<span class="keyword" id="5671672">interface</span>&nbsp;<span class="op" id="5671682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5671685">id</span><span class="op" id="5671687">(</span><span class="op" id="5671688">)</span>&nbsp;<span class="ident" id="5671690">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5671698">setId</span><span class="op" id="5671703">(</span><span class="ident" id="5671704">id</span>&nbsp;<span class="ident" id="5671707">typeId</span><span class="op" id="5671713">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5671716">name</span><span class="op" id="5671720">(</span><span class="op" id="5671721">)</span>&nbsp;<span class="builtintype" id="5671723">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5671731">string</span><span class="op" id="5671737">(</span><span class="op" id="5671738">)</span>&nbsp;<span class="builtintype" id="5671740">string</span>&nbsp;<span class="comment" id="5671747">//&nbsp;not&nbsp;public;&nbsp;only&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5671782">safeString</span><span class="op" id="5671792">(</span><span class="ident" id="5671793">seen</span>&nbsp;<span class="keyword" id="5671798">map</span><span class="op" id="5671801">[</span><span class="ident" id="5671802">typeId</span><span class="op" id="5671808">]</span><span class="builtintype" id="5671809">bool</span><span class="op" id="5671813">)</span>&nbsp;<span class="builtintype" id="5671815">string</span><br>
<span class="lineno"></span><span class="op" id="5671822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="5671825">var</span>&nbsp;<span class="ident" id="5671829">types</span>&nbsp;<span class="op" id="5671835">=</span>&nbsp;<span class="builtinfunc" id="5671837">make</span><span class="op" id="5671841">(</span><span class="keyword" id="5671842">map</span><span class="op" id="5671845">[</span><span class="ident" id="5671846">reflect</span><span class="op" id="5671853">.</span><span class="ident" id="5671854">Type</span><span class="op" id="5671858">]</span><span class="ident" id="5671859">gobType</span><span class="op" id="5671866">)</span><br>
<span class="lineno"></span><span class="keyword" id="5671868">var</span>&nbsp;<span class="ident" id="5671872">idToType</span>&nbsp;<span class="op" id="5671881">=</span>&nbsp;<span class="builtinfunc" id="5671883">make</span><span class="op" id="5671887">(</span><span class="keyword" id="5671888">map</span><span class="op" id="5671891">[</span><span class="ident" id="5671892">typeId</span><span class="op" id="5671898">]</span><span class="ident" id="5671899">gobType</span><span class="op" id="5671906">)</span><br>
<span class="lineno"></span><span class="keyword" id="5671908">var</span>&nbsp;<span class="ident" id="5671912">builtinIdToType</span>&nbsp;<span class="keyword" id="5671928">map</span><span class="op" id="5671931">[</span><span class="ident" id="5671932">typeId</span><span class="op" id="5671938">]</span><span class="ident" id="5671939">gobType</span>&nbsp;<span class="comment" id="5671947">//&nbsp;set&nbsp;in&nbsp;init()&nbsp;after&nbsp;builtins&nbsp;are&nbsp;established</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5671996">func</span>&nbsp;<span class="ident" id="5672001">setTypeId</span><span class="op" id="5672010">(</span><span class="ident" id="5672011">typ</span>&nbsp;<span class="ident" id="5672015">gobType</span><span class="op" id="5672022">)</span>&nbsp;<span class="op" id="5672024">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5672027">//&nbsp;When&nbsp;building&nbsp;recursive&nbsp;types,&nbsp;someone&nbsp;may&nbsp;get&nbsp;there&nbsp;before&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672095">if</span>&nbsp;<span class="ident" id="5672098">typ</span><span class="op" id="5672101">.</span><span class="ident" id="5672102">id</span><span class="op" id="5672104">(</span><span class="op" id="5672105">)</span>&nbsp;<span class="op" id="5672107">!=</span>&nbsp;<span class="num" id="5672110">0</span>&nbsp;<span class="op" id="5672112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672116">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5672124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672127">nextId</span><span class="op" id="5672133">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672137">typ</span><span class="op" id="5672140">.</span><span class="ident" id="5672141">setId</span><span class="op" id="5672146">(</span><span class="ident" id="5672147">nextId</span><span class="op" id="5672153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672156">idToType</span><span class="op" id="5672164">[</span><span class="ident" id="5672165">nextId</span><span class="op" id="5672171">]</span>&nbsp;<span class="op" id="5672173">=</span>&nbsp;<span class="ident" id="5672175">typ</span><br>
<span class="lineno"></span><span class="op" id="5672179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5672182">func</span>&nbsp;<span class="op" id="5672187">(</span><span class="ident" id="5672188">t</span>&nbsp;<span class="ident" id="5672190">typeId</span><span class="op" id="5672196">)</span>&nbsp;<span class="ident" id="5672198">gobType</span><span class="op" id="5672205">(</span><span class="op" id="5672206">)</span>&nbsp;<span class="ident" id="5672208">gobType</span>&nbsp;<span class="op" id="5672216">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672219">if</span>&nbsp;<span class="ident" id="5672222">t</span>&nbsp;<span class="op" id="5672224">==</span>&nbsp;<span class="num" id="5672227">0</span>&nbsp;<span class="op" id="5672229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672233">return</span>&nbsp;<span class="builtintype" id="5672240">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5672245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672248">return</span>&nbsp;<span class="ident" id="5672255">idToType</span><span class="op" id="5672263">[</span><span class="ident" id="5672264">t</span><span class="op" id="5672265">]</span><br>
<span class="lineno"></span><span class="op" id="5672267">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="5672270">//&nbsp;string&nbsp;returns&nbsp;the&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno"></span><span class="keyword" id="5672354">func</span>&nbsp;<span class="op" id="5672359">(</span><span class="ident" id="5672360">t</span>&nbsp;<span class="ident" id="5672362">typeId</span><span class="op" id="5672368">)</span>&nbsp;<span class="builtintype" id="5672370">string</span><span class="op" id="5672376">(</span><span class="op" id="5672377">)</span>&nbsp;<span class="builtintype" id="5672379">string</span>&nbsp;<span class="op" id="5672386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672389">if</span>&nbsp;<span class="ident" id="5672392">t</span><span class="op" id="5672393">.</span><span class="ident" id="5672394">gobType</span><span class="op" id="5672401">(</span><span class="op" id="5672402">)</span>&nbsp;<span class="op" id="5672404">==</span>&nbsp;<span class="builtintype" id="5672407">nil</span>&nbsp;<span class="op" id="5672411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672415">return</span>&nbsp;<span class="string" id="5672422">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5672431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672434">return</span>&nbsp;<span class="ident" id="5672441">t</span><span class="op" id="5672442">.</span><span class="ident" id="5672443">gobType</span><span class="op" id="5672450">(</span><span class="op" id="5672451">)</span><span class="op" id="5672452">.</span><span class="builtintype" id="5672453">string</span><span class="op" id="5672459">(</span><span class="op" id="5672460">)</span><br>
<span class="lineno"></span><span class="op" id="5672462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5672465">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno">215</span><span class="keyword" id="5672530">func</span>&nbsp;<span class="op" id="5672535">(</span><span class="ident" id="5672536">t</span>&nbsp;<span class="ident" id="5672538">typeId</span><span class="op" id="5672544">)</span>&nbsp;<span class="ident" id="5672546">name</span><span class="op" id="5672550">(</span><span class="op" id="5672551">)</span>&nbsp;<span class="builtintype" id="5672553">string</span>&nbsp;<span class="op" id="5672560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672563">if</span>&nbsp;<span class="ident" id="5672566">t</span><span class="op" id="5672567">.</span><span class="ident" id="5672568">gobType</span><span class="op" id="5672575">(</span><span class="op" id="5672576">)</span>&nbsp;<span class="op" id="5672578">==</span>&nbsp;<span class="builtintype" id="5672581">nil</span>&nbsp;<span class="op" id="5672585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672589">return</span>&nbsp;<span class="string" id="5672596">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5672605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672608">return</span>&nbsp;<span class="ident" id="5672615">t</span><span class="op" id="5672616">.</span><span class="ident" id="5672617">gobType</span><span class="op" id="5672624">(</span><span class="op" id="5672625">)</span><span class="op" id="5672626">.</span><span class="ident" id="5672627">name</span><span class="op" id="5672631">(</span><span class="op" id="5672632">)</span><br>
<span class="lineno">220</span><span class="op" id="5672634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5672637">//&nbsp;CommonType&nbsp;holds&nbsp;elements&nbsp;of&nbsp;all&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="5672680">//&nbsp;It&nbsp;is&nbsp;a&nbsp;historical&nbsp;artifact,&nbsp;kept&nbsp;for&nbsp;binary&nbsp;compatibility&nbsp;and&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="5672755">//&nbsp;only&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;the&nbsp;package&#39;s&nbsp;encoding&nbsp;of&nbsp;type&nbsp;descriptors.&nbsp;It&nbsp;is</span><br>
<span class="lineno">225</span><span class="comment" id="5672832">//&nbsp;not&nbsp;intended&nbsp;for&nbsp;direct&nbsp;use&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="5672875">type</span>&nbsp;<span class="ident" id="5672880">CommonType</span>&nbsp;<span class="keyword" id="5672891">struct</span>&nbsp;<span class="op" id="5672898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672901">Name</span>&nbsp;<span class="builtintype" id="5672906">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672914">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5672919">typeId</span><br>
<span class="lineno"></span><span class="op" id="5672926">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="5672929">func</span>&nbsp;<span class="op" id="5672934">(</span><span class="ident" id="5672935">t</span>&nbsp;<span class="op" id="5672937">*</span><span class="ident" id="5672938">CommonType</span><span class="op" id="5672948">)</span>&nbsp;<span class="ident" id="5672950">id</span><span class="op" id="5672952">(</span><span class="op" id="5672953">)</span>&nbsp;<span class="ident" id="5672955">typeId</span>&nbsp;<span class="op" id="5672962">{</span>&nbsp;<span class="keyword" id="5672964">return</span>&nbsp;<span class="ident" id="5672971">t</span><span class="op" id="5672972">.</span><span class="ident" id="5672973">Id</span>&nbsp;<span class="op" id="5672976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5672979">func</span>&nbsp;<span class="op" id="5672984">(</span><span class="ident" id="5672985">t</span>&nbsp;<span class="op" id="5672987">*</span><span class="ident" id="5672988">CommonType</span><span class="op" id="5672998">)</span>&nbsp;<span class="ident" id="5673000">setId</span><span class="op" id="5673005">(</span><span class="ident" id="5673006">id</span>&nbsp;<span class="ident" id="5673009">typeId</span><span class="op" id="5673015">)</span>&nbsp;<span class="op" id="5673017">{</span>&nbsp;<span class="ident" id="5673019">t</span><span class="op" id="5673020">.</span><span class="ident" id="5673021">Id</span>&nbsp;<span class="op" id="5673024">=</span>&nbsp;<span class="ident" id="5673026">id</span>&nbsp;<span class="op" id="5673029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="5673032">func</span>&nbsp;<span class="op" id="5673037">(</span><span class="ident" id="5673038">t</span>&nbsp;<span class="op" id="5673040">*</span><span class="ident" id="5673041">CommonType</span><span class="op" id="5673051">)</span>&nbsp;<span class="builtintype" id="5673053">string</span><span class="op" id="5673059">(</span><span class="op" id="5673060">)</span>&nbsp;<span class="builtintype" id="5673062">string</span>&nbsp;<span class="op" id="5673069">{</span>&nbsp;<span class="keyword" id="5673071">return</span>&nbsp;<span class="ident" id="5673078">t</span><span class="op" id="5673079">.</span><span class="ident" id="5673080">Name</span>&nbsp;<span class="op" id="5673085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5673088">func</span>&nbsp;<span class="op" id="5673093">(</span><span class="ident" id="5673094">t</span>&nbsp;<span class="op" id="5673096">*</span><span class="ident" id="5673097">CommonType</span><span class="op" id="5673107">)</span>&nbsp;<span class="ident" id="5673109">safeString</span><span class="op" id="5673119">(</span><span class="ident" id="5673120">seen</span>&nbsp;<span class="keyword" id="5673125">map</span><span class="op" id="5673128">[</span><span class="ident" id="5673129">typeId</span><span class="op" id="5673135">]</span><span class="builtintype" id="5673136">bool</span><span class="op" id="5673140">)</span>&nbsp;<span class="builtintype" id="5673142">string</span>&nbsp;<span class="op" id="5673149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5673152">return</span>&nbsp;<span class="ident" id="5673159">t</span><span class="op" id="5673160">.</span><span class="ident" id="5673161">Name</span><br>
<span class="lineno"></span><span class="op" id="5673166">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5673169">func</span>&nbsp;<span class="op" id="5673174">(</span><span class="ident" id="5673175">t</span>&nbsp;<span class="op" id="5673177">*</span><span class="ident" id="5673178">CommonType</span><span class="op" id="5673188">)</span>&nbsp;<span class="ident" id="5673190">name</span><span class="op" id="5673194">(</span><span class="op" id="5673195">)</span>&nbsp;<span class="builtintype" id="5673197">string</span>&nbsp;<span class="op" id="5673204">{</span>&nbsp;<span class="keyword" id="5673206">return</span>&nbsp;<span class="ident" id="5673213">t</span><span class="op" id="5673214">.</span><span class="ident" id="5673215">Name</span>&nbsp;<span class="op" id="5673220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5673223">//&nbsp;Create&nbsp;and&nbsp;check&nbsp;predefined&nbsp;types</span><br>
<span class="lineno"></span><span class="comment" id="5673260">//&nbsp;The&nbsp;string&nbsp;for&nbsp;tBytes&nbsp;is&nbsp;&#34;bytes&#34;&nbsp;not&nbsp;&#34;[]byte&#34;&nbsp;to&nbsp;signify&nbsp;its&nbsp;specialness.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="5673338">var</span>&nbsp;<span class="op" id="5673342">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5673345">//&nbsp;Primordial&nbsp;types,&nbsp;needed&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5673397">//&nbsp;Always&nbsp;passed&nbsp;as&nbsp;pointers&nbsp;so&nbsp;the&nbsp;interface{}&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5673451">//&nbsp;goes&nbsp;through&nbsp;without&nbsp;losing&nbsp;its&nbsp;interfaceness.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673502">tBool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5673513">=</span>&nbsp;<span class="ident" id="5673515">bootstrapType</span><span class="op" id="5673528">(</span><span class="string" id="5673529">&#34;bool&#34;</span><span class="op" id="5673535">,</span>&nbsp;<span class="op" id="5673537">(</span><span class="op" id="5673538">*</span><span class="builtintype" id="5673539">bool</span><span class="op" id="5673543">)</span><span class="op" id="5673544">(</span><span class="builtintype" id="5673545">nil</span><span class="op" id="5673548">)</span><span class="op" id="5673549">,</span>&nbsp;<span class="num" id="5673551">1</span><span class="op" id="5673552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673555">tInt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5673566">=</span>&nbsp;<span class="ident" id="5673568">bootstrapType</span><span class="op" id="5673581">(</span><span class="string" id="5673582">&#34;int&#34;</span><span class="op" id="5673587">,</span>&nbsp;<span class="op" id="5673589">(</span><span class="op" id="5673590">*</span><span class="builtintype" id="5673591">int</span><span class="op" id="5673594">)</span><span class="op" id="5673595">(</span><span class="builtintype" id="5673596">nil</span><span class="op" id="5673599">)</span><span class="op" id="5673600">,</span>&nbsp;<span class="num" id="5673602">2</span><span class="op" id="5673603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673606">tUint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5673617">=</span>&nbsp;<span class="ident" id="5673619">bootstrapType</span><span class="op" id="5673632">(</span><span class="string" id="5673633">&#34;uint&#34;</span><span class="op" id="5673639">,</span>&nbsp;<span class="op" id="5673641">(</span><span class="op" id="5673642">*</span><span class="builtintype" id="5673643">uint</span><span class="op" id="5673647">)</span><span class="op" id="5673648">(</span><span class="builtintype" id="5673649">nil</span><span class="op" id="5673652">)</span><span class="op" id="5673653">,</span>&nbsp;<span class="num" id="5673655">3</span><span class="op" id="5673656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673659">tFloat</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5673670">=</span>&nbsp;<span class="ident" id="5673672">bootstrapType</span><span class="op" id="5673685">(</span><span class="string" id="5673686">&#34;float&#34;</span><span class="op" id="5673693">,</span>&nbsp;<span class="op" id="5673695">(</span><span class="op" id="5673696">*</span><span class="builtintype" id="5673697">float64</span><span class="op" id="5673704">)</span><span class="op" id="5673705">(</span><span class="builtintype" id="5673706">nil</span><span class="op" id="5673709">)</span><span class="op" id="5673710">,</span>&nbsp;<span class="num" id="5673712">4</span><span class="op" id="5673713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673716">tBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5673727">=</span>&nbsp;<span class="ident" id="5673729">bootstrapType</span><span class="op" id="5673742">(</span><span class="string" id="5673743">&#34;bytes&#34;</span><span class="op" id="5673750">,</span>&nbsp;<span class="op" id="5673752">(</span><span class="op" id="5673753">*</span><span class="op" id="5673754">[</span><span class="op" id="5673755">]</span><span class="builtintype" id="5673756">byte</span><span class="op" id="5673760">)</span><span class="op" id="5673761">(</span><span class="builtintype" id="5673762">nil</span><span class="op" id="5673765">)</span><span class="op" id="5673766">,</span>&nbsp;<span class="num" id="5673768">5</span><span class="op" id="5673769">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673772">tString</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5673783">=</span>&nbsp;<span class="ident" id="5673785">bootstrapType</span><span class="op" id="5673798">(</span><span class="string" id="5673799">&#34;string&#34;</span><span class="op" id="5673807">,</span>&nbsp;<span class="op" id="5673809">(</span><span class="op" id="5673810">*</span><span class="builtintype" id="5673811">string</span><span class="op" id="5673817">)</span><span class="op" id="5673818">(</span><span class="builtintype" id="5673819">nil</span><span class="op" id="5673822">)</span><span class="op" id="5673823">,</span>&nbsp;<span class="num" id="5673825">6</span><span class="op" id="5673826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673829">tComplex</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5673840">=</span>&nbsp;<span class="ident" id="5673842">bootstrapType</span><span class="op" id="5673855">(</span><span class="string" id="5673856">&#34;complex&#34;</span><span class="op" id="5673865">,</span>&nbsp;<span class="op" id="5673867">(</span><span class="op" id="5673868">*</span><span class="builtintype" id="5673869">complex128</span><span class="op" id="5673879">)</span><span class="op" id="5673880">(</span><span class="builtintype" id="5673881">nil</span><span class="op" id="5673884">)</span><span class="op" id="5673885">,</span>&nbsp;<span class="num" id="5673887">7</span><span class="op" id="5673888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673891">tInterface</span>&nbsp;<span class="op" id="5673902">=</span>&nbsp;<span class="ident" id="5673904">bootstrapType</span><span class="op" id="5673917">(</span><span class="string" id="5673918">&#34;interface&#34;</span><span class="op" id="5673929">,</span>&nbsp;<span class="op" id="5673931">(</span><span class="op" id="5673932">*</span><span class="keyword" id="5673933">interface</span><span class="op" id="5673942">{</span><span class="op" id="5673943">}</span><span class="op" id="5673944">)</span><span class="op" id="5673945">(</span><span class="builtintype" id="5673946">nil</span><span class="op" id="5673949">)</span><span class="op" id="5673950">,</span>&nbsp;<span class="num" id="5673952">8</span><span class="op" id="5673953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5673956">//&nbsp;Reserve&nbsp;some&nbsp;Ids&nbsp;for&nbsp;compatible&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674002">tReserved7</span>&nbsp;<span class="op" id="5674013">=</span>&nbsp;<span class="ident" id="5674015">bootstrapType</span><span class="op" id="5674028">(</span><span class="string" id="5674029">&#34;_reserved1&#34;</span><span class="op" id="5674041">,</span>&nbsp;<span class="op" id="5674043">(</span><span class="op" id="5674044">*</span><span class="keyword" id="5674045">struct</span><span class="op" id="5674051">{</span>&nbsp;<span class="ident" id="5674053">r7</span>&nbsp;<span class="builtintype" id="5674056">int</span>&nbsp;<span class="op" id="5674060">}</span><span class="op" id="5674061">)</span><span class="op" id="5674062">(</span><span class="builtintype" id="5674063">nil</span><span class="op" id="5674066">)</span><span class="op" id="5674067">,</span>&nbsp;<span class="num" id="5674069">9</span><span class="op" id="5674070">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674073">tReserved6</span>&nbsp;<span class="op" id="5674084">=</span>&nbsp;<span class="ident" id="5674086">bootstrapType</span><span class="op" id="5674099">(</span><span class="string" id="5674100">&#34;_reserved1&#34;</span><span class="op" id="5674112">,</span>&nbsp;<span class="op" id="5674114">(</span><span class="op" id="5674115">*</span><span class="keyword" id="5674116">struct</span><span class="op" id="5674122">{</span>&nbsp;<span class="ident" id="5674124">r6</span>&nbsp;<span class="builtintype" id="5674127">int</span>&nbsp;<span class="op" id="5674131">}</span><span class="op" id="5674132">)</span><span class="op" id="5674133">(</span><span class="builtintype" id="5674134">nil</span><span class="op" id="5674137">)</span><span class="op" id="5674138">,</span>&nbsp;<span class="num" id="5674140">10</span><span class="op" id="5674142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674145">tReserved5</span>&nbsp;<span class="op" id="5674156">=</span>&nbsp;<span class="ident" id="5674158">bootstrapType</span><span class="op" id="5674171">(</span><span class="string" id="5674172">&#34;_reserved1&#34;</span><span class="op" id="5674184">,</span>&nbsp;<span class="op" id="5674186">(</span><span class="op" id="5674187">*</span><span class="keyword" id="5674188">struct</span><span class="op" id="5674194">{</span>&nbsp;<span class="ident" id="5674196">r5</span>&nbsp;<span class="builtintype" id="5674199">int</span>&nbsp;<span class="op" id="5674203">}</span><span class="op" id="5674204">)</span><span class="op" id="5674205">(</span><span class="builtintype" id="5674206">nil</span><span class="op" id="5674209">)</span><span class="op" id="5674210">,</span>&nbsp;<span class="num" id="5674212">11</span><span class="op" id="5674214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674217">tReserved4</span>&nbsp;<span class="op" id="5674228">=</span>&nbsp;<span class="ident" id="5674230">bootstrapType</span><span class="op" id="5674243">(</span><span class="string" id="5674244">&#34;_reserved1&#34;</span><span class="op" id="5674256">,</span>&nbsp;<span class="op" id="5674258">(</span><span class="op" id="5674259">*</span><span class="keyword" id="5674260">struct</span><span class="op" id="5674266">{</span>&nbsp;<span class="ident" id="5674268">r4</span>&nbsp;<span class="builtintype" id="5674271">int</span>&nbsp;<span class="op" id="5674275">}</span><span class="op" id="5674276">)</span><span class="op" id="5674277">(</span><span class="builtintype" id="5674278">nil</span><span class="op" id="5674281">)</span><span class="op" id="5674282">,</span>&nbsp;<span class="num" id="5674284">12</span><span class="op" id="5674286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674289">tReserved3</span>&nbsp;<span class="op" id="5674300">=</span>&nbsp;<span class="ident" id="5674302">bootstrapType</span><span class="op" id="5674315">(</span><span class="string" id="5674316">&#34;_reserved1&#34;</span><span class="op" id="5674328">,</span>&nbsp;<span class="op" id="5674330">(</span><span class="op" id="5674331">*</span><span class="keyword" id="5674332">struct</span><span class="op" id="5674338">{</span>&nbsp;<span class="ident" id="5674340">r3</span>&nbsp;<span class="builtintype" id="5674343">int</span>&nbsp;<span class="op" id="5674347">}</span><span class="op" id="5674348">)</span><span class="op" id="5674349">(</span><span class="builtintype" id="5674350">nil</span><span class="op" id="5674353">)</span><span class="op" id="5674354">,</span>&nbsp;<span class="num" id="5674356">13</span><span class="op" id="5674358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674361">tReserved2</span>&nbsp;<span class="op" id="5674372">=</span>&nbsp;<span class="ident" id="5674374">bootstrapType</span><span class="op" id="5674387">(</span><span class="string" id="5674388">&#34;_reserved1&#34;</span><span class="op" id="5674400">,</span>&nbsp;<span class="op" id="5674402">(</span><span class="op" id="5674403">*</span><span class="keyword" id="5674404">struct</span><span class="op" id="5674410">{</span>&nbsp;<span class="ident" id="5674412">r2</span>&nbsp;<span class="builtintype" id="5674415">int</span>&nbsp;<span class="op" id="5674419">}</span><span class="op" id="5674420">)</span><span class="op" id="5674421">(</span><span class="builtintype" id="5674422">nil</span><span class="op" id="5674425">)</span><span class="op" id="5674426">,</span>&nbsp;<span class="num" id="5674428">14</span><span class="op" id="5674430">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674433">tReserved1</span>&nbsp;<span class="op" id="5674444">=</span>&nbsp;<span class="ident" id="5674446">bootstrapType</span><span class="op" id="5674459">(</span><span class="string" id="5674460">&#34;_reserved1&#34;</span><span class="op" id="5674472">,</span>&nbsp;<span class="op" id="5674474">(</span><span class="op" id="5674475">*</span><span class="keyword" id="5674476">struct</span><span class="op" id="5674482">{</span>&nbsp;<span class="ident" id="5674484">r1</span>&nbsp;<span class="builtintype" id="5674487">int</span>&nbsp;<span class="op" id="5674491">}</span><span class="op" id="5674492">)</span><span class="op" id="5674493">(</span><span class="builtintype" id="5674494">nil</span><span class="op" id="5674497">)</span><span class="op" id="5674498">,</span>&nbsp;<span class="num" id="5674500">15</span><span class="op" id="5674502">)</span><br>
<span class="lineno"></span><span class="op" id="5674504">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5674507">//&nbsp;Predefined&nbsp;because&nbsp;it&#39;s&nbsp;needed&nbsp;by&nbsp;the&nbsp;Decoder</span><br>
<span class="lineno"></span><span class="keyword" id="5674556">var</span>&nbsp;<span class="ident" id="5674560">tWireType</span>&nbsp;<span class="op" id="5674570">=</span>&nbsp;<span class="ident" id="5674572">mustGetTypeInfo</span><span class="op" id="5674587">(</span><span class="ident" id="5674588">reflect</span><span class="op" id="5674595">.</span><span class="ident" id="5674596">TypeOf</span><span class="op" id="5674602">(</span><span class="ident" id="5674603">wireType</span><span class="op" id="5674611">{</span><span class="op" id="5674612">}</span><span class="op" id="5674613">)</span><span class="op" id="5674614">)</span><span class="op" id="5674615">.</span><span class="ident" id="5674616">id</span><br>
<span class="lineno">270</span><span class="keyword" id="5674619">var</span>&nbsp;<span class="ident" id="5674623">wireTypeUserInfo</span>&nbsp;<span class="op" id="5674640">*</span><span class="ident" id="5674641">userTypeInfo</span>&nbsp;<span class="comment" id="5674654">//&nbsp;userTypeInfo&nbsp;of&nbsp;(*wireType)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5674686">func</span>&nbsp;<span class="ident" id="5674691">init</span><span class="op" id="5674695">(</span><span class="op" id="5674696">)</span>&nbsp;<span class="op" id="5674698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5674701">//&nbsp;Some&nbsp;magic&nbsp;numbers&nbsp;to&nbsp;make&nbsp;sure&nbsp;there&nbsp;are&nbsp;no&nbsp;surprises.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674761">checkId</span><span class="op" id="5674768">(</span><span class="num" id="5674769">16</span><span class="op" id="5674771">,</span>&nbsp;<span class="ident" id="5674773">tWireType</span><span class="op" id="5674782">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674785">checkId</span><span class="op" id="5674792">(</span><span class="num" id="5674793">17</span><span class="op" id="5674795">,</span>&nbsp;<span class="ident" id="5674797">mustGetTypeInfo</span><span class="op" id="5674812">(</span><span class="ident" id="5674813">reflect</span><span class="op" id="5674820">.</span><span class="ident" id="5674821">TypeOf</span><span class="op" id="5674827">(</span><span class="ident" id="5674828">arrayType</span><span class="op" id="5674837">{</span><span class="op" id="5674838">}</span><span class="op" id="5674839">)</span><span class="op" id="5674840">)</span><span class="op" id="5674841">.</span><span class="ident" id="5674842">id</span><span class="op" id="5674844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674847">checkId</span><span class="op" id="5674854">(</span><span class="num" id="5674855">18</span><span class="op" id="5674857">,</span>&nbsp;<span class="ident" id="5674859">mustGetTypeInfo</span><span class="op" id="5674874">(</span><span class="ident" id="5674875">reflect</span><span class="op" id="5674882">.</span><span class="ident" id="5674883">TypeOf</span><span class="op" id="5674889">(</span><span class="ident" id="5674890">CommonType</span><span class="op" id="5674900">{</span><span class="op" id="5674901">}</span><span class="op" id="5674902">)</span><span class="op" id="5674903">)</span><span class="op" id="5674904">.</span><span class="ident" id="5674905">id</span><span class="op" id="5674907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674910">checkId</span><span class="op" id="5674917">(</span><span class="num" id="5674918">19</span><span class="op" id="5674920">,</span>&nbsp;<span class="ident" id="5674922">mustGetTypeInfo</span><span class="op" id="5674937">(</span><span class="ident" id="5674938">reflect</span><span class="op" id="5674945">.</span><span class="ident" id="5674946">TypeOf</span><span class="op" id="5674952">(</span><span class="ident" id="5674953">sliceType</span><span class="op" id="5674962">{</span><span class="op" id="5674963">}</span><span class="op" id="5674964">)</span><span class="op" id="5674965">)</span><span class="op" id="5674966">.</span><span class="ident" id="5674967">id</span><span class="op" id="5674969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674972">checkId</span><span class="op" id="5674979">(</span><span class="num" id="5674980">20</span><span class="op" id="5674982">,</span>&nbsp;<span class="ident" id="5674984">mustGetTypeInfo</span><span class="op" id="5674999">(</span><span class="ident" id="5675000">reflect</span><span class="op" id="5675007">.</span><span class="ident" id="5675008">TypeOf</span><span class="op" id="5675014">(</span><span class="ident" id="5675015">structType</span><span class="op" id="5675025">{</span><span class="op" id="5675026">}</span><span class="op" id="5675027">)</span><span class="op" id="5675028">)</span><span class="op" id="5675029">.</span><span class="ident" id="5675030">id</span><span class="op" id="5675032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675035">checkId</span><span class="op" id="5675042">(</span><span class="num" id="5675043">21</span><span class="op" id="5675045">,</span>&nbsp;<span class="ident" id="5675047">mustGetTypeInfo</span><span class="op" id="5675062">(</span><span class="ident" id="5675063">reflect</span><span class="op" id="5675070">.</span><span class="ident" id="5675071">TypeOf</span><span class="op" id="5675077">(</span><span class="ident" id="5675078">fieldType</span><span class="op" id="5675087">{</span><span class="op" id="5675088">}</span><span class="op" id="5675089">)</span><span class="op" id="5675090">)</span><span class="op" id="5675091">.</span><span class="ident" id="5675092">id</span><span class="op" id="5675094">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675097">checkId</span><span class="op" id="5675104">(</span><span class="num" id="5675105">23</span><span class="op" id="5675107">,</span>&nbsp;<span class="ident" id="5675109">mustGetTypeInfo</span><span class="op" id="5675124">(</span><span class="ident" id="5675125">reflect</span><span class="op" id="5675132">.</span><span class="ident" id="5675133">TypeOf</span><span class="op" id="5675139">(</span><span class="ident" id="5675140">mapType</span><span class="op" id="5675147">{</span><span class="op" id="5675148">}</span><span class="op" id="5675149">)</span><span class="op" id="5675150">)</span><span class="op" id="5675151">.</span><span class="ident" id="5675152">id</span><span class="op" id="5675154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675158">builtinIdToType</span>&nbsp;<span class="op" id="5675174">=</span>&nbsp;<span class="builtinfunc" id="5675176">make</span><span class="op" id="5675180">(</span><span class="keyword" id="5675181">map</span><span class="op" id="5675184">[</span><span class="ident" id="5675185">typeId</span><span class="op" id="5675191">]</span><span class="ident" id="5675192">gobType</span><span class="op" id="5675199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675202">for</span>&nbsp;<span class="ident" id="5675206">k</span><span class="op" id="5675207">,</span>&nbsp;<span class="ident" id="5675209">v</span>&nbsp;<span class="op" id="5675211">:=</span>&nbsp;<span class="keyword" id="5675214">range</span>&nbsp;<span class="ident" id="5675220">idToType</span>&nbsp;<span class="op" id="5675229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675233">builtinIdToType</span><span class="op" id="5675248">[</span><span class="ident" id="5675249">k</span><span class="op" id="5675250">]</span>&nbsp;<span class="op" id="5675252">=</span>&nbsp;<span class="ident" id="5675254">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5675257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5675261">//&nbsp;Move&nbsp;the&nbsp;id&nbsp;space&nbsp;upwards&nbsp;to&nbsp;allow&nbsp;for&nbsp;growth&nbsp;in&nbsp;the&nbsp;predefined&nbsp;world</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5675335">//&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675372">if</span>&nbsp;<span class="ident" id="5675375">nextId</span>&nbsp;<span class="op" id="5675382">&gt;</span>&nbsp;<span class="ident" id="5675384">firstUserId</span>&nbsp;<span class="op" id="5675396">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5675400">panic</span><span class="op" id="5675405">(</span><span class="ident" id="5675406">fmt</span><span class="op" id="5675409">.</span><span class="ident" id="5675410">Sprintln</span><span class="op" id="5675418">(</span><span class="string" id="5675419">&#34;nextId&nbsp;too&nbsp;large:&#34;</span><span class="op" id="5675438">,</span>&nbsp;<span class="ident" id="5675440">nextId</span><span class="op" id="5675446">)</span><span class="op" id="5675447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5675450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675453">nextId</span>&nbsp;<span class="op" id="5675460">=</span>&nbsp;<span class="ident" id="5675462">firstUserId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675475">registerBasics</span><span class="op" id="5675489">(</span><span class="op" id="5675490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675493">wireTypeUserInfo</span>&nbsp;<span class="op" id="5675510">=</span>&nbsp;<span class="ident" id="5675512">userType</span><span class="op" id="5675520">(</span><span class="ident" id="5675521">reflect</span><span class="op" id="5675528">.</span><span class="ident" id="5675529">TypeOf</span><span class="op" id="5675535">(</span><span class="op" id="5675536">(</span><span class="op" id="5675537">*</span><span class="ident" id="5675538">wireType</span><span class="op" id="5675546">)</span><span class="op" id="5675547">(</span><span class="builtintype" id="5675548">nil</span><span class="op" id="5675551">)</span><span class="op" id="5675552">)</span><span class="op" id="5675553">)</span><br>
<span class="lineno">295</span><span class="op" id="5675555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5675558">//&nbsp;Array&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5675572">type</span>&nbsp;<span class="ident" id="5675577">arrayType</span>&nbsp;<span class="keyword" id="5675587">struct</span>&nbsp;<span class="op" id="5675594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675597">CommonType</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675609">Elem</span>&nbsp;<span class="ident" id="5675614">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675622">Len</span>&nbsp;&nbsp;<span class="builtintype" id="5675627">int</span><br>
<span class="lineno"></span><span class="op" id="5675631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5675634">func</span>&nbsp;<span class="ident" id="5675639">newArrayType</span><span class="op" id="5675651">(</span><span class="ident" id="5675652">name</span>&nbsp;<span class="builtintype" id="5675657">string</span><span class="op" id="5675663">)</span>&nbsp;<span class="op" id="5675665">*</span><span class="ident" id="5675666">arrayType</span>&nbsp;<span class="op" id="5675676">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675679">a</span>&nbsp;<span class="op" id="5675681">:=</span>&nbsp;<span class="op" id="5675684">&amp;</span><span class="ident" id="5675685">arrayType</span><span class="op" id="5675694">{</span><span class="ident" id="5675695">CommonType</span><span class="op" id="5675705">{</span><span class="ident" id="5675706">Name</span><span class="op" id="5675710">:</span>&nbsp;<span class="ident" id="5675712">name</span><span class="op" id="5675716">}</span><span class="op" id="5675717">,</span>&nbsp;<span class="num" id="5675719">0</span><span class="op" id="5675720">,</span>&nbsp;<span class="num" id="5675722">0</span><span class="op" id="5675723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675726">return</span>&nbsp;<span class="ident" id="5675733">a</span><br>
<span class="lineno"></span><span class="op" id="5675735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5675738">func</span>&nbsp;<span class="op" id="5675743">(</span><span class="ident" id="5675744">a</span>&nbsp;<span class="op" id="5675746">*</span><span class="ident" id="5675747">arrayType</span><span class="op" id="5675756">)</span>&nbsp;<span class="ident" id="5675758">init</span><span class="op" id="5675762">(</span><span class="ident" id="5675763">elem</span>&nbsp;<span class="ident" id="5675768">gobType</span><span class="op" id="5675775">,</span>&nbsp;<span class="builtinfunc" id="5675777">len</span>&nbsp;<span class="builtintype" id="5675781">int</span><span class="op" id="5675784">)</span>&nbsp;<span class="op" id="5675786">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5675789">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675864">setTypeId</span><span class="op" id="5675873">(</span><span class="ident" id="5675874">a</span><span class="op" id="5675875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675878">a</span><span class="op" id="5675879">.</span><span class="ident" id="5675880">Elem</span>&nbsp;<span class="op" id="5675885">=</span>&nbsp;<span class="ident" id="5675887">elem</span><span class="op" id="5675891">.</span><span class="ident" id="5675892">id</span><span class="op" id="5675894">(</span><span class="op" id="5675895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675898">a</span><span class="op" id="5675899">.</span><span class="ident" id="5675900">Len</span>&nbsp;<span class="op" id="5675904">=</span>&nbsp;<span class="builtinfunc" id="5675906">len</span><br>
<span class="lineno"></span><span class="op" id="5675910">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="5675913">func</span>&nbsp;<span class="op" id="5675918">(</span><span class="ident" id="5675919">a</span>&nbsp;<span class="op" id="5675921">*</span><span class="ident" id="5675922">arrayType</span><span class="op" id="5675931">)</span>&nbsp;<span class="ident" id="5675933">safeString</span><span class="op" id="5675943">(</span><span class="ident" id="5675944">seen</span>&nbsp;<span class="keyword" id="5675949">map</span><span class="op" id="5675952">[</span><span class="ident" id="5675953">typeId</span><span class="op" id="5675959">]</span><span class="builtintype" id="5675960">bool</span><span class="op" id="5675964">)</span>&nbsp;<span class="builtintype" id="5675966">string</span>&nbsp;<span class="op" id="5675973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675976">if</span>&nbsp;<span class="ident" id="5675979">seen</span><span class="op" id="5675983">[</span><span class="ident" id="5675984">a</span><span class="op" id="5675985">.</span><span class="ident" id="5675986">Id</span><span class="op" id="5675988">]</span>&nbsp;<span class="op" id="5675990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675994">return</span>&nbsp;<span class="ident" id="5676001">a</span><span class="op" id="5676002">.</span><span class="ident" id="5676003">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5676009">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676012">seen</span><span class="op" id="5676016">[</span><span class="ident" id="5676017">a</span><span class="op" id="5676018">.</span><span class="ident" id="5676019">Id</span><span class="op" id="5676021">]</span>&nbsp;<span class="op" id="5676023">=</span>&nbsp;<span class="builtintype" id="5676025">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5676031">return</span>&nbsp;<span class="ident" id="5676038">fmt</span><span class="op" id="5676041">.</span><span class="ident" id="5676042">Sprintf</span><span class="op" id="5676049">(</span><span class="string" id="5676050">&#34;[%d]%s&#34;</span><span class="op" id="5676058">,</span>&nbsp;<span class="ident" id="5676060">a</span><span class="op" id="5676061">.</span><span class="ident" id="5676062">Len</span><span class="op" id="5676065">,</span>&nbsp;<span class="ident" id="5676067">a</span><span class="op" id="5676068">.</span><span class="ident" id="5676069">Elem</span><span class="op" id="5676073">.</span><span class="ident" id="5676074">gobType</span><span class="op" id="5676081">(</span><span class="op" id="5676082">)</span><span class="op" id="5676083">.</span><span class="ident" id="5676084">safeString</span><span class="op" id="5676094">(</span><span class="ident" id="5676095">seen</span><span class="op" id="5676099">)</span><span class="op" id="5676100">)</span><br>
<span class="lineno"></span><span class="op" id="5676102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5676105">func</span>&nbsp;<span class="op" id="5676110">(</span><span class="ident" id="5676111">a</span>&nbsp;<span class="op" id="5676113">*</span><span class="ident" id="5676114">arrayType</span><span class="op" id="5676123">)</span>&nbsp;<span class="builtintype" id="5676125">string</span><span class="op" id="5676131">(</span><span class="op" id="5676132">)</span>&nbsp;<span class="builtintype" id="5676134">string</span>&nbsp;<span class="op" id="5676141">{</span>&nbsp;<span class="keyword" id="5676143">return</span>&nbsp;<span class="ident" id="5676150">a</span><span class="op" id="5676151">.</span><span class="ident" id="5676152">safeString</span><span class="op" id="5676162">(</span><span class="builtinfunc" id="5676163">make</span><span class="op" id="5676167">(</span><span class="keyword" id="5676168">map</span><span class="op" id="5676171">[</span><span class="ident" id="5676172">typeId</span><span class="op" id="5676178">]</span><span class="builtintype" id="5676179">bool</span><span class="op" id="5676183">)</span><span class="op" id="5676184">)</span>&nbsp;<span class="op" id="5676186">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="5676189">//&nbsp;GobEncoder&nbsp;type&nbsp;(something&nbsp;that&nbsp;implements&nbsp;the&nbsp;GobEncoder&nbsp;interface)</span><br>
<span class="lineno"></span><span class="keyword" id="5676261">type</span>&nbsp;<span class="ident" id="5676266">gobEncoderType</span>&nbsp;<span class="keyword" id="5676281">struct</span>&nbsp;<span class="op" id="5676288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676291">CommonType</span><br>
<span class="lineno"></span><span class="op" id="5676302">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5676305">func</span>&nbsp;<span class="ident" id="5676310">newGobEncoderType</span><span class="op" id="5676327">(</span><span class="ident" id="5676328">name</span>&nbsp;<span class="builtintype" id="5676333">string</span><span class="op" id="5676339">)</span>&nbsp;<span class="op" id="5676341">*</span><span class="ident" id="5676342">gobEncoderType</span>&nbsp;<span class="op" id="5676357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676360">g</span>&nbsp;<span class="op" id="5676362">:=</span>&nbsp;<span class="op" id="5676365">&amp;</span><span class="ident" id="5676366">gobEncoderType</span><span class="op" id="5676380">{</span><span class="ident" id="5676381">CommonType</span><span class="op" id="5676391">{</span><span class="ident" id="5676392">Name</span><span class="op" id="5676396">:</span>&nbsp;<span class="ident" id="5676398">name</span><span class="op" id="5676402">}</span><span class="op" id="5676403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676406">setTypeId</span><span class="op" id="5676415">(</span><span class="ident" id="5676416">g</span><span class="op" id="5676417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5676420">return</span>&nbsp;<span class="ident" id="5676427">g</span><br>
<span class="lineno">335</span><span class="op" id="5676429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5676432">func</span>&nbsp;<span class="op" id="5676437">(</span><span class="ident" id="5676438">g</span>&nbsp;<span class="op" id="5676440">*</span><span class="ident" id="5676441">gobEncoderType</span><span class="op" id="5676455">)</span>&nbsp;<span class="ident" id="5676457">safeString</span><span class="op" id="5676467">(</span><span class="ident" id="5676468">seen</span>&nbsp;<span class="keyword" id="5676473">map</span><span class="op" id="5676476">[</span><span class="ident" id="5676477">typeId</span><span class="op" id="5676483">]</span><span class="builtintype" id="5676484">bool</span><span class="op" id="5676488">)</span>&nbsp;<span class="builtintype" id="5676490">string</span>&nbsp;<span class="op" id="5676497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5676500">return</span>&nbsp;<span class="ident" id="5676507">g</span><span class="op" id="5676508">.</span><span class="ident" id="5676509">Name</span><br>
<span class="lineno"></span><span class="op" id="5676514">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="5676517">func</span>&nbsp;<span class="op" id="5676522">(</span><span class="ident" id="5676523">g</span>&nbsp;<span class="op" id="5676525">*</span><span class="ident" id="5676526">gobEncoderType</span><span class="op" id="5676540">)</span>&nbsp;<span class="builtintype" id="5676542">string</span><span class="op" id="5676548">(</span><span class="op" id="5676549">)</span>&nbsp;<span class="builtintype" id="5676551">string</span>&nbsp;<span class="op" id="5676558">{</span>&nbsp;<span class="keyword" id="5676560">return</span>&nbsp;<span class="ident" id="5676567">g</span><span class="op" id="5676568">.</span><span class="ident" id="5676569">Name</span>&nbsp;<span class="op" id="5676574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5676577">//&nbsp;Map&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5676589">type</span>&nbsp;<span class="ident" id="5676594">mapType</span>&nbsp;<span class="keyword" id="5676602">struct</span>&nbsp;<span class="op" id="5676609">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676612">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676624">Key</span>&nbsp;&nbsp;<span class="ident" id="5676629">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676637">Elem</span>&nbsp;<span class="ident" id="5676642">typeId</span><br>
<span class="lineno"></span><span class="op" id="5676649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="5676652">func</span>&nbsp;<span class="ident" id="5676657">newMapType</span><span class="op" id="5676667">(</span><span class="ident" id="5676668">name</span>&nbsp;<span class="builtintype" id="5676673">string</span><span class="op" id="5676679">)</span>&nbsp;<span class="op" id="5676681">*</span><span class="ident" id="5676682">mapType</span>&nbsp;<span class="op" id="5676690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676693">m</span>&nbsp;<span class="op" id="5676695">:=</span>&nbsp;<span class="op" id="5676698">&amp;</span><span class="ident" id="5676699">mapType</span><span class="op" id="5676706">{</span><span class="ident" id="5676707">CommonType</span><span class="op" id="5676717">{</span><span class="ident" id="5676718">Name</span><span class="op" id="5676722">:</span>&nbsp;<span class="ident" id="5676724">name</span><span class="op" id="5676728">}</span><span class="op" id="5676729">,</span>&nbsp;<span class="num" id="5676731">0</span><span class="op" id="5676732">,</span>&nbsp;<span class="num" id="5676734">0</span><span class="op" id="5676735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5676738">return</span>&nbsp;<span class="ident" id="5676745">m</span><br>
<span class="lineno"></span><span class="op" id="5676747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="5676750">func</span>&nbsp;<span class="op" id="5676755">(</span><span class="ident" id="5676756">m</span>&nbsp;<span class="op" id="5676758">*</span><span class="ident" id="5676759">mapType</span><span class="op" id="5676766">)</span>&nbsp;<span class="ident" id="5676768">init</span><span class="op" id="5676772">(</span><span class="ident" id="5676773">key</span><span class="op" id="5676776">,</span>&nbsp;<span class="ident" id="5676778">elem</span>&nbsp;<span class="ident" id="5676783">gobType</span><span class="op" id="5676790">)</span>&nbsp;<span class="op" id="5676792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5676795">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676870">setTypeId</span><span class="op" id="5676879">(</span><span class="ident" id="5676880">m</span><span class="op" id="5676881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676884">m</span><span class="op" id="5676885">.</span><span class="ident" id="5676886">Key</span>&nbsp;<span class="op" id="5676890">=</span>&nbsp;<span class="ident" id="5676892">key</span><span class="op" id="5676895">.</span><span class="ident" id="5676896">id</span><span class="op" id="5676898">(</span><span class="op" id="5676899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676902">m</span><span class="op" id="5676903">.</span><span class="ident" id="5676904">Elem</span>&nbsp;<span class="op" id="5676909">=</span>&nbsp;<span class="ident" id="5676911">elem</span><span class="op" id="5676915">.</span><span class="ident" id="5676916">id</span><span class="op" id="5676918">(</span><span class="op" id="5676919">)</span><br>
<span class="lineno">360</span><span class="op" id="5676921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5676924">func</span>&nbsp;<span class="op" id="5676929">(</span><span class="ident" id="5676930">m</span>&nbsp;<span class="op" id="5676932">*</span><span class="ident" id="5676933">mapType</span><span class="op" id="5676940">)</span>&nbsp;<span class="ident" id="5676942">safeString</span><span class="op" id="5676952">(</span><span class="ident" id="5676953">seen</span>&nbsp;<span class="keyword" id="5676958">map</span><span class="op" id="5676961">[</span><span class="ident" id="5676962">typeId</span><span class="op" id="5676968">]</span><span class="builtintype" id="5676969">bool</span><span class="op" id="5676973">)</span>&nbsp;<span class="builtintype" id="5676975">string</span>&nbsp;<span class="op" id="5676982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5676985">if</span>&nbsp;<span class="ident" id="5676988">seen</span><span class="op" id="5676992">[</span><span class="ident" id="5676993">m</span><span class="op" id="5676994">.</span><span class="ident" id="5676995">Id</span><span class="op" id="5676997">]</span>&nbsp;<span class="op" id="5676999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677003">return</span>&nbsp;<span class="ident" id="5677010">m</span><span class="op" id="5677011">.</span><span class="ident" id="5677012">Name</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5677018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677021">seen</span><span class="op" id="5677025">[</span><span class="ident" id="5677026">m</span><span class="op" id="5677027">.</span><span class="ident" id="5677028">Id</span><span class="op" id="5677030">]</span>&nbsp;<span class="op" id="5677032">=</span>&nbsp;<span class="builtintype" id="5677034">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677040">key</span>&nbsp;<span class="op" id="5677044">:=</span>&nbsp;<span class="ident" id="5677047">m</span><span class="op" id="5677048">.</span><span class="ident" id="5677049">Key</span><span class="op" id="5677052">.</span><span class="ident" id="5677053">gobType</span><span class="op" id="5677060">(</span><span class="op" id="5677061">)</span><span class="op" id="5677062">.</span><span class="ident" id="5677063">safeString</span><span class="op" id="5677073">(</span><span class="ident" id="5677074">seen</span><span class="op" id="5677078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677081">elem</span>&nbsp;<span class="op" id="5677086">:=</span>&nbsp;<span class="ident" id="5677089">m</span><span class="op" id="5677090">.</span><span class="ident" id="5677091">Elem</span><span class="op" id="5677095">.</span><span class="ident" id="5677096">gobType</span><span class="op" id="5677103">(</span><span class="op" id="5677104">)</span><span class="op" id="5677105">.</span><span class="ident" id="5677106">safeString</span><span class="op" id="5677116">(</span><span class="ident" id="5677117">seen</span><span class="op" id="5677121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677124">return</span>&nbsp;<span class="ident" id="5677131">fmt</span><span class="op" id="5677134">.</span><span class="ident" id="5677135">Sprintf</span><span class="op" id="5677142">(</span><span class="string" id="5677143">&#34;map[%s]%s&#34;</span><span class="op" id="5677154">,</span>&nbsp;<span class="ident" id="5677156">key</span><span class="op" id="5677159">,</span>&nbsp;<span class="ident" id="5677161">elem</span><span class="op" id="5677165">)</span><br>
<span class="lineno">370</span><span class="op" id="5677167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5677170">func</span>&nbsp;<span class="op" id="5677175">(</span><span class="ident" id="5677176">m</span>&nbsp;<span class="op" id="5677178">*</span><span class="ident" id="5677179">mapType</span><span class="op" id="5677186">)</span>&nbsp;<span class="builtintype" id="5677188">string</span><span class="op" id="5677194">(</span><span class="op" id="5677195">)</span>&nbsp;<span class="builtintype" id="5677197">string</span>&nbsp;<span class="op" id="5677204">{</span>&nbsp;<span class="keyword" id="5677206">return</span>&nbsp;<span class="ident" id="5677213">m</span><span class="op" id="5677214">.</span><span class="ident" id="5677215">safeString</span><span class="op" id="5677225">(</span><span class="builtinfunc" id="5677226">make</span><span class="op" id="5677230">(</span><span class="keyword" id="5677231">map</span><span class="op" id="5677234">[</span><span class="ident" id="5677235">typeId</span><span class="op" id="5677241">]</span><span class="builtintype" id="5677242">bool</span><span class="op" id="5677246">)</span><span class="op" id="5677247">)</span>&nbsp;<span class="op" id="5677249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5677252">//&nbsp;Slice&nbsp;type</span><br>
<span class="lineno">375</span><span class="keyword" id="5677266">type</span>&nbsp;<span class="ident" id="5677271">sliceType</span>&nbsp;<span class="keyword" id="5677281">struct</span>&nbsp;<span class="op" id="5677288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677291">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677303">Elem</span>&nbsp;<span class="ident" id="5677308">typeId</span><br>
<span class="lineno"></span><span class="op" id="5677315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="5677318">func</span>&nbsp;<span class="ident" id="5677323">newSliceType</span><span class="op" id="5677335">(</span><span class="ident" id="5677336">name</span>&nbsp;<span class="builtintype" id="5677341">string</span><span class="op" id="5677347">)</span>&nbsp;<span class="op" id="5677349">*</span><span class="ident" id="5677350">sliceType</span>&nbsp;<span class="op" id="5677360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677363">s</span>&nbsp;<span class="op" id="5677365">:=</span>&nbsp;<span class="op" id="5677368">&amp;</span><span class="ident" id="5677369">sliceType</span><span class="op" id="5677378">{</span><span class="ident" id="5677379">CommonType</span><span class="op" id="5677389">{</span><span class="ident" id="5677390">Name</span><span class="op" id="5677394">:</span>&nbsp;<span class="ident" id="5677396">name</span><span class="op" id="5677400">}</span><span class="op" id="5677401">,</span>&nbsp;<span class="num" id="5677403">0</span><span class="op" id="5677404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677407">return</span>&nbsp;<span class="ident" id="5677414">s</span><br>
<span class="lineno"></span><span class="op" id="5677416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="5677419">func</span>&nbsp;<span class="op" id="5677424">(</span><span class="ident" id="5677425">s</span>&nbsp;<span class="op" id="5677427">*</span><span class="ident" id="5677428">sliceType</span><span class="op" id="5677437">)</span>&nbsp;<span class="ident" id="5677439">init</span><span class="op" id="5677443">(</span><span class="ident" id="5677444">elem</span>&nbsp;<span class="ident" id="5677449">gobType</span><span class="op" id="5677456">)</span>&nbsp;<span class="op" id="5677458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5677461">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677536">setTypeId</span><span class="op" id="5677545">(</span><span class="ident" id="5677546">s</span><span class="op" id="5677547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5677550">//&nbsp;See&nbsp;the&nbsp;comments&nbsp;about&nbsp;ids&nbsp;in&nbsp;newTypeObject.&nbsp;Only&nbsp;slices&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5677615">//&nbsp;structs&nbsp;have&nbsp;mutual&nbsp;recursion.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677650">if</span>&nbsp;<span class="ident" id="5677653">elem</span><span class="op" id="5677657">.</span><span class="ident" id="5677658">id</span><span class="op" id="5677660">(</span><span class="op" id="5677661">)</span>&nbsp;<span class="op" id="5677663">==</span>&nbsp;<span class="num" id="5677666">0</span>&nbsp;<span class="op" id="5677668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677672">setTypeId</span><span class="op" id="5677681">(</span><span class="ident" id="5677682">elem</span><span class="op" id="5677686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5677689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677692">s</span><span class="op" id="5677693">.</span><span class="ident" id="5677694">Elem</span>&nbsp;<span class="op" id="5677699">=</span>&nbsp;<span class="ident" id="5677701">elem</span><span class="op" id="5677705">.</span><span class="ident" id="5677706">id</span><span class="op" id="5677708">(</span><span class="op" id="5677709">)</span><br>
<span class="lineno"></span><span class="op" id="5677711">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="5677714">func</span>&nbsp;<span class="op" id="5677719">(</span><span class="ident" id="5677720">s</span>&nbsp;<span class="op" id="5677722">*</span><span class="ident" id="5677723">sliceType</span><span class="op" id="5677732">)</span>&nbsp;<span class="ident" id="5677734">safeString</span><span class="op" id="5677744">(</span><span class="ident" id="5677745">seen</span>&nbsp;<span class="keyword" id="5677750">map</span><span class="op" id="5677753">[</span><span class="ident" id="5677754">typeId</span><span class="op" id="5677760">]</span><span class="builtintype" id="5677761">bool</span><span class="op" id="5677765">)</span>&nbsp;<span class="builtintype" id="5677767">string</span>&nbsp;<span class="op" id="5677774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677777">if</span>&nbsp;<span class="ident" id="5677780">seen</span><span class="op" id="5677784">[</span><span class="ident" id="5677785">s</span><span class="op" id="5677786">.</span><span class="ident" id="5677787">Id</span><span class="op" id="5677789">]</span>&nbsp;<span class="op" id="5677791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677795">return</span>&nbsp;<span class="ident" id="5677802">s</span><span class="op" id="5677803">.</span><span class="ident" id="5677804">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5677810">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5677813">seen</span><span class="op" id="5677817">[</span><span class="ident" id="5677818">s</span><span class="op" id="5677819">.</span><span class="ident" id="5677820">Id</span><span class="op" id="5677822">]</span>&nbsp;<span class="op" id="5677824">=</span>&nbsp;<span class="builtintype" id="5677826">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5677832">return</span>&nbsp;<span class="ident" id="5677839">fmt</span><span class="op" id="5677842">.</span><span class="ident" id="5677843">Sprintf</span><span class="op" id="5677850">(</span><span class="string" id="5677851">&#34;[]%s&#34;</span><span class="op" id="5677857">,</span>&nbsp;<span class="ident" id="5677859">s</span><span class="op" id="5677860">.</span><span class="ident" id="5677861">Elem</span><span class="op" id="5677865">.</span><span class="ident" id="5677866">gobType</span><span class="op" id="5677873">(</span><span class="op" id="5677874">)</span><span class="op" id="5677875">.</span><span class="ident" id="5677876">safeString</span><span class="op" id="5677886">(</span><span class="ident" id="5677887">seen</span><span class="op" id="5677891">)</span><span class="op" id="5677892">)</span><br>
<span class="lineno"></span><span class="op" id="5677894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5677897">func</span>&nbsp;<span class="op" id="5677902">(</span><span class="ident" id="5677903">s</span>&nbsp;<span class="op" id="5677905">*</span><span class="ident" id="5677906">sliceType</span><span class="op" id="5677915">)</span>&nbsp;<span class="builtintype" id="5677917">string</span><span class="op" id="5677923">(</span><span class="op" id="5677924">)</span>&nbsp;<span class="builtintype" id="5677926">string</span>&nbsp;<span class="op" id="5677933">{</span>&nbsp;<span class="keyword" id="5677935">return</span>&nbsp;<span class="ident" id="5677942">s</span><span class="op" id="5677943">.</span><span class="ident" id="5677944">safeString</span><span class="op" id="5677954">(</span><span class="builtinfunc" id="5677955">make</span><span class="op" id="5677959">(</span><span class="keyword" id="5677960">map</span><span class="op" id="5677963">[</span><span class="ident" id="5677964">typeId</span><span class="op" id="5677970">]</span><span class="builtintype" id="5677971">bool</span><span class="op" id="5677975">)</span><span class="op" id="5677976">)</span>&nbsp;<span class="op" id="5677978">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="5677981">//&nbsp;Struct&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5677996">type</span>&nbsp;<span class="ident" id="5678001">fieldType</span>&nbsp;<span class="keyword" id="5678011">struct</span>&nbsp;<span class="op" id="5678018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678021">Name</span>&nbsp;<span class="builtintype" id="5678026">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678034">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5678039">typeId</span><br>
<span class="lineno">410</span><span class="op" id="5678046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5678049">type</span>&nbsp;<span class="ident" id="5678054">structType</span>&nbsp;<span class="keyword" id="5678065">struct</span>&nbsp;<span class="op" id="5678072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678075">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678087">Field</span>&nbsp;<span class="op" id="5678093">[</span><span class="op" id="5678094">]</span><span class="op" id="5678095">*</span><span class="ident" id="5678096">fieldType</span><br>
<span class="lineno">415</span><span class="op" id="5678106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5678109">func</span>&nbsp;<span class="op" id="5678114">(</span><span class="ident" id="5678115">s</span>&nbsp;<span class="op" id="5678117">*</span><span class="ident" id="5678118">structType</span><span class="op" id="5678128">)</span>&nbsp;<span class="ident" id="5678130">safeString</span><span class="op" id="5678140">(</span><span class="ident" id="5678141">seen</span>&nbsp;<span class="keyword" id="5678146">map</span><span class="op" id="5678149">[</span><span class="ident" id="5678150">typeId</span><span class="op" id="5678156">]</span><span class="builtintype" id="5678157">bool</span><span class="op" id="5678161">)</span>&nbsp;<span class="builtintype" id="5678163">string</span>&nbsp;<span class="op" id="5678170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5678173">if</span>&nbsp;<span class="ident" id="5678176">s</span>&nbsp;<span class="op" id="5678178">==</span>&nbsp;<span class="builtintype" id="5678181">nil</span>&nbsp;<span class="op" id="5678185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5678189">return</span>&nbsp;<span class="string" id="5678196">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5678205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5678208">if</span>&nbsp;<span class="ident" id="5678211">_</span><span class="op" id="5678212">,</span>&nbsp;<span class="ident" id="5678214">ok</span>&nbsp;<span class="op" id="5678217">:=</span>&nbsp;<span class="ident" id="5678220">seen</span><span class="op" id="5678224">[</span><span class="ident" id="5678225">s</span><span class="op" id="5678226">.</span><span class="ident" id="5678227">Id</span><span class="op" id="5678229">]</span><span class="op" id="5678230">;</span>&nbsp;<span class="ident" id="5678232">ok</span>&nbsp;<span class="op" id="5678235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5678239">return</span>&nbsp;<span class="ident" id="5678246">s</span><span class="op" id="5678247">.</span><span class="ident" id="5678248">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5678254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678257">seen</span><span class="op" id="5678261">[</span><span class="ident" id="5678262">s</span><span class="op" id="5678263">.</span><span class="ident" id="5678264">Id</span><span class="op" id="5678266">]</span>&nbsp;<span class="op" id="5678268">=</span>&nbsp;<span class="builtintype" id="5678270">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678276">str</span>&nbsp;<span class="op" id="5678280">:=</span>&nbsp;<span class="ident" id="5678283">s</span><span class="op" id="5678284">.</span><span class="ident" id="5678285">Name</span>&nbsp;<span class="op" id="5678290">+</span>&nbsp;<span class="string" id="5678292">&#34;&nbsp;=&nbsp;struct&nbsp;{&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5678308">for</span>&nbsp;<span class="ident" id="5678312">_</span><span class="op" id="5678313">,</span>&nbsp;<span class="ident" id="5678315">f</span>&nbsp;<span class="op" id="5678317">:=</span>&nbsp;<span class="keyword" id="5678320">range</span>&nbsp;<span class="ident" id="5678326">s</span><span class="op" id="5678327">.</span><span class="ident" id="5678328">Field</span>&nbsp;<span class="op" id="5678334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678338">str</span>&nbsp;<span class="op" id="5678342">+=</span>&nbsp;<span class="ident" id="5678345">fmt</span><span class="op" id="5678348">.</span><span class="ident" id="5678349">Sprintf</span><span class="op" id="5678356">(</span><span class="string" id="5678357">&#34;%s&nbsp;%s;&nbsp;&#34;</span><span class="op" id="5678366">,</span>&nbsp;<span class="ident" id="5678368">f</span><span class="op" id="5678369">.</span><span class="ident" id="5678370">Name</span><span class="op" id="5678374">,</span>&nbsp;<span class="ident" id="5678376">f</span><span class="op" id="5678377">.</span><span class="ident" id="5678378">Id</span><span class="op" id="5678380">.</span><span class="ident" id="5678381">gobType</span><span class="op" id="5678388">(</span><span class="op" id="5678389">)</span><span class="op" id="5678390">.</span><span class="ident" id="5678391">safeString</span><span class="op" id="5678401">(</span><span class="ident" id="5678402">seen</span><span class="op" id="5678406">)</span><span class="op" id="5678407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5678410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678413">str</span>&nbsp;<span class="op" id="5678417">+=</span>&nbsp;<span class="string" id="5678420">&#34;}&#34;</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5678425">return</span>&nbsp;<span class="ident" id="5678432">str</span><br>
<span class="lineno"></span><span class="op" id="5678436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5678439">func</span>&nbsp;<span class="op" id="5678444">(</span><span class="ident" id="5678445">s</span>&nbsp;<span class="op" id="5678447">*</span><span class="ident" id="5678448">structType</span><span class="op" id="5678458">)</span>&nbsp;<span class="builtintype" id="5678460">string</span><span class="op" id="5678466">(</span><span class="op" id="5678467">)</span>&nbsp;<span class="builtintype" id="5678469">string</span>&nbsp;<span class="op" id="5678476">{</span>&nbsp;<span class="keyword" id="5678478">return</span>&nbsp;<span class="ident" id="5678485">s</span><span class="op" id="5678486">.</span><span class="ident" id="5678487">safeString</span><span class="op" id="5678497">(</span><span class="builtinfunc" id="5678498">make</span><span class="op" id="5678502">(</span><span class="keyword" id="5678503">map</span><span class="op" id="5678506">[</span><span class="ident" id="5678507">typeId</span><span class="op" id="5678513">]</span><span class="builtintype" id="5678514">bool</span><span class="op" id="5678518">)</span><span class="op" id="5678519">)</span>&nbsp;<span class="op" id="5678521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="5678524">func</span>&nbsp;<span class="ident" id="5678529">newStructType</span><span class="op" id="5678542">(</span><span class="ident" id="5678543">name</span>&nbsp;<span class="builtintype" id="5678548">string</span><span class="op" id="5678554">)</span>&nbsp;<span class="op" id="5678556">*</span><span class="ident" id="5678557">structType</span>&nbsp;<span class="op" id="5678568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678571">s</span>&nbsp;<span class="op" id="5678573">:=</span>&nbsp;<span class="op" id="5678576">&amp;</span><span class="ident" id="5678577">structType</span><span class="op" id="5678587">{</span><span class="ident" id="5678588">CommonType</span><span class="op" id="5678598">{</span><span class="ident" id="5678599">Name</span><span class="op" id="5678603">:</span>&nbsp;<span class="ident" id="5678605">name</span><span class="op" id="5678609">}</span><span class="op" id="5678610">,</span>&nbsp;<span class="builtintype" id="5678612">nil</span><span class="op" id="5678615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5678618">//&nbsp;For&nbsp;historical&nbsp;reasons&nbsp;we&nbsp;set&nbsp;the&nbsp;id&nbsp;here&nbsp;rather&nbsp;than&nbsp;init.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5678682">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;newTypeObject&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5678732">setTypeId</span><span class="op" id="5678741">(</span><span class="ident" id="5678742">s</span><span class="op" id="5678743">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5678746">return</span>&nbsp;<span class="ident" id="5678753">s</span><br>
<span class="lineno"></span><span class="op" id="5678755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5678758">//&nbsp;newTypeObject&nbsp;allocates&nbsp;a&nbsp;gobType&nbsp;for&nbsp;the&nbsp;reflection&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="5678823">//&nbsp;Unless&nbsp;ut&nbsp;represents&nbsp;a&nbsp;GobEncoder,&nbsp;rt&nbsp;should&nbsp;be&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno">445</span><span class="comment" id="5678888">//&nbsp;of&nbsp;ut.</span><br>
<span class="lineno"></span><span class="comment" id="5678898">//&nbsp;This&nbsp;is&nbsp;only&nbsp;called&nbsp;from&nbsp;the&nbsp;encoding&nbsp;side.&nbsp;The&nbsp;decoding&nbsp;side</span><br>
<span class="lineno"></span><span class="comment" id="5678963">//&nbsp;works&nbsp;through&nbsp;typeIds&nbsp;and&nbsp;userTypeInfos&nbsp;alone.</span><br>
<span class="lineno"></span><span class="keyword" id="5679013">func</span>&nbsp;<span class="ident" id="5679018">newTypeObject</span><span class="op" id="5679031">(</span><span class="ident" id="5679032">name</span>&nbsp;<span class="builtintype" id="5679037">string</span><span class="op" id="5679043">,</span>&nbsp;<span class="ident" id="5679045">ut</span>&nbsp;<span class="op" id="5679048">*</span><span class="ident" id="5679049">userTypeInfo</span><span class="op" id="5679061">,</span>&nbsp;<span class="ident" id="5679063">rt</span>&nbsp;<span class="ident" id="5679066">reflect</span><span class="op" id="5679073">.</span><span class="ident" id="5679074">Type</span><span class="op" id="5679078">)</span>&nbsp;<span class="op" id="5679080">(</span><span class="ident" id="5679081">gobType</span><span class="op" id="5679088">,</span>&nbsp;<span class="builtintype" id="5679090">error</span><span class="op" id="5679095">)</span>&nbsp;<span class="op" id="5679097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5679100">//&nbsp;Does&nbsp;this&nbsp;type&nbsp;implement&nbsp;GobEncoder?</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679141">if</span>&nbsp;<span class="ident" id="5679144">ut</span><span class="op" id="5679146">.</span><span class="ident" id="5679147">externalEnc</span>&nbsp;<span class="op" id="5679159">!=</span>&nbsp;<span class="num" id="5679162">0</span>&nbsp;<span class="op" id="5679164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679168">return</span>&nbsp;<span class="ident" id="5679175">newGobEncoderType</span><span class="op" id="5679192">(</span><span class="ident" id="5679193">name</span><span class="op" id="5679197">)</span><span class="op" id="5679198">,</span>&nbsp;<span class="builtintype" id="5679200">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679208">var</span>&nbsp;<span class="ident" id="5679212">err</span>&nbsp;<span class="builtintype" id="5679216">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679223">var</span>&nbsp;<span class="ident" id="5679227">type0</span><span class="op" id="5679232">,</span>&nbsp;<span class="ident" id="5679234">type1</span>&nbsp;<span class="ident" id="5679240">gobType</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679249">defer</span>&nbsp;<span class="keyword" id="5679255">func</span><span class="op" id="5679259">(</span><span class="op" id="5679260">)</span>&nbsp;<span class="op" id="5679262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679266">if</span>&nbsp;<span class="ident" id="5679269">err</span>&nbsp;<span class="op" id="5679273">!=</span>&nbsp;<span class="builtintype" id="5679276">nil</span>&nbsp;<span class="op" id="5679280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5679285">delete</span><span class="op" id="5679291">(</span><span class="ident" id="5679292">types</span><span class="op" id="5679297">,</span>&nbsp;<span class="ident" id="5679299">rt</span><span class="op" id="5679301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679308">}</span><span class="op" id="5679309">(</span><span class="op" id="5679310">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5679313">//&nbsp;Install&nbsp;the&nbsp;top-level&nbsp;type&nbsp;before&nbsp;the&nbsp;subtypes&nbsp;(e.g.&nbsp;struct&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5679384">//&nbsp;fields)&nbsp;so&nbsp;recursive&nbsp;types&nbsp;can&nbsp;be&nbsp;constructed&nbsp;safely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679442">switch</span>&nbsp;<span class="ident" id="5679449">t</span>&nbsp;<span class="op" id="5679451">:=</span>&nbsp;<span class="ident" id="5679454">rt</span><span class="op" id="5679456">;</span>&nbsp;<span class="ident" id="5679458">t</span><span class="op" id="5679459">.</span><span class="ident" id="5679460">Kind</span><span class="op" id="5679464">(</span><span class="op" id="5679465">)</span>&nbsp;<span class="op" id="5679467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5679470">//&nbsp;All&nbsp;basic&nbsp;types&nbsp;are&nbsp;easy:&nbsp;they&nbsp;are&nbsp;predefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679521">case</span>&nbsp;<span class="ident" id="5679526">reflect</span><span class="op" id="5679533">.</span><span class="ident" id="5679534">Bool</span><span class="op" id="5679538">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679542">return</span>&nbsp;<span class="ident" id="5679549">tBool</span><span class="op" id="5679554">.</span><span class="ident" id="5679555">gobType</span><span class="op" id="5679562">(</span><span class="op" id="5679563">)</span><span class="op" id="5679564">,</span>&nbsp;<span class="builtintype" id="5679566">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679572">case</span>&nbsp;<span class="ident" id="5679577">reflect</span><span class="op" id="5679584">.</span><span class="ident" id="5679585">Int</span><span class="op" id="5679588">,</span>&nbsp;<span class="ident" id="5679590">reflect</span><span class="op" id="5679597">.</span><span class="ident" id="5679598">Int8</span><span class="op" id="5679602">,</span>&nbsp;<span class="ident" id="5679604">reflect</span><span class="op" id="5679611">.</span><span class="ident" id="5679612">Int16</span><span class="op" id="5679617">,</span>&nbsp;<span class="ident" id="5679619">reflect</span><span class="op" id="5679626">.</span><span class="ident" id="5679627">Int32</span><span class="op" id="5679632">,</span>&nbsp;<span class="ident" id="5679634">reflect</span><span class="op" id="5679641">.</span><span class="ident" id="5679642">Int64</span><span class="op" id="5679647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679651">return</span>&nbsp;<span class="ident" id="5679658">tInt</span><span class="op" id="5679662">.</span><span class="ident" id="5679663">gobType</span><span class="op" id="5679670">(</span><span class="op" id="5679671">)</span><span class="op" id="5679672">,</span>&nbsp;<span class="builtintype" id="5679674">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679680">case</span>&nbsp;<span class="ident" id="5679685">reflect</span><span class="op" id="5679692">.</span><span class="ident" id="5679693">Uint</span><span class="op" id="5679697">,</span>&nbsp;<span class="ident" id="5679699">reflect</span><span class="op" id="5679706">.</span><span class="ident" id="5679707">Uint8</span><span class="op" id="5679712">,</span>&nbsp;<span class="ident" id="5679714">reflect</span><span class="op" id="5679721">.</span><span class="ident" id="5679722">Uint16</span><span class="op" id="5679728">,</span>&nbsp;<span class="ident" id="5679730">reflect</span><span class="op" id="5679737">.</span><span class="ident" id="5679738">Uint32</span><span class="op" id="5679744">,</span>&nbsp;<span class="ident" id="5679746">reflect</span><span class="op" id="5679753">.</span><span class="ident" id="5679754">Uint64</span><span class="op" id="5679760">,</span>&nbsp;<span class="ident" id="5679762">reflect</span><span class="op" id="5679769">.</span><span class="ident" id="5679770">Uintptr</span><span class="op" id="5679777">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679781">return</span>&nbsp;<span class="ident" id="5679788">tUint</span><span class="op" id="5679793">.</span><span class="ident" id="5679794">gobType</span><span class="op" id="5679801">(</span><span class="op" id="5679802">)</span><span class="op" id="5679803">,</span>&nbsp;<span class="builtintype" id="5679805">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679811">case</span>&nbsp;<span class="ident" id="5679816">reflect</span><span class="op" id="5679823">.</span><span class="ident" id="5679824">Float32</span><span class="op" id="5679831">,</span>&nbsp;<span class="ident" id="5679833">reflect</span><span class="op" id="5679840">.</span><span class="ident" id="5679841">Float64</span><span class="op" id="5679848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679852">return</span>&nbsp;<span class="ident" id="5679859">tFloat</span><span class="op" id="5679865">.</span><span class="ident" id="5679866">gobType</span><span class="op" id="5679873">(</span><span class="op" id="5679874">)</span><span class="op" id="5679875">,</span>&nbsp;<span class="builtintype" id="5679877">nil</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679883">case</span>&nbsp;<span class="ident" id="5679888">reflect</span><span class="op" id="5679895">.</span><span class="ident" id="5679896">Complex64</span><span class="op" id="5679905">,</span>&nbsp;<span class="ident" id="5679907">reflect</span><span class="op" id="5679914">.</span><span class="ident" id="5679915">Complex128</span><span class="op" id="5679925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679929">return</span>&nbsp;<span class="ident" id="5679936">tComplex</span><span class="op" id="5679944">.</span><span class="ident" id="5679945">gobType</span><span class="op" id="5679952">(</span><span class="op" id="5679953">)</span><span class="op" id="5679954">,</span>&nbsp;<span class="builtintype" id="5679956">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679962">case</span>&nbsp;<span class="ident" id="5679967">reflect</span><span class="op" id="5679974">.</span><span class="ident" id="5679975">String</span><span class="op" id="5679981">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5679985">return</span>&nbsp;<span class="ident" id="5679992">tString</span><span class="op" id="5679999">.</span><span class="ident" id="5680000">gobType</span><span class="op" id="5680007">(</span><span class="op" id="5680008">)</span><span class="op" id="5680009">,</span>&nbsp;<span class="builtintype" id="5680011">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680017">case</span>&nbsp;<span class="ident" id="5680022">reflect</span><span class="op" id="5680029">.</span><span class="ident" id="5680030">Interface</span><span class="op" id="5680039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680043">return</span>&nbsp;<span class="ident" id="5680050">tInterface</span><span class="op" id="5680060">.</span><span class="ident" id="5680061">gobType</span><span class="op" id="5680068">(</span><span class="op" id="5680069">)</span><span class="op" id="5680070">,</span>&nbsp;<span class="builtintype" id="5680072">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680078">case</span>&nbsp;<span class="ident" id="5680083">reflect</span><span class="op" id="5680090">.</span><span class="ident" id="5680091">Array</span><span class="op" id="5680096">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680100">at</span>&nbsp;<span class="op" id="5680103">:=</span>&nbsp;<span class="ident" id="5680106">newArrayType</span><span class="op" id="5680118">(</span><span class="ident" id="5680119">name</span><span class="op" id="5680123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680127">types</span><span class="op" id="5680132">[</span><span class="ident" id="5680133">rt</span><span class="op" id="5680135">]</span>&nbsp;<span class="op" id="5680137">=</span>&nbsp;<span class="ident" id="5680139">at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680144">type0</span><span class="op" id="5680149">,</span>&nbsp;<span class="ident" id="5680151">err</span>&nbsp;<span class="op" id="5680155">=</span>&nbsp;<span class="ident" id="5680157">getBaseType</span><span class="op" id="5680168">(</span><span class="string" id="5680169">&#34;&#34;</span><span class="op" id="5680171">,</span>&nbsp;<span class="ident" id="5680173">t</span><span class="op" id="5680174">.</span><span class="ident" id="5680175">Elem</span><span class="op" id="5680179">(</span><span class="op" id="5680180">)</span><span class="op" id="5680181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680185">if</span>&nbsp;<span class="ident" id="5680188">err</span>&nbsp;<span class="op" id="5680192">!=</span>&nbsp;<span class="builtintype" id="5680195">nil</span>&nbsp;<span class="op" id="5680199">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680204">return</span>&nbsp;<span class="builtintype" id="5680211">nil</span><span class="op" id="5680214">,</span>&nbsp;<span class="ident" id="5680216">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5680222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680226">//&nbsp;Historical&nbsp;aside:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680249">//&nbsp;For&nbsp;arrays,&nbsp;maps,&nbsp;and&nbsp;slices,&nbsp;we&nbsp;set&nbsp;the&nbsp;type&nbsp;id&nbsp;after&nbsp;the&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680322">//&nbsp;are&nbsp;constructed.&nbsp;This&nbsp;is&nbsp;to&nbsp;retain&nbsp;the&nbsp;order&nbsp;of&nbsp;type&nbsp;id&nbsp;allocation&nbsp;after</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680400">//&nbsp;a&nbsp;fix&nbsp;made&nbsp;to&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;which&nbsp;changed&nbsp;the&nbsp;order&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680470">//&nbsp;which&nbsp;types&nbsp;are&nbsp;built.&nbsp;&nbsp;Delaying&nbsp;the&nbsp;setting&nbsp;in&nbsp;this&nbsp;way&nbsp;preserves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680542">//&nbsp;type&nbsp;ids&nbsp;while&nbsp;allowing&nbsp;recursive&nbsp;types&nbsp;to&nbsp;be&nbsp;described.&nbsp;Structs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680613">//&nbsp;done&nbsp;below,&nbsp;were&nbsp;already&nbsp;handling&nbsp;recursion&nbsp;correctly&nbsp;so&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5680680">//&nbsp;assign&nbsp;the&nbsp;top-level&nbsp;id&nbsp;before&nbsp;those&nbsp;of&nbsp;the&nbsp;field.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680736">at</span><span class="op" id="5680738">.</span><span class="ident" id="5680739">init</span><span class="op" id="5680743">(</span><span class="ident" id="5680744">type0</span><span class="op" id="5680749">,</span>&nbsp;<span class="ident" id="5680751">t</span><span class="op" id="5680752">.</span><span class="ident" id="5680753">Len</span><span class="op" id="5680756">(</span><span class="op" id="5680757">)</span><span class="op" id="5680758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680762">return</span>&nbsp;<span class="ident" id="5680769">at</span><span class="op" id="5680771">,</span>&nbsp;<span class="builtintype" id="5680773">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680779">case</span>&nbsp;<span class="ident" id="5680784">reflect</span><span class="op" id="5680791">.</span><span class="ident" id="5680792">Map</span><span class="op" id="5680795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680799">mt</span>&nbsp;<span class="op" id="5680802">:=</span>&nbsp;<span class="ident" id="5680805">newMapType</span><span class="op" id="5680815">(</span><span class="ident" id="5680816">name</span><span class="op" id="5680820">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680824">types</span><span class="op" id="5680829">[</span><span class="ident" id="5680830">rt</span><span class="op" id="5680832">]</span>&nbsp;<span class="op" id="5680834">=</span>&nbsp;<span class="ident" id="5680836">mt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680841">type0</span><span class="op" id="5680846">,</span>&nbsp;<span class="ident" id="5680848">err</span>&nbsp;<span class="op" id="5680852">=</span>&nbsp;<span class="ident" id="5680854">getBaseType</span><span class="op" id="5680865">(</span><span class="string" id="5680866">&#34;&#34;</span><span class="op" id="5680868">,</span>&nbsp;<span class="ident" id="5680870">t</span><span class="op" id="5680871">.</span><span class="ident" id="5680872">Key</span><span class="op" id="5680875">(</span><span class="op" id="5680876">)</span><span class="op" id="5680877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680881">if</span>&nbsp;<span class="ident" id="5680884">err</span>&nbsp;<span class="op" id="5680888">!=</span>&nbsp;<span class="builtintype" id="5680891">nil</span>&nbsp;<span class="op" id="5680895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680900">return</span>&nbsp;<span class="builtintype" id="5680907">nil</span><span class="op" id="5680910">,</span>&nbsp;<span class="ident" id="5680912">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5680918">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680922">type1</span><span class="op" id="5680927">,</span>&nbsp;<span class="ident" id="5680929">err</span>&nbsp;<span class="op" id="5680933">=</span>&nbsp;<span class="ident" id="5680935">getBaseType</span><span class="op" id="5680946">(</span><span class="string" id="5680947">&#34;&#34;</span><span class="op" id="5680949">,</span>&nbsp;<span class="ident" id="5680951">t</span><span class="op" id="5680952">.</span><span class="ident" id="5680953">Elem</span><span class="op" id="5680957">(</span><span class="op" id="5680958">)</span><span class="op" id="5680959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680963">if</span>&nbsp;<span class="ident" id="5680966">err</span>&nbsp;<span class="op" id="5680970">!=</span>&nbsp;<span class="builtintype" id="5680973">nil</span>&nbsp;<span class="op" id="5680977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680982">return</span>&nbsp;<span class="builtintype" id="5680989">nil</span><span class="op" id="5680992">,</span>&nbsp;<span class="ident" id="5680994">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5681000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681004">mt</span><span class="op" id="5681006">.</span><span class="ident" id="5681007">init</span><span class="op" id="5681011">(</span><span class="ident" id="5681012">type0</span><span class="op" id="5681017">,</span>&nbsp;<span class="ident" id="5681019">type1</span><span class="op" id="5681024">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681028">return</span>&nbsp;<span class="ident" id="5681035">mt</span><span class="op" id="5681037">,</span>&nbsp;<span class="builtintype" id="5681039">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681045">case</span>&nbsp;<span class="ident" id="5681050">reflect</span><span class="op" id="5681057">.</span><span class="ident" id="5681058">Slice</span><span class="op" id="5681063">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5681067">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681108">if</span>&nbsp;<span class="ident" id="5681111">t</span><span class="op" id="5681112">.</span><span class="ident" id="5681113">Elem</span><span class="op" id="5681117">(</span><span class="op" id="5681118">)</span><span class="op" id="5681119">.</span><span class="ident" id="5681120">Kind</span><span class="op" id="5681124">(</span><span class="op" id="5681125">)</span>&nbsp;<span class="op" id="5681127">==</span>&nbsp;<span class="ident" id="5681130">reflect</span><span class="op" id="5681137">.</span><span class="ident" id="5681138">Uint8</span>&nbsp;<span class="op" id="5681144">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681149">return</span>&nbsp;<span class="ident" id="5681156">tBytes</span><span class="op" id="5681162">.</span><span class="ident" id="5681163">gobType</span><span class="op" id="5681170">(</span><span class="op" id="5681171">)</span><span class="op" id="5681172">,</span>&nbsp;<span class="builtintype" id="5681174">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5681180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681184">st</span>&nbsp;<span class="op" id="5681187">:=</span>&nbsp;<span class="ident" id="5681190">newSliceType</span><span class="op" id="5681202">(</span><span class="ident" id="5681203">name</span><span class="op" id="5681207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681211">types</span><span class="op" id="5681216">[</span><span class="ident" id="5681217">rt</span><span class="op" id="5681219">]</span>&nbsp;<span class="op" id="5681221">=</span>&nbsp;<span class="ident" id="5681223">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681228">type0</span><span class="op" id="5681233">,</span>&nbsp;<span class="ident" id="5681235">err</span>&nbsp;<span class="op" id="5681239">=</span>&nbsp;<span class="ident" id="5681241">getBaseType</span><span class="op" id="5681252">(</span><span class="ident" id="5681253">t</span><span class="op" id="5681254">.</span><span class="ident" id="5681255">Elem</span><span class="op" id="5681259">(</span><span class="op" id="5681260">)</span><span class="op" id="5681261">.</span><span class="ident" id="5681262">Name</span><span class="op" id="5681266">(</span><span class="op" id="5681267">)</span><span class="op" id="5681268">,</span>&nbsp;<span class="ident" id="5681270">t</span><span class="op" id="5681271">.</span><span class="ident" id="5681272">Elem</span><span class="op" id="5681276">(</span><span class="op" id="5681277">)</span><span class="op" id="5681278">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681282">if</span>&nbsp;<span class="ident" id="5681285">err</span>&nbsp;<span class="op" id="5681289">!=</span>&nbsp;<span class="builtintype" id="5681292">nil</span>&nbsp;<span class="op" id="5681296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681301">return</span>&nbsp;<span class="builtintype" id="5681308">nil</span><span class="op" id="5681311">,</span>&nbsp;<span class="ident" id="5681313">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5681319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681323">st</span><span class="op" id="5681325">.</span><span class="ident" id="5681326">init</span><span class="op" id="5681330">(</span><span class="ident" id="5681331">type0</span><span class="op" id="5681336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681340">return</span>&nbsp;<span class="ident" id="5681347">st</span><span class="op" id="5681349">,</span>&nbsp;<span class="builtintype" id="5681351">nil</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681357">case</span>&nbsp;<span class="ident" id="5681362">reflect</span><span class="op" id="5681369">.</span><span class="ident" id="5681370">Struct</span><span class="op" id="5681376">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681380">st</span>&nbsp;<span class="op" id="5681383">:=</span>&nbsp;<span class="ident" id="5681386">newStructType</span><span class="op" id="5681399">(</span><span class="ident" id="5681400">name</span><span class="op" id="5681404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681408">types</span><span class="op" id="5681413">[</span><span class="ident" id="5681414">rt</span><span class="op" id="5681416">]</span>&nbsp;<span class="op" id="5681418">=</span>&nbsp;<span class="ident" id="5681420">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681425">idToType</span><span class="op" id="5681433">[</span><span class="ident" id="5681434">st</span><span class="op" id="5681436">.</span><span class="ident" id="5681437">id</span><span class="op" id="5681439">(</span><span class="op" id="5681440">)</span><span class="op" id="5681441">]</span>&nbsp;<span class="op" id="5681443">=</span>&nbsp;<span class="ident" id="5681445">st</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681450">for</span>&nbsp;<span class="ident" id="5681454">i</span>&nbsp;<span class="op" id="5681456">:=</span>&nbsp;<span class="num" id="5681459">0</span><span class="op" id="5681460">;</span>&nbsp;<span class="ident" id="5681462">i</span>&nbsp;<span class="op" id="5681464">&lt;</span>&nbsp;<span class="ident" id="5681466">t</span><span class="op" id="5681467">.</span><span class="ident" id="5681468">NumField</span><span class="op" id="5681476">(</span><span class="op" id="5681477">)</span><span class="op" id="5681478">;</span>&nbsp;<span class="ident" id="5681480">i</span><span class="op" id="5681481">++</span>&nbsp;<span class="op" id="5681484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681489">f</span>&nbsp;<span class="op" id="5681491">:=</span>&nbsp;<span class="ident" id="5681494">t</span><span class="op" id="5681495">.</span><span class="ident" id="5681496">Field</span><span class="op" id="5681501">(</span><span class="ident" id="5681502">i</span><span class="op" id="5681503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681508">if</span>&nbsp;<span class="op" id="5681511">!</span><span class="ident" id="5681512">isSent</span><span class="op" id="5681518">(</span><span class="op" id="5681519">&amp;</span><span class="ident" id="5681520">f</span><span class="op" id="5681521">)</span>&nbsp;<span class="op" id="5681523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681529">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5681541">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681546">typ</span>&nbsp;<span class="op" id="5681550">:=</span>&nbsp;<span class="ident" id="5681553">userType</span><span class="op" id="5681561">(</span><span class="ident" id="5681562">f</span><span class="op" id="5681563">.</span><span class="ident" id="5681564">Type</span><span class="op" id="5681568">)</span><span class="op" id="5681569">.</span><span class="ident" id="5681570">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681578">tname</span>&nbsp;<span class="op" id="5681584">:=</span>&nbsp;<span class="ident" id="5681587">typ</span><span class="op" id="5681590">.</span><span class="ident" id="5681591">Name</span><span class="op" id="5681595">(</span><span class="op" id="5681596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681601">if</span>&nbsp;<span class="ident" id="5681604">tname</span>&nbsp;<span class="op" id="5681610">==</span>&nbsp;<span class="string" id="5681613">&#34;&#34;</span>&nbsp;<span class="op" id="5681616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681622">t</span>&nbsp;<span class="op" id="5681624">:=</span>&nbsp;<span class="ident" id="5681627">userType</span><span class="op" id="5681635">(</span><span class="ident" id="5681636">f</span><span class="op" id="5681637">.</span><span class="ident" id="5681638">Type</span><span class="op" id="5681642">)</span><span class="op" id="5681643">.</span><span class="ident" id="5681644">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681653">tname</span>&nbsp;<span class="op" id="5681659">=</span>&nbsp;<span class="ident" id="5681661">t</span><span class="op" id="5681662">.</span><span class="ident" id="5681663">String</span><span class="op" id="5681669">(</span><span class="op" id="5681670">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5681675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681680">gt</span><span class="op" id="5681682">,</span>&nbsp;<span class="ident" id="5681684">err</span>&nbsp;<span class="op" id="5681688">:=</span>&nbsp;<span class="ident" id="5681691">getBaseType</span><span class="op" id="5681702">(</span><span class="ident" id="5681703">tname</span><span class="op" id="5681708">,</span>&nbsp;<span class="ident" id="5681710">f</span><span class="op" id="5681711">.</span><span class="ident" id="5681712">Type</span><span class="op" id="5681716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681721">if</span>&nbsp;<span class="ident" id="5681724">err</span>&nbsp;<span class="op" id="5681728">!=</span>&nbsp;<span class="builtintype" id="5681731">nil</span>&nbsp;<span class="op" id="5681735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5681741">return</span>&nbsp;<span class="builtintype" id="5681748">nil</span><span class="op" id="5681751">,</span>&nbsp;<span class="ident" id="5681753">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5681760">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5681765">//&nbsp;Some&nbsp;mutually&nbsp;recursive&nbsp;types&nbsp;can&nbsp;cause&nbsp;us&nbsp;to&nbsp;be&nbsp;here&nbsp;while</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5681831">//&nbsp;still&nbsp;defining&nbsp;the&nbsp;element.&nbsp;Fix&nbsp;the&nbsp;element&nbsp;type&nbsp;id&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5681895">//&nbsp;We&nbsp;could&nbsp;do&nbsp;this&nbsp;more&nbsp;neatly&nbsp;by&nbsp;setting&nbsp;the&nbsp;id&nbsp;at&nbsp;the&nbsp;start&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5681964">//&nbsp;building&nbsp;every&nbsp;type,&nbsp;but&nbsp;that&nbsp;would&nbsp;break&nbsp;binary&nbsp;compatibility.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682034">if</span>&nbsp;<span class="ident" id="5682037">gt</span><span class="op" id="5682039">.</span><span class="ident" id="5682040">id</span><span class="op" id="5682042">(</span><span class="op" id="5682043">)</span>&nbsp;<span class="op" id="5682045">==</span>&nbsp;<span class="num" id="5682048">0</span>&nbsp;<span class="op" id="5682050">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682056">setTypeId</span><span class="op" id="5682065">(</span><span class="ident" id="5682066">gt</span><span class="op" id="5682068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5682073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682078">st</span><span class="op" id="5682080">.</span><span class="ident" id="5682081">Field</span>&nbsp;<span class="op" id="5682087">=</span>&nbsp;<span class="builtinfunc" id="5682089">append</span><span class="op" id="5682095">(</span><span class="ident" id="5682096">st</span><span class="op" id="5682098">.</span><span class="ident" id="5682099">Field</span><span class="op" id="5682104">,</span>&nbsp;<span class="op" id="5682106">&amp;</span><span class="ident" id="5682107">fieldType</span><span class="op" id="5682116">{</span><span class="ident" id="5682117">f</span><span class="op" id="5682118">.</span><span class="ident" id="5682119">Name</span><span class="op" id="5682123">,</span>&nbsp;<span class="ident" id="5682125">gt</span><span class="op" id="5682127">.</span><span class="ident" id="5682128">id</span><span class="op" id="5682130">(</span><span class="op" id="5682131">)</span><span class="op" id="5682132">}</span><span class="op" id="5682133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5682137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682141">return</span>&nbsp;<span class="ident" id="5682148">st</span><span class="op" id="5682150">,</span>&nbsp;<span class="builtintype" id="5682152">nil</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682158">default</span><span class="op" id="5682165">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682169">return</span>&nbsp;<span class="builtintype" id="5682176">nil</span><span class="op" id="5682179">,</span>&nbsp;<span class="ident" id="5682181">errors</span><span class="op" id="5682187">.</span><span class="ident" id="5682188">New</span><span class="op" id="5682191">(</span><span class="string" id="5682192">&#34;gob&nbsp;NewTypeObject&nbsp;can&#39;t&nbsp;handle&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="5682232">+</span>&nbsp;<span class="ident" id="5682234">rt</span><span class="op" id="5682236">.</span><span class="ident" id="5682237">String</span><span class="op" id="5682243">(</span><span class="op" id="5682244">)</span><span class="op" id="5682245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5682248">}</span><br>
<span class="lineno"></span><span class="op" id="5682250">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5682253">//&nbsp;isExported&nbsp;reports&nbsp;whether&nbsp;this&nbsp;is&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5682324">func</span>&nbsp;<span class="ident" id="5682329">isExported</span><span class="op" id="5682339">(</span><span class="ident" id="5682340">name</span>&nbsp;<span class="builtintype" id="5682345">string</span><span class="op" id="5682351">)</span>&nbsp;<span class="builtintype" id="5682353">bool</span>&nbsp;<span class="op" id="5682358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5682361">rune</span><span class="op" id="5682365">,</span>&nbsp;<span class="ident" id="5682367">_</span>&nbsp;<span class="op" id="5682369">:=</span>&nbsp;<span class="ident" id="5682372">utf8</span><span class="op" id="5682376">.</span><span class="ident" id="5682377">DecodeRuneInString</span><span class="op" id="5682395">(</span><span class="ident" id="5682396">name</span><span class="op" id="5682400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682403">return</span>&nbsp;<span class="ident" id="5682410">unicode</span><span class="op" id="5682417">.</span><span class="ident" id="5682418">IsUpper</span><span class="op" id="5682425">(</span><span class="builtintype" id="5682426">rune</span><span class="op" id="5682430">)</span><br>
<span class="lineno">570</span><span class="op" id="5682432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5682435">//&nbsp;isSent&nbsp;reports&nbsp;whether&nbsp;this&nbsp;struct&nbsp;field&nbsp;is&nbsp;to&nbsp;be&nbsp;transmitted.</span><br>
<span class="lineno"></span><span class="comment" id="5682501">//&nbsp;It&nbsp;will&nbsp;be&nbsp;transmitted&nbsp;only&nbsp;if&nbsp;it&nbsp;is&nbsp;exported&nbsp;and&nbsp;not&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5682579">//&nbsp;or&nbsp;pointer&nbsp;to&nbsp;chan&nbsp;or&nbsp;func.</span><br>
<span class="lineno">575</span><span class="keyword" id="5682610">func</span>&nbsp;<span class="ident" id="5682615">isSent</span><span class="op" id="5682621">(</span><span class="ident" id="5682622">field</span>&nbsp;<span class="op" id="5682628">*</span><span class="ident" id="5682629">reflect</span><span class="op" id="5682636">.</span><span class="ident" id="5682637">StructField</span><span class="op" id="5682648">)</span>&nbsp;<span class="builtintype" id="5682650">bool</span>&nbsp;<span class="op" id="5682655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682658">if</span>&nbsp;<span class="op" id="5682661">!</span><span class="ident" id="5682662">isExported</span><span class="op" id="5682672">(</span><span class="ident" id="5682673">field</span><span class="op" id="5682678">.</span><span class="ident" id="5682679">Name</span><span class="op" id="5682683">)</span>&nbsp;<span class="op" id="5682685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682689">return</span>&nbsp;<span class="builtintype" id="5682696">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5682703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5682706">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;or&nbsp;pointer&nbsp;thereto,&nbsp;don&#39;t&nbsp;send&nbsp;it.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5682776">//&nbsp;That&nbsp;is,&nbsp;treat&nbsp;it&nbsp;like&nbsp;an&nbsp;unexported&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682824">typ</span>&nbsp;<span class="op" id="5682828">:=</span>&nbsp;<span class="ident" id="5682831">field</span><span class="op" id="5682836">.</span><span class="ident" id="5682837">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682843">for</span>&nbsp;<span class="ident" id="5682847">typ</span><span class="op" id="5682850">.</span><span class="ident" id="5682851">Kind</span><span class="op" id="5682855">(</span><span class="op" id="5682856">)</span>&nbsp;<span class="op" id="5682858">==</span>&nbsp;<span class="ident" id="5682861">reflect</span><span class="op" id="5682868">.</span><span class="ident" id="5682869">Ptr</span>&nbsp;<span class="op" id="5682873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682877">typ</span>&nbsp;<span class="op" id="5682881">=</span>&nbsp;<span class="ident" id="5682883">typ</span><span class="op" id="5682886">.</span><span class="ident" id="5682887">Elem</span><span class="op" id="5682891">(</span><span class="op" id="5682892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5682895">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682898">if</span>&nbsp;<span class="ident" id="5682901">typ</span><span class="op" id="5682904">.</span><span class="ident" id="5682905">Kind</span><span class="op" id="5682909">(</span><span class="op" id="5682910">)</span>&nbsp;<span class="op" id="5682912">==</span>&nbsp;<span class="ident" id="5682915">reflect</span><span class="op" id="5682922">.</span><span class="ident" id="5682923">Chan</span>&nbsp;<span class="op" id="5682928">||</span>&nbsp;<span class="ident" id="5682931">typ</span><span class="op" id="5682934">.</span><span class="ident" id="5682935">Kind</span><span class="op" id="5682939">(</span><span class="op" id="5682940">)</span>&nbsp;<span class="op" id="5682942">==</span>&nbsp;<span class="ident" id="5682945">reflect</span><span class="op" id="5682952">.</span><span class="ident" id="5682953">Func</span>&nbsp;<span class="op" id="5682958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682962">return</span>&nbsp;<span class="builtintype" id="5682969">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5682976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5682979">return</span>&nbsp;<span class="builtintype" id="5682986">true</span><br>
<span class="lineno"></span><span class="op" id="5682991">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="5682994">//&nbsp;getBaseType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type&#39;s&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5683077">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5683103">func</span>&nbsp;<span class="ident" id="5683108">getBaseType</span><span class="op" id="5683119">(</span><span class="ident" id="5683120">name</span>&nbsp;<span class="builtintype" id="5683125">string</span><span class="op" id="5683131">,</span>&nbsp;<span class="ident" id="5683133">rt</span>&nbsp;<span class="ident" id="5683136">reflect</span><span class="op" id="5683143">.</span><span class="ident" id="5683144">Type</span><span class="op" id="5683148">)</span>&nbsp;<span class="op" id="5683150">(</span><span class="ident" id="5683151">gobType</span><span class="op" id="5683158">,</span>&nbsp;<span class="builtintype" id="5683160">error</span><span class="op" id="5683165">)</span>&nbsp;<span class="op" id="5683167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683170">ut</span>&nbsp;<span class="op" id="5683173">:=</span>&nbsp;<span class="ident" id="5683176">userType</span><span class="op" id="5683184">(</span><span class="ident" id="5683185">rt</span><span class="op" id="5683187">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683190">return</span>&nbsp;<span class="ident" id="5683197">getType</span><span class="op" id="5683204">(</span><span class="ident" id="5683205">name</span><span class="op" id="5683209">,</span>&nbsp;<span class="ident" id="5683211">ut</span><span class="op" id="5683213">,</span>&nbsp;<span class="ident" id="5683215">ut</span><span class="op" id="5683217">.</span><span class="ident" id="5683218">base</span><span class="op" id="5683222">)</span><br>
<span class="lineno"></span><span class="op" id="5683224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5683227">//&nbsp;getType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type.</span><br>
<span class="lineno"></span><span class="comment" id="5683294">//&nbsp;Should&nbsp;be&nbsp;called&nbsp;only&nbsp;when&nbsp;handling&nbsp;GobEncoders/Decoders,</span><br>
<span class="lineno">600</span><span class="comment" id="5683355">//&nbsp;which&nbsp;may&nbsp;be&nbsp;pointers.&nbsp;&nbsp;All&nbsp;other&nbsp;types&nbsp;are&nbsp;handled&nbsp;through&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5683422">//&nbsp;base&nbsp;type,&nbsp;never&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="5683453">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5683479">func</span>&nbsp;<span class="ident" id="5683484">getType</span><span class="op" id="5683491">(</span><span class="ident" id="5683492">name</span>&nbsp;<span class="builtintype" id="5683497">string</span><span class="op" id="5683503">,</span>&nbsp;<span class="ident" id="5683505">ut</span>&nbsp;<span class="op" id="5683508">*</span><span class="ident" id="5683509">userTypeInfo</span><span class="op" id="5683521">,</span>&nbsp;<span class="ident" id="5683523">rt</span>&nbsp;<span class="ident" id="5683526">reflect</span><span class="op" id="5683533">.</span><span class="ident" id="5683534">Type</span><span class="op" id="5683538">)</span>&nbsp;<span class="op" id="5683540">(</span><span class="ident" id="5683541">gobType</span><span class="op" id="5683548">,</span>&nbsp;<span class="builtintype" id="5683550">error</span><span class="op" id="5683555">)</span>&nbsp;<span class="op" id="5683557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683560">typ</span><span class="op" id="5683563">,</span>&nbsp;<span class="ident" id="5683565">present</span>&nbsp;<span class="op" id="5683573">:=</span>&nbsp;<span class="ident" id="5683576">types</span><span class="op" id="5683581">[</span><span class="ident" id="5683582">rt</span><span class="op" id="5683584">]</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683587">if</span>&nbsp;<span class="ident" id="5683590">present</span>&nbsp;<span class="op" id="5683598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683602">return</span>&nbsp;<span class="ident" id="5683609">typ</span><span class="op" id="5683612">,</span>&nbsp;<span class="builtintype" id="5683614">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5683619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683622">typ</span><span class="op" id="5683625">,</span>&nbsp;<span class="ident" id="5683627">err</span>&nbsp;<span class="op" id="5683631">:=</span>&nbsp;<span class="ident" id="5683634">newTypeObject</span><span class="op" id="5683647">(</span><span class="ident" id="5683648">name</span><span class="op" id="5683652">,</span>&nbsp;<span class="ident" id="5683654">ut</span><span class="op" id="5683656">,</span>&nbsp;<span class="ident" id="5683658">rt</span><span class="op" id="5683660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683663">if</span>&nbsp;<span class="ident" id="5683666">err</span>&nbsp;<span class="op" id="5683670">==</span>&nbsp;<span class="builtintype" id="5683673">nil</span>&nbsp;<span class="op" id="5683677">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683681">types</span><span class="op" id="5683686">[</span><span class="ident" id="5683687">rt</span><span class="op" id="5683689">]</span>&nbsp;<span class="op" id="5683691">=</span>&nbsp;<span class="ident" id="5683693">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5683698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683701">return</span>&nbsp;<span class="ident" id="5683708">typ</span><span class="op" id="5683711">,</span>&nbsp;<span class="ident" id="5683713">err</span><br>
<span class="lineno"></span><span class="op" id="5683717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="5683720">func</span>&nbsp;<span class="ident" id="5683725">checkId</span><span class="op" id="5683732">(</span><span class="ident" id="5683733">want</span><span class="op" id="5683737">,</span>&nbsp;<span class="ident" id="5683739">got</span>&nbsp;<span class="ident" id="5683743">typeId</span><span class="op" id="5683749">)</span>&nbsp;<span class="op" id="5683751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5683754">if</span>&nbsp;<span class="ident" id="5683757">want</span>&nbsp;<span class="op" id="5683762">!=</span>&nbsp;<span class="ident" id="5683765">got</span>&nbsp;<span class="op" id="5683769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683773">fmt</span><span class="op" id="5683776">.</span><span class="ident" id="5683777">Fprintf</span><span class="op" id="5683784">(</span><span class="ident" id="5683785">os</span><span class="op" id="5683787">.</span><span class="ident" id="5683788">Stderr</span><span class="op" id="5683794">,</span>&nbsp;<span class="string" id="5683796">&#34;checkId:&nbsp;%d&nbsp;should&nbsp;be&nbsp;%d\n&#34;</span><span class="op" id="5683824">,</span>&nbsp;<span class="builtintype" id="5683826">int</span><span class="op" id="5683829">(</span><span class="ident" id="5683830">got</span><span class="op" id="5683833">)</span><span class="op" id="5683834">,</span>&nbsp;<span class="builtintype" id="5683836">int</span><span class="op" id="5683839">(</span><span class="ident" id="5683840">want</span><span class="op" id="5683844">)</span><span class="op" id="5683845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5683849">panic</span><span class="op" id="5683854">(</span><span class="string" id="5683855">&#34;bootstrap&nbsp;type&nbsp;wrong&nbsp;id:&nbsp;&#34;</span>&nbsp;<span class="op" id="5683883">+</span>&nbsp;<span class="ident" id="5683885">got</span><span class="op" id="5683888">.</span><span class="ident" id="5683889">name</span><span class="op" id="5683893">(</span><span class="op" id="5683894">)</span>&nbsp;<span class="op" id="5683896">+</span>&nbsp;<span class="string" id="5683898">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5683902">+</span>&nbsp;<span class="ident" id="5683904">got</span><span class="op" id="5683907">.</span><span class="builtintype" id="5683908">string</span><span class="op" id="5683914">(</span><span class="op" id="5683915">)</span>&nbsp;<span class="op" id="5683917">+</span>&nbsp;<span class="string" id="5683919">&#34;&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="5683927">+</span>&nbsp;<span class="ident" id="5683929">want</span><span class="op" id="5683933">.</span><span class="builtintype" id="5683934">string</span><span class="op" id="5683940">(</span><span class="op" id="5683941">)</span><span class="op" id="5683942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5683945">}</span><br>
<span class="lineno">620</span><span class="op" id="5683947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5683950">//&nbsp;used&nbsp;for&nbsp;building&nbsp;the&nbsp;basic&nbsp;types;&nbsp;called&nbsp;only&nbsp;from&nbsp;init().&nbsp;&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5684027">//&nbsp;interface&nbsp;always&nbsp;refers&nbsp;to&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="keyword" id="5684068">func</span>&nbsp;<span class="ident" id="5684073">bootstrapType</span><span class="op" id="5684086">(</span><span class="ident" id="5684087">name</span>&nbsp;<span class="builtintype" id="5684092">string</span><span class="op" id="5684098">,</span>&nbsp;<span class="ident" id="5684100">e</span>&nbsp;<span class="keyword" id="5684102">interface</span><span class="op" id="5684111">{</span><span class="op" id="5684112">}</span><span class="op" id="5684113">,</span>&nbsp;<span class="ident" id="5684115">expect</span>&nbsp;<span class="ident" id="5684122">typeId</span><span class="op" id="5684128">)</span>&nbsp;<span class="ident" id="5684130">typeId</span>&nbsp;<span class="op" id="5684137">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684140">rt</span>&nbsp;<span class="op" id="5684143">:=</span>&nbsp;<span class="ident" id="5684146">reflect</span><span class="op" id="5684153">.</span><span class="ident" id="5684154">TypeOf</span><span class="op" id="5684160">(</span><span class="ident" id="5684161">e</span><span class="op" id="5684162">)</span><span class="op" id="5684163">.</span><span class="ident" id="5684164">Elem</span><span class="op" id="5684168">(</span><span class="op" id="5684169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684172">_</span><span class="op" id="5684173">,</span>&nbsp;<span class="ident" id="5684175">present</span>&nbsp;<span class="op" id="5684183">:=</span>&nbsp;<span class="ident" id="5684186">types</span><span class="op" id="5684191">[</span><span class="ident" id="5684192">rt</span><span class="op" id="5684194">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5684197">if</span>&nbsp;<span class="ident" id="5684200">present</span>&nbsp;<span class="op" id="5684208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5684212">panic</span><span class="op" id="5684217">(</span><span class="string" id="5684218">&#34;bootstrap&nbsp;type&nbsp;already&nbsp;present:&nbsp;&#34;</span>&nbsp;<span class="op" id="5684253">+</span>&nbsp;<span class="ident" id="5684255">name</span>&nbsp;<span class="op" id="5684260">+</span>&nbsp;<span class="string" id="5684262">&#34;,&nbsp;&#34;</span>&nbsp;<span class="op" id="5684267">+</span>&nbsp;<span class="ident" id="5684269">rt</span><span class="op" id="5684271">.</span><span class="ident" id="5684272">String</span><span class="op" id="5684278">(</span><span class="op" id="5684279">)</span><span class="op" id="5684280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5684283">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684286">typ</span>&nbsp;<span class="op" id="5684290">:=</span>&nbsp;<span class="op" id="5684293">&amp;</span><span class="ident" id="5684294">CommonType</span><span class="op" id="5684304">{</span><span class="ident" id="5684305">Name</span><span class="op" id="5684309">:</span>&nbsp;<span class="ident" id="5684311">name</span><span class="op" id="5684315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684318">types</span><span class="op" id="5684323">[</span><span class="ident" id="5684324">rt</span><span class="op" id="5684326">]</span>&nbsp;<span class="op" id="5684328">=</span>&nbsp;<span class="ident" id="5684330">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684335">setTypeId</span><span class="op" id="5684344">(</span><span class="ident" id="5684345">typ</span><span class="op" id="5684348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684351">checkId</span><span class="op" id="5684358">(</span><span class="ident" id="5684359">expect</span><span class="op" id="5684365">,</span>&nbsp;<span class="ident" id="5684367">nextId</span><span class="op" id="5684373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684376">userType</span><span class="op" id="5684384">(</span><span class="ident" id="5684385">rt</span><span class="op" id="5684387">)</span>&nbsp;<span class="comment" id="5684389">//&nbsp;might&nbsp;as&nbsp;well&nbsp;cache&nbsp;it&nbsp;now</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5684420">return</span>&nbsp;<span class="ident" id="5684427">nextId</span><br>
<span class="lineno"></span><span class="op" id="5684434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5684437">//&nbsp;Representation&nbsp;of&nbsp;the&nbsp;information&nbsp;we&nbsp;send&nbsp;and&nbsp;receive&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5684511">//&nbsp;Each&nbsp;value&nbsp;we&nbsp;send&nbsp;is&nbsp;preceded&nbsp;by&nbsp;its&nbsp;type&nbsp;definition:&nbsp;an&nbsp;encoded&nbsp;int.</span><br>
<span class="lineno">640</span><span class="comment" id="5684585">//&nbsp;However,&nbsp;the&nbsp;very&nbsp;first&nbsp;time&nbsp;we&nbsp;send&nbsp;the&nbsp;value,&nbsp;we&nbsp;first&nbsp;send&nbsp;the&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="5684659">//&nbsp;(-id,&nbsp;wireType).</span><br>
<span class="lineno"></span><span class="comment" id="5684679">//&nbsp;For&nbsp;bootstrapping&nbsp;purposes,&nbsp;we&nbsp;assume&nbsp;that&nbsp;the&nbsp;recipient&nbsp;knows&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="5684749">//&nbsp;to&nbsp;decode&nbsp;a&nbsp;wireType;&nbsp;it&nbsp;is&nbsp;exactly&nbsp;the&nbsp;wireType&nbsp;struct&nbsp;here,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="5684826">//&nbsp;using&nbsp;the&nbsp;gob&nbsp;rules&nbsp;for&nbsp;sending&nbsp;a&nbsp;structure,&nbsp;except&nbsp;that&nbsp;we&nbsp;assume&nbsp;the</span><br>
<span class="lineno">645</span><span class="comment" id="5684900">//&nbsp;ids&nbsp;for&nbsp;wireType&nbsp;and&nbsp;structType&nbsp;etc.&nbsp;are&nbsp;known.&nbsp;&nbsp;The&nbsp;relevant&nbsp;pieces</span><br>
<span class="lineno"></span><span class="comment" id="5684972">//&nbsp;are&nbsp;built&nbsp;in&nbsp;encode.go&#39;s&nbsp;init()&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5685017">//&nbsp;To&nbsp;maintain&nbsp;binary&nbsp;compatibility,&nbsp;if&nbsp;you&nbsp;extend&nbsp;this&nbsp;type,&nbsp;always&nbsp;put</span><br>
<span class="lineno"></span><span class="comment" id="5685090">//&nbsp;the&nbsp;new&nbsp;fields&nbsp;last.</span><br>
<span class="lineno"></span><span class="keyword" id="5685114">type</span>&nbsp;<span class="ident" id="5685119">wireType</span>&nbsp;<span class="keyword" id="5685128">struct</span>&nbsp;<span class="op" id="5685135">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685138">ArrayT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5685155">*</span><span class="ident" id="5685156">arrayType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685167">SliceT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5685184">*</span><span class="ident" id="5685185">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685196">StructT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5685213">*</span><span class="ident" id="5685214">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685226">MapT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5685243">*</span><span class="ident" id="5685244">mapType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685253">GobEncoderT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5685270">*</span><span class="ident" id="5685271">gobEncoderType</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685287">BinaryMarshalerT</span>&nbsp;<span class="op" id="5685304">*</span><span class="ident" id="5685305">gobEncoderType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685321">TextMarshalerT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5685338">*</span><span class="ident" id="5685339">gobEncoderType</span><br>
<span class="lineno"></span><span class="op" id="5685354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5685357">func</span>&nbsp;<span class="op" id="5685362">(</span><span class="ident" id="5685363">w</span>&nbsp;<span class="op" id="5685365">*</span><span class="ident" id="5685366">wireType</span><span class="op" id="5685374">)</span>&nbsp;<span class="builtintype" id="5685376">string</span><span class="op" id="5685382">(</span><span class="op" id="5685383">)</span>&nbsp;<span class="builtintype" id="5685385">string</span>&nbsp;<span class="op" id="5685392">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685395">const</span>&nbsp;<span class="ident" id="5685401">unknown</span>&nbsp;<span class="op" id="5685409">=</span>&nbsp;<span class="string" id="5685411">&#34;unknown&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685427">if</span>&nbsp;<span class="ident" id="5685430">w</span>&nbsp;<span class="op" id="5685432">==</span>&nbsp;<span class="builtintype" id="5685435">nil</span>&nbsp;<span class="op" id="5685439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685443">return</span>&nbsp;<span class="ident" id="5685450">unknown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5685459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685462">switch</span>&nbsp;<span class="op" id="5685469">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685472">case</span>&nbsp;<span class="ident" id="5685477">w</span><span class="op" id="5685478">.</span><span class="ident" id="5685479">ArrayT</span>&nbsp;<span class="op" id="5685486">!=</span>&nbsp;<span class="builtintype" id="5685489">nil</span><span class="op" id="5685492">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685496">return</span>&nbsp;<span class="ident" id="5685503">w</span><span class="op" id="5685504">.</span><span class="ident" id="5685505">ArrayT</span><span class="op" id="5685511">.</span><span class="ident" id="5685512">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685518">case</span>&nbsp;<span class="ident" id="5685523">w</span><span class="op" id="5685524">.</span><span class="ident" id="5685525">SliceT</span>&nbsp;<span class="op" id="5685532">!=</span>&nbsp;<span class="builtintype" id="5685535">nil</span><span class="op" id="5685538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685542">return</span>&nbsp;<span class="ident" id="5685549">w</span><span class="op" id="5685550">.</span><span class="ident" id="5685551">SliceT</span><span class="op" id="5685557">.</span><span class="ident" id="5685558">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685564">case</span>&nbsp;<span class="ident" id="5685569">w</span><span class="op" id="5685570">.</span><span class="ident" id="5685571">StructT</span>&nbsp;<span class="op" id="5685579">!=</span>&nbsp;<span class="builtintype" id="5685582">nil</span><span class="op" id="5685585">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685589">return</span>&nbsp;<span class="ident" id="5685596">w</span><span class="op" id="5685597">.</span><span class="ident" id="5685598">StructT</span><span class="op" id="5685605">.</span><span class="ident" id="5685606">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685612">case</span>&nbsp;<span class="ident" id="5685617">w</span><span class="op" id="5685618">.</span><span class="ident" id="5685619">MapT</span>&nbsp;<span class="op" id="5685624">!=</span>&nbsp;<span class="builtintype" id="5685627">nil</span><span class="op" id="5685630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685634">return</span>&nbsp;<span class="ident" id="5685641">w</span><span class="op" id="5685642">.</span><span class="ident" id="5685643">MapT</span><span class="op" id="5685647">.</span><span class="ident" id="5685648">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685654">case</span>&nbsp;<span class="ident" id="5685659">w</span><span class="op" id="5685660">.</span><span class="ident" id="5685661">GobEncoderT</span>&nbsp;<span class="op" id="5685673">!=</span>&nbsp;<span class="builtintype" id="5685676">nil</span><span class="op" id="5685679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685683">return</span>&nbsp;<span class="ident" id="5685690">w</span><span class="op" id="5685691">.</span><span class="ident" id="5685692">GobEncoderT</span><span class="op" id="5685703">.</span><span class="ident" id="5685704">Name</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685710">case</span>&nbsp;<span class="ident" id="5685715">w</span><span class="op" id="5685716">.</span><span class="ident" id="5685717">BinaryMarshalerT</span>&nbsp;<span class="op" id="5685734">!=</span>&nbsp;<span class="builtintype" id="5685737">nil</span><span class="op" id="5685740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685744">return</span>&nbsp;<span class="ident" id="5685751">w</span><span class="op" id="5685752">.</span><span class="ident" id="5685753">BinaryMarshalerT</span><span class="op" id="5685769">.</span><span class="ident" id="5685770">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685776">case</span>&nbsp;<span class="ident" id="5685781">w</span><span class="op" id="5685782">.</span><span class="ident" id="5685783">TextMarshalerT</span>&nbsp;<span class="op" id="5685798">!=</span>&nbsp;<span class="builtintype" id="5685801">nil</span><span class="op" id="5685804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685808">return</span>&nbsp;<span class="ident" id="5685815">w</span><span class="op" id="5685816">.</span><span class="ident" id="5685817">TextMarshalerT</span><span class="op" id="5685831">.</span><span class="ident" id="5685832">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5685838">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5685841">return</span>&nbsp;<span class="ident" id="5685848">unknown</span><br>
<span class="lineno"></span><span class="op" id="5685856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5685859">type</span>&nbsp;<span class="ident" id="5685864">typeInfo</span>&nbsp;<span class="keyword" id="5685873">struct</span>&nbsp;<span class="op" id="5685880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685883">id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685891">typeId</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685899">encInit</span>&nbsp;<span class="ident" id="5685907">sync</span><span class="op" id="5685911">.</span><span class="ident" id="5685912">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5685920">//&nbsp;protects&nbsp;creation&nbsp;of&nbsp;encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685953">encoder</span>&nbsp;<span class="ident" id="5685961">atomic</span><span class="op" id="5685967">.</span><span class="ident" id="5685968">Value</span>&nbsp;<span class="comment" id="5685974">//&nbsp;*encEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5685989">wire</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5685997">*</span><span class="ident" id="5685998">wireType</span><br>
<span class="lineno"></span><span class="op" id="5686007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span><span class="comment" id="5686010">//&nbsp;typeInfoMap&nbsp;is&nbsp;an&nbsp;atomic&nbsp;pointer&nbsp;to&nbsp;map[reflect.Type]*typeInfo.</span><br>
<span class="lineno"></span><span class="comment" id="5686077">//&nbsp;It&#39;s&nbsp;updated&nbsp;copy-on-write.&nbsp;Readers&nbsp;just&nbsp;do&nbsp;an&nbsp;atomic&nbsp;load</span><br>
<span class="lineno"></span><span class="comment" id="5686139">//&nbsp;to&nbsp;get&nbsp;the&nbsp;current&nbsp;version&nbsp;of&nbsp;the&nbsp;map.&nbsp;Writers&nbsp;make&nbsp;a&nbsp;full&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5686209">//&nbsp;the&nbsp;map&nbsp;and&nbsp;atomically&nbsp;update&nbsp;the&nbsp;pointer&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;new&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="5686279">//&nbsp;Under&nbsp;heavy&nbsp;read&nbsp;contention,&nbsp;this&nbsp;is&nbsp;significantly&nbsp;faster&nbsp;than&nbsp;a&nbsp;map</span><br>
<span class="lineno">695</span><span class="comment" id="5686351">//&nbsp;protected&nbsp;by&nbsp;a&nbsp;mutex.</span><br>
<span class="lineno"></span><span class="keyword" id="5686376">var</span>&nbsp;<span class="ident" id="5686380">typeInfoMap</span>&nbsp;<span class="ident" id="5686392">atomic</span><span class="op" id="5686398">.</span><span class="ident" id="5686399">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5686406">func</span>&nbsp;<span class="ident" id="5686411">lookupTypeInfo</span><span class="op" id="5686425">(</span><span class="ident" id="5686426">rt</span>&nbsp;<span class="ident" id="5686429">reflect</span><span class="op" id="5686436">.</span><span class="ident" id="5686437">Type</span><span class="op" id="5686441">)</span>&nbsp;<span class="op" id="5686443">*</span><span class="ident" id="5686444">typeInfo</span>&nbsp;<span class="op" id="5686453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5686456">m</span><span class="op" id="5686457">,</span>&nbsp;<span class="ident" id="5686459">_</span>&nbsp;<span class="op" id="5686461">:=</span>&nbsp;<span class="ident" id="5686464">typeInfoMap</span><span class="op" id="5686475">.</span><span class="ident" id="5686476">Load</span><span class="op" id="5686480">(</span><span class="op" id="5686481">)</span><span class="op" id="5686482">.</span><span class="op" id="5686483">(</span><span class="keyword" id="5686484">map</span><span class="op" id="5686487">[</span><span class="ident" id="5686488">reflect</span><span class="op" id="5686495">.</span><span class="ident" id="5686496">Type</span><span class="op" id="5686500">]</span><span class="op" id="5686501">*</span><span class="ident" id="5686502">typeInfo</span><span class="op" id="5686510">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5686513">return</span>&nbsp;<span class="ident" id="5686520">m</span><span class="op" id="5686521">[</span><span class="ident" id="5686522">rt</span><span class="op" id="5686524">]</span><br>
<span class="lineno"></span><span class="op" id="5686526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5686529">func</span>&nbsp;<span class="ident" id="5686534">getTypeInfo</span><span class="op" id="5686545">(</span><span class="ident" id="5686546">ut</span>&nbsp;<span class="op" id="5686549">*</span><span class="ident" id="5686550">userTypeInfo</span><span class="op" id="5686562">)</span>&nbsp;<span class="op" id="5686564">(</span><span class="op" id="5686565">*</span><span class="ident" id="5686566">typeInfo</span><span class="op" id="5686574">,</span>&nbsp;<span class="builtintype" id="5686576">error</span><span class="op" id="5686581">)</span>&nbsp;<span class="op" id="5686583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5686586">rt</span>&nbsp;<span class="op" id="5686589">:=</span>&nbsp;<span class="ident" id="5686592">ut</span><span class="op" id="5686594">.</span><span class="ident" id="5686595">base</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5686601">if</span>&nbsp;<span class="ident" id="5686604">ut</span><span class="op" id="5686606">.</span><span class="ident" id="5686607">externalEnc</span>&nbsp;<span class="op" id="5686619">!=</span>&nbsp;<span class="num" id="5686622">0</span>&nbsp;<span class="op" id="5686624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5686628">//&nbsp;We&nbsp;want&nbsp;the&nbsp;user&nbsp;type,&nbsp;not&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5686675">rt</span>&nbsp;<span class="op" id="5686678">=</span>&nbsp;<span class="ident" id="5686680">ut</span><span class="op" id="5686682">.</span><span class="ident" id="5686683">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5686689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5686692">if</span>&nbsp;<span class="ident" id="5686695">info</span>&nbsp;<span class="op" id="5686700">:=</span>&nbsp;<span class="ident" id="5686703">lookupTypeInfo</span><span class="op" id="5686717">(</span><span class="ident" id="5686718">rt</span><span class="op" id="5686720">)</span><span class="op" id="5686721">;</span>&nbsp;<span class="ident" id="5686723">info</span>&nbsp;<span class="op" id="5686728">!=</span>&nbsp;<span class="builtintype" id="5686731">nil</span>&nbsp;<span class="op" id="5686735">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5686739">return</span>&nbsp;<span class="ident" id="5686746">info</span><span class="op" id="5686750">,</span>&nbsp;<span class="builtintype" id="5686752">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5686757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5686760">return</span>&nbsp;<span class="ident" id="5686767">buildTypeInfo</span><span class="op" id="5686780">(</span><span class="ident" id="5686781">ut</span><span class="op" id="5686783">,</span>&nbsp;<span class="ident" id="5686785">rt</span><span class="op" id="5686787">)</span><br>
<span class="lineno"></span><span class="op" id="5686789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">715</span><span class="comment" id="5686792">//&nbsp;buildTypeInfo&nbsp;constructs&nbsp;the&nbsp;type&nbsp;information&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5686854">//&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;type&nbsp;info&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="5686893">func</span>&nbsp;<span class="ident" id="5686898">buildTypeInfo</span><span class="op" id="5686911">(</span><span class="ident" id="5686912">ut</span>&nbsp;<span class="op" id="5686915">*</span><span class="ident" id="5686916">userTypeInfo</span><span class="op" id="5686928">,</span>&nbsp;<span class="ident" id="5686930">rt</span>&nbsp;<span class="ident" id="5686933">reflect</span><span class="op" id="5686940">.</span><span class="ident" id="5686941">Type</span><span class="op" id="5686945">)</span>&nbsp;<span class="op" id="5686947">(</span><span class="op" id="5686948">*</span><span class="ident" id="5686949">typeInfo</span><span class="op" id="5686957">,</span>&nbsp;<span class="builtintype" id="5686959">error</span><span class="op" id="5686964">)</span>&nbsp;<span class="op" id="5686966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5686969">typeLock</span><span class="op" id="5686977">.</span><span class="ident" id="5686978">Lock</span><span class="op" id="5686982">(</span><span class="op" id="5686983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5686986">defer</span>&nbsp;<span class="ident" id="5686992">typeLock</span><span class="op" id="5687000">.</span><span class="ident" id="5687001">Unlock</span><span class="op" id="5687007">(</span><span class="op" id="5687008">)</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687012">if</span>&nbsp;<span class="ident" id="5687015">info</span>&nbsp;<span class="op" id="5687020">:=</span>&nbsp;<span class="ident" id="5687023">lookupTypeInfo</span><span class="op" id="5687037">(</span><span class="ident" id="5687038">rt</span><span class="op" id="5687040">)</span><span class="op" id="5687041">;</span>&nbsp;<span class="ident" id="5687043">info</span>&nbsp;<span class="op" id="5687048">!=</span>&nbsp;<span class="builtintype" id="5687051">nil</span>&nbsp;<span class="op" id="5687055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687059">return</span>&nbsp;<span class="ident" id="5687066">info</span><span class="op" id="5687070">,</span>&nbsp;<span class="builtintype" id="5687072">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5687077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5687081">gt</span><span class="op" id="5687083">,</span>&nbsp;<span class="ident" id="5687085">err</span>&nbsp;<span class="op" id="5687089">:=</span>&nbsp;<span class="ident" id="5687092">getBaseType</span><span class="op" id="5687103">(</span><span class="ident" id="5687104">rt</span><span class="op" id="5687106">.</span><span class="ident" id="5687107">Name</span><span class="op" id="5687111">(</span><span class="op" id="5687112">)</span><span class="op" id="5687113">,</span>&nbsp;<span class="ident" id="5687115">rt</span><span class="op" id="5687117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687120">if</span>&nbsp;<span class="ident" id="5687123">err</span>&nbsp;<span class="op" id="5687127">!=</span>&nbsp;<span class="builtintype" id="5687130">nil</span>&nbsp;<span class="op" id="5687134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687138">return</span>&nbsp;<span class="builtintype" id="5687145">nil</span><span class="op" id="5687148">,</span>&nbsp;<span class="ident" id="5687150">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5687155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5687158">info</span>&nbsp;<span class="op" id="5687163">:=</span>&nbsp;<span class="op" id="5687166">&amp;</span><span class="ident" id="5687167">typeInfo</span><span class="op" id="5687175">{</span><span class="ident" id="5687176">id</span><span class="op" id="5687178">:</span>&nbsp;<span class="ident" id="5687180">gt</span><span class="op" id="5687182">.</span><span class="ident" id="5687183">id</span><span class="op" id="5687185">(</span><span class="op" id="5687186">)</span><span class="op" id="5687187">}</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687191">if</span>&nbsp;<span class="ident" id="5687194">ut</span><span class="op" id="5687196">.</span><span class="ident" id="5687197">externalEnc</span>&nbsp;<span class="op" id="5687209">!=</span>&nbsp;<span class="num" id="5687212">0</span>&nbsp;<span class="op" id="5687214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5687218">userType</span><span class="op" id="5687226">,</span>&nbsp;<span class="ident" id="5687228">err</span>&nbsp;<span class="op" id="5687232">:=</span>&nbsp;<span class="ident" id="5687235">getType</span><span class="op" id="5687242">(</span><span class="ident" id="5687243">rt</span><span class="op" id="5687245">.</span><span class="ident" id="5687246">Name</span><span class="op" id="5687250">(</span><span class="op" id="5687251">)</span><span class="op" id="5687252">,</span>&nbsp;<span class="ident" id="5687254">ut</span><span class="op" id="5687256">,</span>&nbsp;<span class="ident" id="5687258">rt</span><span class="op" id="5687260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687264">if</span>&nbsp;<span class="ident" id="5687267">err</span>&nbsp;<span class="op" id="5687271">!=</span>&nbsp;<span class="builtintype" id="5687274">nil</span>&nbsp;<span class="op" id="5687278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687283">return</span>&nbsp;<span class="builtintype" id="5687290">nil</span><span class="op" id="5687293">,</span>&nbsp;<span class="ident" id="5687295">err</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5687301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5687305">gt</span>&nbsp;<span class="op" id="5687308">:=</span>&nbsp;<span class="ident" id="5687311">userType</span><span class="op" id="5687319">.</span><span class="ident" id="5687320">id</span><span class="op" id="5687322">(</span><span class="op" id="5687323">)</span><span class="op" id="5687324">.</span><span class="ident" id="5687325">gobType</span><span class="op" id="5687332">(</span><span class="op" id="5687333">)</span><span class="op" id="5687334">.</span><span class="op" id="5687335">(</span><span class="op" id="5687336">*</span><span class="ident" id="5687337">gobEncoderType</span><span class="op" id="5687351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687355">switch</span>&nbsp;<span class="ident" id="5687362">ut</span><span class="op" id="5687364">.</span><span class="ident" id="5687365">externalEnc</span>&nbsp;<span class="op" id="5687377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687381">case</span>&nbsp;<span class="ident" id="5687386">xGob</span><span class="op" id="5687390">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5687395">info</span><span class="op" id="5687399">.</span><span class="ident" id="5687400">wire</span>&nbsp;<span class="op" id="5687405">=</span>&nbsp;<span class="op" id="5687407">&amp;</span><span class="ident" id="5687408">wireType</span><span class="op" id="5687416">{</span><span class="ident" id="5687417">GobEncoderT</span><span class="op" id="5687428">:</span>&nbsp;<span class="ident" id="5687430">gt</span><span class="op" id="5687432">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687436">case</span>&nbsp;<span class="ident" id="5687441">xBinary</span><span class="op" id="5687448">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5687453">info</span><span class="op" id="5687457">.</span><span class="ident" id="5687458">wire</span>&nbsp;<span class="op" id="5687463">=</span>&nbsp;<span class="op" id="5687465">&amp;</span><span class="ident" id="5687466">wireType</span><span class="op" id="5687474">{</span><span class="ident" id="5687475">BinaryMarshalerT</span><span class="op" id="5687491">:</span>&nbsp;<span class="ident" id="5687493">gt</span><span class="op" id="5687495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687499">case</span>&nbsp;<span class="ident" id="5687504">xText</span><span class="op" id="5687509">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5687514">info</span><span class="op" id="5687518">.</span><span class="ident" id="5687519">wire</span>&nbsp;<span class="op" id="5687524">=</span>&nbsp;<span class="op" id="5687526">&amp;</span><span class="ident" id="5687527">wireType</span><span class="op" id="5687535">{</span><span class="ident" id="5687536">TextMarshalerT</span><span class="op" id="5687550">:</span>&nbsp;<span class="ident" id="5687552">gt</span><span class="op" id="5687554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5687558">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5687562">rt</span>&nbsp;<span class="op" id="5687565">=</span>&nbsp;<span class="ident" id="5687567">ut</span><span class="op" id="5687569">.</span><span class="ident" id="5687570">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5687576">}</span>&nbsp;<span class="keyword" id="5687578">else</span>&nbsp;<span class="op" id="5687583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5687587">t</span>&nbsp;<span class="op" id="5687589">:=</span>&nbsp;<span class="ident" id="5687592">info</span><span class="op" id="5687596">.</span><span class="ident" id="5687597">id</span><span class="op" id="5687599">.</span><span class="ident" id="5687600">gobType</span><span class="op" id="5687607">(</span><span class="op" id="5687608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687612">switch</span>&nbsp;<span class="ident" id="5687619">typ</span>&nbsp;<span class="op" id="5687623">:=</span>&nbsp;<span class="ident" id="5687626">rt</span><span class="op" id="5687628">;</span>&nbsp;<span class="ident" id="5687630">typ</span><span class="op" id="5687633">.</span><span class="ident" id="5687634">Kind</span><span class="op" id="5687638">(</span><span class="op" id="5687639">)</span>&nbsp;<span class="op" id="5687641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687645">case</span>&nbsp;<span class="ident" id="5687650">reflect</span><span class="op" id="5687657">.</span><span class="ident" id="5687658">Array</span><span class="op" id="5687663">:</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5687668">info</span><span class="op" id="5687672">.</span><span class="ident" id="5687673">wire</span>&nbsp;<span class="op" id="5687678">=</span>&nbsp;<span class="op" id="5687680">&amp;</span><span class="ident" id="5687681">wireType</span><span class="op" id="5687689">{</span><span class="ident" id="5687690">ArrayT</span><span class="op" id="5687696">:</span>&nbsp;<span class="ident" id="5687698">t</span><span class="op" id="5687699">.</span><span class="op" id="5687700">(</span><span class="op" id="5687701">*</span><span class="ident" id="5687702">arrayType</span><span class="op" id="5687711">)</span><span class="op" id="5687712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687716">case</span>&nbsp;<span class="ident" id="5687721">reflect</span><span class="op" id="5687728">.</span><span class="ident" id="5687729">Map</span><span class="op" id="5687732">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5687737">info</span><span class="op" id="5687741">.</span><span class="ident" id="5687742">wire</span>&nbsp;<span class="op" id="5687747">=</span>&nbsp;<span class="op" id="5687749">&amp;</span><span class="ident" id="5687750">wireType</span><span class="op" id="5687758">{</span><span class="ident" id="5687759">MapT</span><span class="op" id="5687763">:</span>&nbsp;<span class="ident" id="5687765">t</span><span class="op" id="5687766">.</span><span class="op" id="5687767">(</span><span class="op" id="5687768">*</span><span class="ident" id="5687769">mapType</span><span class="op" id="5687776">)</span><span class="op" id="5687777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687781">case</span>&nbsp;<span class="ident" id="5687786">reflect</span><span class="op" id="5687793">.</span><span class="ident" id="5687794">Slice</span><span class="op" id="5687799">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5687804">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;handled&nbsp;separately</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687865">if</span>&nbsp;<span class="ident" id="5687868">typ</span><span class="op" id="5687871">.</span><span class="ident" id="5687872">Elem</span><span class="op" id="5687876">(</span><span class="op" id="5687877">)</span><span class="op" id="5687878">.</span><span class="ident" id="5687879">Kind</span><span class="op" id="5687883">(</span><span class="op" id="5687884">)</span>&nbsp;<span class="op" id="5687886">!=</span>&nbsp;<span class="ident" id="5687889">reflect</span><span class="op" id="5687896">.</span><span class="ident" id="5687897">Uint8</span>&nbsp;<span class="op" id="5687903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5687909">info</span><span class="op" id="5687913">.</span><span class="ident" id="5687914">wire</span>&nbsp;<span class="op" id="5687919">=</span>&nbsp;<span class="op" id="5687921">&amp;</span><span class="ident" id="5687922">wireType</span><span class="op" id="5687930">{</span><span class="ident" id="5687931">SliceT</span><span class="op" id="5687937">:</span>&nbsp;<span class="ident" id="5687939">t</span><span class="op" id="5687940">.</span><span class="op" id="5687941">(</span><span class="op" id="5687942">*</span><span class="ident" id="5687943">sliceType</span><span class="op" id="5687952">)</span><span class="op" id="5687953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5687958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5687962">case</span>&nbsp;<span class="ident" id="5687967">reflect</span><span class="op" id="5687974">.</span><span class="ident" id="5687975">Struct</span><span class="op" id="5687981">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5687986">info</span><span class="op" id="5687990">.</span><span class="ident" id="5687991">wire</span>&nbsp;<span class="op" id="5687996">=</span>&nbsp;<span class="op" id="5687998">&amp;</span><span class="ident" id="5687999">wireType</span><span class="op" id="5688007">{</span><span class="ident" id="5688008">StructT</span><span class="op" id="5688015">:</span>&nbsp;<span class="ident" id="5688017">t</span><span class="op" id="5688018">.</span><span class="op" id="5688019">(</span><span class="op" id="5688020">*</span><span class="ident" id="5688021">structType</span><span class="op" id="5688031">)</span><span class="op" id="5688032">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5688036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5688039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5688043">//&nbsp;Create&nbsp;new&nbsp;map&nbsp;with&nbsp;old&nbsp;contents&nbsp;plus&nbsp;new&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5688096">newm</span>&nbsp;<span class="op" id="5688101">:=</span>&nbsp;<span class="builtinfunc" id="5688104">make</span><span class="op" id="5688108">(</span><span class="keyword" id="5688109">map</span><span class="op" id="5688112">[</span><span class="ident" id="5688113">reflect</span><span class="op" id="5688120">.</span><span class="ident" id="5688121">Type</span><span class="op" id="5688125">]</span><span class="op" id="5688126">*</span><span class="ident" id="5688127">typeInfo</span><span class="op" id="5688135">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5688138">m</span><span class="op" id="5688139">,</span>&nbsp;<span class="ident" id="5688141">_</span>&nbsp;<span class="op" id="5688143">:=</span>&nbsp;<span class="ident" id="5688146">typeInfoMap</span><span class="op" id="5688157">.</span><span class="ident" id="5688158">Load</span><span class="op" id="5688162">(</span><span class="op" id="5688163">)</span><span class="op" id="5688164">.</span><span class="op" id="5688165">(</span><span class="keyword" id="5688166">map</span><span class="op" id="5688169">[</span><span class="ident" id="5688170">reflect</span><span class="op" id="5688177">.</span><span class="ident" id="5688178">Type</span><span class="op" id="5688182">]</span><span class="op" id="5688183">*</span><span class="ident" id="5688184">typeInfo</span><span class="op" id="5688192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5688195">for</span>&nbsp;<span class="ident" id="5688199">k</span><span class="op" id="5688200">,</span>&nbsp;<span class="ident" id="5688202">v</span>&nbsp;<span class="op" id="5688204">:=</span>&nbsp;<span class="keyword" id="5688207">range</span>&nbsp;<span class="ident" id="5688213">m</span>&nbsp;<span class="op" id="5688215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5688219">newm</span><span class="op" id="5688223">[</span><span class="ident" id="5688224">k</span><span class="op" id="5688225">]</span>&nbsp;<span class="op" id="5688227">=</span>&nbsp;<span class="ident" id="5688229">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5688232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5688235">newm</span><span class="op" id="5688239">[</span><span class="ident" id="5688240">rt</span><span class="op" id="5688242">]</span>&nbsp;<span class="op" id="5688244">=</span>&nbsp;<span class="ident" id="5688246">info</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5688252">typeInfoMap</span><span class="op" id="5688263">.</span><span class="ident" id="5688264">Store</span><span class="op" id="5688269">(</span><span class="ident" id="5688270">newm</span><span class="op" id="5688274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5688277">return</span>&nbsp;<span class="ident" id="5688284">info</span><span class="op" id="5688288">,</span>&nbsp;<span class="builtintype" id="5688290">nil</span><br>
<span class="lineno"></span><span class="op" id="5688294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5688297">//&nbsp;Called&nbsp;only&nbsp;when&nbsp;a&nbsp;panic&nbsp;is&nbsp;acceptable&nbsp;and&nbsp;unexpected.</span><br>
<span class="lineno">775</span><span class="keyword" id="5688355">func</span>&nbsp;<span class="ident" id="5688360">mustGetTypeInfo</span><span class="op" id="5688375">(</span><span class="ident" id="5688376">rt</span>&nbsp;<span class="ident" id="5688379">reflect</span><span class="op" id="5688386">.</span><span class="ident" id="5688387">Type</span><span class="op" id="5688391">)</span>&nbsp;<span class="op" id="5688393">*</span><span class="ident" id="5688394">typeInfo</span>&nbsp;<span class="op" id="5688403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5688406">t</span><span class="op" id="5688407">,</span>&nbsp;<span class="ident" id="5688409">err</span>&nbsp;<span class="op" id="5688413">:=</span>&nbsp;<span class="ident" id="5688416">getTypeInfo</span><span class="op" id="5688427">(</span><span class="ident" id="5688428">userType</span><span class="op" id="5688436">(</span><span class="ident" id="5688437">rt</span><span class="op" id="5688439">)</span><span class="op" id="5688440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5688443">if</span>&nbsp;<span class="ident" id="5688446">err</span>&nbsp;<span class="op" id="5688450">!=</span>&nbsp;<span class="builtintype" id="5688453">nil</span>&nbsp;<span class="op" id="5688457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5688461">panic</span><span class="op" id="5688466">(</span><span class="string" id="5688467">&#34;getTypeInfo:&nbsp;&#34;</span>&nbsp;<span class="op" id="5688483">+</span>&nbsp;<span class="ident" id="5688485">err</span><span class="op" id="5688488">.</span><span class="ident" id="5688489">Error</span><span class="op" id="5688494">(</span><span class="op" id="5688495">)</span><span class="op" id="5688496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5688499">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5688502">return</span>&nbsp;<span class="ident" id="5688509">t</span><br>
<span class="lineno"></span><span class="op" id="5688511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5688514">//&nbsp;GobEncoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="5688583">//&nbsp;representation&nbsp;for&nbsp;encoding&nbsp;values&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder.</span><br>
<span class="lineno">785</span><span class="comment" id="5688655">//&nbsp;A&nbsp;type&nbsp;that&nbsp;implements&nbsp;GobEncoder&nbsp;and&nbsp;GobDecoder&nbsp;has&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="5688720">//&nbsp;control&nbsp;over&nbsp;the&nbsp;representation&nbsp;of&nbsp;its&nbsp;data&nbsp;and&nbsp;may&nbsp;therefore</span><br>
<span class="lineno"></span><span class="comment" id="5688785">//&nbsp;contain&nbsp;things&nbsp;such&nbsp;as&nbsp;private&nbsp;fields,&nbsp;channels,&nbsp;and&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="5688852">//&nbsp;which&nbsp;are&nbsp;not&nbsp;usually&nbsp;transmissible&nbsp;in&nbsp;gob&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="5688907">//</span><br>
<span class="lineno">790</span><span class="comment" id="5688910">//&nbsp;Note:&nbsp;Since&nbsp;gobs&nbsp;can&nbsp;be&nbsp;stored&nbsp;permanently,&nbsp;It&nbsp;is&nbsp;good&nbsp;design</span><br>
<span class="lineno"></span><span class="comment" id="5688975">//&nbsp;to&nbsp;guarantee&nbsp;the&nbsp;encoding&nbsp;used&nbsp;by&nbsp;a&nbsp;GobEncoder&nbsp;is&nbsp;stable&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5689042">//&nbsp;software&nbsp;evolves.&nbsp;&nbsp;For&nbsp;instance,&nbsp;it&nbsp;might&nbsp;make&nbsp;sense&nbsp;for&nbsp;GobEncode</span><br>
<span class="lineno"></span><span class="comment" id="5689112">//&nbsp;to&nbsp;include&nbsp;a&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5689160">type</span>&nbsp;<span class="ident" id="5689165">GobEncoder</span>&nbsp;<span class="keyword" id="5689176">interface</span>&nbsp;<span class="op" id="5689186">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5689189">//&nbsp;GobEncode&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;representing&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5689257">//&nbsp;receiver&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder,&nbsp;usually&nbsp;of&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5689324">//&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5689343">GobEncode</span><span class="op" id="5689352">(</span><span class="op" id="5689353">)</span>&nbsp;<span class="op" id="5689355">(</span><span class="op" id="5689356">[</span><span class="op" id="5689357">]</span><span class="builtintype" id="5689358">byte</span><span class="op" id="5689362">,</span>&nbsp;<span class="builtintype" id="5689364">error</span><span class="op" id="5689369">)</span><br>
<span class="lineno"></span><span class="op" id="5689371">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="5689374">//&nbsp;GobDecoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="5689443">//&nbsp;routine&nbsp;for&nbsp;decoding&nbsp;transmitted&nbsp;values&nbsp;sent&nbsp;by&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5689508">type</span>&nbsp;<span class="ident" id="5689513">GobDecoder</span>&nbsp;<span class="keyword" id="5689524">interface</span>&nbsp;<span class="op" id="5689534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5689537">//&nbsp;GobDecode&nbsp;overwrites&nbsp;the&nbsp;receiver,&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer,</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5689601">//&nbsp;with&nbsp;the&nbsp;value&nbsp;represented&nbsp;by&nbsp;the&nbsp;byte&nbsp;slice,&nbsp;which&nbsp;was&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5689669">//&nbsp;by&nbsp;GobEncode,&nbsp;usually&nbsp;for&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5689723">GobDecode</span><span class="op" id="5689732">(</span><span class="op" id="5689733">[</span><span class="op" id="5689734">]</span><span class="builtintype" id="5689735">byte</span><span class="op" id="5689739">)</span>&nbsp;<span class="builtintype" id="5689741">error</span><br>
<span class="lineno"></span><span class="op" id="5689747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="5689750">var</span>&nbsp;<span class="op" id="5689754">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5689757">registerLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5689776">sync</span><span class="op" id="5689780">.</span><span class="ident" id="5689781">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5689790">nameToConcreteType</span>&nbsp;<span class="op" id="5689809">=</span>&nbsp;<span class="builtinfunc" id="5689811">make</span><span class="op" id="5689815">(</span><span class="keyword" id="5689816">map</span><span class="op" id="5689819">[</span><span class="builtintype" id="5689820">string</span><span class="op" id="5689826">]</span><span class="ident" id="5689827">reflect</span><span class="op" id="5689834">.</span><span class="ident" id="5689835">Type</span><span class="op" id="5689839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5689842">concreteTypeToName</span>&nbsp;<span class="op" id="5689861">=</span>&nbsp;<span class="builtinfunc" id="5689863">make</span><span class="op" id="5689867">(</span><span class="keyword" id="5689868">map</span><span class="op" id="5689871">[</span><span class="ident" id="5689872">reflect</span><span class="op" id="5689879">.</span><span class="ident" id="5689880">Type</span><span class="op" id="5689884">]</span><span class="builtintype" id="5689885">string</span><span class="op" id="5689891">)</span><br>
<span class="lineno"></span><span class="op" id="5689893">)</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="5689896">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;rather&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5689972">//&nbsp;type&#39;s&nbsp;default.</span><br>
<span class="lineno"></span><span class="keyword" id="5689991">func</span>&nbsp;<span class="ident" id="5689996">RegisterName</span><span class="op" id="5690008">(</span><span class="ident" id="5690009">name</span>&nbsp;<span class="builtintype" id="5690014">string</span><span class="op" id="5690020">,</span>&nbsp;<span class="ident" id="5690022">value</span>&nbsp;<span class="keyword" id="5690028">interface</span><span class="op" id="5690037">{</span><span class="op" id="5690038">}</span><span class="op" id="5690039">)</span>&nbsp;<span class="op" id="5690041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690044">if</span>&nbsp;<span class="ident" id="5690047">name</span>&nbsp;<span class="op" id="5690052">==</span>&nbsp;<span class="string" id="5690055">&#34;&#34;</span>&nbsp;<span class="op" id="5690058">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5690062">//&nbsp;reserved&nbsp;for&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5690084">panic</span><span class="op" id="5690089">(</span><span class="string" id="5690090">&#34;attempt&nbsp;to&nbsp;register&nbsp;empty&nbsp;name&#34;</span><span class="op" id="5690122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5690125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690128">registerLock</span><span class="op" id="5690140">.</span><span class="ident" id="5690141">Lock</span><span class="op" id="5690145">(</span><span class="op" id="5690146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690149">defer</span>&nbsp;<span class="ident" id="5690155">registerLock</span><span class="op" id="5690167">.</span><span class="ident" id="5690168">Unlock</span><span class="op" id="5690174">(</span><span class="op" id="5690175">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690178">ut</span>&nbsp;<span class="op" id="5690181">:=</span>&nbsp;<span class="ident" id="5690184">userType</span><span class="op" id="5690192">(</span><span class="ident" id="5690193">reflect</span><span class="op" id="5690200">.</span><span class="ident" id="5690201">TypeOf</span><span class="op" id="5690207">(</span><span class="ident" id="5690208">value</span><span class="op" id="5690213">)</span><span class="op" id="5690214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5690217">//&nbsp;Check&nbsp;for&nbsp;incompatible&nbsp;duplicates.&nbsp;The&nbsp;name&nbsp;must&nbsp;refer&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5690283">//&nbsp;same&nbsp;user&nbsp;type,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690319">if</span>&nbsp;<span class="ident" id="5690322">t</span><span class="op" id="5690323">,</span>&nbsp;<span class="ident" id="5690325">ok</span>&nbsp;<span class="op" id="5690328">:=</span>&nbsp;<span class="ident" id="5690331">nameToConcreteType</span><span class="op" id="5690349">[</span><span class="ident" id="5690350">name</span><span class="op" id="5690354">]</span><span class="op" id="5690355">;</span>&nbsp;<span class="ident" id="5690357">ok</span>&nbsp;<span class="op" id="5690360">&amp;&amp;</span>&nbsp;<span class="ident" id="5690363">t</span>&nbsp;<span class="op" id="5690365">!=</span>&nbsp;<span class="ident" id="5690368">ut</span><span class="op" id="5690370">.</span><span class="ident" id="5690371">user</span>&nbsp;<span class="op" id="5690376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5690380">panic</span><span class="op" id="5690385">(</span><span class="ident" id="5690386">fmt</span><span class="op" id="5690389">.</span><span class="ident" id="5690390">Sprintf</span><span class="op" id="5690397">(</span><span class="string" id="5690398">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;types&nbsp;for&nbsp;%q:&nbsp;%s&nbsp;!=&nbsp;%s&#34;</span><span class="op" id="5690449">,</span>&nbsp;<span class="ident" id="5690451">name</span><span class="op" id="5690455">,</span>&nbsp;<span class="ident" id="5690457">t</span><span class="op" id="5690458">,</span>&nbsp;<span class="ident" id="5690460">ut</span><span class="op" id="5690462">.</span><span class="ident" id="5690463">user</span><span class="op" id="5690467">)</span><span class="op" id="5690468">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5690471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690474">if</span>&nbsp;<span class="ident" id="5690477">n</span><span class="op" id="5690478">,</span>&nbsp;<span class="ident" id="5690480">ok</span>&nbsp;<span class="op" id="5690483">:=</span>&nbsp;<span class="ident" id="5690486">concreteTypeToName</span><span class="op" id="5690504">[</span><span class="ident" id="5690505">ut</span><span class="op" id="5690507">.</span><span class="ident" id="5690508">base</span><span class="op" id="5690512">]</span><span class="op" id="5690513">;</span>&nbsp;<span class="ident" id="5690515">ok</span>&nbsp;<span class="op" id="5690518">&amp;&amp;</span>&nbsp;<span class="ident" id="5690521">n</span>&nbsp;<span class="op" id="5690523">!=</span>&nbsp;<span class="ident" id="5690526">name</span>&nbsp;<span class="op" id="5690531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5690535">panic</span><span class="op" id="5690540">(</span><span class="ident" id="5690541">fmt</span><span class="op" id="5690544">.</span><span class="ident" id="5690545">Sprintf</span><span class="op" id="5690552">(</span><span class="string" id="5690553">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;names&nbsp;for&nbsp;%s:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="5690604">,</span>&nbsp;<span class="ident" id="5690606">ut</span><span class="op" id="5690608">.</span><span class="ident" id="5690609">user</span><span class="op" id="5690613">,</span>&nbsp;<span class="ident" id="5690615">n</span><span class="op" id="5690616">,</span>&nbsp;<span class="ident" id="5690618">name</span><span class="op" id="5690622">)</span><span class="op" id="5690623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5690626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5690629">//&nbsp;Store&nbsp;the&nbsp;name&nbsp;and&nbsp;type&nbsp;provided&nbsp;by&nbsp;the&nbsp;user....</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690682">nameToConcreteType</span><span class="op" id="5690700">[</span><span class="ident" id="5690701">name</span><span class="op" id="5690705">]</span>&nbsp;<span class="op" id="5690707">=</span>&nbsp;<span class="ident" id="5690709">reflect</span><span class="op" id="5690716">.</span><span class="ident" id="5690717">TypeOf</span><span class="op" id="5690723">(</span><span class="ident" id="5690724">value</span><span class="op" id="5690729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5690732">//&nbsp;but&nbsp;the&nbsp;flattened&nbsp;type&nbsp;in&nbsp;the&nbsp;type&nbsp;table,&nbsp;since&nbsp;that&#39;s&nbsp;what&nbsp;decode&nbsp;needs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690810">concreteTypeToName</span><span class="op" id="5690828">[</span><span class="ident" id="5690829">ut</span><span class="op" id="5690831">.</span><span class="ident" id="5690832">base</span><span class="op" id="5690836">]</span>&nbsp;<span class="op" id="5690838">=</span>&nbsp;<span class="ident" id="5690840">name</span><br>
<span class="lineno"></span><span class="op" id="5690845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="5690848">//&nbsp;Register&nbsp;records&nbsp;a&nbsp;type,&nbsp;identified&nbsp;by&nbsp;a&nbsp;value&nbsp;for&nbsp;that&nbsp;type,&nbsp;under&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5690923">//&nbsp;internal&nbsp;type&nbsp;name.&nbsp;&nbsp;That&nbsp;name&nbsp;will&nbsp;identify&nbsp;the&nbsp;concrete&nbsp;type&nbsp;of&nbsp;a&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5691000">//&nbsp;sent&nbsp;or&nbsp;received&nbsp;as&nbsp;an&nbsp;interface&nbsp;variable.&nbsp;&nbsp;Only&nbsp;types&nbsp;that&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5691071">//&nbsp;transferred&nbsp;as&nbsp;implementations&nbsp;of&nbsp;interface&nbsp;values&nbsp;need&nbsp;to&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span><span class="comment" id="5691148">//&nbsp;Expecting&nbsp;to&nbsp;be&nbsp;used&nbsp;only&nbsp;during&nbsp;initialization,&nbsp;it&nbsp;panics&nbsp;if&nbsp;the&nbsp;mapping</span><br>
<span class="lineno">845</span><span class="comment" id="5691225">//&nbsp;between&nbsp;types&nbsp;and&nbsp;names&nbsp;is&nbsp;not&nbsp;a&nbsp;bijection.</span><br>
<span class="lineno"></span><span class="keyword" id="5691272">func</span>&nbsp;<span class="ident" id="5691277">Register</span><span class="op" id="5691285">(</span><span class="ident" id="5691286">value</span>&nbsp;<span class="keyword" id="5691292">interface</span><span class="op" id="5691301">{</span><span class="op" id="5691302">}</span><span class="op" id="5691303">)</span>&nbsp;<span class="op" id="5691305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691308">//&nbsp;Default&nbsp;to&nbsp;printed&nbsp;representation&nbsp;for&nbsp;unnamed&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691364">rt</span>&nbsp;<span class="op" id="5691367">:=</span>&nbsp;<span class="ident" id="5691370">reflect</span><span class="op" id="5691377">.</span><span class="ident" id="5691378">TypeOf</span><span class="op" id="5691384">(</span><span class="ident" id="5691385">value</span><span class="op" id="5691390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691393">name</span>&nbsp;<span class="op" id="5691398">:=</span>&nbsp;<span class="ident" id="5691401">rt</span><span class="op" id="5691403">.</span><span class="ident" id="5691404">String</span><span class="op" id="5691410">(</span><span class="op" id="5691411">)</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691415">//&nbsp;But&nbsp;for&nbsp;named&nbsp;types&nbsp;(or&nbsp;pointers&nbsp;to&nbsp;them),&nbsp;qualify&nbsp;with&nbsp;import&nbsp;path&nbsp;(but&nbsp;see&nbsp;inner&nbsp;comment).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691512">//&nbsp;Dereference&nbsp;one&nbsp;pointer&nbsp;looking&nbsp;for&nbsp;a&nbsp;named&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691566">star</span>&nbsp;<span class="op" id="5691571">:=</span>&nbsp;<span class="string" id="5691574">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5691578">if</span>&nbsp;<span class="ident" id="5691581">rt</span><span class="op" id="5691583">.</span><span class="ident" id="5691584">Name</span><span class="op" id="5691588">(</span><span class="op" id="5691589">)</span>&nbsp;<span class="op" id="5691591">==</span>&nbsp;<span class="string" id="5691594">&#34;&#34;</span>&nbsp;<span class="op" id="5691597">{</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5691601">if</span>&nbsp;<span class="ident" id="5691604">pt</span>&nbsp;<span class="op" id="5691607">:=</span>&nbsp;<span class="ident" id="5691610">rt</span><span class="op" id="5691612">;</span>&nbsp;<span class="ident" id="5691614">pt</span><span class="op" id="5691616">.</span><span class="ident" id="5691617">Kind</span><span class="op" id="5691621">(</span><span class="op" id="5691622">)</span>&nbsp;<span class="op" id="5691624">==</span>&nbsp;<span class="ident" id="5691627">reflect</span><span class="op" id="5691634">.</span><span class="ident" id="5691635">Ptr</span>&nbsp;<span class="op" id="5691639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691644">star</span>&nbsp;<span class="op" id="5691649">=</span>&nbsp;<span class="string" id="5691651">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691658">//&nbsp;NOTE:&nbsp;The&nbsp;following&nbsp;line&nbsp;should&nbsp;be&nbsp;rt&nbsp;=&nbsp;pt.Elem()&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691727">//&nbsp;what&nbsp;the&nbsp;comment&nbsp;above&nbsp;claims,&nbsp;but&nbsp;fixing&nbsp;it&nbsp;would&nbsp;break&nbsp;compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691804">//&nbsp;with&nbsp;existing&nbsp;gobs.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691830">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691836">//&nbsp;Given&nbsp;package&nbsp;p&nbsp;imported&nbsp;as&nbsp;&#34;full/p&#34;&nbsp;with&nbsp;these&nbsp;definitions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691903">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691923">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;T1&nbsp;struct&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691956">//&nbsp;this&nbsp;table&nbsp;shows&nbsp;the&nbsp;intended&nbsp;and&nbsp;actual&nbsp;strings&nbsp;used&nbsp;by&nbsp;gob&nbsp;to</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692026">//&nbsp;name&nbsp;the&nbsp;types:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692048">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692054">//&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Correct&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actual&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692103">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692109">//&nbsp;T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692154">//&nbsp;*T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p.T1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692195">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692201">//&nbsp;The&nbsp;missing&nbsp;full&nbsp;path&nbsp;cannot&nbsp;be&nbsp;fixed&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;gob&nbsp;decoders.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692285">rt</span>&nbsp;<span class="op" id="5692288">=</span>&nbsp;<span class="ident" id="5692290">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5692295">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5692298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5692301">if</span>&nbsp;<span class="ident" id="5692304">rt</span><span class="op" id="5692306">.</span><span class="ident" id="5692307">Name</span><span class="op" id="5692311">(</span><span class="op" id="5692312">)</span>&nbsp;<span class="op" id="5692314">!=</span>&nbsp;<span class="string" id="5692317">&#34;&#34;</span>&nbsp;<span class="op" id="5692320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5692324">if</span>&nbsp;<span class="ident" id="5692327">rt</span><span class="op" id="5692329">.</span><span class="ident" id="5692330">PkgPath</span><span class="op" id="5692337">(</span><span class="op" id="5692338">)</span>&nbsp;<span class="op" id="5692340">==</span>&nbsp;<span class="string" id="5692343">&#34;&#34;</span>&nbsp;<span class="op" id="5692346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692351">name</span>&nbsp;<span class="op" id="5692356">=</span>&nbsp;<span class="ident" id="5692358">star</span>&nbsp;<span class="op" id="5692363">+</span>&nbsp;<span class="ident" id="5692365">rt</span><span class="op" id="5692367">.</span><span class="ident" id="5692368">Name</span><span class="op" id="5692372">(</span><span class="op" id="5692373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5692377">}</span>&nbsp;<span class="keyword" id="5692379">else</span>&nbsp;<span class="op" id="5692384">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692389">name</span>&nbsp;<span class="op" id="5692394">=</span>&nbsp;<span class="ident" id="5692396">star</span>&nbsp;<span class="op" id="5692401">+</span>&nbsp;<span class="ident" id="5692403">rt</span><span class="op" id="5692405">.</span><span class="ident" id="5692406">PkgPath</span><span class="op" id="5692413">(</span><span class="op" id="5692414">)</span>&nbsp;<span class="op" id="5692416">+</span>&nbsp;<span class="string" id="5692418">&#34;.&#34;</span>&nbsp;<span class="op" id="5692422">+</span>&nbsp;<span class="ident" id="5692424">rt</span><span class="op" id="5692426">.</span><span class="ident" id="5692427">Name</span><span class="op" id="5692431">(</span><span class="op" id="5692432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5692436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5692439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692443">RegisterName</span><span class="op" id="5692455">(</span><span class="ident" id="5692456">name</span><span class="op" id="5692460">,</span>&nbsp;<span class="ident" id="5692462">value</span><span class="op" id="5692467">)</span><br>
<span class="lineno">885</span><span class="op" id="5692469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5692472">func</span>&nbsp;<span class="ident" id="5692477">registerBasics</span><span class="op" id="5692491">(</span><span class="op" id="5692492">)</span>&nbsp;<span class="op" id="5692494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692497">Register</span><span class="op" id="5692505">(</span><span class="builtintype" id="5692506">int</span><span class="op" id="5692509">(</span><span class="num" id="5692510">0</span><span class="op" id="5692511">)</span><span class="op" id="5692512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692515">Register</span><span class="op" id="5692523">(</span><span class="builtintype" id="5692524">int8</span><span class="op" id="5692528">(</span><span class="num" id="5692529">0</span><span class="op" id="5692530">)</span><span class="op" id="5692531">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692534">Register</span><span class="op" id="5692542">(</span><span class="builtintype" id="5692543">int16</span><span class="op" id="5692548">(</span><span class="num" id="5692549">0</span><span class="op" id="5692550">)</span><span class="op" id="5692551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692554">Register</span><span class="op" id="5692562">(</span><span class="builtintype" id="5692563">int32</span><span class="op" id="5692568">(</span><span class="num" id="5692569">0</span><span class="op" id="5692570">)</span><span class="op" id="5692571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692574">Register</span><span class="op" id="5692582">(</span><span class="builtintype" id="5692583">int64</span><span class="op" id="5692588">(</span><span class="num" id="5692589">0</span><span class="op" id="5692590">)</span><span class="op" id="5692591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692594">Register</span><span class="op" id="5692602">(</span><span class="builtintype" id="5692603">uint</span><span class="op" id="5692607">(</span><span class="num" id="5692608">0</span><span class="op" id="5692609">)</span><span class="op" id="5692610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692613">Register</span><span class="op" id="5692621">(</span><span class="builtintype" id="5692622">uint8</span><span class="op" id="5692627">(</span><span class="num" id="5692628">0</span><span class="op" id="5692629">)</span><span class="op" id="5692630">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692633">Register</span><span class="op" id="5692641">(</span><span class="builtintype" id="5692642">uint16</span><span class="op" id="5692648">(</span><span class="num" id="5692649">0</span><span class="op" id="5692650">)</span><span class="op" id="5692651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692654">Register</span><span class="op" id="5692662">(</span><span class="builtintype" id="5692663">uint32</span><span class="op" id="5692669">(</span><span class="num" id="5692670">0</span><span class="op" id="5692671">)</span><span class="op" id="5692672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692675">Register</span><span class="op" id="5692683">(</span><span class="builtintype" id="5692684">uint64</span><span class="op" id="5692690">(</span><span class="num" id="5692691">0</span><span class="op" id="5692692">)</span><span class="op" id="5692693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692696">Register</span><span class="op" id="5692704">(</span><span class="builtintype" id="5692705">float32</span><span class="op" id="5692712">(</span><span class="num" id="5692713">0</span><span class="op" id="5692714">)</span><span class="op" id="5692715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692718">Register</span><span class="op" id="5692726">(</span><span class="builtintype" id="5692727">float64</span><span class="op" id="5692734">(</span><span class="num" id="5692735">0</span><span class="op" id="5692736">)</span><span class="op" id="5692737">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692740">Register</span><span class="op" id="5692748">(</span><span class="builtintype" id="5692749">complex64</span><span class="op" id="5692758">(</span><span class="num" id="5692759">0i</span><span class="op" id="5692761">)</span><span class="op" id="5692762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692765">Register</span><span class="op" id="5692773">(</span><span class="builtintype" id="5692774">complex128</span><span class="op" id="5692784">(</span><span class="num" id="5692785">0i</span><span class="op" id="5692787">)</span><span class="op" id="5692788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692791">Register</span><span class="op" id="5692799">(</span><span class="builtintype" id="5692800">uintptr</span><span class="op" id="5692807">(</span><span class="num" id="5692808">0</span><span class="op" id="5692809">)</span><span class="op" id="5692810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692813">Register</span><span class="op" id="5692821">(</span><span class="builtintype" id="5692822">false</span><span class="op" id="5692827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692830">Register</span><span class="op" id="5692838">(</span><span class="string" id="5692839">&#34;&#34;</span><span class="op" id="5692841">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692844">Register</span><span class="op" id="5692852">(</span><span class="op" id="5692853">[</span><span class="op" id="5692854">]</span><span class="builtintype" id="5692855">byte</span><span class="op" id="5692859">(</span><span class="builtintype" id="5692860">nil</span><span class="op" id="5692863">)</span><span class="op" id="5692864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692867">Register</span><span class="op" id="5692875">(</span><span class="op" id="5692876">[</span><span class="op" id="5692877">]</span><span class="builtintype" id="5692878">int</span><span class="op" id="5692881">(</span><span class="builtintype" id="5692882">nil</span><span class="op" id="5692885">)</span><span class="op" id="5692886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692889">Register</span><span class="op" id="5692897">(</span><span class="op" id="5692898">[</span><span class="op" id="5692899">]</span><span class="builtintype" id="5692900">int8</span><span class="op" id="5692904">(</span><span class="builtintype" id="5692905">nil</span><span class="op" id="5692908">)</span><span class="op" id="5692909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692912">Register</span><span class="op" id="5692920">(</span><span class="op" id="5692921">[</span><span class="op" id="5692922">]</span><span class="builtintype" id="5692923">int16</span><span class="op" id="5692928">(</span><span class="builtintype" id="5692929">nil</span><span class="op" id="5692932">)</span><span class="op" id="5692933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692936">Register</span><span class="op" id="5692944">(</span><span class="op" id="5692945">[</span><span class="op" id="5692946">]</span><span class="builtintype" id="5692947">int32</span><span class="op" id="5692952">(</span><span class="builtintype" id="5692953">nil</span><span class="op" id="5692956">)</span><span class="op" id="5692957">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692960">Register</span><span class="op" id="5692968">(</span><span class="op" id="5692969">[</span><span class="op" id="5692970">]</span><span class="builtintype" id="5692971">int64</span><span class="op" id="5692976">(</span><span class="builtintype" id="5692977">nil</span><span class="op" id="5692980">)</span><span class="op" id="5692981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692984">Register</span><span class="op" id="5692992">(</span><span class="op" id="5692993">[</span><span class="op" id="5692994">]</span><span class="builtintype" id="5692995">uint</span><span class="op" id="5692999">(</span><span class="builtintype" id="5693000">nil</span><span class="op" id="5693003">)</span><span class="op" id="5693004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693007">Register</span><span class="op" id="5693015">(</span><span class="op" id="5693016">[</span><span class="op" id="5693017">]</span><span class="builtintype" id="5693018">uint8</span><span class="op" id="5693023">(</span><span class="builtintype" id="5693024">nil</span><span class="op" id="5693027">)</span><span class="op" id="5693028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693031">Register</span><span class="op" id="5693039">(</span><span class="op" id="5693040">[</span><span class="op" id="5693041">]</span><span class="builtintype" id="5693042">uint16</span><span class="op" id="5693048">(</span><span class="builtintype" id="5693049">nil</span><span class="op" id="5693052">)</span><span class="op" id="5693053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693056">Register</span><span class="op" id="5693064">(</span><span class="op" id="5693065">[</span><span class="op" id="5693066">]</span><span class="builtintype" id="5693067">uint32</span><span class="op" id="5693073">(</span><span class="builtintype" id="5693074">nil</span><span class="op" id="5693077">)</span><span class="op" id="5693078">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693081">Register</span><span class="op" id="5693089">(</span><span class="op" id="5693090">[</span><span class="op" id="5693091">]</span><span class="builtintype" id="5693092">uint64</span><span class="op" id="5693098">(</span><span class="builtintype" id="5693099">nil</span><span class="op" id="5693102">)</span><span class="op" id="5693103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693106">Register</span><span class="op" id="5693114">(</span><span class="op" id="5693115">[</span><span class="op" id="5693116">]</span><span class="builtintype" id="5693117">float32</span><span class="op" id="5693124">(</span><span class="builtintype" id="5693125">nil</span><span class="op" id="5693128">)</span><span class="op" id="5693129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693132">Register</span><span class="op" id="5693140">(</span><span class="op" id="5693141">[</span><span class="op" id="5693142">]</span><span class="builtintype" id="5693143">float64</span><span class="op" id="5693150">(</span><span class="builtintype" id="5693151">nil</span><span class="op" id="5693154">)</span><span class="op" id="5693155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693158">Register</span><span class="op" id="5693166">(</span><span class="op" id="5693167">[</span><span class="op" id="5693168">]</span><span class="builtintype" id="5693169">complex64</span><span class="op" id="5693178">(</span><span class="builtintype" id="5693179">nil</span><span class="op" id="5693182">)</span><span class="op" id="5693183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693186">Register</span><span class="op" id="5693194">(</span><span class="op" id="5693195">[</span><span class="op" id="5693196">]</span><span class="builtintype" id="5693197">complex128</span><span class="op" id="5693207">(</span><span class="builtintype" id="5693208">nil</span><span class="op" id="5693211">)</span><span class="op" id="5693212">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693215">Register</span><span class="op" id="5693223">(</span><span class="op" id="5693224">[</span><span class="op" id="5693225">]</span><span class="builtintype" id="5693226">uintptr</span><span class="op" id="5693233">(</span><span class="builtintype" id="5693234">nil</span><span class="op" id="5693237">)</span><span class="op" id="5693238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693241">Register</span><span class="op" id="5693249">(</span><span class="op" id="5693250">[</span><span class="op" id="5693251">]</span><span class="builtintype" id="5693252">bool</span><span class="op" id="5693256">(</span><span class="builtintype" id="5693257">nil</span><span class="op" id="5693260">)</span><span class="op" id="5693261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693264">Register</span><span class="op" id="5693272">(</span><span class="op" id="5693273">[</span><span class="op" id="5693274">]</span><span class="builtintype" id="5693275">string</span><span class="op" id="5693281">(</span><span class="builtintype" id="5693282">nil</span><span class="op" id="5693285">)</span><span class="op" id="5693286">)</span><br>
<span class="lineno"></span><span class="op" id="5693288">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
