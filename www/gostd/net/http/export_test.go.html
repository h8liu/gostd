<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6553517">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6553573">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6553627">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6553678">//&nbsp;Bridge&nbsp;package&nbsp;to&nbsp;expose&nbsp;http&nbsp;internals&nbsp;to&nbsp;tests&nbsp;in&nbsp;the&nbsp;http_test</span><br>
<span class="lineno"></span><span class="comment" id="6553747">//&nbsp;package.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6553760">package</span>&nbsp;<span class="ident" id="6553768">http</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6553774">import</span>&nbsp;<span class="op" id="6553781">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6553784">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6553791">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6553802">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6553809">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6553812">func</span>&nbsp;<span class="ident" id="6553817">NewLoggingConn</span><span class="op" id="6553831">(</span><span class="ident" id="6553832">baseName</span>&nbsp;<span class="builtintype" id="6553841">string</span><span class="op" id="6553847">,</span>&nbsp;<span class="ident" id="6553849">c</span>&nbsp;<span class="ident" id="6553851">net</span><span class="op" id="6553854">.</span><span class="ident" id="6553855">Conn</span><span class="op" id="6553859">)</span>&nbsp;<span class="ident" id="6553861">net</span><span class="op" id="6553864">.</span><span class="ident" id="6553865">Conn</span>&nbsp;<span class="op" id="6553870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553873">return</span>&nbsp;<span class="ident" id="6553880">newLoggingConn</span><span class="op" id="6553894">(</span><span class="ident" id="6553895">baseName</span><span class="op" id="6553903">,</span>&nbsp;<span class="ident" id="6553905">c</span><span class="op" id="6553906">)</span><br>
<span class="lineno"></span><span class="op" id="6553908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6553911">var</span>&nbsp;<span class="ident" id="6553915">ExportAppendTime</span>&nbsp;<span class="op" id="6553932">=</span>&nbsp;<span class="ident" id="6553934">appendTime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6553946">func</span>&nbsp;<span class="op" id="6553951">(</span><span class="ident" id="6553952">t</span>&nbsp;<span class="op" id="6553954">*</span><span class="ident" id="6553955">Transport</span><span class="op" id="6553964">)</span>&nbsp;<span class="ident" id="6553966">NumPendingRequestsForTesting</span><span class="op" id="6553994">(</span><span class="op" id="6553995">)</span>&nbsp;<span class="builtintype" id="6553997">int</span>&nbsp;<span class="op" id="6554001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554004">t</span><span class="op" id="6554005">.</span><span class="ident" id="6554006">reqMu</span><span class="op" id="6554011">.</span><span class="ident" id="6554012">Lock</span><span class="op" id="6554016">(</span><span class="op" id="6554017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554020">defer</span>&nbsp;<span class="ident" id="6554026">t</span><span class="op" id="6554027">.</span><span class="ident" id="6554028">reqMu</span><span class="op" id="6554033">.</span><span class="ident" id="6554034">Unlock</span><span class="op" id="6554040">(</span><span class="op" id="6554041">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554044">return</span>&nbsp;<span class="builtinfunc" id="6554051">len</span><span class="op" id="6554054">(</span><span class="ident" id="6554055">t</span><span class="op" id="6554056">.</span><span class="ident" id="6554057">reqCanceler</span><span class="op" id="6554068">)</span><br>
<span class="lineno"></span><span class="op" id="6554070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6554073">func</span>&nbsp;<span class="op" id="6554078">(</span><span class="ident" id="6554079">t</span>&nbsp;<span class="op" id="6554081">*</span><span class="ident" id="6554082">Transport</span><span class="op" id="6554091">)</span>&nbsp;<span class="ident" id="6554093">IdleConnKeysForTesting</span><span class="op" id="6554115">(</span><span class="op" id="6554116">)</span>&nbsp;<span class="op" id="6554118">(</span><span class="ident" id="6554119">keys</span>&nbsp;<span class="op" id="6554124">[</span><span class="op" id="6554125">]</span><span class="builtintype" id="6554126">string</span><span class="op" id="6554132">)</span>&nbsp;<span class="op" id="6554134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554137">keys</span>&nbsp;<span class="op" id="6554142">=</span>&nbsp;<span class="builtinfunc" id="6554144">make</span><span class="op" id="6554148">(</span><span class="op" id="6554149">[</span><span class="op" id="6554150">]</span><span class="builtintype" id="6554151">string</span><span class="op" id="6554157">,</span>&nbsp;<span class="num" id="6554159">0</span><span class="op" id="6554160">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554163">t</span><span class="op" id="6554164">.</span><span class="ident" id="6554165">idleMu</span><span class="op" id="6554171">.</span><span class="ident" id="6554172">Lock</span><span class="op" id="6554176">(</span><span class="op" id="6554177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554180">defer</span>&nbsp;<span class="ident" id="6554186">t</span><span class="op" id="6554187">.</span><span class="ident" id="6554188">idleMu</span><span class="op" id="6554194">.</span><span class="ident" id="6554195">Unlock</span><span class="op" id="6554201">(</span><span class="op" id="6554202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554205">if</span>&nbsp;<span class="ident" id="6554208">t</span><span class="op" id="6554209">.</span><span class="ident" id="6554210">idleConn</span>&nbsp;<span class="op" id="6554219">==</span>&nbsp;<span class="ident" id="6554222">nil</span>&nbsp;<span class="op" id="6554226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554230">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6554238">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554241">for</span>&nbsp;<span class="ident" id="6554245">key</span>&nbsp;<span class="op" id="6554249">:=</span>&nbsp;<span class="keyword" id="6554252">range</span>&nbsp;<span class="ident" id="6554258">t</span><span class="op" id="6554259">.</span><span class="ident" id="6554260">idleConn</span>&nbsp;<span class="op" id="6554269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554273">keys</span>&nbsp;<span class="op" id="6554278">=</span>&nbsp;<span class="builtinfunc" id="6554280">append</span><span class="op" id="6554286">(</span><span class="ident" id="6554287">keys</span><span class="op" id="6554291">,</span>&nbsp;<span class="ident" id="6554293">key</span><span class="op" id="6554296">.</span><span class="ident" id="6554297">String</span><span class="op" id="6554303">(</span><span class="op" id="6554304">)</span><span class="op" id="6554305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6554308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554311">return</span><br>
<span class="lineno"></span><span class="op" id="6554318">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6554321">func</span>&nbsp;<span class="op" id="6554326">(</span><span class="ident" id="6554327">t</span>&nbsp;<span class="op" id="6554329">*</span><span class="ident" id="6554330">Transport</span><span class="op" id="6554339">)</span>&nbsp;<span class="ident" id="6554341">IdleConnCountForTesting</span><span class="op" id="6554364">(</span><span class="ident" id="6554365">cacheKey</span>&nbsp;<span class="builtintype" id="6554374">string</span><span class="op" id="6554380">)</span>&nbsp;<span class="builtintype" id="6554382">int</span>&nbsp;<span class="op" id="6554386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554389">t</span><span class="op" id="6554390">.</span><span class="ident" id="6554391">idleMu</span><span class="op" id="6554397">.</span><span class="ident" id="6554398">Lock</span><span class="op" id="6554402">(</span><span class="op" id="6554403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554406">defer</span>&nbsp;<span class="ident" id="6554412">t</span><span class="op" id="6554413">.</span><span class="ident" id="6554414">idleMu</span><span class="op" id="6554420">.</span><span class="ident" id="6554421">Unlock</span><span class="op" id="6554427">(</span><span class="op" id="6554428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554431">if</span>&nbsp;<span class="ident" id="6554434">t</span><span class="op" id="6554435">.</span><span class="ident" id="6554436">idleConn</span>&nbsp;<span class="op" id="6554445">==</span>&nbsp;<span class="ident" id="6554448">nil</span>&nbsp;<span class="op" id="6554452">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554456">return</span>&nbsp;<span class="num" id="6554463">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6554466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554469">for</span>&nbsp;<span class="ident" id="6554473">k</span><span class="op" id="6554474">,</span>&nbsp;<span class="ident" id="6554476">conns</span>&nbsp;<span class="op" id="6554482">:=</span>&nbsp;<span class="keyword" id="6554485">range</span>&nbsp;<span class="ident" id="6554491">t</span><span class="op" id="6554492">.</span><span class="ident" id="6554493">idleConn</span>&nbsp;<span class="op" id="6554502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554506">if</span>&nbsp;<span class="ident" id="6554509">k</span><span class="op" id="6554510">.</span><span class="ident" id="6554511">String</span><span class="op" id="6554517">(</span><span class="op" id="6554518">)</span>&nbsp;<span class="op" id="6554520">==</span>&nbsp;<span class="ident" id="6554523">cacheKey</span>&nbsp;<span class="op" id="6554532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554537">return</span>&nbsp;<span class="builtinfunc" id="6554544">len</span><span class="op" id="6554547">(</span><span class="ident" id="6554548">conns</span><span class="op" id="6554553">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6554557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6554560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554563">return</span>&nbsp;<span class="num" id="6554570">0</span><br>
<span class="lineno"></span><span class="op" id="6554572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6554575">func</span>&nbsp;<span class="op" id="6554580">(</span><span class="ident" id="6554581">t</span>&nbsp;<span class="op" id="6554583">*</span><span class="ident" id="6554584">Transport</span><span class="op" id="6554593">)</span>&nbsp;<span class="ident" id="6554595">IdleConnChMapSizeForTesting</span><span class="op" id="6554622">(</span><span class="op" id="6554623">)</span>&nbsp;<span class="builtintype" id="6554625">int</span>&nbsp;<span class="op" id="6554629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554632">t</span><span class="op" id="6554633">.</span><span class="ident" id="6554634">idleMu</span><span class="op" id="6554640">.</span><span class="ident" id="6554641">Lock</span><span class="op" id="6554645">(</span><span class="op" id="6554646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554649">defer</span>&nbsp;<span class="ident" id="6554655">t</span><span class="op" id="6554656">.</span><span class="ident" id="6554657">idleMu</span><span class="op" id="6554663">.</span><span class="ident" id="6554664">Unlock</span><span class="op" id="6554670">(</span><span class="op" id="6554671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554674">return</span>&nbsp;<span class="builtinfunc" id="6554681">len</span><span class="op" id="6554684">(</span><span class="ident" id="6554685">t</span><span class="op" id="6554686">.</span><span class="ident" id="6554687">idleConnCh</span><span class="op" id="6554697">)</span><br>
<span class="lineno"></span><span class="op" id="6554699">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6554702">func</span>&nbsp;<span class="op" id="6554707">(</span><span class="ident" id="6554708">t</span>&nbsp;<span class="op" id="6554710">*</span><span class="ident" id="6554711">Transport</span><span class="op" id="6554720">)</span>&nbsp;<span class="ident" id="6554722">IsIdleForTesting</span><span class="op" id="6554738">(</span><span class="op" id="6554739">)</span>&nbsp;<span class="builtintype" id="6554741">bool</span>&nbsp;<span class="op" id="6554746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554749">t</span><span class="op" id="6554750">.</span><span class="ident" id="6554751">idleMu</span><span class="op" id="6554757">.</span><span class="ident" id="6554758">Lock</span><span class="op" id="6554762">(</span><span class="op" id="6554763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554766">defer</span>&nbsp;<span class="ident" id="6554772">t</span><span class="op" id="6554773">.</span><span class="ident" id="6554774">idleMu</span><span class="op" id="6554780">.</span><span class="ident" id="6554781">Unlock</span><span class="op" id="6554787">(</span><span class="op" id="6554788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554791">return</span>&nbsp;<span class="ident" id="6554798">t</span><span class="op" id="6554799">.</span><span class="ident" id="6554800">wantIdle</span><br>
<span class="lineno">65</span><span class="op" id="6554809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6554812">func</span>&nbsp;<span class="op" id="6554817">(</span><span class="ident" id="6554818">t</span>&nbsp;<span class="op" id="6554820">*</span><span class="ident" id="6554821">Transport</span><span class="op" id="6554830">)</span>&nbsp;<span class="ident" id="6554832">RequestIdleConnChForTesting</span><span class="op" id="6554859">(</span><span class="op" id="6554860">)</span>&nbsp;<span class="op" id="6554862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554865">t</span><span class="op" id="6554866">.</span><span class="ident" id="6554867">getIdleConnCh</span><span class="op" id="6554880">(</span><span class="ident" id="6554881">connectMethod</span><span class="op" id="6554894">{</span><span class="ident" id="6554895">nil</span><span class="op" id="6554898">,</span>&nbsp;<span class="string" id="6554900">&#34;http&#34;</span><span class="op" id="6554906">,</span>&nbsp;<span class="string" id="6554908">&#34;example.com&#34;</span><span class="op" id="6554921">}</span><span class="op" id="6554922">)</span><br>
<span class="lineno"></span><span class="op" id="6554924">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="6554927">func</span>&nbsp;<span class="op" id="6554932">(</span><span class="ident" id="6554933">t</span>&nbsp;<span class="op" id="6554935">*</span><span class="ident" id="6554936">Transport</span><span class="op" id="6554945">)</span>&nbsp;<span class="ident" id="6554947">PutIdleTestConn</span><span class="op" id="6554962">(</span><span class="op" id="6554963">)</span>&nbsp;<span class="builtintype" id="6554965">bool</span>&nbsp;<span class="op" id="6554970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554973">c</span><span class="op" id="6554974">,</span>&nbsp;<span class="ident" id="6554976">_</span>&nbsp;<span class="op" id="6554978">:=</span>&nbsp;<span class="ident" id="6554981">net</span><span class="op" id="6554984">.</span><span class="ident" id="6554985">Pipe</span><span class="op" id="6554989">(</span><span class="op" id="6554990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554993">return</span>&nbsp;<span class="ident" id="6555000">t</span><span class="op" id="6555001">.</span><span class="ident" id="6555002">putIdleConn</span><span class="op" id="6555013">(</span><span class="op" id="6555014">&amp;</span><span class="ident" id="6555015">persistConn</span><span class="op" id="6555026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555030">t</span><span class="op" id="6555031">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6555040">t</span><span class="op" id="6555041">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555045">conn</span><span class="op" id="6555049">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6555055">c</span><span class="op" id="6555056">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6555076">//&nbsp;dummy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555087">closech</span><span class="op" id="6555094">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="6555097">make</span><span class="op" id="6555101">(</span><span class="keyword" id="6555102">chan</span>&nbsp;<span class="keyword" id="6555107">struct</span><span class="op" id="6555113">{</span><span class="op" id="6555114">}</span><span class="op" id="6555115">)</span><span class="op" id="6555116">,</span>&nbsp;<span class="comment" id="6555118">//&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555143">cacheKey</span><span class="op" id="6555151">:</span>&nbsp;<span class="ident" id="6555153">connectMethodKey</span><span class="op" id="6555169">{</span><span class="string" id="6555170">&#34;&#34;</span><span class="op" id="6555172">,</span>&nbsp;<span class="string" id="6555174">&#34;http&#34;</span><span class="op" id="6555180">,</span>&nbsp;<span class="string" id="6555182">&#34;example.com&#34;</span><span class="op" id="6555195">}</span><span class="op" id="6555196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6555199">}</span><span class="op" id="6555200">)</span><br>
<span class="lineno"></span><span class="op" id="6555202">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="6555205">func</span>&nbsp;<span class="ident" id="6555210">NewTestTimeoutHandler</span><span class="op" id="6555231">(</span><span class="ident" id="6555232">handler</span>&nbsp;<span class="ident" id="6555240">Handler</span><span class="op" id="6555247">,</span>&nbsp;<span class="ident" id="6555249">ch</span>&nbsp;<span class="op" id="6555252">&lt;-</span><span class="keyword" id="6555254">chan</span>&nbsp;<span class="ident" id="6555259">time</span><span class="op" id="6555263">.</span><span class="ident" id="6555264">Time</span><span class="op" id="6555268">)</span>&nbsp;<span class="ident" id="6555270">Handler</span>&nbsp;<span class="op" id="6555278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555281">f</span>&nbsp;<span class="op" id="6555283">:=</span>&nbsp;<span class="keyword" id="6555286">func</span><span class="op" id="6555290">(</span><span class="op" id="6555291">)</span>&nbsp;<span class="op" id="6555293">&lt;-</span><span class="keyword" id="6555295">chan</span>&nbsp;<span class="ident" id="6555300">time</span><span class="op" id="6555304">.</span><span class="ident" id="6555305">Time</span>&nbsp;<span class="op" id="6555310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6555314">return</span>&nbsp;<span class="ident" id="6555321">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6555325">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6555328">return</span>&nbsp;<span class="op" id="6555335">&amp;</span><span class="ident" id="6555336">timeoutHandler</span><span class="op" id="6555350">{</span><span class="ident" id="6555351">handler</span><span class="op" id="6555358">,</span>&nbsp;<span class="ident" id="6555360">f</span><span class="op" id="6555361">,</span>&nbsp;<span class="string" id="6555363">&#34;&#34;</span><span class="op" id="6555365">}</span><br>
<span class="lineno"></span><span class="op" id="6555367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6555370">func</span>&nbsp;<span class="ident" id="6555375">ResetCachedEnvironment</span><span class="op" id="6555397">(</span><span class="op" id="6555398">)</span>&nbsp;<span class="op" id="6555400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555403">httpProxyEnv</span><span class="op" id="6555415">.</span><span class="ident" id="6555416">reset</span><span class="op" id="6555421">(</span><span class="op" id="6555422">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555425">httpsProxyEnv</span><span class="op" id="6555438">.</span><span class="ident" id="6555439">reset</span><span class="op" id="6555444">(</span><span class="op" id="6555445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555448">noProxyEnv</span><span class="op" id="6555458">.</span><span class="ident" id="6555459">reset</span><span class="op" id="6555464">(</span><span class="op" id="6555465">)</span><br>
<span class="lineno"></span><span class="op" id="6555467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6555470">var</span>&nbsp;<span class="ident" id="6555474">DefaultUserAgent</span>&nbsp;<span class="op" id="6555491">=</span>&nbsp;<span class="ident" id="6555493">defaultUserAgent</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="6555511">func</span>&nbsp;<span class="ident" id="6555516">ExportRefererForURL</span><span class="op" id="6555535">(</span><span class="ident" id="6555536">lastReq</span><span class="op" id="6555543">,</span>&nbsp;<span class="ident" id="6555545">newReq</span>&nbsp;<span class="op" id="6555552">*</span><span class="ident" id="6555553">url</span><span class="op" id="6555556">.</span><span class="ident" id="6555557">URL</span><span class="op" id="6555560">)</span>&nbsp;<span class="builtintype" id="6555562">string</span>&nbsp;<span class="op" id="6555569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6555572">return</span>&nbsp;<span class="ident" id="6555579">refererForURL</span><span class="op" id="6555592">(</span><span class="ident" id="6555593">lastReq</span><span class="op" id="6555600">,</span>&nbsp;<span class="ident" id="6555602">newReq</span><span class="op" id="6555608">)</span><br>
<span class="lineno"></span><span class="op" id="6555610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="6555613">//&nbsp;SetPendingDialHooks&nbsp;sets&nbsp;the&nbsp;hooks&nbsp;that&nbsp;run&nbsp;before&nbsp;and&nbsp;after&nbsp;handling</span><br>
<span class="lineno"></span><span class="comment" id="6555686">//&nbsp;pending&nbsp;dials.</span><br>
<span class="lineno"></span><span class="keyword" id="6555704">func</span>&nbsp;<span class="ident" id="6555709">SetPendingDialHooks</span><span class="op" id="6555728">(</span><span class="ident" id="6555729">before</span><span class="op" id="6555735">,</span>&nbsp;<span class="ident" id="6555737">after</span>&nbsp;<span class="keyword" id="6555743">func</span><span class="op" id="6555747">(</span><span class="op" id="6555748">)</span><span class="op" id="6555749">)</span>&nbsp;<span class="op" id="6555751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555754">prePendingDial</span><span class="op" id="6555768">,</span>&nbsp;<span class="ident" id="6555770">postPendingDial</span>&nbsp;<span class="op" id="6555786">=</span>&nbsp;<span class="ident" id="6555788">before</span><span class="op" id="6555794">,</span>&nbsp;<span class="ident" id="6555796">after</span><br>
<span class="lineno"></span><span class="op" id="6555802">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6555805">var</span>&nbsp;<span class="ident" id="6555809">ExportServerNewConn</span>&nbsp;<span class="op" id="6555829">=</span>&nbsp;<span class="op" id="6555831">(</span><span class="op" id="6555832">*</span><span class="ident" id="6555833">Server</span><span class="op" id="6555839">)</span><span class="op" id="6555840">.</span><span class="ident" id="6555841">newConn</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6555850">var</span>&nbsp;<span class="ident" id="6555854">ExportCloseWriteAndWait</span>&nbsp;<span class="op" id="6555878">=</span>&nbsp;<span class="op" id="6555880">(</span><span class="op" id="6555881">*</span><span class="ident" id="6555882">conn</span><span class="op" id="6555886">)</span><span class="op" id="6555887">.</span><span class="ident" id="6555888">closeWriteAndWait</span>
</div>
</body>
</html>
